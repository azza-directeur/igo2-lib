"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[732],{76732:(O,v,s)=>{s.r(v),s.d(v,{NestedAppAuthController:()=>E});var d=s(35392),k=s(59512),m=s(1384),C=s(36424),l=s(85696),w=s(55536),U=s(75796),N=s(24148),f=s(35348),p=s(57048),h=s(11168),y=s(41048),S=s(52852),P=s(98988),g=s(29480);class b{constructor(e,t,n,o){this.clientId=e,this.clientCapabilities=t,this.crypto=n,this.logger=o}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));const o=(new U.I).addClientCapabilitiesToClaims(e.claims,this.clientCapabilities);return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:e.scopes.join(" "),correlationId:void 0!==e.correlationId?e.correlationId:this.crypto.createNewGuid(),claims:N.e.isEmptyObj(o)?void 0:o,state:e.state,authenticationScheme:e.authenticationScheme||f.me.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,n){if(!t.token.id_token||!t.token.access_token)throw(0,p.mQ)(h.cf);const o=new Date(1e3*(n+(t.token.expires_in||0))),a=y.aw(t.token.id_token,this.crypto.base64Decode),i=this.fromNaaAccountInfo(t.account,a);return{authority:t.token.authority||i.environment,uniqueId:i.localAccountId,tenantId:i.tenantId,scopes:(t.token.scope||e.scope).split(" "),account:i,idToken:t.token.id_token,idTokenClaims:a,accessToken:t.token.access_token,fromCache:!0,expiresOn:o,tokenType:e.authenticationScheme||f.me.BEARER,correlationId:e.correlationId,extExpiresOn:o,state:e.state}}fromNaaAccountInfo(e,t){const n=t||e.idTokenClaims,o=e.localAccountId||n?.oid||n?.sub||"",a=e.tenantId||n?.tid||"";return{homeAccountId:e.homeAccountId||`${o}.${a}`,environment:e.environment,tenantId:a,username:e.username||n?.preferred_username||"",localAccountId:o,name:e.name||n?.name,idToken:e.idToken,idTokenClaims:n}}fromBridgeError(e){if(!function B(T){return void 0!==T.status}(e))return new g.WM("unknown_error","An unknown error occurred");switch(e.status){case"USER_CANCEL":return new p.oJ(h.K8);case"NO_NETWORK":return new p.oJ(h.C);case"ACCOUNT_UNAVAILABLE":return new p.oJ(h.AL);case"DISABLED":return new p.oJ(h.QL);case"NESTED_APP_AUTH_UNAVAILABLE":return new p.oJ(e.code||h.QL,e.description);case"TRANSIENT_ERROR":case"PERSISTENT_ERROR":return new S.s(e.code,e.description);case"USER_INTERACTION_REQUIRED":return new P.uw(e.code,e.description);default:return new g.WM(e.code,e.description)}}}const I_unsupportedMethod_code="unsupported_method",I_unsupportedMethod_desc="The PKCE code challenge and verifier could not be generated.";class r extends g.WM{constructor(e,t){super(e,t),Object.setPrototypeOf(this,r.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new r(I_unsupportedMethod_code,I_unsupportedMethod_desc)}}var x=s(70620),A=s(30536);class E{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(void 0===t)throw new Error("unexpected: bridgeProxy is undefined");this.bridgeProxy=t,this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new w.A(this.logger,this.performanceClient):k.K,this.eventHandler=new x.c(this.logger,this.browserCrypto),this.nestedAppAuthAdapter=new b(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger)}getBrowserStorage(){throw r.createUnsupportedError()}getEventHandler(){return this.eventHandler}static createController(e){return(0,d.c)(function*(){const t=new E(e);return Promise.resolve(t)})()}initialize(){return Promise.resolve()}acquireTokenInteractive(e){var t=this;return(0,d.c)(function*(){t.eventHandler.emitEvent(A.W.ACQUIRE_TOKEN_START,l.wV.Popup,e);const n=t.performanceClient.startMeasurement(m.Xv.AcquireTokenPopup,e.correlationId);n?.add({nestedAppAuthRequest:!0});try{const o=t.nestedAppAuthAdapter.toNaaTokenRequest(e),a=C.GO(),i=yield t.bridgeProxy.getTokenInteractive(o),c=t.nestedAppAuthAdapter.fromNaaTokenResponse(o,i,a);return t.operatingContext.setActiveAccount(c.account),t.eventHandler.emitEvent(A.W.ACQUIRE_TOKEN_SUCCESS,l.wV.Popup,c),n.add({accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),n.end({success:!0,requestId:c.requestId}),c}catch(o){const a=t.nestedAppAuthAdapter.fromBridgeError(o);throw t.eventHandler.emitEvent(A.W.ACQUIRE_TOKEN_FAILURE,l.wV.Popup,null,o),n.end({errorCode:a.errorCode,subErrorCode:a.subError,success:!1}),a}})()}acquireTokenSilentInternal(e){var t=this;return(0,d.c)(function*(){t.eventHandler.emitEvent(A.W.ACQUIRE_TOKEN_START,l.wV.Silent,e);const n=t.performanceClient.startMeasurement(m.Xv.SsoSilent,e.correlationId);n?.increment({visibilityChangeCount:0}),n?.add({nestedAppAuthRequest:!0});try{const o=t.nestedAppAuthAdapter.toNaaTokenRequest(e),a=C.GO(),i=yield t.bridgeProxy.getTokenSilent(o),c=t.nestedAppAuthAdapter.fromNaaTokenResponse(o,i,a);return t.operatingContext.setActiveAccount(c.account),t.eventHandler.emitEvent(A.W.ACQUIRE_TOKEN_SUCCESS,l.wV.Silent,c),n?.add({accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),n?.end({success:!0,requestId:c.requestId}),c}catch(o){const a=t.nestedAppAuthAdapter.fromBridgeError(o);throw t.eventHandler.emitEvent(A.W.ACQUIRE_TOKEN_FAILURE,l.wV.Silent,null,o),n?.end({errorCode:a.errorCode,subErrorCode:a.subError,success:!1}),a}})()}acquireTokenPopup(e){var t=this;return(0,d.c)(function*(){return t.acquireTokenInteractive(e)})()}acquireTokenRedirect(e){throw r.createUnsupportedError()}acquireTokenSilent(e){var t=this;return(0,d.c)(function*(){return t.acquireTokenSilentInternal(e)})()}acquireTokenByCode(e){throw r.createUnsupportedError()}acquireTokenNative(e,t,n){throw r.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw r.createUnsupportedError()}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw r.createUnsupportedError()}removePerformanceCallback(e){throw r.createUnsupportedError()}enableAccountStorageEvents(){throw r.createUnsupportedError()}disableAccountStorageEvents(){throw r.createUnsupportedError()}getAccount(e){throw r.createUnsupportedError()}getAccountByHomeId(e){const t=this.operatingContext.getActiveAccount();return void 0!==t&&t.homeAccountId===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAccountByLocalId(e){const t=this.operatingContext.getActiveAccount();return void 0!==t&&t.localAccountId===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAccountByUsername(e){const t=this.operatingContext.getActiveAccount();return void 0!==t&&t.username===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAllAccounts(){const e=this.operatingContext.getActiveAccount();return void 0!==e?[this.nestedAppAuthAdapter.fromNaaAccountInfo(e)]:[]}handleRedirectPromise(e){throw r.createUnsupportedError()}loginPopup(e){if(void 0!==e)return this.acquireTokenInteractive(e);throw r.createUnsupportedError()}loginRedirect(e){throw r.createUnsupportedError()}logout(e){throw r.createUnsupportedError()}logoutRedirect(e){throw r.createUnsupportedError()}logoutPopup(e){throw r.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw r.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}setActiveAccount(e){this.logger.warning("nestedAppAuth does not support setActiveAccount")}getActiveAccount(){const e=this.operatingContext.getActiveAccount();return void 0!==e?this.nestedAppAuthAdapter.fromNaaAccountInfo(e):null}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw r.createUnsupportedError()}getRedirectResponse(){throw r.createUnsupportedError()}preflightBrowserEnvironmentCheck(e,t){throw r.createUnsupportedError()}clearCache(e){return(0,d.c)(function*(){throw r.createUnsupportedError()})()}hydrateCache(e,t){return(0,d.c)(function*(){throw r.createUnsupportedError()})()}}}}]);
//# sourceMappingURL=732.28faa06488c9be9d.js.map