{"version":3,"file":"main.d2c1cc71cd95fb40.js","mappings":"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EA8hB,GACAK,GACAmC,GACAI,GACAK,GACAG,GACAM,GAEAI,GACAM,GACAK,GACAI,GACAY,GACAM,GACAU,GACAK,GAEA4O,GAEA2hJ,GACAG,GACAG,GACAG,GACAI,GACAG,GACAG,GACAG,GACAG,GACAQ,GACAM,GACAwR,GACAI,GACAG,GACAG,GACAI,GACAG,GACA2B,GACAK,GAEAG,GAEAI,GAEAsB,SAQSP,CAAS,KAUhB,SAAUE,GAAsBjiN,EACpCuiN,GACA,MAAO,IAAM,IAAI7hN,QAAcC,IAC7B4hN,EAAeC,SAAS9kN,QACtB6I,MAAMi8M,IAAyB,IAAbA,IAAiB,EACnCx4I,MAAU,KACR,MAAM5kE,EAAkBpF,EAASjB,IAAIyF,GAC/BtC,EAAOkD,EAAgBT,cAC7B,OAAOS,EAAgBX,UAAUxC,eAAeC,EAAI,IAErD7E,UAAWiF,IACV,MAAM8C,EAAkBpF,EAASjB,IAAIyF,GAC/BtC,EAAOkD,EAAgBT,cAC7BS,EAAgBX,UAAUg+M,eAAevgN,EAAMI,GAC/C3B,GAAO,EACR,EAEP,UCjJI+xC,kBACFgwK,SAGFC,QACGC,gBAAgBb,IAChBnhK,MAAMj9B,GAAO5iB,QAAQC,IAAI2iB,GAAI,oBCdhC,QACA,aACA,gBACA,WACA,eACA,kBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,eACA,kBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,YACA,eACA,mBACA,sBACA,kBACA,qBACA,aACA,gBACA,aACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,kBACA,qBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,oBAIA,cACA,YACA,WACA,CACA,eACA,eACA,8CACA,gCACAhR,CACA,CACA,YACA,CACAkwM,kBACA,sBACA,EACAA,aACAC,aACAD","names":["Base64","static","s","i","charCodeAt","this","ALPHA","indexOf","charAt","b10","pads","imax","length","x","String","PADCHAR","getByte64","push","fromCharCode","join","getByte","userAgent","Bowser","window","navigator","Clipboard","element","successful","textArea","createTextArea","selectText","copyTextToClipboard","destroyTextArea","text","document","createElement","value","body","appendChild","removeChild","getOSName","oldContentEditable","contentEditable","oldReadOnly","readOnly","range","createRange","selection","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","StringUtils","s1","s2","p","toString","changeData","getChanges","nextS","slice","mtc","ins","sbs","nextThis","del","result","diff","l","m","match","slen","o","fis","isThisLonger","longer","shorter","bi","split","len","cd","fil","sub","rc","getMatchingSubstring","rotateArray","array","n","res","Array","ADDED","ChangeType","ChangeUtils","obj1","obj2","ignoreKeys","items","added","deleted","modified","obj1Clone","obj2Clone","fromItem","index","findIndex","id","change","type","DELETED","toItem","splice","fromItemClone","JSON","parse","stringify","toItemClone","keysChanged","compareObject","undefined","MODIFIED","oldValue","newValue","map","itemAdded","baseKey","keys","Set","Object","forEach","key","keyString","isArray","concat","ObjectUtils","obj","keysArray","replace","current","shift","item","Date","target","source","ignoreUndefined","output","assign","isObject","filter","mergeDeep","src","prop","hasOwnProperty","copyDeep","summaryCapitalizeObject","capitalizeObject","upperCaseCount","property","upperCaseProperty","toUpperCase","count","capitalizedProperty","capitalizedPropertyObject","singlePossibility","paramClosestToLowercase","f","toLowerCase","reduce","prev","y","removeUndefined","removeNull","a","b","direction","nullsFirst","nullScore","ax","bx","_","$1","$2","Infinity","an","bn","nn","localeCompare","obj1Props","getOwnPropertyNames","obj2Props","_obj","NumberUtils","num","decimal","roundFactor","Math","pow","round","strEnum","create","S4","random","substring","uuid","SubjectStatus","Watcher","constructor","Subject","status","_status","status$","next","subscribe","callback","scope","watch","status$$","pipe","distinctUntilChanged","handleStatusChange","call","unsubscribe","unwatch","Waiting","ActivityService","BehaviorSubject","ids","register","counter$","unregister","factory","ɵfac","ActivityInterceptor","activityService","intercept","req","activity","headers","get","actReq","clone","delete","handle","finalize","i0","IgoActivityModule","ngModule","providers","provide","HTTP_INTERCEPTORS","useClass","multi","lib","releaseDate","ConfigService","injector","config","getConfig","load","options","baseConfig","default","path","http","HttpClient","Promise","resolve","_reject","catchError","error","console","log","throwError","configResponse","version","CONFIG_OPTIONS","InjectionToken","provideConfigOptions","useValue","configService","IgoConfigModule","APP_INITIALIZER","useFactory","configFactory","deps","LanguageLoader","prefix","suffix","getTranslation","lang","igoLocale$","appLocale$","forkJoin","translations","acc","provideDefaultLanguageLoader","loader","TranslateLoader","defaultLanguageLoader","IgoMissingTranslationHandler","params","translateService","langs","Error","substr","IgoLanguageModule","TranslateModule","missingTranslationHandler","MissingTranslationHandler","IgoMessageModule","CommonModule","ToastrModule","positionClass","timeOut","extendedTimeOut","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","ERROR","MessageType","LanguageService","translate","getBrowserLang","getLanguage","setDefaultLang","language$","language","setLanguage","combineLatest","use","reloadLang","MessageService","languageService","activeMessageTranslations","debounceTime","r","toastr","toasts","toast","activeMessageTranslation","find","amt","toastId","translatedTextInterpolateParams","textInterpolateParams","translatedTitleInterpolateParams","titleInterpolateParams","k","instant","textKey","titleKey","first","toastRef","componentInstance","message","title","ToastrService","showError","httpError","caught","messageType","toastrConfig","iconClasses","messages$","currentDate","from","to","showIcon","handleTemplate","messageShown","SUCCESS","success","INFO","info","SHOW","show","ALERT","WARNING","alert","handleNgxToastr","translatedTitlenterpolateParams","translatedTitle","activeToast","warning","remove","removeAllAreNotError","mess","template","html","Injector","ErrorInterceptor","originalReq","interceptError","errorContainer","handleError","handleCaughtError","handleUncaughtError","HttpErrorResponse","errorObj","_a","statusText","url","toDisplay","messageService","IgoErrorModule","parentModule","dbConfig","name","objectStoresMeta","store","storeConfig","keyPath","autoIncrement","storeSchema","keypath","unique","IgoCoreModule","matIconRegistry","domSanitizer","addSvgIconSet","bypassSecurityTrustResourceUrl","HttpClientModule","forRoot","NgxIndexedDBModule","ROUTE_SERVICE_OPTIONS","RouteService","router","route","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","directionsOptionsKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","queryParams","decodeURIComponent","location","search","includes","pair","navigate","Mobile","Media","MediaOrientation","Portrait","MediaService","breakpointObserver","observe","Breakpoints","matches","media$","orientation$","Landscape","Tablet","Desktop","getMedia","getOrientation","isTouchScreen","documentElement","isMobile","isDesktop","SESSION","StorageScope","StorageServiceEventEnum","StorageService","sessionStorage","getItem","LOCAL","localStorage","set","previousValue","setItem","currentValue","storageChange$","event","removeItem","REMOVED","clear","CLEARED","getNumber","v","endposition","CompressionService","Map","generateBase64Index","base64Index","indexBase64","compressBlob","blob","Observable","observer","reader","FileReader","readAsDataURL","onload","base64","valueOf","text64","compressed","compressStringBase64","object","decompressBlob","compressedData","decompressed","decompressStringBase64","byteCharacters","atob","byteNumbers","byteArray","Uint8Array","Blob","out","bits","chr","rem","c","j","NetworkService","EventEmitter","connection","onLine","checkNetworkState","onlineSubscription","fromEvent","previousMessageId","messageObj","state","emitEvent","offlineSubscription","stateChangeEventEmitter","emit","ngOnDestroy","e","currentState","reportState","startWith","RegexService","getAll","EntityTableColumnRenderer","Default","EntityTableScrollBehavior","Auto","EntityTableSelectionState","None","entity","t","safeObject","getEntityId","meta","getEntityProperty","idProperty","getEntityTitle","titleProperty","getEntityIcon","icon","iconProperty","EntityStateManager","ReplaySubject","getKey","size","setMany","entities","setAll","update","changes","exclusive","updateMany","updateManyExclusive","reverse","reverseMany","reversedChanges","reverseChanges","updateAll","allKeys","getAllKeys","some","changeKey","entries","bunch","storeKeys","change$","EntityView","source$","lifted","joins","getKey$","count$","empty","empty$","_index","all","values$","all$","firstBy","clause","firstBy$","values","manyBy","manyBy$","sort","destroy","values$$","createIndex","filter$","addFilter","filterIndex","filters$","removeFilter","sort$","lift","observables$","liftJoinedSource","liftSource","skip","_values","filters","processValues","setValues","sources$","joinData","computeJoinedValue","joinIndex","filterValues","sortValues","clauses","every","v1","v2","valueAccessor","generateIndex","EntityStore","_pristine","strategies","getProperty","createStateManager","view","createDataView","stateView","createStateView","pristine","entities$","softClear","updateCount","insert","insertMany","deleteMany","addStrategy","strategy","activate","_strategy","bindStore","removeStrategy","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","currentRecord","statesAreTheSame","revision","ref","record","newState","currentStateIsEmpty","newStateIsEmpty","EntityStoreWatcher","cdRef","setChangeDetector","setStore","teardownObservers","innerStateIndex","setupObservers","detectChanges","entities$$","onEntitiesChange","state$$","onStateChange","changesDetected","storeIndex","innerIndex","storeValue","innerValue","EntityStoreStrategy","stores","active","active$","doDeactivate","doActivate","EntityStoreFilterCustomFuncStrategy","super","filterStore","unfilterStore","filterAll","unfilterAll","filterClauseFunc","filterId","EntityStoreFilterSelectionStrategy","has","selected","ctx_r0","EntitySelectorComponent","titleAccessor","emptyText","multiAllText","multiNoneText","disabled","ngOnInit","watcher","selected$$","records","onSelectFromStore","onSelectionChange","multiSelect","_value","multiSelectValue","emptyValue","selectedChange","selected$","updateMultiToggleWithEntities","multiText$","selectors","ctx","StopPropagationDirective","onClick","stopPropagation","EntityTablePaginatorComponent","mediaService","hidePageSize","pageIndex","pageSize","showFirstLastButtons","paginationLabelTranslation$$","rangeLabel","page","of","label","startIndex","max","min","ngOnChanges","unsubscribeAll","count$$","emitPaginator","entitySortChange$$","entitySortChange$","paginator","firstPage","initPaginatorOptions","translateLabels","paginatorOptions","_b","_c","pageSizeOptions","_d","_e","_f","_intl","firstPageLabel","getRangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","paginatorChange","MatPaginator","ImageErrorDirective","el","errorImageUrl","hideError","onError","nativeElement","style","display","EntityTableRowDirective","renderer","selectOnClick","highlightSelection","_selected","toggleSelected","scroll","addCls","selectedCls","highlightedCls","removeCls","scrollIntoView","scrollMode","behavior","block","inline","cls","addClass","removeClass","SanitizeHtmlPipe","_sanitizer","transform","bypassSecurityTrustHtml","pure","SecureImagePipe","HttpHeaders","activityInterceptor","regexDepot","RegExp","test","responseType","err","switchMap","onloadend","complete","Cacheable","maxCacheCount","onToggleRows","$event","ctx_r13","onShiftToggleRow","record_r11","onDateChange","onChange","onValueChange","onBooleanValueChange","onSelectValueChange","onAutocompleteValueChange","onButtonClick","EntityTableComponent","formBuilder","_focusMonitor","_elementRef","ngControl","_parentForm","_controlName","_defaultErrorStateMatcher","dateAdapter","UntypedFormGroup","filteredOptions","entityTableColumnRenderer","entityTableSelectionState","sortNullsFirst","withPaginator","MatTableDataSource","setLocale","_paginator","dataSource","columns","column","visible","selectionCheckbox","selectMany","fixedHeader","tableHeight","handleDatasource","getColumnKeyWithoutPropertiesTag","properties","checked","formGroup","controls","setValue","option","viewValue","moment","format","enableEdit","validation","mandatory","setControl","control","multiple","parseInt","valueChanges","domainValues","filterNormalized","normalize","formControlValue","isStringValidNumber","isEdition","linkColumnForce","date","utc","newKey","getValidationAttributeValue","disable","unsubscribeStore","selection$$","firstSelected","firstSelectedStateviewPosition","pageMax","pageToReach","floor","selectionState$","computeSelectionState","dataSource$$","data","getTrackByFunction","refresh","onSort","getValue","entitySortChange","onRowClick","lastRecordCheckedKey","entityClick","onRowSelect","entitySelectChange","toggle","onToggleRow","selectNode","stopImmediatePropagation","recordIndex","lastRecordChecked","indexes","_record","selectedRecords","selectionCount","All","Some","columnIsSortable","sortable","rowIsSelected","isImg","isUrl","pop","Boolean","list_id","Number","list_option","edition","validationType","getColumnRenderer","getTableClass","getHeaderClass","func","headerClassFunc","Function","getRowClass","rowClassFunc","getCellClass","tableFunc","cellClassFunc","columnFunc","clickFunc","MatFormFieldControl","useExisting","Dock","ActionbarMode","action","ActionbarItemComponent","color","withTitle","withIcon","withTooltip","disabled$","noDisplay","noDisplay$","args","ngClass","ngClass$$","updateNgClass","isObservable","icon$$","updateIcon","checkCondition","checkCondition$$","updateCheckCondition","tooltip","tooltip$$","updateTooltip","availability","availability$$","available","disabled$$","display$$","noDisplay$$","trigger","ngClass$","tooltip$","checkCondition$","icon$","scrollUp","onTriggerAction","scrollDown","ctx_r1","ActionbarComponent","overlay","elRef","actionbarMode","collapsed","handler","withToggleButton","horizontal","iconColor","scrollActive","xPosition","yPosition","_overlayClass","overlayClass","withTitleClass","withIconClass","horizontalClass","heightCondition","clientHeight","scrollHeight","positionConditionTop","scrollTop","positionConditionLow","scrollBy","IgoActionbarModule","MatButtonModule","MatIconModule","MatTooltipModule","MatMenuModule","MatListModule","MatCardModule","MatCheckboxModule","IgoActionModule","IgoBadgeIconDirective","hidden","inverseColor","inheritColor","igoMatBadgeIcon","getNamedSvgIcon","svgObj","svg","updateSvg","matBadgeHidden","updateHidden","matBadgeDisabled","updateDisabled","igoMatBadgeInverseColor","updateColor","igoMatBadgeInheritColor","igoMatBadgeColor","igoMatBadgeBackgroundColor","backgroundColor","badge","querySelector","alignItems","justifyContent","innerHTML","background","getComputedStyle","getPropertyValue","originalColor","IgoMatBadgeIconModule","MatBadgeModule","ClickoutDirective","handleMouseClick","contains","clickout","IgoClickoutModule","CollapseDirective","_collapsed","_target","collapseTarget","expandTarget","click","CollapsibleComponent","_title","IgoCollapsibleModule","ConfirmDialogComponent","dialogRef","ConfirmDialogService","dialog","open","disableClose","confirmMessage","afterClosed","IgoConfirmDialogModule","imports","MatDialogModule","ContextMenuDirective","viewContainerRef","elementRef","onContextMenu","TouchEvent","touches","pageX","pageY","MouseEvent","close","preventDefault","menuPosition","overlayRef","positionStrategy","position","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","scrollStrategy","scrollStrategies","attach","TemplatePortal","menuContext","$implicit","clickTarget","overlayElement","take","dispose","LongPressDirective","touchDuration","onlyIOS","touchstart","touchEnd","touchTimeout","setTimeout","longpress","touchend","clearTimeout","IgoContextMenuModule","CustomHtmlComponent","_html","IgoCustomHtmlModule","MatInputModule","DOMService","getDom","dom","response","toPromise","IgoDOMModule","IgoDrapDropModule","DynamicComponent","componentFactory","subscriptions","inputs","inputs$$","subscribers","setTarget","componentRef","createComponent","updateInputs","updateSubscribers","unobserveAllInputs","instance","propName","unobserveInput","inputValue","observeInput","setInputValue","onUpdateInputs","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","outputs","emitter","subscriber","_subscriber","observable","DynamicComponentService","resolver","componentCls","resolveComponentFactory","DynamicOutletComponent","dynamicComponentService","component","eq","inputsAreEquivalents","subscribersAreEquivalents","dynamicComponent","renderComponent","ViewContainerRef","IgoDynamicOutletModule","IgoDynamicComponentModule","IgoFlexibleModule","FormComponent","autocomplete","hasButtons","buttons","children","formData","setData","onSubmit","submitForm","getData","getAllFormFields","form","groups","group","fields","field","updateDataWithFormField","reset","IgoFormFormModule","FormsModule","ReactiveFormsModule","FormService","addControl","validator","validators","getValidators","setValidators","extendFieldConfig","partial","validatorOption","validatorStr","getValidator","Validators","FormFieldService","getFieldByType","FormFieldComponent","formFieldService","fieldInputs","fieldSubscribers","fieldOptions","getFieldComponent","getFieldInputs","errors","placeholder","disableSwitch","formControl","required","getFieldSubscribers","IgoFormFieldModule","MatFormFieldModule","MatSelectModule","FormGroupComponent","getFieldColSpan","colSpan","cols","getFieldNgClass","getErrorMessage","messages","errorMessages","getControlErrorMessage","IgoFormGroupModule","IgoFormModule","IgoEntitySelectorModule","IgoStopPropagationModule","IgoEntityTablePaginatorModule","MatPaginatorModule","IgoImageModule","IgoEntityTableModule","MatTableModule","MatAutocompleteModule","MatSortModule","MatDatepickerModule","IgoEntityModule","InteractiveTourLoader","jsonURL","getPathToConfigFile","loadConfigTour","getJSON","allToursOptions","getTourOptionData","toolName","nameInConfigFile","InteractiveTourService","interactiveTourLoader","shepherdService","nextIndex","isAppHaveTour","haveTour","isToolHaveTourConfig","disabledTourButton","stepConfig","conditions","condition","isTourDisplayInMobile","getButtons","buttonKind","classes","getAction","actionName","addProgress","self","nbTry","checkExist","setInterval","getCurrentStep","attachTo","cancel","clearInterval","currentStepElement","getElement","querySelectorAll","classList","add","header","stepsArray","steps","progress","className","innerText","insertBefore","checkNext","tour","service","nextStep","_setupModal","executeAction","step","actionConfig","executeActionPromise","waitFor","maxTry","maxWait","getShepherdSteps","shepherdSteps","on","popperOptions","modifiers","offset","beforeShowPromise","previousStep","beforeChange","beforeShow","noBackButton","class","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","startTour","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","Toolbox","activeToolHistory","tool","setToolbar","toolbar","initStore","tools$","activeTool$$","getTool","getTools","setTools","tools","getToolbar","toolbar$","activateTool","activatePreviousTool","deactivateTool","previous","clearActiveToolHistory","setActiveTool","activeTool$","ToolService","toolbox","startInteractiveTour","InteractiveTourComponent","interactiveTourService","toolService","tourToStart","getClass","styleButton","getTourToStart","activeToolName","isActiveTool","isToolHaveTour","showTourButton","inMobileAndShow","IgoInteractiveTourModule","KeyValuePipe","keyValues","IgoKeyValueModule","ListItemDirective","_color","_focused","_disabled","focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","beforeDisable","beforeEnable","toggleDisabledClass","enable","getOffsetTop","offsetTop","padding","focusedCls","disabledCls","ListComponent","_navigation","_selection","navigation","selectedItem","_selectedItem","focusedItem","_focusedItem","handleKeyboardEvent","navigationEnabled","enableNavigation","ngAfterViewInit","listItems","init","listItems$$","focusNext","toArray","igoList","getFocusedIndex","isScrolledIntoView","offsetHeight","focusPrevious","disableNavigation","scrollToItem","elem","docViewTop","elemTop","findSelectedItem","findFocusedItem","item2","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","IgoListModule","PanelComponent","_withHeader","cursorPointer","withHeader","IgoPanelModule","SpinnerComponent","shown","shown$","SpinnerActivityDirective","spinner","counter$$","IgoSpinnerModule","MatProgressSpinnerModule","TableDataSource","DataSource","_database","_model","_sort","_filterChange","connect","merge","dataChange","sortChange","getFilteredData","getSortedData","disconnect","filterable","propertyA","propertyB","TableActionColor","ctx_r14","handleClickAction","TableComponent","_hasFIlterInput","SelectionModel","database","model","hasFilterInput","displayedColumns","displayed","unshift","actions","changed","getActionColor","colorId","row","isAllSelected","masterToggle","MatSort","IgoTableModule","CdkTableModule","ActionStore","White","ToolboxColor","toolSlideInOut","speed","transition","animate","ToolboxComponent","classColorGrey","Grey","classColorPrimary","Primary","toolbar$$","onToolbarChange","onActiveToolChange","actionStore","onAnimationStart","animating$","onAnimationComplete","getToolInputs","onAnimate","animation$","_tool","_toolbox","activeTool","toolActivated","childrenToolActivated","parent","unAnimate","animating$$","animation","changeDetection","IgoToolboxModule","IgoToolModule","WidgetOutletComponent","onCancel","onComplete","destroyWidget","getEffectiveSubscribers","baseSubscribers","baseSubscriber","widget","IgoWidgetOutletModule","WidgetService","widgetCls","IgoWidgetModule","WorkspaceSelectorComponent","getWorkspaceTitle","workspace","onSelectedChange","activateWorkspace","IgoWorkspaceSelectorModule","WorkspaceWidgetOutletComponent","widget$","widgetInputs$","widgetSubscribers$","onWidgetCancel","deactivateWidget","onWidgetComplete","IgoWorkspaceWidgetOutletModule","IgoWorkspaceModule","TableDatabase","copiedData","ToolComponent","compType","WorkspaceStore","activeWorkspace$","deactivateWorkspace","Workspace","entityStore","hasWidget","activateWidget","AppHomeRoutingModule","RouterModule","AppHomeComponent","AppHomeModule","AppActivityRoutingModule","AppActivityComponent","idsActivity","counter","AppActivityModule","environment","production","igo","projections","code","alias","def","extent","auth","intern","allowAnonymous","interactiveTour","tourInMobile","importExport","catalog","sources","queryFormat","queryHtmlTarget","regFilters","tooltipType","searchSources","storedqueriesreverse","nominatim","icherche","searchUrl","order","limit","coordinatesreverse","showInPointerSummary","icherchereverse","ilayer","AppConfigRoutingModule","AppConfigComponent","configLanguage","AppConfigModule","AppLanguageRoutingModule","AppLanguageComponent","changeLanguage","AppLanguageModule","AppMediaRoutingModule","AppMediaComponent","media","orientation","AppMediaModule","AppMessageRoutingModule","AppMessageComponent","AppMessageModule","AppRequestRoutingModule","AppRequestComponent","callHttp","rep","callHttpError","AppRequestModule","AppActionRoutingModule","AppActionComponent","added$","AppActionModule","AppSalutationComponent","AppExplanationComponent","AppDynamicComponentRoutingModule","AppDynamicComponentComponent","toggleComponent","AppDynamicComponentModule","AppEntityTableRoutingModule","AppEntityTableComponent","description","image","AppEntityTableModule","AppEntitySelectorRoutingModule","AppEntitySelectorComponent","getTitle","AppEntitySelectorModule","AppFormRoutingModule","AppFormComponent","formService","choices","valueChanges$$","submitDisabled","valid","form$","fillForm","data$","clearForm","AppFormModule","AppTableRoutingModule","AppTableComponent","showName","handleSelect","rows","AppTableModule","AppSalutationToolComponent","__decorate","tslib_es6","ChangeDetectorRef","AppAboutToolComponent","AppToolRoutingModule","AppToolComponent","panelTitle","activateSalutationTool","AppToolModule","AppSalutationWidgetComponent","AppWidgetRoutingModule","AppWidgetComponent","widgetService","AppWidgetModule","TokenService","token","tokenKey","decode","jwtDecode","isExpired","jwt","currentTime","getTime","exp","AuthService","tokenService","languageForce","anonymous","authenticate$","authenticated","logged$","globalCacheBusterNotifier","hasAuthService","login","username","password","myHeader","encodePassword","loginCall","loginWithToken","infosUser","typeConnection","loginAnonymous","post","tap","logout","isAuthenticated","getToken","decodeToken","goToRedirectUrl","redirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","user","patch","logged","isAnonymous","isAdmin","tokenDecoded","locale","AuthGoogleComponent","authService","appRef","apiKey","clientId","loadSDKGoogle","loadPlatform","warn","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","discoveryDocs","then","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","btn","tick","fjs","getElementsByTagName","js","parentNode","AuthInternComponent","fb","_allowAnonymous","loading","loginUser","errorMsg","AuthFacebookComponent","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","accessToken","getElementById","AuthMicrosoftComponent","msalService","msalGuardConfig","PublicClientApplication","cache","cacheLocation","broadcastService","MsalBroadcastService","inProgress$","InteractionStatus","takeUntil","_destroying$","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","account","acquireTokenSilent","tokenId","idToken","catch","__awaiter","InteractionRequiredAuthError","acquireTokenPopup","conf","MSAL_GUARD_CONFIG","MsalServiceb2c","hash","redirectHash","initializeWrapperLibrary","WrapperSKU","initialize","request","acquireTokenRedirect","silentRequest","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRequest","logoutRedirect","logoutPopup","ssoSilent","getLogger","logger","setLogger","MSAL_INSTANCE","MsalBroadcastServiceb2c","msalInstance","_msalSubject","msalSubject$","asObservable","_inProgress","addEventCallback","EventMessageUtils","verbose","eventType","AuthMicrosoftb2cComponent","browserAuthOptions","loginMicrosoftb2c","onLogin","home","AuthFormComponent","_backgroundDisable","_hasAlreadyConnectedDiv","_hasLogoutDiv","_showAlreadyConnectedDiv","_showLogoutDiv","backgroundDisable","isLogoutRoute","hasAlreadyConnectedDiv","hasLogoutDiv","showAlreadyConnectedDiv","showLogoutDiv","showLoginDiv","analyzeRoute","getName","logoutRoute","firstName","sourceId","events","NavigationStart","changeEvent","currentRoute","isLoginRoute","AuthInterceptor","refreshInProgress","trustHosts","hostname","hostsWithCredentials","hostsWithAuthByKey","withCredentials","handleHostsWithCredentials","hostWithKey","handleHostsAuthByKey","refreshToken","href","host","authReq","hashUser","Md5","interceptXhr","xhr","setRequestHeader","alterUrlWithKeyAuth","urlDecomposed","urlWithKeyAdded","paramsToKeep","reqUrl","hostWithCredentials","domainRegFilters","hostWithAuthByKey","keyProperty","keyValue","MSALConfigFactory","msConf","redirectUri","authority","MSALConfigFactoryb2c","MSALAngularConfigFactory","interactionType","InteractionType","scopes","loginHint","MSALAngularConfigFactoryb2c","provideAuthMicrosoft","MsalService","AuthStorageService","userIgo","preference","mergePreference","IgoAuthModule","MsalModule","AppAuthFormRoutingModule","AppAuthFormComponent","AppAuthFormModule","MetadataService","metadata","extern","openMetadata","MetadataButtonComponent","metadataService","layer","_layer","abstract","MetadataAbstractComponent","layerTitle","MAT_DIALOG_DATA","IgoMetadataModule","stringToLonLat","str","mapProjection","opts","lonLat","coordStr","negativeLon","degreesLon","minutesLon","secondsLon","directionLon","decimalLon","negativeLat","degreesLat","minutesLat","secondsLat","directionLat","decimalLat","zone","radius","lon","lat","projectionStr","projectionRegex","lonlatCoord","lonLatPattern","lonLatRegex","dmsCoord","dmsCoordPattern","dmsRegex","patternUtm","utmRegex","patternMtm","mtmRegex","ddCoord","patternDd","ddRegex","dmdCoord","patternDmd","dmdRegex","patternBELL","bellRegex","mmCoord","mmPattern","mmRegex","isXYCoords","toLocaleUpperCase","trim","parseFloat","convertDMSToDD","epsgUtm","olproj","epsgMtm","forceNA","dest","abs","degrees","minutes","seconds","neg","dd","convertDDToDMS","lonLatDD","lonLatDMS","ceil","int","toFixed","formatScale","scale","getResolutionFromScale","dpi","inchesPerMeter","ctrlKeyDown","originalEvent","altKey","MAC","metaKey","ctrlKey","shiftKey","roundCoordTo","coord","roundCoordToString","Layer","authInterceptor","geoDBService","layerDBService","legendCollapsed","firstLoadComponent","olLoadingProblem","displayed$","isInResolutionsRange$","visible$","ol","createOlLayer","zIndex","baseLayer","maxResolution","maxScaleDenom","minResolution","minScaleDenom","opacity","legendOptions","legend","setLegend","isIgoInternalLayer","getZIndex","setZIndex","setOpacity","isInResolutionsRange","setMaxResolution","updateInResolutionsRange","getMaxResolution","setMinResolution","getMinResolution","setVisible","hasBeenVisible$","showMessage","showInLayerList","setMap","igoMap","unobserveResolution","observeResolution","hasBeenVisible$$","resolution$$","viewController","resolution$","resolution","getResolution","OPACITY","LinkedProperties","TooltipType","TITLE","ImageWatcher","loaded","handleLoadStart","handleLoadEnd","handleLoadError","un","__watchers__","watcherIndex","params_","LAYERS","computeMVTOptionsOnHover","layerOptions","sourceOptions","igoStyle","styleByAttribute","hoverStyle","featureClass","TileWatcher","tile","generateIdFromSourceOptions","wms","generateWMSIdFromSourceOptions","wmts","generateWMTSIdFromSourceOptions","xyz","generateXYZIdFromSourceOptions","feature","generateFeatureIdFromSourceOptions","wfs","generateWfsIdFromSourceOptions","arcgisrest","generateArcgisRestIdFromSourceOptions","imagearcgisrest","tilearcgisrest","osm","_options","tiledebug","generateId","layers","standardizeUrl","featureTypes","origin","urlStandardized","dataService","createOlSource","getLegend","FeatureDataSource","getSourceFormatFromOptions","OlVectorSource","olFormatCls","formatType","olformat","formatOptions","onUnwatch","queryTitle","ClusterDataSource","olSourceCluster","VectorWatcher","olSource","getUrl","ImageLayer","valStatus","olOptions","olLayerImage","getSource","setImageLoadFunction","customLoader","interceptor","XMLHttpRequest","alteredUrlWithKeyAuth","abort","getImage","arrayBufferView","TextDecoder","imageUrl","URL","createObjectURL","send","TileLayer","tileLayer","olLayerTile","tileSource","setTileLoadFunction","modifiedUrl","BasicNumericOperator","OgcFilterOperatorType","OgcFilterOperator","BBOX","OgcFilterWriter","filterSequence","PropertyIsEqualTo","spatial","fieldRestrict","PropertyIsNotEqualTo","PropertyIsLike","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsBetween","During","PropertyIsNull","Intersects","Within","Contains","defineOgcFiltersDefaultOptions","ogcFiltersOptions","fieldNameGeometry","srcType","ogcFiltersDefaultValue","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","buildFilter","proj","ourBboxFilter","enableBbox","filterAssembly","olfilter","getCode","checkIgoFiltersProperties","bundleFilter","wfsOptions","srsName","featureNS","featurePrefix","outputFormat","query","olFormatWFS","writeGetFeature","XMLSerializer","serializeToString","filterObject","logicalArray","createFilter","operator","logical","filterOptions","wfsPropertyName","propertyName","wfsPattern","pattern","wfsMatchCase","matchCase","wfsWildCard","wildCard","wfsSingleChar","singleChar","wfsEscapeChar","escapeChar","wfsLowerBoundary","lowerBoundary","wfsUpperBoundary","upperBoundary","wfsGeometryName","wfsExtent","wfsWktGeometry","wkt_geometry","wfsSrsName","wfsBegin","parseFilterOptionDate","begin","minDate","wfsEnd","end","maxDate","wfsExpression","expression","geometry","olWKT","readGeometry","dataProjection","featureProjection","And","Or","Not","defineInterfaceFilterSequence","level","addInterfaceFilter","computeAllowedOperators","defaultOperatorsType","allowedOperators","fieldsHasSpatialOperator","includeContains","effectiveOperators","srcField","allowedOperatorsType","Spatial","BasicAndSpatial","operators","Basic","Time","igoOgcFilterObject","parentLogical","filterid","sliderOptions","igoSpatialSelector","igoSNRC","filterArray","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","sequence","nextElement","lastProcessedFilter","lastParentLogical","uiFilter","computeIgoSelector","computedSelectors","selector","bundles","bundle","selectorType","selectorGroup","handleOgcFiltersAppliedValue","ogcFilters","filterQueryStringSelector","filterQueryStringAdvancedFilters","pushConditions","formatGroupAndFilter","checkboxConditions","selectorsCorr","verifyMultipleEnableds","radioConditions","selectConditions","filterQueryString","formatProcessedOgcFilter","enableds","list","selectorBundle","g","bundleCondition","selectorsType","ogcselector","enabledSelector","processedFilter","layersOrTypenames","appliedFilter","layerOrTypenames","defaultValue","isValid","defaultEpsg","defaultMaxFeatures","defaultFieldNameGeometry","gmlRegex","buildUrl","randomParam","paramsWFS","queryStringValues","formatWFSQueryString","igoFilters","ogcFilterWriter","filterOrBox","filterOrPush","xmlFilter","baseUrl","download","dynamicUrl","dataSourceOptions","epsg","forceDefaultOutputFormat","versionWfs200","urlWfs","effectiveCount","effectiveStartIndex","epsgCode","paramMaxFeatures","cnt","maxFeatures","srs","valueReference","sourceFields","fieldsNames","sourcefield","separator","getFeature","getpropertyvalue","wfsDataSourceOptions","getFormatFromOptions","gmlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","System","InsertSourceInsertDBEnum","VectorLayer","geoNetworkService","browsable","exportable","initialOpacityValue","initialVisibleValue","initialMinResValue","initialMaxResValue","so","preload","bypassVisible","bypassResolution","flash","bind","idbInfo","storeToIdb","firstLoad","maintainFeaturesInIdb","once","trackFeature","enableTrackFeature","vector","OlVectorLayer","vectorSource","failure","customWFSLoader","setLoader","idbLoader","customIDBLoader","_g","maintainOptionsInIdb","removeLayerFromIDB","zip","deleteByKey","igoStyleObject","olStyleToBasicIgoStyle","layerOlStyle","getStyle","fill","getFill","getColor","stroke","getStroke","width","circle","layerData","layerId","detailedContextUri","contextUri","queryable","insertEvent","dsFeatures","getFeatures","geojsonObject","writeFeatures","getProjection","User","listenerKey","vectorContext","getVectorContext","frameState","flashGeom","getGeometry","elapsed","time","elapsedRatio","duration","easeOut","newColor","asArray","getStyleFunction","style2","styleClone","getType","getRadius","setRadius","setColor","setWidth","getWidth","setText","setStyle","drawGeometry","unByKey","render","setExtent","stopAnimation","trackFeatureListenerId","centerMapOnFeature","feat","getFeatureById","getView","setCenter","getCoordinates","getId","disableTrackFeature","wfsProj","olProjection","currentExtent","alteredUrl","nbOfFeature","threshold","idAssociatedCall","mostRecentIdCallOGCFilter","removeLoadedExtent","onerror","responseText","features","getFormat","readFeatures","addFeatures","projection","delay","concatMap","content","DOMParser","parseFromString","readProjection","responseXML","layerID","VectorTileLayer","vectorTile","olLayerVectorTile","vectorTileSource","onLoad","FEATURE","FeatureMotion","OSMDataSource","olSourceOSM","XYZDataSource","olSourceXYZ","WFSDataSource","wfsService","checkWfsParams","sf","getSourceFieldsFromWFS","setOgcFilters","OlLoadingStrategy","triggerEvent","notify","WFSService","DataService","defineFieldAndValuefromWFS","getfeatureSourceField","wfsGetFeature","nb","d","fieldList","fieldListWoGeom","fieldListWoGeomStr","olFormats","effectiveOlFormats","gmlDataSourceOptions","sourceFieldsToRetrieveValues","allowGml","firstFeature","getKeys","getGeometryName","processingArray","chunkSize","results","mfeatures","loopFeatures","built_properties_value","kv","getProperties","boundedBy","fieldType","featureProperties","GML2","QueryFormat","QueryFormatMimeType","QueryHtmlTarget","IFRAME","WMSDataSource","sourceParams","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","wfsCheckup","buildDynamicDownloadUrlFromParamsWFS","sourceField","initOgcFilters","calendarModeYear","FILTER","updateParams","timeFilterable","timeFilter","setTimeFilter","mapLabel","BLANK","igoRefresh","asWFSDataSourceOptions","olSourceImageWMS","ratio","timeFilter$","projParam","contentDependent","contentDependentLegend","VERSION","currentStyle","createDefaultTileGrid","projectionExtent","getExtent","resolutions","matrixIds","z","olTileGridWMTS","getTopLeft","WMTSDataSource","tileGrid","olSourceWMTS","CartoDataSource","crossOrigin","olSourceCarto","htmlString","types","oneType","cartocss","colors","layer_name","ArcGISRestDataSource","esrijsonFormat","olFormatEsriJSON","attributions","overlaps","encodeURIComponent","customParams","legendInfo","legendElement","htmlImgSrc","contentType","imageData","uniqueValueInfos","symbol","createSVG","strokeWidth","outlineColor","outline","ImageArcGISRestDataSource","renderingRule","ImageArcGISRest","TileArcGISRestDataSource","olSourceTileArcGISRest","TileDebugDataSource","baseOptions","TileGrid","TileDebug","WebSocketDataSource","createWebSocket","ws","WebSocket","onmessage","onMessage","onclose","onClose","onopen","onOpen","featureAdded","readFeature","featureToRemove","removeFeature","addFeature","MVTDataSource","mvtFormat","olFormatMVT","OlFeature","olSourceVectorTile","EsriStyleGenerator","_converters","esriPMS","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","_renderers","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","point","units","mpu","rotation","_transformAngle","angle","olStyle","_transformColor","font","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","_convertPointToPixel","xoffset","offsetY","yoffset","_convertOutline","lineDash","ol3Rad","PI","points","radius2","_convertLabelingInfo","labelingInfo","mapUnits","styles","ii","labelExpression","maxScale","minScale","_getResolutionForScale","getText","defaultSymbol","defaultStyle","classBreakInfos","classBreakInfo","classMinValue","minValue","classMaxValue","field1","infos","me","generateStyle","layerInfo","drawingInfo","styleFunctions","drawingInfoStyle","labelingInfoStyleFunctions","DATE","TimeFilterType","TimeFilterStyle","CALENDAR","MapService","getMap","TypeCapabilities","CapabilitiesService","mapService","WMSCapabilities","WMTSCapabilities","esriJSON","EsriJSON","getWMSOptions","getCapabilities","capabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","mapId","cartoOptions","parseCartoOptions","getArcgisOptions","serviceCapabilities","arcgisOptions","parseArcgisOptions","getImageArcgisOptions","legendUrl","parseTileOrImageArcgisOptions","getTileArcgisOptions","HttpParams","fromObject","_i","parsers","read","findDataSourceInCapabilities","Capability","DataURL","Abstract","keywordList","KeywordList","getTimeFilter","Style","isExtentInGeographic","EX_GeographicBoundingBox","queryFormatMimeTypePriority","GEOJSON","GEOJSON2","GML3","HTML","mimeType","Request","GetFeatureInfo","Format","keyEnum","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","OnlineResource","stepDate","Contents","Identifier","optionsFromCapabilities","ouputOptions","layer_definition","olAttribution","copyrightText","timeExtent","timeInfo","setTime","toUTCString","DATETIME","serviceDescription","displayField","layerName","layerArray","Name","dimension","Dimension","minMaxDim","stylesAvailable","OptionsService","ProjectionService","registerProjection","utmZone","mtmZone","lon0","proj4","olproj4","DataSourceService","capabilitiesService","optionsService","wfsDataSourceService","projectionService","createAsyncDataSource","context","createOSMDataSource","createFeatureDataSource","createWFSDataSource","wmsContext","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","datasources$","observables","optionsFromApi","optionsMerged","getArcgisRestOptions","featureToOl","projectionOut","olFeature","OlGeoJSON","setId","mapTitle","getEntityRevision","featureFromOl","projectionIn","olLayer","exclude","excludeOffline","idColumn","olFormat","startsWith","writeGeometryObject","excludeAttribute","excludeAttributeOffline","getRevision","olFeatures","olextent","featureExtent","olExtent","olFeatureExtent","olFeatureProjection","olGeometry","computeOlFeatureExtent","height","featuresAreOutOfView","featuresExtent","edgeRatio","edgesRatio","viewExtent","scaleExtent","motion","areaRatio","computeOlFeaturesExtent","Zoom","zoomToExtent","Move","moveToExtent","featuresAreTooDeepInView","mapExtent","mapExtentArea","featuresExtentArea","getZoom","hideOlFeature","bindLayer","addLayer","FeatureStore","searchDocument","_searchDocument","setLayerFeatures","viewScale","checkLayer","setLayerOlFeatures","setStoreOlFeatures","clearLayer","olFeaturesMap","olFeaturesToRemove","newOlFeature","olFeaturesToAddIds","computeOlFeaturesDiff","removeOlFeaturesFromLayer","addOlFeaturesToLayer","moveToOlFeatures","setLayerExtent","FeatureStoreInMapExtentStrategy","states$$","watchStore","empty$$","skipWhile","updateEntitiesInExtent","unwatchStore","unwatchAll","stores$$","state$","inMapExtent","entitiesInMapExtent","entitiesWithNoGeom","FeatureStoreInMapResolutionStrategy","updateEntitiesInResolution","mapResolution","inMapResolution","GeoPropertiesStrategy","propertyTypeDetectorService","updateEntitiesPropertiesState","layers$","debounceTime$1","pairwise","prevLayers","currentLayers","prevLayersId","layersId","geoService","firstN","distinctValues","containGeoServices","entry","valuedAreGeoservices","isGeoService","geoServiceAssociations","getGeoService","propertiesForLayerName","propertyForLayerName","urlProperty","layerNameProperty","geoServiceStates","geoServiceAssociation","arcgisLayerName","appliedLayerName","potentialLayerId","LAYER","haveGeoServiceProperties","geoServiceState","urlValue","layerNameValue","entitiesToProcess","FeatureStoreLoadingStrategy","setMotion","subscription","onFeaturesChange","selectMotion","getFeatureId","FeatureStoreLoadingLayerStrategy","onSourceChanges","flatMap","cluster","OlDragSelectInteraction","OlDragBoxInteraction","FeatureStoreSelectionStrategy","_overlayStore","createOverlayStore","overlayStore","unselectAll","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","stores$","mapClickListener","onMapClick","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","olDragSelectInteraction","olInteractions","getInteractions","getArray","olInteraction","addInteraction","olDragSelectInteractionEndKey","onDragBoxEnd","removeInteraction","mapBrowserEvent","getFeaturesInExtent","overlayFeaturesKeys","featuresKeys","doMotion","groupedFeatures","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","overlayLayer","createOverlayLayer","removeLayer","FeatureStoreSearchIndexStrategy","initStoreSearchIndex","Document","tokenize","onEntitiesChanges","percentDistinctValueRatio","featuresProperties","fp","igoSearchID","toIndex","columnsToNotIndex","contentToIndex","searchIndex","sf2","columnsToIndex","propertiesToIndex","markerColor","markerOutlineColor","svgIconColor","svgOutlineColor","newOutlineColor","anchor","overflow","StyleService","createStyle","createOverlayMarkerStyle","parsedStyle","parseStyle","labelMinResolution","labelMaxResolution","labelMinResolutionFromScale","labelMaxResolutionFromScale","attribute","getLabel","styleOptions","olCls","getOlCls","_key","olKey","getOlKey","createStyleByAttribute","guessTypeFeature","labelStyle","baseStyle","val","createClusterStyle","clusterParam","layerStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","clusterRadius","radiusMin","image_","radiusCalc","labelMatch","labelToGet","matchAll","createOverlayLayerStyle","createOverlayDefaultStyle","markerStyle","createBufferStyle","strokeRGBA","fillRGBA","bufferRadius","customStyle","fillColor","strokeColor","fillWithOpacity","strokeWithOpacity","Overlay","overlayDataSource","setFeatures","removeOlFeature","addOlFeatures","addOlFeature","removeFeatures","LayerWatcher","unwatchLayer","setPropertyChange","TIMEFILTER","OGCFILTERS","VISIBLE","MINRESOLUTION","MAXRESOLUTION","propertyChange$","watchLayer","evt","layer$$","MapViewAction","MapController","observerKeys","getOlMap","olMap","setOlMap","MapViewController","maxZoomOnExtent","states","stateIndex","stateHistory","olView","setPadding","top","right","bottom","left","onMoveEnd","extent$$","extent$","monitorRotation","rotation$","getRotation","getOlProjection","getCenter","center","calculateExtent","getSize","getScale","getScaleFromResolution","unit","getUnits","zoomIn","zoomTo","zoomOut","zoom","cancelAnimations","easing","oleasing","resetRotation","hasPreviousState","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","fromCenter","toCenter","distCenter","sqrt","fromExtent","fromSize","xSize","maxZoom","fit","isFinished","setState","state1","state2","tolerance","trunc","viewStatesAreEqual","GeolocationOverlayType","Position","MapGeolocationController","storageService","subscriptions$$","_buffer","buffer","_accuracyThreshold","accuracyThreshold","_followPosition","followPosition","geolocationOverlay","bufferStyle","bufferStroke","bufferFill","showBufferRadius","arrowStyle","displacement","arrowRotation","rotateWithView","handleFeatureCreation","position$","olGeolocation","geolocation","tracking","getTracking","setTracking","tracking$","followPosition$","deleteGeolocationFeatures","deleteFeatureByType","PositionDirection","Accuracy","Buffer","onPositionChange","trackingOptions","enableHighAccuracy","maximumAge","timeout","emissionIntervalSeconds$","interval","updateArrowFeatureOrientation","position4326","lastPosition","coordinates","dateTime","arrowFeature","getFeatureByType","isMoving","distanceBetweenPoints","accuracy","theta","atan2","coord1","coord2","olSphere","addOnChangedListener","listener","deleteChangedListener","updateGeolocationOptions","geolocate","alwaysTracking","storedTracking","storedFollowPosition","geolocateProperties","altitude","altitudeAccuracy","heading","timestamp","handleViewFromFeatures","featureById","positionGeometry","Point","accuracyGeometry","fromCircle","OlCircle","positionFeature","positionFeatureArrow","accuracyFeature","positionFeatureExists","positionFeatureArrowExists","accuracyFeatureExists","positionFeatureStyle","accuracyFeatureStyle","setGeometry","bufferFeature","bufferFeatureExists","bufferGeometry","areOutOfView","getLinkedLayersOptions","linkedLayers","linkId","getRootParentByProperty","layerToUse","parentLayer","hasParentLayer","getDirectParentLayerByProperty","hasLinkWithProperty","layerLLOptions","links","layerHasLinkWithProperty","currentLinkId","parents","pl","linkedIds","getDirectChildLayersByProperty","link","lid","getIgoLayerByLinkId","getAllChildLayersByProperty","knownChildLayers","childLayers","cl","syncedDelete","getAllChildLayersByDeletion","getDirectChildLayersByDeletion","rootLayersByProperty","plbp","IgoMap","attribution","defaultOptions","layerWatcher","scaleLine","olControlScaleLine","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","setView","queryResultsOverlay","searchResultsOverlay","geolocationController","mapViewOptions","initLayerSyncFromRootParentLayers","skipWhile$1","pc","handleLayerPropertyChange","propertyChange","initiatorIgoLayer","isLayerProperty","isDatasourceProperty","rootParentByProperty","clbp","resolutionPropertyHasChanged","initiatorIgoLayerSourceType","initiatorIgoLayerOgcFilterableDataSourceOptions","getUid","lLayerType","appliedOgcFilter","getParams","appliedTimeFilter","TIME","updateView","currentView","viewOptions","constrainResolution","maxLayerZoomExtent","updateControls","getControls","removeControl","changeBaseLayer","bl","getBaseLayers","setMinZoom","minZoom","setMaxZoom","getLayerById","getLayerByAlias","getLayerByOlUId","olUId","getLayerByOlLayer","addLayers","offsetZIndex","offsetBaseLayerZIndex","addedLayers","doAddLayer","setLayers","removeLayers","newLayers","layersToRemove","handleLinkedLayersDeletion","linkedLayer","linkedIndex","doRemoveLayer","srcLayer","rootParentByDeletion","getDirectParentLayerByDeletion","layerHasLinkDeletion","hasLinkWithSyncedDelete","getRootParentByDeletion","clbd","removeAllLayers","raiseLayer","getLayerIndex","moveLayer","raiseLayers","lowerLayer","lowerLayers","reverseLayers","layerTo","zIndexFrom","existingLayer","maxZIndex","sortLayersByZIndex","layer1","layer2","MapBrowserComponent","_view","_controls","activityId","PointerPositionDirective","pointerPositionDelay","listenToMapPointerMove","unlistenToMapPointerMove","pointerMoveListener","onPointerEvent","dragging","lastTimeoutRequest","lonlat","coordinate","pointerPositionCoord","featureRandomStyleFunction","featureRandomStyle","olStyles","backgroundFill","backgroundStroke","imgSize","HoverFeatureDirective","styleService","selectionMVT","hoverFeatureId","igoHoverFeatureDelay","igoHoverFeatureEnabled","mouseout","subscribeToPointerStore","layers$$","tryBindStoreLayer","hoverFeatureMarkerStyle","selectionLayer","renderMode","declutter","mvtStyleOptions","createHoverStyle","localHoverStyle","hasLabelStyle","unsubscribeToPointerStore","unlistenToMapSingleClick","store$$","pointerHoverFeatureStore","resultsUnderPointerPosition","addFeatureOverlay","onMapEvent","singleClickMapListener","onMapSingleClickEvent","topMostOlLayer","maximumZindex","getPixelFromCoordinate","forEachFeatureAtPixel","mapFeature","layerOL","igoLayer","ol_uid","canProcessHover","myLayerVector","localOlFeature","handleRenderFeature","setLayerStyleFromOptions","featuresToLoad","myLabelOlFeature","setProperties","labelGeom","olgeom","myLayerVectorTile","setSource","mvtFeatures","localFeature","RenderFeature","hoverEntity","hoverSummary","getHoverSummary","summary","geom","getOrientedFlatCoordinates","coords","flatCoords","idx","ZoomButtonComponent","getMinZoom","getMaxZoom","onGeolocationClick","GeolocateButtonComponent","_map","ngAfterContentInit","tracking$$","HomeExtentButtonComponent","computeHomeExtent","homeExtentButtonExtent","extentOverride","homeExtentButtonCenter","centerOverride","homeExtentButtonZoom","zoomOverride","onToggleClick","WakeLockButtonComponent","noSleep","NoSleep","ie","edge","chrome","firefox","opera","safari","disableWakeLock","addEventListener","enableWakeLock","toggleWakeLock","collapseOrExpand","BaseLayersSwitcherComponent","_baseLayers","expand","showButton","useStaticIcon","arrayLayers","baseLayers","mapZoom","blHidden","GeoDBService","ngxIndexedDBService","compression","dbName","_newData","regionID","insertSource","compress","subject","geoDBData","object$","getByID","dbObject","currentRegionID","collisions","collisionsMap","customUpdate","deleteRequest","isDeleted","getRegionCountByID","getRegionByID","datas","IDBKey","IDBKeyRange","only","getAllByIndex","deleteByRegionID","dbRequest","openCursor","keyRange","lowerBound","mode","DBMode","openCursorByIndex","resetCounters","resetCollisionsMap","revertCollisions","getByKey","newData","GeoNetworkService","networkService","networkOnline","simpleGetOptions","getOnline","getOffline","isOnline","LayerDBService","layerDBData","LayerService","dataSourceService","createLayer","createTileLayer","createVectorLayer","createImageLayer","_layerOptions","createVectorTileLayer","createAsyncLayer","handleLegacyStyles","serviceStyle","clusterBaseStyle","layerOptionsOl","applyMapboxStyle","legacyStyleOptions","legacyOption","mapboxStyle","getStuff","sprite","getAbsoluteUrl","res2","stylefunction","createAsyncIdbLayers","layersOptions","idbl","MiniBaseMapComponent","layerService","basemap","_display","_baseLayer","handleBaseLayerChanged","handleMainMapViewChange","mainMapView","mainMapViewProperties","setResolution","setRotation","baselayer","handleLinkedBaseLayer","linkedId","layerToApply","linkedLayerOptions","showInMiniBaseMap","RotationButtonComponent","azimuthRounded","rotationRounded","currentStyle$","radians","deg","bearingToAzimuth","rotated$","InfoSectionComponent","infoContent","CatalogItemType","TypeCatalog","Catalog","catalogService","WMSCatalog","collectCatalogItems","loadCatalogWMSLayerItems","WMTSCatalog","loadCatalogWMTSLayerItems","BaselayersCatalog","baselayers","loadCatalogBaseLayerItems","ArcGISRestCatalog","loadCatalogArcGISRestItems","TileOrImageArcGISRestCatalog","typeCatalog","CompositeCatalog","composite","loadCatalogCompositeLayerItems","CatalogFactory","QueryService","queryEnabled","previousMessageIds","queryLayer","apply","getQueryUrl","HTMLGML2","urlGml","mergeMap","gmlRes","mergedGML","mergeGML","imposedGeom","imposedProperties","extractData","urlGmls","checkScaleAndResolution","requestDataForHTMLGML2","checkScale","checkResolution","olmline","pts","ptsArray","firstFeatureType","olmpoly","nbFeatures","bbox","getQueryParams","bboxExtent","titleContent","queryTileField","olmpts","returnGeometry","queryTitleContent","featureGeometryCoordinates","featureGeometryType","appendLineString","appendPolygon","convexHull","cross","lower","upper","imposedGeometry","queryDataSource","allowedFieldsAndAlias","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","ESRIJSON","extractEsriJSONData","TEXT","extractTextData","extractHtmlData","extractGML2Data","geomToAdd","createGeometryFromUrlClick","wmsDatasource","FEATURE_COUNT","featureCount","defaultFeatureCount","getQueryTitle","sourceTitle","searchParams","bboxRaw","clickx","clicky","clickx1","clicky1","wktPoly","wmsParser","featureToResult","parser","htmlTarget","crs","bodyTagStart","bodyTagEnd","lastIndexOf","striptags","queryString","pairs","featureOL","featureGeometry","GEOMETRIE","shape","SHAPE","SHAPE_S","SHAPE_L","SHAPE_P","the_geom","geom32198","datasource","forceGML2","queryUrls","getCustomQueryUrl","WMSGetFeatureInfoOptions","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","cartoDatasource","sql","queryPrecision","tileArcGISRestDatasource","deltaX","deltaY","clickBuffer","mime","getLabelMatch","layerIsQueryable","olLayerFeatureIsQueryable","layerFeatureIsQueryable","queryLayerFeatures","QueryDirective","queryService","queries$$","queryFeatures","queryFeaturesHitTolerance","waitForAllQueries","cancelOngoingQueries","queries$","doQueryFeatures","queryLayers","query$","clickedFeatures","values_","queryFormatAsWms","newFeature","nom","id_","_icon","renderFeatureFromOl","olRenderFeature","geometryType","ends","getEnds","OlPolygon","getFlatCoordinates","OlPoint","OlLineString","queryFeaturesCondition","dragExtent","forEachFeatureIntersectingExtent","olDragSelectInteractionOnQuery","SearchSource","storageOptions","getDefaultOptions","settings","setting","setParamFromSetting","showInSettings","featureStoresWithIndex","storesWithIndex","_featureStoresWithIndex","setWorkspaces","workspaces","fw","datasets","saveInStorage","confValue","displayOrder","getHashtagsValid","term","settingsName","hashtags","searchSourceSetting","getSettingsValues","hashtagsValid","hashtag","hashtagKey","QuerySearchSource","GoogleLinks","encodeURI","OsmLinks","PropertyTypeDetectorService","regexService","geoServiceRegexes","getGeoServiceRegexes","getPropertyType","geoServiceRegex","availableProperties","matchingGeoservice","CatalogService","loadCatalogs","contextConfig","catalogConfig","apiUrl","catalogsFromConfig","catalogsFromApi$","catalogs","_response","EMPTY","loadCatalogItems","newCatalog","createInstanceCatalog","getCatalogBaseLayersOptions","externalProvider","Group","getCatalogCapabilities","Service","finalLayers","flattenWmsCapabilities","groupSeparator","capabilitiesCapabilityLayer","includeRecursiveItems","modifiedParent","modifiedLayer","ff","getWMTSItems","getArcGISRESTItems","compositeCatalog","catalogsFromInstance","sortDirection","request1$","request2$","flatDeepLayer","arr","groupImpose","pushImposeGroup","outGroupImpose","address","flatLayer","obs","request3$","recursiveGroupByLayerAddress","keyFn","outItem","indicesMatchTitle","indicesMatchNewMetadataUrl","bInd","nPosition","newMetadataUrl","groupByGroupId","groupId","ind","ix","computeForcedProperties","layerNameFromCatalog","forcedProperties","returnProperty","metadataUrl","metadataAbstract","metadataAbstractAll","metadataUrlAll","forcedPropertiesForAllLayers","forcedProperty","prepareCatalogItemLayer","idParent","layersQueryFormat","configuredQueryFormat","retrieveLayerInfoFormat","showLegend","baseSourceOptions","setCrossOriginAnonymous","propertiesToForce","baseAbstract","layerPrepare","prepareCatalogItemGroup","itemListIn","regexes","idGroup","groupItem","testLayerRegexes","layerItem","itemsPrepare","loopLevel","findCatalogInfoFormat","ServiceIdentification","matrixSet","requestEncoding","regex","currentLayerInfoFormat","baseInfoFormat","configuredInfoFormat","specific","onLayerAddedChange","CatalogBrowserComponent","catalogAllowLegend","toggleCollapsedGroup","currentItems","isGroup","isLayer","addLayerToMap","removeLayerFromMap","onGroupAddedChange","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","profils","security","layersAddedByClick$","currLayer","sortCatalogItemsByTitle","returnItem","titleA","titleB","toggleLegendItem","style_r18","onChangeStyle","onLoadImage","LayerLegendComponent","updateLegendOnResolutionChange","imagesHeight","lastlLegend","listStyles","STYLES","onViewControllerStateChange","legendItems$","getLegendGraphic","obsLegGraph","leg","imgGraphValue","transfertToggleLegendItem","newLegends","outLegends","lastLegends","computeItemTitle","layerLegend","localLayerOptions","wmsDataSourceOptions","updateLegend","legendItems","sA","sa","elemRef","renderedLegends","renderedLegend","CatalogBrowserLayerComponent","mouseInsideAdd","isPreview$$","isPreview$","addedLayerIsPreview","isVisible","computeTitleTooltip","layerTooltip","layerMetadata","ABSTRACT","CUSTOM","onMouseEvent","askForLegend","layerLegendShown$","igoLayer$","addedChange","haveGroup","isNaN","inRange$","oLayer","isVisible$","getBadgeIcon","computeTooltip","CatalogBrowserGroupComponent","toggleCollapsed","evaluateAdded","evaluateDisabled","onToggleCollapsed","layerAddedChange","tryToggleGroup","onLayerPreview","preview$","onTitleClick","LayerListToolService","sortAlpha","onlyVisible","onlyInRange","keywordInitialized","sortedAlphaInitialized","onlyVisibleInitialized","onlyInRangeInitialized","check","toggleVisibility","toggleLayerTool","LayerItemComponent","_selectAll","toggleLegendOnVisibilityChange","expandLegendIfVisible","orderable","lowerDisabled","raiseDisabled","queryBadge","activeLayer","_activeLayer","selectionMode","layerTool$","selectAll","layerCheck","eyeTooltip","inResolutionRange$","toggleLegend","updateQueryBadge","onResolutionChange","tooltipText","network$$","showLegend$","toggleLegendOnClick","inResolutionRange","queryBadgeHidden$","checkbox","always","LayerListControlsEnum","LayerListSelectVisibleEnum","ALL_VISIBLE","LayerListDisplacement","Raise","zoomLayerExtents","changeOpacity","zoomLayersExtents","LayerListComponent","thresholdToFilterAndSort","hideSelectedLayers","layersChecked","layersAreAllVisible","ogcButton","timeButton","floatLabel","layerFilterAndSortOptions","excludeBaseLayers","expandLegendOfVisibleLayers","_keyword","_onlyVisible","_sortedAlpha","toggleOpacity","_layers","removeProblemLayerInList","activeLayer$","keyword","badgeOpacity","getUpperLayer","isUpperBaselayer","getLowerLayer","isLowerBaselayer","raiseDisabledSelection","raisableLayers","selectAllCheck","lowerDisabledSelection","lowerableLayers","checkOpacity","layersCheckedOpacity","layerListDisplacement","change$$","debounce","timer","showToolbar$","computeShowToolbar","computeLayers","appliedFilterAndSort","selectAllCheck$$","selectAllCheck$","checks","layerTool","lay","activeLayerExtentIsValid","showButtonZoomToExtent","layerExtent","activeLayersExtentAreValid","layersExtent","clearKeyword","moveActiveLayer","actiontype","fromUi","sortedLayersToMove","ZINDEX","layersToMove","Lower","base","mapIndex","currentLayer","previousLayer","raisableLayer","layersToRaise","checkItems","getElementsByClassName","itemFocused","targetToScroll","nextLayer","lowerableLayer","layersToLower","layersOut","filterLayers","sortLayersByTitle","sortLayersByZindex","onKeywordChange","onAppliedFilterAndSortChange","showToolbar","never","keepLayerIds","layerKeywords","kw","localKeyword","dataSourceType","keywordRegex","keywordInList","removable","layerItemChangeDetection$","isLayerRemovable","isAllLayersRemovable","statusSelectedLayersCheck","statusSelectedLayers","NULL","findTrue","findFalse","MIXED","ALL_HIDDEN","layersCheck","eventMapIndex","toggleSelectionMode","elemSource","layersList","clearTerm","LayerListToolComponent","onlyVisible$","sortAlpha$","term$","term$$","onlyVisible$$","sortAlpha$$","toggleSortAlpha","toggleOnlyVisible","LayerListBindingDirective","layersOrResolutionChange$$","shownLayers","setLayersVisibilityStatus","layersVisibility$$","visibles","allLayersAreVisible","toggleShowAllLegends","LayerLegendListComponent","showAllLegend","allowShowAllLegends","showAllLegendsValue","computeShownLayers","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","allLegendsShown","toggleTrackFeature","TrackFeatureButtonComponent","LayerLegendItemComponent","IgoLayerModule","MatDividerModule","MatSlideToggleModule","MatSliderModule","ColorPickerModule","IgoCatalogBrowserModule","type_r9","ctx_r5","ctx_r6","AddCatalogDialogComponent","defaultAddedCatalogType","predefinedCatalogs","addedCatalog","typeCapabilities","addedCatalogType$$","updateValueAndValidity","computePredefinedCatalogList","storeViewAll$$","emailAddress","changeUrlOrTitle","patchValue","predefinedCatalogsList$","addCatalog","addCatalogDialog","CatalogLibaryComponent","addCatalogAllowed","addedCatalogs","getCatalogs","onCatalogSelect","catalogSelectChange","unsubscribeAddingCatalog","addingCatalog$$","predefinedCatalog","mapName","ServiceType","catalogToAdd","newCatalogs","onCatalogRemove","removeCatalogFromLibrary","CatalogLibaryItemComponent","catalogRemove","IgoCatalogLibraryModule","IgoCatalogModule","FilterableDataSourcePipe","arg","isTimeFilterable","isOgcFilterable","TimeFilterService","filterByDate","newdateform","newdateformStart","newdateformEnd","dates","reformatDateTime","filterByYear","year","years","getFullYear","month","getMonth","day","getUTCDate","hour","getUTCHours","minute","getUTCMinutes","OGCFilterService","filterByOgc","filterString","setOgcWFSFiltersOptions","wfsDatasource","interfaceOgcFilters","setOgcWMSFiltersOptions","filtered","SpatialFilterType","Predefined","SpatialFilterItemType","Address","SpatialFilterService","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","getKeyByValue","loadFilterList","urlFilterList","featureCollection","loadThematicsList","loadFilterItem","itemType","thematic","urlItem","bufferInput","simplified","loc","loadItemById","featureType","featureCode","loadBufferGeometry","filterType","bufferOutput","DownloadService","DSOptions","currentProj","outputFormatDownload","baseurl","openDownload","DownloadButtonComponent","downloadService","IgoDownloadModule","openSecureUrl","ctx_r8","FeatureDetailsComponent","sanitizer","ready","unsubscribe$","_source","_feature","selectFeature","urlSanitizer","isHtmlDisplay","htmlDisplayEvent","htmlSanitizer","docOrImage","fileUrl","isEmbeddedLink","div","getAttribute","isDoc","getEmbeddedLinkText","filterFeatureProperties","offlineButtonState","forcedOffline$","Route","GeometryType","LabelType","Coordinates","CoordinatesUnit","DecimalDegree","FontType","Arial","createDrawInteractionStyle","createDrawHoleInteractionStyle","getMousePositionFromOlGeometryEvent","olEvent","DrawControl","olDrawingLayer","drawingLayer","createOlInnerOverlayLayer","olGeometryType","olInteractionStyle","interactionStyle","radiusVal","predefinedRadius$","radiusValData","radiusCercle","olDrawingLayerSource","activateModifyAndSelect","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setOlInteractionStyle","setGeometryType","getGeometryType","drawingLayerSource","drawingLayerStyle","olDrawInteraction","freehand$","OlDraw","maxPoints","freehand","ispredefinedRadius$","stopClick","freehandCondition","onDrawStartKey","onDrawStart","onDrawEndKey","onDrawEnd","onDrawAbortKey","abort$","olModifyInteraction","OlModify","olSelectInteraction","OlSelect","doubleClick","onSelect","unsubscribeKeyDown","onDrawKey","start$","olGeometryEvent","mousePosition","changes$","subscribeKeyDown","radiusDrawEnd$","modify$","end$","select$","keyDown$$","removeLastPoint","finishDrawing","abortDrawing","Length","MeasureType","MeasureLengthUnit","Meters","Kilometers","Miles","Feet","SquareMeters","MeasureAreaUnit","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","metersToKilometers","metersToFeet","metersToMiles","squareMetersToSquareKilometers","squareMetersToSquareMiles","squareMetersToSquareFeet","squareMetersToHectares","squareMetersToAcres","conversion","formatMeasure","measure","parts","toLocaleString","minimumFractionDigits","maximumFractionDigits","unitAbbr","MeasureLengthUnitAbbreviation","MeasureAreaUnitAbbreviation","createMeasureInteractionStyle","getLength","getArea","measureOlGeometryLength","area","measureOlGeometryArea","lengths","coordinatesLength","olSegment","updateOlGeometryMidpoints","olMidpoints","olMidpointPoint","getOlGeometryMidpoints","midpointsLength","midpointCoordinate","getCoordinateAt","olMidpoint","setCoordinates","expectedNumber","clearOlMidpointTooltip","olTooltip","removeOverlay","getTooltipsOfOlGeometry","olTooltips","getOlTooltipsAtMidpoints","olCenterTooltip","getOlTooltipAtCenter","olCenter","createOlTooltipAtPoint","olPoint","srcGeomType","OlOverlay","stopEvent","setPosition","createInteractionStyle","DegreesMinutesSeconds","onLabelTypeChange","onChangeCoordinateUnit","onChangeLengthUnit","onChangeAreaUnit","cancelDrawing","confirm","DrawPopupComponent","confirmFlag","Custom","labelType","arrayBuiltInType","currentLabel","labelLength","longitudeLatitude","Circle","longitude","latitude","longlatDD","coordinatesInDD","point4326","currentCoordinates","LineString","lengthInMeters","currentLength","Polygon","areaInMetersSquare","currentArea","circularPolygon","coordinatesMeasureUnit","lengthMeasureUnit","Area","areaMeasureUnit","buildArrayType","input","labelFlag","measureUnit","polygonCheck","lengthUnit","metersToUnit","areaUnit","squareMetersToUnit","coordinatesUnit","DDtoDMS","selectOptions","noLabelButton","customOrPredefined","optionAvailable","currentOption","allLengthUnits","getLengthUnitEnum","allAreaUnits","allCoordinatesUnits","getAreaUnitEnum","lengthLabelT","getLabelLength","getProperLengthLabel","DrawShorcutsComponent","DrawStyleService","labelsAreShown","fontSize","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","toggleLabelsAreShown","setIcon","getIcon","getFontSize","setFontSize","getFontStyle","fontStyle","setFontStyle","getOffsetX","setOffsetX","getOffsetY","setOffsetY","createIndividualElementStyle","fontSizeAndStyle","labelsAreOffset","flatCoordinates","cos","StyleModalDrawingComponent","drawStyleService","buildForm","linestringOnly","buildStyleData","styleModalData","drawingStyle","allFontStyles","getFeatureFontSize","getFeatureFontStyle","getFeatureFillColor","getFeatureStrokeColor","getFeatureOffsetX","getFeatureOffsetY","DrawLayerPopupComponent","labelString","DrawIconService","getIconsList","getIcons","icons","getPath","onToggleFreehandMode","onMeasureUnitChange","deleteDrawings","onIconChange","openStyleModalDialog","DrawComponent","drawIconService","draw","editMode","editLabelDrawing","_stores","_drawControls","layerCounterID","draw$","drawControlIsDisabled","drawControlIsActive","freehandMode","UntypedFormControl","Subscription","isCreatingNewLayer","drawControls","activeDrawingLayer","_activeDrawingLayer","measureUnits","activeStore","activeDrawControl","dc","deactivateDrawControl","allLayers","selectedFeatures$","onLayerChange","createDrawControl","toggleDrawControl","drawControlsEvent","layersIDEvent","radiusFormControlChange$$","radiusFormControl","changeRadius","activeDrawingLayerSource","newTitle","isNewLayer","autoFocus","onFontChange","onColorChange","onOffsetLabelChange","openDrawDialog","isDrawEnd","updateLabelOfOlGeometry","updateLabelType","updateMeasureUnit","updateFontSizeAndStyle","updateFillAndStrokeColor","updateOffset","onSelectDraw","updateHeightTable","drawingLayerFeature","addFeatureToStore","clearLabelsOfOlGeometry","onModifyDraw","longLat","radiusLabel","olGeometryLength","lengthLabel","circleArea","areaLabel","olGeometryArea","replaceFeatureInStore","labelTypeAndUnit","olGeometryCoordinates","entityCoordinates","rad","center4326","lon4326","lat4326","featureId","extent4326","getDistance","setupLayer","currGeometryType","onToggleLabels","activeLayerChange","selectionChange","olGeometryFeature","openShorcutsDialog","selectedFeature","elementStyle","onToggleDrawControl","toggleIsChecked","isCircle","numberId","tryAddLoadingStrategy","tryAddSelectionStrategy","many","isAnIcon","onGeometryTypeChange","_label","fontStyle_","fillColor_","strokeColor_","offsetX_","offsetY_","typeOfLabel","labelType_","measureUnit_","numberOfDrawings","tableTemplate","updateActiveLayer","activateDrawControl","drawEnd$$","drawSelect$$","isPoint","isLineString","isPolygon","radiusMeters","pointStyle","selectedMeasureUnit","dependencies","IgoDrawModule","MatButtonToggleModule","BrowserModule","BrowserAnimationsModule","MatRadioModule","IgoFeatureDetailsModule","IgoFeatureFormModule","IgoFeatureModule","ModifyControl","olModifyInteractionIsActive","olTranslateInteractionIsActive","olDrawInteractionIsActive","removedOlInteractions","modify","olOverlayLayer","olLinearRingsLayer","createOlLinearRingsLayer","olOverlaySource","olLinearRingsSource","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","drawStyle","deactivateModifyInteraction","onModifyStartKey","onModifyStart","onModifyEndKey","onModifyEnd","onModifyKey","subscribeToKeyDown","unsubscribeToKeyDown","olTranslateInteraction","OlTranslate","deactivateTranslateInteraction","onTranslateStartKey","onTranslateStart","onTranslateEndKey","onTranslateEnd","onTranslateKey","olOuterGeometry","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","drawKeyDown$$","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","drawKeyUp$$","unsubscribeToDrawKeyUp","deactivateDrawInteraction","linearRingCoordinates","getLinearRing","addLinearRingToOlGeometry","_linearRingCoordinates","updateLinearRingOfOlGeometry","olPolygon","olLinearRing","appendLinearRing","addLinearRingToOlPolygon","OlLinearRing","newCoordinates","getLinearRings","MeasurerDialogComponent","measureAreaUnit","measureLengthUnit","onNoClick","onToggleDisplayLines","onToggleDisplayDistance","onToggleDisplayAreas","onLengthUnitChange","onAreaUnitChange","onCalculateClick","onDeleteClick","MeasurerComponent","activeLengthUnit","activeAreaUnit","measureType","measureUnitsAuto","displayDistance","displayLines","displayAreas","showTooltips","minSegmentLength","activeMeasureType","setActiveMeasureType","_activeMeasureType","createDrawLineControl","createDrawPolygonControl","createModifyControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","onToggleMeasureUnitsAuto","onDisplayDistance","onDisplayLines","onDisplayAreas","table","activeOlGeometry","updateTooltipsOfOlGeometry","sum","perimeter","openDialog","olDrawSource","onModifyClick","modifyControl","_olFeature","activateModifyControl","clearTooltipsOfOlGeometry","onFeatureAddedKey","updateMeasureOfOlGeometry","onFeatureRemovedKey","selectedFeatures$$","objectsExists","objectExist","hasArea$","hasLine$","drawLineControl","OlStyle","drawPolygonControl","drawControl","drawStart$$","drawChanges$$","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","measureOlGeometry","measure$","modifyStart$$","modifyEnd$$","modifyChanges$$","onModifyChanges","_measure","olMidpointsTooltips","updateOlTooltipsAtMidpoints","typeGeom","updateOlTooltip","updateOlTooltipAtCenter","updateOlGeometryCenter","centerCoordinate","showTooltipsOfOlGeometry","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","MeasureFormatPipe","GeometryFormFieldInputComponent","createMeasureTooltip","drawGuide","_drawControlIsActive","controlOptions","_geometryType","deactivateControl","freehandDrawIsActive","toggleControl","_freehandDrawIsActive","predefinedRadius","_predefinedRadius","_drawStyle","olGuideStyle","getGuideStyleFromDrawStyle","defaultDrawStyleRadius","overlayStyle","_overlayStyle","addGeoJSONToOverlay","olModify","features_","addOlOverlayLayer","registerOnChange","fn","registerOnTouched","onTouched","writeValue","updateDrawStyleWithDrawGuide","activeControl","activateControl","olGeometryEnds$$","onOlGeometryEnds","olGeometryChanges$$","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","olGeoJSON","lastIndex","lastLength","olLastMidpoint","innerHtml","guideStyle","IgoGeometryFormFieldModule","IgoGeometryModule","TimeFilterButtonComponent","timeFilterCollapse","handleDateChange","year_r21","handleYearChange","startYear_r27","endYear_r28","ctx_r34","toggleFilterState","playYear","resetFilter","ctx_r2","playFilter","ctx_r3","TimeFilterFormComponent","listYears","startListYears","endListYears","playIcon","resetIcon","YEAR","valueArray","startDate","endDate","isRange","SLIDER","getStepDefinition","timeInterval","getTimezoneOffset","is","startYear","initStartYear","endYear","initEndYear","checkFilterValue","yearChange","storeCurrentFilterValue","timeFromWms","newStartListYears","newEndListYears","setupDateOutput","applyTypeChange","handleListYearChange","handleListYearStartChange","dateToNumber","newDate","setSliderThumbLabel","thumbLabel","findThumbLabel","mySlider","childNodes","textContent","stopFilter","that","newMinDateNumber","maxDateNumber","handleSliderDateChange","handleSliderTooltip","handleSliderYearChange","handleSliderValue","getRoundedDate","toDateString","toTimeString","setSeconds","setHours","setMinutes","getDay","selectedHour","getHours","selectedMinute","getMinutes","getRangeMinDate","getRangeMaxDate","atMinute","coeff","asMilliseconds","MatSlider","toggleFiltersCollapsed","TimeFilterItemComponent","timeFilterService","filtersCollapsed","TimeFilterListComponent","WktService","wktToFeature","wkt","wktProj","featureProj","extentToWkt","epsgTO","extentProj","roundCoordinateArray","wktLine","wktMultiPoints","coordinateArray","roundArray","snrcToWkt","snrc","ew","sn","snrc250kIndex","snrc50kIndex","snrc1m","snrc250k","snrc50k","ar1m","part1m","part250k","part50k","partEW","partSN","unit1mEW","unit1mSN","unit250kEW","unit250kSN","unit50kEW","unit50kSN","index250kEW","index250kSN","index50kEW","index50kSN","increment250kEW","increment250kSN","increment50kEW","increment50kSN","unitPerTypeEW","unitPerTypeSN","ul","lr","ur","ll","clearSelectedField","updateFieldsList","changeField","changeSpatialSelector","clearProperty","updateValuesList","changeProperty","changeSNRC","changeMapExtentGeometry","OgcFilterFormComponent","wktService","ogcFilterOperator","defaultStepMillisecond","_snrc","allOgcFilterOperators","ogcFilterOperators$","igoSpatialSelectors","currentFilter","activeFilters","fields$","sFields","excludeFromOgcFilters","sfs","selectedField$","currentFilterIsSpatial","filteredFields$","_filterFields","pos","filteredValues$","_filterValues","isClearable","detectedProperty","detectProperty","refreshFilters","deleteFilter","changeLogical","changeOperator","currentFilterIsSpatial$","changeCaseSensitive","refreshFilter","changeNumericProperty","changeSNRCGeometry","isSpatial","isTemporalOperator","OgcFilterableFormComponent","refreshFunc","addFilterToSequence","changeOgcFilterType","OgcFilterableItemComponent","ogcFilterService","hasActiveSpatialFilter","filtersAreEditable","hasSelector","lastRunOgcFilter","lastLevel","firstFieldName","includedFields","datasourceOptions","firstOperatorName","defaultLogicalParent","force","af","rebuildFilter","ogcDataSource","ogcLayer","isAdvancedOgcFilters","addFilterDisabled","changeOgcFiltersAdvancedOgcFilters","OgcFilterableListComponent","OgcFilterButtonComponent","ogcFilterCollapse","currentPushButtonGroup","gr","cntPushButtons","cb","button","currentCheckboxGroup","cntCheckboxes","currentRadioButtonsGroup","cntRadioButtons","radio","currentSelectGroup","cntSelect","currentAutocompleteGroup","cntAutocomplete","filterActiveValue","OGCFilterTimeService","stepMillisecond","stepIsYearDuration","months","weeks","days","hours","stepIsMonthDuration","stepIsWeekDuration","week","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","addStep","toDate","subtractStep","subtract","bundle_r14","bundle_r26","emptyRadioButtons","bundle_r46","emptySelect","toggleAllSelection","selectOptionClick","bundle_r69","emptyAutocomplete","autocompleteOptionClick","bundle_r99","ctx_r113","OgcFilterSelectionComponent","domService","checkboxesIndex","radioButtonsIndex","baseIndex","selectAllSelected","filteredOgcAutocomplete","_currentFilter","ogcFiltersSelectors","ogcSelector","_j","_h","_m","_l","_k","_q","_p","_o","_u","_s","_r","_x","_w","_v","_0","_z","_y","_3","_2","_1","_6","_5","_4","currentPushButtonsGroup","pushButtonsGroup","currentCheckboxesGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled","selectEnabled$","applyFiltersTimeout","compSelect","applyFilters","selectEnableds","selectEnableds$","autocompleteEnabled","autocompleteEnabled$","selectMulti","getPushButtonsGroups","getCheckboxesGroups","getRadioButtonsGroups","getSelectGroups","getAutocompleteGroups","getSelectEnabled","getSelectDomValues","getAutocompleteEnabled","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","getToolTip","toolTip","domSelectors","domValues","domSelector","filterDOM","domOptions","newBundle","sel","comp","getButtonColor","pushButton","bundleIsVertical","vertical","currentOgcSelection","markAsUntouched","deselect","newStatus","isUserInput","displayFn","currentGroups","currentGroup","isMoreResults","selectorsLength","displayMoreResults","isLessResults","displayLessResults","decls","SpatialFilterTypeComponent","spatialType","_store","selectedTypeIndex","activeDrawType","onTypeChange","onDrawTypeChange","eventQueryType","selectedQueryType","zoneChange","zoneWithBufferChange","bufferChange","SpatialFilterListComponent","spatialFilterService","queryType","_queryType","_zone","zoneWithBuffer","bufferFormControl","formValueChanges$$","bufferValueChanges$$","selectedZone","featureGeom","onZoneChange","measureUnitChange","onDrawControlChange","onfreehandControlChange","onItemTypeChange","ctx_r37","clearSearch","clearDrawZone","toggleVisibleList","entityChange","SpatialFilterItemComponent","Thematics","NestedTreeControl","node","childrens","thematics","MatTreeNestedDataSource","selectedThematics","geometryTypeField","drawGuideField","drawGuidePlaceholder","listIsVisible","geometryTypes","drawGuide$","drawStyle$","PointStyle","PolyStyle","overlayStyle$","thematicLength","_thematicLength","limits","child","value$","value$$","drawZone","drawZoneEvent","radiusChanges$$","bufferChanges$$","bufferEvent","selectedRecordStrategy","selectionStrategy","detach","selectedItemType","itemTypeChange","isPredefined","hasChild","treeControl","isExpanded","collapse","numSelected","numNodes","hasChildrenSelected","bool","selectedThematicsName","thematicChange","childrensToggle","onToggleChange","nodeSelected","freehandControl","toggleSearchButton","radiusEvent","toggleSearch","openWorkspace","createTableTemplate","clearButton","clearButtonEvent","clearSearchEvent","disableSearchButton","disabledClearSearch","formValue","typeColumn","nameColumn","modeChange","changePropertyByPass","hour_r27","minute_r31","hour_r39","minute_r43","monthSelected","OgcFilterTimeComponent","ogcFilterTimeService","_defaultMin","_defaultMax","_defaultDisplayFormat","_defaultSliderModeEnabled","sliderMode","calendarTypeYear","stepMilliseconds","beginValue","_beginValue","endValue","_endValue","sliderInterval","displayFormat","parseFilter","handleMin","handleMax","onlyYearBegin","getUTCFullYear","onlyYearEnd","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","dateFilter","filterBeginFunction","filterEndFunction","intervalInt","_now","endOf","getDateFromStringWithoutTime","changeTemporalProperty","valueTmp","getDateTime","dateStringFromYearNotime","calendarType","restrictedToStep","toISOString","handleDate","yearOnlyInputChange","datePicker","yearSelected","calendarView","dateValue","monthDiff","dateValuePlus1","monthDiffPlus1","asYears","asMonths","weekDiff","weekDiffPlus1","asWeeks","dayDiff","_mod","asDays","hourDiff","asHours","valuetmp","valuetmp2","beginHourFormControl","beginMinuteFormControl","endHourFormControl","endMinuteFormControl","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","checkEndValue","beginHours","fullEndHoursArray","endHours","fullBeginMinutesArray","beginMinutes","fullEndMinutesArray","endMinutes","beginTmp","endTmp","restrictToStep","filterStateDisable","stringDate","dateItems","minDefaultDate","maxDefaultDate","minDefaultISOString","maxDefaultISOString","filterOriginConfig","toLocaleDateString","OgcFilterTimeSliderComponent","sliderValue","calculatedStep","_defaultSliderInterval","sliderDisplayWith","beginMillisecond","maxMillisecond","calculateStep","handleSliderInput","dateTmp","toAdd","slider","_emitInputEvent","_increment","matSliderChange","dateBeginTmp","dateEndTmp","startOf","IgoFilterModule","MAT_DATE_LOCALE","MatTabsModule","MatTreeModule","MatOptionModule","MatNativeDateModule","MatDatetimepickerModule","MatNativeDatetimeModule","ExportError","ExportInvalidFileError","setPrototypeOf","ExportNothingToExportError","EncodingFormat","ExportService","aggregateInComment","ogreUrl","gpxAggregateInComment","export","encoding","exportOlFeatures","generateFeature","exportAsync","excludePrefix","ExportFormat","GPX","generateAggregatedFeature","comment","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","downloadContent","fileName","uri","setAttribute","downloadFromUri","encodingType","featuresText","UTF8","acceptCharset","enctype","LATIN1","featuresJson","encodedProperties","encode","geojsonField","outputNameField","outputName","ogreFormat","outputFormatField","submit","GML","KML","Shapefile","CSVcomma","CSVsemicolon","padTo2Digits","padStart","handleFileImportSuccess","file","confirmDialogService","styleListService","handleNothingToImportError","computeLayerTitleFromFile","first$1","dformat","getDate","addLayerAndFeaturesStyledToMap","imposedSourceOptions","imposedLayerOptions","distance","getStyleList","randomStyle","searchIndexEnabled","addLayerAndFeaturesToMap","handleInvalidFileImportError","handleUnreadbleFileImportError","handleSizeFileImportError","sizeMb","handleOgreServerImportError","getFileExtension","ImportError","ImportInvalidFileError","ImportUnreadableFileError","ImportNothingToImportError","ImportSizeError","ImportSRSError","ImportOgreServerError","ImportService","importConfig","clientSideFileSizeMax","clientSideFileSizeMaxMb","formats","allowedExtensions","formatExtensionAssociation","import","importAsync","getFileImporter","extension","zipMimeTypes","allowedZipMimeTypes","allowedMimeTypes","importFile","importFileWithOgre","importer","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","errMsg","msg","GeoJSON","writeFeatureObject","StyleListService","styleList","baseStyleList","styleListResponse","projection_r6","inLayersIdToExportSelectionOnly","layer_r29","handleExportFormSubmit","ImportExportComponent","importService","exportService","forceNaming","controlFormat","popupChecked","selectFirstProj","_projectionsLimitations","selectedMode","loadConfig","computeProjections","importHtmlClarifications","exportHtmlClarifications","projectionsLimitations","inputProj","importForm","popupAllowed","exportableLayers$","configFileSizeMb","fileSizeMb","exportOptions$$","exportOptions$","exportOptions","computeFormats","formLayer$$","handlePopup","handlePreviousLayerSpecs","selectedLayers","formats$","loading$","previousSpecs","previousLayerSpecs$","formats$$","encodings$$","encodings$","encodings","exportableLayers$$","projections$","translateKey","projectionsConstraints","computeProjectionsConstraints","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","configProjection","getWorkspaceByLayerId","wksFromLayerId","getLayerTitleById","layerHasSelectedFeatures","wksFromLayer","onlySelected","layersWithSelection","onlySelectedClick","exportOptionsChange","specs","importFiles","files","espgCodeRegex","onFileImportSuccess","onFileImportError","preCheck","p2","closed","onPopupBlockedError","geomTypesCSV","featuresCSV","filename","layerIndex","combineLayers","dSOptions","wks","featureInMapExtent","geomTypes","featureGeomType","currentGeomType","geomType","circular","gpxFeatureCnt","previousFeature","currentFeature","titleEmptyRows","createTitleEmptyRows","onFileExportError","onFileExportSuccess","titleRow","headerRow","emptyRow","previousFeatureKeys","firstKeyPrevious","currentFeatureKeys","firstKeyCurrent","previousKey","firstKeyAll","sameKeys","unset","importExportOptions","allowToStoreLayer","importWithStyle","handleFileImportError","handleSRSImportError","extraMessage","handleNothingToExportError","handleFileExportError","loadEncodings","encodingDefaultValue","appliedformats","formatsType","onlyUrl","onlyVector","vectorAndUrl","customList","validateListFormat","allowedFormats","configImportExportFormats","validatedListFormat","commonFormats","layersWithCustomFormats","previousCustomListFormats","finalFormats","modeChanged","selectMode","handleFileExportSuccess","onImportExportChange","IgoImportExportModule","IgoMapModule","MeasurerItemComponent","_auto","auto","toggleAutoUnit","measure$$","computeBestMeasureUnit","computeBestAreaUnit","converted","possibleUnits","computeBestLengthUnit","IgoMeasurerModule","IgoMeasureModule","OverlayAction","OverlayService","features$","OverlayDirective","overlayService","features$$","handleFeatures","IgoOverlayModule","jsPDFAPI","setGeoArea","pdfExt","geoExt","minx","maxx","maxy","miny","bounds","bbox_obj","internal","newAdditionalObject","bounds_obj","proj_obj","objId","title_obj","bbox_id","write","PrintOutputFormat","PrintPaperFormat","PrintOrientation","PrintResolution","PrintSaveImageFormat","PrintLegendPosition","PrintService","titleFont","titleFontStyle","subtitleFont","subtitleFontStyle","commentFont","commentFontStyle","commentFontSize","print","paperFormat","jsGeoPdfPlugin","jsPDF","doc","dimensions","margins","titleSizes","subtitleSizes","subtitle","A1","A0","fontSizeInPt","getTextPdfObjectSizeAndMarg","TEXTPDFFONT","addTextInPdfDoc","marginLeft","showProjection","showScale","addProjScale","addComment","addMap","addScale","handleMeasureLayer","addGeoRef","imgSizeAdded","legendPosition","addLegendSamePage","addLegend","saveDoc","docHeight","getHeight","pdf_extents","pdf_units2points","canvasOverlayHTMLMeasures","mapOverlayMeasuresHTML","getOverlayContainer","html2canvas","addCanvas","getLayersLegendHtml","map$1","legends","legendUrls","getLayersLegends","images$","getDataImage","dataImage","htmlImg","dataImages","getLayersLegendImage","doZipFile","canvas","useCORS","generateCanvaFileToZip","saveCanvasImageAsFile","pageWidth","setFont","textMarginLeft","textDimensions","getTextDimensions","w","h","commentMarginLeft","commentMarginBottom","textToAdd","textFont","textFontStyle","textFontSize","textMarginTop","isComment","splitTextToSize","heightPixels","textProjScale","imageSize","pourcentageReduction","imgData","addPage","toDataURL","addImage","marginsLegend","mapSize","canvasOverlayHTML","mapOverlayHTML","getOverlayContainerStopEvent","OverlayHTMLButtons","OverlayHTMLButtonsarr","OverlayHTMLButton","olCollapsed","allowTaint","addCopyrightToImage","getContext","drawImage","defineNbFileToProcess","nbFileToProcess","ms","getImageSizeToFitPdf","rect","widthPixels","canvases","getViewport","mapStatus$$","mapStatus","renderMap","downloadMapImage","oldCanvas","newCanvas","newContext","positionHCanvas","commentWidth","measureText","positionHProjScale","commentNbLine","positionHComment","fillStyle","fillRect","fillText","projectionScaleText","CommentLengthToCut","positionLastBlank","commentCurrentLine","positionFirstCutChar","addLegendToImage","fileNameWithExt","tfwFileNameWithExt","tiwContent","getWorldFileInformation","addFileToZip","saveAs","saveFileProcessing","renderSync","canvasLegend","canvasHeight","canvasWidth","legendHeight","legendWidth","legendX","legendY","strokeRect","updateSize","save","returnPromise","pageHeight","canHeight","canWidth","heightRatio","widthRatio","maxRatio","currentResolution","nameWithExt","blobFormat","toBlob","zipFile","JSZip","msSaveBlob","msToBlob","getZipFile","generateAsync","PrintFormComponent","outputFormats","paperFormats","orientations","imageFormats","legendPositions","isPrintService","maxLength","imageFormat","imageFormatField","Jpeg","onlySelf","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","handleFormSubmit","toggleImageSaveProp","clearValidators","changeCommentLength","A2","A3","A4","A5","PrintComponent","printService","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","IgoPrintModule","querySearchSourceFactory","IgoQueryModule","DirectionsSource","DirectionsSourceService","directionsSourceServiceFactory","DirectionsFormat","SourceDirectionsType","ProposalType","Coord","DirectionType","Stop","DirectionRelativePositionType","Start","updateStoreSorting","stopsStore","totalLength","relativePosition","Intermediate","End","addStopToStore","stops","positions","stop","maxPosition","insertPosition","stopToUpdate","computeRelativePosition","vertexStyle","stopStyle","routeStyle","formatDistance","formatDuration","formatInstruction","modifier","stepPosition","exit","lastStep","directive","cssClass","translatedDirection","bearing","translateBearing","translatedModifier","translateModifier","aggregatedDirection","coma","cntSuffix","instruction","clearStop","removeStop","onStopEnter","onStopLeave","stop_r1","setStopText","chooseProposal","DirectionsInputsComponent","invalidKeys","onMapClickEventKeys","stopIsDragged","coordRoundedDecimals","unlistenMapSingleClick","stopWithHover","getOptionText","geomCoord","pointOnFeature","validateTerm","keyIsValid","getNgClass","getPlaceholder","extra","computeStopsPosition","stopsToComputePosition","removeStopFromStore","drop","moveStops","previousIndex","currentIndex","fromIndex","moveItemInArray","onInputFocus","stopInputHasFocus","listenMapSingleClick","stopsFeatureStore","roundedCoord","olObservable","DirectionsService","directionsSourceService","directionsOptions","routeSource","sourceCanSearch","sourceCanReverseSearch","reverseSearch","sourceCanReverseSearchAsSummary","str1","str2","computeTermSimilarity","caseSensitive","termFrom","termTo","totalDiff","findDiff","delta","SearchSourceService","getSources","getEnabledSources","enableSourcesByType","SearchService","searchSourceService","termIsValid","getEnabledOnly","searchType","asPointerSummary","reverseSourceFonction","reverseSearchCoordsFormat","reverseSearchSources","resetStops","zoomRoute","copyDirectionsToClipboard","copyLinkToClipboard","DirectionsButtonsComponent","activeRoute","routesFeatureStore","clearStops","addStop","zoomToActiveRoute$","directionsBody","directionsToText","indent","activeRouteDirective","wayPointList","wayPointsCnt","stopText","localCnt","formatStep","maneuver","bearing_after","routingOptions","directionsKey","stopsCoordinates","directionsUrl","pathname","showSegment","onStepsListBlur","DirectionsResultsComponent","activeFeatureWithDirection","directions","activeDirection","changeRoute","stepFeatureStore","showRouteSegmentGeometry","vertexId","lastPoint","geojsonGeom","previousVertex","Vertex","DirectionsComponent","directionsService","searchService","routesQueries$$","focusOnStop","isTranslating","previousStops","searchs$$","initEntityStores","loadingStrategy","directionsStyle","initStopsFeatureStore","initRoutesFeatureStore","initStepFeatureStore","initOlInteraction","storeEmpty$$","storeChange$$","u","zoomRoute$$","freezeStores","selectStopInteraction","translateStop","selectedRoute","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","routeExtent","executeStopTranslation","olCondition","selectCoordinates","addedStop","onStopInputHasFocusChange","translatedStopId","translationCoordinates","translatedStop","storeInitialized$","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","simplifiedStops","stopIdToProcess","changedStop","researches","isCoord","requests$","searchProposals","sp","Text","storedSource","addStopOverlay","stopFeature","isOverview","stopsWithCoordinates","roundedCoordinates","routeResponse","overview","alternatives","continue_straight","previousRoute","routeFeatureStore","addDirectionToRoutesFeatureStore","addStopToStopsFeatureStore","stopColor","previousStop","stopFeatureStore","stopOpacity","IgoDirectionsModule","DragDropModule","searchSourceServiceFactory","IChercheSearchResultFormatter","formatResult","IgoHttpParameterCodec","encodeKey","encodeValue","decodeKey","decodeValue","IChercheSearchSource","formatter","hashtagsLieuxToKeep","getAllowedTypes","title$","ecmax","computeRequestParams","extractResults","typeSetting","typesMatched","computeOptionsParam","q","computeTerm","xMin","yMin","xMax","yMax","encoder","dataToResult","computeProperties","dataType","titleHtml","highlight","title2","title3","score","nextPage","propertiesBlacklist","googleLinksProperties","GoogleMaps","googleMaps","googleMapsNom","getGoogleMapsCoordLink","getGoogleMapsNameLink","municipalite","GoogleStreetView","getGoogleStreetViewLink","routing","keep","IChercheReverseSearchSource","getSubtitle","computeExtent","subtitleHtml","pointerSummaryTitle","defaultIChercheSearchResultFormatterFactory","ichercheReverseSearchSourceFactory","CoordinatesSearchResultFormatter","CoordinatesReverseSearchSource","reverseSearchCoordsFormatEnabled","dataDMS","rawCoord3857","convertedLonLat","igo2CoordFormat","utmZoneFromLonLat","utmName","rawCoordUtm","mtmZoneFromLonLat","long","mtmName","rawCoordMtm","rawCoord","numericEpsgCode","lonLatConversion","roundedCoordString","roundedCoordStringDMS","circleGeometry","polygonGeometry","writer","writeGeometry","OpenStreetMap","getOpenStreetMapLink","defaultCoordinatesSearchResultFormatterFactory","CoordinatesReverseSearchSourceFactory","_projectionService","ILayerSearchResultFormatter","allowedKey","dataR","ILayerSearchSource","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","formatOpt","urls","urlOpt","ilayerSearchResultFormatterFactory","ilayerSearchSourceFactory","SEARCH_TYPES","SearchSelectorComponent","searchTypes","setSearchType","searchType$","searchType$$","onSetSearchType","onSearchTypeChange","getSearchTypeTitle","searchTypeChange","IgoSearchSelectorModule","checkUncheckAllSources","checkUncheckAll","setting_r13","changePointerReverseSearch","SearchSettingsComponent","hasPointerReverseSearchSource","searchSourcesAllEnabled","now","displayBlock","pointerSummaryEnabled","searchResultsGeometryEnabled","pointerSummaryStatus","hasReverseSearchSourcesForPointerSummary","getSearchSources","textSearchSources","computeSourcesCheckAllBehavior","settingsValueCheckedCheckbox","settingValue","searchSourceChange","computeSettingCheckAllBehavior","allEnabled","enabledSourcesCnt","disabledSourcesCnt","settingsValueCheckedRadioButton","onCheckSearchSource","storage","getAvailableValues","getAvailableHashtagsValues","changeSearchResultsGeometry","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","IgoSearchSettingsModule","onClearButtonClick","SearchBarComponent","showSearchButton","_reverseSearchCoordsFormatEnabled","appearance","termSplitter","minLength","searchSelector","searchSettings","setTerm","stream$$","stream$","onSetTerm","handlePlaceholder","configValue","onKeyup","clearFeature","onSearchSettingsChange","doSearch","searchSettingsChange","reverseCoordEvent","slug","searchTermChange","ss","placeholder$","rawTerm","terms","researches$$","research","onResearchCompleted","newResults","IgoSearchBarModule","onZoomHandler","SearchResultsItemComponent","withZoomButton","getEntityTitleHtml","titleHtmlProperty","tooltipHtml","hideBtn","showBtn","group_r4","resultFocus","resultUnfocus","Grouped","SearchResultMode","SearchResultsComponent","showResultsCount","searchResultMode","pageIterator","tabsMode","_term","results$","_results$","liftResults","settingsChange$$","settingsChange$","computeGroupTitle","onResultSelect","resultSelect","groupResults","sortByOrder","r1","r2","grouped","sourceResults","stategy","moreResults","layer_r2","SaveFeatureDialogComponent","filteredLayers$","addFeatureToLayer","SearchResultAddButtonComponent","layersSubcriptions","saveSearchResultInLayer","mediaService$$","currEvent","Stroke","Fill","take$1","searchLayer","IgoSearchResultsModule","SearchPointerSummaryDirective","reverseSearch$$","searchPointerSummaryFeatureId","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","pointerPositionSummaryMarkerStyle","ngAfterContentChecked","unsubscribeReverseSearch","pointerSearchStore","entitiesToPointerOverlay","computeSummaryClosestFeature","closestResultByType","summarizedClosestType","processedSummarizedClosestType","typeIndex","addPointerOverlay","onSearchCoordinate","_results","onSearch","pointerSummary","IgoSearchModule","OgcFilterComponent","OgcFilterWidget","ogcFilterWidgetFactory","IgoOgcFilterModule","getCommonVectorSelectedStyle","markerOpacity","fillOpacity","strokeOpacity","getCommonVectorStyle","isOlFeature","markerColorAsArray","markerColorRGB","WfsWorkspace","getLayerWksOptionTabQuery","queryOptions","tabQuery","getLayerWksOptionMapQuery","mapQueryOnOpenTab","getInResolutionRange","mapExtentStrategyActiveToolTip","noElementSelected","addedLayerId","geoServiceProperties","addOrRemoveLayer","WfsWorkspaceService","zoomAuto","createWorkspace","srcId","workspaceId","createFeatureStore","inMapExtentStrategy","geoPropertiesStrategy","inMapResolutionStrategy","confQueryOverlayStyle","createFilterInMapExtentOrResolutionStrategy","geoServiceAction","getGeoServiceAction","relations","columnsFromFeatures","col","relationsColumn","relation","ws$","class_icon","WmsWorkspaceService","BehaviorSubject$1","wmsLinkId","wfsLinkId","linkProperties","hasOgcFilters","clonedLinks","wksLayerOption","workspaceLayer","ConfirmationPopupComponent","cancelAction","confirmedAction","EditionWorkspace","editionWorkspaceService","edit","deleteFeature","deleteUrl","columnName","primary","editFeature","editionOpt","getDomainValues","original_properties","original_geometry","idkey","editFeaturefilterClauseFunc","adding$","newFeaturefilterClauseFunc","addWithDraw","featureOl","createModifyInteraction","olCollection","Collection","modifyStyle","EditionWorkspaceService","wksConfig","rendererType","modifyButton","deleteButton","saveFeature","cancelEdit","cellClass","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","protocole","modifyHeaders","modifyFeature","hasGeometry","projDest","geomDatabaseProj","wktFormat","geoJsonFormat","refreshMap","rowsInMapExtentCheckCondition$","removeZ","relationLayers","relationLayers$","fromSave","wfsOlLayer","wmsOlLayer","_t","FeatureWorkspace","FeatureWorkspaceService","searchStrategy","WorkspaceSelectorDirective","wfsWorkspaceService","wmsWorkspaceService","featureWorkspaceService","workspaceStore","onLayersChange","changeWorkspace","adding","rowsInMapExtentCheckCondition","editableLayers","layerIsEditable","editableLayersIds","workspacesToAdd","getOrCreateWorkspace","workspacesToRemove","wmsWks","IgoWorkspaceUpdatorModule","IgoConfirmationPopupModule","IgoGeoWorkspaceModule","STYLELIST_OPTIONS","provideStyleListOptions","IgoStyleListModule","styleListFactory","IgoStyleModule","StopsStore","StopsFeatureStore","RoutesFeatureStore","StepFeatureStore","OsrmDirectionsSource","_name","directionsParams","getRouteParams","extractRoutesData","formatRoute","waypoints","geometries","roadNetworkRoute","stepsUI","legs","sourceType","weight_name","CadastreSearchSource","endsWith","numero","lot","computeGeometry","NoLot","cadastreSearchSourceFactory","NominatimSearchSource","place_id","display_name","osm_type","boundingbox","computeTermTags","tag","computeTermSettings","nominatimSearchSourceFactory","StoredQueriesSearchSource","storedQueriesOptions","defaultResultTitle","storedquery_id","splitPrefix","outputformat","srsname","resultTitle","multipleFieldsQuery","storedqueriesParams","resultArray","extractWFSData","idxEnd","resultTotLenght","patternGml3","geojson","wfsfeatures","splittedTerm","remainingTerm","splitterRegex","wfsversion","StoredQueriesReverseSearchSource","longField","latField","longLatParams","doc_type","storedqueriesSearchSourceFactory","storedqueriesReverseSearchSourceFactory","WorkspaceSearchSource","limitValue","fswi","termToUse","gettedIndex","sortedResultToProcess","resultsCnt","subtitleHtml2","workspaceSearchSourceFactory","AppSimpleMapRoutingModule","AppSimpleMapComponent","onPointerMove","pointerCoord","AppSimpleMapModule","AppLayerRoutingModule","AppLayerComponent","AppLayerModule","AppLegendRoutingModule","AppLegendComponent","AppLegendModule","AppOverlayRoutingModule","AppOverlayComponent","AppOverlayModule","AppGeometryRoutingModule","AppGeometryComponent","olstyle","AppGeometryModule","AppFeatureRoutingModule","AppFeatureComponent","AppFeatureModule","AppHoverRoutingModule","AppHoverComponent","AppHoverModule","AppMeasureRoutingModule","AppMeasureComponent","AppMeasureModule","AppDrawRoutingModule","AppDrawComponent","AppDrawModule","AppQueryRoutingModule","AppQueryComponent","feature1","olLineString","feature2","feature3","handleQueryResults","AppQueryModule","AppCatalogRoutingModule","AppCatalogComponent","catalogStore","onCatalogSelectChange","catalogItemStore","AppCatalogModule","TypePermission","ContextService","contexts$","ours","importedContext","mapViewFromRoute","basePath","contextListFile","defaultContextUri","readParamsFromRoute","handleContextsChange","loadContexts","_defaultContextUri","permissions","getById","getDetails","getDefault","defaultContextId$","getContextByUri","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","imported","contexts","contextCreated","permission","contextCloned","addToolAssociation","contextId","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","permissionId","getLocalContexts","getLocalContext","urlBase","resBase","resMerge","l2","t2","err2","loadDefaultContext","loadFct","direct","_context","addContextToList","setContext","loadContext","contextParam","context$","handleContextMessage","currentContext","keepCurrentView","loadEditedContext","setEditedContext","editedContext$","getContextFromMap","global","getContextFromLayers","extraFeatures","layerFound","contextLayer","olVectorSource","Cluster","cleanedOlFeatures","catalogLayer","contextToLoad","getContextLayers","mapLayers","permissionError","titleContext","keepCurrentContext","editedContext","findContext","toolsChanged$","editedFound","contextSimplifie","public","found","IgoContextImportExportModule","MapContextDirective","contextService","context$$","handleContextChange","viewContext","controlsContext","scaleLineOption","minWidth","LayerContextDirective","contextLayers","removeLayersOnContextChange","queryParams$$","layersAndIndex$","handleAddLayers","addImportedFeaturesStyledToMap","addImportedFeaturesToMap","computeLayerVisibilityFromUrl","currentLayerid","contextParams","visibleOnLayersParams","visibleOffLayersParams","visiblelayers","invisiblelayers","ContextListControlsEnum","BookmarkDialogComponent","favoriteClick","managePermissions","ContextItemComponent","showFavorite","canShare","favorite","clearFilter","manageTools","ContextListComponent","contextsInitial","shared","showHidden","thresholdToFilter","_contexts","selectedContext","_selectedContext","_defaultContextId","sortedAlpha","filterContextsList","createContext","sortContextsList","updateContexts","publics","showFilter","showContextFilter","contextsList","toggleSort","getPermission","userSelection","indeterminate","childs","parentPermission","childrenPermission","filterPermissionsChanged","ContextListBindingDirective","onEdit","onSave","contextFromMap","msgSuccess","onFavorite","onManageTools","onManagePermissions","onDelete","onClone","onCreate","showHiddenContexts","onShowContext","onHideContext","contexts$$","defaultContextId$$","storedContextUri","selectedContext$$","authenticate","users","profilsAcc","cur","PoiService","IgoContextMapButtonModule","IgoContextManagerModule","ImportExportType","ImportExportMode","ImportExportState","importExportType$","selectedMode$","setImportExportType","setMode","setsExportOptions","ToolState","importExportState","toolToActivateFromOptions","toolToActivate","openSidenav$","MapState","_legendToolShowAll","StorageState","igoStorageService","FeatureActionsService","storageState","toolState","storageChange$$","loadActions","selectOnlyCheckCondition$","buildActions","zoomAuto$","storageChange","handleZoomAuto","filterStrategy","maximize$","WfsActionsService","ogcFilterWidget","EditionActionsService","WorkspaceState","featureActionsService","wfsActionsService","editionActionsService","workspacePanelExpanded","actionMaximize$$","initWorkspaces","workspaceSelection","workspace$","workspaceSelection$","maximized","setWorkspaceIsMaximized","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","rowsInMapExtentCheckCondition$$","rowsInMapExtent","selectOnlyCheckCondition$$","selectOnly","workspaceMaximize$","setActiveWorkspaceById","wksFromId","setActiveWorkspaceByTitle","wksFromTitle","teardownWorkspaces","SearchState","workspaceState","mapState","searchLayerStores","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","searchResultsGeometryEnabled$","createCustomFilterTermStrategy","wksSource","searchableWks","monitorLayerDeletion","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","searchDisabled$","disableSearch","setSearchTerm","searchTerm","searchTerm$","setSearchSettingsChange","searchSettingsChange$","setSelectedResult","selectedResult$","setSearchResultsGeometryStatus","IgoAppSearchBarModule","IgoAppSearchResultsToolModule","IgoAppSearchModule","AppSearchRoutingModule","AppSearchComponent","searchState","osmLayer","igoReverseSearchCoordsFormatEnabled","searchStore","onPointerSummaryStatusChange","onSearchTermChange","onReverseCoordsFormatStatusChange","onResultFocus","tryAddFeatureToMap","searchCoordinate","openGoogleMaps","openGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","contextmenuPoint","mapBrowser","getBoundingClientRect","scrollY","scrollX","ElementRef","AppSearchModule","ichercheSearchSourceFactory","AppPrintRoutingModule","AppPrintComponent","AppPrintModule","AppImportExportRoutingModule","AppImportExportComponent","AppImportExport","AppDirectionsRoutingModule","AppDirectionsComponent","AppDirectionsModule","osrmDirectionsSourcesFactory","AppTimeFilterRoutingModule","AppTimeFilterComponent","AppTimeFilterModule","AppOgcFilterRoutingModule","AppOgcFilterComponent","AppOgcFilterModule","AppSpatialFilterRoutingModule","AppSpatialFilterComponent","olFormatGeoJSON","getOutputType","getOutputQueryType","spatialListStore","getOutputToggleSearch","loadThematics","getOutputClearSearch","clearMap","activeLayers","iterator","zeroResults","tryAddFeaturesToMap","featuresPoint","featuresLinePoly","idPoint","idLinePoly","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_internal","featuresOl","createSvgIcon","pushLayer","xmlSerializer","AppSpatialFilterModule","AppWorkspaceRoutingModule","AppWorkspaceComponent","selectedWorkspace$","workspacePaginator","AppWorkspaceModule","AppContextRoutingModule","AppContextComponent","AppContextModule","HttpClientJsonpModule","redirectTo","pathMatch","AppRoutingModule","useHash","AppComponent","changeDetectorRef","mobileQuery","matchMedia","_mobileQueryListener","themeClass","detectOldBrowser","removeEventListener","defaultTooltipOptions","showDelay","hideDelay","touchendHideDelay","disableTooltipInteractivity","AppModule","bootstrap","appInitializerFactory","ApplicationRef","MAT_TOOLTIP_DEFAULT_OPTIONS","MatSidenavModule","MatToolbarModule","HammerModule","applicationRef","isStable","setTranslation","enableProdMode","__NgCli_bootstrap_1","bootstrapModule","webpackContext","module"],"sourceRoot":"webpack:///","sources":["./packages/utils/src/lib/base64.ts","./packages/utils/src/lib/user-agent.ts","./packages/utils/src/lib/clipboard.ts","./packages/utils/src/lib/string-utils.ts","./packages/utils/src/lib/change.interface.ts","./packages/utils/src/lib/change.ts","./packages/utils/src/lib/object-utils.ts","./packages/utils/src/lib/number-utils.ts","./packages/utils/src/lib/strenum.ts","./packages/utils/src/lib/uuid.ts","./packages/utils/src/lib/watcher.ts","./packages/core/src/lib/activity/activity.service.ts","./packages/core/src/lib/activity/activity.interceptor.ts","./packages/core/src/lib/activity/activity.module.ts","./packages/core/src/lib/config/version.ts","./packages/core/src/lib/config/config.service.ts","./packages/core/src/lib/config/config.provider.ts","./packages/core/src/lib/config/config.module.ts","./packages/core/src/lib/language/shared/language.loader.ts","./packages/core/src/lib/language/shared/language.provider.ts","./packages/core/src/lib/language/shared/missing-translation.guard.ts","./packages/core/src/lib/language/language.module.ts","./packages/core/src/lib/message/message.module.ts","./packages/core/src/lib/message/shared/message.enum.ts","./packages/core/src/lib/language/shared/language.service.ts","./packages/core/src/lib/message/shared/message.service.ts","./packages/core/src/lib/request/error.interceptor.ts","./packages/core/src/lib/request/error.module.ts","./packages/core/src/lib/core.module.ts","./packages/core/src/lib/route/route.service.ts","./packages/core/src/lib/media/media.enum.ts","./packages/core/src/lib/media/media.service.ts","./packages/core/src/lib/storage/storage.interface.ts","./packages/core/src/lib/storage/storage.service.ts","./packages/core/src/lib/compression/compression.service.ts","./packages/core/src/lib/network/network.service.ts","./packages/core/src/lib/regex/regex.service.ts","./packages/common/src/lib/entity/shared/entity.enums.ts","./packages/common/src/lib/entity/shared/entity.utils.ts","./packages/common/src/lib/entity/shared/state.ts","./packages/common/src/lib/entity/shared/view.ts","./packages/common/src/lib/entity/shared/store.ts","./packages/common/src/lib/entity/shared/watcher.ts","./packages/common/src/lib/entity/shared/strategies/strategy.ts","./packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","./packages/common/src/lib/entity/shared/strategies/filter-selection.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.component.html","./packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","./packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","./packages/common/src/lib/image/image-error.directive.ts","./packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","./packages/common/src/lib/custom-html/custom-html.pipe.ts","./packages/common/src/lib/image/secure-image.pipe.ts","./packages/common/src/lib/entity/entity-table/entity-table.component.html","./packages/common/src/lib/entity/entity-table/entity-table.component.ts","./packages/common/src/lib/action/shared/action.enums.ts","./packages/common/src/lib/action/actionbar/actionbar-item.component.html","./packages/common/src/lib/action/actionbar/actionbar-item.component.ts","./packages/common/src/lib/action/actionbar/actionbar.component.html","./packages/common/src/lib/action/actionbar/actionbar.component.ts","./packages/common/src/lib/action/actionbar/actionbar.module.ts","./packages/common/src/lib/action/action.module.ts","./packages/common/src/lib/badge-icon/badge-icon.directive.ts","./packages/common/src/lib/badge-icon/badge-icon.module.ts","./packages/common/src/lib/clickout/clickout.directive.ts","./packages/common/src/lib/clickout/clickout.module.ts","./packages/common/src/lib/collapsible/collapse.directive.ts","./packages/common/src/lib/collapsible/collapsible.component.ts","./packages/common/src/lib/collapsible/collapsible.component.html","./packages/common/src/lib/collapsible/collapsible.module.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","./packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","./packages/common/src/lib/context-menu/context-menu.directive.ts","./packages/common/src/lib/context-menu/long-press.directive.ts","./packages/common/src/lib/context-menu/context-menu.module.ts","./packages/common/src/lib/custom-html/custom-html.component.ts","./packages/common/src/lib/custom-html/custom-html.component.html","./packages/common/src/lib/custom-html/custom-html.module.ts","./packages/common/src/lib/dom/dom.service.ts","./packages/common/src/lib/dom/dom.module.ts","./packages/common/src/lib/drag-drop/drag-drop.module.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","./packages/common/src/lib/dynamic-component/dynamic-component.module.ts","./packages/common/src/lib/flexible/flexible.module.ts","./packages/common/src/lib/form/form/form.component.ts","./packages/common/src/lib/form/shared/form.utils.ts","./packages/common/src/lib/form/form/form.component.html","./packages/common/src/lib/form/form/form.module.ts","./packages/common/src/lib/form/shared/form.service.ts","./packages/common/src/lib/form/shared/form-field.service.ts","./packages/common/src/lib/form/form-field/form-field.component.html","./packages/common/src/lib/form/form-field/form-field.component.ts","./packages/common/src/lib/form/form-field/form-field.module.ts","./packages/common/src/lib/form/form-group/form-group.component.html","./packages/common/src/lib/form/form-group/form-group.component.ts","./packages/common/src/lib/form/form-group/form-group.module.ts","./packages/common/src/lib/form/form.module.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","./packages/common/src/lib/stop-propagation/stop-propagation.module.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","./packages/common/src/lib/image/image.module.ts","./packages/common/src/lib/entity/entity-table/entity-table.module.ts","./packages/common/src/lib/entity/entity.module.ts","./packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","./packages/common/src/lib/interactive-tour/interactive-tour.service.ts","./packages/common/src/lib/tool/shared/toolbox.ts","./packages/common/src/lib/tool/shared/tool.service.ts","./packages/common/src/lib/interactive-tour/interactive-tour.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.ts","./packages/common/src/lib/interactive-tour/interactive-tour.module.ts","./packages/common/src/lib/keyvalue/keyvalue.pipe.ts","./packages/common/src/lib/keyvalue/keyvalue.module.ts","./packages/common/src/lib/list/list-item.directive.ts","./packages/common/src/lib/list/list.component.ts","./packages/common/src/lib/list/list.component.html","./packages/common/src/lib/list/list.module.ts","./packages/common/src/lib/panel/panel.component.html","./packages/common/src/lib/panel/panel.component.ts","./packages/common/src/lib/panel/panel.module.ts","./packages/common/src/lib/spinner/spinner.component.ts","./packages/common/src/lib/spinner/spinner.component.html","./packages/common/src/lib/spinner/spinner-activity.directive.ts","./packages/common/src/lib/spinner/spinner.module.ts","./packages/common/src/lib/table/table-datasource.ts","./packages/common/src/lib/table/table-action-color.enum.ts","./packages/common/src/lib/table/table.component.html","./packages/common/src/lib/table/table.component.ts","./packages/common/src/lib/table/table.module.ts","./packages/common/src/lib/action/shared/store.ts","./packages/common/src/lib/tool/shared/toolbox.enums.ts","./packages/common/src/lib/tool/toolbox/toolbox.animation.ts","./packages/common/src/lib/tool/toolbox/toolbox.component.html","./packages/common/src/lib/tool/toolbox/toolbox.component.ts","./packages/common/src/lib/tool/toolbox/toolbox.module.ts","./packages/common/src/lib/tool/tool.module.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","./packages/common/src/lib/widget/shared/widget.service.ts","./packages/common/src/lib/widget/widget.module.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","./packages/common/src/lib/workspace/workspace.module.ts","./packages/common/src/lib/table/table-database.ts","./packages/common/src/lib/tool/shared/tool-component.ts","./packages/common/src/lib/workspace/shared/store.ts","./packages/common/src/lib/workspace/shared/workspace.ts","./demo/src/app/core/home/home-routing.module.ts","./demo/src/app/core/home/home.component.ts","./demo/src/app/core/home/home.component.html","./demo/src/app/core/home/home.module.ts","./demo/src/app/core/activity/activity-routing.module.ts","./demo/src/app/core/activity/activity.component.ts","./demo/src/app/core/activity/activity.component.html","./demo/src/app/core/activity/activity.module.ts","./demo/src/environments/environment.prod.ts","./demo/src/app/core/config/config-routing.module.ts","./demo/src/app/core/config/config.component.ts","./demo/src/app/core/config/config.component.html","./demo/src/app/core/config/config.module.ts","./demo/src/app/core/language/language-routing.module.ts","./demo/src/app/core/language/language.component.ts","./demo/src/app/core/language/language.component.html","./demo/src/app/core/language/language.module.ts","./demo/src/app/core/media/media-routing.module.ts","./demo/src/app/core/media/media.component.ts","./demo/src/app/core/media/media.component.html","./demo/src/app/core/media/media.module.ts","./demo/src/app/core/message/message-routing.module.ts","./demo/src/app/core/message/message.component.ts","./demo/src/app/core/message/message.component.html","./demo/src/app/core/message/message.module.ts","./demo/src/app/core/request/request-routing.module.ts","./demo/src/app/core/request/request.component.ts","./demo/src/app/core/request/request.component.html","./demo/src/app/core/request/request.module.ts","./demo/src/app/common/action/action.component.html","./demo/src/app/common/action/action-routing.module.ts","./demo/src/app/common/action/action.component.ts","./demo/src/app/common/action/action.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.ts","./demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.html","./demo/src/app/common/dynamic-component/dynamic-component.module.ts","./demo/src/app/common/entity-table/entity-table-routing.module.ts","./demo/src/app/common/entity-table/entity-table.component.ts","./demo/src/app/common/entity-table/entity-table.component.html","./demo/src/app/common/entity-table/entity-table.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.html","./demo/src/app/common/entity-selector/entity-selector-routing.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.ts","./demo/src/app/common/entity-selector/entity-selector.module.ts","./demo/src/app/common/form/form.component.html","./demo/src/app/common/form/form-routing.module.ts","./demo/src/app/common/form/form.component.ts","./demo/src/app/common/form/form.module.ts","./demo/src/app/common/table/table-routing.module.ts","./demo/src/app/common/table/table.component.ts","./demo/src/app/common/table/table.component.html","./demo/src/app/common/table/table.module.ts","./demo/src/app/common/tool/tool.component.html","./demo/src/app/common/tool/tool.component.ts","./demo/src/app/common/tool/tool-routing.module.ts","./demo/src/app/common/tool/tool.module.ts","./demo/src/app/common/widget/widget.component.ts","./demo/src/app/common/widget/widget-routing.module.ts","./demo/src/app/common/widget/widget.component.html","./demo/src/app/common/widget/widget.module.ts","./packages/auth/src/lib/shared/token.service.ts","./packages/auth/src/lib/shared/auth.service.ts","./packages/auth/src/lib/auth-form/auth-google.component.ts","./packages/auth/src/lib/auth-form/auth-google.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.html","./packages/auth/src/lib/auth-form/auth-microsoft.component.ts","./packages/auth/src/lib/auth-form/auth-microsoft.component.html","./packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","./packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","./packages/auth/src/lib/auth-form/auth-form.component.html","./packages/auth/src/lib/auth-form/auth-form.component.ts","./packages/auth/src/lib/shared/auth.interceptor.ts","./packages/auth/src/lib/shared/auth-microsoft.provider.ts","./packages/auth/src/lib/shared/storage.service.ts","./packages/auth/src/lib/auth.module.ts","./demo/src/app/auth/auth-form/auth-form-routing.module.ts","./demo/src/app/auth/auth-form/auth-form.component.ts","./demo/src/app/auth/auth-form/auth-form.component.html","./demo/src/app/auth/auth-form/auth-form.module.ts","./packages/geo/src/lib/metadata/shared/metadata.service.ts","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","./packages/geo/src/lib/metadata/metadata.module.ts","./packages/geo/src/lib/map/shared/map.utils.ts","./packages/geo/src/lib/layer/shared/layers/layer.ts","./packages/geo/src/lib/layer/shared/layers/layer.interface.ts","./packages/geo/src/lib/layer/utils/image-watcher.ts","./packages/geo/src/lib/layer/utils/layer.utils.ts","./packages/geo/src/lib/layer/utils/tile-watcher.ts","./packages/geo/src/lib/utils/id-generator.ts","./packages/geo/src/lib/datasource/shared/datasources/datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","./packages/geo/src/lib/layer/utils/vector-watcher.ts","./packages/geo/src/lib/layer/shared/layers/image-layer.ts","./packages/geo/src/lib/layer/shared/layers/tile-layer.ts","./packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","./packages/geo/src/lib/filter/shared/ogc-filter.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.enums.ts","./packages/geo/src/lib/layer/shared/layers/vector-layer.ts","./packages/geo/src/lib/style/shared/vector/conversion.utils.ts","./packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","./packages/geo/src/lib/feature/shared/feature.enums.ts","./packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","./packages/geo/src/lib/datasource/shared/datasources/data.service.ts","./packages/geo/src/lib/query/shared/query.enums.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","./packages/geo/src/lib/datasource/utils/tilegrid.ts","./packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","./packages/geo/src/lib/style/shared/datasource/esri-style-generator.ts","./packages/geo/src/lib/filter/shared/time-filter.enum.ts","./packages/geo/src/lib/map/shared/map.service.ts","./packages/geo/src/lib/datasource/shared/capabilities.service.ts","./packages/geo/src/lib/datasource/shared/options/options.service.ts","./packages/geo/src/lib/map/shared/projection.service.ts","./packages/geo/src/lib/datasource/shared/datasource.service.ts","./packages/geo/src/lib/feature/shared/feature.utils.ts","./packages/geo/src/lib/feature/shared/store.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","./packages/geo/src/lib/feature/shared/strategies/geo-properties.ts","./packages/geo/src/lib/feature/shared/strategies/loading.ts","./packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","./packages/geo/src/lib/feature/shared/strategies/selection.ts","./packages/geo/src/lib/feature/shared/strategies/search.ts","./packages/geo/src/lib/feature/shared/strategies.utils.ts","./packages/geo/src/lib/style/shared/overlay/overlay-marker-style.utils.ts","./packages/geo/src/lib/style/style-service/style.service.ts","./packages/geo/src/lib/style/shared/overlay/overlay-style.utils.ts","./packages/geo/src/lib/overlay/shared/overlay.ts","./packages/geo/src/lib/overlay/shared/overlay.utils.ts","./packages/geo/src/lib/map/utils/layer-watcher.ts","./packages/geo/src/lib/map/shared/map.enums.ts","./packages/geo/src/lib/map/shared/controllers/controller.ts","./packages/geo/src/lib/map/shared/controllers/view.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.ts","./packages/geo/src/lib/map/shared/linkedLayers.utils.ts","./packages/geo/src/lib/map/shared/map.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.html","./packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","./packages/geo/src/lib/style/shared/feature/feature-style.ts","./packages/geo/src/lib/map/shared/hover-feature.directive.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","./packages/geo/src/lib/offline/geoDB/geoDB.service.ts","./packages/geo/src/lib/offline/shared/geo-network.service.ts","./packages/geo/src/lib/offline/layerDB/layerDB.service.ts","./packages/geo/src/lib/layer/shared/layer.service.ts","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","./packages/geo/src/lib/map/rotation-button/rotation-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","./packages/geo/src/lib/map/info-section/info-section.component.html","./packages/geo/src/lib/map/info-section/info-section.component.ts","./packages/geo/src/lib/catalog/shared/catalog.enum.ts","./packages/geo/src/lib/catalog/shared/catalog.abstract.ts","./packages/geo/src/lib/query/shared/query.service.ts","./packages/geo/src/lib/query/shared/query.utils.ts","./packages/geo/src/lib/query/shared/query.directive.ts","./packages/geo/src/lib/search/shared/sources/source.ts","./packages/geo/src/lib/query/shared/query-search-source.ts","./packages/geo/src/lib/utils/googleLinks.ts","./packages/geo/src/lib/utils/osmLinks.ts","./packages/geo/src/lib/utils/propertyTypeDetector/propertyTypeDetector.service.ts","./packages/geo/src/lib/catalog/shared/catalog.service.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","./packages/geo/src/lib/layer/layer-item/layer-item.component.html","./packages/geo/src/lib/layer/layer-item/layer-item.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","./packages/geo/src/lib/layer/layer-list/layer-list.component.html","./packages/geo/src/lib/layer/layer-list/layer-list.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","./packages/geo/src/lib/layer/layer.module.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","./packages/geo/src/lib/catalog/catalog.module.ts","./packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","./packages/geo/src/lib/filter/shared/time-filter.service.ts","./packages/geo/src/lib/filter/shared/ogc-filter.service.ts","./packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","./packages/geo/src/lib/filter/shared/spatial-filter.service.ts","./packages/geo/src/lib/download/shared/download.service.ts","./packages/geo/src/lib/download/download-button/download-button.component.html","./packages/geo/src/lib/download/download-button/download-button.component.ts","./packages/geo/src/lib/download/download.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.component.html","./packages/geo/src/lib/feature/feature-details/feature-details.component.ts","./packages/geo/src/lib/draw/shared/draw.enum.ts","./packages/geo/src/lib/style/shared/font.enum.ts","./packages/geo/src/lib/geometry/shared/geometry.utils.ts","./packages/geo/src/lib/geometry/shared/geometry.errors.ts","./packages/geo/src/lib/geometry/shared/controls/draw.ts","./packages/geo/src/lib/measure/shared/measure.enum.ts","./packages/geo/src/lib/measure/shared/measure.utils.ts","./packages/geo/src/lib/draw/shared/draw.utils.ts","./packages/geo/src/lib/draw/draw/draw-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","./packages/geo/src/lib/style/style-service/draw-style.service.ts","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.html","./packages/geo/src/lib/draw/shared/draw-icon.service.ts","./packages/geo/src/lib/draw/draw/draw.component.html","./packages/geo/src/lib/draw/draw/draw.component.ts","./packages/geo/src/lib/draw/draw/draw.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.module.ts","./packages/geo/src/lib/feature/feature-form/feature-form.module.ts","./packages/geo/src/lib/feature/feature.module.ts","./packages/geo/src/lib/geometry/shared/controls/modify.ts","./packages/geo/src/lib/layer/shared/layer.enums.ts","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","./packages/geo/src/lib/measure/measurer/measurer.component.html","./packages/geo/src/lib/measure/measurer/measurer.component.ts","./packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","./packages/geo/src/lib/geometry/geometry.module.ts","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","./packages/geo/src/lib/wkt/shared/wkt.service.ts","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","./packages/geo/src/lib/filter/filter.module.ts","./packages/geo/src/lib/import-export/shared/export.errors.ts","./packages/geo/src/lib/import-export/shared/export.type.ts","./packages/geo/src/lib/import-export/shared/export.service.ts","./packages/utils/src/lib/file.ts","./packages/geo/src/lib/import-export/shared/import.utils.ts","./packages/geo/src/lib/import-export/shared/import.errors.ts","./packages/geo/src/lib/import-export/shared/import.service.ts","./packages/geo/src/lib/style/style-list/style-list.service.ts","./packages/geo/src/lib/import-export/import-export/import-export.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.ts","./packages/geo/src/lib/map/shared/projection.utils.ts","./packages/geo/src/lib/import-export/shared/export.utils.ts","./packages/geo/src/lib/import-export/import-export.module.ts","./packages/geo/src/lib/map/map.module.ts","./packages/geo/src/lib/measure/measurer/measurer-item.component.html","./packages/geo/src/lib/measure/measurer/measurer-item.component.ts","./packages/geo/src/lib/measure/measurer/measurer.module.ts","./packages/geo/src/lib/measure/measure.module.ts","./packages/geo/src/lib/overlay/shared/overlay.enum.ts","./packages/geo/src/lib/overlay/shared/overlay.service.ts","./packages/geo/src/lib/overlay/shared/overlay.directive.ts","./packages/geo/src/lib/overlay/overlay.module.ts","./packages/geo/src/lib/print/shared/geopdf.ts","./packages/geo/src/lib/print/shared/print.type.ts","./packages/geo/src/lib/print/shared/print.service.ts","./packages/geo/src/lib/layer/utils/outputLegend.ts","./packages/geo/src/lib/print/print-form/print-form.component.html","./packages/geo/src/lib/print/print-form/print-form.component.ts","./packages/geo/src/lib/print/print/print.component.ts","./packages/geo/src/lib/print/print/print.component.html","./packages/geo/src/lib/print/print.module.ts","./packages/geo/src/lib/query/shared/query-search-source.providers.ts","./packages/geo/src/lib/query/query.module.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.ts","./packages/geo/src/lib/directions/shared/directions-source.service.ts","./packages/geo/src/lib/directions/shared/directions.enum.ts","./packages/geo/src/lib/directions/shared/directions.utils.ts","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","./packages/geo/src/lib/directions/shared/directions.service.ts","./packages/geo/src/lib/search/shared/search.utils.ts","./packages/geo/src/lib/search/shared/search-source.service.ts","./packages/geo/src/lib/search/shared/search.service.ts","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","./packages/geo/src/lib/directions/directions-results/directions-results.component.html","./packages/geo/src/lib/directions/directions-results/directions-results.component.ts","./packages/geo/src/lib/directions/directions.component.ts","./packages/geo/src/lib/directions/directions.component.html","./packages/geo/src/lib/directions/directions.module.ts","./packages/geo/src/lib/search/shared/search-source-service.providers.ts","./packages/geo/src/lib/search/shared/sources/icherche.ts","./packages/geo/src/lib/search/shared/sources/icherche.providers.ts","./packages/geo/src/lib/search/shared/sources/coordinates.ts","./packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","./packages/geo/src/lib/search/shared/sources/ilayer.ts","./packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","./packages/geo/src/lib/search/shared/search.enums.ts","./packages/geo/src/lib/search/search-selector/search-selector.component.html","./packages/geo/src/lib/search/search-selector/search-selector.component.ts","./packages/geo/src/lib/search/search-selector/search-selector.module.ts","./packages/geo/src/lib/search/search-settings/search-settings.component.html","./packages/geo/src/lib/search/search-settings/search-settings.component.ts","./packages/geo/src/lib/search/search-settings/search-settings.module.ts","./packages/geo/src/lib/search/search-bar/search-bar.component.html","./packages/geo/src/lib/search/search-bar/search-bar.component.ts","./packages/geo/src/lib/search/search-bar/search-bar.module.ts","./packages/geo/src/lib/search/search-results/search-results-item.component.html","./packages/geo/src/lib/search/search-results/search-results-item.component.ts","./packages/geo/src/lib/search/search-results/search-results.component.html","./packages/geo/src/lib/search/search-results/search-results.component.ts","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.html","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.ts","./packages/geo/src/lib/search/search-results/search-results-add-button.component.html","./packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","./packages/geo/src/lib/search/search-results/search-results.module.ts","./packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","./packages/geo/src/lib/search/search.module.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","./packages/geo/src/lib/workspace/widgets/widgets.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","./packages/geo/src/lib/style/shared/vector/commonVectorStyle.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.ts","./packages/geo/src/lib/workspace/shared/workspace.utils.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","./packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","./packages/geo/src/lib/workspace/shared/edition-workspace.ts","./packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","./packages/geo/src/lib/workspace/workspace.module.ts","./packages/geo/src/lib/style/style-list/style-list.provider.ts","./packages/geo/src/lib/style/style-list/style-list.module.ts","./packages/geo/src/lib/style/style.module.ts","./packages/geo/src/lib/directions/shared/store.ts","./packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","./packages/geo/src/lib/search/shared/sources/cadastre.ts","./packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","./packages/geo/src/lib/search/shared/sources/nominatim.ts","./packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","./packages/geo/src/lib/search/shared/sources/workspace.ts","./packages/geo/src/lib/search/shared/sources/workspace.providers.ts","./demo/src/app/geo/simple-map/simple-map.component.html","./demo/src/app/geo/simple-map/simple-map-routing.module.ts","./demo/src/app/geo/simple-map/simple-map.component.ts","./demo/src/app/geo/simple-map/simple-map.module.ts","./demo/src/app/geo/layer/layer.component.html","./demo/src/app/geo/layer/layer-routing.module.ts","./demo/src/app/geo/layer/layer.component.ts","./demo/src/app/geo/layer/layer.module.ts","./demo/src/app/geo/legend/legend-routing.module.ts","./demo/src/app/geo/legend/legend.component.ts","./demo/src/app/geo/legend/legend.component.html","./demo/src/app/geo/legend/legend.module.ts","./demo/src/app/geo/overlay/overlay-routing.module.ts","./demo/src/app/geo/overlay/overlay.component.ts","./demo/src/app/geo/overlay/overlay.component.html","./demo/src/app/geo/overlay/overlay.module.ts","./demo/src/app/geo/geometry/geometry.component.html","./demo/src/app/geo/geometry/geometry-routing.module.ts","./demo/src/app/geo/geometry/geometry.component.ts","./demo/src/app/geo/geometry/geometry.module.ts","./demo/src/app/geo/feature/feature-routing.module.ts","./demo/src/app/geo/feature/feature.component.ts","./demo/src/app/geo/feature/feature.component.html","./demo/src/app/geo/feature/feature.module.ts","./demo/src/app/geo/hover/hover-routing.module.ts","./demo/src/app/geo/hover/hover.component.ts","./demo/src/app/geo/hover/hover.component.html","./demo/src/app/geo/hover/hover.module.ts","./demo/src/app/geo/measure/measure-routing.module.ts","./demo/src/app/geo/measure/measure.component.ts","./demo/src/app/geo/measure/measure.component.html","./demo/src/app/geo/measure/measure.module.ts","./demo/src/app/geo/draw/draw-routing.module.ts","./demo/src/app/geo/draw/draw.component.ts","./demo/src/app/geo/draw/draw.component.html","./demo/src/app/geo/draw/draw.module.ts","./demo/src/app/geo/query/query.component.html","./demo/src/app/geo/query/query-routing.module.ts","./demo/src/app/geo/query/query.component.ts","./demo/src/app/geo/query/query.module.ts","./demo/src/app/geo/catalog/catalog-routing.module.ts","./demo/src/app/geo/catalog/catalog.component.ts","./demo/src/app/geo/catalog/catalog.component.html","./demo/src/app/geo/catalog/catalog.module.ts","./packages/context/src/lib/context-import-export/shared/context-export.errors.ts","./packages/context/src/lib/context-import-export/shared/context-import.errors.ts","./packages/context/src/lib/context-manager/shared/context.enum.ts","./packages/context/src/lib/context-manager/shared/context.service.ts","./packages/context/src/lib/context-import-export/context-import-export.module.ts","./packages/context/src/lib/context-manager/shared/map-context.directive.ts","./packages/context/src/lib/context-manager/shared/layer-context.directive.ts","./packages/context/src/lib/context-import-export/shared/context-import.utils.ts","./packages/context/src/lib/context-manager/context-list/context-list.enum.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.ts","./packages/context/src/lib/context-manager/context-list/context-list.component.html","./packages/context/src/lib/context-manager/context-list/context-list.component.ts","./packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","./packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","./packages/context/src/lib/context-map-button/context-map-button.module.ts","./packages/context/src/lib/context-manager/context-manager.module.ts","./packages/integration/src/lib/import-export/import-export.state.ts","./packages/integration/src/lib/tool/tool.state.ts","./packages/integration/src/lib/map/map.state.ts","./packages/integration/src/lib/workspace/shared/workspace.utils.ts","./packages/integration/src/lib/storage/storage.state.ts","./packages/integration/src/lib/workspace/shared/feature-actions.service.ts","./packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","./packages/integration/src/lib/workspace/shared/edition-actions.service.ts","./packages/integration/src/lib/workspace/workspace.state.ts","./packages/integration/src/lib/search/search.state.ts","./packages/integration/src/lib/search/search-bar/search-bar.module.ts","./packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","./packages/integration/src/lib/search/search.module.ts","./demo/src/app/geo/search/search.component.html","./demo/src/app/geo/search/search-routing.module.ts","./demo/src/app/geo/search/search.component.ts","./demo/src/app/geo/search/search.module.ts","./demo/src/app/geo/print/print-routing.module.ts","./demo/src/app/geo/print/print.component.ts","./demo/src/app/geo/print/print.component.html","./demo/src/app/geo/print/print.module.ts","./demo/src/app/geo/import-export/import-export-routing.module.ts","./demo/src/app/geo/import-export/import-export.component.ts","./demo/src/app/geo/import-export/import-export.component.html","./demo/src/app/geo/import-export/import-export.module.ts","./demo/src/app/geo/directions/directions-routing.module.ts","./demo/src/app/geo/directions/directions.component.ts","./demo/src/app/geo/directions/directions.component.html","./demo/src/app/geo/directions/directions.module.ts","./demo/src/app/geo/time-filter/time-filter-routing.module.ts","./demo/src/app/geo/time-filter/time-filter.component.ts","./demo/src/app/geo/time-filter/time-filter.component.html","./demo/src/app/geo/time-filter/time-filter.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.html","./demo/src/app/geo/ogc-filter/ogc-filter.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.html","./demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.ts","./demo/src/app/geo/spatial-filter/spatial-filter.module.ts","./demo/src/app/geo/workspace/workspace.component.html","./demo/src/app/geo/workspace/workspace-routing.module.ts","./demo/src/app/geo/workspace/workspace.component.ts","./demo/src/app/geo/workspace/workspace.module.ts","./demo/src/app/context/context/context.component.html","./demo/src/app/context/context/context-routing.module.ts","./demo/src/app/context/context/context.component.ts","./demo/src/app/context/context/context.module.ts","./demo/src/app/app-routing.module.ts","./demo/src/app/app.component.ts","./demo/src/app/app.component.html","./demo/src/app/app.module.ts","./demo/src/main.ts","./node_modules/moment/locale/ sync ^\\.\\/.*$"],"sourcesContent":["/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - s.length % 3;\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import * as Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n          ? (i = slen) // stop after the first found substring\n          : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","import { StringUtils } from './string-utils';\nimport { GroupingChanges, ChangeType } from './change.interface';\n\nexport class ChangeUtils {\n  static findChanges(\n    obj1: any[],\n    obj2: any[],\n    ignoreKeys: string[] = []\n  ): GroupingChanges {\n    const items: GroupingChanges = {\n      added: [],\n      deleted: [],\n      modified: []\n    };\n\n    if (!obj1 || !obj2) {\n      return items;\n    }\n\n    const obj1Clone: any = [...obj1];\n    const obj2Clone: any = [...obj2];\n\n    for (const fromItem of obj1Clone) {\n      const index = obj2Clone.findIndex(s => s.id === fromItem.id);\n\n      if (index === -1) {\n        items.deleted.push({\n          change: { type: ChangeType.DELETED },\n          value: fromItem\n        });\n        continue;\n      }\n\n      const toItem = obj2Clone.splice(index, 1)[0];\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n      const keysChanged = ChangeUtils.compareObject(\n        fromItemClone,\n        toItemClone,\n        undefined,\n        ignoreKeys\n      );\n\n      if (keysChanged.length) {\n        items.modified.push({\n          change: {\n            type: ChangeType.MODIFIED,\n            keysChanged\n          },\n          value: fromItemClone,\n          oldValue: fromItem,\n          newValue: toItem\n        });\n      }\n    }\n\n    items.added = obj2Clone.map(itemAdded => {\n      return {\n        change: { type: ChangeType.ADDED },\n        value: itemAdded\n      };\n    });\n\n    return items;\n  }\n\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n    const keys: any = new Set([\n      ...Object.keys(fromItem),\n      ...Object.keys(toItem)\n    ]);\n    let keysChanged = [];\n    keys.forEach(key => {\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\n      if (ignoreKeys.indexOf(keyString) !== -1) {\n        return;\n      }\n\n      if (Array.isArray(fromItem[key])) {\n        fromItem[key] = fromItem[key].join(',<br>');\n      }\n      if (Array.isArray(toItem[key])) {\n        toItem[key] = toItem[key].join(',<br>');\n      }\n\n      if (\n        typeof fromItem[key] === 'object' &&\n        typeof toItem[key] === 'object' &&\n        fromItem[key] !== null &&\n        toItem[key] !== null\n      ) {\n        keysChanged = keysChanged.concat(\n          this.compareObject(fromItem[key], toItem[key], keyString)\n        );\n      } else {\n        if (fromItem[key] !== toItem[key]) {\n          keysChanged.push({\n            key: keyString,\n            oldValue: fromItemClone[key],\n            newValue: toItemClone[key]\n          });\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\n        }\n      }\n    });\n\n    return keysChanged;\n  }\n}\n","export class ObjectUtils {\n  static resolve(obj: object, key: string): any {\n    const keysArray = key\n      .replace(/\\[/g, '.')\n      .replace(/\\]/g, '')\n      .split('.');\n    let current = obj;\n    while (keysArray.length) {\n      if (typeof current !== 'object') {\n        return undefined;\n      }\n      current = current[keysArray.shift()];\n    }\n\n    return current;\n  }\n\n  static isObject(item: object) {\n    return (\n      item &&\n      typeof item === 'object' &&\n      !Array.isArray(item) &&\n      item !== null &&\n      !(item instanceof Date)\n    );\n  }\n\n  static mergeDeep(\n    target: object,\n    source: object,\n    ignoreUndefined = false\n  ): any {\n    const output = Object.assign({}, target);\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\n      Object.keys(source)\n        .filter(key => !ignoreUndefined || source[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(source[key])) {\n            if (!(key in target)) {\n              Object.assign(output, { [key]: source[key] });\n            } else {\n              output[key] = ObjectUtils.mergeDeep(\n                target[key],\n                source[key],\n                ignoreUndefined\n              );\n            }\n          } else {\n            Object.assign(output, { [key]: source[key] });\n          }\n        });\n    }\n    return output;\n  }\n\n  static copyDeep(src): any {\n    const target = Array.isArray(src) ? [] : {};\n    for (const prop in src) {\n      if (src.hasOwnProperty(prop)) {\n        const value = src[prop];\n        if (value && typeof value === 'object') {\n          target[prop] = this.copyDeep(value);\n        } else {\n          target[prop] = value;\n        }\n      }\n    }\n    return target;\n  }\n\n  static removeDuplicateCaseInsensitive(obj: object) {\n    const summaryCapitalizeObject = {};\n    const capitalizeObject = {};\n    const upperCaseCount = [];\n\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        const upperCaseProperty = property.toUpperCase();\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\n          summaryCapitalizeObject[upperCaseProperty] = [\n            { [property]: obj[property] }\n          ];\n        } else {\n          summaryCapitalizeObject[upperCaseProperty].push({\n            [property]: obj[property]\n          });\n        }\n        // counting the number of uppercase lettersMna\n        upperCaseCount.push({\n          key: property,\n          count: property.replace(/[^A-Z]/g, '').length\n        });\n      }\n    }\n    for (const capitalizedProperty in summaryCapitalizeObject) {\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n          const capitalizedPropertyObject =\n            summaryCapitalizeObject[capitalizedProperty];\n          if (capitalizedPropertyObject.length === 1) {\n            // for single params (no duplicates)\n            const singlePossibility = capitalizedPropertyObject[0];\n            capitalizeObject[capitalizedProperty] =\n              singlePossibility[Object.keys(singlePossibility)[0]];\n          } else if (capitalizedPropertyObject.length > 1) {\n            // defining the closest to lowercase property\n            const paramClosestToLowercase = upperCaseCount\n              .filter(\n                f => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\n              )\n              .reduce((prev, current) => {\n                return prev.y < current.y ? prev : current;\n              });\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\n              obj[paramClosestToLowercase.key];\n          }\n        }\n      }\n    }\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        delete obj[property];\n      }\n    }\n\n    for (const property in capitalizeObject) {\n      if (capitalizeObject.hasOwnProperty(property)) {\n        obj[property] = capitalizeObject[property];\n      }\n    }\n  }\n\n  static removeUndefined(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeUndefined(o));\n    }\n\n    return obj;\n  }\n\n  static removeNull(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== null)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeNull(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeNull(o));\n    }\n\n    return obj;\n  }\n\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\n    if (direction === 'desc') {\n      b = [a, (a = b)][0];\n    }\n\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\n    // nullsFirst = true : always first\n    // nullsFirst = false : always end\n    if (\n      a === null ||\n      a === '' ||\n      a === undefined ||\n      b === null ||\n      b === '' ||\n      b === undefined\n    ) {\n      const nullScore =\n        a === b\n          ? 0\n          : a === undefined\n          ? 3\n          : b === undefined\n          ? -3\n          : a === null\n          ? 2\n          : b === null\n          ? -2\n          : a === ''\n          ? 1\n          : -1;\n      if (direction === 'desc') {\n        return nullsFirst !== false ? nullScore : nullScore * -1;\n      }\n      return nullsFirst === true ? nullScore * -1 : nullScore;\n    }\n\n    const ax = [];\n    const bx = [];\n    a = '' + a;\n    b = '' + b;\n\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      ax.push([$1 || Infinity, $2 || '']);\n    });\n\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      bx.push([$1 || Infinity, $2 || '']);\n    });\n\n    while (ax.length && bx.length) {\n      const an = ax.shift();\n      const bn = bx.shift();\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\n      if (nn) {\n        return nn;\n      }\n    }\n\n    return ax.length - bx.length;\n  }\n\n  /**\n   * Return true if two object are equivalent.\n   * Objects are considered equivalent if they have the same properties and\n   * if all of their properties (first-level only) share the same value.\n   * @param obj1 First object\n   * @param obj2 Second object\n   * @returns Whether two objects arer equivalent\n   */\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\n    if (obj1 === obj2) {\n      return true;\n    }\n\n    const obj1Props = Object.getOwnPropertyNames(obj1);\n    const obj2Props = Object.getOwnPropertyNames(obj2);\n    if (obj1Props.length !== obj2Props.length) {\n      return false;\n    }\n\n    for (const prop of obj1Props) {\n      if (obj1[prop] !== obj2[prop]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Return a new object with an array of keys removed\n   * @param obj Source object\n   * @param keys Keys to remove\n   * @returns A new object\n   */\n  static removeKeys(obj: object, keys: string[]): object {\n    const newObj = Object.keys(obj)\n      .filter(key => keys.indexOf(key) < 0)\n      .reduce((_obj, key) => {\n        _obj[key] = obj[key];\n        return _obj;\n      }, {});\n\n    return newObj;\n  }\n}\n","export class NumberUtils {\n    static roundToNDecimal(num: number, decimal: number = 3): number {\n        const roundFactor = Math.pow(10, decimal);\n        return Math.round((num) * roundFactor) / roundFactor;\n    }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { uuid } from '@igo2/utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","export interface Version {\n  lib: string;\n  releaseDate: number;\n}\n\nexport const version: Version = {\n  lib: '1.15.5',\n  releaseDate: 1712840659029\n};\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigOptions } from './config.interface';\nimport { version } from './version';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ConfigService {\n  private config: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in config file\n   */\n  public getConfig(key: string): any {\n    return ObjectUtils.resolve(this.config, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all config's variables\n   */\n  public load(options: ConfigOptions) {\n    const baseConfig = options.default || {};\n    if (!options.path) {\n      this.config = baseConfig;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`Configuration file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((configResponse: object) => {\n          this.config = ObjectUtils.mergeDeep(\n            ObjectUtils.mergeDeep({ version }, baseConfig),\n            configResponse\n          );\n          resolve(true);\n        });\n    });\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { ConfigService } from './config.service';\nimport { ConfigOptions } from './config.interface';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfigOptions(options: ConfigOptions) {\n  return {\n    provide: CONFIG_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function configFactory(\n  configService: ConfigService,\n  options: ConfigOptions\n) {\n  return () => configService.load(options);\n}\n\nexport function provideConfigLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: configFactory,\n    multi: true,\n    deps: [ConfigService, CONFIG_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideConfigOptions, provideConfigLoader } from './config.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoConfigModule {\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\n    return {\n      ngModule: IgoConfigModule,\n      providers: [provideConfigOptions({}), provideConfigLoader()]\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { forkJoin, map } from 'rxjs';\n\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigService } from '../../config/config.service';\n\nexport class LanguageLoader implements TranslateLoader {\n  constructor(\n    private http: HttpClient,\n    private prefix?: string | string[],\n    private suffix: string = '.json',\n    private config?: ConfigService\n  ) {}\n\n  public getTranslation(lang: string): any {\n    const igoLocale$ = this.http.get(`locale/libs_locale/${lang}.json`);\n\n    if (this.config && !this.prefix) {\n      const prefix = this.config.getConfig('language.prefix');\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\n    }\n\n    if (!this.prefix || this.prefix.length === 0) {\n      return igoLocale$;\n    }\n\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\n      this.http.get(`${prefix}${lang}${this.suffix}`)\n    );\n\n    const locale$ = forkJoin([igoLocale$, ...appLocale$]);\n\n    return locale$.pipe(\n      map((translations) => {\n        return translations.reduce(\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\n          {}\n        );\n      })\n    );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ConfigService } from '../../config/config.service';\nimport { LanguageLoader } from './language.loader';\n\nexport function defaultLanguageLoader(\n  http: HttpClient,\n  config?: ConfigService\n) {\n  return new LanguageLoader(http, undefined, undefined, config);\n}\n\nexport function provideLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient]\n  };\n}\n\nexport function provideDefaultLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  TranslateModule,\n  MissingTranslationHandler\n} from '@ngx-translate/core';\n\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\n\n@NgModule({\n  imports: [\n    TranslateModule.forRoot({\n      missingTranslationHandler: {\n        provide: MissingTranslationHandler,\n        useClass: IgoMissingTranslationHandler\n      }\n    })\n  ],\n  declarations: [],\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\n    return {\n      ngModule: IgoLanguageModule,\n      providers: [provideDefaultLanguageLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { GlobalConfig, ToastrModule } from 'ngx-toastr';\n\n@NgModule({\n  imports: [CommonModule,\n    ToastrModule.forRoot({\n      positionClass: 'toast-bottom-right',\n      timeOut: 10000,\n      extendedTimeOut: 10000,\n      messageClass: 'toast-message mat-typography',\n      closeButton: true,\n      progressBar: true,\n      enableHtml: true,\n      tapToDismiss: true,\n      maxOpened: 4,\n      preventDuplicates: true,\n      resetTimeoutOnDuplicate: true,\n      countDuplicates: false,\n      includeTitleDuplicates: true\n    } as GlobalConfig)],\n  declarations: [],\n  exports: []\n})\nexport class IgoMessageModule {\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\n    return {\n      ngModule: IgoMessageModule,\n      providers: []\n    };\n  }\n}\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success',\n  SHOW = 'show'\n}\n","import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LanguageService {\n  private language: string = this.translate.getBrowserLang();\n  readonly language$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  constructor(public translate: TranslateService) {\n    const lang = this.getLanguage();\n    this.translate.setDefaultLang(lang);\n    this.language$.next(lang);\n  }\n\n  public getLanguage(): string {\n    return this.language.match(/en|fr/) ? this.language : 'en';\n  }\n\n  public setLanguage(language: string) {\n    this.language = language.match(/en|fr/) ? language : 'en';\n    combineLatest([this.translate.use(this.language), this.translate.reloadLang(this.language)]).subscribe(() => {\n      this.language$.next(this.language);\n    });\n  }\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BehaviorSubject, forkJoin } from 'rxjs';\n\nimport { ConfigService } from '../../config/config.service';\n\nimport { Message, MessageOptions } from './message.interface';\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\nimport { MessageType } from './message.enum';\nimport { LanguageService } from '../../language/shared/language.service';\nimport { debounceTime, first } from 'rxjs/operators';\n\ninterface ActiveMessageTranslation {\n  id: number;\n  titleKey: string;\n  textKey: string;\n  textInterpolateParams?: Object\n  titleInterpolateParams?: Object\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  public messages$ = new BehaviorSubject<Message[]>([]);\n  private options: MessageOptions;\n  private activeMessageTranslations: ActiveMessageTranslation[] = [];\n\n  constructor(\n    @Inject(Injector) private injector: Injector,\n    private configService: ConfigService,\n    private languageService: LanguageService\n  ) {\n    this.options = this.configService.getConfig('message') || {};\n    this.languageService.language$.pipe(debounceTime(500)).subscribe(r => {\n      if (this.toastr.toasts.length === 0) {\n        this.activeMessageTranslations = [];\n      }\n      this.toastr.toasts.map(toast => {\n        const activeMessageTranslation = this.activeMessageTranslations.find(amt => amt.id === toast.toastId);\n        if (activeMessageTranslation) {\n          const translatedTextInterpolateParams = {...activeMessageTranslation.textInterpolateParams};\n          const translatedTitleInterpolateParams = {...activeMessageTranslation.titleInterpolateParams};\n\n          if (activeMessageTranslation.textInterpolateParams) {\n            Object.keys(activeMessageTranslation.textInterpolateParams).map(k => {\n              if (k) {\n                translatedTextInterpolateParams[k] =\n                  this.languageService.translate.instant(activeMessageTranslation.textInterpolateParams[k]);\n              }\n            });\n          }\n          if (activeMessageTranslation.titleInterpolateParams) {\n            Object.keys(activeMessageTranslation.titleInterpolateParams).map(k => {\n              if (k) {\n                translatedTitleInterpolateParams[k] =\n                  this.languageService.translate.instant(activeMessageTranslation.titleInterpolateParams[k]);\n              }\n\n            });\n          }\n\n\n          forkJoin([\n          this.languageService.translate.get(activeMessageTranslation.textKey, translatedTextInterpolateParams),\n          this.languageService.translate.get(activeMessageTranslation.titleKey, translatedTitleInterpolateParams)\n        ]).pipe(first()).subscribe((res: [string, string]) => {\n          toast.toastRef.componentInstance.message = res[0];\n          toast.toastRef.componentInstance.title = res[1];\n        });\n        }\n      });\n    });\n  }\n\n  private get toastr(): ToastrService {\n    return this.injector.get(ToastrService);\n  }\n\n  showError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    return this.error(httpError.error.message, httpError.error.title);\n  }\n\n  message(message: Message) {\n    const messageType = message.type;\n    this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType}`;\n\n    this.messages$.next(this.messages$.value.concat([message]));\n\n    message.options = message.options || {} as MessageOptions;\n    const currentDate = new Date();\n\n    message.options.from = message.options.from ? message.options.from : new Date('1 jan 1900');\n    message.options.to = message.options.to ? message.options.to : new Date('1 jan 3000');\n    if (typeof message.options.from === 'string') {\n      message.options.from = new Date(Date.parse(message.options.from.replace(/-/g, ' ')));\n    }\n    if (typeof message.options.to === 'string') {\n      message.options.to = new Date(Date.parse(message.options.to.replace(/-/g, ' ')));\n    }\n    if (currentDate > message.options.from && currentDate < message.options.to) {\n      if (message.showIcon === false) {\n        this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType} toast-no-icon`;\n      }\n      message = this.handleTemplate(message);\n\n      if (message.text) {\n        let messageShown: ActiveToast<any>;\n        switch (message.type) {\n          case MessageType.SUCCESS:\n            messageShown = this.success(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.ERROR:\n            messageShown = this.error(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.INFO:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.SHOW:\n            messageShown = this.show(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.ALERT:\n          case MessageType.WARNING:\n            messageShown = this.alert(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          default:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n        }\n        message.options.id = messageShown.toastId;\n      }\n    }\n  }\n\n  success(\n    text: string,\n    title: string = 'igo.core.message.success',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('success', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  error(\n    text: string,\n    title: string = 'igo.core.message.error',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('error', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  info(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('info', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  alert(\n    text: string,\n    title: string = 'igo.core.message.alert',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('alert', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  show(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('show', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  private handleNgxToastr(\n    type: 'alert' | 'info' | 'error' | 'success' | 'show',\n    text: string,\n    title: string,\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n\n    const translatedTextInterpolateParams = {...textInterpolateParams};\n    const translatedTitlenterpolateParams = {...titleInterpolateParams};\n\n    if (textInterpolateParams) {\n      Object.keys(textInterpolateParams).map(k => {\n        if (textInterpolateParams[k]) {\n          translatedTextInterpolateParams[k] =\n            this.languageService.translate.instant(textInterpolateParams[k]);\n        }\n      });\n    }\n    if (titleInterpolateParams) {\n      Object.keys(titleInterpolateParams).map(k => {\n        if (k) {\n          translatedTitlenterpolateParams[k] =\n            this.languageService.translate.instant(titleInterpolateParams[k]);\n        }\n      });\n    }\n\n\n    const message = this.languageService.translate.instant(text, translatedTextInterpolateParams);\n    const translatedTitle = this.languageService.translate.instant(title, translatedTitlenterpolateParams);\n\n    let activeToast;\n    switch (type) {\n      case 'success':\n        activeToast = this.toastr.success(message, translatedTitle, options);\n        break;\n      case 'error':\n        activeToast = this.toastr.error(message, translatedTitle, options);\n        break;\n      case 'show':\n      case 'info':\n        activeToast = this.toastr.info(message, translatedTitle, options);\n        break;\n      case 'alert':\n        activeToast = this.toastr.warning(message, translatedTitle, options);\n        break;\n    }\n    this.activeMessageTranslations.push({\n      id: activeToast.toastId,\n      titleKey: title,\n      textKey: text,\n      textInterpolateParams,\n      titleInterpolateParams });\n    return activeToast;\n\n  }\n\n  remove(id?: number) {\n    this.toastr.remove(id);\n  }\n\n  removeAllAreNotError() {\n    for (const mess of this.messages$.value) {\n      if (mess.type !== MessageType.ERROR) {\n        this.remove(mess.options.id);\n      }\n    }\n  }\n\n  private handleTemplate(message: Message): Message {\n    if (!this.options.template || message.html) {\n      return message;\n    }\n\n    let html = this.options.template;\n    html = html.replace('${text}', message.text);\n    html = html.replace('${title}', message.title);\n\n    message.html = undefined;\n    message.text = html;\n    message.title = undefined;\n    return message;\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest,\n  HttpEvent,\n  HttpErrorResponse\n} from '@angular/common/http';\n\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, finalize } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(\n    private injector: Injector\n  ) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const interceptError = originalReq.headers.get('interceptError');\n    const req = originalReq.clone({\n      headers: originalReq.headers.delete('interceptError')\n    });\n    if (interceptError === 'false') {\n      return next.handle(req);\n    }\n    const errorContainer = { httpError: undefined };\n    return next.handle(req).pipe(\n      catchError(error => this.handleError(error, errorContainer)),\n      finalize(() => {\n        this.handleCaughtError(errorContainer);\n        this.handleUncaughtError(errorContainer);\n      })\n    );\n  }\n\n  private handleError(\n    httpError: HttpErrorResponse,\n    errorContainer: { httpError: HttpErrorResponse }\n  ) {\n    if (httpError instanceof HttpErrorResponse) {\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\n      errorObj.message = httpError.error?.message || httpError.statusText;\n      errorObj.caught = false;\n\n      httpError = new HttpErrorResponse({\n        error: errorObj,\n        headers: httpError.headers,\n        status: httpError.status,\n        statusText: httpError.statusText,\n        url: httpError.url\n      });\n    }\n\n    errorContainer.httpError = httpError;\n    return throwError(httpError);\n  }\n\n  private handleCaughtError(errorContainer: { httpError: HttpErrorResponse }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && httpError.error.toDisplay) {\n      httpError.error.caught = true;\n      const messageService = this.injector.get(MessageService);\n       messageService.error(httpError.error.message, httpError.error.title);\n    }\n  }\n\n  private handleUncaughtError(errorContainer: {\n    httpError: HttpErrorResponse;\n  }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && !httpError.error.caught) {\n      const messageService = this.injector.get(MessageService);\n      httpError.error.caught = true;\n      messageService.error('igo.core.errors.uncaught.message', 'igo.core.errors.uncaught.title');\n    }\n  }\n}\n","import {\n  NgModule,\n  ModuleWithProviders,\n  Optional,\n  SkipSelf\n} from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { IgoActivityModule } from './activity/activity.module';\nimport { IgoConfigModule } from './config/config.module';\nimport { IgoLanguageModule } from './language/language.module';\nimport { IgoMessageModule } from './message/message.module';\nimport { IgoErrorModule } from './request/error.module';\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\n\nconst dbConfig: DBConfig = {\n  name: 'igo2DB',\n  version: 2,\n  objectStoresMeta: [{\n    store: 'geoData',\n    storeConfig: { keyPath: 'url', autoIncrement: false },\n    storeSchema: [\n      { name: 'regionID', keypath: 'regionID', options: { unique: false }}\n    ]\n  },\n  {\n    store: 'layerData',\n    storeConfig: { keyPath: 'layerId', autoIncrement: false },\n    storeSchema: [\n      { name: 'layerOptions', keypath: 'layerOptions', options: { unique: false }},\n      { name: 'sourceOptions', keypath: 'sourceOptions', options: { unique: false }}\n    ]\n  }]\n};\n@NgModule({\n  imports: [\n    CommonModule,\n    HttpClientModule,\n    IgoActivityModule.forRoot(),\n    IgoConfigModule.forRoot(),\n    IgoErrorModule.forRoot(),\n    IgoLanguageModule.forRoot(),\n    IgoMessageModule.forRoot(),\n    NgxIndexedDBModule.forRoot(dbConfig)\n  ],\n  declarations: [],\n  exports: [\n    IgoActivityModule,\n    IgoConfigModule,\n    IgoErrorModule,\n    IgoLanguageModule,\n    IgoMessageModule\n  ]\n})\nexport class IgoCoreModule {\n  static forRoot(): ModuleWithProviders<IgoCoreModule> {\n    return {\n      ngModule: IgoCoreModule,\n      providers: []\n    };\n  }\n\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n","import { Injectable, Inject, InjectionToken, Optional } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\nimport { Observable } from 'rxjs';\n\nimport { RouteServiceOptions } from './route.interface';\n\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\n  'routeServiceOptions'\n);\n\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\n  return {\n    provide: ROUTE_SERVICE_OPTIONS,\n    useValue: options\n  };\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RouteService {\n  public options: RouteServiceOptions;\n\n  constructor(\n    private router: Router,\n    public route: ActivatedRoute,\n    @Inject(ROUTE_SERVICE_OPTIONS)\n    @Optional()\n    options: RouteServiceOptions\n  ) {\n    const defaultOptions = {\n      centerKey: 'center',\n      zoomKey: 'zoom',\n      projectionKey: 'projection',\n      contextKey: 'context',\n      searchKey: 'search',\n      visibleOnLayersKey: 'visiblelayers',\n      visibleOffLayersKey: 'invisiblelayers',\n      directionsCoordKey: 'routing',\n      directionsOptionsKey: 'routingOptions',\n      toolKey: 'tool',\n      wmsUrlKey: 'wmsUrl',\n      wmsLayersKey:  'wmsLayers',\n      wmtsUrlKey: 'wmtsUrl',\n      wmtsLayersKey:  'wmtsLayers',\n      arcgisUrlKey: 'arcgisUrl',\n      arcgisLayersKey:  'arcgisLayers',\n      iarcgisUrlKey: 'iarcgisUrl',\n      iarcgisLayersKey:  'iarcgisLayers',\n      tarcgisUrlKey: 'tarcgisUrl',\n      tarcgisLayersKey:  'tarcgisLayers',\n      vectorKey: 'vector'\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n  }\n\n  get queryParams(): Observable<Params> {\n    let url = decodeURIComponent(location.search);\n    if (url.includes('¢er=')) {\n      url = url.replace('¢er', '&center');\n      const queryParams: any = url\n      .slice(1)\n      .split('&')\n      .map(p => p.split('='))\n      .reduce((obj, pair) => {\n        const [key, value] = pair.map(decodeURIComponent);\n        obj[key] = value;\n        return obj;\n      }, {});\n      this.router.navigate([], { queryParams });\n    }\n    return this.route.queryParams;\n  }\n}\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { Injectable } from '@angular/core';\nimport { Breakpoints, BreakpointObserver } from '@angular/cdk/layout';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Media, MediaOrientation } from './media.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MediaService {\n  public media$ = new BehaviorSubject<Media>(undefined);\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\n\n  constructor(breakpointObserver: BreakpointObserver) {\n    breakpointObserver\n      .observe([Breakpoints.HandsetLandscape])\n      .subscribe(res => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver.observe([Breakpoints.HandsetPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Mobile);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n  }\n\n  getMedia(): Media {\n    return this.media$.value;\n  }\n\n  getOrientation(): MediaOrientation {\n    return this.orientation$.value;\n  }\n\n  isTouchScreen(): boolean {\n    return 'ontouchstart' in document.documentElement ? true : false;\n  }\n\n  isMobile(): boolean {\n    const media = this.getMedia();\n    return media === 'mobile';\n  }\n\n  isDesktop(): boolean {\n    const media = this.getMedia();\n    return media === 'desktop';\n  }\n}\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '../config/config.service';\nimport { StorageScope, StorageOptions, StorageServiceEvent, StorageServiceEventEnum } from './storage.interface';\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n  protected options: StorageOptions;\n\n  public storageChange$: BehaviorSubject<StorageServiceEvent> = new BehaviorSubject(undefined);\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('storage') || { key: 'igo' };\n  }\n  /**\n   * Use to get the data found in storage file\n   */\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\n    let value: any;\n\n    if (!scope || scope === StorageScope.SESSION) {\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\n      value = localStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch {\n        value = value;\n      }\n    }\n\n    return value;\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.setItem(\n        `${this.options.key}.${key}`,\n        JSON.stringify(value)\n      );\n    } else {\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\n    }\n    const currentValue = this.get(key, scope);\n\n    if (currentValue !== previousValue) {\n      this.storageChange$.next({\n        key, scope,\n        event: previousValue !== undefined ? StorageServiceEventEnum.MODIFIED : StorageServiceEventEnum.ADDED,\n        previousValue,\n        currentValue\n      });\n    }\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\n    } else {\n      localStorage.removeItem(`${this.options.key}.${key}`);\n    }\n    this.storageChange$.next({key, scope, event: StorageServiceEventEnum.REMOVED, previousValue });\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.clear();\n    } else {\n      localStorage.clear();\n    }\n    this.storageChange$.next({scope, event: StorageServiceEventEnum.CLEARED });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, Observer } from 'rxjs';\nimport { CompressedData } from './compressedData.interface';\n\nfunction getNumber(v: number, endposition: number, length: number) {\n  /* tslint:disable:no-bitwise*/\n  const mask = ((1 << length) - 1);\n  return (v >> endposition) & mask;\n  /* tslint:enable:no-bitwise*/\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CompressionService {\n  private base64Index = new Map<string, number>();\n  private indexBase64 = new Map<number, string>();\n\n  constructor() {\n    this.generateBase64Index();\n  }\n\n  private generateBase64Index() {\n    // https://fr.wikipedia.org/wiki/Base64\n    // A-Z => [0, 25]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\n    }\n    // a-z => [26, 51]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\n    }\n    // 0-9 => [52, 61]\n    for (let i = 0; i < 10; i++) {\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\n    }\n    // + / => [62, 63]\n    this.base64Index.set('+', 62);\n    this.base64Index.set('/', 63);\n    this.indexBase64.set(62, '+');\n    this.indexBase64.set(63, '/');\n  }\n\n  compressBlob(blob: Blob): Observable<CompressedData> {\n    if (!blob) {\n      return;\n    }\n\n    const observable = new Observable((observer: Observer<CompressedData>) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(blob);\n      reader.onload = () => {\n        const base64 = reader.result.valueOf() as string;\n        const text64 = base64.substr(base64.indexOf(',') + 1);\n        const compressed = this.compressStringBase64(text64);\n        const compressedData: CompressedData = { length: text64.length,\n                                                 type: blob.type,\n                                                 object: compressed };\n        observer.next(compressedData);\n      };\n    });\n    return observable;\n  }\n\n  decompressBlob(compressedData: CompressedData): Blob {\n    /* tslint:disable:no-bitwise*/\n    const object = compressedData.object;\n    const length = compressedData.length;\n    const decompressed: string = this.decompressStringBase64(object, length);\n    const byteCharacters = atob(decompressed);\n    const byteNumbers = new Array(byteCharacters.length);\n    for (let i = 0; i < byteCharacters.length; i++) {\n        byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    const byteArray = new Uint8Array(byteNumbers);\n    const blob = new Blob([byteArray], {type: compressedData.type});\n    /* tslint:enable:no-bitwise*/\n    return blob;\n  }\n\n  private compressStringBase64(s: string): string {\n    /* tslint:disable:no-bitwise*/\n    let out = '';\n    let bits = 16;\n    let chr = 0;\n    let rem = 0;\n    for (const c of s) {\n      const value = this.base64Index.get(c);\n      if (bits > 6) {\n        bits -= 6;\n        chr += value << bits;\n      } else {\n        rem = 6 - bits;\n        chr += value >> rem;\n        out += String.fromCharCode(chr);\n        chr = (value) << (16 - rem);\n        bits = 16 - rem;\n      }\n    }\n    if (s.length % 8 !== 0) {\n      out += String.fromCharCode(chr);\n    }\n    /* tslint:enable:no-bitwise*/\n    return String.fromCharCode(9731) + out;\n  }\n\n  private decompressStringBase64(c: string, length: number): string {\n     /* tslint:disable:no-bitwise*/\n    if (!c) {\n      return;\n    }\n\n    if (c.charCodeAt(0) !== 9731) {\n      return c;\n    }\n\n    let chr = 0;\n    let rem = 0;\n    let bits = 16;\n    let out = '';\n    let j = 1;\n    let value = c.charCodeAt(j);\n    for (let i = 0; i < length; i++) {\n      if (bits > 6) {\n        bits -= 6;\n        chr = getNumber(value, bits, 6);\n        out += this.indexBase64.get(chr);\n      } else {\n        rem = 6 - bits;\n        chr = getNumber(value, 0, bits) << rem;\n        value = c.charCodeAt(++j);\n        chr += getNumber(value, 16 - rem, rem);\n        out += this.indexBase64.get(chr);\n        bits = 16 - rem;\n      }\n    }\n    return out;\n    /* tslint:enable:no-bitwise*/\n  }\n}\n","import { Injectable, EventEmitter, OnDestroy, Injector } from '@angular/core';\nimport { Observable, Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, startWith } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\nimport { ConnectionState } from './network.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetworkService implements OnDestroy {\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\n  private onlineSubscription: Subscription;\n  private offlineSubscription: Subscription;\n  private previousMessageId;\n\n  private state: ConnectionState = {\n    connection: window.navigator.onLine\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {\n      this.checkNetworkState();\n  }\n\n  private checkNetworkState() {\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.online.message',\n        'igo.core.network.online.title');\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = true;\n      this.emitEvent();\n    });\n\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.offline.message',\n        'igo.core.network.offline.title');\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = false;\n      this.emitEvent();\n    });\n  }\n\n  private emitEvent() {\n    this.stateChangeEventEmitter.emit(this.state);\n  }\n\n  ngOnDestroy(): void {\n    try {\n      this.offlineSubscription.unsubscribe();\n      this.onlineSubscription.unsubscribe();\n    } catch (e) {}\n  }\n\n  currentState(reportState = true): Observable<ConnectionState> {\n    return reportState\n      ? this.stateChangeEventEmitter.pipe(\n          debounceTime(300),\n          startWith(this.state)\n        )\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigService } from '../config/config.service';\nimport { RegexOptions } from './regex.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RegexService {\n  protected options: RegexOptions;\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('regex');\n  }\n\n\n  getAll() {\n    return this.options;\n  }\n\n  get(key) {\n    if (this.options) {\n      return this.options[key];\n    }\n    return;\n  }\n}\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import { t } from 'typy';\n\nimport { EntityKey } from './entity.interfaces';\n\n/**\n * Get an entity's named property. Nested properties are supported\n * with the dotted notation. (i.e 'author.name')\n *\n * Note: this method is a 'best attempt' at getting an entity's property.\n * It fits the most common cases but you might need to explicitely define\n * a property getter when using an EntityStore, for example.\n * @param entity Entity\n * @param property Property name\n * @returns Property value\n */\nexport function getEntityProperty(entity: object, property: string): any {\n  return t(entity, property).safeObject;\n}\n\n/**\n * Get an entity's id. An entity's id can be one of:\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\n *\n * Note: See the note in the 'getEntityProperty' documentation.\n * @param entity Entity\n * @returns Entity id\n */\nexport function getEntityId(entity: object): EntityKey {\n  const meta = (entity as any).meta || {};\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\n}\n\n/**\n * Get an entity's title. An entity's title can be one of:\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\n * @param entity Entity\n * @returns Entity title\n */\nexport function getEntityTitle(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.title ? meta.title : getEntityProperty(entity, meta.titleProperty || 'title');\n}\n\n/**\n * Get an entity's HTML title. An entity's HTML title can be one of:\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\n * @param entity Entity\n * @returns Entity HTML title\n */\nexport function getEntityTitleHtml(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.titleHtml ? meta.titleHtml : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\n}\n\n/**\n * Get an entity's icon. An entity's icon can be one of:\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\n * @param entity Entity\n * @returns Entity icon\n */\nexport function getEntityIcon(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.icon ? meta.icon : getEntityProperty(entity, meta.iconProperty || 'icon');\n}\n\n/**\n * Get an entity's revision.\n * @param entity Entity\n * @returns Entity revision\n */\nexport function getEntityRevision(entity: object): number {\n  const meta = (entity as any).meta || {};\n  return meta.revision || 0;\n}\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState, EntityStateManagerOptions } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\nimport { EntityStore } from './store';\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<E extends object, S extends EntityState = EntityState> {\n\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  private store: EntityStore<object> | undefined;\n\n  constructor(options: EntityStateManagerOptions = {}) {\n    this.store = options.store ? options.store : undefined;\n    this.getKey = options.getKey\n      ? options.getKey\n      : (this.store ? this.store.getKey : getEntityId);\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce((acc: {[key: string]: boolean}, key: string) => {\n        acc[key] = currentState[key] || false;\n        return acc;\n      }, {}) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || {} as S;\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some((changeKey: string) => {\n          return state[changeKey] !== undefined &&\n            state[changeKey] !== reverseChanges[changeKey];\n        });\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce((reverseChanges: Partial<S>, bunch: [string, any]) => {\n      const [changeKey, value] = bunch;\n      if (typeof value === typeof true) {\n        (reverseChanges as object)[changeKey] = !value;\n      }\n      return reverseChanges;\n    }, {});\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = this.store ? Array.from(this.store.index.keys()) : [];\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n\n}\n","import { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport { ObjectUtils, uuid } from '@igo2/utils';\nimport {\n  EntityKey,\n  EntityFilterClause,\n  EntitySortClause,\n  EntityJoinClause\n} from './entity.interfaces';\n\n/**\n * An entity view streams entities from an observable source. These entities\n * can be filtered or sorted without affecting the source. A view can also\n * combine data from multiple sources, joined together.\n */\nexport class EntityView<E extends object, V extends object = E> {\n\n  /**\n   * Observable stream of values\n   */\n  readonly values$ = new BehaviorSubject<V[]>([]);\n\n  /**\n   * Subscription to the source (and joined sources) values\n   */\n  private values$$: Subscription;\n\n  /**\n   * Whether this view has been lifted\n   */\n  private lifted = false;\n\n  /**\n   * Join clauses\n   */\n  private joins: EntityJoinClause[] = [];\n\n  /**\n   * Observable of a filter clause\n   */\n  private filter$ = new BehaviorSubject(undefined);\n\n  /**\n   * Observable of filter clauses\n   */\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject([]);\n\n  /**\n   * Filters index\n   */\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\n\n  /**\n   * Observable of a sort clause\n   */\n  private sort$ = new BehaviorSubject(undefined);\n\n  /**\n   * Method for indexing\n   */\n  get getKey(): (V) => EntityKey { return this.getKey$.value; }\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(undefined);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, V> { return this._index; }\n  private _index: Map<EntityKey, V>;\n\n  constructor(private source$: BehaviorSubject<E[]>) {}\n\n  /**\n   * Get a value from the view by key\n   * @param key Key\n   * @returns Value\n   */\n  get(key: EntityKey): V {\n    if (this._index === undefined) {\n      throw new Error('This view has no index, therefore, this method is unavailable.');\n    }\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all the values\n   * @returns Array of values\n   */\n  all(): V[] {\n    return this.values$.value;\n  }\n\n  /**\n   * Observe all the values\n   * @returns Observable of values\n   */\n  all$(): BehaviorSubject<V[]> {\n    return this.values$;\n  }\n\n  /**\n   * Get the first value that respects a criteria\n   * @returns A value\n   */\n  firstBy(clause: EntityFilterClause<V>): V {\n    return this.values$.value.find(clause);\n  }\n\n  /**\n   * Observe the first value that respects a criteria\n   * @returns Observable of a value\n   */\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\n  }\n\n  /**\n   * Get all the values that respect a criteria\n   * @returns Array of values\n   */\n  manyBy(clause: EntityFilterClause<V>): V[] {\n    return this.values$.value.filter(clause);\n  }\n\n  /**\n   * Observe all the values that respect a criteria\n   * @returns Observable of values\n   */\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\n  }\n\n  /**\n   * Clear the filter and sort and unsubscribe from the source\n   */\n  clear() {\n    this.filter(undefined);\n    this.sort(undefined);\n  }\n\n  destroy() {\n    if (this.values$$ !== undefined) {\n      this.values$$.unsubscribe();\n    }\n    this.clear();\n  }\n\n  /**\n   * Create an index\n   * @param getKey Method to get a value's id\n   * @returns The view\n   */\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\n    this._index = new Map();\n    this.getKey$.next(getKey);\n    return this;\n  }\n\n  /**\n   * Join another source to the stream (chainable)\n   * @param clause Join clause\n   * @returns The view\n   */\n  join(clause: EntityJoinClause): EntityView<E, V> {\n    if (this.lifted === true) {\n      throw new Error('This view has already been lifted, therefore, no join is allowed.');\n    }\n    this.joins.push(clause);\n    return this;\n  }\n\n  /**\n   * Filter values (chainable)\n   * @param clause Filter clause\n   * @returns The view\n   */\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\n    this.filter$.next(clause);\n    return this;\n  }\n\n  /**\n   * @param clause Filter clause\n   * @returns The filter id\n   */\n  addFilter(clause: EntityFilterClause<V>): string {\n    const id = uuid();\n    this.filterIndex.set(id, clause);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n    return id;\n  }\n\n  /**\n   * Remove a filter by id\n   * @param clause Filter clause\n   */\n  removeFilter(id: string) {\n    this.filterIndex.delete(id);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n  }\n\n  /**\n   * Sort values (chainable)\n   * @param clauseSort clause\n   * @returns The view\n   */\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\n    this.sort$.next(clause);\n    return this;\n  }\n\n  /**\n   * Create the final observable\n   * @returns Observable\n   */\n  lift() {\n    this.lifted = true;\n    const source$ = this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\n    const observables$ = [\n      source$,\n      this.filters$,\n      this.filter$,\n      this.sort$,\n      this.getKey$\n    ];\n\n    this.values$$ = combineLatest(observables$)\n      .pipe(skip(1), debounceTime(5))\n      .subscribe((bunch: any[]) => {\n        const [_values, filters, filter, sort, getKey] = bunch;\n        const values = this.processValues(_values, filters, filter, sort);\n        const generateIndex = getKey !== undefined;\n        this.setValues(values, generateIndex);\n      });\n  }\n\n  /**\n   * Create the source observable when no joins are defined\n   * @returns Observable\n   */\n  private liftSource(): Observable<V[]> {\n    return this.source$ as any as Observable<V[]>;\n  }\n\n  /**\n   * Create the source observable when joins are defined\n   * @returns Observable\n   */\n  private liftJoinedSource(): Observable<V[]> {\n    const sources$ = [this.source$, combineLatest(\n      this.joins.map((join: EntityJoinClause) => join.source)\n    )];\n\n    return combineLatest(sources$)\n      .pipe(\n        map((bunch: [E[], any[]]) => {\n          const [entities, joinData] = bunch;\n          return entities.reduce((values: V[], entity: E) => {\n            const value = this.computeJoinedValue(entity, joinData);\n            if (value !== undefined) {\n              values.push(value);\n            }\n            return values;\n          }, []);\n        })\n      );\n  }\n\n  /**\n   * Apply joins to a source's entity and return the final value\n   * @returns Final value\n   */\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\n    let value = entity as Partial<V>;\n    let joinIndex = 0;\n    while (value !== undefined && joinIndex < this.joins.length) {\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\n      joinIndex += 1;\n    }\n    return value as V;\n  }\n\n  /**\n   * Filter and sort values before streaming them\n   * @param values Values\n   * @param filters Filter clauses\n   * @param filter Filter clause\n   * @param sort Sort clause\n   * @returns Filtered and sorted values\n   */\n  private processValues(\n    values: V[], filters: EntityFilterClause[], filter: EntityFilterClause, sort: EntitySortClause\n  ): V[] {\n    values = values.slice(0);\n    values = this.filterValues(values, filters.concat([filter]));\n    values = this.sortValues(values, sort);\n    return values;\n  }\n\n  /**\n   * Filter values\n   * @param values Values\n   * @param filters Filter clauses\n   * @returns Filtered values\n   */\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\n    if (clauses.length === 0) { return values; }\n\n    return values\n      .filter((value: V) => {\n        return clauses\n          .filter((clause: EntityFilterClause) => clause !== undefined)\n          .every((clause: EntityFilterClause) => clause(value));\n      });\n  }\n\n  /**\n   * Sort values\n   * @param values Values\n   * @param sort Sort clause\n   * @returns Sorted values\n   */\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\n    if (clause === undefined) { return values; }\n    return values.sort((v1: V, v2: V) => {\n      return ObjectUtils.naturalCompare(\n        clause.valueAccessor(v1),\n        clause.valueAccessor(v2),\n        clause.direction,\n        clause.nullsFirst\n      );\n    });\n  }\n\n  /**\n   * Set value and optionally generate an index\n   * @param values Values\n   * @param generateIndex boolean\n   */\n  private setValues(values: V[], generateIndex: boolean) {\n    if (generateIndex === true) {\n      this._index = this.generateIndex(values);\n    }\n\n    this.values$.next(values);\n\n    const count = values.length;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Generate a complete index of all the values\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(values: V[]): Map<EntityKey, V> {\n    const entries = values.map((value: V) => [this.getKey(value), value]);\n    return new Map(entries as [EntityKey, V][]);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStateManager } from './state';\nimport { EntityView } from './view';\nimport { EntityKey, EntityState, EntityRecord, EntityStoreOptions } from './entity.interfaces';\nimport { getEntityId, getEntityProperty } from './entity.utils';\nimport { EntityStoreStrategy } from './strategies/strategy';\n\n/**\n * An entity store class holds any number of entities\n * as well as their state. It can be observed, filtered and sorted and\n * provides methods to insert, update or delete entities.\n */\nexport class EntityStore<E extends object = object, S extends EntityState = EntityState> {\n\n  /**\n   * Observable of the raw entities\n   */\n  readonly entities$ = new BehaviorSubject<E[]>([]);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Entity store state\n   */\n  readonly state: EntityStateManager<E, S>;\n\n  /**\n   * View of all the entities\n   */\n  readonly view: EntityView<E>;\n\n  /**\n   * View of all the entities and their state\n   */\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  /**\n   * Method to get an entity's named property\n   */\n  readonly getProperty: (E, prop: string) => any;\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, E> { return this._index; }\n  private _index: Map<EntityKey, E>;\n\n  /**\n   * Store index\n   */\n  get pristine(): boolean { return this._pristine; }\n  private _pristine: boolean = true;\n\n  /**\n   * Strategies\n   */\n  private strategies: EntityStoreStrategy[] = [];\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n    this.getProperty = options.getProperty ? options.getProperty : getEntityProperty;\n\n    this.state = this.createStateManager();\n    this.view = this.createDataView();\n    this.stateView = this.createStateView();\n\n    this.view.lift();\n    this.stateView.lift();\n\n    if (entities.length > 0) {\n      this.load(entities);\n    } else {\n      this._index = this.generateIndex(entities);\n    }\n  }\n\n  /**\n   * Get an entity from the store by key\n   * @param key Key\n   * @returns Entity\n   */\n  get(key: EntityKey): E {\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all entities in the store\n   * @returns Array of entities\n   */\n  all(): E[] {\n    return this.entities$.value;\n  }\n\n  /**\n   * Set this store's entities\n   * @param entities Entities\n   */\n  load(entities: E[], pristine: boolean = true) {\n    this._index = this.generateIndex(entities);\n    this._pristine = pristine;\n    this.next();\n  }\n\n  /**\n   * Clear the store's entities but keep the state and views intact.\n   * Views won't return any data but future data will be subject to the\n   * current views filter and sort\n   */\n  softClear() {\n    if (this.index && this.index.size > 0) {\n      this.index.clear();\n      this._pristine = true;\n      this.next();\n    } else if (this.index) {\n      this.updateCount();\n    }\n  }\n\n  /**\n   * Clear the store's entities, state and views\n   */\n  clear() {\n    this.stateView.clear();\n    this.view.clear();\n    this.state.clear();\n    this.softClear();\n  }\n\n  destroy() {\n    this.stateView.destroy();\n    this.view.destroy();\n    this.clear();\n  }\n\n  /**\n   * Insert an entity into the store\n   * @param entity Entity\n   */\n  insert(entity: E) {\n    this.insertMany([entity]);\n  }\n\n  /**\n   * Insert many entities into the store\n   * @param entities Entities\n   */\n  insertMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Update or insert an entity into the store\n   * @param entity Entity\n   */\n  update(entity: E) {\n    this.updateMany([entity]);\n  }\n\n  /**\n   * Update or insert many entities into the store\n   * @param entities Entities\n   */\n  updateMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Delete an entity from the store\n   * @param entity Entity\n   */\n  delete(entity: E) {\n    this.deleteMany([entity]);\n  }\n\n  /**\n   * Delete many entities from the store\n   * @param entities Entities\n   */\n  deleteMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Add a strategy to this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  addStrategy(strategy: EntityStoreStrategy, activate: boolean = false): EntityStore {\n    const existingStrategy = this.strategies.find((_strategy: EntityStoreStrategy) => {\n      return strategy.constructor === _strategy.constructor;\n    });\n    if (existingStrategy !== undefined) {\n      throw new Error('A strategy of this type already exists on that EntityStore.');\n    }\n\n    this.strategies.push(strategy);\n    strategy.bindStore(this);\n\n    if (activate === true) {\n      strategy.activate();\n    }\n\n    return this;\n  }\n\n  /**\n   * Remove a strategy from this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\n    const index = this.strategies.indexOf(strategy);\n    if (index >= 0) {\n      this.strategies.splice(index, 1);\n      strategy.unbindStore(this);\n    }\n    return this;\n  }\n\n  /**\n   * Return strategies of a given type\n   * @param type Entity store strategy class\n   * @returns Strategies\n   */\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\n      return strategy instanceof type;\n    });\n  }\n\n  /**\n   * Activate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  /**\n   * Generate a complete index of all the entities\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\n    return new Map(entries as [EntityKey, E][]);\n  }\n\n  /**\n   * Push the index's entities into the entities$ observable\n   */\n  private next() {\n    this.entities$.next(Array.from(this.index.values()));\n    this.updateCount();\n  }\n\n  /**\n   * Update the store's count and empty\n   */\n  private updateCount() {\n    const count = this.index.size;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Create the entity state manager\n   * @returns EntityStateManager\n   */\n  private createStateManager() {\n    return new EntityStateManager<E, S>({store: this});\n  }\n\n  /**\n   * Create the data view\n   * @returns EntityView<E>\n   */\n  private createDataView() {\n    return new EntityView<E>(this.entities$);\n  }\n\n  /**\n   * Create the state view\n   * @returns EntityView<EntityRecord<E>>\n   */\n  private createStateView() {\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\n      .join({\n        source: this.state.change$,\n        reduce: (entity: E): EntityRecord<E, S> => {\n          const key = this.getKey(entity);\n          const state = this.state.get(entity);\n          const currentRecord = this.stateView.get(key);\n\n          if (\n            currentRecord !== undefined &&\n            currentRecord.entity === entity &&\n            this.statesAreTheSame(currentRecord.state, state)\n          ) {\n            return currentRecord;\n          }\n\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\n          const ref = `${key}-${revision}`;\n          return {entity, state, revision, ref};\n        }\n      })\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\n  }\n\n  private statesAreTheSame(currentState: S, newState: S): boolean {\n    if (currentState === newState) {\n      return true;\n    }\n\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\n    const newStateIsEmpty = Object.keys(newState).length === 0;\n    return currentStateIsEmpty && newStateIsEmpty;\n  }\n\n}\n","import { ChangeDetectorRef } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { EntityKey } from './entity.interfaces';\n\nimport { EntityStore } from './store';\n\n/**\n * This class is used to synchronize a component's changes\n * detection with an EntityStore changes. For example, it is frequent\n * to have a component subscribe to a store's selected entity and, at the same time,\n * this component provides a way to select an entity with, let's say, a click.\n *\n * This class automatically handles those case and triggers the compoent's\n * change detection when needed.\n *\n * Note: If the component observes the store's stateView, a workspace is\n * probably not required because the stateView catches any changes to the\n * entities and their state.\n */\nexport class EntityStoreWatcher<E extends object> {\n\n  /**\n   * Component change detector\n   */\n  private cdRef: ChangeDetectorRef;\n\n  /**\n   * Entity store\n   */\n  private store: EntityStore<E>;\n\n  /**\n   * Component inner state\n   */\n  private innerStateIndex = new Map<EntityKey, {[key: string]: any}>();\n\n  /**\n   * Subscription to the store's entities\n   */\n  private entities$$: Subscription;\n\n  /**\n   * Subscription to the store's state\n   */\n  private state$$: Subscription;\n\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\n    this.setChangeDetector(cdRef);\n    this.setStore(store);\n  }\n\n  destroy() {\n    this.setChangeDetector(undefined);\n    this.setStore(undefined);\n  }\n\n  /**\n   * Bind this workspace to a store and start watching for changes\n   * @param store Entity store\n   */\n  setStore(store?: EntityStore<E>) {\n    if (store === undefined) {\n      this.teardownObservers();\n      this.innerStateIndex.clear();\n      this.store = undefined;\n      return;\n    }\n\n    this.setStore(undefined);\n    this.store = store;\n    this.setupObservers();\n    this.detectChanges();\n  }\n\n  /**\n   * Bind this workspace to a component's change detector\n   * @param cdRef Change detector\n   */\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\n    this.cdRef = cdRef;\n  }\n\n  /**\n   * Set up observers on a store's entities and their state\n   * @param store Entity store\n   */\n  private setupObservers() {\n    this.teardownObservers();\n\n    this.entities$$ = this.store.entities$\n      .subscribe((entities: E[]) => this.onEntitiesChange(entities));\n\n    this.state$$ = this.store.state.change$\n      .pipe(skip(1))\n      .subscribe(() => this.onStateChange());\n  }\n\n  /**\n   * Teardown store observers\n   */\n  private teardownObservers() {\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n    this.entities$$ = undefined;\n    this.state$$ = undefined;\n  }\n\n  /**\n   * When the entities change, always trigger the changes detection\n   */\n  private onEntitiesChange(entities: E[]) {\n    this.detectChanges();\n  }\n\n  /**\n   * When the entities state change, trigger the change detection\n   * only if the component has not handled these changes yet. For example,\n   * the component might have initiated thoses changes itself.\n   */\n  private onStateChange() {\n    let changesDetected = false;\n    const storeIndex = this.store.state.index;\n    const innerIndex = this.innerStateIndex;\n\n    if (storeIndex.size !== innerIndex.size) {\n      changesDetected = this.detectChanges();\n    }\n\n    const storeKeys = Array.from(storeIndex.keys());\n    for (const key of storeKeys) {\n      const storeValue = storeIndex.get(key);\n      const innerValue = innerIndex.get(key);\n      if (changesDetected === false) {\n        if (innerValue === undefined) {\n          changesDetected = this.detectChanges();\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\n          changesDetected = this.detectChanges();\n        }\n      }\n\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\n    }\n  }\n\n  /**\n   * Trigger the change detection of the workspace is bound to a change detector\n   */\n  private detectChanges() {\n    if (this.cdRef !== undefined) {\n      this.cdRef.detectChanges();\n    }\n    return true;\n  }\n\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(store, store.stateView.addFilter(this.options.filterClauseFunc));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\">\n    <mat-option *ngIf=\"emptyText !== undefined && multi === false\" [value]=\"emptyValue\">{{emptyText}}</mat-option>\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{multiText$ | async}}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{titleAccessor(record.entity)}}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityRecord } from '../shared/entity.interfaces';\nimport { EntityStore } from '../shared/store';\nimport { EntityStoreWatcher } from '../shared/watcher';\nimport { getEntityTitle } from '../shared/entity.utils';\n\n@Component({\n  selector: 'igo-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\n\n  /**\n   * The selected entity\n   * @internal\n   */\n  readonly selected$ = new BehaviorSubject<object>(undefined);\n\n  /**\n   * The current multi select option text\n   * @internal\n   */\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\n\n  readonly multiSelectValue = {id: 'IGO_MULTI_SELECT'};\n\n  readonly emptyValue = {id: 'IGO_EMPTY_SELECT'};\n\n  /**\n   * Subscription to the selected entity\n   */\n  private selected$$: Subscription;\n\n  /**\n   * Store watcher\n   */\n  private watcher: EntityStoreWatcher<object>;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Title accessor\n   */\n  @Input() titleAccessor: (object) => string = getEntityTitle;\n\n  /**\n   * Text to display when nothing is selected\n   */\n  @Input() emptyText: string = undefined;\n\n  /**\n   * Wheter selecting many entities is allowed\n   */\n  @Input() multi: boolean = false;\n\n  /**\n   * Text to display for the select all option\n   */\n  @Input() multiAllText: string = 'All';\n\n  /**\n   * Text to display for the select none option\n   */\n  @Input() multiNoneText: string = 'None';\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Wheter the selector is disabled or not\n   */\n  @Input() disabled: boolean = false;\n\n  /**\n   * Event emitted when the selection changes\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: object | object[];\n  }>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Create a store watcher and subscribe to the selected entity\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.selected$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const entities = records.map((record: EntityRecord<object>) => record.entity);\n        this.onSelectFromStore(entities);\n      });\n  }\n\n  /**\n   * Unsubscribe to the selected entity and destroy the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.selected$$.unsubscribe();\n  }\n\n  /**\n   * On selection change, update the store's state and emit an event\n   * @internal\n   */\n  onSelectionChange(event: {value: object | undefined}) {\n    const values = event.value instanceof Array ? event.value : [event.value];\n\n    const multiSelect = values.find((_value: object) => _value === this.multiSelectValue);\n    let entities = values.filter((_value: object) => _value !== this.multiSelectValue);\n    if (multiSelect !== undefined) {\n      if (entities.length === this.store.count) {\n        entities = [];\n      } else if (entities.length < this.store.count) {\n        entities = this.store.all();\n      }\n    }\n\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\n    if (entities.length === 0) {\n      this.store.state.updateAll({selected: false});\n    } else {\n      this.store.state.updateMany(entities, {selected: true}, true);\n    }\n\n    const value = this.multi ? entities : event.value;\n    this.selectedChange.emit({selected: true, value});\n  }\n\n  private onSelectFromStore(entities: object[]) {\n    if (this.multi === true) {\n      this.selected$.next(entities);\n    } else {\n      const entity = entities.length > 0 ? entities[0] : undefined;\n      this.selected$.next(entity);\n    }\n\n    this.updateMultiToggleWithEntities(entities);\n  }\n\n  private updateMultiToggleWithEntities(entities: object[]) {\n    if (entities.length === this.store.count && this.multiText$.value !== this.multiNoneText) {\n      this.multiText$.next(this.multiNoneText);\n    } else if (entities.length < this.store.count && this.multiText$.value !== this.multiAllText) {\n      this.multiText$.next(this.multiAllText);\n    }\n  }\n\n}\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]'\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnChanges,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnDestroy\n} from '@angular/core';\n\nimport {\n  EntityStore\n} from '../shared';\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table-paginator',\n  templateUrl: './entity-table-paginator.component.html',\n  styleUrls: ['./entity-table-paginator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\n\n  public disabled: boolean = false;\n  public hidePageSize: boolean = false;\n  public pageIndex: number = 0;\n  public pageSize: number = 50;\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\n  public showFirstLastButtons: boolean = true;\n  private count$$: Subscription;\n  private entitySortChange$$: Subscription;\n  private paginationLabelTranslation$$: Subscription[] = [];\n\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when the paginator changes the page size or page index.\n   */\n  @Output() page: EventEmitter<PageEvent>;\n\n  public length: number = 0;\n\n  /**\n   * Paginator emitted.\n   */\n  @Output() paginatorChange: EventEmitter<MatPaginator> = new EventEmitter<MatPaginator>();\n\n  constructor(private languageService: LanguageService, private mediaService: MediaService) {}\n\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\n\n  ngOnChanges() {\n    this.unsubscribeAll();\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\n      this.length = count;\n      this.emitPaginator();\n    });\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\n      if (this.paginator) {\n        this.paginator.firstPage();\n      }\n    });\n    this.initPaginatorOptions();\n    this.translateLabels();\n  }\n\n  initPaginatorOptions() {\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\n    this.pageSizeOptions = this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\n    if (this.mediaService.isMobile()) {\n      this.showFirstLastButtons = false;\n      this.hidePageSize = true;\n    } else {\n      this.showFirstLastButtons = this.paginatorOptions?.showFirstLastButtons || this.showFirstLastButtons;\n      this.hidePageSize = this.paginatorOptions?.hidePageSize || this.hidePageSize;\n    }\n  }\n\n  translateLabels() {\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.firstPageLabel').subscribe((label: string) => {\n        this.paginator._intl.firstPageLabel = label;\n      }));\n\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.itemsPerPageLabel').subscribe((label: string) => {\n        this.paginator._intl.itemsPerPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.lastPageLabel').subscribe((label: string) => {\n        this.paginator._intl.lastPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.nextPageLabel').subscribe((label: string) => {\n        this.paginator._intl.nextPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.previousPageLabel').subscribe((label: string) => {\n        this.paginator._intl.previousPageLabel = label;\n      }));\n  }\n\n  rangeLabel = (page: number, pageSize: number, length: number) => {\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.of').subscribe((label: string) => {\n        of.next(label);\n      }));\n    if (length === 0 || pageSize === 0) { return `0 ${of.value} ${length}`; }\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex = startIndex < length ?\n        Math.min(startIndex + pageSize, length) :\n        startIndex + pageSize;\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\n  };\n\n  private unsubscribeAll() {\n    this.paginationLabelTranslation$$.map(sub => sub.unsubscribe());\n    if (this.count$$) { this.count$$.unsubscribe(); }\n    if (this.entitySortChange$$) { this.entitySortChange$$.unsubscribe(); }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeAll();\n  }\n\n  emitPaginator() {\n    this.paginatorChange.emit(this.paginator);\n  }\n}\n","<mat-paginator \n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\">\n</mat-paginator>\n","import {\n  Directive,\n  HostListener,\n  Input,\n  ElementRef\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoImageError]'\n})\nexport class ImageErrorDirective {\n\n  @Input() errorImageUrl: string = './assets/igo2/common/images/na.png';\n  @Input() hideError: boolean = false;\n\n  constructor(private el: ElementRef) {}\n\n  @HostListener(\"error\", ['$event'])\n  public onError(event: any): void {\n    if (this.hideError) {\n      this.el.nativeElement.style.display = \"none\";\n    } else {\n      event.target.src = this.errorImageUrl;\n    }\n\n  }\n\n}\n","import {\n  Directive,\n  Input,\n  ElementRef,\n  Renderer2,\n  EventEmitter,\n  Output,\n  HostListener\n} from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\n\n/**\n * Directive that handles an entity table row click and selection.\n */\n@Directive({\n  selector: '[igoEntityTableRow]'\n})\nexport class EntityTableRowDirective {\n\n  /**\n   * Class added to a selected row\n   */\n  static selectedCls = 'igo-entity-table-row-selected';\n\n  /**\n   * Class added to a highlighted row\n   */\n  static highlightedCls = 'igo-entity-table-row-highlighted';\n\n  /**\n   * Whether a row supports selection\n   */\n  @Input() selection = false;\n\n  /**\n   * Whether clicking a row should select it (if selection is true)\n   */\n  @Input() selectOnClick: boolean = true;\n\n  /**\n   * Whether the selected row should be highlighted\n   */\n  @Input() highlightSelection: boolean = true;\n\n  /**\n   * Whether a row is selected\n   */\n  @Input()\n  set selected(value: boolean) {\n    if (this.selection === false) { return; }\n    if (value === this._selected) { return; }\n\n    this.toggleSelected(value);\n    this.scroll();\n  }\n  get selected(): boolean {\n    return this._selected;\n  }\n  private _selected = false;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Event emitted when a row is selected\n   */\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\n\n  /**\n   * When a row is clicked, select it if it's supported\n   * @ignore\n   */\n  @HostListener('click')\n  onClick() {\n    if (this.selection === false || this.selectOnClick === false) {\n      return;\n    }\n\n    this.toggleSelected(true);\n    this.select.emit(this);\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  /**\n   * Select a row and add or remove the selected class from it\n   * @param selected Whether the row should be selected\n   */\n  private toggleSelected(selected: boolean) {\n    this._selected = selected;\n    if (selected === true) {\n      this.addCls(EntityTableRowDirective.selectedCls);\n      if (this.highlightSelection === true) {\n        this.addCls(EntityTableRowDirective.highlightedCls);\n      }\n    } else {\n      this.removeCls(EntityTableRowDirective.selectedCls);\n      this.removeCls(EntityTableRowDirective.highlightedCls);\n    }\n  }\n\n  /**\n   * Scroll to the selected row\n   */\n  private scroll() {\n    if (this._selected === true) {\n      scrollIntoView(this.el.nativeElement, {\n        scrollMode: 'if-needed',\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Add the selected CSS class\n   */\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  /**\n   * Remove the selected CSS class\n   */\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({ name: 'sanitizeHtml' })\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {\n  }\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { Cacheable } from 'ts-cacheable';\nimport { Observable } from 'rxjs';\nimport { catchError, switchMap } from 'rxjs/operators';\nimport { ConfigService } from '@igo2/core';\n\n@Pipe({\n  name: 'secureImage'\n})\nexport class SecureImagePipe implements PipeTransform {\n  constructor(\n    private http: HttpClient,\n    private configService?: ConfigService) {}\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  transform(url: string): Observable<string> {\n    const headers = new HttpHeaders({\n      'Content-Type': 'text/plain',\n      activityInterceptor: 'false',\n      interceptError: 'false'\n    });\n\n    const regexDepot = new RegExp(this.configService?.getConfig('depot.url') + '.*?(?=\"|$)');\n    if (regexDepot.test(url)) {\n      url = url.match(regexDepot)[0];\n    }\n\n    return this.http\n      .get(url, {\n        headers,\n        responseType: 'blob'\n      })\n      .pipe(\n        catchError((err) => {\n          err.error.caught = true;\n          err.error.toDisplay = false;\n          throw err;\n        }),\n        switchMap((blob) => {\n          return new Observable((observer) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = () => {\n              observer.next(reader.result);\n              observer.complete();\n            };\n          });\n        })\n      ) as Observable<string>;\n  }\n}\n","<div class=\"table-container\" [ngStyle]=\"{'height': tableHeight}\">\n  <table mat-table matSort [ngClass]=\"getTableClass()\" [dataSource]=\"dataSource\" [trackBy]=\"getTrackByFunction()\" (matSortChange)=\"onSort($event)\">\n      <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\n          <th mat-header-cell *matHeaderCellDef>\n              <ng-container *ngIf=\"selectMany\">\n                  <ng-container *ngIf=\"selectionState$ | async as selectionState\">\n                      <mat-checkbox (change)=\"onToggleRows($event.checked)\" [checked]=\"selectionState === entityTableSelectionState.All\"\n                      [indeterminate]=\"selectionState === entityTableSelectionState.Some\">\n                      </mat-checkbox>\n                  </ng-container>\n              </ng-container>\n          </th>\n          <td mat-cell *matCellDef=\"let record\">\n              <mat-checkbox (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\" (click)=\"$event.shiftKey ?\n              onShiftToggleRow(!rowIsSelected(record), record, $event) : $event.stopPropagation()\" (change)=\"onToggleRow($event.checked,record)\"\n              [checked]=\"rowIsSelected(record)\">\n              </mat-checkbox>\n          </td>\n      </ng-container>\n\n      <ng-container [matColumnDef]=\"column.name\" *ngFor=\"let column of template.columns\">\n          <ng-container *ngIf=\"columnIsSortable(column)\">\n              <th mat-header-cell *matHeaderCellDef mat-sort-header [matTooltip]=\"column.tooltip ? column.tooltip : undefined\">\n                  {{column.title}}\n              </th>\n          </ng-container>\n\n          <ng-container *ngIf=\"!columnIsSortable(column)\">\n              <th mat-header-cell *matHeaderCellDef [matTooltip]=\"column.tooltip ? column.tooltip : undefined\">\n                  {{column.title}}\n              </th>\n          </ng-container>\n\n          <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlDefault\" [ngClass]=\"getCellClass(record, column)\">\n                          {{getValue(record, column)}}\n                      </td>\n                      <ng-template #isAnUrlDefault>\n                          <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                              <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                  <img igoImageError *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                  <ng-template #notImg><span>{{\n                    'igo.common.entity-table.targetHtmlUrl' | translate }}\n                  </span></ng-template>\n                              </a>\n                          </td>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlHTML\" [ngClass]=\"getCellClass(record, column)\"\n                      [innerHTML]=\"getValue(record, column)\">\n                      </td>\n                      <ng-template #isAnUrlHTML>\n                          <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                              <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                  <img igoImageError *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                  <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' |\n                    translate }} </span></ng-template>\n                              </a>\n                          </td>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text edition\" [formGroup]=\"formGroup\" *ngIf=\"isEdition(record);else isUnsanitizedHTML\"\n                      [ngClass]=\"getCellClass(record, column)\">\n                          <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\n                              <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n                              <input matInput [matDatepicker]=\"picker\" [formControlName]=\"column.name\" value=\"{{getValue(record, column)}}\"\n                              (dateChange)=\"onDateChange(column.name, record, $event)\">\n                              <mat-datepicker #picker></mat-datepicker>\n                          </div>\n                          <input matInput type=\"time\" *ngIf=\"column.type === 'time'\" [formControlName]=\"column.name\" step=\"900\" (focus)=\"column.onFocus($event)\"\n                          (keypress)=\"column.onChange($event)\" (blur)=\"column.onBlur($event)\">\n                          <input matInput type=\"number\" class=\"class_number_edition\" *ngIf=\"column.type === 'number'\" [formControlName]=\"column.name\" step=\"{{column.step}}\"\n                          value=\"{{getValue(record,column)}}\" (input)=\"onValueChange(column.name, record, $event)\"\n                          readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\"\n                          min=\"{{getValidationAttributeValue(column, 'minValue')}}\" max=\"{{getValidationAttributeValue(column, 'maxValue')}}\">\n                          <input matInput type=\"text\" *ngIf=\"!column.type || column.type ==='string'\" [formControlName]=\"column.name\"\n                          value=\"{{getValue(record, column)}}\" (input)=\"onValueChange(column.name, record, $event)\"\n                          readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\">\n                          <mat-checkbox *ngIf=\"column.type === 'boolean'\" [formControlName]=\"column.name\" [checked]=\"getValue(record,column)\"\n                          (change)=\"onBooleanValueChange(column.name, record,$event)\"></mat-checkbox>\n                          <mat-select *ngIf=\"column.type === 'list'\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\"\n                          [formControlName]=\"column.name\" [multiple]=\"column.multiple\" (selectionChange)=\"onSelectValueChange(column.name, record, $event)\"\n                          [value]=\"getValue(record, column)\">\n                              <mat-option *ngFor=\"let option of column.domainValues\" [value]=\"option.id\" [disabled]=\"option.disabled\">\n                                  {{ option.value }}\n                              </mat-option>\n                          </mat-select>\n                          <input matInput type=\"text\" [formControlName]=\"column.name\" *ngIf=\"column.type === 'autocomplete'\" [matAutocomplete]=\"auto\"\n                            required=\"{{getValidationAttributeValue(column, 'mandatory')}}\" value=\"{{getValue(record, column)}}\"\n                            readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\">\n                                <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onAutocompleteValueChange(column, record, $event)\"\n                                panelWidth=\"430px\">\n                                    <mat-option *ngFor=\"let option of filteredOptions[column.name] | async\"\n                                        [value]=\"option.id\">\n                                        {{ option.value }}\n                                    </mat-option>\n                                </mat-autocomplete>\n                      </td>\n                      <ng-template #isUnsanitizedHTML>\n                          <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlUnsanitizedHTML\" [ngClass]=\"getCellClass(record, column)\"\n                          [innerHTML]=\"getValue(record, column) | sanitizeHtml\">\n                          </td>\n                          <ng-template #isAnUrlUnsanitizedHTML>\n                              <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                      <img igoImageError *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                      <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n                                  </a>\n                              </td>\n                          </ng-template>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\n                  <td mat-cell *matCellDef=\"let record\" class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                      <mat-icon *ngIf=\"column.onClick\" svgIcon=\"{{getValue(record, column)|| column.icon}}\" (click)=\"column.onClick($event)\"></mat-icon>\n                      <mat-icon *ngIf=\"!column.onClick\" svgIcon=\"{{getValue(record, column)|| column.icon}}\"></mat-icon>\n                  </td>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                          <span *ngFor=\"let button of getValue(record, column)\">\n                              <ng-container *ngIf=\"isEdition(record) === button.editMode || button.editMode === undefined\">\n                                  <button *ngIf=\"button.style === 'mat-icon-button'\" igoStopPropagation mat-icon-button\n                                      [color]=\"button.color\" (mousedown)=\"onButtonClick(button.click, record)\" [disabled]=\"button.disabled\">\n                                      <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                                  </button>\n                                  <button *ngIf=\"button.style !== 'mat-icon-button'\" igoStopPropagation mat-mini-fab\n                                      [color]=\"button.color\" (mousedown)=\"onButtonClick(button.click, record)\" [disabled]=\"button.disabled\">\n                                      <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                                  </button>\n                              </ng-container>\n                          </span>\n                      </td>\n                  </ng-container>\n              </ng-container>\n          </ng-container>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"headers; sticky: fixedHeader\" [ngClass]=\"getHeaderClass()\">\n      </tr>\n      <tr mat-row igoEntityTableRow *matRowDef=\"let record; columns: headers;\" [scrollBehavior]=\"scrollBehavior\" [ngClass]=\"getRowClass(record)\" [selection]=\"selection\" [selected]=\"rowIsSelected(record)\" (select)=\"onRowSelect(record)\" (click)=\"onRowClick(record)\">\n      </tr>\n  </table>\n  <igo-entity-table-paginator *ngIf=\"withPaginator\" [store]=\"store\" [paginatorOptions]=\"paginatorOptions\" [entitySortChange$]=\"entitySortChange$\" (paginatorChange)=\"paginatorChange($event)\">\n  </igo-entity-table-paginator>\n</div>","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy,\n  OnChanges,\n  SimpleChanges,\n  ElementRef,\n  Optional,\n  Self\n} from '@angular/core';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport {\n  EntityKey,\n  EntityRecord,\n  EntityState,\n  EntityStore,\n  EntityTableTemplate,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableSelectionState,\n  EntityTableScrollBehavior\n} from '../shared';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\nimport { MatFormFieldControl } from '@angular/material/form-field';\nimport { UntypedFormBuilder, NgControl, NgForm, FormControlName, UntypedFormGroup } from '@angular/forms';\nimport { FocusMonitor } from '@angular/cdk/a11y';\nimport { DateAdapter, ErrorStateMatcher } from '@angular/material/core';\nimport { map } from 'rxjs/operators';\nimport { default as moment } from 'moment';\n\n@Component({\n  selector: 'igo-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [{ provide: MatFormFieldControl, useExisting: EntityTableComponent }]\n})\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\n\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public formGroup: UntypedFormGroup = new UntypedFormGroup({});\n\n  public filteredOptions = {};\n\n  /**\n   * Reference to the column renderer types\n   * @internal\n   */\n  entityTableColumnRenderer = EntityTableColumnRenderer;\n\n  /**\n   * Reference to the selection's state\n   * @internal\n   */\n  entityTableSelectionState = EntityTableSelectionState;\n\n  /**\n   * Observable of the selection,s state\n   * @internal\n   */\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the store's selection\n   */\n  private selection$$: Subscription;\n\n  /**\n   * Subscription to the dataSource\n   */\n  private dataSource$$: Subscription;\n\n  /**\n   * The last record checked. Useful for selecting\n   * multiple records by holding the shift key and checking\n   * checkboxes.\n   */\n  private lastRecordCheckedKey: EntityKey;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Table paginator\n   */\n  @Input() set paginator(value: MatPaginator) {\n    this._paginator = value;\n    this.dataSource.paginator = value;\n  }\n\n  get paginator(): MatPaginator {\n    return this._paginator;\n  }\n  private _paginator: MatPaginator;\n\n  /**\n   * Table template\n   */\n  @Input() template: EntityTableTemplate;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Whether nulls should be first when sorting\n   */\n  @Input()\n  sortNullsFirst: boolean = false;\n\n  /**\n   * Show the table paginator or not. False by default.\n   */\n  @Input()\n  withPaginator: boolean = false;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when an entity (row) is clicked\n   */\n  @Output() entityClick = new EventEmitter<object>();\n\n  /**\n   * Event emitted when an entity (row) is selected\n   */\n  @Output() entitySelectChange = new EventEmitter<{\n    added: object[];\n  }>();\n\n  /**\n   * Event emitted when the table sort is changed.\n   */\n  @Output() entitySortChange: EventEmitter<{column: EntityTableColumn, direction: string}> = new EventEmitter(undefined);\n\n  /**\n   * Table headers\n   * @internal\n   */\n  get headers(): string[] {\n    let columns = this.template.columns\n      .filter((column: EntityTableColumn) => column.visible !== false)\n      .map((column: EntityTableColumn) => column.name);\n\n    if (this.selectionCheckbox === true) {\n      columns = ['selectionCheckbox'].concat(columns);\n    }\n\n    return columns;\n  }\n\n  /**\n   * Data source consumable by the underlying material table\n   * @internal\n   */\n  dataSource = new MatTableDataSource<object>();\n\n  /**\n   * Whether selection is supported\n   * @internal\n   */\n  get selection(): boolean { return this.template.selection || false; }\n\n  /**\n   * Whether a selection checkbox should be displayed\n   * @internal\n   */\n  get selectionCheckbox(): boolean { return this.template.selectionCheckbox || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get selectMany(): boolean { return this.template.selectMany || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get fixedHeader(): boolean { return this.template.fixedHeader === undefined ? true : this.template.fixedHeader; }\n\n  get tableHeight(): string { return this.template.tableHeight ? this.template.tableHeight : 'auto'; }\n\n  constructor(private cdRef: ChangeDetectorRef,\n    private formBuilder: UntypedFormBuilder,\n    protected _focusMonitor: FocusMonitor,\n    protected _elementRef: ElementRef<HTMLElement>,\n    @Optional() @Self() public ngControl: NgControl,\n    @Optional() protected _parentForm: NgForm,\n    @Optional() protected _controlName: FormControlName,\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\n    private dateAdapter: DateAdapter<Date>\n  ) {\n    this.dateAdapter.setLocale('fr-CA');\n  }\n\n  /**\n   * Track the selection state to properly display the selection checkboxes\n   * @internal\n   */\n  ngOnInit() {\n    this.handleDatasource();\n    this.dataSource.paginator = this.paginator;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      this.handleDatasource();\n    }\n  }\n\n  /**\n   * Process text or number value change (edition)\n   */\n  onValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.target.value;\n  }\n\n  /**\n   * Process boolean value change (edition)\n   */\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.checked;\n  }\n\n  /**\n   * Process select value change (edition)\n   */\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.value;\n  }\n\n  /**\n   * Process autocomplete value change (edition)\n   */\n  onAutocompleteValueChange(column: EntityTableColumn, record: EntityRecord<any>, event) {\n    this.formGroup.controls[column.name].setValue(event.option.viewValue);\n    const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n    record.entity.properties[key] = event.option.value;\n  }\n\n  /**\n   * Process date value change (edition)\n   */\n  onDateChange(column: string, record: EntityRecord<any>, event) {\n    const format = \"YYYY-MM-DD\";\n    const value = moment(event.value).format(format);\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = value;\n  }\n\n  /**\n   * Enable edition mode for one row\n   * More than one row can be edited at the same time\n   */\n  private enableEdit(record: EntityRecord<any>) {\n    const item = record.entity.properties || record.entity;\n    this.template.columns.forEach(column => {\n      column.title = column.validation?.mandatory && !column.title.includes('*') ? column.title + ' *' : column.title;\n\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n      if (column.type === 'boolean') {\n        if (!item[key] || item[key] === null) {\n          item[key] = false;\n        } else if (typeof item[key] === 'string') {\n          item[key] = JSON.parse(item[key].toLowerCase());\n        }\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n      } else if (column.type === 'list') {\n        if (column.multiple) {\n          this.formGroup.setControl(column.name, this.formBuilder.control(\n            [item[key]]\n          ));\n        } else {\n          this.formGroup.setControl(column.name, this.formBuilder.control(\n            item[key]\n          ));\n\n          typeof item[key] === 'string' ?\n            this.formGroup.controls[column.name].setValue(parseInt(item[key])) :\n            this.formGroup.controls[column.name].setValue(item[key]);\n        }\n      } else if (column.type === 'autocomplete') {\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n\n        this.filteredOptions[column.name] = new Observable<any[]>();\n        this.filteredOptions[column.name] =\n          this.formGroup.controls[column.name].valueChanges.pipe(\n            map(value => {\n              if (value?.length) {\n                return column.domainValues?.filter((option) => {\n                  const filterNormalized = value ? value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') : '';\n                  const featureNameNormalized = option.value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n                  return featureNameNormalized.includes(filterNormalized);\n                });\n              }\n            })\n          );\n\n        let formControlValue = item[key];\n        column.domainValues.forEach(option => {\n          if (this.isStringValidNumber(formControlValue)) {\n            formControlValue = parseInt(formControlValue);\n          }\n          if (option.value === formControlValue || option.id === formControlValue) {\n            formControlValue = option.value;\n          }\n        });\n\n        this.formGroup.controls[column.name].setValue(formControlValue);\n        if (this.isEdition(record) && column.linkColumnForce) {\n          const entity = record.entity as any;\n          this.formGroup.controls[column.name].setValue(\n            entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)]\n          );\n        }\n      } else if (column.type === 'date') {\n        if (column.visible !== false) {\n          if (item[key]) {\n            let date = moment(item[key]);\n            item[key] = date.utc().format('YYYY-MM-DD');\n            this.formGroup.setControl(column.name, this.formBuilder.control(\n              item[key]\n            ));\n          } else {\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\n            record.entity.properties[newKey] = null;\n            this.formGroup.setControl(column.name, this.formBuilder.control(\n              null\n            ));\n          }\n        }\n      } else {\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n      }\n\n      if (this.formGroup.controls[column.name] && this.getValidationAttributeValue(column, 'readonly')) {\n        this.formGroup.controls[column.name].disable();\n      }\n    });\n  }\n\n  private handleDatasource() {\n    this.unsubscribeStore();\n    this.selection$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const firstSelected = records[0];\n        const firstSelectedStateviewPosition = this.store.stateView.all().indexOf(firstSelected);\n        const pageMax = this.paginator ? this.paginator.pageSize * (this.paginator.pageIndex + 1) : 0;\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\n\n        if (\n          this.paginator &&\n          (firstSelectedStateviewPosition < pageMin ||\n          firstSelectedStateviewPosition >= pageMax)) {\n          const pageToReach = Math.floor(firstSelectedStateviewPosition / this.paginator.pageSize);\n          this.dataSource.paginator.pageIndex = pageToReach;\n        }\n        this.selectionState$.next(this.computeSelectionState(records));\n      });\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\n      if (all[0]) {\n        this.enableEdit(all[0]);\n      }\n      this.dataSource.data = all;\n    });\n\n  }\n\n  /**\n   * Unbind the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unsubscribeStore();\n  }\n\n  private unsubscribeStore() {\n    if (this.selection$$) {\n      this.selection$$.unsubscribe();\n    }\n    if (this.dataSource$$) {\n      this.dataSource$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Trackby function\n   * @param record Record\n   * @param index Record index\n   * @internal\n   */\n  getTrackByFunction() {\n    return (index: number, record: EntityRecord<object, EntityState>) => {\n      return record.ref;\n    };\n  }\n\n  /**\n   * Trigger a refresh of thre table. This can be useful when\n   * the data source doesn't emit a new value but for some reason\n   * the records need an update.\n   * @internal\n   */\n  refresh() {\n    this.cdRef.detectChanges();\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  /**\n   * On sort, sort the store\n   * @param event Sort event\n   * @internal\n   */\n  onSort(event: {active: string, direction: string}) {\n    const direction = event.direction;\n    const column = this.template.columns\n      .find((c: EntityTableColumn) => c.name === event.active);\n\n    if (direction === 'asc' || direction === 'desc') {\n      this.store.stateView.sort({\n        valueAccessor: (record: EntityRecord<object>) => this.getValue(record, column),\n        direction,\n        nullsFirst: this.sortNullsFirst\n      });\n      this.entitySortChange.emit({column, direction});\n      this.entitySortChange$.next(true);\n    } else {\n      this.store.stateView.sort(undefined);\n    }\n  }\n\n  /**\n   * When an entity is clicked, emit an event\n   * @param record Record\n   * @internal\n   */\n  onRowClick(record: EntityRecord<object>) {\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n    this.entityClick.emit(record.entity);\n  }\n\n  /**\n   * When an entity is selected, select it in the store and emit an event. Even if\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\n   * multiple rows should be achieved by using the checkboxes.\n   * @param record Record\n   * @internal\n   */\n  onRowSelect(record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    this.store.state.update(entity, {selected: true}, true);\n    this.entitySelectChange.emit({added: [entity]});\n  }\n\n  /**\n   * Select or unselect all rows at once. On select, emit an event.\n   * @param toggle Select or unselect\n   * @internal\n   */\n  onToggleRows(toggle: boolean) {\n    if (this.selection === false) { return; }\n\n    this.store.state.updateAll({selected: toggle});\n    if (toggle === true) {\n      const entities = this.store.stateView\n        .all()\n        .map((record: EntityRecord<object>) => record.entity);\n      this.entitySelectChange.emit({added: [entities]});\n    }\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    const exclusive = toggle === true && !this.selectMany;\n    this.store.state.update(entity, {selected: toggle}, exclusive);\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: [entity]});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onShiftToggleRow(toggle: boolean, record: EntityRecord<object>, event: MouseEvent) {\n    if (this.selection === false) { return; }\n\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\n      this.onToggleRow(toggle, record);\n      return;\n    }\n\n    // This is a workaround mat checkbox wrong behavior\n    // when the shift key is held.\n    // See https://github.com/angular/components/issues/6232\n    const range = window.document.createRange();\n    range.selectNode(event.target as HTMLElement);\n    window.getSelection().removeAllRanges();\n    window.getSelection().addRange(range);\n    event.stopImmediatePropagation();\n\n    const records = this.store.stateView.all();\n    const recordIndex = records.indexOf(record);\n    const lastRecordChecked = this.store.stateView.get(this.lastRecordCheckedKey);\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\n    const indexes = [recordIndex, lastRecordIndex];\n    const selectRecords = records.slice(Math.min(...indexes), Math.max(...indexes) + 1);\n\n    const entities = selectRecords.map((_record: EntityRecord<object>) => _record.entity);\n    this.store.state.updateMany(entities, {selected: toggle});\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: entities});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * Compute the selection state\n   * @returns Whether all, some or no rows are selected\n   * @internal\n   */\n  private computeSelectionState(selectedRecords: EntityRecord<object>[]): EntityTableSelectionState {\n    const states = EntityTableSelectionState;\n    const selectionCount = selectedRecords.length;\n    return selectionCount === 0 ?\n      states.None :\n      (selectionCount === this.store.stateView.count ? states.All : states.Some);\n  }\n\n  /**\n   * Whether a column is sortable\n   * @param column Column\n   * @returns True if a column is sortable\n   * @internal\n   */\n  columnIsSortable(column: EntityTableColumn): boolean {\n    let sortable = column.sort;\n    if (sortable === undefined) {\n      sortable = this.template.sort === undefined ? false : this.template.sort;\n    }\n    return sortable;\n  }\n\n  /**\n   * Whether a row is should be selected based on the underlying entity state\n   * @param record Record\n   * @returns True if a row should be selected\n   * @internal\n   */\n  rowIsSelected(record: EntityRecord<object>): boolean {\n    const state = record.state;\n    return state.selected ? state.selected : false;\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !== -1\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Method to access an entity's values\n   * @param record Record\n   * @param column Column\n   * @returns Any value\n   * @internal\n   */\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\n    const entity = record.entity;\n    let value;\n    if (column.valueAccessor !== undefined) {\n      return column.valueAccessor(entity, record);\n    }\n    if (this.template.valueAccessor !== undefined) {\n      return this.template.valueAccessor(entity, column.name, record);\n    }\n    value = this.store.getProperty(entity, column.name);\n\n    if (column.type === 'boolean') {\n      if (value === undefined || value === null || value === '') {\n        value = false;\n      } else if (typeof value !== 'boolean' && value !== undefined) {\n        if (typeof value === 'number'){\n          value = Boolean(value);\n        } else {\n          value = JSON.parse(value.toLowerCase());\n        }\n      }\n      if (!this.isEdition(record)){\n        value = value ? '&#10003;' : ''; // check mark\n      }\n    } else if (column.type === 'list' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (column.multiple) {\n        let list_id;\n        typeof value === 'string' ? list_id = value.match(/[\\w.-]+/g).map(Number) : list_id = value;\n        let list_option = [];\n\n        column.domainValues.forEach(option => {\n          if (list_id.includes(option.id)) {\n            if (record.edition) {\n              list_option.push(option.id);\n            } else {\n              list_option.push(option.value);\n            }\n          }\n        });\n\n        this.isEdition(record) ? value = list_id : value = list_option;\n      } else {\n        if (!this.isEdition(record) && column.linkColumnForce) {\n          value = entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)];\n        } else {\n          column.domainValues.forEach(option => {\n            if (this.isStringValidNumber(value)) {\n              value = parseInt(value);\n            }\n            if (option.value === value || option.id === value) {\n              this.isEdition(record) ? value = option.id : value = option.value;\n            }\n          });\n        }\n      }\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (!this.isEdition(record) && column.linkColumnForce) {\n        value = entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)];\n      } else {\n        column.domainValues.forEach(option => {\n          if (this.isStringValidNumber(value)) {\n            value = parseInt(value);\n          }\n          if (option.value === value || option.id === value) {\n            value = option.value;\n          }\n        });\n      }\n    } else if (column.type === 'date') {\n      if (this.isEdition(record)) {\n        if (value) {\n          let date = moment(value);\n          value = date.format();\n          this.formGroup.controls[column.name].setValue(value);\n        }\n      } else if (!this.isEdition(record) && value === null) {\n        value = \"\";\n      }\n    }\n\n    if (value === undefined) {\n      value = '';\n    }\n\n    return value;\n  }\n\n  /**\n   * Method to access an entity's validation values\n   * @param column Column\n   * @param validationType string\n   * @returns Any value (false if no validation or not the one concerned)\n   * @internal\n   */\n  getValidationAttributeValue(column: EntityTableColumn, validationType: string): any {\n    if (column.validation !== undefined && column.validation[validationType] !== undefined) {\n      return column.validation[validationType];\n    } else {\n      return false;\n    }\n  }\n\n  public isEdition(record) {\n    return record.entity.edition ? true : false;\n  }\n\n  /**\n   * Return the type of renderer of a column\n   * @param column Column\n   * @returns Renderer type\n   * @internal\n   */\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\n    if (column.renderer !== undefined) {\n      return column.renderer;\n    }\n    return EntityTableColumnRenderer.Default;\n  }\n\n  /**\n   * Return the table ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getTableClass(): {[key: string]: boolean} {\n    return {\n      'igo-entity-table-with-selection': this.selection\n    };\n  }\n\n  /**\n   * Return a header ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getHeaderClass(): {[key: string]: boolean} {\n    const func = this.template.headerClassFunc;\n    if (func instanceof Function) {\n      return func();\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @returns ngClass\n   * @internal\n   */\n  getRowClass(record: EntityRecord<object>): {[key: string]: boolean} {\n    const entity = record.entity;\n    const func = this.template.rowClassFunc;\n    if (func instanceof Function) {\n      return func(entity, record);\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @param column Column\n   * @returns ngClass\n   * @internal\n   */\n  getCellClass(record: EntityRecord<object>, column: EntityTableColumn): {[key: string]: boolean} {\n    const entity = record.entity;\n    const cls = {};\n\n    const tableFunc = this.template.cellClassFunc;\n    if (tableFunc instanceof Function) {\n      Object.assign(cls, tableFunc(entity, column, record));\n    }\n\n    const columnFunc = column.cellClassFunc;\n    if (columnFunc instanceof Function) {\n      Object.assign(cls, columnFunc(entity, record));\n    }\n\n    return cls;\n  }\n\n  /**\n   * When a button is clicked\n   * @param func Function\n   * @param record Record\n   * @internal\n   */\n  onButtonClick(\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\n    record: EntityRecord<object>\n  ) {\n    this.enableEdit(record);\n    if (typeof clickFunc === 'function') {\n      clickFunc(record.entity, record);\n    }\n  }\n\n  /**\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\n   */\n  public getColumnKeyWithoutPropertiesTag(column: string) {\n    if (column.includes('properties.')) {\n      return column.split('.')[1];\n    }\n    return column;\n  }\n  /**\n   * Check if string is a valid number\n   * @param value string\n   * @returns boolean\n   */\n  private isStringValidNumber(value: string): boolean {\n    return typeof value === 'string' && /^\\d+$/.test(value) && (value.length > 1 && value.charAt(0) !== '0');\n  }\n}\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","<mat-list-item *ngIf=\"!action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\">\n  <button *ngIf=\"withIcon\"\n    mat-list-avatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\">\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{icon$ | async}}\"></mat-icon>\n  </button>\n  <h4 *ngIf=\"withTitle\" matLine>{{title | translate}}</h4>\n</mat-list-item>\n\n<mat-list-item class=\"item-checkbox\" *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\">\n  <mat-checkbox *ngIf=\"withTitle\"\n      (change)=\"action.handler()\"\n      [checked]=\"checkCondition$ | async\">\n      {{title | translate}}\n  </mat-checkbox>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\n\nimport { Action } from '../shared/action.interfaces';\n\n /**\n  * An action button\n  */\n@Component({\n  selector: 'igo-actionbar-item',\n  templateUrl: './actionbar-item.component.html',\n  styleUrls: ['./actionbar-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\n\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly ngClass$: BehaviorSubject<{[key: string]: boolean}> = new BehaviorSubject({});\n\n  private ngClass$$: Subscription;\n\n  private disabled$$: Subscription;\n\n  private availability$$: Subscription;\n\n  private icon$$: Subscription;\n\n  private checkCondition$$: Subscription;\n\n  private tooltip$$: Subscription;\n\n  private noDisplay$$: Subscription;\n\n  private display$$: Subscription;\n\n  /**\n   * Action\n   */\n  @Input() action: Action;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Whether the action title is displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether the action icon is displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Whether a tooltip should be shown\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether the action is disabled\n   */\n  @Input()\n  set disabled(value: boolean) { this.disabled$.next(value); }\n  get disabled(): boolean { return this.disabled$.value; }\n\n  /**\n   * Whether the action is display or not\n   */\n  @Input()\n  set noDisplay(value: boolean) { this.noDisplay$.next(value); }\n  get noDisplay(): boolean { return this.noDisplay$.value; }\n\n  /**\n   * Event emitted when the action button is clicked\n   */\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return this.action.title; }\n\n  constructor() {}\n\n  ngOnInit() {\n    const args = this.action.args || [];\n\n    if (this.action.ngClass !== undefined) {\n      this.ngClass$$ = this.action.ngClass(...args)\n        .subscribe((ngClass: {[key: string]: boolean}) => this.updateNgClass(ngClass));\n    }\n\n    if (isObservable(this.action.icon)) {\n      this.icon$$ = this.action.icon\n        .subscribe((icon: string) => this.updateIcon(icon));\n    } else {\n      this.updateIcon(this.action.icon);\n    }\n\n    if (isObservable(this.action.checkCondition)) {\n      this.checkCondition$$ = this.action.checkCondition\n        .subscribe((checkCondition: boolean) => this.updateCheckCondition(checkCondition));\n    } else {\n      this.updateCheckCondition(this.action.checkCondition);\n    }\n\n    if (isObservable(this.action.tooltip)) {\n      this.tooltip$$ = this.action.tooltip\n        .subscribe((tooltip: string) => this.updateTooltip(tooltip));\n    } else {\n      this.updateTooltip(this.action.tooltip);\n    }\n\n    if (this.action.availability !== undefined) {\n      this.availability$$ = this.action.availability(...args)\n        .subscribe((available: boolean) => this.disabled = !available);\n    }\n\n    this.disabled$$ = this.disabled$\n      .subscribe((disabled: boolean) => this.updateNgClass({'igo-actionbar-item-disabled': disabled}));\n\n    if (this.action.display !== undefined) {\n      this.display$$ = this.action.display(...args)\n        .subscribe((display: boolean) => this.noDisplay = !display);\n    }\n\n    this.noDisplay$$ = this.noDisplay$\n      .subscribe((noDisplay: boolean) => this.updateNgClass({'igo-actionbar-item-no-display': noDisplay}));\n  }\n\n  ngOnDestroy() {\n    if (this.ngClass$$ !== undefined) {\n      this.ngClass$$.unsubscribe();\n      this.ngClass$$ = undefined;\n    }\n\n    if (this.availability$$ !== undefined) {\n      this.availability$$.unsubscribe();\n      this.availability$$ = undefined;\n    }\n\n    if (this.display$$ !== undefined) {\n      this.display$$.unsubscribe();\n      this.display$$ = undefined;\n    }\n\n    if (this.checkCondition$$ !== undefined) {\n      this.checkCondition$$.unsubscribe();\n      this.checkCondition$$ = undefined;\n    }\n\n    if (this.icon$$ !== undefined) {\n      this.icon$$.unsubscribe();\n      this.icon$$ = undefined;\n    }\n\n    if (this.tooltip$$ !== undefined) {\n      this.tooltip$$.unsubscribe();\n      this.tooltip$$ = undefined;\n    }\n\n    this.disabled$$.unsubscribe();\n    this.noDisplay$$.unsubscribe();\n  }\n\n  /**\n   * When the action button is clicked, emit the 'trigger' event but don't\n   * invoke the action handler. This is handled by the parent component.\n   * @internal\n   */\n  onClick() {\n    if (this.disabled === true) {\n      return;\n    }\n    this.trigger.emit(this.action);\n  }\n\n  private updateNgClass(ngClass: {[key: string]: boolean}) {\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\n  }\n\n  private updateTooltip(tooltip: string) {\n    this.tooltip$.next(tooltip);\n  }\n\n  private updateCheckCondition(checkCondition: boolean) {\n    this.checkCondition$.next(checkCondition);\n  }\n\n  private updateIcon(icon: string) {\n    this.icon$.next(icon);\n  }\n}\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\">\n\n    <div *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n      id=\"topChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n        (click)=\"scrollUp()\">\n        <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n      </button>\n    </div>\n\n    <igo-actionbar-item\n      *ngIf=\"withToggleButton\"\n      color=\"accent\"\n      [withTitle]=\"false\"\n      [withIcon]=\"true\"\n      [color]=\"color\"\n      [disabled]=\"store.view.empty\"\n      [action]=\"toggleCollapseAction\"\n      (trigger)=\"onTriggerAction(toggleCollapseAction)\">\n    </igo-actionbar-item>\n\n    <ng-template #buttonContent *ngIf=\"!collapsed\" ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [withTooltip]=\"withTooltip\"\n        [color]=\"color\"\n        [disabled]=\"store.state.get(action).disabled\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\">\n      </igo-actionbar-item>\n    </ng-template>\n\n    <div *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n      id=\"lowChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n        (click)=\"scrollDown()\">\n        <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n      </button>\n    </div>\n\n</mat-list>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\">\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\">\n\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\">\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card *ngIf=\"mode === actionbarMode.Context\" class=\"context-menu-card mat-elevation-z4\">\n  <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n          <igo-actionbar-item\n            color=\"accent\"\n            [withTitle]=\"withTitle\"\n            [withIcon]=\"withIcon\"\n            [color]=\"color\"\n            [action]=\"action\"\n            (trigger)=\"onTriggerAction(action)\">\n          </igo-actionbar-item>\n        <br/>\n      </ng-template>\n  </mat-list>\n</mat-card>\n","import {\n  Component,\n  Input,\n  HostBinding,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ElementRef\n} from '@angular/core';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { EntityStoreWatcher } from '../../entity';\nimport { Action } from '../shared/action.interfaces';\nimport { ActionbarMode } from '../shared/action.enums';\nimport { ActionStore } from '../shared/store';\nimport { Overlay } from '@angular/cdk/overlay';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * A list of action buttons.\n * This component can be displayed in one of two way: 'dock' or 'overlay'\n */\n@Component({\n  selector: 'igo-actionbar',\n  templateUrl: './actionbar.component.html',\n  styleUrls: ['./actionbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarComponent implements OnDestroy, OnChanges {\n\n  /**\n   * Reference to the ActionbarMode enum for use in the template\n   * @internal\n   */\n  actionbarMode = ActionbarMode;\n\n  /**\n   * Whether the actionbar is collapsed (Dock mode)\n   * @internal\n   */\n  collapsed = false;\n\n  /**\n   * Toggle collapse action (Dock)\n   * @internal\n   */\n  toggleCollapseAction = {\n    id: 'actionbar_toggle',\n    icon: 'dots-vertical',\n    handler: () => {\n      this.collapsed = !this.collapsed;\n    }\n  };\n\n  /**\n   * Action store watcher\n   * @internal\n   */\n  private watcher: EntityStoreWatcher<Action>;\n\n  /**\n   * Height Condition for scroll button\n   */\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Position Condition for top scroll button\n   */\n  positionConditionTop$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Position Condition for low scroll button\n   */\n  positionConditionLow$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Action store\n   */\n  @Input() store: ActionStore;\n\n  /**\n   * Actionbar mode\n   */\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\n\n  /**\n   * Whether a toggle button should be displayed (Dock mode)\n   */\n  @Input() withToggleButton = false;\n\n  /**\n   * Whether a the actionbar should display buttons horizontally\n   */\n  @Input() horizontal = false;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Color of the button if action mode === overlay\n   */\n  @Input() iconColor = 'default';\n\n  /**\n   * Whether action titles are displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether action tooltips are displayed\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether action titles are displayed (condition for scroll button)\n   */\n  @Input() scrollActive = true;\n\n  /**\n   * Whether action icons are displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Which icon want to be shown\n   */\n  @Input() icon = 'dots-horizontal';\n\n  /**\n   * Overlay X position\n   */\n  @Input() xPosition = 'before';\n\n  /**\n   * Overlay Y position\n   */\n  @Input() yPosition = 'above';\n\n  /**\n   * Class to add to the actionbar overlay\n   */\n  @Input()\n  set overlayClass(value: string) {\n    this._overlayClass = value;\n  }\n  get overlayClass(): string {\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\n  }\n  private _overlayClass = '';\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-title')\n  get withTitleClass() {\n    return this.withTitle;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-icon')\n  get withIconClass() {\n    return this.withIcon;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.horizontal')\n  get horizontalClass() {\n    return this.horizontal;\n  }\n\n  get heightCondition(): boolean {\n    const el = this.elRef.nativeElement;\n    if (this.scrollActive === false) {\n      if (el.clientHeight < el.scrollHeight) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get positionConditionTop(): boolean {\n    if (this.elRef.nativeElement.scrollTop === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get positionConditionLow(): boolean {\n    const el = this.elRef.nativeElement;\n    if (el.scrollTop >= (el.scrollHeight - el.clientHeight)) {\n      return false;\n    }\n    return true;\n  }\n\n  get isDesktop(): boolean {\n    return this.mediaService.getMedia() === Media.Desktop;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef,\n    public mediaService: MediaService) {}\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      if (this.watcher !== undefined) {\n        this.watcher.destroy();\n      }\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * Invoke the action handler\n   * @internal\n   */\n  onTriggerAction(action: Action) {\n    const args = action.args || [];\n    action.handler(...args);\n  }\n\n  scrollDown() {\n    this.elRef.nativeElement.scrollBy(0, 52);\n  }\n\n  scrollUp() {\n    this.elRef.nativeElement.scrollBy(0, -52);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ActionbarComponent } from './actionbar.component';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatListModule,\n    MatCardModule,\n    MatCheckboxModule\n  ],\n  exports: [ActionbarComponent],\n  declarations: [ActionbarComponent, ActionbarItemComponent]\n})\nexport class IgoActionbarModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    IgoActionbarModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoActionModule {}\n","import { Directive, Input, ElementRef, OnInit } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\n\n\n/**\n * This directive allow to add an icon inside a matBadge.\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\n * The badge content will be overrided by this current directive.\n */\n@Directive({\n  selector: '[igoMatBadgeIcon]'\n})\nexport class IgoBadgeIconDirective implements OnInit {\n  @Input()\n  set igoMatBadgeIcon(value: string) {\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\n      this.svg = svgObj;\n      this.updateSvg();\n    });\n  }\n  private svg: SVGElement;\n\n  @Input()\n  set matBadgeHidden(value: boolean) {\n    this.hidden = value;\n    this.updateHidden();\n  }\n  private hidden = false;\n\n  @Input()\n  set matBadgeDisabled(value: boolean) {\n    this.disabled = value;\n    this.updateDisabled();\n  }\n  private disabled = false;\n\n  @Input()\n  set igoMatBadgeInverseColor(value: boolean) {\n    this.inverseColor = value;\n    this.updateColor();\n  }\n  private inverseColor = false;\n\n  @Input()\n  set igoMatBadgeInheritColor(value: boolean) {\n    this.inheritColor = value;\n    this.updateColor();\n  }\n  private inheritColor = false;\n\n  @Input()\n  set igoMatBadgeColor(value: string) {\n    this.color = value;\n    this.updateColor();\n  }\n  private color;\n\n  @Input()\n  set igoMatBadgeBackgroundColor(value: string) {\n    this.backgroundColor = value;\n    this.updateColor();\n  }\n  private backgroundColor;\n\n  get badge() {\n    return this.el.nativeElement.querySelector('.mat-badge-content');\n  }\n\n  private originalColor: string;\n\n  constructor(\n    private el: ElementRef,\n    private matIconRegistry: MatIconRegistry\n  ) {}\n\n  ngOnInit() {\n    this.badge.style.alignItems = 'center';\n    this.badge.style.justifyContent = 'center';\n\n    this.updateHidden();\n    this.updateColor();\n    this.updateSvg();\n  }\n\n  private updateSvg() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.innerHTML = '';\n    if (this.svg) {\n      this.badge.appendChild(this.svg);\n    }\n  }\n  private updateColor() {\n    if (!this.badge) {\n      return;\n    }\n\n    if (this.color || this.backgroundColor) {\n      this.badge.style.color = this.color ? this.color : '';\n      this.badge.style.background = this.backgroundColor ? this.backgroundColor : '';\n    } else if (this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = 'currentColor';\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = 'currentColor';\n      }\n    } else if (!this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = window\n          .getComputedStyle(this.badge, null)\n          .getPropertyValue('background-color');\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = '';\n      }\n    }\n    this.originalColor = this.badge.style.color;\n    this.updateDisabled();\n  }\n\n  private updateHidden() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\n  }\n\n  private updateDisabled() {\n    if (!this.badge || !this.inverseColor) {\n      return;\n    }\n    if (this.disabled) {\n      this.originalColor = this.badge.style.color;\n      this.badge.style.color = '#b9b9b9';\n    } else {\n      this.badge.style.color = this.originalColor;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\n\n@NgModule({\n  imports: [MatBadgeModule, MatIconModule],\n  declarations: [IgoBadgeIconDirective],\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\n})\nexport class IgoMatBadgeIconModule {\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\n    return {\n      ngModule: IgoMatBadgeIconModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]'\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ClickoutDirective } from './clickout.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ClickoutDirective],\n  exports: [ClickoutDirective]\n})\nexport class IgoClickoutModule {\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\n    return {\n      ngModule: IgoClickoutModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  HostListener,\n  ElementRef,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoCollapse]'\n})\nexport class CollapseDirective {\n  @Input()\n  get target() {\n    return this._target;\n  }\n  set target(value: Element) {\n    this._target = value;\n  }\n  private _target: Element;\n\n  @Input()\n  get collapsed(): boolean {\n    return this._collapsed;\n  }\n  set collapsed(collapsed: boolean) {\n    collapsed ? this.collapseTarget() : this.expandTarget();\n    this._collapsed = collapsed;\n    this.toggle.emit(collapsed);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n\n  @HostListener('click')\n  click() {\n    this.collapsed = !this.collapsed;\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  private collapseTarget() {\n    this.renderer.addClass(this.target, 'igo-collapsed');\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\n  }\n\n  private expandTarget() {\n    this.renderer.removeClass(this.target, 'igo-collapsed');\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\n  }\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss']\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\n  <mat-icon\n    svgIcon=\"chevron-up\" \n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\">\n  </mat-icon>\n  <h4 matLine>{{title}}</h4>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\nimport { CollapsibleComponent } from './collapsible.component';\n\n@NgModule({\n  imports: [MatIconModule, MatListModule],\n  declarations: [CollapsibleComponent, CollapseDirective],\n  exports: [CollapsibleComponent, CollapseDirective]\n})\nexport class IgoCollapsibleModule {\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\n    return {\n      ngModule: IgoCollapsibleModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss']\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">{{'igo.common.confirmDialog.title' | translate}}</h2>\n<div mat-dialog-content class=\"mat-typography\">{{confirmMessage}}</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">{{'igo.common.confirmDialog.confirmBtn' | translate}}</button>\n  <button mat-button (click)=\"dialogRef.close(false)\">{{'igo.common.confirmDialog.cancelBtn' | translate}}</button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { LanguageService } from '@igo2/core';\n\nimport { Observable } from 'rxjs';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\n\n@Injectable()\nexport class ConfirmDialogService {\n  constructor(private dialog: MatDialog, private languageService: LanguageService) {}\n\n  public open(message: string): Observable<any> {\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.confirmMessage = this.languageService.translate.instant(message);\n\n    return dialogRef.afterClosed();\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\n  declarations: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  ViewContainerRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\n\n@Directive({\n  selector: '[igoContextMenu]'\n})\nexport class ContextMenuDirective {\n  private overlayRef: OverlayRef | null;\n  private sub: Subscription;\n\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\n\n  constructor(\n    public overlay: Overlay,\n    public viewContainerRef: ViewContainerRef,\n    private elementRef: ElementRef\n  ) {}\n\n  @HostListener('longpress', ['$event'])\n  @HostListener('contextmenu', ['$event'])\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\n    let x;\n    let y;\n    if (e instanceof TouchEvent) {\n      x = e.touches[0].pageX;\n      y = e.touches[0].pageY;\n    } else if (e instanceof MouseEvent) {\n      x = e.x;\n      y = e.y;\n    }\n    if (!x || !y) {\n      return;\n    }\n\n    this.close();\n    e.preventDefault();\n    this.menuPosition.emit({ x, y });\n    this.overlayRef = null;\n    const positionStrategy = this.overlay\n      .position()\n      .flexibleConnectedTo({ x, y })\n      .withPositions([\n        {\n          originX: 'end',\n          originY: 'bottom',\n          overlayX: 'start',\n          overlayY: 'top'\n        }\n      ]);\n    this.overlayRef = this.overlay.create({\n      positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close()\n    });\n    this.overlayRef.attach(\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\n        $implicit: undefined\n      })\n    );\n\n    this.sub = fromEvent<MouseEvent>(document, 'click')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          this.close();\n          return (\n            !!this.overlayRef &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          );\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          if (\n            clickTarget &&\n            !this.elementRef.nativeElement.contains(clickTarget) &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          ) {\n            return true;\n          } else {\n            event.preventDefault();\n          }\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n  }\n\n  close() {\n    if (this.overlayRef) {\n      this.overlayRef.dispose();\n      this.overlayRef = null;\n    }\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n}\n","import { Directive, HostListener, Output, EventEmitter, Input } from '@angular/core';\nimport { userAgent } from '@igo2/utils';\n\n\n/**\n * IgoLongPress trigger longpress event after a define duration.\n * This directive exist to patch the unavailable contextmenu event on iOS.\n * @param touchDuration touch duration in ms, default value is 400ms\n * @param iOSOnly define if longpress is triggered only for iOS, default value = true\n */\n@Directive({\n  selector: '[igoLongPress]'\n})\nexport class LongPressDirective {\n  private touchTimeout: any;\n  @Input() touchDuration: number = 400;\n  @Input() onlyIOS: boolean = true;\n  @Output() longpress = new EventEmitter();\n\n  constructor() { }\n\n\n  @HostListener('touchstart', ['$event'])\n  public touchstart(e: TouchEvent) {\n    if (e.touches.length > 1) {\n      this.touchEnd();\n      return;\n    }\n    this.touchTimeout = setTimeout(() => {\n      if (this.onlyIOS) {\n        if (userAgent.getOSName() === 'iOS') {\n          this.longpress.emit(e);\n        }\n      } else {\n        this.longpress.emit(e);\n      }\n    }, this.touchDuration);\n  }\n  @HostListener('touchmove')\n  @HostListener('touchcancel')\n  @HostListener('touchend')\n  public touchend() {\n    this.touchEnd();\n  }\n\n\n  private touchEnd() {\n    clearTimeout(this.touchTimeout);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ContextMenuDirective } from './context-menu.directive';\nimport { LongPressDirective } from './long-press.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ContextMenuDirective, LongPressDirective],\n  exports: [ContextMenuDirective, LongPressDirective]\n})\nexport class IgoContextMenuModule {\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\n    return {\n      ngModule: IgoContextMenuModule,\n      providers: []\n    };\n  }\n}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-custom-html',\n  templateUrl: './custom-html.component.html',\n  styleUrls: ['./custom-html.component.scss']\n})\nexport class CustomHtmlComponent {\n  @Input()\n  get html(): string {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = value;\n  }\n  private _html = '';\n\n  constructor() {}\n}\n","<div class=\"custom-html\" [innerHTML]=\"html | sanitizeHtml\"></div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { CustomHtmlComponent } from './custom-html.component';\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ],\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\n})\nexport class IgoCustomHtmlModule {\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\n    return {\n      ngModule: IgoCustomHtmlModule\n    };\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { catchError, map } from 'rxjs/operators';\nimport { throwError } from 'rxjs';\n\nimport { DOMOptions, DOMValue } from './dom.interfaces';\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DOMService {\n\n  constructor(private http: HttpClient) {}\n\n  async getDom(dom: DOMOptions): Promise<DOMValue[]> {\n    const url = dom.url;\n    let result: DOMValue[];\n\n    await this.http.get<any>(url).pipe(\n      map(response => {\n        result = response;\n        return response;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        return throwError(err);\n      })\n    ).toPromise();\n\n    return result;\n  }\n\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DOMService } from './dom.service';\n\n@NgModule({\n  providers: [DOMService]\n})\nexport class IgoDOMModule {\n  static forRoot(): ModuleWithProviders<IgoDOMModule> {\n    return {\n      ngModule: IgoDOMModule,\n      providers: [\n        DOMService\n      ]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { DragAndDropDirective } from './drag-drop.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [DragAndDropDirective],\n  exports: [DragAndDropDirective]\n})\nexport class IgoDrapDropModule {\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\n    return {\n      ngModule: IgoDrapDropModule,\n      providers: []\n    };\n  }\n}\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: {[key: string]: any} = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: {[key: string]: Subscription} = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: {[key: string]: (event: any) => void} = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: {[key: string]: any}) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n\n      this.unobserveInput(key);\n\n      const inputValue = inputs[key];\n      if (inputs.hasOwnProperty(key)) {\n        if (inputValue instanceof Observable) {\n          this.observeInput(key, inputValue);\n        } else {\n          this.setInputValue(instance, key, inputValue);\n        }\n      }\n    });\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: {[key: string]: (event: any) => void}) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n      if (subscribers.hasOwnProperty(key)) {\n        const emitter = instance[key];\n        const subscriber = subscribers[key];\n        if (Array.isArray(subscriber)) {\n          subscriber.forEach((_subscriber) => {\n            this.subscriptions.push(emitter.subscribe(_subscriber));\n          });\n        } else {\n          this.subscriptions.push(emitter.subscribe(subscriber));\n        }\n      }\n    });\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n\n}\n","import {\n  ComponentFactoryResolver,\n  Injectable\n} from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import {\n  Input,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  Component,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewContainerRef,\n  ViewChild\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (!component || !component.currentValue) {\n      return;\n    }\n\n    if (component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    DynamicOutletComponent\n  ],\n  declarations: [\n    DynamicOutletComponent\n  ]\n})\nexport class IgoDynamicOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\nimport { DynamicComponentService } from './shared/dynamic-component.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    IgoDynamicOutletModule\n  ],\n  providers: [\n    DynamicComponentService\n  ]\n})\nexport class IgoDynamicComponentModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FlexibleComponent } from './flexible.component';\n\n@NgModule({\n  imports: [],\n  declarations: [FlexibleComponent],\n  exports: [FlexibleComponent]\n})\nexport class IgoFlexibleModule {\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\n    return {\n      ngModule: IgoFlexibleModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnChanges,\n  SimpleChanges,\n  ChangeDetectionStrategy,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\n\nimport { t } from 'typy';\n\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getAllFormFields } from '../shared/form.utils';\n\n/**\n * A configurable form\n */\n@Component({\n  selector: 'igo-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormComponent implements OnChanges {\n\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Input data\n   */\n  @Input() formData: { [key: string]: any};\n\n  /**\n   * Form autocomplete\n   */\n  @Input() autocomplete: string = 'off';\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<{[key: string]: any}>();\n\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\n\n  get hasButtons(): boolean {\n    return this.buttons.nativeElement.children.length !== 0;\n  }\n\n  constructor() {}\n\n  /**\n   * Is the entity or the template change, recreate the form or repopulate it.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const formData = changes.formData;\n    if (formData && formData.currentValue !== formData.previousValue) {\n      if (formData.currentValue === undefined) {\n        this.clear();\n      } else {\n        this.setData(formData.currentValue);\n      }\n    }\n  }\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit() {\n    this.submitForm.emit(this.getData());\n  }\n\n  getData(): { [key: string]: any} {\n    const data = {};\n    getAllFormFields(this.form).forEach((field: FormField) => {\n      this.updateDataWithFormField(data, field);\n    });\n    return data;\n  }\n\n  private setData(data: {[key: string]: any}) {\n    this.form.fields.forEach((field: FormField) => {\n      field.control.setValue(t(data, field.name).safeObject);\n    });\n\n    this.form.groups.forEach((group: FormFieldGroup) => {\n      group.fields.forEach((field: FormField) => {\n        field.control.setValue(t(data, field.name).safeObject);\n      });\n    });\n  }\n\n  private updateDataWithFormField(data: { [key: string]: any}, field: FormField) {\n    const control = field.control;\n    if (!control.disabled) {\n      data[field.name] = control.value;\n    }\n  }\n\n  /**\n   * Clear form\n   */\n  private clear() {\n    this.form.control.reset();\n  }\n\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find((key: string) => {\n      return formControlIsRequired((control as any).controls[key]);\n    });\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): {[key: string]: string} {\n  return {\n    required: 'igo.common.form.errors.required'\n  };\n}\n\nexport function getControlErrorMessage(control: AbstractControl, messages: {[key: string]: string}): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","\n<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\">\n  <div class=\"igo-form-body\" [ngClass]=\"{'igo-form-body-with-buttons': hasButtons}\">\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { FormComponent } from './form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  exports: [\n    FormComponent,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  declarations: [\n    FormComponent\n  ]\n})\nexport class IgoFormFormModule {}\n","import { Injectable } from '@angular/core';\nimport { UntypedFormBuilder, Validators, ValidatorFn } from '@angular/forms';\n\nimport {\n  Form,\n  FormField,\n  FormFieldConfig,\n  FormFieldGroup,\n  FormFieldGroupConfig\n} from './form.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormService {\n\n  constructor(private formBuilder: UntypedFormBuilder) {}\n\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n    groups.forEach((group: FormFieldGroup) => {\n      control.addControl(group.name, group.control);\n    });\n\n    return {fields, groups, control};\n  }\n\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\n    const options = config.options || {};\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({}, config, {fields, control}) as FormFieldGroup;\n  }\n\n  field(config: FormFieldConfig): FormField {\n    const options = config.options || {};\n    const state = {\n      value: '',\n      disabled: options.disabled\n    };\n    const control = this.formBuilder.control(state);\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({type: 'text'}, config, {control}) as FormField;\n  }\n\n  extendFieldConfig(config: FormFieldConfig, partial: Partial<FormFieldConfig>): FormFieldConfig {\n    const options = Object.assign({}, config.options || {}, partial.options || {});\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\n    const subscribers = Object.assign({}, config.subscribers || {}, partial.subscribers || {});\n    return Object.assign({}, config, {options, inputs, subscribers});\n  }\n\n  private getValidators(validatorOption: string | string[] | ValidatorFn): ValidatorFn | ValidatorFn[] {\n    if (Array.isArray(validatorOption)) {\n      return validatorOption.map((validatorStr) => {\n        return this.getValidator(validatorStr);\n      });\n    }\n\n    return this.getValidator(validatorOption);\n  }\n\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\n    if (typeof validatorStr !== 'string') {\n      return validatorStr;\n    }\n\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\n    const match = validatorStr.match(re);\n\n    if (!match) {\n      return Validators[validatorStr];\n    }\n\n    const name = match[1];\n    const args = match[2];\n    return Validators[name](args);\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n\n  static fields: {[key: string]: any} = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n\n}\n","\n\n<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\">\n  </igo-dynamic-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { FormField, FormFieldInputs, FormFieldOptions } from '../shared/form.interfaces';\nimport { FormFieldService } from '../shared/form-field.service';\nimport { getDefaultErrorMessages } from '../shared';\n\n/**\n * This component renders the proper form input based on\n * the field configuration it receives.\n */\n@Component({\n  selector: 'igo-form-field',\n  templateUrl: './form-field.component.html',\n  styleUrls: ['./form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldComponent {\n\n  /**\n   * Field configuration\n   */\n  @Input() field: FormField;\n\n  /**\n   * Field inputs cache\n   */\n  private fieldInputs: FormFieldInputs = undefined;\n\n  /**\n   * Field subscribers cache\n   */\n  private fieldSubscribers: {[key: string]: ({field: FormField, control: FormControl}) => void } = undefined;\n\n  get fieldOptions(): FormFieldOptions {\n    return this.field.options || {};\n  }\n\n  constructor(private formFieldService: FormFieldService) {}\n\n  getFieldComponent(): any {\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\n  }\n\n  getFieldInputs(): FormFieldInputs {\n    if (this.fieldInputs !== undefined) {\n      return this.fieldInputs;\n    }\n\n    const errors = this.fieldOptions.errors || {};\n    this.fieldInputs = Object.assign(\n      {\n        placeholder: this.field.title,\n        disableSwitch: this.fieldOptions.disableSwitch || false\n      },\n      Object.assign({}, this.field.inputs || {}),\n      {\n        formControl: this.field.control,\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\n      }\n    );\n    return this.fieldInputs;\n  }\n\n  getFieldSubscribers(): {[key: string]: ({field: FormField, control: FormControl}) => void } {\n    if (this.fieldSubscribers !== undefined) {\n      return this.fieldSubscribers;\n    }\n\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\n    return this.fieldSubscribers;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\n\nimport { FormFieldComponent } from './form-field.component';\nimport { FormFieldSelectComponent } from './form-field-select.component';\nimport { FormFieldTextComponent } from './form-field-text.component';\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    IgoLanguageModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ],\n  declarations: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ]\n})\nexport class IgoFormFieldModule {}\n","<div\n  *ngIf=\"group && group.fields.length > 0\"\n  class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\">\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{getErrorMessage() | translate}}</mat-error>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { UntypedFormGroup } from '@angular/forms';\n\nimport { getControlErrorMessage } from '../shared/form.utils';\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\n\n/**\n * A configurable form, optionnally bound to an entity\n * (for example in case of un update). Submitting that form\n * emits an event with the form data but no other operation is performed.\n */\n@Component({\n  selector: 'igo-form-group',\n  templateUrl: './form-group.component.html',\n  styleUrls: ['./form-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormGroupComponent {\n\n  /**\n   * Form field group\n   */\n  @Input() group: FormFieldGroup;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: {[key: string]: string};\n\n  /**\n   * Form group control\n   */\n  get formControl(): UntypedFormGroup { return this.group.control; }\n\n  constructor() {}\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldColSpan(field: FormField): number {\n    let colSpan = 2;\n    const options = field.options || {};\n    if (options.cols && options.cols > 0) {\n      colSpan = Math.min(options.cols, 2);\n    }\n\n    return colSpan;\n  }\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldNgClass(field: FormField): {[key: string]: boolean} {\n    const colspan = this.getFieldColSpan(field);\n    return {[`igo-form-field-colspan-${colspan}`]: true};\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    const options = this.group.options || {};\n    return getControlErrorMessage(this.formControl, options.errors || {});\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\nimport { FormGroupComponent } from './form-group.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatFormFieldModule,\n    IgoLanguageModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    FormGroupComponent\n  ],\n  declarations: [\n    FormGroupComponent\n  ]\n})\nexport class IgoFormGroupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormFormModule } from './form/form.module';\nimport { IgoFormGroupModule } from './form-group/form-group.module';\nimport { IgoFormFieldModule } from './form-field/form-field.module';\nimport { FormService } from './shared/form.service';\nimport { FormFieldService } from './shared/form-field.service';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    IgoFormFormModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  declarations: [],\n  providers: [\n    FormService,\n    FormFieldService\n  ]\n})\nexport class IgoFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { EntitySelectorComponent } from './entity-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatSelectModule\n  ],\n  exports: [EntitySelectorComponent],\n  declarations: [EntitySelectorComponent]\n})\nexport class IgoEntitySelectorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\nimport { StopPropagationDirective } from './stop-propagation.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\n})\nexport class IgoStopPropagationModule {\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\n    return {\n      ngModule: IgoStopPropagationModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    MatPaginatorModule,\n  ],\n  exports: [\n    EntityTablePaginatorComponent\n  ],\n  declarations: [\n    EntityTablePaginatorComponent,\n  ]\n})\nexport class IgoEntityTablePaginatorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ImageErrorDirective } from './image-error.directive';\nimport { SecureImagePipe } from './secure-image.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [SecureImagePipe, ImageErrorDirective],\n  exports: [SecureImagePipe, ImageErrorDirective]\n})\nexport class IgoImageModule {\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\n    return {\n      ngModule: IgoImageModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\nimport { EntityTableRowDirective } from './entity-table-row.directive';\nimport { EntityTableComponent } from './entity-table.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\nimport { IgoImageModule } from '../../image/image.module';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatSelectModule } from '@angular/material/select';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTableModule,\n    MatAutocompleteModule,\n    MatSortModule,\n    MatIconModule,\n    MatButtonModule,\n    MatCheckboxModule,\n    MatPaginatorModule,\n    MatSelectModule,\n    IgoStopPropagationModule,\n    IgoCustomHtmlModule,\n    IgoEntityTablePaginatorModule,\n    IgoImageModule,\n    IgoLanguageModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatDatepickerModule,\n    MatTooltipModule\n  ],\n  exports: [\n    EntityTableComponent\n  ],\n  declarations: [\n    EntityTableComponent,\n    EntityTableRowDirective\n  ]\n})\nexport class IgoEntityTableModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoEntitySelectorModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  declarations: []\n})\nexport class IgoEntityModule {}\n","import { catchError } from 'rxjs/operators';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Injectable } from '@angular/core';\nimport { InteractiveTourOptions } from './interactive-tour.interface';\nimport { ConfigService } from '@igo2/core';\n\n@Injectable()\nexport class InteractiveTourLoader {\n  private jsonURL: string;\n  private allToursOptions;\n\n  constructor(private http: HttpClient, private configService: ConfigService) {\n    this.jsonURL = this.getPathToConfigFile();\n  }\n\n   public loadConfigTour() {\n      this.getJSON()\n        .subscribe(\n          (data) => {\n            this.allToursOptions = data;\n          },\n          (err) => {\n            throw new Error(`Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`);\n          }\n        );\n   }\n\n  public getPathToConfigFile(): string {\n    return (\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\n      './config/interactiveTour.json'\n    );\n  }\n\n  public getJSON(): Observable<any> {\n    return this.http.get(this.jsonURL).pipe(\n      catchError((e) => {\n        e.error.caught = true;\n        throw e;\n      })\n    );\n  }\n\n  public getTourOptionData(toolName): InteractiveTourOptions {\n    if (this.allToursOptions === undefined) {\n      return undefined;\n    }\n    let nameInConfigFile = toolName;\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\n    return this.allToursOptions[nameInConfigFile];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ShepherdService } from 'angular-shepherd';\n\nimport { ConfigService, MediaService, LanguageService } from '@igo2/core';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\nimport {\n  InteractiveTourOptions,\n  InteractiveTourStep,\n  InteractiveTourAction\n} from './interactive-tour.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InteractiveTourService {\n  private previousStep: InteractiveTourStep;\n  private nextIndex = 1;\n\n  constructor(\n    private configService: ConfigService,\n    private mediaService: MediaService,\n    private languageService: LanguageService,\n    private interactiveTourLoader: InteractiveTourLoader,\n    private shepherdService: ShepherdService\n  ) {\n    if (this.isAppHaveTour()) {\n      this.interactiveTourLoader.loadConfigTour();\n    }\n  }\n\n  public isAppHaveTour() {\n    const haveTour = this.configService.getConfig('interactiveTour.activateInteractiveTour');\n    if (haveTour === undefined) {\n      return true;\n    } else {\n      return haveTour;\n    }\n  }\n\n  public isToolHaveTourConfig(toolName: string): boolean {\n    const checkTourActiveOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n    if (checkTourActiveOptions === undefined) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  public disabledTourButton(toolName: string): boolean {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    if (stepConfig?.conditions) {\n      for (const condition of stepConfig?.conditions) {\n        if (document.querySelector(condition) === null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  public isMobile(): boolean {\n    return this.mediaService.isMobile();\n  }\n\n  public isTourDisplayInMobile(): boolean {\n    const showInMobile = this.configService.getConfig(\n      'interactiveTour.tourInMobile'\n    );\n    if (showInMobile === undefined) {\n      return true;\n    }\n    return this.configService.getConfig('interactiveTour.tourInMobile');\n  }\n\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\n    if (buttonKind === 'noBackButton') {\n      return [\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n    if (buttonKind === 'first') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n\n    if (buttonKind === 'last') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.backButton'\n          ),\n          type: 'back'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        }\n      ];\n    }\n\n    return [\n      {\n        classes: 'shepherd-button-secondary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.backButton'\n        ),\n        type: 'back'\n      },\n      {\n        classes: 'shepherd-button-primary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.nextButton'\n        ),\n        type: 'next'\n      }\n    ];\n  }\n\n  private getAction(actionName: string) {\n    const action = {\n      click: 'click'\n    };\n    return action[actionName.toLowerCase()];\n  }\n\n  private addProgress() {\n    const self = this as any;\n    let nbTry = 0;\n    const maxTry = 21;\n    const checkExist = setInterval(() => {\n      if (self.getCurrentStep()) {\n        if (self.getCurrentStep().options.attachTo.element && !document.querySelector(self.getCurrentStep().options.attachTo.element)) {\n          self.cancel();\n          clearInterval(checkExist);\n          return;\n        } else {\n          const currentStepElement = self.getCurrentStep().getElement();\n          if (currentStepElement) {\n            const shepherdList = currentStepElement.querySelectorAll('.shepherd-content, .shepherd-text');\n            shepherdList.forEach(element => {\n              element.classList.add('mat-typography');\n            });\n          }\n          const header = currentStepElement\n            ? currentStepElement.querySelector('.shepherd-header')\n            : undefined;\n\n          nbTry++;\n          if (header || nbTry > maxTry) {\n            clearInterval(checkExist);\n          }\n\n          if (header) {\n            const stepsArray = self.steps;\n            const progress = document.createElement('span');\n            progress.className = 'shepherd-progress';\n            progress.innerText = `${\n              stepsArray.indexOf(self.getCurrentStep()) + 1\n            }/${stepsArray.length}`;\n            header.insertBefore(\n              progress,\n              currentStepElement.querySelector('.shepherd-cancel-icon')\n            );\n          }\n        }\n      }\n    }, 100);\n  }\n\n  private checkNext(index, tour, service) {\n    if (tour.getCurrentStep()) {\n      if (tour.getCurrentStep().options.attachTo.element && document.querySelector(tour.getCurrentStep().options.attachTo.element)) {\n        tour.complete();\n        return;\n      }\n\n      if (index.index === tour.steps.length - 1) {\n        tour.complete();\n        return;\n      }\n\n      tour.steps.splice(index.index, 1);\n      const nextStep = tour.steps[index.index];\n      if (nextStep.options.attachTo.element && !document.querySelector(nextStep.options.attachTo.element)) {\n        service.checkNext(index, tour, service);\n      } else {\n        tour._setupModal();\n        tour.show(nextStep.id);\n      }\n    }\n  }\n\n  private executeAction(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    if (!actionConfig) {\n      return;\n    }\n\n    if (\n      actionConfig.condition &&\n      ((actionConfig.condition.charAt(0) === '!' &&\n        document.querySelector(actionConfig.condition.slice(1))) ||\n        (actionConfig.condition.charAt(0) !== '!' &&\n          !document.querySelector(actionConfig.condition)))\n    ) {\n      return;\n    }\n\n    const element: HTMLElement = document.querySelector(\n      actionConfig.element || step.element\n    ) as HTMLElement;\n    const action = this.getAction(actionConfig.action);\n    if (element && action) {\n      element[action]();\n    }\n  }\n\n  private executeActionPromise(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    return new Promise<void>((resolve) => {\n      this.executeAction(step, actionConfig);\n      if (!actionConfig || !actionConfig.waitFor) {\n        resolve();\n        return;\n      }\n      let nbTry = 0;\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\n      const checkExist = setInterval(() => {\n        nbTry++;\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\n          clearInterval(checkExist);\n          resolve();\n        }\n      }, 100);\n    });\n  }\n\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\n    const shepherdSteps = [];\n\n    let i = 0;\n    for (const step of stepConfig.steps) {\n      shepherdSteps.push({\n        attachTo: {\n          element: step.element,\n          on: step.position || stepConfig.position\n        },\n        popperOptions: {\n          modifiers: [{ name: 'offset', options: { offset: [0, 15] } }]\n        },\n        beforeShowPromise: () => {\n          return Promise.all([\n            this.executeActionPromise(\n              this.previousStep,\n              this.previousStep ? this.previousStep.beforeChange : undefined\n            ),\n            this.executeActionPromise(step, step.beforeShow)\n          ]);\n        },\n        buttons: this.getButtons(\n          i === 0\n            ? 'first'\n            : i + 1 === stepConfig.steps.length\n            ? 'last'\n            : stepConfig.steps[i].noBackButton\n            ? 'noBackButton'\n            : undefined\n        ),\n        classes: step.class,\n        highlightClass: step.highlightClass,\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\n        canClickTarget: step.disableInteraction\n          ? !step.disableInteraction\n          : undefined,\n        title: this.languageService.translate.instant(\n          step.title || stepConfig.title\n        ),\n        text: [this.languageService.translate.instant(step.text)],\n        when: {\n          show: () => {\n            this.executeAction(step, step.onShow);\n          },\n          hide: () => {\n            this.previousStep = step;\n            this.executeAction(step, step.onHide);\n          }\n        }\n      });\n      i++;\n    }\n\n    return shepherdSteps;\n  }\n\n  public startTour(toolName: string) {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    this.shepherdService.defaultStepOptions = {\n      classes: stepConfig.class,\n      highlightClass: stepConfig.highlightClass,\n      canClickTarget: stepConfig.disableInteraction\n        ? !stepConfig.disableInteraction\n        : true,\n      cancelIcon: {\n        enabled: true\n      }\n    };\n\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\n\n    this.shepherdService.modal = true;\n    this.shepherdService.confirmCancel = false;\n    this.shepherdService.addSteps(shepherdSteps);\n\n    this.shepherdService.tourObject.on('show', this.addProgress);\n    this.shepherdService.tourObject.on('cancel', (index) => {\n      this.checkNext(index, this.shepherdService.tourObject, this);\n    });\n\n    this.shepherdService.start();\n  }\n}\n","import { EntityRecord, EntityStore } from '../../entity';\nimport { Tool, ToolboxOptions } from './tool.interface';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","<button *ngIf=\"showTourButton\"\n  (click) = \"startInteractiveTour()\"\n  [ngClass]=\"getClass()\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=disabledTourButton>\n  <span class=\"interactive-tour-button-title\">{{'igo.common.interactiveTour.buttonTitle' | translate}} {{(discoverTitleInLocale$ | async) | translate}}</span>\n  <mat-icon\n    svgIcon=\"presentation-play\"\n    [matTooltip]=\"disabledTourButton ?\n    ('igo.common.interactiveTour.disaledTooltipTourToolButton' | translate) :\n    ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\">\n  </mat-icon>\n</button>\n","import { Component, ViewEncapsulation, Input } from '@angular/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { ToolService } from '../tool/shared/tool.service';\nimport { Observable, of } from 'rxjs';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class InteractiveTourComponent {\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: string;\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService\n  ) {}\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@NgModule({\n  declarations: [InteractiveTourComponent],\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  providers: [InteractiveTourService, InteractiveTourLoader],\n  exports: [InteractiveTourComponent]\n})\nexport class IgoInteractiveTourModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'keyvalue'\n})\nexport class KeyValuePipe implements PipeTransform {\n  transform(value: any, args?: any): any {\n    const keyValues = [];\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\n      keyValues.push({ key, value: value[key] })\n    );\n\n    return keyValues;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { KeyValuePipe } from './keyvalue.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [KeyValuePipe],\n  exports: [KeyValuePipe]\n})\nexport class IgoKeyValueModule {\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\n    return {\n      ngModule: IgoKeyValueModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  ElementRef,\n  Renderer2,\n  HostListener,\n  EventEmitter\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoListItem]'\n})\nexport class ListItemDirective {\n\n  static focusedCls = 'igo-list-item-focused';\n  static selectedCls = 'igo-list-item-selected';\n  static disabledCls = 'igo-list-item-disabled';\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input()\n  get focused() {\n    return this._focused;\n  }\n  set focused(value: boolean) {\n    if (value === this._focused) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\n\n    this._focused = value;\n    if (this.selected !== true) {\n      this.toggleFocusedClass();\n    }\n\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\n  }\n  private _focused = false;\n\n  @Input()\n  get selected() {\n    return this._selected;\n  }\n  set selected(value: boolean) {\n    if (value === this._selected) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\n\n    this._selected = value;\n    this._focused = value;\n    this.toggleSelectedClass();\n\n    value ? this.select.emit(this) : this.unselect.emit(this);\n  }\n  private _selected = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    if (value === this._disabled) {\n      return;\n    }\n\n    if (value === true) {\n      this.selected = false;\n    }\n\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\n\n    this._disabled = value;\n    this.toggleDisabledClass();\n\n    value ? this.disable.emit(this) : this.enable.emit(this);\n  }\n  private _disabled = false;\n\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\n  @Output() focus = new EventEmitter<ListItemDirective>();\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\n  @Output() select = new EventEmitter<ListItemDirective>();\n  @Output() unselect = new EventEmitter<ListItemDirective>();\n  @Output() disable = new EventEmitter<ListItemDirective>();\n  @Output() enable = new EventEmitter<ListItemDirective>();\n\n  @HostListener('click')\n  onClick() {\n    this.selected = true;\n  }\n\n  constructor(public renderer: Renderer2, public el: ElementRef) {}\n\n  getOffsetTop(): number {\n    const padding = 5;\n\n    return this.el.nativeElement.offsetTop - padding;\n  }\n\n  private toggleFocusedClass() {\n    if (this.focused) {\n      this.addCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.focusedCls);\n    }\n  }\n\n  private toggleSelectedClass() {\n    if (this.selected) {\n      this.addCls(ListItemDirective.selectedCls);\n      this.removeCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.selectedCls);\n    }\n  }\n\n  private toggleDisabledClass() {\n    if (this.disabled) {\n      this.addCls(ListItemDirective.disabledCls);\n    } else {\n      this.removeCls(ListItemDirective.disabledCls);\n    }\n  }\n\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Component,\n  AfterViewInit,\n  OnInit,\n  OnDestroy,\n  Input,\n  ContentChildren,\n  HostListener,\n  ElementRef\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { ListItemDirective } from './list-item.directive';\n\n@Component({\n  selector: 'igo-list',\n  templateUrl: './list.component.html',\n  styleUrls: ['./list.component.scss']\n})\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input()\n  get navigation() {\n    return this._navigation;\n  }\n  set navigation(value: boolean) {\n    this._navigation = value;\n  }\n  private _navigation = true;\n\n  @Input()\n  get selection() {\n    return this._selection;\n  }\n  set selection(value: boolean) {\n    this._selection = value;\n  }\n  private _selection = true;\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n  set selectedItem(value: ListItemDirective) {\n    this.focusedItem = value;\n    this._selectedItem = value;\n  }\n  private _selectedItem: ListItemDirective;\n\n  get focusedItem() {\n    return this._focusedItem;\n  }\n  set focusedItem(value: ListItemDirective) {\n    this._focusedItem = value;\n  }\n  private _focusedItem: ListItemDirective;\n\n  private navigationEnabled: boolean;\n  private listItems$$: Subscription;\n  private subscriptions: Subscription[] = [];\n\n  @ContentChildren(ListItemDirective, { descendants: true })\n  listItems: QueryList<ListItemDirective>;\n\n  @HostListener('document:keydown', ['$event'])\n  @HostListener('document:enter', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    // It would be nice to be able to unsubscribe to the event\n    // completely but until ES7 this won't be possible because\n    // document events are not observables\n    if (this.navigationEnabled) {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n        event.preventDefault();\n        this.navigate(event.key);\n      } else if (event.key === 'Enter') {\n        this.select(this.focusedItem);\n      }\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.enableNavigation();\n  }\n\n  ngAfterViewInit() {\n    if (this.listItems.length) {\n      this.init();\n    }\n\n    this.listItems$$ = this.listItems.changes.subscribe(\n      (items: ListItemDirective[]) => this.init()\n    );\n  }\n\n  ngOnDestroy() {\n    this.listItems$$.unsubscribe();\n  }\n\n  focus(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unfocus();\n\n    // We need to make this check because dynamic\n    // lists such as in the search results list may fail\n    if (item !== undefined) {\n      item.focused = true;\n    }\n  }\n\n  unfocus() {\n    if (this.focusedItem !== undefined) {\n      this.focusedItem.focused = false;\n    }\n\n    this.focusedItem = undefined;\n  }\n\n  focusNext() {\n    const items = this.listItems.toArray();\n    let item;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n    if (index === undefined) {\n      index = -1;\n    }\n\n    while (disabled && index < items.length - 1) {\n      index += 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index + 1]) {\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      igoList.scrollTop =\n        item.el.nativeElement.offsetTop +\n        item.el.nativeElement.children[0].offsetHeight -\n        igoList.clientHeight;\n    }\n  }\n\n  focusPrevious() {\n    const items = this.listItems.toArray();\n    let item: ListItemDirective;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n\n    while (disabled && index > 0) {\n      index -= 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index - 1]) {\n      igoList.scrollTop = 0;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      const padding = 3;\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\n    }\n  }\n\n  select(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unselect();\n\n    if (item !== undefined) {\n      item.selected = true;\n    }\n  }\n\n  unselect() {\n    this.unfocus();\n\n    if (this.selectedItem !== undefined) {\n      this.selectedItem.selected = false;\n    }\n\n    this.selectedItem = undefined;\n  }\n\n  enableNavigation() {\n    if (this.navigation) {\n      this.navigationEnabled = true;\n    }\n  }\n\n  disableNavigation() {\n    this.navigationEnabled = false;\n  }\n\n  scrollToItem(item: ListItemDirective) {\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\n  }\n\n  isScrolledIntoView(elem) {\n    const docViewTop =\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  private init() {\n    this.subscribe();\n\n    this.selectedItem = this.findSelectedItem();\n    this.focusedItem = this.findFocusedItem();\n\n    this.enableNavigation();\n  }\n\n  private subscribe() {\n    this.unsubscribe();\n\n    this.listItems.toArray().forEach(item => {\n      this.subscriptions.push(\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.select.subscribe((item2: ListItemDirective) =>\n          this.handleItemSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeFocus(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.focus.subscribe((item2: ListItemDirective) =>\n          this.handleItemFocus(item2)\n        )\n      );\n    }, this);\n  }\n\n  private unsubscribe() {\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\n    this.subscriptions = [];\n  }\n\n  private handleItemBeforeFocus(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unfocus();\n    }\n  }\n\n  private handleItemFocus(item: ListItemDirective) {\n    this.focusedItem = item;\n  }\n\n  private handleItemBeforeSelect(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unselect();\n    }\n  }\n\n  private handleItemSelect(item: ListItemDirective) {\n    this.selectedItem = item;\n  }\n\n  private findSelectedItem() {\n    return this.listItems.toArray().find(item => item.selected);\n  }\n\n  private findFocusedItem() {\n    return this.listItems.toArray().find(item => item.focused);\n  }\n\n  private getFocusedIndex() {\n    return this.listItems\n      .toArray()\n      .findIndex(item => item === this.focusedItem);\n  }\n\n  private navigate(key: string) {\n    switch (key) {\n      case 'ArrowUp':\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        this.focusNext();\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<mat-list\n  igoClickout\n  [ngClass]=\"{'selectable': selection}\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\">\n  <ng-content></ng-content>\n</mat-list>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { IgoClickoutModule } from '../clickout/clickout.module';\n\nimport { ListItemDirective } from './list-item.directive';\nimport { ListComponent } from './list.component';\n\n@NgModule({\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\n  declarations: [ListItemDirective, ListComponent],\n  exports: [ListItemDirective, ListComponent]\n})\nexport class IgoListModule {\n  static forRoot(): ModuleWithProviders<IgoListModule> {\n    return {\n      ngModule: IgoListModule,\n      providers: []\n    };\n  }\n}\n","<div *ngIf=\"withHeader\" class=\"igo-panel-header mat-typography\" title=\"\" [ngClass]=\"{'igo-cursor-pointer': cursorPointer === true}\">\n  <h3>\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n    <div class=\"igo-panel-title\">\n      {{ title }}\n      <ng-content select=\"[panelHeader]\"></ng-content>\n    </div>\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </h3>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  HostBinding\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PanelComponent {\n  @Input() title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n\n  @Input() cursorPointer: boolean = false;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PanelComponent } from './panel.component';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [PanelComponent],\n  declarations: [PanelComponent]\n})\nexport class IgoPanelModule {}\n","import { Component, Input } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-spinner',\n  templateUrl: './spinner.component.html',\n  styleUrls: ['./spinner.component.scss']\n})\nexport class SpinnerComponent {\n\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input()\n  set shown(value: boolean) { this.shown$.next(value); }\n  get shown(): boolean { return this.shown$.value; }\n\n  constructor() {}\n\n  show() {\n    this.shown = true;\n  }\n\n  hide() {\n    this.shown = false;\n  }\n}\n","<div\n  [ngClass]=\"{'igo-spinner-container': true, 'igo-spinner-shown': (shown$ | async)}\">\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner diameter=\"40\" mode=\"indeterminate\"></mat-progress-spinner>\n</div>\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { ActivityService } from '@igo2/core';\nimport { SpinnerComponent } from './spinner.component';\n\n/**\n * A directive to bind a SpinnerComponent to the activity service.\n * The activity service tracks any HTTP request and this directive\n * will display the spinner it's attached to when the activity counter\n * is greater than 0.\n */\n@Directive({\n  selector: '[igoSpinnerActivity]'\n})\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\n  /**\n   * Subscription to the activity service counter\n   */\n  private counter$$: Subscription;\n\n  constructor(\n    @Self() private spinner: SpinnerComponent,\n    private activityService: ActivityService\n  ) {}\n\n  /**\n   * Subscribe to the activity service counter and display the spinner\n   * when it's is greater than 0.\n   * @internal\n   */\n  ngOnInit() {\n    this.counter$$ = this.activityService.counter$\n      .pipe(debounceTime(50))\n      .subscribe((count: number) => {\n        count > 0 ? this.spinner.show() : this.spinner.hide();\n      });\n  }\n\n  /**\n   * Unsubcribe to the activity service counter.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.counter$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\nimport { SpinnerComponent } from './spinner.component';\n\n@NgModule({\n  imports: [CommonModule, MatProgressSpinnerModule],\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\n  exports: [SpinnerActivityDirective, SpinnerComponent]\n})\nexport class IgoSpinnerModule {}\n","import { DataSource } from '@angular/cdk/table';\nimport { MatSort } from '@angular/material/sort';\n\nimport { Observable, BehaviorSubject, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableDatabase, TableModel } from './index';\n\nexport class TableDataSource extends DataSource<any> {\n  get filter(): string {\n    return this._filterChange.value;\n  }\n  set filter(filter: string) {\n    this._filterChange.next(filter);\n  }\n  private _filterChange = new BehaviorSubject('');\n\n  constructor(\n    private _database: TableDatabase,\n    private _model: TableModel,\n    private _sort: MatSort\n  ) {\n    super();\n  }\n\n  // Connect function called by the table to retrieve one stream containing\n  // the data to render.\n  connect(): Observable<any[]> {\n    if (!this._database) {\n      return merge([]);\n    }\n    const displayDataChanges = [\n      this._database.dataChange,\n      this._filterChange,\n      this._sort.sortChange\n    ];\n\n    return merge(...displayDataChanges).pipe(\n      map(() => {\n        return this.getFilteredData(this._database.data);\n      }),\n      map(data => {\n        return this.getSortedData(data);\n      })\n    );\n  }\n\n  disconnect() {}\n\n  getFilteredData(data): any[] {\n    if (!this.filter) {\n      return data;\n    }\n    return data.slice().filter((item: any) => {\n      const searchStr: string = this._model.columns\n        .filter(c => c.filterable)\n        .map(c => ObjectUtils.resolve(item, c.name))\n        .join(' ')\n        .toLowerCase();\n\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\n    });\n  }\n\n  getSortedData(data): any[] {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      const propertyA: number | string = ObjectUtils.resolve(\n        a,\n        this._sort.active\n      );\n      const propertyB: number | string = ObjectUtils.resolve(\n        b,\n        this._sort.active\n      );\n\n      return ObjectUtils.naturalCompare(\n        propertyB,\n        propertyA,\n        this._sort.direction\n      );\n    });\n  }\n}\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","<div class='table-box'>\n  <div class='table-header' *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder='never'>\n      <input matInput #filter [placeholder]=\"'igo.common.table.filter' | translate\">\n    </mat-form-field>\n  </div>\n\n  <div class='table-container'>\n    <table mat-table #table [dataSource]='dataSource' matSort>\n\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"selection.hasValue() && isAllSelected()\"\n                        [indeterminate]=\"selection.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox (click)=\"$event.stopPropagation()\"\n                        (change)=\"$event ? selection.toggle(row) : null\"\n                        [checked]=\"selection.isSelected(row)\">\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container [matColumnDef]='column.name' *ngFor='let column of model.columns'>\n        <ng-container *ngIf='column.sortable'>\n          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf='!column.sortable'>\n          <th mat-header-cell *matHeaderCellDef> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\">\n            {{getValue(row, column.name)}}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\"\n            [innerHTML]=\"getValue(row, column.name)\">\n          </td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef='action'>\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef='let row'>\n          <button *ngFor='let action of model.actions'\n          mat-mini-fab\n          [color]='getActionColor(action.color)'\n          (click)='handleClickAction($event, action, row)'>\n            <mat-icon svgIcon=\"{{action.icon}}\"></mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef='displayedColumns;'></tr>\n      <tr mat-row\n        *matRowDef='let row; columns: displayedColumns;'\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\">\n      </tr>\n\n    </table>\n  </div>\n\n</div>\n","import {\n  Component,\n  ElementRef,\n  ViewChild,\n  Input,\n  Output,\n  OnChanges,\n  OnInit,\n  AfterViewInit,\n  EventEmitter\n} from '@angular/core';\nimport { MatSort } from '@angular/material/sort';\nimport { SelectionModel } from '@angular/cdk/collections';\n\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { fromEvent } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableModel } from './table-model.interface';\nimport { TableDatabase } from './table-database';\nimport { TableDataSource } from './table-datasource';\nimport { TableActionColor } from './table-action-color.enum';\n\n@Component({\n  selector: 'igo-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\n  @Input()\n  get database(): TableDatabase {\n    return this._database;\n  }\n  set database(value: TableDatabase) {\n    this._database = value;\n  }\n  private _database: TableDatabase;\n\n  @Input()\n  get model(): TableModel {\n    return this._model;\n  }\n  set model(value: TableModel) {\n    this._model = value;\n  }\n  private _model: TableModel;\n\n  @Input()\n  get hasFilterInput(): boolean {\n    return this._hasFIlterInput;\n  }\n  set hasFilterInput(value: boolean) {\n    this._hasFIlterInput = value;\n  }\n  private _hasFIlterInput = true;\n\n  public displayedColumns;\n  public dataSource: TableDataSource | null;\n  public selection = new SelectionModel<any>(true, []);\n\n  @Output()\n  select = new EventEmitter<{\n    added: any[];\n    removed: any[];\n    source: SelectionModel<any>;\n  }>();\n\n  @ViewChild('filter') filter: ElementRef;\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\n\n  ngOnInit() {\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\n\n    if (this.model) {\n      this.displayedColumns = this.model.columns\n        .filter(c => c.displayed !== false)\n        .map(c => c.name);\n\n      if (this.model.selectionCheckbox) {\n        this.displayedColumns.unshift('selectionCheckbox');\n      }\n      if (this.model.actions && this.model.actions.length) {\n        this.displayedColumns.push('action');\n      }\n    }\n\n    this.selection.changed.subscribe(e => this.select.emit(e));\n  }\n\n  ngAfterViewInit() {\n    if (this.filter) {\n      fromEvent(this.filter.nativeElement, 'keyup')\n        .pipe(\n          debounceTime(150),\n          distinctUntilChanged()\n        )\n        .subscribe(() => {\n          if (!this.dataSource) {\n            return;\n          }\n          this.dataSource.filter = this.filter.nativeElement.value;\n        });\n    }\n  }\n\n  ngOnChanges(change) {\n    if (change.database) {\n      this.dataSource = new TableDataSource(\n        this.database,\n        this.model,\n        this.sort\n      );\n      this.selection.clear();\n    }\n  }\n\n  getActionColor(colorId: number): string {\n    return TableActionColor[colorId];\n  }\n\n  getValue(row, key) {\n    return ObjectUtils.resolve(row, key);\n  }\n\n  /** Whether the number of selected elements matches the total number of rows. */\n  isAllSelected() {\n    const numSelected = this.selection.selected.length;\n    const numRows = this.database.data.length;\n    return numSelected === numRows;\n  }\n\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\n  masterToggle() {\n    this.isAllSelected()\n      ? this.selection.clear()\n      : this.database.data.forEach(row => this.selection.select(row));\n  }\n\n  handleClickAction(event, action, row) {\n    event.stopPropagation();\n    action.click(row);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { TableComponent } from './table.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    CdkTableModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTableModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSortModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  declarations: [TableComponent],\n  exports: [TableComponent]\n})\nexport class IgoTableModule {\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\n    return {\n      ngModule: IgoTableModule,\n      providers: []\n    };\n  }\n}\n","import { EntityStore } from '../../entity';\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {\n\n}\n","export enum ToolboxColor {\n  White = 'white',\n  Grey = 'grey',\n  Primary = 'primary'\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\">\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container\"\n  [ngClass]=\"{'igo-tool-container-with-toolbar': !actionStore.empty, 'igo-tool-container-with-animation': animate}\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\">\n\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\">\n  </igo-dynamic-outlet>\n\n</div>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  HostBinding,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Subscription, BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Action, ActionStore } from '../../action';\nimport { Tool } from '../shared/tool.interface';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { Toolbox } from '../shared/toolbox';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = ToolboxColor.White;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === ToolboxColor.Grey;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === ToolboxColor.Primary;\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        // iconImage: tool.iconImage,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionModule } from '../../action/action.module';\nimport {\n    IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { ToolboxComponent } from './toolbox.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    ToolboxComponent\n  ],\n  declarations: [\n    ToolboxComponent\n  ]\n})\nexport class IgoToolboxModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { ToolService } from './shared/tool.service';\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoToolboxModule\n  ],\n  declarations: []\n})\nexport class IgoToolModule {\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\n    return {\n      ngModule: IgoToolModule,\n      providers: [\n        ToolService\n      ]\n    };\n  }\n}\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\">\n</igo-dynamic-outlet>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { DynamicComponent } from '../../dynamic-component';\n\nimport { WidgetComponent } from '../shared/widget.interfaces';\n\n/**\n * This component dynamically renders a widget. It also subscribes\n * to the widget's 'cancel' and 'complete' events and destroys it\n * when any of those event is emitted.\n */\n@Component({\n  selector: 'igo-widget-outlet',\n  templateUrl: './widget-outlet.component.html',\n  styleUrls: ['./widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WidgetOutletComponent implements OnDestroy {\n\n  /**\n   * Widget subscribers to 'cancel' and 'complete'\n   * @internal\n   */\n  private baseSubscribers = {\n    cancel: (event: any) => this.onCancel(event),\n    complete: (event: any) => this.onComplete(event)\n  };\n\n  /**\n   * Widget\n   */\n  @Input() widget: DynamicComponent<WidgetComponent>;\n\n  /**\n   * Widget inputs\n   */\n  @Input() inputs: {[key: string]: any};\n\n  /**\n   * Widget subscribers\n   */\n  @Input() subscribers: {[key: string]: (event: any) => void} = {};\n\n  /**\n   * Event emitted when the widget emits 'complete'\n   */\n  @Output() complete = new EventEmitter<any>();\n\n  /**\n   * Event emitted when the widget emits 'cancel'\n   */\n  @Output() cancel = new EventEmitter<any>();\n\n  constructor() {}\n\n  /**\n   * Destroy the current widget and all it's inner subscriptions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.destroyWidget();\n  }\n\n  /**\n   * Get the effective subscribers. That means a combination of the base\n   * subscribers and any subscriber given as input.\n   * @returns Combined subscribers\n   * @internal\n   */\n  getEffectiveSubscribers(): {[key: string]: (event: any) => void} {\n    const subscribers = Object.assign({}, this.subscribers);\n\n    // Base subscribers\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\n      const subscriber = subscribers[key];\n      const baseSubscriber = this.baseSubscribers[key];\n      if (subscriber !== undefined) {\n        subscribers[key] = (event: any) => {\n          subscriber(event);\n          baseSubscriber(event);\n        };\n      } else {\n        subscribers[key] = baseSubscriber;\n      }\n    });\n\n    return subscribers;\n  }\n\n  /**\n   * When the widget emits 'cancel', propagate that event and destroy\n   * the widget\n   */\n  private onCancel(event: any) {\n    this.cancel.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * When the widget emits 'complete', propagate that event and destroy\n   * the widget\n   */\n  private onComplete(event: any) {\n    this.complete.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * Destroy the current widget\n   */\n  private destroyWidget() {\n    if (this.widget !== undefined) {\n      this.widget.destroy();\n    }\n    this.widget = undefined;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport {\n  IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { WidgetOutletComponent } from './widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    WidgetOutletComponent\n  ],\n  declarations: [\n    WidgetOutletComponent\n  ]\n})\nexport class IgoWidgetOutletModule {}\n","import { Injectable } from '@angular/core';\n\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\n\nimport { Widget } from './widget';\nimport { WidgetComponent } from './widget.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n\n  constructor(private dynamicComponentService: DynamicComponentService) {}\n\n  create(widgetCls: any): Widget {\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\nimport { WidgetService } from './shared/widget.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    IgoWidgetOutletModule\n  ],\n  declarations: [],\n  providers: [\n    WidgetService\n  ]\n})\nexport class IgoWidgetModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { getEntityTitle } from '../../entity';\nimport { Workspace } from '../shared/workspace';\nimport { WorkspaceStore } from '../shared/store';\n\n/**\n * Drop list that activates the selected workspace emit an event.\n */\n@Component({\n  selector: 'igo-workspace-selector',\n  templateUrl: './workspace-selector.component.html',\n  styleUrls: ['./workspace-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceSelectorComponent {\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  /**\n   * Wheither the selector must be disabled or not.\n   */\n  @Input() disabled: boolean;\n\n  /**\n   * Event emitted when an workspace is selected or unselected\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: Workspace;\n  }>();\n\n  /**\n   * @internal\n   */\n  getWorkspaceTitle(workspace: Workspace): string {\n    return getEntityTitle(workspace);\n  }\n\n  /**\n   * When an workspace is manually selected, select it into the\n   * store and emit an event.\n   * @internal\n   * @param event The selection change event\n   */\n  onSelectedChange(event: {value: Workspace}) {\n    const workspace = event.value;\n    this.store.activateWorkspace(workspace);\n    this.selectedChange.emit({selected: true, value: workspace});\n  }\n\n}\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  [disabled]=\"disabled\"\n  (selectedChange)=\"onSelectedChange($event)\">\n</igo-entity-selector>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [\n    WorkspaceSelectorComponent\n  ],\n  declarations: [\n    WorkspaceSelectorComponent\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\">\n  </igo-widget-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Widget } from '../../widget';\nimport { Workspace } from '../shared/workspace';\n\n/**\n * This component dynamically render an Workspace's active widget.\n * It also deactivate that widget whenever the widget's component\n * emit the 'cancel' or 'complete' event.\n */\n@Component({\n  selector: 'igo-workspace-widget-outlet',\n  templateUrl: './workspace-widget-outlet.component.html',\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceWidgetOutletComponent {\n\n  /**\n   * Workspace\n   */\n  @Input() workspace: Workspace;\n\n  /**\n   * Event emitted when a widget is deactivate which happens\n   * when the widget's component emits the 'cancel' or 'complete' event.\n   */\n  @Output() deactivateWidget = new EventEmitter<Widget>();\n\n  /**\n   * Observable of the workspace's active widget\n   * @internal\n   */\n  get widget$(): BehaviorSubject<Widget> { return this.workspace.widget$; }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetInputs$(): BehaviorSubject<{[key: string]: any}> {\n    return this.workspace.widgetInputs$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetSubscribers$(): BehaviorSubject<{[key: string]: (event: any) => void}> {\n    return this.workspace.widgetSubscribers$;\n  }\n\n  constructor() {}\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetCancel(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetComplete(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\n\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    WorkspaceWidgetOutletComponent\n  ],\n  declarations: [\n    WorkspaceWidgetOutletComponent\n  ]\n})\nexport class IgoWorkspaceWidgetOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceWidgetOutletModule\n  ],\n  declarations: []\n})\nexport class IgoWorkspaceModule {}\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(Object.assign({}, tool, {\n      component: compType\n    } as Tool));\n  };\n}\n","import { EntityStore } from '../../entity';\nimport { Workspace } from './workspace';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * workspaces.\n */\nexport class WorkspaceStore extends EntityStore<Workspace> {\n\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\n\n  /**\n   * Activate the an workspace workspace and deactivate the one currently active\n   * @param workspace Workspace\n   */\n  activateWorkspace(workspace: Workspace) {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n    }\n\n    this.deactivateWorkspace();\n    if (workspace !== undefined) {\n      this.state.update(workspace, {active: true, selected: true}, true);\n      this.activeWorkspace$.next(workspace);\n      workspace.activate();\n    }\n  }\n\n  /**\n   * Deactivate the current workspace\n   * @param workspace Workspace\n   */\n  deactivateWorkspace() {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n      this.activeWorkspace$.next(undefined);\n    }\n  }\n\n}\n","import { Subscription, BehaviorSubject, Subject } from 'rxjs';\n\nimport { ActionStore } from '../../action';\nimport { Widget } from '../../widget';\nimport { EntityStore } from '../../entity';\n\nimport { WorkspaceOptions } from './workspace.interfaces';\n\n/**\n * This class is responsible of managing the relations between\n * entities and the actions that consume them. It also defines an\n * entity table template that may be used by an entity table component.\n */\nexport class Workspace<E extends object = object> {\n\n  /**\n   * Observable of the selected widget\n   */\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the selected widget's inputs\n   */\n  readonly widgetInputs$ = new BehaviorSubject<{[key: string]: any}>({});\n\n  /**\n   * Observable of the selected widget's subscribers\n   */\n  readonly widgetSubscribers$ = new BehaviorSubject<{[key: string]: (event: any) => void}>({});\n\n  /**\n   * Subscription to the selected entity\n   */\n  private entities$$: Subscription;\n\n  /**\n   * State change that trigger an update of the actions availability\n   */\n  private change: Subject<void> = new Subject();\n\n  /**\n   * Subscription to state changes\n   */\n  private change$: Subscription;\n\n  /**\n   * Workspace id\n   */\n  get id(): string { return this.options.id; }\n\n  /**\n   * Workspace title\n   */\n  get title(): string { return this.options.title; }\n\n  /**\n   * Workspace title\n   */\n  get meta(): {[key: string]: any} { return this.options.meta || {}; }\n\n  /**\n   * Entities store\n   */\n  get entityStore(): EntityStore<E> { return this.options.entityStore as EntityStore<E>; }\n\n  /**\n   * Actions store (some actions activate a widget)\n   */\n  get actionStore(): ActionStore { return this.options.actionStore; }\n\n  /**\n   * Selected widget\n   */\n  get widget(): Widget { return this.widget$.value; }\n\n  /**\n   * Whether a widget is selected\n   */\n  get hasWidget(): boolean { return this.widget !== undefined; }\n\n  constructor(protected options: WorkspaceOptions) {}\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Activate the workspace. By doing that, the workspace will observe\n   * the selected entity (from the store) and update the actions availability.\n   * For example, some actions require an entity to be selected.\n   */\n  activate() {\n    if (this.active === true) {\n      this.deactivate();\n    }\n    this.active$.next(true);\n\n    if (this.entityStore !== undefined) {\n      this.entities$$ = this.entityStore.stateView.all$()\n        .subscribe(() => this.onStateChange());\n    }\n\n    this.change.next();\n  }\n\n  /**\n   * Deactivate the workspace. Unsubcribe to the selected entity.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.deactivateWidget();\n\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.change$ !== undefined) {\n      this.change$.unsubscribe();\n    }\n  }\n\n  /**\n   * Activate a widget. In itself, activating a widget doesn't render it but,\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\n   * show up.\n   * @param widget Widget\n   * @param inputs Inputs the widget will receive\n   */\n  activateWidget(\n    widget: Widget,\n    inputs: {[key: string]: any} = {},\n    subscribers: {[key: string]: (event: any) => void} = {}\n  ) {\n    this.widget$.next(widget);\n    this.widgetInputs$.next(inputs);\n    this.widgetSubscribers$.next(subscribers);\n    this.change.next();\n  }\n\n  /**\n   * Deactivate a widget.\n   */\n  deactivateWidget() {\n    this.widget$.next(undefined);\n    this.change.next();\n  }\n\n  /**\n   * When the state changes, update the actions availability.\n   */\n  private onStateChange() {\n    this.change.next();\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppHomeComponent } from './home.component';\n\nconst routes: Routes = [\n  {\n    path: 'home',\n    component: AppHomeComponent\n  }\n];\n\nexport const AppHomeRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { InteractiveTourService } from '@igo2/common';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss']\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<div style=\"text-align:center\">\n  <h1 id=\"igo-title\">\n    Welcome to IGO\n  </h1>\n  <img  class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\">\n</div>\n\n<p>\n  <igo-interactive-tour\n    tourToStart = \"global\"\n    menuIsOpen = true\n    styleButton = \"raised\">\n  </igo-interactive-tour>\n</p>\n\n<p>\n  IGO2 library contains many components and services that may benefit any web application. <br>\n  IGO2 library is open source project using Angular, Angular Material and OpenLayers.\n</p>\n\n<h3>IGO2 library is divided into several elements: </h3>\n<ul>\n  <li><b>@igo2/utils</b> : Basic utilies without dependency (ex: base64, clipboard, uuid)</li>\n  <li><b>@igo2/core</b> : Element affecting the core of the application (ex: config, language, message, media, request)</li>\n  <li><b>@igo2/common</b> : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table)</li>\n  <li><b>@igo2/auth</b> : Library grouping the authentication and security module</li>\n  <li><b>@igo2/geo</b> : Library containing the geomatic components. Depends on Openlayers.</li>\n  <li><b>@igo2/context</b> : Library of components uniting @igo2/geo and @igo2/auth</li>\n  <li><b>@igo2/integration</b> : Library integrate basic components</li>\n</ul>\n\n<h2>Here are some links to help you start: </h2>\n<ul>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\">Installation</a></h2>\n  </li>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\">Angular Documentation</a></h2>\n  </li>\n</ul>\n\n*** Modules in <code>@igo2/core</code> must be imported only once\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { AppHomeComponent } from './home.component';\nimport { AppHomeRoutingModule } from './home-routing.module';\nimport { IgoInteractiveTourModule } from '@igo2/common';\n\n@NgModule({\n  declarations: [AppHomeComponent],\n  imports: [\n    AppHomeRoutingModule,\n    IgoInteractiveTourModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule\n  ],\n  exports: [AppHomeComponent]\n})\nexport class AppHomeModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppActivityComponent } from './activity.component';\n\nconst routes: Routes = [\n  {\n    path: 'activity',\n    component: AppActivityComponent\n  }\n];\n\nexport const AppActivityRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss']\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter() {\n    return this.activityService.counter$.value;\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Activity</mat-card-title>\n  <mat-card-content>\n    <p>Register activities in service. Use to display a loading icon</p>\n\n    <li>Import <code>IgoActivityModule</code> only if you want register http calls</li>\n    <li>Import <code>IgoActivityModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/activity\"> code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"register()\">Register</button>\n    <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n  </mat-card-actions>\n  <p>Counter: {{counter}}</p>\n\n  <igo-spinner igoSpinnerActivity></igo-spinner>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActivityModule } from '@igo2/core';\nimport { IgoSpinnerModule } from '@igo2/common';\n\nimport { AppActivityComponent } from './activity.component';\nimport { AppActivityRoutingModule } from './activity-routing.module';\n\n@NgModule({\n  declarations: [AppActivityComponent],\n  imports: [\n    AppActivityRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoActivityModule.forRoot(), // Only if you want register http calls\n    IgoSpinnerModule\n  ],\n  exports: [AppActivityComponent]\n})\nexport class AppActivityModule {}\n","interface Environment {\n  production: boolean;\n  igo: any;\n}\n\nexport const environment: Environment = {\n  production: true,\n  igo: {\n    projections: [\n      {\n        code: 'EPSG:32198',\n        alias: 'Quebec Lambert',\n        def:\n          '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\n      }\n    ],\n    auth: {\n      intern: {\n        enabled: true\n      },\n      allowAnonymous: true\n    },\n    interactiveTour: {\n      tourInMobile: true\n    },\n    importExport: {\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\n    },\n    language: {\n      prefix: './locale/'\n    },\n    catalog: {\n      sources: [\n        {\n          id: 'Gououvert',\n          title: 'Gouvouvert',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\n        },\n        {\n          id: 'DefiningInfoFormat',\n          title: 'Defining info_format',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          queryFormat: {\n            html: '*',\n            'application/json': [\n              'stations_meteoroutieres',\n              'histo_stations_meteoroutieres'\n            ]\n          },\n          queryHtmlTarget: 'iframe',\n          count: 30\n        },\n        {\n          id: 'catalogwithregex',\n          title: 'Filtered catalog by regex',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          regFilters: ['zpegt']\n        },\n        {\n          id: 'catalogwithtooltipcontrol',\n          title: 'Controling tooltip format',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          tooltipType: 'abstract' // or title\n        }\n      ]\n    },\n    searchSources: {\n      storedqueriesreverse: { enabled: false},\n      nominatim: {\n        enabled: false\n      },\n      icherche: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n        order: 2,\n        enabled: true,\n        params: {\n          limit: '8'\n        }\n      },\n      coordinatesreverse: {\n        showInPointerSummary: true\n      },\n      icherchereverse: {\n        showInPointerSummary: true,\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n        order: 3,\n        enabled: true\n      },\n      ilayer: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n        order: 4,\n        enabled: true,\n        params: {\n          limit: '5'\n        }\n      }\n    }\n  }\n};\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppConfigComponent } from './config.component';\n\nconst routes: Routes = [\n  {\n    path: 'config',\n    component: AppConfigComponent\n  }\n];\n\nexport const AppConfigRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { ConfigService, LanguageOptions } from '@igo2/core';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss']\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>config</mat-card-title>\n  <mat-card-content>\n    <p>Load config in your angular application</p>\n\n    <li>Import <code>IgoConfigModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/config\"> code of this example</a> <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Config language: {{configLanguage | json }}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\n\nimport { environment } from '../../../environments/environment';\nimport { AppConfigComponent } from './config.component';\nimport { AppConfigRoutingModule } from './config-routing.module';\n\n@NgModule({\n  declarations: [AppConfigComponent],\n  imports: [\n    AppConfigRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoConfigModule.forRoot()\n  ],\n  exports: [AppConfigComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppConfigModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLanguageComponent } from './language.component';\n\nconst routes: Routes = [\n  {\n    path: 'language',\n    component: AppLanguageComponent\n  }\n];\n\nexport const AppLanguageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss']\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>language</mat-card-title>\n  <mat-card-content>\n    <p>Translate your angular application</p>\n\n    <li>Import <code>IgoLanguageModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/language\">code of this example</a><br>\n    See language section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\">locale files</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n    <button mat-raised-button (click)=\"changeLanguage('fr')\">Français</button>\n  </mat-card-actions>\n\n  <p>{{'welcome' | translate: app}}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { AppLanguageComponent } from './language.component';\nimport { AppLanguageRoutingModule } from './language-routing.module';\n\n@NgModule({\n  declarations: [AppLanguageComponent],\n  imports: [\n    AppLanguageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoLanguageModule.forRoot()\n  ],\n  exports: [AppLanguageComponent]\n})\nexport class AppLanguageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMediaComponent } from './media.component';\n\nconst routes: Routes = [\n  {\n    path: 'media',\n    component: AppMediaComponent\n  }\n];\n\nexport const AppMediaRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MediaService } from '@igo2/core';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss']\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation() {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Media</mat-card-title>\n  <mat-card-content>\n    <p>Detect type of media (mobile, tablet, desktop)</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/media\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Current media: {{media}}</p>\n  <p>Current orientation: {{orientation}}</p>\n  <p>Device mode:  {{isTouchScreen ? 'Touch device' : 'Not a touch device '}}</p>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { AppMediaComponent } from './media.component';\nimport { AppMediaRoutingModule } from './media-routing.module';\n\n@NgModule({\n  declarations: [AppMediaComponent],\n  imports: [AppMediaRoutingModule, MatCardModule],\n  exports: [AppMediaComponent]\n})\nexport class AppMediaModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMessageComponent } from './message.component';\n\nconst routes: Routes = [\n  {\n    path: 'message',\n    component: AppMessageComponent\n  }\n];\n\nexport const AppMessageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MessageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss']\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success() {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info() {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert() {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error() {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Message</mat-card-title>\n  <mat-card-content>\n    <p>Show message to user.</p>\n\n    <li>Import <code>IgoMessageModule</code> only once</li>\n    <li>Dependencies: BrowserAnimationsModule </li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/message\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"success()\">Success message</button>\n    <button mat-raised-button color='primary' (click)=\"info()\">Info message</button>\n    <button mat-raised-button color='accent' (click)=\"alert()\">Alert message</button>\n    <button mat-raised-button color='warn' (click)=\"error()\">Error message</button>\n  </mat-card-actions>\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppMessageComponent } from './message.component';\nimport { AppMessageRoutingModule } from './message-routing.module';\n\n@NgModule({\n  declarations: [AppMessageComponent],\n  imports: [\n    AppMessageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule.forRoot()\n  ],\n  exports: [AppMessageComponent]\n})\nexport class AppMessageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppRequestComponent } from './request.component';\n\nconst routes: Routes = [\n  {\n    path: 'request',\n    component: AppRequestComponent\n  }\n];\n\nexport const AppRequestRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-request',\n  templateUrl: './request.component.html',\n  styleUrls: ['./request.component.scss']\n})\nexport class AppRequestComponent {\n  constructor(\n    private http: HttpClient,\n    public languageService: LanguageService\n  ) {}\n\n  callHttp() {\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n\n  callHttpError() {\n    const url = '404';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Request</mat-card-title>\n  <mat-card-content>\n    <p>Register http calls in console</p>\n\n    <li>Import <code>IgoLoggingModule</code> only if you want register http calls in console</li>\n    <li>Import <code>IgoErrorModule</code> only if you want register errors from http call in console</li>\n    <li>Import modules only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/request\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"callHttp()\">Log</button>\n    <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n  </mat-card-actions>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\n\nimport { AppRequestComponent } from './request.component';\nimport { AppRequestRoutingModule } from './request-routing.module';\n\n@NgModule({\n  declarations: [AppRequestComponent],\n  imports: [\n    AppRequestRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    HttpClientModule,\n    IgoLanguageModule.forRoot(),\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\n  ],\n  exports: [AppRequestComponent]\n})\nexport class AppRequestModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/action\">code of this example</a>\n  </mat-card-content>\n\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"true\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n</mat-card>\n<p></p>\n\n<mat-card [igoContextMenu]= actionbarMenu>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action context-menu</mat-card-title>\n  <div></div>\n</mat-card>\n\n\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppActionComponent } from './action.component';\n\nconst routes: Routes = [\n  {\n    path: 'action',\n    component: AppActionComponent\n  }\n];\n\nexport const AppActionRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  Media,\n  MediaOrientation,\n  MediaService,\n  LanguageService\n} from '@igo2/core';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { Overlay } from '@angular/cdk/overlay';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss']\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  private added$ = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media = this.mediaService.media$.value;\n    const orientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'plus',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'pencil',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\n\nimport { AppActionComponent } from './action.component';\nimport { AppActionRoutingModule } from './action-routing.module';\n\n@NgModule({\n  declarations: [AppActionComponent],\n  imports: [\n    AppActionRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoActionModule,\n    IgoContextMenuModule\n  ],\n  exports: [AppActionComponent]\n})\nexport class AppActionModule {}\n","import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\n\nimport { OnUpdateInputs } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-component',\n  template: '<p>Hello, my name is {{name}}.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-explanation-component',\n  template: '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppExplanationComponent implements OnUpdateInputs {\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-dynamic-component',\n  templateUrl: './dynamic-component.component.html',\n  styleUrls: ['./dynamic-component.component.scss']\n})\nexport class AppDynamicComponentComponent {\n\n  component: any = AppSalutationComponent;\n\n  inputs = {name: 'Bob'};\n\n  toggleComponent() {\n    this.component = this.component === AppSalutationComponent ?\n      AppExplanationComponent :\n      AppSalutationComponent;\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\n\nconst routes: Routes = [\n  {\n    path: 'dynamic-component',\n    component: AppDynamicComponentComponent\n  }\n];\n\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Dynamic Component</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/dynamic-component\">code of this example</a>\n  </mat-card-content>\n\n  <igo-dynamic-outlet\n    [component]=\"component\"\n    [inputs]=\"inputs\">\n  </igo-dynamic-outlet>\n\n  <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">Toggle Component</button>\n</mat-card>\n\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoDynamicComponentModule } from '@igo2/common';\n\nimport {\n  AppSalutationComponent,\n  AppExplanationComponent,\n  AppDynamicComponentComponent\n} from './dynamic-component.component';\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\n\n@NgModule({\n    declarations: [\n        AppSalutationComponent,\n        AppDynamicComponentComponent,\n        AppExplanationComponent\n    ],\n    imports: [\n        AppDynamicComponentRoutingModule,\n        MatButtonModule,\n        MatCardModule,\n        IgoDynamicComponentModule\n    ],\n    exports: [AppDynamicComponentComponent]\n})\nexport class AppDynamicComponentModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntityTableComponent } from './entity-table.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-table',\n    component: AppEntityTableComponent\n  }\n];\n\nexport const AppEntityTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  EntityStore,\n  EntityTableButton,\n  getEntityProperty,\n  EntityTableColumnRenderer,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'app-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss']\n})\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\n  public store = new EntityStore([]);\n  public paginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public paginatorOptions: EntityTablePaginatorOptions = {pageSize: 10};\n\n  public template = {\n    selection: true,\n    selectionCheckbox: true,\n    selectMany: true,\n    sort: true,\n    valueAccessor: (entity: object, name: string) => {\n      return getEntityProperty(entity, name);\n    },\n    columns: [\n      {\n        name: 'selected',\n        title: 'Selected',\n        valueAccessor: (entity: object) => {\n          return this.store.state.get(entity).selected\n            ? 'radiobox-marked'\n            : 'radiobox-blank';\n        },\n        renderer: EntityTableColumnRenderer.Icon\n      },\n      {\n        name: 'id',\n        title: 'ID'\n      },\n      {\n        name: 'name',\n        title: 'Name'\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        renderer: EntityTableColumnRenderer.HTML\n      },\n      {\n        name: 'url',\n        title: 'Hyperlink'\n      },\n      {\n        name: 'image',\n        title: 'Image'\n      },\n      {\n        name: 'action',\n        title: '',\n        valueAccessor: (entity: object) => {\n          return [{\n            icon: 'home',\n            color: 'warn',\n            click: (row) => { console.log(row); }\n          }] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup\n      }\n    ]\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\n\n    const entities = ids.map(id => {\n      if (id === 3) {\n        return { id , name: `Name ${id}`, description: `<b>Description ${id}</b>`, url: 'https://igouverte.org', image: 'https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png'};\n      }\n      return { id , name: `Name ${id}`, description: `<b>Description ${id}</b>`, url: 'https://igouverte.org', image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'};\n    });\n    this.store.load(entities);\n  }\n\n  entitySortChange() {\n    this.entitySortChange$.next(true);\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-table\">code of this example</a>\n  </mat-card-content>\n  <igo-entity-table\n    [store]=\"store\"\n    [withPaginator]=\"true\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [template]=\"template\"\n    (entitySortChange)=\"entitySortChange()\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntityTableModule, IgoEntityTablePaginatorModule } from '@igo2/common';\n\nimport { AppEntityTableComponent } from './entity-table.component';\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\n\n@NgModule({\n  declarations: [AppEntityTableComponent],\n  imports: [\n    AppEntityTableRoutingModule,\n    MatCardModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  exports: [AppEntityTableComponent]\n})\nexport class AppEntityTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Selector</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-selector\">code of this example</a>\n  </mat-card-content>\n\n  <igo-entity-selector\n    [store]=\"store\"\n    [titleAccessor]=\"getTitle\"\n    [emptyText]=\"''\"\n    [placeholder]=\"'Select an entity'\"\n    (selectedChange)=\"onSelectedChange($event)\">\n  </igo-entity-selector>\n\n  <div *ngIf=\"selected$ | async as selected\">\n    <p>ID: {{selected.id}}</p>\n    <p>Name: {{selected.name}}</p>\n    <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\n  </div>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-selector',\n    component: AppEntitySelectorComponent\n  }\n];\n\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\ninterface DemoEntity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n@Component({\n  selector: 'app-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss']\n})\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\n\n  public store = new EntityStore([]);\n\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.store.load([\n      {id: '2', name: 'Name 2', description: '<b>Description 2</b>'},\n      {id: '1', name: 'Name 1', description: '<b>Description 1</b>'},\n      {id: '3', name: 'Name 3', description: '<b>Description 3</b>'}\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  getTitle(entity: DemoEntity): string {\n    return entity.name;\n  }\n\n  onSelectedChange(event: {selected: boolean; entity: DemoEntity}) {\n    this.selected$.next(event.entity);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntitySelectorModule } from '@igo2/common';\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\n\n@NgModule({\n  declarations: [AppEntitySelectorComponent],\n  imports: [\n    CommonModule,\n    AppEntitySelectorRoutingModule,\n    MatCardModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [AppEntitySelectorComponent]\n})\nexport class AppEntitySelectorModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFormComponent } from './form.component';\n\nconst routes: Routes = [\n  {\n    path: 'form',\n    component: AppFormComponent\n  }\n];\n\nexport const AppFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\n\n@Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss']\n})\nexport class AppFormComponent implements OnInit, OnDestroy {\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private formService: FormService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    const fieldConfigs = [\n      {\n        name: 'id',\n        title: 'ID',\n        options:  {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options:  {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options:  {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            {value: 1, title: 'Single'},\n            {value: 2, title: 'Married'}\n          ]\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      id: 1,\n      name: 'Bob',\n      status: 2\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { AppFormComponent } from './form.component';\nimport { AppFormRoutingModule } from './form-routing.module';\n\n@NgModule({\n  declarations: [AppFormComponent],\n  imports: [\n    CommonModule,\n    AppFormRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule\n  ],\n  exports: [AppFormComponent]\n})\nexport class AppFormModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTableComponent } from './table.component';\n\nconst routes: Routes = [\n  {\n    path: 'table',\n    component: AppTableComponent\n  }\n];\n\nexport const AppTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { TableDatabase, TableActionColor } from '@igo2/common';\n\n@Component({\n  selector: 'app-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class AppTableComponent implements OnInit {\n  public database: TableDatabase;\n\n  public model = {\n    columns: [\n      {\n        name: 'id',\n        title: 'ID',\n        sortable: false,\n        filterable: true\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        sortable: true,\n        filterable: true\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        sortable: true,\n        filterable: true\n      }\n    ],\n    actions: [\n      {\n        icon: 'file-document',\n        color: TableActionColor.primary,\n        click: row => this.showName(row.name)\n      }\n    ],\n    selectionCheckbox: true\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.database = new TableDatabase([\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\n    ]);\n  }\n\n  showName(name) {\n    alert(name);\n  }\n\n  handleSelect(rows) {\n    console.log(rows);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/table\">code of this example</a>\n  </mat-card-content>\n\n  <igo-table\n    [database]=\"database\"\n    [model]=\"model\"\n    [hasFilterInput]=\"true\"\n    (select)=\"handleSelect($event)\">\n  </igo-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoTableModule } from '@igo2/common';\n\nimport { AppTableComponent } from './table.component';\nimport { AppTableRoutingModule } from './table-routing.module';\n\n@NgModule({\n  declarations: [AppTableComponent],\n  imports: [\n    AppTableRoutingModule,\n    MatCardModule,\n    IgoTableModule\n  ],\n  exports: [AppTableComponent]\n})\nexport class AppTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Tool</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/tool\">code of this example</a>\n  </mat-card-content>\n\n  <igo-panel [title]=\"panelTitle\">\n    <button\n      mat-icon-button\n      panelLeftButton\n      (click)=\"toolbox.activatePreviousTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"arrow-back\"></mat-icon>\n    </button>\n\n    <button\n      mat-icon-button\n      panelRightButton\n      (click)=\"toolbox.deactivateTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"menu\"></mat-icon>\n    </button>\n\n    <igo-toolbox [toolbox]=\"toolbox\" [animate]=\"true\"></igo-toolbox>\n  </igo-panel>\n\n  <button\n    mat-flat-button\n    type=\"button\"\n    color=\"primary\"\n    (click)=\"activateSalutationTool()\">\n    Activate Salutation Tool\n  </button>\n\n</mat-card>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  OnUpdateInputs,\n  Tool,\n  Toolbox,\n  ToolComponent,\n  ToolService\n} from '@igo2/common';\n\n@ToolComponent({\n  name: 'demo-salutation',\n  title: 'Salutation',\n  icon: 'account',\n  options: {name: 'Jack'}\n})\n@Component({\n  selector: 'app-salutation-tool',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationToolComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@ToolComponent({\n  name: 'demo-about',\n  title: 'About',\n  icon: 'information'\n})\n@Component({\n  selector: 'app-about-tool',\n  template: `\n    <p>I'm a tool inside a toolbox.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppAboutToolComponent {}\n\n@Component({\n  selector: 'app-tool',\n  templateUrl: './tool.component.html',\n  styleUrls: ['./tool.component.scss']\n})\nexport class AppToolComponent implements OnInit, OnDestroy {\n\n  toolbox = new Toolbox();\n\n  get activeTool$(): BehaviorSubject<Tool> {\n    return this.toolbox.activeTool$;\n  }\n\n  get panelTitle(): string {\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\n  }\n\n  constructor(\n    private toolService: ToolService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\n    this.toolbox.setTools(this.toolService.getTools());\n  }\n\n  ngOnDestroy() {\n    this.toolbox.destroy();\n  }\n\n  activateSalutationTool() {\n    this.toolbox.activateTool('demo-salutation', {name: 'Bob'});\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppToolComponent } from './tool.component';\n\nconst routes: Routes = [\n  {\n    path: 'tool',\n    component: AppToolComponent\n  }\n];\n\nexport const AppToolRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\n\nimport {\n  AppToolComponent,\n  AppSalutationToolComponent,\n  AppAboutToolComponent\n} from './tool.component';\nimport { AppToolRoutingModule } from './tool-routing.module';\n\n@NgModule({\n    declarations: [\n        AppToolComponent,\n        AppSalutationToolComponent,\n        AppAboutToolComponent\n    ],\n    imports: [\n        CommonModule,\n        AppToolRoutingModule,\n        MatButtonModule,\n        MatIconModule,\n        MatCardModule,\n        IgoLanguageModule,\n        IgoPanelModule,\n        IgoToolModule.forRoot()\n    ],\n    exports: [AppToolComponent]\n})\nexport class AppToolModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { DynamicComponent, OnUpdateInputs, WidgetComponent, WidgetService } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-widget',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n    <button mat-flat-button (click)=\"complete.emit(name)\">Nice to meet you</button>\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationWidgetComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() name: string;\n\n  @Output() complete = new EventEmitter<string>();\n\n  @Output() cancel = new EventEmitter<string>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-widget',\n  templateUrl: './widget.component.html',\n  styleUrls: ['./widget.component.scss']\n})\nexport class AppWidgetComponent {\n\n  widget: DynamicComponent<WidgetComponent> = this.widgetService.create(AppSalutationWidgetComponent);\n\n  inputs = {name: 'Bob'};\n\n  constructor(private widgetService: WidgetService) {}\n\n  onWidgetComplete(name: string) {\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\n  }\n\n  onWidgetCancel() {\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWidgetComponent } from './widget.component';\n\nconst routes: Routes = [\n  {\n    path: 'widget',\n    component: AppWidgetComponent\n  }\n];\n\nexport const AppWidgetRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Widget</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/widget\">code of this example</a>\n  </mat-card-content>\n\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"inputs\"\n    (complete)=\"onWidgetComplete($event)\"\n    (cancel)=\"onWidgetCancel()\">\n  </igo-widget-outlet>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport {\n  AppSalutationWidgetComponent,\n  AppWidgetComponent\n} from './widget.component';\nimport { AppWidgetRoutingModule } from './widget-routing.module';\n\n@NgModule({\n    declarations: [\n        AppSalutationWidgetComponent,\n        AppWidgetComponent\n    ],\n    imports: [\n        AppWidgetRoutingModule,\n        MatButtonModule,\n        MatCardModule,\n        IgoWidgetModule\n    ],\n    exports: [AppWidgetComponent]\n})\nexport class AppWidgetModule {}\n","import { Injectable, Injector } from '@angular/core';\nimport jwtDecode from 'jwt-decode';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options: AuthOptions;\n\n  constructor(private injector: Injector) {}\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode() {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token);\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n\n  private get tokenKey() {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth') || {};\n    return this.options.tokenKey;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Router } from '@angular/router';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { tap, catchError } from 'rxjs/operators';\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\n\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\nimport { Base64 } from '@igo2/utils';\n\nimport { User, IInfosUser } from './auth.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\n  public logged$ = new BehaviorSubject<boolean>(undefined);\n  public redirectUrl: string;\n  public languageForce = false;\n  private anonymous = false;\n\n  get hasAuthService() {\n    return this.config.getConfig('auth.url') !== undefined;\n  }\n\n  constructor(\n    private http: HttpClient,\n    private tokenService: TokenService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private router: Router\n  ) {\n    this.authenticate$.next(this.authenticated);\n    this.authenticate$.subscribe((authenticated) => {\n      this.logged$.next(authenticated);\n      globalCacheBusterNotifier.next();\n    });\n  }\n\n  login(username: string, password: string): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      username,\n      password: this.encodePassword(password)\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginWithToken(token: string, type: string, infosUser?: IInfosUser): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      token,\n      typeConnection: type,\n      infosUser\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginAnonymous(): Observable<boolean> {\n    this.anonymous = true;\n    this.logged$.next(true);\n    return of(true);\n  }\n\n  refresh(): Observable<void> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/refresh`, {}).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n\n  logout(): Observable<boolean> {\n    this.anonymous = false;\n    this.tokenService.remove();\n    this.authenticate$.next(false);\n    return of(true);\n  }\n\n  isAuthenticated(): boolean {\n    return !this.tokenService.isExpired();\n  }\n\n  getToken(): string {\n    return this.tokenService.get();\n  }\n\n  decodeToken() {\n    if (this.isAuthenticated()) {\n      return this.tokenService.decode();\n    }\n    return false;\n  }\n\n  goToRedirectUrl() {\n    if (!this.router) {\n      return;\n    }\n    const redirectUrl = this.redirectUrl || this.router.url;\n\n    const options = this.config.getConfig('auth') || {};\n    if (redirectUrl === options.loginRoute) {\n      const homeRoute = options.homeRoute || '/';\n      this.router.navigateByUrl(homeRoute);\n    } else if (redirectUrl) {\n      this.router.navigateByUrl(redirectUrl);\n    }\n  }\n\n  getUserInfo(): Observable<User> {\n    const url = this.config.getConfig('auth.url') + '/info';\n    return this.http.get<User>(url);\n  }\n\n  getProfils(): Observable<{ profils: string[] }> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.get<{ profils: string[] }>(`${url}/profils`);\n  }\n\n  updateUser(user: User): Observable<User> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.patch<User>(url, user);\n  }\n\n  private encodePassword(password: string) {\n    return Base64.encode(password);\n  }\n\n  // authenticated or anonymous\n  get logged(): boolean {\n    return this.authenticated || this.isAnonymous;\n  }\n\n  get isAnonymous(): boolean {\n    return this.anonymous;\n  }\n\n  get authenticated(): boolean {\n    return this.isAuthenticated();\n  }\n\n  get isAdmin(): boolean {\n    const token = this.decodeToken();\n    if (token && token.user && token.user.isAdmin) {\n      return true;\n    }\n    return false;\n  }\n\n  private loginCall(body, headers) {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/login`, body, { headers }).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n        const tokenDecoded = this.decodeToken();\n        if (tokenDecoded && tokenDecoded.user) {\n          if (tokenDecoded.user.locale && !this.languageForce) {\n            this.languageService.setLanguage(tokenDecoded.user.locale);\n          }\n          if (tokenDecoded.user.isExpired) {\n              this.messageService.alert('igo.auth.error.Password expired');\n          }\n        }\n        this.authenticate$.next(true);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { AuthGoogleOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-google',\n  templateUrl: './auth-google.component.html',\n  styleUrls: ['./auth-google.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthGoogleComponent {\n  private options: AuthGoogleOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.google') || {};\n\n    if (this.options.apiKey && this.options.clientId) {\n      this.loadSDKGoogle();\n      this.loadPlatform();\n    } else {\n      console.warn('Google authentification needs \"apiKey\" and \"clientId\" options');\n    }\n  }\n\n  public handleSignInClick() {\n    (window as any).gapi.auth2.getAuthInstance().signIn();\n  }\n\n  public handleSignOutClick() {\n    (window as any).gapi.auth2.getAuthInstance().signOut();\n  }\n\n  private handleClientLoad() {\n    (window as any).gapi.load('client:auth2', () => this.initClient());\n  }\n\n  private initClient() {\n    (window as any).gapi.client\n      .init({\n        apiKey: this.options.apiKey,\n        clientId: this.options.clientId,\n        discoveryDocs: [\n          'https://people.googleapis.com/$discovery/rest?version=v1'\n        ],\n        scope: 'profile'\n      })\n      .then(() => {\n        this.handleSignOutClick();\n        this.updateTextButton();\n        (window as any).gapi.auth2.getAuthInstance().isSignedIn.listen(rep => {\n          this.updateSigninStatus(rep);\n        });\n      });\n  }\n\n  private updateSigninStatus(isSignedIn) {\n    this.updateTextButton();\n    if (isSignedIn) {\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\n    }\n  }\n\n  private updateTextButton() {\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\n    if (btn && this.languageService.getLanguage() !== 'en') {\n      if (btn.innerHTML === 'Sign in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.login');\n      } else if (btn.innerHTML === 'Signed in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.logged');\n      }\n    }\n  }\n\n  private loginGoogle(token) {\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKGoogle() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-jssdk';\n    js.src = 'https://apis.google.com/js/api.js';\n    js.onload = () => {\n      this.handleClientLoad();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n\n  private loadPlatform() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-platform';\n    js.src = 'https://apis.google.com/js/platform.js';\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div class=\"g-signin2 google-login-button\" data-height=\"40\" data-width=\"265\" data-longtitle=\"true\">\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required placeholder=\"{{'igo.auth.user' | translate}}\" formControlName=\"username\">\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required type=\"password\" placeholder=\"{{'igo.auth.password' | translate}}\" formControlName=\"password\">\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\">{{'igo.auth.login' | translate}}</button>\n  <button *ngIf=\"allowAnonymous\" mat-raised-button class=\"anonymous\" type=\"button\" [disabled]=\"loading\" (click)=\"loginAnonymous()\">\n    {{'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br/>\n    <font size=\"3\" color=\"red\">{{error}}</font>\n  </div>\n</form>\n\n<!--\nThis part was removed from the below line to fix Angular issue 30616 : [disabled]=\"!form.valid || loading\n  <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid || loading\">{{'igo.auth.login' | translate}}</button>*/\n-->\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Validators, UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\n\nimport { AuthService } from '../shared/auth.service';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-auth-intern',\n  templateUrl: './auth-intern.component.html',\n  styleUrls: ['./auth-intern.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthInternComponent {\n  @Input()\n  get allowAnonymous(): boolean {\n    return this._allowAnonymous;\n  }\n  set allowAnonymous(value: boolean) {\n    this._allowAnonymous = value;\n  }\n  private _allowAnonymous = true;\n\n  public error = '';\n  public form: UntypedFormGroup;\n  public loading = false;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    public auth: AuthService,\n    private languageService: LanguageService,\n    fb: UntypedFormBuilder\n  ) {\n    this.form = fb.group({\n      username: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  loginUser(values: any) {\n    this.loading = true;\n    this.auth.login(values.username, values.password).subscribe(\n      () => {\n        this.login.emit(true);\n        this.loading = false;\n      },\n      (error: any) => {\n        try {\n          this.languageService.translate\n            .get('igo.auth.error.' + error.error.message)\n            .subscribe(errorMsg => (this.error = errorMsg));\n        } catch (e) {\n          this.error = error.error.message;\n        }\n        this.loading = false;\n      }\n    );\n    return false;\n  }\n\n  loginAnonymous() {\n    this.auth.loginAnonymous().subscribe(() => {\n      this.login.emit(true);\n    });\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthFacebookOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-facebook',\n  templateUrl: './auth-facebook.component.html',\n  styleUrls: ['./auth-facebook.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthFacebookComponent {\n  private options: AuthFacebookOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.facebook') || {};\n\n    if (this.options.appId) {\n      this.loadSDKFacebook();\n    } else {\n      console.warn('Facebook authentification needs \"appId\" option');\n    }\n  }\n\n  private subscribeEvents() {\n    (window as any).FB.Event.subscribe('auth.statusChange', rep => {\n      this.statusChangeCallback(rep);\n    });\n  }\n\n  private statusChangeCallback(response) {\n    if (response.status === 'connected') {\n      const accessToken = response.authResponse.accessToken;\n      this.loginFacebook(accessToken);\n    }\n  }\n\n  private loginFacebook(token) {\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKFacebook() {\n    if (document.getElementById('facebook-jssdk')) {\n      return;\n    }\n\n    const urlSDK =\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\n\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'facebook-jssdk';\n    js.src = `${urlSDK}&appId=${this.options.appId}`;\n    js.onload = () => {\n      this.subscribeEvents();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div scope=\"public_profile,email\"\n     class=\"fb-login-button\" data-max-rows=\"1\" data-size=\"large\"\n     data-button-type=\"login_with\" data-show-faces=\"false\"\n     data-auto-logout-link=\"false\" data-use-continue-as=\"false\">\n</div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\nimport { MsalBroadcastService, MsalService, MSAL_GUARD_CONFIG} from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'igo-auth-microsoft',\n  templateUrl: './auth-microsoft.component.html',\n  styleUrls: ['./auth-microsoft.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftComponent {\n  private options: AuthMicrosoftOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastService;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalService,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n    this.options = this.config.getConfig('auth.microsoft') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastService(this.msalService.instance, this.msalService);\n\n    if (this.options.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoft() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const tokenAccess = response.accessToken;\n        const tokenId = response.idToken;\n        this.authService.loginWithToken(tokenAccess, 'microsoft', { tokenId } ).subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        console.log(error);\n      }).catch(error => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'add')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoft()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoft.login' | translate}}\n</button>\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { Location } from '@angular/common';\nimport {\n    IPublicClientApplication,\n    EndSessionRequest,\n    EndSessionPopupRequest,\n    AuthenticationResult,\n    RedirectRequest,\n    SilentRequest,\n    PopupRequest,\n    SsoSilentRequest,\n    Logger,\n    WrapperSKU\n} from '@azure/msal-browser';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { Observable, from } from 'rxjs';\nimport { IMsalService } from '@azure/msal-angular';\n\n@Injectable()\nexport class MsalServiceb2c implements IMsalService {\n    private redirectHash: string;\n    private logger: Logger;\n    private name = '@azure/msal-angular';\n    private version = '2.0.0-beta.2';\n    constructor(\n        @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\n        private location: Location\n    ) {\n        const hash = this.location.path(true).split('#').pop();\n        if (hash) {\n            this.redirectHash = `#${hash}`;\n        }\n        this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\n    }\n\n    initialize(): Observable<void> {\n        return from(this.instance.initialize());\n    }\n\n    acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenPopup(request));\n    }\n    acquireTokenRedirect(request: RedirectRequest): Observable<void> {\n        return from(this.instance.acquireTokenRedirect(request));\n    }\n    acquireTokenSilent(silentRequest: SilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenSilent(silentRequest));\n    }\n    handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\n        return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\n    }\n    loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.loginPopup(request));\n    }\n    loginRedirect(request?: RedirectRequest): Observable<void> {\n        return from(this.instance.loginRedirect(request));\n    }\n    logout(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logout(logoutRequest));\n    }\n    logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logoutRedirect(logoutRequest));\n    }\n    logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\n        return from(this.instance.logoutPopup(logoutRequest));\n    }\n    ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.ssoSilent(request));\n    }\n    /**\n     * Gets logger for msal-angular.\n     * If no logger set, returns logger instance created with same options as msal-browser\n     */\n    getLogger(): Logger {\n        if (!this.logger) {\n            this.logger = this.instance.getLogger().clone(this.name, this.version);\n        }\n        return this.logger;\n    }\n    // Create a logger instance for msal-angular with the same options as msal-browser\n    setLogger(logger: Logger): void {\n        this.logger = logger.clone(this.name, this.version);\n        this.instance.setLogger(logger);\n    }\n\n}\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { EventMessage, EventMessageUtils, IPublicClientApplication, InteractionStatus } from '@azure/msal-browser';\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\n@Injectable()\nexport class MsalBroadcastServiceb2c {\n    private _msalSubject: Subject<EventMessage>;\n    public msalSubject$: Observable<EventMessage>;\n    private _inProgress: BehaviorSubject<InteractionStatus>;\n    public inProgress$: Observable<InteractionStatus>;\n\n    constructor(\n        @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\n        private authService: MsalServiceb2c\n    ) {\n        this._msalSubject = new Subject<EventMessage>();\n        this.msalSubject$ = this._msalSubject.asObservable();\n\n        // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\n        this._inProgress = new BehaviorSubject<InteractionStatus>(InteractionStatus.Startup);\n        this.inProgress$ = this._inProgress.asObservable();\n\n        this.msalInstance.addEventCallback((message: EventMessage) => {\n            this._msalSubject.next(message);\n            const status = EventMessageUtils.getInteractionStatusFromEvent(message);\n            if (status !== null) {\n                this.authService.getLogger().verbose(`BroadcastService - ${message.eventType} results in setting inProgress to ${status}`);\n                this._inProgress.next(status);\n            }\n        });\n    }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\n\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftb2cOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\n\n@Component({\n  selector: 'igo-auth-microsoftb2c',\n  templateUrl: './auth-microsoftb2c.component.html',\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftb2cComponent {\n  private options: AuthMicrosoftb2cOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastServiceb2c;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalServiceb2c,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options.browserAuthOptions,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastServiceb2c(this.msalService.instance, this.msalService);\n\n    if (this.options.browserAuthOptions.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoftb2c() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const token = response.idToken;\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        }).catch(error => {\n          console.log('Silent token fails');\n        });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'b2c')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoftb2c()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoftb2c.login' | translate}}\n</button>\n","<div *ngIf=\"visible\">\n  <div *ngIf=\"!auth.logged && backgroundDisable\" class=\"backgroundDisable\"></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{'igo.auth.connection' | translate}}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-google>\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoft>\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoftb2c>\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-facebook>\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\">\n    </igo-auth-intern>\n  </div>\n\n  <div *ngIf=\"auth.logged && showAlreadyConnectedDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.welcome' | translate: user}}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">{{'igo.auth.signOut' | translate}}</button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.deconnection' | translate}}</p>\n    <button *ngIf=\"options.homeRoute\" mat-raised-button type=\"button\" (click)=\"home()\">{{'igo.auth.home' | translate}}</button>\n  </div>\n\n</div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  OnInit,\n  Input,\n  Optional,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Router, NavigationStart } from '@angular/router';\nimport { filter } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options: AuthOptions;\n  public user;\n\n  public visible = true;\n\n  private isLoginRoute: boolean;\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth') || {};\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options.logoutRoute) {\n          this.router.navigate([this.options.logoutRoute]);\n        } else if (this.options.homeRoute) {\n          this.router.navigate([this.options.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options.homeRoute) {\n      this.router.navigate([this.options.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options.logoutRoute;\n          const loginRoute = this.options.loginRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n          this.isLoginRoute = currentRoute === loginRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  HttpEvent,\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Md5 } from 'ts-md5';\n\nimport { ConfigService } from '@igo2/core';\nimport { TokenService } from './token.service';\nimport { AuthByKeyOptions, WithCredentialsOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthInterceptor implements HttpInterceptor {\n  private refreshInProgress = false;\n\n  private get trustHosts() {\n    const trustHosts = this.config.getConfig('auth.trustHosts') || [];\n    trustHosts.push(window.location.hostname);\n    return trustHosts;\n  }\n\n  private get hostsWithCredentials(): WithCredentialsOptions[] {\n    return this.config.getConfig('auth.hostsWithCredentials') || [];\n  }\n\n  private get hostsWithAuthByKey(): AuthByKeyOptions[] {\n    return this.config.getConfig('auth.hostsByKey') || [];\n  }\n\n  constructor(\n    private config: ConfigService,\n    private tokenService: TokenService,\n    private http: HttpClient\n  ) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\n    let req = originalReq.clone();\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\n    if (hostWithKey) {\n      req = req.clone({\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\n      });\n    }\n    if (withCredentials) {\n      req = originalReq.clone({\n        withCredentials\n      });\n      return next.handle(req);\n    }\n    this.refreshToken();\n    const token = this.tokenService.get();\n    const element = document.createElement('a');\n    element.href = req.url;\n    if (element.host === '') {\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\n    }\n\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return next.handle(req);\n    }\n\n    const authHeader = `Bearer ${token}`;\n    let authReq = req.clone({\n      headers: req.headers.set('Authorization', authHeader)\n    });\n\n    const tokenDecoded: any = this.tokenService.decode();\n    if (\n      authReq.params.get('_i') === 'true' &&\n      tokenDecoded &&\n      tokenDecoded.user &&\n      tokenDecoded.user.sourceId\n    ) {\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\n      authReq = authReq.clone({\n        params: authReq.params.set('_i', hashUser)\n      });\n    } else if (authReq.params.get('_i') === 'true') {\n      authReq = authReq.clone({\n        params: authReq.params.delete('_i')\n      });\n    }\n\n    return next.handle(authReq);\n  }\n\n  interceptXhr(xhr, url: string): boolean {\n    const withCredentials = this.handleHostsWithCredentials(url);\n    if (withCredentials) {\n       xhr.withCredentials = withCredentials;\n       return true;\n    }\n\n    this.refreshToken();\n    const element = document.createElement('a');\n    element.href = url;\n\n    const token = this.tokenService.get();\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return false;\n    }\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\n    return true;\n  }\n\n  alterUrlWithKeyAuth(url: string): string {\n    const hostWithKey = this.handleHostsAuthByKey(url);\n    let interceptedUrl = url;\n    if (hostWithKey) {\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\n      let urlWithKeyAdded = urlDecomposed.shift();\n      const paramsToKeep = urlDecomposed.filter(p => p.length !== 0);\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\n      if (paramsToKeep.length) {\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\n      }\n      return urlWithKeyAdded;\n    }\n    return;\n  }\n\n  private handleHostsWithCredentials(reqUrl: string) {\n    let withCredentials = false;\n    for (const hostWithCredentials of this.hostsWithCredentials) {\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        withCredentials = hostWithCredentials.withCredentials !== undefined ? hostWithCredentials.withCredentials : undefined;\n        break;\n      }\n    }\n    return withCredentials;\n  }\n\n  private handleHostsAuthByKey(reqUrl: string): {key: string, value: string} {\n    let hostWithKey;\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\n        var keyAdded = new RegExp(replace,\"gm\");\n        if (!keyAdded.test(reqUrl)) {\n          hostWithKey = {key : hostWithAuthByKey.keyProperty, value: hostWithAuthByKey.keyValue};\n          break;\n        }\n      }\n    }\n    return hostWithKey;\n  }\n\n  refreshToken() {\n    const jwt = this.tokenService.decode();\n    const currentTime = new Date().getTime() / 1000;\n\n    if (\n      !this.refreshInProgress &&\n      jwt &&\n      currentTime < jwt.exp &&\n      currentTime > jwt.exp - 1800\n    ) {\n      this.refreshInProgress = true;\n\n      const url = this.config.getConfig('auth.url');\n      return this.http.post(`${url}/refresh`, {}).subscribe(\n        (data: any) => {\n          this.tokenService.set(data.token);\n          this.refreshInProgress = false;\n        },\n        err => {\n          err.error.caught = true;\n          return err;\n        }\n      );\n    }\n  }\n}\n","import {\n  MSAL_GUARD_CONFIG,\n  MSAL_INSTANCE,\n  MsalService,\n} from '@azure/msal-angular';\n\nimport {\n  PublicClientApplication,\n  InteractionType\n} from '@azure/msal-browser';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { BrowserAuthOptions } from '@azure/msal-browser';\n\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from './auth.interface';\n\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\nexport function MSALConfigFactory(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoft') || {};\n\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALConfigFactoryb2c(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALAngularConfigFactory(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: AuthMicrosoftOptions = config.getConfig('auth.microsoft') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: ['user.read'],\n      loginHint: 'todo',\n    },\n    type: 'add'\n  };\n}\n\nexport function MSALAngularConfigFactoryb2c(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: [msConf.clientId]\n    },\n    type: 'b2c'\n  };\n}\n\nexport function provideAuthMicrosoft(type?: string) {\n  if (type === 'b2c') {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactoryb2c,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactoryb2c,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalServiceb2c\n    ];\n  } else {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactory,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactory,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalService\n    ];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { StorageService, StorageScope, ConfigService } from '@igo2/core';\nimport { AuthService } from './auth.service';\nimport { TokenService } from './token.service';\nimport { AuthStorageOptions } from './storage.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthStorageService extends StorageService {\n  protected options: AuthStorageOptions;\n\n  constructor(\n    config: ConfigService,\n    private http: HttpClient,\n    private authService: AuthService,\n    private tokenService: TokenService\n  ) {\n    super(config);\n\n    this.authService.authenticate$.subscribe(isAuthenticated => {\n      if (isAuthenticated && this.options.url) {\n        this.http\n          .get(this.options.url)\n          .subscribe((userIgo: { preference: object }) => {\n            if (userIgo && userIgo.preference) {\n              for (const key of Object.keys(userIgo.preference)) {\n                const value = userIgo.preference[key];\n                super.set(key, value);\n              }\n            }\n          });\n      }\n    });\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = value;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.set(key, value, scope);\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = undefined;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.remove(key, scope);\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http.patch(this.options.url, { preference: {}}, {\n        params: {\n          mergePreference: 'false'\n        }\n      }).subscribe();\n    }\n\n    let token: string;\n    if (scope === StorageScope.LOCAL) {\n      token = this.tokenService.get();\n    }\n\n    super.clear(scope);\n\n    if (token) {\n      this.tokenService.set(token);\n    }\n\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .get(this.options.url)\n        .subscribe((userIgo: { preference: object }) => {\n          if (userIgo && userIgo.preference) {\n            for (const key of Object.keys(userIgo.preference)) {\n              const value = userIgo.preference[key];\n              super.set(key, value);\n            }\n          }\n        });\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MsalModule } from '@azure/msal-angular';\n\nimport { StorageService, IgoLanguageModule } from '@igo2/core';\n\nimport { AuthStorageService } from './shared/storage.service';\nimport { ProtectedDirective } from './shared/protected.directive';\nimport { AuthInterceptor } from './shared/auth.interceptor';\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\n\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\nimport { AuthFormComponent } from './auth-form/auth-form.component';\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    MsalModule\n  ],\n  declarations: [\n    AuthFormComponent,\n    AuthGoogleComponent,\n    AuthInternComponent,\n    AuthFacebookComponent,\n    AuthMicrosoftComponent,\n    AuthMicrosoftb2cComponent,\n    ProtectedDirective\n  ],\n  exports: [AuthFormComponent, ProtectedDirective]\n})\nexport class IgoAuthModule {\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\n    return {\n      ngModule: IgoAuthModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: AuthInterceptor,\n          multi: true\n        },\n        {\n          provide: StorageService,\n          useClass: AuthStorageService\n        },\n        ...provideAuthMicrosoft('add'),\n        ...provideAuthMicrosoft('b2c')\n      ]\n    };\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppAuthFormComponent } from './auth-form.component';\n\nconst routes: Routes = [\n  {\n    path: 'auth-form',\n    component: AppAuthFormComponent\n  }\n];\n\nexport const AppAuthFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss']\n})\nexport class AppAuthFormComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private languageService: LanguageService) {}\n}\n","<mat-card>\n  <mat-card-subtitle>Auth</mat-card-subtitle>\n  <mat-card-title>Authentification</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/auth/auth-form\">code of this example</a><br>\n    See auth section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n  </mat-card-content>\n</mat-card>\n\n<igo-auth-form></igo-auth-form>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { AppAuthFormComponent } from './auth-form.component';\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\n\n@NgModule({\n  declarations: [AppAuthFormComponent],\n  imports: [AppAuthFormRoutingModule, MatCardModule, IgoAuthModule.forRoot()],\n  exports: [AppAuthFormComponent]\n})\nexport class AppAuthFormModule {}\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"(options && options.metadata && options.metadata.url) || (options && options.metadata && options.metadata.abstract)\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\">\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import { Component, Input, ChangeDetectionStrategy, Inject, ViewEncapsulation } from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      if (!metadata.url && metadata.abstract) {\n        this.dialog.open(MetadataAbstractComponent, {\n          data: {\n            layerTitle: this.layer.title,\n            abstract: metadata.abstract,\n            type: metadata.type\n          }\n        });\n      } else if (metadata.url) {\n        this.metadataService.open(metadata);\n      }\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { MatDialogModule } from '@angular/material/dialog';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { MetadataButtonComponent, MetadataAbstractComponent } from './metadata-button/metadata-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ],\n  exports: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent],\n  declarations: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent]\n})\nexport class IgoMetadataModule {\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\n    return {\n      ngModule: IgoMetadataModule,\n      providers: []\n    };\n  }\n}\n","import * as olproj from 'ol/proj';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\n\nimport { NumberUtils } from '@igo2/utils';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|°]?\\\\s*([0-9]{1,2})?[:|\\'|′|’]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"|″|”]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      lon,\n      ,\n      decimalLon,\n      negativeLat,\n      lat,\n      ,\n      decimalLat\n    ] = coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\n    (lonLat[1] > 90 || lonLat[1] < -90)\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number], decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach(dd => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees}° ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(coord: [number, number], decimal: number = 3): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)] as [number, number];\n}\n\nexport function roundCoordToString(coord: [number, number], decimal: number = 3): [string, string]{\n    return roundCoordTo(coord, decimal).map(r => r.toString()) as [string, string];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @param reverseCoords To reverse coords from latLon to lonLat (search option)\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [number, number];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [number, number];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [number, number];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach(projection => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [number, number];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(', ')} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { DataSource, Legend } from '../../../datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\n\nimport { LayerOptions } from './layer.interface';\nimport { Message, MessageService } from '@igo2/core';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: IgoMap;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<\n    boolean\n  > = new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value === 0 ? 0 : value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value){\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter(m => m.options?.showOnEachLayerVisibility)\n        .map(message =>\n          this.showMessage(message)\n        );\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor,\n    protected geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(igoMap: IgoMap | undefined) {\n    this.map = igoMap;\n\n    this.unobserveResolution();\n    if (igoMap !== undefined) {\n      this.observeResolution();\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map(message => {\n            this.showMessage(message);\n          });\n        }\n      });\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { Message } from '@igo2/core';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { MapExtent, MapViewOptions } from '../../../map/shared/map.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  security?: LayerSecurityOptions;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n  showButtonZoomToExtent?: boolean;\n}\n\nexport interface LayerSecurityOptions {\n  profils?: string[]\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n  searchIndexEnabled?: boolean;\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  /** Default value is true */\n  showInMiniBaseMap?: boolean;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n\nexport interface LegendOptions {\n  collapsed?: boolean;\n  display?: boolean;\n  url?: string;\n  html?: string;\n  stylesAvailable?: ItemStyleOptions[];\n}\n\nexport interface LegendMapViewOptions extends MapViewOptions{\n  scale?: number;\n  size?: [number, number];\n}\n\nexport interface ItemStyleOptions {\n  name: string;\n  title?: string;\n}\n\nexport interface OutputLayerLegend {\n  title: string;\n  url: string;\n  display: boolean;\n  isInResolutionsRange: boolean;\n}\n","import olSourceImage from 'ol/source/Image';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\nimport { MessageService } from '@igo2/core';\nimport { ImageLayer } from '../shared/layers/image-layer';\n\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n\n    if (!event.image.__watchers__) {\n      return;\n    }\n    this.messageService.error(\n      'igo.geo.dataSource.unavailable',\n      'igo.geo.dataSource.unavailableTitle',\n      undefined,\n      { value: event.target.params_.LAYERS });\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n\n  }\n}\n","import { AnyLayerOptions } from \"../shared/layers/any-layer.interface\";\nimport { VectorTileLayerOptions } from \"../shared/layers/vectortile-layer.interface\";\n\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.igoStyle?.styleByAttribute?.hoverStyle || vectorTileLayerOptions.igoStyle?.hoverStyle)) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import olSourceTile from 'ol/source/Tile';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { TileLayer } from '../shared/layers/tile-layer';\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\nimport { Md5 } from 'ts-md5';\n\nimport { uuid } from '@igo2/utils';\n\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { WFSDataSourceOptions } from '../datasource';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  if (!options.url) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(options: ArcGISRestDataSourceOptions) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(p => p.length !== 0 && p.charAt(0) !== '_');\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DataSourceOptions,\n  Legend\n} from './datasource.interface';\n\nimport { DataService } from './data.service';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { LegendMapViewOptions, LegendOptions } from '../../../layer/shared/layers/layer.interface';\n\nexport abstract class DataSource {\n\n  public id: string;\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource ;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id || this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url} ];\n    } else if (options.html) {\n      this.legend = [{ html: options.html} ];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public options: FeatureDataSourceOptions;\n  public ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public options: ClusterDataSourceOptions;\n  public ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { AuthInterceptor } from '@igo2/auth';\n\nimport { ImageWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\n\nimport { Layer } from './layer';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { MessageService } from '@igo2/core';\n\nexport class ImageLayer extends Layer {\n  public dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public options: ImageLayerOptions;\n  public ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe(valStatus => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(tile, src: string, interceptor: AuthInterceptor, messageService: MessageService) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function() {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error('igo.geo.dataSource.optionsApiUnavailable','igo.geo.dataSource.unavailableTitle');\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\nimport Tile from 'ol/Tile';\n\nimport { TileWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\n\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nimport { MessageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nexport class TileLayer extends Layer {\n  public dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public options: TileLayerOptions;\n  public ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor ) {\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","export enum OgcFilterOperatorType {\n    BasicNumericOperator = 'basicnumericoperator',\n    Basic = 'basic',\n    BasicAndSpatial = 'basicandspatial',\n    Spatial = 'spatial',\n    All = 'all',\n    Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n    BBOX = 'BBox',\n    PropertyIsBetween = 'PropertyIsBetween',\n    Contains = 'Contains',\n    During = 'During',\n    PropertyIsEqualTo = 'PropertyIsEqualTo',\n    PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n    PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n    Intersects = 'Intersects',\n    PropertyIsNull = 'PropertyIsNull',\n    PropertyIsLessThan = 'PropertyIsLessThan',\n    PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n    PropertyIsLike = 'PropertyIsLike',\n    PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n    Within = 'Within',\n    And = 'And',\n    Or = 'Or',\n    Not = 'Not'\n}\n","import * as olfilter from 'ol/format/filter';\nimport olFormatWKT from 'ol/format/WKT';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olGeometry from 'ol/geom/Geometry';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\n\nimport {\n  OgcFilter,\n  IgoOgcFilterObject,\n  AnyBaseOgcFilterOptions,\n  OgcInterfaceFilterOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  IgoOgcSelector,\n  SelectorGroup,\n  OgcSelectorBundle\n} from './ogc-filter.interface';\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { default as moment } from 'moment';\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (ogcFiltersOptions.enabled && (ogcFiltersOptions.pushButtons || ogcFiltersOptions.checkboxes\n      || ogcFiltersOptions.radioButtons || ogcFiltersOptions.select || ogcFiltersOptions.autocomplete)) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: [number, number, number, number],\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary || 1e40*-1,\n          wfsUpperBoundary || 1e40\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern ? wfsPattern.replace(/[()_]/gi, wfsSingleChar): wfsWildCard,\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n      ? proj.getCode()\n      : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error(\n          'You must set an id for each of your bundles'\n        );\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: [number, number, number, number],\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (ogcFilters.enabled && (ogcFilters.pushButtons || ogcFilters.checkboxes || ogcFilters.radioButtons || ogcFilters.select\n      || ogcFilters.autocomplete)) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.autocomplete) {\n        selectors = ogcFilters.autocomplete;\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach(bundle => {\n      if (!bundle.multiple && bundle.selectors) {\n        const enableds = bundle.selectors.reduce((list, filter, index) => (filter.enabled) === true ? list.concat(index) : list, []);\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach(index => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(\n      selectors\n    );\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) => bundleCondition.push(enabledSelector.filters));\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    } else if (selectors.selectorType === 'autocomplete') {\n      ogcFilters.autocomplete = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n\n    if (!processedFilter) {return undefined;};\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (value === 'today') {\n      return undefined;\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n}\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\n\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(options, undefined, options.paramsWFS.srsName);\n  let igoFilters;\n  if (ogcFilters && ogcFilters.enabled) {\n    igoFilters = ogcFilters.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName, options);\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(options, ogcFilters.geometryName, extent, proj);\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\n  options.download = Object.assign({}, options.download, { dynamicUrl: baseUrl });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex = paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n    : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n      outputFormat = '';\n      version = 'version=1.1.0';\n      cnt = cnt.replace('count', 'maxFeatures');\n    }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n    ? 'srsname=' + paramsWFS.srsName\n    : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML2 }});\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML32 }});\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML3 }});\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","export enum InsertSourceInsertDBEnum {\n    System = 'system',\n    User = 'user'\n  }\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { unByKey } from 'ol/Observable';\nimport { easeOut } from 'ol/easing';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { getVectorContext } from 'ol/render';\nimport olFeature from 'ol/Feature';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport * as olformat from 'ol/format';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\nimport { VectorWatcher } from '../../utils';\nimport { IgoMap, MapExtent, getResolutionFromScale } from '../../../map';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport { buildUrl, defaultMaxFeatures } from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { GeoNetworkService, SimpleGetOptions } from '../../../offline/shared/geo-network.service';\nimport { catchError, concatMap, debounceTime, delay, first } from 'rxjs/operators';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { fromEvent, of, zip } from 'rxjs';\nimport { InsertSourceInsertDBEnum } from '../../../offline/geoDB/geoDB.enums';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\nimport { LayerDBData } from '../../../offline';\nimport BaseEvent from 'ol/events/Event';\nimport { olStyleToBasicIgoStyle } from '../../../style/shared/vector/conversion.utils';\nimport { FeatureDataSourceOptions } from '../../../datasource/shared/datasources/feature-datasource.interface';\nimport { ObjectUtils } from '@igo2/utils';\n\nexport class VectorLayer extends Layer {\n  public dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public options: VectorLayerOptions;\n  public ol: olLayerVector<olSourceVector<OlGeometry>>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor,\n    private geoNetworkService?: GeoNetworkService,\n    public geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    super(options, messageService, authInterceptor, geoDBService, layerDBService);\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\n    const initialOpacityValue = this.options.opacity || 1;\n    const initialVisibleValue = this.options.visible !== false;\n    const initialMinResValue = this.options.minResolution || getResolutionFromScale(Number(this.options.minScaleDenom));\n    const initialMaxResValue = this.options.maxResolution || getResolutionFromScale(Number(this.options.maxScaleDenom));\n    const so = this.options.sourceOptions as FeatureDataSourceOptions;\n    if (this.dataSource instanceof FeatureDataSource) {\n      if (so?.preload?.bypassResolution || so?.preload?.bypassVisible) {\n        this.options.opacity = 0;\n        if (so.preload.bypassResolution && (this.options.minResolution || this.options.maxResolution)) {\n          this.options.minResolution = 0;\n          this.options.maxResolution = Infinity;\n        }\n        if (so.preload.bypassVisible && !initialVisibleValue) {\n          this.options.visible = true;\n        }\n      }\n    }\n\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector<OlGeometry>\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function(e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      if (this.options.idbInfo.firstLoad){\n        this.maintainFeaturesInIdb();\n      }\n      this.dataSource.ol.once('featuresloadend', () => {\n        this.dataSource.ol.on('addfeature', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('changefeature', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('clear', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('removefeature', () => this.maintainFeaturesInIdb());\n      });\n    }\n\n    if (\n      this.dataSource instanceof FeatureDataSource &&\n      (so?.preload?.bypassResolution || so?.preload?.bypassVisible)) {\n      this.dataSource.ol.once('featuresloadend', () => {\n        if (initialOpacityValue) {\n          this.opacity = initialOpacityValue;\n        }\n        if (so.preload.bypassResolution) {\n          this.minResolution = initialMinResValue;\n          this.maxResolution = initialMaxResValue;\n        }\n        if (so.preload.bypassVisible) {\n          this.visible = initialVisibleValue;\n        }\n      });\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\n    const url = vectorSource.getUrl();\n    if (url) {\n      let loader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (wfsOptions?.type === 'wfs' && (wfsOptions.params || wfsOptions.paramsWFS)) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    } else if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      const idbLoader = (extent, resolution, proj, success, failure) => {\n        this.customIDBLoader(\n          vectorSource,\n          olOptions.id,\n          extent,\n          proj,\n          success,\n          failure\n        );\n      };\n      if (idbLoader) {\n        vectorSource.setLoader(idbLoader);\n      }\n    }\n\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      vector.once('sourceready', () => {\n        if (this.options.idbInfo.firstLoad){\n          this.maintainOptionsInIdb();\n        }\n        fromEvent<BaseEvent>(vector, 'change').pipe(debounceTime(750)).subscribe(() => this.maintainOptionsInIdb());\n        vector.on('change:zIndex', () => this.maintainOptionsInIdb());\n      });\n    }\n    return vector;\n  }\n\n  removeLayerFromIDB() {\n    if (this.geoDBService && this.layerDBService) {\n      zip(this.geoDBService.deleteByKey(this.id),\n        this.layerDBService.deleteByKey(this.id)).subscribe();\n    }\n  }\n\n  private maintainOptionsInIdb() {\n    this.options.igoStyle.igoStyleObject = olStyleToBasicIgoStyle(this.ol);\n    const layerData: LayerDBData = ObjectUtils.removeUndefined({\n      layerId: this.id,\n      detailedContextUri: this.options.idbInfo.contextUri,\n      sourceOptions: {\n        id: this.id,\n        type: 'vector',\n        queryable: true\n      },\n      layerOptions: {\n        workspace: this.options.workspace,\n        zIndex: this.ol ? this.zIndex: 1000000,\n        id: this.id,\n        isIgoInternalLayer: this.isIgoInternalLayer,\n        title: this.title,\n        igoStyle: this.options.igoStyle,\n        idbInfo: Object.assign({}, this.options.idbInfo, { firstLoad: false })\n      },\n      insertEvent: `${this.title}-${this.id}-${new Date()}`\n    });\n    this.layerDBService.update(layerData);\n  }\n\n  private maintainFeaturesInIdb() {\n    const dsFeatures = this.dataSource.ol.getFeatures();\n    const geojsonObject = JSON.parse(new olformat.GeoJSON().writeFeatures(dsFeatures, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.dataSource.ol.getProjection() || 'EPSG:3857'\n    }));\n    this.geoDBService.update(this.id, this.id, geojsonObject, InsertSourceInsertDBEnum.User, `${this.title}-${this.id}-${new Date()}`);\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          if(styleClone.getImage() !== null &&\n            typeof styleClone.getImage().getRadius === 'function'){\n            const radius =\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n            styleClone.getImage().setRadius(radius);\n            styleClone.getImage().setOpacity(opacity);\n          }\n\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public setExtent(extent: MapExtent): void {\n    this.options.extent = extent;\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function(e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol.getView().setCenter((feat.getGeometry() as any).getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource,\n    options,\n    interceptor,\n    extent,\n    resolution,\n    proj,\n    success,\n    failure,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        (options as OgcFilterableDataSourceOptions).ogcFilters,\n        randomParam);\n      let startIndex = 0;\n      if (paramsWFS.version === '2.0.0' && paramsWFS.maxFeatures > defaultMaxFeatures) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace('count=' + paramsWFS.maxFeatures, 'count=' + nbOfFeature);\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, alteredUrl, nbOfFeature, success, failure);\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, url, paramsWFS.maxFeatures, success, failure);\n      }\n    }\n  }\n\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param threshold the threshold to manage \"more features\" (TODO)\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector<OlGeometry>,\n    interceptor,\n    extent,\n    dataProjection,\n    featureProjection,\n    url: string,\n    threshold: number,\n    success, failure) {\n\n    const idAssociatedCall = (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter;\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features =\n          vectorSource\n            .getFormat()\n            .readFeatures(xhr.responseText, { dataProjection, featureProjection }) as olFeature<OlGeometry>[];\n        // TODO Manage \"More feature\"\n        /*if (features.length === 0 || features.length < threshold ) {\n          console.log('No more data to download at this resolution');\n        }*/\n        // Avoids retrieving an older call that took longer to be process\n        if (idAssociatedCall === (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter)\n        {\n            vectorSource.addFeatures(features);\n            success(features);\n        }\n        else {\n            success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource,\n    url,\n    interceptor,\n    extent,\n    resolution,\n    projection,\n    success,\n    failure\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    } else {\n      modifiedUrl = url(extent, resolution, projection);\n    }\n\n    if (this.geoNetworkService && typeof url !== 'function') {\n      const format = vectorSource.getFormat();\n      const type = format.getType();\n\n      let responseType = type;\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n\n      const options: SimpleGetOptions = { responseType };\n      this.geoNetworkService.geoDBService.get(url).pipe(delay(750)).pipe(concatMap(r =>\n        r ? of(r) : this.geoNetworkService.get(modifiedUrl, options)\n          .pipe(\n            first(),\n            catchError((res) => {\n              onError();\n              throw res;\n            })\n          )\n      ))\n      .subscribe((content) => {\n          if (content) {\n            const format = vectorSource.getFormat();\n            const type = format.getType();\n            let source;\n            if (type === 'json' || type === 'text') {\n              source = content;\n            } else if (type === 'xml') {\n              source = content;\n              if (!source) {\n                source = new DOMParser().parseFromString(\n                  content,\n                  'application/xml'\n                );\n              }\n            } else if (type === 'arraybuffer') {\n              source = content;\n            }\n            if (source) {\n              const features = format.readFeatures(source, { extent, featureProjection: projection });\n              vectorSource.addFeatures(features, format.readProjection(source));\n              success(features);\n            } else {\n              onError();\n            }\n          }\n        });\n\n    } else {\n    xhr.open( 'GET', modifiedUrl);\n    const format = vectorSource.getFormat();\n    if (format.getType() === 'arraybuffer') {\n      xhr.responseType = 'arraybuffer';\n    }\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      // status will be 0 for file:// urls\n      if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n        const type = format.getType();\n        let source;\n        if (type === 'json' || type === 'text') {\n          source = xhr.responseText;\n        } else if (type === 'xml') {\n          source = xhr.responseXML;\n          if (!source) {\n            source = new DOMParser().parseFromString(\n              xhr.responseText,\n              'application/xml'\n            );\n          }\n        } else if (type === 'arraybuffer') {\n          source = xhr.response;\n        }\n        if (source) {\n          const features = format.readFeatures(source, { extent, featureProjection: projection });\n          vectorSource.addFeatures(features, format.readProjection(source));\n          success(features);\n        } else {\n          onError();\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n  }\n\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param layerID the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customIDBLoader(\n    vectorSource,\n    layerID,\n    extent,\n    projection,\n    success,\n    failure\n  ) {\n\n\n    if (this.geoNetworkService) {\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n      this.geoNetworkService.geoDBService.get(layerID)\n      .subscribe((content) => {\n          if (content) {\n            const format = vectorSource.getFormat();\n            const type = format.getType();\n            let source;\n            if (type === 'json' || type === 'text') {\n              source = content;\n            } else if (type === 'xml') {\n              source = content;\n              if (!source) {\n                source = new DOMParser().parseFromString(\n                  content,\n                  'application/xml'\n                );\n              }\n            } else if (type === 'arraybuffer') {\n              source = content;\n            }\n            if (source) {\n              const features = format.readFeatures(source, { extent, featureProjection: projection });\n              vectorSource.addFeatures(features, format.readProjection(source));\n              success(features);\n            } else {\n              onError();\n            }\n          }\n        });\n\n    }\n  }\n\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nexport function olStyleToBasicIgoStyle(layer: olLayerVector<olSourceVector<OlGeometry>>) {\n    const layerOlStyle = layer.getStyle();\n    if (typeof layerOlStyle === 'function' || layerOlStyle instanceof Array) {\n      return;\n    }\n\n    const rStyle = {\n      fill: {\n        color: layerOlStyle.getFill().getColor()\n      },\n      stroke: {\n        color: layerOlStyle.getStroke().getColor(),\n        width: 2\n      },\n      circle: {\n        fill: {\n          color: (layerOlStyle.getImage() as any).getFill().getColor()\n        },\n        stroke: {\n          color: (layerOlStyle.getImage() as any).getStroke().getColor(),\n          width: 2\n        },\n        radius: 5,\n      }\n    };\n    return rStyle;\n  }\n","import olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\n\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\nimport { TileWatcher } from '../../utils';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { IgoMap } from '../../../map';\nimport { MessageService } from '@igo2/core';\nimport VectorTile from 'ol/VectorTile';\n\nexport class VectorTileLayer extends Layer {\n  public dataSource: MVTDataSource;\n  public options: VectorTileLayerOptions;\n  public ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(url, tile.getFormat(), this.authInterceptor, tile.onLoad.bind(tile));\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    }\n    );\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return ((extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open( 'GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          }\n          else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\n            }\n          }\n          else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(this, format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }), format.readProjection(source));\n          }\n          else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    });\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public options: OSMDataSourceOptions;\n  public ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public options: XYZDataSourceOptions;\n  public ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport {\n  defaultFieldNameGeometry,\n  checkWfsParams,\n  getFormatFromOptions,\n  buildUrl\n} from './wms-wfs.utils';\nimport { AuthInterceptor } from '@igo2/auth';\n\nexport class WFSDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public mostRecentIdCallOGCFilter: number = 0;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons){\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes){\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons){\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select){\n      ogcFilters.select.selectorType = 'select';\n    }\n    if (ogcFilters?.autocomplete){\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\n    }\n\n    this.setOgcFilters((this.options as OgcFilterableDataSourceOptions).ogcFilters, true);\n  }\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      url: (extent, resolution, proj: olProjection) => {\n        const paramsWFS = this.options.paramsWFS;\n        const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\n      },\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    this.mostRecentIdCallOGCFilter += 1;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() { }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport olFeature from 'ol/Feature';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { DataService } from './data.service';\nimport { formatWFSQueryString,\n          gmlRegex,\n          defaultEpsg,\n          defaultMaxFeatures,\n          getFormatFromOptions} from './wms-wfs.utils';\nimport { concatMap } from 'rxjs/operators';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields = getfeatureSourceField;\n      });\n\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\n          if (sourcefield.alias === undefined) {\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n          }\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\n          }\n        });\n      });\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName, startIndex, forceDefaultOutputFormat );\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (forceDefaultOutputFormat || gmlRegex.test(outputFormat) || !outputFormat) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable(d => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions = JSON.parse(\n        JSON.stringify(dataSourceOptions)\n      );\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields?.filter(f => !f.values).map(f => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true).pipe(\n        concatMap(res => String(res).toLowerCase().includes('exception') ? of(false) : of(true)),\n        concatMap(allowGml => {\n          // If the service return GML (return no exception)\n          return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n            concatMap(firstFeature => {\n              const features = olFormats.readFeatures(firstFeature);\n              fieldList = features[0].getKeys();\n              if (dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0) {\n                sourceFieldsToRetrieveValues = fieldList;\n              }\n              fieldListWoGeom = fieldList.filter(\n                field =>\n                  sourceFieldsToRetrieveValues.includes(field) &&\n                  field !== features[0].getGeometryName() &&\n                  !field.match(/boundedby/gi)\n              );\n              fieldListWoGeomStr = fieldListWoGeom.join(',');\n              const processingArray = [];\n              let startIndex = 0;\n              // If the service do not allow gml return, dice the call in multiple\n              // calls by increment of chunkSize with the original outputFormat\n              if (\n                !allowGml && dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures) {\n                const chunkSize = 1000;\n                while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                  processingArray.push(this.wfsGetFeature(\n                    dataSourceOptions,\n                    chunkSize,\n                    dataSourceOptions.paramsWFS.srsName,\n                    fieldListWoGeomStr,\n                    startIndex\n                  ));\n                  startIndex += chunkSize;\n                }\n                effectiveOlFormats = olFormats;\n              } else {\n                processingArray.push(this.wfsGetFeature(\n                  dataSourceOptions,\n                  dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\n                  dataSourceOptions.paramsWFS.srsName,\n                  fieldListWoGeomStr,\n                  0, true\n                ));\n              }\n              return combineLatest(processingArray);\n            })\n          );\n        })).subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach(element => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields.filter(f => f.name === key).forEach(v => {\n            if (v.values.indexOf(featureProperties[key]) === -1) {\n              v.values.push(featureProperties[key]);\n            }\n          });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","export abstract class DataService {\n    abstract getData(): string;\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions, OgcFilterDuringOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport {\n  formatWFSQueryString,\n  checkWfsParams,\n  defaultFieldNameGeometry\n} from './wms-wfs.utils';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/layer.interface';\nimport { BehaviorSubject } from 'rxjs';\nimport { TimeFilterableDataSourceOptions, TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\n\nexport class WMSDataSource extends DataSource {\n  public ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  set timeFilter(value: TimeFilterOptions ) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach(sourceField => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        initOgcFilters,\n        fieldNameGeometry,\n        'wms'\n      );\n    } else {\n      initOgcFilters.advancedOgcFilters = (initOgcFilters.pushButtons || initOgcFilters.checkboxes\n        || initOgcFilters.radioButtons || initOgcFilters.select || initOgcFilters.autocomplete)\n        ? false\n        : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n          const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n          if(filterDuring.calendarModeYear) {\n            initOgcFilters.advancedOgcFilters = false;\n          }\n      }\n      if (initOgcFilters.pushButtons){\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes){\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons){\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select){\n        initOgcFilters.select.selectorType = 'select';\n      }\n      if (initOgcFilters.autocomplete){\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.ol.updateParams({'FILTER': sourceParams.FILTER});\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions = (options as TimeFilterableDataSourceOptions);\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\n      .value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ratio: 1}, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n      this.ol.notify('timeFilter', this.ogcFilters);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && (style === undefined && !view?.scale)) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (view?.size && view?.extent && view?.projection && this.options.contentDependentLegend) {\n      projParam = this.params.VERSION === '1.3.0' || this.params.VERSION === undefined ? 'CRS' : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : style as string\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public options: WMTSDataSourceOptions;\n  public ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class CartoDataSource extends DataSource {\n  public ol: olSourceCarto;\n  public options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend !== null) {\n      this.options.config.layers[0].legend.items.forEach(f => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function(extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach(element => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(legendElement.contentType, legendElement.imageData);\n        label = legendElement.label ? legendElement.label.replace('<Null>', 'Null') : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === \"uniqueValue\") {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(legendElement.symbol.contentType, legendElement.symbol.imageData);\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === \"simple\") {\n      label = legendInfo.label ? legendInfo.label.replace('<Null>', 'Null') : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(legendInfo.symbol.contentType, legendInfo.symbol.imageData);\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string = `stroke:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\" `+ strokeDashArray + `/></svg>`;\n      }\n    } else if (symbol.style === 'esriSMSCircle' || symbol.style === 'esriSFSSolid') {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke = `stroke:rgba(` + outlineColor[0] + ',' + outlineColor[1] + ',' + outlineColor[2] + ',' + outlineColor[3] + ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill = `fill:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg = `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` + size/2 + `\" style=\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      } else {\n        svg = `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nexport class ImageArcGISRestDataSource extends DataSource {\n  public ol: ImageArcGISRest;\n  public options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params = this.options.layer === undefined ? this.options.params : Object.assign(\n      {LAYERS: `show:${this.options.layer}`},\n      this.options.params\n    );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public ol: olSourceTileArcGISRest;\n  public options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public options: TileDebugDataSourceOptions;\n  public ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(event.data) as olFeature<OlGeometry>;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { Md5 } from 'ts-md5';\nimport feature from 'ol/Feature';\nimport olSourceVectorTile from 'ol/source/VectorTile';\nimport olFormatMVT from 'ol/format/MVT';\n\nimport { uuid } from '@igo2/utils';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public options: MVTDataSourceOptions;\n  public ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({featureClass: feature});\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n        return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import * as olstyle from 'ol/style';\nimport * as olproj from 'ol/proj';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function(feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","export enum TimeFilterType {\n    DATE = 'date',\n    TIME = 'time',\n    DATETIME = 'datetime',\n    YEAR = 'year',\n}\n\nexport enum TimeFilterStyle {\n    CALENDAR = 'calendar',\n    SLIDER = 'slider',\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpClient,\n  HttpParams\n} from '@angular/common/http';\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\nimport olAttribution from 'ol/control/Attribution';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { EsriStyleGenerator } from '../../style/shared/datasource/esri-style-generator';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\n\nimport {\n  WMTSDataSourceOptions,\n  WMSDataSourceOptions,\n  CartoDataSourceOptions,\n  ArcGISRestDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions\n} from './datasources';\nimport {\n  LegendOptions,\n  ItemStyleOptions\n} from '../../layer/shared/layers/layer.interface';\nimport {\n  TimeFilterType,\n  TimeFilterStyle\n} from '../../filter/shared/time-filter.enum';\nimport * as olproj from 'ol/proj';\n\nexport enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(private http: HttpClient, private mapService: MapService) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const serviceCapabilities = this.getCapabilities('arcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    return forkJoin([arcgisOptions, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getImageArcgisOptions(\n    baseOptions: ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('imagearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('tilearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic ?\n        olproj.transformExtent(layer.EX_GeographicBoundingBox, 'EPSG:4326', this.mapService.getMap().projection) :\n        undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    serviceCapabilities: any,\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers ? legend.layers.find(x => x.layerName === title) : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions>;\n}\n","import { Injectable } from '@angular/core';\n\nimport proj4 from 'proj4';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n\n  constructor(private config: ConfigService) {\n    const projections = this.config.getConfig('projections') || [];\n    projections.forEach((projection: Projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport { OptionsService } from './options/options.service';\nimport { WFSService } from './datasources/wfs.service';\nimport {\n  DataSource,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  XYZDataSource,\n  XYZDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ImageArcGISRestDataSource,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  WebSocketDataSource,\n  AnyDataSourceOptions,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions\n} from './datasources';\nimport { ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ProjectionService } from '../../map/shared/projection.service';\nimport { AuthInterceptor } from '@igo2/auth';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private projectionService: ProjectionService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(context: AnyDataSourceOptions, detailedContextUri?: string): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(context as TileDebugDataSource);\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable(d => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable(d => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable(d =>\n      d.next(new WFSDataSource(context, this.wfsDataSourceService, this.authInterceptor))\n    );\n  }\n\n  private createWMSDataSource(context: WMSDataSourceOptions, detailedContextUri?: string): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError(e => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS });\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (this.optionsService && context.optionsFromApi && window.navigator.onLine) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          this.messageService.error(\n            'igo.geo.dataSource.unavailable',\n            'igo.geo.dataSource.unavailableTitle',\n            undefined,\n            { value: context.layer });\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable(d => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable(d => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable(d => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable(d => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(this.capabilitiesService.getArcgisOptions(context).pipe(\n        catchError(e => {\n          this.messageService.error(\n            'igo.geo.dataSource.unavailable',\n            'igo.geo.dataSource.unavailableTitle',\n            undefined,\n            { value: context.layer });\n          throw e;\n        })\n      ));\n    }\n    if (this.optionsService && context.optionsFromApi && window.navigator.onLine) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    if (window.navigator.onLine) {\n      observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n        catchError(e => {\n          this.messageService.error(\n            'igo.geo.dataSource.unavailable',\n            'igo.geo.dataSource.unavailableTitle',\n            undefined,\n            { value: context.params.LAYERS });\n          throw e;\n        })\n      ));\n    }\n    if (this.optionsService && context.optionsFromApi && window.navigator.onLine) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n        catchError(e => {\n          this.messageService.error(\n            'igo.geo.dataSource.unavailable',\n            'igo.geo.dataSource.unavailableTitle',\n            undefined,\n            { value: context.params.LAYERS });\n          throw e;\n        })\n      ));\n    }\n    if (this.optionsService && context.optionsFromApi && window.navigator.onLine) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable(d => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable(d => d.next(new ClusterDataSource(context)));\n  }\n}\n","import * as olextent from 'ol/extent';\nimport * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport type { GeometryLayout } from 'ol/geom/Geometry';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { uuid } from '@igo2/utils';\n\nimport {\n  EntityKey,\n  getEntityId,\n  getEntityTitle,\n  getEntityRevision,\n  getEntityIcon,\n  getEntityProperty\n} from '@igo2/common';\n\nimport { IgoMap } from '../../map';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\nimport { FeatureStore } from './store';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(olRenderFeature.getFlatCoordinates(), 'XY' as GeometryLayout);\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout,\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(olRenderFeature.getExtent(), projectionIn, projectionOut) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        ((sourceOptions.type === 'arcgisrest' || sourceOptions.type === 'tilearcgisrest') ? 'OBJECTID' : undefined );\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId() ? olFeature.getId() : olFeature.get(idColumn) ? olFeature.get(idColumn) : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  map: IgoMap,\n  olFeature: OlFeature<OlGeometry>\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      map.projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[]\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * By default, we define the edge as 5% (0.05) of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param edgeRatio Number or Number[] Single value OR an array =>\n *  [top,right,bottom,left] directions, in that order\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number],\n  edgeRatio: number | number[] = 0.05\n) {\n  const edgesRatio = Array.isArray(edgeRatio) ? edgeRatio :[edgeRatio,edgeRatio,edgeRatio,edgeRatio];\n  const mapExtent = map.viewController.getExtent();\n  const scale = [-1, -1, -1, -1].map((x,i) => x * edgesRatio[i]);\n  const viewExtent = scaleExtent(mapExtent, scale as [\n    number,\n    number,\n    number,\n    number\n  ]);\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = map.viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    map.viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    map.viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(map, featuresExtent) ||\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\n    ) {\n      map.viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olextent from 'ol/extent';\n\nimport { Document } from 'flexsearch';\n\nimport {\n  getEntityId,\n  EntityKey,\n  EntityStore\n} from '@igo2/common';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap, MapExtent } from '../../map';\n\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures, computeOlFeaturesExtent } from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\n  }\n\n  /**\n   * The searchable index of loaded feature. Computed if strategy is provided\n   */\n  set searchDocument(v: Document<T>) {\n    this._searchDocument = v;\n  }\n\n  get searchDocument(): Document<T> {\n    return this._searchDocument;\n  }\n  private _searchDocument: Document<T>;\n\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\n    }\n  }\n\n  setLayerExtent(): void {\n    let features = this.entities$.getValue();\n    let extent = olextent.createEmpty() as MapExtent;\n    let olFeatures = [];\n\n    features.forEach((feature) => {\n      olFeatures.push(featureToOl(feature, this.map.projection));\n    });\n    const featuresExtent = computeOlFeaturesExtent(this.map, olFeatures);\n    olextent.extend(extent, featuresExtent);\n    this.layer.setExtent(extent);\n  }\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n\n}\n","import * as olextent from 'ol/extent';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(store.layer.map.viewController.state$.subscribe(() => {\n      this.updateEntitiesInExtent(store);\n    }));\n  }\n\n  private updateEntitiesInExtent(store) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      let entitiesInMapExtent = [];\n      let entitiesWithNoGeom = [];\n      for (const entity of store.entities$.value) {\n        if (entity.ol) {\n          if (olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent)) {\n            entitiesInMapExtent.push(entity);\n          }\n        } else {\n          entitiesWithNoGeom.push(entity);\n        }\n      }\n      if (entitiesInMapExtent.length > 0) {\n        store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, false);\n      }\n      if (entitiesWithNoGeom.length > 0) {\n        store.state.updateMany(entitiesWithNoGeom, { inMapExtent: true }, false);\n      }\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\n\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .subscribe(() => this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution()));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution());\n    this.resolution$$.push(store.layer.map.viewController.resolution$.subscribe((res) => {\n      this.updateEntitiesInResolution(store, res);\n    }));\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (mapResolution > store.layer.minResolution && mapResolution < store.layer.maxResolution) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\nimport { CapabilitiesService } from '../../../datasource/shared/capabilities.service';\nimport { FeatureStore } from '../store';\nimport { Feature, FeatureStorePropertyTypeStrategyOptions } from '../feature.interfaces';\nimport { Subscription, debounceTime, pairwise } from 'rxjs';\nimport { PropertyTypeDetectorService } from '../../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { ObjectUtils } from '@igo2/utils';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { IgoMap } from '../../../map/shared/map';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { GeoServiceDefinition } from '../../../utils';\n\n/**\n * This strategy maintain the store features updated to detect geoproperties\n * (wms/arcgis... layer and url).\n * The features's state inside the map are tagged haveGeoServiceProperties = true;\n */\nexport class GeoPropertiesStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  /**\n   * The map the layer is bound to\n   */\n  private readonly map: IgoMap;\n\n  constructor(\n    protected options: FeatureStorePropertyTypeStrategyOptions,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService) {\n    super(options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesPropertiesState(store);\n    this.states$$.push(\n      this.map.layers$.pipe(\n        debounceTime(750),\n        pairwise())\n        .subscribe(([prevLayers, currentLayers]) => {\n          let prevLayersId;\n          if (prevLayers) {\n            prevLayersId = prevLayers.map(l => l.id);\n          }\n          const layers = currentLayers.filter(l => !prevLayersId.includes(l.id));\n          this.updateEntitiesPropertiesState(store, layers);\n        }));\n    this.states$$.push(\n      store.entities$\n        .pipe(debounceTime(750))\n        .subscribe((a) => {\n          this.updateEntitiesPropertiesState(store);\n        }));\n\n  }\n\n  private updateEntitiesPropertiesState(store: FeatureStore, layers?: Layer[]) {\n    const layersId = this.map.layers.map(l => l.id);\n    let entities: Feature[] = [];\n    if (layers) {\n      entities = store.entities$.value;\n    } else {\n      const allSV = store.stateView.all();\n      entities = allSV.length ? store.stateView.all().filter(s => !s.state.geoService).map(e => e.entity) : store.entities$.value;\n    }\n    const sampling = entities.length >= 250 ? 250 : entities.length;\n    const firstN = entities.slice(0, sampling);\n    let allKeys = [];\n    firstN.map(e => {\n      allKeys = allKeys.concat(Object.keys(e.properties || {}));\n    });\n    allKeys = [...new Set(allKeys)];\n    const distinctValues = {};\n    allKeys.map(k => {\n      distinctValues[k] = [...new Set(entities.map(item => item.properties[k]))];\n    });\n    const containGeoServices = {};\n    Object.entries(distinctValues).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      const valuedAreGeoservices = values.filter(value => this.propertyTypeDetectorService.isGeoService(value));\n      if (valuedAreGeoservices?.length) {\n        containGeoServices[key] = valuedAreGeoservices;\n      }\n    });\n    interface GeoServiceAssociation { url: string, layerNameProperty: string, urlProperty: string, geoService: GeoServiceDefinition }\n    const geoServiceAssociations: GeoServiceAssociation[] = [];\n    Object.entries(containGeoServices).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      values.map(value => {\n        const geoService = this.propertyTypeDetectorService.getGeoService(value, allKeys);\n        const propertiesForLayerName = allKeys.filter(p => geoService.propertiesForLayerName.includes(p));\n        // providing the the first matching regex;\n        const propertyForLayerName = propertiesForLayerName.length ? propertiesForLayerName[0] : undefined;\n        if (propertyForLayerName) {\n          geoServiceAssociations.push({ url: value, urlProperty: key, layerNameProperty: propertyForLayerName, geoService });\n\n        }\n      });\n    });\n    const geoServiceStates: { geoServiceAssociation: GeoServiceAssociation, state: any }[] = [];\n    geoServiceAssociations.map(geoServiceAssociation => {\n      const url = geoServiceAssociation.url;\n      const type = geoServiceAssociation.geoService.type || 'wms';\n      distinctValues[geoServiceAssociation.layerNameProperty].map(layerName => {\n        let appliedLayerName = layerName;\n        let arcgisLayerName = undefined;\n        if (['arcgisrest', 'imagearcgisrest', 'tilearcgisrest'].includes(type)) {\n          appliedLayerName = undefined;\n          arcgisLayerName = layerName;\n        }\n        const so = ObjectUtils.removeUndefined({\n          sourceOptions: {\n            type: type || 'wms',\n            url,\n            optionsFromCapabilities: true,\n            optionsFromApi: true,\n            params: {\n              LAYERS: appliedLayerName,\n              LAYER: arcgisLayerName\n            }\n          }\n        });\n        const potentialLayerId = generateIdFromSourceOptions(so.sourceOptions);\n        geoServiceStates.push({\n          geoServiceAssociation,\n          state:\n          {\n            added: layersId.find(l => l === potentialLayerId) !== undefined,\n            haveGeoServiceProperties: true,\n            type,\n            url,\n            layerName\n          }\n        });\n      });\n    });\n    geoServiceStates.map(geoServiceState => {\n      const urlProperty = geoServiceState.geoServiceAssociation.urlProperty;\n      const layerNameProperty = geoServiceState.geoServiceAssociation.layerNameProperty;\n\n      const urlValue = geoServiceState.state.url;\n      const layerNameValue = geoServiceState.state.layerName;\n      const entitiesToProcess = entities.filter(e =>\n        e.properties[urlProperty] === urlValue &&\n        e.properties[layerNameProperty] === layerNameValue\n      );\n      const ns = {\n        geoService: geoServiceState.state\n      };\n      store.state.updateMany(entitiesToProcess, ns, true);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { Subscription } from 'rxjs';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureMotion } from '../feature.enums';\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view.all$()\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\n      entries[1].unsubscribe();\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) { return this.motion; }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import OlEvent from 'ol/events/Event';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\nimport { EventsKey } from 'ol/events';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime, skip } from 'rxjs/operators';\n\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../../datasource';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\n\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\nimport { FeatureMotion } from '../feature.enums';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: olLayer => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer?.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature<OlGeometry>) =>\n      olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","import { Document, DocumentOptions } from 'flexsearch';\nimport { EntityStoreStrategy } from '@igo2/common';\nimport { FeatureStore } from '../store';\nimport { FeatureStoreSearchIndexStrategyOptions } from '../feature.interfaces';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n *\n * This strategy loads a layer's features's properties into a searchable index.\n */\nexport class FeatureStoreSearchIndexStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreSearchIndexStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  private initStoreSearchIndex(store) {\n    store.searchDocument = new Document({ tokenize: \"full\" });\n  }\n\n  /**\n   * Watch for a store's entities changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n    this.initStoreSearchIndex(store);\n\n    store.entities$\n      .pipe(skipWhile((e) => !e.length))\n      .subscribe(() => this.onEntitiesChanges(store));\n  }\n\n  /**\n   * Stop watching for a store's entities changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      store.searchDocument = undefined;\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Maintain searcahble index for every loaded entities\n   * @param store Feature store\n   */\n  private onEntitiesChanges(store: FeatureStore) {\n    const ratio = this.options.percentDistinctValueRatio || 2;\n    const featuresProperties = [];\n    store.index.forEach((value, key) => {\n      const fp = value.properties;\n      fp.igoSearchID = key;\n      featuresProperties.push(fp);\n    });\n    const toIndex = [];\n    let columnsToNotIndex = [];\n    let contentToIndex = [];\n    if (this.options.sourceFields) {\n      columnsToNotIndex = this.options.sourceFields.filter(sf => !sf.searchIndex?.enabled);\n      contentToIndex = this.options.sourceFields.filter(sf => sf.searchIndex?.enabled).map(sf2 => {\n        return Object.assign({}, {field: sf2.name, tokenize: \"full\"}, sf2.searchIndex);\n      });\n    } else {\n      if (featuresProperties.length) {\n        // THIS METHOD COMPUTE COLUMN DISTINCT VALUE TO FILTER WHICH COLUMN TO INDEX BASED ON A RATIO or discard float columns\n        const columns = Object.keys(featuresProperties[0]);\n        const columnsToIndex = [];\n        columnsToNotIndex = columns.map((column) => {\n          const distinctValues = [...new Set(featuresProperties.map(item => item[column]))];\n          // identify column to not index based on a ratio distinctValues/nb of features OR discart exclusive float column (ex: lat, long)\n          if (\n            (distinctValues.length / featuresProperties.length) * 100 <= ratio ||\n            distinctValues.every(n => Number(n) === n && n % 1 !== 0)) {\n            columnsToNotIndex.push(column);\n          } else {\n            columnsToIndex.push(column);\n          }\n        }).filter(f => f);\n        const keysToIndex = columnsToIndex.filter(f => f !== 'igoSearchID');\n        contentToIndex = keysToIndex.map(key => { return { field: key, tokenize: \"full\" }; });\n      }\n    }\n    store.index.forEach((value, key) => {\n      const propertiesToIndex = JSON.parse(JSON.stringify(value.properties));\n      columnsToNotIndex.map(c => delete propertiesToIndex[c]);\n      if (Object.keys(propertiesToIndex).length) {\n        toIndex.push(propertiesToIndex);\n      }\n    });\n\n    if (toIndex.length === 0) {\n      this.initStoreSearchIndex(store);\n    } else {\n\n\n      store.searchDocument = new Document({\n        document: {\n          id: 'igoSearchID',\n          index: contentToIndex\n        } as DocumentOptions<any>\n      });\n      toIndex.map(i => {\n        store.searchDocument.add(i.igoSearchID, i);\n      });\n    }\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (newColor.length === 4 && (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\n\nimport { createOverlayMarkerStyle } from '../shared/overlay/overlay-marker-style.utils';\nimport RenderFeature from 'ol/render/Feature';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { StyleByAttribute } from '../shared/vector/vector-style.interface';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olStyle.Style;\n\n  /**\n   * Create a style based on a object as\n   * style: {\n   *       \"stroke\": {\n   *         \"color\": \"blue\",\n   *         \"lineDash\": [10, 5]\n   *       },\n   *       \"text\": {\n   *         \"minScaleDenom\": 50000,\n   *         \"maxScaleDenom\": 200000,\n   *         \"minResolution\": 100,\n   *         \"maxResolution\": 400,\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\n   *         \"text\": \"MY HARCODED TEXT\",\n   *         \"stroke\": {\n   *           \"color\": \"blue\",\n   *           \"width\": 0.75\n   *         },\n   *         \"fill\": {\n   *           \"color\": \"black\"\n   *         },\n   *         \"font\": \"20px sans-serif\",\n   *         \"overflow\": true,\n   *         \"offsetX\": 10,\n   *         \"offsetY\": 20,\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\n   *       },\n   *       \"width\": 5\n   *     }\n   *\n   * @param options\n   * @param feature feature to apply style on\n   * @param resolution current map resolution, to control label resolution range\n   * @returns\n   */\n  createStyle(options: { [key: string]: any }, feature?: RenderFeature | OlFeature<OlGeometry>, resolution?: number) {\n\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olStyle.Style) {\n      return options;\n    }\n    const parsedStyle = this.parseStyle('style', options);\n    if (parsedStyle.getText()) {\n      let labelMinResolution = 0;\n      let labelMaxResolution = Infinity;\n      if (options.text) {\n        const labelMinResolutionFromScale =\n          options.text?.minScaleDenom ? getResolutionFromScale(Number(options.text.minScaleDenom)) : undefined;\n        const labelMaxResolutionFromScale =\n          options.text?.maxScaleDenom ? getResolutionFromScale(Number(options.text.maxScaleDenom)) : undefined;\n        const minResolution = options.text?.minResolution ? options.text.minResolution : 0;\n        const maxResolution = options.text?.maxResolution ? options.text.maxResolution : Infinity;\n\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n      }\n      if (feature && resolution >= labelMinResolution && resolution <= labelMaxResolution) {\n        if (feature && options.text.attribute) {\n          parsedStyle.getText().setText(this.getLabel(feature, options.text.attribute));\n        }\n      } else {\n        parsedStyle.setText();\n      }\n    }\n    return parsedStyle;\n  }\n\n  public parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach(_key => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olStyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olStyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olStyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olStyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(feature: RenderFeature | OlFeature<OlGeometry>, styleByAttribute: StyleByAttribute, resolution: number) {\n\n    let style;\n    const type = styleByAttribute.type ? styleByAttribute.type : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label ? styleByAttribute.label.attribute : undefined;\n    const labelMinResolutionFromScale =\n      styleByAttribute.label?.minScaleDenom ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom)) : undefined;\n    const labelMaxResolutionFromScale =\n      styleByAttribute.label?.maxScaleDenom ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom)) : undefined;\n    const minResolution = styleByAttribute.label?.minResolution ? styleByAttribute.label.minResolution : 0;\n    const maxResolution = styleByAttribute.label?.maxResolution ? styleByAttribute.label.maxResolution : Infinity;\n\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n\n    let labelStyle = styleByAttribute.label?.style ? this.parseStyle('text', styleByAttribute.label.style) : undefined;\n    if (!labelStyle && label) {\n        labelStyle = new olStyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      if (resolution >= labelMinResolution && resolution <= labelMaxResolution) {\n        labelStyle.setText(this.getLabel(feature, label));\n      } else {\n        labelStyle.setText('');\n      }\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          if (icon) {\n            style = [\n              new olStyle.Style({\n                image: new olStyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              image: new olStyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olStyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olStyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle, feature, resolution);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: 4,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n        typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olStyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle, feature, resolution);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(feature: RenderFeature | OlFeature<OlGeometry>, resolution: number, clusterParam: ClusterParam = {}, layerStyle) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olStyle.Circle;\n\n            if (r.showRange) {\n              const text = new olStyle.Text({\n                text: size.toString(),\n                fill: new olStyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: clusterRadius,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olStyle.Text({\n              text: size.toString(),\n              fill: new olStyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle, feature, resolution);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { StyleService } from '../../../style/style-service/style.service';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\n\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nexport function createOverlayLayerStyle(): (olFeature: OlFeature<OlGeometry>, resolution: number) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle, olFeature, resolution);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9],\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\n\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay {\n  /**\n   * The map to add the layer to\n   */\n  private map: IgoMap;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: IgoMap) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: IgoMap) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { createOverlayLayerStyle } from '../../style/shared/overlay/overlay-style.utils';\n\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n","import { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Watcher, SubjectStatus } from '@igo2/utils';\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\nimport { ObjectEvent } from 'ol/Object';\n\nexport class LayerWatcher extends Watcher {\n  public propertyChange$: BehaviorSubject<{event:ObjectEvent, layer: Layer}> = new BehaviorSubject(undefined);\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\n  }\n\n  setPropertyChange(change: ObjectEvent, layer: Layer) {\n\n    if (![\n      LinkedProperties.TIMEFILTER,\n      LinkedProperties.OGCFILTERS,\n      LinkedProperties.VISIBLE,\n      LinkedProperties.OPACITY,\n      LinkedProperties.MINRESOLUTION,\n      LinkedProperties.MAXRESOLUTION]\n      .includes(change.key as any)) {\n      return;\n  }\n  this.propertyChange$.next({event: change, layer});\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n    layer.ol.on('propertychange', evt => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.on('propertychange', evt => this.setPropertyChange(evt, layer));\n\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe(status => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.ol.un('propertychange', evt => this.setPropertyChange(evt,layer));\n    layer.dataSource.ol.un('propertychange', evt => this.setPropertyChange(evt, layer));\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * Base map controller\n */\nexport class MapController {\n\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport * as oleasing from 'ol/easing';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport OlView from 'ol/View';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\nimport { EventsKey } from 'ol/events';\nimport { ObjectEvent } from 'ol/Object';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current rotation in radians\n   */\n   readonly rotation$ = new BehaviorSubject<number>(0);\n\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   * Values in the array are top, right, bottom and left padding.\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  setPadding(padding: { top?: number, bottom?: number, left?: number, right?: number }) {\n    // Values in the array are top, right, bottom and left padding.\n    if (padding.top || padding.top === 0) {\n      this.padding[0] = padding.top;\n    }\n    if (padding.right || padding.right === 0) {\n      this.padding[1] = padding.right;\n    }\n    if (padding.bottom || padding.bottom === 0) {\n      this.padding[2] = padding.bottom;\n    }\n    if (padding.left || padding.left === 0) {\n      this.padding[3] = padding.left;\n    }\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event)) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  monitorRotation() {\n    this.observerKeys.push(\n      this.olMap.getView().on('change:rotation', (evt: ObjectEvent) => {\n        this.rotation$.next(evt.target.getRotation());\n      }) as EventsKey\n      );\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [number, number];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in radians\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import OlMap from 'ol/Map';\nimport olGeolocation from 'ol/Geolocation';\nimport { BehaviorSubject, interval, Subscription } from 'rxjs';\nimport Geometry from 'ol/geom/Geometry';\nimport * as olproj from 'ol/proj';\nimport olFeature from 'ol/Feature';\nimport { MapController } from './controller';\nimport { Point, Polygon } from 'ol/geom';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport * as olSphere from 'ol/sphere';\nimport OlCircle from 'ol/geom/Circle';\nimport { IgoMap } from '../map';\nimport * as olstyle from 'ol/style';\nimport { Overlay } from '../../../overlay/shared/overlay';\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { MapViewOptions } from '../map.interface';\nimport { switchMap } from 'rxjs/operators';\nimport { computeOlFeaturesExtent, featuresAreOutOfView, hideOlFeature, moveToOlFeatures } from '../../../feature/shared/feature.utils';\nexport interface MapGeolocationControllerOptions {\n  //  todo keepPositionHistory?: boolean;\n  projection: olproj.ProjectionLike\n  accuracyThreshold?: number;\n  followPosition?: boolean;\n  buffer?: GeolocationBuffer;\n}\nexport interface MapGeolocationState {\n  position: number[];\n  projection: string;\n  accuracy: number;\n  altitude: number;\n  altitudeAccuracy: number;\n  heading: number;\n  speed: number;\n  enableHighAccuracy: boolean;\n  timestamp: Date;\n}\nexport interface GeolocationBuffer {\n  bufferRadius?: number;\n  bufferStroke?: [number, number, number, number];\n  bufferFill?: [number, number, number, number];\n  showBufferRadius?: boolean;\n}\n\n\nenum GeolocationOverlayType {\n  Position = 'position',\n  PositionDirection = 'positionDirection',\n  Accuracy = 'accuracy',\n  Buffer = 'buffer'\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapGeolocationController extends MapController {\n\n  private arrowRotation: number;\n  private subscriptions$$: Subscription[] = [];\n  private geolocationOverlay: Overlay;\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] = new olstyle.Style({\n    image: new olstyle.Circle({\n      radius: 6,\n      fill: new olstyle.Fill({\n        color: '#3399CC',\n      }),\n      stroke: new olstyle.Stroke({\n        color: '#fff',\n        width: 2,\n      }),\n    }),\n  });\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] = new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: 'rgba(120, 120, 120, 0.4)',\n      width: 1,\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(120, 120, 120, 0.4)',\n    }),\n  });\n\n  private get bufferStyle(): olstyle.Style {\n    return new olstyle.Style({\n      stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\n      fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\n      text: new olstyle.Text({\n        textAlign: 'left',\n        offsetX: 10,\n        offsetY: -10,\n        font: '12px Calibri,sans-serif',\n        text: this.buffer.showBufferRadius ? `${this.buffer.bufferRadius}m` : '',\n        fill: new olstyle.Fill({ color: '#000' }),\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\n      })\n    });\n  }\n\n  private get arrowStyle(): olstyle.Style {\n    return new olstyle.Style({\n      image: new olstyle.RegularShape({\n        radius: 5.5,\n        fill: new olstyle.Fill({\n          color: 'rgba(0, 132, 202)'\n        }),\n        stroke: new olstyle.Stroke({\n          color: '#fff',\n          width: 1.5,\n        }),\n        points: 3,\n        displacement: [0, 9],\n        rotation: this.arrowRotation,\n        rotateWithView: true\n      })\n    });\n  }\n\n  private geolocation: olGeolocation;\n\n  /**\n   * Observable of the current emission interval of the position. In seconds\n   */\n  public readonly emissionIntervalSeconds$: BehaviorSubject<number> = new BehaviorSubject(5);\n\n  /**\n   * Observable of the current position\n   */\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(undefined);\n  /**\n   * Observable of the tracking state\n   */\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\n  /**\n   * Observable of the follow position state\n   */\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\n\n  private lastPosition: {coordinates: number[], dateTime: Date};\n\n  /**\n   * History of positions\n   */\n  // private positions: MapGeolocationState[] = [];\n\n  /**\n   * Whether the geolocate controller should keep the position history\n   */\n  /*\n  // todo: refine this method\n  set keepPositionHistory(value) {\n    this._keepPositionHistory = value;\n  }\n  get keepPositionHistory(): boolean {\n    return this._keepPositionHistory;\n  }\n  private _keepPositionHistory: boolean = this.options && this.options.keepPositionHistory ? this.options.keepPositionHistory : true;\n*/\n  /**\n   * Whether the geolocate should show a buffer around the current position\n   */\n  set buffer(value: GeolocationBuffer) {\n    this._buffer = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n  get buffer(): GeolocationBuffer {\n    return this._buffer;\n  }\n  private _buffer: GeolocationBuffer = this.options && this.options.buffer ? this.options.buffer : undefined;\n\n  /**\n   * Whether the geolocate controller accuracy threshold to store/show the position.\n   */\n  set accuracyThreshold(value: number) {\n    this._accuracyThreshold = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n\n  get accuracyThreshold(): number {\n    return this._accuracyThreshold;\n  }\n  private _accuracyThreshold = this.options && this.options.accuracyThreshold ? this.options.accuracyThreshold : 5000;\n\n\n  get olGeolocation() {\n    return this.geolocation;\n  }\n\n  /**\n   * Whether the activate the geolocation.\n   */\n  get tracking() {\n    return this.geolocation.getTracking();\n  }\n\n  set tracking(value: boolean) {\n    this.geolocation.setTracking(value || false);\n    this.tracking$.next(value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.tracking', value);\n    }\n    if (!value) {\n      this.position$.next(undefined);\n    }\n  }\n\n  /**\n   * Whether the activate the view tracking of the current position\n   */\n  set followPosition(value: boolean) {\n    this._followPosition = value;\n    this.followPosition$.next(value);\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\n      this._followPosition = false;\n      this.followPosition$.next(false);\n    }\n    this.handleFeatureCreation(this.position$.value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.followPosition', value);\n    }\n  }\n\n  get followPosition() {\n    return this._followPosition;\n  }\n\n\n  private _followPosition = this.options && this.options.followPosition ? this.options.followPosition : false;\n\n\n  constructor(\n    private map: IgoMap,\n    private options?: MapGeolocationControllerOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService) {\n    super();\n    this.geolocationOverlay = new Overlay(this.map);\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  private deleteGeolocationFeatures() {\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\n    this.deleteFeatureByType(GeolocationOverlayType.PositionDirection);\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\n  }\n\n  setupObservers() {\n    this.tracking$.subscribe(tracking => {\n      if (tracking) {\n        this.onPositionChange(true, true);\n      } else {\n        this.deleteGeolocationFeatures();\n      }\n    });\n\n    this.geolocation = new olGeolocation({\n      // enableHighAccuracy must be set to true to have the heading value.\n      trackingOptions: {\n        enableHighAccuracy: true,\n        maximumAge: 10000,\n        timeout: 600000\n      },\n      projection: this.options.projection,\n    });\n    let tracking = false;\n    this.subscriptions$$.push(this.emissionIntervalSeconds$\n      .pipe(switchMap(value => interval(value * 1000)))\n      .subscribe(() => {\n        if (tracking === this.tracking) {\n          this.onPositionChange(true);\n        } else {\n          tracking = this.tracking;\n          this.onPositionChange(true, true);\n        }\n      }));\n\n    this.geolocation.on('change', (evt) => {\n      this.onPositionChange(false, false);\n    });\n  }\n\n  updateArrowFeatureOrientation(position: MapGeolocationState) {\n    const position4326 = olproj.transform(position.position, position.projection, 'EPSG:4326');\n    if(!this.lastPosition) {\n      this.lastPosition = {coordinates: position4326, dateTime: new Date()};\n      return;\n    }\n    const arrowFeature = this.getFeatureByType(GeolocationOverlayType.PositionDirection);\n    const isMoving = position?.speed > 1.25 && this.distanceBetweenPoints(this.lastPosition.coordinates, position4326) > 0.003;\n    if(position.accuracy <= this.accuracyThreshold && isMoving) {\n      // Calculate the heading using current position and last recorded\n      // because ol heading not returning right value\n      var dx = position4326[1] - this.lastPosition.coordinates[1];\n      var dy = position4326[0] - this.lastPosition.coordinates[0];\n      var theta = Math.atan2(dy, dx);\n      if (theta < 0) theta = (2*Math.PI) + theta;\n      this.arrowRotation = theta;\n      if(arrowFeature) {\n        arrowFeature.setStyle(this.arrowStyle);\n      }\n      this.lastPosition = {coordinates: position4326, dateTime: new Date()};\n    }\n    else {\n      if(arrowFeature && ((new Date()).getTime() - this.lastPosition.dateTime.getTime()) > 3000)\n        hideOlFeature(arrowFeature);\n    }\n  }\n\n  /**\n   * @returns distance in km between coord1 and coord2\n   */\n  private distanceBetweenPoints(coord1: number[], coord2: number[]): number{\n    return olSphere.getDistance(coord1, coord2) / 1000;\n  }\n\n  public addOnChangedListener(event: (geo: olGeolocation) => any) {\n    let listener = () => {\n      event(this.geolocation);\n    };\n    this.geolocation.on(\"change\", listener);\n    return listener;\n  }\n\n  public deleteChangedListener(event: () => any) {\n    this.geolocation.un(\"change\", event);\n  }\n\n  public updateGeolocationOptions(options: MapViewOptions) {\n    if (!options) { return; }\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\n    let tracking = options.geolocate;\n    let followPosition = options.alwaysTracking;\n    if (this.storageService) {\n      const storedTracking = this.storageService.get('geolocation.tracking') as boolean;\n      if (storedTracking !== null && storedTracking !== undefined) {\n        tracking = storedTracking;\n      }\n\n      const storedFollowPosition = this.storageService.get('geolocation.followPosition') as boolean;\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\n        followPosition = storedFollowPosition;\n      }\n    }\n    this.tracking = tracking;\n    this.followPosition = followPosition;\n    this.buffer = options.buffer;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    if (this.subscriptions$$.length) {\n      this.subscriptions$$.map(s => s.unsubscribe());\n    }\n    super.teardownObservers();\n  }\n\n  /**\n   * Clear the position  history\n   */\n  /*\n  // todo\n  clearPositionsHistory() {\n    this.positions = [];\n  }*/\n\n  /**\n   * On position change, get the position, show it on the map and record it.\n   * @param emitEvent Map event\n   */\n  private onPositionChange(emitEvent: boolean = false, zoomTo: boolean = false) {\n    if (!this.tracking) {\n      return;\n    }\n    const geolocateProperties = this.geolocation.getProperties();\n\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\n      this.position$.next(undefined);\n      return;\n    }\n\n    const position: MapGeolocationState = {\n      position: geolocateProperties.position,\n      projection: this.geolocation.getProjection().getCode(),\n      accuracy: geolocateProperties.accuracy,\n      altitude: geolocateProperties.altitude,\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\n      heading: geolocateProperties.heading,\n      speed: geolocateProperties.speed,\n      enableHighAccuracy: geolocateProperties.trackingOptions?.enableHighAccuracy ? true : false,\n      timestamp: new Date()\n    };\n    this.handleFeatureCreation(position);\n    this.handleViewFromFeatures(position, zoomTo);\n    if (emitEvent) {\n      this.position$.next(position);\n      /*if (this.keepPositionHistory === true) {\n        // handle position diff to store only true diff;\n        this.positions.push(position);\n      }*/\n    }\n  }\n\n  private getFeatureByType(type: GeolocationOverlayType): olFeature<Geometry> {\n    return this.geolocationOverlay.dataSource.ol.getFeatureById(type);\n  }\n\n  private deleteFeatureByType(type: GeolocationOverlayType) {\n    const featureById = this.geolocationOverlay.dataSource.ol.getFeatureById(type);\n    if (featureById) {\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\n    }\n  }\n\n  private handleFeatureCreation(position: MapGeolocationState) {\n    if (!position || !position.position) {\n      return;\n    }\n    const positionGeometry = new Point(position.position);\n    const accuracyGeometry = fromCircle(new OlCircle(position.position, position.accuracy || 0));\n    let positionFeature = this.getFeatureByType(GeolocationOverlayType.Position);\n    let positionFeatureArrow = this.getFeatureByType(GeolocationOverlayType.PositionDirection);\n    let accuracyFeature = this.getFeatureByType(GeolocationOverlayType.Accuracy);\n    const positionFeatureExists = positionFeature ? true : false;\n    const positionFeatureArrowExists = positionFeatureArrow ? true : false;\n    const accuracyFeatureExists = accuracyFeature ? true : false;\n    if (!positionFeatureArrowExists) {\n      positionFeatureArrow = new olFeature<Point>({ geometry: positionGeometry });\n      positionFeatureArrow.setId(GeolocationOverlayType.PositionDirection);\n      hideOlFeature(positionFeatureArrow);\n    }\n    if (!positionFeatureExists) {\n      positionFeature = new olFeature<Point>({ geometry: positionGeometry });\n      positionFeature.setId(GeolocationOverlayType.Position);\n      positionFeature.setStyle(this.positionFeatureStyle);\n    }\n    if (!accuracyFeatureExists) {\n      accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\n      accuracyFeature.setId(GeolocationOverlayType.Accuracy);\n      accuracyFeature.setStyle(this.accuracyFeatureStyle);\n    }\n\n    if (positionGeometry) {\n      positionFeatureExists ?\n        positionFeature.setGeometry(positionGeometry) : this.geolocationOverlay.addOlFeature(positionFeature, FeatureMotion.None);\n      positionFeatureArrowExists ?\n        positionFeatureArrow.setGeometry(positionGeometry) : this.geolocationOverlay.addOlFeature(positionFeatureArrow, FeatureMotion.None);\n      this.updateArrowFeatureOrientation(position);\n      accuracyFeatureExists ?\n        accuracyFeature.setGeometry(accuracyGeometry) : this.geolocationOverlay.addOlFeature(accuracyFeature, FeatureMotion.None);\n\n      if (this.buffer) {\n        let bufferFeature = this.getFeatureByType(GeolocationOverlayType.Buffer);\n        const bufferFeatureExists = bufferFeature ? true : false;\n        const bufferGeometry = new OlCircle(position.position, this.buffer.bufferRadius);\n        if (!bufferFeatureExists) {\n          bufferFeature = new olFeature(bufferGeometry);\n          bufferFeature.setId(GeolocationOverlayType.Buffer);\n          bufferFeature.setStyle(this.positionFeatureStyle);\n        }\n        bufferFeature.setStyle(this.bufferStyle);\n        bufferFeatureExists ?\n          bufferFeature.setGeometry(bufferGeometry) : this.geolocationOverlay.addOlFeature(bufferFeature, FeatureMotion.None);\n      }\n    }\n\n  }\n  handleViewFromFeatures(position: MapGeolocationState, zoomTo: boolean = false) {\n    let positionFeature = this.getFeatureByType(GeolocationOverlayType.Position);\n    let positionFeatureArrow = this.getFeatureByType(GeolocationOverlayType.PositionDirection);\n    let accuracyFeature = this.getFeatureByType(GeolocationOverlayType.Accuracy);\n    let bufferFeature = this.getFeatureByType(GeolocationOverlayType.Buffer);\n    const features = [positionFeature, positionFeatureArrow, accuracyFeature, bufferFeature].filter(f => f);\n    if (features.length > 0) {\n      const featuresExtent = computeOlFeaturesExtent(this.map, features);\n      const edgeRatios = position?.speed > 12.5 ? [0.25,0.25,0.25,0.25] : [0.15,0.1,0.1,0.1];\n      const areOutOfView = featuresAreOutOfView(this.map, featuresExtent, edgeRatios);\n      let motion = this.followPosition && areOutOfView ? FeatureMotion.Move : FeatureMotion.None;\n      if (zoomTo) {\n        motion = FeatureMotion.Zoom;\n      }\n      motion !== FeatureMotion.None ? moveToOlFeatures(this.map, features, motion) : undefined;\n    }\n  }\n}\n","import { ObjectEvent } from \"ol/Object\";\nimport { getUid } from \"ol/util\";\nimport { WMSDataSource } from \"../../datasource/shared/datasources/wms-datasource\";\nimport { OgcFilterableDataSource, OgcFilterableDataSourceOptions } from \"../../filter/shared/ogc-filter.interface\";\nimport { TimeFilterableDataSource, TimeFilterableDataSourceOptions } from \"../../filter/shared/time-filter.interface\";\nimport { Layer, LinkedProperties } from \"../../layer/shared/layers\";\nimport { IgoMap } from \"./map\";\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\n\nexport function getLinkedLayersOptions(layer: Layer) {\n    return layer.options.linkedLayers;\n}\n\nexport function getIgoLayerByLinkId(map: IgoMap, id: string) {\n    return map.layers.find(l => l.options.linkedLayers?.linkId === id);\n}\n\nexport function layerHasLinkWithProperty(layer: Layer, property: LinkedProperties): boolean {\n    let hasLinkWithProperty = false;\n    const layerLLOptions = getLinkedLayersOptions(layer);\n    if (layerLLOptions?.links) {\n        const link = layerLLOptions.links.find(l => l.properties.includes(property));\n        hasLinkWithProperty = link ? true : false;\n    }\n    return hasLinkWithProperty;\n}\n\nexport function layerHasLinkDeletion(layer: Layer): boolean {\n  let hasLinkWithSyncedDelete = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n      const link = layerLLOptions.links.find(l => l.syncedDelete);\n      hasLinkWithSyncedDelete = link ? true : false;\n  }\n  return hasLinkWithSyncedDelete;\n}\n\nexport function getRootParentByProperty(map: IgoMap, layer: Layer, property: LinkedProperties): Layer {\n    let layerToUse = layer;\n    let parentLayer = layerToUse;\n    let hasParentLayer = true;\n    while (hasParentLayer) {\n        layerToUse = parentLayer;\n        parentLayer = getDirectParentLayerByProperty(map, layerToUse, property);\n        hasParentLayer = parentLayer ? true : false;\n    }\n    if (!hasParentLayer) {\n        if (!layerHasLinkWithProperty(layerToUse,property)) {\n            layerToUse = undefined;\n        }\n    }\n    return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByProperty(map: IgoMap, layer: Layer, property: LinkedProperties): Layer {\n    if (layer?.options.linkedLayers?.linkId) {\n        const currentLinkId = layer.options.linkedLayers.linkId;\n        let parents = map.layers.filter(pl => {\n            const linkedLayers = pl.options.linkedLayers;\n            if (linkedLayers && linkedLayers.links) {\n                const a = linkedLayers.links.find(l => l.linkedIds.includes(currentLinkId) && l.properties.includes(property));\n                return a;\n            }\n        });\n        if (parents.length > 1) {\n            console.warn(`Your layer ${layer.title || layer.id} must only have 1 parent (${parents.map(p => p.title || p.id)})\n            , The first parent (${parents[0].title || parents[0].id}) will be use to sync properties`);\n        }\n        return parents[0];\n    }\n}\n\nexport function getDirectChildLayersByProperty(map: IgoMap, layer: Layer, property: LinkedProperties): Layer[] {\n    let linkedIds = [];\n    if (layer?.options.linkedLayers?.links) {\n        layer.options.linkedLayers.links\n        .filter(l => l.properties.includes(property))\n        .map(link => {\n            linkedIds = linkedIds.concat(link.linkedIds);});\n    }\n    return linkedIds.map(lid => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByProperty(map: IgoMap, layer: Layer, knownChildLayers: Layer[], property: LinkedProperties): Layer[] {\n    let childLayers = getDirectChildLayersByProperty(map, layer,property);\n    childLayers.map(cl => {\n        knownChildLayers.push(cl);\n        const directChildLayers = getDirectChildLayersByProperty(map, cl, property);\n        if (directChildLayers) {\n            getAllChildLayersByProperty(map, cl, knownChildLayers, property);\n        }\n\n    });\n    return knownChildLayers;\n}\n\nexport function getRootParentByDeletion(map: IgoMap, layer: Layer): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n      layerToUse = parentLayer;\n      parentLayer = getDirectParentLayerByDeletion(map, layerToUse);\n      hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkDeletion(layerToUse)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByDeletion(map: IgoMap, layer: Layer): Layer {\n  if (layer.options.linkedLayers?.linkId) {\n      const currentLinkId = layer.options.linkedLayers.linkId;\n      let parents = map.layers.filter(pl => {\n          const linkedLayers = pl.options.linkedLayers;\n          if (linkedLayers && linkedLayers.links) {\n              const a = linkedLayers.links.find(l => (l.linkedIds.includes(currentLinkId) && l.syncedDelete));\n              return a;\n          }\n      });\n      if (parents.length > 1) {\n          console.warn(`Your layer ${layer.title || layer.id} must only have 1 parent (${parents.map(p => p.title || p.id)})\n          , The first parent (${parents[0].title || parents[0].id}) will be use to sync properties`);\n      }\n      return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByDeletion(map: IgoMap, layer: Layer): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n      layer.options.linkedLayers.links\n      .filter(l => l.syncedDelete)\n      .map(link => {\n          linkedIds = linkedIds.concat(link.linkedIds);});\n  }\n  return linkedIds.map(lid => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByDeletion(map: IgoMap, layer: Layer, knownChildLayers: Layer[]): Layer[] {\n  let childLayers = getDirectChildLayersByDeletion(map, layer);\n  childLayers.map(cl => {\n      knownChildLayers.push(cl);\n      const directChildLayers = getDirectChildLayersByDeletion(map, cl);\n      if (directChildLayers) {\n        getAllChildLayersByDeletion(map, cl, knownChildLayers);\n      }\n\n  });\n  return knownChildLayers;\n}\n\nexport function initLayerSyncFromRootParentLayers(map: IgoMap, layers: Layer[]) {\n    const rootLayersByProperty = {};\n    const keys = Object.keys(LinkedProperties);\n    keys.map(k => {\n      rootLayersByProperty[LinkedProperties[k]] = [];\n    });\n    layers\n      .filter(l => getLinkedLayersOptions(l))\n      .map(l => {\n        keys.map(key => {\n          const k = LinkedProperties[key];\n          const plbp = getRootParentByProperty(map, l, k as LinkedProperties);\n          const layers = rootLayersByProperty[k];\n          const layersId = layers.map(l => l.id);\n          if (plbp && !layersId.includes(plbp.id)) {\n            rootLayersByProperty[k].push(plbp);\n          }\n        });\n      });\n    Object.keys(rootLayersByProperty).map(k => {\n      const layers = rootLayersByProperty[k];\n      layers.map((l: Layer) => l.ol.notify(k, undefined));\n    });\n  }\n\n  export function handleLayerPropertyChange(map: IgoMap, propertyChange: ObjectEvent, initiatorIgoLayer: Layer) {\n    if (!propertyChange) {\n      return;\n    }\n    const ogcFilterWriter = new OgcFilterWriter();\n    let isLayerProperty = true;\n    let isDatasourceProperty = true;\n    const key = propertyChange.key;\n    let newValue;\n    if (key === 'ogcFilters') {\n      isLayerProperty = false;\n      isDatasourceProperty = true;\n      newValue = (initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n    } else if (key === 'timeFilter') {\n      isLayerProperty = false;\n      isDatasourceProperty = true;\n      newValue = (initiatorIgoLayer.dataSource.options as TimeFilterableDataSourceOptions).timeFilter;\n    } else {\n      isLayerProperty = true;\n      isDatasourceProperty = false;\n      newValue = initiatorIgoLayer.ol.get(key);\n    }\n\n    const initiatorLinkedLayersOptions = getLinkedLayersOptions(initiatorIgoLayer);\n    if (initiatorLinkedLayersOptions) {\n      let rootParentByProperty = getRootParentByProperty(map,initiatorIgoLayer, key as LinkedProperties);\n      if (!rootParentByProperty) {\n        rootParentByProperty = initiatorIgoLayer;\n      }\n\n      const clbp = [rootParentByProperty];\n      getAllChildLayersByProperty(map, rootParentByProperty, clbp, key as LinkedProperties);\n\n      let resolutionPropertyHasChanged = false;\n      const initiatorIgoLayerSourceType = initiatorIgoLayer.options.source.options.type;\n      const initiatorIgoLayerOgcFilterableDataSourceOptions = initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions;\n      clbp.map(l => {\n        if (initiatorIgoLayer && l && getUid(initiatorIgoLayer.ol) !== getUid(l?.ol)) {\n          const lLayerType = l.options.source.options.type;\n          if (isLayerProperty) {\n          l.ol.set(key, newValue, true);\n          if (key === 'visible') {\n            l.visible$.next(newValue);\n          }\n          if (key === 'minResolution' || key === 'maxResolution') {\n            resolutionPropertyHasChanged = true;\n          }\n          } else if (isDatasourceProperty) {\n            if (key === 'ogcFilters') {\n              (l.dataSource as OgcFilterableDataSource).setOgcFilters(newValue, false);\n              if (lLayerType === 'wfs') {\n                l.ol.getSource().refresh();\n              }\n              if (lLayerType === 'wms') {\n                let appliedOgcFilter;\n                if (initiatorIgoLayerSourceType === 'wfs') {\n                  appliedOgcFilter = ogcFilterWriter.handleOgcFiltersAppliedValue(\n                    initiatorIgoLayerOgcFilterableDataSourceOptions,\n                    (initiatorIgoLayer.dataSource.options as any).fieldNameGeometry,\n                    undefined,\n                    map.viewController.getOlProjection()\n                  );\n                } else if (initiatorIgoLayerSourceType === 'wms') {\n                  appliedOgcFilter = (initiatorIgoLayer.dataSource as WMSDataSource).ol.getParams().FILTER;\n                }\n                (l.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n              }\n            } else if (l.dataSource instanceof WMSDataSource && key === 'timeFilter') {\n              (l.dataSource as TimeFilterableDataSource).setTimeFilter(newValue, false);\n              const appliedTimeFilter = (initiatorIgoLayer.ol.getSource() as olSourceImageWMS).getParams().TIME;\n              l.dataSource.ol.updateParams({ TIME: appliedTimeFilter });\n            }\n          }\n        }\n      });\n      if (resolutionPropertyHasChanged) {\n        map.viewController.resolution$.next(map.viewController.resolution$.value);\n      }\n\n\n    }\n  }\n","import olMap from 'ol/Map';\nimport olView from 'ol/View';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olinteraction from 'ol/interaction';\nimport {getUid} from 'ol/util';\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, pairwise, skipWhile, Subject } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Layer, VectorLayer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\n\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport {\n  MapViewOptions,\n  MapOptions,\n  MapAttributionOptions,\n  MapScaleLineOptions,\n  MapExtent,\n  MapControlsOptions\n} from './map.interface';\nimport { MapViewController } from './controllers/view';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { MapGeolocationController } from './controllers/geolocation';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { ObjectEvent } from 'ol/Object';\nimport {\n  getAllChildLayersByDeletion,\n  getRootParentByDeletion,\n  handleLayerPropertyChange,\n  initLayerSyncFromRootParentLayers\n} from './linkedLayers.utils';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap {\n  public ol: olMap;\n  public forcedOffline$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public layersAddedByClick$ = new BehaviorSubject<Layer[]>(undefined);\n  public status$: Subject<SubjectStatus>;\n  public propertyChange$: Subject<{event:ObjectEvent, layer: Layer}>;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public geolocationController: MapGeolocationController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private options: MapOptions;\n  private mapViewOptions: MapViewOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  get projection(): string {\n    return this.viewController.getOlProjection().getCode();\n  }\n\n  constructor(\n    options?: MapOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    this.propertyChange$ = this.layerWatcher.propertyChange$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (this.options.controls.attribution === true\n          ? {}\n          : this.options.controls.attribution) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (this.options.controls.scaleLine === true\n          ? {}\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.ol.once('rendercomplete', () => {\n      this.geolocationController = new MapGeolocationController(\n        this,\n        {\n          projection: this.viewController.getOlProjection()\n        },\n        this.storageService,\n        this.configService);\n      this.geolocationController.setOlMap(this.ol);\n      if (this.geolocationController) {\n        this.geolocationController.updateGeolocationOptions(this.mapViewOptions);\n      }\n      this.layers$\n      .pipe(pairwise())\n      .subscribe(([prevLayers, currentLayers]) => {\n        let prevLayersId;\n        if (prevLayers){\n          prevLayersId = prevLayers.map(l => l.id);\n        }\n        const layers = currentLayers.filter(l => !prevLayersId.includes(l.id));\n\n        for (const layer of layers) {\n          if (layer.options.linkedLayers) {\n            layer.ol.once('postrender', () => {\n              initLayerSyncFromRootParentLayers(this, layers);\n            });\n          }\n        }\n      });\n      this.viewController.monitorRotation();\n  });\n  this.propertyChange$.pipe(skipWhile((pc) => !pc)).subscribe(p => handleLayerPropertyChange(this, p.event, p.layer));\n  }\n\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => { }, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions = Object.assign(\n      {\n        zoom: currentView.getZoom()\n      },\n      currentView.getProperties()\n    );\n\n    this.setView(Object.assign(viewOptions, options));\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n    this.mapViewOptions = options;\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    options = Object.assign({ constrainResolution: true }, options);\n    const view = new olView(options);\n    this.ol.setView(view);\n\n    if (options) {\n      if (options.maxLayerZoomExtent) {\n        this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n      }\n\n      if (options.center) {\n        const projection = view.getProjection().getCode();\n        const center = olproj.fromLonLat(options.center, projection);\n        view.setCenter(center);\n      }\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (value.attribution === true\n        ? {}\n        : value.attribution) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (value.scaleLine === true\n        ? {}\n        : value.scaleLine) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach(control => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach(control => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n\n  // TODO: Move to ViewController and update every place it's used\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => getUid(layer.ol) && getUid(layer.ol) === olUId\n    );\n  }\n\n  getLayerByOlLayer(olLayer: olLayer<olSource>): Layer {\n    const olUId = getUid(olLayer);\n    return this.getLayerByOlUId(olUId);\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) { return; }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      if (layer instanceof VectorLayer) {\n        layer.removeLayerFromIDB();\n      }\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map(linkedLayer => {\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    let rootParentByDeletion = getRootParentByDeletion(this, srcLayer);\n    if (!rootParentByDeletion) {\n      rootParentByDeletion = srcLayer;\n    }\n    const clbd = getAllChildLayersByDeletion(this, rootParentByDeletion, [rootParentByDeletion]);\n    for (const layer of clbd) {\n      layersToRemove.push(layer);\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { ActivityService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss']\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${new Date().getTime()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe(status =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  Self,\n  OnInit\n} from '@angular/core';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\n\nimport { transform } from 'ol/proj';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]'\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","import * as olStyle from 'ol/style';\nimport * as olGeom from 'ol/geom';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { StyleService } from '../../style-service/style.service';\n\n\nexport function featureRandomStyleFunction(): (olFeature: olFeature<OlGeometry>) => olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  return (olFeature: olFeature<OlGeometry>) => {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle);\n      }\n      const style = new olStyle.Style({\n        stroke,\n        fill,\n        image: new olStyle.Circle({\n          radius: 5,\n          stroke,\n          fill\n        }),\n        text: olFeature.get('_mapTitle') ? new olStyle.Text({\n          text: olFeature.get('_mapTitle').toString(),\n          offsetX: 5,\n          offsetY: -5,\n          font: '12px Calibri,sans-serif',\n          fill: new olStyle.Fill({ color: '#000' }),\n          stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n          overflow: true\n        }): undefined\n      });\n      return style;\n  };\n}\n\nexport function featureRandomStyle(): olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n\n  const style = new olStyle.Style({\n    stroke,\n    fill,\n    image: new olStyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    })\n  });\n  return style;\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarkerStyle(feature: olFeature<olGeom.Geometry>, resolution: number): olStyle.Style[] {\n\n    const olStyleText = new olStyle.Style({\n      text: new olStyle.Text({\n        text: feature.get('hoverSummary'),\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: new olStyle.Fill({ color: '#000' }),\n        backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n        backgroundStroke: new olStyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n        stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      })\n    });\n    const olStyles = [olStyleText];\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n        olStyles.push(new olStyle.Style({\n          image: new olStyle.Circle({\n            radius: 10,\n            stroke: new olStyle.Stroke({\n              color: 'blue',\n              width: 3\n            })\n          })\n        }));\n        break;\n      default:\n        olStyles.push(new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'white',\n            width: 5\n          })\n        }));\n        olStyles.push(new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        }));\n    }\n\n    return olStyles;\n  }\n\n  /**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarkerStyle(feature: olFeature<OlGeometry>, resolution: number): olStyle.Style {\n    return new olStyle.Style({\n      image: new olStyle.Icon({\n        src: './assets/igo2/geo/icons/cross_black_18px.svg',\n        imgSize: [18, 18], // for ie\n      }),\n\n      text: new olStyle.Text({\n        text: feature.get('pointerSummary'),\n        textAlign: 'left',\n        textBaseline: 'bottom',\n        font: '12px Calibri,sans-serif',\n        fill: new olStyle.Fill({ color: '#000' }),\n        backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n        backgroundStroke: new olStyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n        stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n        overflow: true,\n        offsetX: 10,\n        offsetY: -10,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      })\n    });\n  }\n","import {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  HostListener\n} from '@angular/core'\n  ;\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olLayerVector from 'ol/layer/Vector';\n\nimport { Subscription } from 'rxjs';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport * as OlGeom from 'ol/geom';\n\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer, Layer, VectorTileLayer } from '../../layer/shared/layers';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { MediaService } from '@igo2/core';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { unByKey } from 'ol/Observable';\nimport RenderFeature from 'ol/render/Feature';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { hoverFeatureMarkerStyle } from '../../style/shared/feature/feature-style';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]'\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> = new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService,\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n    this.listenToMapClick();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], { map: this.map });\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find(l => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: \"vector\",\n      declutter: true,\n      source: new olVectorTileSource({projection: this.map.projection}),\n      style: (feature, resolution) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(feature, this.mvtStyleOptions, resolution);\n        }\n      }\n    });\n  }\n\n  createHoverStyle(feature: RenderFeature | OlFeature<OlGeometry>, hoverStyle: StyleByAttribute, resolution: number) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style =\n      {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(feature, localHoverStyle, resolution);\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.addFeatureOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging || !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (!layerOL) {\n          return;\n        }\n        const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n        if (!this.canProcessHover(igoLayer as any)) {\n          return;\n        }\n        if (igoLayer.zIndex <= maximumZindex) {\n          return;\n        }\n        maximumZindex = igoLayer.zIndex;\n        topMostOlLayer = layerOL;\n\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer instanceof olLayerVector || olLayer instanceof olLayerVectorTile\n      });\n      if (!topMostOlLayer) {\n        // To clear label\n        this.clearLayer();\n        this.pointerHoverFeatureStore.clear();\n        return;\n      }\n\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        // To avoid flashing feature\n        if (\n          mapFeature.get('hoverSummary') === undefined &&\n          mapFeature.getProperties() !== this.pointerHoverFeatureStore.all()[0]?.getProperties()\n        ) {\n          this.clearLayer();\n          let igoLayer;\n          if (layerOL instanceof olLayerVector) {\n            const myLayerVector = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorLayer;\n            if (!this.canProcessHover(myLayerVector)) {\n              return;\n            }\n            let localOlFeature = this.handleRenderFeature(mapFeature);\n            this.setLayerStyleFromOptions(myLayerVector, localOlFeature);\n            const featuresToLoad = [localOlFeature];\n            localOlFeature.set(\"_isLabel\", false);\n            const myLabelOlFeature = new OlFeature();\n            myLabelOlFeature.setProperties(localOlFeature.getProperties());\n            const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n            myLabelOlFeature.setGeometry(labelGeom);\n            myLabelOlFeature.setId(localOlFeature.getId());\n            myLabelOlFeature.set(\"_isLabel\", true);\n            this.setLayerStyleFromOptions(myLayerVector, myLabelOlFeature);\n            featuresToLoad.push(myLabelOlFeature);\n            this.pointerHoverFeatureStore.load(featuresToLoad);\n            igoLayer = myLayerVector;\n            return true;\n          }\n          if (layerOL instanceof olLayerVectorTile) {\n            const myLayerVectorTile = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorTileLayer;\n            if (!this.canProcessHover(myLayerVectorTile)) {\n              return;\n            }\n            if (myLayerVectorTile?.options?.igoStyle?.styleByAttribute?.hoverStyle) {\n              this.mvtStyleOptions = myLayerVectorTile.options.igoStyle.styleByAttribute.hoverStyle;\n            } else if (myLayerVectorTile?.options?.igoStyle?.hoverStyle) {\n              this.mvtStyleOptions = myLayerVectorTile.options.igoStyle.hoverStyle;\n            }\n            this.selectionLayer.setSource(layerOL.getSource());\n            layerOL.getFeatures(event.pixel).then((mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n              if (!mvtFeatures.length) {\n                this.selectionMVT = {};\n                this.selectionLayer.changed();\n                this.clearLayer();\n                return;\n              }\n              const feature = mvtFeatures[0];\n              if (!feature) {\n                this.clearLayer();\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(feature);\n              localOlFeature.set(\"_isLabel\", false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set(\"_isLabel\", true);\n              this.setLayerStyleFromOptions(myLayerVectorTile, myLabelOlFeature);\n              this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n              this.selectionMVT[feature.getId()] = localOlFeature;\n              this.selectionLayer.changed();\n            });\n            igoLayer = myLayerVectorTile;\n          }\n        }\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer === topMostOlLayer\n      });\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (!igoLayer.options.igoStyle?.styleByAttribute && !igoLayer.options.igoStyle?.hoverStyle) {\n      return false;\n    }\n\n    if (\n      (igoLayer.options.igoStyle?.styleByAttribute && !igoLayer.options.igoStyle?.styleByAttribute.hoverStyle) &&\n      !igoLayer.options.igoStyle?.hoverStyle) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(feature: RenderFeature | OlFeature<OlGeometry>): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    localFeature.setProperties(feature.getProperties());\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n\n    if (hoverEntity.length > 0) {\n\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(igoLayer: VectorLayer | VectorTileLayer, feature: OlFeature<OlGeometry>) {\n    const resolution = this.store.layer.map.viewController.getResolution();\n    if (igoLayer?.options?.igoStyle?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.igoStyle.styleByAttribute.hoverStyle, resolution));\n      return;\n    }\n    if (igoLayer?.options?.igoStyle?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.igoStyle.hoverStyle, resolution));\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([parseFloat(coords[idx]), parseFloat(coords[idx + 1])]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss']\n})\nexport class ZoomButtonComponent {\n\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number { return this.map.viewController.getZoom(); }\n\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\n\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: {zoom: zoom + 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\">\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: {zoom: zoom - 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\">\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"map.geolocationController.tracking ? ('igo.geo.mapButtons.geolocateInactive' | translate) :('igo.geo.mapButtons.geolocate' | translate)\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onGeolocationClick()\">\n    <mat-icon svgIcon=\"{{icon$ | async}}\"></mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss']\n})\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\n\n  private tracking$$: Subscription;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('crosshairs-gps');\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor(private configService: ConfigService) {}\n  ngAfterContentInit(): void {\n    this.map.ol.once('rendercomplete', () => {\n      this.tracking$$ =this.map.geolocationController.tracking$.subscribe(tracking => {\n        if (tracking) {\n          this.icon$.next('crosshairs-gps');\n        } else {\n          this.configService.getConfig('geolocate.basic') ? this.icon$.next('crosshairs-gps') : this.icon$.next('crosshairs');\n        }\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.tracking$$) {\n      this.tracking$$.unsubscribe();\n    }\n  }\n\n  onGeolocationClick() {\n    const tracking = this.map.geolocationController.tracking;\n    this.map.geolocationController.tracking = tracking ? false : true;\n  }\n}\n","import { ConfigService } from '@igo2/core';\r\nimport { Component, Input } from '@angular/core';\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapExtent } from '../shared/map.interface';\r\nimport * as olproj from 'ol/proj';\r\n/*\r\nButton to center the map to the home extent\r\n*/\r\n@Component({\r\n  selector: 'igo-home-extent-button',\r\n  templateUrl:'./home-extent-button.component.html',\r\n  styleUrls: ['./home-extent-button.component.scss'],\r\n})\r\nexport class HomeExtentButtonComponent {\r\n  @Input() map: IgoMap;\r\n  @Input() color: string;\r\n  @Input() extentOverride?: MapExtent;\r\n  @Input() centerOverride?: [number, number];\r\n  @Input() zoomOverride?: number;\r\n\r\n  private homeExtentButtonExtent;\r\n  private homeExtentButtonCenter;\r\n  private homeExtentButtonZoom;\r\n\r\n constructor(public configService: ConfigService) {\r\n      this.computeHomeExtent();\r\n  }\r\n\r\n  computeHomeExtent() {\r\n    this.homeExtentButtonExtent = this.extentOverride || this.configService.getConfig('homeExtentButton.homeExtButtonExtent');\r\n    this.homeExtentButtonCenter = this.centerOverride || this.configService.getConfig('homeExtentButton.homeExtButtonCenter');\r\n    this.homeExtentButtonZoom = this.zoomOverride || this.configService.getConfig('homeExtentButton.homeExtButtonZoom');\r\n\r\n    // priority over extent if these 2 properties are defined;\r\n    if (this.centerOverride && this.zoomOverride) {\r\n      this.homeExtentButtonExtent = undefined;\r\n    }\r\n  }\r\n\r\n  onToggleClick() {\r\n    this.computeHomeExtent();\r\n    if (this.homeExtentButtonExtent) {\r\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\r\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\r\n      const center = olproj.fromLonLat(this.homeExtentButtonCenter, this.map.viewController.olView.getProjection().getCode());\r\n      this.map.viewController.olView.setCenter(center);\r\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-home-extent-button-container\"><button\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\r\n            matTooltipPosition=\"left\"\r\n      [color]=\"color\"\r\n      (click)=\"onToggleClick()\"><mat-icon svgIcon = \"home-map-marker\"></mat-icon></button></div>\r\n","import { Component, Input } from '@angular/core';\nimport { StorageService } from '@igo2/core';\nimport { BehaviorSubject } from 'rxjs';\nimport NoSleep from 'nosleep.js';\nimport { userAgent } from '@igo2/utils';\n\n@Component({\n  selector: 'igo-wake-lock-button',\n  templateUrl: './wake-lock-button.component.html',\n  styleUrls: ['./wake-lock-button.component.scss']\n})\n\n/**\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n * On iOS, the Wake Lock API is not supported\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n * On not supported browser, a fake video is used to keep the screen open.\n *\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\n * and replace it by a WakeLock API implementation.\n */\nexport class WakeLockButtonComponent {\n\n  @Input() color: string = 'primary';\n  @Input()\n  get enabled(): boolean {\n    return this.storageService.get('wakeLockEnabled') as boolean;\n  }\n  set enabled(value: boolean) {\n    this.storageService.set('wakeLockEnabled', value);\n  }\n\n  private noSleep: NoSleep;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('sleep');\n  public visible = false;\n\n  constructor(private storageService: StorageService) {\n    this.noSleep = new NoSleep();\n    const nonWakeLockApiBrowser = userAgent.satisfies({\n      ie: '>0',\n      edge: '<84',\n      chrome: '<84',\n      firefox: '>0',\n      opera: '<70',\n      safari: '>0'\n    });\n    if (nonWakeLockApiBrowser) {\n      this.disableWakeLock();\n      this.enabled = false;\n      window.addEventListener('blur', () => {\n        this.disableWakeLock();\n        this.enabled = false;\n      });\n    }\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\n  }\n\n  /**\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n   * On iOS, the Wake Lock API is not supported\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n   * On not supported browser, a fake video is used to keep the screen open.\n   */\n  private enableWakeLock() {\n    this.noSleep.enable();\n    this.enabled = true;\n    this.icon$.next('sleep-off');\n  }\n  /**\n   * Let display sleep\n   */\n  private disableWakeLock() {\n    this.noSleep.disable();\n    this.enabled = false;\n    this.icon$.next('sleep');\n  }\n\n  toggleWakeLock() {\n    if (this.enabled) {\n      this.disableWakeLock();\n    } else {\n      this.enableWakeLock();\n    }\n  }\n}\n","<div class=\"igo-wake-lock-button-container\">\n    <button \n      [color]=\"color\"\n      mat-icon-button\n      [matTooltip]=\"enabled ? ('igo.geo.mapButtons.preventScreenLock' | translate): ('igo.geo.mapButtons.letScreenLock' | translate)\"\n      matTooltipPosition=\"left\"\n      (click)=\"toggleWakeLock()\">\n      <mat-icon svgIcon=\"{{icon$ | async}}\"></mat-icon>\n    </button>\n</div>","<div *ngIf=\"baseLayers.length > 0\"\n     class=\"igo-baselayers-switcher-container\"\n     [ngClass]=\"{'container-expand': expand}\"\n     [@baseLayerSwitcherState]=\"expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\"\n     (@baseLayerSwitcherState.start)=\"showButton=false\"\n     (@baseLayerSwitcherState.done)=\"showButton=true\"\n     (click)=\"collapseOrExpand()\">\n\n     <div *ngIf=\"useStaticIcon && !expand && showButton\" class=\"igo-baselayers-switcher-button-container\">\n       <button\n         mat-icon-button\n         [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n         matTooltipPosition=\"right\"\n         color=\"primary\">\n         <mat-icon svgIcon=\"image-multiple\"></mat-icon>\n       </button>\n     </div>\n\n     <igo-mini-basemap class=\"mat-typography\" *ngFor=\"let baseLayer of baseLayers; let i = index\"\n       [map]=\"map\"\n       [baseLayer]=\"baseLayer\"\n       [title]=\"(baseLayers.length > 2 && !expand) ? ('igo.geo.baselayersSwitcher.title' | translate) : baseLayer.title\"\n       [display]=\"expand || (i === 0 && !useStaticIcon)\"\n       [disabled]=\"!expand && baseLayers.length > 1\">\n     </igo-mini-basemap>\n\n    <div class=\"more-baselayers\">\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" color=\"primary\" svgIcon=\"menu-down\"></mat-icon>\n    </div>\n\n</div>\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter(l => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter(l => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '85px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","import { Injectable } from '@angular/core';\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, of, Subject } from 'rxjs';\nimport { concatMap, first, map, take } from 'rxjs/operators';\nimport { CompressionService } from '@igo2/core';\nimport { GeoDBData } from './geoDB.interface';\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoDBService {\n  readonly dbName: string = 'geoData';\n  public collisionsMap: Map<number, string[]> = new Map();\n  public _newData: number = 0;\n\n  constructor(\n    private ngxIndexedDBService: NgxIndexedDBService,\n    private compression: CompressionService\n  ) { }\n\n  /**\n   * Only blob can be compressed\n   * @param url\n   * @param regionID\n   * @param object object to handle\n   * @param insertSource type of event user or system\n   * @param insertEvent Name of the event where the insert has been triggered\n   * @returns\n   */\n  update(url: string, regionID: any, object: any, insertSource: InsertSourceInsertDBEnum, insertEvent: string): Observable<any> {\n    if (!object) {\n      return;\n    }\n    let compress = false;\n\n    const subject: Subject<GeoDBData> = new Subject();\n    let object$: Observable<any> = of(object);\n    if (object instanceof Blob) {\n      object$ = this.compression.compressBlob(object);\n      compress = true;\n    }\n    let geoDBData: GeoDBData;\n    object$.pipe(\n      first(),\n      concatMap(object => {\n        geoDBData = {\n          url,\n          regionID,\n          object: object,\n          compressed: compress,\n          insertSource,\n          insertEvent\n        };\n        return this.ngxIndexedDBService.getByID(this.dbName, url);\n      }),\n      concatMap((dbObject: GeoDBData) => {\n        if (!dbObject) {\n          this._newData++;\n          return this.ngxIndexedDBService.add(this.dbName, geoDBData);\n        } else {\n          const currentRegionID = dbObject.regionID;\n          if (currentRegionID !== regionID) {\n            const collisions = this.collisionsMap.get(currentRegionID);\n            if (collisions !== undefined) {\n              collisions.push(dbObject.url);\n              this.collisionsMap.set(currentRegionID, collisions);\n            } else {\n              this.collisionsMap.set(currentRegionID, [dbObject.url]);\n            }\n          }\n          return this.customUpdate(geoDBData);\n        }\n      })\n    ).subscribe((response) => {\n      subject.next(response);\n      subject.complete();\n    });\n    return subject;\n  }\n\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\n    const subject: Subject<GeoDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(this.dbName, geoDBData.url);\n    deleteRequest.pipe(\n      concatMap(isDeleted => isDeleted ? this.ngxIndexedDBService.add(this.dbName, geoDBData) : of(undefined))\n    )\n    .subscribe(object => {\n      if (object) {\n        subject.next(object);\n      }\n      subject.complete();\n    });\n    return subject;\n  }\n\n  get(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\n      map((data: GeoDBData) => {\n        if (data) {\n          const object = data.object;\n          if (!data.compressed) {\n            return object;\n          }\n          return this.compression.decompressBlob(object);\n        }\n      })\n    );\n  }\n\n  getByID(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url);\n  }\n\n  deleteByKey(url: string): Observable<any> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, url);\n  }\n\n  getRegionCountByID(id: number): Observable<number> {\n    const subject: Subject<number> = new Subject();\n    const dbRequest = this.getRegionByID(id)\n      .subscribe((datas) => {\n        subject.next(datas.length);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  getRegionByID(id: number): Observable<any[]> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(this.dbName, 'regionID', IDBKey);\n    return dbRequest;\n  }\n\n  deleteByRegionID(id: number): Observable<any> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(this.dbName, 'regionID', IDBKey);\n    dbRequest.subscribe((datas: GeoDBData[]) => {\n      datas.forEach((data) => {\n        this.ngxIndexedDBService.deleteByKey(this.dbName, data.url);\n      });\n    });\n    return dbRequest;\n  }\n\n  openCursor(\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\n    mode: DBMode = DBMode.readonly\n  ) {\n    const request = this.ngxIndexedDBService.openCursorByIndex(this.dbName, 'regionID', keyRange, mode);\n    return request;\n  }\n\n  resetCounters() {\n    this.resetCollisionsMap();\n    this._newData = 0;\n  }\n\n  resetCollisionsMap() {\n    this.collisionsMap = new Map();\n  }\n\n  revertCollisions() {\n    for (const [regionID, collisions] of this.collisionsMap) {\n      for (const url of collisions) {\n        this.ngxIndexedDBService.getByKey(this.dbName, url)\n          .pipe(take(1))\n          .subscribe((dbObject: GeoDBData) => {\n            const updatedObject = dbObject;\n            updatedObject.regionID = regionID;\n            this.customUpdate(dbObject);\n          });\n      }\n    }\n  }\n\n  get newData(): number {\n    return this._newData;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { ConnectionState, NetworkService } from '@igo2/core';\nimport { Observable } from 'rxjs';\nimport { GeoDBService } from '../geoDB/geoDB.service';\n\nexport enum ResponseType {\n  Arraybuffer= 'arraybuffer',\n  Blob= 'blob',\n  Text= 'text',\n  Json= 'json',\n}\nexport interface SimpleGetOptions {\n  responseType: ResponseType;\n  withCredentials?: boolean;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoNetworkService {\n  private networkOnline: boolean = true;\n  constructor(\n    private http: HttpClient,\n    public geoDBService: GeoDBService,\n    private networkService: NetworkService,\n  ) {\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkOnline = state.connection;\n    });\n  }\n\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    if (window.navigator.onLine && this.networkOnline) {\n      return this.getOnline(url, simpleGetOptions);\n    }\n    return this.getOffline(url);\n  }\n\n  private getOnline(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    let request;\n    switch (simpleGetOptions.responseType) {\n      // TODO Ajuster pour autre formats\n      case 'arraybuffer':\n        request = this.http.get(url, { responseType: 'arraybuffer', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      case 'blob':\n        request = this.http.get(url, { responseType: 'blob', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      case 'text':\n        request = this.http.get(url, { responseType: 'text', withCredentials: simpleGetOptions.withCredentials });\n          break;\n      case 'json':\n        request = this.http.get(url, { responseType: 'json', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      default:\n        request = this.http.get(url, { responseType: 'blob', withCredentials: simpleGetOptions.withCredentials });\n        break;\n    }\n    return request;\n  }\n\n  private getOffline(url: string): Observable<any> {\n    return this.geoDBService.get(url);\n  }\n\n  public isOnline() {\n    return this.networkOnline && window.navigator.onLine;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, of, Subject } from 'rxjs';\nimport { concatMap, first } from 'rxjs/operators';\nimport { LayerDBData } from './layerDB.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerDBService {\n  readonly dbName: string = 'layerData';\n\n  constructor(\n    private ngxIndexedDBService: NgxIndexedDBService\n  ) { }\n\n  /**\n   * This method allow to update the stored layer into the indexeddb (layerData)\n   * @param layerDBData\n   * @returns\n   */\n  update(layerDBData: LayerDBData): Observable<any> {\n    const subject: Subject<LayerDBData> = new Subject();\n    this.ngxIndexedDBService.getByID(this.dbName, layerDBData.layerId).pipe(\n      first(),\n      concatMap((dbObject: LayerDBData) => {\n        if (!dbObject) {\n          return this.ngxIndexedDBService.add(this.dbName, layerDBData);\n        } else {\n          return this.customUpdate(layerDBData);\n        }\n      })\n    ).subscribe((response) => {\n      subject.next(response);\n      subject.complete();\n    });\n    return subject;\n  }\n\n  private customUpdate(layerDBData: LayerDBData): Observable<LayerDBData> {\n    const subject: Subject<LayerDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(this.dbName, layerDBData.layerId);\n    deleteRequest.pipe(\n      concatMap(isDeleted => isDeleted ? this.ngxIndexedDBService.add(this.dbName, layerDBData) : of(undefined))\n    )\n    .subscribe(object => {\n      if (object) {\n        subject.next(object);\n      }\n      subject.complete();\n    });\n    return subject;\n  }\n\n\n  /**\n   * This method retrieve an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getByID(layerId: string): Observable<LayerDBData> {\n    return this.ngxIndexedDBService.getByID(this.dbName, layerId);\n  }\n\n  /**\n   * This method delete an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  deleteByKey(layerId: string): Observable<boolean> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, layerId);\n  }\n\n  /**\n   * This method retrive all idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getAll(): Observable<LayerDBData[]> {\n    return this.ngxIndexedDBService.getAll(this.dbName);\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport { map, catchError, concatMap } from 'rxjs/operators';\nimport {stylefunction} from \"ol-mapbox-style\";\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ObjectUtils } from '@igo2/utils';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\n\nimport { Style } from 'ol/style';\nimport * as olStyle from 'ol/style';\n\nimport {\n  OSMDataSource,\n  FeatureDataSource,\n  XYZDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMTSDataSource,\n  WMSDataSource,\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  ArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WebSocketDataSource,\n  MVTDataSource,\n  ClusterDataSource\n} from '../../datasource';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\n\nimport {\n  Layer,\n  ImageLayer,\n  ImageLayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  AnyLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions,\n  LayerOptions\n} from './layers';\n\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { MessageService } from '@igo2/core';\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport { LayerDBService } from '../../offline/layerDB/layerDB.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private geoNetworkService: GeoNetworkService,\n    private messageService: MessageService,\n    private layerDBService: LayerDBService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(_layerOptions: AnyLayerOptions, detailedContextUri?: string): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map(source => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(layerOptions, this.messageService, this.authInterceptor);\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(layerOptions, this.messageService, this.authInterceptor);\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style[] | Style | OlStyleLike = layerOptions.style;\n    let igoLayer: VectorLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = ['styleByAttribute', 'hoverStyle', 'mapboxStyle', 'clusterBaseStyle', 'style'];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n    if (layerOptions.igoStyle.igoStyleObject && !layerOptions.idbInfo?.storeToIdb) {\n      style = (feature, resolution) => this.styleService.createStyle(layerOptions.igoStyle.igoStyleObject, feature, resolution);\n    } else if (layerOptions.igoStyle.igoStyleObject && layerOptions.idbInfo?.storeToIdb) {\n      // temporary fix todo : handle it with geostyler.\n      style = this.styleService.parseStyle('style', layerOptions.igoStyle.igoStyleObject);\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.igoStyle?.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService);\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.igoStyle.clusterBaseStyle;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          resolution,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(layerOptionsOl,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private handleLegacyStyles(layerOptions, legacyStyleOptions: string[]) {\n    legacyStyleOptions.map(legacyOption => {\n      if (layerOptions[legacyOption]) {\n        let newKey = legacyOption;\n        if (legacyOption === 'style') {\n          if (layerOptions[legacyOption] instanceof olStyle.Style) {\n            return;\n          }\n          if (typeof layerOptions[legacyOption] === 'object') {\n            newKey = 'igoStyleObject';\n          } else {\n            return;\n          }\n        }\n        layerOptions.igoStyle[newKey] = layerOptions[legacyOption];\n        delete layerOptions[legacyOption];\n        console.warn(`\n        The location of this style option (${legacyOption}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${legacyOption}: {...} must be transfered to igoStyle: { ${newKey}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `);\n      }\n    });\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorTileLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = ['styleByAttribute', 'hoverStyle', 'mapboxStyle', 'style'];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n\n    if (layerOptions.igoStyle.igoStyleObject) {\n      style = (feature, resolution) => this.styleService.createStyle(layerOptions.igoStyle.igoStyleObject, feature, resolution);\n    }\n\n    if (layerOptions.igoStyle.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorTileLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.igoStyle?.mapboxStyle) {\n      this.getStuff(layerOptions.igoStyle.mapboxStyle.url).subscribe(res => {\n        if (res.sprite){\n          const url = this.getAbsoluteUrl(layerOptions.igoStyle.mapboxStyle.url, res.sprite);\n          this.getStuff(url+'.json').subscribe(res2 => {\n            stylefunction(layer.ol as olLayerVectorTile, res, layerOptions.igoStyle.mapboxStyle.source, undefined, res2,\n              url+'.png');\n          });\n        } else {\n          stylefunction(layer.ol as olLayerVectorTile, res, layerOptions.igoStyle.mapboxStyle.source);\n        }\n      });\n    }\n  }\n\n  private getStuff(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError(err => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n\n  private getAbsoluteUrl(source, url) {\n    const r = new RegExp('^http|\\/\\/', 'i');\n    if(r.test(url)){\n      return url;\n    } else {\n      if ( source.substr(source.length -1) === \"/\"){\n        return source + url;\n      } else{\n        return source + \"/\" + url;\n      }\n    }\n  }\n\n  createAsyncIdbLayers(contextUri: string = '*'): Observable<Layer[]> {\n    return this.layerDBService.getAll().pipe(\n      concatMap(res => {\n        const idbLayers = contextUri !== '*' ? res.filter(l => l.detailedContextUri === contextUri) : res;\n        const layersOptions: LayerOptions[] =\n          idbLayers.map(idbl => Object.assign({}, idbl.layerOptions, { sourceOptions: idbl.sourceOptions }));\n        return combineLatest(layersOptions.map(layerOptions => this.createAsyncLayer(layerOptions)));\n      })\n    );\n  }\n\n}\n","<div class=\"igo-mini-basemap-container\">\n\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf='title' class='igo-mini-basemap-title'> {{title}} </div>\n  </div>\n\n</div>\n","import {\n  Component,\n  Input,\n  AfterViewInit,\n  OnDestroy,\n  ApplicationRef,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\nimport {\n  Layer,\n  LayerOptions,\n  LayersLink,\n  LayersLinkProperties\n} from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss']\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() title: string;\n\n  @Input()\n  get display(): boolean {\n    return this._display;\n  }\n  set display(value: boolean) {\n    this._display = value;\n    this.cdRef.detectChanges();\n    this.basemap.ol.getView().changed();\n  }\n  private _display: boolean;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.on('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.un('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(mainMapViewProperties.resolution);\n    this.basemap.viewController.olView.setRotation(mainMapViewProperties.rotation);\n    this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter());\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer): void {\n    const linkedLayers: LayersLink = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const links: LayersLinkProperties[] = linkedLayers.links;\n    const isParentLayer: boolean = links ? true : false;\n    if (isParentLayer) {\n      // search for child layers\n      links.map((link: LayersLinkProperties) => {\n        link.linkedIds.map((linkedId: string) => {\n          const layerToApply: Layer = this.map.layers.find(\n            (layer: Layer) => layer.options.linkedLayers?.linkId === linkedId\n          );\n          if (layerToApply) {\n            const linkedLayerOptions: LayerOptions = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible:\n                  layerToApply.options.linkedLayers?.showInMiniBaseMap ?? true,\n                baseLayer: false\n              } as LayerOptions\n            );\n            this.basemap.addLayer(this.layerService.createLayer(linkedLayerOptions));\n          }\n        });\n      });\n    }\n  }\n}\n","<div *ngIf=\"((rotated$ | async) && !showIfNoRotation) || showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"(rotated$ | async) ? ('igo.geo.mapButtons.resetRotation' | translate: {azimuth: azimuthRounded, rotation: rotationRounded}): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"(rotated$ | async) === false\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"currentStyle$ | async\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { bearingToAzimuth } from '@turf/helpers';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss']\n})\nexport class RotationButtonComponent implements AfterContentInit {\n  readonly rotated$ = new BehaviorSubject<boolean>(false);\n  public azimuthRounded: number = 0;\n  public rotationRounded: number = 0;\n  readonly currentStyle$ = new BehaviorSubject<{}>({\n    transform: 'rotate(0rad)'\n  });\n\n  @Input() map: IgoMap;\n  @Input() showIfNoRotation: boolean;\n  @Input() color: string;\n\n  constructor() { }\n\n  ngAfterContentInit() {\n    this.map.viewController.rotation$.subscribe(r => {\n      const radians = r || 0;\n      const deg = radians * 180 / Math.PI;\n      this.rotationRounded = Math.round(deg);\n      this.azimuthRounded = Math.round(bearingToAzimuth(deg * -1));\n      this.currentStyle$.next({\n        transform: 'rotate(' + radians + 'rad)'\n      });\n      this.rotated$.next(radians !== 0);\n    }\n    );\n  }\n}\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n    <pre>{{infoContent}}</pre>\n</div>","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss']\n})\nexport class InfoSectionComponent {\n\n  @Input() infoContent: string = '';\n\n  constructor() {}\n\n}\n","export enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms, wmts, baselayers, arcgisrest, tilearcgisrest, imagearcgisrest, composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TooltipType } from '../../layer';\nimport { TimeFilterOptions } from '../../filter';\nimport { QueryFormat, QueryHtmlTarget } from '../../query';\n\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\nimport { CatalogService } from './catalog.service';\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\n\nexport abstract class Catalog implements ICatalog {\n\n    // ICatalog -----------------------------\n    id: string;\n    title: string;\n    url: string;\n    removable?: boolean;\n    externalProvider?: boolean;\n    abstract?: string;\n    forcedProperties?: any[];\n    items?: CatalogItem[];\n    type?: TypeCatalogStrings;\n    version?: string;\n    matrixSet?: string;\n    requestEncoding?: string;\n    regFilters?: string[];\n    groupImpose?: CatalogItemGroup;\n    groupSeparator?: string;\n    timeFilter?: TimeFilterOptions;\n    queryFormat?: QueryFormat;\n    queryHtmlTarget?: QueryHtmlTarget;\n    queryParams?: { [key: string]: string; };\n    sourceOptions?: { [key: string]: any; };\n    count?: number;\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n    sortDirection?: 'asc' | 'desc';\n    setCrossOriginAnonymous?: boolean;\n    showLegend?: boolean;\n    profils?: string[];\n    // ICatalog -----------------------------\n\n    protected catalogService: CatalogService;\n\n    constructor(options: Catalog, service: CatalogService) {\n        Object.assign(this, options);\n        this.catalogService = service;\n    }\n\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nclass WMSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wms];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMSLayerItems(this);\n    }\n}\n\nclass WMTSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\n    }\n}\n\nclass BaselayersCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n        return this.catalogService.loadCatalogBaseLayerItems(this);\n    }\n}\n\nclass ArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nclass TileOrImageArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService, typeCatalog: TypeCatalog) {\n        super(options, service);\n        this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n    composite: ICatalog[];\n\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.composite];\n        this.type = TypeCatalog[sType];\n        this.url = null;\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\n    }\n}\n\nexport class CatalogFactory {\n\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\n\n        let catalog: Catalog;\n        if (options.hasOwnProperty('composite')) {\n            catalog = new CompositeCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n            catalog = new BaselayersCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n            catalog = new ArcGISRestCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n            catalog = new WMTSCatalog(options, service);\n        } else {\n            catalog = new WMSCatalog(options, service);\n        }\n\n        return catalog;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport { default as striptags } from 'striptags';\n\nimport * as olformat from 'ol/format';\nimport * as olextent from 'ol/extent';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFeature from 'ol/Feature';\nimport * as olgeom from 'ol/geom';\n\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\nimport { Feature, FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  WMSDataSource,\n  CartoDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSourceOptions,\n  ImageArcGISRestDataSource\n} from '../../datasource';\n\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions,\n  QueryUrlData\n} from './query.interfaces';\nimport { MapExtent } from '../../map/shared/map.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n  public defaultFeatureCount = 20; // default feature count\n  public featureCount = 20; // feature count\n\n  private previousMessageIds = [];\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    if (this.previousMessageIds.length) {\n      this.previousMessageIds.forEach(id => {\n        this.messageService.remove(id);\n      });\n    }\n\n    const newLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n    .map((layer: Layer) => this.queryLayer(layer, options));\n    // the directive accept array in this format [observable, observable...]\n    // if we use multiple 'url' in queryUrl so the result => this form [observable, observable, [observable, observable]]\n    // so we need to flat the array\n    let flatArray = [].concat.apply([], newLayers);\n    return flatArray;\n  }\n\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> | Observable<Feature[]>[] {\n    const url = this.getQueryUrl(layer.dataSource, options, false, layer.map.viewController.getExtent());\n    if (!url) {\n      return of([]);\n    }\n\n    const resolution: number = layer.map.viewController.getResolution();\n    const scale: number = layer.map.viewController.getScale();\n\n    if ((layer.dataSource as QueryableDataSource).options.queryFormat === QueryFormat.HTMLGML2) {\n      if (typeof url === 'string') {\n        const urlGml = this.getQueryUrl(layer.dataSource, options, true) as string;\n        return this.http.get(urlGml, { responseType: 'text' }).pipe(\n          mergeMap(gmlRes => {\n            const mergedGML = this.mergeGML(gmlRes, url, layer);\n            const imposedGeom = mergedGML[0];\n            const imposedProperties = mergedGML[1];\n            return this.http\n              .get(url, { responseType: 'text' })\n              .pipe(\n                map(res =>\n                  this.extractData(res, layer, options, url, imposedGeom, imposedProperties)\n                )\n              );\n          })\n        );\n      }\n      const urlGmls = this.getQueryUrl(layer.dataSource, options, true);\n      let observables: any = [];\n      for (let i = 0; i < urlGmls.length; i++) {\n        const element = urlGmls[i] as QueryUrlData;\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          observables.push(this.requestDataForHTMLGML2(element.url, url[i].url, layer, options));\n        }\n      }\n      return observables;\n    } else {\n      if (typeof url === 'string') {\n        const request = this.http.get(url, { responseType: 'text' });\n        return request.pipe(map(res => this.extractData(res, layer, options, url)));\n      }\n      let observables: any = [];\n      for (let i = 0; i < url.length; i++) {\n        const element: QueryUrlData = url[i];\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          const request = this.http.get(element.url, { responseType: 'text' });\n          observables.push(request.pipe(map(res => this.extractData(res, layer, options, element.url))));\n        }\n      }\n      return observables;\n    }\n  }\n\n  private requestDataForHTMLGML2(urlGml: string, url: string ,layer: Layer, options: QueryOptions): Observable<Feature[]> {\n    return this.http.get(urlGml, { responseType: 'text' }).pipe(\n      mergeMap(gmlRes => {\n        const mergedGML = this.mergeGML(gmlRes, url, layer);\n        const imposedGeom = mergedGML[0];\n        const imposedProperties = mergedGML[1];\n        return this.http\n          .get(url, { responseType: 'text' })\n          .pipe(\n            map(res =>\n              this.extractData(res, layer, options, url, imposedGeom, imposedProperties)\n            )\n          );\n      })\n    );\n  }\n\n  private checkScaleAndResolution(resolution: number, scale: number, element: QueryUrlData): boolean {\n    let checkScale: boolean;\n    let checkResolution: boolean;\n\n    if (!element.minResolution && !element.maxResolution && !element.minScale && !element.maxScale) {\n      return true;\n    } else {\n      /******************* checking Resolution *******************/\n      if (element.minResolution && element.maxResolution) {\n        // if \"minResolution\" and \"maxResolution\" exists check if resoltion is between\n        if ((resolution >= element.minResolution) && (resolution <= element.maxResolution)) {\n          checkResolution = true;\n        }\n      } else {\n        // check if \"minResolution\" or \"maxResolution\" exists\n        if (element.minResolution && resolution >= element.minResolution) { checkResolution = true; }\n        if (element.maxResolution && resolution <= element.maxResolution) { checkResolution = true; }\n      }\n\n      /******************* checking Scale *******************/\n      if (element.minScale && element.maxScale) {\n        // if \"minScale\" and \"maxScale\" exists check if scale is between\n        if ((scale > element.minScale) && (scale < element.maxScale)) {\n          checkScale = true;\n        }\n      } else {\n        // check if \"minScale\" or \"maxScale\" exists\n        if (element.maxScale && scale <= element.maxScale) { checkScale = true; }\n        if (element.minScale && scale >= element.minScale) { checkScale = true; }\n      }\n\n      /******************* result of checking *******************/\n      if (checkScale === true && checkResolution === true) {\n        return true;\n      } else if ((checkResolution === true && !checkScale) || (checkScale === true && !checkResolution)) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  private mergeGML(gmlRes, url, layer: Layer): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map(feature => {\n\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent ? queryTitleContent : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = (feature.getGeometry() as any).getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n        break;\n      case 'Point':\n        returnGeometry = olmpts;\n        break;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [ returnGeometry, imposedProperties];\n\n\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n    if (features.length > 0 && (features[0].geometry === null || !features[0].geometry)) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    const wmsDatasource = layer.dataSource as WMSDataSource;\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT ?\n      new RegExp('FEATURE_COUNT=' + this.featureCount) :\n      new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\n\n    if (\n      featureCount.test(url) &&\n      ((wmsDatasource.params?.FEATURE_COUNT && this.featureCount > 1 && features.length === this.featureCount) ||\n      (!wmsDatasource.params?.FEATURE_COUNT && features.length === this.defaultFeatureCount))) {\n      const messageObj = this.messageService.info('igo.geo.query.featureCountMax', undefined, undefined, { value: layer.title });\n      this.previousMessageIds.push(messageObj.toastId);\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(feature => feature.meta = {\n      id: uuid(),\n      order: 1000 - zIndex,\n      alias: allowedFieldsAndAlias\n    });\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map(feature => this.featureToResult(feature, zIndex, allowedFieldsAndAlias));\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const body = striptags(res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, ''));\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign({ target: htmlTarget, body: res, url }, imposedProperties),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach(pair => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.SHAPE_S;\n    delete properties.SHAPE_L;\n    delete properties.SHAPE_P;\n    delete properties.the_geom;\n    delete properties.geom;\n    delete properties.geom32198;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string | QueryUrlData[]{\n    let url;\n\n    if (datasource.options.queryUrls) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\n        };\n\n        if (wmsDatasource.params.FEATURE_COUNT) {\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\n        }\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision ? tileArcGISRestDatasource.options.queryPrecision : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      key => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach(sourceField => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent): QueryUrlData[] {\n\n      const extent = olextent.getForViewAndSize(\n        options.coordinates,\n        options.resolution,\n        0,\n        [101, 101]\n      );\n\n      return datasource.options.queryUrls.map(item => {\n        let data: QueryUrlData = {\n          url: item.url.replace(/\\{bbox\\}/g, extent.join(','))\n          .replace(/\\{x\\}/g, options.coordinates[0].toString())\n          .replace(/\\{y\\}/g, options.coordinates[1].toString())\n          .replace(/\\{resolution\\}/g, options.resolution.toString())\n          .replace(/\\{srid\\}/g, options.projection.replace('EPSG:',''))\n        };\n\n        // if the queryFormat changed to \"QueryFormat.HTMLGML2\": mapExtent will be undefined\n        // we need to check \"mapExtent\" befor replace variables in the url\n        if(mapExtent) {\n          data.url.replace(/\\{xmin\\}/g, mapExtent[0].toString())\n          .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n          .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n          .replace(/\\{ymax\\}/g, mapExtent[3].toString());\n        }\n\n        if(item.maxResolution) {\n          data.maxResolution = item.maxResolution;\n        }\n\n        if(item.minResolution) {\n          data.minResolution = item.minResolution;\n        }\n\n        if(item.minScale) {\n          data.minScale = item.minScale;\n        }\n\n        if(item.maxScale) {\n          data.maxScale = item.maxScale;\n        }\n\n        return data;\n      });\n    }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined ? (dataSource.options.queryLayerFeatures === true) : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : (layerIsQueryable(layer) && layerFeatureIsQueryable(layer));\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  AfterViewInit,\n  Self\n} from '@angular/core';\n\nimport { Subscription, Observable, of, zip } from 'rxjs';\nimport { unByKey } from 'ol/Observable';\n\nimport OlFeature from 'ol/Feature';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { EventsKey } from 'ol/events';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { QueryableDataSourceOptions } from './query.interfaces';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]'\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return (this.component.map as any) as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if ((layer.dataSource.options as QueryableDataSourceOptions).queryFormatAsWms) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter(layer => layer instanceof VectorLayer && layer.visible)\n        .map(layer => {\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\n          featuresOL.forEachFeatureIntersectingExtent(dragExtent, (olFeature: any) => {\n            const newFeature: Feature = featureFromOl(olFeature, this.map.projection, layer.ol);\n            newFeature.meta = {\n              id: layer.id + '.' + olFeature.getId(),\n              icon: olFeature.values_._icon,\n              sourceTitle: layer.title,\n              alias: this.queryService.getAllowedFieldsAndAlias(layer),\n              title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n            };\n            clickedFeatures.push(newFeature);\n          });\n        });\n    }\n\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions,\n  SearchSourceSettings\n} from './source.interfaces';\nimport { FeatureStore } from '../../../feature';\nimport { Workspace } from '@igo2/common';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): { [key: string]: string } {\n    return this.options.params === undefined ? {} : this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  set featureStoresWithIndex(storesWithIndex: FeatureStore[]) {\n    this._featureStoresWithIndex = storesWithIndex;\n  }\n  get featureStoresWithIndex() {\n    return this._featureStoresWithIndex;\n  }\n  private _featureStoresWithIndex: FeatureStore[];\n\n  setWorkspaces(workspaces: Workspace[]) {\n    if (workspaces.filter(fw => (fw.entityStore as FeatureStore).searchDocument).length >= 1) {\n      this.options.available = true;\n    } else {\n      this.options.available = false;\n    }\n    const values = [];\n    this.featureStoresWithIndex = workspaces\n      .filter(fw => (fw.entityStore as FeatureStore).searchDocument)\n      .map(fw => {\n        values.push({\n          title: fw.title,\n          value: fw.title,\n          enabled: true\n        });\n        return fw.entityStore as FeatureStore;\n      });\n    const datasets = this.options.settings.find(s => s.title === 'datasets');\n    if (datasets) {\n      datasets.values = values;\n    }\n    this.setParamFromSetting(datasets);\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach(conf => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter(s => s.available !== false)\n          .forEach(conf => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(\n        this.getId() + '.options',\n        {params: this.options.params}\n      );\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(options: SearchSourceOptions, private storageService?: StorageService) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(this.getDefaultOptions(), this.options);\n\n\n    // Set Default Params from Settings\n    this.settings.forEach(setting => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-zÀ-ÿ-+]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach(hashtag => {\n      searchSourceSetting.values.forEach(conf => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n\n/**\n * Search sources that allow searching by text implement this class\n */\nexport interface TextSearch {\n  /**\n   * Search by text\n   * @param term Text\n   * @param options Optional: TextSearchOptions\n   * @returns Observable or search results\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult[]>;\n}\n\n/**\n * Search sources that allow searching by coordinates implement this class\n */\nexport interface ReverseSearch {\n  /**\n   * Search by text\n   * @param lonLat Coordinates\n   * @param options Optional: ReverseSearchOptions\n   * @returns Observable or search results\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    reverseSearchCoordsFormat?: boolean\n  ): Observable<SearchResult[]>;\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return 'https://www.google.com/maps?q=' + encodedName;\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { RegexService } from '@igo2/core';\nimport { GeoServiceDefinition } from './propertyTypeDetector.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PropertyTypeDetectorService {\n\n  public geoServiceRegexes: GeoServiceDefinition[];\n\n  constructor(\n    private regexService: RegexService\n  ) {\n    this.geoServiceRegexes = this.getGeoServiceRegexes();\n  }\n\n  getPropertyType(value) {\n    return typeof value;\n  }\n\n  private isUrl(value): boolean {\n    const regex = /^https?:\\/\\//;\n    return regex.test(value.toString());\n  }\n\n  isGeoService(value): boolean {\n    let isGeoService = false;\n    if (!this.isUrl) {\n      return;\n    }\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(value)) {\n        isGeoService = true;\n        break;\n      }\n    }\n    return isGeoService;\n  }\n\n  getGeoService(url: string, availableProperties: string[]): GeoServiceDefinition {\n    if (!this.isGeoService(url)) {\n      return;\n    }\n    let matchingGeoservice: GeoServiceDefinition;\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(url)) {\n        // providing the the first matching regex;\n        const matchingProperties = availableProperties.filter(p => geoServiceRegex.propertiesForLayerName.includes(p));\n        matchingGeoservice = matchingProperties ? geoServiceRegex: undefined;\n        if (matchingGeoservice) { break; }\n      }\n    }\n    return matchingGeoservice;\n  }\n\n\n  private getGeoServiceRegexes(): GeoServiceDefinition[] {\n    return this.regexService.get('geoservice') as GeoServiceDefinition[] | [];\n  }\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\nimport {\n  CapabilitiesService,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions,\n  ArcGISRestDataSourceOptions\n} from '../../datasource';\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\nimport { getResolutionFromScale } from '../../map';\n\nimport {\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  ForcedProperty\n} from './catalog.interface';\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport { QueryFormat } from '../../query';\nimport { generateIdFromSourceOptions } from '../../utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n    const catalogConfig = this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      // Base layers catalog\n      if (catalogConfig.baseLayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (capabilities.Service && capabilities.Service.Abstract && capabilities.Service.Abstract.length) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(capabilities.Capability.Layer, 0, finalLayers, catalog.groupSeparator);\n        const capabilitiesCapabilityLayer = Object.assign({}, capabilities.Capability.Layer);\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(f => f.Layer.length !== 0);\n        this.includeRecursiveItems(\n          catalog,\n          capabilitiesCapabilityLayer,\n          items\n        );\n        return items;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n        const modifiedParent = Object.assign({}, parent);\n        modifiedParent.Layer = [];\n        finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n        const modifiedLayer = Object.assign({}, layer);\n        if (level > 0) {\n          modifiedLayer.Title = parent.Title + separator + layer.Title;\n        }\n        if (layer.Layer) {\n            this.flattenWmsCapabilities(modifiedLayer, level + 1, finalLayers, separator);\n        } else {\n            finalLayers.find(ff => ff.Title === parent.Title).Layer.push(layer);\n         }\n    }\n}\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n    );\n  }\n    );\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is kept\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const indicesMatchNewMetadataUrl = []; // metadata\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n            nPosition = indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          this.messageService.error(\n            catalog.title ? 'igo.geo.catalog.unavailable' : 'igo.geo.catalog.someUnavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            catalog.title ? { value: catalog.title } : undefined);\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private computeForcedProperties(\n    layerNameFromCatalog: string,\n    forcedProperties: ForcedProperty[]): ForcedProperty {\n\n    if (!forcedProperties || forcedProperties.length === 0) {\n      return;\n    }\n    const returnProperty: ForcedProperty = {\n      layerName: layerNameFromCatalog,\n      title: undefined,\n      metadataUrl: undefined,\n      metadataAbstract: undefined,\n      metadataAbstractAll: undefined,\n      metadataUrlAll: undefined\n    };\n    //process wildcard before\n    // if there is a * wildcard\n    const forcedPropertiesForAllLayers = forcedProperties.find(f => f.layerName === '*');\n    if (forcedPropertiesForAllLayers) {\n      // metadataAbstractAll\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\n        returnProperty.metadataAbstractAll = forcedPropertiesForAllLayers.metadataAbstractAll;\n      }\n      // metadataUrlAll\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\n        returnProperty.metadataUrlAll = forcedPropertiesForAllLayers.metadataUrlAll;\n      }\n    }\n    forcedProperties.map(forcedProperty => {\n      // if match found\n      if (layerNameFromCatalog === forcedProperty.layerName) {\n        // title\n        if (forcedProperty.title) {\n          returnProperty.title = forcedProperty.title;\n        }\n        // metadataUrl\n        if (forcedProperty.metadataUrl) {\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\n        }\n        // metadataAbstract\n        if (forcedProperty.metadataAbstract) {\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\n        }\n      }\n    });\n    return returnProperty;\n  }\n\n  /// WMS\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    const propertiesToForce = this.computeForcedProperties(layer.Name, catalog.forcedProperties);\n    let baseAbstract;\n    let extern = true;\n    if (layer.Abstract) {\n      baseAbstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      baseAbstract = catalog.abstract;\n    }\n    const layerOnlineResource = layer?.DataURL && layer?.DataURL.length >0 ? layer?.DataURL[0].OnlineResource : undefined;\n\n    let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll || layerOnlineResource;\n    let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || baseAbstract;\n\n    if (\n      !propertiesToForce?.metadataUrl &&\n      !propertiesToForce?.metadataUrlAll &&\n      (propertiesToForce?.metadataAbstract ||\n        propertiesToForce?.metadataAbstractAll)\n    ) {\n      extern = false;\n    }\n    if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n      extern = false;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadataUrl,\n          extern,\n          abstract: metadataAbstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> = this.prepareCatalogItemLayer(\n            layer,\n            idGroup,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  /// WMTS\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n\n        const propertiesToForce = this.computeForcedProperties(layer.Title, catalog.forcedProperties);\n        let extern = true;\n\n        let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || catalog.abstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n          extern = false;\n        }\n\n\n      if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n        return undefined;\n      }\n      const params = Object.assign({}, catalog.queryParams, {\n        version: '1.0.0'\n      });\n      const baseSourceOptions = {\n        type: 'wmts',\n        url: catalog.url,\n        crossOrigin: catalog.setCrossOriginAnonymous\n          ? 'anonymous'\n          : undefined,\n        layer: layer.Identifier,\n        matrixSet: catalog.matrixSet,\n        optionsFromCapabilities: true,\n        requestEncoding: catalog.requestEncoding || 'KVP',\n        style: 'default'\n      } as WMTSDataSourceOptions;\n      const sourceOptions = Object.assign(\n        {},\n        baseSourceOptions,\n        catalog.sourceOptions,\n        { params }\n      ) as WMTSDataSourceOptions;\n\n      return ObjectUtils.removeUndefined({\n        id: generateIdFromSourceOptions(sourceOptions),\n        type: CatalogItemType.Layer,\n        title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n        address: catalog.id,\n        externalProvider: catalog.externalProvider,\n        options: {\n          sourceOptions,\n          metadata: {\n            url: metadataUrl,\n            extern,\n            abstract: metadataAbstract,\n            type: baseSourceOptions.type\n          }\n        }\n      } as CatalogItem);\n    })\n    .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n}\n\n/// ERSI\n\n  private getArcGISRESTItems(\n    catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers =\n    !capabilities.layers ? [] : capabilities.layers.filter(layer => !layer.type || layer.type === 'Feature Layer');\n    if (!capabilities.layers) {\n      this.messageService.error(\n        'igo.geo.catalog.someUnavailable',\n        'igo.geo.catalog.unavailableTitle');\n    }\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (capabilities.serviceDescription && capabilities.serviceDescription.length) {\n      const regex = /(<([^>]+)>)/ig;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    return layers\n      .map((layer: any) => {\n\n        const propertiesToForce = this.computeForcedProperties(layer.name, catalog.forcedProperties);\n        let baseAbstract;\n        let extern = true;\n        if (layer.Abstract) {\n          baseAbstract = layer.Abstract;\n        } else if (!layer.Abstract && catalog.abstract) {\n          baseAbstract = catalog.abstract;\n        }\n\n        let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || baseAbstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions = {\n          type: TypeCatalog[catalog.type],\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.id as string,\n          queryable: true,\n          queryFormat: 'esrijson',\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          style: 'default'\n        } as ArcGISRestDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        ) as ArcGISRestDataSourceOptions;\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title ? propertiesToForce.title : layer.name,\n          externalProvider: catalog.externalProvider,\n          address: catalog.id,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: baseSourceOptions.type\n            },\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [map]=\"map\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"(store.count === 1) ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [map]=\"map\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { zip, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../../map';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType,\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter\n} from '../shared';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added ? this.addLayerToMap(layer, event) : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: AddedChangeGroupEmitter) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added ? this.addGroupToMap(group, event) : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer, event?: AddedChangeEmitter) {\n    this.addLayersToMap([layer], event);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(layers: CatalogItemLayer[], event: AddedChangeEmitter | AddedChangeGroupEmitter) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      if (this.catalog.profils?.length) {\n        layer.options.security = { profils: this.catalog.profils };\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n    zip(...layers$).subscribe((layers: Layer[]) => {\n      if (event.event.type === 'click' && event.added) {\n        this.map.layersAddedByClick$.next(layers);\n      }\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(layers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const currLayer = this.map.getLayerById(layer.options.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      } else {\n        const currLayer = this.map.getLayerById(layer.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(group: CatalogItemGroup, event: AddedChangeGroupEmitter) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[], event);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            mat-list-avatar\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"(item.collapsed)\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\">\n          </mat-icon>\n          <h4 matLine>{{computeItemTitle(item) | async}} </h4>\n        </mat-list-item>\n        <div #legend class=\"igo-layer-legend\" [ngClass]=\"{'with-title': item.title}\">\n          <div *ngIf=\"currentStyle !== undefined\">\n              <mat-form-field>\n                <mat-select tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n                  [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" [(ngModel)]=\"currentStyle\"\n                  (selectionChange)=\"onChangeStyle()\">\n                  <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{style.title}}</mat-option>\n                </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!(item.collapsed)\">\n            <div *ngIf=\"item.url\">\n              <img igoImageError *ngIf=\"item.imgGraphValue\" hideError=\"true\" #renderedLegend id=\"{{item.title}}\" (load)=\"onLoadImage(item.title)\"\n                [src]=\"item.imgGraphValue\"\n                alt=\"{{'igo.geo.layer.legend.loadingLegendText' | translate}}\">\n              <small *ngIf=\"imagesHeight[item.title]<16\">\n                  {{'igo.geo.layer.legend.noLegendScale' | translate}}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{'igo.geo.layer.legend.noLegendText' | translate}}\n    </small>\n  </ng-template>\n\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, ChangeDetectorRef } from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\n\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer, ItemStyleOptions } from '../shared/layers';\nimport { LegendMapViewOptions } from '../shared/layers/layer.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { LanguageService, ConfigService } from '@igo2/core';\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\nimport { SecureImagePipe } from '@igo2/common';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private configService: ConfigService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (typeof this.layer.options.legendOptions !== 'undefined' && this.layer.options.legendOptions.display === false) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    }\n\n    if (this.updateLegendOnResolutionChange || (sourceOptions as WMSDataSourceOptions).contentDependentLegend) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\n      secureIMG.transform(item.url).pipe(\n        catchError((err) => {\n          if (err.error) {\n            err.error.caught = true;\n            this.getLegend = false;\n            this.cdRef.detectChanges();\n            return err;\n          }\n        })\n        ).subscribe(obsLegGraph => {\n          const idx = this.legendItems$.value.findIndex(leg => leg.title === item.title);\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        }\n      );\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n   }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\n    return this.capabilitiesService\n      .getWMSOptions(localLayerOptions)\n      .pipe(map(wmsDataSourceOptions => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      }));\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\n      }\n      stylesAvailable.filter(sa => !sa.title).map((sa) => sa.title = sa.name);\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\n      return stylesAvailable;\n    }\n    return ;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\n        STYLES += this.currentStyle + ','\n      );\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" mat-list-avatar svgIcon=\"blank\"></mat-icon>\n  <h4 mat-line matTooltipShowDelay=\"500\" [ngClass]=\"(catalogAllowLegend)?'igo-cataloglayer-title':''\" (click)=\"askForLegend($event)\" [matTooltip]=\"computeTitleTooltip()\">{{title}}</h4>\n\n    <button *ngIf=\"layer.externalProvider\"\n      disabled=\"true\"\n      mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloglayer-external-icon\"\n      *ngIf=\"layer.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n  <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n  <button\n    (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"computeTooltip() | translate\"\n    [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n    (click)=\"onToggleClick($event)\">\n    <mat-icon\n       matBadge=\"icon\"\n       [igoMatBadgeIcon]=\"getBadgeIcon()\"\n       igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n       igoMatBadgeBackgroundColor=\"none\"\n       igoMatBadgeInverseColor=\"true\"\n       [matBadgeHidden]=\"((inRange$ | async) && (isVisible$ | async) === true) || ((inRange$ | async) && !added) || ((inRange$ | async) && (isPreview$ | async))\"\n       [matBadgeDisabled]=\"(inRange$ | async) === false\"\n       matBadgeSize=\"small\"\n       matBadgePosition=\"after\"\n       [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\"\n    [layer]=\"igoLayer$ | async\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\n\nimport { AddedChangeEmitter, CatalogItemLayer } from '../shared';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { first } from 'rxjs/operators';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { IgoMap } from '../../map';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeEmitter>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService ) {}\n\n  ngOnInit(): void {\n    this.isPreview$$ = this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\n\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n\n    this.resolution$$ = this.map.viewController.resolution$.subscribe((resolution) => {\n      this.isInResolutionsRange(resolution);\n      this.isVisible();\n    });\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n      const layerOptions = this.layer.options;\n      if (!layerOptions.tooltip) {\n        return getEntityTitle(this.layer);\n      }\n      const layerTooltip = layerOptions.tooltip;\n      const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n      switch (layerOptions.tooltip.type) {\n        case TooltipType.TITLE:\n          return this.layer.title;\n        case TooltipType.ABSTRACT:\n          if (layerMetadata && layerMetadata.abstract) {\n            return layerMetadata.abstract;\n          } else {\n            return this.layer.title;\n          }\n        case TooltipType.CUSTOM:\n          if (layerTooltip && layerTooltip.text) {\n            return layerTooltip.text;\n          } else {\n            return this.layer.title;\n          }\n        default:\n          return this.layer.title;\n      }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\n    .subscribe(layer => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove(event);\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove(event);\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer, event });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove(event: Event) {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer, event });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = (!this.layer.options.minResolution || Number.isNaN(this.layer.options.minResolution))\n      ? 0 : this.layer.options.minResolution;\n    const maxResolution = (!this.layer.options.maxResolution || Number.isNaN(this.layer.options.maxResolution))\n    ? Infinity : this.layer.options.maxResolution;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.id) {\n      const oLayer = this.map.getLayerById(this.layer?.id);\n      oLayer ? this.isVisible$.next(oLayer.visible) : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.getValue()) {\n      return this.isVisible$.getValue() ? '' : 'eye-off';\n    } else {\n      return 'eye-off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    mat-list-avatar\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\">\n  </mat-icon>\n\n  <h4 class=\"igo-catalog-group-title\" id=\"catalog-group-title\" mat-line matTooltipShowDelay=\"500\" [matTooltip]=\"title\" (click)=\"onTitleClick()\">{{title}}</h4>\n\n  <button *ngIf=\"group.externalProvider\"\n    disabled=\"true\"\n    mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloggroup-external-icon\"\n      *ngIf=\"group.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n\n  <ng-container *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\">\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n      color=\"warn\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick($event)\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </ng-container>\n\n  <ng-template #notadded>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick($event)\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n  </ng-template>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [map]=\"map\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport type { EntityStateManager } from '@igo2/common';\n\nimport {\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter,\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\nimport { IgoMap } from '../../map';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeGroupEmitter>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<AddedChangeEmitter>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event: Event) {\n    this.added$.value ? this.remove(event) : this.add(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group,\n      event\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove(event: Event) {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group,\n      event\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: AddedChangeEmitter) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every(value => value === added)) {\n      added ? this.add(event.event) : this.remove(event.event);\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <mat-checkbox *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    mat-list-icon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\">\n  </mat-checkbox>\n  <h4 (click)=\"toggleLegendOnClick()\" matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n\n  <button *ngIf=\"!selectionMode\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"eyeTooltip | translate\"\n    (click)=\"toggleVisibility()\">\n    <mat-icon\n      matBadge=\"?\"\n      matBadgeColor=\"accent\"\n      matBadgeSize=\"small\"\n      matBadgePosition=\"after\"\n      [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n  <button *ngIf=\"selectionMode\" class=\"selection-eye\"\n  mat-icon-button\n  [color]=\"layer.visible ? 'primary' : 'default'\"\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"layer.visible ?\n                ('igo.geo.layer.hideLayer' | translate) :\n                ('igo.geo.layer.showLayer' | translate)\"\n  (click)=\"toggleVisibility()\">\n  <mat-icon\n    matBadge=\"?\"\n    matBadgeColor=\"accent\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n    [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n    [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n  </mat-icon>\n</button>\n\n  <button *ngIf=\"!selectionMode\"\n    class=\"actions-button\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]= \"'igo.geo.layer.moreOptions' | translate\"\n    mat-icon-button\n    color=\"primary\"\n    (click)=\"toggleLayerTool()\">\n    <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n  </button>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  Renderer2,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  get eyeTooltip() {\n    if (this.inResolutionRange$.getValue() === false) {\n      return 'igo.geo.layer.notInResolution';\n    } else {\n      return this.layer.visible ? 'igo.geo.layer.hideLayer' : 'igo.geo.layer.showLayer';\n    }\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility() {\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower',\n}\n","<mat-list>\n  <igo-layer-list-tool *ngIf=\"showToolbar$ | async\"\n    floatLabel=\"auto\"\n    [layersAreAllVisible]=\"layersAreAllVisible\"\n    [term]=\"layerFilterAndSortOptions.keyword\"\n    [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n    [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n    (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n    (selection)=\"toggleSelectionMode($event)\">\n  </igo-layer-list-tool>\n</mat-list>\n\n<mat-list-item *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox mat-subheading-2\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"> {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) : ('igo.geo.layer.selectAll' | translate)}}\n  </mat-checkbox>\n</mat-list-item>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [ngClass]=\"{'igo-list-tools-multi': selection, 'igo-list-tools-single': (layerTool && !selection), 'igo-list-no-tools': (!layerTool && !selection)}\" [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\">\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel *ngIf=\"!selection && layerTool && activeLayer\" class=\"igo-layer-actions-container\" [title]=\"activeLayer.title\">\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Lower, true)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabled\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Raise, true)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabled\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon [matBadge]=\"badgeOpacity\" matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [value]=\"opacity\"\n          (input)=\"changeOpacity($event)\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          (click) = \"$event.stopPropagation()\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerExtentIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\">\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n\n    <ng-container igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{layer: activeLayer}\">\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel *ngIf=\"selection && layers.length > 0\" class=\"igo-layer-actions-container\" [title]=\"'igo.geo.layer.tools' | translate\">\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"isAllLayersRemovable(layersChecked) ? ('igo.geo.layer.removeSelectedLayers' | translate) : 'igo.geo.layer.removeSelectedLayersRestriction' | translate\"\n      (click)=\"removeLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"'!'\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n                svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"statusSelectedLayersCheck === 'ALL_HIDDEN' ? ('igo.geo.layer.showSelectedLayers' | translate) : ('igo.geo.layer.hideSelectedLayers' | translate)\"\n      (click)=\"toggleVisibility(layersChecked)\">\n      <mat-icon\t[svgIcon]=\"(statusSelectedLayersCheck === 'ALL_HIDDEN') ? 'eye-off' : 'eye'\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabledSelection\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabledSelection\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\"  class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click) = \"$event.stopPropagation()\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n    *ngIf=\"layersChecked.length !== 0 && activeLayersExtentAreValid(layersChecked)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\">\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ContentChild,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter,\n  ElementRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { LayerListControlsEnum, LayerListDisplacement } from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties } from '../shared/layers/layer.interface';\nimport { MatSliderChange } from '@angular/material/slider';\nimport * as olextent from 'ol/extent';\nimport { getAllChildLayersByProperty, getRootParentByProperty } from '../../map/shared/linkedLayers.utils';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) { }\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe(valStatus => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerExtentIsValid(layer: Layer): boolean {\n    let valid = false;\n    if (layer.options.showButtonZoomToExtent === false) {\n      return false;\n    }\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersExtentAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = (olextent.containsExtent(maxLayerZoomExtent, layersExtent));\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [number, number, number, number];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange ){\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(activeLayer: Layer, actiontype: LayerListDisplacement, fromUi: boolean = false) {\n    const sortedLayersToMove = [];\n    getRootParentByProperty(this.map,activeLayer,LinkedProperties.ZINDEX);\n    let rootParentByProperty = getRootParentByProperty(this.map,activeLayer,LinkedProperties.ZINDEX);\n    if (!rootParentByProperty) {\n      rootParentByProperty = activeLayer;\n    }\n    const layersToMove = [rootParentByProperty];\n    getAllChildLayersByProperty(this.map, rootParentByProperty, layersToMove, LinkedProperties.ZINDEX);\n\n    this.layers.map(layer => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, fromUi);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, fromUi);\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName('mat-checkbox-checked');\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName('igo-layer-item-focused');\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[0];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName('mat-checkbox-checked');\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName('igo-layer-item-focused');\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[checkItems.length-1];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every(l => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","  <mat-list-item>\n      <mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n        <input\n          matInput\n          [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n          [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n          matTooltipShowDelay=\"500\"\n          type=\"text\" [(ngModel)]=\"term\">\n        <button\n          mat-button\n          *ngIf=\"term\"\n          matSuffix\n          mat-icon-button\n          aria-label=\"Clear\"\n          color=\"warn\"\n          (click)=\"clearTerm()\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      </mat-form-field>\n\n      <div [matTooltip]=\"sortAlpha ?\n      ('igo.geo.layer.sortMapOrder' | translate) :\n      ('igo.geo.layer.sortAlphabetically' | translate)\" matTooltipShowDelay=\"500\">\n        <button class=\"sort-alpha\" [color]=\"sortAlpha ? 'warn' : 'primary'\" mat-icon-button (click)=\"toggleSortAlpha()\">\n          <mat-icon [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"></mat-icon>\n        </button>\n      </div>\n\n       <div [matTooltip]=\"onlyVisible ?\n        ('igo.geo.layer.resetLayersList' | translate) :\n        ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"only-visible\" mat-icon-button [disabled]=\"layersAreAllVisible && !onlyVisible\"\n           [color]=\"onlyVisible ? 'warn' : 'primary'\" (click)=\"toggleOnlyVisible()\">\n           <mat-icon\n             matBadge=\"icon\"\n             igoMatBadgeIcon=\"eye\"\n             igoMatBadgeInverseColor=\"true\"\n             igoMatBadgeInheritColor=\"true\"\n             [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\">\n           </mat-icon>\n         </button>\n       </div>\n\n       <div [matTooltip]=\"selectionMode ?\n        ('igo.geo.layer.deactivateSelectionMode' | translate) :\n        ('igo.geo.layer.activateSelectionMode' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"selection-mode\" mat-icon-button\n           color=\"primary\" (click)=\"toggleSelectionMode()\">\n           <mat-icon [svgIcon]=\"selectionMode ? 'checkbox-multiple-marked-outline' : 'checkbox-multiple-blank-outline'\"></mat-icon>\n         </button>\n       </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  EventEmitter,\n  Output,\n  OnDestroy\n} from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe(keyword => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { RouteService } from '@igo2/core';\nimport { MapService } from '../../map/shared/map.service';\nimport { LayerListComponent } from './layer-list.component';\nimport { Layer } from '../shared/layers/layer';\nimport { map, debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoLayerListBinding]'\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\n    });\n  }\n\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(layers\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\n      .map((layer: Layer) => layer.visible$))\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe((allLayersAreVisible: boolean) =>\n        this.component.layersAreAllVisible = allLayersAreVisible);\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","\n<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle \n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n  [checked]=\"showAllLegendsValue\" class=\"mat-typography\" \n  *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\" [labelPosition]=\"'before'\" (change)=\"toggleShowAllLegends($event.checked)\">\n    {{'igo.geo.layer.legend.showAll' | translate}}\n  </mat-slide-toggle>\n  <mat-divider *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n          igoListItem [layer]=\"layer\"\n          [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisible' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleButZoom' | translate}} \n  </p>\n\n</div>","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\nimport { Layer } from '../shared';\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() { }\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(debounce(() => {\n        return this.layers.length === 0 ? EMPTY : timer(50);\n      }))\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n      this.showAllLegendsValue = toggle;\n      this.next();\n      this.allLegendsShown.emit(toggle);\n  }\n}\n","<button *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\">\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { VectorLayer } from '../shared/layers';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <h4 matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoCollapsibleModule,\n  IgoImageModule,\n  IgoPanelModule,\n  IgoMatBadgeIconModule,\n  IgoCustomHtmlModule\n} from '@igo2/common';\n\nimport { LayerService } from './shared/layer.service';\nimport { StyleService } from '../style/style-service/style.service';\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\nimport { LayerItemComponent } from './layer-item/layer-item.component';\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\nimport { LayerListComponent } from './layer-list/layer-list.component';\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\n\n@NgModule({\n  imports: [\n    MatInputModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    CommonModule,\n    FormsModule,\n    MatDividerModule,\n    MatMenuModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSlideToggleModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatListModule,\n    MatSliderModule,\n    MatBadgeModule,\n    MatCheckboxModule,\n    ColorPickerModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoImageModule,\n    IgoPanelModule,\n    IgoMatBadgeIconModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ],\n  declarations: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ]\n})\nexport class IgoLayerModule {\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\n    return {\n      ngModule: IgoLayerModule,\n      providers: [LayerService, StyleService, LayerListToolService]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoMatBadgeIconModule,\n  IgoCollapsibleModule,\n  IgoListModule\n} from '@igo2/common';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { CatalogBrowserComponent } from './catalog-browser.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { IgoLayerModule } from '../../layer/layer.module';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoMetadataModule,\n    IgoLayerModule\n  ],\n  exports: [\n    CatalogBrowserComponent\n  ],\n  declarations: [\n    CatalogBrowserComponent,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent\n  ]\n})\nexport class IgoCatalogBrowserModule {}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.catalog.library.addTitle' | translate}}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"title\" placeholder=\"{{'igo.geo.printForm.title' | translate}}\" matInput [matAutocomplete]=\"auto2\">\n        <mat-autocomplete #auto2=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.title}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"url\" placeholder=\"URL\" matInput [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.url}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select\n          formControlName=\"type\"\n          placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\">\n              <p mat-line>{{type}}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.externalProvider.unavailableWithEmail', { value: addedCatalog.url, email: emailAddress })}}</p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url })}}</p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.catalog.library.cancel' | translate}}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\">\n      {{'igo.geo.catalog.library.add' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService, ConfigService } from '@igo2/core';\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormBuilder, UntypedFormGroup, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport { TypeCapabilities } from '../../datasource';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss']\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { predefinedCatalogs: Catalog[]; store: EntityStore<Catalog>; error: boolean; addedCatalog: Catalog }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\">\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=btnAddCatalog>\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\">\n    {{'igo.geo.catalog.library.addBtn' | translate}}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { EntityStore } from '@igo2/common';\nimport { MessageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\nimport { CapabilitiesService } from '../../datasource';\nimport { IgoMap } from '../../map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    this.predefinedCatalogs = this.predefinedCatalogs.map(c => {\n      c.id = Md5.hashStr(\n        (c.type || 'wms') + standardizeUrl(c.url)\n      ) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      this.messageService.alert('igo.geo.catalog.library.inlist.message', 'igo.geo.catalog.library.inlist.title');\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n    .getCapabilities(addedCatalog.type as any, addedCatalog.url, addedCatalog.version)\n      .pipe(\n        catchError((e) => {\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          this.messageService.error(\n            'igo.geo.catalog.unavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            { value: addedCatalog.url });\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign({},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })) as Catalog);\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<mat-list-item>\n  <h4 mat-line>\n    {{title}}\n  </h4>\n  <mat-icon\n    class=\"igo-external-provider\"\n    *ngIf=\"catalog.externalProvider\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n    color=\"primary\"\n    (click)=\"$event.stopPropagation()\"\n    svgIcon=\"earth-arrow-right\">\n  </mat-icon>\n\n  <button\n  *ngIf=\"catalog.removable\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n  color=\"warn\"\n  (click)=\"removeCatalogFromLibrary($event)\">\n  <mat-icon svgIcon=\"delete\"></mat-icon>\n</button>\n\n<button\n  class=\"igo-blank\"\n  *ngIf=\"!catalog.removable\"\n  disabled=\"true\"\n  mat-icon-button>\n  <mat-icon svgIcon=\"blank\"></mat-icon>\n</button>\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common';\nimport { IgoMap } from '../../map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryItemComponent {\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.catalog); }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule } from '@igo2/common';\n\nimport { CatalogLibaryComponent, } from './catalog-library.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoListModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n    MatDialogModule\n  ],\n  exports: [\n    CatalogLibaryComponent,\n    AddCatalogDialogComponent\n  ],\n  declarations: [\n    CatalogLibaryComponent,\n    CatalogLibaryItemComponent,\n    AddCatalogDialogComponent\n  ]\n})\nexport class IgoCatalogLibraryModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\n\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoListModule,\n    IgoCollapsibleModule\n  ],\n  exports: [\n    IgoCatalogBrowserModule,\n    IgoCatalogLibraryModule\n  ],\n  declarations: []\n})\nexport class IgoCatalogModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\nimport { TimeFilterableDataSource } from './time-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource'\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (\n        dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select ||\n        dataSource.options.ogcFilters.autocomplete)) {\n        isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else { // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          options.ogcFilters.filters,\n          options.paramsWFS.fieldNameGeometry\n        );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          // With some wms server, this param must be set to make spatials call.\n          options.ogcFilters.filters,\n          options.fieldNameGeometry\n        );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters,\n        undefined,\n        undefined,\n        undefined,\n        wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n    AdmRegion = 'AdmRegion',\n    Mun = 'Mun',\n    Arrond = 'Arrond',\n    CircFed = 'CircFed',\n    CircProv = 'CircProv',\n    DirReg = 'DirReg',\n    MRC = 'MRC',\n    RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n    Predefined = 'Predefined',\n    Polygon = 'Polygon',\n    Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n    Address = 'Address',\n    Thematics = 'Thematics'\n}\n","import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { map } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { Feature } from '../../feature/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterItemType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find(key => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{ features: Feature[] }>(\n          this.baseUrl + this.urlFilterList[urlPath]\n        )\n        .pipe(\n          map(featureCollection =>\n            featureCollection.features.map(f => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach(type => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map(f => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType,\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode,\n            {\n              params: {\n                geometry: '100',\n                bufferOutput: buffer.toString()\n              }\n            }\n          )\n          .pipe(\n            map(f => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map(f => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { MessageService } from '@igo2/core';\n\nimport { Layer } from '../../layer/shared';\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n\n  constructor(\n    private messageService: MessageService\n  ) {}\n\n  open(layer: Layer) {\n    this.messageService.success(\n      'igo.geo.download.start',\n      'igo.geo.download.title'\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0\n        ) {\n          currentProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined ? '' : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter()\n        .handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj);\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n            filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"options && options.download && (options.download['dynamicUrl'] || options.download['url']) \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\">\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","<table class=\"igo-striped mat-typography\" *ngIf=\"ready && feature && isObject(feature.properties) && feature.properties.target !== 'iframe'\">\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <mat-icon mat-list-avatar svgIcon=\"{{icon}}\"></mat-icon>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\"> {{ 'igo.geo.targetHtmlUrl' | translate }} {{title}}</a>\n        <button class=\"copyClipboard\" mat-icon-button (click)=\"copyTextToClipboard(property.value)\">\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\n        </button>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{property.key}}\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value) && !isEmbeddedLink(property.value)\" [innerHTML]=\"property.value\">\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isEmbeddedLink(property.value)\">\n        <u [ngStyle]=\"{'cursor': 'pointer', 'color': 'blue'}\" (click)=\"openSecureUrl(property.value)\">{{ getEmbeddedLinkText(property.value) }}</u>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && (isDoc(property.value) || isUrl(property.value)) && !isImg(property.value)\">\n        <u [ngStyle]=\"{'cursor': 'pointer', 'color': 'blue'}\" (click)=\"openSecureUrl(property.value)\">{{ 'igo.geo.targetHtmlUrl' | translate }}</u>\n        <button class=\"copyClipboard\" mat-icon-button (click)=\"copyTextToClipboard(property.value)\">\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\n        </button>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value) && isImg(property.value)\">\n        <a href=\"{{property.value}}\" target='_blank' (click)=\"openSecureUrl(property.value)\" rel=\"noopener noreferrer\">\n          <img igoImageError src=\"{{(property.value | secureImage) | async}}\" width=\"225\" height=\"auto\">\n        </a>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isObject(property.value)\" [innerHTML]=\"property.value | json\">\n      </td>\n\n    </tr>\n  </tbody>\n</table>\n\n<iframe *ngIf=\"isHtmlDisplay()\" [srcdoc]=\"htmlSanitizer(feature.properties)\" [src]=\"urlSanitizer(feature.properties.url)\"></iframe>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { NetworkService, ConnectionState, MessageService } from '@igo2/core';\nimport { ConfigService } from '@igo2/core';\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\nimport type { Toolbox } from '@igo2/common';\n\nimport { Feature } from '../shared';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { IgoMap } from '../../map/shared/map';\nimport { HttpClient } from '@angular/common/http';\nimport { Clipboard } from '@igo2/utils';\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n\n  constructor(\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private configService: ConfigService\n  ) {\n    this.networkService.currentState().pipe(takeUntil(this.unsubscribe$)).subscribe((state: ConnectionState) => {\n      this.state = state;\n    });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n\n  isHtmlDisplay(): boolean {\n    if (this.feature && this.isObject(this.feature.properties) && this.feature.properties.target === 'iframe') {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body) {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace('<head>', `<head><base href=\"${url.origin}\">`);\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  openSecureUrl(value) {\n    let url: string;\n    const regexDepot = new RegExp(this.configService?.getConfig('depot.url') + '.*?(?=\"|$)');\n\n    if (regexDepot.test(value)) {\n      url = value.match(regexDepot)[0];\n\n      this.http.get(url, {\n        responseType: 'blob'\n      })\n      .subscribe((docOrImage) => {\n        const fileUrl = URL.createObjectURL(docOrImage);\n        window.open(fileUrl, '_blank');\n        this.cdRef.detectChanges();\n      },\n      (error: Error) => {\n        this.messageService.error('igo.geo.targetHtmlUrlUnauthorized', 'igo.geo.targetHtmlUrlUnauthorizedTitle');\n      });\n    } else {\n      let url = value;\n      if (this.isEmbeddedLink(value)) {\n        var div = document.createElement('div');\n        div.innerHTML = value;\n        url = div.children[0].getAttribute('href');\n      }\n      window.open(url, '_blank');\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      const regex = /^https?:\\/\\//;\n      return regex.test(value);\n    }\n  }\n\n  isDoc(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(pdf|docx?|xlsx?)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isImg(value) {\n    if (typeof value ==='string') {\n      if (this.isUrl(value)) {\n        const regex = /(jpe?g|png|gif)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isEmbeddedLink(value) {\n    if (typeof value === 'string') {\n        const matchRegex = /<a/g;\n        const match = value.match(matchRegex) || [];\n        const count = match.length;\n        if (count === 1) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n    return false;\n}\n\n  getEmbeddedLinkText(value) {\n    const regex = /(?:>).*?(?=<|$)/;\n    let text = value.match(regex)[0] as string;\n    text = text.replace(/>/g, '');\n    return text;\n  }\n\n  filterFeatureProperties(feature) {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.forcedOffline$.pipe(takeUntil(this.unsubscribe$)).subscribe(state => {\n        offlineButtonState = state;\n      });\n    }\n\n    if (feature.properties && feature.properties.Route && this.toolbox && !this.toolbox.getTool('directions')) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n\n  /**\n   * Copy the url to a clipboard\n   */\n  copyTextToClipboard(value: string): void {\n    const successful = Clipboard.copy(value);\n    if (successful) {\n      this.messageService.success('igo.geo.query.link.message');\n    }\n  }\n}\n","export enum GeometryType {\n    Point = 'Point',\n    LineString = 'LineString',\n    Polygon = 'Polygon',\n    Circle = 'Circle'\n}\n\nexport enum LabelType{\n    Coordinates = 'Coordinates',\n    Length = 'Length',\n    Area = 'Area',\n    Predefined = 'Predefined',\n    Custom = 'Custom'\n}\n\nexport enum CoordinatesUnit {\n    DecimalDegree = 'DD',\n    DegreesMinutesSeconds = 'DMS'\n\n}\n","export enum FontType {\n    Arial = 'Arial',\n    ArialBlack = 'Arial Black',\n    Verdana = 'Verdana',\n    Tahoma = 'Tahoma',\n    TrebuchetMS = 'Trebuchet MS',\n    Impact = 'Impact',\n    TimesNewRoman = 'Times New Roman',\n    Georgia = 'Georgia',\n    AmericanTypewriter = 'American Typewriter',\n    Courier = 'Courier',\n    LucidaConsole = 'Lucida Console',\n    BrushScriptMT = 'Brush Script MT',\n    ComicSansMS = 'Comic Sans MS'\n}\n","import OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport lineIntersect from '@turf/line-intersect';\nimport { lineString } from '@turf/helpers';\n\nimport {\n  GeometrySliceMultiPolygonError,\n  GeometrySliceLineStringError,\n  GeometrySliceTooManyIntersectionError\n } from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color:  [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(\n  olEvent: BasicEvent\n) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice a MultiPolygon.');\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice with a line that has more than 2 points.');\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super('More than 2 intersections found between the target polygon and the slicing line.');\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\n  }\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlDraw from 'ol/interaction/Draw';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport BasicEvent from 'ol/events/Event';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport { unByKey } from 'ol/Observable';\nimport { doubleClick } from 'ol/events/condition';\n\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: Type | string;\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n  public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Observables from predefined radius (defaults to false and undefined)\n   */\n  ispredefinedRadius$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n  radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometry | undefined | string;\n  private olInteractionStyle: OlStyleLike;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n  public radius: number;\n\n  private mousePosition: [number, number];\n\n  /**\n   * take the value of radius\n   */\n  get radiusVal(): number {\n    return this.predefinedRadius$.getValue();\n  }\n  set radiusValData(radiusCercle: number) {\n    this.predefinedRadius$.next(radiusCercle);\n  }\n\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer ? options.drawingLayer : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n    this.olInteractionStyle = this.options.interactionStyle;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayerSource;\n\n  }\n\n  setOlInteractionStyle(style) {\n    this.olInteractionStyle = style;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: Type) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Get the current geometry type\n   */\n  getGeometryType() {\n    return this.olGeometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource ? this.options.drawingLayerSource : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      if (!this.ispredefinedRadius$.getValue()) {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: 'Point',\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      }\n\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          style: typeof this.olInteractionStyle === 'function' ? undefined : this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n    this.onDrawStartKey = olDrawInteraction.on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\n    this.onDrawAbortKey = olDrawInteraction.on('drawabort', (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry()));\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) => this.onSelect(event));\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey, this.onDrawAbortKey]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    if (event.feature.getGeometry().getType() === 'Point') {\n      this.radiusDrawEnd$.next(this.predefinedRadius$.getValue());\n    }\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\n      // On Escape or 'c' keydowns, abort the current drawing\n      if (event.key === 'Escape') {\n        this.olDrawInteraction.abortDrawing();\n        return;\n      }\n\n      // On Backspace or 'u' keydowns, remove last vertex of current drawing\n      if (event.key === 'Backspace') {\n        this.olDrawInteraction.removeLastPoint();\n      }\n\n      // On Enter or 'f' keydowns, finish current drawing\n      if (event.key === 'Enter') {\n        this.olDrawInteraction.finishDrawing();\n      }\n\n      // On space bar key down, pan to the current mouse position\n      if (event.key === ' ') {\n        this.olMap.getView().animate({\n          center: this.mousePosition,\n          duration: 100\n        });\n        return;\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","\nexport const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm²',\n  [MeasureAreaUnit.SquareKilometers]: 'km²',\n  [MeasureAreaUnit.SquareMiles]: 'mi²',\n  [MeasureAreaUnit.SquareFeet]: 'ft²',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\nimport * as olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport {\n  getLength as olGetLength,\n  getArea as olGetArea\n} from 'ol/sphere';\n\nimport { Measure } from './measure.interfaces';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(measure.toLocaleString(options.locale, {\n      minimumFractionDigits: decimal,\n      maximumFractionDigits: decimal\n    }));\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ?\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter(p => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33',\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, {projection});\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, {projection});\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max((olGeometry.getFlatCoordinates().length / 2) - 1, 0);\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n  typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n    }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(olPoint: OlPoint, center: boolean = false, srcGeomType: string= ''): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center ?\n    [ 'igo-map-tooltip',\n      'igo-map-tooltip-measure', 'igo-map-tooltip-measure-area'] : ['igo-map-tooltip', 'igo-map-tooltip-measure',\n      `igo-map-tooltip-measure-${srcGeomType}segments`]).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import * as Olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport {\n  updateOlGeometryMidpoints,\n  updateOlGeometryCenter\n} from '../../measure/shared/measure.utils';\nimport { CoordinatesUnit } from './draw.enum';\nimport { convertDDToDMS, roundCoordToString } from '../../map/shared/map.utils';\n\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(fillColor?: string, strokeColor?: string, strokeWidth?: number, label?: string): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: [\n      'igo-map-tooltip',\n      'igo-map-tooltip-draw'\n    ].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n\n\nexport function DDtoDMS(value: [number, number], unit: CoordinatesUnit): string[] | undefined {\n  const conversionMapper = new Map([\n    [CoordinatesUnit.DecimalDegree, (val: [number, number]) => {\n      if (typeof val[0] === 'number') {\n        return roundCoordToString(val, 5) as string[];\n      } else {\n        const numVal: [number, number] = [Number(val[0]), Number(val[1])];\n        return roundCoordToString(numVal, 5) as string[];\n      }\n    }],\n    [CoordinatesUnit.DegreesMinutesSeconds, (val: [number, number]) => convertDDToDMS(val, 2)]\n  ]);\n  let conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n\n","<div>\n  <h2 mat-dialog-title>\n    {{ 'igo.geo.draw.popupTitle' | translate }}\n  </h2>\n</div>\n\n\n<div class=\"geometry-type-toggle mat-typography\">\n  <mat-button-toggle-group\n    (change)=\"onLabelTypeChange($event.value)\" [value]=\"customOrPredefined\">\n    <mat-button-toggle [value]=\"labelType.Custom\" >\n      {{ 'igo.geo.draw.labelType.custom' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"labelType.Predefined\">\n      {{ 'igo.geo.draw.labelType.predefined' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<div *ngIf=\"labelFlag !== labelType.Custom\">\n  <div>\n    <p class=\"mat-typography\">{{ 'igo.geo.draw.builtInInstructions' | translate }}</p>\n    <mat-radio-group *ngIf=\"olGeometryType !== 'Polygon'\" class=\"mat-typography\">\n      <mat-radio-button *ngFor=\"let option of arrayBuiltInType\" [value]=\"option.value\" [disabled]=\"optionAvailable(option.value)\" \n      (change)=\"onLabelTypeChange($event.value)\" [checked]=\"option.checked\">\n        {{getProperLengthLabel(option.value)}}\n      </mat-radio-button>\n    </mat-radio-group>\n    <ng-container class=\"mat-typography\" *ngIf=\"olGeometryType === 'Polygon'\">\n      <mat-checkbox\n        *ngFor=\"let option of arrayBuiltInType\"\n        class=\"mat-typography\"\n        [value]=\"option.value\"\n        [disabled]=\"optionAvailable(option.value)\"\n        (change)=\"onLabelTypeChange($event.source.value, $event.checked)\"\n        [checked]=\"option.checked\">\n        {{getProperLengthLabel(option.value)}}\n      </mat-checkbox>\n    </ng-container>\n    <div *ngIf=\"labelFlag === labelType.Coordinates\">\n      <mat-form-field class=\"readOnly-Input\">\n        <input\n          #input\n          matInput\n          placeholder=\"(Latitude, Longitude)\"\n          value=\"{{currentCoordinates}}\" readonly>\n      </mat-form-field>\n      <mat-form-field class=\"unit-field\">\n        <mat-select [value]=\"coordinatesMeasureUnit\" (selectionChange)=\"onChangeCoordinateUnit($event.value)\">\n          <mat-option *ngFor=\"let unit of allCoordinatesUnits\" [value]=\"unit\">\n            {{unit}}\n          </mat-option>\n        </mat-select>  \n      </mat-form-field>\n    </div>\n    <div *ngIf=\"labelFlag === labelType.Length || polygonCheck === 2\">\n      <mat-form-field class=\"readOnly-Input\">\n        <input\n          #input\n          matInput\n          placeholder={{lengthLabelT}}\n          value=\"{{currentLength}}\" readonly>\n      </mat-form-field>\n      <mat-form-field class=\"unit-field\">\n        <mat-select [value]=\"lengthMeasureUnit\" (selectionChange)=\"onChangeLengthUnit($event.value)\">\n          <mat-option *ngFor=\"let unit of allLengthUnits\" [value]=\"unit\">\n            {{getLengthUnitEnum(unit)}}\n          </mat-option>\n        </mat-select>  \n      </mat-form-field>\n    </div>\n    <div *ngIf=\"labelFlag === labelType.Area || polygonCheck === 2\">\n      <mat-form-field class=\"readOnly-Input\">\n        <input\n          #input\n          matInput\n          placeholder=\"{{ 'igo.geo.draw.labelType.Area' | translate }}\"\n          value=\"{{currentArea}}\" readonly>\n      </mat-form-field>\n      <mat-form-field class=\"unit-field\">\n        <mat-select [value]=\"areaMeasureUnit\" (selectionChange)=\"onChangeAreaUnit($event.value)\">\n          <mat-option *ngFor=\"let unit of allAreaUnits\" [value]=\"unit\">\n            {{getAreaUnitEnum(unit)}}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\" >\n      {{'igo.geo.draw.cancel' | translate}}\n    </button>\n    <button \n      mat-raised-button \n      color=\"primary\" \n      (click)=\"confirm()\"> \n      {{noLabelButton()}} \n    </button>\n  </div>\n</div>\n\n<div *ngIf=\"labelFlag === labelType.Custom\">\n  <div>\n    <p class=\"mat-typography\">{{ 'igo.geo.draw.dialogInstruction' | translate }}</p>\n    <mat-form-field class=\"input\">\n      <input\n        #input\n        matInput\n        (select)=\"true\"\n        (input)=\"getLabelLength($event.target.value)\"\n        placeholder=\"{{'igo.geo.draw.dialogTitle' | translate}}\"\n        value=\"{{ currentLabel }}\"\n        cdkFocusInitial/>\n    </mat-form-field>\n  </div>\n  \n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\" >\n      {{'igo.geo.draw.cancel' | translate}}\n    </button>\n    <button \n      mat-raised-button \n      color=\"primary\" \n      (click)=\"confirm(input.value)\">\n      {{noLabelButton()}}\n    </button>\n  </div>\n</div>\n","import { Component, Inject, Input } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { transform } from 'ol/proj';\nimport { IgoMap, roundCoordTo } from '../../map/shared';\nimport OlFeature from 'ol/Feature';\nimport {\n  measureOlGeometryLength,\n  measureOlGeometryArea,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\nimport {\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation,\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n} from '../../measure/shared/measure.enum';\n\nimport {fromCircle} from 'ol/geom/Polygon';\nimport { getLength } from 'ol/sphere';\nimport Circle from 'ol/geom/Circle';\nimport { DDtoDMS } from '../shared/draw.utils';\n\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-popup.component.html',\n  styleUrls: ['./draw-popup.component.scss']\n  })\nexport class DrawPopupComponent {\n  @Input() confirmFlag: boolean = false;\n  @Input() labelFlag: LabelType | [LabelType, LabelType] = LabelType.Custom;\n  @Input() coordinatesMeasureUnit: CoordinatesUnit;\n  @Input() lengthMeasureUnit: MeasureLengthUnit;\n  @Input() areaMeasureUnit: MeasureAreaUnit;\n\n  public geometryType = GeometryType;\n  public labelType = LabelType;\n  public arrayBuiltInType: any[] = [];\n\n  public currentLabel: string;\n  public currentCoordinates: string;\n  public currentArea: string;\n  public currentLength: string;\n\n  public olGeometryType: GeometryType = undefined;\n  public lengthInMeters: string;\n  public areaInMetersSquare: string;\n  public coordinatesInDD: string;\n  public currentCoordinatesUnit: string;\n\n  private longlatDD: [number, number];\n  private labelLength: number;\n\n  public polygonCheck = 0; // Count for polygon label types checkboxes\n\n  constructor(\n    private languageService: LanguageService,\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: { olGeometry: any, map: IgoMap }\n    ) {\n      this.currentLabel = this.data.olGeometry.get('draw');\n      this.labelLength = this.currentLabel ? this.currentLabel.length: 0;\n      let olGeometry;\n\n      const projection = this.data.map.ol.getView().getProjection();\n\n      if(this.data.olGeometry instanceof OlFeature) {\n        if (this.data.olGeometry.get('rad')){\n          const longitudeLatitude = [this.data.olGeometry.get('longitude'), this.data.olGeometry.get('latitude')];\n          this.olGeometryType = GeometryType.Circle;\n          olGeometry = new Circle(longitudeLatitude, this.data.olGeometry.get('rad'));\n        }\n        else{\n          this.olGeometryType = this.data.olGeometry.getGeometry().getType();\n          olGeometry = this.data.olGeometry.get('geometry');\n        }\n      }\n      else{\n        this.olGeometryType = this.data.olGeometry.getType();\n        olGeometry = this.data.olGeometry;\n      }\n\n      if (this.olGeometryType === GeometryType.Point || this.olGeometryType === GeometryType.Circle){\n        if(this.data.olGeometry instanceof OlFeature){\n          let longitude = this.data.olGeometry.get('longitude');\n          let latitude = this.data.olGeometry.get('latitude');\n          this.longlatDD = roundCoordTo([longitude, latitude], 5);\n          this.coordinatesInDD = '(' + latitude + ', '\n          + longitude + ')';\n        }\n        else {\n          let point4326 = transform(\n            this.data.olGeometry.getFlatCoordinates(),\n            projection,\n            'EPSG:4326'\n          );\n          this.longlatDD = roundCoordTo([point4326[0], point4326[1]], 5);\n          this.coordinatesInDD =\n            '(' + this.longlatDD[1] + ', ' + this.longlatDD[0] + ')';\n        }\n        this.currentCoordinates = this.coordinatesInDD;\n      }\n      if (this.olGeometryType === GeometryType.LineString){\n        this.lengthInMeters = measureOlGeometryLength(olGeometry, projection.getCode()).toFixed(2);\n        this.currentLength = this.lengthInMeters;\n      }\n      else if (this.olGeometryType === GeometryType.Polygon){\n        this.lengthInMeters = measureOlGeometryLength(olGeometry, projection.getCode()).toFixed(2);\n        this.currentLength = this.lengthInMeters;\n        this.areaInMetersSquare = measureOlGeometryArea(olGeometry,projection.getCode()).toFixed(2);\n        this.currentArea = this.areaInMetersSquare;\n      }\n      else if(this.olGeometryType === GeometryType.Circle){\n        let circularPolygon = fromCircle(olGeometry, 10000);\n        const radius = this.getRadius(circularPolygon);\n        this.lengthInMeters = radius.toFixed(2);\n        this.currentLength = this.lengthInMeters;\n        this.areaInMetersSquare = measureOlGeometryArea(circularPolygon,projection.getCode()).toFixed(2);\n        this.currentArea = this.areaInMetersSquare;\n      }\n\n      if (data.olGeometry.get('labelType') === LabelType.Coordinates) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Coordinates, true);\n        this.coordinatesMeasureUnit = data.olGeometry.get('measureUnit');\n      } else if (data.olGeometry.get('labelType') === LabelType.Length) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Length, true);\n        this.lengthMeasureUnit = data.olGeometry.get('measureUnit');\n      } else if (data.olGeometry.get('labelType') === LabelType.Area) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Area, true);\n        this.areaMeasureUnit = data.olGeometry.get('measureUnit');\n      } else if (data.olGeometry.get('labelType')?.length === 2) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Length, true);\n        this.onLabelTypeChange(LabelType.Area, true);\n        this.lengthMeasureUnit = data.olGeometry.get('measureUnit')[0];\n        this.areaMeasureUnit = data.olGeometry.get('measureUnit')[1];\n      }\n      this.buildArrayType();\n    }\n\n  /**\n   * HTML Interactions\n   */\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm(input?: string) {\n    this.confirmFlag = true;\n    if(this.labelFlag === LabelType.Predefined){\n      this.dialogRef.close();\n    }\n    else if (this.labelFlag === LabelType.Custom){\n      this.dialogRef.close({\n        label: input\n      });\n    }\n    else if(this.labelFlag === LabelType.Coordinates){\n      this.dialogRef.close({\n        label: this.currentCoordinates,\n        measureUnit: this.coordinatesMeasureUnit\n      });\n    }\n    else if (this.olGeometryType === GeometryType.Polygon) {\n      if (this.polygonCheck === 2) {\n        this.labelFlag = [LabelType.Length, LabelType.Area];\n        this.dialogRef.close({\n          label: 'P: ' + this.currentLength + ' ' + MeasureLengthUnitAbbreviation[MeasureLengthUnit.Meters] + '\\n'\n          + this.languageService.translate.instant('igo.geo.draw.labelType.A') + this.currentArea + ' ' +\n          MeasureAreaUnitAbbreviation[MeasureAreaUnit.SquareMeters], measureUnit: [this.lengthMeasureUnit, this.areaMeasureUnit]\n        });\n      } else {\n        this.labelFlag === LabelType.Length ?\n        this.dialogRef.close({\n          label: 'P: ' + this.currentLength + ' ' + MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        }) :\n        this.dialogRef.close({\n          label: this.currentArea + ' ' + MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n          measureUnit: this.areaMeasureUnit\n        });\n      }\n    }\n    else if (this.labelFlag === LabelType.Length){\n      if (this.olGeometryType === GeometryType.Circle){\n        this.dialogRef.close({\n          label: 'R: ' + this.currentLength + ' ' + MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      }\n      else if (this.olGeometryType === GeometryType.LineString) {\n        this.dialogRef.close({\n          label: this.currentLength + ' ' + MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      }\n    }\n    else if (this.labelFlag === LabelType.Area){\n      this.dialogRef.close({\n        label: this.currentArea + ' ' + MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n        measureUnit: this.areaMeasureUnit\n      });\n    }\n  }\n\n  onLabelTypeChange(labelType: LabelType, checked?: boolean){\n    if (labelType !== LabelType.Predefined &&\n      labelType !== LabelType.Custom &&\n      this.olGeometryType === GeometryType.Polygon) {\n        this.arrayBuiltInType.find(type => type.value === labelType) ?\n          this.arrayBuiltInType.find(type => type.value === labelType).checked = checked : this.labelFlag = undefined;\n        checked ? this.labelFlag = labelType : this.labelFlag = this.arrayBuiltInType.find(type => type.checked)?.value;\n    } else {\n      this.labelFlag = labelType;\n    }\n\n    if (labelType === LabelType.Predefined){\n      if (this.olGeometryType === GeometryType.Point ){\n        this.labelFlag = LabelType.Coordinates;\n        this.currentCoordinates = this.coordinatesInDD;\n        this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n      }\n      else if (this.olGeometryType === GeometryType.LineString){\n        this.labelFlag = LabelType.Length;\n        this.currentLength = this.lengthInMeters;\n        this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n      }\n    }\n    else if (labelType === LabelType.Area){\n      this.currentArea = this.areaInMetersSquare;\n      this.areaMeasureUnit = MeasureAreaUnit.SquareMeters;\n    }\n    else if (labelType === LabelType.Length){\n      this.currentLength = this.lengthInMeters;\n      this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n    }\n    else if (this.labelFlag === LabelType.Coordinates){\n      this.currentCoordinates = this.coordinatesInDD;\n      this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n    }\n\n    const labeltypes = [this.labelType.Length, this.labelType.Area];\n    if (\n      this.olGeometryType === GeometryType.Polygon &&\n      labeltypes.includes(labelType)) {\n      checked ? this.polygonCheck += 1 : this.polygonCheck -= 1;;\n    } else {\n      this.polygonCheck = 0;\n    }\n  }\n\n  onChangeLengthUnit(lengthUnit: MeasureLengthUnit){\n    this.lengthMeasureUnit = lengthUnit;\n    this.currentLength = metersToUnit(Number(this.lengthInMeters), lengthUnit).toFixed(2);\n  }\n\n  onChangeAreaUnit(areaUnit: MeasureAreaUnit){\n    this.areaMeasureUnit = areaUnit;\n    this.currentArea = squareMetersToUnit(Number(this.areaInMetersSquare), areaUnit).toFixed(2);\n  }\n\n  onChangeCoordinateUnit(coordinatesUnit: CoordinatesUnit){\n    this.coordinatesMeasureUnit = coordinatesUnit;\n    let coordinates = DDtoDMS(this.longlatDD, coordinatesUnit);\n    this.currentCoordinates = '(' + coordinates[1] + ', ' + coordinates[0] + ')';\n  }\n\n  buildArrayType() {\n    for (const labelType of Object.values(LabelType)){\n      if (labelType !== LabelType.Custom && labelType !== LabelType.Predefined){\n        this.arrayBuiltInType.push({\n          value: labelType,\n          checked:\n            this.selectOptions(labelType) ||\n            this.labelFlag === labelType ||\n            (this.polygonCheck === 2 && labelType !== LabelType.Coordinates)\n        });\n      }\n    }\n  }\n\n  noLabelButton(){\n    if (this.labelFlag === LabelType.Predefined || (this.labelFlag === LabelType.Custom && this.labelLength === 0)){\n      return this.languageService.translate.instant('igo.geo.draw.noLabel');\n    }\n\n    return 'OK';\n  }\n\n  get customOrPredefined(){\n    if (this.labelFlag === LabelType.Custom){\n      return LabelType.Custom;\n    }\n    return LabelType.Predefined;\n  }\n\n  optionAvailable(currentOption: LabelType){\n    switch(this.olGeometryType){\n      case GeometryType.Point:\n        if (currentOption === LabelType.Coordinates){\n          return false;\n        }\n        return true;\n      case GeometryType.LineString:\n        if (currentOption === LabelType.Length){\n          return false;\n        }\n        return true;\n      case GeometryType.Polygon:\n        if (currentOption === LabelType.Coordinates){\n          return true;\n        }\n        return false;\n      default:\n        return false;\n    }\n  }\n\n  get allLengthUnits(): string[]{\n    return Object.values(MeasureLengthUnit);\n  }\n\n  getLengthUnitEnum(lengthUnit: MeasureLengthUnit){\n    return MeasureLengthUnitAbbreviation[lengthUnit];\n  }\n\n  get allAreaUnits(): string[]{\n    return Object.values(MeasureAreaUnit);\n  }\n\n  get allCoordinatesUnits(): string[]{\n    return Object.values(CoordinatesUnit);\n  }\n\n  getAreaUnitEnum(areaUnit: MeasureAreaUnit){\n    return MeasureAreaUnitAbbreviation[areaUnit];\n  }\n\n  private getRadius(olGeometry): number{\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n\n  get lengthLabelT(){\n    if (this.olGeometryType === GeometryType.Polygon){\n      return this.languageService.translate.instant('igo.geo.measure.perimeter');\n    }\n    if (this.olGeometryType === GeometryType.Circle){\n      return this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n    }\n    return this.languageService.translate.instant('igo.geo.draw.labelType.Length');\n  }\n\n  getLabelLength(event?){\n    this.labelLength = event.length;\n  }\n\n  selectOptions(option){\n    if (this.olGeometryType === GeometryType.Point){\n      return option === LabelType.Coordinates;\n    }\n    else if (this.olGeometryType === GeometryType.LineString){\n      return option === LabelType.Length;\n    }\n  }\n\n  getProperLengthLabel(option){\n    if (option === LabelType.Length){\n      if (this.olGeometryType === GeometryType.Polygon){\n        return this.languageService.translate.instant('igo.geo.measure.perimeter');\n      }\n      if (this.olGeometryType === GeometryType.Circle){\n        return this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      }\n      return this.languageService.translate.instant('igo.geo.draw.labelType.Length');\n    }\n    return this.languageService.translate.instant('igo.geo.draw.labelType.' + option);\n  }\n\n\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\n\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon>{{'igo.geo.draw.finish' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon>{{'igo.geo.draw.undo' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon>{{'igo.geo.draw.abort' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon>{{'igo.geo.draw.move' | translate}}</span>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>","import { Injectable } from '@angular/core';\n\nimport * as OlStyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport { ProjectionLike, transform } from 'ol/proj';\nimport { FontType } from '../shared/font.enum';\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawStyleService {\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n  private fontSize: string = '15';\n  private fontStyle: string = FontType.Arial.toString();\n  private offsetX: number = 0;\n  private offsetY: number = 0;\n\n  constructor() {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  // To edit the label of drawing\n  getFontSize() {\n    return this.fontSize;\n  }\n\n  setFontSize(fontSize: string) {\n    this.fontSize = fontSize;\n  }\n\n  getFontStyle() {\n    return this.fontStyle;\n  }\n\n  setFontStyle(fontStyle: string) {\n    this.fontStyle = fontStyle;\n  }\n\n  getOffsetX(): number {\n    return this.offsetX;\n  }\n\n  setOffsetX(offsetX: number) {\n    this.offsetX = offsetX;\n  }\n\n  getOffsetY(): number {\n    return this.offsetY;\n  }\n\n  setOffsetY(offsetY: number) {\n    this.offsetY = offsetY;\n  }\n\n  createIndividualElementStyle(\n    feature,\n    resolution,\n    labelsAreShown: boolean,\n    fontSizeAndStyle: string,\n    fillColor: string,\n    strokeColor: string,\n    offsetX: number,\n    offsetY: number,\n    proj: ProjectionLike,\n    icon?: string\n  ): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(feature.getGeometry().flatCoordinates, proj, 'EPSG:4326');\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        image: new OlStyle.Circle({\n          radius: feature.get('rad') / Math.cos((Math.PI / 180) * coordinates[1]) / resolution,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n\n      // if feature is an icon\n    } else if (icon) {\n      this.offsetY = -26;\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n      // if feature is a point, a linestring or a polygon\n    } else {\n      this.offsetY = labelsAreOffset ? -15 : 0;\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","<div mat-dialog-content>\n  <h2 mat-dialog-title class=\"mat-typography\">{{ 'igo.geo.style.styleModal' | translate }}</h2>\n  <div\n  class=\"edition-drawing mat-typography\"\n  [hidden]=\"data.features.length === 0\">\n    <form\n      class=\"igo-form\"\n      [formGroup]=\"form\">\n      <div class=\"fill-color-picker mat-typography\" *ngIf=\"linestringOnly !== true\">\n        <span>\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n          {{ 'igo.geo.style.fill' | translate }}\n        </span>\n\n        <mat-form-field\n          class=\"fill-field\"\n          appearance=\"outline\"\n          floatLabel=\"always\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.style.colorPicker' | translate\">\n          <mat-label>{{ getFeatureFillColor() }}</mat-label>\n          <input\n            #fillColorInput\n            formControlName=\"fill\"\n            matInput\n            type=\"text\"\n            [style.background]=\"getFeatureFillColor()\"\n            [readonly]=\"true\"\n            [colorPicker]=\"getFeatureFillColor()\"\n            [cpWidth]=\"'200px'\"\n            [cpOutputFormat]=\"'rgba'\"\n            [cpPosition]=\"'bottom'\"\n            [cpPositionOffset]=\"'-75%'\"\n            [cpCancelButton]=\"true\"\n            [cpCancelButtonText]=\"'igo.geo.style.cancel' | translate\"\n            [cpOKButton]=\"true\"\n            (colorPickerChange)=\"styleModalData.fillColor = $event\">\n        </mat-form-field>\n      </div>\n\n      <div class=\"stroke-color-picker mat-typography\">\n        <span>\n          <mat-icon\n            class=\"stroke-palette-icon\"\n            svgIcon=\"square-outline\">\n          </mat-icon>\n          {{'igo.geo.style.stroke' | translate}}\n        </span>\n\n        <mat-form-field\n          class=\"stroke-field\"\n          appearance=\"outline\"\n          floatLabel=\"always\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.style.colorPicker' | translate\">\n          <mat-label>{{ getFeatureStrokeColor() }}</mat-label>\n          <input\n            #strokeColorInput\n            formControlName=\"stroke\"\n            matInput\n            type=\"text\"\n            [style.background]=\"getFeatureStrokeColor()\"\n            [readonly]=\"true\"\n            [colorPicker]=\"getFeatureStrokeColor()\"\n            [cpWidth]=\"'200px'\"\n            [cpPosition]=\"'bottom'\"\n            [cpPositionOffset]=\"'-75%'\"\n            [cpOutputFormat]=\"'rgba'\"\n            [cpCancelButton]=\"true\"\n            [cpCancelButtonText]=\"'igo.geo.style.cancel' | translate\"\n            [cpOKButton]=\"true\"\n            (colorPickerChange)=\"styleModalData.strokeColor = $event\">\n        </mat-form-field>\n      </div>\n\n      <div class=\"igo-input-container\">\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.style.fontSize' | translate }}</mat-label>\n          <input\n            matInput\n            #testFontSize\n            type=\"number\"\n            placeholder=\"10\"\n            min=\"10\"\n            onkeydown=\"return event.keyCode !== 69\"\n            [value]=\"getFeatureFontSize()\"\n            (input)=\"styleModalData.fontSize = $event.target.value\">\n          <span matSuffix>px</span>\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.style.fontStyle' | translate }}</mat-label>\n          <mat-select\n            #testFontStyle\n            [value]=\"getFeatureFontStyle()\"\n            (selectionChange)=\"styleModalData.fontStyle = $event.value\">\n            <mat-option\n              *ngFor=\"let fontSelect of allFontStyles\"\n              [value]=\"fontSelect\">\n              {{ fontSelect }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n\n      <div class=\"igo-input-container\">\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.style.offsetX' | translate }}</mat-label>\n          <input\n            matInput\n            #offsetXInput\n            type=\"number\"\n            onkeydown=\"return event.keyCode !== 69\"\n            [value]=\"getFeatureOffsetX()\"\n            (input)=\"styleModalData.offsetX = $event.target.value\">\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.style.offsetY' | translate }}</mat-label>\n          <input\n            matInput\n            #offsetYInput\n            type=\"number\"\n            onkeydown=\"return event.keyCode !== 69\"\n            [value]=\"getFeatureOffsetY()\"\n            (input)=\"styleModalData.offsetY= $event.target.value\">\n        </mat-form-field>\n      </div>\n    </form>\n  </div>\n</div>\n<div mat-dialog-actions>\n  <button \n    mat-raised-button \n    (click)=\"cancelDrawing()\">{{'igo.geo.style.cancel' | translate}}\n  </button>\n  <button \n    mat-raised-button \n    color=\"primary\" \n    (click)=\"confirm()\">OK\n  </button>\n</div>\n","import { Component, Inject, Input, OnInit } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\n\nimport { DrawStyleService } from '../../style-service/draw-style.service';\nimport { FontType } from '../../shared/font.enum';\nimport { DrawingMatDialogData, StyleModalData } from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-drawing',\n  templateUrl: './style-modal-drawing.component.html',\n  styleUrls: ['./style-modal-drawing.component.scss']\n})\nexport class StyleModalDrawingComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalDrawingComponent>,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    @Inject(MAT_DIALOG_DATA) public data: DrawingMatDialogData) {\n      this.buildForm();\n    }\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.features) {\n      if (feature.geometry.type !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.fill\n        : 'rgba(255,255,255,0.4)',\n      strokeColor:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.stroke\n        : 'rgba(143,7,7,1)',\n      fontSize:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle\n            .split(' ')[0]\n            .replace('px', '')\n        : '20',\n      fontStyle:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle.substring(\n            this.data.features[0].properties.fontStyle.indexOf(' ') + 1)\n        : FontType.Arial,\n      offsetX:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.offsetX\n        : this.drawStyleService.getOffsetX(),\n      offsetY:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.offsetY\n        : this.drawStyleService.getOffsetY()\n    };\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  getFeatureFontSize(): string {\n    if (!this.styleModalData.fontSize) {\n      return this.data.features.length > 0\n      ? this.data.features[0].properties.fontStyle\n          .split(' ')[0]\n          .replace('px', '')\n      : '20';\n    } else {\n      return this.styleModalData.fontSize;\n    }\n  }\n\n  getFeatureFontStyle() {\n    if (!this.styleModalData.fontStyle) {\n      return this.data.features.length > 0\n      ? this.data.features[0].properties.fontStyle.substring(\n        this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n        )\n      : FontType.Arial;\n    } else {\n      return this.styleModalData.fontStyle;\n    }\n  }\n\n  getFeatureFillColor() {\n    if (!this.styleModalData.fillColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.fill\n        : 'rgba(255,255,255,0.4)';\n    } else {\n      return this.styleModalData.fillColor;\n    }\n  }\n\n  getFeatureStrokeColor() {\n    if (!this.styleModalData.strokeColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.stroke\n        : 'rgba(143,7,7,1)';\n    } else {\n      return this.styleModalData.strokeColor;\n    }\n  }\n\n  getFeatureOffsetX() {\n    if (!this.styleModalData.offsetX) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetX\n        : this.drawStyleService.getOffsetX();\n    } else {\n      return this.styleModalData.offsetX;\n    }\n  }\n\n  getFeatureOffsetY() {\n    if (!this.styleModalData.offsetY) {\n      return this.data.features.length > 0\n      ? this.data.features[0].properties.offsetY\n      : this.drawStyleService.getOffsetY();\n    } else {\n      return this.styleModalData.offsetY;\n    }\n  }\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    this.dialogRef.close(this.styleModalData);\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-layer-popup.component.html',\n  styleUrls: ['./draw-layer-popup.component.scss']\n})\nexport class DrawLayerPopupComponent {\n  @Input() confirmFlag: boolean = false;\n\n  constructor(\n    public dialogRef: MatDialogRef<DrawLayerPopupComponent>,\n    // @Inject(MAT_DIALOG_DATA) public data: { currentLabel: string }\n  ) {}\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n  confirm(labelString: string) {\n    this.confirmFlag = true;\n    this.dialogRef.close(labelString);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{ 'igo.geo.draw.layer.layerDialogInstruction' | translate }}\n  </p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{ 'igo.geo.draw.layer.title' | translate }}\"\n      />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.draw.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n    OK\n  </button>\n</div>\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawIconService {\n\n    protected icons: Array<string>;\n\n    constructor(\n      protected config: ConfigService\n    ) {\n        this.getIconsList();\n    }\n\n    getIcons() {\n        return this.icons;\n    }\n\n    getPath(): any {\n      return this.config.getConfig('drawingTool.icons') || [];\n    }\n\n    getIconsList() {\n      this.icons = this.getPath();\n    }\n}\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\" [value]=\"geometryType.Point\">\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{'igo.geo.draw.' + geometryType.Point | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{'igo.geo.draw.' + geometryType.LineString | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{'igo.geo.draw.' + geometryType.Polygon | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{'igo.geo.draw.' + geometryType.Circle | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\">\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"!isPoint()\"\n      [checked]=\"freehandMode\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleFreehandMode($event)\">\n      {{ 'igo.geo.draw.freehandMode' | translate }}\n    </mat-slide-toggle>\n\n    <div class=\"radius-unit\" *ngIf=\"isCircle()\">\n      <form class=\"radius-form\">\n        <mat-form-field class=\"radius\">\n          <input\n            matInput type=\"number\"\n            min=\"0\"\n            placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n            [formControl]=\"radiusFormControl\"\n            [readonly]=\"this.freehandMode\">\n        </mat-form-field>\n      </form>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\">\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n  <mat-divider></mat-divider>\n\n  <div>\n    <mat-form-field appearance=\"outline\" class=\"layer-select\">\n      <mat-label>{{'igo.geo.draw.layer.title' | translate}}</mat-label>\n      <mat-select #selectedLayer (selectionChange)=\"onLayerChange(selectedLayer.value)\" [value]=\"updateActiveLayer()\">\n        <mat-option *ngFor=\"let layer of allLayers\" [value]=\"layer\">\n          {{ layer.title }}\n        </mat-option>\n        <mat-option id=\"createNewLayer\" >\n          {{'igo.geo.draw.layer.createNewLayer' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <button\n      *ngIf=\"activeDrawingLayer\"\n      mat-icon-button\n      [color]=\"activeDrawingLayer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"activeDrawingLayer.visible ?\n                    ('igo.geo.layer.hideLayer' | translate) :\n                    ('igo.geo.layer.showLayer' | translate)\"\n      (click)=\"activeDrawingLayer.visible = !activeDrawingLayer.visible\">\n      <mat-icon\n        [svgIcon]=\"activeDrawingLayer.visible ? 'eye' : 'eye-off'\">\n      </mat-icon>\n    </button>\n  </div>\n  <mat-divider></mat-divider>\n  <div>\n    <button\n      *ngIf=\"activeStore.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <div>\n      <igo-entity-table\n        #table\n        class=\"table-compact\"\n        [store]=\"activeStore\"\n        [template]=\"tableTemplate\">\n      </igo-entity-table>\n    </div>\n  </div>\n\n  <div class=\"icon-options\">\n    <mat-form-field *ngIf=\"icons.length >= 1\">\n      <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\n      <mat-select>\n        <mat-select-trigger>\n          <div *ngIf=\"icon\" class=\"box\">\n            <img src=\"{{ icon }}\">\n          </div>\n        </mat-select-trigger>\n        <mat-option value=\"\" (click)=\"onIconChange()\">{{ 'igo.geo.draw.noIcon' | translate }}</mat-option>\n        <mat-option\n          *ngFor=\"let icon_html of icons\"\n          [value]=\"icon_html\"\n          (click)=\"onIconChange(icon_html)\">\n          <div class=\"box\">\n            <img src=\"{{ icon_html }}\">\n          </div>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <button\n    mat-icon-button\n    color=\"accent\"\n    disableRipple=\"true\"\n    (click)=\"openShorcutsDialog()\"\n  >\n    <mat-icon\n      class=\"shortcuts-icon\"\n      svgIcon=\"keyboard-outline\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\"\n    >\n    </mat-icon>\n  </button>\n\n  <button\n    *ngIf=\"selectedFeatures$.value.length\"\n    mat-raised-button\n    color=\"primary\"\n    (click)=\"openStyleModalDialog()\"\n    [matTooltip]=\"'igo.geo.style.styleModalTooltipSelected' | translate\">\n    {{'igo.geo.style.styleModal' | translate}}\n    <mat-icon\n      class=\"style-icon\"\n      svgIcon=\"palette\"\n      [matBadge]=\"selectedFeatures$.value.length\"\n      matBadgeColor=\"warn\"\n      matBadgeSize=\"medium\">\n    </mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  FeatureMotion,\n  FeatureStoreLoadingStrategy,\n  featureToOl\n} from '../../feature';\n\nimport { LanguageService } from '@igo2/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { FontType } from '../../style/shared/font.enum';\nimport { IgoMap } from '../../map/shared/map';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { UntypedFormGroup, UntypedFormBuilder, UntypedFormControl } from '@angular/forms';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport {\n  EntityRecord,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common';\n\nimport * as OlStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlOverlay from 'ol/Overlay';\nimport type { Type } from 'ol/geom/Geometry';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getDistance, getLength } from 'ol/sphere';\nimport { DrawStyleService } from '../../style/style-service/draw-style.service';\nimport { first, skip } from 'rxjs/operators';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport { createInteractionStyle, DDtoDMS } from '../shared/draw.utils';\nimport { transform } from 'ol/proj';\nimport { DrawIconService } from '../shared/draw-icon.service';\nimport { StyleModalDrawingComponent } from '../../style/style-modal/drawing/style-modal-drawing.component';\nimport { StyleModalData } from '../../style/style-modal/shared/style-modal.interface';\n\nimport {\n  trigger,\n  state,\n  style,\n  animate,\n  transition\n} from '@angular/animations';\n\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\n\nimport {\n  measureOlGeometryLength,\n  measureOlGeometryArea,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\n\nimport {\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation,\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n} from '../../measure/shared/measure.enum';\nimport Polygon, { fromCircle } from 'ol/geom/Polygon';\n\n\n@Component({\n  selector: 'igo-draw',\n  animations: [\n    trigger('openClose', [\n      state(\n        'open',\n        style({\n          opacity: 1\n        })\n      ),\n      state(\n        'closed',\n        style({\n          opacity: 0\n        })\n      ),\n      transition('open => closed', [animate('600ms ease')]),\n      transition('closed => open', [animate('800ms ease')])\n    ])\n  ],\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    fixedHeader: true,\n    tableHeight: 'auto',\n    columns: [\n      {\n        name: 'Drawing',\n        title: this.languageService.translate.instant('igo.geo.draw.labels'),\n        valueAccessor: (feature: FeatureWithDraw) => {\n          return feature.properties.draw;\n        }\n      },\n      {\n        name: 'Edition',\n        title: '',\n        sort: false,\n        valueAccessor: (feature: FeatureWithDraw) => {\n          return [{\n            editMode: false,\n            icon: 'pencil',\n            color: 'primary',\n            click: () => { this.editLabelDrawing(feature);},\n            style: 'mat-icon-button'\n          }] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup,\n      }\n    ]\n  };\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input()\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this._stores;\n  }\n  set stores(value: FeatureStore<FeatureWithDraw>[]) {\n    this._stores = value;\n  }\n  private _stores:FeatureStore<FeatureWithDraw>[] = [];\n\n  @Input()\n  get drawControls(): [string, DrawControl][]{\n    return this._drawControls;\n  }\n  set drawControls(value: [string, DrawControl][]){\n    this._drawControls = value;\n  }\n  private _drawControls = [];\n\n  @Input()\n  get activeDrawingLayer(): VectorLayer {\n    return this._activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this._activeDrawingLayer = value;\n  }\n  private _activeDrawingLayer: VectorLayer;\n\n  @Output() activeLayerChange = new EventEmitter<VectorLayer>();\n  @Output() drawControlsEvent = new EventEmitter<[string, DrawControl][]>();\n  @Output() layersIDEvent = new EventEmitter<string>();\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Output() fontSize: string;\n  @Output() fontStyle: string;\n\n  public activeStore: FeatureStore<FeatureWithDraw>;\n  private layerCounterID: number = 0;\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n  private activeDrawingLayerSource = new OlVectorSource();\n  private activeDrawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\n    new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  public freehandMode = false;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: UntypedFormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  public radiusFormControl = new UntypedFormControl(1000);\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public radiusFormControlChange$$: Subscription = new Subscription();\n  public predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n  public radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n  private numberOfDrawings: number;\n  public isCreatingNewLayer: boolean = false;\n  private currGeometryType = this.geometryType.Point as any;\n\n  @ViewChild('selectedLayer') select;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n\n  ) {\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n\n    this.fontSize = this.drawStyleService.getFontSize();\n    this.fontStyle = this.drawStyleService.getFontStyle();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    if (!this.stores.length) {\n      this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n        map: this.map\n      });\n      this.initStore();\n      this.activeDrawControl = this.createDrawControl(\n        this.fillColor,\n        this.strokeColor,\n        this.strokeWidth\n      );\n      this.activeDrawControl.setGeometryType(this.geometryType.Point as any);\n      this.toggleDrawControl();\n      this.stores.push(this.activeStore);\n      this.drawControls.push([this.activeDrawingLayer.id, this.activeDrawControl]);\n      this.drawControlsEvent.emit(this.drawControls);\n      this.layersIDEvent.emit(this.activeDrawingLayer.id);\n      this.onLayerChange(this.activeDrawingLayer);\n    } else {\n      this.activeStore = this.stores.find(store => store.layer.id === this.activeDrawingLayer.id);\n      this.activeDrawControl = this.drawControls.find(dc => dc[0] === this.activeDrawingLayer.id)[1];\n      this.deactivateDrawControl();\n      this.allLayers.forEach(layer => {\n        if (layer.id !== this.activeDrawingLayer.id) {\n          layer.opacity = 0;\n        }\n        let store = this.stores.find(s => s.layer.id === layer.id);\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(\n              first()\n            )\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              records.forEach((record) => {\n                record.state.selected = false;\n              });\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(\n              skip(1) // Skip initial emission\n            )\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              this.selectedFeatures$.next(records.map((record) => record.entity));\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.count$.subscribe((cnt) => {\n            cnt >= 1\n              ? (this.activeStore.layer.options.showInLayerList = true)\n              : (this.activeStore.layer.options.showInLayerList = false);\n          })\n        );\n      });\n      this.onLayerChange(this.activeDrawingLayer);\n    }\n\n    this.radiusFormControlChange$$ = this.radiusFormControl.valueChanges.subscribe(value => {\n      if (this.activeDrawControl.ispredefinedRadius$.getValue()) {\n        this.changeRadius(value);\n      }\n    });\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.allLayers.forEach(layer => layer.opacity = 1);\n    this.activeStore.state.updateAll({selected: false});\n    this.deactivateDrawControl();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n    this.radiusFormControlChange$$.unsubscribe();\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const activeDrawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.activeDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n    return activeDrawControl;\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n\n  private initStore(newTitle?: string, isNewLayer?: boolean) {\n    this.createLayer(newTitle, isNewLayer);\n    this.subscriptions$$.push(\n      this.activeStore.stateView\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          skip(1) // Skip initial emission\n        )\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n          this.selectedFeatures$.next(records.map((record) => record.entity));\n        })\n    );\n\n    this.subscriptions$$.push(\n      this.activeStore.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.activeStore.layer.options.showInLayerList = true)\n          : (this.activeStore.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n/**\n * Open the style modal dialog box\n */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const dialogRef = this.dialog.open(StyleModalDrawingComponent, {\n        disableClose: false,\n        data: {\n          features: this.selectedFeatures$.getValue(),\n          icons: this.icons,\n          icon: this.icon\n        },\n        autoFocus: false\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((data: StyleModalData) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.onFontChange(this.labelsAreShown, data.fontSize, data.fontStyle);\n          this.onColorChange(this.labelsAreShown, this.icon ? true : false, data.fillColor, data.strokeColor);\n          this.onOffsetLabelChange(this.labelsAreShown, data.offsetX, data.offsetY);\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDrawDialog(olGeometry, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: {olGeometry: olGeometry, map: this.map}\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((result) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n\n          this.updateLabelOfOlGeometry(olGeometry, result.label);\n          this.updateLabelType(olGeometry, dialogRef.componentInstance.labelFlag);\n          this.updateMeasureUnit(olGeometry, result.measureUnit);\n\n          if (!(olGeometry instanceof OlFeature)){\n            this.updateFontSizeAndStyle(olGeometry, '15', FontType.Arial);\n            this.updateFillAndStrokeColor(\n              olGeometry,\n              'rgba(255,255,255,0.4)',\n              'rgba(143,7,7,1)'\n            );\n            this.updateOffset(\n              olGeometry,\n              0,\n              (olGeometry instanceof OlPoint) ? -15 : 0\n            );\n          }\n\n          isDrawEnd ? this.onDrawEnd(olGeometry): this.onSelectDraw(olGeometry, result.label,\n            [dialogRef.componentInstance.labelFlag, result.measureUnit]);\n          this.updateHeightTable();\n        }\n        // deletes the feature\n        else {\n          this.activeDrawingLayerSource\n            .getFeatures()\n            .forEach((drawingLayerFeature) => {\n              const geometry = drawingLayerFeature.getGeometry() as any;\n              if (olGeometry === geometry) {\n                this.activeDrawingLayerSource.removeFeature(\n                  drawingLayerFeature\n                );\n              }\n            });\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.activeStore.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.activeStore.all();\n\n    entities.forEach((entity) => {\n      const entityId = entity.properties.id;\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        if (entity.properties.labelType === LabelType.Coordinates){\n          let longLat = DDtoDMS([entity.properties.longitude, entity.properties.latitude],\n            entity.properties.measureUnit as CoordinatesUnit);\n          this.updateLabelOfOlGeometry(olGeometry, '(' + longLat[1] + ', ' + longLat[0] + ')');\n        }\n        else if (entity.properties.labelType === LabelType.Length){\n          if (olGeometry instanceof OlCircle){\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            const radius = metersToUnit(this.getRadius(circularPolygon), entity.properties.measureUnit as MeasureLengthUnit);\n            const unit = MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            const radiusLabel = 'R: ' + radius.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, radiusLabel);\n          }\n          else {\n            let olGeometryLength = measureOlGeometryLength(olGeometry, this.map.ol.getView().getProjection().getCode());\n            let measureUnit: any;\n            const temp: MeasureLengthUnit = entity.properties.measureUnit as MeasureLengthUnit;\n            measureUnit = MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryLength = metersToUnit(olGeometryLength, temp);\n            let lengthLabel = olGeometry instanceof Polygon ?\n              'P: ' + olGeometryLength.toFixed(2).toString() + ' ' + measureUnit\n              : olGeometryLength.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        }\n        else if (entity.properties.labelType === LabelType.Area){\n          if (olGeometry instanceof OlCircle){\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            let circleArea = measureOlGeometryArea(circularPolygon, this.map.ol.getView().getProjection().getCode());\n            const unit = MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            const temp: MeasureAreaUnit = entity.properties.measureUnit as MeasureAreaUnit;\n            circleArea = squareMetersToUnit(circleArea, temp);\n            const areaLabel = circleArea.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, areaLabel);\n          }\n          else {\n            let olGeometryArea = measureOlGeometryArea(olGeometry, this.map.ol.getView().getProjection().getCode());\n            let measureUnit: any;\n            const temp: MeasureAreaUnit = entity.properties.measureUnit as MeasureAreaUnit;\n            measureUnit = MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryArea = squareMetersToUnit(olGeometryArea, temp);\n            const lengthLabel = olGeometryArea.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        }\n        else {\n          this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        }\n\n        this.updateLabelType(\n          olGeometry,\n          entity.properties.labelType\n        );\n        this.updateMeasureUnit(olGeometry, entity.properties.measureUnit);\n        this.updateFontSizeAndStyle(\n          olGeometry,\n          entity.properties.fontStyle.split(' ')[0].replace('px', ''),\n          entity.properties.fontStyle.substring(\n            entity.properties.fontStyle.indexOf(' ') + 1\n          )\n        );\n        this.updateFillAndStrokeColor(\n          olGeometry,\n          entity.properties.drawingStyle.fill,\n          entity.properties.drawingStyle.stroke\n        );\n        this.updateOffset(\n          olGeometry,\n          entity.properties.offsetX,\n          entity.properties.offsetY\n        );\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(olFeature: OlFeature<OlGeometry>, label: string, labelTypeAndUnit?) {\n    const entities = this.activeStore.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(\n      olGeometry.getCoordinates()[0]\n    );\n\n    entities.forEach((entity) => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n      if (olGeometryCoordinates === entityCoordinates) {\n        const fontSize = olFeature\n          .get('fontStyle')\n          .split(' ')[0]\n          .replace('px', '');\n        const fontStyle = olFeature\n          .get('fontStyle')\n          .substring(olFeature.get('fontStyle').indexOf(' ') + 1);\n\n        const fillColor = olFeature.get('drawingStyle').fill;\n        const strokeColor = olFeature.get('drawingStyle').stroke;\n\n        const offsetX = olFeature.get('offsetX');\n        const offsetY = olFeature.get('offsetY');\n\n        const rad: number = entity.properties.rad\n          ? entity.properties.rad\n          : undefined;\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.updateFontSizeAndStyle(olGeometry, fontSize, fontStyle);\n        this.updateFillAndStrokeColor(olGeometry, fillColor, strokeColor);\n        this.updateOffset(olGeometry, offsetX, offsetY);\n        this.updateLabelType(olGeometry, labelTypeAndUnit[0]);\n        this.updateMeasureUnit(olGeometry, labelTypeAndUnit[1]);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(\n    olGeometry,\n    radius?: number,\n    feature?: FeatureWithDraw,\n  ) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[2],\n            olGeometry.getFlatCoordinates()[3]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        center4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[0],\n            olGeometry.getFlatCoordinates()[1]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n        this.radiusFormControl.setValue(Math.round(rad));\n      }\n\n    }\n    if (this.activeDrawControl.radiusDrawEnd$.getValue()) {\n      rad = this.activeDrawControl.radiusDrawEnd$.getValue();\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(\n        olGeometry.getFlatCoordinates(),\n        projection,\n        'EPSG:4326'\n      );\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.activeStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null,\n        fontStyle: olGeometry.get('fontStyle_'),\n        drawingStyle: {\n          fill: olGeometry.get('fillColor_'),\n          stroke: olGeometry.get('strokeColor_')\n        },\n        offsetX: olGeometry.get('offsetX_'),\n        offsetY: olGeometry.get('offsetY_'),\n        labelType: olGeometry.get('labelType_'),\n        measureUnit: olGeometry.get('measureUnit_')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n    this.activeStore.setLayerExtent();\n    this.activeDrawControl.predefinedRadius$.next(undefined);\n    this.activeDrawControl.radiusDrawEnd$.next(undefined);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  public setupLayer(isNewLayer?: boolean) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(DrawLayerPopupComponent, {\n        disableClose: false,\n      });\n      dialogRef.afterClosed().subscribe((label: string) => {\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.activeStore.state.updateAll({selected: false});\n          this.activeStore = new FeatureStore<FeatureWithDraw>([], { map: this.map });\n          this.activeDrawingLayerSource = new OlVectorSource();\n          this.activeDrawingLayer.opacity = 0;\n          this.deactivateDrawControl();\n          this.initStore(label, isNewLayer);\n          this.activeDrawControl = this.createDrawControl(\n            this.fillColor,\n            this.strokeColor,\n            this.strokeWidth\n          );\n          this.activeDrawControl.setGeometryType(this.currGeometryType);\n          this.toggleDrawControl();\n          this.stores.push(this.activeStore);\n          this.drawControls.push([this.activeDrawingLayer.id, this.activeDrawControl]);\n          this.drawControlsEvent.emit(this.drawControls);\n          this.layersIDEvent.emit(this.activeDrawingLayer.id);\n          this.isCreatingNewLayer = false;\n          if (!this.labelsAreShown){\n            this.onToggleLabels();\n          }\n          this.activeLayerChange.emit(this.activeDrawingLayer);\n        } else {\n          this.select.value = this.activeDrawingLayer;\n          this.select.selectionChange.emit(this.activeDrawingLayer);\n        }\n      });\n    }, 250);\n  }\n\n  // HTML user interactions\n\n  /**\n   * Called when the user double-clicks the selected drawing\n   */\n  editLabelDrawing(feature) {\n    const olGeometryFeature = featureToOl(\n      feature,\n      this.map.ol.getView().getProjection().getCode()\n    );\n    this.openDrawDialog(olGeometryFeature, false);\n\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n\n  deleteDrawings() {\n    this.activeStore.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.activeDrawingLayerSource\n        .getFeatures()\n        .forEach((drawingLayerFeature) => {\n          const geometry = drawingLayerFeature.getGeometry() as any;\n          if (selectedFeature.properties.id === geometry.ol_uid) {\n            this.activeDrawingLayerSource.removeFeature(drawingLayerFeature);\n          }\n        });\n    });\n    this.updateHeightTable();\n    this.activeStore.setLayerExtent();\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon\n      ? this.elementStyle(\n          this.labelsAreShown,\n          true\n        )\n      : this.elementStyle(\n          this.labelsAreShown,\n          false\n        );\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  onToggleFreehandMode(event: any) {\n    if (this.isCircle() && !event.checked) {\n      this.activeDrawControl.ispredefinedRadius$.next(true);\n      this.changeRadius(this.radiusFormControl.value);\n    } else {\n      this.activeDrawControl.setOlInteractionStyle(createInteractionStyle(this.fillColor, this.strokeColor, this.strokeWidth));\n      this.activeDrawControl.ispredefinedRadius$.next(false);\n    }\n    this.freehandMode = event.checked;\n    this.activeDrawControl.freehand$.next(event.checked);\n    this.toggleDrawControl();\n  }\n\n  // User changes properties of a drawing element\n\n  /**\n   * Display the current layer with the current store and the current layerSource\n   */\n\n  public onLayerChange(currLayer?: VectorLayer) {\n    if (currLayer) {\n      this.activeStore.state.updateAll({selected: false});\n      this.isCreatingNewLayer = false;\n      this.activeDrawingLayer.opacity = 0;\n      this.activeDrawingLayer = currLayer;\n      this.activeDrawingLayer.opacity = 1;\n      this.deactivateDrawControl();\n      if (!this.labelsAreShown){\n        this.onToggleLabels();\n      }\n      this.activeStore = this.stores.find(store => store.layer.id === this.activeDrawingLayer.id);\n      this.activeDrawControl = this.drawControls.find(dc => dc[0] === this.activeDrawingLayer.id)[1];\n      this.activeDrawingLayerSource = this.activeDrawControl.olDrawingLayerSource;\n      this.activeDrawControl.setGeometryType(this.currGeometryType);\n      this.toggleDrawControl();\n    } else {\n      this.setupLayer(true);\n    }\n    this.activeLayerChange.emit(this.activeDrawingLayer);\n  }\n\n  public createLayer(newTitle?, isNewLayer?) {\n    for (const layer of this.allLayers){\n      let numberId = Number(layer.id.replace('igo-draw-layer',''));\n      this.layerCounterID = Math.max(numberId,this.layerCounterID);\n    }\n    this.activeDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer' + ++this.layerCounterID,\n      title: isNewLayer\n        ? newTitle\n        : this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          this.labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n\n    tryBindStoreLayer(this.activeStore, this.activeDrawingLayer);\n\n    tryAddLoadingStrategy(\n      this.activeStore,\n      new FeatureStoreLoadingStrategy({\n        motion: FeatureMotion.None\n      })\n    );\n\n    tryAddSelectionStrategy(\n      this.activeStore,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.None,\n        many: true\n      })\n    );\n    this.activeStore.layer.visible = true;\n    this.activeStore.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent<OlGeometry>) => {\n        const olGeometry = event.feature.getGeometry();\n        this.clearLabelsOfOlGeometry(olGeometry);\n      }\n    );\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   * @param fillColor which is the filling color\n   * @param strokeColor which is the stroke color\n   */\n  onColorChange(\n    labelsAreShown: boolean,\n    isAnIcon: boolean,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    if (this.selectedFeatures$.value.length > 0 && !isAnIcon) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFillAndStrokeColor(olFeature, fillColor, strokeColor);\n\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.drawingStyle.fill = olFeature.get('fillColor_');\n        entity.properties.drawingStyle.stroke = olFeature.get('strokeColor_');\n        this.activeStore.update(entity);\n      });\n    }\n\n    this.elementStyle(labelsAreShown, isAnIcon);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user changes the font size or/and style\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param size the size of the font\n   * @param style the style of the font\n   */\n\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFontSizeAndStyle(olFeature, size, style);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.fontStyle = olFeature.get('fontStyle_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol.getSource().getFeatures().find(f => f.getId() === entity.meta.id);\n        olFeature.setProperties({ fontStyle: entity.properties.fontStyle });\n        olFeature.changed();\n      });\n\n      this.fontSize = size;\n      this.fontStyle = style;\n\n      this.drawStyleService.setFontSize(size);\n      this.drawStyleService.setFontStyle(style);\n\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  /**\n   * Called when the user changes the value of the horizontal/vertical offset\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param offsetX horizontal offset of the label\n   * @param offsetY vertical offset of the label\n   */\n\n  onOffsetLabelChange(\n    labelsAreShown: boolean,\n    offsetX: number,\n    offsetY: number\n  ) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateOffset(olFeature, offsetX, offsetY);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.offsetX = olFeature.get('offsetX_');\n        entity.properties.offsetY = olFeature.get('offsetY_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol.getSource().getFeatures().find(f => f.getId() === entity.meta.id);\n        olFeature.setProperties({ offsetX: entity.properties.offsetX, offsetY: entity.properties.offsetY });\n        olFeature.changed();\n      });\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.elementStyle(true, this.icon);\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: Type) {\n    this.currGeometryType = geometryType;\n    this.activeDrawControl.setGeometryType(geometryType);\n    this.freehandMode ?\n      this.onToggleFreehandMode({ checked: true }) :\n      this.onToggleFreehandMode({ checked: false });\n    this.toggleDrawControl();\n  }\n\n  // Updates the properties of olFeature inputted\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param OlFeature the feature\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(OlFeature, label: string) {\n    OlFeature.setProperties(\n      {\n        _label: label\n      },\n      true\n    );\n  }\n\n  private updateFontSizeAndStyle(\n    olFeature: OlFeature<OlGeometry>,\n    fontSize: string,\n    fontStyle: string\n  ) {\n    olFeature.setProperties(\n      {\n        fontStyle_: `${fontSize}px ${fontStyle}`\n      },\n      true\n    );\n  }\n\n  private updateFillAndStrokeColor(\n    olFeature: OlFeature<OlGeometry>,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    olFeature.setProperties(\n      {\n        fillColor_: fillColor,\n        strokeColor_: strokeColor\n      },\n      true\n    );\n  }\n\n  private updateOffset(\n    olFeature: OlFeature<OlGeometry>,\n    offsetX: number,\n    offsetY: number\n  ) {\n    olFeature.setProperties(\n      {\n        offsetX_: offsetX,\n        offsetY_: offsetY\n      },\n      true\n    );\n  }\n\n  private updateLabelType(\n    olFeature: OlFeature<OlGeometry>,\n    typeOfLabel: LabelType | [LabelType, LabelType]\n  ){\n    olFeature.setProperties(\n      {\n        labelType_:typeOfLabel\n      },\n      true\n    );\n  }\n\n  private updateMeasureUnit(\n    olFeature: OlFeature<OlGeometry>,\n    measureUnit: MeasureLengthUnit | MeasureAreaUnit | CoordinatesUnit | []\n  ){\n    olFeature.setProperties(\n      {\n        measureUnit_: measureUnit\n      },\n      true\n    );\n\n  }\n\n  // Updates values of the selected element on the HTML view\n\n  getFeatureFontSize(): string {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle\n          .split(' ')[0]\n          .replace('px', '')\n      : '15';\n  }\n\n  getFeatureFontStyle() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle.substring(\n          this.selectedFeatures$.value[0].properties.fontStyle.indexOf(' ') + 1\n        )\n      : FontType.Arial;\n  }\n\n  getFeatureFillColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.fill\n      : 'rgba(255,255,255,0.4)';\n  }\n\n  getFeatureStrokeColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.stroke\n      : 'rgba(143,7,7,1)';\n  }\n\n  getFeatureOffsetX() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetX\n      : this.drawStyleService.getOffsetX();\n  }\n\n  getFeatureOffsetY() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetY\n      : '0';\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-draw-layer')\n    );\n  }\n\n  updateHeightTable() {\n    // Check the amount of rows as a possible alternative\n    this.numberOfDrawings = this.activeStore.count$.getValue();\n    this.numberOfDrawings > 10\n      ? (this.tableTemplate.tableHeight = '35vh')\n      : (this.tableTemplate.tableHeight = 'auto');\n  }\n\n  updateActiveLayer() {\n    let currLayer = this.allLayers.find(layer => layer.title === this.activeDrawingLayer.title);\n    return currLayer ? currLayer : this.allLayers[0];\n  }\n\n  // Helper methods\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(\n    entity,\n    olGeometry: OlGeometry,\n    radius?: number\n  ) {\n    this.activeStore.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.activeDrawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.activeDrawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.activeDrawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.openDrawDialog(olGeometry, true);\n      }\n    );\n\n    this.activeDrawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.activeDrawControl.select$.subscribe(\n        (olFeature: OlFeature<OlGeometry>) => {\n          this.openDrawDialog(olFeature, false);\n        }\n      );\n    }\n    this.activeDrawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * get the geometry of design\n   *\n   */\n\n  isPoint() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Point;\n  }\n\n  isLineString() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.LineString;\n  }\n\n  isPolygon() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Polygon;\n  }\n\n  isCircle() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Circle;\n  }\n\n  /**\n   * The fonction to predefine the radius of the user\n   *\n   */\n\n  changeRadius(radius: number) {\n    let radiusMeters: number;\n\n    if (radius) {\n      this.measureUnit === MeasureLengthUnit.Meters ? radiusMeters = radius :\n        radiusMeters = radius * 1000;\n    } else {\n      radiusMeters = undefined;\n    }\n\n    const pointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n      const geom = feature.getGeometry() as OlPoint;\n      const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n\n      const radius = radiusMeters / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution;\n      this.activeDrawControl.predefinedRadius$.next(radiusMeters);\n      return new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: radius,\n          stroke: new OlStyle.Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new OlStyle.Fill({\n            color: 'rgba(255,255,255,0.4)'\n          })\n        })\n      });\n    };\n\n    this.activeDrawControl.setOlInteractionStyle(pointStyle);\n    this.toggleDrawControl();\n  }\n\n  onMeasureUnitChange(selectedMeasureUnit: MeasureLengthUnit) {\n    if (selectedMeasureUnit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = selectedMeasureUnit;\n      this.measureUnit === MeasureLengthUnit.Meters ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n        this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n    }\n  }\n\n  /**\n   * Recreates the style of the feature stored\n   */\n  private elementStyle(labelsAreShown: boolean, isAnIcon?) {\n    if (isAnIcon) {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      });\n    } else {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection\n        );\n      });\n    }\n  }\n\n  private getRadius(olGeometry): number{\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\nimport { DrawComponent } from './draw.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\n\nimport { BrowserModule } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n\nimport {MatRadioModule} from '@angular/material/radio';\n\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatListModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDialogModule,\n    IgoLanguageModule,\n    IgoEntityTableModule,\n    ColorPickerModule,\n    BrowserModule,\n    BrowserAnimationsModule,\n    MatRadioModule,\n    MatCheckboxModule\n  ],\n  declarations: [DrawComponent, DrawPopupComponent, DrawLayerPopupComponent, DrawShorcutsComponent],\n  exports: [DrawComponent]\n})\nexport class IgoDrawModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoKeyValueModule,\n    IgoImageModule\n  ],\n  exports: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective],\n  declarations: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective]\n})\nexport class IgoFeatureDetailsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { FeatureFormComponent } from './feature-form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormModule\n  ],\n  exports: [\n    IgoFormModule,\n    FeatureFormComponent\n  ],\n  declarations: [\n    FeatureFormComponent\n  ]\n})\nexport class IgoFeatureFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoFeatureDetailsModule,\n    IgoFeatureFormModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoFeatureModule {}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlModify from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport OlDraw from 'ol/interaction/Draw';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLineString from 'ol/geom/LineString';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport BasicEvent from 'ol/events/Event';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        this.changes$.next(olGeometryEvent.target as OlLineString | OlCircle | OlPolygon);\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = ((olGeometry as any).getLinearRing() as any).getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n        const _linearRingCoordinates = olGeometryTarget\n          .getLinearRing(0)\n          .getCoordinates();\n        this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n        this.changes$.next(this.getOlGeometry());\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = ((event.feature\n      .getGeometry() as any)\n      .getLinearRing() as any)\n      .getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","export const LAYER = 'Layer';\n","<h3 mat-dialog-title>{{'igo.geo.measure.dialog.title' | translate}}</h3>\n\n<table *ngIf=\"data.length > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\n    </tr>\n  </tbody>\n</table>\n\n<table *ngIf=\"data.area > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\n      <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\n    </tr>\n  </tbody>\n</table>\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\n\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss']\n})\nexport class MeasurerDialogComponent {\n\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\">\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{('igo.geo.measure.' + measureType.Length) | translate}}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{('igo.geo.measure.' + measureType.Area) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.measure.toggleActive' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasLine$ | async)\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayLines' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayDistance' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayAreas' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\">\n      {{'igo.geo.measure.toggleAutoUnits' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Length || activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"measureLengthUnit.Meters\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"(activeMeasureType === measureType.Area ? 'igo.geo.measure.perimeter' : 'igo.geo.measure.length') | translate\"\n      (measureUnitChange)=\"onLengthUnitChange($event)\">\n    </igo-measurer-item>\n\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($event)\">\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\">\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\n    </button>\n\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <!--button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\n      (click)=\"onModifyClick()\">\n      <mat-icon svgIcon=\"edit\"></mat-icon>\n    </button-->\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport OlStyle from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlOverlay from 'ol/Overlay';\nimport { unByKey } from 'ol/Observable';\n\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\nimport type { EntityTableComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from '../../datasource';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n} from '../shared/measure.enum';\nimport {\n  measureOlGeometry,\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  updateOlTooltipsAtMidpoints,\n  updateOlTooltipAtCenter,\n  getTooltipsOfOlGeometry,\n  squareMetersToUnit,\n  metersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [\n      {\n        name: 'length',\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeLengthUnit;\n          const measure = metersToUnit(localFeature.properties.measure.length, unit);\n          return formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          });\n        }\n      },\n      {\n        name: 'area',\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeAreaUnit;\n          const measure = squareMetersToUnit(localFeature.properties.measure.area, unit);\n          return measure ? formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          }) : '';\n        }\n      }\n    ]\n  };\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n   public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n   onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle ? (this.storageService.set('distanceToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('distanceToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle ? (this.storageService.set('linesToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('linesToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle ? (this.storageService.set('areasToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('areasToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle(){\n    if (this.storageService.get('distanceToggle') === false){\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false){\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false){\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    if (this.displayDistance) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    if (this.displayLines) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    if (this.displayAreas) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      return sum + localFeature.properties.measure.area || 0;\n    }, 0);\n    const length = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'Polygon') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n    const perimeter = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'LineString') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) { return; }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as (OlLineString | OlPolygon));\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, {data});\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant('igo.geo.measure.layerTitle'),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe(visible => {\n      if (visible) {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-measure-by-display'));\n      }\n      else {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-measure-by-display'));\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      many: true\n    }));\n\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const localFeature = event.feature;\n      const olGeometry = localFeature.getGeometry() as any;\n      this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n      this.onDisplayDistance();\n    });\n\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry() as any;\n      this.clearTooltipsOfOlGeometry(olGeometry);\n    });\n\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    )\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n      if (this.modifyControl.active === true) {\n        this.deactivateModifyControl();\n      }\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    });\n\n    this.subscriptions$$.push(this.store.entities$.subscribe(objectsExists => {\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'Polygon')){\n        this.hasArea$.next(true);\n      } else {\n        this.hasArea$.next(false);\n      }\n\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'LineString')){\n        this.hasLine$.next(true);\n      } else {\n        this.hasLine$.next(false);\n      }\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ?\n        this.store.layer.options.showInLayerList = true :\n        this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\n    this.drawEnd$$ = drawControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\n    this.drawChanges$$ = drawControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\n    this.drawChanges$$ = drawControl.abort$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      });\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\n      area: undefined // We don't want to display an area tooltip while drawing.\n    }));\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\n    this.modifyEnd$$ = this.modifyControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\n    this.modifyChanges$$ = this.modifyControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\n    olGeometry.setProperties({_measure: measure}, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature ? localFeature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (this.shouldShowTooltip(olTooltip)) {\n        this.map.ol.addOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(properties._measure, {\n      decimal: 1,\n      unit: properties._unit,\n      unitAbbr: true,\n      locale: 'fr'\n    }, this.languageService);\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat'\n})\nexport class MeasureFormatPipe implements PipeTransform {\n\n  /**\n   * @ignore\n   */\n  transform(\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out ? formatMeasure(out, {\n      decimal: 1,\n      unit,\n      unitAbbr,\n      locale: 'fr'\n    }) : out;\n  }\n}\n","import { DrawControlOptions } from './../shared/controls/draw';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  Optional,\n  Self,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\n\nimport { Subscription } from 'rxjs';\n\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlOverlay from 'ol/Overlay';\nimport * as olproj from 'ol/proj';\nimport Point from 'ol/geom/Point';\n\nimport { IgoMap } from '../../map';\nimport {\n  MeasureLengthUnit,\n  updateOlGeometryMidpoints,\n  formatMeasure,\n  measureOlGeometry\n} from '../../measure';\nimport { DrawControl, ModifyControl, ModifyControlOptions } from '../shared/controls';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\n\ninterface HasRadius {\n  getRadius: () => number\n  setRadius: (radius: number) => void\n}\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\n\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: Type) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): Type { return this._geometryType; }\n  private _geometryType: Type;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get predefinedRadius(): boolean { return this._predefinedRadius; }\n  set predefinedRadius(value: boolean) {\n    this._predefinedRadius = value;\n    this.drawControl.ispredefinedRadius$.next(value);\n  }\n  private _predefinedRadius: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyleLike | OlStyle.RegularShape) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value);\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyleLike | OlStyle.RegularShape { return this._drawStyle; }\n  private _drawStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyleLike | OlStyle.RegularShape) { this._overlayStyle = value; }\n  get overlayStyle(): OlStyleLike | OlStyle.RegularShape { return this._overlayStyle; }\n  private _overlayStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry { return this._value; }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$\n        .subscribe((olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) => this.onOlGeometryChanges(olGeometry));\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: [\n        'igo-map-tooltip',\n        'igo-map-tooltip-measure'\n      ].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(olStyle: OlStyleLike | OlStyle.RegularShape, resolution: number) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle);\n    if (olGuideStyle === undefined) {\n      return;\n    }\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(olStyle: OlStyleLike | OlStyle.RegularShape): HasRadius | undefined {\n    let baseStyle: unknown;\n    if (Array.isArray(olStyle)) {\n      baseStyle = olStyle[0];\n    } else {\n      baseStyle = olStyle;\n    }\n\n    if (typeof (baseStyle as any).getImage === 'function') {\n      baseStyle = (baseStyle as any).getImage() as OlStyle.Image;\n    }\n\n    let guideStyle: HasRadius;\n    if (typeof (baseStyle as any).setRadius === 'function') {\n      guideStyle = baseStyle as HasRadius;\n    }\n\n    return guideStyle;\n  }\n}\n","<ng-template></ng-template>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ],\n  declarations: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ]\n})\nexport class IgoGeometryFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoGeometryFormFieldModule\n  ],\n  exports: [\n    IgoGeometryFormFieldModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoGeometryModule {}\n","<button *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"history\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"header && options.timeFilterable && options.timeFilter\">\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\">\n  </igo-time-filter-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterButtonComponent implements OnInit {\n\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !=='year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle class=\"time-filter-mat-datetimepicker-toggle\" [for]=\"datetimePicker\" matSuffix></mat-datetimepicker-toggle>\n      <mat-datetimepicker #datetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n      <input matInput autocomplete=\"false\"\n        placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\">\n    </mat-form-field>\n\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle class=\"time-filter-mat-datetimepicker-toggle\" [for]=\"minDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #minDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"startDate\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle class=\"time-filter-mat-datetimepicker-toggle\" [for]=\"maxDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #maxDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type ==='year'\">\n\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\" [(ngModel)]=\"year\" (selectionChange)=\"handleYearChange($event)\">\n                  <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{year}}</mat-option>\n            </mat-select>\n        </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\" [(ngModel)]=\"startYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"startYear\" *ngFor=\"let startYear of startListYears\">{{startYear}}</mat-option>\n            </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n    <mat-form-field>\n        <mat-select placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\" [(ngModel)]=\"endYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{endYear}}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n</div>\n\n\n  <br>\n  <div *ngIf=\"!isRange && style === 'slider' && type === 'year'\" class=\"igo-col igo-col-100 igo-col-100-m mat-typography\">\n    <span>{{startYear}}</span>\n    <mat-slider\n        id=\"time-slider\"\n        tickInterval=\"auto\"\n        step=\"{{step}}\"\n        [min]=\"startYear\"\n        [max]=\"endYear\"\n        [value]=\"handleSliderValue()\"\n        [color]=\"color\"\n        thumbLabel\n        (input)=\"handleSliderYearChange($event)\"\n        (change)=\"handleSliderYearChange($event)\"\n        [disabled]= \"!options.enabled || !layer.visible\">\n    </mat-slider>\n    <span>{{endYear}}</span>\n    <p *ngIf= \"options.enabled\" class=\"date-below\">{{year}}</p>\n    <div #actions class=\"igo-layer-actions-container\">\n      <mat-slide-toggle (change)=\"toggleFilterState()\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" [color]=\"color\" [checked]=\"options.enabled\"\n        [disabled]=\"!layer.visible\">\n      </mat-slide-toggle>\n      <button [disabled]= \"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"playYear($event)\">\n        <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n       </button>\n      <button [disabled]=\"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n    </div>\n  </div>\n\n<div *ngIf=\"style === 'slider' && type !== 'year'\" class=\"igo-col igo-col-100 igo-col-100-m\">\n  <mat-slider\n      id=\"time-slider\"\n      tickInterval=\"auto\"\n      step=\"{{step}}\"\n      [min]=\"dateToNumber(min)\"\n      [max]=\"dateToNumber(max)\"\n      [value]=\"handleSliderValue()\"\n      thumbLabel\n      (input)=\"handleSliderDateChange($event)\"\n      (selectionChange)=\"handleSliderDateChange($event)\">\n  </mat-slider>\n  <p class=\"date-below\">{{handleSliderTooltip()}}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n   <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  OnInit,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\nimport { DateAdapter } from '@angular/material/core';\nimport { MatSlider } from '@angular/material/slider';\nimport { default as moment } from 'moment';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss']\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach(value => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(() => {\n        if (\n          (this.year + this.mySlider.step) > this.max.getFullYear()) {\n          this.stopFilter();\n        } else {\n          this.year = this.year + this.mySlider.step;\n        }\n        this.yearChange.emit(this.year);\n\n      }, this.timeInterval, this);\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\" >\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\"  matLine>{{layer.title}}</h4>\n  \n  <button *ngIf=\"header\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"layer.visible = !layer.visible\">\n    <mat-icon\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]= \"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\">\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'time'\">\n    <igo-time-filter-item [header]=\"true\" igoListItem [layer]=\"layer\"></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olproj from 'ol/proj';\nimport olWKT from 'ol/format/WKT';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach(element => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach(element => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [\n        coord.ul[0] + unitPerTypeEW,\n        coord.ul[1] - unitPerTypeSN\n      ];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","<mat-checkbox\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n  (click)=\"$event.stopPropagation()\"\n  (change)=\"toggleFilterState($event)\"\n  [checked]=\"currentFilter.active\">\n</mat-checkbox>\n\n<mat-form-field\n  [ngClass]=\"{'logical': activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true, 'logicalHidden': activeFilters.indexOf(currentFilter) === 0 || currentFilter.active!==true}\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.parentLogical\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.parentLogical ? (('igo.geo.operators.tooltip.'+ currentFilter.parentLogical) | translate) : ''\"\n    (selectionChange)=\"changeLogical($event.value)\">\n      <mat-option\n        [value]=ogcFilterOperator.And\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\">\n          {{'igo.geo.operators.And' | translate}}\n      </mat-option>\n      <mat-option\n        [value]=ogcFilterOperator.Or\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\">\n          {{'igo.geo.operators.Or' | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\n  class=\"field\"\n  *ngIf=\"(currentFilterIsSpatial$ | async)===false && (fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''\"\n  (mouseenter)=\"inputClearable = 'selectField'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n  <input\n  matInput\n  [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n  [disabled]=\"!currentFilter.active\"\n  [matAutocomplete]=\"autoCompleteField\"\n  [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ('igo.geo.sourceFields.selectField' | translate)\"\n  (input)=\"updateFieldsList($event.target.value)\">\n  <mat-autocomplete #autoCompleteField=\"matAutocomplete\"\n  (optionSelected)='changeField($event.option.id)'>\n    <mat-option\n      *ngFor=\"let field of filteredFields$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"field.alias\"\n      [id]=\"field.name\"\n      [matTooltip]=\"field.alias\">\n      {{field.alias}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"currentFilter.propertyName && inputClearable === 'selectField' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearSelectedField()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n\n<mat-form-field\n  [ngClass]=\"{'operator': (currentFilterIsSpatial$ | async)===false , 'dualInput': (currentFilterIsSpatial$ | async)}\"\n  [floatLabel]=\"floatLabel\">\n  <mat-select\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.operator ? (('igo.geo.operators.tooltip.'+ currentFilter.operator) | translate) : ('igo.geo.filter.selectOperator' | translate)\"\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.operator\"\n    (selectionChange)=\"changeOperator($event.value)\">\n      <mat-option\n        *ngFor=\"let operator of (ogcFilterOperators$ | async) | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"('igo.geo.operators.tooltip.'+ operator.key) | translate\">\n          {{('igo.geo.operators.'+ operator.key) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"spatialSelector\"\n*ngIf=\"currentFilterIsSpatial$ | async\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.igoSpatialSelector\"\n    (selectionChange)=\"changeSpatialSelector($event.value)\">\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\">\n          {{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"singleInput\"\n*ngIf=\"['expression','pattern'].indexOf(detectProperty()) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n    [disabled]=\"!currentFilter.active\"\n    [matAutocomplete]=\"autoCompleteValues\"\n    [value]=\"detectProperty() === 'expression' ? currentFilter.expression : currentFilter.pattern\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"detectProperty() === 'expression' ? currentFilter.expression || '' : currentFilter.pattern || ''\"\n    (input)=\"updateValuesList($event.target.value)\">\n  <mat-autocomplete #autoCompleteValues=\"matAutocomplete\"\n    (optionSelected)=\"changeProperty($event.option.value)\">\n    <mat-option\n      *ngFor=\"let value of filteredValues$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"value\"\n      [matTooltip]=\"value\">\n      {{value}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"isClearable() && inputClearable === 'selectProperty' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearProperty()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"igo-layer-button-group\">\n  <button\n    mat-icon-button\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n    color=\"warn\"\n    (click)=\"deleteFilter()\">\n    <mat-icon svgIcon=\"delete\"></mat-icon>\n  </button>\n</div>\n\n<mat-form-field\nclass=\"snrc\"\n*ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'snrc'\"\n(mouseenter)=\"inputClearable = 'selectSNRC'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n    [value]=\"currentFilter.igoSNRC\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n    (input)=\"changeSNRC($event.target.value)\">\n  <button\n    mat-button\n    *ngIf=\"currentFilter.igoSNRC\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active && inputClearable === 'selectSNRC' && currentFilter.active\"\n    (click)=\"currentFilter.igoSNRC=''\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n  </mat-form-field>\n\n  <ng-container *ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'fixedExtent'\">\n    <button\n    mat-button\n    [disabled]=\"!currentFilter.active\"\n    *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n    matSuffix\n    mat-icon-button\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"changeMapExtentGeometry()\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\">\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n  </button>\n</ng-container>\n\n<br/>\n\n<mat-form-field\nclass=\"dualInput\"\n*ngIf=\"!isTemporalOperator() && ['lowerBoundary','begin'].indexOf(detectProperty(1)) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty1'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"detectProperty(1) === 'lowerBoundary' ? currentFilter.lowerBoundary : currentFilter.begin\"\n      (input)=\"updateValuesList($event.target.value,1)\">\n    <mat-autocomplete #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,1)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(1) && inputClearable === 'selectProperty1' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<mat-form-field\n  class=\"dualInput\"\n  *ngIf=\"!isTemporalOperator() && ['upperBoundary','end'].indexOf(detectProperty(2)) !== -1\"\n  (mouseenter)=\"inputClearable = 'selectProperty2'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"detectProperty(2) === 'upperBoundary' ? currentFilter.upperBoundary : currentFilter.end\"\n      (input)=\"updateValuesList($event.target.value,2)\">\n    <mat-autocomplete #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,2)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(2) && inputClearable === 'selectProperty2' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<igo-ogc-filter-time *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n</igo-ogc-filter-time>\n\n<!--\nTODO C'EST PERTINENT je crois\n<mat-form-field class=\"field\" *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$| async) && (fields$| async).length === 1 &&  (fields$| async)[0].name === ''\">\n<input [disabled]=\"!currentFilter.active\" matInput #fieldPerUser (keyup)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\"\n  (blur)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\" [(ngModel)]=\"currentFilter.propertyName\">\n<button mat-button *ngIf=\"currentFilter.propertyName\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"currentFilter.propertyName=''\">\n  <mat-icon svgIcon=\"close\"></mat-icon>\n</button>\n</mat-form-field>\n\n\n\n<mat-checkbox labelPosition='before' (change)=\"changeCaseSensitive($event)\" [(ngModel)]=\"currentFilter.matchCase\">\n  {{('igo.geo.operators.caseSensitive') | translate}}\n</mat-checkbox>\n\n</mat-list-item> -->\n","import { Component, Input, OnInit } from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss']\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n\n    if ( this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n        ? of(this.selectedField$.value.values)\n        : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.selectedField$.value.values.filter((val) =>\n      val && keywordRegex.test(\n        val\n          .toString()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\">\n</igo-ogc-filter-selection>\n\n<ng-template \n*ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\nngFor let-currentFilter \n[ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\">\n<igo-ogc-filter-form\n  [currentFilter]=\"currentFilter\"\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\">\n</igo-ogc-filter-form>\n</ng-template>","import { Component, Input } from '@angular/core';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html'\n})\nexport class OgcFilterableFormComponent {\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters ?\n    this.datasource.options.ogcFilters.interfaceOgcFilters[0] : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<div [ngClass]=\"{'separate-item' : header === true}\" >\n  <mat-list-item>\n    <mat-icon\n      *ngIf=\"header\"\n      class=\"igo-chevron\"\n      mat-list-avatar\n      igoCollapse [target]=\"ogcFilters\"\n      [collapsed]=\"filtersCollapsed\"\n      (click)=\"toggleFiltersCollapsed()\"\n      svgIcon=\"chevron-up\">\n    </mat-icon>\n    <h4 (click)=\"toggleLegendOnClick()\" *ngIf=\"header\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\" matLine [matTooltip]=\"layer.title\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n      <button *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\" [disabled]=\"addFilterDisabled()\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.addFilter' | translate\" [color]=\"color\" (click)=\"addFilterToSequence()\">\n        <mat-icon svgIcon=\"plus\"></mat-icon>\n      </button>\n      <button *ngIf=\"header\"\n        mat-icon-button\n        [color]=\"layer.visible ? 'primary' : 'default'\"\n        collapsibleButton\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"layer.visible ?\n                      ('igo.geo.layer.hideLayer' | translate) :\n                      ('igo.geo.layer.showLayer' | translate)\"\n        (click)=\"layer.visible = !layer.visible\">\n        <mat-icon\n          [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n          [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n        </mat-icon>\n      </button>\n  </mat-list-item>\n\n  <div #ogcFilters>\n      <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n        <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n        </igo-layer-legend>\n      </div>\n    <igo-ogc-filterable-form [datasource]=\"datasource\" [map]=\"map\" [refreshFilters]=\"refreshFunc\">\n    </igo-ogc-filterable-form>\n\n    <section *ngIf=\"hasSelector && filtersAreEditable\" class=\"mat-typography advancedOgcFilters\">\n      <mat-divider></mat-divider>\n      <mat-checkbox labelPosition='before' (change)=\"changeOgcFilterType($event)\"\n        [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\">\n        {{'igo.geo.filter.advancedOgcFilters' | translate}}\n      </mat-checkbox>\n    </section>\n  </div>\n</div>","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { IgoMap } from '../../map';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss']\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    if (this.layer.visible) {\n      this.filtersCollapsed = false;\n    }\n\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\n      .options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType);\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection,\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters ?\n      ogcFilters.interfaceOgcFilters.filter(f => f.active === true) : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n          activeFilters\n        );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","\n<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <div  id=\"no-layer-message\" *ngIf=\"(layers | filterableDataSource : 'ogc').length === 0\">{{'igo.geo.filter.noFilterableLayer' | translate}}</div>\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item igoListItem [header]=\"true\" [layer]=\"layer\" \n    [map]=\"layer.map\" ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  styleUrls: ['./ogc-filterable-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterableListComponent {\n\n  @Input() layers: Layer[];\n\n  @Input() map: IgoMap;\n\n  constructor() {}\n}\n","<button\n  *ngIf=\"header && options.ogcFilters && options.ogcFilters.enabled &&\n  (options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.autocomplete\n    || options.ogcFilters.editable)\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"filter\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"options.ogcFilters && options.ogcFilters.enabled &&\n(options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.autocomplete\n  || options.ogcFilters.editable)\">\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\">\n  </igo-ogc-filterable-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { OgcFilterableDataSourceOptions, IgoOgcSelector } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterButtonComponent implements OnInit {\n\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors?.map(cb => cntPushButtons += (cb.selectors as any)?.filter(\n            button => button.enabled).length);\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find(gr => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors?.map(cb => cntCheckboxes += (cb.selectors as any)?.filter(\n            checkbox => checkbox.enabled).length);\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(gr => gr.enabled);\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors?.map(cb => cntRadioButtons += (cb.selectors as any)?.filter(\n            radio => radio.enabled).length);\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find(gr => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors?.map(cb => cntSelect += (cb.selectors as any)?.filter(\n            multi => multi.enabled).length);\n        }\n        cnt += cntSelect;\n      }\n      if (filter.autocomplete) {\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\n        const currentAutocompleteGroup = autocomplete.groups.find(gr => gr.enabled);\n        let cntAutocomplete = 0;\n        if (currentAutocompleteGroup) {\n          currentAutocompleteGroup.computedSelectors?.map(cb => cntAutocomplete += (cb.selectors as any)?.filter(\n            autocomplete => autocomplete.enabled).length);\n        }\n        cnt += cntAutocomplete;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (filter.filters && filter.filters.operator === 'During' && filter.filters.active &&\n      filter.interfaceOgcFilters && filter.interfaceOgcFilters[0].active) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if ((filterActiveValue.begin.substring(0,4) !== this.options.minDate.substring(0,4) ) ||\n        (filterActiveValue.end.substring(0,4) !== this.options.maxDate.substring(0,4) )) {\n          cnt += 1;\n        }\n      } else if ((filterActiveValue.begin !== this.options.minDate) || (filterActiveValue.end !== this.options.maxDate)) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { default as moment } from 'moment';\n\nimport {\n    OgcFilterableDataSource\n  } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n\n    readonly defaultStepMillisecond = 60000;\n\n    constructor() {}\n\n    step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n    }\n\n    stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n        const step = moment.duration(this.step(dataSource, currentFilter)).asMilliseconds();\n        return step === 0 ? this.defaultStepMillisecond : step;\n    }\n\n    stepIsYearDuration(step: string) {\n        const year = moment.duration(step);\n        return (\n            year.years() !== 0 &&\n            year.months() === 0 &&\n            year.weeks() === 0 &&\n            year.days() === 0 &&\n            year.hours() === 0 &&\n            year.minutes() === 0\n        );\n    }\n\n    stepIsMonthDuration(step: string) {\n        const month = moment.duration(step);\n        return (\n            month.months() !== 0 &&\n            month.weeks() === 0 &&\n            month.days() === 0 &&\n            month.hours() === 0 &&\n            month.minutes() === 0\n        );\n    }\n\n    stepIsWeekDuration(step: string) {\n        const week = moment.duration(step);\n        return (\n            week.weeks() !== 0 &&\n            week.days() === 7 &&\n            week.hours() === 0 &&\n            week.minutes() === 0\n        );\n    }\n\n    stepIsDayDuration(step: string) {\n        const day = moment.duration(step);\n        return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n    }\n\n    stepIsHourDuration(step: string) {\n        const hour = moment.duration(step);\n        return hour.hours() !== 0 && hour.minutes() === 0;\n    }\n\n    stepIsMinuteDuration(step: string) {\n        const minute = moment.duration(step);\n        return minute.minutes() !== 0;\n    }\n\n    dateToNumber(date: Date): number {\n        let newDate = new Date();\n        if (date) {\n          newDate = new Date(date);\n        }\n        return newDate.getTime();\n    }\n\n    public addStep(value, stepMillisecond) {\n        return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n    }\n\n    public subtractStep(value, stepMillisecond) {\n        return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n    }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div class=\"pushButtonGroups\" *ngIf=\"selector.selectorType === 'pushButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\" class=\"mat-typography\" appearance=\"legacy\" vertical={{bundleIsVertical(bundle)}} multiple=\"true\">\n          <mat-button-toggle *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\" matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\" (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\">{{ogcPushButton.title}}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\" (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\">{{ogcCheckbox.title}}\n          </mat-checkbox>\n        </div>\n        <p *ngIf=\"isLessResults(bundle, 'checkbox') || isMoreResults(bundle, 'checkbox')\">\n          <u *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div class=\"radioButtonGroups\" *ngIf=\"selector.selectorType === 'radioButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-radio-group\n          formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\">{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\" (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\">{{ogcRadioButton.title}}\n          </mat-radio-button>\n          <p *ngIf=\"isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\">\n            <u *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field [style.width.%]=\"bundle.width ? bundle.width : undefined\">\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection [multiple]=\"bundle.multiple\" [placeholder]=\"bundle.title\" formControlName=\"selectMulti\">\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"selectAllSelected\" [ngModelOptions]=\"{standalone: true}\"\n                    (change)=\"toggleAllSelection()\">Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"selectOptionClick($event.source.value, bundle, $event)\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select\n                [placeholder]=\"bundle.title\" formControlName=\"select\">\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\" (onSelectionChange)=\"selectOptionClick($event.source.value, bundle)\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n\n    <div class=\"autocompleteGroups\" *ngIf=\"selector.selectorType === 'autocomplete'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"autocompleteGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentAutocompleteGroup\">\n            <mat-option *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\n              [value]=\"autocompleteGroup\">{{autocompleteGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptyAutocomplete()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field *ngIf=\"filteredOgcAutocomplete[bundle.id]\" [style.width.%]=\"bundle.width ? bundle.width : undefined\">\n            <input matInput type=\"text\" formControlName=\"autocomplete\" #autocomplete class=\"autocomplete\"\n              [matAutocomplete]=\"auto\" [placeholder]=\"bundle.title\">\n              <mat-autocomplete #auto=\"matAutocomplete\" #autocomplete (optionSelected)=\"autocompleteOptionClick($event.option.value)\"\n              [displayWith]=\"displayFn\">\n                <mat-option *ngFor=\"let ogcAutocomplete of filteredOgcAutocomplete[bundle.id] | async\" [value]=\"ogcAutocomplete\">\n                  {{ ogcAutocomplete.value }}\n                </mat-option>\n              </mat-autocomplete>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h4 *ngIf=\"!currentFilter.title\">{{ 'igo.geo.filter.reportingDate' | translate }}</h4>\n  <h4 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h4>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n  </igo-ogc-filter-time>\n</div>","import {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { DOMService, DOMValue } from '@igo2/common';\n\nimport {\n  OgcFilterableDataSource,\n  IgoOgcFilterObject,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { IgoMap } from '../../map';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { UntypedFormBuilder, UntypedFormGroup, Validators } from '@angular/forms';\nimport { debounceTime, map } from 'rxjs/operators';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { MatSelect } from '@angular/material/select';\nimport { MatOption } from '@angular/material/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss'],\n  providers: [ DOMService ]\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: UntypedFormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public selectAllSelected = false;\n  public selectEnabled$ = new BehaviorSubject(undefined);\n  public selectEnableds$ = new BehaviorSubject([]);\n  public autocompleteEnabled$ = new BehaviorSubject(undefined);\n  public filteredOgcAutocomplete = {};\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get currentAutocompleteGroup() {\n    return this.form.get('autocompleteGroup').value;\n  }\n  set currentAutocompleteGroup(value) {\n    this.form.patchValue({ autocompleteGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get selectEnabled() {\n    return this.selectEnabled$.value;\n  }\n\n  set selectEnabled(value) {\n    this.selectEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value === selector ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get selectEnableds() {\n    return this.selectEnableds$.value;\n  }\n\n  set selectEnableds(value) {\n    this.selectEnableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value.includes(selector) ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get autocompleteEnabled() {\n    return this.autocompleteEnabled$.value;\n  }\n\n  set autocompleteEnabled(value) {\n    this.autocompleteEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentAutocompleteGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value === selector.title ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: UntypedFormBuilder,\n    private domService: DOMService,\n    private configService: ConfigService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n      select: ['', [Validators.required]],\n      selectMulti: ['', [Validators.required]],\n      autocompleteGroup: ['', [Validators.required]],\n      autocomplete: ['', [Validators.required]]\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  getAutocompleteGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      return this.datasource.options.ogcFilters.autocomplete.groups;\n    }\n  }\n\n  async ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n        await this.getSelectDomValues();\n      }\n      if (this.datasource.options.ogcFilters.autocomplete) {\n        this.currentAutocompleteGroup =\n          this.datasource.options.ogcFilters.autocomplete.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.autocomplete.groups[0];\n        this.getAutocompleteEnabled();\n        await this.getAutocompleteDomValues();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n    .get('pushButtonsGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onPushButtonsChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n    .get('checkboxesGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onCheckboxesChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('autocompleteGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onAutocompleteChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      if (compSelect.multiple) {\n        compSelect.selectors?.forEach(selector => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.selectEnableds = enableds;\n        this.form.controls['selectMulti'].setValue(enableds);\n      } else {\n        compSelect.selectors?.forEach(selector => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.form.controls['select'].reset(enabled);\n        this.selectEnabled$.subscribe((value) => {\n          if (this.form.controls['select'].value !== value) {\n            this.form.controls['select'].setValue(value);\n          }\n        });\n        this.selectEnabled = enabled;\n      }\n    });\n  }\n\n  private getAutocompleteEnabled() {\n    let enabled;\n    this.currentAutocompleteGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        if (selector.enabled) {\n          const dom = {\n            id: selector.filters.expression,\n            value: selector.title\n          };\n          enabled = selector.title;\n          this.form.controls['autocomplete'].setValue(dom);\n        }\n      });\n      this.autocompleteEnabled = enabled;\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  async getSelectDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (domSelector.id === domOptions.id || domSelector.name === domOptions.name) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url ? domValues = await this.domService.getDom(filterDOM) as DOMValue[] :\n            domValues = filterDOM.values;\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              if (bundle.multiple) {\n                let enabled;\n                this.selectEnableds?.find(sel => sel.title === value.value) ? enabled = true : enabled = false;\n                selector = {\n                  title: value.value,\n                  enabled,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id,\n                  }\n                };\n              } else {\n                selector = {\n                  title: value.value,\n                  enabled: this.selectEnabled?.title === value.value ?\n                    true : false,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id,\n                  }\n                };\n              }\n              newBundle.selectors.push(selector);\n            }\n            this.getSelectGroups().find(group => group.ids.includes(newBundle.id)).computedSelectors\n              .find(comp => comp.title === newBundle.title).selectors = newBundle.selectors;\n          }\n        }\n        this.getSelectEnabled();\n      }\n    }\n  }\n\n  async getAutocompleteDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (domSelector.id === domOptions.id || domSelector.name === domOptions.name) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url ? domValues = await this.domService.getDom(filterDOM) as DOMValue[] :\n            domValues = filterDOM.values;\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              selector = {\n                title: value.value,\n                enabled: this.autocompleteEnabled && this.autocompleteEnabled === value.value ?\n                  true : false,\n                filters: {\n                  operator: domSelector.operator,\n                  propertyName: domSelector.propertyName,\n                  expression: value.id,\n                }\n              };\n              newBundle.selectors.push(selector);\n            }\n            this.getAutocompleteGroups().find(group => group.ids.includes(newBundle.id)).computedSelectors\n              .find(comp => comp.title === newBundle.title).selectors = newBundle.selectors;\n          }\n        }\n\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\n        this.cdRef.detectChanges();\n        this.filteredOgcAutocomplete[bundle.id] = this.form.controls['autocomplete'].valueChanges.pipe(\n          map(value => {\n            if (value.length) {\n              return domValues?.filter((option) => {\n                const filterNormalized = value ? value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') : '';\n                const featureNameNormalized = option.value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n      }\n    }\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map(group => group.enabled = false);\n    this.getPushButtonsGroups().find(group => group === this.currentPushButtonsGroup).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map(group => group.enabled = false);\n    this.getCheckboxesGroups().find(group => group === this.currentCheckboxesGroup).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map(group => group.enabled = false);\n    this.getRadioButtonsGroups().find(group => group === this.currentRadioButtonsGroup).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map(group => group.enabled = false);\n    this.getSelectGroups().find(group => group === this.currentSelectGroup).enabled = true;\n  }\n\n  private onAutocompleteChangeGroup() {\n    this.getAutocompleteGroups().map(group => group.enabled = false);\n    this.getAutocompleteGroups().find(group => group === this.currentAutocompleteGroup).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.map(selector => selector.enabled = false);\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n   });\n  }\n\n  emptySelect() {\n    this.selectEnabled = undefined;\n  }\n\n  emptyAutocomplete() {\n    this.autocompleteEnabled = undefined;\n    this.form.controls['autocomplete'].setValue('');\n    this.form.controls['autocomplete'].markAsUntouched();\n  }\n\n  toggleAllSelection() {\n    if (this.selectAllSelected) {\n      const enableds = [];\n      this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n        compSelect.selectors?.forEach(selector => {\n          enableds.push(selector);\n        });\n      });\n      this.sel.options.forEach((item: MatOption) => item.select());\n      this.selectEnableds = enableds;\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n      this.selectEnableds = [];\n    }\n  }\n\n  selectOptionClick(value, bundle, event?) {\n    if (bundle.multiple) {\n      const enableds = this.selectEnableds;\n      let newStatus = true;\n      this.sel.options.forEach((item: MatOption) => {\n        if (!item.selected) {\n          newStatus = false;\n        }\n      });\n      this.selectAllSelected = newStatus;\n      if (event.isUserInput) {\n        if (enableds.length) {\n          for (const enabled of enableds) {\n            if (enabled.title === value.title) {\n              if (enabled.enabled && value.enabled) {\n                enableds.splice(enableds.indexOf(enabled), 1);\n                this.selectEnableds = enableds;\n                break;\n              }\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\n              enableds.push(value);\n              this.selectEnableds = enableds;\n              break;\n            }\n          }\n        } else {\n          enableds.push(value);\n          this.selectEnableds = enableds;\n        }\n      }\n    } else {\n      this.selectEnabled = value;\n    }\n  }\n\n  autocompleteOptionClick(value) {\n    this.autocompleteEnabled = value.value;\n  }\n\n  displayFn(dom): string {\n    return dom ? dom.value : undefined;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [this.currentPushButtonsGroup, this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup, this.currentSelectGroup, this.currentAutocompleteGroup];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map(selectorBundle => {\n          const bundleCondition = [];\n          selectorBundle.selectors?.filter(ogcSelector => ogcSelector.enabled === true)\n          .forEach(enabledSelector => bundleCondition.push(enabledSelector.filters));\n          if (bundleCondition.length >= 1 ) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({logical: selectorBundle.logical, filters: bundleCondition});\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]);\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter\n        .buildFilter(conditions.length === 1 ?\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio' ? this.radioButtonsIndex += 5 : this.checkboxesIndex += 5;\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio' ? this.radioButtonsIndex = this.baseIndex : this.checkboxesIndex = this.baseIndex;\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        filter => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\">\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.spatialFilter.searchLabel' | translate}}</mat-label>\n      <mat-select (selectionChange)=\"onSelectionChange()\" [(value)]=\"selectedQueryType\">\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{('igo.geo.terrapi.' + queryType) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\">\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\">\n        <mat-button-toggle [value]=\"spatialType.Polygon\" [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\">\n            <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"spatialType.Point\" [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\">\n            <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n\n</mat-tab-group>\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { UntypedFormControl } from '@angular/forms';\nimport { EntityStore } from '@igo2/common';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { Layer } from '../../../layer';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\n  public selectedTypeIndex = new UntypedFormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<form class=\"form-list\">\n    <mat-form-field class=\"zone-list\">\n        <input #input type=\"text\" placeholder=\"{{'igo.geo.spatialFilter.listLabel' | translate}}\" matInput\n        [formControl]=\"formControl\" [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onZoneChange($event.option.value)\"\n        [displayWith]=\"displayFn\">\n            <mat-option *ngFor=\"let entities of this.store.view.all$() | async\" [value]=\"entities\">\n                {{entities.properties.nom}}\n            </mat-option>\n        </mat-autocomplete>\n    </mat-form-field>\n<form>\n\n<div class=\"buffer-div\">\n    <form class=\"buffer-form\">\n        <mat-form-field class=\"buffer\">\n            <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n            [value]=\"0\" [readonly]=\"!zone\">\n        </mat-form-field>\n    </form>\n\n    <mat-form-field class=\"unit-field\">\n        <mat-select\n        [value]=\"measureUnit\"\n        (selectionChange)=\"onMeasureUnitChange($event.value)\">\n        <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n        </mat-option>\n        </mat-select>\n    </mat-form-field>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { EntityStore } from '@igo2/common';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\nimport { SpatialFilterQueryType, SpatialFilterType } from './../../shared/spatial-filter.enum';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { UntypedFormControl } from '@angular/forms';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport { MessageService } from '@igo2/core';\nimport { Layer } from '../../../layer';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new UntypedFormControl();\n\n  public bufferFormControl = new UntypedFormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\n      if (value.length) {\n        this.store.view.filter((feature) => {\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          return featureNameNormalized.includes(filterNormalized);\n        });\n      }\n    });\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500),\n        distinctUntilChanged()\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value * 1000,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n            value < 0 ||\n            (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n            (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.messageService.alert('igo.geo.spatialFilter.bufferAlert', 'igo.geo.spatialFilter.warning');\n        }\n    });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService.loadItemById(feature, this.queryType)\n      .subscribe((featureGeom: Feature) => {\n        this.selectedZone = featureGeom;\n        this.zoneChange.emit(featureGeom);\n      });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n        this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\"\n  [predefinedRadius]=\"predefinedRadius\">\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onDrawControlChange()\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"freehandDrawIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onfreehandControlChange()\">\n      {{'igo.geo.spatialFilter.freehandControl' | translate}}\n    </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <form class=\"buffer-form\">\n    <mat-form-field class=\"buffer\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n      [value]=\"0\" [readonly]=\"this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <form class=\"radius-form\">\n    <mat-form-field class=\"radius\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.radius' | translate}}\" [formControl]=\"radiusFormControl\"\n      [value]=\"1000\" (input)=\"getRadius()\" [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n    <mat-radio-button *ngFor=\"let item of itemType\"\n      [value]=\"item\"\n      (change)=\"onItemTypeChange($event)\">\n      {{'igo.geo.spatialFilter.' + item | translate}}\n    </mat-radio-button>\n</mat-radio-group>\n\n<div class=\"thematics\" *ngIf=\"(selectedItemType==='Thematics' && !tableTemplate) || (selectedItemType==='Thematics' && tableTemplate && !listIsVisible)\">\n  <mat-table>\n      <!-- Name Column -->\n      <ng-container matColumnDef=\"name\">\n        <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{'igo.geo.spatialFilter.Thematics' | translate}}</mat-header-cell>\n      </ng-container>\n\n      <!-- Select Column -->\n      <ng-container matColumnDef=\"select\">\n        <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"isAllSelected()\"\n                        [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns;\"></mat-row>\n\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{node.name}}\n        <mat-checkbox class=\"tree-check\" (click)=\"$event.stopPropagation()\"\n                      (change)=\"$event ? onToggleChange(node) : null\"\n                      [checked]=\"selectedThematics.isSelected(node)\">\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n        <div class=\"mat-tree-node\">\n          <button mat-icon-button\n            (click)=\"onToggleClick(node)\">\n            <mat-icon [svgIcon]=\"treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\"></mat-icon>\n          </button>\n          {{node.name}}\n          <mat-checkbox class=\"tree-check-2\" (change)=\"$event ? childrensToggle(node) : null\"\n                        [checked]=\"isAllSelected(node)\"\n                        [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\">\n          </mat-checkbox>\n        </div>\n        <ul class=\"tree-ul\" [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\">\n          <ng-container matTreeNodeOutlet></ng-container>\n        </ul>\n    </mat-nested-tree-node>\n\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n\n  <button *ngIf=\"isPredefined()\" mat-raised-button class=\"clear-search-button\" [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\">\n      {{'igo.geo.spatialFilter.clearSearch' | translate}}\n  </button>\n\n  <button *ngIf=\"isPolygon() || isPoint()\" mat-raised-button class=\"clear-form-button\" [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\">\n    {{'igo.geo.spatialFilter.clearForm' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"search-button\" [disabled]=\"disableSearchButton()\" color=\"primary\"\n    (click)=\"toggleSearchButton()\">\n    {{'igo.geo.spatialFilter.goSearch' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"remove-button\" [disabled]=\"allLayers.length === 0\" (click)=\"clearButton()\">\n    {{'igo.geo.spatialFilter.removeLayer' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"export-button\" [disabled]=\"!store.entities$.getValue().length\" (click)=\"export.emit()\">\n    {{'igo.geo.spatialFilter.exportLayer' | translate}}\n  </button>\n\n</div>\n\n<button\n  class=\"chevron-down\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n</button>\n\n<div class=\"results\" *ngIf=\"store.all().length && tableTemplate && listIsVisible\">\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\">\n  </igo-entity-table>\n</div>\n","import OlFeature from 'ol/Feature';\nimport {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { IgoMap } from '../../../map';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { UntypedFormControl } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport * as olStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlPoint from 'ol/geom/Point';\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { EntityStore, EntityStoreFilterSelectionStrategy, EntityTableColumnRenderer, EntityTableTemplate } from '@igo2/common';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { FeatureDataSource } from '../../../datasource/shared';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n        return new olStyle.Style ({\n          image: new olStyle.Circle ({\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style ({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle ({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill:  new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n  @Output() predefinedRadius = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new UntypedFormControl();\n  public geometryType: Type | string;\n  public geometryTypeField = false;\n  public geometryTypes: string[] = ['Point', 'Polygon'];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new UntypedFormControl();\n  public bufferFormControl = new UntypedFormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.spatialFilterService.loadThematicsList()\n    .subscribe((items: SpatialFilterThematic[]) => {\n      for (const item of items) {\n        this.childrens.push(item);\n        this.childrens.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      }\n      this.groups.push(this.languageService.translate.instant('igo.geo.terrapi.limites'));\n      const limits: SpatialFilterThematic = {\n        name: this.groups[0],\n        children: []\n      };\n      this.thematics.push(limits);\n      this.childrens.forEach(child => {\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\n          this.groups.push(child.group);\n          const thematic: SpatialFilterThematic = {\n            name: child.group,\n            children: []\n          };\n          this.thematics.push(thematic);\n        }\n\n        if (!child.group) {\n          if (\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.AdmRegion') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Arrond') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircFed') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircProv') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.DirReg') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.RegTour')) {\n              child.group = limits.name;\n          } else if (child.name === this.languageService.translate.instant('igo.geo.terrapi.routes')) {\n            child.group = this.languageService.translate.instant('igo.geo.spatialFilter.group.transport');\n          } else {\n            const thematic: SpatialFilterThematic = {\n              name: child.name,\n              children: [],\n              source: child.source\n            };\n            this.thematics.push(thematic);\n          }\n        }\n        this.thematics.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      });\n      this.thematics.forEach(thematic => {\n        for (const child of this.childrens) {\n          if (child.group === thematic.name) {\n            thematic.children.push(child);\n          }\n        }\n      });\n    });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      if (value) {\n        this.value$.next(value);\n        this.drawZone = this.formControl.value as Feature;\n        if (this.buffer !== 0) {\n          this.drawZoneEvent.emit(this.drawZone);\n          this.bufferFormControl.setValue(this.buffer);\n        }\n      } else {\n        this.value$.next(undefined);\n        this.drawZone = undefined;\n      }\n    });\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500)\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value * 1000\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.buffer = 0;\n            this.messageService.alert('igo.geo.spatialFilter.bufferAlert','igo.geo.spatialFilter.warning');\n        }\n    });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n          this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n          this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach(children => {\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach(child => {\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ?\n      this.selectedThematics.clear() :\n      this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach(children => this.selectedThematics.select(children));\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node) ?\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\n    this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\n      selected = true;\n    }\n\n    this.childrens.forEach(children => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach(thematic => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n    if (this.isPoint()) {\n      this.predefinedRadius.emit(!this.freehandDrawIsActive);\n      if (this.freehandDrawIsActive) {\n        this.overlayStyle$.next(undefined);\n        this.drawStyle$.next(undefined);\n      }\n    } else {\n      this.predefinedRadius.emit(false);\n    }\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(\n      debounceTime(500)\n    ).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\n          return this.loading;\n        }\n      }\n    }\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address ?\n      disable = this.queryType === undefined :\n      disable = this.queryType === undefined && this.selectedThematics.selected.length === 0;\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        formValue = this.formControl.value.radius :\n        formValue = this.formControl.value.radius / 1000;\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && this.radiusFormControl.value >= 100)) {\n          this.messageService.alert('igo.geo.spatialFilter.radiusAlert', 'igo.geo.spatialFilter.warning');\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters ?\n            this.radiusFormControl.setValue(this.radius) :\n            this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert('igo.geo.spatialFilter.radiusAlert', 'igo.geo.spatialFilter.warning');\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.type'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.searchResults'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"datetime-container\">\n  <mat-slide-toggle \n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\">\n    {{'igo.geo.filter.sliderModeTitle' | translate}}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\" \n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n    \n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.startYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearBegin}}\"\n          (change)= \"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]= \"filterStateDisable\"\n          >\n        <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n  \n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n          >\n        </mat-datepicker>\n\n        <input #beginYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.endYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearEnd}}\"\n          (change)= \"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled] = \"filterStateDisable\">\n        <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n          >\n        </mat-datepicker>\n\n        <input #endYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n          [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n      <button class=\"reset-button\" \n        mat-icon-button\n        color=\"primary\" \n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class='toggle-filter-state' \n        (change)=\"toggleFilterState()\" \n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [checked]=\"!filterStateDisable\">\n      </mat-slide-toggle>\n\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType()!=='year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n          <input #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"filterBeginFunction\"\n            [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\" \n            [disabled]= \"filterStateDisable\">\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let minute of beginMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"datetime-input\" *ngIf=\"!restrictedToStep()\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n            <input #end\n              matInput\n              [matDatepicker]=\"endDatepicker\"\n              [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n              [matDatepickerFilter]=\"filterEndFunction\"\n              [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n              [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n              [max]=\"handleDate(datasource.options.maxDate)\" \n              [disabled]= \"filterStateDisable\">\n            <span class=\"filler\"></span>\n            <mat-datepicker #endDatepicker\n              [startView]=\"calendarView()\"\n              [startAt]=\"endValue\"\n              (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n              (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\" >\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <button class=\"reset-button\" \n        mat-icon-button color=\"primary\"\n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class=\"toggle-filter-state\" \n        (change)=\"toggleFilterState()\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        [checked]= \"!filterStateDisable\">\n      </mat-slide-toggle>\n    </div>\n  </div>\n</div>\n","import {\n  Component,\n  Input,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { UntypedFormControl } from '@angular/forms';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFilterableDataSource,\n  OgcFilterDuringOptions\n} from '../shared/ogc-filter.interface';\n\nimport { default as moment } from 'moment';\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss']\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new UntypedFormControl();\n  beginMinuteFormControl = new UntypedFormControl();\n  endHourFormControl = new UntypedFormControl();\n  endMinuteFormControl = new UntypedFormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat ? this.currentFilter.displayFormat : this._defaultDisplayFormat;\n  }\n\n  public filterBeginFunction;\n  public filterEndFunction;\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit(){\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled = this.currentFilter.sliderOptions.enabled !== undefined ?\n        this.currentFilter.sliderOptions.enabled : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n    this.dateFilter(this.filterBeginFunction, 'begin');\n    this.dateFilter(this.filterEndFunction, 'end');\n  }\n\n  parseFilter(filter): Date {\n    if (!filter){\n      return new Date();\n    } else if ( isNaN( new Date(filter).getTime() ) ) {\n      if (filter.search('now') >= 0 ) {\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0){\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if ( filter.match(/\\+/) ) {\n          const intervalInt = parseInt( filter.substring(filter.search('+') + 1, interval.index), 10 );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if ( filter.match(/\\-/) ) {\n          const intervalInt = parseInt(filter.substring(filter.search('-') + 1, interval.index), 10);\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(value, position?, refreshFilter = true) {\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({ value: dateStringFromYearNotime, pos: position, refreshFilter });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds), 2, refreshFilter);\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({ value: valueTmp.toISOString(), pos: position, refreshFilter });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof(value) === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(year, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (property === 'begin' && this.restrictedToStep() && !this.calendarTypeYear) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(year, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  monthSelected(month, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(month, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  calendarView() {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock';\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string) {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'years', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'years', true);\n        this.filterEndFunction = (monthDiffPlus1 % moment.duration(this.step).asYears()) === 0;\n        return;\n      } else if ( type === 'begin' ) {\n        this.filterBeginFunction = (monthDiff % moment.duration(this.step).asYears()) === 0;\n        return;\n      }\n    }\n    else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'months', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'months', true);\n        this.filterEndFunction = (monthDiffPlus1 % moment.duration(this.step).asMonths()) === 0;\n        return;\n      } else if ( type === 'begin' ) {\n        this.filterBeginFunction = (monthDiff % moment.duration(this.step).asMonths()) === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(moment(this.handleMin()), 'weeks', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'weeks', true);\n        this.filterEndFunction = (weekDiffPlus1 % moment.duration(this.step).asWeeks()) === 0;\n        return;\n      } else if ( type === 'begin' ) {\n        this.filterBeginFunction = (weekDiff % moment.duration(this.step).asWeeks()) === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(moment(this.handleMin()), 'days', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'days', true);\n        const _mod = (dayDiffPlus1 % moment.duration(this.step).asDays());\n        this.filterEndFunction = (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0 ; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      } else if ( type === 'begin' ) {\n        const _mod = ((dayDiff % moment.duration(this.step).asDays()) + 1);\n        this.filterBeginFunction = (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1 ; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      }\n    } else if ( this.ogcFilterTimeService.stepIsHourDuration(this.step) ) {\n      if ( type === 'end' ) {\n        const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n        this.filterEndFunction = (hourDiff % moment.duration(this.step).asHours()) === 0;\n        return;\n      } else if (type === 'begin') {\n        const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n        this.filterBeginFunction = (hourDiff % moment.duration(this.step).asHours()) === 0;\n        return;\n      }\n    } else if ( this.ogcFilterTimeService.stepIsMinuteDuration(this.step) ) {\n      if ( type === 'end' ) {\n        this.filterEndFunction = true;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction = true;\n        return;\n      }\n    }\n\n    this.filterEndFunction = diff % this.stepMilliseconds === 0;\n    this.filterBeginFunction = diff % this.stepMilliseconds === 0;\n    return;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n            this.beginHourFormControl.value,\n            this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60 ? 1 : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin ? this.currentFilter.begin :\n              (this.datasource.options.minDate ? this.datasource.options.minDate : this._defaultMin);\n  }\n\n  public handleMax() {\n    return this.currentFilter.end ? this.currentFilter.end :\n              (this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax);\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if(this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n       const dateItems = stringDate.split('-');\n        if (dateItems.length !== 3) {\n          throw new Error('Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY');\n        } else {\n          year = dateItems[0];\n          month = dateItems[1];\n          day = dateItems[2];\n        }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let filterOriginConfig = this.datasource.options.ogcFilters.filters as OgcFilterDuringOptions;\n\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0,4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0,4)}-01-01`;\n      }\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0,4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if ((this.currentFilter.begin !== minDefaultISOString ) ||\n    (this.currentFilter.end !== maxDefaultISOString)) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","import {\n  Component,\n  Input,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\nimport { default as moment } from 'moment';\nimport { MatSlider } from '@angular/material/slider';\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat){\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(this.datasource, this.currentFilter);\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit(){\n    this.calculateStep();\n    this.handleSliderInput({value: 1});\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(this.beginMillisecond + ((value - 1) * this.stepMillisecond));\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'year').toDate();\n    } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'month').toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n\n          if (this.slider.value < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n    this.slider.value = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n\n      if ( this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'year').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'month').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n            const dateTmp = new Date(this.beginMillisecond + (this.stepMillisecond * (matSliderChange.value - 1)));\n            this.changeProperty.next({value: dateTmp.toISOString(), pos: 1, refreshFilter: false});\n            this.changeProperty.next({value: new Date(this.ogcFilterTimeService.addStep(dateTmp.toISOString(),\n                                        this.stepMillisecond)).toISOString(),\n                                        pos: 2, refreshFilter: true});\n      }\n    }\n  }\n\n  calculateStep(){\n    for (let i = 1; (this.maxMillisecond - (this.beginMillisecond + (i * this.stepMillisecond))) >= -1; i++) {\n      this.calculatedStep = i;\n    }\n  }\n\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    (input)=\"handleSliderInput($event)\"\n    thumbLabel\n    >\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n  </button>\n  \n</div>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule, MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule } from '@angular/material/tree';\n\nimport {\n  MatDatetimepickerModule,\n  MatNativeDatetimeModule\n} from '@mat-datetimepicker/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoEntityModule,\n  IgoDOMModule\n} from '@igo2/common';\nimport { IgoGeometryModule } from './../geometry/geometry.module';\n\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\nimport { IgoLayerModule } from '../layer/layer.module';\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\nimport { TimeFilterService } from './shared/time-filter.service';\n\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\nimport { OGCFilterService } from './shared/ogc-filter.service';\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\n\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\nimport { SpatialFilterService } from './shared/spatial-filter.service';\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatAutocompleteModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatRadioModule,\n    MatMenuModule,\n    MatTableModule,\n    MatTreeModule,\n    MatButtonToggleModule,\n    MatCheckboxModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatListModule,\n    MatTooltipModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    MatDatetimepickerModule,\n    MatNativeDatetimeModule,\n    IgoLanguageModule,\n    IgoLayerModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoEntityModule,\n    IgoDOMModule,\n    IgoKeyValueModule,\n    IgoGeometryModule,\n    MatBadgeModule\n  ],\n  exports: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  declarations: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  providers: [TimeFilterService, OGCFilterService, OGCFilterTimeService, SpatialFilterService]\n})\nexport class IgoFilterModule {\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\n    return {\n      ngModule: IgoFilterModule,\n      providers: [\n        {\n          provide: MAT_DATE_LOCALE,\n          useValue: 'fr-FR'\n        }\n      ]\n    };\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum(['URL', 'GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon']);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport {encode} from 'windows-1252';\n\nimport { ExportFormat, EncodingFormat } from './export.type';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\n\n    return this.exportAsync(exportOlFeatures, format, title, encoding, projectionIn, projectionOut);\n  }\n\n  public generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    excludePrefix: string = '_'\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith(excludePrefix));\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(olFeatures: OlFeature<OlGeometry>[]): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature.getKeys().filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce((acc: object, key: string) => {\n        if (key && key !== 'geometry') {\n          key === 'id' && olFeature.get('draw') ? comment += key + ':' + olFeature.get('draw') + '   \\r\\n'\n          : comment += key + ':' + olFeature.get(key) + '   \\r\\n';\n        }\n        acc[key] = olFeature.get(key);\n        return acc;\n      },\n      {\n        geometry: olFeature.getGeometry()\n      });\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(olFeatures, observer, format, title, encoding, projectionIn, projectionOut);\n      } else {\n        this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const featuresJson = JSON.parse(featuresText);\n      featuresJson.features.map(f => {\n        const encodedProperties = String.fromCharCode\n          .apply(null, encode(JSON.stringify(f.properties), { mode: 'replacement' }));\n        f.properties = JSON.parse(encodedProperties);\n      });\n      featuresText = JSON.stringify(featuresJson);\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName = format === 'Shapefile' ? `${title}.zip` : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(/’/g, \"'\");\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(olFeatures: OlFeature<OlGeometry>[], format: string): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find(olFeature => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(content: string, mimeType: string, fileName: string) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n","import { MessageService } from '@igo2/core';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  featureToOl,\n  moveToOlFeatures,\n  computeOlFeaturesExtent\n} from '../../feature/shared/feature.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { uuid } from '@igo2/utils';\nimport { featureRandomStyle, featureRandomStyleFunction } from '../../style/shared/feature/feature-style';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { ConfirmDialogService } from '@igo2/common';\nimport { first, of } from 'rxjs';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  layerTitle: string,\n  layerService: LayerService,\n  storeToIdb: boolean = false\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const id = uuid();\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    id,\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  let randomStyle;\n  let editable: boolean = false;\n  if (\n    olFeatures[0].getKeys().includes('_style') ||\n    olFeatures[0].getKeys().includes('_mapTitle')) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = layerService.createLayer({\n    id,\n    title: layerTitle,\n    workspace: { enabled: true, searchIndexEnabled: true },\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    idbInfo: { firstLoad: true, storeToIdb, contextUri: contextUri || '*' },\n    style: randomStyle\n  }) as VectorLayer;\n  layer.setExtent(computeOlFeaturesExtent(map, olFeatures));\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService,\n  layerId?: string,\n  imposedSourceOptions?,\n  imposedLayerOptions?,\n  zoomTo: boolean = true\n\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute, resolution);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style'), feature, resolution\n    );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList('default.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList('default.style'), feature, resolution\n    );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer(\n    Object.assign({\n      title: layerTitle,\n      id: layerId || uuid(),\n      isIgoInternalLayer: true,\n      source,\n      style\n    }, imposedLayerOptions));\n  map.addLayer(layer);\n  if (zoomTo){\n    moveToOlFeatures(map, olFeatures);\n  }\n  return layer;\n}\n\nfunction padTo2Digits(num) {\n  return num.toString().padStart(2, '0');\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  messageService: MessageService,\n  layerService: LayerService,\n  confirmDialogService?: ConfirmDialogService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  let layerTitle = computeLayerTitleFromFile(file);\n\n  const obs$ = confirmDialogService ? confirmDialogService.open('igo.geo.import.promptStoreToIdb') : of(false);\n\n  obs$.pipe(first()).subscribe((confirm) => {\n    const d = new Date();\n    const dformat =\n    [d.getFullYear(),\n      padTo2Digits(d.getMonth() + 1),\n      padTo2Digits(d.getDate()), ].join('/') +\n    ' ' +\n    [padTo2Digits(d.getHours()),padTo2Digits(d.getMinutes())].join(':');\n\n\n    layerTitle = confirm ? `${layerTitle} (${dformat})` : layerTitle;\n    if (!styleListService) {\n      addLayerAndFeaturesToMap(features, map, contextUri, layerTitle, layerService, confirm);\n    } else {\n      addLayerAndFeaturesStyledToMap(\n        features,\n        map,\n        layerTitle,\n        styleListService,\n        styleService\n      );\n    }\n\n    messageService.success(\n      'igo.geo.dropGeoFile.success.text',\n      'igo.geo.dropGeoFile.success.title',\n      undefined,\n      { value: layerTitle });\n  });\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalid.text',\n    'igo.geo.dropGeoFile.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    });\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error('igo.geo.dropGeoFile.unreadable.text',\n    'igo.geo.dropGeoFile.unreadable.title',\n    undefined,\n    { value: file.name });\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.tooLarge.text',\n    'igo.geo.dropGeoFile.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    });\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.empty.text',\n    'igo.geo.dropGeoFile.empty.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    });\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalidSRS.text',\n    'igo.geo.dropGeoFile.invalidSRS.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    });\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error('igo.geo.dropGeoFile.ogreServer.text', 'igo.geo.dropGeoFile.ogreServer.title');\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name\n    .split('.')\n    .pop()\n    .toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n      super('Error 500 with OGRE');\n      Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError,\n  ImportSRSError,\n  ImportOgreServerError\n} from './import.errors';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\nimport { ImportExportServiceOptions } from './import.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n\n  static formatExtensionAssociation = {\n    GeoJSON: 'geojson',\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'zip'\n  };\n\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml', 'zip'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    const importConfig = this.config.getConfig('importExport') as ImportExportServiceOptions;\n    this.ogreUrl = importConfig.url;\n    const configFileSizeMb = importConfig.clientSideFileSizeMaxMb;\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    if (importConfig.formats) {\n      ImportService.allowedExtensions = importConfig.formats\n        .map(format => ImportService.formatExtensionAssociation[format])\n        .filter(e => e);\n      if (ImportService.allowedExtensions.includes('geojson')) {\n        ImportService.allowedExtensions.push('json');\n      }\n    }\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n      file: File,\n      observer: Observer<Feature[]>,\n      projectionIn: string,\n      projectionOut: string\n    ) => void {\n    const extension = getFileExtension(file);\n    const allowedExtensions = ImportService.allowedExtensions;\n    let zipMimeTypes = [];\n    if (allowedExtensions.includes('zip')) {\n      zipMimeTypes = ImportService.allowedZipMimeTypes;\n    }\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...zipMimeTypes\n    ];\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = evt => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() })\n      .subscribe(\n        (response: { errors?: string[] } | object | null) => {\n          if (response === null) {\n            observer.error(new ImportUnreadableFileError());\n            return;\n          }\n\n          const errors = (response as any).errors || [];\n          if (errors.length > 0) {\n            observer.error(new ImportUnreadableFileError());\n          } else {\n            const features = this.parseFeaturesFromGeoJSON(\n              file,\n              response,\n              projectionOut\n            );\n            observer.next(features);\n            observer.complete();\n          }\n        },\n        (error: any) => {\n          error.error.caught = true;\n          const errMsg = error.error.msg || '';\n          if (errMsg === 'No valid files found') {\n            observer.error(new ImportInvalidFileError());\n          } else if (errMsg && errMsg.startWith('ERROR 1: Failed to process SRS definition')\n          ) {\n            observer.error(new ImportSRSError());\n          } else if (error.status === 500) {\n            observer.error(new ImportOgreServerError());\n          } else {\n            observer.error(new ImportUnreadableFileError());\n          }\n        }\n      );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\n          resolve(true);\n        });\n    });\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n        [value]=\"selectedMode\"\n        (change)=\"onImportExportChange($event)\">\n        <mat-button-toggle [value]=\"'import'\">\n          {{'igo.geo.importExportForm.importTabTitle' | translate}}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"'export'\">\n          {{'igo.geo.importExportForm.exportTabTitle' | translate}}\n        </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form class=\"igo-form\" [formGroup]=\"importForm\" *ngIf=\"selectedMode === 'import'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.importProjPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of (projections$ | async)\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line *ngIf=\"projection.translateKey\">{{('igo.geo.importExportForm.projections.' + projection.translateKey) | translate: projection}}</p>\n          <p mat-line *ngIf=\"!projection.translateKey\">{{projection.alias}}</p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"importForm.invalid ? ('igo.geo.importExportForm.projections.choose' | translate) : ('igo.geo.importExportForm.importButton' | translate)\"\n    class=\"igo-form-button-group\">\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\">\n        {{'igo.geo.importExportForm.importButton' | translate}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\">\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <div *ngIf=\"importHtmlClarifications === ''\">\n    <h4>{{'igo.geo.importExportForm.importClarifications' | translate}}</h4>\n    <ul>\n      <li>{{'igo.geo.importExportForm.importSizeMax' | translate: {size: fileSizeMb} }}</li>\n      <li>{{'igo.geo.importExportForm.importFormatAuthorized' | translate}}</li>\n      <li>{{'igo.geo.importExportForm.importShpZip' | translate}}</li>\n    </ul>\n  </div>\n  <igo-custom-html *ngIf=\"importHtmlClarifications !== ''\" class=\"mat-typography\"\n    [html]=\"importHtmlClarifications\">\n  </igo-custom-html>\n</section>\n\n<section class=\"mat-typography\" *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\">\n  <h4>{{'igo.geo.importExportForm.exportNoLayersExportable' | translate}}</h4>\n</section>\n\n<form class=\"igo-form\" [formGroup]=\"form\" *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportLayerPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{layers.length ? getLayerTitleById(layers[0]) : ''}}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{layers.length - 1}} {{(layers?.length === 2 ? 'igo.geo.importExportForm.other' : 'igo.geo.importExportForm.others') | translate }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of (exportableLayers$ | async)\"\n          [ngClass]=\"{'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)}\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line>{{layer.title}}</p>\n          <p mat-line>\n            <mat-slide-toggle *ngIf=\"layerHasSelectedFeatures(layer)\"\n              [labelPosition]=\"'after'\"\n              (click)=\"onlySelectedClick($event,layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event,layer.id)\">\n              <small>{{'igo.geo.importExportForm.exportSelectedFeature' | translate}}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportFormatPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option *ngFor=\"let format of (formats$ | async) | keyvalue\" [value]=\"format.key\">\n            {{'igo.geo.export.format.' + format.value | translate}}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{'igo.geo.export.noFormat.title' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"forceNaming && form.value.format !== 'URL'\">\n    <mat-form-field>\n        <input matInput formControlName=\"name\" placeholder=\"{{'igo.geo.importExportForm.exportFileNamePlaceholder' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.encodingPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option *ngFor=\"let encoding of (encodings$ | async) | keyvalue\" [value]=\"encoding.key\">\n            {{'igo.geo.export.encoding.' + encoding.value | translate}}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"export-combine-layers mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\">\n    <mat-slide-toggle\n        formControlName=\"combineLayers\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportCombineResults' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-separator mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon') && form.value.combineLayers\">\n    <mat-slide-toggle\n        formControlName=\"separator\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportSeparator' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-options mat-typography\" *ngIf=\"form.value.format !== 'URL'\">\n    <mat-slide-toggle\n        formControlName=\"featureInMapExtent\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportFeatureInExtent' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\">\n      {{form.value.format !== 'URL'  ? ('igo.geo.importExportForm.exportButton' | translate): (form.value.layers.length > 1  ? ('igo.geo.importExportForm.exportButtonLinks' | translate): ('igo.geo.importExportForm.exportButtonLink' | translate))}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n  <igo-custom-html *ngIf=\"exportHtmlClarifications !== ''\" class=\"mat-typography\"\n    [html]=\"exportHtmlClarifications\">\n  </igo-custom-html>\n\n</form>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { UntypedFormGroup, UntypedFormBuilder, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport {\n  MessageService,\n  LanguageService,\n  ConfigService,\n  StorageService\n} from '@igo2/core';\nimport { strEnum } from '@igo2/utils';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\n\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\nimport { ExportService } from '../shared/export.service';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/import.utils';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { skipWhile } from 'rxjs/operators';\nimport { ConfirmDialogService, EntityRecord, Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { computeProjectionsConstraints } from '../../map';\n\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { ImportExportServiceOptions } from '../shared/import.interface';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: UntypedFormGroup;\n  public importForm: UntypedFormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n  public importHtmlClarifications: string;\n  public exportHtmlClarifications: string;\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> = new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  @Input() contextUri: string;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return this.storageService.get('importExportPopupAllowed') as boolean || false;\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService,\n    private layerService: LayerService,\n    private confirmDialogService: ConfirmDialogService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n    this.importHtmlClarifications = this.languageService.translate.instant('igo.geo.importExportForm.importHtmlClarifications');\n    this.exportHtmlClarifications = this.languageService.translate.instant('igo.geo.importExportForm.exportHtmlClarifications');\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges\n      .subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers = layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({ encoding: encodings[Object.keys(encodings)[0]] });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({ inputProj: { translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4326', zone: '' } });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(this.projectionsLimitations);\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({ translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4269', zone: '' });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({ translateKey: 'wgs84', alias: 'WGS84', code: 'EPSG:4326', zone: '' });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({ translateKey: 'webMercator', alias: 'Web Mercator', code: 'EPSG:3857', zone: '' });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({ translateKey: 'mtm', alias: `MTM ${mtmZone}`, code, zone: `${mtmZone}` });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({ translateKey: 'utm', alias: `UTM ${utmZone}`, code, zone: `${utmZone}` });\n      }\n    }\n\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(workspace => (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace).layer.id === id);\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView\n        .firstBy((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        });\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(layerId => layerId !== id);\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find(layerId => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(layerId => layerId === layer.id) ? true : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (!this.popupChecked && data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 || data.format === ExportFormat.URL) && !this.popupAllowed) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string, features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = \"\";\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma)\n      || !data.combineLayers || data.layers.length === 1) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant('igo.geo.export.combinedLayers');\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (data.format === ExportFormat.URL && dSOptions.download && (dSOptions.download.url || dSOptions.download.dynamicUrl)) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi) ? this.downloadService.open(lay) : window.open(url , '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n\n        if (data.layersWithSelection.indexOf(layer) !== -1 && data.featureInMapExtent) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent && e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.layersWithSelection.indexOf(layer) !== -1 && !data.featureInMapExtent) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent).map(e => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView.all().map(e => (e.entity as Feature).ol);\n        }\n      }\n      else {\n        const ol = lay.dataSource.ol as olVectorSource<OlGeometry> | olClusterSource ;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n\n      let geomTypes: { geometryType: string, features: any[] }[] = [];\n      if (data.format === ExportFormat.Shapefile || data.format === ExportFormat.GPX) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(geomType => geomType.geometryType === featureGeomType);\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({ geometryType: featureGeomType, features: [olFeature] });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach(geomType => {\n        geomType.features.forEach(feature => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [feature.get('longitude'), feature.get('latitude')];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter(geomType => ['LineString', 'Point'].includes(geomType.geometryType));\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          this.messageService.error('igo.geo.export.gpx.error.poly.text', 'igo.geo.export.gpx.error.poly.title', { timeOut: 20000 });\n        }\n      } else if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n        geomTypes.forEach(geomType => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach(geomType => {\n            geomType.features.forEach(currentFeature => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (currentFeature.get('_featureStore').layer.options.title !==\n                  previousFeature.get('_featureStore').layer.options.title) {\n                    const titleEmptyRows = this.createTitleEmptyRows(previousFeature, currentFeature);\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(currentFeature, currentFeature);\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        this.messageService.error('igo.geo.export.nothing.text', 'igo.geo.export.nothing.title', { timeOut: 20000 });\n\n      } else {\n        if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) || !data.combineLayers) {\n          geomTypes.map(geomType =>\n            this.exportService.export(geomType.features, data.format, filename + geomType.geometryType, data.encoding, this.map.projection)\n            .subscribe(\n              () => {},\n              (error: Error) => this.onFileExportError(error),\n              () => {\n                this.onFileExportSuccess();\n\n                geomType.features.forEach(feature => {\n                  this.circleToPoint(feature);\n                });\n\n                this.loading$.next(false);\n            }\n          ));\n        }\n      }\n    };\n    if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n      this.exportService.export(featuresCSV, data.format, filename, data.encoding, this.map.projection)\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n\n          featuresCSV.forEach(feature => {\n            this.circleToPoint(feature);\n          });\n\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach(previousKey => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach(key => {\n      const sameKeys: boolean = previousFeatureKeys.length === currentFeatureKeys.length &&\n      previousFeatureKeys.every((value, index) => value === currentFeatureKeys[index]);\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title + \" ===============>\", true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!(currentFeatureKeys.includes(key))) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([feature.get('longitude'), feature.get('latitude')]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    const importExportOptions = this.config.getConfig('importExport') as ImportExportServiceOptions;\n    const confirmDialogService = importExportOptions?.allowToStoreLayer ? this.confirmDialogService : undefined;\n    const importWithStyle =importExportOptions?.importWithStyle || this.config.getConfig('importWithStyle');\n    if (this.config.getConfig('importWithStyle')) {\n      console.warn(`\n      The location of this config importWithStyle is deprecated.\n      Please move this property within importExport configuration.\n      Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\n      Refer to environnement.ts OR config/config.json\n      This legacy conversion will be deleted in 2024.\n      `);\n    }\n    if (!importWithStyle) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.fileSizeMb\n    );\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const extraMessage = preCheck ? 'igo.geo.export.popupBlocked.selectAgain' : 'igo.geo.export.popupBlocked.retry';\n    this.messageService.error(\n      'igo.geo.export.popupBlocked.text',\n      'igo.geo.export.popupBlocked.title',\n      { timeOut: 20000 },\n      {extraMessage});\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService);\n  }\n\n  private loadConfig() {\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\n    }\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({layer: layer.title, formats: this.validateListFormat(layer.dataSource.options.download.allowedFormats)});\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url || layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    const configImportExportFormats = this.config.getConfig('importExport.formats');\n    if (configImportExportFormats) {\n      const validatedListFormat = this.validateListFormat(configImportExportFormats);\n      appliedformats = appliedformats.filter(af => validatedListFormat.includes(af));\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map(list => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter(value => previousCustomListFormats.includes(value));\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter(value => appliedformats.includes(value));\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              'igo.geo.export.customList.text',\n              'igo.geo.export.customList.title',\n              undefined,\n              { value: layersWithCustomFormats.join() }\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert('igo.geo.export.noFormat.text','igo.geo.export.noFormat.title');\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n    let lonMin = -54;\n    const lonMax = -81;\n    if (lon < lonMax || lon > lonMin) {\n      return 0;\n    }\n    else {\n      const deltaLon = 3;\n      let zone = 2;\n      while (Math.abs(lon - lonMin) > deltaLon) {\n        lonMin = lonMin - deltaLon;\n        zone++;\n      }\n      return zone;\n    }\n  }\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n    projectionsLimitations: ProjectionsLimitationsOptions):\n    ProjectionsLimitationsOptions {\n    const mtmZone = projectionsLimitations.mtmZone;\n    const utmZone = projectionsLimitations.utmZone;\n    const projectionsConstraints = {\n        projFromConfig: projectionsLimitations.projFromConfig === false ? false : true,\n        nad83: projectionsLimitations.nad83 === false ? false : true,\n        wgs84: projectionsLimitations.wgs84 === false ? false : true,\n        webMercator: projectionsLimitations.webMercator === false ? false : true,\n        utm: projectionsLimitations.utm === false ? false : true,\n        mtm: projectionsLimitations.mtm === false ? false : true,\n        utmZone: {\n        minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n        maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21,\n        },\n        mtmZone: {\n        minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n        maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10,\n        }\n    };\n    return projectionsConstraints;\n  }\n","import {\n  getEntityProperty,\n  EntityTableColumn,\n  EntityTableColumnRenderer\n} from '@igo2/common';\nimport { MessageService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService);\n    return;\n  }\n  messageService.error('igo.geo.export.failed.text', 'igo.geo.export.failed.title');\n}\n\nexport function handleFileExportSuccess(\n  messageService: MessageService\n) {\n  messageService.success('igo.geo.export.success.text', 'igo.geo.export.success.title');\n}\n\nexport function handleNothingToExportError(\n  messageService: MessageService\n) {\n  messageService.error('igo.geo.export.nothing.text', 'igo.geo.export.nothing.title');\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule, IgoCustomHtmlModule } from '@igo2/common';\n\nimport { ExportButtonComponent } from './export-button/export-button.component';\nimport { ImportExportComponent } from './import-export/import-export.component';\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\n\n@NgModule({\n  imports: [\n    MatIconModule,\n    MatTooltipModule,\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    IgoKeyValueModule,\n    IgoDrapDropModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent],\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\n})\nexport class IgoImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\n    return {\n      ngModule: IgoImportExportModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field\n  class=\"measure-field\"\n  appearance=\"outline\"\n  floatLabel=\"always\">\n  <mat-label>{{placeholder}}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    [value]=\"((measure$ | async) || 0) | measureFormat: measureUnit\">\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerItemComponent implements OnDestroy {\n\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number { return this.measure$.value; }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\n  get auto(): boolean { return this._auto; }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\n\nimport { MeasureFormatPipe } from './measure-format.pipe';\nimport { MeasurerItemComponent } from './measurer-item.component';\nimport { MeasurerComponent } from './measurer.component';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDividerModule,\n    IgoLanguageModule,\n    IgoEntityTableModule\n  ],\n  declarations: [\n    MeasureFormatPipe,\n    MeasurerItemComponent,\n    MeasurerComponent,\n    MeasurerDialogComponent\n  ],\n  exports: [\n    MeasureFormatPipe,\n    MeasurerComponent\n  ]\n})\nexport class IgoMeasurerModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoMeasurerModule\n  ]\n})\nexport class IgoMeasureModule {}\n","export enum OverlayAction {\n    None,\n    Move,\n    Zoom,\n    ZoomIfOutMapExtent\n  }\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayService } from '../shared/overlay.service';\nimport { OverlayAction } from '../shared/overlay.enum';\n\n@Directive({\n  selector: '[igoOverlay]'\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe(res =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2016-2017 Dan \"Ducky\" Little\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport default function jsGeoPdfPlugin(jsPDFAPI) {\n\n    const setGeoArea = function(pdfExt, geoExt) {\n        const bbox = pdfExt.join(' ');\n        // the ordering may seem odd here but PDF\n        //  flips the Y axis upside down and this accounts for that\n        //  change.\n        const minx = geoExt[0];\n        const maxx = geoExt[2];\n        const maxy = geoExt[1];\n        const miny = geoExt[3];\n        const bounds = [miny, minx, maxy, minx, maxy, maxx, miny, maxx].join(' ');\n        const bbox_obj = this.internal.newAdditionalObject();\n        const bounds_obj = this.internal.newAdditionalObject();\n        const proj_obj = this.internal.newAdditionalObject();\n\n        proj_obj.content = '<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS[\"WGS_1984_Web_Mercator_Auxiliary_Sphere\"'+\n        ',GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0]'+\n        ',UNIT[\"Degree\",0.017453292519943295]],PROJECTION[\"Mercator_Auxiliary_Sphere\"],PARAMETER[\"False_Easting\",0.0]'+\n        ',PARAMETER[\"False_Northing\",0.0],PARAMETER[\"Central_Meridian\",0.0],PARAMETER[\"Standard_Parallel_1\",0.0]'+\n        ',PARAMETER[\"Auxiliary_Sphere_Type\",0.0],UNIT[\"Meter\",1.0]]) >>';\n\n        bounds_obj.content = '<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS ' +\n        proj_obj.objId + ' 0 R /GPTS [ ' + bounds + ' ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>';\n\n        bbox_obj.content = '<< /BBox [ ' + bbox + ' ] /Measure ' + bounds_obj.objId + ' 0 R /Name (Layer) /Type /Viewport >>';\n\n        const title_obj = this.internal.newAdditionalObject();\n        const date = new Date().toLocaleDateString('en-CA');\n        title_obj.content = '<< /Name IGO2 /Type /OCG /Date '+ date +' >>';\n\n        return bbox_obj.objId;\n    };\n\n    jsPDFAPI.setGeoArea = function(pdfExt, geoExt) {\n        this.internal.events.subscribe('putPage', function() {\n            const bbox_id = setGeoArea.call(this, pdfExt, geoExt);\n            this.internal.write('/VP [ ' + bbox_id + ' 0 R ]');\n        });\n    };\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { saveAs } from 'file-saver';\nimport jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { default as JSZip } from 'jszip';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { SecureImagePipe } from '@igo2/common';\nimport { MessageService, ActivityService, LanguageService, ConfigService } from '@igo2/core';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport { LegendMapViewOptions } from '../../layer/shared/layers/layer.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\n\nimport { PrintOptions, TextPdfSizeAndMargin } from './print.interface';\nimport GeoPdfPlugin from './geopdf';\nimport { PrintPaperFormat } from './print.type';\n\ndeclare global {\n  interface Navigator {\n    msSaveBlob?: (blob: any, defaultName?: string) => boolean\n  }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  imgSizeAdded: Array<number>;\n\n  TEXTPDFFONT = {\n    titleFont: 'Times',\n    titleFontStyle: 'bold',\n    subtitleFont: 'Times',\n    subtitleFontStyle: 'bold',\n    commentFont: 'courier',\n    commentFontStyle: 'normal',\n    commentFontSize: 12\n  };\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n    this.activityId = this.activityService.register();\n\n    GeoPdfPlugin(jsPDF.API);\n\n    const doc = new jsPDF({\n      orientation,\n      format: paperFormat.toLowerCase(),\n      unit: 'mm' // default\n    });\n\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0] - margins[3] - margins[1];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size = [width, height];\n    let titleSizes: TextPdfSizeAndMargin;\n    let subtitleSizes: TextPdfSizeAndMargin;\n\n    // if paper format A1 or A0 add margin top\n    if ((options.title !== '' || options.subtitle) &&\n      (paperFormat === PrintPaperFormat.A1 || paperFormat === PrintPaperFormat.A0)) {\n      margins[0] += 10;\n    }\n    // PDF title\n    const fontSizeInPt = Math.round(2 * (height + 145) * 0.05) / 2; //calculate the fontSize title from the page height.\n    if (options.title !== undefined && options.title !== '') {\n      titleSizes = this.getTextPdfObjectSizeAndMarg(options.title,\n        margins,\n        this.TEXTPDFFONT.titleFont,\n        fontSizeInPt,\n        this.TEXTPDFFONT.titleFontStyle,\n        doc);\n\n      this.addTextInPdfDoc(doc,\n        options.title,\n        this.TEXTPDFFONT.titleFont,\n        this.TEXTPDFFONT.titleFontStyle,\n        titleSizes.fontSize,\n        titleSizes.marginLeft + margins[3],\n        margins[0]);\n\n      margins[0] = titleSizes.height + margins[0]; // cumulative margin top for next elem to place in pdf doc\n    }\n\n    // PDF subtitle\n    if (options.subtitle !== undefined && options.subtitle !== '') {\n      subtitleSizes = this.getTextPdfObjectSizeAndMarg(options.subtitle,\n        margins,\n        this.TEXTPDFFONT.subtitleFont,\n        (options.title !== '') ? titleSizes.fontSize * 0.7 : fontSizeInPt * 0.7, // 70% size of title\n        this.TEXTPDFFONT.subtitleFontStyle,\n        doc);\n\n       this.addTextInPdfDoc(doc,\n        options.subtitle,\n        this.TEXTPDFFONT.subtitleFont,\n        this.TEXTPDFFONT.subtitleFontStyle,\n        subtitleSizes.fontSize,\n        subtitleSizes.marginLeft + margins[3],\n        margins[0]\n      );\n\n      margins[0] += 5; // cumulative marg top for next elem to place in pdf doc. 5 is a fix it could be adjust\n    }\n\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale\n        );\n    }\n    if (options.comment !== undefined && options.comment !== '') {\n      this.addComment(doc, options.comment);\n    }\n\n    this.addMap(doc, map, resolution, size, margins).subscribe(\n      async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addScale(doc, map, margins);\n          await this.handleMeasureLayer(doc, map, margins);\n\n          const width = this.imgSizeAdded[0];\n          const height = this.imgSizeAdded[1];\n          const res = 1;\n          this.addGeoRef(doc, map, width, height, res, margins);\n\n          if (options.legendPosition !== 'none') {\n            if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(options.legendPosition) > -1 ) {\n              await this.addLegendSamePage(doc, map, margins, resolution, options.legendPosition);\n            } else if (options.legendPosition === 'newpage') {\n              await this.addLegend(doc, map, margins, resolution);\n            }\n          } else {\n            await this.saveDoc(doc);\n          }\n        }\n\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n          this.activityService.unregister(this.activityId);\n          status$.next(SubjectStatus.Done);\n        }\n      }\n    );\n\n    return status$;\n  }\n  // ref GeoMoose https://github.com/geomoose/gm3/tree/main/src/gm3/components/print\n  addGeoRef(doc, map, width, height, resolution, margins) {\n    const unit = 'mm';\n    const docHeight = doc.internal.pageSize.getHeight();\n\n    // x,y = margin left-bottom corner for img in pdf doc\n    const x = margins[3];\n    const y = docHeight - margins[0] - height;\n\n    let pdf_extents = [x, y, x + width, y + height];\n    for(let i = 0; i < pdf_extents.length; i++) {\n      pdf_extents[i] = this.pdf_units2points(pdf_extents[i], unit);\n    }\n\n    const mapExtent = map.viewController.getExtent('EPSG:3857');\n    doc.setGeoArea(pdf_extents, mapExtent);\n\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>\n  ) {\n    if (map.layers.find(layer => layer.visible && layer.id.startsWith('igo-measures-'))) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then(e => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(\n        map.layers,\n        {\n          resolution: map.viewController.getResolution(),\n          extent: map.viewController.getExtent(),\n          projection: map.viewController.getOlProjection().getCode(),\n          // scale: map.viewController.getScale(resolution),\n          size: map.ol.getSize()\n        } as LegendMapViewOptions\n      );\n\n      if (legends.filter(l => l.display === true).length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html += '.html2canvas-container { width: ' + width + 'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html += 'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends.filter(l => l.display && l.isInResolutionsRange === true)\n      .map((legend) =>\n        this.getDataImage(legend.url).pipe(\n          rxMap((dataImage) => {\n            let htmlImg = '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n            htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n            return htmlImg;\n          })\n        )\n      );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n\n  getTextPdfObjectSizeAndMarg(text: string, margins, font:string, fontSizeInPt: number, fontStyle:string, doc: jsPDF)\n  : TextPdfSizeAndMargin {\n    const pdfResolution = 96;\n    const docWidth = doc.internal.pageSize.getWidth();\n    const pageWidth = docWidth - margins[1] - margins[3];\n\n    // important to set it first, the textDimension change when font change!\n    doc.setFont(font, fontStyle);\n    doc.setFontSize(fontSizeInPt);\n\n    let textDimensions = doc.getTextDimensions(text);\n    let textMarginLeft: number;\n\n    if (textDimensions.w > pageWidth) {\n      // if the text is to long, reduce fontSize 70% and the overflow with be cut in print...\n      textMarginLeft = 0;\n      fontSizeInPt = fontSizeInPt * 0.7;\n      doc.setFontSize(fontSizeInPt);\n      textDimensions = doc.getTextDimensions(text);\n\n    } else {\n      textMarginLeft = (pageWidth - textDimensions.w ) / 2 ;\n    }\n\n    return {\n      'fontSize': fontSizeInPt,\n      'marginLeft': textMarginLeft,\n      'height': textDimensions.h\n    };\n  }\n\n  /**\n   * Add comment to the document\n   * * @param  doc - pdf document\n   * * @param  comment - Comment to add in the document\n   */\n  private addComment(doc: jsPDF, comment: string) {\n    const commentMarginLeft = 10; //margin left and bottom is fix\n    const commentMarginBottom = 10;\n    const marginTop = doc.internal.pageSize.height - commentMarginBottom;\n    this. addTextInPdfDoc(doc,comment,\n      this.TEXTPDFFONT.commentFont,\n      this.TEXTPDFFONT.commentFontStyle,\n      this.TEXTPDFFONT.commentFontSize,\n      commentMarginLeft,\n      marginTop,\n      true\n    );\n  }\n\n  private addTextInPdfDoc(doc: jsPDF,\n    textToAdd: string,\n    textFont: string,\n    textFontStyle: string,\n    textFontSize: number,\n    textMarginLeft: number,\n    textMarginTop: number,\n    isComment: boolean = false)\n    {\n      doc.setFont(textFont, textFontStyle);\n      doc.setFontSize(textFontSize);\n\n      if(isComment) {\n        textToAdd = doc.splitTextToSize(textToAdd, (doc.internal.pageSize.getWidth() - (textMarginLeft * 3)));\n      }\n      doc.text(textToAdd, textMarginLeft, textMarginTop);\n    }\n\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   */\n  private addProjScale(\n    doc: jsPDF,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean\n  ) {\n    const translate = this.languageService.translate;\n    const projScaleSize = 12;\n    const projScaleMarginLeft = 10;\n    const marginBottom = 15;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont('courier');\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution, pourcentageReduction\n        * (25.4 * canvas.height) / resolution];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n    }\n\n    await this.saveDoc(doc);\n\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n     private async addLegendSamePage(\n      doc: jsPDF,\n      map: IgoMap,\n      margins: Array<number>,\n      resolution: number,\n      legendPosition: string\n    ) {\n      // Get html code for the legend\n      const width = doc.internal.pageSize.width;\n      const html = await this.getLayersLegendHtml(\n        map,\n        width,\n        resolution\n      ).toPromise();\n      // If no legend, save the map directly\n      if (html === '') {\n        await this.saveDoc(doc);\n        return true;\n      }\n      // Create div to contain html code for legend\n      const div = window.document.createElement('div');\n      div.style.position = 'absolute';\n      div.style.top = '0';\n      // Add html code to convert in the new window\n      window.document.body.appendChild(div);\n      div.innerHTML = html;\n      await this.timeout(1);\n      const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n        console.log(e);\n      });\n      let marginsLegend;\n      if (canvas) {\n        const pourcentageReduction = 0.85;\n        const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution,\n           pourcentageReduction * (25.4 * canvas.height) / resolution];\n        // Move the legend to the correct position on the page\n        if ( legendPosition === 'bottomright') {\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1], margins[1],\n           margins[2], doc.internal.pageSize.width - margins[1] - imageSize[0]];\n        } else if (legendPosition === 'topright') {\n          marginsLegend = [margins[0], margins[1], doc.internal.pageSize.height - margins[0] - imageSize[1],\n          doc.internal.pageSize.width - margins[1] - imageSize[0] ];\n        } else if (legendPosition === 'bottomleft') {\n          // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\n          doc.internal.pageSize.width - margins[3] - imageSize[0], margins[2] + 15, margins[3] ];\n        } else if (legendPosition === 'topleft') {\n          marginsLegend = [margins[0], doc.internal.pageSize.width - margins[3] - imageSize[0],\n           doc.internal.pageSize.height - margins[0] - imageSize[1], margins[3] ];\n        }\n        this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n        await this.saveDoc(doc);\n      }\n    }\n\n  /**\n   * Add scale and attributions on the map on the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addScale(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>\n    ) {\n      const mapSize = map.ol.getSize();\n      const extent = map.ol.getView().calculateExtent(mapSize);\n      // Get the scale and attribution\n      // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n      let canvasOverlayHTML;\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\n      // Remove the UI buttons from the nodes\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n      }\n      // Find attributions by class and delete\n      // the collapsed class to open attribution Copyright\n      const element = mapOverlayHTML.querySelector('.ol-attribution');\n      const olCollapsed: boolean = element.classList.contains('ol-collapsed');\n      if (olCollapsed) {\n        element.classList.remove('ol-collapsed');\n      }\n      // Change the styles of hyperlink in the printed version\n      // Transform the Overlay into a canvas\n      // scale is necessary to make it in google chrome\n      // background as null because otherwise it is white and cover the map\n      // allowtaint is to allow rendering images in the attributions\n      // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n      const canvas = await html2canvas(mapOverlayHTML, {\n        scale: 1,\n        backgroundColor: null,\n        allowTaint: true,\n        useCORS: true,\n      }).then( e => {\n        canvasOverlayHTML = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTML, margins); // this adds scales and attributions\n      if (olCollapsed) {\n        element.classList.add('ol-collapsed');\n      }\n }\n\n /**\n  * Add Copyrigh to the map canvas\n  * @param map - Map of the app\n  * @param canvas Canvas of the map\n  */\n  private async addCopyrightToImage(\n    map: IgoMap,\n    canvas : HTMLCanvasElement\n    ) {\n      const context = canvas.getContext('2d');\n      let canvasOverlayHTML;\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\n      // Remove the UI buttons from the nodes\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n      }\n      // Find attributions by class and delete\n      // the collapsed class to open attribution Copyright\n      const element = mapOverlayHTML.querySelector('.ol-attribution');\n      const olCollapsed: boolean = element.classList.contains('ol-collapsed');\n      if (olCollapsed) {\n        element.classList.remove('ol-collapsed');\n      }\n\n      await html2canvas(mapOverlayHTML, {\n        scale: 1,\n        backgroundColor: null,\n        allowTaint: true,\n        useCORS: true,\n      }).then( e => {\n        canvasOverlayHTML = e;\n      });\n      context.drawImage(canvasOverlayHTML, 0, 0);\n      if (olCollapsed) {\n        element.classList.add('ol-collapsed');\n      }\n  }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jsPDF,\n    canvas: HTMLCanvasElement,\n    margins: Array<number>\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      if (image.length < 20 ) { //  img is corrupt    todo: fix addScale in mobile make a corrupt img\n        console.log('Warning: An image cannot be print in pdf file');\n        return;\n      }\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\n      doc.addImage(\n        image,\n        'PNG',\n        margins[3],\n        margins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\n      this.imgSizeAdded = imageSize; // keep img size for georef later\n    }\n  }\n\n  // TODO fix printing with image resolution\n  private addMap(\n    doc: jsPDF,\n    map: IgoMap,\n    resolution: number,\n    size: Array<number>,\n    margins: Array<number>\n  ) {\n    const status$ = new Subject();\n\n    const mapSize = map.ol.getSize();\n    const extent = map.ol.getView().calculateExtent(mapSize);\n\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\n\n    let timeout;\n\n    map.ol.once('rendercomplete', (event: any) => {\n      const canvases = event.target.getViewport().getElementsByTagName('canvas');\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error('igo.geo.printForm.corsErrorMessageBody','igo.geo.printForm.corsErrorMessageHeader');\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error('igo.geo.printForm.corsErrorMessageBody', 'igo.geo.printForm.corsErrorMessageHeader');\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      }, 200);\n    });\n\n    this.renderMap(map, [widthPixels, heightPixels], extent);\n\n    return status$;\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    resolution: number,\n    format = 'png',\n    projection = false,\n    scale = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true,\n    legendPosition: string\n  ) {\n    const status$ = new Subject();\n    // const resolution = map.ol.getView().getResolution();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    map.ol.once('rendercomplete', async (event: any) => {\n      format = format.toLowerCase();\n      const oldCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas')[0];\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Get height/width of map canvas\n      const width = oldCanvas.width;\n      let height = oldCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n      if (['bmp','gif', 'jpeg', 'png', 'tiff'].indexOf(format) > -1) {\n        // Patch Jpeg default black background to white\n        if (format === 'jpeg') {\n          newContext.fillStyle = '#ffffff';\n          newContext.fillRect(0, 0, width, height);\n          newContext.fillStyle = '#000000';\n        } else if (title !== '' || subtitle !== '' || comment !== '' ||\n            projection !== false || scale !== false) {\n              newContext.fillStyle = '#ffffff';\n              newContext.fillRect(0, 0, width, height);\n              newContext.fillStyle = '#000000';\n        }\n      }\n\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection or/end scale need to be added to canvas\n      if((projection !== false) || (scale !== false)) {\n        let projectionScaleText = '';\n        if (projection !== false) {\n          const projText = translate.instant('igo.geo.printForm.projection');\n          projectionScaleText = projText + ': ' + map.projection + '         ';\n        }\n\n        if (scale !== false) {\n          const scaleText = translate.instant('igo.geo.printForm.scale');\n          const mapScale = map.viewController.getScale(resolution);\n          projectionScaleText += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n        }\n        newContext.textAlign = 'center';\n        newContext.fillText(projectionScaleText, width / 2, positionHProjScale, width * 0.9);\n      }\n\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n\n      // Add map to new canvas\n      newContext.drawImage(oldCanvas, 0, positionHCanvas);\n      // Add copyrigh\n      await this.addCopyrightToImage(map, newCanvas);\n\n      // Check the legendPosition\n      if (legendPosition !== 'none') {\n        if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(legendPosition) > -1) {\n          await this.addLegendToImage(\n            newCanvas,\n            map,\n            resolution,\n            legendPosition,\n            format\n          );\n        } else if (legendPosition === 'newpage') {\n          await this.getLayersLegendImage(\n            map,\n            format,\n            doZipFile,\n            resolution\n          );\n        }\n      }\n\n      let status = SubjectStatus.Done;\n      let fileNameWithExt = 'map.' + format;\n      if (format.toLowerCase() === 'tiff') {\n        fileNameWithExt = 'map' + map.projection.replace(':', '_') + '.' + format;\n      }\n\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tfwFileNameWithExt = fileNameWithExt.substring(0, fileNameWithExt.toLowerCase().indexOf('.tiff')) + '.tfw';\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, tfwFileNameWithExt);\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(tfwFileNameWithExt,blob);\n        }\n      }\n    });\n    map.ol.renderSync();\n\n    return status$;\n  }\n\n  /**\n   * Create and Add Legend to the map canvas\n   * @param  canvas Canvas of the map\n   * @param  map Map of the app\n   * @param  resolution Resolution of map\n   * @param  legendPosition Legend position\n   * @param  format Image format\n   */\n  private async addLegendToImage(\n      canvas: HTMLCanvasElement,\n      map: IgoMap,\n      resolution: number,\n      legendPosition: string,\n      format: string\n  ) {\n    const fileNameWithExt = 'map.' + format;\n    const context = canvas.getContext('2d');\n\n    // Get html code for the legend\n    const html = await this.getLayersLegendHtml(\n      map,\n      canvas.width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveCanvasImageAsFile(canvas, fileNameWithExt, format);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvasLegend = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvasLegend) {\n      const canvasHeight = canvas.height;\n      const canvasWidth = canvas.width;\n      const legendHeight = canvasLegend.height;\n      const legendWidth = canvasLegend.width;\n      // Move the legend to the correct position on the page\n      const offset = canvasHeight * 0.01;\n      let legendX: number;\n      let legendY: number;\n\n      if (legendPosition === 'bottomright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = canvasHeight - legendHeight - offset;\n      } else if (legendPosition === 'topright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = offset;\n      } else if (legendPosition === 'bottomleft') {\n        legendX = offset;\n        legendY = canvasHeight - legendHeight - offset - 15;\n      } else if (legendPosition === 'topleft') {\n        legendX = offset;\n        legendY = offset;\n      }\n\n      context.drawImage(canvasLegend, legendX, legendY, legendWidth, legendHeight);\n      context.strokeRect(legendX, legendY, legendWidth, legendHeight);\n      div.parentNode.removeChild(div); // remove temp div (IE style)\n      return true;\n    }\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jsPDF) {\n    await doc.save('map_georef.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  private getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight = doc.internal.pageSize.getHeight() - (margins[0] + margins[2] + 10);\n    const pageWidth = doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = this.pdf_units2points(canvas.height, 'mm');\n    const canWidth = this.pdf_units2points(canvas.width, 'mm');\n\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      canvas.toBlob((blob) => {\n        // download image\n        saveAs(blob, nameWithExt);\n        that.saveFileProcessing();\n      }, blobFormat);\n    } catch (err) {\n      this.messageService.error('igo.geo.printForm.corsErrorMessageBody','igo.geo.printForm.corsErrorMessageHeader');\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error('igo.geo.printForm.corsErrorMessageBody','igo.geo.printForm.corsErrorMessageHeader');\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n\n\n  private pdf_units2points(n, unit): number {\n    let k = 1;\n\n    // this code is borrowed from jsPDF\n    //  as it does not expose a public API\n    //  for converting units to points.\n    switch (unit) {\n        case 'pt':\n            k = 1;\n            break;\n        case 'mm':\n            k = 72 / 25.4;\n            break;\n        case 'cm':\n            k = 72 / 2.54;\n            break;\n        case 'in':\n            k = 72;\n            break;\n        case 'px':\n            k = 96 / 72;\n            break;\n        case 'pc':\n            k = 12;\n            break;\n        case 'em':\n            k = 12;\n            break;\n        case 'ex':\n            k = 6;\n            break;\n        default:\n            throw new Error('Invalid unit: ' + unit);\n    }\n\n    return n * k;\n  }\n\n}\n","import { Layer } from '../shared/layers/layer';\nimport { LegendMapViewOptions, OutputLayerLegend } from '../shared/layers/layer.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(layers: Layer[], view?: LegendMapViewOptions): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    const legendOptions = layer.options.legendOptions;\n    if (layer.visible === false) { continue; }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) { continue; }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title || '',\n        url: legendUrl.url,\n        display: legendOptions?.display === undefined ? true : legendOptions.display,\n        isInResolutionsRange: layer.isInResolutionsRange,\n      });\n    }\n  }\n\n  return legends;\n}\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\n        <mat-error *ngIf=\"titleField.errors?.maxlength\">{{'igo.geo.formValidation.maxLength' | translate: { \n          column: 'igo.geo.printForm.title' | translate, \n          value: 130 } }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{'igo.geo.printForm.subtitle' | translate}}\">\n        <mat-error *ngIf=\"subtitleField.errors?.maxlength\">{{'igo.geo.formValidation.maxLength' | translate: { \n          column: 'igo.geo.printForm.subtitle' | translate, \n          value: 120 } }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{'igo.geo.printForm.comment' | translate}}\">\n        <mat-error *ngIf=\"commentField.errors?.maxlength\">{{'igo.geo.formValidation.maxLength' | translate: { \n          column: 'igo.geo.printForm.comment' | translate, \n          value: maxLength } }}</mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <div class=\"print-slide-toggle-container mat-typography\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showProjection' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showScale' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\">\n        {{'igo.geo.printForm.doZipFile' | translate}}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{'igo.geo.printForm.legendPosition' | translate}}\">\n        <mat-option *ngFor=\"let legendPosition of legendPositions | keyvalue \" [value]=\"legendPosition.key\">\n          <ng-container *ngIf=\"!['newpage', 'newimage'].includes(legendPosition.value)\">\n            {{'igo.geo.printForm.legendPositions.' + legendPosition.value | translate}}\n          </ng-container>\n\n          <ng-container *ngIf=\"['newpage', 'newimage'].includes(legendPosition.value)\">\n            {{ ((outputFormat === 'Pdf') ? 'igo.geo.printForm.legendPositions.newpage' : \n            'igo.geo.printForm.legendPositions.newimage') | translate}}\n          </ng-container>\n        </mat-option>\n\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{'igo.geo.printForm.outputFormat' | translate}}\">\n        <mat-option *ngFor=\"let outputFormat of outputFormats | keyvalue \" [value]=\"outputFormat.key\">\n            {{outputFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"paperFormat\"\n        placeholder=\"{{'igo.geo.printForm.paperFormat' | translate}}\">\n        <mat-option *ngFor=\"let paperFormat of paperFormats | keyvalue \" [value]=\"paperFormat.key\">\n          {{('igo.geo.printForm.paperFormats.' + paperFormat.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'none' : 'block'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{'igo.geo.printForm.imageFormat' | translate}}\">\n        <mat-option *ngFor=\"let imageFormat of imageFormats | keyvalue \" [value]=\"imageFormat.key\">\n          {{imageFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" style=\"display: none;\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{'igo.geo.printForm.resolution' | translate}}\">\n        <mat-option *ngFor=\"let resolution of resolutions | keyvalue \" [value]=\"resolution.key\">\n          {{resolution.value + ' PPI'}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"orientation\"\n        placeholder=\"{{'igo.geo.printForm.orientation' | translate}}\">\n        <mat-option *ngFor=\"let orientation of orientations | keyvalue \" [value]=\"orientation.key\">\n          {{('igo.geo.printForm.' + orientation.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\">\n      {{'igo.geo.printForm.saveBtn' | translate}}\n    </button>\n  </div>\n\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport {\n  UntypedFormGroup,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss']\n})\nexport class PrintFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = PrintResolution;\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || PrintResolution['96'], {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as UntypedFormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as UntypedFormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as UntypedFormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as UntypedFormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as UntypedFormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as UntypedFormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as UntypedFormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as UntypedFormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as UntypedFormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as UntypedFormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as UntypedFormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as UntypedFormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as UntypedFormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  maxLength: number = 180;\n\n  constructor(private formBuilder: UntypedFormBuilder) {\n    this.form = this.formBuilder.group({\n      title: ['', [Validators.minLength(0), Validators.maxLength(130)]],\n      subtitle: ['', [Validators.minLength(0), Validators.maxLength(120)]],\n      comment: ['', [Validators.minLength(0), Validators.maxLength(this.maxLength)]],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: [ '', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n      this.commentField.clearValidators();\n      this.commentField.updateValueAndValidity();\n    } else {\n      this.isPrintService = true;\n    }\n  }\n\n  changeCommentLength() {\n    switch (this.paperFormat) {\n      case PrintPaperFormat.A0:\n        // A0, landscape, length 900 | A0, portrait, comment length:  600\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 900 : 600;\n        break;\n      case PrintPaperFormat.A1:\n        // A1, landscape, length 600 | A1, portrait, length 400;\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 600 : 400;\n        break;\n      case PrintPaperFormat.A2:\n        // A2, landscape, length 400 | A2, portrait, length 300;\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 400 : 300;\n        break;\n      case PrintPaperFormat.A3:\n        // A3, landscape, length 300 | A3, portrait, length 200;\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 300 : 200;\n        break;\n      case PrintPaperFormat.A4:\n        // A4, landscape length 200 | A4, portrait length 120;\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 200 : 100;\n        break;\n      case PrintPaperFormat.A5:\n        // A5, landscape length 120 | A5, portrait length 80;\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 120 : 80;\n        break;\n      case PrintPaperFormat.Letter:\n        // lettre, landscape, 180 | lettre, portrait, 140\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 180 : 140;\n        break;\n      default:\n        // legal, landscape, 200 | legal, portrait, 140\n        this.maxLength = (this.orientation === PrintOrientation.landscape) ? 200 : 140;\n        break;\n    }\n\n    this.commentField.setValidators([Validators.maxLength(this.maxLength)]​);\n    this.commentField.updateValueAndValidity();\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\nimport { PrintService } from '../shared/print.service';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html'\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      if (data.legendPosition === 'newpage') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      const resolution = +data.resolution;\n\n      this.printService\n        .downloadMapImage(\n          this.map,\n          resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile,\n          data.legendPosition\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\">\n</igo-print-form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule, IgoMessageModule } from '@igo2/core';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule, IgoLanguageModule, IgoMessageModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\n\nexport abstract class DirectionsSource {\n  abstract enabled: boolean;\n  abstract getName(): string;\n  abstract route(coordinates: [number, number][], directionsOptions: DirectionOptions): Observable<Direction[]>;\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\nimport * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olGeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olProj from 'ol/proj';\n\nimport { uuid, NumberUtils } from '@igo2/utils';\n\nimport { Direction, FeatureWithDirection, FeatureWithStop, Stop } from './directions.interface';\nimport { createOverlayMarkerStyle } from '../../style/shared/overlay/overlay-marker-style.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { LanguageService } from '@igo2/core';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionRelativePositionType, DirectionType } from './directions.enum';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(stopsStore: StopsStore, direction: 'asc' | 'desc' = 'asc', field = 'position') {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(index: number, totalLength): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(stop.position, stopsToComputePosition.length);\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map(stop => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore.all().find(stop => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(lastPosition, stopsStore.count + 1);\n  }\n\n  stopsStore.insert({ id, position: insertPosition, relativePosition: computeRelativePosition(insertPosition, stopsStore.count + 1) });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`, width: 10 })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`, width: 6 })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(stopsFeatureStore: StopsFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.stopLayer'),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(routesFeatureStore: RoutesFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.routeLayer'),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService) {\n  let stopColor;\n  let stopText;\n\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.start');\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.end');\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.intermediate') + ' #' + stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(stop.coordinates, projection, stopsFeatureStore.map.projection)\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute\n    ? previousRoute.meta.revision\n    : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  if (distance >= 1000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route,\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix = modifier === 'straight' ? '' : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'forward';\n  } else if (modifier === 'slight left') {\n    image = 'forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', { route });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', { route, aggregatedDirection, translatedModifier });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', { coma, aggregatedDirection });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', { route });\n      image = 'map-marker';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', { aggregatedDirection });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', { aggregatedDirection });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', { translatedModifier, route });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix = exit === 1 ?\n      translate.instant('igo.geo.directions.cntSuffix.first') :\n      translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', { exit, cntSuffix, route });\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', { translatedDirection, route });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag-variant' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'compass' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(bearing: number, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n\n\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div touchleave  \n  (touchenter)=\"onStopEnter(stop)\"\n  (touchleave)=\"onStopLeave()\"\n  (mouseover)=\"onStopEnter(stop)\"\n  (mouseleave)=\"onStopLeave()\"\n  (cdkDragStarted)=\"stopIsDragged=true\"\n  (cdkDragEnded)=\"stopIsDragged=false\"\n  cdkDragLockAxis=\"y\" class=\"stop-box mat-typography\" *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index;\" cdkDrag>\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field>\n        <input id=\"{{stop.id}}\" type=\"text\"\n            [placeholder]=\"getPlaceholder(stop)\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"stop.text\"\n            aria-label=\"Number\"\n            matInput\n            (focus)=\"onInputFocus(stop)\"\n            [(ngModel)]=\"stop.text\"\n            (keyup)=\"setStopText($event,stop)\"\n            (keydown.enter)=\"$event.preventDefault()\"\n            [matAutocomplete]=\"auto\">\n        <button \n            mat-button \n            *ngIf=\"(stop.text || stop.coordinates) && stopWithHover && stop.id===stopWithHover.id\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n            matSuffix mat-icon-button color=\"warn\" aria-label=\"Clear\" (click)=\"clearStop(stop)\">\n            <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      \n        <mat-autocomplete [displayWith]=\"getOptionText\" #auto=\"matAutocomplete\" (optionSelected)=\"chooseProposal($event,stop)\">\n          <mat-optgroup *ngFor=\"let source of stop.searchProposals\" [label]=\"source.source.title\" [disabled]=\"source.source.enabled === false\">\n          <mat-option *ngFor=\"let result of source.results\" [value]=\"result\" \n          matTooltipShowDelay=\"500\" [matTooltip]=\"result.meta ? result.meta.title : ''\">\n            {{ result.meta ? result.meta.title : '' }}\n          </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n\n\n\n    <div class=\"igo-form-button-group\" *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\">\n      <button class=\"swipe-vertical\" cdkDragHandle mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\" color=\"primary\">\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"(stopsStore.count$ | async)> 2\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\" (click)=\"removeStop(stop)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n      <button *ngIf=\"(stopsStore.count$ | async)<= 2\" disabled=\"true\" mat-icon-button tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\">\n        <mat-icon svgIcon=\"blank\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>","import { Component, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\nimport * as olProj from 'ol/proj';\nimport * as olObservable from 'ol/Observable';\n\nimport { Stop } from '../shared/directions.interface';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { computeRelativePosition, removeStopFromStore, updateStoreSorting } from '../shared/directions.utils';\nimport { MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatOption } from '@angular/material/core';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { LanguageService } from '@igo2/core';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss']\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) { }\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(event: { source: MatAutocomplete, option: MatOption }, stop: Stop) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find(value => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (stop.relativePosition === DirectionRelativePositionType.Intermediate) {\n        extra = ' #' + stop.position;\n      }\n      return this.languageService.translate.instant('igo.geo.directionsForm.' + stop.relativePosition) + extra;\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({ id: stop.id, relativePosition: stop.relativePosition, position: stop.position });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once('singleclick', event => {\n      const clickCoordinates = olProj.transform(\n        event.coordinate,\n        this.stopsFeatureStore.layer.map.projection,\n        this.projection\n      );\n      const roundedCoord = roundCoordTo(clickCoordinates as [number, number], this.coordRoundedDecimals);\n      stop.text = roundedCoord.join(',');\n      stop.coordinates = roundedCoord;\n      this.stopsStore.update(stop);\n      setTimeout(() => {\n        this.stopInputHasFocus.emit(false);\n      }, 500);\n    });\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map(key => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { DirectionsSourceService } from './directions-source.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionsService {\n  constructor(private directionsSourceService: DirectionsSourceService) {}\n\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]>[] {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.directionsSourceService.sources\n      .filter((source: DirectionsSource) => source.enabled)\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions );\n    return request;\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchSource } from './sources/source';\nimport { SearchResult } from './search.interfaces';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  if (feature.properties) {\n    delete feature.properties.geometry;\n    delete feature.properties.GEOMETRIE;\n    delete feature.properties.boundedBy;\n    delete feature.properties.shape;\n    delete feature.properties.SHAPE;\n    delete feature.properties.SHAPE_S;\n    delete feature.properties.SHAPE_L;\n    delete feature.properties.SHAPE_P;\n    delete feature.properties.the_geom;\n    delete feature.properties.geom;\n    delete feature.properties.geom32198;\n  }\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'map-marker'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string){\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(from, to, caseSensitive: boolean = false): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toString().toLowerCase();\n  const termTo = caseSensitive ? to : to.toString().toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = totalDiff.length / termFrom.length * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { Workspace } from '@igo2/common';\nimport { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n\n    /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n    setWorkspaces(source: SearchSource, workspaces: Workspace[]) {\n      source.setWorkspaces(workspaces);\n    }\n}\n","import { Injectable } from '@angular/core';\n\nimport { stringToLonLat } from '../../map';\nimport { MapService } from '../../map/shared/map.service';\n\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\nimport {\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './sources/source.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research } from './search.interfaces';\nimport {\n  sourceCanSearch,\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary\n} from './search.utils';\nimport { StorageService } from '@igo2/core';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchService {\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, { distance: response.radius, conf: response.conf });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    const reverseSearchCoordsFormat = this.storageService.get('reverseSearchCoordsFormatEnabled') as boolean || false;\n\n    return this.reverseSearchSources(sources, lonLat, options || {}, reverseSearchCoordsFormat);\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormat: boolean\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as ReverseSearch).reverseSearch(\n          lonLat,\n          options,\n          reverseSearchCoordsFormat\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","<div class=\"igo-form-button-group\">\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\" color=\"primary\" (click)=\"addStop()\">\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1 || (stopsStore.count$ | async)>=1\"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\" color=\"warn\" (click)=\"resetStops()\">\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyLinkToClipboard()\" \n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n</div>","import { Component, Input, Optional } from '@angular/core';\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\nimport { Clipboard } from '@igo2/utils';\nimport { Subject } from 'rxjs';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { FeatureWithDirection } from '../shared/directions.interface';\n\nimport { addStopToStore, formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss']\n})\nexport class DirectionsButtonsComponent {\n\n  get activeRoute() {\n    return this.routesFeatureStore.all().find(route => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService) { }\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsgLink',\n        'igo.geo.directionsForm.dialog.copyTitle');\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsg',\n        'igo.geo.directionsForm.dialog.copyTitle');\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach(stop => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(\n          ','\n        );\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach(step => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore.all()\n    .map((direction: FeatureWithDirection) => direction.properties.id).indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view.all().map(stop => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n    <mat-form-field *ngIf=\"directions && directions.length > 1\">\n        <mat-select placeholder=\"{{'igo.geo.directionsForm.drivingOptions' | translate}}\"\n            (selectionChange)=\"changeRoute()\" [(ngModel)]=\"activeDirection\">\n            <mat-option *ngFor=\"let direction of directions; let cnt = index;\" [value]=\"direction\">\n                Option {{cnt + 1}} : {{formatDistance(direction.distance)}}\n                ({{formatDuration(direction.duration)}})\n            </mat-option>\n        </mat-select>\n    </mat-form-field>\n\n    <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n    <mat-list (mouseleave)=\"onStepsListBlur()\">\n        <h2 mat-header class=\"igo-route-title mat-typography\">{{activeDirection.title}}</h2>\n        <h2 mat-subheader>{{formatDistance(activeDirection.distance)}}, {{formatDuration(activeDirection.duration)}}</h2>\n        <mat-list-item class=\"igo-steps\" \n            (mouseenter)=\"showSegment(step)\" \n            (click)=\"showSegment(step,true)\" \n            *ngFor=\"let step of activeDirection.steps; let cnt = index;\" igoListItem>\n            <mat-icon [ngClass]=\"formatStep(step,cnt).cssClass\" mat-list-icon svgIcon=\"{{formatStep(step,cnt).image}}\">\n            </mat-icon>\n\n            <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\n            <h4 mat-line class=\"right\">{{formatDistance(step.distance)}}</h4>\n        </mat-list-item>\n\n        <mat-divider></mat-divider>\n\n    </mat-list>\n\n</div>","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Direction, FeatureWithStep, IgoStep } from '../shared/directions.interface';\nimport { formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { DirectionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss']\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) { }\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe(entities => {\n        const activeFeatureWithDirection = entities.find(entity => entity.properties.active);\n        this.directions = entities.map(entity => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection = activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(entity =>\n      entity.properties.active = !entity.properties.active\n    );\n    this.routesFeatureStore.layer.ol.getSource().getFeatures().map(feature =>\n      feature.set('active', !feature.get('active'))\n    );\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(feature.getGeometry().getExtent() as [number, number, number, number]);\n    }\n  }\n\n}\n","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStoreWatcher } from '@igo2/common';\n\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport * as olProj from 'ol/proj';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport Collection from 'ol/Collection';\nimport { SelectEvent } from 'ol/interaction/Select';\n\nimport { DirectionOptions, FeatureWithStopProperties, Stop } from './shared/directions.interface';\nimport { Subject, Subscription } from 'rxjs';\nimport { addDirectionToRoutesFeatureStore, addStopToStopsFeatureStore, addStopToStore,\n  initRoutesFeatureStore, initStepFeatureStore, initStopsFeatureStore, updateStoreSorting } from './shared/directions.utils';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { DirectionsService } from './shared/directions.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { SearchService } from '../search/shared/search.service';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './shared/store';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { QueryService } from '../query/shared/query.service';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n\n  @Input() contextUri: string;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private searchService: SearchService,\n    private queryService: QueryService\n  ) { }\n\n\n  ngOnInit(): void {\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute);\n    this.stopsFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.routesFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore.all().find(route => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(routeExtent as [number, number, number, number]);\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: feature => {\n        return feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating;\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number], this.coordRoundedDecimals);\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus ?\n      this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute) :\n      this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(\n    features: Collection<any>\n  ) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(translationCoordinates as [number, number], this.coordRoundedDecimals);\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(\n        distinctUntilChanged()\n      ).subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map(s => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({ ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates } });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, ['coordinates']);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = (change.newValue as Stop);\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(term, this.stopsFeatureStore.layer.map.projection);\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, { searchType: 'Feature' });\n          this.cancelSearch();\n          const requests$ = researches.map(res => res.request\n            .pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request.pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map(r => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(sp => sp.type === (isCoord ? ProposalType.Coord : ProposalType.Text));\n                  let storedSource = stop.searchProposals.find(sp => sp.source === source);\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter(stop => stop.coordinates);\n    stopsWithCoordinates.map(stop => this.addStopOverlay(stop));\n    this.stopsFeatureStore.all().map(\n      (stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter(stop => !stop.coordinates);\n    stopsWithoutCoordinates.map(stop => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter(stop => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(stop.coordinates, this.coordRoundedDecimals);\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      routeResponse.map(res =>\n        this.routesQueries$$.push(\n          res.subscribe(directions => {\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n            directions.map(direction =>\n              addDirectionToRoutesFeatureStore(\n                this.routesFeatureStore,\n                direction,\n                this.projection,\n                direction === directions[0] ? true : false)\n            );\n          })\n        )\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(stop, this.stopsStore, this.stopsFeatureStore, this.projection, this.languageService);\n  }\n}\n","<igo-directions-buttons [contextUri]=\"contextUri\" [zoomToActiveRoute$]=\"zoomToActiveRoute$\" [routesFeatureStore]=\"routesFeatureStore\" [stopsStore]=\"stopsStore\"></igo-directions-buttons>\n\n<igo-directions-inputs (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\" [coordRoundedDecimals]=\"coordRoundedDecimals\" [projection]=\"projection\" [stopsFeatureStore]=\"stopsFeatureStore\" [stopsStore]=\"stopsStore\" [debounce]=\"debounce\" [length]=\"length\"></igo-directions-inputs>\n<br>\n<igo-directions-results [stepFeatureStore]=\"stepFeatureStore\" [routesFeatureStore]=\"routesFeatureStore\"></igo-directions-results>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsComponent } from './directions.component';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    DragDropModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatListModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatAutocompleteModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  declarations: [\n     DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  providers: [provideDirectionsSourceService()]\n})\nexport class IgoDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpClient, HttpParams, HttpParameterCodec } from '@angular/common/http';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { FEATURE, Feature } from '../../../feature';\nimport { GoogleLinks } from './../../../utils/googleLinks';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : [\n            'adresses',\n            'codes-postaux',\n            'routes',\n            'intersections',\n            'municipalites',\n            'mrc',\n            'regadmin',\n            'lieux'\n          ];\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cycleStop',\n              value: 'haltes_cyclables',\n              enabled: types.indexOf('haltes_cyclables') !== -1,\n              hashtags: ['haltevelo','haltes_cyclables']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.restArea',\n              value: 'haltes_routieres',\n              enabled: types.indexOf('haltes_routieres') !== -1,\n              hashtags: ['halteroute','haltes_routieres']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalité', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['région-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30 || !ecmax\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type:\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(response: IChercheResponse, term: string): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(this.dataToResult(data, term, response));\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: data.icon || 'map-marker',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = hashtag.substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\wÀ-ÿ !\\-\\+\\(\\)\\.\\/½¼¾,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector,\n  ) {\n    super(options, storageService);\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'map-marker',\n        pointerSummaryTitle: this.getSubtitle(data)+ ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport * as olproj from 'ol/proj';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olformat from 'ol/format';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, ReverseSearch } from './source';\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { lonLatConversion, roundCoordTo, convertDDToDMS } from '../../../map/shared/map.utils';\nimport { OsmLinks } from '../../../utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[]\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled?: boolean\n  ): Observable<SearchResult<Feature>[]> {\n    return of([this.dataToResult(lonLat, options, reverseSearchCoordsFormatEnabled)]);\n  }\n\n  private dataToResult(data: [number, number], options: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled: boolean): SearchResult<Feature> {\n\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce((obj, item) => (\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\n\n    const roundedCoordString = (!reverseSearchCoordsFormatEnabled) ?\n      roundCoordTo(data, 6).join(', ') : roundCoordTo(data, 6).reverse().join(', ');\n\n    const roundedCoordStringDMS = (!reverseSearchCoordsFormatEnabled) ?\n      dataDMS.join(', ') : dataDMS.reverse().join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform([data[0], data[1]], 'EPSG:4326', 'EPSG:3857');\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(writer.writeGeometry(polygonGeometry.transform('EPSG:3857', 'EPSG:4326')));\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant('igo.geo.search.coordinates.conf');\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = (!reverseSearchCoordsFormatEnabled) ?\n      this.languageService.translate.instant('igo.geo.search.coordinates.coord'):\n      this.languageService.translate.instant('igo.geo.search.coordinates.reversedCoord');\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = (!reverseSearchCoordsFormatEnabled) ?\n     this.languageService.translate.instant('igo.geo.search.coordinates.coordDMS'):\n     this.languageService.translate.instant('igo.geo.search.coordinates.reversedCoordDMS');\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(\n          properties,\n          coords,\n          {\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n              data[0],\n              data[1]\n            ),\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n            Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n          }\n        ),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'map-marker',\n        score: 100, // every coord exists\n      }\n    };\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * Coordinate search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the Coordinates search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the Coordinate search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { LAYER } from '../../../layer';\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { TextSearchOptions } from './source.interfaces';\nimport {\n  ILayerSearchSourceOptions,\n  ILayerData,\n  ILayerItemResponse,\n  ILayerServiceResponse,\n  ILayerDataSource\n} from './ilayer.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50 || !ecmax\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\wÀ-ÿ !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse, term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n    this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\n      url\n    );\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params: data.properties.format === 'wms' ? {LAYERS: data.properties.name} : undefined,\n        layer: data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(\n    url: string\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = ((value as any) as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach(urlOpt => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, ILayerSearchResultFormatter]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\">\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\">\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\">\n      <mat-radio-button *ngFor=\"let searchType of searchTypes\" [value]=\"searchType\">\n        {{getSearchTypeTitle(searchType) | translate}}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) { this.setSearchType(value); }\n  get searchType(): string { return this.searchType$.value; }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","<div class=\"igo-search-settings\">\n\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\">\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu\n    #searchSettingsMenu=\"matMenu\"\n    class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length>4\">\n      <button mat-raised-button\n        (click)=\"checkUncheckAllSources($event)\">{{!searchSourcesAllEnabled  ? ('igo.geo.search.searchSources.unselectAll' | translate): ('igo.geo.search.searchSources.selectAll' | translate)}}</button>\n    </div>\n      <ng-container *ngFor=\"let source of getSearchSources()\">\n        <span class=\"igo-search-settings-search-source\">\n          <mat-checkbox\n            class=\"igo-search-settings-checkbox\"\n            [checked]=\"source.enabled\"\n            [value]=\"source\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"onCheckSearchSource($event, source)\">\n          </mat-checkbox>\n          <button *ngIf=\"source.settings.length > 0\"\n            [matMenuTriggerFor]=\"sub_menu\"\n            mat-menu-item>{{source.title}}\n          </button>\n          <button\n            mat-menu-item\n            *ngIf=\"source.settings.length === 0\">\n            {{source.title}}\n          </button>\n        </span>\n          <mat-menu #sub_menu=\"matMenu\">\n            <ng-container *ngFor=\"let setting of source.settings\">\n              <button\n                  mat-menu-item\n                  [matMenuTriggerFor]=\"test_sub_menu\">\n                {{'igo.geo.search.searchSources.settings.'+ setting.title | translate}}\n              </button>\n              <mat-menu #test_sub_menu=\"matMenu\"\n                [ngSwitch]=\"setting.type\"\n                yPosition=\"above\">\n                <span *ngSwitchCase=\"'radiobutton'\">\n                  <mat-radio-group\n                    class=\"igo-search-settings-radio-group\"\n                    [value]=\"setting\">\n                    <mat-radio-button *ngFor=\"let settingValue of setting.values\"\n                      class=\"mat-typography\"\n                      [value]=\"settingValue\"\n                      [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                      [checked]=\"settingValue.enabled\"\n                      (click)=\"$event.stopPropagation()\"\n                      (change)=\"settingsValueCheckedRadioButton($event, source, setting, settingValue)\">\n                      {{settingValue.title | translate}}\n                    </mat-radio-button>\n                  </mat-radio-group>\n                </span>\n                <span *ngSwitchCase=\"'checkbox'\">\n                  <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                    <button mat-raised-button\n                      (click)=\"checkUncheckAll($event, source, setting)\">{{setting.allEnabled || setting.allEnabled === undefined  ? ('igo.geo.search.searchSources.settings.unselectAll' | translate): ('igo.geo.search.searchSources.settings.selectAll' | translate)}}</button>\n                  </div>\n                  <mat-checkbox *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                    class=\"mat-menu-item\"\n                    [style.display]=\"displayBlock\"\n                    [checked]=\"settingValue.enabled\"\n                    [value]=\"setting\"\n                    [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                    (click)=\"$event.stopPropagation()\"\n                    (change)=\"settingsValueCheckedCheckbox($event, source, setting, settingValue)\">\n                    {{settingValue.title | translate}}\n                  </mat-checkbox>\n                </span>\n              </mat-menu>\n            </ng-container>\n          </mat-menu>\n      </ng-container>\n        <mat-divider></mat-divider>\n        <span class=\"pointer-summary-slide-toggle-container mat-typography\">\n          <mat-slide-toggle class=\"search-option\" (change)=\"changePointerReverseSearch($event)\" tooltip-position=\"below\"\n            *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\" \n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.pointerSearchSummary.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"pointerSummaryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.pointerSearchSummary.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"search-option\" (change)=\"changeSearchResultsGeometry($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.searchResultsGeometry.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"searchResultsGeometryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.searchResultsGeometry.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"search-option\" (change)=\"reverseSearchCoordsFormat($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"reverseSearchCoordsFormatEnabled ? ('igo.geo.search.reverseCoordFormat.tooltipLatLon' | translate)\n            : ('igo.geo.search.reverseCoordFormat.tooltipLonLat' | translate)\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"reverseSearchCoordsFormatEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.reverseCoordFormat.title' | translate}}\n          </mat-slide-toggle>\n        </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\nimport { MatRadioChange } from '@angular/material/radio';\n\nimport {\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  HostListener,\n  Input\n} from '@angular/core';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\nimport {\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch,\n  sourceCanReverseSearch\n} from '../shared/search.utils';\nimport { MediaService, StorageService } from '@igo2/core';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  @Input() reverseSearchCoordsFormatEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter((source) => !source.enabled)\n      .length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') || {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(\n      source.getId() + '.options',\n      storage\n    );\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n\n  reverseSearchCoordsFormat(event) {\n    this.reverseSearchCoordsFormatEnabled = event.checked;\n    this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SearchSettingsComponent } from './search-settings.component';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  declarations: [SearchSettingsComponent],\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatCheckboxModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule { }\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{empty: empty$ | async}\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{label}}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{'hasSearchIcon': showSearchButton}\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"placeholder ? placeholder : (placeholder$ | async) ? (placeholder$.value | translate) : undefined\"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\">\n  </mat-form-field>\n\n  <div class=\"search-bar-buttons\">\n    <button *ngIf=\"(empty$ | async)===false\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\"\n      [matTooltip]=\"'igo.geo.search.clearSearch' | translate\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n    \n    <button *ngIf=\"showSearchButton\"\n      mat-icon-button\n      [color]=\"color\">\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\">\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      [reverseSearchCoordsFormatEnabled]=\"reverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"reverseSearchCoordsFormatStatus.emit($event)\"\n      (searchSourceChange)=\"onSearchSettingsChange()\">\n    </igo-search-settings>\n  </div>\n</div>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance\n} from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * whether to show search button or not\n   */\n\n  public showSearchButton: boolean = false;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n   @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n   /**\n   * Event emitted when the coords format setting is changed\n   */\n   @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * When reverse coordinates status change\n   */\n  @Input()\n  get reverseSearchCoordsFormatEnabled(): boolean {\n    return this._reverseSearchCoordsFormatEnabled;\n  }\n  set reverseSearchCoordsFormatEnabled(value: boolean) {\n    this._reverseSearchCoordsFormatEnabled = value;\n    this.setTerm(this.term, true);\n  }\n  private _reverseSearchCoordsFormatEnabled = false;\n\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  @Input() appearance: MatFormFieldAppearance = 'legacy';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private configService: ConfigService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(\n        debounce(() => timer(this.debounce))\n      )\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n\n    const configValue = this.configService.getConfig(\"searchBar.showSearchButton\");\n    this.showSearchButton = configValue !== undefined ? configValue : false;\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string, reverseCoordEvent?: boolean) {\n\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term && !reverseCoordEvent) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (this.termSplitter && rawTerm.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = rawTerm.split(this.termSplitter).filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(this.searchService.search(term, {\n        forceNA: this.forceNA\n      }));\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\nimport { SearchBarComponent } from './search-bar.component';\nimport { SearchUrlParamDirective } from './search-url-param.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatFormFieldModule,\n    MatInputModule,\n    IgoLanguageModule,\n    IgoSearchSelectorModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    SearchBarComponent,\n  ],\n  declarations: [\n    SearchBarComponent,\n    SearchUrlParamDirective\n  ]\n})\nexport class IgoSearchBarModule {}\n","<mat-list-item (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\">\n  <mat-icon *ngIf=\"icon\" mat-list-avatar svgIcon=\"{{showIcons ? icon : 'blank'}}\"></mat-icon>\n\n  <h4 matLine *ngIf=\"titleHtml\" [innerHtml]=\"titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"tooltipHtml\" matTooltipClass=\"search-result-tooltip\"></h4>\n  <h4 matLine *ngIf=\"!titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"title\">{{title}}</h4>\n\n  <button *ngIf=\"withZoomButton\"\n    igoStopPropagation\n    mat-icon-button\n    (click)=\"onZoomHandler()\">\n    <mat-icon svgIcon=\"magnify\"></mat-icon>\n  </button>\n\n  <ng-content\n    select=[igoSearchItemToolbar]>\n  </ng-content>\n\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport {\n  getEntityTitle,\n  getEntityTitleHtml,\n  getEntityIcon\n} from '@igo2/common';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    const element = event.target;\n    const type = event.type;\n    switch (type) {\n      case 'mouseenter':\n        const hideBtn = element.querySelector('#hide-save-search-result-btn');\n        (hideBtn) ?\n        hideBtn.setAttribute('id', 'show-save-search-result-btn') : null;\n        break;\n      case 'mouseleave':\n        const showBtn = element.querySelector('#show-save-search-result-btn');\n        (showBtn) ?\n        showBtn.setAttribute('id', 'hide-save-search-result-btn') : null;\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<igo-list [navigation]=\"true\" *ngIf=\"tabsMode === false\">\n  <ng-template\n    #groupTemplate\n    ngFor let-group\n    [ngForOf]=\"results$ | async\">\n\n    <igo-collapsible [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\">\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\">\n\n          <ng-container igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{result: result}\">\n          </ng-container>\n\n        </igo-search-results-item>\n      </ng-template>\n      <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n\n  </ng-template>\n\n</igo-list>\n\n<igo-list [navigation]=\"true\" *ngIf=\"tabsMode\">\n\n  <ng-container *ngIf=\"mode === searchResultMode.Grouped; then tabsTemplate else flatTemplate\"></ng-container>\n\n  <ng-template #tabsTemplate>\n    <mat-tab-group class=\"custom-tabs-view\" dynamicHeight>\n      <mat-tab *ngFor=\"let group of results$ | async\" [label]=\"computeGroupTitle(group)\">\n        <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {group: group}\"></ng-container>\n      </mat-tab>\n    </mat-tab-group>\n  </ng-template>\n\n  <ng-template #flatTemplate>\n    <ng-template ngFor let-group [ngForOf]=\"results$ | async\">\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {group: group}\"></ng-container>\n    </ng-template>\n  </ng-template>\n\n  <ng-template #storeItemTemplate let-group=\"group\">\n    <ng-template ngFor let-result [ngForOf]=\"group.results\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [map]=\"map\"\n        [result]=\"result\"\n        [showIcons]=\"showIcons\"\n        [withZoomButton]=\"withZoomButton\"\n        [focused]=\"store.state.get(result).focused\"\n        [selected]=\"store.state.get(result).selected\"\n        (focus)=\"resultFocus.emit(result)\"\n        (unfocus)=\"resultUnfocus.emit(result)\"\n        (select)=\"onResultSelect(result)\"\n        (mouseenter)=\"resultFocus.emit(result)\"\n        (mouseleave)=\"resultUnfocus.emit(result)\">\n\n        <ng-container igoSearchItemToolbar\n          [ngTemplateOutlet]=\"templateSearchToolbar\"\n          [ngTemplateOutletContext]=\"{result: result}\">\n        </ng-container>\n\n      </igo-search-results-item>\n    </ng-template>\n    <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\n      <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n    </span>\n  </ng-template>\n</igo-list>","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ContentChild,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { EntityState, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreWatcher } from '@igo2/common';\n\nimport { IgoMap } from '../../map';\n\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchSource } from '../shared/sources/source';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n\n  private showResultsCount: boolean = true;\n\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: {sourceId: string}[] = [];\n\n  public collapsed: {sourceId: string}[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * To check if the view for tabsMode for search-result-tools\n   */\n  @Input() tabsMode: boolean = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {}) templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    {source: SearchSource; results: SearchResult[]}[]\n  >;\n\n  constructor(private cdRef: ChangeDetectorRef,\n              private searchService: SearchService,\n              private configService: ConfigService,\n              ) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n\n    if (this.configService.getConfig('searchSources.showResultsCount') === false) {\n      this.showResultsCount = false;\n    }\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1 && this.showResultsCount) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, {focused: true, selected: true}, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n   private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    return this.store.stateView.all$().pipe(\n      debounce((results: {entity: SearchResult, state: EntityState}[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: {entity: SearchResult, state: EntityState}[]) => {\n        return this.groupResults(results.map(r => r.entity).sort(this.sortByOrder));\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return {source, results: grouped.get(source)};\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const stategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    const active = stategy?.active || false;\n    if (!active) {\n      return group.results && group.results[group.results.length - 1].meta.nextPage === true;\n    } else {\n      return group.results?.length % +group.source.params.limit === 0 && + group.source.params.page < 30;\n    }\n\n  }\n\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (this.termSplitter && this.term.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map(research => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({research, results: newResults});\n      });\n    });\n    return;\n  }\n}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.layer.saveFeatureInLayer' | translate}}</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <igo-list [navigation]=\"false\" [selection]=\"false\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [result]=\"feature\"\n        showIcons=\"true\">\n      </igo-search-results-item>\n    </igo-list>\n    \n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\"\n          placeholder=\"{{'igo.geo.layer.chooseOrSet' | translate}}\"\n          matInput\n          [matAutocomplete]=\"auto\"\n          formControlName=\"layerName\">\n        <mat-autocomplete [displayWith]=\"displayFn\" #auto=\"matAutocomplete\">\n          <mat-option *ngFor=\"let layer of filteredLayers$ | async\" [value]=\"layer\">\n            <p mat-line>{{layer.title}}</p>\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group create-layer-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.layer.cancelBtn' | translate}}\n    </button>\n    <button\n      id=\"createLayerBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"save()\">\n      {{'igo.geo.layer.saveBtn' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService } from '@igo2/core';\nimport { Component, OnInit, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormBuilder, UntypedFormGroup, Validators } from '@angular/forms';\nimport { Layer } from '../../layer';\nimport { SearchResult } from '../shared';\nimport { Observable } from 'rxjs';\nimport { map, startWith } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-save-feature-dialog',\n  templateUrl: './save-feature-dialog.component.html',\n  styleUrls: ['./save-feature-dialog.component.scss']\n})\nexport class SaveFeatureDialogComponent implements OnInit {\n\n  public form: UntypedFormGroup;\n  feature: SearchResult;\n  layers: Layer[] = [];\n  filteredLayers$: Observable<Layer[]>;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<SaveFeatureDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { feature: SearchResult; layers: Layer[]}\n  ) {\n    this.form = this.formBuilder.group({\n      layerName: ['', [Validators.required]],\n    });\n  }\n\n  ngOnInit() {\n    this.feature = this.data.feature;\n    this.layers = this.data.layers;\n    this.filteredLayers$ = this.form.controls['layerName'].valueChanges.pipe(\n      startWith(''),\n      map(val => this.filter(val))\n    );\n  }\n\n  private filter(val): Layer[] {\n    if(typeof val !== 'string'){\n      return;\n    }\n    return this.layers.map(l => l).filter(layer =>\n      layer?.title?.toLowerCase().includes(val.toLowerCase()));\n  }\n\n  displayFn(layer: Layer): string {\n    return layer && layer.title ? layer.title: '';\n  }\n\n  save() {\n    const data: {layer: string | Layer, feature: SearchResult} = {layer: this.form.value.layerName, feature: this.feature};\n    this.dialogRef.close(data);\n  }\n\n  cancel() {\n    this.dialogRef.close();\n  }\n}\n","<button\nigoStopPropagation\n(mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n*ngIf=\"layer.meta.dataType === 'Layer'\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"computeTooltip() | translate\"\n[color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n(click)=\"onToggleClick($event)\">\n<mat-icon\n  matBadge=\"icon\"\n  [igoMatBadgeIcon]=\"getBadgeIcon()\"\n  igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n  igoMatBadgeBackgroundColor=\"none\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"((inRange$ | async) && (isVisible$ | async) === true) || ((inRange$ | async) && !added) || ((inRange$ | async) && (isPreview$ | async))\"\n  [matBadgeDisabled]=\"(inRange$ | async) === false\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n</mat-icon>\n</button>\n\n<button\n[id]=\"(!isMobile) ? 'hide-save-search-result-btn' : ''\"\nigoStopPropagation\n*ngIf=\"layer.meta.dataType === 'Feature' && saveSearchResultInLayer\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"(addFeatureToLayerTooltip$ | async) | translate\"\n(click)=\"addFeatureToLayer()\">\n<mat-icon\n  matBadge=\"icon\"\n  igoMatBadgeIcon=\"eye-off\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"(inRange$ | async)\"\n  matBadgeDisabled=\"true\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  svgIcon=\"file-plus-outline\">\n</mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy,\n} from '@angular/core';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { Subscription, BehaviorSubject, take } from 'rxjs';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\nimport { MatDialog } from '@angular/material/dialog';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { DataSourceService, FeatureDataSource } from '../../datasource';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  tryBindStoreLayer\n} from '../../feature';\nimport { EntityStore } from '@igo2/common';\nimport { getTooltipsOfOlGeometry } from '../../measure';\nimport OlOverlay from 'ol/Overlay';\nimport Stroke from 'ol/style/Stroke';\nimport Fill from 'ol/style/Fill';\nimport Style from 'ol/style/Style';\nimport Circle from 'ol/style/Circle';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport { QueryableDataSourceOptions } from '../../query';\nimport { Media, MediaService } from '@igo2/core';\n\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy{\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  public addFeatureToLayerTooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.addToLayer'\n  );\n\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * show hide save search result in layer button\n   */\n  @Input() saveSearchResultInLayer: boolean = false;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input() stores: FeatureStore<Feature>[] = [];\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-search-layer')\n    );\n  }\n  private mediaService$$: Subscription;\n  public isMobile: boolean = false;\n  constructor(\n    private layerService: LayerService,\n    private dialog: MatDialog,\n    private dataSourceService: DataSourceService,\n    private mediaService: MediaService) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    // check the view if is mobile or not\n    this.mediaService$$ = this.mediaService.media$.subscribe(\n      (media: Media) => {\n        if(media === Media.Mobile) {\n          this.isMobile = true;\n        }\n      }\n    );\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          lay => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\n      this.isInResolutionsRange(value);\n      this.isVisible();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n    if (this.mediaService$$) {\n      this.mediaService$$.unsubscribe();\n    }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(currEvent: Event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    const event = currEvent ? currEvent : {} as Event;\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap(event);\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map(s => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap(event?: Event) {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService\n        .createAsyncLayer(layerOptions)\n        .subscribe(layer => {\n          if (event.type === 'click') {\n            this.map.layersAddedByClick$.next([layer]);\n          }\n          this.map.addLayer(layer);\n        })\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.data?.sourceOptions?.id) {\n      const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n      oLayer ? this.isVisible$.next(oLayer.visible) : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.value) {\n      return this.isVisible$.value ? '' : 'eye-off';\n    } else {\n      return 'eye-off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n\n  addFeatureToLayer() {\n    if (this.layer.meta.dataType !== 'Feature') {\n      return;\n    }\n\n    const selectedFeature = this.layer;\n    const dialogRef = this.dialog.open(SaveFeatureDialogComponent, {\n      width: '700px',\n      data: {\n        feature: selectedFeature,\n        layers: this.allLayers\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((data: {layer: string | any, feature: SearchResult}) => {\n      if (data) {\n        if(this.stores.length > 0) {\n          this.stores.map((store) => {\n            store.state.updateAll({selected: false});\n            (store?.layer).visible = false;\n            return store;\n          });\n        }\n        // check if is new layer\n        if (typeof data.layer === 'string') {\n          this.createLayer(data.layer, data.feature);\n        } else {\n          const activeStore = this.stores.find(store => store.layer.id === data.layer.id);\n          activeStore.layer.visible = true;\n          activeStore.layer.opacity = 1;\n          this.addFeature(data.feature, activeStore);\n        }\n      }\n    });\n  }\n\n  createLayer(layerTitle: string, selectedFeature: SearchResult) {\n    const activeStore: FeatureStore<Feature> = new FeatureStore<Feature>([], {\n      map: this.map\n    });\n\n    const styles = [\n      new Style({\n        image: new Circle({\n          radius: 5,\n          stroke: new Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new Fill({\n            color: 'rgba(143,7,7,1)'\n          })\n        })\n      }),\n      new Style({\n        stroke: new Stroke({\n          width: 1,\n          color: 'rgba(143,7,7,1)'\n        }),\n        fill: new Fill({\n          color: 'rgba(0, 0, 255, 0.1)',\n        }),\n      })\n    ];\n\n    // set layer id\n    let layerCounterID: number = 0;\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-search-layer',''));\n      layerCounterID = Math.max(numberId,layerCounterID);\n    }\n\n    this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: FeatureDataSource) => {\n          let searchLayer: VectorLayer = new VectorLayer({\n            isIgoInternalLayer: true,\n            id: 'igo-search-layer' + ++layerCounterID,\n            title: layerTitle,\n            source: dataSource,\n            igoStyle: {\n              editable: false,\n              igoStyleObject: {\n                fill: { color: 'rgba(255,255,255,0.4)' },\n                stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n                circle: {\n                  fill: { color: 'rgba(255,255,255,0.4)', },\n                  stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n                  radius: 5,\n                }\n              }\n            },\n            style: styles,\n            showInLayerList: true,\n            exportable: true,\n            workspace: {\n              enabled: true\n            }\n          });\n\n          tryBindStoreLayer(activeStore, searchLayer);\n          tryAddLoadingStrategy(\n            activeStore,\n            new FeatureStoreLoadingStrategy({\n              motion: FeatureMotion.None\n            })\n          );\n\n          tryAddSelectionStrategy(\n            activeStore,\n            new FeatureStoreSelectionStrategy({\n              map: this.map,\n              motion: FeatureMotion.None,\n              many: true\n            })\n          );\n\n          activeStore.layer.visible = true;\n          activeStore.source.ol.on(\n            'removefeature',\n            (event: OlVectorSourceEvent<OlGeometry>) => {\n              const olGeometry = event.feature.getGeometry();\n              this.clearLabelsOfOlGeometry(olGeometry);\n            }\n          );\n\n          this.addFeature(selectedFeature, activeStore);\n          this.stores.push(activeStore);\n        });\n  }\n\n  addFeature(feature: SearchResult, activeStore: FeatureStore<Feature>) {\n    const newFeature = {\n      type: feature.data.type,\n      geometry: {\n        coordinates: feature.data.geometry.coordinates,\n        type: feature.data.geometry.type\n      },\n      projection: feature.data.projection,\n      properties: feature.data.properties,\n      meta: {\n        id: feature.meta.id\n      }\n    };\n    delete newFeature.properties.Route;\n    activeStore.update(newFeature);\n    activeStore.setLayerExtent();\n    activeStore.layer.ol.getSource().refresh();\n  }\n\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoMatBadgeIconModule,\n  IgoStopPropagationModule\n} from '@igo2/common';\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchResultsItemComponent } from './search-results-item.component';\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatDialogModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoMatBadgeIconModule,\n    IgoMetadataModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n  ],\n  exports: [\n    SearchResultsComponent,\n    SearchResultAddButtonComponent\n  ],\n  declarations: [\n    SearchResultsComponent,\n    SearchResultsItemComponent,\n    SearchResultAddButtonComponent,\n    SaveFeatureDialogComponent\n  ]\n})\nexport class IgoSearchResultsModule {}\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  AfterContentChecked\n} from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchService } from './search.service';\n\nimport olFeature from 'ol/Feature';\nimport { transform } from 'ol/proj';\nimport * as olgeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\n\nimport { SearchResult, Research } from './search.interfaces';\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSourceService } from './search-source.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\nimport { pointerPositionSummaryMarkerStyle } from '../../style/shared/feature/feature-style';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]'\n})\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\n\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], {map: this.map});\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id : 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\n        this.hasPointerReverseSearchSource = false;\n      } else {\n        this.hasPointerReverseSearchSource = true;\n      }\n    }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map(result => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map(result => {\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map(s => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n    /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n     private sortByOrder(r1: SearchResult, r2: SearchResult) {\n      return r1.source.displayOrder - r2.source.displayOrder;\n    }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          }));\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore.all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n/**\n * Clear the pointer store features\n */\nprivate clearLayer() {\n  if (this.store) {\n    this.store.clearLayer();\n  }\n}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\n\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\" \n  [map]=\"map\" >\n</igo-ogc-filterable-item>","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFilterModule } from '../../../filter/filter.module';\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFilterModule\n  ],\n  exports: [OgcFilterComponent],\n  declarations: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\nimport olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { FeatureCommonVectorStyleOptions } from './vector-style.interface';\n\nimport { createOverlayDefaultStyle } from '../overlay/overlay-style.utils';\nimport { createOverlayMarkerStyle } from '../overlay/overlay-marker-style.utils';\n\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 1,\n    markerOutlineColor = [0, 255, 255],\n    fillColor,\n    fillOpacity = 0.15,\n    strokeColor = [0, 255, 255],\n    strokeOpacity = 0.5,\n    strokeWidth = 4\n  }: FeatureCommonVectorStyleOptions): olStyle.Style {\n\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 0.5,\n    markerOutlineColor,\n    fillColor = [0, 161, 222],\n    fillOpacity = 0.15,\n    strokeColor = [0, 161, 222],\n    strokeOpacity = 0.5,\n    strokeWidth = 2\n  }: FeatureCommonVectorStyleOptions): olStyle.Style {\n\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (markerColorAsArray.length === 4 &&\n        (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (!(fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' || /^#[0-9A-F]{8}$/i.test(fillColor as string)))) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (!(strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' || /^#[0-9A-F]{8}$/i.test(strokeColor as string)))) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { WfsWorkspace } from './wfs-workspace';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { EditionWorkspace } from './edition-workspace';\nimport { Observable } from 'rxjs';\nimport { EntityStoreFilterCustomFuncStrategy, EntityRecord, EntityTableColumnRenderer, EntityTableButton } from '@igo2/common';\nimport { map } from 'rxjs/operators';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { StorageScope } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { IgoMap } from '../../map/shared/map';\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\nimport { LayerService } from '../../layer';\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean || true;\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(`workspace.rowsInMapExtent.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return storageService.get(`workspace.selectedOnly.${layerId}`) as boolean || false;\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(`workspace.selectedOnly.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function mapExtentStrategyActiveToolTip(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<string> {\n  return ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy).active$.pipe(\n    map((active: boolean) => active ? 'igo.geo.workspace.inMapExtent.active.tooltip' : 'igo.geo.workspace.inMapExtent.inactive.tooltip')\n  );\n}\n\nexport function noElementSelected(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<boolean> {\n  return ws.entityStore.stateView.manyBy$((record: EntityRecord<Feature>) => {\n    return record.state.selected === true;\n  }).pipe(\n    map((entities: EntityRecord<Feature>[]) => entities.length >= 1)\n  );\n}\n\nexport function addOrRemoveLayer(\n  action: 'add' | 'remove',\n  map: IgoMap,\n  url: string,\n  type: string,\n  layerName: string,\n  layerService: LayerService) {\n  const so = ObjectUtils.removeUndefined({\n    sourceOptions: {\n      type: type,\n      url,\n      optionsFromCapabilities: true,\n      optionsFromApi: true,\n      params: {\n        LAYERS: type === 'wms' ? layerName : undefined,\n        LAYER: type === 'wms' ? undefined : layerName,\n      }\n    }\n  });\n  if (action === 'add') {\n    layerService\n      .createAsyncLayer(so)\n      .subscribe(layer => {\n        map.layersAddedByClick$.next([layer]);\n        map.addLayer(layer);\n      });\n  } else if (action === 'remove') {\n    const addedLayerId = generateIdFromSourceOptions(so.sourceOptions);\n    map.removeLayer(map.layers.find(l => l.id === addedLayerId));\n  }\n}\n\nexport function getGeoServiceAction(workspace: FeatureWorkspace | WfsWorkspace, layerService: LayerService) {\n  const geoServiceAction = [{\n    name: 'geoServiceAction',\n    title: undefined,\n    tooltip: '',\n    renderer: EntityTableColumnRenderer.ButtonGroup,\n    valueAccessor: (entity: Feature, record: EntityRecord<Feature>) => {\n      let geoServiceProperties = record.state.geoService;\n      if (\n        geoServiceProperties &&\n        geoServiceProperties.haveGeoServiceProperties &&\n        geoServiceProperties.url &&\n        geoServiceProperties.layerName\n      ) {\n        if (geoServiceProperties.added) {\n          return [{\n            icon: 'delete',\n            color: 'warn',\n            click: (row, record) => {\n              addOrRemoveLayer('remove', workspace.map, record.state.geoService.url,\n                record.state.geoService.type, record.state.geoService.layerName, layerService);\n              geoServiceProperties.added = false;\n            }\n          }] as EntityTableButton[];\n        } else {\n          return [{\n            icon: 'plus',\n            color: 'primary',\n            click: (row, record) => {\n              addOrRemoveLayer('add', workspace.map, record.state.geoService.url,\n                record.state.geoService.type, record.state.geoService.layerName, layerService);\n              geoServiceProperties.added = true;\n            }\n          }] as EntityTableButton[];\n        }\n      } else {\n        return [];\n      }\n    },\n  }];\n  return geoServiceAction;\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature';\nimport { LayerService, VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions, CapabilitiesService } from '../../datasource';\nimport { PropertyTypeDetectorService} from '../../utils';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\n\nimport { WfsWorkspace } from './wfs-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getGeoServiceAction } from './workspace.utils';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy({ map }, this.propertyTypeDetectorService, this.capabilitiesService);\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const geoServiceAction = getGeoServiceAction(workspace, this.layerService);\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        columnsFromFeatures.unshift(...geoServiceAction);\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.unshift(...geoServiceAction);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate } from '@igo2/common';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { CapabilitiesService, RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { WfsWorkspace } from './wfs-workspace';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\nimport { getGeoServiceAction } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private capabilitiesService: CapabilitiesService,\n    private styleService: StyleService,\n    private configService: ConfigService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(lay => lay.id === layer.id + '.WfsWorkspaceTableDest') ||\n      layer.dataSource.options.edition) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n\n    let wks;\n    let wksLayerOption = {\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        style: this.styleService.createStyle(\n          {\n            fill: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            stroke: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            circle: {\n              fill: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              stroke: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              radius: 5\n            }\n          }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          queryFormatAsWms: layer.options.workspace?.enabled ? (dataSource.options as QueryableDataSourceOptions).queryFormatAsWms : true,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            enabled: true,\n            srcId: layer.id,\n            workspaceId: workspaceLayer.id,\n            queryOptions: {\n              mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n              tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n            },\n            pageSize: layer.options.workspace?.pageSize,\n            pageSizeOptions: layer.options.workspace?.pageSizeOptions\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy({ map }, this.propertyTypeDetectorService, this.capabilitiesService);\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const geoServiceAction = getGeoServiceAction(workspace, this.layerService);\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        columnsFromFeatures.unshift(...geoServiceAction);\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.unshift(...geoServiceAction);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { LanguageService } from '@igo2/core';\nimport { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n    selector: 'igo-confirmation-popup-component',\n    templateUrl: './confirmation-popup.component.html',\n    styleUrls: ['./confirmation-popup.component.scss']\n  })\n  export class ConfirmationPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n      public languageService: LanguageService,\n      @Inject(MAT_DIALOG_DATA) public data: {type: string, cancel: boolean}) {}\n\n    cancelAction() {\n      this.data.cancel = true;\n      this.dialogRef.close(this.data.cancel);\n    }\n\n    confirmedAction() {\n      this.data.cancel = false;\n      this.dialogRef.close(this.data.cancel);\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{data.type === 'add' ?\n    languageService.translate.instant('igo.geo.workspace.addConfirmation') :\n    languageService.translate.instant('igo.geo.workspace.deleteConfirmation')}}</p>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    (click)=\"confirmedAction()\">Ok\n  </button>\n  <button\n    mat-raised-button\n    (click)=\"cancelAction()\">{{languageService.translate.instant('igo.geo.workspace.cancel')}}\n  </button>\n</div>","import { MatDialog } from '@angular/material/dialog';\nimport {\n  Workspace,\n  WorkspaceOptions,\n  EntityRecord\n} from '@igo2/common';\nimport { ConfigService } from '@igo2/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { EditionWorkspaceService } from './edition-workspace.service';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\nimport { DrawControl } from '../../geometry';\nimport { createInteractionStyle, GeometryType } from '../../draw';\nimport { featureToOl } from '../../feature';\n\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport OlModify from 'ol/interaction/Modify';\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport { FeatureDataSource } from '../../datasource/shared';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): ImageLayer | VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.edit === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    protected options: EditionWorkspaceOptions,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private dialog: MatDialog,\n    private configService: ConfigService) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: {type: 'delete'}\n    });\n\n      dialogRef.afterClosed().subscribe(result => {\n        if (result === false) {\n          let id, url;\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl = workspace.layer.dataSource.options.edition.deleteUrl;\n          if (baseUrl.length) {\n            url = this.configService.getConfig('edition.url') ?\n              this.configService.getConfig('edition.url') + baseUrl + '?' + deleteUrl :\n              baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url') ?\n              this.configService.getConfig('edition.url') + deleteUrl : deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.editionWorkspaceService.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns ) {\n\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.editionWorkspaceService.getDomainValues(column.relation).subscribe(result => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(JSON.stringify(feature.properties));\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      workspace.entityStore.state.updateAll({ edit: false });\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.editionWorkspaceService.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(feature, { newFeature: true }, true);\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: Type, feature, workspace: EditionWorkspace) {\n      this.drawControl.setGeometryType(geometryType);\n      this.toggleDrawControl(feature, workspace);\n    }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.addFeatureToStore(feature, workspace, olGeometry);\n    });\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(feature, workspace: EditionWorkspace, olGeometry?: OlGeometry) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    } else {\n      workspace.entityStore.state.update(feature, { edit: true }, true);\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(olFeature: OlFeature<OlGeometry>, feature, workspace: EditionWorkspace) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach(feature => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate,\n  EntityTableButton} from '@igo2/common';\nimport { ConfigService, MessageService, StorageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspace } from './edition-workspace';\n\nimport WKT from 'ol/format/WKT';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport olFeature from 'ol/Feature';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(undefined);\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n  public wktFormat = new WKT();\n  public geoJsonFormat = new GeoJSON();\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    private styleService: StyleService,\n    public authInterceptor?: AuthInterceptor) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (layer.options.workspace?.enabled !== true || layer.dataSource.options.edition.enabled !== true) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        style: this.styleService.createStyle(\n          {\n            fill: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            stroke: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            circle: {\n              fill: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              stroke: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              radius: 5\n            }\n          }),\n          sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        }, this, this.dialog, this.configService);\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            wksConfig\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: EditionWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [{\n      name: 'edition',\n      title: undefined,\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      primary: false,\n      valueAccessor: () => {\n        return [{\n          editMode: false,\n          icon: 'pencil',\n          color: 'primary',\n          disabled: layer.dataSource.options.edition.modifyButton === false ? true : false,\n          click: (feature) => { workspace.editFeature(feature, workspace); }\n        },\n        {\n          editMode: false,\n          icon: 'delete',\n          color: 'warn',\n          disabled: layer.dataSource.options.edition.deleteButton === false ? true : false,\n          click: (feature) => { workspace.deleteFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'check',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.saveFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'alpha-x',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.cancelEdit(workspace, feature); }\n        }] as EntityTableButton[];\n      }\n    }];\n\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: rendererType,\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: false,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        linkColumnForce: field.linkColumnForce,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation).subscribe(result => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)){\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n    let url = this.configService.getConfig('edition.url');\n\n    if (!url) {\n      url = baseUrl;\n    } else {\n      url += baseUrl ? baseUrl : '';\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (workspace.layer.dataSource.options.edition.modifyProtocol !== \"post\") {\n        url += '?' + workspace.layer.dataSource.options.edition.modifyUrl + feature.idkey;\n      }\n      else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole = workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders = workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest = workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      feature.properties[workspace.layer.dataSource.options.params.fieldNameGeometry] =\n      'SRID=' + projDest.replace(\"EPSG:\", \"\") + ';' + this.wktFormat.writeGeometry(\n        this.geoJsonFormat.readFeature(feature.geometry).getGeometry().transform('EPSG:4326', projDest),\n        { dataProjection: projDest });\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || (sf.name === property && sf.validation?.send === false)) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http.post(`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        workspace.entityStore.stateView.clear();\n        workspace.deleteDrawings();\n        workspace.entityStore.delete(feature);\n\n        this.messageService.success('igo.geo.workspace.addSuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        this.adding$.next(false);\n        this.rowsInMapExtentCheckCondition$.next(true);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        this.messageService.success('igo.geo.workspace.deleteSuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach(message => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error('igo.geo.workspace.addError');\n            }\n          } else {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n      }\n    );\n  }\n\n  public modifyFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}, protocole = 'patch' ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest = workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      // Remove 3e dimension\n      feature.geometry.coordinates = removeZ(feature.geometry.coordinates);\n      feature.properties[workspace.layer.dataSource.options.params.fieldNameGeometry] =\n        'SRID=' + projDest.replace(\"EPSG:\", \"\") + ';' + this.wktFormat.writeGeometry(\n          this.geoJsonFormat.readFeature(feature.geometry).getGeometry().transform('EPSG:4326', projDest),\n          { dataProjection: projDest });\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || (sf.name === property && sf.validation?.send === false)\n          || property === 'boundedBy') {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        this.messageService.success('igo.geo.workspace.modifySuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n    workspace.entityStore.stateView.clear();\n\n    if (feature.newFeature) {\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(relation: RelationOptions): Observable<any> {\n    let url = relation.url;\n    if (!url) {\n      url = this.configService.getConfig('edition.url') ?\n        this.configService.getConfig('edition.url') + relation.table : relation.table;\n    }\n\n    return this.http.get<any>(url).pipe(\n      map(result => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        err.error.caught = true;\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: IgoMap) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader = (extent, resolution, proj, success, failure) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(layer.id.substr(0, layer.id.indexOf('.') - 1)) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      )\n        {\n          const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n          let params = wmsOlLayer.getParams();\n          params._t = new Date().getTime();\n          wmsOlLayer.updateParams(params);\n        }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    let message;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys( column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (column.validation[type] && (!feature.properties.hasOwnProperty(key) || !feature.properties[key])) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.mandatory',\n                  undefined,\n                  undefined,\n                  {column: column.title});\n              }\n              break;\n            }\n            case 'minValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] < column.validation[type]) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  });\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] > column.validation[type]) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  });\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length < column.validation[type])\n              {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  });\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length > column.validation[type])\n              {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  });\n              }\n              break;\n            }\n            }\n          });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.type === 'list' && feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[getColumnKeyWithoutPropertiesTag(column.name)].toString();\n      }\n\n    });\n  }\n\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n\nfunction removeZ(coords: any) {\n  if (coords.length === 0) return coords;\n  if (typeof coords[0] === 'number') return coords.slice(0, 2);\n  return coords.map(removeZ);\n}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreSearchIndexStrategy,\n  GeoPropertiesStrategy\n} from '../../feature';\nimport { LayerService, VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions, CapabilitiesService } from '../../datasource';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\n\nimport { FeatureWorkspace } from './feature-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getGeoServiceAction } from './workspace.utils';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n    ) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const searchStrategy = new FeatureStoreSearchIndexStrategy({\n      percentDistinctValueRatio: 2,\n      sourceFields: layer.dataSource.options.sourceFields\n    });\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy({ map }, this.propertyTypeDetectorService, this.capabilitiesService);\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    if (layer.options.workspace?.searchIndexEnabled) {\n      store.addStrategy(searchStrategy, true);\n    }\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: FeatureWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const geoServiceAction = getGeoServiceAction(workspace, this.layerService);\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        columnsFromFeatures.unshift(...geoServiceAction);\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.unshift(...geoServiceAction);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Directive, Input, OnInit, OnDestroy, Output, EventEmitter } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\n\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]'\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.adding$.subscribe((adding) => { this.disableSwitch.emit(adding); });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => { this.relationLayers.emit(layers); });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe((condition) => {\n      this.rowsInMapExtentCheckCondition.emit(condition);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n        layer.dataSource instanceof FeatureDataSource &&\n        (layer as VectorLayer).exportable === true &&\n        layer.dataSource.options.edition?.enabled !== true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled === true) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceSelectorDirective\n  ],\n  declarations: [\n    WorkspaceSelectorDirective\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceUpdatorDirective\n  ],\n  declarations: [\n    WorkspaceUpdatorDirective\n  ]\n})\nexport class IgoWorkspaceUpdatorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatButtonToggleModule\n  ],\n  exports: [ConfirmationPopupComponent],\n  declarations: [ConfirmationPopupComponent]\n})\nexport class IgoConfirmationPopupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport { provideOgcFilterWidget } from './widgets/widgets';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoWidgetModule,\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    MatDialogModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    IgoConfirmationPopupModule\n  ],\n  declarations: [],\n  providers: [\n    provideOgcFilterWidget()\n  ]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListService } from './style-list.service';\nimport { StyleListOptions } from './style-list.interface';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoStyleListModule {\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\n    return {\n      ngModule: IgoStyleListModule,\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\n    };\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { ColorPickerModule } from 'ngx-color-picker';\nimport { IgoStyleListModule } from './style-list/style-list.module';\nimport { StyleModalDrawingComponent } from './style-modal/drawing/style-modal-drawing.component';\nimport { StyleModalLayerComponent } from './style-modal/layer/style-modal-layer.component';\nimport { StyleModalLayerButtonComponent } from './style-modal/layer-button/style-modal-layer-button.component';\nimport { DrawStyleService } from './style-service/draw-style.service';\nimport { StyleService } from './style-service/style.service';\n\n@NgModule({\n  imports: [\n    ColorPickerModule,\n    CommonModule,\n    FormsModule,\n    IgoLanguageModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatButtonModule,\n    MatInputModule,\n    MatSelectModule,\n    MatTooltipModule,\n    ReactiveFormsModule,\n    IgoStyleListModule.forRoot()\n  ],\n  exports: [IgoStyleListModule, StyleModalDrawingComponent, StyleModalLayerComponent, StyleModalLayerButtonComponent],\n  declarations: [StyleModalDrawingComponent, StyleModalLayerComponent, StyleModalLayerButtonComponent]\n})\nexport class IgoStyleModule {\n  static forRoot(): ModuleWithProviders<IgoStyleModule> {\n    return {\n      ngModule: IgoStyleModule,\n      providers: [StyleService, DrawStyleService]\n    };\n  }\n}\n","import { EntityStore } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureWithDirection, FeatureWithStep, FeatureWithStop, Stop } from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n\n    public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n    public clearStops() {\n        this.storeInitialized$.next(false);\n        this.clear();\n    }\n\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {\n\n}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {\n\n}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Cacheable } from 'ts-cacheable';\n\nimport { uuid } from '@igo2/utils';\nimport { ConfigService } from '@igo2/core';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\n\nimport { DirectionsSource } from './directions-source';\nimport { DirectionsSourceOptions } from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get enabled(): boolean {\n    return this.options.enabled !== false;\n  }\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  static _name = 'OSRM Québec';\n  private directionsUrl =\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\n  private options: DirectionsSourceOptions;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    super();\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\n    this.directionsUrl = this.options.url || this.directionsUrl;\n  }\n\n  getName(): string {\n    return OsrmDirectionsSource._name;\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.http\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\n        params: directionsParams\n      })\n      .pipe(map(res => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach(route => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\n    directionsOptions.steps = directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries = directionsOptions.geometries !== undefined ? directionsOptions.geometries : 'geojson';\n    directionsOptions.overview = directionsOptions.overview !== undefined ? directionsOptions.overview : false;\n    directionsOptions.continue_straight = directionsOptions.continue_straight !== undefined ? directionsOptions.continue_straight : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\n        continue_straight: directionsOptions.continue_straight ? 'true' : 'false',\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach(leg => {\n      leg.steps.forEach(step => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: OsrmDirectionsSource._name,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\nimport { GeoJsonGeometryTypes } from 'geojson';\n\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Québec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n    term = term.replace(/ /g, '');\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: string, term: string): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'map-marker'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType() as GeoJsonGeometryTypes,\n      coordinates: (feature.getGeometry() as any).getCoordinates()\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { CadastreSearchSource } from './cadastre';\n\n/**\n * Cadastre search source factory\n * @ignore\n */\nexport function cadastreSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new CadastreSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`),\n  );\n}\n\n/**\n * Function that returns a provider for the Cadastre search source\n */\nexport function provideCadastreSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: cadastreSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { NominatimData } from './nominatim.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(map((response: NominatimData[]) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: NominatimData[], term: string): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(data: NominatimData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'map-marker',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach(tag => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach(settings => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach(conf => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach(value => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesSearchSourceOptions,\n  StoredQueriesFields,\n  StoredQueriesReverseSearchSourceOptions\n} from './storedqueries.interfaces';\n\nimport * as olformat from 'ol/format';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource extends SearchSource\n  implements TextSearch {\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            let resultArray = this.extractResults(this.extractWFSData(response), term);\n            resultArray.sort((a, b) =>\n              (a.meta.score > b.meta.score) ? 1 :\n              (a.meta.score === b.meta.score) ? ((a.meta.titleHtml < b.meta.titleHtml) ? 1 : -1) : -1);\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd = Number(this.options.params.limit) * Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1 ].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1 ].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response), term);\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach(field => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach(field => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse, term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'map-marker',\n        score: (data.properties.title) ?\n        computeTermSimilarity(term.trim(), data.properties.title) :\n        computeTermSimilarity(term.trim(), data.properties[title]),\n\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      { Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>' }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n /* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\n\n    if (!this.storedQueriesOptions || (this.storedQueriesOptions && !this.storedQueriesOptions.available) ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            return this.extractResults(this.extractWFSData(response));\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response));\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(\n    data: StoredQueriesReverseData\n  ): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    return Object.assign(properties, { type: data.properties.doc_type }, routing);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\n\nimport { LanguageService, StorageService } from '@igo2/core';\n\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions\n} from './source.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SimpleDocumentSearchResultSetUnit } from 'flexsearch';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { WorkspaceData } from './workspace.interfaces';\n\n\n/**\n * Workspace search source\n */\n@Injectable()\nexport class WorkspaceSearchSource extends SearchSource implements TextSearch {\n  static id = 'workspace';\n  static type = FEATURE;\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n  }\n\n  getId(): string {\n    return WorkspaceSearchSource.id;\n  }\n\n  getType(): string {\n    return WorkspaceSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit: Number = 5;\n\n    return {\n      title: 'igo.geo.search.workspace.name',\n      searchUrl: undefined,\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'datasets',\n          name: 'datasets',\n          values: []\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {title: '1',value: 1,enabled: limit === 1},\n            {title: '5',value: 5,enabled: limit === 5 || !limit},\n            {title: '10',value: 10,enabled: limit === 10},\n            {title: '25',value: 25,enabled: limit === 25},\n            {title: '50',value: 50,enabled: limit === 50}\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const limitSetting = this.settings.find((s) => s.name === 'limit');\n    const limitValue = limitSetting.values.find(v => v.enabled).value as number || 5;\n    this.options.params.limit = limitValue.toLocaleString();\n    const results: WorkspaceData[] = [];\n    this.options.params.page = (options.page || 1).toLocaleString();\n    const page = options.page || 1;\n    const datasets = this.options.params.datasets.split(',');\n    this.featureStoresWithIndex\n      .filter(fswi => fswi.searchDocument && datasets.includes(fswi.layer.title))\n      .map(fswi => {\n        const termToUse = term;\n        fswi.searchDocument.search(termToUse, { limit: page * limitValue }).map(i => {\n          const foundIn: SimpleDocumentSearchResultSetUnit = i;\n          const field = foundIn.field;\n          foundIn.result.map(index => {\n            const feature = fswi.index.get(index);\n            const score = computeTermSimilarity(termToUse.trim(), feature.properties[field]);\n            results.push({ index, feature, layer: fswi.layer, field, score });\n          });\n        });\n      });\n\n    results.sort((a, b) => (a.score > b.score) ? -1 : 1);\n    const gettedIndex = [];\n    const sortedResultToProcess: WorkspaceData[] = [];\n    results.map(r => {\n      if (!gettedIndex.includes(r.index)) {\n        gettedIndex.push(r.index);\n        sortedResultToProcess.push(r);\n      }\n    });\n\n    return of(\n      this.extractResults(sortedResultToProcess\n        .sort((a, b) => (a.score > b.score) ? -1 : 1)\n        .slice(0, page * limitValue))\n    );\n  }\n\n  private extractResults(results: WorkspaceData[]): SearchResult<Feature>[] {\n    return results.map(result => this.dataToResult(result, results.length));\n  }\n\n\n    private dataToResult(\n      data: WorkspaceData,\n      resultsCnt: number\n    ): SearchResult<Feature> {\n      const properties = this.computeProperties(data);\n      const id = [this.getId(), properties.type, data.index].join('.');\n      const titleHtml = data.feature.properties[data.field];\n      const subtitleHtml2 = '<br><small> ' + data.layer.title + '</small>';\n\n      return {\n        source: this,\n        data: {\n          type: FEATURE,\n          projection: 'EPSG:4326',\n          geometry: data.feature.geometry,\n          extent: data.feature.extent,\n          properties,\n          meta: {\n            id,\n            title: data.feature.properties[data.field],\n            alias: this.getAllowedFieldsAndAlias(data.layer)\n          }\n        },\n        meta: {\n          dataType: FEATURE,\n          id,\n          title: data.feature.meta.title,\n          titleHtml: titleHtml + subtitleHtml2,\n          icon: 'map-marker',\n          score: data.score,\n          nextPage:\n            resultsCnt % +this.options.params.limit === 0 &&\n            +this.options.params.page < 10\n        }\n      } as SearchResult<Feature>;\n    }\n\n\n    private getAllowedFieldsAndAlias(layer: Layer) {\n      let allowedFieldsAndAlias;\n      if (\n        layer.options?.source?.options?.sourceFields &&\n        layer.options.source.options.sourceFields.length >= 1\n      ) {\n        allowedFieldsAndAlias = {};\n        layer.options.source.options.sourceFields.forEach(sourceField => {\n          const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n          allowedFieldsAndAlias[sourceField.name] = alias;\n        });\n      }\n      return allowedFieldsAndAlias;\n    }\n\n\n    private computeProperties(data: WorkspaceData): { [key: string]: any } {\n      if (!data.feature.geometry) {\n        return Object.assign({ type: data.layer.title + '.' + data.field }, data.feature.properties);\n      }\n      const googleLinksProperties: {\n        GoogleMaps: string;\n        GoogleStreetView?: string;\n      } = {\n        GoogleMaps: ''\n      };\n      let googleMaps;\n      if (data.feature.geometry.type === 'Point') {\n        googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n          data.feature.geometry.coordinates[0],\n          data.feature.geometry.coordinates[1]\n        );\n      } else {\n        const point = pointOnFeature(data.feature.geometry);\n        googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        );\n      }\n      googleLinksProperties.GoogleMaps =\n        '<a href=' +\n        googleMaps +\n        ' target=\"_blank\">' +\n        this.languageService.translate.instant('igo.geo.searchByCoord') +\n        '</a>';\n      if (data.feature.geometry.type === 'Point') {\n        googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\n          data.feature.geometry.coordinates[0],\n          data.feature.geometry.coordinates[1]\n        );\n      }\n      const routing: {\n        Route: string;\n      } = {\n        Route:\n          '<span class=\"routing\"> <u>' +\n          this.languageService.translate.instant('igo.geo.seeRouting') +\n          '</u> </span>'\n      };\n      return Object.assign(\n        { type: data.feature.sourceId },\n        data.feature.properties,\n        googleLinksProperties,\n        routing\n      );\n    }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\nimport { SearchSource } from './source';\nimport { WorkspaceSearchSource } from './workspace';\n\n\n/**\n * Workspace search source factory\n * @ignore\n */\nexport function workspaceSearchSourceFactory(\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new WorkspaceSearchSource(\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${WorkspaceSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the Workspace search source\n */\nexport function provideWorkspaceSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: workspaceSearchSourceFactory,\n    multi: true,\n    deps: [\n      LanguageService,\n      StorageService,\n      ConfigService\n    ]\n  };\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/simple-map\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoPointerPosition\n  [pointerPositionDelay]=\"pointerCoordDelay\"\n  (pointerPositionCoord)=\"onPointerMove($event)\">\n    <igo-info-section [infoContent]=\"pointerCoord\"></igo-info-section>\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n    <igo-wake-lock-button></igo-wake-lock-button>\n  </igo-map-browser>\n\n</mat-card>\n\n<p *ngIf=\"!isTouchScreen\">{{pointerCoord}}</p>","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSimpleMapComponent } from './simple-map.component';\n\nconst routes: Routes = [\n  {\n    path: 'simple-map',\n    component: AppSimpleMapComponent\n  }\n];\n\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-simple-map',\n  templateUrl: './simple-map.component.html',\n  styleUrls: ['./simple-map.component.scss']\n})\nexport class AppSimpleMapComponent {\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    rotation: 0.75\n  };\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  onPointerMove(event) {\n    this.pointerCoord = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppSimpleMapComponent } from './simple-map.component';\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppSimpleMapComponent],\n  imports: [\n    CommonModule,\n    AppSimpleMapRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppSimpleMapComponent]\n})\nexport class AppSimpleMapModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list\n    [map]=\"map\"\n    [layers]=\"map.layers\"\n    [expandLegendOfVisibleLayers]=\"false\"\n    floatLabel=\"never\"\n    [queryBadge]=\"true\">\n\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-download-button [layer]=\"layer\"></igo-download-button>\n        <igo-ogc-filter-button [header]=\"true\" [layer]=\"layer\"></igo-ogc-filter-button>\n        <igo-time-filter-button [header]=\"true\" [layer]=\"layer\"></igo-time-filter-button>\n        <igo-track-feature-button [layer]=\"layer\" [trackFeature]=\"true\"></igo-track-feature-button>\n      </ng-template>\n\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLayerComponent } from './layer.component';\n\nconst routes: Routes = [\n  {\n    path: 'layer',\n    component: AppLayerComponent\n  }\n];\n\nexport const AppLayerRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss']\n})\nexport class AppLayerComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourceCustomEPSG: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: 'geojson_utf8',\n        srsName: 'EPSG:32198',\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '12072'\n        }\n      },\n      formatOptions: {\n        dataProjection: 'EPSG:32198'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS (Custom EPSG)',\n          visible: true,\n          source: dataSource,\n          removable: false\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'parc_routier',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habité',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'sh_dis_eco',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'nurc:Arc_Sample_Parent',\n        visible: false,\n        legendOptions: {\n          // collapsed: false,\n          display: true,\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\n          stylesAvailable: [\n            { name: 'rain', title: 'Pluie' },\n            { name: 'raster', title: 'Défaut' }\n          ] //\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embâcle',\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLayerComponent } from './layer.component';\nimport { AppLayerRoutingModule } from './layer-routing.module';\n\n@NgModule({\n  declarations: [AppLayerComponent],\n  imports: [\n    AppLayerRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLayerComponent]\n})\nexport class AppLayerModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLegendComponent } from './legend.component';\n\nconst routes: Routes = [\n  {\n    path: 'legend',\n    component: AppLegendComponent\n  }\n];\n\nexport const AppLegendRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-legend',\n  templateUrl: './legend.component.html',\n  styleUrls: ['./legend.component.scss']\n})\nexport class AppLegendComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with display:false',\n      visible: true,\n      legendOptions: {\n        display: false,\n        html: 'test html'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_dis_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend in html',\n      visible: true,\n      legendOptions: {\n        display: true,\n        html: '<h2 style=\"background-color: blue;\">HTML légende</h2>'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: false,\n        params: {\n          LAYERS: 'sh_sreg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with url param',\n      visible: true,\n      legendOptions: {\n        url: `data:image/jpeg;base64,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`\n\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_reg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Commission scolaire anglophone',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          params: {\n            LAYERS: 'WMS_MEQ_CS_ANGLO',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habité',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embâcle',\n          visible: true,\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map with a legend list</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this\n      example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Legends\">\n    <igo-layer-legend-list [layers]=\"map.layers\"\n    [excludeBaseLayers]=\"true\"\n    [allowShowAllLegends]=\"true\"\n    [updateLegendOnResolutionChange]=\"false\"\n    [showAllLegendsValue]=\"false\">\n  </igo-layer-legend-list>\n\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLegendComponent } from './legend.component';\nimport { AppLegendRoutingModule } from './legend-routing.module';\n\n@NgModule({\n  declarations: [AppLegendComponent],\n  imports: [\n    AppLegendRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLegendComponent]\n})\nexport class AppLegendModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOverlayComponent } from './overlay.component';\n\nconst routes: Routes = [\n  {\n    path: 'overlay',\n    component: AppOverlayComponent\n  }\n];\n\nexport const AppOverlayRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, AfterViewInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FEATURE,\n  Feature,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-overlay',\n  templateUrl: './overlay.component.html',\n  styleUrls: ['./overlay.component.scss']\n})\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngAfterViewInit() {\n    const feature1: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 1\n      },\n      properties: {},\n      geometry: {\n        type: 'Point',\n        coordinates: [-73, 46.6]\n      }\n    };\n\n    const feature2: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 2\n      },\n      properties: {},\n      geometry: {\n        type: 'LineString',\n        coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n      }\n    };\n\n    const feature3: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 3\n      },\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n      }\n    };\n\n    this.map.overlay.setFeatures(\n      [feature1, feature2, feature3],\n      FeatureMotion.None\n    );\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Overlay</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/overlay\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\n\nimport { AppOverlayComponent } from './overlay.component';\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\n\n@NgModule({\n  declarations: [AppOverlayComponent],\n  imports: [\n    AppOverlayRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule,\n    IgoOverlayModule\n  ],\n  exports: [AppOverlayComponent]\n})\nexport class AppOverlayModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Geometry Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppGeometryComponent } from './geometry.component';\n\nconst routes: Routes = [\n  {\n    path: 'geometry',\n    component: AppGeometryComponent\n  }\n];\n\nexport const AppGeometryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport * as olstyle from 'ol/style';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-geometry',\n  templateUrl: './geometry.component.html',\n  styleUrls: ['./geometry.component.scss']\n})\nexport class AppGeometryComponent implements OnInit, OnDestroy {\n\n  map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  view = {\n    center: [-73, 47.2],\n    zoom: 15\n  };\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private languageService: LanguageService,\n    private formService: FormService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    const fieldConfigs = [\n      {\n        name: 'geometry',\n        title: 'Geometry',\n        options:  {\n          validator: Validators.required\n        },\n        type: 'geometry',\n        inputs: {\n          map: this.map,\n          geometryTypeField: true,\n          geometryType: 'Polygon',\n          drawGuideField: true,\n          drawGuide: 50,\n          drawGuidePlaceholder: 'Draw Guide',\n          drawStyle: new olstyle.Style({\n            stroke: new olstyle.Stroke({\n              color: [255, 0, 0, 1],\n              width: 2\n            }),\n            fill:  new olstyle.Fill({\n              color: [255, 0, 0, 0.2]\n            }),\n            image: new olstyle.Circle({\n              radius: 8,\n              stroke: new olstyle.Stroke({\n                color: [255, 0, 0, 1]\n              }),\n              fill: new olstyle.Fill({\n                color: [255, 0, 0, 0.2]\n              })\n            })\n          })\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options:  {\n          validator: Validators.required\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      name: 'Place',\n      geometry: JSON.stringify({type: 'Polygon', coordinates: [[\n        [-106, 42],\n        [-107, 31],\n        [-81, 32],\n        [-82, 42],\n        [-106, 42]\n      ]]})\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\n\nimport { AppGeometryComponent } from './geometry.component';\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\n\n@NgModule({\n  declarations: [AppGeometryComponent],\n  imports: [\n    CommonModule,\n    AppGeometryRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule,\n    IgoGeometryModule,\n    IgoMapModule\n  ],\n  exports: [AppGeometryComponent]\n})\nexport class AppGeometryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFeatureComponent } from './feature.component';\n\nconst routes: Routes = [\n  {\n    path: 'feature',\n    component: AppFeatureComponent\n  }\n];\n\nexport const AppFeatureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  VectorLayer,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-feature',\n  templateUrl: './feature.component.html',\n  styleUrls: ['./feature.component.scss']\n})\nexport class AppFeatureComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  public tableTemplate = {\n    selection: true,\n    selectMany: true,\n    sort: true,\n    columns: [\n      {\n        name: 'properties.id',\n        title: 'ID'\n      },\n      {\n        name: 'properties.name',\n        title: 'Name'\n      },\n      {\n        name: 'properties.description',\n        title: 'Description'\n      }\n    ]\n  };\n\n  public store = new FeatureStore([], { map: this.map });\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\n    this.store.addStrategy(loadingStrategy);\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.Default\n    });\n    this.store.addStrategy(selectionStrategy);\n\n    this.store.load([\n      {\n        meta: { id: 1 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-72, 47.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 1,\n          name: 'Name 1',\n          description: 'Description 1'\n        }\n      },\n      {\n        meta: { id: 4 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-71, 46.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 4,\n          name: 'Name 4',\n          description: 'Description 4'\n        }\n      },{\n        meta: { id: 5 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-73, 45.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 5,\n          name: 'Name 5',\n          description: 'Description 5'\n        }\n      },\n      {\n        meta: { id: 2 },\n        type: 'Feature',\n        geometry: {\n          type: 'LineString',\n          coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 2,\n          name: 'Name 2',\n          description: 'Description 2'\n        }\n      },\n      {\n        meta: { id: 3 },\n        type: 'Feature',\n        geometry: {\n          type: 'Polygon',\n          coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 3,\n          name: 'Name 3',\n          description: 'Description 3'\n        }\n      }\n    ]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'MVT test',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url:\n            'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true\n        },\n        igoStyle: {\n          mapboxStyle: {\n            url: 'assets/mapboxStyleExample-vectortile.json',\n            source: 'ahocevar'\n          }\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector'\n      })\n      .subscribe(dataSource => {\n        const layer = this.layerService.createLayer({\n          title: 'Vector Layer',\n          source: dataSource,\n          animation: {\n            duration: 2000\n          },\n          igoStyle: {\n            mapboxStyle: {\n              url: 'assets/mapboxStyleExample-feature.json',\n              source: 'source_nameX'\n            }\n          },\n        }) as VectorLayer;\n        this.map.addLayer(layer);\n        this.store.bindLayer(layer);\n        loadingStrategy.activate();\n        selectionStrategy.activate();\n      });\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Feature</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geom/feature\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-entity-table\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoEntityTableModule } from '@igo2/common';\nimport { IgoMapModule, IgoFeatureModule } from '@igo2/geo';\n\nimport { AppFeatureComponent } from './feature.component';\nimport { AppFeatureRoutingModule } from './feature-routing.module';\n\n@NgModule({\n  declarations: [AppFeatureComponent],\n  imports: [\n    AppFeatureRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoEntityTableModule,\n    IgoMapModule,\n    IgoFeatureModule\n  ],\n  exports: [AppFeatureComponent]\n})\nexport class AppFeatureModule {}\n","import { Routes, RouterModule } from '@angular/router';\nimport { AppHoverComponent } from './hover.component';\n\nconst routes: Routes = [\n  {\n    path: 'hover',\n    component: AppHoverComponent\n  }\n];\n\nexport const AppHoverRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService, WFSDataSourceOptions, VectorLayerOptions, WFSDataSource } from '@igo2/geo';\n\n@Component({\n  selector: 'app-hover',\n  templateUrl: './hover.component.html',\n  styleUrls: ['./hover.component.scss']\n})\nexport class AppHoverComponent {\n  public selected;\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public pointerHoverFeatureDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 8,\n    projection: 'EPSG:3857'\n  };\n\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wmts',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n        layer: 'carte_gouv_qc_public',\n        matrixSet: 'EPSG_3857',\n        version: '1.3.0'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Quebec',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSDataOptions\n      extends WFSDataSourceOptions { }\n\n    const wfsDatasourcePolygon: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'adn_bassin_n1_public_v',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '3.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePolygon)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (polygon)',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourcePoint: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n      params: {\n        featureTypes: 'MSP_CASERNE_PUBLIC',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePoint)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (point)',\n          visible: true,\n          source: dataSource,\n          igoStyle: {\n            styleByAttribute: {\n              attribute: 'en_caserne',\n              data: ['true', 'false'],\n              stroke: ['red', 'blue'],\n              fill: ['#ffffff', '#ffffff'],\n              radius: [7, 7],\n              width: [2, 2]\n            },\n            hoverStyle: {\n              label: {\n                attribute: 'Caserne: ${no_caserne} \\n Mun: ${nom_ssi}',\n                style: {\n                  textAlign: 'left',\n                  textBaseline: 'top',\n                  font: '12px Calibri,sans-serif',\n                  fill: { color: '#000' },\n                  backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n                  backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n                  stroke: { color: '#fff', width: 3 },\n                  overflow: true,\n                  offsetX: 20,\n                  offsetY: 10,\n                  padding: [2.5, 2.5, 2.5, 2.5]\n                }\n              },\n              baseStyle: {\n                circle: {\n                  stroke: {\n                    color: 'orange',\n                    width: 5\n                  },\n                  width: [5],\n                  radius: 15\n                }\n              }\n            }\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Hover</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/hover\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoHoverFeature\n  [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n  [igoHoverFeatureEnabled]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppHoverComponent } from './hover.component';\nimport { AppHoverRoutingModule } from './hover-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppHoverComponent],\n  imports: [\n    CommonModule,\n    AppHoverRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppHoverComponent]\n})\nexport class AppHoverModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMeasureComponent } from './measure.component';\n\nconst routes: Routes = [\n  {\n    path: 'measure',\n    component: AppMeasureComponent\n  }\n];\n\nexport const AppMeasureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithMeasure\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-measure',\n  templateUrl: './measure.component.html',\n  styleUrls: ['./measure.component.scss']\n})\nexport class AppMeasureComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store = new FeatureStore<FeatureWithMeasure>([], {map: this.map});\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/measure\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\n\nimport { AppMeasureComponent } from './measure.component';\nimport { AppMeasureRoutingModule } from './measure-routing.module';\n\n@NgModule({\n  declarations: [AppMeasureComponent],\n  imports: [\n    AppMeasureRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoMeasureModule\n  ],\n  exports: [AppMeasureComponent]\n})\nexport class AppMeasureModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppDrawComponent } from './draw.component';\n\nconst routes: Routes = [\n  {\n    path: 'draw',\n    component: AppDrawComponent\n  }\n];\n\nexport const AppDrawRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithDraw,\n  MapService\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss']\n})\nexport class AppDrawComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/draw\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-draw [stores]=\"stores\" [map]=\"map\"></igo-draw>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoDrawModule } from '@igo2/geo';\n\nimport { AppDrawComponent } from './draw.component';\nimport { AppDrawRoutingModule } from './draw-routing.module';\n\n@NgModule({\n  declarations: [AppDrawComponent],\n  imports: [\n    AppDrawRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoDrawModule\n  ],\n  exports: [AppDrawComponent]\n})\nexport class AppDrawModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Query</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay\n    igoQuery\n    [queryFeatures]=\"true\"\n    (query)=\"handleQueryResults($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Details\">\n    <ng-container *ngIf=\"features$ | async as features\">\n      <div *ngFor=\"let feature of features\">\n        <h1>Query Title : <span style=\"background-color: #e0e0e0;\">{{getTitle(feature)}}</span></h1>\n        <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n      </div>\n    </ng-container>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppQueryComponent } from './query.component';\n\nconst routes: Routes = [\n  {\n    path: 'query',\n    component: AppQueryComponent\n  }\n];\n\nexport const AppQueryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport olFeature from 'ol/Feature';\nimport olPoint from 'ol/geom/Point';\nimport olPolygon from 'ol/geom/Polygon';\nimport olLineString from 'ol/geom/LineString';\nimport * as olproj from 'ol/proj';\n\nimport {\n  IgoMap,\n  FeatureDataSource,\n  DataSourceService,\n  LayerService,\n  Feature,\n  QueryableDataSourceOptions,\n  QueryFormat,\n  QueryHtmlTarget,\n  SearchResult,\n  FeatureMotion\n} from '@igo2/geo';\n\nimport { getEntityTitle } from '@igo2/common';\n\n@Component({\n  selector: 'app-query',\n  templateUrl: './query.component.html',\n  styleUrls: ['./query.component.scss']\n})\nexport class AppQueryComponent {\n  public features$ = new BehaviorSubject<Feature[]>([]);\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryTitle: 'num_rts',\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryFormat: QueryFormat.HTMLGML2,\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS html with a pre call in GML',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n      this.layerService\n      .createAsyncLayer({\n        title: 'Query url test',\n        visible: true,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          queryable: true,\n          queryUrls: [{url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application/geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'}],\n          queryLayerFeatures: false,\n          queryFormat: 'geojson',\n          params: {\n            layers: 'SDA_MUNIC_S_20K',\n            version: '1.3.0'\n          }\n        }\n      } as any).subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true,\n        queryTitle: 'So beautiful ${name}',\n        sourceFields: [\n          { name: 'name', alias: 'Alias name' },\n          { name: 'description', alias: 'Alias description' }\n        ]\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Vector Layer',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n        this.addFeatures(dataSource as FeatureDataSource);\n      });\n  }\n\n  addFeatures(dataSource: FeatureDataSource) {\n    const feature1 = new olFeature({\n      name: 'feature1',\n      geometry: new olLineString([\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\n      ]),\n    });\n\n    const feature2 = new olFeature({\n      name: 'feature2',\n      geometry: new olPoint(\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\n      ),\n    });\n\n    const feature3 = new olFeature({\n      name: 'feature3',\n      geometry: new olPolygon([\n        [\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\n        ]\n      ]),\n    });\n\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Vector tile with custom getfeatureinfo url',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true,\n          queryUrls: [\n            { url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application%2Fgeojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'}\n          ],\n          queryLayerFeatures: false,\n          // queryFormat: 'geojson'\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n      this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi',\n        queryable: true,\n        queryUrls: [\n          {\n            url:'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&INFO_FORMAT=geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}',\n            // minScale: 20000,\n            // maxScale: 9000000,\n            minResolution: 0,\n            maxResolution: 400\n          }\n        ],\n        queryFormat: 'geojson',\n        params: {\n          version: '1.3.0',\n          layers: 'MSP_CASERNE_PUBLIC'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS with custom getfeatureinfo url',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n  }\n\n  handleQueryResults(results) {\n    const features: Feature[] = results.features;\n    if (features.length && features[0]) {\n      this.features$.next(features);\n      this.map.queryResultsOverlay.setFeatures(features, FeatureMotion.None);\n    }\n  }\n\n  getTitle(result: SearchResult) {\n    return getEntityTitle(result);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\n\nimport { AppQueryComponent } from './query.component';\nimport { AppQueryRoutingModule } from './query-routing.module';\n\n@NgModule({\n  declarations: [AppQueryComponent],\n  imports: [\n    AppQueryRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule\n  ],\n  exports: [AppQueryComponent]\n})\nexport class AppQueryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppCatalogComponent } from './catalog.component';\n\nconst routes: Routes = [\n  {\n    path: 'catalog',\n    component: AppCatalogComponent\n  }\n];\n\nexport const AppCatalogRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService, ConfigService, StorageService } from '@igo2/core';\nimport { IgoMap, LayerService, Catalog, CatalogItem, CatalogService, MapService } from '@igo2/geo';\nimport { EntityRecord, EntityStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.scss']\n})\nexport class AppCatalogComponent implements OnInit {\n  catalog: Catalog;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public catalogStore = new EntityStore<Catalog>([]);\n\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\n\n  constructor(\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private catalogService: CatalogService,\n    private storageService: StorageService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => this.map.addLayer(layer));\n\n    this.loadCatalogs();\n\n    this.mapService.setMap(this.map);\n    this.catalogStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Catalog>) => record.state.selected === true\n      )\n      .subscribe((record: EntityRecord<Catalog>) => {\n        if (record && record.entity) {\n          const catalog = record.entity;\n          this.catalog = catalog;\n        }\n      });\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: {selected: boolean; catalog: Catalog}) {\n    this.loadCatalogItems(event.catalog);\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService.loadCatalogs()\n      .subscribe((catalogs: Catalog[]) => {\n        this.catalogStore.clear();\n        this.catalogStore.load(catalogs.concat((this.storageService.get('addedCatalogs') || []) as Catalog[]));\n      });\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    this.catalogService.loadCatalogItems(catalog)\n      .subscribe((items: CatalogItem[]) => {\n        this.catalogItemStore.clear();\n        this.catalogItemStore.load(items);\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Catalog</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/catalog\">code of this example</a><br>\n    See catalog section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Catalog Library\">\n    <igo-catalog-library\n      [store]=\"catalogStore\"\n      (catalogSelectChange)=\"onCatalogSelectChange($event)\">\n    </igo-catalog-library>\n  </igo-panel>\n\n  <igo-panel title=\"Catalog Browser\">\n    <igo-catalog-browser\n      [catalog]=\"catalog\"\n      [store]=\"catalogItemStore\"\n      [map]=\"map\">\n    </igo-catalog-browser>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoCatalogModule } from '@igo2/geo';\n\nimport { environment } from '../../../environments/environment';\nimport { AppCatalogComponent } from './catalog.component';\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\n\n@NgModule({\n  declarations: [AppCatalogComponent],\n  imports: [\n    CommonModule,\n    AppCatalogRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoConfigModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoCatalogModule\n  ],\n  exports: [AppCatalogComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppCatalogModule {}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\n\nimport { BehaviorSubject, Observable, of, Subject } from 'rxjs';\nimport {\n  map,\n  tap,\n  catchError,\n  debounceTime,\n  mergeMap,\n  first,\n  skip\n} from 'rxjs/operators';\n\nimport olPoint from 'ol/geom/Point';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport Cluster from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Tool } from '@igo2/common';\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport {\n  ConfigService,\n  RouteService,\n  Message,\n  MessageService,\n  LanguageService,\n  StorageService\n} from '@igo2/core';\n\nimport { AuthService } from '@igo2/auth';\nimport type { IgoMap, Layer, LayerOptions } from '@igo2/geo';\nimport { ExportService } from '@igo2/geo';\n\nimport { TypePermission } from './context.enum';\nimport {\n  ContextsList,\n  ContextServiceOptions,\n  Context,\n  DetailedContext,\n  ContextMapView,\n  ContextPermission,\n  ContextProfils\n} from './context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextService {\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\n  public importedContext: Array<DetailedContext> = [];\n  public toolsChanged$ = new Subject<DetailedContext>();\n  private mapViewFromRoute: ContextMapView = {};\n  private options: ContextServiceOptions;\n  private baseUrl: string;\n\n  // Until the ContextService is completely refactored, this is needed\n  // to track the current tools\n  private tools: Tool[];\n  private toolbar: string[];\n\n  get defaultContextUri(): string {\n    return this.storageService.get('favorite.context.uri') as string || this._defaultContextUri || this.options.defaultContextUri;\n  }\n  set defaultContextUri(uri: string) {\n    this._defaultContextUri = uri;\n  }\n  private _defaultContextUri: string;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService,\n    private languageService: LanguageService,\n    private config: ConfigService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private exportService: ExportService,\n    @Optional() private route: RouteService\n  ) {\n    this.options = Object.assign(\n      {\n        basePath: 'contexts',\n        contextListFile: '_contexts.json',\n        defaultContextUri: '_default'\n      },\n      this.config.getConfig('context')\n    );\n\n    this.baseUrl = this.options.url;\n\n    this.readParamsFromRoute();\n\n    if (this.authService.hasAuthService) {\n      this.authService.logged$.subscribe((logged) => {\n        if (logged) {\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\n            this.handleContextsChange();\n          });\n          this.loadContexts();\n        }\n      });\n    } else {\n      this.loadContexts();\n      this.handleContextsChange(false);\n    }\n  }\n\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\n    let url = this.baseUrl + '/contexts';\n    if (permissions && this.authService.authenticated) {\n      url += '?permission=' + permissions.join();\n      if (hidden) {\n        url += '&hidden=true';\n      }\n    }\n    return this.http.get<ContextsList>(url);\n  }\n\n  getById(id: string): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.get<Context>(url);\n  }\n\n  getDetails(id: string): Observable<DetailedContext> {\n    const url = `${this.baseUrl}/contexts/${id}/details`;\n    return this.http.get<DetailedContext>(url).pipe(\n      catchError((res) => {\n        this.handleError(res, id);\n        throw res;\n      })\n    );\n  }\n\n  getDefault(): Observable<DetailedContext> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.get<DetailedContext>(url).pipe(\n        tap((context) => {\n          this.defaultContextId$.next(context.id);\n        })\n      );\n    } else {\n      const uri = this.storageService.get('favorite.context.uri') as string;\n      this.defaultContextId$.next(uri);\n      return this.getContextByUri(uri);\n    }\n\n  }\n\n  getProfilByUser(): Observable<ContextProfils[]> {\n    if (this.baseUrl) {\n      const url = this.baseUrl + '/profils?';\n      return this.http.get<ContextProfils[]>(url);\n    }\n    return of([]);\n  }\n\n  setDefault(id: string): Observable<any> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.post(url, { defaultContextId: id });\n    } else {\n      this.storageService.set('favorite.context.uri', id);\n      return of(undefined);\n    }\n  }\n\n  hideContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\n    return this.http.post(url, {});\n  }\n\n  showContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/show';\n    return this.http.post(url, {});\n  }\n\n  delete(id: string, imported = false): Observable<void> {\n    const contexts: ContextsList = { ours: [] };\n    Object.keys(this.contexts$.value).forEach(\n      (key) =>\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\n    );\n\n    if (imported) {\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\n      return of(this.contexts$.next(contexts));\n    }\n\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.delete<void>(url).pipe(\n      tap((res) => {\n        this.contexts$.next(contexts);\n      })\n    );\n  }\n\n  create(context: DetailedContext): Observable<Context> {\n    const url = this.baseUrl + '/contexts';\n    return this.http.post<Context>(url, context).pipe(\n      map((contextCreated) => {\n        if (this.authService.authenticated) {\n          contextCreated.permission = TypePermission[TypePermission.write];\n        } else {\n          contextCreated.permission = TypePermission[TypePermission.read];\n        }\n        this.contexts$.value.ours.unshift(contextCreated);\n        this.contexts$.next(this.contexts$.value);\n        return contextCreated;\n      })\n    );\n  }\n\n  clone(id: string, properties = {}): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\n    return this.http.post<Context>(url, properties).pipe(\n      map((contextCloned) => {\n        contextCloned.permission = TypePermission[TypePermission.write];\n        this.contexts$.value.ours.unshift(contextCloned);\n        this.contexts$.next(this.contexts$.value);\n        return contextCloned;\n      })\n    );\n  }\n\n  update(id: string, context: Context): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.patch<Context>(url, context);\n  }\n\n  // =================================================================\n\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\n    const association = {\n      toolId\n    };\n    return this.http.post<void>(url, association);\n  }\n\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\n    return this.http.delete(url);\n  }\n\n  getPermissions(id: string): Observable<ContextPermission[]> {\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\n    return this.http.get<ContextPermission[]>(url);\n  }\n\n  addPermissionAssociation(\n    contextId: string,\n    profil: string,\n    type: TypePermission\n  ): Observable<ContextPermission[]> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\n    const association = {\n      profil,\n      typePermission: type\n    };\n\n    return this.http.post<ContextPermission[]>(url, association).pipe(\n      catchError((res) => {\n        this.handleError(res, undefined, true);\n        throw [res]; // TODO Not sure about this.\n      })\n    );\n  }\n\n  deletePermissionAssociation(\n    contextId: string,\n    permissionId: string\n  ): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\n    return this.http.delete<void>(url);\n  }\n\n  // ======================================================================\n\n  getLocalContexts(): Observable<ContextsList> {\n    const url = this.getPath(this.options.contextListFile);\n    return this.http.get<ContextsList>(url).pipe(\n      map((res: any) => {\n        return { ours: res };\n      })\n    );\n  }\n\n  getLocalContext(uri: string): Observable<DetailedContext> {\n    const url = this.getPath(`${uri}.json`);\n    return this.http.get<DetailedContext>(url).pipe(\n      mergeMap((res) => {\n        if (!res.base) {\n          return of(res);\n        }\n        const urlBase = this.getPath(`${res.base}.json`);\n        return this.http.get<DetailedContext>(urlBase).pipe(\n          map((resBase: DetailedContext) => {\n            const resMerge = res;\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\n            resMerge.layers = (resBase.layers || [])\n              .concat(res.layers || [])\n              .reverse()\n              .filter(\n                (l, index, self) =>\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\n              )\n              .reverse();\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\n            resMerge.message = res.message || resBase.message;\n            resMerge.messages = res.messages || resBase.messages;\n            resMerge.tools = (res.tools || [])\n              .concat(resBase.tools || [])\n              .filter(\n                (t, index, self) =>\n                  self.findIndex((t2) => t2.name === t.name) === index\n              );\n            return resMerge;\n          }),\n          catchError((err) => {\n            this.handleError(err, uri);\n            throw err;\n          })\n        );\n      }),\n      catchError((err2) => {\n        this.handleError(err2, uri);\n        throw err2;\n      })\n    );\n  }\n\n  loadContexts(permissions?: string[], hidden?: boolean) {\n    let request;\n    if (this.baseUrl) {\n      request = this.get(permissions, hidden);\n    } else {\n      request = this.getLocalContexts();\n    }\n    request.subscribe((contexts) => {\n      contexts.ours = this.importedContext.concat(contexts.ours);\n      this.contexts$.next(contexts);\n    });\n  }\n\n  loadDefaultContext() {\n    const loadFct = (direct = false) => {\n      if (!direct && this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe(\n          (_context: DetailedContext) => {\n            this.defaultContextUri = _context.uri;\n            this.addContextToList(_context);\n            this.setContext(_context);\n          },\n          () => {\n            this.defaultContextId$.next(undefined);\n            this.loadContext(this.defaultContextUri);\n          }\n        );\n      } else {\n        this.loadContext(this.defaultContextUri);\n      }\n    };\n\n    if (this.route && this.route.options.contextKey) {\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\n        const contextParam = params[this.route.options.contextKey as string];\n        let direct = false;\n        if (contextParam) {\n          this.defaultContextUri = contextParam;\n          direct = true;\n        }\n        loadFct(direct);\n      });\n    } else {\n      loadFct();\n    }\n  }\n\n  loadContext(uri: string) {\n    const context = this.context$.value;\n\n    if (context && context.uri === uri) {\n      return;\n    }\n\n    this.getContextByUri(uri)\n      .pipe(first())\n      .subscribe(\n        (_context: DetailedContext) => {\n          this.addContextToList(_context);\n          this.setContext(_context);\n        },\n        (err) => {\n          if (uri !== this.options.defaultContextUri) {\n            this.loadContext(this.options.defaultContextUri);\n          }\n        }\n      );\n  }\n\n  setContext(context: DetailedContext) {\n    this.handleContextMessage(context);\n    const currentContext = this.context$.value;\n    if (currentContext && context && context.id === currentContext.id) {\n      if (context.map.view.keepCurrentView === undefined) {\n        context.map.view.keepCurrentView = true;\n      }\n      this.context$.next(context);\n      return;\n    }\n\n    if (!context.map) {\n      context.map = { view: {} };\n    }\n\n    Object.assign(context.map.view, this.mapViewFromRoute);\n\n    this.context$.next(context);\n  }\n\n  loadEditedContext(uri: string) {\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\n      this.setEditedContext(_context);\n    });\n  }\n\n  setEditedContext(context: DetailedContext) {\n    this.editedContext$.next(context);\n  }\n\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: uuid(),\n      title: '',\n      scope: 'private',\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\n        }\n      },\n      layers: [],\n      tools: []\n    };\n\n    let layers = [];\n    if (empty === true) {\n      layers = igoMap.layers$\n        .getValue()\n        .filter(\n          (lay) =>\n            lay.baseLayer === true ||\n            lay.options.id === 'searchPointerSummaryId'\n        )\n        .sort((a, b) => a.zIndex - b.zIndex);\n    } else {\n      layers = igoMap.layers$.getValue().filter(lay => !lay.id.includes('WfsWorkspaceTableDest')).sort((a, b) => a.zIndex - b.zIndex);\n    }\n\n    let i = 0;\n    for (const l of layers) {\n      const layer: any = l;\n      const opts = {\n        id: layer.options.id ? String(layer.options.id) : undefined,\n        layerOptions: {\n          title: layer.options.title,\n          zIndex: ++i,\n          visible: layer.visible,\n          security: layer.security\n        } as LayerOptions,\n        sourceOptions: {\n          type: layer.dataSource.options.type,\n          params: layer.dataSource.options.params,\n          url: layer.dataSource.options.url,\n          queryable: layer.queryable\n        }\n      };\n      if (opts.sourceOptions.type) {\n        context.layers.push(opts);\n      }\n    }\n\n    context.tools = this.tools.map((tool) => {\n      return { id: String(tool.id), global: tool.global };\n    });\n\n    return context;\n  }\n\n  getContextFromLayers(\n    igoMap: IgoMap,\n    layers: Layer[],\n    name: string\n  ): DetailedContext {\n    const currentContext = this.context$.getValue();\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: name,\n      title: name,\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj\n        }\n      },\n      layers: [],\n      toolbar: [],\n      tools: [],\n      extraFeatures: []\n    };\n\n    const currentLayers = igoMap.layers$.getValue();\n    context.layers = currentLayers\n      .filter((l) => l.baseLayer)\n      .map((l) => {\n        return {\n          baseLayer: true,\n          sourceOptions: l.options.sourceOptions,\n          title: l.options.title,\n          visible: l.visible\n        };\n      });\n\n    layers.forEach((layer) => {\n      // Do not seem to work properly. layerFound is always undefined.\n      const layerFound = currentContext.layers.find(\n        (contextLayer) => {\n          const source = contextLayer.source;\n          return source && layer.id === source.id && !contextLayer.baseLayer;\n        });\n      if (layerFound) {\n        let layerStyle = layerFound[`style`];\n        if (layerFound[`igoStyle`][`styleByAttribute`]) {\n          layerStyle = undefined;\n        } else if (layerFound[`igoStyle`][`clusterBaseStyle`]) {\n          layerStyle = undefined;\n          delete layerFound.sourceOptions[`source`];\n          delete layerFound.sourceOptions[`format`];\n        }\n        const opts = {\n          baseLayer: layerFound.baseLayer,\n          title: layer.options.title,\n          zIndex: layer.zIndex,\n          igoStyle: {\n            styleByAttribute: layerFound[`igoStyle`][`styleByAttribute`],\n            clusterBaseStyle: layerFound[`igoStyle`][`clusterBaseStyle`],\n          },\n          style: layerStyle,\n          clusterParam: layerFound[`clusterParam`],\n          visible: layer.visible,\n          opacity: layer.opacity,\n          sourceOptions: layerFound.sourceOptions\n        };\n        context.layers.push(opts);\n      } else {\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\n          const catalogLayer = layer.options;\n          catalogLayer.zIndex = layer.zIndex;\n          delete catalogLayer.source;\n          context.layers.push(catalogLayer);\n        } else {\n          let features;\n          const writer = new GeoJSON();\n          if (layer.ol.getSource() instanceof Cluster) {\n            const clusterSource = layer.ol.getSource() as Cluster;\n            let olFeatures = clusterSource.getFeatures();\n            olFeatures = (olFeatures as any).flatMap((cluster: any) => cluster.get('features'));\n            const cleanedOlFeatures = this.exportService.generateFeature(olFeatures, 'GeoJSON', '_featureStore');\n            features = writer.writeFeatures(\n              cleanedOlFeatures,\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          } else {\n            const source = layer.ol.getSource() as olVectorSource;\n            const olFeatures = source.getFeatures();\n            const cleanedOlFeatures = this.exportService.generateFeature(olFeatures, 'GeoJSON', '_featureStore');\n            features = writer.writeFeatures(\n              cleanedOlFeatures,\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          }\n          features = JSON.parse(features);\n          features.name = layer.options.title;\n          context.extraFeatures.push(features);\n        }\n      }\n    });\n\n    context.toolbar = this.toolbar;\n    context.tools = this.tools;\n\n    return context;\n  }\n\n  setTools(tools: Tool[]) {\n    this.tools = tools;\n  }\n\n  setToolbar(toolbar: string[]) {\n    this.toolbar = toolbar;\n  }\n\n  private handleContextMessage(context: DetailedContext) {\n    if (this.context$.value && context.uri && this.context$.value.uri !== context.uri) {\n      this.messageService.removeAllAreNotError();\n    }\n\n    context.messages = context.messages ? context.messages : [];\n    context.messages.push(context.message);\n    context.messages.map(message => {\n      if (message) {\n        this.messageService.message(message as Message);\n      }\n    });\n  }\n\n  private getContextByUri(uri: string): Observable<DetailedContext> {\n    if (this.baseUrl) {\n      let contextToLoad;\n      for (const key of Object.keys(this.contexts$.value)) {\n        contextToLoad = this.contexts$.value[key].find((c) => {\n          return c.uri === uri;\n        });\n        if (contextToLoad) {\n          break;\n        }\n      }\n\n      if (contextToLoad && contextToLoad.imported) {\n        return of(contextToLoad);\n      }\n\n      // TODO : use always id or uri\n      const id = contextToLoad ? contextToLoad.id : uri;\n      return this.getDetails(id);\n    }\n\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\n      return currentContext.uri === uri && currentContext.imported === true;\n    });\n\n    if (importedContext) {\n      return of(importedContext);\n    } else {\n      return this.getLocalContext(uri);\n    }\n  }\n\n  getContextLayers(igoMap: IgoMap) {\n    const layers: Layer[] = [];\n    const mapLayers = igoMap.layers$.getValue();\n    mapLayers.forEach((layer) => {\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\n        layers.push(layer);\n      }\n    });\n    return layers;\n  }\n\n  private readParamsFromRoute() {\n    if (!this.route) {\n      return;\n    }\n\n    this.route.queryParams.subscribe((params) => {\n      const centerKey = this.route.options.centerKey;\n      if (centerKey && params[centerKey as string]) {\n        const centerParams = params[centerKey as string];\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\n      }\n\n      const projectionKey = this.route.options.projectionKey;\n      if (projectionKey && params[projectionKey as string]) {\n        const projectionParam = params[projectionKey as string];\n        this.mapViewFromRoute.projection = projectionParam;\n      }\n\n      const zoomKey = this.route.options.zoomKey;\n      if (zoomKey && params[zoomKey as string]) {\n        const zoomParam = params[zoomKey as string];\n        this.mapViewFromRoute.zoom = Number(zoomParam);\n      }\n    });\n  }\n\n  private getPath(file: string) {\n    const basePath = this.options.basePath.replace(/\\/$/, '');\n\n    return `${basePath}/${file}`;\n  }\n\n  private handleError(\n    error: HttpErrorResponse,\n    uri: string,\n    permissionError?: boolean\n  ) {\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\n    const titleContext = context ? context.title : uri;\n    error.error.title = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.title'\n    );\n\n    error.error.message = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.text',\n      { value: titleContext }\n    );\n\n    error.error.toDisplay = true;\n\n    if (permissionError) {\n      error.error.title = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      error.error.message = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermission'\n      );\n    }\n    this.messageService.error(\n      'igo.context.contextManager.errors.addPermission',\n      'igo.context.contextManager.errors.addPermissionTitle');\n  }\n\n  private handleContextsChange(\n    keepCurrentContext = true\n  ) {\n    const context = this.context$.value;\n    const editedContext = this.editedContext$.value;\n    if (!context || context.uri === this.options.defaultContextUri) {\n      keepCurrentContext = false;\n    }\n    if (!keepCurrentContext || !this.findContext(context)) {\n      this.defaultContextUri = undefined;\n      this.loadDefaultContext();\n    } else {\n      this.getContextByUri(context.uri)\n        .pipe(first())\n        .subscribe(\n          (newContext: DetailedContext) => {\n            this.toolsChanged$.next(newContext);\n          }\n        );\n\n      if (this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe();\n      }\n    }\n    const editedFound = this.findContext(editedContext);\n    if (!editedFound || editedFound.permission !== 'write') {\n      this.setEditedContext(undefined);\n    }\n  }\n\n  private addContextToList(context: Context) {\n    const contextFound = this.findContext(context);\n    if (!contextFound) {\n      const contextSimplifie = {\n        id: context.id,\n        uri: context.uri,\n        title: context.title,\n        scope: context.scope,\n        permission: TypePermission[TypePermission.read]\n      };\n\n      if (this.contexts$.value && this.contexts$.value.public) {\n        this.contexts$.value.public.push(contextSimplifie);\n        this.contexts$.next(this.contexts$.value);\n      }\n    }\n  }\n\n  private findContext(context: Context) {\n    if (!context) {\n      return false;\n    }\n\n    const contexts = this.contexts$.value;\n    let found;\n    for (const key of Object.keys(contexts)) {\n      const value = contexts[key];\n      found = value.find(\n        (c) =>\n          (context.id && c.id === context.id) ||\n          (context.uri && c.uri === context.uri)\n      );\n      if (found) {\n        break;\n      }\n    }\n\n    return found;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\nimport { IgoSpinnerModule } from '@igo2/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    MatTooltipModule,\n  ],\n  exports: [\n    ContextImportExportComponent\n  ],\n  declarations: [\n    ContextImportExportComponent\n  ]\n})\nexport class IgoContextImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\n    return {\n      ngModule: IgoContextImportExportModule\n    };\n  }\n}\n","import { Directive, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { MapViewOptions, MapBrowserComponent, MapControlsOptions, MapScaleLineOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext, ContextMapView } from './context.interface';\nimport { MediaService } from '@igo2/core';\n\n@Directive({\n  selector: '[igoMapContext]'\n})\nexport class MapContextDirective implements OnInit, OnDestroy {\n  private component: MapBrowserComponent;\n  private context$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    component: MapBrowserComponent,\n    private contextService: ContextService,\n    private mediaService: MediaService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter(context => context !== undefined))\n      .subscribe(context => this.handleContextChange(context));\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.map === undefined) {\n      return;\n    }\n\n    // This creates a new ol.Map when the context changes. Doing that\n    // allows the print tool to work properly even when the map's canvas\n    // has been tainted (CORS) with the layers of another context. This could\n    // have some side effects such as unbinding all listeners on the first map.\n    // A better solution would be to create a new map (preview) before\n    // printing and avoid the tainted canvas issue. This will come later so\n    // this snippet of code is kept here in case it takes too long becomes\n    // an issue\n\n    // const target = this.component.map.ol.getTarget();\n    // this.component.map.ol.setTarget(undefined);\n    // this.component.map.init();\n    // this.component.map.ol.setTarget(target);\n\n    const viewContext: ContextMapView = context.map.view;\n    if (!this.component.view || viewContext.keepCurrentView !== true || context.map.view.projection !== this.map.projection) {\n      this.component.view = viewContext as MapViewOptions;\n    }\n    if (this.component.map.geolocationController) {\n      this.component.map.geolocationController.updateGeolocationOptions(viewContext);\n    }\n\n    const controlsContext: MapControlsOptions = context.map.controls;\n    if (!this.component.controls && controlsContext) {\n      if (this.mediaService.isMobile()) {\n        if (typeof(controlsContext.scaleLine) !== 'boolean') {\n          const scaleLineOption = controlsContext.scaleLine as MapScaleLineOptions;\n          if (!scaleLineOption.minWidth) {\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\n            controlsContext.scaleLine = scaleLineOption;\n          }\n        }\n      }\n      this.component.controls = controlsContext;\n    }\n  }\n}\n","import { Directive, OnInit, OnDestroy, Optional, Input } from '@angular/core';\n\nimport { Subscription, merge } from 'rxjs';\nimport { buffer, debounceTime, filter } from 'rxjs/operators';\n\nimport { RouteService, ConfigService } from '@igo2/core';\nimport {\n  MapBrowserComponent,\n  Layer,\n  LayerService,\n  LayerOptions,\n  StyleListService,\n  StyleService\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext } from './context.interface';\nimport {\n  addImportedFeaturesToMap,\n  addImportedFeaturesStyledToMap\n} from '../../context-import-export/shared/context-import.utils';\nimport GeoJSON from 'ol/format/GeoJSON';\n\n@Directive({\n  selector: '[igoLayerContext]'\n})\nexport class LayerContextDirective implements OnInit, OnDestroy {\n  private context$$: Subscription;\n  private queryParams: any;\n\n  private contextLayers: Layer[] = [];\n\n  @Input() removeLayersOnContextChange: boolean = true;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private contextService: ContextService,\n    private layerService: LayerService,\n    private configService: ConfigService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n\n    if (\n      this.route &&\n      this.route.options.visibleOnLayersKey &&\n      this.route.options.visibleOffLayersKey &&\n      this.route.options.contextKey\n    ) {\n      const queryParams$$ = this.route.queryParams.subscribe((params) => {\n        if (Object.keys(params).length > 0) {\n          this.queryParams = params;\n          queryParams$$.unsubscribe();\n        }\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.layers === undefined) {\n      return;\n    }\n    if (this.removeLayersOnContextChange === true) {\n      this.map.removeAllLayers();\n    } else {\n      this.map.removeLayers(this.contextLayers);\n    }\n    this.contextLayers = [];\n\n    const layersAndIndex$ = merge(\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\n      })\n    );\n\n    layersAndIndex$\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\n      .subscribe((layers: Layer[]) => {\n        this.handleAddLayers(layers);\n\n        if (context.extraFeatures) {\n          context.extraFeatures.forEach((featureCollection) => {\n            const format = new GeoJSON();\n            const title = featureCollection.name;\n            featureCollection = JSON.stringify(featureCollection);\n            featureCollection = format.readFeatures(featureCollection, {\n              dataProjection: 'EPSG:4326',\n              featureProjection: 'EPSG:3857'\n            });\n            const importExportOptions = this.configService.getConfig('importExport');\n            const importWithStyle =importExportOptions?.importWithStyle || this.configService.getConfig('importWithStyle');\n            if (this.configService.getConfig('importWithStyle')) {\n              console.warn(`\n              The location of this config importWithStyle is deprecated.\n              Please move this property within importExport configuration.\n              Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\n              Refer to environnement.ts OR config/config.json\n              This legacy conversion will be deleted in 2024.\n              `);\n            }\n            if (!importWithStyle) {\n              addImportedFeaturesToMap(featureCollection, this.map, title);\n            } else {\n              addImportedFeaturesStyledToMap(\n                featureCollection,\n                this.map,\n                title,\n                this.styleListService,\n                this.styleService\n              );\n            }\n          });\n        }\n      });\n\n      this.layerService.createAsyncIdbLayers(context.uri).pipe(debounceTime(500))\n      .subscribe((layers: Layer[]) => this.handleAddLayers(layers));\n\n  }\n\n  private handleAddLayers(layers: Layer[]) {\n    layers = layers\n      .filter((layer: Layer) => layer !== undefined)\n      .map((layer) => {\n        layer.visible = this.computeLayerVisibilityFromUrl(layer);\n        layer.zIndex = layer.zIndex;\n\n        return layer;\n      });\n    this.contextLayers.concat(layers);\n    this.map.addLayers(layers);\n  }\n\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\n    const params = this.queryParams;\n    const currentContext = this.contextService.context$.value.uri;\n    const currentLayerid: string = layer.id;\n\n    let visible = layer.visible;\n    if (!params || !currentLayerid) {\n      return visible;\n    }\n\n    const contextParams = params[this.route.options.contextKey as string];\n    if (contextParams === currentContext || !contextParams) {\n      let visibleOnLayersParams = '';\n      let visibleOffLayersParams = '';\n      let visiblelayers: string[] = [];\n      let invisiblelayers: string[] = [];\n\n      if (\n        this.route.options.visibleOnLayersKey &&\n        params[this.route.options.visibleOnLayersKey as string]\n      ) {\n        visibleOnLayersParams =\n          params[this.route.options.visibleOnLayersKey as string];\n      }\n      if (\n        this.route.options.visibleOffLayersKey &&\n        params[this.route.options.visibleOffLayersKey as string]\n      ) {\n        visibleOffLayersParams =\n          params[this.route.options.visibleOffLayersKey as string];\n      }\n\n      /* This order is important because to control whichever\n       the order of * param. First whe open and close everything.*/\n      if (visibleOnLayersParams === '*') {\n        visible = true;\n      }\n      if (visibleOffLayersParams === '*') {\n        visible = false;\n      }\n\n      // After, managing named layer by id (context.json OR id from datasource)\n      visiblelayers = visibleOnLayersParams.split(',');\n      invisiblelayers = visibleOffLayersParams.split(',');\n      if (visiblelayers.indexOf(currentLayerid) > -1 || visiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = true;\n      }\n      if (invisiblelayers.indexOf(currentLayerid) > -1 || invisiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = false;\n      }\n    }\n\n    return visible;\n  }\n}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  IgoMap,\n  VectorLayer,\n  QueryableDataSourceOptions,\n  StyleService,\n  StyleListService,\n  StyleByAttribute,\n  ClusterParam,\n  ClusterDataSourceOptions,\n  ClusterDataSource,\n  featureRandomStyle,\n  featureRandomStyleFunction\n} from '@igo2/geo';\nimport { MessageService } from '@igo2/core';\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport OlFeature from 'ol/Feature';\n\nexport function handleFileImportSuccess(\n  file: File,\n  context: DetailedContext,\n  messageService: MessageService,\n  contextService: ContextService\n) {\n  if (Object.keys(context).length <= 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  const contextTitle = computeLayerTitleFromFile(file);\n\n  addContextToContextList(context, contextTitle, contextService);\n\n  messageService.success(\n    'igo.context.contextImportExport.import.success.text',\n    'igo.context.contextImportExport.import.success.title', undefined, {\n      value: contextTitle\n    });\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.invalid.text',\n    'igo.context.contextImportExport.import.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.tooLarge.text',\n    'igo.context.contextImportExport.import.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    });\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.unreadable.text',\n    'igo.context.contextImportExport.import.unreadable.title',\n    undefined,\n    {\n      value: file.name\n    });\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.empty.text',\n    'igo.context.contextImportExport.import.empty.title',\n    undefined,\n    { value: file.name });\n}\n\nexport function addContextToContextList(\n  context: DetailedContext,\n  contextTitle: string,\n  contextService: ContextService\n) {\n  context.title = contextTitle;\n  context.imported = true;\n  contextService.contexts$.value.ours.unshift(context);\n  contextService.contexts$.next(contextService.contexts$.value);\n  contextService.importedContext.unshift(context);\n  contextService.loadContext(context.uri);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n\nexport function addImportedFeaturesToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  let randomStyle;\n  let editable: boolean = false;\n  if (\n    olFeatures[0].getKeys().includes('_style') ||\n    olFeatures[0].getKeys().includes('_mapTitle')) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    style: randomStyle\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nexport function addImportedFeaturesStyledToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute, resolution);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style'), feature, resolution\n    );\n  } else {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList('default.style'), feature, resolution\n    );\n  }\n  let source;\n\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions &\n      QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    style\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html'\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">{{ 'igo.context.bookmarkButton.dialog.title' | translate }}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input matInput required autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.bookmarkButton.dialog.placeholder' | translate\"\n      [(ngModel)]=\"title\">\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\"\n         [disabled]=\"!title\"\n         (click)=\"dialogRef.close(title)\">\n    {{'igo.common.confirmDialog.confirmBtn' | translate}}\n  </button>\n  <button mat-button\n          (click)=\"dialogRef.close(false)\">\n    {{'igo.common.confirmDialog.cancelBtn' | translate}}\n  </button>\n</div>\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{'mat-list-item-light': hidden}\">\n  <button mat-list-avatar\n    *ngIf=\"auth.authenticated\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"auth.authenticated ? ('igo.context.contextManager.favorite' | translate) : ''\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\">\n    <mat-icon *ngIf=\"!context.iconImage\" svgIcon=\"{{context.icon ? context.icon : context.scope === 'public' ? 'earth' : 'star'}}\"></mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\">\n  </button>\n  <button mat-list-avatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\">\n    <mat-icon svgIcon=\"star\"></mat-icon>\n  </button>\n  <h4 matLine>{{context.title}}</h4>\n\n  <div *ngIf=\"auth.authenticated\"\n       igoStopPropagation\n       class=\"igo-actions-container\">\n\n     <button *ngIf=\"collapsed && selected && (context.permission === typePermission[typePermission.write] || context.imported)\"\n       class=\"save-button\"\n       mat-icon-button\n       [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n       matTooltipShowDelay=\"500\"\n       [color]=\"color\"\n       (click)=\"save.emit(context)\">\n       <mat-icon svgIcon=\"content-save\"></mat-icon>\n     </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n\n      <button *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.managePermissions' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\">\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\n      </button>\n\n      <!--button\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\n        [color]=\"color\"\n        (click)=\"manageTools.emit(context)\">\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\n      </button-->\n\n      <button *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\">\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] && !context.imported\"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\">\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\">\n        <mat-icon svgIcon=\"eye\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\">\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] || context.imported\"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=collapsed\n      (click)=\"collapsed = !collapsed\">\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n\n  </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input() showFavorite: boolean = true;\n  @Input() context: DetailedContext;\n  @Input() default: boolean;\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context: DetailedContext) {\n    this.favorite.emit(context);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <mat-form-field *ngIf=\"showFilter()\" [ngClass]=\"auth.authenticated && configService.getConfig('context') ? 'context-filter-min-width' : 'context-filter-max-width'\">\n    <input\n      matInput\n      type=\"text\"\n      [placeholder]=\"'igo.context.contextManager.filterPlaceHolder' | translate\"\n      [(ngModel)]=\"term\">\n    <button\n      mat-button\n      mat-icon-button\n      matSuffix\n      class=\"clear-button\"\n      *ngIf=\"term.length\"\n      aria-label=\"Clear\"\n      color=\"warn\"\n      (click)=\"clearFilter()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <button\n  *ngIf=\"!sortedAlpha\"\n  class=\"sort-alpha\"\n  mat-icon-button\n  [matTooltip]=\"'igo.context.contextManager.sortAlphabetically' | translate\"\n  matTooltipShowDelay=\"500\"\n  (click)=\"toggleSort(true)\">\n  <mat-icon color=\"primary\" svgIcon=\"sort-alphabetical-variant\"></mat-icon>\n  </button>\n  <button\n    *ngIf=\"sortedAlpha\"\n    class=\"sort-alpha\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSort(false)\">\n    <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\n  </button>\n\n  <igo-actionbar *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"add-context-button\"\n    [iconColor]=\"color\"\n    [store]=\"actionStore\"\n    [withIcon]=\"true\"\n    icon=\"plus\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"false\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n  <button *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"users-filter\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\n    matTooltipShowDelay=\"500\"\n    [matMenuTriggerFor]=\"accountMenu\">\n    <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\n  </button>\n\n  <mat-menu #accountMenu=\"matMenu\">\n    <ng-container *ngFor=\"let user of users\">\n      <span class=\"profilsMenu\">\n        <mat-checkbox\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(user).checked\"\n          [indeterminate]=\"getPermission(user).indeterminate\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(user)\">\n        </mat-checkbox>\n        <button *ngIf=\"user.childs\"\n          [matMenuTriggerFor]=\"subAccountMenu\"\n          mat-menu-item>\n          {{user.title}}\n        </button>\n        <button\n          mat-menu-item\n          *ngIf=\"!user.childs\">\n          {{user.title}}\n        </button>\n      </span>\n\n      <mat-menu #subAccountMenu=\"matMenu\">\n        <mat-checkbox *ngFor=\"let child of user.childs\"\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(child).checked\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(child, user)\">\n          {{child.title}}\n        </mat-checkbox>\n      </mat-menu>\n    </ng-container>\n\n    <span class=\"profilsMenu\">\n      <mat-checkbox\n        class=\"mat-menu-item\"\n        [checked]=\"showHidden\"\n        (click)=\"$event.stopPropagation()\"\n        (change)=\"showHiddenContexts.emit()\">\n      </mat-checkbox>\n      <button mat-menu-item>\n        {{ 'igo.context.contextManager.showHidden' | translate }}\n      </button>\n    </span>\n  </mat-menu>\n\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\n\n    <igo-collapsible *ngIf=\"groupContexts.value.length && auth.authenticated\" [title]=\"titleMapping[groupContexts.key] | translate\"\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\" (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\">\n\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\n        <igo-context-item\n          igoListItem\n          color=\"accent\"\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n          [context]=\"context\"\n          [default]=\"context.id && this.defaultContextId && this.defaultContextId === context.id\"\n          (edit)=\"edit.emit(context)\"\n          (delete)=\"delete.emit(context)\"\n          (clone)=\"clone.emit(context)\"\n          (save)=\"save.emit(context)\"\n          (hide)=\"hideContext(context)\"\n          (show)=\"showContext(context)\"\n          (favorite)=\"favorite.emit(context)\"\n          (manageTools)=\"manageTools.emit(context)\"\n          (managePermissions)=\"managePermissions.emit(context)\"\n          (select)=\"select.emit(context)\"\n          (unselect)=\"unselect.emit(context)\">\n        </igo-context-item>\n      </ng-template>\n\n    </igo-collapsible>\n\n    <ng-template *ngIf=\"groupContexts.value.length && !auth.authenticated\" ngFor let-context [ngForOf]=\"groupContexts.value\">\n      <igo-context-item\n        igoListItem\n        color=\"accent\"\n        [showFavorite]=\"configService.getConfig('favoriteContext4NonAuthenticated')\"\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n        [context]=\"context\"\n        [default]=\"configService.getConfig('context') ? defaultContextId === context.id : defaultContextId === context.uri\"\n        (favorite)=\"favorite.emit(context)\"\n        (select)=\"select.emit(context)\"\n        (unselect)=\"unselect.emit(context)\">\n      </igo-context-item>\n    </ng-template>\n\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef,\n  OnInit,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\nimport {\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission,\n  ContextProfils\n} from '../shared/context.interface';\nimport { ContextListControlsEnum } from './context-list.enum';\nimport {\n  Subscription,\n  BehaviorSubject,\n  ReplaySubject,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\nimport { debounce } from 'rxjs/operators';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\n\n@Component({\n  selector: 'igo-context-list',\n  templateUrl: './context-list.component.html',\n  styleUrls: ['./context-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextListComponent implements OnInit, OnDestroy {\n  private contextsInitial: ContextsList = { ours: [] };\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\n    this.contextsInitial\n  );\n\n  change$ = new ReplaySubject<void>(1);\n\n  private change$$: Subscription;\n\n  @Input()\n  get contexts(): ContextsList {\n    return this._contexts;\n  }\n  set contexts(value: ContextsList) {\n    this._contexts = value;\n    this.cdRef.detectChanges();\n    this.next();\n  }\n  private _contexts: ContextsList = { ours: [] };\n\n  @Input()\n  get selectedContext(): DetailedContext {\n    return this._selectedContext;\n  }\n  set selectedContext(value: DetailedContext) {\n    this._selectedContext = value;\n    this.cdRef.detectChanges();\n  }\n  private _selectedContext: DetailedContext;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get defaultContextId(): string {\n    return this.configService.getConfig('context') ? this._defaultContextId :\n      this.storageService.get('favorite.context.uri') as string || this._defaultContextId;\n  }\n  set defaultContextId(value: string) {\n    this._defaultContextId = value;\n  }\n  private _defaultContextId: string;\n\n  public collapsed: { contextScope }[] = [];\n\n  @Output() select = new EventEmitter<DetailedContext>();\n  @Output() unselect = new EventEmitter<DetailedContext>();\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n  @Output() filterPermissionsChanged = new EventEmitter<\n    ContextUserPermission[]\n  >();\n\n  public titleMapping = {\n    ours: 'igo.context.contextManager.ourContexts',\n    shared: 'igo.context.contextManager.sharedContexts',\n    public: 'igo.context.contextManager.publicContexts'\n  };\n\n  public users: ContextProfils[];\n  public permissions: ContextUserPermission[] = [];\n\n  public actionStore = new ActionStore([]);\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public color = 'primary';\n\n  public showHidden = false;\n\n  /**\n   * Context filter term\n   */\n  @Input()\n  set term(value: string) {\n    this._term = value;\n    this.next();\n  }\n  get term(): string {\n    return this._term;\n  }\n  public _term: string = '';\n\n  get sortedAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortedAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha: boolean = undefined;\n\n  public showContextFilter = ContextListControlsEnum.always;\n\n  public thresholdToFilter = 5;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    public configService: ConfigService,\n    public auth: AuthService,\n    private dialog: MatDialog,\n    private languageService: LanguageService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit() {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.contexts.ours.length === 0 &&\n            this.contexts.public?.length === 0 &&\n            this.contexts.shared?.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.contexts$.next(this.filterContextsList(this.contexts));\n      });\n\n    this.actionStore.load([\n      {\n        id: 'emptyContext',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContext'\n        ),\n        icon: 'map-outline',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContextTooltip'\n        ),\n        handler: () => {\n          this.createContext(true);\n        }\n      },\n      {\n        id: 'contextFromMap',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMap'\n        ),\n        icon: 'map-check',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMapTooltip'\n        ),\n        handler: () => {\n          this.createContext(false);\n        }\n      }\n    ]);\n  }\n\n  private next() {\n    this.change$.next();\n  }\n\n  private filterContextsList(contexts: ContextsList) {\n    if (this.term === '') {\n      if (this.sortedAlpha) {\n        contexts = this.sortContextsList(contexts);\n      }\n      return contexts;\n    } else {\n      const ours = contexts.ours.filter((context) => {\n        const filterNormalized = this.term\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const contextTitleNormalized = context.title\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        return contextTitleNormalized.includes(filterNormalized);\n      });\n\n      let updateContexts: ContextsList = {\n        ours\n      };\n\n      if (this.contexts.public) {\n        const publics = contexts.public.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.public = publics;\n      }\n\n      if (this.contexts.shared) {\n        const shared = contexts.shared.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.shared = shared;\n      }\n\n      if (this.sortedAlpha) {\n        updateContexts = this.sortContextsList(updateContexts);\n      }\n      return updateContexts;\n    }\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n\n  public showFilter() {\n    switch (this.showContextFilter) {\n      case ContextListControlsEnum.always:\n        return true;\n      case ContextListControlsEnum.never:\n        return false;\n      default:\n        let totalLength = this.contexts.ours.length;\n        this.contexts.public\n          ? (totalLength += this.contexts.public.length)\n          : (totalLength += 0);\n        this.contexts.shared\n          ? (totalLength += this.contexts.shared.length)\n          : (totalLength += 0);\n        if (totalLength >= this.thresholdToFilter) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  sortContextsList(contexts: ContextsList) {\n    if (contexts) {\n      const contextsList = JSON.parse(JSON.stringify(contexts));\n      contextsList.ours.sort((a, b) => {\n        if (this.normalize(a.title) < this.normalize(b.title)) {\n          return -1;\n        }\n        if (this.normalize(a.title) > this.normalize(b.title)) {\n          return 1;\n        }\n        return 0;\n      });\n\n      if (contextsList.shared) {\n        contextsList.shared.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      } else if (contextsList.public) {\n        contextsList.public.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      }\n      return contextsList;\n    }\n  }\n\n  normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  toggleSort(sortAlpha: boolean) {\n    this.sortedAlpha = sortAlpha;\n  }\n\n  clearFilter() {\n    this.term = '';\n  }\n\n  createContext(empty?: boolean) {\n    this.dialog\n      .open(BookmarkDialogComponent, { disableClose: false })\n      .afterClosed()\n      .pipe(take(1))\n      .subscribe((title: string) => {\n        if (title) {\n          this.create.emit({ title, empty });\n        }\n      });\n  }\n\n  getPermission(user?): ContextUserPermission {\n    if (user) {\n      const permission = this.permissions.find((p) => p.name === user.name);\n      return permission;\n    }\n  }\n\n  userSelection(user, parent?) {\n    const permission = this.getPermission(user);\n    if (permission) {\n      permission.checked = !permission.checked;\n      this.storageService.set(\n        'contexts.permissions.' + permission.name,\n        permission.checked\n      );\n      permission.indeterminate = false;\n    }\n\n    if (parent) {\n      let indeterminate = false;\n\n      for (const c of parent.childs) {\n        const cPermission = this.getPermission(c);\n        if (cPermission.checked !== permission.checked) {\n          indeterminate = true;\n          break;\n        }\n      }\n      const parentPermission = this.getPermission(parent);\n      if (parentPermission) {\n        parentPermission.checked = permission.checked;\n        this.storageService.set(\n          'contexts.permissions.' + parentPermission.name,\n          permission.checked\n        );\n        parentPermission.indeterminate = indeterminate;\n      }\n    }\n\n    if (user.childs) {\n      for (const c of user.childs) {\n        const childrenPermission = this.getPermission(c);\n        if (\n          childrenPermission &&\n          childrenPermission.checked !== permission.checked\n        ) {\n          childrenPermission.checked = permission.checked;\n          this.storageService.set(\n            'contexts.permissions.' + childrenPermission.name,\n            permission.checked\n          );\n        }\n      }\n    }\n\n    this.filterPermissionsChanged.emit(this.permissions);\n  }\n\n  hideContext(context: DetailedContext) {\n    context.hidden = true;\n    if (!this.showHidden) {\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\n      this.contexts = contexts;\n    }\n    this.hide.emit(context);\n  }\n\n  showContext(context: DetailedContext) {\n    context.hidden = false;\n    this.show.emit(context);\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  OnDestroy,\n  HostListener,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MessageService, LanguageService, StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { ConfirmDialogService } from '@igo2/common';\nimport { MapService } from '@igo2/geo';\n\nimport {\n  Context,\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextListComponent } from './context-list.component';\n\n@Directive({\n  selector: '[igoContextListBinding]'\n})\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\n  private component: ContextListComponent;\n  private contexts$$: Subscription;\n  private selectedContext$$: Subscription;\n  private defaultContextId$$: Subscription;\n  private previousMessageId;\n\n  @HostListener('select', ['$event'])\n  onSelect(context: Context) {\n    this.contextService.loadContext(context.uri);\n  }\n\n  @HostListener('edit', ['$event'])\n  onEdit(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('save', ['$event'])\n  onSave(context: Context) {\n    const map = this.mapService.getMap();\n    const contextFromMap = this.contextService.getContextFromMap(map);\n\n    const msgSuccess = () => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.saveMsg',\n        'igo.context.contextManager.dialog.saveTitle',\n        undefined,\n        {\n          value: context.title\n        });\n    };\n\n    if (context.imported) {\n      contextFromMap.title = context.title;\n      this.contextService.delete(context.id, true);\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\n        this.contextService.loadContext(contextCreated.uri);\n        msgSuccess();\n      });\n      return;\n    }\n\n    const changes: any = {\n      layers: contextFromMap.layers,\n      map: {\n        view: contextFromMap.map.view\n      }\n    };\n\n    this.contextService.update(context.id, changes).subscribe(() => {\n      msgSuccess();\n    });\n  }\n\n  @HostListener('favorite', ['$event'])\n  onFavorite(context: Context) {\n    if (!context.id) {\n      context.id = context.uri;\n    }\n    this.contextService.setDefault(context.id).subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.contextService.defaultContextId$.next(context.id);\n      const messageObj = this.messageService.success(\n        'igo.context.contextManager.dialog.favoriteMsg',\n      'igo.context.contextManager.dialog.favoriteTitle',\n      undefined,\n      {\n        value: context.title\n      }\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  @HostListener('manageTools', ['$event'])\n  onManageTools(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('managePermissions', ['$event'])\n  onManagePermissions(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('delete', ['$event'])\n  onDelete(context: Context) {\n    const translate = this.languageService.translate;\n    this.confirmDialogService\n      .open(\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\n      )\n      .subscribe((confirm) => {\n        if (confirm) {\n          this.contextService\n            .delete(context.id, context.imported)\n            .subscribe(() => {\n              this.messageService.info(\n                'igo.context.contextManager.dialog.deleteMsg',\n                'igo.context.contextManager.dialog.deleteTitle',\n                undefined,\n                {value: context.title});\n            });\n        }\n      });\n  }\n\n  @HostListener('clone', ['$event'])\n  onClone(context: DetailedContext) {\n    const properties = {\n      title: context.title + '-copy',\n      uri: context.uri + '-copy'\n    };\n    this.contextService.clone(context.id, properties).subscribe(() => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.cloneMsg',\n        'igo.context.contextManager.dialog.cloneTitle',\n        undefined,\n        { value: context.title });\n    });\n  }\n\n  @HostListener('create', ['$event'])\n  onCreate(opts: { title: string; empty: boolean }) {\n    const { title, empty } = opts;\n    const context = this.contextService.getContextFromMap(\n      this.component.map,\n      empty\n    );\n    context.title = title;\n    this.contextService.create(context).subscribe(() => {\n      this.messageService.success(\n        'igo.context.bookmarkButton.dialog.createMsg',\n        'igo.context.bookmarkButton.dialog.createTitle',\n        undefined,\n        { value: context.title });\n      this.contextService.loadContext(context.uri);\n    });\n  }\n\n  @HostListener('filterPermissionsChanged')\n  loadContexts() {\n    const permissions = ['none'];\n    for (const p of this.component.permissions) {\n      if (p.checked === true || p.indeterminate === true) {\n        permissions.push(p.name);\n      }\n    }\n    this.component.showHidden\n      ? this.contextService.loadContexts(permissions, true)\n      : this.contextService.loadContexts(permissions, false);\n  }\n\n  @HostListener('showHiddenContexts')\n  showHiddenContexts() {\n    this.component.showHidden = !this.component.showHidden;\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\n    this.loadContexts();\n  }\n\n  @HostListener('show', ['$event'])\n  onShowContext(context: DetailedContext) {\n    this.contextService.showContext(context.id).subscribe();\n  }\n\n  @HostListener('hide', ['$event'])\n  onHideContext(context: DetailedContext) {\n    this.contextService.hideContext(context.id).subscribe();\n  }\n\n  constructor(\n    @Self() component: ContextListComponent,\n    private contextService: ContextService,\n    private mapService: MapService,\n    private languageService: LanguageService,\n    private confirmDialogService: ConfirmDialogService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private storageService: StorageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input contexts\n    this.component.contexts = { ours: [] };\n    this.component.showHidden = this.storageService.get(\n      'contexts.showHidden'\n    ) as boolean;\n\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\n      this.handleContextsChange(contexts)\n    );\n\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\n      (id) => {\n        this.component.defaultContextId = id;\n      }\n    );\n    const storedContextUri = this.storageService.get('favorite.context.uri') as string;\n    if (storedContextUri && !this.auth.authenticated) {\n      this.contextService.defaultContextId$.next(storedContextUri);\n    }\n\n    // See feature-list.component for an explanation about the debounce time\n    this.selectedContext$$ = this.contextService.context$\n      .pipe(debounceTime(100))\n      .subscribe((context) => (this.component.selectedContext = context));\n\n    this.auth.authenticate$.subscribe((authenticate) => {\n      if (authenticate) {\n        this.contextService.getProfilByUser().subscribe((profils) => {\n          this.component.users = profils;\n          this.component.permissions = [];\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\n            acc = acc.concat(cur);\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\n            return acc;\n          }, []);\n\n          for (const user of profilsAcc) {\n            const permission: ContextUserPermission = {\n              name: user.name,\n              checked: this.storageService.get(\n                'contexts.permissions.' + user.name\n              ) as boolean\n            };\n            if (permission.checked === null) {\n              permission.checked = true;\n            }\n            this.component.permissions.push(permission);\n          }\n\n          const permissions = ['none'];\n          for (const p of this.component.permissions) {\n            if (p.checked === true || p.indeterminate === true) {\n              permissions.push(p.name);\n            }\n          }\n\n          this.component.showHidden\n            ? this.contextService.loadContexts(permissions, true)\n            : this.contextService.loadContexts(permissions, false);\n        });\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.contexts$$.unsubscribe();\n    this.selectedContext$$.unsubscribe();\n    this.defaultContextId$$.unsubscribe();\n  }\n\n  private handleContextsChange(contexts: ContextsList) {\n    this.component.contexts = contexts;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, EMPTY } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\nimport { Poi } from './poi.interface';\n\n@Injectable()\nexport class PoiService {\n  private baseUrl: string;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.baseUrl = this.config.getConfig('context.url');\n  }\n\n  get(): Observable<Poi[]> {\n    if (!this.baseUrl) {\n      return EMPTY;\n    }\n\n    const url = this.baseUrl + '/pois';\n    return this.http.get<Poi[]>(url);\n  }\n\n  delete(id: string): Observable<void> {\n    const url = this.baseUrl + '/pois/' + id;\n    return this.http.delete<void>(url);\n  }\n\n  create(context: Poi): Observable<Poi> {\n    const url = this.baseUrl + '/pois';\n    return this.http.post<Poi>(url, context);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\nimport { PoiService } from './poi-button/shared/poi.service';\nimport { UserDialogComponent } from './user-button/user-dialog.component';\nimport { UserButtonComponent } from './user-button/user-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    IgoStopPropagationModule,\n    IgoAuthModule,\n    FormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatDialogModule,\n    MatInputModule\n  ],\n  exports: [BookmarkButtonComponent, PoiButtonComponent, UserButtonComponent, BookmarkDialogComponent],\n  declarations: [\n    BookmarkButtonComponent,\n    BookmarkDialogComponent,\n    PoiButtonComponent,\n    PoiDialogComponent,\n    UserButtonComponent,\n    UserDialogComponent\n  ],\n  providers: [PoiService]\n})\nexport class IgoContextMapButtonModule {\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\n    return {\n      ngModule: IgoContextMapButtonModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoAuthModule } from '@igo2/auth';\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoCollapsibleModule,\n  IgoStopPropagationModule,\n  IgoActionbarModule\n} from '@igo2/common';\n\nimport { MapContextDirective } from './shared/map-context.directive';\nimport { LayerContextDirective } from './shared/layer-context.directive';\nimport { ContextListComponent } from './context-list/context-list.component';\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\nimport { ContextItemComponent } from './context-item/context-item.component';\nimport { ContextFormComponent } from './context-form/context-form.component';\nimport { ContextEditComponent } from './context-edit/context-edit.component';\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\n\nconst CONTEXT_DIRECTIVES = [\n  MapContextDirective,\n  LayerContextDirective\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatListModule,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatDialogModule,\n    MatMenuModule,\n    MatOptionModule,\n    MatAutocompleteModule,\n    IgoAuthModule,\n    IgoListModule,\n    IgoKeyValueModule,\n    IgoCollapsibleModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoContextImportExportModule,\n    IgoContextMapButtonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ],\n  declarations: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ]\n})\nexport class IgoContextManagerModule {\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\n    return {\n      ngModule: IgoContextManagerModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\nimport { ExportOptions } from '@igo2/geo';\n\nexport enum ImportExportType {\n  layer = 'layer',\n  context = 'context'\n}\n\nexport enum ImportExportMode {\n  import = 'import',\n  export = 'export'\n}\n\n/**\n * Service that holds the state of the importExport module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportExportState {\n\n  readonly importExportType$: BehaviorSubject<ImportExportType> = new BehaviorSubject(ImportExportType.layer);\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> = new BehaviorSubject(ImportExportMode.import);\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(undefined);\n\n  setImportExportType(type: ImportExportType) {\n    this.importExportType$.next(type);\n  }\n\n  setMode(mode: ImportExportMode) {\n    this.selectedMode$.next(mode);\n  }\n\n  setsExportOptions(exportOptions: ExportOptions) {\n      this.exportOptions$.next(exportOptions);\n    }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { Toolbox, ToolService } from '@igo2/common';\n\nimport { ExportOptions } from '@igo2/geo';\nimport { BehaviorSubject } from 'rxjs';\nimport { ImportExportMode, ImportExportState } from '../import-export/import-export.state';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolState {\n  get toolbox(): Toolbox {\n    return this.toolService.toolbox;\n  }\n\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  constructor(\n    private toolService: ToolService,\n    private importExportState: ImportExportState\n    ) {}\n\n    toolToActivateFromOptions(toolToActivate: { tool: string; options: {[key: string]: any} }) {\n    if (!toolToActivate) { return; }\n    if (toolToActivate.tool === 'importExport') {\n      let exportOptions: ExportOptions = this.importExportState.exportOptions$.value;\n      if (!exportOptions) {\n        exportOptions = {\n          layers: toolToActivate.options.layers,\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\n        };\n      } else {\n        exportOptions.layers = toolToActivate.options.layers;\n        exportOptions.featureInMapExtent = toolToActivate.options.featureInMapExtent;\n      }\n      this.importExportState.setsExportOptions(exportOptions);\n      this.importExportState.setMode(ImportExportMode.export);\n    }\n\n    if (this.toolbox.getTool(toolToActivate.tool)) {\n      this.toolbox.activateTool(toolToActivate.tool);\n      this.openSidenav$.next(true);\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { StorageService, ConfigService } from '@igo2/core';\n\nimport { IgoMap, MapService, ProjectionService } from '@igo2/geo';\n// import { BehaviorSubject } from 'rxjs';\n\n/**\n * Service that holds the state of the map module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapState {\n\n  // public mapCenter$ = new BehaviorSubject<boolean>(false);\n  get showAllLegendsValue(): boolean {\n    return this._legendToolShowAll;\n  }\n\n  set showAllLegendsValue(value) {\n    this._legendToolShowAll = value;\n  }\n  private _legendToolShowAll: boolean;\n\n  /**\n   * Active map\n   */\n  get map(): IgoMap { return this._map; }\n  private _map: IgoMap;\n\n  constructor(\n    private mapService: MapService,\n    private projectionService: ProjectionService, // Don't remove this or it'll never be injected,\n    private storageService: StorageService,\n    private configService: ConfigService\n  ) {\n    this._map = new IgoMap({\n      controls: {\n        scaleLine: true,\n        attribution: {\n          collapsed: true\n        }\n      }\n    },\n    this.storageService,\n    this.configService);\n\n    this.mapService.setMap(this.map);\n  }\n}\n","import {\n    FeatureMotion,\n    FeatureStoreSelectionStrategy,\n    FeatureWorkspace,\n    WfsWorkspace,\n    EditionWorkspace\n} from '@igo2/geo';\n\n\nexport function handleZoomAuto(workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace, storageService) {\n    const zoomStrategy = workspace.entityStore\n        .getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    zoomStrategy.setMotion(storageService.get('zoomAuto') as boolean ? FeatureMotion.Default : FeatureMotion.None);\n}\n\n\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  FeatureWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private toolState: ToolState,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange.key !== 'zoomAuto' || storageChange.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set(\n            'zoomAuto',\n            !this.storageService.get('zoomAuto') as boolean\n          );\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.tooltip',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\n            selected: false\n          });\n        },\n        args: [workspace],\n        availability: (ws: FeatureWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'featureDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterCustomFuncStrategy\n          );\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterSelectionStrategy\n          );\n          const layersWithSelection = filterSelectionStrategy.active\n            ? [ws.layer.id]\n            : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: {\n              layers: [ws.layer.id],\n              featureInMapExtent: filterStrategy.active,\n              layersWithSelection\n            } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  WfsWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterWidget,\n  OgcFilterableDataSource,\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\n        storageChange?.key !== 'zoomAuto' || storageChange?.event === StorageServiceEventEnum.CLEARED))\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    const actions = [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.title',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\n        },\n        args: [workspace],\n        availability: (ws: WfsWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'wfsDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'ogcFilter',\n        icon: 'filter',\n        title: 'igo.integration.workspace.ogcFilter.title',\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n        handler: (widget: Widget, ws: WfsWorkspace) => {\n          ws.activateWidget(widget, {\n            map: ws.map,\n            layer: ws.layer\n          });\n        },\n        args: [this.ogcFilterWidget, workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n    return (workspace.layer.dataSource as OgcFilterableDataSource).options.ogcFilters?.enabled ?\n    actions : actions.filter(action => action.id !== 'ogcFilter');\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  EditionWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterWidget,\n  OgcFilterableDataSource,\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\n        storageChange?.key !== 'zoomAuto' || storageChange?.event === StorageServiceEventEnum.CLEARED))\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    const actions = [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.title',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: EditionWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\n        },\n        args: [workspace],\n        availability: (ws: EditionWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'wfsDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: EditionWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'ogcFilter',\n        icon: 'filter',\n        title: 'igo.integration.workspace.ogcFilter.title',\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n        handler: (widget: Widget, ws: EditionWorkspace) => {\n          ws.activateWidget(widget, {\n            map: ws.map,\n            layer: ws.layer\n          });\n        },\n        args: [this.ogcFilterWidget, workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n    return (workspace.layer.dataSource as OgcFilterableDataSource).options.ogcFilters?.enabled ?\n    actions : actions.filter(action => action.id !== 'ogcFilter');\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject, Subscription, Observable, of } from 'rxjs';\n\nimport {\n  EntityRecord,\n  Workspace,\n  WorkspaceStore,\n  Widget,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityState } from '@igo2/common';\nimport { WfsWorkspace, FeatureWorkspace, EditionWorkspace } from '@igo2/geo';\nimport { FeatureActionsService } from './shared/feature-actions.service';\nimport { WfsActionsService } from './shared/wfs-actions.service';\nimport { StorageService } from '@igo2/core';\nimport { EditionActionsService } from './shared/edition-actions.service';\n\n/**\n * Service that holds the state of the workspace module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class WorkspaceState implements OnDestroy {\n\n  public workspacePanelExpanded: boolean = false;\n\n  readonly workspaceEnabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  readonly workspaceMaximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n  private actionMaximize$$: Subscription[] = [];\n\n  private rowsInMapExtentCheckCondition$$: Subscription;\n  private selectOnlyCheckCondition$$: Subscription;\n\n  /** Subscription to the active workspace */\n  private activeWorkspace$$: Subscription;\n\n  /** Subscription to the active workspace widget */\n  private activeWorkspaceWidget$$: Subscription;\n\n  /** Active widget observable. Only one may be active for all available workspaces */\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the active workspace\n   */\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\n\n  /**\n   * Store that holds all the available workspaces\n   */\n  get store(): WorkspaceStore { return this._store; }\n  private _store: WorkspaceStore;\n\n  get workspaceSelection() {\n    if (this.workspace$.value) {\n    return this.workspace$.value?.entityStore.stateView.manyBy((r) => r.state.selected === true);\n    } else {\n      return [];\n    }\n  }\n\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore?.stateView.manyBy$((r) => r.state.selected === true);\n    } else {\n      return of([]);\n    }\n  }\n\n  constructor(\n    private featureActionsService: FeatureActionsService,\n    private wfsActionsService: WfsActionsService,\n    private editionActionsService: EditionActionsService,\n    private storageService: StorageService\n  ) {\n    this.initWorkspaces();\n  }\n\n  /**\n   * Initialize the workspace store. Each time a workspace is activated,\n   * subscribe to it's active widget. Tracking the active widget is useful\n   * to make sure only one widget is active at a time.\n   */\n  private initWorkspaces() {\n    this._store = new WorkspaceStore([]);\n    this._store.stateView\n      .firstBy$((record: EntityRecord<Workspace>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Workspace>) => {\n        const workspace = record ? record.entity : undefined;\n        this.workspace$.next(workspace);\n      });\n\n    this._store.stateView.all$()\n    .subscribe((workspaces: EntityRecord<Workspace>[]) => {\n      workspaces.map((wks: EntityRecord<Workspace>) => {\n        if (wks.entity.actionStore.empty) {\n          if (wks.entity instanceof WfsWorkspace) {\n            this.wfsActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          } else if (wks.entity instanceof FeatureWorkspace) {\n            this.featureActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          } else if (wks.entity instanceof EditionWorkspace) {\n            this.editionActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          }\n        }\n\n      });\n    });\n\n    this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.activeWorkspace$$ = this.workspace$\n      .subscribe((workspace: Workspace) => {\n        if (this.activeWorkspaceWidget$$ !== undefined) {\n          this.activeWorkspaceWidget$$.unsubscribe();\n          this.activeWorkspaceWidget$$ = undefined;\n        }\n\n        if (workspace !== undefined) {\n          this.activeWorkspaceWidget$$ = workspace.widget$\n            .subscribe((widget: Widget) => this.activeWorkspaceWidget$.next(widget));\n        }\n      });\n\n    this.rowsInMapExtentCheckCondition$$ = this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          if (filterStrategy) {\n            if (rowsInMapExtent) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe((selectOnly) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          if (filterStrategy) {\n            if (selectOnly) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n  }\n\n  private setWorkspaceIsMaximized(maximized: boolean) {\n    this.storageService.set('workspaceMaximize', maximized);\n    this.workspaceMaximize$.next(maximized);\n  }\n\n  public setActiveWorkspaceById(id: string) {\n    const wksFromId = this.store\n    .all()\n    .find(workspace => workspace.id === id);\n    if (wksFromId) {\n      this.store.activateWorkspace(wksFromId);\n    }\n  }\n\n  public setActiveWorkspaceByTitle(title: string) {\n    const wksFromTitle = this.store\n      .all()\n      .find(workspace => workspace.title === title);\n    if (wksFromTitle) {\n      this.store.activateWorkspace(wksFromTitle);\n    }\n  }\n\n  /**\n   * Teardown all the workspaces\n   * @internal\n   */\n  ngOnDestroy() {\n    this.teardownWorkspaces();\n    this.actionMaximize$$.map(a => a.unsubscribe());\n    if (this.rowsInMapExtentCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n    if (this.selectOnlyCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Teardown the workspace store and any subscribers\n   */\n  private teardownWorkspaces() {\n    this.store.clear();\n    if (this.activeWorkspaceWidget$$ !== undefined) {\n      this.activeWorkspaceWidget$$.unsubscribe();\n    }\n    if (this.activeWorkspace$$ !== undefined) {\n      this.activeWorkspace$$.unsubscribe();\n    }\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  EntityRecord,\n  EntityStore,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreStrategyFuncOptions\n} from '@igo2/common';\nimport { ConfigService, StorageService } from '@igo2/core';\nimport {\n  SearchResult,\n  SearchSourceService,\n  SearchSource,\n  CommonVectorStyleOptions,\n  FeatureWorkspace,\n  FeatureStore,\n  Feature\n} from '@igo2/geo';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { WorkspaceState } from '../workspace/workspace.state';\nimport { MapState } from '../map';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchState {\n  public searchLayerStores: FeatureStore<Feature>[] = [];\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\n\n  public focusedOrResolution$$: Subscription;\n  public selectedOrResolution$$: Subscription;\n\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject('|');\n\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchSettingsChange$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(undefined);\n\n  /**\n   * Store that holds the search results\n   */\n  readonly store: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n\n  /**\n   * Search types currently enabled in the search source service\n   */\n  get searchTypes(): string[] {\n    return this.searchSourceService\n      .getEnabledSources()\n      .map((source: SearchSource) => (source.constructor as any).type);\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private storageService: StorageService,\n    private workspaceState: WorkspaceState,\n    private configService: ConfigService,\n    private mapState: MapState) {\n    const searchOverlayStyle = this.configService.getConfig('searchOverlayStyle') as {\n      base?: CommonVectorStyleOptions,\n      selection?: CommonVectorStyleOptions,\n      focus?: CommonVectorStyleOptions\n    };\n    if (searchOverlayStyle) {\n      this.searchOverlayStyle = searchOverlayStyle.base;\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\n    }\n\n    const searchResultsGeometryEnabled = this.storageService.get('searchResultsGeometryEnabled') as boolean;\n    if (searchResultsGeometryEnabled) {\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\n    }\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\n\n    const wksSource = this.searchSourceService.getSources().find(source => source.getId() === 'workspace');\n    this.workspaceState.store.entities$\n    .subscribe(e => {\n      const searchableWks = e.filter(fw => fw instanceof FeatureWorkspace && fw.layer.options.workspace.searchIndexEnabled);\n      this.searchSourceService.setWorkspaces(wksSource, searchableWks);\n    }\n    );\n    this.monitorLayerDeletion();\n  }\n\n  private monitorLayerDeletion() {\n    this.mapState.map.layers$\n      .subscribe((layers) => {\n        this.searchLayerStores.forEach((store) => {\n          let layer = layers.find(l => l.id === store.layer.id);\n          if (!layer) {\n            const index = this.searchLayerStores.indexOf(store);\n            this.searchLayerStores.splice(index, 1);\n          }\n        });\n      });\n  }\n\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\n      return record.entity.meta.score === 100;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  /**\n   * Activate custom strategy\n   *\n   */\n  activateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate custom strategy\n   *\n   */\n  deactivateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  enableSearch() {\n    this.searchDisabled$.next(false);\n  }\n\n  disableSearch() {\n    this.searchDisabled$.next(true);\n  }\n\n  setSearchTerm(searchTerm: string) {\n    this.searchTerm$.next(searchTerm);\n  }\n\n  setSearchType(searchType: string) {\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchType$.next(searchType);\n  }\n\n  setSearchSettingsChange() {\n    this.searchSettingsChange$.next(true);\n  }\n\n  setSelectedResult(result: SearchResult) {\n    this.selectedResult$.next(result);\n  }\n\n  setSearchResultsGeometryStatus(value) {\n    this.storageService.set('searchResultsGeometryEnabled', value);\n    this.searchResultsGeometryEnabled$.next(value);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoSearchModule } from '@igo2/geo';\n\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [IgoSearchModule],\n  declarations: [SearchBarBindingDirective],\n  exports: [SearchBarBindingDirective],\n})\nexport class IgoAppSearchBarModule {}\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoFlexibleModule, IgoCustomHtmlModule, IgoPanelModule } from '@igo2/common';\nimport {\n  IgoFeatureModule,\n  IgoSearchModule,\n  IgoFeatureDetailsModule\n} from '@igo2/geo';\n\nimport { SearchResultsToolComponent } from './search-results-tool.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFeatureModule,\n    IgoSearchModule,\n    IgoFlexibleModule,\n    IgoPanelModule,\n    IgoFeatureDetailsModule,\n    IgoCustomHtmlModule\n  ],\n  declarations: [SearchResultsToolComponent],\n  exports: [SearchResultsToolComponent],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\n})\nexport class IgoAppSearchResultsToolModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n   IgoAppSearchBarModule,\n   IgoAppSearchResultsToolModule\n  ],\n})\nexport class IgoAppSearchModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Search</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/search\">code of this example</a><br>\n    See search section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n    <br>\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      F2 activate/deactivate the pointer location.\n    </span>\n  </mat-card-content>\n\n  <igo-map-browser #mapBrowser [map]=\"map\" [view]=\"view\" igoOverlay [igoContextMenu]=actionbarMenu igoLongPress\n\n    igoSearchPointerSummary\n    [igoSearchPointerSummaryDelay]=\"500\"\n    [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n    (menuPosition)=\"onContextMenuOpen($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Search\">\n    <igo-search-bar\n      [term]=\"term\"\n      (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n      [searchSettings]=\"true\"\n      [store]=\"searchStore\"\n      [termSplitter]=\"termSplitter\"\n      (searchTermChange)=\"onSearchTermChange($event)\"\n      (search)=\"onSearch($event)\"\n      (clearFeature)=\"removeFeatureFromMap()\"\n      (searchSettingsChange)=\"onSearchSettingsChange()\"\n      [reverseSearchCoordsFormatEnabled]=\"igoReverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"onReverseCoordsFormatStatusChange($event)\">\n    </igo-search-bar>\n\n    <igo-search-results\n      [store]=\"searchStore\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      placeholder=\"false\"\n      [settingsChange$]=\"settingsChange$\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultFocus($event)\"\n      (moreResults)=\"onSearch($event)\">\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button\n            [map]=\"map\"\n            [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n    </igo-search-results>\n\n  </igo-panel>\n\n  <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n    <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n  </igo-panel>\n\n</mat-card>\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"false\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSearchComponent } from './search.component';\n\nconst routes: Routes = [\n  {\n    path: 'search',\n    component: AppSearchComponent\n  }\n];\n\nexport const AppSearchRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { BehaviorSubject } from 'rxjs';\nimport {\n  Component,\n  ElementRef,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport * as proj from 'ol/proj';\n\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\nimport { EntityStore, ActionStore } from '@igo2/common';\nimport {\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  GoogleLinks,\n  IgoMap,\n  LayerService,\n  MapService,\n  Layer,\n  ProjectionService,\n  Research,\n  SearchResult\n} from '@igo2/geo';\n\nimport { SearchState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss']\n})\nexport class AppSearchComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  public igoSearchPointerSummaryEnabled: boolean = false;\n\n  public termSplitter: string = '|';\n\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public osmLayer: Layer;\n\n  @ViewChild('mapBrowser', { read: ElementRef, static: true }) mapBrowser: ElementRef;\n\n  public lonlat;\n  public mapProjection: string;\n  public term: string;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  get searchStore(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  public selectedFeature: Feature;\n  public igoReverseSearchCoordsFormatEnabled: boolean;\n\n  constructor(\n    private languageService: LanguageService,\n    private projectionService: ProjectionService,\n    private mapService: MapService,\n    private layerService: LayerService,\n    private searchState: SearchState,\n    private mediaService: MediaService,\n    private storageService: StorageService,\n  ) {\n    this.mapService.setMap(this.map);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => {\n        this.osmLayer = layer;\n        this.map.addLayer(layer);\n      });\n\n      this.igoReverseSearchCoordsFormatEnabled =\n      this.storageService.get('reverseSearchCoordsFormatEnabled') as boolean || false;\n  }\n\n  onPointerSummaryStatusChange(value) {\n    this.igoSearchPointerSummaryEnabled = value;\n  }\n\n  onSearchTermChange(term?: string) {\n    this.term = term;\n    this.searchState.setSearchTerm(term);\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (termWithoutHashtag.length < 2) {\n      this.searchStore.clear();\n      this.selectedFeature = undefined;\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    this.searchStore.state.updateAll({ focused: false, selected: false });\n    const newResults = this.searchStore.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.searchStore.updateMany(newResults);\n  }\n\n  onReverseCoordsFormatStatusChange(value) {\n    this.storageService.set('reverseSearchCoordsFormatEnabled', value);\n    this.igoReverseSearchCoordsFormatEnabled = value;\n  }\n\n  onSearchSettingsChange() {\n    this.settingsChange$.next(true);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.tryAddFeatureToMap(result);\n    this.selectedFeature = (result as SearchResult<Feature>).data;\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param layer A search result that could be a feature\n   */\n  private tryAddFeatureToMap(layer: SearchResult) {\n    if (layer.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (layer.data.geometry === undefined) {\n      return;\n    }\n\n    this.map.searchResultsOverlay.setFeatures(\n      [layer.data] as Feature[],\n      FeatureMotion.Default\n    );\n  }\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'coordinates',\n        title: 'coordinates',\n        handler: () => this.searchCoordinate(this.lonlat)\n      },\n      {\n        id: 'googleMaps',\n        title: 'googleMap',\n        handler: () => this.openGoogleMaps(this.lonlat),\n      },\n      {\n        id: 'googleStreetView',\n        title: 'googleStreetView',\n        handler: () => this.openGoogleStreetView(this.lonlat)\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /*\n   * Remove a feature to the map overlay\n   */\n  removeFeatureFromMap() {\n    this.map.searchResultsOverlay.clear();\n  }\n\n  onContextMenuOpen(event: { x: number; y: number }) {\n    const position = this.mapPosition(event);\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\n    this.mapProjection = this.mapService.getMap().projection;\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\n  }\n\n  mapPosition(event: { x: number; y: number }) {\n    const contextmenuPoint = event;\n    contextmenuPoint.y =\n      contextmenuPoint.y -\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\n      window.scrollY;\n    contextmenuPoint.x =\n      contextmenuPoint.x -\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\n      window.scrollX;\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\n    return position;\n  }\n\n  searchCoordinate(lonlat) {\n    this.searchStore.clear();\n    this.term = (!this.igoReverseSearchCoordsFormatEnabled) ?\n    lonlat.map((c) => c.toFixed(6)).join(', ') : lonlat.reverse().map((c) => c.toFixed(6)).join(', ');\n  }\n\n  openGoogleMaps(lonlat) {\n    window.open(GoogleLinks.getGoogleMapsCoordLink(lonlat[0], lonlat[1]));\n  }\n\n  openGoogleStreetView(lonlat) {\n    window.open(\n      GoogleLinks.getGoogleStreetViewLink(lonlat[0], lonlat[1])\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport {\n  IgoPanelModule,\n  IgoActionbarModule,\n  IgoContextMenuModule\n} from '@igo2/common';\n\nimport {\n  IgoFeatureModule,\n  IgoMapModule,\n  IgoSearchModule,\n  provideIChercheSearchSource,\n  provideWorkspaceSearchSource,\n  provideILayerSearchSource,\n  provideNominatimSearchSource,\n  provideIChercheReverseSearchSource,\n  provideCoordinatesReverseSearchSource,\n  provideCadastreSearchSource,\n  provideStoredQueriesSearchSource,\n  provideStoredQueriesReverseSearchSource\n} from '@igo2/geo';\n\nimport { IgoAppSearchModule } from '@igo2/integration';\n\nimport { AppSearchComponent } from './search.component';\nimport { AppSearchRoutingModule } from './search-routing.module';\n\n@NgModule({\n  declarations: [AppSearchComponent],\n  imports: [\n    CommonModule,\n    AppSearchRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoMessageModule.forRoot(),\n    IgoPanelModule,\n    IgoMapModule,\n    IgoSearchModule.forRoot(),\n    IgoAppSearchModule,\n    IgoActionbarModule,\n    IgoContextMenuModule,\n    IgoFeatureModule\n  ],\n  exports: [AppSearchComponent],\n  providers: [\n    provideCoordinatesReverseSearchSource(),\n    provideCadastreSearchSource(),\n    provideIChercheSearchSource(),\n    provideWorkspaceSearchSource(),\n    provideILayerSearchSource(),\n    provideNominatimSearchSource(),\n    provideIChercheReverseSearchSource(),\n    provideStoredQueriesSearchSource(),\n    provideStoredQueriesReverseSearchSource()\n  ]\n})\nexport class AppSearchModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppPrintComponent } from './print.component';\n\nconst routes: Routes = [\n  {\n    path: 'print',\n    component: AppPrintComponent\n  }\n];\n\nexport const AppPrintRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss']\n})\nexport class AppPrintComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        sourceOptions: {\n          type: 'wmts',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n          layer: 'carte_gouv_qc_ro',\n          matrixSet: 'EPSG_3857',\n          version: '1.3.0',\n          crossOrigin: 'anonymous',\n          attributions: \"© <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Québec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'School board',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n    //\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embacle',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    // this.layerService\n    //   .createAsyncLayer({\n    //     title: 'Geomet',\n    //     sourceOptions: {\n    //       type: 'wms',\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\n    //       params: {\n    //         LAYERS: 'RADAR_1KM_RDBR',\n    //         VERSION: '1.3.0'\n    //       },\n    //       crossOrigin: 'anonymous'\n    //     }\n    //   })\n    //   .subscribe(l => this.map.addLayer(l));\n\n    /*\n        //CORS error if activate (for test)\n        this.layerService\n          .createAsyncLayer({\n            title: 'Geomet',\n            sourceOptions: {\n              type: 'wms',\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\n              params: {\n                layers: 'swtq',\n                version: '1.3.0',\n              }\n            }\n          })\n          .subscribe(l => this.map.addLayer(l));\n    */\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Print</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/print\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-print [map]=\"map\"></igo-print>\n\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\n\nimport { AppPrintComponent } from './print.component';\nimport { AppPrintRoutingModule } from './print-routing.module';\n\n@NgModule({\n  declarations: [AppPrintComponent],\n  imports: [\n    AppPrintRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoPrintModule\n  ],\n  exports: [AppPrintComponent]\n})\nexport class AppPrintModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppImportExportComponent } from './import-export.component';\n\nconst routes: Routes = [\n  {\n    path: 'import-export',\n    component: AppImportExportComponent\n  }\n];\n\nexport const AppImportExportRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\nimport { WorkspaceStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class AppImportExportComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  public store = new WorkspaceStore([]);\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Import / Export</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/import-export\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-import-export [store]=\"store\" [map]=\"map\"></igo-import-export>\n\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoImportExportModule,\n  provideStyleListOptions,\n  IgoStyleModule\n} from '@igo2/geo';\n\nimport { AppImportExportComponent } from './import-export.component';\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\n\n@NgModule({\n  declarations: [AppImportExportComponent],\n  imports: [\n    AppImportExportRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoStyleModule,\n    IgoImportExportModule\n  ],\n  exports: [AppImportExportComponent],\n  providers: [\n    provideStyleListOptions({\n      path: './assets/import-style.json'\n    })\n  ]\n})\nexport class AppImportExport {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDirectionsComponent } from './directions.component';\n\nconst routes: Routes = [\n  {\n    path: 'directions',\n    component: AppDirectionsComponent\n  }\n];\n\nexport const AppDirectionsRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  LayerService,\n  MapService,\n  ProjectionService,\n  StopsStore,\n  StopsFeatureStore,\n  RoutesFeatureStore,\n  StepFeatureStore\n} from '@igo2/geo';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'app-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class AppDirectionsComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9,\n    geolocate: false\n  };\n\n  public stopsStore: StopsStore = new StopsStore([]);\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], { map: this.map });\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], { map: this.map });\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], { map: this.map });\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private projectionService: ProjectionService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Directions</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/directions\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-directions\n    [stopsStore]=\"stopsStore\"\n    [stopsFeatureStore]=\"stopsFeatureStore\"\n    [stepFeatureStore]=\"stepFeatureStore\"\n    [routesFeatureStore]=\"routesFeatureStore\"\n    [zoomToActiveRoute$]=\"zoomToActiveRoute$\">  \n  </igo-directions>\n\n\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoDirectionsModule,\n  provideOsrmDirectionsSource\n} from '@igo2/geo';\n\nimport { AppDirectionsComponent } from './directions.component';\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\n\n@NgModule({\n  declarations: [AppDirectionsComponent],\n  imports: [\n    AppDirectionsRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoDirectionsModule\n  ],\n  exports: [AppDirectionsComponent],\n  providers: [provideOsrmDirectionsSource()]\n})\nexport class AppDirectionsModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTimeFilterComponent } from './time-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'time-filter',\n    component: AppTimeFilterComponent\n  }\n];\n\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  TimeFilterableDataSourceOptions,\n  TimeFilterType,\n  TimeFilterStyle\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-time-filter',\n  templateUrl: './time-filter.component.html',\n  styleUrls: ['./time-filter.component.scss']\n})\nexport class AppTimeFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasource: TimeFilterableDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n    //   params: {\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\n    //     version: '1.3.0'\n    //   },\n    //   timeFilterable: true,\n    //   timeFilter: {\n    //     min: '2017-01-01',\n    //     max: '2018-01-01',\n    //     range: true,\n    //     type: TimeFilterType.DATETIME,\n    //     style: TimeFilterStyle.SLIDER,\n    //     step: 86400000,\n    //     timeInterval: 2000\n    //   }\n    // };\n\n    const datasourceYear: TimeFilterableDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      },\n      timeFilterable: true,\n      timeFilter: {\n        min: '2013',\n        max: '2019',\n        range: false,\n        type: TimeFilterType.YEAR,\n        style: TimeFilterStyle.SLIDER,\n        step: 1,\n        timeInterval: 2000\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle YEAR',\n            visible: true,\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Time filter</mat-card-title>\n  <mat-card-content>\n    <li>npm install --save moment@2.22.2</li>\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/time-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppTimeFilterComponent } from './time-filter.component';\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\n\n@NgModule({\n  declarations: [AppTimeFilterComponent],\n  imports: [\n    AppTimeFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppTimeFilterComponent]\n})\nexport class AppTimeFilterModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'ogc-filter',\n    component: AppOgcFilterComponent\n  }\n];\n\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  WFSDataSourceOptions,\n  WFSDataSourceOptionsParams,\n  OgcFilterableDataSourceOptions,\n  AnyBaseOgcFilterOptions,\n  OgcFilterOperatorType,\n  OgcFilterDuringOptions\n} from '@igo2/geo';\n\nimport {Fill, Stroke, Circle, Style} from 'ol/style';\n\n@Component({\n  selector: 'app-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss']\n})\nexport class AppOgcFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const datasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'code_municipalite', alias: '# de la municipalitée' },\n        { name: 'date_observation', excludeFromOgcFilters: true },\n        { name: 'urgence', values: ['immédiate', 'inconnue'] }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          logical: 'Or',\n          filters: [\n            {\n              operator: 'PropertyIsEqualTo',\n              propertyName: 'code_municipalite',\n              expression: '10043'\n            },\n            {\n              operator: 'Intersects',\n              geometryName: 'the_geom',\n              wkt_geometry: `MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))`\n            }\n          ] as AnyBaseOgcFilterOptions[]\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (PropertyIsEqualTo OR Intersects)',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'orange',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilter: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-21T00:00:00-05:00',\n            end: '2016-01-26T00:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-10T00:00:00-05:00',\n      stepDate: 'P2D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilter)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P2D)',\n            id: '1',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n\n    const datasourceDuringFilterTime: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T04:00:00-05:00',\n            end: '2016-01-12T16:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-14T20:00:00-05:00',\n      stepDate: 'PT4H'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTime)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: PT4H)',\n            id: '2',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'blue',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T00:00:00-05:00',\n            end: '2016-03-31T00:00:00-05:00',\n            displayFormat: 'MMMM'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2018-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P1M)',\n            id: '3',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'yellow',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeYear: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2014-01-01T00:00:00-05:00',\n            end: '2019-12-31T00:00:00-05:00',\n            sliderOptions: {\n              interval: 2000,\n              displayFormat: 'YY'\n            },\n            displayFormat: 'YYYY'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2014-01-01T00:00:00-05:00',\n      maxDate: '2019-12-31T00:00:00-05:00',\n      stepDate: 'P1Y'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P1Y)',\n            id: '4',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'green',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\n            end: 'today', // \"now\" can also be used. Instead of midnight, the current time will be used\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Interval from Now, Step: P1D)',\n            id: '5',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'black',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2019-01-01 00:00:00',\n            restrictToStep: true\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, RestrictToStep, Step: P1M)',\n            id: '6',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'black'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const wmsOgcFilterOptions: WMSoptions = {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\n          VERSION: '1.3.0'\n        },\n        sourceFields: [\n          { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n        ],\n        ogcFilters: {\n          enabled: true,\n          editable: true,\n          filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation'\n          } as OgcFilterDuringOptions,\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wmsOgcFilterOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Inondation (During, optionsFromCapabilities)',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WMSoptions\n      extends WMSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const filterableWMSwithPushButtons: WMSoptions = {\n      type: 'wms',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        LAYERS: 'radars_photos',\n        VERSION: '1.3.0'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        pushButtons: {\n          selectorType: 'pushButton',\n          order: 2,\n          groups : [\n            {title: 'Nom du group1 - push', name: '1 - push', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Régions',\n              logical: 'Or',\n              vertical: true,\n              selectors: [\n                {\n                  title: 'Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'Or',\n                    filters: [\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                },\n                {\n                  title: 'Outside Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'And',\n                    filters: [\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        checkboxes: {\n          selectorType: 'checkbox',\n          order: 1,\n          groups : [\n            {title: 'Nom du group1 - checkbox', name: '1 - checkbox', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Type de radar photo',\n              logical: 'Or',\n              selectors: [\n                {\n                  title: 'Radar photo fixe',\n                  enabled: true,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe'\n                  }\n                },\n                {\n                  title: 'Radar photo mobile',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo mobile'\n                  }\n                },\n                {\n                  title: 'Radar photo fixe + feu rouge',\n                  enabled: false,\n                  color: '0,200,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\n                  }\n                },\n                {\n                  title: 'Radar feu rouge',\n                  enabled: false,\n                  color: '255,0,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Appareil de surveillance au feu rouge'\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        allowedOperatorsType: OgcFilterOperatorType.Basic\n        },\n      paramsWFS: {\n        featureTypes: 'radars_photos',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '1.1.0',\n        outputFormat: 'geojson',\n        outputFormatDownload: 'shp'\n      } as WFSDataSourceOptionsParams\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(filterableWMSwithPushButtons)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Filterable WMS layers with predefined filters (push buttons)',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasourceWmsWith2Layers: WMSoptions = {\n    //   type: 'wms',\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   params: {\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\n    //     version: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'histo_stations_meteoroutieres',\n    //     fieldNameGeometry: 'geometry',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'geojson',\n    //     outputFormatDownload: 'shp'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Layer build from 2 WMS layers',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n\n    // const datasourceWms: WMSoptions = {\n    //   type: 'wms',\n    //   url: '/geoserver/wms',\n    //   urlWfs: '/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true,\n    //     filters: {\n    //       operator: 'PropertyIsEqualTo',\n    //       propertyName: 'waterway',\n    //       expression: 'riverbank'\n    //     }\n    //   },\n    //   sourceFields: [\n    //     { name: 'waterway', alias: 'Chemin d eau' },\n    //     { name: 'osm_id' },\n    //     { name: 'landuse', values: ['yes', 'no'] }\n    //   ],\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWms)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Geoserver water_areas',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Ogc filter</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/ogc-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n\n    </igo-ogc-filterable-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\n\n@NgModule({\n  declarations: [AppOgcFilterComponent],\n  imports: [\n    AppOgcFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppOgcFilterComponent]\n})\nexport class AppOgcFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Query</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay\n    igoQuery\n    [queryFeatures]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel>\n    <igo-spatial-filter-type\n      [store]=\"spatialListStore\"\n      [selectedQueryType]=\"queryType\"\n      [zone]=\"zone\"\n      [layers]=\"activeLayers\"\n      (eventType)=\"getOutputType($event)\"\n      (eventQueryType)=\"getOutputQueryType($event)\"\n      (zoneChange)=\"onZoneChange($event)\"\n      (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n      (bufferChange)=\"buffer = $event\"\n      (measureUnitChange)=\"measureUnit = $event\">\n    </igo-spatial-filter-type>\n\n    <igo-spatial-filter-item\n      [type]=\"type\"\n      [queryType]=\"queryType\"\n      [map]=\"map\"\n      [zone]=\"zone\"\n      [loading]=\"loading\"\n      [store]=\"store\"\n      [layers]=\"activeLayers\"\n      [allLayers]=\"layers\"\n      [thematicLength]=\"thematicLength\"\n      (radiusEvent)=\"buffer = $event\"\n      (bufferEvent)=\"buffer = $event\"\n      (measureUnitChange)=\"measureUnit = $event\"\n      (freehandControl)=\"freehandDrawIsActive = $event\"\n      (drawZoneEvent)=\"zone = $event\"\n      (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n      (itemTypeChange)=\"itemType = $event\"\n      (thematicChange)=\"thematics = $event\"\n      (toggleSearch)=\"getOutputToggleSearch()\"\n      (clearButtonEvent)=\"clearMap()\"\n      (clearSearchEvent)=\"getOutputClearSearch()\">\n    </igo-spatial-filter-item>\n  </igo-panel>\n\n  <igo-panel>\n    <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n    </ng-container>\n  </igo-panel>\n</mat-card>","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'spatial-filter',\n    component: AppSpatialFilterComponent\n  }\n];\n\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef, OnDestroy, OnInit } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\nimport { Observable, forkJoin, Subject } from 'rxjs';\nimport { tap, take, takeUntil } from 'rxjs/operators';\n\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  Feature,\n  moveToOlFeatures,\n  FeatureMotion,\n  ClusterDataSource,\n  featureToOl,\n  DataSource,\n  QueryableDataSourceOptions,\n  SpatialFilterService,\n  SpatialFilterType,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterThematic,\n  Layer,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  MeasureLengthUnit\n} from '@igo2/geo';\nimport { EntityStore } from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceVector from 'ol/source/Vector';\nimport olSourceCluster from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject } from 'rxjs';\nimport * as olstyle from 'ol/style';\nimport { MessageService, LanguageService } from '@igo2/core';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'app-spatial-filter',\n  templateUrl: './spatial-filter.component.html',\n  styleUrls: ['./spatial-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSpatialFilterComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer = 0;\n\n  public iterator = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store: EntityStore<Feature> = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  public thematicLength = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngOnInit() {\n    for (const layer of this.map.layers) {\n      if (layer.title && layer.title.includes(this.languageService.translate.instant('igo.geo.spatialFilter.spatialFilter'))) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap() {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    let zeroResults = true;\n    let thematics;\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (this.measureUnit === MeasureLengthUnit.Kilometers && this.type !== SpatialFilterType.Point) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach(thematic => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint;\n              let idLinePoly;\n              features.forEach(feature => {\n                if (feature.geometry.type === 'Point') {\n                  feature.properties.longitude = feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  'igo.geo.spatialFilter.maxSizeAlert',\n                  'igo.geo.spatialFilter.warning',\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$).pipe(takeUntil(this.unsubscribe$)).subscribe(() => {\n      this.loading = false;\n      if (zeroResults) {\n        this.messageService.alert(\n          'igo.geo.spatialFilter.zeroResults',\n          'igo.geo.spatialFilter.warning',\n          { timeOut: 10000 }\n        );\n      }\n    });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean) {\n    this.zone = feature;\n    if (feature) {\n      buffer ? this.tryAddFeaturesToMap([feature], true) : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (this.activeLayers.length === 1 && layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates = (features[0] as any).coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map(f => {\n            return featureToOl(f, this.map.projection);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type = this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe(svgObj => {\n      const xmlSerializer = new XMLSerializer();\n      svgObj.setAttribute('width', '30');\n      svgObj.setAttribute('height', '30');\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n      svgObj.setAttribute('stroke', 'white');\n      const svg = xmlSerializer.serializeToString(svgObj);\n      style = new olstyle.Style({\n        image: new olstyle.Icon({\n          src: 'data:image/svg+xml;utf8,' + svg\n        })\n      });\n    });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\n    }\n  }\n\n  pushLayer(layer) {\n    for (const lay of this.activeLayers) {\n      if (lay.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoFormModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule, IgoQueryModule, IgoFeatureModule, IgoFeatureDetailsModule } from '@igo2/geo';\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\n\n@NgModule({\n  declarations: [AppSpatialFilterComponent],\n  imports: [\n    AppSpatialFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoMessageModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoFeatureDetailsModule,\n    IgoFilterModule,\n    IgoFormModule,\n    CommonModule\n  ],\n  exports: [AppSpatialFilterComponent]\n})\nexport class AppSpatialFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Workspace</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/workspace\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-workspace-selector\n    igoWorkspaceSelector\n    [store]=\"workspaceStore\"\n    [map]=\"map\">\n  </igo-workspace-selector>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-entity-table-paginator\n      *ngIf=\"workspace.inResolutionRange$ | async\"\n      [store]=\"workspace.entityStore\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [entitySortChange$]=\"entitySortChange$\"\n      (paginatorChange)=\"paginatorChange($event)\">\n    </igo-entity-table-paginator>\n  </ng-container>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-actionbar\n      *ngIf=\"workspace.actionStore\"\n      [store]=\"workspace.actionStore\"\n      [horizontal]=\"true\"\n      [withToggleButton]=\"true\"\n      [withTitle]=\"true\"\n      [mode]=\"actionbarMode\">\n    </igo-actionbar>\n\n    <igo-entity-table\n      *ngIf=\"workspace.entityStore && workspace.meta && workspace.meta.tableTemplate && (workspace.inResolutionRange$ | async)\"\n      class=\"table-compact table-centered\"\n      [paginator]=\"workspacePaginator\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [store]=\"workspace.entityStore\"\n      [template]=\"workspace.meta.tableTemplate\">\n    </igo-entity-table>\n    <mat-card-content\n    *ngIf=\"(workspace.inResolutionRange$ | async) === false\">\n      No data available at this scale. Please zoom in. \n    </mat-card-content>\n\n    <igo-workspace-widget-outlet [workspace]=\"workspace\"></igo-workspace-widget-outlet>\n\n  </ng-container>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWorkspaceComponent } from './workspace.component';\n\nconst routes: Routes = [\n  {\n    path: 'workspace',\n    component: AppWorkspaceComponent\n  }\n];\n\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  ActionbarMode,\n  EntityRecord,\n  EntityTableScrollBehavior,\n  Workspace,\n  WorkspaceStore,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WFSDataSourceOptions\n} from '@igo2/geo';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { WorkspaceState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-workspace',\n  templateUrl: './workspace.component.html',\n  styleUrls: ['./workspace.component.scss']\n})\nexport class AppWorkspaceComponent implements OnInit {\n\n  public workspacePaginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public paginatorOptions: EntityTablePaginatorOptions = {\n    pageSize: 5, // Number of items to display on a page.\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\n  };\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-72, 47.2],\n    zoom: 5\n  };\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  public selectedWorkspace$: Observable<Workspace>;\n\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    public workspaceState: WorkspaceState,\n  ) {}\n\n  ngOnInit() {\n    this.selectedWorkspace$ = this.workspaceStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.selected === true\n      )\n      .pipe(\n        map((record: EntityRecord<Workspace>) => {\n          const entity = record === undefined ? undefined : record.entity;\n          if (entity) {\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\n            // and this tool is not available in the igo2-lib demo.\n            // This is why it's has been removed frome the actions's list.\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\n            entity.actionStore.view.filter((action) => {\n              return action.id !== 'wfsDownload';\n            });\n          }\n          return entity;\n\n        })\n      );\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const wmsDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://ahocevar.com/geoserver/wms',\n    //   urlWfs: 'https://ahocevar.com/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   },\n    //   sourceFields: [\n    //     {name: 'waterway', alias: 'Chemin d eau'},\n    //     {name: 'osm_id'},\n    //     {name: 'landuse'}\n    //   ],\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   serverType: 'geoserver'\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(wmsDataSourceOptions as OgcFilterableDataSourceOptions)\n    //   .subscribe(dataSource => {\n    //     const layer = {\n    //       optionsFromCapabilities: true,\n    //       title: 'WMS Geoserver filterable ',\n    //       visible: true,\n    //       source: dataSource\n    //     };\n    //     this.map.addLayer(this.layerService.createLayer(layer));\n    //   });\n\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\n      type: 'wfs',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        featureTypes: 'etablissement_mtq',\n        fieldNameGeometry: 'geometry',\n        version: '2.0.0',\n        outputFormat: 'geojson'\n      },\n      sourceFields: [\n        { name: 'idetablis', alias: 'ID' },\n        { name: 'nometablis', alias: 'Name' },\n        { name: 'typetablis', alias: 'Type' }\n      ]\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDataSourceOptions)\n      .subscribe(dataSource => {\n        const layer = {\n          title: 'Simple WFS ',\n          maxResolution: 3000,\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.workspacePaginator = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport {\n  IgoActionModule,\n  IgoEntityModule,\n  IgoWorkspaceModule,\n  IgoPanelModule\n} from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoGeoWorkspaceModule\n} from '@igo2/geo';\n\nimport { AppWorkspaceComponent } from './workspace.component';\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\n\n@NgModule({\n  declarations: [AppWorkspaceComponent],\n  imports: [\n    CommonModule,\n    AppWorkspaceRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoActionModule,\n    IgoEntityModule,\n    IgoWorkspaceModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoGeoWorkspaceModule\n  ],\n  exports: [AppWorkspaceComponent]\n})\nexport class AppWorkspaceModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Context</mat-card-title>\n  <mat-card-content>\n    <p>* Dependencies: LanguageService</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/context/context\">code of this example</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/contexts\"> contexts</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    igoMapContext\n    igoLayerContext\n    [map]=\"map\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Contexts list\">\n    <igo-context-list igoContextListBinding [map]=\"map\"></igo-context-list>\n  </igo-panel>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list igoLayerListBinding [map]=\"map\">\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppContextComponent } from './context.component';\n\nconst routes: Routes = [\n  {\n    path: 'context',\n    component: AppContextComponent\n  }\n];\n\nexport const AppContextRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, OverlayService, MapService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-context',\n  templateUrl: './context.component.html',\n  styleUrls: ['./context.component.scss']\n})\nexport class AppContextComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private mapService: MapService,\n    private overlayService: OverlayService\n  ) {\n    this.mapService.setMap(this.map);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { HttpClientJsonpModule } from '@angular/common/http';\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoMetadataModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\nimport { IgoContextManagerModule } from '@igo2/context';\n\nimport { AppContextComponent } from './context.component';\nimport { AppContextRoutingModule } from './context-routing.module';\n\n@NgModule({\n  declarations: [AppContextComponent],\n  imports: [\n    HttpClientJsonpModule,\n    AppContextRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoContextManagerModule\n  ],\n  exports: [AppContextComponent]\n})\nexport class AppContextModule {}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: '**', redirectTo: '/home' }\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { MediaMatcher } from '@angular/cdk/layout';\nimport {\n  ChangeDetectorRef,\n  Component,\n  OnDestroy,\n  Renderer2\n} from '@angular/core';\n\nimport { userAgent } from '@igo2/utils';\nimport { version } from '@igo2/core';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent implements OnDestroy {\n  mobileQuery: MediaQueryList;\n\n  public title = 'IGO';\n  public version = version;\n  private themeClass = 'deeppurple-theme';\n  private _mobileQueryListener: () => void;\n\n  constructor(\n    private changeDetectorRef: ChangeDetectorRef,\n    private media: MediaMatcher,\n    private renderer: Renderer2\n  ) {\n    this.mobileQuery = media.matchMedia('(max-width: 600px)');\n    this._mobileQueryListener = () => changeDetectorRef.detectChanges();\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\n\n    this.renderer.addClass(document.body, this.themeClass);\n\n    this.detectOldBrowser();\n  }\n\n  ngOnDestroy(): void {\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\n  }\n\n  private detectOldBrowser() {\n    const oldBrowser = userAgent.satisfies({\n      ie: '<=11',\n      chrome: '<64',\n      firefox: '<60'\n    });\n\n    if (oldBrowser) {\n      console.log('Very old browser ! ', userAgent.getBrowser());\n    }\n  }\n}\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\n  <mat-toolbar color=\"primary\" class=\"example-toolbar\">\n    <button mat-icon-button (click)=\"snav.toggle()\"><mat-icon svgIcon=\"menu\"></mat-icon></button>\n    <h1>{{title}}</h1>\n    <h5>{{version.lib}}</h5>\n  </mat-toolbar>\n\n  <mat-sidenav-container class=\"example-sidenav-container\" [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\">\n    <mat-sidenav #snav opened=\"true\" [mode]=\"mobileQuery.matches ? 'over' : 'side'\" [fixedInViewport]=\"mobileQuery.matches\" fixedTopGap=\"56\">\n      <mat-nav-list>\n        <a mat-list-item routerLink=\".\">Home</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"activity\">Activity</a>\n        <a mat-list-item routerLink=\"config\">Config</a>\n        <a mat-list-item routerLink=\"language\">Language</a>\n        <a mat-list-item routerLink=\"media\">Media</a>\n        <a mat-list-item routerLink=\"message\">Message</a>\n        <a mat-list-item routerLink=\"request\">Request</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"action\">Action</a>\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\n        <a mat-list-item routerLink=\"form\">Form</a>\n        <a mat-list-item routerLink=\"table\">Table</a>\n        <a mat-list-item routerLink=\"tool\">Tool</a>\n        <a mat-list-item routerLink=\"widget\">Widget</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\n        <a mat-list-item routerLink=\"layer\">Layer</a>\n        <a mat-list-item routerLink=\"legend\">Legend</a>\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\n        <a mat-list-item routerLink=\"feature\">Feature</a>\n        <a mat-list-item routerLink=\"hover\">Hover</a>\n        <a mat-list-item routerLink=\"measure\">Measure</a>\n        <a mat-list-item routerLink=\"draw\">Draw</a>\n        <a mat-list-item routerLink=\"query\">Query</a>\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\n        <a mat-list-item routerLink=\"search\">Search</a>\n        <a mat-list-item routerLink=\"print\">Print</a>\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\n        <a mat-list-item routerLink=\"directions\">Directions</a>\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"context\">Context</a>\n\n      </mat-nav-list>\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n      <router-outlet></router-outlet>\n    </mat-sidenav-content>\n\n  </mat-sidenav-container>\n</div>\n","import { BrowserModule, DomSanitizer } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { APP_INITIALIZER, ApplicationRef, Injector, NgModule } from '@angular/core';\nimport { HammerModule } from '@angular/platform-browser';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconRegistry, MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport { AppHomeModule } from './core/home/home.module';\nimport { AppActivityModule } from './core/activity/activity.module';\nimport { AppConfigModule } from './core/config/config.module';\nimport { AppLanguageModule } from './core/language/language.module';\nimport { AppMediaModule } from './core/media/media.module';\nimport { AppMessageModule } from './core/message/message.module';\nimport { AppRequestModule } from './core/request/request.module';\n\nimport { AppActionModule } from './common/action/action.module';\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\nimport { AppFormModule } from './common/form/form.module';\nimport { AppTableModule } from './common/table/table.module';\nimport { AppToolModule } from './common/tool/tool.module';\nimport { AppWidgetModule } from './common/widget/widget.module';\n\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\n\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\nimport { AppLayerModule } from './geo/layer/layer.module';\nimport { AppLegendModule } from './geo/legend/legend.module';\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\nimport { AppFeatureModule } from './geo/feature/feature.module';\nimport { AppHoverModule } from './geo/hover/hover.module';\nimport { AppMeasureModule } from './geo/measure/measure.module';\nimport { AppDrawModule } from './geo/draw/draw.module';\nimport { AppQueryModule } from './geo/query/query.module';\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\nimport { AppSearchModule } from './geo/search/search.module';\nimport { AppPrintModule } from './geo/print/print.module';\nimport { AppImportExport } from './geo/import-export/import-export.module';\nimport { AppDirectionsModule } from './geo/directions/directions.module';\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\n\nimport { AppContextModule } from './context/context/context.module';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\nimport { IgoCoreModule, LanguageService } from '@igo2/core';\nimport { MatTooltipDefaultOptions, MAT_TOOLTIP_DEFAULT_OPTIONS } from '@angular/material/tooltip';\nimport { concatMap, first } from 'rxjs';\n\nexport const defaultTooltipOptions: MatTooltipDefaultOptions = {\n  showDelay: 500,\n  hideDelay: 0,\n  touchendHideDelay: 0,\n  disableTooltipInteractivity: true\n};\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [\n    IgoCoreModule,\n    BrowserModule,\n    BrowserAnimationsModule,\n    MatSidenavModule,\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n\n    AppHomeModule,\n    AppActivityModule,\n    AppConfigModule,\n    AppLanguageModule,\n    AppMediaModule,\n    AppMessageModule,\n    AppRequestModule,\n\n    AppActionModule,\n    AppDynamicComponentModule,\n    AppEntityTableModule,\n    AppEntitySelectorModule,\n    AppFormModule,\n    AppTableModule,\n    AppToolModule,\n    AppWidgetModule,\n\n    AppAuthFormModule,\n\n    AppSimpleMapModule,\n    AppLayerModule,\n    AppLegendModule,\n    AppOverlayModule,\n    AppGeometryModule,\n    AppFeatureModule,\n    AppHoverModule,\n    AppMeasureModule,\n    AppDrawModule,\n    AppQueryModule,\n    AppCatalogModule,\n    AppSearchModule,\n    AppPrintModule,\n    AppImportExport,\n    AppDirectionsModule,\n    AppTimeFilterModule,\n    AppOgcFilterModule,\n    AppSpatialFilterModule,\n    AppWorkspaceModule,\n\n    AppContextModule,\n\n    AppRoutingModule,\n\n    HammerModule\n  ],\n  providers: [\n    { provide: APP_INITIALIZER, useFactory: appInitializerFactory, deps: [Injector, ApplicationRef], multi: true },\n    { provide: MAT_TOOLTIP_DEFAULT_OPTIONS, useValue: defaultTooltipOptions }\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n\nexport function appInitializerFactory(injector: Injector,\n  applicationRef: ApplicationRef) {\n  return () => new Promise<any>((resolve: any) => {\n    applicationRef.isStable.pipe(\n      first(isStable => isStable === true),\n      concatMap(() => {\n        const languageService = injector.get(LanguageService);\n        const lang = languageService.getLanguage();\n        return languageService.translate.getTranslation(lang);\n      }))\n      .subscribe((translations) => {\n        const languageService = injector.get(LanguageService);\n        const lang = languageService.getLanguage();\n        languageService.translate.setTranslation(lang, translations);\n        resolve();\n      });\n  });\n}\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nimport 'hammerjs';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch(err => console.log(err));\n","var map = {\n\t\"./af\": 58685,\n\t\"./af.js\": 58685,\n\t\"./ar\": 254,\n\t\"./ar-dz\": 4312,\n\t\"./ar-dz.js\": 4312,\n\t\"./ar-kw\": 32614,\n\t\"./ar-kw.js\": 32614,\n\t\"./ar-ly\": 18630,\n\t\"./ar-ly.js\": 18630,\n\t\"./ar-ma\": 28674,\n\t\"./ar-ma.js\": 28674,\n\t\"./ar-sa\": 49032,\n\t\"./ar-sa.js\": 49032,\n\t\"./ar-tn\": 24730,\n\t\"./ar-tn.js\": 24730,\n\t\"./ar.js\": 254,\n\t\"./az\": 53052,\n\t\"./az.js\": 53052,\n\t\"./be\": 60150,\n\t\"./be.js\": 60150,\n\t\"./bg\": 63069,\n\t\"./bg.js\": 63069,\n\t\"./bm\": 13466,\n\t\"./bm.js\": 13466,\n\t\"./bn\": 18516,\n\t\"./bn-bd\": 90557,\n\t\"./bn-bd.js\": 90557,\n\t\"./bn.js\": 18516,\n\t\"./bo\": 26273,\n\t\"./bo.js\": 26273,\n\t\"./br\": 9588,\n\t\"./br.js\": 9588,\n\t\"./bs\": 19815,\n\t\"./bs.js\": 19815,\n\t\"./ca\": 83331,\n\t\"./ca.js\": 83331,\n\t\"./cs\": 21320,\n\t\"./cs.js\": 21320,\n\t\"./cv\": 72219,\n\t\"./cv.js\": 72219,\n\t\"./cy\": 68266,\n\t\"./cy.js\": 68266,\n\t\"./da\": 66427,\n\t\"./da.js\": 66427,\n\t\"./de\": 67435,\n\t\"./de-at\": 52871,\n\t\"./de-at.js\": 52871,\n\t\"./de-ch\": 12994,\n\t\"./de-ch.js\": 12994,\n\t\"./de.js\": 67435,\n\t\"./dv\": 82357,\n\t\"./dv.js\": 82357,\n\t\"./el\": 95649,\n\t\"./el.js\": 95649,\n\t\"./en-au\": 59961,\n\t\"./en-au.js\": 59961,\n\t\"./en-ca\": 19878,\n\t\"./en-ca.js\": 19878,\n\t\"./en-gb\": 3924,\n\t\"./en-gb.js\": 3924,\n\t\"./en-ie\": 70864,\n\t\"./en-ie.js\": 70864,\n\t\"./en-il\": 91579,\n\t\"./en-il.js\": 91579,\n\t\"./en-in\": 30940,\n\t\"./en-in.js\": 30940,\n\t\"./en-nz\": 16181,\n\t\"./en-nz.js\": 16181,\n\t\"./en-sg\": 44301,\n\t\"./en-sg.js\": 44301,\n\t\"./eo\": 85291,\n\t\"./eo.js\": 85291,\n\t\"./es\": 54529,\n\t\"./es-do\": 53764,\n\t\"./es-do.js\": 53764,\n\t\"./es-mx\": 12584,\n\t\"./es-mx.js\": 12584,\n\t\"./es-us\": 63425,\n\t\"./es-us.js\": 63425,\n\t\"./es.js\": 54529,\n\t\"./et\": 35203,\n\t\"./et.js\": 35203,\n\t\"./eu\": 70678,\n\t\"./eu.js\": 70678,\n\t\"./fa\": 83483,\n\t\"./fa.js\": 83483,\n\t\"./fi\": 96262,\n\t\"./fi.js\": 96262,\n\t\"./fil\": 52521,\n\t\"./fil.js\": 52521,\n\t\"./fo\": 34555,\n\t\"./fo.js\": 34555,\n\t\"./fr\": 63131,\n\t\"./fr-ca\": 88239,\n\t\"./fr-ca.js\": 88239,\n\t\"./fr-ch\": 21702,\n\t\"./fr-ch.js\": 21702,\n\t\"./fr.js\": 63131,\n\t\"./fy\": 267,\n\t\"./fy.js\": 267,\n\t\"./ga\": 23821,\n\t\"./ga.js\": 23821,\n\t\"./gd\": 71753,\n\t\"./gd.js\": 71753,\n\t\"./gl\": 4074,\n\t\"./gl.js\": 4074,\n\t\"./gom-deva\": 92762,\n\t\"./gom-deva.js\": 92762,\n\t\"./gom-latn\": 5969,\n\t\"./gom-latn.js\": 5969,\n\t\"./gu\": 82809,\n\t\"./gu.js\": 82809,\n\t\"./he\": 45402,\n\t\"./he.js\": 45402,\n\t\"./hi\": 315,\n\t\"./hi.js\": 315,\n\t\"./hr\": 10410,\n\t\"./hr.js\": 10410,\n\t\"./hu\": 38288,\n\t\"./hu.js\": 38288,\n\t\"./hy-am\": 67928,\n\t\"./hy-am.js\": 67928,\n\t\"./id\": 71334,\n\t\"./id.js\": 71334,\n\t\"./is\": 86959,\n\t\"./is.js\": 86959,\n\t\"./it\": 34864,\n\t\"./it-ch\": 51124,\n\t\"./it-ch.js\": 51124,\n\t\"./it.js\": 34864,\n\t\"./ja\": 36141,\n\t\"./ja.js\": 36141,\n\t\"./jv\": 29187,\n\t\"./jv.js\": 29187,\n\t\"./ka\": 42136,\n\t\"./ka.js\": 42136,\n\t\"./kk\": 94332,\n\t\"./kk.js\": 94332,\n\t\"./km\": 18607,\n\t\"./km.js\": 18607,\n\t\"./kn\": 84305,\n\t\"./kn.js\": 84305,\n\t\"./ko\": 70234,\n\t\"./ko.js\": 70234,\n\t\"./ku\": 16003,\n\t\"./ku.js\": 16003,\n\t\"./ky\": 75061,\n\t\"./ky.js\": 75061,\n\t\"./lb\": 32786,\n\t\"./lb.js\": 32786,\n\t\"./lo\": 66183,\n\t\"./lo.js\": 66183,\n\t\"./lt\": 50029,\n\t\"./lt.js\": 50029,\n\t\"./lv\": 24169,\n\t\"./lv.js\": 24169,\n\t\"./me\": 68577,\n\t\"./me.js\": 68577,\n\t\"./mi\": 68177,\n\t\"./mi.js\": 68177,\n\t\"./mk\": 50337,\n\t\"./mk.js\": 50337,\n\t\"./ml\": 65260,\n\t\"./ml.js\": 65260,\n\t\"./mn\": 52325,\n\t\"./mn.js\": 52325,\n\t\"./mr\": 14695,\n\t\"./mr.js\": 14695,\n\t\"./ms\": 75334,\n\t\"./ms-my\": 37151,\n\t\"./ms-my.js\": 37151,\n\t\"./ms.js\": 75334,\n\t\"./mt\": 63570,\n\t\"./mt.js\": 63570,\n\t\"./my\": 97963,\n\t\"./my.js\": 97963,\n\t\"./nb\": 88028,\n\t\"./nb.js\": 88028,\n\t\"./ne\": 86638,\n\t\"./ne.js\": 86638,\n\t\"./nl\": 50302,\n\t\"./nl-be\": 66782,\n\t\"./nl-be.js\": 66782,\n\t\"./nl.js\": 50302,\n\t\"./nn\": 33501,\n\t\"./nn.js\": 33501,\n\t\"./oc-lnc\": 50563,\n\t\"./oc-lnc.js\": 50563,\n\t\"./pa-in\": 50869,\n\t\"./pa-in.js\": 50869,\n\t\"./pl\": 65302,\n\t\"./pl.js\": 65302,\n\t\"./pt\": 49687,\n\t\"./pt-br\": 74884,\n\t\"./pt-br.js\": 74884,\n\t\"./pt.js\": 49687,\n\t\"./ro\": 79107,\n\t\"./ro.js\": 79107,\n\t\"./ru\": 33627,\n\t\"./ru.js\": 33627,\n\t\"./sd\": 30355,\n\t\"./sd.js\": 30355,\n\t\"./se\": 83427,\n\t\"./se.js\": 83427,\n\t\"./si\": 11848,\n\t\"./si.js\": 11848,\n\t\"./sk\": 54590,\n\t\"./sk.js\": 54590,\n\t\"./sl\": 20184,\n\t\"./sl.js\": 20184,\n\t\"./sq\": 56361,\n\t\"./sq.js\": 56361,\n\t\"./sr\": 78965,\n\t\"./sr-cyrl\": 81287,\n\t\"./sr-cyrl.js\": 81287,\n\t\"./sr.js\": 78965,\n\t\"./ss\": 25456,\n\t\"./ss.js\": 25456,\n\t\"./sv\": 70451,\n\t\"./sv.js\": 70451,\n\t\"./sw\": 77558,\n\t\"./sw.js\": 77558,\n\t\"./ta\": 51356,\n\t\"./ta.js\": 51356,\n\t\"./te\": 73693,\n\t\"./te.js\": 73693,\n\t\"./tet\": 21243,\n\t\"./tet.js\": 21243,\n\t\"./tg\": 42500,\n\t\"./tg.js\": 42500,\n\t\"./th\": 55768,\n\t\"./th.js\": 55768,\n\t\"./tk\": 77761,\n\t\"./tk.js\": 77761,\n\t\"./tl-ph\": 35780,\n\t\"./tl-ph.js\": 35780,\n\t\"./tlh\": 29590,\n\t\"./tlh.js\": 29590,\n\t\"./tr\": 33807,\n\t\"./tr.js\": 33807,\n\t\"./tzl\": 93857,\n\t\"./tzl.js\": 93857,\n\t\"./tzm\": 60654,\n\t\"./tzm-latn\": 8806,\n\t\"./tzm-latn.js\": 8806,\n\t\"./tzm.js\": 60654,\n\t\"./ug-cn\": 30845,\n\t\"./ug-cn.js\": 30845,\n\t\"./uk\": 19232,\n\t\"./uk.js\": 19232,\n\t\"./ur\": 47052,\n\t\"./ur.js\": 47052,\n\t\"./uz\": 77967,\n\t\"./uz-latn\": 32233,\n\t\"./uz-latn.js\": 32233,\n\t\"./uz.js\": 77967,\n\t\"./vi\": 98615,\n\t\"./vi.js\": 98615,\n\t\"./x-pseudo\": 12320,\n\t\"./x-pseudo.js\": 12320,\n\t\"./yo\": 31313,\n\t\"./yo.js\": 31313,\n\t\"./zh-cn\": 64490,\n\t\"./zh-cn.js\": 64490,\n\t\"./zh-hk\": 55910,\n\t\"./zh-hk.js\": 55910,\n\t\"./zh-mo\": 98262,\n\t\"./zh-mo.js\": 98262,\n\t\"./zh-tw\": 44223,\n\t\"./zh-tw.js\": 44223\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"],"x_google_ignoreList":[693]}