(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[179],{73750:(Ko,ys,C)=>{"use strict";var yt=C(50318),e=C(3184),pn=C(57481),w=C(87317),T=C(65590),G=C(26131),Xo=C(7216),vl=C(19946),O=C(40089),te=C(17643),f=C(36362),x=C(11961),Ge=C(61534),$e=C(82796),q=C(28784),bl=C(32313),he=C(53158),fe=C(71989),Gt=C(80155),Cl=C(44874),b=C(76317),dn=C(25474),Qt=C(91640),Z=C(50635),Qe=C(26562),Ke=C(90833),lo=C(23280),Wp=C(93962),Se=C(50253),ei=C(98977);let Xp=(()=>{class i{static getByte(t,o){return t.charCodeAt(o)}static getByte64(t,o){return this.ALPHA.indexOf(t.charAt(o))}static decode(t){let n,s,o=0,a=t.length,l=[];if(t=String(t),0===a)return t;for(t.charAt(a-1)===this.PADCHAR&&(o=1,t.charAt(a-2)===this.PADCHAR&&(o=2),a-=4),n=0;n<a;n+=4)s=this.getByte64(t,n)<<18|this.getByte64(t,n+1)<<12|this.getByte64(t,n+2)<<6|this.getByte64(t,n+3),l.push(String.fromCharCode(s>>16,s>>8&255,255&s));switch(o){case 1:s=this.getByte64(t,n)<<18|this.getByte64(t,n+1)<<12|this.getByte64(t,n+2)<<6,l.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=this.getByte64(t,n)<<18|this.getByte64(t,n+1)<<12,l.push(String.fromCharCode(s>>16))}return l.join("")}static encode(t){let o,n,s=[],a=(t=String(t)).length-t.length%3;if(0===t.length)return t;for(o=0;o<a;o+=3)n=this.getByte(t,o)<<16|this.getByte(t,o+1)<<8|this.getByte(t,o+2),s.push(this.ALPHA.charAt(n>>18)),s.push(this.ALPHA.charAt(n>>12&63)),s.push(this.ALPHA.charAt(n>>6&63)),s.push(this.ALPHA.charAt(63&n));switch(t.length-a){case 1:n=this.getByte(t,o)<<16,s.push(this.ALPHA.charAt(n>>18)+this.ALPHA.charAt(n>>12&63)+this.PADCHAR+this.PADCHAR);break;case 2:n=this.getByte(t,o)<<16|this.getByte(t,o+1)<<8,s.push(this.ALPHA.charAt(n>>18)+this.ALPHA.charAt(n>>12&63)+this.ALPHA.charAt(n>>6&63)+this.PADCHAR)}return s.join("")}}return i.PADCHAR="=",i.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i})();const ti=Wp.getParser(window.navigator.userAgent);class Ft{static copy(r){let t=!1;if("string"==typeof r){const o=Ft.createTextArea(r);Ft.selectText(o),t=Ft.copyTextToClipboard(),Ft.destroyTextArea(o)}else Ft.selectText(r),t=Ft.copyTextToClipboard();return t}static createTextArea(r){const t=document.createElement("textArea");return t.value=r,document.body.appendChild(t),t}static destroyTextArea(r){document.body.removeChild(r)}static selectText(r){if("iOS"===ti.getOSName()){const t=r.contentEditable,o=r.readOnly,n=document.createRange(),s=window.getSelection();r.contenteditable=!0,r.readonly=!1,n.selectNodeContents(r),s.removeAllRanges(),s.addRange(n),r.setSelectionRange(0,999999),r.contentEditable=t,r.readOnly=o}else r.select()}static copyTextToClipboard(){return("iOS"!==ti.getOSName()||!ti.compareVersion("<10"))&&document.execCommand("copy")}}class oi{static diff(r,t,o=4){if(!r&&!t)return"";if(!r)return'<span class="inserted">'+t+"</span>";if(!t)return'<span class="deleted">'+r+"</span>";r=r.toString(),t=t.toString();const n=oi.getChanges(r,t,"",o),s=t.slice(n.mtc.length+n.ins.length+n.sbs.length),a=r.slice(n.mtc.length+n.del.length+n.sbs.length);let l="";return n.del.length>0&&(n.del='<span class="deleted">'+n.del+"</span>"),n.ins.length>0&&(n.ins='<span class="inserted">'+n.ins+"</span>"),l=n.mtc+n.del+n.ins+n.sbs,l+=""!==a||""!==s?oi.diff(a,s,o):"",l}static getMatchingSubstring(r,t,o){let n=0,s=!1;const a=r.length,l={fis:a,mtc:o,sbs:""};for(;n<a;)t[n]===r[n]?s?l.sbs+=r[n]:(s=!0,l.fis=n,l.sbs=r[n]):s&&(n=a),++n;return l}static getChanges(r,t,o,n){const s=r.length>=r.length;let[a,l]=s?[r,t]:[t,r],c=0;for(;l[c]===a[c]&&c<l.length;)++c;a=a.split("").slice(c),l=l.slice(c);const u=a.length;let p={fis:l.length,fil:u,sbs:"",mtc:o+t.slice(0,c)},d={sbs:""};if(""!==l)for(let g=0;g<u&&d.sbs.length<n;g++)d=oi.getMatchingSubstring(l,oi.rotateArray(a,g),p.mtc),d.fil=g<u-d.fis?d.fis+g:d.fis-u+g,d.sbs.length>p.sbs.length&&(p=d);return[p.del,p.ins]=s?[a.slice(0,p.fil).join(""),l.slice(0,p.fis)]:[l.slice(0,p.fis),a.slice(0,p.fil).join("")],-1===p.del.indexOf(" ")||-1===p.ins.indexOf(" ")||""===p.del||""===p.ins||""===p.sbs?p:oi.getChanges(p.del,p.ins,p.mtc,n)}static rotateArray(r,t){const o=r.length,n=new Array(r.length);if(t%o==0)return r.slice();for(let s=0;s<o;s++)n[s]=r[(s+(o+t%o))%o];return n}}var Ti=(()=>{return(i=Ti||(Ti={})).ADDED="added",i.DELETED="deleted",i.MODIFIED="modified",Ti;var i})();class vs{static findChanges(r,t,o=[]){const n={added:[],deleted:[],modified:[]};if(!r||!t)return n;const s=[...r],a=[...t];for(const l of s){const c=a.findIndex(h=>h.id===l.id);if(-1===c){n.deleted.push({change:{type:Ti.DELETED},value:l});continue}const u=a.splice(c,1)[0],p=JSON.parse(JSON.stringify(l)),d=JSON.parse(JSON.stringify(u)),g=vs.compareObject(p,d,void 0,o);g.length&&n.modified.push({change:{type:Ti.MODIFIED,keysChanged:g},value:p,oldValue:l,newValue:u})}return n.added=a.map(l=>({change:{type:Ti.ADDED},value:l})),n}static compareObject(r,t,o,n=[]){const s=JSON.parse(JSON.stringify(r)),a=JSON.parse(JSON.stringify(t)),l=new Set([...Object.keys(r),...Object.keys(t)]);let c=[];return l.forEach(u=>{const p=o?`${o}.${u}`:u;-1===n.indexOf(p)&&(Array.isArray(r[u])&&(r[u]=r[u].join(",<br>")),Array.isArray(t[u])&&(t[u]=t[u].join(",<br>")),"object"==typeof r[u]&&"object"==typeof t[u]&&null!==r[u]&&null!==t[u]?c=c.concat(this.compareObject(r[u],t[u],p)):r[u]!==t[u]&&(c.push({key:p,oldValue:s[u],newValue:a[u]}),r[u]=oi.diff(r[u],t[u])))}),c}}class B{static resolve(r,t){const o=t.replace(/\[/g,".").replace(/\]/g,"").split(".");let n=r;for(;o.length;){if("object"!=typeof n)return;n=n[o.shift()]}return n}static isObject(r){return r&&"object"==typeof r&&!Array.isArray(r)&&null!==r&&!(r instanceof Date)}static mergeDeep(r,t,o=!1){const n=Object.assign({},r);return B.isObject(r)&&B.isObject(t)&&Object.keys(t).filter(s=>!o||void 0!==t[s]).forEach(s=>{B.isObject(t[s])?s in r?n[s]=B.mergeDeep(r[s],t[s],o):Object.assign(n,{[s]:t[s]}):Object.assign(n,{[s]:t[s]})}),n}static copyDeep(r){const t=Array.isArray(r)?[]:{};for(const o in r)if(r.hasOwnProperty(o)){const n=r[o];t[o]=n&&"object"==typeof n?this.copyDeep(n):n}return t}static removeDuplicateCaseInsensitive(r){const t={},o={},n=[];for(const s in r)if(r.hasOwnProperty(s)){const a=s.toUpperCase();t.hasOwnProperty(a)?t[a].push({[s]:r[s]}):t[a]=[{[s]:r[s]}],n.push({key:s,count:s.replace(/[^A-Z]/g,"").length})}for(const s in t)if(t.hasOwnProperty(s)&&t.hasOwnProperty(s)){const a=t[s];if(1===a.length){const l=a[0];o[s]=l[Object.keys(l)[0]]}else if(a.length>1){const l=n.filter(c=>c.key.toLowerCase()===s.toLowerCase()).reduce((c,u)=>c.y<u.y?c:u);o[l.key.toUpperCase()]=r[l.key]}}for(const s in r)r.hasOwnProperty(s)&&delete r[s];for(const s in o)o.hasOwnProperty(s)&&(r[s]=o[s])}static removeUndefined(r){const t={};return B.isObject(r)?(Object.keys(r).filter(o=>void 0!==r[o]).forEach(o=>{t[o]=B.isObject(r[o])||Array.isArray(r[o])?B.removeUndefined(r[o]):r[o]}),t):Array.isArray(r)?r.map(o=>B.removeUndefined(o)):r}static removeNull(r){const t={};return B.isObject(r)?(Object.keys(r).filter(o=>null!==r[o]).forEach(o=>{t[o]=B.isObject(r[o])||Array.isArray(r[o])?B.removeNull(r[o]):r[o]}),t):Array.isArray(r)?r.map(o=>B.removeNull(o)):r}static naturalCompare(r,t,o="asc",n){if("desc"===o&&(t=[r,r=t][0]),null===r||""===r||void 0===r||null===t||""===t||void 0===t){const l=r===t?0:void 0===r?3:void 0===t?-3:null===r?2:null===t?-2:""===r?1:-1;return"desc"===o?!1!==n?l:-1*l:!0===n?-1*l:l}const s=[],a=[];for(t=""+t,(r=""+r).replace(/(\d+)|(\D+)/g,(l,c,u)=>{s.push([c||1/0,u||""])}),t.replace(/(\d+)|(\D+)/g,(l,c,u)=>{a.push([c||1/0,u||""])});s.length&&a.length;){const l=s.shift(),c=a.shift(),u=l[0]-c[0]||l[1].localeCompare(c[1]);if(u)return u}return s.length-a.length}static objectsAreEquivalent(r,t){if(r===t)return!0;const o=Object.getOwnPropertyNames(r),n=Object.getOwnPropertyNames(t);if(o.length!==n.length)return!1;for(const s of o)if(r[s]!==t[s])return!1;return!0}static removeKeys(r,t){return Object.keys(r).filter(n=>t.indexOf(n)<0).reduce((n,s)=>(n[s]=r[s],n),{})}}class ii{static roundToNDecimal(r,t=3){const o=Math.pow(10,t);return Math.round(r*o)/o}}function co(i){return i.reduce((r,t)=>(r[t]=t,r),Object.create(null))}function Do(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Ze(){return`${Do()}${Do()}-${Do()}-${Do()}-${Do()}-${Do()}${Do()}${Do()}`.toLowerCase()}var ve=(()=>{return(i=ve||(ve={}))[i.Error=0]="Error",i[i.Done=1]="Done",i[i.Working=2]="Working",i[i.Waiting=3]="Waiting",ve;var i})();class nr{constructor(){this.status$=new Se.x}get status(){return this._status}set status(r){this._status=r,this.status$.next(r)}subscribe(r,t){this.watch(),this.status$$=this.status$.pipe((0,ei.x)()).subscribe(o=>{this.handleStatusChange(o),r.call(t,this)})}unsubscribe(){this.unwatch(),void 0!==this.status$$&&(this.status$$.unsubscribe(),this.status$$=void 0),this.status=ve.Waiting}handleStatusChange(r){}}var L=C(32097),Sl=C(34101),rr=C(24044),ko=C(39910);let gn=(()=>{class i{constructor(){this.counter$=new b.X(0),this.ids=[]}register(){const t=Ze();return this.ids.push(t),this.counter$.next(this.ids.length),t}unregister(t){const o=this.ids.indexOf(t);-1!==o&&(this.ids.splice(o,1),this.counter$.next(this.ids.length))}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),td=(()=>{class i{constructor(t){this.activityService=t}intercept(t,o){const n=t.headers.get("activityInterceptor");if(n){const a=t.clone({headers:t.headers.delete("activityInterceptor")});if("false"===n)return o.handle(a)}const s=this.activityService.register();return o.handle(t).pipe((0,bl.x)(()=>{this.activityService.unregister(s)}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(gn))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),bs=(()=>{class i{static forRoot(){return{ngModule:i,providers:[{provide:q.TP,useClass:td,multi:!0}]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})();const wl={lib:"1.15.0",releaseDate:1683149021750};let J=(()=>{class i{constructor(t){this.injector=t,this.config={}}getConfig(t){return B.resolve(this.config,t)}load(t){const o=t.default||{};if(!t.path)return this.config=o,!0;const n=this.injector.get(q.eN);return new Promise((s,a)=>{n.get(t.path).pipe((0,he.K)(l=>(console.log(`Configuration file ${t.path} could not be read`),s(!0),(0,dn._)(l.error||"Server error")))).subscribe(l=>{this.config=B.mergeDeep(B.mergeDeep({version:wl},o),l),s(!0)})})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Tl=new e.OlP("configOptions");function Cs(i){return{provide:Tl,useValue:i}}function od(i,r){return()=>i.load(r)}let sr=(()=>{class i{static forRoot(){return{ngModule:i,providers:[Cs({}),{provide:e.ip1,useFactory:od,multi:!0,deps:[J,Tl]}]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})();class nd{constructor(r,t,o=".json",n){this.http=r,this.prefix=t,this.suffix=o,this.config=n}getTranslation(r){const t=this.http.get(`locale/libs_locale/${r}.json`);if(this.config&&!this.prefix){const s=this.config.getConfig("language.prefix");this.prefix=!s||Array.isArray(s)?s:[s]}if(!this.prefix||0===this.prefix.length)return t;const o=this.prefix.map(s=>this.http.get(`${s}${r}${this.suffix}`));return(0,Qt.D)([t,...o]).pipe((0,Z.U)(s=>s.reduce((a,l)=>B.mergeDeep(a,l),{})))}}function Ml(i,r){return new nd(i,void 0,void 0,r)}function rd(i){return{provide:L.Zw,useFactory:i||Ml,deps:[q.eN,J]}}class sd{handle(r){if(!r.translateService.langs.length)throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.");if("igo."===r.key.substr(0,4))throw new Error(`The Key "${r.key}" is missing in locale file.`);return r.key}}let oe=(()=>{class i{static forRoot(){return{ngModule:i,providers:[rd()]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[L.aw.forRoot({missingTranslationHandler:{provide:L.gC,useClass:sd}}),L.aw]}),i})(),wo=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Sl.Rh.forRoot({positionClass:"toast-bottom-right",timeOut:1e4,extendedTimeOut:1e4,messageClass:"toast-message mat-typography",closeButton:!0,progressBar:!0,enableHtml:!0,tapToDismiss:!0,maxOpened:4,preventDuplicates:!0,resetTimeoutOnDuplicate:!0,countDuplicates:!1,includeTitleDuplicates:!0})]}),i})();var uo=(()=>{return(i=uo||(uo={})).ERROR="error",i.ALERT="warning",i.WARNING="warning",i.INFO="info",i.SUCCESS="success",i.SHOW="show",uo;var i})();let D=(()=>{class i{constructor(t){this.translate=t,this.language=this.translate.getBrowserLang(),this.language$=new b.X(void 0);const o=this.getLanguage();this.translate.setDefaultLang(o),this.language$.next(o)}getLanguage(){return this.language.match(/en|fr/)?this.language:"en"}setLanguage(t){this.language=t.match(/en|fr/)?t:"en",(0,Qe.a)([this.translate.use(this.language),this.translate.reloadLang(this.language)]).subscribe(()=>{this.language$.next(this.language)})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(L.sK))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),_e=(()=>{class i{constructor(t,o,n){this.injector=t,this.configService=o,this.languageService=n,this.messages$=new b.X([]),this.activeMessageTranslations=[],this.options=this.configService.getConfig("message")||{},this.languageService.language$.pipe((0,fe.b)(500)).subscribe(s=>{0===this.toastr.toasts.length&&(this.activeMessageTranslations=[]),this.toastr.toasts.map(a=>{const l=this.activeMessageTranslations.find(c=>c.id===a.toastId);if(l){const c=Object.assign({},l.textInterpolateParams),u=Object.assign({},l.titleInterpolateParams);l.textInterpolateParams&&Object.keys(l.textInterpolateParams).map(p=>{p&&(c[p]=this.languageService.translate.instant(l.textInterpolateParams[p]))}),l.titleInterpolateParams&&Object.keys(l.titleInterpolateParams).map(p=>{p&&(u[p]=this.languageService.translate.instant(l.titleInterpolateParams[p]))}),(0,Qt.D)([this.languageService.translate.get(l.textKey,c),this.languageService.translate.get(l.titleKey,u)]).pipe((0,Gt.P)()).subscribe(p=>{a.toastRef.componentInstance.message=p[0],a.toastRef.componentInstance.title=p[1]})}})})}get toastr(){return this.injector.get(Sl._W)}showError(t){return t.error.caught=!0,this.error(t.error.message,t.error.title)}message(t){const o=t.type;this.toastr.toastrConfig.iconClasses[o]=`toast-${o}`,this.messages$.next(this.messages$.value.concat([t])),t.options=t.options||{};const n=new Date;if(t.options.from=t.options.from?t.options.from:new Date("1 jan 1900"),t.options.to=t.options.to?t.options.to:new Date("1 jan 3000"),"string"==typeof t.options.from&&(t.options.from=new Date(Date.parse(t.options.from.replace(/-/g," ")))),"string"==typeof t.options.to&&(t.options.to=new Date(Date.parse(t.options.to.replace(/-/g," ")))),n>t.options.from&&n<t.options.to&&(!1===t.showIcon&&(this.toastr.toastrConfig.iconClasses[o]=`toast-${o} toast-no-icon`),(t=this.handleTemplate(t)).text)){let s;switch(t.type){case uo.SUCCESS:s=this.success(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case uo.ERROR:s=this.error(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case uo.INFO:s=this.info(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case uo.SHOW:s=this.show(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case uo.ALERT:case uo.WARNING:s=this.alert(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;default:s=this.info(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams)}t.options.id=s.toastId}}success(t,o="igo.core.message.success",n={},s,a){return this.handleNgxToastr("success",t,o,n,s,a)}error(t,o="igo.core.message.error",n={},s,a){return this.handleNgxToastr("error",t,o,n,s,a)}info(t,o="igo.core.message.info",n={},s,a){return this.handleNgxToastr("info",t,o,n,s,a)}alert(t,o="igo.core.message.alert",n={},s,a){return this.handleNgxToastr("alert",t,o,n,s,a)}show(t,o="igo.core.message.info",n={},s,a){return this.handleNgxToastr("show",t,o,n,s,a)}handleNgxToastr(t,o,n,s={},a,l){const c=Object.assign({},a),u=Object.assign({},l);a&&Object.keys(a).map(h=>{a[h]&&(c[h]=this.languageService.translate.instant(a[h]))}),l&&Object.keys(l).map(h=>{h&&(u[h]=this.languageService.translate.instant(l[h]))});const p=this.languageService.translate.instant(o,c),d=this.languageService.translate.instant(n,u);let g;switch(t){case"success":g=this.toastr.success(p,d,s);break;case"error":g=this.toastr.error(p,d,s);break;case"show":case"info":g=this.toastr.info(p,d,s);break;case"alert":g=this.toastr.warning(p,d,s)}return this.activeMessageTranslations.push({id:g.toastId,titleKey:n,textKey:o,textInterpolateParams:a,titleInterpolateParams:l}),g}remove(t){this.toastr.remove(t)}removeAllAreNotError(){for(const t of this.messages$.value)t.type!==uo.ERROR&&this.remove(t.options.id)}handleTemplate(t){if(!this.options.template||t.html)return t;let o=this.options.template;return o=o.replace("${text}",t.text),o=o.replace("${title}",t.title),t.html=void 0,t.text=o,t.title=void 0,t}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(e.zs3),e.LFG(J),e.LFG(D))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ad=(()=>{class i{constructor(t){this.injector=t}intercept(t,o){const n=t.headers.get("interceptError"),s=t.clone({headers:t.headers.delete("interceptError")});if("false"===n)return o.handle(s);const a={httpError:void 0};return o.handle(s).pipe((0,he.K)(l=>this.handleError(l,a)),(0,bl.x)(()=>{this.handleCaughtError(a),this.handleUncaughtError(a)}))}handleError(t,o){if(t instanceof q.UA){const n="object"===t.error?t.error:{};n.message=t.error.message||t.statusText,n.caught=!1,t=new q.UA({error:n,headers:t.headers,status:t.status,statusText:t.statusText,url:t.url})}return o.httpError=t,(0,dn._)(t)}handleCaughtError(t){const o=t.httpError;o&&o.error.toDisplay&&(o.error.caught=!0,this.injector.get(_e).error(o.error.message,o.error.title))}handleUncaughtError(t){const o=t.httpError;if(o&&!o.error.caught){const n=this.injector.get(_e);o.error.caught=!0,n.error("igo.core.errors.uncaught.message","igo.core.errors.uncaught.title")}}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),xs=(()=>{class i{constructor(t){if(t)throw new Error("IgoErrorModule is already loaded. Import it in the AppModule only")}static forRoot(){return{ngModule:i,providers:[{provide:q.TP,useClass:ad,multi:!0}]}}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(i,12))},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})();const ld={name:"igo2DB",version:2,objectStoresMeta:[{store:"geoData",storeConfig:{keyPath:"url",autoIncrement:!1},storeSchema:[{name:"regionID",keypath:"regionID",options:{unique:!1}}]},{store:"layerData",storeConfig:{keyPath:"layerId",autoIncrement:!1},storeSchema:[{name:"layerOptions",keypath:"layerOptions",options:{unique:!1}},{name:"sourceOptions",keypath:"sourceOptions",options:{unique:!1}}]}]};let cd=(()=>{class i{constructor(t,o){t.addSvgIconSet(o.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(T.jv),e.LFG(yt.H7))},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,q.JF,bs.forRoot(),sr.forRoot(),xs.forRoot(),oe.forRoot(),wo.forRoot(),rr.Cz.forRoot(ld),bs,sr,xs,oe,wo]}),i})(),Fl=new e.OlP("routeServiceOptions"),Mi=(()=>{class i{constructor(t,o,n){this.router=t,this.route=o,this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"},n)}get queryParams(){let t=decodeURIComponent(location.search);if(t.includes("\xa2er=")){t=t.replace("\xa2er","&center");const o=t.slice(1).split("&").map(n=>n.split("=")).reduce((n,s)=>{const[a,l]=s.map(decodeURIComponent);return n[a]=l,n},{});this.router.navigate([],{queryParams:o})}return this.route.queryParams}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(te.F0),e.LFG(te.gz),e.LFG(Fl,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Et=(()=>{return(i=Et||(Et={})).Mobile="mobile",i.Tablet="tablet",i.Desktop="desktop",Et;var i})(),po=(()=>{return(i=po||(po={})).Portrait="portrait",i.Landscape="landscape",po;var i})();let gt=(()=>{class i{constructor(t){this.media$=new b.X(void 0),this.orientation$=new b.X(void 0),t.observe([ko.u3.HandsetLandscape]).subscribe(o=>{o.matches&&(this.media$.next(Et.Mobile),this.orientation$.next(po.Landscape))}),t.observe([ko.u3.HandsetPortrait]).subscribe(o=>{o.matches&&(this.media$.next(Et.Mobile),this.orientation$.next(po.Portrait))}),t.observe([ko.u3.TabletLandscape]).subscribe(o=>{o.matches&&(this.media$.next(Et.Tablet),this.orientation$.next(po.Landscape))}),t.observe([ko.u3.TabletPortrait]).subscribe(o=>{o.matches&&(this.media$.next(Et.Tablet),this.orientation$.next(po.Portrait))}),t.observe([ko.u3.WebLandscape]).subscribe(o=>{o.matches&&(this.media$.next(Et.Desktop),this.orientation$.next(po.Landscape))}),t.observe([ko.u3.WebPortrait]).subscribe(o=>{o.matches&&(this.media$.next(Et.Desktop),this.orientation$.next(po.Portrait))})}getMedia(){return this.media$.value}getOrientation(){return this.orientation$.value}isTouchScreen(){return"ontouchstart"in document.documentElement}isMobile(){return"mobile"===this.getMedia()}isDesktop(){return"desktop"===this.getMedia()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ko.Yg))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ie=(()=>{return(i=Ie||(Ie={})).SESSION="Session",i.LOCAL="Local",Ie;var i})(),go=(()=>{return(i=go||(go={})).ADDED="Added",i.MODIFIED="Modified",i.REMOVED="Removed",i.CLEARED="Cleared",go;var i})();let ce=(()=>{class i{constructor(t){this.config=t,this.storageChange$=new b.X(void 0),this.options=this.config.getConfig("storage")||{key:"igo"}}get(t,o){let n;if((!o||o===Ie.SESSION)&&(n=sessionStorage.getItem(`${this.options.key}.${t}`)),(o===Ie.LOCAL||!n&&!o)&&(n=localStorage.getItem(`${this.options.key}.${t}`)),n)try{n=JSON.parse(n)}catch(s){}return n}set(t,o,n=Ie.LOCAL){const s=this.get(t,n);n===Ie.SESSION?sessionStorage.setItem(`${this.options.key}.${t}`,JSON.stringify(o)):localStorage.setItem(`${this.options.key}.${t}`,JSON.stringify(o));const a=this.get(t,n);a!==s&&this.storageChange$.next({key:t,scope:n,event:void 0!==s?go.MODIFIED:go.ADDED,previousValue:s,currentValue:a})}remove(t,o=Ie.LOCAL){const n=this.get(t,o);o===Ie.SESSION?sessionStorage.removeItem(`${this.options.key}.${t}`):localStorage.removeItem(`${this.options.key}.${t}`),this.storageChange$.next({key:t,scope:o,event:go.REMOVED,previousValue:n})}clear(t=Ie.LOCAL){t===Ie.SESSION?sessionStorage.clear():localStorage.clear(),this.storageChange$.next({scope:t,event:go.CLEARED})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Ss(i,r,t){return i>>r&(1<<t)-1}let pd=(()=>{class i{constructor(){this.base64Index=new Map,this.indexBase64=new Map,this.generateBase64Index()}generateBase64Index(){for(let t=0;t<26;t++)this.base64Index.set(String.fromCharCode("A".charCodeAt(0)+t),t),this.indexBase64.set(t,String.fromCharCode("A".charCodeAt(0)+t));for(let t=0;t<26;t++)this.base64Index.set(String.fromCharCode("a".charCodeAt(0)+t),t+26),this.indexBase64.set(t+26,String.fromCharCode("a".charCodeAt(0)+t));for(let t=0;t<10;t++)this.base64Index.set(String.fromCharCode("0".charCodeAt(0)+t),t+52),this.indexBase64.set(t+52,String.fromCharCode("0".charCodeAt(0)+t));this.base64Index.set("+",62),this.base64Index.set("/",63),this.indexBase64.set(62,"+"),this.indexBase64.set(63,"/")}compressBlob(t){return t?new Ke.y(n=>{const s=new FileReader;s.readAsDataURL(t),s.onload=()=>{const a=s.result.valueOf(),l=a.substr(a.indexOf(",")+1),c=this.compressStringBase64(l);n.next({length:l.length,type:t.type,object:c})}}):void 0}decompressBlob(t){const s=this.decompressStringBase64(t.object,t.length),a=atob(s),l=new Array(a.length);for(let p=0;p<a.length;p++)l[p]=a.charCodeAt(p);const c=new Uint8Array(l);return new Blob([c],{type:t.type})}compressStringBase64(t){let o="",n=16,s=0,a=0;for(const l of t){const c=this.base64Index.get(l);n>6?(n-=6,s+=c<<n):(a=6-n,s+=c>>a,o+=String.fromCharCode(s),s=c<<16-a,n=16-a)}return t.length%8!=0&&(o+=String.fromCharCode(s)),String.fromCharCode(9731)+o}decompressStringBase64(t,o){if(!t)return;if(9731!==t.charCodeAt(0))return t;let n=0,s=0,a=16,l="",c=1,u=t.charCodeAt(c);for(let p=0;p<o;p++)a>6?(a-=6,n=Ss(u,a,6),l+=this.indexBase64.get(n)):(s=6-a,n=Ss(u,0,a)<<s,u=t.charCodeAt(++c),n+=Ss(u,16-s,s),l+=this.indexBase64.get(n),a=16-s);return l}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),mn=(()=>{class i{constructor(t,o){this.messageService=t,this.injector=o,this.stateChangeEventEmitter=new e.vpe,this.state={connection:window.navigator.onLine},this.checkNetworkState()}checkNetworkState(){this.onlineSubscription=(0,lo.R)(window,"online").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const t=this.messageService.info("igo.core.network.online.message","igo.core.network.online.title");this.previousMessageId=t.toastId,this.state.connection=!0,this.emitEvent()}),this.offlineSubscription=(0,lo.R)(window,"offline").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const t=this.messageService.info("igo.core.network.offline.message","igo.core.network.offline.title");this.previousMessageId=t.toastId,this.state.connection=!1,this.emitEvent()})}emitEvent(){this.stateChangeEventEmitter.emit(this.state)}ngOnDestroy(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch(t){}}currentState(t=!0){return t?this.stateChangeEventEmitter.pipe((0,fe.b)(300),(0,Cl.O)(this.state)):this.stateChangeEventEmitter.pipe((0,fe.b)(300))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(_e),e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var ws=C(74225),hn=C(26067),Ts=C(14437),X=C(10745),Ms=C(36646),ni=C(87260),Al=C(32673),ri=C(60116),Ee=C(59295),I=C(44770),ue=C(91434),Q=C(1130),we=C(97217),_=C(90587),E=C(56908),dd=C(84128),Xe=C(43188),si=C(64316),ar=C(26439),H=C(24683),Po=C(5818),Fs=C(13295),j=C(34929),Ot=C(14700),As=C(54244),mt=C(70178),P=C(79944),gd=C(24476),md=C(72754),Ll=C(74742),Ls=C(89502),hd=C(33865),ae=C(31631),je=(()=>{return(i=je||(je={})).Default="Default",i.HTML="HTML",i.UnsanitizedHTML="UnsanitizedHTML",i.Editable="Editable",i.Icon="Icon",i.ButtonGroup="ButtonGroup",je;var i})(),Fi=(()=>{return(i=Fi||(Fi={})).Auto="auto",i.Instant="instant",i.Smooth="smooth",Fi;var i})(),fn=(()=>{return(i=fn||(fn={})).None="None",i.All="All",i.Some="Some",fn;var i})();function ai(i,r){return(0,ws.t)(i,r).safeObject}function _n(i){const r=i.meta||{};return r.id?r.id:ai(i,r.idProperty||"id")}function Yt(i){const r=i.meta||{};return r.title?r.title:ai(i,r.titleProperty||"title")}function lr(i){const r=i.meta||{};return r.icon?r.icon:ai(i,r.iconProperty||"icon")}class _d{constructor(r={}){this.index=new Map,this.change$=new hn.t(1),this.store=r.store?r.store:void 0,this.getKey=r.getKey?r.getKey:this.store?this.store.getKey:_n,this.next()}clear(){this.index.size>0&&(this.index.clear(),this.next())}get(r){return this.index.get(this.getKey(r))||{}}set(r,t){this.setMany([r],t)}setMany(r,t){r.forEach(o=>{this.index.set(this.getKey(o),Object.assign({},t))}),this.next()}setAll(r){Array.from(this.index.keys()).forEach(t=>{this.index.set(t,Object.assign({},r))}),this.next()}update(r,t,o=!1){this.updateMany([r],t,o)}updateMany(r,t,o=!1){if(!0===o)return this.updateManyExclusive(r,t);r.forEach(n=>{const s=Object.assign({},this.get(n),t);this.index.set(this.getKey(n),s)}),this.next()}reverse(r,t){this.reverseMany([r],t)}reverseMany(r,t){r.forEach(o=>{const n=this.get(o),s=t.reduce((c,u)=>(c[u]=n[u]||!1,c),{}),a=this.reverseChanges(s),l=Object.assign({},n,a);this.index.set(this.getKey(o),l)}),this.next()}updateAll(r){const t=this.getAllKeys();Array.from(t).forEach(o=>{const n=Object.assign({},this.index.get(o),r);this.index.set(o,n)}),this.next()}updateManyExclusive(r,t){const o=this.reverseChanges(t),n=r.map(a=>this.getKey(a));new Set(n.concat(Array.from(this.getAllKeys()))).forEach(a=>{const l=this.index.get(a)||{};n.indexOf(a)>=0?this.index.set(a,Object.assign({},l,t)):!0===Object.keys(o).some(u=>void 0!==l[u]&&l[u]!==o[u])&&this.index.set(a,Object.assign({},l,o))}),this.next()}reverseChanges(r){return Object.entries(r).reduce((t,o)=>{const[n,s]=o;return"boolean"==typeof s&&(t[n]=!s),t},{})}getAllKeys(){const r=this.store?Array.from(this.store.index.keys()):[];return new Set(Array.from(this.index.keys()).concat(r))}next(){this.change$.next()}}class Ol{constructor(r){this.source$=r,this.values$=new b.X([]),this.lifted=!1,this.joins=[],this.filter$=new b.X(void 0),this.filters$=new b.X([]),this.filterIndex=new Map,this.sort$=new b.X(void 0),this.getKey$=new b.X(void 0),this.count$=new b.X(0),this.empty$=new b.X(!0)}get getKey(){return this.getKey$.value}get count(){return this.count$.value}get empty(){return this.empty$.value}get index(){return this._index}get(r){if(void 0===this._index)throw new Error("This view has no index, therefore, this method is unavailable.");return this.index.get(r)}all(){return this.values$.value}all$(){return this.values$}firstBy(r){return this.values$.value.find(r)}firstBy$(r){return this.values$.pipe((0,Z.U)(t=>t.find(r)))}manyBy(r){return this.values$.value.filter(r)}manyBy$(r){return this.values$.pipe((0,Z.U)(t=>t.filter(r)))}clear(){this.filter(void 0),this.sort(void 0)}destroy(){void 0!==this.values$$&&this.values$$.unsubscribe(),this.clear()}createIndex(r){return this._index=new Map,this.getKey$.next(r),this}join(r){if(!0===this.lifted)throw new Error("This view has already been lifted, therefore, no join is allowed.");return this.joins.push(r),this}filter(r){return this.filter$.next(r),this}addFilter(r){const t=Ze();return this.filterIndex.set(t,r),this.filters$.next(Array.from(this.filterIndex.values())),t}removeFilter(r){this.filterIndex.delete(r),this.filters$.next(Array.from(this.filterIndex.values()))}sort(r){return this.sort$.next(r),this}lift(){this.lifted=!0;const t=[this.joins.length>0?this.liftJoinedSource():this.liftSource(),this.filters$,this.filter$,this.sort$,this.getKey$];this.values$$=(0,Qe.a)(t).pipe((0,ni.T)(1),(0,fe.b)(5)).subscribe(o=>{const[n,s,a,l,c]=o,u=this.processValues(n,s,a,l);this.setValues(u,void 0!==c)})}liftSource(){return this.source$}liftJoinedSource(){const r=[this.source$,(0,Qe.a)(this.joins.map(t=>t.source))];return(0,Qe.a)(r).pipe((0,Z.U)(t=>{const[o,n]=t;return o.reduce((s,a)=>{const l=this.computeJoinedValue(a,n);return void 0!==l&&s.push(l),s},[])}))}computeJoinedValue(r,t){let o=r,n=0;for(;void 0!==o&&n<this.joins.length;)o=this.joins[n].reduce(o,t[n]),n+=1;return o}processValues(r,t,o,n){return r=r.slice(0),r=this.filterValues(r,t.concat([o])),this.sortValues(r,n)}filterValues(r,t){return 0===t.length?r:r.filter(o=>t.filter(n=>void 0!==n).every(n=>n(o)))}sortValues(r,t){return void 0===t?r:r.sort((o,n)=>B.naturalCompare(t.valueAccessor(o),t.valueAccessor(n),t.direction,t.nullsFirst))}setValues(r,t){!0===t&&(this._index=this.generateIndex(r)),this.values$.next(r);const o=r.length,n=0===o;this.count$.next(o),this.empty$.next(n)}generateIndex(r){const t=r.map(o=>[this.getKey(o),o]);return new Map(t)}}class it{constructor(r,t={}){this.entities$=new b.X([]),this.count$=new b.X(0),this.empty$=new b.X(!0),this._pristine=!0,this.strategies=[],this.getKey=t.getKey?t.getKey:_n,this.getProperty=t.getProperty?t.getProperty:ai,this.state=this.createStateManager(),this.view=this.createDataView(),this.stateView=this.createStateView(),this.view.lift(),this.stateView.lift(),r.length>0?this.load(r):this._index=this.generateIndex(r)}get count(){return this.count$.value}get empty(){return this.empty$.value}get index(){return this._index}get pristine(){return this._pristine}get(r){return this.index.get(r)}all(){return this.entities$.value}load(r,t=!0){this._index=this.generateIndex(r),this._pristine=t,this.next()}softClear(){this.index&&this.index.size>0?(this.index.clear(),this._pristine=!0,this.next()):this.index&&this.updateCount()}clear(){this.stateView.clear(),this.view.clear(),this.state.clear(),this.softClear()}destroy(){this.stateView.destroy(),this.view.destroy(),this.clear()}insert(r){this.insertMany([r])}insertMany(r){r.forEach(t=>this.index.set(this.getKey(t),t)),this._pristine=!1,this.next()}update(r){this.updateMany([r])}updateMany(r){r.forEach(t=>this.index.set(this.getKey(t),t)),this._pristine=!1,this.next()}delete(r){this.deleteMany([r])}deleteMany(r){r.forEach(t=>this.index.delete(this.getKey(t))),this._pristine=!1,this.next()}addStrategy(r,t=!1){if(void 0!==this.strategies.find(n=>r.constructor===n.constructor))throw new Error("A strategy of this type already exists on that EntityStore.");return this.strategies.push(r),r.bindStore(this),!0===t&&r.activate(),this}removeStrategy(r){const t=this.strategies.indexOf(r);return t>=0&&(this.strategies.splice(t,1),r.unbindStore(this)),this}getStrategyOfType(r){return this.strategies.find(t=>t instanceof r)}activateStrategyOfType(r){const t=this.getStrategyOfType(r);void 0!==t&&t.activate()}deactivateStrategyOfType(r){const t=this.getStrategyOfType(r);void 0!==t&&t.deactivate()}generateIndex(r){const t=r.map(o=>[this.getKey(o),o]);return new Map(t)}next(){this.entities$.next(Array.from(this.index.values())),this.updateCount()}updateCount(){const r=this.index.size,t=0===r;this.count$.next(r),this.empty$.next(t)}createStateManager(){return new _d({store:this})}createDataView(){return new Ol(this.entities$)}createStateView(){return new Ol(this.view.all$()).join({source:this.state.change$,reduce:r=>{const t=this.getKey(r),o=this.state.get(r),n=this.stateView.get(t);if(void 0!==n&&n.entity===r&&this.statesAreTheSame(n.state,o))return n;const s=n?n.revision+1:1;return{entity:r,state:o,revision:s,ref:`${t}-${s}`}}}).createIndex(r=>this.getKey(r.entity))}statesAreTheSame(r,t){if(r===t)return!0;const o=0===Object.keys(r).length,n=0===Object.keys(t).length;return o&&n}}class yn{constructor(r,t){this.innerStateIndex=new Map,this.setChangeDetector(t),this.setStore(r)}destroy(){this.setChangeDetector(void 0),this.setStore(void 0)}setStore(r){if(void 0===r)return this.teardownObservers(),this.innerStateIndex.clear(),void(this.store=void 0);this.setStore(void 0),this.store=r,this.setupObservers(),this.detectChanges()}setChangeDetector(r){this.cdRef=r}setupObservers(){this.teardownObservers(),this.entities$$=this.store.entities$.subscribe(r=>this.onEntitiesChange(r)),this.state$$=this.store.state.change$.pipe((0,ni.T)(1)).subscribe(()=>this.onStateChange())}teardownObservers(){void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.state$$&&this.state$$.unsubscribe(),this.entities$$=void 0,this.state$$=void 0}onEntitiesChange(r){this.detectChanges()}onStateChange(){let r=!1;const t=this.store.state.index,o=this.innerStateIndex;t.size!==o.size&&(r=this.detectChanges());const n=Array.from(t.keys());for(const s of n){const a=t.get(s),l=o.get(s);!1===r&&(void 0===l?r=this.detectChanges():B.objectsAreEquivalent(a,l)||(r=this.detectChanges())),this.innerStateIndex.set(s,Object.assign({},a))}}detectChanges(){return void 0!==this.cdRef&&this.cdRef.detectChanges(),!0}}class $o{constructor(r={}){this.options=r,this.stores=[],this.active$=new b.X(!1),this.options=r}get active(){return this.active$.value}activate(){!0===this.active&&this.doDeactivate(),this.active$.next(!0),this.doActivate()}deactivate(){this.active$.next(!1),this.doDeactivate()}bindStore(r){this.stores.indexOf(r)<0&&this.stores.push(r)}unbindStore(r){const t=this.stores.indexOf(r);t>=0&&this.stores.splice(t,1)}doActivate(){}doDeactivate(){}}class Jt extends $o{constructor(r){super(r),this.options=r,this.filters=new Map}bindStore(r){super.bindStore(r),!0===this.active&&this.filterStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unfilterStore(r)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(r=>this.filterStore(r))}unfilterAll(){this.stores.forEach(r=>this.unfilterStore(r))}filterStore(r){this.filters.set(r,r.stateView.addFilter(this.options.filterClauseFunc))}unfilterStore(r){const t=this.filters.get(r);void 0!==t&&(r.stateView.removeFilter(t),this.filters.delete(r))}}class To extends $o{constructor(){super(...arguments),this.filters=new Map}bindStore(r){super.bindStore(r),!0===this.active&&this.filterStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unfilterStore(r)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(r=>this.filterStore(r))}unfilterAll(){this.stores.forEach(r=>this.unfilterStore(r))}filterStore(r){this.filters.has(r)||this.filters.set(r,r.stateView.addFilter(o=>!0===o.state.selected))}unfilterStore(r){const t=this.filters.get(r);void 0!==t&&(r.stateView.removeFilter(t),this.filters.delete(r))}}function yd(i,r){if(1&i&&(e.TgZ(0,"mat-option",4),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.Q6J("value",t.emptyValue),e.xp6(1),e.Oqu(t.emptyText)}}function vd(i,r){if(1&i&&(e.TgZ(0,"mat-option",4),e._uU(1),e.ALo(2,"async"),e.qZA()),2&i){const t=e.oxw();e.Q6J("value",t.multiSelectValue),e.xp6(1),e.Oqu(e.lcZ(2,2,t.multiText$))}}function bd(i,r){if(1&i&&(e.TgZ(0,"mat-option",4),e._uU(1),e.qZA()),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("value",t.entity),e.xp6(1),e.hij(" ",o.titleAccessor(t.entity)," ")}}let Zl=(()=>{class i{constructor(t){this.cdRef=t,this.selected$=new b.X(void 0),this.multiText$=new b.X(void 0),this.multiSelectValue={id:"IGO_MULTI_SELECT"},this.emptyValue={id:"IGO_EMPTY_SELECT"},this.titleAccessor=Yt,this.emptyText=void 0,this.multi=!1,this.multiAllText="All",this.multiNoneText="None",this.disabled=!1,this.selectedChange=new e.vpe}ngOnInit(){this.watcher=new yn(this.store,this.cdRef),this.selected$$=this.store.stateView.manyBy$(t=>!0===t.state.selected).subscribe(t=>{const o=t.map(n=>n.entity);this.onSelectFromStore(o)})}ngOnDestroy(){this.watcher.destroy(),this.selected$$.unsubscribe()}onSelectionChange(t){const o=t.value instanceof Array?t.value:[t.value],n=o.find(l=>l===this.multiSelectValue);let s=o.filter(l=>l!==this.multiSelectValue);void 0!==n&&(s.length===this.store.count?s=[]:s.length<this.store.count&&(s=this.store.all())),s=s.filter(l=>l!==this.emptyValue),0===s.length?this.store.state.updateAll({selected:!1}):this.store.state.updateMany(s,{selected:!0},!0),this.selectedChange.emit({selected:!0,value:this.multi?s:t.value})}onSelectFromStore(t){this.selected$.next(!0===this.multi?t:t.length>0?t[0]:void 0),this.updateMultiToggleWithEntities(t)}updateMultiToggleWithEntities(t){t.length===this.store.count&&this.multiText$.value!==this.multiNoneText?this.multiText$.next(this.multiNoneText):t.length<this.store.count&&this.multiText$.value!==this.multiAllText&&this.multiText$.next(this.multiAllText)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-entity-selector"]],inputs:{store:"store",titleAccessor:"titleAccessor",emptyText:"emptyText",multi:"multi",multiAllText:"multiAllText",multiNoneText:"multiNoneText",placeholder:"placeholder",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},decls:7,vars:11,consts:[[1,"igo-entity-selector"],[3,"disabled","value","multiple","placeholder","selectionChange"],[3,"value",4,"ngIf"],["ngFor","",3,"ngForOf"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-form-field",0)(1,"mat-select",1),e.NdJ("selectionChange",function(s){return o.onSelectionChange(s)}),e.ALo(2,"async"),e.YNc(3,yd,2,2,"mat-option",2),e.YNc(4,vd,3,4,"mat-option",2),e.YNc(5,bd,2,2,"ng-template",3),e.ALo(6,"async"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("disabled",o.disabled)("value",e.lcZ(2,7,o.selected$))("multiple",o.multi)("placeholder",o.placeholder),e.xp6(2),e.Q6J("ngIf",void 0!==o.emptyText&&!1===o.multi),e.xp6(1),e.Q6J("ngIf",!0===o.multi),e.xp6(1),e.Q6J("ngForOf",e.lcZ(6,9,o.store.stateView.all$())))},dependencies:[f.sg,f.O5,I.KE,ue.gD,Q.ey,f.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),i})(),Ai=(()=>{class i{onClick(t){t.stopPropagation()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=e.lG2({type:i,selectors:[["","igoStopPropagation",""]],hostBindings:function(t,o){1&t&&e.NdJ("click",function(s){return o.onClick(s)})}}),i})(),Dl=(()=>{class i{constructor(t,o){this.languageService=t,this.mediaService=o,this.disabled=!1,this.hidePageSize=!1,this.pageIndex=0,this.pageSize=50,this.pageSizeOptions=[5,10,20,50,100,200],this.showFirstLastButtons=!0,this.paginationLabelTranslation$$=[],this.entitySortChange$=new b.X(!1),this.length=0,this.paginatorChange=new e.vpe,this.rangeLabel=(n,s,a)=>{const l=new b.X("");if(this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.of").subscribe(p=>{l.next(p)})),0===a||0===s)return`0 ${l.value} ${a}`;const c=n*s;return`${c+1} - ${c<(a=Math.max(a,0))?Math.min(c+s,a):c+s} ${l.value} ${a}`}}ngOnChanges(){this.unsubscribeAll(),this.count$$=this.store.stateView.count$.subscribe(t=>{this.length=t,this.emitPaginator()}),this.entitySortChange$$=this.entitySortChange$.subscribe(()=>{this.paginator&&this.paginator.firstPage()}),this.initPaginatorOptions(),this.translateLabels()}initPaginatorOptions(){var t,o,n,s,a,l;this.disabled=(null===(t=this.paginatorOptions)||void 0===t?void 0:t.disabled)||this.disabled,this.pageIndex=(null===(o=this.paginatorOptions)||void 0===o?void 0:o.pageIndex)||this.pageIndex,this.pageSize=(null===(n=this.paginatorOptions)||void 0===n?void 0:n.pageSize)||this.pageSize,this.pageSizeOptions=(null===(s=this.paginatorOptions)||void 0===s?void 0:s.pageSizeOptions)||this.pageSizeOptions,this.mediaService.isMobile()?(this.showFirstLastButtons=!1,this.hidePageSize=!0):(this.showFirstLastButtons=(null===(a=this.paginatorOptions)||void 0===a?void 0:a.showFirstLastButtons)||this.showFirstLastButtons,this.hidePageSize=(null===(l=this.paginatorOptions)||void 0===l?void 0:l.hidePageSize)||this.hidePageSize)}translateLabels(){this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.firstPageLabel").subscribe(t=>{this.paginator._intl.firstPageLabel=t})),this.paginator._intl.getRangeLabel=this.rangeLabel,this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.itemsPerPageLabel").subscribe(t=>{this.paginator._intl.itemsPerPageLabel=t})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.lastPageLabel").subscribe(t=>{this.paginator._intl.lastPageLabel=t})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.nextPageLabel").subscribe(t=>{this.paginator._intl.nextPageLabel=t})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.previousPageLabel").subscribe(t=>{this.paginator._intl.previousPageLabel=t}))}unsubscribeAll(){this.paginationLabelTranslation$$.map(t=>t.unsubscribe()),this.count$$&&this.count$$.unsubscribe(),this.entitySortChange$$&&this.entitySortChange$$.unsubscribe()}ngOnDestroy(){this.unsubscribeAll()}emitPaginator(){this.paginatorChange.emit(this.paginator)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(gt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-entity-table-paginator"]],viewQuery:function(t,o){if(1&t&&e.Gf(ar.NW,7),2&t){let n;e.iGM(n=e.CRH())&&(o.paginator=n.first)}},inputs:{entitySortChange$:"entitySortChange$",store:"store",paginatorOptions:"paginatorOptions"},outputs:{page:"page",paginatorChange:"paginatorChange"},features:[e.TTD],decls:1,vars:7,consts:[[3,"disabled","hidePageSize","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","page"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-paginator",0),e.NdJ("page",function(){return o.emitPaginator()}),e.qZA()),2&t&&e.Q6J("disabled",o.disabled)("hidePageSize",o.hidePageSize)("length",o.length)("pageIndex",o.pageIndex)("pageSize",o.pageSize)("pageSizeOptions",o.pageSizeOptions)("showFirstLastButtons",o.showFirstLastButtons)},dependencies:[ar.NW],styles:["[_nghost-%COMP%]{margin-top:-10px;padding-right:15px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]{margin-top:0;padding-right:5px}}"],changeDetection:0}),i})(),Is=(()=>{class i{constructor(t){this.el=t,this.errorImageUrl="./assets/igo2/common/images/na.png",this.hideError=!1}onError(t){this.hideError?this.el.nativeElement.style.display="none":t.target.src=this.errorImageUrl}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoImageError",""]],hostBindings:function(t,o){1&t&&e.NdJ("error",function(s){return o.onError(s)})},inputs:{errorImageUrl:"errorImageUrl",hideError:"hideError"}}),i})(),Cd=(()=>{class i{constructor(t,o){this.renderer=t,this.el=o,this.selection=!1,this.selectOnClick=!0,this.highlightSelection=!0,this._selected=!1,this.scrollBehavior=Fi.Auto,this.select=new e.vpe}set selected(t){!1!==this.selection&&t!==this._selected&&(this.toggleSelected(t),this.scroll())}get selected(){return this._selected}onClick(){!1===this.selection||!1===this.selectOnClick||(this.toggleSelected(!0),this.select.emit(this))}toggleSelected(t){this._selected=t,!0===t?(this.addCls(i.selectedCls),!0===this.highlightSelection&&this.addCls(i.highlightedCls)):(this.removeCls(i.selectedCls),this.removeCls(i.highlightedCls))}scroll(){!0===this._selected&&(0,Fs.Z)(this.el.nativeElement,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})}addCls(t){this.renderer.addClass(this.el.nativeElement,t)}removeCls(t){this.renderer.removeClass(this.el.nativeElement,t)}}return i.selectedCls="igo-entity-table-row-selected",i.highlightedCls="igo-entity-table-row-highlighted",i.\u0275fac=function(t){return new(t||i)(e.Y36(e.Qsj),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoEntityTableRow",""]],hostBindings:function(t,o){1&t&&e.NdJ("click",function(){return o.onClick()})},inputs:{selection:"selection",selectOnClick:"selectOnClick",highlightSelection:"highlightSelection",selected:"selected",scrollBehavior:"scrollBehavior"},outputs:{select:"select"}}),i})(),cr=(()=>{class i{constructor(t){this._sanitizer=t}transform(t){return this._sanitizer.bypassSecurityTrustHtml(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(yt.H7,16))},i.\u0275pipe=e.Yjl({name:"sanitizeHtml",type:i,pure:!0}),i})(),ur=(()=>{class i{constructor(t,o){this.http=t,this.configService=o}transform(t){var o;const n=new q.WM({"Content-Type":"text/plain",activityInterceptor:"false",interceptError:"false"}),s=new RegExp((null===(o=this.configService)||void 0===o?void 0:o.getConfig("depot.url"))+'.*?(?="|$)');return s.test(t)&&(t=t.match(s)[0]),this.http.get(t,{headers:n,responseType:"blob"}).pipe((0,he.K)(a=>{throw a.error.caught=!0,a.error.toDisplay=!1,a}),(0,Al.w)(a=>new Ke.y(l=>{const c=new FileReader;c.readAsDataURL(a),c.onloadend=()=>{l.next(c.result),l.complete()}})))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(q.eN,16),e.Y36(J,16))},i.\u0275pipe=e.Yjl({name:"secureImage",type:i,pure:!0}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"transform",null),i})();function xd(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-checkbox",11),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onToggleRows(n.checked))}),e.qZA(),e.BQk()}if(2&i){const t=r.ngIf,o=e.oxw(3);e.xp6(1),e.Q6J("checked",t===o.entityTableSelectionState.All)("indeterminate",t===o.entityTableSelectionState.Some)}}function Sd(i,r){if(1&i&&(e.ynx(0),e.YNc(1,xd,2,2,"ng-container",10),e.ALo(2,"async"),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.selectionState$))}}function wd(i,r){if(1&i&&(e.TgZ(0,"th",9),e.YNc(1,Sd,3,3,"ng-container",10),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.selectMany)}}function Td(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td",12)(1,"mat-checkbox",13),e.NdJ("mousedown",function(n){return n.shiftKey?n.preventDefault():null})("click",function(n){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(n.shiftKey?l.onShiftToggleRow(!l.rowIsSelected(a),a,n):n.stopPropagation())})("change",function(n){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onToggleRow(n.checked,a))}),e.qZA()()}if(2&i){const t=r.$implicit,o=e.oxw();e.xp6(1),e.Q6J("checked",o.rowIsSelected(t))}}function Md(i,r){if(1&i&&(e.TgZ(0,"th",16),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.Q6J("matTooltip",t.tooltip?t.tooltip:void 0),e.xp6(1),e.hij(" ",t.title," ")}}function Fd(i,r){1&i&&(e.ynx(0),e.YNc(1,Md,2,2,"th",15),e.BQk())}function Ad(i,r){if(1&i&&(e.TgZ(0,"th",18),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.Q6J("matTooltip",t.tooltip?t.tooltip:void 0),e.xp6(1),e.hij(" ",t.title," ")}}function Ld(i,r){1&i&&(e.ynx(0),e.YNc(1,Ad,2,2,"th",17),e.BQk())}function Id(i,r){if(1&i&&(e.TgZ(0,"td",22),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.Q6J("ngClass",n.getCellClass(t,o)),e.xp6(1),e.hij(" ",n.getValue(t,o)," ")}}function Od(i,r){if(1&i&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&i){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,n.getValue(t,o))),e.LSH)}}function Zd(i,r){1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.common.entity-table.targetHtmlUrl")," "))}function Dd(i,r){if(1&i&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(2,Od,3,5,"img",24),e.YNc(3,Zd,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&i){const t=e.MAs(4),o=e.oxw().$implicit,n=e.oxw(3).$implicit,s=e.oxw();e.Q6J("ngClass",s.getCellClass(o,n)),e.xp6(1),e.s9C("href",s.getValue(o,n),e.LSH),e.xp6(1),e.Q6J("ngIf",s.isImg(s.getValue(o,n)))("ngIfElse",t)}}function kd(i,r){if(1&i&&(e.ynx(0),e.YNc(1,Id,2,2,"td",20),e.YNc(2,Dd,5,4,"ng-template",null,21,e.W1O),e.BQk()),2&i){const t=r.$implicit,o=e.MAs(3),n=e.oxw(3).$implicit,s=e.oxw();e.xp6(1),e.Q6J("ngIf",!s.isUrl(s.getValue(t,n)))("ngIfElse",o)}}function Pd(i,r){1&i&&(e.ynx(0),e.YNc(1,kd,4,2,"ng-container",19),e.BQk())}function $d(i,r){if(1&i&&e._UZ(0,"td",29),2&i){const t=e.oxw().$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.Q6J("ngClass",n.getCellClass(t,o))("innerHTML",n.getValue(t,o),e.oJD)}}function Ed(i,r){if(1&i&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&i){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,n.getValue(t,o))),e.LSH)}}function Jd(i,r){1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.targetHtmlUrl")," "))}function Rd(i,r){if(1&i&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(2,Ed,3,5,"img",24),e.YNc(3,Jd,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&i){const t=e.MAs(4),o=e.oxw().$implicit,n=e.oxw(3).$implicit,s=e.oxw();e.Q6J("ngClass",s.getCellClass(o,n)),e.xp6(1),e.s9C("href",s.getValue(o,n),e.LSH),e.xp6(1),e.Q6J("ngIf",s.isImg(s.getValue(o,n)))("ngIfElse",t)}}function Bd(i,r){if(1&i&&(e.ynx(0),e.YNc(1,$d,1,2,"td",27),e.YNc(2,Rd,5,4,"ng-template",null,28,e.W1O),e.BQk()),2&i){const t=r.$implicit,o=e.MAs(3),n=e.oxw(3).$implicit,s=e.oxw();e.xp6(1),e.Q6J("ngIf",!s.isUrl(s.getValue(t,n)))("ngIfElse",o)}}function Ud(i,r){1&i&&(e.ynx(0),e.YNc(1,Bd,4,2,"ng-container",19),e.BQk())}function Nd(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",43),e._UZ(1,"mat-datepicker-toggle",44),e.TgZ(2,"input",45),e.NdJ("dateChange",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onDateChange(a.name,s,n))}),e.qZA(),e._UZ(3,"mat-datepicker",null,46),e.qZA()}if(2&i){const t=e.MAs(4),o=e.oxw(2).$implicit,n=e.oxw(3).$implicit,s=e.oxw();e.xp6(1),e.Q6J("for",t),e.xp6(1),e.s9C("value",s.getValue(o,n)),e.Q6J("matDatepicker",t)("formControlName",n.name)}}function qd(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"input",47),e.NdJ("focus",function(n){e.CHM(t);const s=e.oxw(5).$implicit;return e.KtG(s.onFocus(n))})("keypress",function(n){e.CHM(t);const s=e.oxw(5).$implicit;return e.KtG(s.onChange(n))})("blur",function(n){e.CHM(t);const s=e.oxw(5).$implicit;return e.KtG(s.onBlur(n))}),e.qZA()}if(2&i){const t=e.oxw(5).$implicit;e.Q6J("formControlName",t.name)}}function Gd(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"input",48),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onValueChange(a.name,s,n))}),e.qZA()}if(2&i){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("step",o.step),e.s9C("value",n.getValue(t,o)),e.s9C("readonly",n.getValidationAttributeValue(o,"readonly")),e.s9C("required",n.getValidationAttributeValue(o,"mandatory")),e.s9C("min",n.getValidationAttributeValue(o,"minValue")),e.s9C("max",n.getValidationAttributeValue(o,"maxValue")),e.Q6J("formControlName",o.name)}}function Qd(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"input",49),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onValueChange(a.name,s,n))}),e.qZA()}if(2&i){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("value",n.getValue(t,o)),e.s9C("readonly",n.getValidationAttributeValue(o,"readonly")),e.s9C("required",n.getValidationAttributeValue(o,"mandatory")),e.Q6J("formControlName",o.name)}}function jd(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",50),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onBooleanValueChange(a.name,s,n))}),e.qZA()}if(2&i){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.Q6J("formControlName",o.name)("checked",n.getValue(t,o))}}function Yd(i,r){if(1&i&&(e.TgZ(0,"mat-option",53),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.id)("disabled",t.disabled),e.xp6(1),e.hij(" ",t.value," ")}}function Hd(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-select",51),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectValueChange(a.name,s,n))}),e.YNc(1,Yd,2,3,"mat-option",52),e.qZA()}if(2&i){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("required",n.getValidationAttributeValue(o,"mandatory")),e.Q6J("formControlName",o.name)("multiple",o.multiple)("value",n.getValue(t,o)),e.xp6(1),e.Q6J("ngForOf",o.domainValues)}}function Vd(i,r){if(1&i&&e._UZ(0,"input",54),2&i){e.oxw();const t=e.MAs(9),o=e.oxw().$implicit,n=e.oxw(3).$implicit,s=e.oxw();e.s9C("required",s.getValidationAttributeValue(n,"mandatory")),e.s9C("value",s.getValue(o,n)),e.s9C("readonly",s.getValidationAttributeValue(n,"readonly")),e.Q6J("formControlName",n.name)("matAutocomplete",t)}}function zd(i,r){if(1&i&&(e.TgZ(0,"mat-option",55),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.value," ")}}function Wd(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td",32),e.YNc(1,Nd,5,4,"div",33),e.YNc(2,qd,1,1,"input",34),e.YNc(3,Gd,1,7,"input",35),e.YNc(4,Qd,1,4,"input",36),e.YNc(5,jd,1,2,"mat-checkbox",37),e.YNc(6,Hd,2,5,"mat-select",38),e.YNc(7,Vd,1,5,"input",39),e.TgZ(8,"mat-autocomplete",40,41),e.NdJ("optionSelected",function(n){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onAutocompleteValueChange(a,s,n))}),e.YNc(10,zd,2,2,"mat-option",42),e.ALo(11,"async"),e.qZA()()}if(2&i){const t=e.oxw().$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.Q6J("formGroup",n.formGroup)("ngClass",n.getCellClass(t,o)),e.xp6(1),e.Q6J("ngIf","date"===o.type),e.xp6(1),e.Q6J("ngIf","time"===o.type),e.xp6(1),e.Q6J("ngIf","number"===o.type),e.xp6(1),e.Q6J("ngIf",!o.type||"string"===o.type),e.xp6(1),e.Q6J("ngIf","boolean"===o.type),e.xp6(1),e.Q6J("ngIf","list"===o.type),e.xp6(1),e.Q6J("ngIf","autocomplete"===o.type),e.xp6(3),e.Q6J("ngForOf",e.lcZ(11,10,n.filteredOptions[o.name]))}}function Kd(i,r){if(1&i&&(e._UZ(0,"td",29),e.ALo(1,"sanitizeHtml")),2&i){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.Q6J("ngClass",n.getCellClass(t,o))("innerHTML",e.lcZ(1,2,n.getValue(t,o)),e.oJD)}}function Xd(i,r){if(1&i&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&i){const t=e.oxw(3).$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,n.getValue(t,o))),e.LSH)}}function eg(i,r){1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.targetHtmlUrl")," "))}function tg(i,r){if(1&i&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(2,Xd,3,5,"img",24),e.YNc(3,eg,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&i){const t=e.MAs(4),o=e.oxw(2).$implicit,n=e.oxw(3).$implicit,s=e.oxw();e.Q6J("ngClass",s.getCellClass(o,n)),e.xp6(1),e.s9C("href",s.getValue(o,n),e.LSH),e.xp6(1),e.Q6J("ngIf",s.isImg(s.getValue(o,n)))("ngIfElse",t)}}function og(i,r){if(1&i&&(e.YNc(0,Kd,2,4,"td",27),e.YNc(1,tg,5,4,"ng-template",null,56,e.W1O)),2&i){const t=e.MAs(2),o=e.oxw().$implicit,n=e.oxw(3).$implicit,s=e.oxw();e.Q6J("ngIf",!s.isUrl(s.getValue(o,n)))("ngIfElse",t)}}function ig(i,r){if(1&i&&(e.ynx(0),e.YNc(1,Wd,12,12,"td",30),e.YNc(2,og,3,2,"ng-template",null,31,e.W1O),e.BQk()),2&i){const t=r.$implicit,o=e.MAs(3),n=e.oxw(4);e.xp6(1),e.Q6J("ngIf",n.isEdition(t))("ngIfElse",o)}}function ng(i,r){1&i&&(e.ynx(0),e.YNc(1,ig,4,2,"ng-container",19),e.BQk())}function rg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-icon",60),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(4).$implicit;return e.KtG(s.onClick(n))}),e.qZA()}if(2&i){const t=e.oxw().$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("svgIcon",n.getValue(t,o)||o.icon)}}function sg(i,r){if(1&i&&e._UZ(0,"mat-icon",61),2&i){const t=e.oxw().$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.s9C("svgIcon",n.getValue(t,o)||o.icon)}}function ag(i,r){if(1&i&&(e.TgZ(0,"td",22),e.YNc(1,rg,1,1,"mat-icon",58),e.YNc(2,sg,1,1,"mat-icon",59),e.qZA()),2&i){const t=r.$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.Q6J("ngClass",n.getCellClass(t,o)),e.xp6(1),e.Q6J("ngIf",o.onClick),e.xp6(1),e.Q6J("ngIf",!o.onClick)}}function lg(i,r){1&i&&(e.ynx(0),e.YNc(1,ag,3,3,"td",57),e.BQk())}function cg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",65),e.NdJ("mousedown",function(){e.CHM(t);const n=e.oxw(2).$implicit,s=e.oxw().$implicit,a=e.oxw(4);return e.KtG(a.onButtonClick(n.click,s))}),e._UZ(1,"mat-icon",61),e.qZA()}if(2&i){const t=e.oxw(2).$implicit;e.Q6J("color",t.color)("disabled",t.disabled),e.xp6(1),e.s9C("svgIcon",t.icon)}}function ug(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",66),e.NdJ("mousedown",function(){e.CHM(t);const n=e.oxw(2).$implicit,s=e.oxw().$implicit,a=e.oxw(4);return e.KtG(a.onButtonClick(n.click,s))}),e._UZ(1,"mat-icon",61),e.qZA()}if(2&i){const t=e.oxw(2).$implicit;e.Q6J("color",t.color)("disabled",t.disabled),e.xp6(1),e.s9C("svgIcon",t.icon)}}function pg(i,r){if(1&i&&(e.ynx(0),e.YNc(1,cg,2,3,"button",63),e.YNc(2,ug,2,3,"button",64),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf","mat-icon-button"===t.style),e.xp6(1),e.Q6J("ngIf","mat-icon-button"!==t.style)}}function dg(i,r){if(1&i&&(e.TgZ(0,"span"),e.YNc(1,pg,3,2,"ng-container",10),e.qZA()),2&i){const t=r.$implicit,o=e.oxw().$implicit,n=e.oxw(4);e.xp6(1),e.Q6J("ngIf",n.isEdition(o)===t.editMode||void 0===t.editMode)}}function gg(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"td",22),e.YNc(2,dg,2,1,"span",62),e.qZA(),e.BQk()),2&i){const t=r.$implicit,o=e.oxw(3).$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngClass",n.getCellClass(t,o)),e.xp6(1),e.Q6J("ngForOf",n.getValue(t,o))}}function mg(i,r){1&i&&(e.ynx(0),e.YNc(1,gg,3,2,"ng-container",19),e.BQk())}function hg(i,r){if(1&i&&(e.ynx(0),e.YNc(1,Pd,2,0,"ng-container",10),e.YNc(2,Ud,2,0,"ng-container",10),e.YNc(3,ng,2,0,"ng-container",10),e.YNc(4,lg,2,0,"ng-container",10),e.YNc(5,mg,2,0,"ng-container",10),e.BQk()),2&i){const t=r.ngIf,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.Default),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.HTML),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.UnsanitizedHTML),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.Icon),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.ButtonGroup)}}function fg(i,r){if(1&i&&(e.ynx(0,14),e.YNc(1,Fd,2,0,"ng-container",10),e.YNc(2,Ld,2,0,"ng-container",10),e.YNc(3,hg,6,5,"ng-container",10),e.BQk()),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("matColumnDef",t.name),e.xp6(1),e.Q6J("ngIf",o.columnIsSortable(t)),e.xp6(1),e.Q6J("ngIf",!o.columnIsSortable(t)),e.xp6(1),e.Q6J("ngIf",o.getColumnRenderer(t))}}function _g(i,r){if(1&i&&e._UZ(0,"tr",67),2&i){const t=e.oxw();e.Q6J("ngClass",t.getHeaderClass())}}function yg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"tr",68),e.NdJ("select",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onRowSelect(s))})("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onRowClick(s))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw();e.Q6J("scrollBehavior",o.scrollBehavior)("ngClass",o.getRowClass(t))("selection",o.selection)("selected",o.rowIsSelected(t))}}function vg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-entity-table-paginator",69),e.NdJ("paginatorChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.paginatorChange(n))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("store",t.store)("paginatorOptions",t.paginatorOptions)("entitySortChange$",t.entitySortChange$)}}const bg=function(i){return{height:i}};let li=(()=>{class i{constructor(t,o,n,s,a,l,c,u,p){this.cdRef=t,this.formBuilder=o,this._focusMonitor=n,this._elementRef=s,this.ngControl=a,this._parentForm=l,this._controlName=c,this._defaultErrorStateMatcher=u,this.dateAdapter=p,this.entitySortChange$=new b.X(!1),this.formGroup=new _.nJ({}),this.filteredOptions={},this.entityTableColumnRenderer=je,this.entityTableSelectionState=fn,this.selectionState$=new b.X(void 0),this.scrollBehavior=Fi.Auto,this.sortNullsFirst=!1,this.withPaginator=!1,this.entityClick=new e.vpe,this.entitySelectChange=new e.vpe,this.entitySortChange=new e.vpe(void 0),this.dataSource=new we.by,this.dateAdapter.setLocale("fr-CA")}set paginator(t){this._paginator=t,this.dataSource.paginator=t}get paginator(){return this._paginator}get headers(){let t=this.template.columns.filter(o=>!1!==o.visible).map(o=>o.name);return!0===this.selectionCheckbox&&(t=["selectionCheckbox"].concat(t)),t}get selection(){return this.template.selection||!1}get selectionCheckbox(){return this.template.selectionCheckbox||!1}get selectMany(){return this.template.selectMany||!1}get fixedHeader(){return void 0===this.template.fixedHeader||this.template.fixedHeader}get tableHeight(){return this.template.tableHeight?this.template.tableHeight:"auto"}ngOnInit(){this.handleDatasource(),this.dataSource.paginator=this.paginator}ngOnChanges(t){const o=t.store;o&&o.currentValue!==o.previousValue&&this.handleDatasource()}onValueChange(t,o,n){const s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=n.target.value}onBooleanValueChange(t,o,n){const s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=n.checked}onSelectValueChange(t,o,n){const s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=n.value}onAutocompleteValueChange(t,o,n){this.formGroup.controls[t.name].setValue(n.option.viewValue);const s=this.getColumnKeyWithoutPropertiesTag(t.name);o.entity.properties[s]=n.option.value}onDateChange(t,o,n){const a=E(n.value).format("YYYY-MM-DD"),l=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[l]=a}enableEdit(t){const o=t.entity.properties||t.entity;this.template.columns.forEach(n=>{var s;n.title=(null===(s=n.validation)||void 0===s?void 0:s.mandatory)&&!n.title.includes("*")?n.title+" *":n.title;const a=this.getColumnKeyWithoutPropertiesTag(n.name);if("boolean"===n.type)o[a]&&null!==o[a]?"string"==typeof o[a]&&(o[a]=JSON.parse(o[a].toLowerCase())):o[a]=!1,this.formGroup.setControl(n.name,this.formBuilder.control(o[a]));else if("list"===n.type)n.multiple?this.formGroup.setControl(n.name,this.formBuilder.control([o[a]])):(this.formGroup.setControl(n.name,this.formBuilder.control(o[a])),this.formGroup.controls[n.name].setValue("string"==typeof o[a]?parseInt(o[a]):o[a]));else if("autocomplete"===n.type){this.formGroup.setControl(n.name,this.formBuilder.control(o[a])),this.filteredOptions[n.name]=new Ke.y,this.filteredOptions[n.name]=this.formGroup.controls[n.name].valueChanges.pipe((0,Z.U)(c=>{var u;if(null!=c&&c.length)return null===(u=n.domainValues)||void 0===u?void 0:u.filter(p=>{const d=c?c.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return p.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(d)})}));let l=o[a];if(n.domainValues.forEach(c=>{"string"==typeof l&&/^\d+$/.test(l)&&(l=parseInt(l)),(c.value===l||c.id===l)&&(l=c.value)}),this.formGroup.controls[n.name].setValue(l),this.isEdition(t)&&n.linkColumnForce){const c=t.entity;this.formGroup.controls[n.name].setValue(null==c?void 0:c.properties[this.getColumnKeyWithoutPropertiesTag(n.linkColumnForce)])}}else if("date"===n.type){if(!1!==n.visible)if(o[a]){let l=E(o[a]);o[a]=l.utc().format("YYYY-MM-DD"),this.formGroup.setControl(n.name,this.formBuilder.control(o[a]))}else{const l=this.getColumnKeyWithoutPropertiesTag(n.name);t.entity.properties[l]=null,this.formGroup.setControl(n.name,this.formBuilder.control(null))}}else this.formGroup.setControl(n.name,this.formBuilder.control(o[a]));this.formGroup.controls[n.name]&&this.getValidationAttributeValue(n,"readonly")&&this.formGroup.controls[n.name].disable()})}handleDatasource(){this.unsubscribeStore(),this.selection$$=this.store.stateView.manyBy$(t=>!0===t.state.selected).subscribe(t=>{const o=t[0],n=this.store.stateView.all().indexOf(o),s=this.paginator?this.paginator.pageSize*(this.paginator.pageIndex+1):0;if(this.paginator&&(n<(this.paginator?s-this.paginator.pageSize:0)||n>=s)){const l=Math.floor(n/this.paginator.pageSize);this.dataSource.paginator.pageIndex=l}this.selectionState$.next(this.computeSelectionState(t))}),this.dataSource$$=this.store.stateView.all$().subscribe(t=>{t[0]&&this.enableEdit(t[0]),this.dataSource.data=t})}ngOnDestroy(){this.unsubscribeStore()}unsubscribeStore(){this.selection$$&&this.selection$$.unsubscribe(),this.dataSource$$&&this.dataSource$$.unsubscribe()}getTrackByFunction(){return(t,o)=>o.ref}refresh(){this.cdRef.detectChanges()}paginatorChange(t){this.paginator=t}onSort(t){const o=t.direction,n=this.template.columns.find(s=>s.name===t.active);"asc"===o||"desc"===o?(this.store.stateView.sort({valueAccessor:s=>this.getValue(s,n),direction:o,nullsFirst:this.sortNullsFirst}),this.entitySortChange.emit({column:n,direction:o}),this.entitySortChange$.next(!0)):this.store.stateView.sort(void 0)}onRowClick(t){this.lastRecordCheckedKey=this.store.stateView.getKey(t),this.entityClick.emit(t.entity)}onRowSelect(t){if(!1===this.selection)return;const o=t.entity;this.store.state.update(o,{selected:!0},!0),this.entitySelectChange.emit({added:[o]})}onToggleRows(t){if(!1!==this.selection&&(this.store.state.updateAll({selected:t}),!0===t)){const o=this.store.stateView.all().map(n=>n.entity);this.entitySelectChange.emit({added:[o]})}}onToggleRow(t,o){if(!1===this.selection)return;const n=o.entity;this.store.state.update(n,{selected:t},!0===t&&!this.selectMany),!0===t&&this.entitySelectChange.emit({added:[n]}),this.lastRecordCheckedKey=this.store.stateView.getKey(o)}onShiftToggleRow(t,o,n){if(!1===this.selection)return;if(!1===this.selectMany||void 0===this.lastRecordCheckedKey)return void this.onToggleRow(t,o);const s=window.document.createRange();s.selectNode(n.target),window.getSelection().removeAllRanges(),window.getSelection().addRange(s),n.stopImmediatePropagation();const a=this.store.stateView.all(),l=a.indexOf(o),c=this.store.stateView.get(this.lastRecordCheckedKey),p=[l,a.indexOf(c)],g=a.slice(Math.min(...p),Math.max(...p)+1).map(h=>h.entity);this.store.state.updateMany(g,{selected:t}),!0===t&&this.entitySelectChange.emit({added:g}),this.lastRecordCheckedKey=this.store.stateView.getKey(o)}computeSelectionState(t){const n=t.length;return 0===n?fn.None:n===this.store.stateView.count?fn.All:fn.Some}columnIsSortable(t){let o=t.sort;return void 0===o&&(o=void 0!==this.template.sort&&this.template.sort),o}rowIsSelected(t){const o=t.state;return!!o.selected&&o.selected}isImg(t){return!!this.isUrl(t)&&-1!==["jpg","png","gif"].indexOf(t.split(".").pop().toLowerCase())}isUrl(t){return"string"==typeof t&&("https://"===t.slice(0,8)||"http://"===t.slice(0,7))}getValue(t,o){const n=t.entity;let s;if(void 0!==o.valueAccessor)return o.valueAccessor(n,t);if(void 0!==this.template.valueAccessor)return this.template.valueAccessor(n,o.name,t);if(s=this.store.getProperty(n,o.name),"boolean"===o.type)null==s||""===s?s=!1:"boolean"!=typeof s&&void 0!==s&&(s="number"==typeof s?Boolean(s):JSON.parse(s.toLowerCase())),this.isEdition(t)||(s=s?"&#10003;":"");else if("list"===o.type&&s&&o.domainValues){const a=t.entity;if(o.multiple){let l;l="string"==typeof s?s.match(/[\w.-]+/g).map(Number):s;let c=[];o.domainValues.forEach(u=>{l.includes(u.id)&&c.push(t.edition?u.id:u.value)}),s=this.isEdition(t)?l:c}else!this.isEdition(t)&&o.linkColumnForce?s=null==a?void 0:a.properties[this.getColumnKeyWithoutPropertiesTag(o.linkColumnForce)]:o.domainValues.forEach(l=>{"string"==typeof s&&/^\d+$/.test(s)&&(s=parseInt(s)),(l.value===s||l.id===s)&&(s=this.isEdition(t)?l.id:l.value)})}else if("autocomplete"===o.type&&s&&o.domainValues){const a=t.entity;!this.isEdition(t)&&o.linkColumnForce?s=null==a?void 0:a.properties[this.getColumnKeyWithoutPropertiesTag(o.linkColumnForce)]:o.domainValues.forEach(l=>{"string"==typeof s&&/^\d+$/.test(s)&&(s=parseInt(s)),(l.value===s||l.id===s)&&(s=l.value)})}else"date"===o.type&&(this.isEdition(t)?s&&(s=E(s).format(),this.formGroup.controls[o.name].setValue(s)):!this.isEdition(t)&&null===s&&(s=""));return void 0===s&&(s=""),s}getValidationAttributeValue(t,o){return void 0!==t.validation&&void 0!==t.validation[o]&&t.validation[o]}isEdition(t){return!!t.entity.edition}getColumnRenderer(t){return void 0!==t.renderer?t.renderer:je.Default}getTableClass(){return{"igo-entity-table-with-selection":this.selection}}getHeaderClass(){const t=this.template.headerClassFunc;return t instanceof Function?t():{}}getRowClass(t){const n=this.template.rowClassFunc;return n instanceof Function?n(t.entity,t):{}}getCellClass(t,o){const n=t.entity,s={},a=this.template.cellClassFunc;a instanceof Function&&Object.assign(s,a(n,o,t));const l=o.cellClassFunc;return l instanceof Function&&Object.assign(s,l(n,t)),s}onButtonClick(t,o){this.enableEdit(o),"function"==typeof t&&t(o.entity,o)}getColumnKeyWithoutPropertiesTag(t){return t.includes("properties.")?t.split(".")[1]:t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(_.QS),e.Y36(dd.tE),e.Y36(e.SBq),e.Y36(_.a5,10),e.Y36(_.F,8),e.Y36(_.u,8),e.Y36(Q.rD),e.Y36(Q._A))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-entity-table"]],inputs:{store:"store",paginator:"paginator",template:"template",scrollBehavior:"scrollBehavior",sortNullsFirst:"sortNullsFirst",withPaginator:"withPaginator",paginatorOptions:"paginatorOptions"},outputs:{entityClick:"entityClick",entitySelectChange:"entitySelectChange",entitySortChange:"entitySortChange"},features:[e._Bn([{provide:I.Eo,useExisting:i}]),e.TTD],decls:9,vars:11,consts:[[1,"table-container",3,"ngStyle"],["mat-table","","matSort","",3,"ngClass","dataSource","trackBy","matSortChange"],["matColumnDef","selectionCheckbox",1,"mat-cell-checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"ngClass",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click",4,"matRowDef","matRowDefColumns"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],["mat-header-cell",""],[4,"ngIf"],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","mousedown","click","change"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip"],["mat-header-cell","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","",3,"matTooltip"],[4,"matCellDef"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"ngIf","ngIfElse"],["isAnUrlDefault",""],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","50","heigth","auto",3,"src",4,"ngIf","ngIfElse"],["notImg",""],["igoImageError","","width","50","heigth","auto",3,"src"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"ngIf","ngIfElse"],["isAnUrlHTML",""],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-cell","","class","mat-cell-text edition",3,"formGroup","ngClass",4,"ngIf","ngIfElse"],["isUnsanitizedHTML",""],["mat-cell","",1,"mat-cell-text","edition",3,"formGroup","ngClass"],["class","date-picker",4,"ngIf"],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur",4,"ngIf"],["matInput","","type","number","class","class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input",4,"ngIf"],["matInput","","type","text",3,"formControlName","value","readonly","required","input",4,"ngIf"],[3,"formControlName","checked","change",4,"ngIf"],[3,"required","formControlName","multiple","value","selectionChange",4,"ngIf"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly",4,"ngIf"],["panelWidth","430px",3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"date-picker"],["matSuffix","",3,"for"],["matInput","",3,"matDatepicker","formControlName","value","dateChange"],["picker",""],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur"],["matInput","","type","number",1,"class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input"],["matInput","","type","text",3,"formControlName","value","readonly","required","input"],[3,"formControlName","checked","change"],[3,"required","formControlName","multiple","value","selectionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly"],[3,"value"],["isAnUrlUnsanitizedHTML",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],[3,"svgIcon","click",4,"ngIf"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon","click"],[3,"svgIcon"],[4,"ngFor","ngForOf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown"],["mat-header-row","",3,"ngClass"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"table",1),e.NdJ("matSortChange",function(s){return o.onSort(s)}),e.ynx(2,2),e.YNc(3,wd,2,1,"th",3),e.YNc(4,Td,2,1,"td",4),e.BQk(),e.YNc(5,fg,4,4,"ng-container",5),e.YNc(6,_g,1,1,"tr",6),e.YNc(7,yg,1,4,"tr",7),e.qZA(),e.YNc(8,vg,1,3,"igo-entity-table-paginator",8),e.qZA()),2&t&&(e.Q6J("ngStyle",e.VKq(9,bg,o.tableHeight)),e.xp6(1),e.Q6J("ngClass",o.getTableClass())("dataSource",o.dataSource)("trackBy",o.getTrackByFunction()),e.xp6(4),e.Q6J("ngForOf",o.template.columns),e.xp6(1),e.Q6J("matHeaderRowDef",o.headers)("matHeaderRowDefSticky",o.fixedHeader),e.xp6(1),e.Q6J("matRowDefColumns",o.headers),e.xp6(1),e.Q6J("ngIf",o.withPaginator))},dependencies:[f.mk,f.sg,f.O5,f.PC,we.BZ,we.fO,we.as,we.w1,we.Dz,we.nj,we.ge,we.ev,we.XQ,we.Gk,Xe.XC,Xe.ZL,Q.ey,si.YE,si.nU,T.Hw,w.lW,Ge.oG,I.R9,ue.gD,Ai,Dl,Is,_.Fj,_.wV,_.JJ,_.JL,_.Q7,_.qQ,_.Fd,_.sg,_.u,H.Nt,Po.Mq,Po.hl,Po.nW,O.gM,Cd,f.Ov,cr,ur,L.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-compact[_nghost-%COMP%]   tr.mat-header-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     .mat-checkbox .mat-checkbox-ripple{height:36px}.table-compact[_nghost-%COMP%]   tr.mat-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     .mat-checkbox .mat-checkbox-ripple{height:28px}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]{padding:0 3px}entity-table[_ngcontent-%COMP%]   table.igo-entity-table-with-selection[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd;cursor:pointer}table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:7px}.class_hidden[_ngcontent-%COMP%]{visibility:hidden}.class_display_none[_ngcontent-%COMP%]{display:none}.class_boolean[_ngcontent-%COMP%], .class_icon[_ngcontent-%COMP%], .class_number[_ngcontent-%COMP%]{text-align:center;padding-right:35px!important}.class_sting[_ngcontent-%COMP%], .class_text[_ngcontent-%COMP%], .class_number_edition[_ngcontent-%COMP%]{text-align:left}td.edition[_ngcontent-%COMP%]{background:rgba(166,166,166,.2)}input[_ngcontent-%COMP%]{border-bottom:1px solid darkgrey}"],changeDetection:0}),i})();var Mo=(()=>{return(i=Mo||(Mo={})).Dock="dock",i.Overlay="overlay",i.Context="context",Mo;var i})();function Cg(i,r){if(1&i&&(e._UZ(0,"mat-icon",7),e.ALo(1,"async")),2&i){const t=e.oxw(3);e.s9C("svgIcon",e.lcZ(1,1,t.icon$))}}function xg(i,r){if(1&i&&(e.TgZ(0,"button",5),e.ALo(1,"async"),e.YNc(2,Cg,2,3,"mat-icon",6),e.qZA()),2&i){const t=e.oxw(2);e.Q6J("color",t.color)("disabled",e.lcZ(1,3,t.disabled$)),e.xp6(2),e.Q6J("ngIf",t.withIcon)}}function Sg(i,r){if(1&i&&(e.TgZ(0,"h4",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(e.lcZ(2,1,t.title))}}function wg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-list-item",2),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,xg,3,5,"button",3),e.YNc(5,Sg,3,3,"h4",4),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",t.withTooltip?e.lcZ(1,4,e.lcZ(2,6,t.tooltip$)||t.title):"")("ngClass",e.lcZ(3,8,t.ngClass$)),e.xp6(4),e.Q6J("ngIf",t.withIcon),e.xp6(1),e.Q6J("ngIf",t.withTitle)}}function Tg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",11),e.NdJ("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.action.handler())}),e.ALo(1,"async"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("checked",e.lcZ(1,2,t.checkCondition$)),e.xp6(2),e.hij(" ",e.lcZ(3,4,t.title)," ")}}function Mg(i,r){if(1&i&&(e.TgZ(0,"mat-list-item",9),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,Tg,4,6,"mat-checkbox",10),e.qZA()),2&i){const t=e.oxw();e.Q6J("matTooltip",t.withTooltip?e.lcZ(1,3,e.lcZ(2,5,t.tooltip$)||t.title):"")("ngClass",e.lcZ(3,7,t.ngClass$)),e.xp6(4),e.Q6J("ngIf",t.withTitle)}}let Fg=(()=>{class i{constructor(){this.disabled$=new b.X(!1),this.checkCondition$=new b.X(void 0),this.icon$=new b.X(void 0),this.tooltip$=new b.X(void 0),this.noDisplay$=new b.X(!1),this.ngClass$=new b.X({}),this.color="default",this.withTitle=!0,this.withIcon=!0,this.withTooltip=!0,this.trigger=new e.vpe}set disabled(t){this.disabled$.next(t)}get disabled(){return this.disabled$.value}set noDisplay(t){this.noDisplay$.next(t)}get noDisplay(){return this.noDisplay$.value}get title(){return this.action.title}ngOnInit(){const t=this.action.args||[];void 0!==this.action.ngClass&&(this.ngClass$$=this.action.ngClass(...t).subscribe(o=>this.updateNgClass(o))),(0,Ts.b)(this.action.icon)?this.icon$$=this.action.icon.subscribe(o=>this.updateIcon(o)):this.updateIcon(this.action.icon),(0,Ts.b)(this.action.checkCondition)?this.checkCondition$$=this.action.checkCondition.subscribe(o=>this.updateCheckCondition(o)):this.updateCheckCondition(this.action.checkCondition),(0,Ts.b)(this.action.tooltip)?this.tooltip$$=this.action.tooltip.subscribe(o=>this.updateTooltip(o)):this.updateTooltip(this.action.tooltip),void 0!==this.action.availability&&(this.availability$$=this.action.availability(...t).subscribe(o=>this.disabled=!o)),this.disabled$$=this.disabled$.subscribe(o=>this.updateNgClass({"igo-actionbar-item-disabled":o})),void 0!==this.action.display&&(this.display$$=this.action.display(...t).subscribe(o=>this.noDisplay=!o)),this.noDisplay$$=this.noDisplay$.subscribe(o=>this.updateNgClass({"igo-actionbar-item-no-display":o}))}ngOnDestroy(){void 0!==this.ngClass$$&&(this.ngClass$$.unsubscribe(),this.ngClass$$=void 0),void 0!==this.availability$$&&(this.availability$$.unsubscribe(),this.availability$$=void 0),void 0!==this.display$$&&(this.display$$.unsubscribe(),this.display$$=void 0),void 0!==this.checkCondition$$&&(this.checkCondition$$.unsubscribe(),this.checkCondition$$=void 0),void 0!==this.icon$$&&(this.icon$$.unsubscribe(),this.icon$$=void 0),void 0!==this.tooltip$$&&(this.tooltip$$.unsubscribe(),this.tooltip$$=void 0),this.disabled$$.unsubscribe(),this.noDisplay$$.unsubscribe()}onClick(){!0!==this.disabled&&this.trigger.emit(this.action)}updateNgClass(t){this.ngClass$.next(Object.assign({},this.ngClass$.value,t))}updateTooltip(t){this.tooltip$.next(t)}updateCheckCondition(t){this.checkCondition$.next(t)}updateIcon(t){this.icon$.next(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-actionbar-item"]],inputs:{action:"action",color:"color",withTitle:"withTitle",withIcon:"withIcon",withTooltip:"withTooltip",disabled:"disabled",noDisplay:"noDisplay"},outputs:{trigger:"trigger"},decls:2,vars:2,consts:[["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click",4,"ngIf"],["class","item-checkbox","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass",4,"ngIf"],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click"],["mat-list-avatar","","mat-icon-button","",3,"color","disabled",4,"ngIf"],["matLine","",4,"ngIf"],["mat-list-avatar","","mat-icon-button","",3,"color","disabled"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon"],["matLine",""],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"item-checkbox",3,"matTooltip","ngClass"],[3,"checked","change",4,"ngIf"],[3,"checked","change"]],template:function(t,o){1&t&&(e.YNc(0,wg,6,10,"mat-list-item",0),e.YNc(1,Mg,5,9,"mat-list-item",1)),2&t&&(e.Q6J("ngIf",!o.action.checkbox),e.xp6(1),e.Q6J("ngIf",o.action.checkbox))},dependencies:[f.mk,f.O5,w.lW,T.Hw,O.gM,G.Tg,G.eA,Q.X2,Ge.oG,f.Ov,L.X$],styles:["mat-list-item.igo-actionbar-item-disabled[_ngcontent-%COMP%]{color:#00000042;cursor:default!important}mat-list-item.igo-actionbar-item-no-display[_ngcontent-%COMP%]{display:none}mat-checkbox[_ngcontent-%COMP%]{padding:12px}.item-checkbox[_ngcontent-%COMP%]{height:56px}.item-checkbox[_ngcontent-%COMP%]     .mat-checkbox-label{margin-left:20px}"],changeDetection:0}),i})();function Ag(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",5)(1,"button",6),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.scrollUp())}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",7),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.common.actionbar.scrollUp")))}function Lg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",8),e.NdJ("trigger",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.onTriggerAction(n.toggleCollapseAction))}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("withTitle",!1)("withIcon",!0)("color",t.color)("disabled",t.store.view.empty)("action",t.toggleCollapseAction)}}function Ig(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",11),e.NdJ("trigger",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.onTriggerAction(s))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("withTooltip",o.withTooltip)("color",o.color)("disabled",o.store.state.get(t).disabled)("action",t)}}function Og(i,r){if(1&i&&(e.YNc(0,Ig,1,6,"ng-template",9,10,e.W1O),e.ALo(2,"async")),2&i){const t=e.oxw(2);e.Q6J("ngForOf",e.lcZ(2,1,t.store.view.all$()))}}function Zg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",12)(1,"button",6),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.scrollDown())}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",13),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.common.actionbar.scrollDown")))}function Dg(i,r){if(1&i&&(e.TgZ(0,"mat-list"),e.YNc(1,Ag,4,3,"div",2),e.YNc(2,Lg,1,5,"igo-actionbar-item",3),e.YNc(3,Og,3,3,null,0),e.YNc(4,Zg,4,3,"div",4),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.heightCondition&&t.positionConditionTop&&t.isDesktop),e.xp6(1),e.Q6J("ngIf",t.withToggleButton),e.xp6(1),e.Q6J("ngIf",!t.collapsed),e.xp6(1),e.Q6J("ngIf",t.heightCondition&&t.positionConditionLow&&t.isDesktop)}}function kg(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",18),e.NdJ("trigger",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onTriggerAction(s))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(2);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("color",o.color)("action",t)}}function Pg(i,r){if(1&i&&(e.TgZ(0,"div")(1,"button",14),e.ALo(2,"translate"),e._UZ(3,"mat-icon",15),e.qZA(),e.TgZ(4,"mat-menu",16,17)(6,"mat-list"),e.YNc(7,kg,1,4,"ng-template",9),e.ALo(8,"async"),e.qZA()()()),2&i){const t=e.MAs(5),o=e.oxw();e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,10,"igo.common.actionbar.icon"))("matMenuTriggerFor",t)("disabled",o.store.view.empty)("color",o.iconColor),e.xp6(2),e.Q6J("svgIcon",o.icon),e.xp6(1),e.Tol(o.overlayClass),e.Q6J("xPosition",o.xPosition)("yPosition",o.yPosition),e.xp6(3),e.Q6J("ngForOf",e.lcZ(8,12,o.store.view.all$()))}}function $g(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",18),e.NdJ("trigger",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onTriggerAction(s))}),e.qZA(),e._UZ(1,"br")}if(2&i){const t=r.$implicit,o=e.oxw(2);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("color",o.color)("action",t)}}function Eg(i,r){if(1&i&&(e.TgZ(0,"mat-card",19)(1,"mat-list"),e.YNc(2,$g,2,4,"ng-template",9),e.ALo(3,"async"),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,t.store.view.all$()))}}let vn=(()=>{class i{constructor(t,o,n,s){this.overlay=t,this.elRef=o,this.cdRef=n,this.mediaService=s,this.actionbarMode=Mo,this.collapsed=!1,this.toggleCollapseAction={id:"actionbar_toggle",icon:"dots-vertical",handler:()=>{this.collapsed=!this.collapsed}},this.heightCondition$=new b.X(!1),this.positionConditionTop$=new b.X(!0),this.positionConditionLow$=new b.X(!0),this.mode=Mo.Dock,this.withToggleButton=!1,this.horizontal=!1,this.color="default",this.iconColor="default",this.withTitle=!0,this.withTooltip=!0,this.scrollActive=!0,this.withIcon=!0,this.icon="dots-horizontal",this.xPosition="before",this.yPosition="above",this._overlayClass=""}set overlayClass(t){this._overlayClass=t}get overlayClass(){return[this._overlayClass,"igo-actionbar-overlay"].join(" ")}get withTitleClass(){return this.withTitle}get withIconClass(){return this.withIcon}get horizontalClass(){return this.horizontal}get heightCondition(){const t=this.elRef.nativeElement;return!1===this.scrollActive&&t.clientHeight<t.scrollHeight}get positionConditionTop(){return 0!==this.elRef.nativeElement.scrollTop}get positionConditionLow(){const t=this.elRef.nativeElement;return!(t.scrollTop>=t.scrollHeight-t.clientHeight)}get isDesktop(){return this.mediaService.getMedia()===Et.Desktop}ngOnChanges(t){const o=t.store;o&&o.currentValue!==o.previousValue&&(void 0!==this.watcher&&this.watcher.destroy(),this.watcher=new yn(this.store,this.cdRef))}ngOnDestroy(){this.watcher.destroy()}onTriggerAction(t){t.handler(...t.args||[])}scrollDown(){this.elRef.nativeElement.scrollBy(0,52)}scrollUp(){this.elRef.nativeElement.scrollBy(0,-52)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(As.aV),e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(gt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-actionbar"]],hostVars:6,hostBindings:function(t,o){2&t&&e.ekj("with-title",o.withTitleClass)("with-icon",o.withIconClass)("horizontal",o.horizontalClass)},inputs:{store:"store",mode:"mode",withToggleButton:"withToggleButton",horizontal:"horizontal",color:"color",iconColor:"iconColor",withTitle:"withTitle",withTooltip:"withTooltip",scrollActive:"scrollActive",withIcon:"withIcon",icon:"icon",xPosition:"xPosition",yPosition:"yPosition",overlayClass:"overlayClass"},features:[e.TTD],decls:3,vars:3,consts:[[4,"ngIf"],["class","context-menu-card mat-elevation-z4",4,"ngIf"],["id","topChevron",4,"ngIf"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger",4,"ngIf"],["id","lowChevron",4,"ngIf"],["id","topChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger"],["ngFor","",3,"ngForOf"],["buttonContent",""],["color","accent",3,"withTitle","withIcon","withTooltip","color","disabled","action","trigger"],["id","lowChevron"],["svgIcon","chevron-down"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"buttonOverlay",3,"matTooltip","matMenuTriggerFor","disabled","color"],[3,"svgIcon"],["overlapTrigger","true",1,"igo-compact-menu","igo-no-min-width-menu",3,"xPosition","yPosition"],["actionbarMenu","matMenu"],["color","accent",3,"withTitle","withIcon","color","action","trigger"],[1,"context-menu-card","mat-elevation-z4"]],template:function(t,o){1&t&&(e.YNc(0,Dg,5,4,"mat-list",0),e.YNc(1,Pg,9,14,"div",0),e.YNc(2,Eg,4,3,"mat-card",1)),2&t&&(e.Q6J("ngIf",o.mode===o.actionbarMode.Dock),e.xp6(1),e.Q6J("ngIf",o.mode===o.actionbarMode.Overlay),e.xp6(1),e.Q6J("ngIf",o.mode===o.actionbarMode.Context))},dependencies:[f.sg,f.O5,w.lW,T.Hw,O.gM,$e.VK,$e.p6,G.i$,x.a8,Fg,f.Ov,L.X$],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}button[_ngcontent-%COMP%]{margin:4px}.buttonOverlay[_ngcontent-%COMP%]{margin:0}mat-list[_ngcontent-%COMP%]{padding-top:0}.horizontal[_nghost-%COMP%]{max-width:100%;overflow:visible;overflow:initial}.horizontal[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{width:auto;white-space:nowrap}.horizontal[_nghost-%COMP%]   igo-actionbar-item[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]     .mat-list .mat-list-item .mat-list-text>*{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-list-base .mat-list-item.mat-list-item-with-avatar{height:46px}[_nghost-%COMP%]     .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content{display:-webkit-flex;height:46px;padding:3px}[_nghost-%COMP%]     .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content>mat-icon{padding:8px}igo-actionbar-item[_ngcontent-%COMP%]     mat-list-item [mat-list-avatar]{height:auto;width:40px}igo-actionbar-item[_ngcontent-%COMP%]     mat-list-item:hover{cursor:pointer}.context-menu-card[_ngcontent-%COMP%]{padding:8px 3px;margin:10px}#topChevron[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:3}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){#topChevron[_ngcontent-%COMP%]{position:fixed;top:auto;top:initial}}@supports (-ms-accelerator: true){#topChevron[_ngcontent-%COMP%]{position:fixed;top:auto;top:initial}}#lowChevron[_ngcontent-%COMP%]{position:fixed;position:sticky;bottom:0;background-color:#fff;z-index:3}"],changeDetection:0}),i})(),pr=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,oe,w.ot,T.Ps,O.AV,$e.Tx,G.ie,x.QW,Ge.p9]}),i})(),Os=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,pr,pr]}),i})(),Zs=(()=>{class i{constructor(t,o){this.el=t,this.matIconRegistry=o,this.hidden=!1,this.disabled=!1,this.inverseColor=!1,this.inheritColor=!1}set igoMatBadgeIcon(t){this.matIconRegistry.getNamedSvgIcon(t).subscribe(o=>{this.svg=o,this.updateSvg()})}set matBadgeHidden(t){this.hidden=t,this.updateHidden()}set matBadgeDisabled(t){this.disabled=t,this.updateDisabled()}set igoMatBadgeInverseColor(t){this.inverseColor=t,this.updateColor()}set igoMatBadgeInheritColor(t){this.inheritColor=t,this.updateColor()}set igoMatBadgeColor(t){this.color=t,this.updateColor()}set igoMatBadgeBackgroundColor(t){this.backgroundColor=t,this.updateColor()}get badge(){return this.el.nativeElement.querySelector(".mat-badge-content")}ngOnInit(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateSvg()}updateSvg(){!this.badge||(this.badge.innerHTML="",this.svg&&this.badge.appendChild(this.svg))}updateColor(){!this.badge||(this.color||this.backgroundColor?(this.badge.style.color=this.color?this.color:"",this.badge.style.background=this.backgroundColor?this.backgroundColor:""):this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inheritColor||(this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="")),this.originalColor=this.badge.style.color,this.updateDisabled())}updateHidden(){!this.badge||(this.badge.style.display=this.hidden?"none":"flex")}updateDisabled(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.SBq),e.Y36(T.jv))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor",igoMatBadgeColor:"igoMatBadgeColor",igoMatBadgeBackgroundColor:"igoMatBadgeBackgroundColor"}}),i})(),dr=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[mt.g,T.Ps,mt.g]}),i})(),Rg=(()=>{class i{constructor(t){this.el=t,this.clickout=new e.vpe}handleMouseClick(t,o){!o||this.el.nativeElement.contains(o)||this.clickout.emit(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoClickout",""]],hostBindings:function(t,o){1&t&&e.NdJ("click",function(s){return o.handleMouseClick(s,s.target)},!1,e.evT)},outputs:{clickout:"clickout"}}),i})(),Bg=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})(),Li=(()=>{class i{constructor(t,o){this.renderer=t,this.el=o,this._collapsed=!1,this.toggle=new e.vpe}get target(){return this._target}set target(t){this._target=t}get collapsed(){return this._collapsed}set collapsed(t){t?this.collapseTarget():this.expandTarget(),this._collapsed=t,this.toggle.emit(t)}click(){this.collapsed=!this.collapsed}collapseTarget(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}expandTarget(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.Qsj),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoCollapse",""]],hostBindings:function(t,o){1&t&&e.NdJ("click",function(){return o.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"}}),i})();const Ug=["*"];let Ds=(()=>{class i{constructor(){this._title="",this._collapsed=!1,this.toggle=new e.vpe}get title(){return this._title}set title(t){this._title=t}get collapsed(){return this._collapsed}set collapsed(t){this._collapsed=t,this.toggle.emit(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},ngContentSelectors:Ug,decls:7,vars:3,consts:[["svgIcon","chevron-up","mat-list-avatar","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matLine",""],["content",""]],template:function(t,o){if(1&t&&(e.F$t(),e.TgZ(0,"mat-list-item")(1,"mat-icon",0),e.NdJ("toggle",function(s){return o.collapsed=s}),e.qZA(),e.TgZ(2,"h4",1),e._uU(3),e.qZA()(),e.TgZ(4,"div",null,2),e.Hsn(6),e.qZA()),2&t){const n=e.MAs(5);e.xp6(1),e.Q6J("target",n)("collapsed",o.collapsed),e.xp6(2),e.Oqu(o.title)}},dependencies:[T.Hw,G.Tg,G.eA,Q.X2,Li],styles:["[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}"]}),i})(),Ii=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[T.Ps,G.ie]}),i})(),Ng=(()=>{class i{constructor(t){this.dialogRef=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-confirm-dialog"]],decls:12,vars:10,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click"],["mat-button","",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"h2",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1),e._uU(4),e.qZA(),e.TgZ(5,"div",2)(6,"button",3),e.NdJ("click",function(){return o.dialogRef.close(!0)}),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"button",4),e.NdJ("click",function(){return o.dialogRef.close(!1)}),e._uU(10),e.ALo(11,"translate"),e.qZA()()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,4,"igo.common.confirmDialog.title")),e.xp6(3),e.Oqu(o.confirmMessage),e.xp6(3),e.Oqu(e.lcZ(8,6,"igo.common.confirmDialog.confirmBtn")),e.xp6(3),e.Oqu(e.lcZ(11,8,"igo.common.confirmDialog.cancelBtn")))},dependencies:[w.lW,P.uh,P.xY,P.H8,L.X$],styles:["h2[_ngcontent-%COMP%]{margin:5px 0 10px}div[mat-dialog-content][_ngcontent-%COMP%]{max-width:200px}div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}"]}),i})(),bn=(()=>{class i{constructor(t,o){this.dialog=t,this.languageService=o}open(t){const o=this.dialog.open(Ng,{disableClose:!1});return o.componentInstance.confirmMessage=this.languageService.translate.instant(t),o.afterClosed()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(P.uw),e.LFG(D))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),kl=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[bn],imports:[w.ot,P.Is,oe]}),i})(),Pl=(()=>{class i{constructor(t,o,n){this.overlay=t,this.viewContainerRef=o,this.elementRef=n,this.menuPosition=new e.vpe}onContextMenu(t){let o,n;if(t instanceof TouchEvent?(o=t.touches[0].pageX,n=t.touches[0].pageY):t instanceof MouseEvent&&(o=t.x,n=t.y),!o||!n)return;this.close(),t.preventDefault(),this.menuPosition.emit({x:o,y:n}),this.overlayRef=null;const s=this.overlay.position().flexibleConnectedTo({x:o,y:n}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}]);this.overlayRef=this.overlay.create({positionStrategy:s,scrollStrategy:this.overlay.scrollStrategies.close()}),this.overlayRef.attach(new gd.UE(this.menuContext,this.viewContainerRef,{$implicit:void 0})),this.sub=(0,lo.R)(document,"click").pipe((0,ri.h)(a=>{const l=a.target;return this.close(),!!this.overlayRef&&!this.overlayRef.overlayElement.contains(l)}),(0,Ee.q)(1)).subscribe(()=>this.close()),this.sub=(0,lo.R)(document,"contextmenu").pipe((0,ri.h)(a=>{const l=a.target;if(l&&!this.elementRef.nativeElement.contains(l)&&!this.overlayRef.overlayElement.contains(l))return!0;a.preventDefault()}),(0,Ee.q)(1)).subscribe(()=>this.close())}close(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null),this.sub&&this.sub.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(As.aV),e.Y36(e.s_b),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoContextMenu",""]],hostBindings:function(t,o){1&t&&e.NdJ("longpress",function(s){return o.onContextMenu(s)})("contextmenu",function(s){return o.onContextMenu(s)})},inputs:{menuContext:["igoContextMenu","menuContext"]},outputs:{menuPosition:"menuPosition"}}),i})(),qg=(()=>{class i{constructor(){this.touchDuration=400,this.onlyIOS=!0,this.longpress=new e.vpe}touchstart(t){t.touches.length>1?this.touchEnd():this.touchTimeout=setTimeout(()=>{this.onlyIOS?"iOS"===ti.getOSName()&&this.longpress.emit(t):this.longpress.emit(t)},this.touchDuration)}touchend(){this.touchEnd()}touchEnd(){clearTimeout(this.touchTimeout)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=e.lG2({type:i,selectors:[["","igoLongPress",""]],hostBindings:function(t,o){1&t&&e.NdJ("touchstart",function(s){return o.touchstart(s)})("touchmove",function(){return o.touchend()})("touchcancel",function(){return o.touchend()})("touchend",function(){return o.touchend()})},inputs:{touchDuration:"touchDuration",onlyIOS:"onlyIOS"},outputs:{longpress:"longpress"}}),i})(),$l=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})(),ks=(()=>{class i{constructor(){this._html=""}get html(){return this._html}set html(t){this._html=t}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-custom-html"]],inputs:{html:"html"},decls:2,vars:3,consts:[[1,"custom-html",3,"innerHTML"]],template:function(t,o){1&t&&(e._UZ(0,"div",0),e.ALo(1,"sanitizeHtml")),2&t&&e.Q6J("innerHTML",e.lcZ(1,1,o.html),e.oJD)},dependencies:[cr],styles:[".custom-html[_ngcontent-%COMP%]{padding:20px}"]}),i})(),Oi=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,T.Ps,O.AV,H.c,w.ot,oe]}),i})(),gr=(()=>{class i{constructor(t){this.http=t}getDom(t){return(0,j.mG)(this,void 0,void 0,function*(){const o=t.url;let n;return yield this.http.get(o).pipe((0,Z.U)(s=>(n=s,s)),(0,he.K)(s=>(0,dn._)(s))).toPromise(),n})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Gg=(()=>{class i{static forRoot(){return{ngModule:i,providers:[gr]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[gr]}),i})(),jg=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})();class El{constructor(r){this.componentFactory=r,this.subscriptions=[],this.inputs={},this.inputs$$={},this.subscribers={}}setTarget(r){this.target=r,this.componentRef=r.createComponent(this.componentFactory),this.updateInputs(this.inputs),this.updateSubscribers(this.subscribers)}destroy(){void 0!==this.target&&this.target.clear(),void 0!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0),this.unobserveAllInputs(),this.unsubscribeAll()}updateInputs(r){if(this.inputs=r,void 0===this.componentRef)return;const t=this.componentRef.instance;this.componentFactory.inputs.forEach(n=>{const s=n.propName;this.unobserveInput(s);const a=r[s];r.hasOwnProperty(s)&&(a instanceof Ke.y?this.observeInput(s,a):this.setInputValue(t,s,a))}),"function"==typeof t.onUpdateInputs&&t.onUpdateInputs()}setInputValue(r,t,o){if(o===r[t])return;const s=Object.getPrototypeOf(r),a=Object.getOwnPropertyDescriptor(s,t);void 0!==a&&void 0!==a.set?a.set.call(r,o):r[t]=o}updateSubscribers(r){if(this.subscribers=r,void 0===this.componentRef)return;const t=this.componentRef.instance;this.componentFactory.outputs.forEach(n=>{const s=n.propName;if(r.hasOwnProperty(s)){const a=t[s],l=r[s];Array.isArray(l)?l.forEach(c=>{this.subscriptions.push(a.subscribe(c))}):this.subscriptions.push(a.subscribe(l))}})}observeInput(r,t){this.inputs$$[r]=t.subscribe(o=>{const n=this.componentRef.instance;this.setInputValue(n,r,o),"function"==typeof n.onUpdateInputs&&n.onUpdateInputs()})}unobserveInput(r){void 0!==this.inputs$$[r]&&(this.inputs$$[r].unsubscribe(),this.inputs$$[r]=void 0)}unobserveAllInputs(){Object.values(this.inputs$$).forEach(r=>{void 0!==r&&r.unsubscribe()}),this.inputs$$={}}unsubscribeAll(){this.subscriptions.forEach(r=>r.unsubscribe()),this.subscriptions=[]}}let Ps=(()=>{class i{constructor(t){this.resolver=t}create(t){const o=this.resolver.resolveComponentFactory(t);return new El(o)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(e._Vd))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Yg=["target"];function Hg(i,r){}let mr=(()=>{class i{constructor(t,o){this.dynamicComponentService=t,this.cdRef=o,this.inputs={},this.subscribers={}}ngOnChanges(t){const o=t.component,n=t.inputs,s=t.subscribers,a=B.objectsAreEquivalent;if(o&&o.currentValue){if(o.currentValue!==o.previousValue)this.createComponent(o.currentValue);else{const l=n&&a(n.currentValue||{},n.previousValue||{}),c=s&&a(s.currentValue||{},s.previousValue||{});!1===l&&this.updateInputs(),!1===c&&this.updateSubscribers()}this.cdRef.detectChanges()}}ngOnDestroy(){this.dynamicComponent&&this.dynamicComponent.destroy()}createComponent(t){void 0!==this.dynamicComponent&&this.dynamicComponent.destroy(),this.dynamicComponent=t instanceof El?t:this.dynamicComponentService.create(t),this.renderComponent()}renderComponent(){this.updateInputs(),this.updateSubscribers(),this.dynamicComponent.setTarget(this.target)}updateInputs(){this.dynamicComponent.updateInputs(this.inputs)}updateSubscribers(){this.dynamicComponent.updateSubscribers(this.subscribers)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ps),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-dynamic-outlet"]],viewQuery:function(t,o){if(1&t&&e.Gf(Yg,7,e.s_b),2&t){let n;e.iGM(n=e.CRH())&&(o.target=n.first)}},inputs:{component:"component",inputs:"inputs",subscribers:"subscribers"},features:[e.TTD],decls:2,vars:0,consts:[["target",""]],template:function(t,o){1&t&&e.YNc(0,Hg,0,0,"ng-template",null,0,e.W1O)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0}),i})(),$s=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez]}),i})(),Es=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Ps],imports:[f.ez,$s,$s]}),i})(),Js=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})();const Xg=["buttons"],em=["*",[["","formButtons",""]]],tm=function(i){return{"igo-form-body-with-buttons":i}},om=["*","[formButtons]"];let Rs=(()=>{class i{constructor(){this.autocomplete="off",this.submitForm=new e.vpe}get hasButtons(){return 0!==this.buttons.nativeElement.children.length}ngOnChanges(t){const o=t.formData;o&&o.currentValue!==o.previousValue&&(void 0===o.currentValue?this.clear():this.setData(o.currentValue))}onSubmit(){this.submitForm.emit(this.getData())}getData(){const t={};return function Jl(i){return i.groups.reduce((r,t)=>r.concat(t.fields),[].concat(i.fields))}(this.form).forEach(o=>{this.updateDataWithFormField(t,o)}),t}setData(t){this.form.fields.forEach(o=>{o.control.setValue((0,ws.t)(t,o.name).safeObject)}),this.form.groups.forEach(o=>{o.fields.forEach(n=>{n.control.setValue((0,ws.t)(t,n.name).safeObject)})})}updateDataWithFormField(t,o){const n=o.control;n.disabled||(t[o.name]=n.value)}clear(){this.form.control.reset()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-form"]],viewQuery:function(t,o){if(1&t&&e.Gf(Xg,7),2&t){let n;e.iGM(n=e.CRH())&&(o.buttons=n.first)}},inputs:{form:"form",formData:"formData",autocomplete:"autocomplete"},outputs:{submitForm:"submitForm"},features:[e.TTD],ngContentSelectors:om,decls:7,vars:5,consts:[[3,"autocomplete","formGroup","ngSubmit"],[1,"igo-form-body",3,"ngClass"],[1,"igo-form-content"],[1,"igo-form-buttons"],["buttons",""]],template:function(t,o){1&t&&(e.F$t(em),e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"div",2),e.Hsn(3),e.qZA(),e.TgZ(4,"div",3,4),e.Hsn(6,1),e.qZA()()()),2&t&&(e.Q6J("autocomplete",o.autocomplete)("formGroup",o.form.control),e.xp6(1),e.Q6J("ngClass",e.VKq(3,tm,o.hasButtons)))},dependencies:[f.mk,_._Y,_.JL,_.sg],styles:["[_nghost-%COMP%]{display:block}form[_ngcontent-%COMP%]{width:100%;height:100%}.igo-form-body[_ngcontent-%COMP%], .igo-form-content[_ngcontent-%COMP%]{height:100%}.igo-form-body-with-buttons[_ngcontent-%COMP%]   .igo-form-content[_ngcontent-%COMP%]{height:calc(100% - 56px)}.igo-form-content[_ngcontent-%COMP%]{display:flex}"],changeDetection:0}),i})(),im=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,_.u5,_.UX]}),i})(),Bs=(()=>{class i{constructor(t){this.formBuilder=t}form(t,o){const n=this.formBuilder.group({});return t.forEach(s=>{n.addControl(s.name,s.control)}),o.forEach(s=>{n.addControl(s.name,s.control)}),{fields:t,groups:o,control:n}}group(t,o){const n=t.options||{},s=this.formBuilder.group({});if(o.forEach(a=>{s.addControl(a.name,a.control)}),n.validator){const a=this.getValidators(n.validator);s.setValidators(a)}return Object.assign({},t,{fields:o,control:s})}field(t){const o=t.options||{},s=this.formBuilder.control({value:"",disabled:o.disabled});if(o.validator){const a=this.getValidators(o.validator);s.setValidators(a)}return Object.assign({type:"text"},t,{control:s})}extendFieldConfig(t,o){const n=Object.assign({},t.options||{},o.options||{}),s=Object.assign({},t.inputs||{},o.inputs||{}),a=Object.assign({},t.subscribers||{},o.subscribers||{});return Object.assign({},t,{options:n,inputs:s,subscribers:a})}getValidators(t){return Array.isArray(t)?t.map(o=>this.getValidator(o)):this.getValidator(t)}getValidator(t){if("string"!=typeof t)return t;const n=t.match(/^([a-zA-Z]{3,15})\((.{0,20})\)$/);return n?_.kI[n[1]](n[2]):_.kI[t]}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(_.QS))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Us=(()=>{class i{constructor(){}static register(t,o){i.fields[t]=o}getFieldByType(t){return i.fields[t]}}return i.fields={},i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function nm(i,r){if(1&i&&(e.ynx(0),e._UZ(1,"igo-dynamic-outlet",1),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("component",t.getFieldComponent())("inputs",t.getFieldInputs())("subscribers",t.getFieldSubscribers())}}let rm=(()=>{class i{constructor(t){this.formFieldService=t,this.fieldInputs=void 0,this.fieldSubscribers=void 0}get fieldOptions(){return this.field.options||{}}getFieldComponent(){return this.formFieldService.getFieldByType(this.field.type||"text")}getFieldInputs(){if(void 0!==this.fieldInputs)return this.fieldInputs;const t=this.fieldOptions.errors||{};return this.fieldInputs=Object.assign({placeholder:this.field.title,disableSwitch:this.fieldOptions.disableSwitch||!1},Object.assign({},this.field.inputs||{}),{formControl:this.field.control,errors:Object.assign({},{required:"igo.common.form.errors.required"},t)}),this.fieldInputs}getFieldSubscribers(){return void 0!==this.fieldSubscribers||(this.fieldSubscribers=Object.assign({},this.field.subscribers||{})),this.fieldSubscribers}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Us))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-form-field"]],inputs:{field:"field"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(t,o){1&t&&e.YNc(0,nm,2,3,"ng-container",0),2&t&&e.Q6J("ngIf",void 0!==o.field)},dependencies:[f.O5,mr],styles:["mat-form-field{width:100%}  .igo-form-disable-switch{margin-right:8px}"],changeDetection:0}),i})(),Ns=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,T.Ps,I.lN,H.c,ue.LD,oe,$s]}),i})();function gm(i,r){if(1&i&&(e.TgZ(0,"div",5),e._UZ(1,"igo-form-field",6),e.qZA()),2&i){const t=r.$implicit,o=e.oxw(2);e.Q6J("ngClass",o.getFieldNgClass(t)),e.xp6(1),e.Q6J("field",t)}}function mm(i,r){if(1&i&&(e.TgZ(0,"div",3),e.YNc(1,gm,2,2,"div",4),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.group.fields)}}function hm(i,r){if(1&i&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.getErrorMessage()))}}const fm=["*"];let Rl=(()=>{class i{constructor(){}get formControl(){return this.group.control}getFieldColSpan(t){let o=2;const n=t.options||{};return n.cols&&n.cols>0&&(o=Math.min(n.cols,2)),o}getFieldNgClass(t){return{[`igo-form-field-colspan-${this.getFieldColSpan(t)}`]:!0}}getErrorMessage(){return function _r(i,r){const n=Object.keys(i.errors||{}).map(s=>r[s]).filter(s=>void 0!==s);return n.length>0?n[0]:""}(this.formControl,(this.group.options||{}).errors||{})}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-form-group"]],inputs:{group:"group",errors:"errors"},ngContentSelectors:fm,decls:4,vars:2,consts:[["class","igo-form-group-fields",4,"ngIf"],[1,"igo-form-group-extra-content"],[4,"ngIf"],[1,"igo-form-group-fields"],["class","igo-form-field-wrapper",3,"ngClass",4,"ngFor","ngForOf"],[1,"igo-form-field-wrapper",3,"ngClass"],[3,"field"]],template:function(t,o){1&t&&(e.F$t(),e.YNc(0,mm,2,1,"div",0),e.TgZ(1,"div",1),e.Hsn(2),e.qZA(),e.YNc(3,hm,3,3,"mat-error",2)),2&t&&(e.Q6J("ngIf",o.group&&o.group.fields.length>0),e.xp6(3),e.Q6J("ngIf",o.formControl.errors))},dependencies:[f.mk,f.sg,f.O5,I.TO,rm,L.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:auto;padding:10px 5px}.igo-form-field-wrapper[_ngcontent-%COMP%]{display:inline-block;padding:0 5px}.igo-form-field-colspan-2[_ngcontent-%COMP%]{width:100%}.igo-form-field-colspan-1[_ngcontent-%COMP%]{width:50%}"],changeDetection:0}),i})(),Bl=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,I.lN,oe,Ns]}),i})(),Cn=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Bs,Us],imports:[f.ez,Bl,Ns,im,Bl,Ns]}),i})(),qs=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,ue.LD]}),i})(),vr=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})(),Gs=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[ar.TU]}),i})(),Qs=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})(),Zi=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,we.p0,Xe.Bb,si.JX,T.Ps,w.ot,Ge.p9,ar.TU,ue.LD,vr,Oi,Gs,Qs,oe,_.u5,_.UX,H.c,Po.FA,O.AV]}),i})(),Ul=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,qs,Zi,Gs]}),i})(),Nl=(()=>{class i{constructor(t,o){this.http=t,this.configService=o,this.jsonURL=this.getPathToConfigFile()}loadConfigTour(){this.getJSON().subscribe(t=>{this.allToursOptions=t},t=>{throw new Error("Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.")})}getPathToConfigFile(){return this.configService.getConfig("interactiveTour.pathToConfigFile")||"./config/interactiveTour.json"}getJSON(){return this.http.get(this.jsonURL).pipe((0,he.K)(t=>{throw t.error.caught=!0,t}))}getTourOptionData(t){if(void 0===this.allToursOptions)return;let o=t;return o=o.replace(/\s/g,""),this.allToursOptions[o]}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),js=(()=>{class i{constructor(t,o,n,s,a){this.configService=t,this.mediaService=o,this.languageService=n,this.interactiveTourLoader=s,this.shepherdService=a,this.nextIndex=1,this.isAppHaveTour()&&this.interactiveTourLoader.loadConfigTour()}isAppHaveTour(){const t=this.configService.getConfig("interactiveTour.activateInteractiveTour");return void 0===t||t}isToolHaveTourConfig(t){return void 0!==this.interactiveTourLoader.getTourOptionData(t)}disabledTourButton(t){const o=this.interactiveTourLoader.getTourOptionData(t);if(null!=o&&o.conditions)for(const n of null==o?void 0:o.conditions)if(null===document.querySelector(n))return!0;return!1}isMobile(){return this.mediaService.isMobile()}isTourDisplayInMobile(){return void 0===this.configService.getConfig("interactiveTour.tourInMobile")||this.configService.getConfig("interactiveTour.tourInMobile")}getButtons(t){return"noBackButton"===t?[{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"first"===t?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"last"===t?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"}]:[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]}getAction(t){return{click:"click"}[t.toLowerCase()]}addProgress(){const t=this;let o=0;const s=setInterval(()=>{if(t.getCurrentStep()){if(t.getCurrentStep().options.attachTo.element&&!document.querySelector(t.getCurrentStep().options.attachTo.element))return t.cancel(),void clearInterval(s);{const a=t.getCurrentStep().getElement();a&&a.querySelectorAll(".shepherd-content, .shepherd-text").forEach(u=>{u.classList.add("mat-typography")});const l=a?a.querySelector(".shepherd-header"):void 0;if(o++,(l||o>21)&&clearInterval(s),l){const c=t.steps,u=document.createElement("span");u.className="shepherd-progress",u.innerText=`${c.indexOf(t.getCurrentStep())+1}/${c.length}`,l.insertBefore(u,a.querySelector(".shepherd-cancel-icon"))}}}},100)}checkNext(t,o,n){if(o.getCurrentStep()){if(o.getCurrentStep().options.attachTo.element&&document.querySelector(o.getCurrentStep().options.attachTo.element))return void o.complete();if(t.index===o.steps.length-1)return void o.complete();o.steps.splice(t.index,1);const s=o.steps[t.index];s.options.attachTo.element&&!document.querySelector(s.options.attachTo.element)?n.checkNext(t,o,n):(o._setupModal(),o.show(s.id))}}executeAction(t,o){if(!o||o.condition&&("!"===o.condition.charAt(0)&&document.querySelector(o.condition.slice(1))||"!"!==o.condition.charAt(0)&&!document.querySelector(o.condition)))return;const n=document.querySelector(o.element||t.element),s=this.getAction(o.action);n&&s&&n[s]()}executeActionPromise(t,o){return new Promise(n=>{if(this.executeAction(t,o),!o||!o.waitFor)return void n();let s=0;const a=o.maxWait?o.maxWait/100:20,l=setInterval(()=>{s++,(s>a||document.querySelector(o.waitFor))&&(clearInterval(l),n())},100)})}getShepherdSteps(t){const o=[];let n=0;for(const s of t.steps)o.push({attachTo:{element:s.element,on:s.position||t.position},popperOptions:{modifiers:[{name:"offset",options:{offset:[0,15]}}]},beforeShowPromise:()=>Promise.all([this.executeActionPromise(this.previousStep,this.previousStep?this.previousStep.beforeChange:void 0),this.executeActionPromise(s,s.beforeShow)]),buttons:this.getButtons(0===n?"first":n+1===t.steps.length?"last":t.steps[n].noBackButton?"noBackButton":void 0),classes:s.class,highlightClass:s.highlightClass,scrollTo:s.scrollToElement||t.scrollToElement||!0,canClickTarget:s.disableInteraction?!s.disableInteraction:void 0,title:this.languageService.translate.instant(s.title||t.title),text:[this.languageService.translate.instant(s.text)],when:{show:()=>{this.executeAction(s,s.onShow)},hide:()=>{this.previousStep=s,this.executeAction(s,s.onHide)}}}),n++;return o}startTour(t){const o=this.interactiveTourLoader.getTourOptionData(t);this.shepherdService.defaultStepOptions={classes:o.class,highlightClass:o.highlightClass,canClickTarget:!o.disableInteraction||!o.disableInteraction,cancelIcon:{enabled:!0}};const n=this.getShepherdSteps(o);this.shepherdService.modal=!0,this.shepherdService.confirmCancel=!1,this.shepherdService.addSteps(n),this.shepherdService.tourObject.on("show",this.addProgress),this.shepherdService.tourObject.on("cancel",s=>{this.checkNext(s,this.shepherdService.tourObject,this)}),this.shepherdService.start()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(J),e.LFG(gt),e.LFG(D),e.LFG(Nl),e.LFG(md.a))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();class ql{constructor(r={}){this.options=r,this.activeTool$=new b.X(void 0),this.toolbar$=new b.X([]),this.activeToolHistory=[],this.store=new it([],{getKey:t=>t.name}),this.setToolbar(r.toolbar),this.initStore()}get tools$(){return this.store.entities$}destroy(){this.activeTool$$.unsubscribe(),this.store.destroy()}getTool(r){return this.store.get(r)}getTools(){return this.store.all()}setTools(r){this.store.load(r)}getToolbar(){return this.toolbar$.getValue()}setToolbar(r){this.toolbar$.next(r||[])}activateTool(r,t={}){const o=this.getTool(r);void 0!==o&&this.store.state.update(o,{active:!0,options:t},!0)}activatePreviousTool(){if(this.activeToolHistory.length<=1)return void this.deactivateTool();const[r,t]=this.activeToolHistory.splice(-2,2);this.activateTool(r)}deactivateTool(){this.clearActiveToolHistory(),this.store.state.updateAll({active:!1})}initStore(){this.store=new it([],{getKey:r=>r.name}),this.activeTool$$=this.store.stateView.firstBy$(r=>!0===r.state.active).subscribe(r=>{if(void 0===r)return void this.setActiveTool(void 0);const t=r.entity,o=Object.assign({},t.options||{},r.state.options||{});this.setActiveTool(Object.assign({},t,{options:o}))})}setActiveTool(r){this.activeTool$.next(r),void 0===r?this.clearActiveToolHistory():this.activeToolHistory=this.activeToolHistory.filter(t=>t!==r.name).concat([r.name])}clearActiveToolHistory(){this.activeToolHistory=[]}}let Di=(()=>{class i{constructor(){this.toolbox=new ql,this.toolbox.setTools(this.getTools())}static register(t){i.tools[t.name]=t}getTool(t){return i.tools[t]}getTools(){return Object.values(i.tools)}}return i.tools={},i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function _m(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.startInteractiveTour())}),e.TgZ(1,"span",2),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"async"),e.qZA(),e._UZ(6,"mat-icon",3),e.ALo(7,"translate"),e.ALo(8,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngClass",t.getClass())("disabled",t.disabledTourButton),e.xp6(2),e.AsE("",e.lcZ(3,5,"igo.common.interactiveTour.buttonTitle")," ",e.lcZ(4,7,e.lcZ(5,9,t.discoverTitleInLocale$)),""),e.xp6(4),e.Q6J("matTooltip",t.disabledTourButton?e.lcZ(7,11,"igo.common.interactiveTour.disaledTooltipTourToolButton"):e.lcZ(8,13,"igo.common.interactiveTour.tooltipTourToolButton"))}}let Gl=(()=>{class i{constructor(t,o){this.interactiveTourService=t,this.toolService=o,this.tourToStart="",this.discoverTitleInLocale$=(0,X.of)("IGO")}getClass(){return{"tour-button-tool-icon":"icon"===this.styleButton,"tour-button-tool":"raised"===this.styleButton}}get toolbox(){return this.toolService.toolbox}getTourToStart(){return this.tourToStart?this.tourToStart:this.activeToolName}get activeToolName(){if(this.toolbox)return this.isActiveTool?this.toolbox.activeTool$.getValue().name:"global"}get isActiveTool(){if(this.toolbox)return void 0!==this.toolbox.activeTool$.getValue()}get isToolHaveTour(){return!("about"===this.activeToolName&&!this.tourToStart)&&this.interactiveTourService.isToolHaveTourConfig(this.getTourToStart())}get showTourButton(){let t,o;return t=this.isToolHaveTour,!1!==t&&!(this.interactiveTourService.isMobile()&&(o=this.isTourDisplayInMobile,!1===o))}get isTourDisplayInMobile(){return this.interactiveTourService.isTourDisplayInMobile()}get disabledTourButton(){return this.interactiveTourService.disabledTourButton(this.activeToolName)}startInteractiveTour(){const t=this.getTourToStart();t&&this.interactiveTourService.startTour(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(js),e.Y36(Di))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-interactive-tour"]],inputs:{tourToStart:"tourToStart",styleButton:"styleButton",discoverTitleInLocale$:"discoverTitleInLocale$"},decls:1,vars:1,consts:[["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click",4,"ngIf"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click"],[1,"interactive-tour-button-title"],["svgIcon","presentation-play",3,"matTooltip"]],template:function(t,o){1&t&&e.YNc(0,_m,9,15,"button",0),2&t&&e.Q6J("ngIf",o.showTourButton)},dependencies:[f.mk,f.O5,T.Hw,w.lW,O.gM,f.Ov,L.X$],styles:[".shepherd-has-title .shepherd-content .shepherd-header{padding:.5em .75em}.shepherd-title{margin:0!important;font-weight:revert!important}.shepherd-progress{margin-right:15px;color:#737373}.shepherd-text{font-size:14px!important}.shepherd-element{border:1px solid;border-color:#474747;box-shadow:4px 5px #65656599}\n"],encapsulation:2}),i})(),Ql=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[js,Nl],imports:[f.ez,T.Ps,w.ot,O.AV,oe]}),i})(),ci=(()=>{class i{transform(t,o){const n=[];return Object.getOwnPropertyNames(t).forEach(s=>n.push({key:s,value:t[s]})),n}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275pipe=e.Yjl({name:"keyvalue",type:i,pure:!0}),i})(),ki=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})(),Zt=(()=>{class i{constructor(t,o){this.renderer=t,this.el=o,this._color="primary",this._focused=!1,this._selected=!1,this._disabled=!1,this.beforeSelect=new e.vpe,this.beforeFocus=new e.vpe,this.beforeUnselect=new e.vpe,this.beforeUnfocus=new e.vpe,this.beforeDisable=new e.vpe,this.beforeEnable=new e.vpe,this.focus=new e.vpe,this.unfocus=new e.vpe,this.select=new e.vpe,this.unselect=new e.vpe,this.disable=new e.vpe,this.enable=new e.vpe}get color(){return this._color}set color(t){this._color=t}get focused(){return this._focused}set focused(t){t!==this._focused&&(this.disabled||(t?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=t,!0!==this.selected&&this.toggleFocusedClass(),t?this.focus.emit(this):this.unfocus.emit(this)))}get selected(){return this._selected}set selected(t){t!==this._selected&&(this.disabled||(t?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=t,this._focused=t,this.toggleSelectedClass(),t?this.select.emit(this):this.unselect.emit(this)))}get disabled(){return this._disabled}set disabled(t){t!==this._disabled&&(!0===t&&(this.selected=!1),t?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=t,this.toggleDisabledClass(),t?this.disable.emit(this):this.enable.emit(this))}onClick(){this.selected=!0}getOffsetTop(){return this.el.nativeElement.offsetTop-5}toggleFocusedClass(){this.focused?this.addCls(i.focusedCls):this.removeCls(i.focusedCls)}toggleSelectedClass(){this.selected?(this.addCls(i.selectedCls),this.removeCls(i.focusedCls)):this.removeCls(i.selectedCls)}toggleDisabledClass(){this.disabled?this.addCls(i.disabledCls):this.removeCls(i.disabledCls)}addCls(t){this.renderer.addClass(this.el.nativeElement,t)}removeCls(t){this.renderer.removeClass(this.el.nativeElement,t)}}return i.focusedCls="igo-list-item-focused",i.selectedCls="igo-list-item-selected",i.disabledCls="igo-list-item-disabled",i.\u0275fac=function(t){return new(t||i)(e.Y36(e.Qsj),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoListItem",""]],hostBindings:function(t,o){1&t&&e.NdJ("click",function(){return o.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"}}),i})();const Lm=function(i){return{selectable:i}},Im=["*"];let mo=(()=>{class i{constructor(t){this.el=t,this._navigation=!0,this._selection=!0,this.subscriptions=[]}get navigation(){return this._navigation}set navigation(t){this._navigation=t}get selection(){return this._selection}set selection(t){this._selection=t}get selectedItem(){return this._selectedItem}set selectedItem(t){this.focusedItem=t,this._selectedItem=t}get focusedItem(){return this._focusedItem}set focusedItem(t){this._focusedItem=t}handleKeyboardEvent(t){this.navigationEnabled&&("ArrowUp"===t.key||"ArrowDown"===t.key?(t.preventDefault(),this.navigate(t.key)):"Enter"===t.key&&this.select(this.focusedItem))}ngOnInit(){this.enableNavigation()}ngAfterViewInit(){this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(t=>this.init())}ngOnDestroy(){this.listItems$$.unsubscribe()}focus(t){!this.selection||(this.unfocus(),void 0!==t&&(t.focused=!0))}unfocus(){void 0!==this.focusedItem&&(this.focusedItem.focused=!1),this.focusedItem=void 0}focusNext(){const t=this.listItems.toArray();let o;const n=this.el.nativeElement;let s=!0,a=this.getFocusedIndex();for(void 0===a&&(a=-1);s&&a<t.length-1;)a+=1,o=t[a],s=o.disabled;void 0!==o&&this.focus(o),t[a+1]?void 0!==o&&!this.isScrolledIntoView(o.el.nativeElement)&&(n.scrollTop=o.el.nativeElement.offsetTop+o.el.nativeElement.children[0].offsetHeight-n.clientHeight):n.scrollTop=n.scrollHeight-n.clientHeight}focusPrevious(){const t=this.listItems.toArray();let o;const n=this.el.nativeElement;let s=!0,a=this.getFocusedIndex();for(;s&&a>0;)a-=1,o=t[a],s=o.disabled;void 0!==o&&this.focus(o),t[a-1]?void 0!==o&&!this.isScrolledIntoView(o.el.nativeElement)&&(n.scrollTop=o.el.nativeElement.offsetTop-3):n.scrollTop=0}select(t){!this.selection||(this.unselect(),void 0!==t&&(t.selected=!0))}unselect(){this.unfocus(),void 0!==this.selectedItem&&(this.selectedItem.selected=!1),this.selectedItem=void 0}enableNavigation(){this.navigation&&(this.navigationEnabled=!0)}disableNavigation(){this.navigationEnabled=!1}scrollToItem(t){this.el.nativeElement.scrollTop=t.getOffsetTop()}isScrolledIntoView(t){const o=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,s=t.offsetTop;return s+t.children[0].offsetHeight<=o+this.el.nativeElement.clientHeight&&s>=o}init(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}subscribe(){this.unsubscribe(),this.listItems.toArray().forEach(t=>{this.subscriptions.push(t.beforeSelect.subscribe(o=>this.handleItemBeforeSelect(o))),this.subscriptions.push(t.select.subscribe(o=>this.handleItemSelect(o))),this.subscriptions.push(t.beforeFocus.subscribe(o=>this.handleItemBeforeFocus(o))),this.subscriptions.push(t.focus.subscribe(o=>this.handleItemFocus(o)))},this)}unsubscribe(){this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[]}handleItemBeforeFocus(t){t!==this.focusedItem&&this.unfocus()}handleItemFocus(t){this.focusedItem=t}handleItemBeforeSelect(t){t!==this.focusedItem&&this.unselect()}handleItemSelect(t){this.selectedItem=t}findSelectedItem(){return this.listItems.toArray().find(t=>t.selected)}findFocusedItem(){return this.listItems.toArray().find(t=>t.focused)}getFocusedIndex(){return this.listItems.toArray().findIndex(t=>t===this.focusedItem)}navigate(t){switch(t){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext()}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.SBq))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-list"]],contentQueries:function(t,o,n){if(1&t&&e.Suo(n,Zt,5),2&t){let s;e.iGM(s=e.CRH())&&(o.listItems=s)}},hostBindings:function(t,o){1&t&&e.NdJ("keydown",function(s){return o.handleKeyboardEvent(s)},!1,e.evT)("enter",function(s){return o.handleKeyboardEvent(s)},!1,e.evT)},inputs:{navigation:"navigation",selection:"selection"},ngContentSelectors:Im,decls:2,vars:3,consts:[["igoClickout","",3,"ngClass","clickout","click"]],template:function(t,o){1&t&&(e.F$t(),e.TgZ(0,"mat-list",0),e.NdJ("clickout",function(){return o.disableNavigation()})("click",function(){return o.enableNavigation()}),e.Hsn(1),e.qZA()),2&t&&e.Q6J("ngClass",e.VKq(1,Lm,o.selection))},dependencies:[f.mk,G.i$,Rg],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]{position:static}[_nghost-%COMP%]     .mat-list .mat-list-item .mat-list-text>*{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-item-with-avatar .mat-list-item-content{display:-webkit-flex;height:46px;padding:3px}[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-item-with-avatar{height:46px}[_nghost-%COMP%]     .mat-list   igo-collapsible>.mat-list-item>.mat-list-item-content>.mat-list-text>.mat-line{font-weight:700;opacity:.9}[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-item-with-avatar .mat-list-item-content>mat-icon{padding:8px}[_nghost-%COMP%]     [igolistitem] mat-list-item [mat-list-avatar]{height:auto;width:40px}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}"]}),i})(),ui=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,T.Ps,G.ie,Bg]}),i})();const Om=function(i){return{"igo-cursor-pointer":i}};function Zm(i,r){if(1&i&&(e.TgZ(0,"div",2)(1,"h3"),e.Hsn(2,1),e.TgZ(3,"div",3),e._uU(4),e.Hsn(5,2),e.qZA(),e.Hsn(6,3),e.qZA()()),2&i){const t=e.oxw();e.Q6J("ngClass",e.VKq(2,Om,!0===t.cursorPointer)),e.xp6(4),e.hij(" ",t.title," ")}}const Dm=["*",[["","panelLeftButton",""]],[["","panelHeader",""]],[["","panelRightButton",""]]],km=["*","[panelLeftButton]","[panelHeader]","[panelRightButton]"];let Dt=(()=>{class i{constructor(){this._withHeader=!0,this.cursorPointer=!1}get withHeader(){return this._withHeader}set withHeader(t){this._withHeader=t}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-panel"]],hostVars:2,hostBindings:function(t,o){2&t&&e.ekj("igo-panel-with-header",o.withHeader)},inputs:{title:"title",withHeader:"withHeader",cursorPointer:"cursorPointer"},ngContentSelectors:km,decls:3,vars:1,consts:[["class","igo-panel-header mat-typography","title","",3,"ngClass",4,"ngIf"],["title","",1,"igo-panel-content"],["title","",1,"igo-panel-header","mat-typography",3,"ngClass"],[1,"igo-panel-title"]],template:function(t,o){1&t&&(e.F$t(Dm),e.YNc(0,Zm,7,4,"div",0),e.TgZ(1,"div",1),e.Hsn(2),e.qZA()),2&t&&e.Q6J("ngIf",o.withHeader)},dependencies:[f.mk,f.O5],styles:["[_nghost-%COMP%]{display:block}.igo-panel-header[_ngcontent-%COMP%]{height:46px;padding:3px;text-align:center}.igo-panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;height:40px}.igo-panel-header[_ngcontent-%COMP%]     [panelleftbutton]{float:left;margin-right:-40px}.igo-panel-header[_ngcontent-%COMP%]     [panelrightbutton]{float:right}.igo-panel-content[_ngcontent-%COMP%]{overflow:auto}.igo-cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}.igo-panel-with-header[_nghost-%COMP%]   .igo-panel-content[_ngcontent-%COMP%]{height:calc(100% - 46px)}[_nghost-%COMP%]:not(.igo-panel-with-header)   .igo-panel-content[_ngcontent-%COMP%]{height:100%}.igo-panel-title[_ngcontent-%COMP%]{display:block;width:calc(100% - 80px);margin-left:40px;height:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:40px;float:left;font-weight:700;font-size:1.17em}"],changeDetection:0}),i})(),Tt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez]}),i})();const Pm=function(i){return{"igo-spinner-container":!0,"igo-spinner-shown":i}};let br=(()=>{class i{constructor(){this.shown$=new b.X(!1)}set shown(t){this.shown$.next(t)}get shown(){return this.shown$.value}show(){this.shown=!0}hide(){this.shown=!1}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spinner"]],inputs:{shown:"shown"},decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e._UZ(2,"div",1)(3,"mat-progress-spinner",2),e.qZA()),2&t&&e.Q6J("ngClass",e.VKq(3,Pm,e.lcZ(1,1,o.shown$)))},dependencies:[f.mk,Ll.Ou,f.Ov],styles:[".igo-spinner-container[_ngcontent-%COMP%]{display:none;pointer-events:none}.igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}.igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}"]}),i})(),$m=(()=>{class i{constructor(t,o){this.spinner=t,this.activityService=o}ngOnInit(){this.counter$$=this.activityService.counter$.pipe((0,fe.b)(50)).subscribe(t=>{t>0?this.spinner.show():this.spinner.hide()})}ngOnDestroy(){this.counter$$.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(br,2),e.Y36(gn))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoSpinnerActivity",""]]}),i})(),Cr=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Ll.Cq]}),i})();class jl extends Ls.o2{constructor(r,t,o){super(),this._database=r,this._model=t,this._sort=o,this._filterChange=new b.X("")}get filter(){return this._filterChange.value}set filter(r){this._filterChange.next(r)}connect(){return this._database?(0,Ms.T)(this._database.dataChange,this._filterChange,this._sort.sortChange).pipe((0,Z.U)(()=>this.getFilteredData(this._database.data)),(0,Z.U)(t=>this.getSortedData(t))):(0,Ms.T)([])}disconnect(){}getFilteredData(r){return this.filter?r.slice().filter(t=>-1!==this._model.columns.filter(n=>n.filterable).map(n=>B.resolve(t,n.name)).join(" ").toLowerCase().indexOf(this.filter.toLowerCase())):r}getSortedData(r){return this._sort.active&&""!==this._sort.direction?r.sort((t,o)=>{const n=B.resolve(t,this._sort.active),s=B.resolve(o,this._sort.active);return B.naturalCompare(s,n,this._sort.direction)}):r}}var xn=(()=>{return(i=xn||(xn={}))[i.primary=0]="primary",i[i.accent=1]="accent",i[i.warn=2]="warn",xn;var i})();const Em=["filter"];function Jm(i,r){1&i&&(e.TgZ(0,"div",12)(1,"mat-form-field",13),e._UZ(2,"input",14,15),e.ALo(4,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.Q6J("placeholder",e.lcZ(4,1,"igo.common.table.filter")))}function Rm(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"th",16)(1,"mat-checkbox",17),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(n?s.masterToggle():null)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())}}function Bm(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td",18)(1,"mat-checkbox",19),e.NdJ("click",function(n){return n.stopPropagation()})("change",function(n){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(n?l.selection.toggle(a):null)}),e.qZA()()}if(2&i){const t=r.$implicit,o=e.oxw();e.xp6(1),e.Q6J("checked",o.selection.isSelected(t))}}function Um(i,r){if(1&i&&(e.TgZ(0,"th",25),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function Nm(i,r){1&i&&(e.ynx(0),e.YNc(1,Um,2,1,"th",24),e.BQk())}function qm(i,r){if(1&i&&(e.TgZ(0,"th",16),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function Gm(i,r){1&i&&(e.ynx(0),e.YNc(1,qm,2,1,"th",6),e.BQk())}const Ys=function(){return{}};function Qm(i,r){if(1&i&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&i){const t=r.$implicit,o=e.oxw(2).$implicit,n=e.oxw();e.Q6J("ngClass",n.model.cellClassFunc?n.model.cellClassFunc(t,o):e.DdM(2,Ys)),e.xp6(1),e.hij(" ",n.getValue(t,o.name)," ")}}function jm(i,r){1&i&&(e.ynx(0),e.YNc(1,Qm,2,3,"td",26),e.BQk())}function Ym(i,r){if(1&i&&e._UZ(0,"td",29),2&i){const t=r.$implicit,o=e.oxw(2).$implicit,n=e.oxw();e.Q6J("ngClass",n.model.cellClassFunc?n.model.cellClassFunc(t,o):e.DdM(2,Ys))("innerHTML",n.getValue(t,o.name),e.oJD)}}function Hm(i,r){1&i&&e.YNc(0,Ym,1,3,"td",28)}function Vm(i,r){if(1&i&&(e.ynx(0,20),e.YNc(1,Nm,2,0,"ng-container",21),e.YNc(2,Gm,2,0,"ng-container",21),e.YNc(3,jm,2,0,"ng-container",22),e.YNc(4,Hm,1,0,"ng-template",null,23,e.W1O),e.BQk()),2&i){const t=r.$implicit,o=e.MAs(5);e.Q6J("matColumnDef",t.name),e.xp6(1),e.Q6J("ngIf",t.sortable),e.xp6(1),e.Q6J("ngIf",!t.sortable),e.xp6(1),e.Q6J("ngIf",!t.html)("ngIfElse",o)}}function zm(i,r){1&i&&e._UZ(0,"th",16)}function Wm(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(n){const a=e.CHM(t).$implicit,l=e.oxw().$implicit,c=e.oxw();return e.KtG(c.handleClickAction(n,a,l))}),e._UZ(1,"mat-icon",32),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(2);e.Q6J("color",o.getActionColor(t.color)),e.xp6(1),e.s9C("svgIcon",t.icon)}}function Km(i,r){if(1&i&&(e.TgZ(0,"td",18),e.YNc(1,Wm,2,2,"button",30),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.model.actions)}}function Xm(i,r){1&i&&e._UZ(0,"tr",33)}function eh(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"tr",34),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.selection.toggle(s))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw();e.Q6J("ngClass",o.model.rowClassFunc?o.model.rowClassFunc(t):e.DdM(1,Ys))}}let th=(()=>{class i{constructor(){this._hasFIlterInput=!0,this.selection=new Ls.Ov(!0,[]),this.select=new e.vpe}get database(){return this._database}set database(t){this._database=t}get model(){return this._model}set model(t){this._model=t}get hasFilterInput(){return this._hasFIlterInput}set hasFilterInput(t){this._hasFIlterInput=t}ngOnInit(){this.dataSource=new jl(this.database,this.model,this.sort),this.model&&(this.displayedColumns=this.model.columns.filter(t=>!1!==t.displayed).map(t=>t.name),this.model.selectionCheckbox&&this.displayedColumns.unshift("selectionCheckbox"),this.model.actions&&this.model.actions.length&&this.displayedColumns.push("action")),this.selection.changed.subscribe(t=>this.select.emit(t))}ngAfterViewInit(){this.filter&&(0,lo.R)(this.filter.nativeElement,"keyup").pipe((0,fe.b)(150),(0,ei.x)()).subscribe(()=>{!this.dataSource||(this.dataSource.filter=this.filter.nativeElement.value)})}ngOnChanges(t){t.database&&(this.dataSource=new jl(this.database,this.model,this.sort),this.selection.clear())}getActionColor(t){return xn[t]}getValue(t,o){return B.resolve(t,o)}isAllSelected(){return this.selection.selected.length===this.database.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.database.data.forEach(t=>this.selection.select(t))}handleClickAction(t,o,n){t.stopPropagation(),o.click(n)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-table"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Em,5),e.Gf(si.YE,7)),2&t){let n;e.iGM(n=e.CRH())&&(o.filter=n.first),e.iGM(n=e.CRH())&&(o.sort=n.first)}},inputs:{database:"database",model:"model",hasFilterInput:"hasFilterInput"},outputs:{select:"select"},features:[e.TTD],decls:14,vars:5,consts:[[1,"table-box"],["class","table-header",4,"ngIf"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["table",""],["matColumnDef","selectionCheckbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[1,"table-header"],["floatPlaceholder","never"],["matInput","",3,"placeholder"],["filter",""],["mat-header-cell",""],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","click","change"],[3,"matColumnDef"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["cellHTML",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-mini-fab","",3,"color","click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"color","click"],[3,"svgIcon"],["mat-header-row",""],["mat-row","",3,"ngClass","click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Jm,5,3,"div",1),e.TgZ(2,"div",2)(3,"table",3,4),e.ynx(5,5),e.YNc(6,Rm,2,2,"th",6),e.YNc(7,Bm,2,1,"td",7),e.BQk(),e.YNc(8,Vm,6,5,"ng-container",8),e.ynx(9,9),e.YNc(10,zm,1,0,"th",6),e.YNc(11,Km,2,1,"td",7),e.BQk(),e.YNc(12,Xm,1,0,"tr",10),e.YNc(13,eh,1,2,"tr",11),e.qZA()()()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.hasFilterInput),e.xp6(2),e.Q6J("dataSource",o.dataSource),e.xp6(5),e.Q6J("ngForOf",o.model.columns),e.xp6(4),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns))},dependencies:[f.mk,f.sg,f.O5,T.Hw,w.lW,we.BZ,we.fO,we.as,we.w1,we.Dz,we.nj,we.ge,we.ev,we.XQ,we.Gk,I.KE,H.Nt,si.YE,si.nU,Ge.oG,L.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.table-box[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.table-header[_ngcontent-%COMP%]{min-height:64px;max-width:500px;display:flex;flex:0 1 auto;align-items:baseline;padding:8px 24px 0;font-size:20px;justify-content:space-between}tr[mat-header-row][_ngcontent-%COMP%], tr[mat-row][_ngcontent-%COMP%]{height:60px}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}td[mat-cell][_ngcontent-%COMP%]{padding-right:15px}th.mat-header-cell[_ngcontent-%COMP%]{padding-right:5px}button[_ngcontent-%COMP%]{margin-right:10px}"]}),i})(),oh=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,hd.HT,T.Ps,w.ot,we.p0,I.lN,H.c,si.JX,Ge.p9,oe]}),i})();class Eo extends it{}var Pi=(()=>{return(i=Pi||(Pi={})).White="white",i.Grey="grey",i.Primary="primary",Pi;var i})();function ih(i="300ms",r="ease-in-out"){return(0,ae.X$)("toolSlideInOut",[(0,ae.SB)("enter",(0,ae.oB)({transform:"translate3d(0, 0, 0)"})),(0,ae.eR)("void => enter",(0,ae.jt)(i+" "+r))])}function nh(i,r){if(1&i&&(e._UZ(0,"igo-actionbar",2),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async")),2&i){const t=e.oxw();e.Q6J("store",t.actionStore)("withIcon",!0)("withTitle",e.lcZ(1,6,t.toolbarWithTitle$))("withTooltip",!1===e.lcZ(2,8,t.toolbarWithTitle$))("scrollActive",e.lcZ(3,10,t.toolbarWithTitle$))("horizontal",!1)}}const rh=function(i,r){return{"igo-tool-container-with-toolbar":i,"igo-tool-container-with-animation":r}};function sh(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",3),e.NdJ("@toolSlideInOut.start",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onAnimationStart())})("@toolSlideInOut.done",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onAnimationComplete())}),e.ALo(1,"async"),e._UZ(2,"igo-dynamic-outlet",4),e.qZA()}if(2&i){const t=r.ngIf,o=e.oxw();e.Q6J("ngClass",e.WLB(6,rh,!o.actionStore.empty,o.animate))("@toolSlideInOut",e.lcZ(1,4,o.animation$)),e.xp6(2),e.Q6J("component",t.component)("inputs",o.getToolInputs(t))}}let ah=(()=>{class i{constructor(){this.activeTool$=new b.X(void 0),this.actionStore=new Eo([]),this.animation$=new b.X("none"),this.toolbar$=new b.X([]),this.toolbarWithTitle$=this.activeTool$.pipe((0,Z.U)(t=>void 0===t)),this.animating$=new b.X(!1),this.animate=!1,this.color=Pi.White}get classColorGrey(){return this.color===Pi.Grey}get classColorPrimary(){return this.color===Pi.Primary}ngOnInit(){this.toolbar$$=this.toolbox.toolbar$.subscribe(t=>this.onToolbarChange(t)),this.activeTool$$=this.toolbox.activeTool$.subscribe(t=>this.onActiveToolChange(t))}ngOnDestroy(){this.toolbar$$.unsubscribe(),this.activeTool$$.unsubscribe(),this.actionStore.destroy()}onAnimationStart(){this.animating$.next(!0)}onAnimationComplete(){this.animating$.next(!1)}getToolInputs(t){return t.options||{}}onToolbarChange(t){this.setToolbar(t)}onActiveToolChange(t){this.animate?this.onAnimate(()=>this.setActiveTool(t)):this.setActiveTool(t)}setActiveTool(t){if(void 0===t)this.actionStore.state.updateAll({active:!1});else{const o=this.actionStore.get(t.name);void 0!==o&&this.actionStore.state.update(o,{active:!0},!0)}this.activeTool$.next(t),this.animate&&this.animation$.next("enter")}setToolbar(t){const o=t.reduce((n,s)=>{const a=this.toolbox.getTool(s);return void 0===a||n.push({id:a.name,title:a.title,icon:a.icon,tooltip:a.tooltip,args:[a,this.toolbox],handler:(l,c)=>{c.activateTool(l.name)},ngClass:(l,c)=>this.toolbox.activeTool$.pipe((0,Z.U)(u=>{let p=!1;void 0!==u&&l.name===u.name&&(p=!0);let d=!1;return void 0!==u&&l.name===u.parent&&(d=!0),{"tool-activated":p,"children-tool-activated":d}}))}),n},[]);this.actionStore.load(o),this.toolbar$.next(t)}onAnimate(t){this.unAnimate(),this.animating$$=this.animating$.subscribe(o=>{o||(t.call(this),this.unAnimate())})}unAnimate(){this.animating$$&&this.animating$$.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-toolbox"]],hostVars:4,hostBindings:function(t,o){2&t&&e.ekj("color-grey",o.classColorGrey)("color-primary",o.classColorPrimary)},inputs:{toolbox:"toolbox",animate:"animate",color:"color"},decls:4,vars:6,consts:[[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal",4,"ngIf"],["class","igo-tool-container",3,"ngClass",4,"ngIf"],[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal"],[1,"igo-tool-container",3,"ngClass"],[3,"component","inputs"]],template:function(t,o){1&t&&(e.YNc(0,nh,4,12,"igo-actionbar",0),e.ALo(1,"async"),e.YNc(2,sh,3,9,"div",1),e.ALo(3,"async")),2&t&&(e.Q6J("ngIf",e.lcZ(1,2,o.toolbar$).length>0),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,o.activeTool$)))},dependencies:[f.mk,f.O5,vn,mr,f.Ov],styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden;width:100%;height:100%}.igo-tool-container[_ngcontent-%COMP%]{position:absolute;inset:0}.igo-tool-container-with-animation[_ngcontent-%COMP%]{transform:translate3d(100%,0,0)}.igo-tool-container-with-toolbar[_ngcontent-%COMP%]{left:50px}igo-actionbar[_ngcontent-%COMP%]{height:100%}igo-actionbar.with-title[_ngcontent-%COMP%]{width:100%;overflow:auto}igo-actionbar[_ngcontent-%COMP%]:not(.with-title){width:48px;overflow:hidden;-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){igo-actionbar[_ngcontent-%COMP%]:not(.with-title){overflow:auto}}igo-dynamic-outlet[_ngcontent-%COMP%]{overflow:auto}"],data:{animation:[ih()]},changeDetection:0}),i})(),lh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Os,Es]}),i})(),ch=(()=>{class i{static forRoot(){return{ngModule:i,providers:[Di]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,lh]}),i})();function uh(i,r){if(1&i&&e._UZ(0,"igo-dynamic-outlet",1),2&i){const t=e.oxw();e.Q6J("component",t.widget)("inputs",t.inputs)("subscribers",t.getEffectiveSubscribers())}}let Yl=(()=>{class i{constructor(){this.baseSubscribers={cancel:t=>this.onCancel(t),complete:t=>this.onComplete(t)},this.subscribers={},this.complete=new e.vpe,this.cancel=new e.vpe}ngOnDestroy(){this.destroyWidget()}getEffectiveSubscribers(){const t=Object.assign({},this.subscribers);return Object.keys(this.baseSubscribers).forEach(o=>{const n=t[o],s=this.baseSubscribers[o];t[o]=void 0!==n?a=>{n(a),s(a)}:s}),t}onCancel(t){this.cancel.emit(t),this.destroyWidget()}onComplete(t){this.complete.emit(t),this.destroyWidget()}destroyWidget(){void 0!==this.widget&&this.widget.destroy(),this.widget=void 0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-widget-outlet"]],inputs:{widget:"widget",inputs:"inputs",subscribers:"subscribers"},outputs:{complete:"complete",cancel:"cancel"},decls:1,vars:1,consts:[[3,"component","inputs","subscribers",4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(t,o){1&t&&e.YNc(0,uh,1,3,"igo-dynamic-outlet",0),2&t&&e.Q6J("ngIf",o.widget)},dependencies:[f.O5,mr],styles:["igo-dynamic-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0}),i})(),Hs=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Es]}),i})(),Vs=(()=>{class i{constructor(t){this.dynamicComponentService=t}create(t){return this.dynamicComponentService.create(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Ps))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Hl=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Vs],imports:[f.ez,Hs,Hs]}),i})(),Vl=(()=>{class i{constructor(){this.selectedChange=new e.vpe}getWorkspaceTitle(t){return Yt(t)}onSelectedChange(t){const o=t.value;this.store.activateWorkspace(o),this.selectedChange.emit({selected:!0,value:o})}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},decls:1,vars:4,consts:[[3,"store","multi","titleAccessor","disabled","selectedChange"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-entity-selector",0),e.NdJ("selectedChange",function(s){return o.onSelectedChange(s)}),e.qZA()),2&t&&e.Q6J("store",o.store)("multi",!1)("titleAccessor",o.getWorkspaceTitle)("disabled",o.disabled)},dependencies:[Zl],styles:["igo-entity-selector[_ngcontent-%COMP%]     mat-form-field .mat-form-field-infix{padding:0}igo-entity-selector[_ngcontent-%COMP%]     mat-form-field .mat-form-field-wrapper{padding-bottom:1.75em}"],changeDetection:0}),i})(),ph=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,qs]}),i})();function dh(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-widget-outlet",1),e.NdJ("cancel",function(){const s=e.CHM(t).ngIf,a=e.oxw();return e.KtG(a.onWidgetCancel(s))})("complete",function(){const s=e.CHM(t).ngIf,a=e.oxw();return e.KtG(a.onWidgetComplete(s))}),e.ALo(2,"async"),e.ALo(3,"async"),e.qZA(),e.BQk()}if(2&i){const t=r.ngIf,o=e.oxw();e.xp6(1),e.Q6J("widget",t)("inputs",e.lcZ(2,3,o.widgetInputs$))("subscribers",e.lcZ(3,5,o.widgetSubscribers$))}}let gh=(()=>{class i{constructor(){this.deactivateWidget=new e.vpe}get widget$(){return this.workspace.widget$}get widgetInputs$(){return this.workspace.widgetInputs$}get widgetSubscribers$(){return this.workspace.widgetSubscribers$}onWidgetCancel(t){this.workspace.deactivateWidget(),this.deactivateWidget.emit(t)}onWidgetComplete(t){this.workspace.deactivateWidget(),this.deactivateWidget.emit(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},decls:2,vars:3,consts:[[4,"ngIf"],[3,"widget","inputs","subscribers","cancel","complete"]],template:function(t,o){1&t&&(e.YNc(0,dh,4,7,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.widget$))},dependencies:[f.O5,Yl,f.Ov],styles:["igo-widget-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0}),i})(),mh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Hs]}),i})(),hh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,ph,mh]}),i})();class fh{constructor(r){this.dataChange=new b.X([]),r&&this.dataChange.next(r)}get data(){return this.dataChange.value}set(r){this.dataChange.next(r)}add(r){const t=this.data.slice();t.push(r),this.set(t)}remove(r){const t=this.data.slice(),o=t.indexOf(r);t.splice(o,1),this.set(t)}}function ke(i){return r=>{Di.register(Object.assign({},i,{component:r}))}}class zl extends it{constructor(){super(...arguments),this.activeWorkspace$=new b.X(void 0)}activateWorkspace(r){const t=this.activeWorkspace$.value;void 0!==t&&t.deactivate(),this.deactivateWorkspace(),void 0!==r&&(this.state.update(r,{active:!0,selected:!0},!0),this.activeWorkspace$.next(r),r.activate())}deactivateWorkspace(){const r=this.activeWorkspace$.value;void 0!==r&&(r.deactivate(),this.activeWorkspace$.next(void 0))}}class zs{constructor(r){this.options=r,this.widget$=new b.X(void 0),this.widgetInputs$=new b.X({}),this.widgetSubscribers$=new b.X({}),this.change=new Se.x,this.active$=new b.X(!1)}get id(){return this.options.id}get title(){return this.options.title}get meta(){return this.options.meta||{}}get entityStore(){return this.options.entityStore}get actionStore(){return this.options.actionStore}get widget(){return this.widget$.value}get hasWidget(){return void 0!==this.widget}get active(){return this.active$.value}activate(){!0===this.active&&this.deactivate(),this.active$.next(!0),void 0!==this.entityStore&&(this.entities$$=this.entityStore.stateView.all$().subscribe(()=>this.onStateChange())),this.change.next()}deactivate(){this.active$.next(!1),this.deactivateWidget(),void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.change$&&this.change$.unsubscribe()}activateWidget(r,t={},o={}){this.widget$.next(r),this.widgetInputs$.next(t),this.widgetSubscribers$.next(o),this.change.next()}deactivateWidget(){this.widget$.next(void 0),this.change.next()}onStateChange(){this.change.next()}}const yh=te.Bz.forChild([{path:"home",component:(()=>{class i{constructor(t){this.interactiveTourService=t}startTour(){this.interactiveTourService.startTour("global")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(js))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-home"]],decls:56,vars:0,consts:[[2,"text-align","center"],["id","igo-title"],["width","180","src","assets/igo2/core/logo.png",1,"igo-logo"],["tourToStart","global","menuIsOpen","true","styleButton","raised"],["target","_blank","rel","noopener","href","https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation"],["target","_blank","rel","noopener","href","https://angular.io/docs"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2," Welcome to IGO "),e.qZA(),e._UZ(3,"img",2),e.qZA(),e.TgZ(4,"p"),e._UZ(5,"igo-interactive-tour",3),e.qZA(),e.TgZ(6,"p"),e._uU(7," IGO2 library contains many components and services that may benefit any web application. "),e._UZ(8,"br"),e._uU(9," IGO2 library is open source project using Angular, Angular Material and OpenLayers.\n"),e.qZA(),e.TgZ(10,"h3"),e._uU(11,"IGO2 library is divided into several elements: "),e.qZA(),e.TgZ(12,"ul")(13,"li")(14,"b"),e._uU(15,"@igo2/utils"),e.qZA(),e._uU(16," : Basic utilies without dependency (ex: base64, clipboard, uuid)"),e.qZA(),e.TgZ(17,"li")(18,"b"),e._uU(19,"@igo2/core"),e.qZA(),e._uU(20," : Element affecting the core of the application (ex: config, language, message, media, request)"),e.qZA(),e.TgZ(21,"li")(22,"b"),e._uU(23,"@igo2/common"),e.qZA(),e._uU(24," : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table)"),e.qZA(),e.TgZ(25,"li")(26,"b"),e._uU(27,"@igo2/auth"),e.qZA(),e._uU(28," : Library grouping the authentication and security module"),e.qZA(),e.TgZ(29,"li")(30,"b"),e._uU(31,"@igo2/geo"),e.qZA(),e._uU(32," : Library containing the geomatic components. Depends on Openlayers."),e.qZA(),e.TgZ(33,"li")(34,"b"),e._uU(35,"@igo2/context"),e.qZA(),e._uU(36," : Library of components uniting @igo2/geo and @igo2/auth"),e.qZA(),e.TgZ(37,"li")(38,"b"),e._uU(39,"@igo2/integration"),e.qZA(),e._uU(40," : Library integrate basic components"),e.qZA()(),e.TgZ(41,"h2"),e._uU(42,"Here are some links to help you start: "),e.qZA(),e.TgZ(43,"ul")(44,"li")(45,"h2")(46,"a",4),e._uU(47,"Installation"),e.qZA()()(),e.TgZ(48,"li")(49,"h2")(50,"a",5),e._uU(51,"Angular Documentation"),e.qZA()()()(),e._uU(52," *** Modules in "),e.TgZ(53,"code"),e._uU(54,"@igo2/core"),e.qZA(),e._uU(55," must be imported only once\n"))},dependencies:[Gl]}),i})()}]);let vh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[yh,Ql,O.AV,T.Ps,w.ot]}),i})();const Ch=te.Bz.forChild([{path:"activity",component:(()=>{class i{constructor(t){this.activityService=t,this.idsActivity=[]}register(){this.idsActivity.push(this.activityService.register())}unregister(){this.activityService.unregister(this.idsActivity.pop())}get counter(){return this.activityService.counter$.value}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(gn))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-activity"]],decls:31,vars:1,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/activity"],["mat-raised-button","",3,"click"],["igoSpinnerActivity",""]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Activity"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Register activities in service. Use to display a loading icon"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoActivityModule"),e.qZA(),e._uU(12," only if you want register http calls"),e.qZA(),e.TgZ(13,"li"),e._uU(14,"Import "),e.TgZ(15,"code"),e._uU(16,"IgoActivityModule"),e.qZA(),e._uU(17," only once"),e.qZA(),e._UZ(18,"br"),e._uU(19," See the "),e.TgZ(20,"a",0),e._uU(21," code of this example"),e.qZA(),e._UZ(22,"hr"),e.qZA(),e.TgZ(23,"mat-card-actions")(24,"button",1),e.NdJ("click",function(){return o.register()}),e._uU(25,"Register"),e.qZA(),e.TgZ(26,"button",1),e.NdJ("click",function(){return o.unregister()}),e._uU(27,"Unregister"),e.qZA()(),e.TgZ(28,"p"),e._uU(29),e.qZA(),e._UZ(30,"igo-spinner",2),e.qZA()),2&t&&(e.xp6(29),e.hij("Counter: ",o.counter,""))},dependencies:[x.a8,x.dn,x.n5,x.$j,x.hq,w.lW,$m,br]}),i})()}]);let xh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Ch,x.QW,w.ot,bs.forRoot(),Cr]}),i})();const Ws={production:!0,igo:{projections:[{code:"EPSG:32198",alias:"Quebec Lambert",def:"+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",extent:[-886251.0296,180252.9126,897177.3418,2106143.8139]}],auth:{intern:{enabled:!0},allowAnonymous:!0},interactiveTour:{tourInMobile:!0},importExport:{url:"https://geoegl.msp.gouv.qc.ca/apis/ogre"},language:{prefix:"./locale/"},catalog:{sources:[{id:"Gououvert",title:"Gouvouvert",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi"},{id:"DefiningInfoFormat",title:"Defining info_format",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryFormat:{html:"*","application/json":["stations_meteoroutieres","histo_stations_meteoroutieres"]},queryHtmlTarget:"iframe",count:30},{id:"catalogwithregex",title:"Filtered catalog by regex",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",regFilters:["zpegt"]},{id:"catalogwithtooltipcontrol",title:"Controling tooltip format",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",tooltipType:"abstract"}]},searchSources:{storedqueriesreverse:{enabled:!1},nominatim:{enabled:!1},icherche:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",order:2,enabled:!0,params:{limit:"8"}},coordinatesreverse:{showInPointerSummary:!0},icherchereverse:{showInPointerSummary:!0,searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",order:3,enabled:!0},ilayer:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",order:4,enabled:!0,params:{limit:"5"}}}}},wh=te.Bz.forChild([{path:"config",component:(()=>{class i{constructor(t){this.configService=t,this.configLanguage=this.configService.getConfig("language")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(J))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-config"]],decls:26,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/config"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"config"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Load config in your angular application"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoConfigModule"),e.qZA(),e._uU(12," only once"),e.qZA(),e._UZ(13,"br"),e._uU(14," See the "),e.TgZ(15,"a",0),e._uU(16," code of this example"),e.qZA(),e._UZ(17,"br"),e._uU(18," See the "),e.TgZ(19,"a",1),e._uU(20," environment config"),e.qZA(),e._UZ(21,"hr"),e.qZA(),e.TgZ(22,"p"),e._uU(23),e.ALo(24,"json"),e.qZA(),e._UZ(25,"p"),e.qZA()),2&t&&(e.xp6(23),e.hij("Config language: ",e.lcZ(24,1,o.configLanguage),""))},dependencies:[x.a8,x.dn,x.n5,x.$j,f.Ts]}),i})()}]);let Th=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Cs({default:Ws.igo})],imports:[wh,f.ez,x.QW,w.ot,sr.forRoot()]}),i})();const Fh=te.Bz.forChild([{path:"language",component:(()=>{class i{constructor(t){this.languageService=t,this.app={title:"IGO"}}changeLanguage(t){this.languageService.setLanguage(t),console.log(this.languageService)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-language"]],decls:35,vars:4,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/language"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale"],["mat-raised-button","",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"language"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Translate your angular application"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoLanguageModule"),e.qZA(),e._uU(12," only once"),e.qZA(),e._UZ(13,"br"),e._uU(14," See the "),e.TgZ(15,"a",0),e._uU(16,"code of this example"),e.qZA(),e._UZ(17,"br"),e._uU(18," See language section of the "),e.TgZ(19,"a",1),e._uU(20," environment config"),e.qZA(),e._UZ(21,"br"),e._uU(22," See "),e.TgZ(23,"a",2),e._uU(24,"locale files"),e.qZA(),e._UZ(25,"hr"),e.qZA(),e.TgZ(26,"mat-card-actions")(27,"button",3),e.NdJ("click",function(){return o.changeLanguage("en")}),e._uU(28,"English"),e.qZA(),e.TgZ(29,"button",3),e.NdJ("click",function(){return o.changeLanguage("fr")}),e._uU(30,"Fran\xe7ais"),e.qZA()(),e.TgZ(31,"p"),e._uU(32),e.ALo(33,"translate"),e.qZA(),e._UZ(34,"p"),e.qZA()),2&t&&(e.xp6(32),e.Oqu(e.xi3(33,1,"welcome",o.app)))},dependencies:[x.a8,x.dn,x.n5,x.$j,x.hq,w.lW,L.X$]}),i})()}]);let Ah=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Fh,x.QW,w.ot,oe.forRoot()]}),i})();const Ih=te.Bz.forChild([{path:"media",component:(()=>{class i{constructor(t){this.mediaService=t}get media(){return this.mediaService.getMedia()}get orientation(){return this.mediaService.getOrientation()}get isTouchScreen(){return this.mediaService.isTouchScreen()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(gt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-media"]],decls:19,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/media"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Media"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Detect type of media (mobile, tablet, desktop)"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"p"),e._uU(14),e.qZA(),e.TgZ(15,"p"),e._uU(16),e.qZA(),e.TgZ(17,"p"),e._uU(18),e.qZA()()),2&t&&(e.xp6(14),e.hij("Current media: ",o.media,""),e.xp6(2),e.hij("Current orientation: ",o.orientation,""),e.xp6(2),e.hij("Device mode: ",o.isTouchScreen?"Touch device":"Not a touch device ",""))},dependencies:[x.a8,x.dn,x.n5,x.$j]}),i})()}]);let Oh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Ih,x.QW]}),i})();const Dh=te.Bz.forChild([{path:"message",component:(()=>{class i{constructor(t){this.messageService=t}success(){this.messageService.success("Congratulations","Success")}info(){this.messageService.info("Welcome to IGO","Info")}alert(){this.messageService.alert("Warning","Alert")}error(){this.messageService.error("There is a bug","Error")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_e))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-message"]],decls:29,vars:0,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/message"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Message"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Show message to user."),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoMessageModule"),e.qZA(),e._uU(12," only once"),e.qZA(),e.TgZ(13,"li"),e._uU(14,"Dependencies: BrowserAnimationsModule "),e.qZA(),e._UZ(15,"br"),e._uU(16," See the "),e.TgZ(17,"a",0),e._uU(18,"code of this example"),e.qZA(),e._UZ(19,"hr"),e.qZA(),e.TgZ(20,"mat-card-actions")(21,"button",1),e.NdJ("click",function(){return o.success()}),e._uU(22,"Success message"),e.qZA(),e.TgZ(23,"button",2),e.NdJ("click",function(){return o.info()}),e._uU(24,"Info message"),e.qZA(),e.TgZ(25,"button",3),e.NdJ("click",function(){return o.alert()}),e._uU(26,"Alert message"),e.qZA(),e.TgZ(27,"button",4),e.NdJ("click",function(){return o.error()}),e._uU(28,"Error message"),e.qZA()()())},dependencies:[x.a8,x.dn,x.n5,x.$j,x.hq,w.lW]}),i})()}]);let kh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Dh,x.QW,w.ot,wo.forRoot()]}),i})();const $h=te.Bz.forChild([{path:"request",component:(()=>{class i{constructor(t,o){this.http=t,this.languageService=o}callHttp(){this.http.get("https://geoegl.msp.gouv.qc.ca/apis/icherche/info").subscribe(o=>{console.log(o)})}callHttpError(){this.http.get("404").subscribe(o=>{console.log(o)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(q.eN),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-request"]],decls:30,vars:0,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/request"],["mat-raised-button","",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Request"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Register http calls in console"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoLoggingModule"),e.qZA(),e._uU(12," only if you want register http calls in console"),e.qZA(),e.TgZ(13,"li"),e._uU(14,"Import "),e.TgZ(15,"code"),e._uU(16,"IgoErrorModule"),e.qZA(),e._uU(17," only if you want register errors from http call in console"),e.qZA(),e.TgZ(18,"li"),e._uU(19,"Import modules only once"),e.qZA(),e._UZ(20,"br"),e._uU(21," See the "),e.TgZ(22,"a",0),e._uU(23,"code of this example"),e.qZA(),e._UZ(24,"hr"),e.qZA(),e.TgZ(25,"mat-card-actions")(26,"button",1),e.NdJ("click",function(){return o.callHttp()}),e._uU(27,"Log"),e.qZA(),e.TgZ(28,"button",1),e.NdJ("click",function(){return o.callHttpError()}),e._uU(29,"Error"),e.qZA()()())},dependencies:[x.a8,x.dn,x.n5,x.$j,x.hq,w.lW]}),i})()}]);let Eh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[$h,x.QW,w.ot,q.JF,oe.forRoot(),xs.forRoot()]}),i})();function Jh(i,r){if(1&i&&e._UZ(0,"igo-actionbar",4),2&i){const t=e.oxw();e.Q6J("store",t.store)("withIcon",!0)("horizontal",!0)("mode","context")}}const Bh=te.Bz.forChild([{path:"action",component:(()=>{class i{constructor(t,o,n){this.overlay=t,this.mediaService=o,this.languageService=n,this.store=new Eo([]),this.added$=new b.X(!1)}get actionbarMode(){return this.mediaService.media$.value===Et.Desktop&&this.mediaService.orientation$.value===po.Landscape?Mo.Dock:Mo.Overlay}ngOnInit(){this.store.load([{id:"add",title:"Add",icon:"plus",tooltip:"Add Tooltip",handler:()=>{alert("Add!"),this.added$.next(!0)}},{id:"edit",title:"Edit",icon:"pencil",tooltip:"Edit Tooltip",args:["1"],handler:t=>{alert(`Edit item ${t}!`)},availability:()=>this.added$},{id:"delete",title:"Delete",tooltip:"Delete Tooltip",icon:"delete",handler:()=>{alert("Delete!"),this.added$.next(!1)},availability:()=>this.added$}])}ngOnDestroy(){this.store.destroy()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(As.aV),e.Y36(gt),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-action"]],decls:19,vars:6,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/action"],[3,"store","withIcon","withTitle","horizontal","mode"],[3,"igoContextMenu"],["actionbarMenu",""],[3,"store","withIcon","horizontal","mode"]],template:function(t,o){if(1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Action"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e._UZ(9,"igo-actionbar",1),e.qZA(),e._UZ(10,"p"),e.TgZ(11,"mat-card",2)(12,"mat-card-subtitle"),e._uU(13,"Common"),e.qZA(),e.TgZ(14,"mat-card-title"),e._uU(15,"Action context-menu"),e.qZA(),e._UZ(16,"div"),e.qZA(),e.YNc(17,Jh,1,4,"ng-template",null,3,e.W1O)),2&t){const n=e.MAs(18);e.xp6(9),e.Q6J("store",o.store)("withIcon",!0)("withTitle","overlay"===o.actionbarMode)("horizontal",!0)("mode",o.actionbarMode),e.xp6(2),e.Q6J("igoContextMenu",n)}},dependencies:[x.a8,x.dn,x.n5,x.$j,vn,Pl],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Uh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Bh,w.ot,x.QW,Os,$l]}),i})(),Ks=(()=>{class i{constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-salutation-component"]],inputs:{name:"name"},decls:2,vars:1,template:function(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&t&&(e.xp6(1),e.hij("Hello, my name is ",o.name,"."))},encapsulation:2,changeDetection:0}),i})(),Nh=(()=>{class i{constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-explanation-component"]],decls:2,vars:0,template:function(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"I am a dynamic component, rendered into an IgoDynamicOutlet."),e.qZA())},encapsulation:2,changeDetection:0}),i})();const Gh=te.Bz.forChild([{path:"dynamic-component",component:(()=>{class i{constructor(){this.component=Ks,this.inputs={name:"Bob"}}toggleComponent(){this.component=this.component===Ks?Nh:Ks}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-dynamic-component"]],decls:12,vars:2,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/dynamic-component"],[3,"component","inputs"],["mat-flat-button","","color","primary",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Dynamic Component"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e._UZ(9,"igo-dynamic-outlet",1),e.TgZ(10,"button",2),e.NdJ("click",function(){return o.toggleComponent()}),e._uU(11,"Toggle Component"),e.qZA()()),2&t&&(e.xp6(9),e.Q6J("component",o.component)("inputs",o.inputs))},dependencies:[w.lW,x.a8,x.dn,x.n5,x.$j,mr],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Qh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Gh,w.ot,x.QW,Es]}),i})();const Yh=te.Bz.forChild([{path:"entity-table",component:(()=>{class i{constructor(t){this.languageService=t,this.store=new it([]),this.entitySortChange$=new b.X(!1),this.paginatorOptions={pageSize:10},this.template={selection:!0,selectionCheckbox:!0,selectMany:!0,sort:!0,valueAccessor:(o,n)=>ai(o,n),columns:[{name:"selected",title:"Selected",valueAccessor:o=>this.store.state.get(o).selected?"radiobox-marked":"radiobox-blank",renderer:je.Icon},{name:"id",title:"ID"},{name:"name",title:"Name"},{name:"description",title:"Description",renderer:je.HTML},{name:"url",title:"Hyperlink"},{name:"image",title:"Image"},{name:"action",title:"",valueAccessor:o=>[{icon:"home",color:"warn",click:n=>{console.log(n)}}],renderer:je.ButtonGroup}]}}ngOnInit(){const o=[2,1,3,4,5,6,7,8,9,10,11,12,13].map(n=>3===n?{id:n,name:`Name ${n}`,description:`<b>Description ${n}</b>`,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png"}:{id:n,name:`Name ${n}`,description:`<b>Description ${n}</b>`,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/Igo_logoavec.png"});this.store.load(o)}entitySortChange(){this.entitySortChange$.next(!0)}paginatorChange(t){this.paginator=t}ngOnDestroy(){this.store.destroy()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-entity-table"]],decls:10,vars:4,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-table"],[3,"store","withPaginator","paginatorOptions","template","entitySortChange"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Entity Table"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-entity-table",1),e.NdJ("entitySortChange",function(){return o.entitySortChange()}),e.qZA()()),2&t&&(e.xp6(9),e.Q6J("store",o.store)("withPaginator",!0)("paginatorOptions",o.paginatorOptions)("template",o.template))},dependencies:[x.a8,x.dn,x.n5,x.$j,li],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Hh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Yh,x.QW,Zi,Gs]}),i})();function Vh(i,r){if(1&i&&(e.TgZ(0,"div")(1,"p"),e._uU(2),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"p"),e._uU(6,"Description: "),e._UZ(7,"span",3),e.qZA()()),2&i){const t=r.ngIf;e.xp6(2),e.hij("ID: ",t.id,""),e.xp6(2),e.hij("Name: ",t.name,""),e.xp6(3),e.Q6J("innerHtml",t.description,e.oJD)}}const Wh=te.Bz.forChild([{path:"entity-selector",component:(()=>{class i{constructor(t){this.languageService=t,this.store=new it([]),this.selected$=new b.X(void 0)}ngOnInit(){this.store.load([{id:"2",name:"Name 2",description:"<b>Description 2</b>"},{id:"1",name:"Name 1",description:"<b>Description 1</b>"},{id:"3",name:"Name 3",description:"<b>Description 3</b>"}])}ngOnDestroy(){this.store.destroy()}getTitle(t){return t.name}onSelectedChange(t){this.selected$.next(t.entity)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-entity-selector"]],decls:12,vars:7,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-selector"],[3,"store","titleAccessor","emptyText","placeholder","selectedChange"],[4,"ngIf"],[3,"innerHtml"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Entity Selector"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-entity-selector",1),e.NdJ("selectedChange",function(s){return o.onSelectedChange(s)}),e.qZA(),e.YNc(10,Vh,8,3,"div",2),e.ALo(11,"async"),e.qZA()),2&t&&(e.xp6(9),e.Q6J("store",o.store)("titleAccessor",o.getTitle)("emptyText","")("placeholder","Select an entity"),e.xp6(1),e.Q6J("ngIf",e.lcZ(11,5,o.selected$)))},dependencies:[f.O5,x.a8,x.dn,x.n5,x.$j,Zl,f.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Kh=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Wh,x.QW,qs]}),i})();function Xh(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-form",2),e.NdJ("submitForm",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onSubmit(n))}),e.ALo(1,"async"),e._UZ(2,"igo-form-group",3),e.TgZ(3,"div",4)(4,"button",5),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.fillForm())}),e._uU(5," Fill Form "),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.clearForm())}),e._uU(7," Clear Form "),e.qZA(),e.TgZ(8,"button",6),e._uU(9," Submit "),e.qZA()()()}if(2&i){const t=r.ngIf,o=e.oxw();e.Q6J("form",t)("formData",e.lcZ(1,4,o.data$)),e.xp6(2),e.Q6J("group",t.groups[0]),e.xp6(6),e.Q6J("disabled",o.submitDisabled)}}const tf=te.Bz.forChild([{path:"form",component:(()=>{class i{constructor(t,o){this.formService=t,this.languageService=o,this.form$=new b.X(void 0),this.data$=new b.X(void 0),this.submitDisabled=!0}ngOnInit(){const o=[{name:"id",title:"ID",options:{cols:1,validator:_.kI.required}},{name:"name",title:"Name",options:{cols:1,validator:_.kI.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}].map(s=>this.formService.field(s)),n=this.formService.form([],[this.formService.group({name:"info"},o)]);this.valueChanges$$=n.control.valueChanges.subscribe(()=>{this.submitDisabled=!n.control.valid}),this.form$.next(n)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({id:1,name:"Bob",status:2})}clearForm(){this.form$.value.control.reset()}onSubmit(t){alert(JSON.stringify(t))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Bs),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-form"]],decls:11,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Form"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.YNc(9,Xh,10,6,"igo-form",1),e.ALo(10,"async"),e.qZA()),2&t&&(e.xp6(9),e.Q6J("ngIf",e.lcZ(10,1,o.form$)))},dependencies:[f.O5,w.lW,x.a8,x.dn,x.n5,x.$j,Rs,Rl,f.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let nf=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,tf,w.ot,x.QW,Cn]}),i})();const sf=te.Bz.forChild([{path:"table",component:(()=>{class i{constructor(t){this.languageService=t,this.model={columns:[{name:"id",title:"ID",sortable:!1,filterable:!0},{name:"name",title:"Name",sortable:!0,filterable:!0},{name:"description",title:"Description",sortable:!0,filterable:!0}],actions:[{icon:"file-document",color:xn.primary,click:o=>this.showName(o.name)}],selectionCheckbox:!0}}ngOnInit(){this.database=new fh([{id:"2",name:"Name 2",description:"Hello 2"},{id:"1",name:"Name 1",description:"Bonjour 1"},{id:"3",name:"Name 3",description:"Hola 3"}])}showName(t){alert(t)}handleSelect(t){console.log(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-table"]],decls:10,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/table"],[3,"database","model","hasFilterInput","select"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Table"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-table",1),e.NdJ("select",function(s){return o.handleSelect(s)}),e.qZA()()),2&t&&(e.xp6(9),e.Q6J("database",o.database)("model",o.model)("hasFilterInput",!0))},dependencies:[x.a8,x.dn,x.n5,x.$j,th],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let af=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[sf,x.QW,oh]}),i})();function lf(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",6),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toolbox.activatePreviousTool())}),e._UZ(1,"mat-icon",7),e.qZA()}}function cf(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toolbox.deactivateTool())}),e._UZ(1,"mat-icon",9),e.qZA()}}let $i=class{constructor(r){this.cdRef=r}onUpdateInputs(){this.cdRef.detectChanges()}};$i.\u0275fac=function(r){return new(r||$i)(e.Y36(e.sBO))},$i.\u0275cmp=e.Xpm({type:$i,selectors:[["app-salutation-tool"]],inputs:{name:"name"},decls:2,vars:1,template:function(r,t){1&r&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&r&&(e.xp6(1),e.hij("Hello, my name is ",t.name,"."))},encapsulation:2,changeDetection:0}),$i=(0,j.gn)([ke({name:"demo-salutation",title:"Salutation",icon:"account",options:{name:"Jack"}}),(0,j.w6)("design:paramtypes",[e.sBO])],$i);let Ei=class{};Ei.\u0275fac=function(r){return new(r||Ei)},Ei.\u0275cmp=e.Xpm({type:Ei,selectors:[["app-about-tool"]],decls:2,vars:0,template:function(r,t){1&r&&(e.TgZ(0,"p"),e._uU(1,"I'm a tool inside a toolbox."),e.qZA())},encapsulation:2,changeDetection:0}),Ei=(0,j.gn)([ke({name:"demo-about",title:"About",icon:"information"})],Ei);const pf=te.Bz.forChild([{path:"tool",component:(()=>{class i{constructor(t,o){this.toolService=t,this.languageService=o,this.toolbox=new ql}get activeTool$(){return this.toolbox.activeTool$}get panelTitle(){return this.activeTool$.value?this.activeTool$.value.title:"Toolbox"}ngOnInit(){this.toolbox.setToolbar(["demo-salutation","demo-about"]),this.toolbox.setTools(this.toolService.getTools())}ngOnDestroy(){this.toolbox.destroy()}activateSalutationTool(){this.toolbox.activateTool("demo-salutation",{name:"Bob"})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Di),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-tool"]],decls:17,vars:9,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/tool"],[3,"title"],["mat-icon-button","","panelLeftButton","",3,"click",4,"ngIf"],["mat-icon-button","","panelRightButton","",3,"click",4,"ngIf"],[3,"toolbox","animate"],["mat-flat-button","","type","button","color","primary",3,"click"],["mat-icon-button","","panelLeftButton","",3,"click"],["svgIcon","arrow-back"],["mat-icon-button","","panelRightButton","",3,"click"],["svgIcon","menu"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Tool"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-panel",1),e.YNc(10,lf,2,0,"button",2),e.ALo(11,"async"),e.YNc(12,cf,2,0,"button",3),e.ALo(13,"async"),e._UZ(14,"igo-toolbox",4),e.qZA(),e.TgZ(15,"button",5),e.NdJ("click",function(){return o.activateSalutationTool()}),e._uU(16," Activate Salutation Tool "),e.qZA()()),2&t&&(e.xp6(9),e.Q6J("title",o.panelTitle),e.xp6(1),e.Q6J("ngIf",e.lcZ(11,5,o.activeTool$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,7,o.activeTool$)),e.xp6(2),e.Q6J("toolbox",o.toolbox)("animate",!0))},dependencies:[f.O5,w.lW,T.Hw,x.a8,x.dn,x.n5,x.$j,Dt,ah,f.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let df=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,pf,w.ot,T.Ps,x.QW,oe,Tt,ch.forRoot()]}),i})(),gf=(()=>{class i{constructor(t){this.cdRef=t,this.complete=new e.vpe,this.cancel=new e.vpe}onUpdateInputs(){this.cdRef.detectChanges()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-salutation-widget"]],inputs:{name:"name"},outputs:{complete:"complete",cancel:"cancel"},decls:6,vars:1,consts:[["mat-flat-button","",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1),e.qZA(),e.TgZ(2,"button",0),e.NdJ("click",function(){return o.complete.emit(o.name)}),e._uU(3,"Nice to meet you"),e.qZA(),e.TgZ(4,"button",0),e.NdJ("click",function(){return o.cancel.emit(o.name)}),e._uU(5,"Dismiss"),e.qZA()),2&t&&(e.xp6(1),e.hij("Hello, my name is ",o.name,"."))},dependencies:[w.lW],encapsulation:2,changeDetection:0}),i})();const hf=te.Bz.forChild([{path:"widget",component:(()=>{class i{constructor(t){this.widgetService=t,this.widget=this.widgetService.create(gf),this.inputs={name:"Bob"}}onWidgetComplete(t){alert(`${t} emitted event 'complete' then got automatically destroyed.`)}onWidgetCancel(){alert("Widget emitted event 'cancel' then got automatically destroyed.")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Vs))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-widget"]],decls:10,vars:2,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/widget"],[3,"widget","inputs","complete","cancel"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Widget"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-widget-outlet",1),e.NdJ("complete",function(s){return o.onWidgetComplete(s)})("cancel",function(){return o.onWidgetCancel()}),e.qZA()()),2&t&&(e.xp6(9),e.Q6J("widget",o.widget)("inputs",o.inputs))},dependencies:[x.a8,x.dn,x.n5,x.$j,Yl],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let ff=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[hf,w.ot,x.QW,Hl]}),i})();var Ji=C(19337),Fo=C(68951),to=C(59346),_f=C(54959),Ht=C(26466),xr=C(5524),Ri=C(43105),Wl=C(7771),yf=C(70349),ho=C(99616);let Xs=(()=>{class i{constructor(t){this.injector=t}set(t){localStorage.setItem(this.tokenKey,t)}remove(){localStorage.removeItem(this.tokenKey)}get(){return localStorage.getItem(this.tokenKey)}decode(){const t=this.get();if(t)return _f(t)}isExpired(){const t=this.decode(),o=(new Date).getTime()/1e3;return!(t&&o<t.exp)}get tokenKey(){const t=this.injector.get(J);return this.options=t.getConfig("auth")||{},this.options.tokenKey}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ye=(()=>{class i{constructor(t,o,n,s,a,l){this.http=t,this.tokenService=o,this.config=n,this.languageService=s,this.messageService=a,this.router=l,this.authenticate$=new b.X(void 0),this.logged$=new b.X(void 0),this.languageForce=!1,this.anonymous=!1,this.authenticate$.next(this.authenticated),this.authenticate$.subscribe(c=>{this.logged$.next(c),Ot.h.next()})}get hasAuthService(){return void 0!==this.config.getConfig("auth.url")}login(t,o){const n=new q.WM({"Content-Type":"application/json"}),s={username:t,password:this.encodePassword(o)};return this.loginCall(s,n)}loginWithToken(t,o,n){const s=new q.WM({"Content-Type":"application/json"});return this.loginCall({token:t,typeConnection:o,infosUser:n},s)}loginAnonymous(){return this.anonymous=!0,this.logged$.next(!0),(0,X.of)(!0)}refresh(){const t=this.config.getConfig("auth.url");return this.http.post(`${t}/refresh`,{}).pipe((0,Ji.b)(o=>{this.tokenService.set(o.token)}),(0,he.K)(o=>{throw o.error.caught=!0,o}))}logout(){return this.anonymous=!1,this.tokenService.remove(),this.authenticate$.next(!1),(0,X.of)(!0)}isAuthenticated(){return!this.tokenService.isExpired()}getToken(){return this.tokenService.get()}decodeToken(){return!!this.isAuthenticated()&&this.tokenService.decode()}goToRedirectUrl(){if(!this.router)return;const t=this.redirectUrl||this.router.url,o=this.config.getConfig("auth")||{};t===o.loginRoute?this.router.navigateByUrl(o.homeRoute||"/"):t&&this.router.navigateByUrl(t)}getUserInfo(){const t=this.config.getConfig("auth.url")+"/info";return this.http.get(t)}getProfils(){const t=this.config.getConfig("auth.url");return this.http.get(`${t}/profils`)}updateUser(t){const o=this.config.getConfig("auth.url");return this.http.patch(o,t)}encodePassword(t){return Xp.encode(t)}get logged(){return this.authenticated||this.isAnonymous}get isAnonymous(){return this.anonymous}get authenticated(){return this.isAuthenticated()}get isAdmin(){const t=this.decodeToken();return!!(t&&t.user&&t.user.isAdmin)}loginCall(t,o){const n=this.config.getConfig("auth.url");return this.http.post(`${n}/login`,t,{headers:o}).pipe((0,Ji.b)(s=>{this.tokenService.set(s.token);const a=this.decodeToken();a&&a.user&&(a.user.locale&&!this.languageForce&&this.languageService.setLanguage(a.user.locale),a.user.isExpired&&this.messageService.alert("igo.auth.error.Password expired")),this.authenticate$.next(!0)}),(0,he.K)(s=>{throw s.error.caught=!0,s}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(Xs),e.LFG(J),e.LFG(D),e.LFG(_e),e.LFG(te.F0,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),vf=(()=>{class i{constructor(t,o,n,s){this.authService=t,this.config=o,this.languageService=n,this.appRef=s,this.login=new e.vpe,this.options=this.config.getConfig("auth.google")||{},this.options.apiKey&&this.options.clientId?(this.loadSDKGoogle(),this.loadPlatform()):console.warn('Google authentification needs "apiKey" and "clientId" options')}handleSignInClick(){window.gapi.auth2.getAuthInstance().signIn()}handleSignOutClick(){window.gapi.auth2.getAuthInstance().signOut()}handleClientLoad(){window.gapi.load("client:auth2",()=>this.initClient())}initClient(){window.gapi.client.init({apiKey:this.options.apiKey,clientId:this.options.clientId,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(()=>{this.handleSignOutClick(),this.updateTextButton(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(t=>{this.updateSigninStatus(t)})})}updateSigninStatus(t){this.updateTextButton(),t&&this.loginGoogle(window.gapi.client.getToken().access_token)}updateTextButton(){const t=document.querySelector('span[id^="not_signed_"]');t&&"en"!==this.languageService.getLanguage()&&("Sign in with Google"===t.innerHTML?t.innerHTML=this.languageService.translate.instant("igo.auth.google.login"):"Signed in with Google"===t.innerHTML&&(t.innerHTML=this.languageService.translate.instant("igo.auth.google.logged")))}loginGoogle(t){this.authService.loginWithToken(t,"google").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKGoogle(){const t=document.getElementsByTagName("script")[0],o=document.createElement("script");o.id="google-jssdk",o.src="https://apis.google.com/js/api.js",o.onload=()=>{this.handleClientLoad()},t.parentNode.insertBefore(o,t)}loadPlatform(){const t=document.getElementsByTagName("script")[0],o=document.createElement("script");o.id="google-platform",o.src="https://apis.google.com/js/platform.js",t.parentNode.insertBefore(o,t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye),e.Y36(J),e.Y36(D),e.Y36(e.z2F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-google"]],outputs:{login:"login"},decls:1,vars:0,consts:[["data-height","40","data-width","265","data-longtitle","true",1,"g-signin2","google-login-button"]],template:function(t,o){1&t&&e._UZ(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block}.google-login-button[_ngcontent-%COMP%]     .abcRioButton{color:#000000de}"],changeDetection:0}),i})();function bf(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.loginAnonymous())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.loading),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.auth.accessAnonymous")," ")}}function Cf(i,r){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"font",8),e._uU(3),e.qZA()()),2&i){const t=e.oxw();e.xp6(3),e.Oqu(t.error)}}let xf=(()=>{class i{constructor(t,o,n){this.auth=t,this.languageService=o,this._allowAnonymous=!0,this.error="",this.loading=!1,this.login=new e.vpe,this.form=n.group({username:["",_.kI.required],password:["",_.kI.required]})}get allowAnonymous(){return this._allowAnonymous}set allowAnonymous(t){this._allowAnonymous=t}loginUser(t){return this.loading=!0,this.auth.login(t.username,t.password).subscribe(()=>{this.login.emit(!0),this.loading=!1},o=>{try{this.languageService.translate.get("igo.auth.error."+o.error.message).subscribe(n=>this.error=n)}catch(n){this.error=o.error.message}this.loading=!1}),!1}loginAnonymous(){this.auth.loginAnonymous().subscribe(()=>{this.login.emit(!0)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye),e.Y36(D),e.Y36(_.QS))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-intern"]],inputs:{allowAnonymous:"allowAnonymous"},outputs:{login:"login"},decls:14,vars:12,consts:[["role","form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","formControlName","username",3,"placeholder"],["matInput","","required","","type","password","formControlName","password",3,"placeholder"],["mat-raised-button","","type","submit"],["mat-raised-button","","class","anonymous","type","button",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["mat-raised-button","","type","button",1,"anonymous",3,"disabled","click"],["size","3","color","red"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.loginUser(o.form.value)}),e.TgZ(1,"div")(2,"mat-form-field",1),e._UZ(3,"input",2),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div")(6,"mat-form-field",1),e._UZ(7,"input",3),e.ALo(8,"translate"),e.qZA()(),e.TgZ(9,"button",4),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.YNc(12,bf,3,4,"button",5),e.YNc(13,Cf,4,1,"div",6),e.qZA()),2&t&&(e.Q6J("formGroup",o.form),e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.auth.user")),e.xp6(4),e.s9C("placeholder",e.lcZ(8,8,"igo.auth.password")),e.xp6(3),e.Oqu(e.lcZ(11,10,"igo.auth.login")),e.xp6(2),e.Q6J("ngIf",o.allowAnonymous),e.xp6(1),e.Q6J("ngIf",o.error))},dependencies:[f.O5,_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.sg,_.u,I.KE,H.Nt,w.lW,L.X$],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.anonymous[_ngcontent-%COMP%]{margin-left:10px}"]}),i})(),Sf=(()=>{class i{constructor(t,o,n){this.authService=t,this.config=o,this.appRef=n,this.login=new e.vpe,this.options=this.config.getConfig("auth.facebook")||{},this.options.appId?this.loadSDKFacebook():console.warn('Facebook authentification needs "appId" option')}subscribeEvents(){window.FB.Event.subscribe("auth.statusChange",t=>{this.statusChangeCallback(t)})}statusChangeCallback(t){"connected"===t.status&&this.loginFacebook(t.authResponse.accessToken)}loginFacebook(t){this.authService.loginWithToken(t,"facebook").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKFacebook(){if(document.getElementById("facebook-jssdk"))return;const o=document.getElementsByTagName("script")[0],n=document.createElement("script");n.id="facebook-jssdk",n.src=`https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9&appId=${this.options.appId}`,n.onload=()=>{this.subscribeEvents()},o.parentNode.insertBefore(n,o)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye),e.Y36(J),e.Y36(e.z2F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-facebook"]],outputs:{login:"login"},decls:1,vars:0,consts:[["scope","public_profile,email","data-max-rows","1","data-size","large","data-button-type","login_with","data-show-faces","false","data-auto-logout-link","false","data-use-continue-as","false",1,"fb-login-button"]],template:function(t,o){1&t&&e._UZ(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-3px}"],changeDetection:0}),i})(),wf=(()=>{class i{constructor(t,o,n,s,a){this.authService=t,this.config=o,this.appRef=n,this.msalService=s,this.msalGuardConfig=a,this._destroying$=new Se.x,this.login=new e.vpe,this.options=this.config.getConfig("auth.microsoft")||{},this.msalService.instance=new xr.L({auth:this.options,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new Ht.J$(this.msalService.instance,this.msalService),this.options.clientId?this.broadcastService.inProgress$.pipe((0,ri.h)(l=>l===Ri.$H.None),(0,Fo.R)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoft(){this.msalService.loginPopup(Object.assign({},this.getConf().authRequest)).subscribe(t=>{this.msalService.instance.setActiveAccount(t.account),this.checkAccount()})}checkAccount(){this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(t=>{this.authService.loginWithToken(t.accessToken,"microsoft",{tokenId:t.idToken}).subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(t=>(0,j.mG)(this,void 0,void 0,function*(){if(t instanceof Wl.Yo)return this.msalService.acquireTokenPopup(this.getConf().authRequest);console.log(t)})).catch(t=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(t=>"add"===t.type)[0]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye),e.Y36(J),e.Y36(e.z2F),e.Y36(Ht.W2),e.Y36(Ht.S9))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-microsoft"]],outputs:{login:"login"},decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(t,o){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return o.loginMicrosoft()}),e._UZ(1,"mat-icon",1),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"igo.auth.microsoft.login"),"\n"))},dependencies:[T.Hw,w.lW,L.X$],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0}),i})(),ea=(()=>{class i{constructor(t,o){this.instance=t,this.location=o,this.name="@azure/msal-angular",this.version="2.0.0-beta.2";const n=this.location.path(!0).split("#").pop();n&&(this.redirectHash=`#${n}`),this.instance.initializeWrapperLibrary(Ri.lA.Angular,this.version)}initialize(){return(0,to.D)(this.instance.initialize())}acquireTokenPopup(t){return(0,to.D)(this.instance.acquireTokenPopup(t))}acquireTokenRedirect(t){return(0,to.D)(this.instance.acquireTokenRedirect(t))}acquireTokenSilent(t){return(0,to.D)(this.instance.acquireTokenSilent(t))}handleRedirectObservable(t){return(0,to.D)(this.instance.handleRedirectPromise(t||this.redirectHash))}loginPopup(t){return(0,to.D)(this.instance.loginPopup(t))}loginRedirect(t){return(0,to.D)(this.instance.loginRedirect(t))}logout(t){return(0,to.D)(this.instance.logout(t))}logoutRedirect(t){return(0,to.D)(this.instance.logoutRedirect(t))}logoutPopup(t){return(0,to.D)(this.instance.logoutPopup(t))}ssoSilent(t){return(0,to.D)(this.instance.ssoSilent(t))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(this.name,this.version)),this.logger}setLogger(t){this.logger=t.clone(this.name,this.version),this.instance.setLogger(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Ht.sK),e.LFG(f.Ye))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),Tf=(()=>{class i{constructor(t,o){this.msalInstance=t,this.authService=o,this._msalSubject=new Se.x,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new b.X(Ri.$H.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(n=>{this._msalSubject.next(n);const s=yf.w.getInteractionStatusFromEvent(n);null!==s&&(this.authService.getLogger().verbose(`BroadcastService - ${n.eventType} results in setting inProgress to ${s}`),this._inProgress.next(s))})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Ht.sK),e.LFG(ea))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),Mf=(()=>{class i{constructor(t,o,n,s,a){this.authService=t,this.config=o,this.appRef=n,this.msalService=s,this.msalGuardConfig=a,this._destroying$=new Se.x,this.login=new e.vpe,this.options=this.config.getConfig("auth.microsoftb2c")||{},this.msalService.instance=new xr.L({auth:this.options.browserAuthOptions,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new Tf(this.msalService.instance,this.msalService),this.options.browserAuthOptions.clientId?this.broadcastService.inProgress$.pipe((0,ri.h)(l=>l===Ri.$H.None),(0,Fo.R)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoftb2c(){this.msalService.loginPopup(Object.assign({},this.getConf().authRequest)).subscribe(t=>{this.msalService.instance.setActiveAccount(t.account),this.checkAccount()})}checkAccount(){this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(t=>{this.authService.loginWithToken(t.idToken,"microsoftb2c").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(t=>(0,j.mG)(this,void 0,void 0,function*(){if(t instanceof Wl.Yo)return this.msalService.acquireTokenPopup(this.getConf().authRequest)})).catch(t=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(t=>"b2c"===t.type)[0]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye),e.Y36(J),e.Y36(e.z2F),e.Y36(ea),e.Y36(Ht.S9))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-microsoftb2c"]],outputs:{login:"login"},decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(t,o){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return o.loginMicrosoftb2c()}),e._UZ(1,"mat-icon",1),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"igo.auth.microsoftb2c.login"),"\n"))},dependencies:[T.Hw,w.lW,L.X$],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0}),i})();function Ff(i,r){1&i&&e._UZ(0,"div",3)}function Af(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-auth-google",7),e.NdJ("login",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.onLogin())}),e.qZA()}}function Lf(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-auth-microsoft",7),e.NdJ("login",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.onLogin())}),e.qZA()}}function If(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-auth-microsoftb2c",7),e.NdJ("login",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.onLogin())}),e.qZA()}}function Of(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-auth-facebook",7),e.NdJ("login",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.onLogin())}),e.qZA()}}function Zf(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-auth-intern",8),e.NdJ("login",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.onLogin())}),e.qZA()}if(2&i){const t=e.oxw(3);e.Q6J("allowAnonymous",t.options.allowAnonymous)}}function Df(i,r){if(1&i&&(e.TgZ(0,"div",4)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Af,1,0,"igo-auth-google",5),e.YNc(5,Lf,1,0,"igo-auth-microsoft",5),e.YNc(6,If,1,0,"igo-auth-microsoftb2c",5),e.YNc(7,Of,1,0,"igo-auth-facebook",5),e.YNc(8,Zf,1,1,"igo-auth-intern",6),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,6,"igo.auth.connection")),e.xp6(2),e.Q6J("ngIf",t.options.google&&!1!==t.options.google.enabled),e.xp6(1),e.Q6J("ngIf",t.options.microsoft&&!1!==t.options.microsoft.enabled),e.xp6(1),e.Q6J("ngIf",t.options.microsoftb2c&&!1!==t.options.microsoftb2c.enabled),e.xp6(1),e.Q6J("ngIf",t.options.facebook&&!1!==t.options.facebook.enabled),e.xp6(1),e.Q6J("ngIf",!t.options.intern||!1!==t.options.intern.enabled)}}function kf(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.logout())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(e.xi3(3,2,"igo.auth.welcome",t.user)),e.xp6(3),e.Oqu(e.lcZ(6,5,"igo.auth.signOut"))}}function Pf(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.home())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.auth.home")))}function $f(i,r){if(1&i&&(e.TgZ(0,"div",4)(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Pf,3,3,"button",10),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,"igo.auth.deconnection")),e.xp6(2),e.Q6J("ngIf",t.options.homeRoute)}}function Ef(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Ff,1,0,"div",1),e.YNc(2,Df,9,8,"div",2),e.YNc(3,kf,7,7,"div",2),e.YNc(4,$f,5,4,"div",2),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.auth.logged&&t.backgroundDisable),e.xp6(1),e.Q6J("ngIf",!t.auth.logged&&t.showLoginDiv),e.xp6(1),e.Q6J("ngIf",t.auth.logged&&t.showAlreadyConnectedDiv),e.xp6(1),e.Q6J("ngIf",t.showLogoutDiv)}}let ta=(()=>{class i{constructor(t,o,n){this.auth=t,this.config=o,this.router=n,this._backgroundDisable=!0,this._hasAlreadyConnectedDiv=!0,this._hasLogoutDiv=!0,this._showAlreadyConnectedDiv=!1,this._showLogoutDiv=!1,this.login=new e.vpe,this.visible=!0,this.options=this.config.getConfig("auth")||{},this.visible=0!==Object.getOwnPropertyNames(this.options).length}get backgroundDisable(){return!this.isLogoutRoute&&!this.isLogoutRoute&&this._backgroundDisable}set backgroundDisable(t){this._backgroundDisable="true"===t.toString()}get hasAlreadyConnectedDiv(){return this._hasAlreadyConnectedDiv}set hasAlreadyConnectedDiv(t){this._hasAlreadyConnectedDiv="true"===t.toString()}get hasLogoutDiv(){return this._hasLogoutDiv}set hasLogoutDiv(t){this._hasLogoutDiv="true"===t.toString()}get showAlreadyConnectedDiv(){return this.isLogoutRoute?this.hasAlreadyConnectedDiv:this._showAlreadyConnectedDiv}set showAlreadyConnectedDiv(t){this._showAlreadyConnectedDiv="true"===t.toString()}get showLogoutDiv(){return this.isLogoutRoute?this.hasLogoutDiv:this._showLogoutDiv}set showLogoutDiv(t){this._showLogoutDiv="true"===t.toString()}get showLoginDiv(){if(!this.isLogoutRoute)return!0}ngOnInit(){this.analyzeRoute(),this.getName()}onLogin(){this.auth.goToRedirectUrl(),this.getName(),this.login.emit(!0)}logout(){this.auth.logout().subscribe(()=>{this.user=void 0,this.router&&(this.options.logoutRoute?this.router.navigate([this.options.logoutRoute]):this.options.homeRoute&&this.router.navigate([this.options.homeRoute]))})}home(){this.router&&this.options.homeRoute&&this.router.navigate([this.options.homeRoute])}getName(){const t=this.auth.decodeToken();t&&(this.user={name:t.user.firstName||t.user.sourceId})}analyzeRoute(){!this.router||this.router.events.pipe((0,ri.h)(t=>t instanceof te.OD)).subscribe(t=>{if(t.url){const o=t.url,s=this.options.loginRoute;this.isLogoutRoute=o===this.options.logoutRoute,this.isLoginRoute=o===s,this.isLogoutRoute&&this.auth.logout()}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye),e.Y36(J),e.Y36(te.F0,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-form"]],inputs:{backgroundDisable:"backgroundDisable",hasAlreadyConnectedDiv:"hasAlreadyConnectedDiv",hasLogoutDiv:"hasLogoutDiv",showAlreadyConnectedDiv:"showAlreadyConnectedDiv",showLogoutDiv:"showLogoutDiv"},outputs:{login:"login"},decls:1,vars:1,consts:[[4,"ngIf"],["class","backgroundDisable",4,"ngIf"],["class","login center-block",4,"ngIf"],[1,"backgroundDisable"],[1,"login","center-block"],[3,"login",4,"ngIf"],[3,"allowAnonymous","login",4,"ngIf"],[3,"login"],[3,"allowAnonymous","login"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button",3,"click",4,"ngIf"]],template:function(t,o){1&t&&e.YNc(0,Ef,5,4,"div",0),2&t&&e.Q6J("ngIf",o.visible)},dependencies:[f.O5,w.lW,vf,xf,Sf,wf,Mf,L.X$],styles:["[_nghost-%COMP%]{z-index:999}div.login[_ngcontent-%COMP%]{z-index:200;width:90%;min-width:360px;max-width:600px;padding:25px 50px;border:1px solid;background-color:#fff;border-color:#888}.center-block[_ngcontent-%COMP%]{position:fixed;top:20%;left:50%;transform:translate(-50%)}.backgroundDisable[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background:#000;opacity:.8;z-index:100;height:100%;width:100%}"]}),i})(),Sr=(()=>{class i{constructor(t,o,n){this.config=t,this.tokenService=o,this.http=n,this.refreshInProgress=!1}get trustHosts(){const t=this.config.getConfig("auth.trustHosts")||[];return t.push(window.location.hostname),t}get hostsWithCredentials(){return this.config.getConfig("auth.hostsWithCredentials")||[]}get hostsWithAuthByKey(){return this.config.getConfig("auth.hostsByKey")||[]}intercept(t,o){const n=this.handleHostsWithCredentials(t.url);let s=t.clone();const a=this.handleHostsAuthByKey(t.url);if(a&&(s=s.clone({params:s.params.set(a.key,a.value)})),n)return s=t.clone({withCredentials:n}),o.handle(s);this.refreshToken();const l=this.tokenService.get(),c=document.createElement("a");if(c.href=s.url,""===c.host&&(c.href=c.href),!l||-1===this.trustHosts.indexOf(c.hostname))return o.handle(s);let p=s.clone({headers:s.headers.set("Authorization",`Bearer ${l}`)});const d=this.tokenService.decode();if("true"===p.params.get("_i")&&d&&d.user&&d.user.sourceId){const g=ho.V8.hashStr(d.user.sourceId);p=p.clone({params:p.params.set("_i",g)})}else"true"===p.params.get("_i")&&(p=p.clone({params:p.params.delete("_i")}));return o.handle(p)}interceptXhr(t,o){const n=this.handleHostsWithCredentials(o);if(n)return t.withCredentials=n,!0;this.refreshToken();const s=document.createElement("a");s.href=o;const a=this.tokenService.get();return!(!a||-1===this.trustHosts.indexOf(s.hostname)||(t.setRequestHeader("Authorization","Bearer "+a),0))}alterUrlWithKeyAuth(t){const o=this.handleHostsAuthByKey(t);if(o){const s=t.split(/[?&]/);let a=s.shift();const l=s.filter(c=>0!==c.length);return l.push(`${o.key}=${o.value}`),l.length&&(a+="?"+l.join("&")),a}}handleHostsWithCredentials(t){let o=!1;for(const n of this.hostsWithCredentials)if(new RegExp(n.domainRegFilters).test(t)){o=void 0!==n.withCredentials?n.withCredentials:void 0;break}return o}handleHostsAuthByKey(t){let o;for(const a of this.hostsWithAuthByKey)if(new RegExp(a.domainRegFilters).test(t)&&!new RegExp(`${a.keyProperty}=${a.keyValue}`,"gm").test(t)){o={key:a.keyProperty,value:a.keyValue};break}return o}refreshToken(){const t=this.tokenService.decode(),o=(new Date).getTime()/1e3;if(!this.refreshInProgress&&t&&o<t.exp&&o>t.exp-1800){this.refreshInProgress=!0;const n=this.config.getConfig("auth.url");return this.http.post(`${n}/refresh`,{}).subscribe(s=>{this.tokenService.set(s.token),this.refreshInProgress=!1},s=>(s.error.caught=!0,s))}}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(J),e.LFG(Xs),e.LFG(q.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Jf(i){const r=i.getConfig("auth.microsoft")||{};return r.redirectUri=r.redirectUri||window.location.href,r.authority=r.authority||"https://login.microsoftonline.com/organizations",new xr.L({auth:r,cache:{cacheLocation:"sessionStorage"}})}function Rf(i){const r=i.getConfig("auth.microsoftb2c.browserAuthOptions")||{};return r.redirectUri=r.redirectUri||window.location.href,r.authority=r.authority||"https://login.microsoftonline.com/organizations",new xr.L({auth:r,cache:{cacheLocation:"sessionStorage"}})}function Bf(i){return i.getConfig("auth.microsoft"),{interactionType:Ri.s_.Popup,authRequest:{scopes:["user.read"],loginHint:"todo"},type:"add"}}function Uf(i){const r=i.getConfig("auth.microsoftb2c.browserAuthOptions")||{};return{interactionType:Ri.s_.Popup,authRequest:{scopes:[r.clientId]},type:"b2c"}}function Kl(i){return"b2c"===i?[{provide:Ht.sK,useFactory:Rf,deps:[J]},{provide:Ht.S9,useFactory:Uf,deps:[J],multi:!0},ea]:[{provide:Ht.sK,useFactory:Jf,deps:[J]},{provide:Ht.S9,useFactory:Bf,deps:[J],multi:!0},Ht.W2]}let Nf=(()=>{class i extends ce{constructor(t,o,n,s){super(t),this.http=o,this.authService=n,this.tokenService=s,this.authService.authenticate$.subscribe(a=>{a&&this.options.url&&this.http.get(this.options.url).subscribe(l=>{if(l&&l.preference)for(const c of Object.keys(l.preference))super.set(c,l.preference[c])})})}set(t,o,n=Ie.LOCAL){if(n===Ie.LOCAL&&this.authService.authenticated&&this.options.url){const s={};s[t]=o,this.http.patch(this.options.url,{preference:s}).subscribe()}super.set(t,o,n)}remove(t,o=Ie.LOCAL){if(o===Ie.LOCAL&&this.authService.authenticated&&this.options.url){const n={};n[t]=void 0,this.http.patch(this.options.url,{preference:n}).subscribe()}super.remove(t,o)}clear(t=Ie.LOCAL){let o;t===Ie.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.patch(this.options.url,{preference:{}},{params:{mergePreference:"false"}}).subscribe(),t===Ie.LOCAL&&(o=this.tokenService.get()),super.clear(t),o&&this.tokenService.set(o),t===Ie.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.get(this.options.url).subscribe(n=>{if(n&&n.preference)for(const s of Object.keys(n.preference))super.set(s,n.preference[s])})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(J),e.LFG(q.eN),e.LFG(Ye),e.LFG(Xs))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),oa=(()=>{class i{static forRoot(){return{ngModule:i,providers:[{provide:q.TP,useClass:Sr,multi:!0},{provide:ce,useClass:Nf},...Kl("add"),...Kl("b2c")]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.UX,I.lN,H.c,T.Ps,w.ot,oe,Ht.up]}),i})();const Qf=te.Bz.forChild([{path:"auth-form",component:(()=>{class i{constructor(t){this.languageService=t,this.idsActivity=[]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-auth-form"]],decls:17,vars:0,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/auth/auth-form"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Auth"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Authentification"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: ConfigService, LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See auth section of the "),e.TgZ(14,"a",1),e._uU(15," environment config"),e.qZA()()(),e._UZ(16,"igo-auth-form"))},dependencies:[x.a8,x.dn,x.n5,x.$j,ta],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let jf=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Qf,x.QW,oa.forRoot()]}),i})();var Sn=C(2762),Xl=C(28653),At=C(64055),Bi=C(20591),wn=C(85524),Yf=C(17714),Hf=C(46441),Vt=C(63853),ia=C(49525),Tn=C(45508),Vf=C(72409),zf=C(81885),wr=C(46289),ec=C(92597),V=C(57647),tc=C(89818),Wf=C(21975),na=C(99408),oc=C(69320),Mn=C(92204),ra=C(39987),Kf=C(86052),Xf=C(2451),ic=C(75767),zt=C(33535),be=C(92845),Tr=C(71288),pi=C(36130),e_=C(83605),Mr=C(46709),sa=C(59437),Fn=C(57868),aa=C(35571),nc=C(41649),rc=C(24717),t_=C(73552),o_=C(97255),i_=C(72816),Jo=C(95091),et=C(87187),Ui=C(12912),fo=C(56224),An=C(1716),Ni=C(49798),ht=C(65387),la=C(85025),sc=C(79432),n_=C(39015),r_=C(48332),Fr=C(59333),Je=C(55407),R=C(864),St=C(44483),N=C(95567),di=C(57920),U=C(12854),Me=C(17840),gi=C(32053),s_=C(62914),kt=C(73950),Pe=C(83733),oo=C(39703),a_=C(74121),l_=C(29580),ac=C(81091),c_=C(60725),lc=C(24609),u_=C(41370),p_=C(8913),d_=C(12279),g_=C(61741),m_=C(50217),h_=C(87769),De=C(6788),cc=C(27274),uc=C(22196),pc=C(87547),dc=C(40535),f_=C(7074),__=C(29186),gc=C(50384),qi=C(3942),Ro=C(56234),mc=C(65017),y_=C(89545),hc=C(17265),v_=C(77141),b_=C(7675),vt=C(19975),at=C(6623),mi=C(61859),Ln=C(7038),Re=C(31959),In=C(58258),ca=C(52567),fc=C(7887),_c=(C(8322),C(18580)),nt=C(68390),lt=C(12379),Bo=C(34972),On=C(23563),C_=C(53892),x_=C(38205),S_=C(61811),ua=C(65226),yc=C(26290),hi=C(9266),w_=C(41308),Zn=C(54941),Ar=C(67981),T_=C(74051);let M_=(()=>{class i{constructor(){}open(t){t.extern&&window.open(t.url,"_blank")}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function F_(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.openMetadata(n.options.metadata))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.metadata.show"))("color",t.color)}}function A_(i,r){if(1&i&&(e.TgZ(0,"mat-dialog-content",3)(1,"h3"),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.data.abstract)}}function L_(i,r){if(1&i&&(e.TgZ(0,"mat-dialog-content",3),e._UZ(1,"h3",4),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("innerHTML",t.data.abstract,e.oJD)}}let Gi=(()=>{class i{constructor(t,o){this.metadataService=t,this.dialog=o,this._color="primary"}get layer(){return this._layer}set layer(t){this._layer=t}get color(){return this._color}set color(t){this._color=t}openMetadata(t){t.extern?!t.url&&t.abstract?this.dialog.open(vc,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}}):t.url&&this.metadataService.open(t):!t.extern&&t.abstract&&this.dialog.open(vc,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}})}get options(){if(this.layer)return this.layer.options}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(M_),e.Y36(P.uw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","information-outline"]],template:function(t,o){1&t&&e.YNc(0,F_,3,4,"button",0),2&t&&e.Q6J("ngIf",o.options&&o.options.metadata&&o.options.metadata.url||o.options&&o.options.metadata&&o.options.metadata.abstract)},dependencies:[f.O5,T.Hw,w.lW,O.gM,L.X$],changeDetection:0}),i})(),vc=(()=>{class i{constructor(t){this.data=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-metadata-abstract"]],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(t,o){1&t&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"button",1),e._uU(3,"X"),e.qZA(),e.YNc(4,A_,3,1,"mat-dialog-content",2),e.YNc(5,L_,2,1,"mat-dialog-content",2)),2&t&&(e.xp6(1),e.Oqu(o.data.layerTitle),e.xp6(3),e.Q6J("ngIf","arcgisrest"!==o.data.type),e.xp6(1),e.Q6J("ngIf","arcgisrest"===o.data.type))},dependencies:[f.O5,w.lW,P.ZT,P.uh,P.xY],styles:[".close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}mat-dialog-container{position:relative}\n"],encapsulation:2}),i})(),fi=(()=>{class i{static forRoot(){return{ngModule:i,providers:[]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,T.Ps,w.ot,O.AV,oe,P.Is]}),i})();function bc(i,r,t={}){let o,n,s,a,l,c,u,p,d,g,h,m,y,v,S,M,A,F,k,z;const de=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),ge="([-+])?([\\d]{1,3})([,.](\\d+))?",xe=`${ge}[\\s,]+${ge}`,pe=new RegExp(`^${xe}$`,"g"),W="([0-9]{1,2})[:|\xb0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|\u2033|\u201d]?\\s*",ze=`${W}([N|S|E|W|O]),?\\s*${W}([N|S|E|W|O])`,me=new RegExp(`^${ze}$`,"gi"),We="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",zo=new RegExp(`^${We}`,"gi"),Zo="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",ir=new RegExp(`^${Zo}`,"gi"),cn="([-+])?(\\d{1,3})[,.](\\d+)",wi=`${cn}\\s*[,]?\\s*${cn}`,un=new RegExp(`^${wi}`,"g"),re="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",fs=`${re}\\s*[,.]?\\s*${re}`,yl=new RegExp(`^${fs}`,"g"),So="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",S6=new RegExp(`^${So}?`,"gi"),Vp="([-+]?\\d+)[,.]?(\\d+)?",zp=`${Vp}[\\s,]+${Vp}`,w6=new RegExp(`^${zp}$`,"g");let _s=!1;if(i=i.toLocaleUpperCase().trim(),de.test(i)?[n,z]=i.split(";").map(Wo=>Wo.trim()):n=i,pe.test(n))[,s,F,,p,d,k,,v]=n.match(xe),F=parseFloat((s||"")+F+"."+p),k=parseFloat((d||"")+k+"."+v);else if(me.test(n))[,a,l,c,u,g,h,m,y]=n.match(ze),("S"===u||"N"===u)&&(a=[g,g=a][0],l=[h,h=l][0],c=[m,m=c][0],u=[y,y=u][0]),F=Uo(parseFloat(a),parseFloat(l),parseFloat(c),u),k=Uo(parseFloat(g),parseFloat(h),parseFloat(m),y);else if(zo.test(n)){_s=!0,[,,S,F,k]=n.match(We);const Wo=Number(S)<10?`EPSG:3260${S}`:`EPSG:326${S}`;[F,k]=V.vs([parseFloat(F),parseFloat(k)],Wo,"EPSG:4326")}else if(ir.test(n)){_s=!0,[,,S,F,k]=n.match(Zo);const Wo=Number(S)<10?`EPSG:3218${S}`:`EPSG:321${80+Number(S)}`;[F,k]=V.vs([parseFloat(F),parseFloat(k)],Wo,"EPSG:4326")}else if(yl.test(n))[,s,a,l,c,p,d,g,h,m,v]=n.match(fs),F=Uo(parseFloat((s||"")+a),parseFloat(l),parseFloat(c),u),k=Uo(parseFloat((d||"")+g),parseFloat(h),parseFloat(m),y);else if(un.test(n))[,s,a,p,d,g,v]=n.match(wi),F=Uo(parseFloat((s||"")+a),parseFloat(l),parseFloat(c),u),k=Uo(parseFloat((d||"")+g),parseFloat(h),parseFloat(m),y);else if(S6.test(n))[,d,g,h,m,,y,s,a,l,c,,u,M,A]=n.match(So),u||(u="W"),F=l&&l.length>2?parseFloat((s||"")+a+"."+l):Uo(parseFloat(a),parseFloat(l),parseFloat(c),u),k=h&&h.length>2?parseFloat((d||"")+g+"."+h):Uo(parseFloat(g),parseFloat(h),parseFloat(m),y);else{if(!w6.test(n))return{lonLat:void 0,message:"",radius:void 0,conf:void 0};_s=!0,[,F,p,k,v]=n.match(zp),p&&(F=parseFloat(F+"."+p)),v&&(k=parseFloat(k+"."+v))}if(t.forceNA&&!_s&&(F>0&&k>0&&(F>k?F=-F:k=-k),F>k&&(F=[k,k=F][0])),o=[Number(F),Number(k)],void 0!==z&&"4326"!==z||o[0]>180||o[0]<-180||o[1]>90||o[1]<-90){const Wo=z?"EPSG:"+z:r,T6="EPSG:4326";try{o=V.vs(o,Wo,T6)}catch(XI){return{lonLat:void 0,message:"Projection "+Wo+" not supported",radius:void 0,conf:void 0}}}return Math.abs(o[0])<=180&&Math.abs(o[1])<=90?{lonLat:o,message:"",radius:M?parseInt(M,10):void 0,conf:A?parseInt(A,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function Uo(i,r,t,o){r=r||0,t=t||0;const n=i<0;let s=Math.abs(i)+r/60+t/3600;return(n||"S"===o||"W"===o)&&(s=-s),s}function Cc(i,r=3){const t=[];return i.forEach(o=>{const n=o<0?Math.ceil(o):Math.floor(o),s=o<0?60*(n-o):60*(o-n),a=Math.floor(s),l=(60*(s-a)).toFixed(r);t.push(`${n}\xb0 ${a}' ${l}"`)}),t}function pa(i){return(i=Math.round(i))<1e4?i+"":(i=Math.round(i/1e3))<1e3?i+"K":(i=Math.round(i/1e3))+"M"}function ct(i,r=96){return i/(39.3701*r)}function Lr(i){const r=i.originalEvent;return!r.altKey&&(Kf.tK?r.metaKey:r.ctrlKey)&&!r.shiftKey}function ft(i,r=3){return[ii.roundToNDecimal(i[0],r),ii.roundToNDecimal(i[1],r)]}function xc(i,r=3){return ft(i,r).map(t=>t.toString())}class Ir{constructor(r,t,o,n,s){this.options=r,this.messageService=t,this.authInterceptor=o,this.geoDBService=n,this.layerDBService=s,this.legendCollapsed=!0,this.firstLoadComponent=!0,this.olLoadingProblem=!1,this.hasBeenVisible$=new b.X(void 0),this.isInResolutionsRange$=new b.X(!1),this.visible$=new b.X(void 0),this.displayed$=(0,Qe.a)([this.isInResolutionsRange$,this.visible$]).pipe((0,Z.U)(a=>a[0]&&a[1])),this.dataSource=r.source,this.ol=this.createOlLayer(),void 0!==r.zIndex&&(this.zIndex=r.zIndex),r.baseLayer&&void 0===r.visible&&(r.visible=!1),this.maxResolution=r.maxResolution||ct(Number(r.maxScaleDenom)),this.minResolution=r.minResolution||ct(Number(r.minScaleDenom)),this.visible=void 0===r.visible||r.visible,this.opacity=void 0===r.opacity?1:r.opacity,r.legendOptions&&(r.legendOptions.url||r.legendOptions.html)&&(this.legend=this.dataSource.setLegend(r.legendOptions)),this.legendCollapsed=!r.legendOptions||!r.legendOptions.collapsed||r.legendOptions.collapsed,this.ol.set("_layer",this,!0)}get isIgoInternalLayer(){return this.options.isIgoInternalLayer||!1}get id(){return this.options.id||this.dataSource.id}get alias(){return this.options.alias}get title(){return this.options.title}set title(r){this.options.title=r}get zIndex(){return this.ol.getZIndex()}set zIndex(r){this.ol.setZIndex(r)}get baseLayer(){return this.options.baseLayer}set baseLayer(r){this.options.baseLayer=r}get opacity(){return this.ol.get("opacity")}set opacity(r){this.ol.setOpacity(r)}set isInResolutionsRange(r){this.isInResolutionsRange$.next(r)}get isInResolutionsRange(){return this.isInResolutionsRange$.value}set maxResolution(r){this.ol.setMaxResolution(0===r?0:r||1/0),this.updateInResolutionsRange()}get maxResolution(){return this.ol.getMaxResolution()}set minResolution(r){this.ol.setMinResolution(r||0),this.updateInResolutionsRange()}get minResolution(){return this.ol.getMinResolution()}set visible(r){var t,o;this.ol.setVisible(r),this.visible$.next(r),!this.hasBeenVisible$.value&&r&&this.hasBeenVisible$.next(r),(null===(t=this.options)||void 0===t?void 0:t.messages)&&r&&(null===(o=this.options)||void 0===o||o.messages.filter(n=>{var s;return null===(s=n.options)||void 0===s?void 0:s.showOnEachLayerVisibility}).map(n=>this.showMessage(n)))}get visible(){return this.visible$.value}get displayed(){return this.visible&&this.isInResolutionsRange}get showInLayerList(){return!1!==this.options.showInLayerList}setMap(r){this.map=r,this.unobserveResolution(),void 0!==r&&(this.observeResolution(),this.hasBeenVisible$$=this.hasBeenVisible$.subscribe(()=>{this.options.messages&&this.visible&&this.options.messages.map(t=>{this.showMessage(t)})}))}showMessage(r){!this.messageService||(r.title=r.title,r.text=r.text,this.messageService.message(r))}observeResolution(){this.resolution$$=this.map.viewController.resolution$.subscribe(()=>this.updateInResolutionsRange())}unobserveResolution(){void 0!==this.resolution$$&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}updateInResolutionsRange(){if(void 0!==this.map){const r=this.map.viewController.getResolution(),o=void 0===this.maxResolution?1/0:this.maxResolution;this.isInResolutionsRange=r>=this.minResolution&&r<=o}else this.isInResolutionsRange=!1}}var Be=(()=>{return(i=Be||(Be={})).OPACITY="opacity",i.VISIBLE="visible",i.OGCFILTERS="ogcFilters",i.MINRESOLUTION="minResolution",i.MAXRESOLUTION="maxResolution",i.ZINDEX="zIndex",i.TIMEFILTER="timeFilter",Be;var i})(),Wt=(()=>{return(i=Wt||(Wt={})).TITLE="title",i.ABSTRACT="abstract",i.CUSTOM="custom",Wt;var i})();class P_ extends nr{constructor(r,t){super(),this.loaded=0,this.loading=0,this.source=r.options.source.ol,this.id=Ze(),this.messageService=t}watch(){this.source.on("imageloadstart",r=>this.handleLoadStart(r)),this.source.on("imageloadend",r=>this.handleLoadEnd(r)),this.source.on("imageloaderror",r=>this.handleLoadEnd(r)),this.source.on("imageloaderror",r=>this.handleLoadError(r))}unwatch(){this.source.un("imageloadstart",r=>this.handleLoadStart(r)),this.source.un("imageloadend",r=>this.handleLoadEnd(r)),this.source.un("imageloaderror",r=>this.handleLoadEnd(r)),this.source.un("imageloaderror",r=>this.handleLoadError(r))}handleLoadStart(r){r.image.__watchers__||(r.image.__watchers__=[]),r.image.__watchers__.push(this.id),this.loading+=1,this.status=ve.Working}handleLoadEnd(r){if(!r.image.__watchers__)return;const t=r.image.__watchers__.indexOf(this.id);if(t<0)return;r.image.__watchers__.splice(t,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=ve.Done,this.loaded=this.loading=0)}handleLoadError(r){!r.image.__watchers__||(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:r.target.params_.LAYERS}),this.loaded=-1,this.loading=0,this.status=ve.Error)}}function Sc(i){var r,t,o,n;return"mvt"===(null===(r=i.sourceOptions)||void 0===r?void 0:r.type)&&((null===(o=null===(t=i.igoStyle)||void 0===t?void 0:t.styleByAttribute)||void 0===o?void 0:o.hoverStyle)||(null===(n=i.igoStyle)||void 0===n?void 0:n.hoverStyle))&&(i.sourceOptions.featureClass=i.sourceOptions.featureClass||"feature"),i}class wc extends nr{constructor(r){super(),this.loaded=0,this.loading=0,this.source=r.options.source.ol,this.id=Ze()}watch(){this.source.on("tileloadstart",r=>this.handleLoadStart(r)),this.source.on("tileloadend",r=>this.handleLoadEnd(r)),this.source.on("tileloaderror",r=>this.handleLoadEnd(r))}unwatch(){this.source.un("tileloadstart",r=>this.handleLoadStart(r)),this.source.un("tileloadend",r=>this.handleLoadEnd(r)),this.source.un("tileloaderror",r=>this.handleLoadEnd(r))}handleLoadStart(r){r.tile.__watchers__||(r.tile.__watchers__=[]),r.tile.__watchers__.push(this.id),this.loading+=1,this.status=ve.Working}handleLoadEnd(r){if(!r.tile.__watchers__)return;const t=r.tile.__watchers__.indexOf(this.id);if(t<0)return;r.tile.__watchers__.splice(t,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=ve.Done,this.loaded=this.loading=0)}}function Dn(i){return({wms:E_,wmts:J_,xyz:R_,feature:B_,wfs:U_,arcgisrest:da,imagearcgisrest:da,tilearcgisrest:da,osm:o=>"OSM",tiledebug:o=>"tiledebug"}[i.type]||ga)(i)}function E_(i){const r=i.params.LAYERS,t=No(i.url);return ho.V8.hashStr("wms"+t+r)}function J_(i){const r=i.layer,t=No(i.url);return ho.V8.hashStr("wmts"+t+r)}function R_(i){const r=No(i.url);return ho.V8.hashStr("xyz"+r)}function B_(i){if(!i.url)return ga();const r=No(i.url);return ho.V8.hashStr("feature"+r)}function U_(i){if(!i.url||!i.params)return ga();const r=No(i.url);return ho.V8.hashStr("wfs"+r+i.params.featureTypes)}function da(i){const r=i.layer,t=No(i.url);return ho.V8.hashStr((i.type||"arcgis")+t+r)}function ga(i){return Ze()}function No(i){const t=("/"===i.charAt(0)?window.location.origin+i:i).split(/[?&]/);let o=t.shift();const n=t.filter(s=>0!==s.length&&"_"!==s.charAt(0));return n.length&&(o+="?"+n.join("&")),o}class Kt{constructor(r={},t){this.options=r,this.dataService=t,this.options=r,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}generateId(){return Dn(this.options)}getLegend(r,t){return this.legend?this.legend:[]}setLegend(r){return this.legend=r.url?[{url:r.url}]:r.html?[{html:r.html}]:[],this.legend}}class Fe extends Kt{createOlSource(){const r={format:this.getSourceFormatFromOptions(this.options)};return new zt.Z(Object.assign(r,this.options))}getSourceFormatFromOptions(r){if(r.format)return r.format;let t;const o=r.formatType;if(o){if(t=Tr[o],void 0===t)throw new Error("Invalid vector source format ${formatType}.")}else t=be.Z;const n=r.formatOptions;let s;return s=n?new t(n):new t,s}onUnwatch(){}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}}class _o extends Fe{createOlSource(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=super.createOlSource(),new ic.Z(this.options)}generateId(){return Ze()}onUnwatch(){}}class N_ extends nr{constructor(r){super(),this.loaded=0,this.loading=0,this.layer=r,this.id=Ze()}watch(){let r=this.layer.options.source.ol;this.layer.dataSource instanceof _o&&(r=this.layer.options.source.options.source),r.getUrl()&&(r.on("featuresloadstart",t=>this.handleLoadStart(t)),r.on("featuresloadend",t=>this.handleLoadEnd(t)),r.on("featuresloaderror",t=>this.handleLoadEnd(t)))}unwatch(){let r=this.layer.options.source.ol;this.layer.dataSource instanceof _o&&(r=this.layer.options.source.options.source),r.getUrl()&&(r.un("featuresloadstart",t=>this.handleLoadStart(t)),r.un("featuresloadend",t=>this.handleLoadEnd(t)),r.un("featuresloaderror",t=>this.handleLoadEnd(t)))}handleLoadStart(r){this.loading+=1,this.status=ve.Working}handleLoadEnd(r){this.loaded+=1;const t=this.loading;this.loaded>=t&&t===this.loading&&(this.status=ve.Done,this.loaded=this.loading=0)}}class q_ extends Ir{constructor(r,t,o){super(r,t,o),this.messageService=t,this.authInterceptor=o,this.watcher=new P_(this,this.messageService),this.status$=this.watcher.status$,this.status$.subscribe(n=>{0===n&&(this.olLoadingProblem=!0)})}createOlLayer(){const r=Object.assign({},this.options,{source:this.options.source.ol}),t=new Xf.Z(r);return this.authInterceptor&&t.getSource().setImageLoadFunction((o,n)=>{this.customLoader(o,n,this.authInterceptor,this.messageService)}),t}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}customLoader(r,t,o,n){const s=new XMLHttpRequest,a=o.alterUrlWithKeyAuth(t);let l=t;if(a&&(l=a),s.open("GET",l),!o.interceptXhr(s,l))return s.abort(),void(r.getImage().src=l);s.responseType="arraybuffer",s.onload=function(){const u=new Uint8Array(this.response);(new TextDecoder).decode(u).includes("ServiceExceptionReport")&&n.error("igo.geo.dataSource.optionsApiUnavailable","igo.geo.dataSource.unavailableTitle");const d=new Blob([u],{type:"image/png"}),h=window.URL.createObjectURL(d);r.getImage().src=h},s.send()}}class G_ extends Ir{constructor(r,t,o){super(r,t),this.messageService=t,this.authInterceptor=o,this.watcher=new wc(this),this.status$=this.watcher.status$}createOlLayer(){const r=Object.assign({},this.options,{source:this.options.source.ol}),t=new i_.Z(r);return t.getSource().setTileLoadFunction((n,s)=>{this.customLoader(n,s,this.authInterceptor)}),t}customLoader(r,t,o){const n=o.alterUrlWithKeyAuth(t);let s=t;n&&(s=n),r.getImage().src=s}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}}var He=(()=>{return(i=He||(He={})).BasicNumericOperator="basicnumericoperator",i.Basic="basic",i.BasicAndSpatial="basicandspatial",i.Spatial="spatial",i.All="all",i.Time="time",He;var i})(),$=(()=>{return(i=$||($={})).BBOX="BBox",i.PropertyIsBetween="PropertyIsBetween",i.Contains="Contains",i.During="During",i.PropertyIsEqualTo="PropertyIsEqualTo",i.PropertyIsGreaterThan="PropertyIsGreaterThan",i.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",i.Intersects="Intersects",i.PropertyIsNull="PropertyIsNull",i.PropertyIsLessThan="PropertyIsLessThan",i.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",i.PropertyIsLike="PropertyIsLike",i.PropertyIsNotEqualTo="PropertyIsNotEqualTo",i.Within="Within",i.And="And",i.Or="Or",i.Not="Not",$;var i})();class Rt{constructor(){this.filterSequence=[],this.operators={[$.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsLike]:{spatial:!1,fieldRestrict:["string"]},[$.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[$.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[$.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[$.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[$.PropertyIsBetween]:{spatial:!1,fieldRestrict:["number"]},[$.During]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsNull]:{spatial:!1,fieldRestrict:[]},[$.Intersects]:{spatial:!0,fieldRestrict:[]},[$.Within]:{spatial:!0,fieldRestrict:[]},[$.Contains]:{spatial:!0,fieldRestrict:[]}}}defineOgcFiltersDefaultOptions(r,t,o){let n=!0;return o&&"wms"===o&&(n=!1),(r=r||{}).enabled=void 0===r.enabled?n:r.enabled,r.editable=void 0===r.editable?n:r.editable,r.geometryName=t,r.advancedOgcFilters=!0,r.enabled&&(r.pushButtons||r.checkboxes||r.radioButtons||r.select||r.autocomplete)&&(r.advancedOgcFilters=!1),r}buildFilter(r,t,o,n,s){let a,l,c;if(l=!/intersects|contains|within/gi.test(JSON.stringify(r)),r&&(n=void 0!==r.geometryName?r.geometryName:n),t&&r&&(a=ht.VW(n,t,o.getCode())),!r)return"bbox="+t.join(",")+","+o.getCode();r=this.checkIgoFiltersProperties(r,n,o),c=t&&l?ht.xD(a,this.bundleFilter(r,s)):this.bundleFilter(r,s);const u={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:c,outputFormat:"",geometryName:n},p=(new pi.Z).writeGetFeature(u);return"filter="+(new XMLSerializer).serializeToString(p).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]}bundleFilter(r,t){if(r instanceof Array){const o=[];return r.forEach(n=>{o.push(this.bundleFilter(n,t))}),o}return r.hasOwnProperty("logical")?this.createFilter({operator:r.logical,logicalArray:this.bundleFilter(r.filters,t)},t):r.hasOwnProperty("operator")?this.createFilter(r,t):void 0}createFilter(r,t){const o=r.operator,n=r.logicalArray,s=r.propertyName,a=r.pattern,l=!r.matchCase||r.matchCase,c=r.wildCard?r.wildCard:"*",u=r.singleChar?r.singleChar:".",p=r.escapeChar?r.escapeChar:"!",d=r.lowerBoundary,g=r.upperBoundary,h=r.geometryName,m=r.extent,y=r.wkt_geometry,v=r.srsName?r.srsName:"EPSG:3857",S=this.parseFilterOptionDate(r.begin,t?t.minDate:void 0),M=this.parseFilterOptionDate(r.end,t?t.maxDate:void 0),A=r.expression;let F;switch(y&&(F=(new Fn.Z).readGeometry(y,{dataProjection:v,featureProjection:v||"EPSG:3857"})),o.toLowerCase()){case $.BBOX.toLowerCase():return ht.VW(h,m,v);case $.PropertyIsBetween.toLowerCase():return ht.vX(s,d||-1e40,g||1e40);case $.Contains.toLowerCase():return ht.r3(h,F,v);case $.During.toLowerCase():return ht.Q9(s,S,M);case $.PropertyIsEqualTo.toLowerCase():return ht.EW(s,A,l);case $.PropertyIsGreaterThan.toLowerCase():return ht.tS(s,A);case $.PropertyIsGreaterThanOrEqualTo.toLowerCase():return ht.wZ(s,A);case $.Intersects.toLowerCase():return ht.kK(h,F,v);case $.PropertyIsNull.toLowerCase():return ht.Ft(s);case $.PropertyIsLessThan.toLowerCase():return ht.Qj(s,A);case $.PropertyIsLessThanOrEqualTo.toLowerCase():return ht.MK(s,A);case $.PropertyIsLike.toLowerCase():return ht.vL(s,a?a.replace(/[()_]/gi,u):c,c,u,p,l);case $.PropertyIsNotEqualTo.toLowerCase():return ht.eI(s,A,l);case $.Within.toLowerCase():return ht.uh(h,F,v);case $.And.toLowerCase():return ht.xD.apply(null,n);case $.Or.toLowerCase():return ht.or.apply(null,n);case $.Not.toLowerCase():return ht.ff.apply(null,n);default:return}}defineInterfaceFilterSequence(r,t,o="",n=-1){return r instanceof Array?r.forEach(s=>{this.filterSequence.concat(this.defineInterfaceFilterSequence(s,t,o,n))}):r.hasOwnProperty("logical")?this.filterSequence.concat(this.defineInterfaceFilterSequence(r.filters,t,r.logical,n+=1)):r.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(r,t,n,o)),this.filterSequence}computeAllowedOperators(r,t,o){let s,a,l,n={};if(r&&t){const c=r.find(u=>u.name===t);s=c&&c.allowedOperatorsType?c.allowedOperatorsType:o}switch(r&&r.map(c=>{if(!c.allowedOperatorsType)return;const u=c.allowedOperatorsType.toLowerCase();(u===He.All.toLowerCase()||u===He.Spatial.toLowerCase()||u===He.BasicAndSpatial.toLowerCase())&&(a=!0,u===He.All.toLowerCase()&&(l=!0))}),s=s||He.BasicAndSpatial,s.toLowerCase()){case He.All:n=this.operators;break;case He.Spatial:n={[$.Intersects]:{spatial:!0,fieldRestrict:[]},[$.Within]:{spatial:!0,fieldRestrict:[]}};break;case He.BasicAndSpatial:n={[$.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[$.Intersects]:{spatial:!0,fieldRestrict:[]},[$.Within]:{spatial:!0,fieldRestrict:[]}};break;case He.Basic:n={[$.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]}};break;case He.Time:n={[$.During]:{spatial:!1,fieldRestrict:[]}};break;case He.BasicNumericOperator:n={[$.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[$.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[$.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[$.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]}};break;default:n={[$.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[$.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[$.Intersects]:{spatial:!0,fieldRestrict:[]},[$.Within]:{spatial:!0,fieldRestrict:[]}}}return a&&(n.Intersects={spatial:!0,fieldRestrict:[]},n.Within={spatial:!0,fieldRestrict:[]},l&&(n.Contains={spatial:!0,fieldRestrict:[]})),n}addInterfaceFilter(r,t,o=0,n="Or"){r||(r={operator:"PropertyIsEqualTo"});const s={propertyName:"",operator:"",active:"",filterid:Ze(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(s,{parentLogical:n,level:o,geometryName:t},r)}checkIgoFiltersProperties(r,t,o,n=!1){const s=[];return r instanceof Array?(r.forEach(a=>{s.push(this.checkIgoFiltersProperties(a,t,o,n))}),s):r.hasOwnProperty("logical")?Object.assign({},{logical:r.logical,filters:this.checkIgoFiltersProperties(r.filters,t,o,n)}):r.hasOwnProperty("operator")?this.addFilterProperties(r,t,o,n):void 0}addFilterProperties(r,t,o,n=!1){const s=r.hasOwnProperty("filterid")?r.filterid:Ze(),a=r.hasOwnProperty("active")?r.active:n,l=r.hasOwnProperty("srsName")?r.srsName:o?o.getCode():"EPSG:3857";return Object.assign({},{filterid:s,active:a,igoSpatialSelector:"fixedExtent",srsName:l},r,{geometryName:t})}rebuiltIgoOgcFilterObjectFromSequence(r){if(r instanceof Array&&r.length>=1){let o,s,t=r[0].parentLogical,n=[];return r.forEach(a=>{const l=Object.assign({},a),c=r.indexOf(a);o=c>=0&&c<r.length-1?r[c+1]:l,delete l.active,delete l.filterid,delete l.parentLogical,n.push(l),1===r.length?s=l:t!==o.parentLogical&&(1===n.length?console.log("You must set at least two operator in a logical ("+t+")"):(s=Object.assign({},{logical:t,filters:n}),n=[s],t=o.parentLogical))}),s}}computeIgoSelector(r){if(r.groups.every(o=>void 0!==o.computedSelectors))return r;let t;if(r.groups&&r.bundles){if(!r.bundles.every(o=>void 0!==o.id))throw new Error("You must set an id for each of your bundles");t=B.copyDeep(r),t.groups.forEach(o=>{o.title=o.title?o.title:o.name,o.enabled=!!o.enabled&&o.enabled,o.computedSelectors=B.copyDeep(t.bundles.filter(n=>o.ids.includes(n.id)))})}else!r.groups&&r.bundles?(t=B.copyDeep(r),t.groups=[{title:"group1",name:"group1",computedSelectors:B.copyDeep(t.bundles)}]):t={bundles:r,groups:[{title:"group1",name:"group1",computedSelectors:B.copyDeep(r)}],selectorType:t.selectorType};return t.groups.find(o=>o.enabled)||(t.groups[0].enabled=!0),t}handleOgcFiltersAppliedValue(r,t,o,n){const s=r.ogcFilters;if(!s)return;const a=[];let l="",c="";if(s.enabled&&(s.pushButtons||s.checkboxes||s.radioButtons||s.select||s.autocomplete)){let p;if(s.pushButtons){p=s.pushButtons;const d=this.formatGroupAndFilter(s,p);for(const g of d)a.push(g)}if(s.checkboxes){p=s.checkboxes;const d=this.formatGroupAndFilter(s,p);for(const g of d)a.push(g)}if(s.radioButtons){p=s.radioButtons;const d=this.verifyMultipleEnableds(p),g=this.formatGroupAndFilter(s,d);for(const h of g)a.push(h)}if(s.select){p=s.select;const d=this.verifyMultipleEnableds(p),g=this.formatGroupAndFilter(s,d);for(const h of g)a.push(h)}if(s.autocomplete){p=s.autocomplete;const d=this.formatGroupAndFilter(s,p);for(const g of d)a.push(g)}a.length>=1&&(l=this.buildFilter(1===a.length?a[0]:{logical:"And",filters:a},o,n,s.geometryName))}s.enabled&&s.filters&&(s.geometryName=s.geometryName||t,c=this.buildFilter(s.filters,o,n,s.geometryName,r));let u=s.advancedOgcFilters?c:l;return"wms"===r.type&&(u=this.formatProcessedOgcFilter(u,r.params.LAYERS)),"wfs"===r.type&&(u=this.formatProcessedOgcFilter(u,r.params.featureTypes)),u}verifyMultipleEnableds(r){return r.bundles.forEach(t=>{if(!t.multiple&&t.selectors){const o=t.selectors.reduce((n,s,a)=>!0===s.enabled?n.concat(a):n,[]);o.length>1&&(o.splice(0,1),o.forEach(n=>{t.selectors[n].enabled=!1}))}}),r}formatGroupAndFilter(r,t){const o=(t=this.computeIgoSelector(t)).groups.find(s=>s.enabled).computedSelectors,n=[];return o.map(s=>{const a=[],l=s.selectors;!l||(l.filter(c=>!0===c.enabled).forEach(c=>a.push(c.filters)),1===a.length?n.push(a[0]):a.length>1&&n.push({logical:s.logical,filters:a}))}),"pushButton"===t.selectorType?r.pushButtons=t:"checkbox"===t.selectorType?r.checkboxes=t:"radioButton"===t.selectorType?r.radioButtons=t:"select"===t.selectorType?r.select=t:"autocomplete"===t.selectorType&&(r.autocomplete=t),n}formatProcessedOgcFilter(r,t){if(!r)return;let o="";return 0===r.length&&-1===t.indexOf(",")?o=r:t.split(",").forEach(s=>{o=`${o}(${r.replace("filter=","")})`}),o=o.replace(/\(\)/g,""),o.length>0?o.replace("filter=",""):void 0}parseFilterOptionDate(r,t){return r?"today"===r?void 0:E(r).isValid()?r:void 0:t}}const Tc="EPSG:3857",Qi=5e3,ma="geometry",Fc=new RegExp(/(.*)?gml(.*)?/gi);function Ac(i,r,t,o,n){const s=i.paramsWFS,a=ha(i,void 0,i.paramsWFS.srsName);let l;o&&o.enabled&&(l=o.filters);const c=new Rt,u=c.buildFilter(l,r,t,o.geometryName,i);let p=c.handleOgcFiltersAppliedValue(i,o.geometryName,r,t),d="filter";p||(d="bbox",p=r.join(",")+","+t.getCode()),s.xmlFilter=o.advancedOgcFilters?u:`${d}=${p}`;let g=a.find(m=>"getfeature"===m.name).value;return g=/(filter|bbox)=.*/gi.test(s.xmlFilter)?`${g}&${s.xmlFilter}`:g,i.download=Object.assign({},i.download,{dynamicUrl:g}),n&&(g+=`$&_t${(new Date).getTime()}`),g.replace(/&&/g,"&")}function ha(i,r,t,o,n=0,s=!1){const a="2.0.0",l=i.urlWfs,c=i.paramsWFS,u=r||Qi,p=c.version===a?`startIndex=${n}`:"",d=t||Tc;let g=c.outputFormat?`outputFormat=${c.outputFormat}`:"",h=c.version?`version=${c.version}`:"version=2.0.0";const y=`${c.version===a?"typenames":"typename"}=${c.featureTypes}`,v=c.version===a?"count":"maxFeatures";let S=r?`${v}=${u}`:c.maxFeatures?`${v}=${c.maxFeatures}`:`${v}=${u}`;s&&(g="",h="version=1.1.0",S=S.replace("count","maxFeatures"));const M=t?`srsname=${d}`:c.srsName?"srsname="+c.srsName:`srsname=${d}`;let A="",F="";o&&(A=`propertyName=${o}`,F=`valueReference=${o}`);const k=i.sourceFields;if(!A&&k&&k.length>0){const ge=[];i.sourceFields.forEach(xe=>{ge.push(xe.name)}),A=`propertyName=${ge.join(",")},${c.fieldNameGeometry}`}const ne=-1===l.indexOf("?")?"?":"&";let z=`${l}${ne}service=WFS&request=GetFeature&${h}&${y}&`;z+=`${g}&${M}&${S}&${A}&${p}`;let de=`${l}?service=WFS&request=GetPropertyValue&version=${a}&${y}&`;return de+=`&${S}&${F}`,[{name:"outputformat",value:g},{name:"version",value:h},{name:"typename",value:y},{name:"count",value:S},{name:"srsname",value:M},{name:"propertyname",value:A},{name:"valuereference",value:F},{name:"getcapabilities",value:`${l}${ne}service=WFS&request=GetCapabilities&${h}`.replace(/&&/g,"&")},{name:"getfeature",value:z.replace(/&&/g,"&")},{name:"getpropertyvalue",value:de.replace(/&&/g,"&")}]}function Lc(i,r){r&&"wfs"===r&&(i.paramsWFS=i.params);const t=i.paramsWFS;let o;return i.urlWfs=i.urlWfs||i.url,t.version=t.version||"2.0.0",t.fieldNameGeometry=t.fieldNameGeometry||ma,t.maxFeatures=t.maxFeatures||Qi,t.outputFormat&&(o=t.outputFormat),(Fc.test(o)||!o)&&(t.version="1.1.0"),Object.assign({},i)}function fa(i){const r=i;let t;const o=r.paramsWFS.outputFormat?r.paramsWFS.outputFormat:void 0;return o?Tr[o]?(t=Tr[o],new t(r.formatOptions)):o.toLowerCase().match("gml2")?(t=pi.Z,new t(Object.assign(Object.assign({},r.formatOptions),{gmlFormat:la.Z}))):o.toLowerCase().match("gml32")?(t=pi.Z,new t(Object.assign(Object.assign({},r.formatOptions),{gmlFormat:n_.Z}))):o.toLowerCase().match("gml3")?(t=pi.Z,new t(Object.assign(Object.assign({},r.formatOptions),{gmlFormat:sc.Z}))):o.toLowerCase().match("topojson")?(t=e_.Z,new t(r.formatOptions)):o.toLowerCase().match("geojson")?(t=be.Z,new t(r.formatOptions)):o.toLowerCase().match("esrijson")?(t=Mr.Z,new t(r.formatOptions)):o.toLowerCase().match("json")?(t=be.Z,new t(r.formatOptions)):o.toLowerCase().match("gpx")?(t=sa.Z,new t(r.formatOptions)):o.toLowerCase().match("WKT")?(t=Fn.Z,new t(r.formatOptions)):o.toLowerCase().match("osmxml")?(t=r_.Z,new t(r.formatOptions)):o.toLowerCase().match("kml")?(t=aa.ZP,new t(r.formatOptions)):new t:(t=pi.Z,new t(r.formatOptions))}var Or=(()=>{return(i=Or||(Or={})).System="system",i.User="user",Or;var i})();class Te extends Ir{constructor(r,t,o,n,s,a){super(r,t,o,s,a),this.messageService=t,this.authInterceptor=o,this.geoNetworkService=n,this.geoDBService=s,this.layerDBService=a,this.watcher=new N_(this),this.status$=this.watcher.status$}get browsable(){return!1!==this.options.browsable}get exportable(){return!1!==this.options.exportable}createOlLayer(){var r,t,o,n,s,a,l;const c=this.options.opacity||1,u=!1!==this.options.visible,p=this.options.minResolution||ct(Number(this.options.minScaleDenom)),d=this.options.maxResolution||ct(Number(this.options.maxScaleDenom)),g=this.options.sourceOptions;this.dataSource instanceof Fe&&((null===(r=null==g?void 0:g.preload)||void 0===r?void 0:r.bypassResolution)||(null===(t=null==g?void 0:g.preload)||void 0===t?void 0:t.bypassVisible))&&(this.options.opacity=0,g.preload.bypassResolution&&(this.options.minResolution||this.options.maxResolution)&&(this.options.minResolution=0,this.options.maxResolution=1/0),g.preload.bypassVisible&&!u&&(this.options.visible=!0));const h=Object.assign({},this.options,{source:this.options.source.ol});this.options.animation&&this.dataSource.ol.on("addfeature",function(S){this.flash(S.feature)}.bind(this)),(null===(o=this.options.idbInfo)||void 0===o?void 0:o.storeToIdb)&&this.geoDBService&&(this.options.idbInfo.firstLoad&&this.maintainFeaturesInIdb(),this.dataSource.ol.once("featuresloadend",()=>{this.dataSource.ol.on("addfeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("changefeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("clear",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("removefeature",()=>this.maintainFeaturesInIdb())})),this.dataSource instanceof Fe&&((null===(n=null==g?void 0:g.preload)||void 0===n?void 0:n.bypassResolution)||(null===(s=null==g?void 0:g.preload)||void 0===s?void 0:s.bypassVisible))&&this.dataSource.ol.once("featuresloadend",()=>{c&&(this.opacity=c),g.preload.bypassResolution&&(this.minResolution=p,this.maxResolution=d),g.preload.bypassVisible&&(this.visible=u)}),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);const m=new Jo.Z(h),y=m.getSource(),v=y.getUrl();if(v){let S;const M=h.sourceOptions;S="wfs"===(null==M?void 0:M.type)&&(M.params||M.paramsWFS)?(A,F,k,ne,se)=>{this.customWFSLoader(y,M,this.authInterceptor,A,F,k,ne,se)}:(A,F,k,ne,se)=>{this.customLoader(y,v,this.authInterceptor,A,F,k,ne,se)},S&&y.setLoader(S)}else if((null===(a=this.options.idbInfo)||void 0===a?void 0:a.storeToIdb)&&this.geoDBService){const S=(M,A,F,k,ne)=>{this.customIDBLoader(y,h.id,M,F,k,ne)};S&&y.setLoader(S)}return(null===(l=this.options.idbInfo)||void 0===l?void 0:l.storeToIdb)&&this.geoDBService&&m.once("sourceready",()=>{this.options.idbInfo.firstLoad&&this.maintainOptionsInIdb(),(0,lo.R)(m,"change").pipe((0,fe.b)(750)).subscribe(()=>this.maintainOptionsInIdb()),m.on("change:zIndex",()=>this.maintainOptionsInIdb())}),m}removeLayerFromIDB(){this.geoDBService&&this.layerDBService&&(0,Sn.$)(this.geoDBService.deleteByKey(this.id),this.layerDBService.deleteByKey(this.id)).subscribe()}maintainOptionsInIdb(){this.options.igoStyle.igoStyleObject=function Q_(i){const r=i.getStyle();return"function"==typeof r||r instanceof Array?void 0:{fill:{color:r.getFill().getColor()},stroke:{color:r.getStroke().getColor(),width:2},circle:{fill:{color:r.getImage().getFill().getColor()},stroke:{color:r.getImage().getStroke().getColor(),width:2},radius:5}}}(this.ol);const r={layerId:this.id,detailedContextUri:this.options.idbInfo.contextUri,sourceOptions:{id:this.id,type:"vector",queryable:!0},layerOptions:{zIndex:this.ol?this.zIndex:1e6,id:this.id,isIgoInternalLayer:this.isIgoInternalLayer,title:this.title,igoStyle:this.options.igoStyle,idbInfo:Object.assign({},this.options.idbInfo,{firstLoad:!1})},insertEvent:`${this.title}-${this.id}-${new Date}`};this.layerDBService.update(r)}maintainFeaturesInIdb(){const r=this.dataSource.ol.getFeatures(),t=JSON.parse((new be.Z).writeFeatures(r,{dataProjection:"EPSG:4326",featureProjection:this.dataSource.ol.getProjection()||"EPSG:3857"}));this.geoDBService.update(this.id,this.id,t,Or.User,`${this.title}-${this.id}-${new Date}`)}flash(r){const t=(new Date).getTime(),o=this.ol.on("postrender",function n(s){const a=(0,An.u3)(s),l=s.frameState,c=r.getGeometry().clone(),u=l.time-t,p=u/this.options.animation.duration,d=(0,Ui.Vv)(1-p),g=(0,fo._2)(this.options.animation.color||"red");g[3]=d;let h=this.ol.getStyleFunction().call(this,r).find(y=>y.getImage());h||(h=this.ol.getStyleFunction().call(this,r)[0]);const m=h.clone();switch(r.getGeometry().getType()){case"Point":if(null!==m.getImage()&&"function"==typeof m.getImage().getRadius){const y=(0,Ui.Vv)(p)*(3*m.getImage().getRadius());m.getImage().setRadius(y),m.getImage().setOpacity(d)}break;case"LineString":m.getImage()&&(m.getImage().getStroke().setColor(g),m.getImage().getStroke().setWidth((0,Ui.Vv)(p)*(3*m.getImage().getStroke().getWidth()))),m.getStroke()&&(m.getStroke().setColor(g),m.getStroke().setWidth((0,Ui.Vv)(p)*(3*m.getStroke().getWidth())));break;case"Polygon":m.getImage()&&m.getImage().getFill().setColor(g),m.getFill()&&m.getFill().setColor(g)}if(m.setText(""),a.setStyle(m),a.drawGeometry(c),u>this.options.animation.duration)return(0,et.B)(o),void this.map.ol.render();this.map.ol.render()}.bind(this))}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}setExtent(r){this.options.extent=r}onUnwatch(){this.dataSource.onUnwatch(),this.stopAnimation()}stopAnimation(){this.dataSource.ol.un("addfeature",function(r){this.visible&&this.flash(r.feature)}.bind(this))}enableTrackFeature(r){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,r))}centerMapOnFeature(r){const t=this.dataSource.ol.getFeatureById(r);t&&this.map.ol.getView().setCenter(t.getGeometry().getCoordinates())}trackFeature(r,t){t.feature.getId()===r&&this.visible&&this.centerMapOnFeature(r)}disableTrackFeature(r){(0,et.B)(this.trackFeatureListenerId)}customWFSLoader(r,t,o,n,s,a,l,c,u){{const p=t.paramsWFS,d=p.srsName?new Ni.Z({code:p.srsName}):a,g=V.$A(n,a,d);p.srsName=p.srsName||a.getCode();const h=Ac(t,g,d,t.ogcFilters,u);let m=0;if("2.0.0"===p.version&&p.maxFeatures>Qi)for(;m<p.maxFeatures;){let v=h.replace("count="+p.maxFeatures,"count=1000");v=v.replace("startIndex=0","0"),v+="&startIndex="+m,v.replace(/&&/g,"&"),this.getFeatures(r,o,g,d,a,v,1e3,l,c),m+=1e3}else this.getFeatures(r,o,g,d,a,h,p.maxFeatures,l,c)}}getFeatures(r,t,o,n,s,a,l,c,u){const p=this.dataSource.mostRecentIdCallOGCFilter,d=new XMLHttpRequest,g=t.alterUrlWithKeyAuth(a);let h=a;g&&(h=g),d.open("GET",h),t&&t.interceptXhr(d,h);const m=()=>{r.removeLoadedExtent(o),u()};d.onerror=m,d.onload=()=>{if(200===d.status&&d.responseText.length>0){const y=r.getFormat().readFeatures(d.responseText,{dataProjection:n,featureProjection:s});p===this.dataSource.mostRecentIdCallOGCFilter?(r.addFeatures(y),c(y)):c([])}else m()},d.send()}customLoader(r,t,o,n,s,a,l,c){const u=new XMLHttpRequest;let p=t;if("function"!=typeof t){const d=o.alterUrlWithKeyAuth(t);d&&(p=d)}else p=t(n,s,a);if(this.geoNetworkService&&"function"!=typeof t){let h=r.getFormat().getType();const m=()=>{r.removeLoadedExtent(n),c()},y={responseType:h};this.geoNetworkService.geoDBService.get(t).pipe((0,Hf.g)(750)).pipe((0,Vt.b)(v=>v?(0,X.of)(v):this.geoNetworkService.get(p,y).pipe((0,Gt.P)(),(0,he.K)(S=>{throw m(),S})))).subscribe(v=>{if(v){const S=r.getFormat(),M=S.getType();let A;if("json"===M||"text"===M?A=v:"xml"===M?(A=v,A||(A=(new DOMParser).parseFromString(v,"application/xml"))):"arraybuffer"===M&&(A=v),A){const F=S.readFeatures(A,{extent:n,featureProjection:a});r.addFeatures(F,S.readProjection(A)),l(F)}else m()}})}else{u.open("GET",p);const d=r.getFormat();"arraybuffer"===d.getType()&&(u.responseType="arraybuffer"),o&&o.interceptXhr(u,p);const g=()=>{r.removeLoadedExtent(n),c()};u.onerror=g,u.onload=()=>{if(!u.status||u.status>=200&&u.status<300){const h=d.getType();let m;if("json"===h||"text"===h?m=u.responseText:"xml"===h?(m=u.responseXML,m||(m=(new DOMParser).parseFromString(u.responseText,"application/xml"))):"arraybuffer"===h&&(m=u.response),m){const y=d.readFeatures(m,{extent:n,featureProjection:a});r.addFeatures(y,d.readProjection(m)),l(y)}else g()}else g()},u.send()}}customIDBLoader(r,t,o,n,s,a){if(this.geoNetworkService){const l=()=>{r.removeLoadedExtent(o),a()};this.geoNetworkService.geoDBService.get(t).subscribe(c=>{if(c){const u=r.getFormat(),p=u.getType();let d;if("json"===p||"text"===p?d=c:"xml"===p?(d=c,d||(d=(new DOMParser).parseFromString(c,"application/xml"))):"arraybuffer"===p&&(d=c),d){const g=u.readFeatures(d,{extent:o,featureProjection:n});r.addFeatures(g,u.readProjection(d)),s(g)}else l()}})}}}class Ic extends Ir{constructor(r,t,o){super(r,t,o),this.messageService=t,this.authInterceptor=o,this.watcher=new wc(this),this.status$=this.watcher.status$}createOlLayer(){const r=Object.assign({},this.options,{source:this.options.source.ol}),t=new Fr.Z(r);return t.getSource().setTileLoadFunction((n,s)=>{const a=this.customLoader(s,n.getFormat(),this.authInterceptor,n.onLoad.bind(n));a&&n.setLoader(a)}),t}customLoader(r,t,o,n,s){return(a,l,c)=>{const u=new XMLHttpRequest;let p=r;if("function"!=typeof r){const d=o.alterUrlWithKeyAuth(r);d&&(p=d)}else p=r(a,l,c);u.open("GET",p),o&&o.interceptXhr(u,p),"arraybuffer"===t.getType()&&(u.responseType="arraybuffer"),u.onload=d=>{if(!u.status||u.status>=200&&u.status<300){const g=t.getType();let h;"json"===g||"text"===g?h=u.responseText:"xml"===g?(h=u.responseXML,h||(h=(new DOMParser).parseFromString(u.responseText,"application/xml"))):"arraybuffer"===g&&(h=u.response),h?n.call(this,t.readFeatures(h,{extent:a,featureProjection:c}),t.readProjection(h)):s.call(this)}else s.call(this)},u.onerror=()=>{s.call(this)},u.send()}}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}}const le="Feature";var Y=(()=>{return(i=Y||(Y={}))[i.None=0]="None",i[i.Move=1]="Move",i[i.Zoom=2]="Zoom",i[i.Default=3]="Default",Y;var i})();class Oc extends Kt{createOlSource(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new a_.Z(this.options)}onUnwatch(){}}class Zc extends Kt{createOlSource(){return new l_.Z(this.options)}onUnwatch(){}}class ji extends Kt{constructor(r,t,o){super(Lc(r,"wfs")),this.options=r,this.wfsService=t,this.authInterceptor=o,this.mostRecentIdCallOGCFilter=0;const n=this.options.ogcFilters,s=this.options.paramsWFS.fieldNameGeometry||ma,a=new Rt;this.options.ogcFilters=a.defineOgcFiltersDefaultOptions(n,s),this.options.ogcFilters.enabled&&this.options.ogcFilters.editable&&(r.sourceFields||[]).filter(l=>!l.values).length>0&&this.wfsService.getSourceFieldsFromWFS(this.options),null!=n&&n.pushButtons&&(n.pushButtons.selectorType="pushButton"),null!=n&&n.checkboxes&&(n.checkboxes.selectorType="checkbox"),null!=n&&n.radioButtons&&(n.radioButtons.selectorType="radioButton"),null!=n&&n.select&&(n.select.selectorType="select"),null!=n&&n.autocomplete&&(n.autocomplete.selectorType="autocomplete"),this.setOgcFilters(this.options.ogcFilters,!0)}set ogcFilters(r){this.options.ogcFilters=r}get ogcFilters(){return this.options.ogcFilters}createOlSource(){return new zt.Z({format:fa(this.options),url:(t,o,n)=>{const s=this.options.paramsWFS,a=s.srsName?new Ni.Z({code:s.srsName}):n,l=this.options.ogcFilters,c=V.$A(t,n,a);return s.srsName=s.srsName||n.getCode(),Ac(this.options,c,a,l)},strategy:ac.VW})}setOgcFilters(r,t=!1){this.ogcFilters=r,this.mostRecentIdCallOGCFilter+=1,t&&this.ol.notify("ogcFilters",this.ogcFilters)}onUnwatch(){}}let Y_=(()=>{class i extends class j_{}{constructor(t){super(),this.http=t}getData(){return console.log("This is defining a data service."),"This is defining a data service."}getSourceFieldsFromWFS(t){t.sourceFields&&0!==t.sourceFields.length?this.defineFieldAndValuefromWFS(t).subscribe(o=>{t.sourceFields.forEach(n=>{void 0===n.alias&&(n.alias=n.name),(void 0===n.values||0===n.values.length)&&(n.values=o.find(s=>s.name===n.name).values)})}):(t.sourceFields=[],this.defineFieldAndValuefromWFS(t).subscribe(o=>{t.sourceFields=o}))}wfsGetFeature(t,o=Qi,n=Tc,s,a=0,l=!1){const u=ha(t,o,n,s,a,l).find(d=>"getfeature"===d.name).value,p=t.paramsWFS.outputFormat;return l||Fc.test(p)||!p?this.http.get(u,{responseType:"text"}):this.http.get(u)}defineFieldAndValuefromWFS(t){return new Ke.y(o=>{var n;const s=[];let a,l,c,u,p;u=fa(t);const d=JSON.parse(JSON.stringify(t));delete d.paramsWFS.outputFormat,delete d.formatOptions,p=fa(d);let g=null===(n=t.sourceFields)||void 0===n?void 0:n.filter(h=>!h.values).map(h=>h.name);this.wfsGetFeature(t,1,void 0,void 0,0,!0).pipe((0,Vt.b)(h=>String(h).toLowerCase().includes("exception")?(0,X.of)(!1):(0,X.of)(!0)),(0,Vt.b)(h=>this.wfsGetFeature(t,1).pipe((0,Vt.b)(m=>{const y=u.readFeatures(m);a=y[0].getKeys(),(t.sourceFields||0===t.sourceFields.length)&&(g=a),l=a.filter(M=>g.includes(M)&&M!==y[0].getGeometryName()&&!M.match(/boundedby/gi)),c=l.join(",");const v=[];let S=0;if(!h&&"2.0.0"===t.paramsWFS.version&&t.paramsWFS.maxFeatures>Qi){for(;S<t.paramsWFS.maxFeatures;)v.push(this.wfsGetFeature(t,1e3,t.paramsWFS.srsName,c,S)),S+=1e3;p=u}else v.push(this.wfsGetFeature(t,t.paramsWFS.maxFeatures||Qi,t.paramsWFS.srsName,c,0,!0));return(0,Qe.a)(v)})))).subscribe(h=>{let m=[];h.map(y=>{const v=p.readFeatures(y);m=m.concat(v)}),this.built_properties_value(m).forEach(y=>{s.push(y)}),o.next(s),o.complete()})})}built_properties_value(t){if(0===t.length)return[];const o=Object.assign({},t[0].getProperties());delete o[t[0].getGeometryName()],delete o.boundedBy;const n=[];for(const s in o)if(o.hasOwnProperty(s)){const a="object"==typeof t[0].get(s)?void 0:typeof t[0].get(s);n.push({name:s,alias:s,type:a,values:[o[s]]})}return t.every(s=>{const a=s.getProperties();for(const l in a)a.hasOwnProperty(l)&&l in o&&n.filter(c=>c.name===l).forEach(c=>{-1===c.values.indexOf(a[l])&&c.values.push(a[l])});return!0}),n}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var qe=(()=>{return(i=qe||(qe={})).GML2="gml2",i.GML3="gml3",i.JSON="json",i.GEOJSON="geojson",i.GEOJSON2="geojson2",i.ESRIJSON="esrijson",i.TEXT="text",i.HTML="html",i.HTMLGML2="htmlgml2",qe;var i})(),Xt=(()=>{return(i=Xt||(Xt={})).GML2="application/vnd.ogc.gml",i.GML3="application/vnd.ogc.gml/3.1.1",i.JSON="application/json",i.GEOJSON="application/geojson",i.GEOJSON2="geojson",i.ESRIJSON="application/json",i.TEXT="text/plain",i.HTML="text/html",i.HTMLGML2="text/html",Xt;var i})(),io=(()=>{return(i=io||(io={})).IFRAME="iframe",i.BLANK="_blank",io;var i})();class Bt extends Kt{constructor(r,t){super(r),this.options=r,this.wfsService=t,this.timeFilter$=new b.X(void 0);const o=r.params,n=o.DPI||96;o.DPI=n,o.MAP_RESOLUTION=n,o.FORMAT_OPTIONS="dpi:"+n,r.refreshIntervalSec&&r.refreshIntervalSec>0&&setInterval(()=>{this.refresh()},1e3*r.refreshIntervalSec);let s=ma;if(r.paramsWFS){const p=Lc(r,"wms");B.mergeDeep(r.paramsWFS,p.paramsWFS),s=r.paramsWFS.fieldNameGeometry||s,r.download=Object.assign({},r.download,{dynamicUrl:this.buildDynamicDownloadUrlFromParamsWFS(r)})}r.sourceFields&&0!==r.sourceFields.length?r.sourceFields.forEach(p=>{p.alias=p.alias?p.alias:p.name}):r.sourceFields=[];const a=r.ogcFilters,l=new Rt;a?(a.advancedOgcFilters=!(a.pushButtons||a.checkboxes||a.radioButtons||a.select||a.autocomplete),a.advancedOgcFilters&&a.filters&&a.filters.calendarModeYear&&(a.advancedOgcFilters=!1),a.pushButtons&&(a.pushButtons.selectorType="pushButton"),a.checkboxes&&(a.checkboxes.selectorType="checkbox"),a.radioButtons&&(a.radioButtons.selectorType="radioButton"),a.select&&(a.select.selectorType="select"),a.autocomplete&&(a.autocomplete.selectorType="autocomplete")):r.ogcFilters=l.defineOgcFiltersDefaultOptions(a,s,"wms"),o.LAYERS.split(",").length>1&&a&&a.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+o.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),r.paramsWFS&&a&&a.enabled&&a.editable&&(r.sourceFields||[]).filter(p=>!p.values).length>0&&this.wfsService.getSourceFieldsFromWFS(r);const c=l.handleOgcFiltersAppliedValue(r,s);o.FILTER=c,this.ol.updateParams({FILTER:o.FILTER}),this.setOgcFilters(a,!0),(null==r?void 0:r.timeFilterable)&&(null==r?void 0:r.timeFilter)&&this.setTimeFilter(r.timeFilter,!0)}get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:io.BLANK}set ogcFilters(r){this.options.ogcFilters=r}get ogcFilters(){return this.options.ogcFilters}set timeFilter(r){this.options.timeFilter=r}get timeFilter(){return this.options.timeFilter}refresh(){this.ol.updateParams({igoRefresh:Math.random()})}buildDynamicDownloadUrlFromParamsWFS(r){return ha(r).find(n=>"getfeature"===n.name).value}createOlSource(){return new c_.Z(Object.assign({ratio:1},this.options))}setOgcFilters(r,t=!1){this.ogcFilters=r,t&&this.ol.notify("ogcFilters",this.ogcFilters)}setTimeFilter(r,t=!1){this.timeFilter=r,t&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}getLegend(r,t){let o=super.getLegend();if(o.length>0&&void 0===r&&(null==t||!t.scale))return o;let s,n=!1;(null==t?void 0:t.size)&&(null==t?void 0:t.extent)&&(null==t?void 0:t.projection)&&this.options.contentDependentLegend&&(s="1.3.0"===this.params.VERSION||void 0===this.params.VERSION?"CRS":"SRS",n=!0);const a=this.params;let l=[];void 0!==a.LAYERS&&(l=a.LAYERS.split(","));const c=this.options.url.replace(/\?$/,""),u=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0",`VERSION=${a.VERSION||"1.3.0"}`];return void 0!==r&&u.push(`STYLE=${r}`),void 0!==(null==t?void 0:t.scale)&&u.push(`SCALE=${t.scale}`),n&&(u.push(`WIDTH=${t.size[0]}`),u.push(`HEIGHT=${t.size[1]}`),u.push(`BBOX=${t.extent.join(",")}`),u.push(`${s}=${t.projection}`)),o=l.map(p=>{const d=c.match(/\?/)?"&":"?";return{url:`${c}${d}${u.join("&")}&LAYER=${p}`,title:l.length>1?p:void 0,currentStyle:void 0===r?void 0:r}}),o}onUnwatch(){}}function H_(i){const t=V.U2(i||"EPSG:3857").getExtent(),o=(0,Je.dz)(t)/256,n=new Array(20),s=new Array(20);for(let a=0;a<20;++a)n[a]=o/Math.pow(2,a),s[a]=a;return new u_.Z({origin:(0,Je.rL)(t),resolutions:n,matrixIds:s})}class _a extends Kt{constructor(r){super(r)}createOlSource(){const r=Object.assign({tileGrid:H_(this.options.projection)},this.options);return new lc.Z(r)}onUnwatch(){}}class Zr extends Kt{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:io.BLANK}createOlSource(){const t=Object.assign({crossOrigin:this.options.crossOrigin?this.options.crossOrigin:"anonymous"},this.options);return new p_.Z(t)}getLegend(){const r=super.getLegend();if(r.length>0)return r;let t="<table>";if(null!==this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(o=>{!0===o.visible&&(t+='<tr><td><p><font size="5" color="'+o.value+'"> &#9679</font></p></td><td>'+o.name+"</td></tr>")}),t+="</table>",[{html:t}];{const o=this.options.config.layers[0].options,n=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];for(const s of n)if(o.cartocss.includes(s)){const a=o.cartocss.split(s).pop(),l=a.substr(0,a.indexOf(";"));if(l.includes("ramp")){const c=l.split(", (")[1].split(","),u=l.split(", (")[2].split(",");for(let p=0;p<c.length;p++)c[p]=c[p].replace(/("|\))/g,""),u[p]=u[p].replace(/("|\))/g,""),"="===u[p].replace(/\s+/g,"")&&(u[p]="Autres"),t+='<tr><td><p><font size="5" color="'+c[p]+'"> &#9679</font></p></td><td>'+u[p]+"</td></tr>";break}t+='<tr><td><p><font size="5" color="'+l+'"> &#9679</font></p></td><td>'+(o.layer_name?o.layer_name:"")+"</td></tr>";break}return t+="</table>",[{html:t}]}}onUnwatch(){}}class ya extends Kt{createOlSource(){const r=new Mr.Z;return new zt.Z({attributions:this.options.params.attributions,overlaps:!1,format:r,url:function(t,o,n){const s=this.options.url+"/"+this.options.layer+"/query/",l=["f=json",`geometry=${encodeURIComponent('{"xmin":'+t[0]+',"ymin":'+t[1]+',"xmax":'+t[2]+',"ymax":'+t[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];return this.options.params.time&&l.push(`time=${this.options.params.time}`),this.options.params.customParams&&this.options.params.customParams.forEach(c=>{l.push(c)}),`${s}?${l.join("&")}`}.bind(this),strategy:ac.VW})}getLegend(){const r=this.options.legendInfo,t=super.getLegend();if(void 0===r||t.length>0)return t;if(!r)return;let n,s,a,o="<table>";if(r.legend)for(const l of r.legend)n=this.htmlImgSrc(l.contentType,l.imageData),s=l.label?l.label.replace("<Null>","Null"):"",o+="<tr><td align='left'><img src=\""+n+'" alt =\'\' /></td><td class="mat-typography">'+s+"</td></tr>";else if("uniqueValue"===r.type)for(const l of r.uniqueValueInfos)s=l.label.replace("<Null>","Null"),"esriPMS"===l.symbol.type?(n=this.htmlImgSrc(l.symbol.contentType,l.symbol.imageData),o+="<tr><td align='left'><img src=\""+n+'" alt =\'\' /></td><td class="mat-typography">'+s+"</td></tr>"):"esriPMS"!==l.symbol.type&&(a=this.createSVG(l.symbol),o+="<tr><td align='left'>"+a+'</td><td class="mat-typography">'+s+"</td></tr>");else"simple"===r.type&&(s=r.label?r.label.replace("<Null>","Null"):"","esriPMS"===r.symbol.type?(n=this.htmlImgSrc(r.symbol.contentType,r.symbol.imageData),o+="<tr><td align='left'><img src=\""+n+'" alt =\'\' /></td><td class="mat-typography">'+s+"</td></tr>"):"esriPMS"!==r.symbol.type&&(a=this.createSVG(r.symbol),o+="<tr><td align='left'>"+a+'</td><td class="mat-typography">'+s+"</td></tr>"));return o+="</table>",[{html:o}]}htmlImgSrc(r,t){return`data:${r};base64,${t}`}createSVG(r){let t="";const o=r.color?r.color:[0,0,0,0];if("esriSLS"===r.type){const s="stroke:rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")",a="stroke-width:"+(r.width?r.width:0);"esriSLSSolid"===r.style?t='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+s+";"+a+'"/></svg>':"esriSLSDash"===r.style&&(t='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+s+";"+a+'" stroke-dasharray="5,5"/></svg>')}else if("esriSMSCircle"===r.style||"esriSFSSolid"===r.style){const n=r.outline.color,a=r.size,l="stroke:rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")",c="stroke-width:"+r.outline.width,u="fill:rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")";t="esriSMSCircle"===r.style?'<svg height="30" width="30"><circle cx="15" cy="15" r="'+a/2+'" style="'+l+";"+c+";"+u+'"/></svg>':'<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+l+";"+c+";"+u+'"/></svg>'}return t}onUnwatch(){}}class va extends Kt{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:io.BLANK}createOlSource(){const r=void 0===this.options.layer?this.options.params:Object.assign({LAYERS:`show:${this.options.layer}`},this.options.params);return"object"==typeof r.renderingRule&&(r.renderingRule=JSON.stringify(r.renderingRule)),new d_.Z({ratio:1,params:r,url:this.options.url})}getLegend(){const r=this.options.legendInfo,t=super.getLegend();if(void 0===r||void 0===this.options.layer||t.length>0)return t;if(!r)return;let o="<table>";for(const n of r.legend)o+=`<tr><td align='left'><img src="${this.options.url}/${r.layerId}/images/${n.url}" alt ='' /></td><td class="mat-typography">`+n.label.replace("<Null>","Null")+"</td></tr>";return o+="</table>",[{html:o}]}onUnwatch(){}}class kn extends Kt{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:io.BLANK}createOlSource(){return new g_.Z(this.options)}getLegend(){const r=this.options.legendInfo,t=super.getLegend();if(void 0===r||void 0===this.options.layer||t.length>0)return t;if(!r)return;let o="<table>";for(const n of r.legend)o+=`<tr><td align='left'><img src="${this.options.url}/${r.layerId}/images/${n.url}" alt ='' /></td><td class="mat-typography">`+n.label.replace("<Null>","Null")+"</td></tr>";return o+="</table>",[{html:o}]}onUnwatch(){}}class Dc extends Kt{createOlSource(){const r=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete r.tileGrid,r.tileGrid=new h_.Z(this.options.tileGrid)),new m_.Z(r)}onUnwatch(){}}class kc extends Fe{createOlSource(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),super.createOlSource()}createWebSocket(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}onMessage(r){const t=this.options.format.readFeature(r.data);switch(this.options.onmessage){case"update":const o=this.ol.getFeatureById(t.getId());o&&this.ol.removeFeature(o),this.ol.addFeature(t);break;case"delete":this.ol.clear(!0),this.ol.addFeature(t);break;default:this.ol.addFeature(t)}}onClose(r){}onError(r){}onOpen(r){}onUnwatch(){this.ws.close()}}class Pc extends Kt{createOlSource(){let r;return r="feature"===this.options.featureClass?new uc.Z({featureClass:De.Z}):new uc.Z,this.options.format=r,new cc.Z(this.options)}generateId(){return this.options.url?ho.V8.hashStr("mvt"+this.options.url):Ze()}onUnwatch(){}}class Ve{constructor(){this._converters={},this._converters.esriPMS=Ve._convertEsriPMS,this._converters.esriSFS=Ve._convertEsriSFS,this._converters.esriSLS=Ve._convertEsriSLS,this._converters.esriSMS=Ve._convertEsriSMS,this._converters.esriTS=Ve._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}static _convertPointToPixel(r){return r/.75}static _transformColor(r){return[r[0],r[1],r[2],r[3]/255]}static _getResolutionForScale(r,t){const n=V.Wm[t];return parseFloat(r)/(39.3701*n*96)}static _convertEsriTS(r){const t=Ve._transformAngle(r.angle),o=void 0!==r.text?r.text:void 0;return new R.ZP({text:new St.Z({fill:new N.Z({color:Ve._transformColor(r.color)}),font:r.font.style+" "+r.font.weight+" "+r.font.size+" px "+r.font.family,textBaseline:r.verticalAlignment,textAlign:r.horizontalAlignment,offsetX:Ve._convertPointToPixel(r.xoffset),offsetY:Ve._convertPointToPixel(r.yoffset),rotation:t,text:o})})}static _convertEsriPMS(r){const t="data:"+r.contentType+";base64, "+r.imageData,o=Ve._transformAngle(r.angle);return new R.ZP({image:new di.Z({src:t,rotation:o})})}static _convertEsriSFS(r){const t=new N.Z({color:Ve._transformColor(r.color)}),o=r.outline?Ve._convertOutline(r.outline):void 0;return new R.ZP({fill:t,stroke:o})}static _convertOutline(r){let t;const o=Ve._transformColor(r.color);return"esriSLSDash"===r.style?t=[5]:"esriSLSDashDot"===r.style?t=[5,5,1,2]:"esriSLSDashDotDot"===r.style?t=[5,5,1,2,1,2]:"esriSLSDot"===r.style?t=[1,2]:"esriSLSNull"===r.style&&(o[3]=0),new U.Z({color:o,lineDash:t,width:Ve._convertPointToPixel(r.width)})}static _convertEsriSLS(r){return new R.ZP({stroke:Ve._convertOutline(r)})}static _transformAngle(r){if(0===r||void 0===r)return;const o=-r*Math.PI/180+Math.PI/2;return o<0?2*Math.PI+o:o}static _convertEsriSMS(r){const t=new N.Z({color:Ve._transformColor(r.color)}),o=r.outline?Ve._convertOutline(r.outline):void 0,n=Ve._convertPointToPixel(r.size)/2,s=Ve._transformAngle(r.angle);return"esriSMSCircle"===r.style?new R.ZP({image:new Me.Z({radius:n,fill:t,stroke:o})}):"esriSMSCross"===r.style?new R.ZP({image:new gi.Z({fill:t,stroke:o,points:4,radius:n,radius2:0,angle:0,rotation:s})}):"esriSMSDiamond"===r.style?new R.ZP({image:new gi.Z({fill:t,stroke:o,points:4,radius:n,rotation:s})}):"esriSMSSquare"===r.style?new R.ZP({image:new gi.Z({fill:t,stroke:o,points:4,radius:n,angle:Math.PI/4,rotation:s})}):"esriSMSX"===r.style?new R.ZP({image:new gi.Z({fill:t,stroke:o,points:4,radius:n,radius2:0,angle:Math.PI/4,rotation:s})}):"esriSMSTriangle"===r.style?new R.ZP({image:new gi.Z({fill:t,stroke:o,points:3,radius:n,angle:0,rotation:s})}):void 0}_convertLabelingInfo(r,t){const o=[];for(let n=0,s=r.length;n<s;++n){const a=r[n].labelExpression,l=a.substr(a.indexOf("[")+1,a.indexOf("]")-1),c=r[n].symbol,u=r[n].maxScale,p=r[n].minScale;let d=null;0!==u&&(d=Ve._getResolutionForScale(u,t));let g=null;0!==p&&(g=Ve._getResolutionForScale(p,t));const h=this._converters[c.type].call(this,c);o.push(function(m,y){let v=!0;if(null!==this.minResolution&&null!==this.maxResolution?v=y<this.maxResolution&&y>=this.minResolution:null!==this.minResolution?v=y>=this.minResolution:null!==this.maxResolution&&(v=y<this.maxResolution),v){const S=m.get(this.field);return this.style.getText().setText(S),[this.style]}}.bind({minResolution:d,maxResolution:g,field:l,style:h}))}return o}_renderSimple(r){const t=this._converters[r.symbol.type].call(this,r.symbol);return()=>[t]}_renderClassBreaks(r){const t=r.defaultSymbol,o=this._converters[t.type].call(this,t),n=r.field,s=[];for(let a=0,l=r.classBreakInfos.length;a<l;++a){const c=r.classBreakInfos[a];let u;u=null==c.classMinValue?0===a?r.minValue:r.classBreakInfos[a-1].classMaxValue:c.classMinValue;const p=c.classMaxValue,d=c.symbol,g=this._converters[d.type].call(this,d);s.push({min:u,max:p,style:g})}return a=>{const l=a.get(n);for(let c=0,u=s.length;c<u;++c){let p;if(p=0===c?l>=s[c].min&&l<=s[c].max:l>s[c].min&&l<=s[c].max,p)return[s[c].style]}return[o]}}_renderUniqueValue(r){const t=r.defaultSymbol;let o=[];t&&(o=[this._converters[t.type].call(this,t)]);const n=r.field1,s=r.uniqueValueInfos,a=this;return(()=>{const l={};for(let c=0,u=s.length;c<u;++c){const p=s[c],d=p.symbol;l[p.value]=[a._converters[d.type].call(a,d)]}return c=>l[c.get(n)]||o})()}generateStyle(r,t){const o=r.drawingInfo;let n=[];const s=this._renderers[o.renderer.type].call(this,o.renderer);if(void 0!==s&&n.push(s),r.labelingInfo){const a=this._convertLabelingInfo(r.labelingInfo,t);n=n.concat(a)}return 1===n.length?n[0]:(a,l)=>{let c=[];for(let u=0,p=n.length;u<p;++u){const d=n[u].call(null,a,l);d&&(c=c.concat(d))}return c}}}var tt=(()=>{return(i=tt||(tt={})).DATE="date",i.TIME="time",i.DATETIME="datetime",i.YEAR="year",tt;var i})(),Lt=(()=>{return(i=Lt||(Lt={})).CALENDAR="calendar",i.SLIDER="slider",Lt;var i})();let Ut=(()=>{class i{constructor(){}getMap(){return this.map}setMap(t){this.map=t}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Yi=(()=>{return(i=Yi||(Yi={})).wms="wms",i.wmts="wmts",i.arcgisrest="esriJSON",i.imagearcgisrest="esriJSON",i.tilearcgisrest="esriJSON",Yi;var i})();let Dr=(()=>{class i{constructor(t,o){this.http=t,this.mapService=o,this.parsers={wms:new t_.Z,wmts:new o_.Z,esriJSON:new Mr.Z}}getWMSOptions(t){return this.getCapabilities("wms",t.url,t.params.VERSION).pipe((0,Z.U)(s=>s?this.parseWMSOptions(t,s):void 0))}getWMTSOptions(t){return this.getCapabilities("wmts",t.url,t.version).pipe((0,Z.U)(a=>a?this.parseWMTSOptions(t,a):void 0))}getCartoOptions(t){return this.http.jsonp("https://"+t.account+".carto.com/api/v2/viz/"+t.mapId+"/viz.json","callback").pipe((0,Z.U)(n=>this.parseCartoOptions(t,n)))}getArcgisOptions(t){const o=t.url+"/"+t.layer+"?f=json",n=this.getCapabilities("arcgisrest",t.url),s=this.http.get(o);return(0,Qt.D)([s,n]).pipe((0,Z.U)(a=>this.parseArcgisOptions(t,a[0],a[1])))}getImageArcgisOptions(t){const o=t.url+"/"+t.layer+"?f=json",n=t.url+"/legend?f=json",s=this.getCapabilities("imagearcgisrest",t.url),a=this.http.get(o),l=this.http.get(n).pipe((0,Z.U)(c=>c),(0,he.K)(c=>(console.log("No legend associated with this Image Service"),(0,X.of)(c))));return(0,Qt.D)([a,l,s]).pipe((0,Z.U)(c=>this.parseTileOrImageArcgisOptions(t,c[0],c[1],c[2])))}getTileArcgisOptions(t){const o=t.url+"/"+t.layer+"?f=json",n=t.url+"/legend?f=json",s=this.getCapabilities("tilearcgisrest",t.url),a=this.http.get(o),l=this.http.get(n).pipe((0,Z.U)(c=>c),(0,he.K)(c=>(console.log("No legend associated with this Tile Service"),(0,X.of)(c))));return(0,Qt.D)([a,l,s]).pipe((0,Z.U)(c=>this.parseTileOrImageArcgisOptions(t,c[0],c[1],c[2])))}getCapabilities(t,o,n){const s=new q.LE({fromObject:{request:"GetCapabilities",service:t.toUpperCase(),version:n||"1.3.0",_i:"true"}});let a;return a="esriJSON"===Yi[t]?this.http.get(o+"?f=json"):this.http.get(o,{params:s,responseType:"text"}),a.pipe((0,Z.U)(l=>{if("esriJSON"===Yi[t])return l;if(String(l).toLowerCase().includes("serviceexception")&&String(l).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return this.parsers[t].read(l)}),(0,he.K)(l=>{throw void 0!==l.error&&(l.error.caught=!0),l}))}parseWMSOptions(t,o){const s=this.findDataSourceInCapabilities(o.Capability.Layer,t.params.LAYERS);if(!s)throw{error:{message:"Layer not found"}};const a=s.DataURL?s.DataURL[0]:void 0,l=s.Abstract?s.Abstract:void 0,c=s.KeywordList?s.KeywordList:void 0;let u=s.queryable;const p=this.getTimeFilter(s),d=p&&Object.keys(p).length>0,g=s.Style?this.getStyle(s.Style):void 0;let h=!0;s.EX_GeographicBoundingBox?s.EX_GeographicBoundingBox.forEach((M,A)=>{A<2&&(M>180||M<-180)&&(h=!1),A>=2&&(M>90||M<-90)&&(h=!1)}):h=!1;const m=h?V.$A(s.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0;let y;const v=[Xt.GEOJSON,Xt.GEOJSON2,Xt.GML3,Xt.GML2,Xt.JSON,Xt.HTML];for(const M of v)if(-1!==o.Capability.Request.GetFeatureInfo.Format.indexOf(M)){const A=Object.keys(Xt).find(F=>Xt[F]===M);y=qe[A];break}y||(u=!1);const S=B.removeUndefined({_layerOptionsFromSource:{title:s.Title,maxResolution:ct(s.MaxScaleDenominator),minResolution:ct(s.MinScaleDenominator),extent:m,metadata:{url:a?a.OnlineResource:void 0,extern:!!a||void 0,abstract:l,keywordList:c},legendOptions:g},queryable:u,queryFormat:y,timeFilter:d?p:void 0,timeFilterable:!!d||void 0,minDate:d?p.min:void 0,maxDate:d?p.max:void 0,stepDate:d?p.step:void 0});return B.mergeDeep(S,t)}parseWMTSOptions(t,o){const n=o.Contents.Layer.find(c=>c.Identifier===t.layer),s=(0,lc.B)(o,t),a=Object.assign(s,t),l=B.removeUndefined({_layerOptionsFromSource:{title:n.Title}});return B.mergeDeep(l,a)}parseCartoOptions(t,o){const n=[],s=o.layers[1].options.layer_definition;s.layers.forEach(l=>{n.push({type:l.type.toLowerCase(),options:l.options,legend:l.legend})});const a=B.removeUndefined({config:{version:s.version,layers:n}});return B.mergeDeep(a,t)}parseArcgisOptions(t,o,n){var s;const a=o.name;let l,c;l=null!==(s=o.drawingInfo)&&void 0!==s&&s.renderer?o.drawingInfo.renderer:void 0,o.drawingInfo&&(c=(new Ve).generateStyle(o,"esriMeters"===o.units?"m":"degrees"));const u=new wr.Z({target:o.copyrightText});let p,d;if(o.timeInfo){const m=o.timeInfo.timeExtent;p=m[0]+","+m[1];const y=new Date;y.setTime(m[0]);const v=new Date;v.setTime(m[1]),d={min:y.toUTCString(),max:v.toUTCString(),range:!0,type:tt.DATETIME,style:Lt.CALENDAR}}const g=Object.assign({},{style:c,LAYERS:t.layer?"show:"+t.layer:void 0,time:p}),h=B.removeUndefined({params:g,_layerOptionsFromSource:{title:a,minResolution:ct(o.maxScale),maxResolution:ct(o.minScale),metadata:{extern:!1,abstract:o.description||n.serviceDescription}},legendInfo:l,timeFilter:d,sourceFields:o.fields,queryTitle:o.displayField});return h.attributions=u,B.mergeDeep(h,t)}parseTileOrImageArcgisOptions(t,o,n,s){const a=o.name,l=n.layers?n.layers.find(h=>h.layerName===a):void 0,c=new wr.Z({target:o.copyrightText});let u,p;if(o.timeInfo){const h=o.timeInfo.timeExtent;u=h[0]+","+h[1];const m=new Date;m.setTime(h[0]);const y=new Date;y.setTime(h[1]),p={min:m.toUTCString(),max:y.toUTCString(),range:!0,type:tt.DATETIME,style:Lt.CALENDAR}}const d=Object.assign({},{LAYERS:t.layer?"show:"+t.layer:void 0,time:u}),g=B.removeUndefined({params:d,_layerOptionsFromSource:{title:a,minResolution:ct(o.maxScale),maxResolution:ct(o.minScale),metadata:{extern:!1,abstract:o.description||s.serviceDescription}},legendInfo:l,timeFilter:p,sourceFields:o.fields,queryTitle:o.displayField});return g.attributions=c,B.mergeDeep(g,t)}findDataSourceInCapabilities(t,o){if(Array.isArray(t)){let n;return t.find(s=>(n=this.findDataSourceInCapabilities(s,o),void 0!==n),this),n}return t.Layer?this.findDataSourceInCapabilities(t.Layer,o):t.Name&&t.Name===o?t:void 0}getTimeFilter(t){let o;if(t.Dimension){const n={};if(o=t.Dimension[0],o.values){const s=o.values.split("/");n.min=void 0!==s[0]?s[0]:void 0,n.max=void 0!==s[1]?s[1]:void 0,n.step=void 0!==s[2]?s[2]:void 0}return o.default&&(n.value=o.default),n}}getStyle(t){return{stylesAvailable:t.map(s=>({name:s.Name,title:s.Title})).filter((s,a,l)=>l.findIndex(c=>c.name===s.name)===a)}}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(Ut))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"getArcgisOptions",null),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"getImageArcgisOptions",null),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"getTileArcgisOptions",null),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"getCapabilities",null),i})();class $c{}let Pn=(()=>{class i{constructor(t){this.config=t,(this.config.getConfig("projections")||[]).forEach(n=>{n.alias=n.alias?n.alias:n.code,this.registerProjection(n)});for(let n=1;n<61;n++)this.registerProjection({code:n<10?`EPSG:3260${n}`:`EPSG:326${n}`,def:`+proj=utm +zone=${n} +datum=WGS84 +units=m +no_defs`,extent:void 0});for(let n=1;n<11;n++){const s=n<10?`EPSG:3218${n}`:`EPSG:321${80+n}`;let a;a=Number(n)<=2?-50-3*Number(n):Number(n)>=12?-81-3*(Number(n)-12):-49.5-3*Number(n),this.registerProjection({code:s,def:`+proj=tmerc +lat_0=0 +lon_0=${a} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"`,extent:void 0})}}registerProjection(t){ra.Z.defs(t.code,t.def),tc.z2(ra.Z),t.extent&&V.U2(t.code).setExtent(t.extent)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),wt=(()=>{class i{constructor(t,o,n,s,a,l,c){this.capabilitiesService=t,this.optionsService=o,this.wfsDataSourceService=n,this.languageService=s,this.messageService=a,this.projectionService=l,this.authInterceptor=c,this.datasources$=new b.X([])}createAsyncDataSource(t,o){if(!t.type)throw console.error(t),new Error("Datasource needs a type");let n;switch(t.type.toLowerCase()){case"osm":n=this.createOSMDataSource(t);break;case"vector":n=this.createFeatureDataSource(t);break;case"wfs":n=this.createWFSDataSource(t);break;case"wms":const s=t;B.removeDuplicateCaseInsensitive(s.params),n=this.createWMSDataSource(s,o);break;case"wmts":n=this.createWMTSDataSource(t);break;case"xyz":n=this.createXYZDataSource(t);break;case"tiledebug":n=this.createTileDebugDataSource(t);break;case"carto":n=this.createCartoDataSource(t);break;case"arcgisrest":n=this.createArcGISRestDataSource(t,o);break;case"imagearcgisrest":n=this.createArcGISRestImageDataSource(t,o);break;case"websocket":n=this.createWebSocketDataSource(t);break;case"mvt":n=this.createMVTDataSource(t);break;case"tilearcgisrest":n=this.createTileArcGISRestDataSource(t,o);break;case"cluster":n=this.createClusterDataSource(t);break;default:throw console.error(t),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([n])),n}createOSMDataSource(t){return new Ke.y(o=>o.next(new Oc(t)))}createFeatureDataSource(t){return new Ke.y(o=>o.next(new Fe(t)))}createWebSocketDataSource(t){return new Ke.y(o=>o.next(new kc(t)))}createWFSDataSource(t){return new Ke.y(o=>o.next(new ji(t,this.wfsDataSourceService,this.authInterceptor)))}createWMSDataSource(t,o){const n=[];return t.optionsFromCapabilities&&window.navigator.onLine&&n.push(this.capabilitiesService.getWMSOptions(t).pipe((0,he.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.params.LAYERS}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&n.push(this.optionsService.getWMSOptions(t,o).pipe((0,he.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,X.of)({}))))),n.push((0,X.of)(t)),(0,Qt.D)(n).pipe((0,Z.U)(s=>{const a=s.reduce((l,c)=>B.mergeDeep(l,c));return new Bt(a,this.wfsDataSourceService)}),(0,he.K)(()=>(0,X.of)(void 0)))}createWMTSDataSource(t){return t.optionsFromCapabilities&&window.navigator.onLine?this.capabilitiesService.getWMTSOptions(t).pipe((0,Z.U)(o=>o?new _a(o):void 0),(0,he.K)(()=>(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.layer}),(0,X.of)(void 0)))):new Ke.y(o=>o.next(new _a(t)))}createXYZDataSource(t){return new Ke.y(o=>o.next(new Zc(t)))}createTileDebugDataSource(t){return new Ke.y(o=>o.next(new Dc(t)))}createCartoDataSource(t){return t.mapId?this.capabilitiesService.getCartoOptions(t).pipe((0,Z.U)(o=>new Zr(o))):new Ke.y(o=>o.next(new Zr(t)))}createArcGISRestDataSource(t,o){const n=[];return window.navigator.onLine&&n.push(this.capabilitiesService.getArcgisOptions(t).pipe((0,he.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.layer}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&n.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,he.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,X.of)({}))))),n.push((0,X.of)(t)),(0,Qt.D)(n).pipe((0,Z.U)(s=>{const a=s.reduce((l,c)=>B.mergeDeep(l,c));return new ya(a)}),(0,he.K)(()=>(0,X.of)(void 0)))}createArcGISRestImageDataSource(t,o){const n=[];return window.navigator.onLine&&n.push(this.capabilitiesService.getImageArcgisOptions(t).pipe((0,he.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.params.LAYERS}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&n.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,he.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,X.of)({}))))),n.push((0,X.of)(t)),(0,Qt.D)(n).pipe((0,Z.U)(s=>{const a=s.reduce((l,c)=>B.mergeDeep(l,c));return new va(a)}),(0,he.K)(()=>(0,X.of)(void 0)))}createTileArcGISRestDataSource(t,o){const n=[];return window.navigator.onLine&&n.push(this.capabilitiesService.getImageArcgisOptions(t).pipe((0,he.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.params.LAYERS}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&n.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,he.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,X.of)({}))))),n.push((0,X.of)(t)),(0,Qt.D)(n).pipe((0,Z.U)(s=>{const a=s.reduce((l,c)=>B.mergeDeep(l,c));return new kn(a)}),(0,he.K)(()=>(0,X.of)(void 0)))}createMVTDataSource(t){return new Ke.y(o=>o.next(new Pc(t)))}createClusterDataSource(t){return new Ke.y(o=>o.next(new _o(t)))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Dr),e.LFG($c,8),e.LFG(Y_),e.LFG(D),e.LFG(_e),e.LFG(Pn),e.LFG(Sr))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function bt(i,r,t){t=t||_n;const n=(new be.Z).readFeature(i,{dataProjection:i.projection,featureProjection:r});n.setId(t(i));const s=Yt(i);void 0!==s&&n.set("_title",s,!0),void 0!==i.extent&&n.set("_extent",i.extent,!0),void 0!==i.projection&&n.set("_projection",i.projection,!0);const a=ai(i,"meta.mapTitle");void 0!==a&&n.set("_mapTitle",a,!0),n.set("_entityRevision",function Il(i){return(i.meta||{}).revision||0}(i),!0);const l=lr(i);return void 0!==l&&n.set("_icon",l,!0),i.meta&&i.meta.style&&n.set("_style",i.meta.style,!0),i.sourceId&&n.set("_sourceId",i.sourceId,!0),n}function _i(i,r,t,o="EPSG:4326"){let n,s,a,l;const c=new be.Z,p=i.getKeys().filter(y=>!y.startsWith("_")&&"geometry"!==y).reduce((y,v)=>(y[v]=i.get(v),y),{}),d=c.writeGeometryObject(i.getGeometry(),{dataProjection:o,featureProjection:r});if(t){n=t.get("title");const y=t.get("sourceOptions");y&&(s=y.excludeAttribute,a=y.excludeAttributeOffline,l=y.idColumn||("arcgisrest"===y.type||"tilearcgisrest"===y.type?"OBJECTID":void 0))}else n=i.get("_title");const g=i.get("_mapTitle"),h=i.getId()?i.getId():i.get(l)?i.get(l):Ze();return i.get("_newFeature"),{type:le,projection:o,extent:i.get("_extent"),meta:{id:h,title:n||g||h,mapTitle:g,revision:i.getRevision(),style:i.get("_style"),excludeAttribute:s,excludeAttributeOffline:a},properties:p,geometry:d,ol:i}}function $n(i,r){const t=Je.lJ();return r.forEach(o=>{const n=function K_(i,r){let t=Je.lJ();const o=r.get("_extent"),n=r.get("_projection");if(void 0!==o&&void 0!==n)t=V.$A(o,n,i.projection);else{const s=r.getGeometry();null!==s&&(t=s.getExtent())}return t}(i,o);Je.l7(t,n)}),t}function Ec(i,r){const[t,o]=Je.ap(i);return[r[3]?i[0]-t*r[3]:i[0],r[2]?i[1]-o*r[2]:i[1],r[1]?i[2]+t*r[1]:i[2],r[0]?i[3]+o*r[0]:i[3]]}function ba(i,r,t=.05){const o=Array.isArray(t)?t:[t,t,t,t],a=Ec(i.viewController.getExtent(),[-1,-1,-1,-1].map((l,c)=>l*o[c]));return!Je.r4(a,r)}function eo(i,r,t=Y.Default,o,n){const s=$n(i,r);let a=s;void 0!==o&&(a=Ec(a,o)),t===Y.Zoom?i.viewController.zoomToExtent(a):t===Y.Move?i.viewController.moveToExtent(a):t===Y.Default&&(ba(i,s)||function Jc(i,r,t){t=t||.004;const o=i.viewController.getExtent(),n=Je.bg(o),s=Je.bg(r);return!(0===s&&i.viewController.getZoom()>13)&&s/n<t}(i,s,n))&&i.viewController.zoomToExtent(a)}function Rc(i){i.setStyle(new R.ZP({}))}function qo(i,r){void 0===i.layer?(r=r||new Te({source:new Fe}),i.bindLayer(r),void 0===i.layer.map&&i.map.addLayer(i.layer)):void 0===i.layer.map&&i.map.addLayer(i.layer)}class Ct extends it{constructor(r,t){super(r,t),this.map=t.map}get source(){return this.layer?this.layer.dataSource:void 0}set searchDocument(r){this._searchDocument=r}get searchDocument(){return this._searchDocument}bindLayer(r){return this.layer=r,this}setLayerFeatures(r,t=Y.Default,o,n,s){s=s||_n,this.checkLayer();const a=r.map(l=>bt(l,this.map.projection,s));this.setLayerOlFeatures(a,t,o,n)}setStoreOlFeatures(r){this.checkLayer();const t=r.map(o=>(o.set("_featureStore",this,!0),_i(o,this.layer.map.projection)));this.load(t)}clearLayer(){this.checkLayer(),this.source.ol.clear()}checkLayer(){if(void 0===this.layer)throw new Error("This FeatureStore is not bound to a layer.")}setLayerOlFeatures(r,t=Y.Default,o,n){const a=function X_(i,r){const t=new Map;r.forEach(a=>{t.set(a.getId(),a)});const o=[];i.forEach(a=>{const l=t.get(a.getId());void 0===l||l.get("_entityRevision")!==a.get("_entityRevision")?o.push(a):t.delete(l.getId())});const n=Array.from(t.keys());return{add:r.filter(a=>n.indexOf(a.getId())>=0),remove:o}}(this.layer.ol.getSource().getFeatures(),r);a.remove.length>0&&this.removeOlFeaturesFromLayer(a.remove),a.add.length>0&&this.addOlFeaturesToLayer(a.add),a.add.length>0?eo(this.map,a.add,t,o,n):a.remove.length>0&&eo(this.map,r,t,o,n)}setLayerExtent(){let r=this.entities$.getValue(),t=Je.lJ(),o=[];r.forEach(s=>{o.push(bt(s,this.map.projection))});const n=$n(this.map,o);Je.l7(t,n),this.layer.setExtent(t)}addOlFeaturesToLayer(r){r.forEach(t=>{t.set("_featureStore",this,!0)}),this.source.ol.addFeatures(r)}removeOlFeaturesFromLayer(r){r.forEach(t=>{this.source.ol.removeFeature(t)})}}class Hi extends $o{constructor(r){super(r),this.options=r,this.stores$$=new Map,this.states$$=[]}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r),this.empty$$=r.empty$.pipe((0,At.n)(t=>!t)).subscribe(()=>this.updateEntitiesInExtent(r))}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){this.stores$$.has(r)||(this.updateEntitiesInExtent(r),this.states$$.push(r.layer.map.viewController.state$.subscribe(()=>{this.updateEntitiesInExtent(r)})))}updateEntitiesInExtent(r){var t,o;if(null!==(o=null===(t=null==r?void 0:r.layer)||void 0===t?void 0:t.map)&&void 0!==o&&o.viewController){r.state.updateAll({inMapExtent:!1});const n=r.layer.map.viewController.getExtent();let s=[],a=[];for(const l of r.entities$.value)l.ol?Je.kK(l.ol.getGeometry().getExtent(),n)&&s.push(l):a.push(l);s.length>0&&r.state.updateMany(s,{inMapExtent:!0},!1),a.length>0&&r.state.updateMany(a,{inMapExtent:!0},!1)}}unwatchStore(r){void 0!==this.stores$$.get(r)&&this.stores$$.delete(r)}unwatchAll(){this.stores$$.clear(),this.states$$.map(r=>r.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}class kr extends $o{constructor(r){super(r),this.options=r,this.stores$$=new Map,this.resolution$$=[]}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r),this.empty$$=r.empty$.subscribe(()=>this.updateEntitiesInResolution(r,r.layer.map.viewController.getResolution()))}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){this.stores$$.has(r)||(this.updateEntitiesInResolution(r,r.layer.map.viewController.getResolution()),this.resolution$$.push(r.layer.map.viewController.resolution$.subscribe(t=>{this.updateEntitiesInResolution(r,t)})))}updateEntitiesInResolution(r,t){r.state.updateAll(t>r.layer.minResolution&&t<r.layer.maxResolution?{inMapResolution:!0}:{inMapResolution:!1})}unwatchStore(r){void 0!==this.stores$$.get(r)&&this.stores$$.delete(r)}unwatchAll(){this.stores$$.clear(),this.resolution$$.map(r=>r.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}class Nt extends $o{constructor(r){super(r),this.options=r,this.stores$$=new Map,this.setMotion(r.motion)}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}setMotion(r){this.motion=r}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){if(this.stores$$.has(r))return;const t=r.view.all$().subscribe(o=>this.onFeaturesChange(o,r));this.stores$$.set(r,t)}unwatchStore(r){const t=this.stores$$.get(r);void 0!==t&&(t.unsubscribe(),this.stores$$.delete(r))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(r=>{r[1].unsubscribe()}),this.stores$$.clear()}onFeaturesChange(r,t){0===r.length?t.clearLayer():t.setLayerFeatures(r,this.selectMotion(t),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}selectMotion(r){return void 0!==this.motion?this.motion:!0===r.pristine||r.count>r.view.count?Y.Default:Y.None}}class Pr extends $o{constructor(r){super(r),this.options=r,this.stores$$=new Map}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){this.stores$$.has(r)||(this.onSourceChanges(r),r.layer.ol.getSource().on("change",o=>{this.onSourceChanges(r)}))}unwatchStore(r){void 0!==this.stores$$.get(r)&&this.stores$$.delete(r)}unwatchAll(){Array.from(this.stores$$.entries()).forEach(r=>{}),this.stores$$.clear()}onSourceChanges(r){let t=r.layer.ol.getSource().getFeatures();r.layer.dataSource instanceof _o&&(t=t.flatMap(o=>o.get("features"))),0===t.length?r.clear():r.setStoreOlFeatures(t)}}class $r extends pc.Z{constructor(r){super(r)}}class Mt extends $o{constructor(r){super(r),this.options=r,this.setMotion(r.motion),this._overlayStore=this.createOverlayStore()}get map(){return this.options.map}get overlayStore(){return this._overlayStore}bindStore(r){super.bindStore(r),!0===this.active&&this.activate()}unbindStore(r){super.unbindStore(r),!0===this.active&&this.activate()}setMotion(r){this.motion=r}unselectAll(){this.stores.forEach(r=>{r.state.updateAll({selected:!1})})}clear(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}deactivateSelection(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}doActivate(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()}doDeactivate(){this.deactivateSelection(),this.removeOverlayLayer()}watchAll(){this.unwatchAll();const r=this.stores.map(t=>t.stateView.manyBy$(o=>!0===o.state.selected).pipe((0,Z.U)(o=>o.map(n=>n.entity))));this.stores$$=(0,Qe.a)(r).pipe((0,fe.b)(5),(0,ni.T)(1),(0,Z.U)(t=>t.reduce((o,n)=>o.concat(n)))).subscribe(t=>this.onSelectFromStore(t))}unwatchAll(){void 0!==this.stores$$&&this.stores$$.unsubscribe()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",r=>{this.onMapClick(r)})}unlistenToMapClick(){(0,et.B)(this.mapClickListener)}onMapClick(r){const t=!Lr(r),o=!t,n=r.map.getFeaturesAtPixel(r.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:s=>void 0!==this.stores.find(l=>{var c;return(null===(c=l.layer)||void 0===c?void 0:c.ol)===s})});this.onSelectFromMap(n,t,o)}addDragBoxInteraction(){let r;const t=this.map.ol.getInteractions().getArray();for(const o of t)if(o instanceof $r){r=o;break}void 0===r&&(r=new $r({condition:Lr}),this.map.ol.addInteraction(r),this.olDragSelectInteraction=r),this.olDragSelectInteractionEndKey=r.on("boxend",o=>this.onDragBoxEnd(o))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,et.B)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}onDragBoxEnd(r){const t=!Lr(r.mapBrowserEvent),n=r.target.getGeometry().getExtent(),s=this.stores.reduce((a,l)=>{const c=l.layer.ol.getSource();return a.push(...c.getFeaturesInExtent(n)),a},[]);this.onSelectFromMap(s,t,!1)}onSelectFromStore(r){const t=this.motion,n=this.overlayStore.layer.ol.getSource().getFeatures().map(l=>l.getId()),s=r.map(this.overlayStore.getKey);let a;a=0!==r.length&&(n.length!==s.length||!n.every(l=>s.indexOf(l)>=0)),this.overlayStore.setLayerFeatures(r,a?t:Y.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}onSelectFromMap(r,t,o){const n=this.groupFeaturesByStore(r);this.stores.forEach(s=>{const a=n.get(s);void 0===a&&!0===t?this.unselectAllFeaturesFromStore(s):void 0===a&&!1===t||this.selectFeaturesFromStore(s,a,t,o)})}selectFeaturesFromStore(r,t,o,n){!0===n?r.state.reverseMany(t,["selected"]):r.state.updateMany(t,{selected:!0},o)}unselectAllFeaturesFromStore(r){r.state.updateAll({selected:!1})}groupFeaturesByStore(r){const t=new Map;return null==r||r.forEach(o=>{const n=o.get("_featureStore");if(void 0===n)return;let s=t.get(n);void 0===s&&(s=[],t.set(n,s));const a=n.get(o.getId());void 0!==a&&s.push(a)}),t}createOverlayStore(){const r=this.options.layer?this.options.layer:this.createOverlayLayer();return new Ct([],{map:this.map}).bindLayer(r)}createOverlayLayer(){return new Te({zIndex:300,source:new Fe,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}addOverlayLayer(){void 0===this.overlayStore.layer.map&&this.map.addLayer(this.overlayStore.layer)}removeOverlayLayer(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)}}class ey extends $o{constructor(r){super(r),this.options=r,this.stores$$=new Map}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}initStoreSearchIndex(r){r.searchDocument=new dc.Document({tokenize:"full"})}watchStore(r){this.stores$$.has(r)||(this.initStoreSearchIndex(r),r.entities$.pipe((0,At.n)(t=>!t.length)).subscribe(()=>this.onEntitiesChanges(r)))}unwatchStore(r){void 0!==this.stores$$.get(r)&&(r.searchDocument=void 0,this.stores$$.delete(r))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(r=>{}),this.stores$$.clear()}onEntitiesChanges(r){const t=this.options.percentDistinctValueRatio||2,o=[];r.index.forEach((l,c)=>{const u=l.properties;u.igoSearchID=c,o.push(u)});const n=[];let s=[],a=[];if(this.options.sourceFields)s=this.options.sourceFields.filter(l=>{var c;return!(null!==(c=l.searchIndex)&&void 0!==c&&c.enabled)}),a=this.options.sourceFields.filter(l=>{var c;return null===(c=l.searchIndex)||void 0===c?void 0:c.enabled}).map(l=>Object.assign({},{field:l.name,tokenize:"full"},l.searchIndex));else if(o.length){const l=Object.keys(o[0]),c=[];s=l.map(p=>{const d=[...new Set(o.map(g=>g[p]))];d.length/o.length*100<=t||d.every(g=>Number(g)===g&&g%1!=0)?s.push(p):c.push(p)}).filter(p=>p),a=c.filter(p=>"igoSearchID"!==p).map(p=>({field:p,tokenize:"full"}))}r.index.forEach((l,c)=>{const u=JSON.parse(JSON.stringify(l.properties));s.map(p=>delete u[p]),Object.keys(u).length&&n.push(u)}),0===n.length?this.initStoreSearchIndex(r):(r.searchDocument=new dc.Document({document:{id:"igoSearchID",index:a}}),n.map(l=>{r.searchDocument.add(l.igoSearchID,l)}))}}function Vi(i,r){void 0===i.getStrategyOfType(Nt)?(r=r||new Nt({}),i.addStrategy(r),r.activate()):i.activateStrategyOfType(Nt)}function Ca(i,r){void 0===i.getStrategyOfType(Mt)?(r=r||new Mt({map:i.map}),i.addStrategy(r),r.activate()):i.activateStrategyOfType(Mt)}function Go({text:i,opacity:r=1,markerColor:t=[0,161,222],markerOutlineColor:o=[255,255,255]}={}){let n,s,a,l;const c=(0,fo._2)(t).slice(0),u=(0,fo._2)(o).slice(0);return 4===c.length&&("string"!=typeof t||/^#[0-9A-F]{8}$/i.test(t))&&(r=c[3]),s=`"rgba(${c[0]},${c[1]},${c[2]},${r})"`,n=t,a=`"rgb(${u[0]},${u[1]},${u[2]})"`,l='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+s+" stroke="+a+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>',new R.ZP({image:new di.Z({src:l,opacity:r,anchor:[.5,.92]}),text:new St.Z({text:i,font:"12px Calibri,sans-serif",fill:new N.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0})})}let no=(()=>{class i{createStyle(t,o,n){var s,a,l,c;if(!t)return Go();if("function"==typeof t||t instanceof R.ZP)return t;const u=this.parseStyle("style",t);if(u.getText()){let p=0,d=1/0;if(t.text){const g=null!==(s=t.text)&&void 0!==s&&s.minScaleDenom?ct(Number(t.text.minScaleDenom)):void 0,h=null!==(a=t.text)&&void 0!==a&&a.maxScaleDenom?ct(Number(t.text.maxScaleDenom)):void 0,m=null!==(l=t.text)&&void 0!==l&&l.minResolution?t.text.minResolution:0,y=null!==(c=t.text)&&void 0!==c&&c.maxResolution?t.text.maxResolution:1/0;p=g||m,d=h||y}o&&n>=p&&n<=d?o&&t.text.attribute&&u.getText().setText(this.getLabel(o,t.text.attribute)):u.setText()}return u}parseStyle(t,o){const n={},s=this.getOlCls(t);return s&&o instanceof Object?(Object.keys(o).forEach(a=>{const l=this.getOlKey(a);n[l]=this.parseStyle(a,o[a])}),new s(n)):o}getOlKey(t){let o;switch(t.toLowerCase()){case"circle":case"regularshape":case"icon":o="image"}return o||t}getOlCls(t){let o=s_[t.charAt(0).toUpperCase()+t.slice(1)];return"regularshape"===t&&(o=gi.Z),"backgroundFill"===t&&(o=N.Z),"backgroundStroke"===t&&(o=U.Z),o}createStyleByAttribute(t,o,n){var s,a,l,c,u;let p;const d=o.type?o.type:this.guessTypeFeature(t),g=o.attribute,h=o.data,m=o.stroke,y=o.width,v=o.fill,S=o.anchor,M=o.radius,A=o.icon,F=o.scale,k=h?h.length:0,ne=o.label?o.label.attribute:void 0,se=null!==(s=o.label)&&void 0!==s&&s.minScaleDenom?ct(Number(o.label.minScaleDenom)):void 0,z=null!==(a=o.label)&&void 0!==a&&a.maxScaleDenom?ct(Number(o.label.maxScaleDenom)):void 0,de=null!==(l=o.label)&&void 0!==l&&l.minResolution?o.label.minResolution:0,ge=null!==(c=o.label)&&void 0!==c&&c.maxResolution?o.label.maxResolution:1/0,xe=se||de,pe=z||ge;let W=null!==(u=o.label)&&void 0!==u&&u.style?this.parseStyle("text",o.label.style):void 0;!W&&ne&&(W=new St.Z);const ze=o.baseStyle;if(W&&W.setText(n>=xe&&n<=pe?this.getLabel(t,ne):""),"circle"===d){for(let me=0;me<k;me++){const We=void 0!==t.get(g)&&null!==t.get(g)?t.get(g):"";if(We===h[me]||We.toString().match(new RegExp(h[me],"gmi")))return A?(p=[new R.ZP({image:new di.Z({color:v?v[me]:void 0,src:A[me],scale:F?F[me]:1,anchor:S?S[me]:[.5,.5]}),text:W instanceof St.Z?W:void 0})],p):(p=[new R.ZP({image:new Me.Z({radius:M?M[me]:4,stroke:new U.Z({color:m?m[me]:"black",width:y?y[me]:1}),fill:new N.Z({color:v?v[me]:"black"})}),text:W instanceof St.Z?W:void 0})],p)}if(!t.getStyle())return ze?(p=this.createStyle(ze,t,n),W&&p.setText(W),p):(p=[new R.ZP({image:new Me.Z({radius:4,stroke:new U.Z({color:"black"}),fill:new N.Z({color:"#bbbbf2"})})})],p)}else if("regular"===d){for(let me=0;me<k;me++){const We=void 0!==t.get(g)&&null!==t.get(g)?t.get(g):"";if(We===h[me]||We.toString().match(new RegExp(h[me],"gmi")))return p=[new R.ZP({stroke:new U.Z({color:m?m[me]:"black",width:y?y[me]:1}),fill:new N.Z({color:v?v[me]:"rgba(255,255,255,0.4)"}),text:W instanceof St.Z?W:void 0})],p}if(t instanceof De.Z&&!t.getStyle())return ze?(p=this.createStyle(ze,t,n),W&&p.setText(W),p):(p=[new R.ZP({stroke:new U.Z({color:"black"}),fill:new N.Z({color:"#bbbbf2"})})],p)}}createClusterStyle(t,o,n={},s){let a;const l=t.get("features").length;if(1!==l){if(n.clusterRanges)for(const c of n.clusterRanges)if((!c.minRadius||c.minRadius<=l)&&(!c.maxRadius||c.maxRadius>=l)){if(a=this.createStyle(c.style),c.showRange){const u=new St.Z({text:l.toString(),fill:new N.Z({color:"#fff"})});a.setText(u)}if(c.dynamicRadius){let u;const p=a.getRadius();u=5*Math.log(l),u<p&&(u=p),a.image_.setRadius(u)}break}if(!a){let c;n.radiusCalc?c=n.radiusCalc(l):(c=5*Math.log(l),c<6&&(c=6)),a=[new R.ZP({image:new Me.Z({radius:c,stroke:new U.Z({color:"black"}),fill:new N.Z({color:"rgba(24, 134, 45, 0.5)"})}),text:new St.Z({text:l.toString(),fill:new N.Z({color:"#fff"})})})]}}else a=this.createStyle(s,t,o);return a}getLabel(t,o){let n=o;if(!n)return;const s=Array.from(o.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(a=>{n=n.replace(a[0],t.get(a[1]))}),0===s.length&&n===o&&(n=t.get(o)||o),n}guessTypeFeature(t){switch(t.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function ty(){const i=Bc(),r=Go();let t;return(o,n)=>{if("bufferFeature"===o.getId())return t=function oy(i=[0,161,222,1],r=2,t=[0,161,222,.15],o){const n=new U.Z({width:r,color:i}),s=new N.Z({color:t});return new R.ZP({stroke:n,fill:s,image:new Me.Z({radius:5,stroke:n,fill:s}),text:new St.Z({font:"12px Calibri,sans-serif",text:o,fill:new N.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0})})}(o.get("bufferStroke"),2,o.get("bufferFill"),o.get("bufferText")),t;{const s=o.get("_style");return s?(new no).createStyle(s,o,n):(t="Point"===o.getGeometry().getType()?r:i,t.getText().setText(o.get("_mapTitle")),t)}}}function Bc({text:i,strokeWidth:r=2,fillColor:t=[0,161,222,.3],strokeColor:o=[0,161,222,.9]}={}){const n=(0,fo._2)(t).slice(0),s=(0,fo._2)(o).slice(0),a=new U.Z({width:r,color:s}),l=new N.Z({color:n});return new R.ZP({stroke:a,fill:l,image:new Me.Z({radius:5,stroke:a,fill:l}),text:new St.Z({text:i,font:"12px Calibri,sans-serif",fill:new N.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0})})}class Er{constructor(r){this.layer=function iy(){const i=new Fe;return new Te({title:"Overlay",zIndex:300,source:i,style:ty()})}(),this.setMap(r)}get dataSource(){return this.layer.dataSource}setMap(r){void 0===r?void 0!==this.map&&this.map.ol.removeLayer(this.layer.ol):r.ol.addLayer(this.layer.ol),this.map=r}setFeatures(r,t=Y.Default,o){if(o)for(const n of this.dataSource.ol.getFeatures())n.get("_sourceId")===o&&this.removeOlFeature(n);else this.clear();this.addFeatures(r,t)}addFeature(r,t=Y.Default){this.addFeatures([r],t)}addFeatures(r,t=Y.Default){const o=[];r.forEach(n=>{const s=bt(n,this.map.projection);null!==s.getGeometry()&&o.push(s)}),this.addOlFeatures(o,t)}addOlFeature(r,t=Y.Default){this.addOlFeatures([r],t)}addOlFeatures(r,t=Y.Default){this.dataSource.ol.addFeatures(r),eo(this.map,r,t)}removeFeature(r){this.removeFeatures([r])}removeFeatures(r){r.forEach(t=>{t.meta&&this.dataSource.ol.getFeatureById(t.meta.id)&&this.removeOlFeature(this.dataSource.ol.getFeatureById(t.meta.id))})}removeOlFeature(r){this.dataSource.ol.removeFeature(r)}clear(){this.dataSource.ol.clear()}}class ny extends nr{constructor(){super(),this.propertyChange$=new b.X(void 0),this.loaded=0,this.loading=0,this.layers=[],this.subscriptions=[]}watch(){}unwatch(){this.layers.forEach(r=>this.unwatchLayer(r),this)}setPropertyChange(r,t){![Be.TIMEFILTER,Be.OGCFILTERS,Be.VISIBLE,Be.OPACITY,Be.MINRESOLUTION,Be.MAXRESOLUTION].includes(r.key)||this.propertyChange$.next({event:r,layer:t})}watchLayer(r){if(void 0===r.status$)return;r.ol.on("propertychange",o=>this.setPropertyChange(o,r)),r.dataSource.ol.on("propertychange",o=>this.setPropertyChange(o,r)),this.layers.push(r);const t=r.status$.pipe((0,ei.x)()).subscribe(o=>{o===ve.Error&&(this.loading=0,this.loaded=-1),o===ve.Working?this.loading+=1:o===ve.Done&&(this.loaded+=1),this.loaded>=this.loading?(this.loading=this.loaded=0,this.status=ve.Done):this.loading>0&&(this.status=ve.Working)});this.subscriptions.push(t)}unwatchLayer(r){r.ol.un("propertychange",o=>this.setPropertyChange(o,r)),r.dataSource.ol.un("propertychange",o=>this.setPropertyChange(o,r)),r.status$.next(ve.Done);const t=this.layers.indexOf(r);t>=0&&(-1!==[ve.Working,ve.Waiting].indexOf(r.watcher.status)&&(this.loaded+=1),this.subscriptions[t].unsubscribe(),this.subscriptions.splice(t,1),this.layers.splice(t,1),r.watcher.unwatch())}}var zi=(()=>{return(i=zi||(zi={}))[i.Move=0]="Move",i[i.Zoom=1]="Zoom",zi;var i})();class Uc{constructor(){this.observerKeys=[]}getOlMap(){return this.olMap}setOlMap(r){if(void 0!==r&&void 0!==this.getOlMap())throw new Error("This controller is already bound to a map.");if(void 0===r)return this.teardownObservers(),void(this.olMap=r);this.olMap=r}teardownObservers(){this.observerKeys.forEach(r=>(0,et.B)(r)),this.observerKeys=[]}}class ry extends Uc{constructor(r){super(),this.options=r,this.rotation$=new b.X(0),this.resolution$=new b.X(void 0),this.state$=new b.X(void 0),this.padding=[0,0,0,0],this.maxZoomOnExtent=19,this.extent$=new Se.x,this.states=[],this.stateIndex=0}get stateHistory(){return!!this.options&&!0===this.options.stateHistory}get olView(){return this.olMap.getView()}setPadding(r){(r.top||0===r.top)&&(this.padding[0]=r.top),(r.right||0===r.right)&&(this.padding[1]=r.right),(r.bottom||0===r.bottom)&&(this.padding[2]=r.bottom),(r.left||0===r.left)&&(this.padding[3]=r.left)}setOlMap(r){super.setOlMap(r),this.setupObservers()}setupObservers(){!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",r=>this.onMoveEnd(r))),this.extent$$=this.extent$.pipe((0,fe.b)(25)).subscribe(r=>{this.setExtent(r.extent,r.action)})}monitorRotation(){this.observerKeys.push(this.olMap.getView().on("change:rotation",r=>{this.rotation$.next(r.target.getRotation())}))}teardownObservers(){super.teardownObservers(),void 0!==this.extent$$&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}getOlProjection(){return this.olView.getProjection()}getCenter(r){let t=this.olView.getCenter();return r&&t&&(t=V.vs(t,this.getOlProjection(),r)),t}getExtent(r){let t=this.olView.calculateExtent(this.olMap.getSize());return r&&t&&(t=V.$A(t,this.getOlProjection(),r)),t}getScale(r=96){return function O_(i,r="m",t=96){return i*V.Wm[r]*39.3701*t}(this.getResolution(),this.getOlProjection().getUnits(),r)}getResolution(){return this.olView.getResolution()}getZoom(){return Math.round(this.olView.getZoom())}zoomIn(){this.zoomTo(this.olView.getZoom()+1)}zoomOut(){this.zoomTo(this.olView.getZoom()-1)}zoomTo(r){this.olView.cancelAnimations(),this.olView.animate({zoom:r,duration:250,easing:Ui.Vv})}moveToExtent(r){this.extent$.next({extent:r,action:zi.Move})}zoomToExtent(r){this.extent$.next({extent:r,action:zi.Zoom})}getRotation(){return this.olView.getRotation()}resetRotation(){this.olView.animate({rotation:0})}hasPreviousState(){return this.states.length>1&&this.stateIndex>0}hasNextState(){return this.states.length>1&&this.stateIndex<this.states.length-1}previousState(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}nextState(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}clearStateHistory(){this.states=[],this.stateIndex=0}setInitialState(){this.states.length>0&&this.setStateIndex(0)}setExtent(r,t,o=!0){const n=this.olView;n.cancelAnimations();const s=o?500:0,a=n.getZoom(),l=n.getCenter(),c=[r[0]+(r[2]-r[0])/2,r[1]+(r[3]-r[1])/2],u=Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)),p=n.calculateExtent(),d=Math.sqrt(Math.pow(p[2]-p[0],2)+Math.pow(p[3]-p[1],2)),m=u/((Math.sqrt(Math.pow(r[2]-r[0],2)+Math.pow(r[3]-r[1],2))+d)/2),y=t===zi.Move||a>this.maxZoomOnExtent?a:this.maxZoomOnExtent;n.fit(r,{size:this.olMap.getSize(),maxZoom:y,padding:this.padding,duration:m>4?0:s,callback:v=>{v||n.fit(r,{size:this.olMap.getSize(),maxZoom:y,padding:this.padding,duration:m>4?0:s})}})}setStateIndex(r){this.stateIndex=r,this.setState(this.states[r])}setState(r){this.olView.animate({resolution:r.resolution,center:r.center,duration:0})}onMoveEnd(r){const t=this.getResolution();this.resolution$.value!==t&&this.resolution$.next(t);const o={resolution:t,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){const n=this.stateIndex;(function I_(i,r){if(void 0===i||void 0===r)return!1;const t=1e-4;return i.zoom===r.zoom&&Math.trunc(i.center[0]/t)===Math.trunc(r.center[0]/t)&&Math.trunc(i.center[1]/t)===Math.trunc(r.center[1]/t)})(o,0===this.states.length?void 0:this.states[n])||(this.states=this.states.slice(0,n+1).concat([o]),this.stateIndex=this.states.length-1)}this.state$.next(o)}}var ut=(()=>{return(i=ut||(ut={})).Position="position",i.PositionDirection="positionDirection",i.Accuracy="accuracy",i.Buffer="buffer",ut;var i})();class sy extends Uc{constructor(r,t,o,n){super(),this.map=r,this.options=t,this.storageService=o,this.configService=n,this.subscriptions$$=[],this.positionFeatureStyle=new R.ZP({image:new Me.Z({radius:6,fill:new N.Z({color:"#3399CC"}),stroke:new U.Z({color:"#fff",width:2})})}),this.accuracyFeatureStyle=new R.ZP({stroke:new U.Z({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new N.Z({color:"rgba(120, 120, 120, 0.4)"})}),this.emissionIntervalSeconds$=new b.X(5),this.position$=new b.X(void 0),this.tracking$=new b.X(void 0),this.followPosition$=new b.X(void 0),this._buffer=this.options&&this.options.buffer?this.options.buffer:void 0,this._accuracyThreshold=this.options&&this.options.accuracyThreshold?this.options.accuracyThreshold:5e3,this._followPosition=!(!this.options||!this.options.followPosition)&&this.options.followPosition,this.geolocationOverlay=new Er(this.map)}get bufferStyle(){return new R.ZP({stroke:new U.Z({width:2,color:this.buffer.bufferStroke}),fill:new N.Z({color:this.buffer.bufferFill}),text:new St.Z({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?`${this.buffer.bufferRadius}m`:"",fill:new N.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3})})})}get arrowStyle(){return new R.ZP({image:new gi.Z({radius:5.5,fill:new N.Z({color:"rgba(0, 132, 202)"}),stroke:new U.Z({color:"#fff",width:1.5}),points:3,displacement:[0,9],rotation:this.arrowRotation,rotateWithView:!0})})}set buffer(r){this._buffer=r,this.handleFeatureCreation(this.position$.value)}get buffer(){return this._buffer}set accuracyThreshold(r){this._accuracyThreshold=r,this.handleFeatureCreation(this.position$.value)}get accuracyThreshold(){return this._accuracyThreshold}get olGeolocation(){return this.geolocation}get tracking(){return this.geolocation.getTracking()}set tracking(r){this.geolocation.setTracking(r||!1),this.tracking$.next(r),this.storageService&&void 0!==r&&this.storageService.set("geolocation.tracking",r),r||this.position$.next(void 0)}set followPosition(r){var t;this._followPosition=r,this.followPosition$.next(r),!1===(null===(t=this.configService)||void 0===t?void 0:t.getConfig("geolocate.followPosition"))&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&void 0!==r&&this.storageService.set("geolocation.followPosition",r)}get followPosition(){return this._followPosition}setOlMap(r){super.setOlMap(r),this.setupObservers()}deleteGeolocationFeatures(){this.deleteFeatureByType(ut.Position),this.deleteFeatureByType(ut.PositionDirection),this.deleteFeatureByType(ut.Accuracy),this.deleteFeatureByType(ut.Buffer)}setupObservers(){this.tracking$.subscribe(t=>{t?this.onPositionChange(!0,!0):this.deleteGeolocationFeatures()}),this.geolocation=new f_.Z({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});let r=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe((0,Al.w)(t=>(0,Xl.F)(1e3*t))).subscribe(()=>{r===this.tracking?this.onPositionChange(!0):(r=this.tracking,this.onPositionChange(!0,!0))})),this.geolocation.on("change",t=>{this.onPositionChange(!1,!1)})}updateArrowFeatureOrientation(r){const t=V.vs(r.position,r.projection,"EPSG:4326");if(!this.lastPosition)return void(this.lastPosition={coordinates:t,dateTime:new Date});const o=this.getFeatureByType(ut.PositionDirection),n=(null==r?void 0:r.speed)>1.25&&this.distanceBetweenPoints(this.lastPosition.coordinates,t)>.003;if(r.accuracy<=this.accuracyThreshold&&n){var l=Math.atan2(t[0]-this.lastPosition.coordinates[0],t[1]-this.lastPosition.coordinates[1]);l<0&&(l=2*Math.PI+l),this.arrowRotation=l,o&&o.setStyle(this.arrowStyle),this.lastPosition={coordinates:t,dateTime:new Date}}else o&&(new Date).getTime()-this.lastPosition.dateTime.getTime()>3e3&&Rc(o)}distanceBetweenPoints(r,t){return qi.Sp(r,t)/1e3}addOnChangedListener(r){let t=()=>{r(this.geolocation)};return this.geolocation.on("change",t),t}deleteChangedListener(r){this.geolocation.un("change",r)}updateGeolocationOptions(r){if(!r)return;let t=r.geolocate,o=r.alwaysTracking;if(this.storageService){const n=this.storageService.get("geolocation.tracking");null!=n&&(t=n);const s=this.storageService.get("geolocation.followPosition");null!=s&&(o=s)}this.tracking=t,this.followPosition=o,this.buffer=r.buffer}teardownObservers(){this.subscriptions$$.length&&this.subscriptions$$.map(r=>r.unsubscribe()),super.teardownObservers()}onPositionChange(r=!1,t=!1){var o;if(!this.tracking)return;const n=this.geolocation.getProperties();if(n.accuracy>this.accuracyThreshold)return console.warn("Poor geolocation accuracy. No position are stored/shown"),void this.position$.next(void 0);const s={position:n.position,projection:this.geolocation.getProjection().getCode(),accuracy:n.accuracy,altitude:n.altitude,altitudeAccuracy:n.altitudeAccuracy,heading:n.heading,speed:n.speed,enableHighAccuracy:!(null===(o=n.trackingOptions)||void 0===o||!o.enableHighAccuracy),timestamp:new Date};this.handleFeatureCreation(s),this.handleViewFromFeatures(s,t),r&&this.position$.next(s)}getFeatureByType(r){return this.geolocationOverlay.dataSource.ol.getFeatureById(r)}deleteFeatureByType(r){const t=this.geolocationOverlay.dataSource.ol.getFeatureById(r);t&&this.geolocationOverlay.dataSource.ol.removeFeature(t)}handleFeatureCreation(r){if(!r||!r.position)return;const t=new Pe.Z(r.position),o=(0,kt.Bb)(new Ro.Z(r.position,r.accuracy||0));let n=this.getFeatureByType(ut.Position),s=this.getFeatureByType(ut.PositionDirection),a=this.getFeatureByType(ut.Accuracy);const l=!!n,c=!!s,u=!!a;if(c||(s=new De.Z({geometry:t}),s.setId(ut.PositionDirection),Rc(s)),l||(n=new De.Z({geometry:t}),n.setId(ut.Position),n.setStyle(this.positionFeatureStyle)),u||(a=new De.Z({geometry:o}),a.setId(ut.Accuracy),a.setStyle(this.accuracyFeatureStyle)),t&&(l?n.setGeometry(t):this.geolocationOverlay.addOlFeature(n,Y.None),c?s.setGeometry(t):this.geolocationOverlay.addOlFeature(s,Y.None),this.updateArrowFeatureOrientation(r),u?a.setGeometry(o):this.geolocationOverlay.addOlFeature(a,Y.None),this.buffer)){let p=this.getFeatureByType(ut.Buffer);const d=!!p,g=new Ro.Z(r.position,this.buffer.bufferRadius);d||(p=new De.Z(g),p.setId(ut.Buffer),p.setStyle(this.positionFeatureStyle)),p.setStyle(this.bufferStyle),d?p.setGeometry(g):this.geolocationOverlay.addOlFeature(p,Y.None)}}handleViewFromFeatures(r,t=!1){const l=[this.getFeatureByType(ut.Position),this.getFeatureByType(ut.PositionDirection),this.getFeatureByType(ut.Accuracy),this.getFeatureByType(ut.Buffer)].filter(c=>c);if(l.length>0){const c=$n(this.map,l),p=ba(this.map,c,(null==r?void 0:r.speed)>12.5?[.25,.25,.25,.25]:[.15,.1,.1,.1]);let d=this.followPosition&&p?Y.Move:Y.None;t&&(d=Y.Zoom),d!==Y.None&&eo(this.map,l,d)}}}function Jr(i){return i.options.linkedLayers}function Nc(i,r){return i.layers.find(t=>{var o;return(null===(o=t.options.linkedLayers)||void 0===o?void 0:o.linkId)===r})}function Rr(i,r,t){let o=r,n=o,s=!0;for(;s;)o=n,n=cy(i,o,t),s=!!n;return s||function ay(i,r){let t=!1;const o=Jr(i);return null!=o&&o.links&&(t=!!o.links.find(s=>s.properties.includes(r))),t}(o,t)||(o=void 0),s?n:o}function cy(i,r,t){var o;if(null!==(o=null==r?void 0:r.options.linkedLayers)&&void 0!==o&&o.linkId){const n=r.options.linkedLayers.linkId;let s=i.layers.filter(a=>{const l=a.options.linkedLayers;if(l&&l.links)return l.links.find(u=>u.linkedIds.includes(n)&&u.properties.includes(t))});return s.length>1&&console.warn(`Your layer ${r.title||r.id} must only have 1 parent (${s.map(a=>a.title||a.id)})\n            , The first parent (${s[0].title||s[0].id}) will be use to sync properties`),s[0]}}function qc(i,r,t){var o;let n=[];return!(null===(o=null==r?void 0:r.options.linkedLayers)||void 0===o)&&o.links&&r.options.linkedLayers.links.filter(s=>s.properties.includes(t)).map(s=>{n=n.concat(s.linkedIds)}),n.map(s=>Nc(i,s))}function xa(i,r,t,o){return qc(i,r,o).map(s=>{t.push(s),qc(i,s,o)&&xa(i,s,t,o)}),t}function py(i,r){var t;if(null!==(t=r.options.linkedLayers)&&void 0!==t&&t.linkId){const o=r.options.linkedLayers.linkId;let n=i.layers.filter(s=>{const a=s.options.linkedLayers;if(a&&a.links)return a.links.find(c=>c.linkedIds.includes(o)&&c.syncedDelete)});return n.length>1&&console.warn(`Your layer ${r.title||r.id} must only have 1 parent (${n.map(s=>s.title||s.id)})\n          , The first parent (${n[0].title||n[0].id}) will be use to sync properties`),n[0]}}function Gc(i,r){var t;let o=[];return!(null===(t=null==r?void 0:r.options.linkedLayers)||void 0===t)&&t.links&&r.options.linkedLayers.links.filter(n=>n.syncedDelete).map(n=>{o=o.concat(n.linkedIds)}),o.map(n=>Nc(i,n))}function Qc(i,r,t){return Gc(i,r).map(n=>{t.push(n),Gc(i,n)&&Qc(i,n,t)}),t}function dy(i,r){const t={},o=Object.keys(Be);o.map(n=>{t[Be[n]]=[]}),r.filter(n=>Jr(n)).map(n=>{o.map(s=>{const a=Be[s],l=Rr(i,n,a),u=t[a].map(p=>p.id);l&&!u.includes(l.id)&&t[a].push(l)})}),Object.keys(t).map(n=>{t[n].map(a=>a.ol.notify(n,void 0))})}class ot{constructor(r,t,o){this.storageService=t,this.configService=o,this.forcedOffline$=new b.X(!1),this.layers$=new b.X([]),this.layersAddedByClick$=new b.X(void 0),this.swipeEnabled$=new b.X(!1),this.mapCenter$=new b.X(!1),this.selectedFeatures$=new b.X(null),this.defaultOptions={controls:{attribution:!1}},this.options=Object.assign({},this.defaultOptions,r),this.layerWatcher=new ny,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,tc.z2(ra.Z),this.init()}get layers(){return this.layers$.value}get projection(){return this.viewController.getOlProjection().getCode()}init(){const r=[];this.options.controls&&(this.options.controls.attribution&&r.push(new wr.Z(!0===this.options.controls.attribution?{}:this.options.controls.attribution)),this.options.controls.scaleLine&&r.push(new ec.Z(!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine)));let t={};!1===this.options.interactions&&(t={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new Vf.Z({interactions:Wf.c(t),controls:r}),this.setView(this.options.view||{}),this.viewController=new ry({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new Er(this),this.queryResultsOverlay=new Er(this),this.searchResultsOverlay=new Er(this),this.ol.once("rendercomplete",()=>{this.geolocationController=new sy(this,{projection:this.viewController.getOlProjection()},this.storageService,this.configService),this.geolocationController.setOlMap(this.ol),this.geolocationController&&this.geolocationController.updateGeolocationOptions(this.mapViewOptions),this.layers$.subscribe(o=>{for(const n of o)n.options.linkedLayers&&n.ol.once("postrender",()=>{dy(this,this.layers)})}),this.viewController.monitorRotation()}),this.propertyChange$.pipe((0,At.n)(o=>!o)).subscribe(o=>function gy(i,r,t){if(!r)return;const o=new Rt;let n=!0,s=!0;const a=r.key;let l;if("ogcFilters"===a?(n=!1,s=!0,l=t.dataSource.options.ogcFilters):"timeFilter"===a?(n=!1,s=!0,l=t.dataSource.options.timeFilter):(n=!0,s=!1,l=t.ol.get(a)),Jr(t)){let u=Rr(i,t,a);u||(u=t);const p=[u];xa(i,u,p,a);let d=!1;const g=t.options.source.options.type,h=t.dataSource.options;p.map(m=>{if(t&&m&&(0,Mn.sq)(t.ol)!==(0,Mn.sq)(null==m?void 0:m.ol)){const y=m.options.source.options.type;if(n)m.ol.set(a,l,!0),"visible"===a&&m.visible$.next(l),("minResolution"===a||"maxResolution"===a)&&(d=!0);else if(s)if("ogcFilters"===a){if(m.dataSource.setOgcFilters(l,!1),"wfs"===y&&m.ol.getSource().refresh(),"wms"===y){let v;"wfs"===g?v=o.handleOgcFiltersAppliedValue(h,t.dataSource.options.fieldNameGeometry,void 0,i.viewController.getOlProjection()):"wms"===g&&(v=t.dataSource.ol.getParams().FILTER),m.dataSource.ol.updateParams({FILTER:v})}}else if(m.dataSource instanceof Bt&&"timeFilter"===a){m.dataSource.setTimeFilter(l,!1);const v=t.ol.getSource().getParams().TIME;m.dataSource.ol.updateParams({TIME:v})}}}),d&&i.viewController.resolution$.next(i.viewController.resolution$.value)}}(this,o.event,o.layer))}setTarget(r){this.ol.setTarget(r),void 0!==r?this.layerWatcher.subscribe(()=>{},null):this.layerWatcher.unsubscribe()}updateView(r){const t=this.ol.getView(),o=Object.assign({zoom:t.getZoom()},t.getProperties());this.setView(Object.assign(o,r)),r.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=r.maxZoomOnExtent),this.mapViewOptions=r}setView(r){void 0!==this.viewController&&this.viewController.clearStateHistory(),r=Object.assign({constrainResolution:!0},r);const t=new zf.ZP(r);if(this.ol.setView(t),r&&(r.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=r.maxLayerZoomExtent),r.center)){const o=t.getProjection().getCode(),n=V.mi(r.center,o);t.setCenter(n)}}updateControls(r){if(void 0===r)return;const t=[];r.attribution&&t.push(new wr.Z(!0===r.attribution?{}:r.attribution)),r.scaleLine&&t.push(new ec.Z(!0===r.scaleLine?{}:r.scaleLine)),Object.assign([],this.ol.getControls().getArray()).forEach(n=>{this.ol.removeControl(n)}),t.forEach(n=>{this.ol.addControl(n)})}getCenter(r){return this.viewController.getCenter(r)}getExtent(r){return this.viewController.getExtent(r)}getZoom(){return this.viewController.getZoom()}changeBaseLayer(r){if(r){for(const t of this.getBaseLayers())t.visible=!1;r.visible=!0,this.viewController.olView.setMinZoom(r.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(r.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}}getBaseLayers(){return this.layers.filter(r=>!0===r.baseLayer)}getLayerById(r){return this.layers.find(t=>t.id&&t.id===r)}getLayerByAlias(r){return this.layers.find(t=>t.alias&&t.alias===r)}getLayerByOlUId(r){return this.layers.find(t=>(0,Mn.sq)(t.ol)&&(0,Mn.sq)(t.ol)===r)}getLayerByOlLayer(r){const t=(0,Mn.sq)(r);return this.getLayerByOlUId(t)}addLayer(r,t=!0){this.addLayers([r])}addLayers(r,t=!0){let o=0,n=0;const s=r.map(a=>{if(!a)return;const l=a.zIndex?0:a.baseLayer?n++:o++;return this.doAddLayer(a,l)}).filter(a=>void 0!==a);this.setLayers([].concat(this.layers,s))}removeLayer(r){this.removeLayers([r])}removeLayers(r){const t=this.layers$.value.slice(0),o=[];r.forEach(n=>{n instanceof Te&&n.removeLayerFromIDB();const s=t.indexOf(n);s>=0&&(o.push(n),t.splice(s,1),this.handleLinkedLayersDeletion(n,o),o.map(a=>{const l=t.indexOf(a);l>=0&&t.splice(l,1)}))}),o.forEach(n=>this.doRemoveLayer(n)),this.setLayers(t)}handleLinkedLayersDeletion(r,t){let o=function uy(i,r){let t=r,o=t,n=!0;for(;n;)t=o,o=py(i,t),n=!!o;return n||function ly(i){let r=!1;const t=Jr(i);return null!=t&&t.links&&(r=!!t.links.find(n=>n.syncedDelete)),r}(t)||(t=void 0),n?o:t}(this,r);o||(o=r);const n=Qc(this,o,[o]);for(const s of n)t.push(s)}removeAllLayers(){this.layers.forEach(r=>this.doRemoveLayer(r)),this.layers$.next([])}raiseLayer(r){const t=this.getLayerIndex(r);t>1&&this.moveLayer(r,t,t-1)}raiseLayers(r){for(const t of r)this.raiseLayer(t)}lowerLayer(r){const t=this.getLayerIndex(r);t<this.layers.length-1&&this.moveLayer(r,t,t+1)}lowerLayers(r){const t=r.reverse();for(const o of t)this.lowerLayer(o)}moveLayer(r,t,o){const n=this.layers[o],a=r.zIndex;n.baseLayer||r.baseLayer||(r.zIndex=n.zIndex,n.zIndex=a,this.layers[o]=r,this.layers[t]=n,this.layers$.next(this.layers.slice(0)))}doAddLayer(r,t){r.baseLayer&&r.visible&&this.changeBaseLayer(r);const o=this.getLayerById(r.id);if(void 0===o){if(!r.baseLayer&&r.zIndex&&(r.zIndex+=10),void 0===r.zIndex||0===r.zIndex){const n=Math.max(r.baseLayer?0:10,...this.layers.filter(s=>s.baseLayer===r.baseLayer&&s.zIndex<200).map(s=>s.zIndex));r.zIndex=n+1+t}return r.baseLayer&&r.zIndex>9&&(r.zIndex=10),r.setMap(this),this.layerWatcher.watchLayer(r),this.ol.addLayer(r.ol),r}o.visible=!0}doRemoveLayer(r){this.layerWatcher.unwatchLayer(r),this.ol.removeLayer(r.ol),r.setMap(void 0)}setLayers(r){this.layers$.next(this.sortLayersByZIndex(r).slice(0))}sortLayersByZIndex(r){return r.sort((t,o)=>o.zIndex-t.zIndex)}getLayerIndex(r){return this.layers.findIndex(t=>t===r)}}const my=["*"];let Ae=(()=>{class i{constructor(t){this.activityService=t,this.id=`igo-map-target-${(new Date).getTime()}`}get view(){return this._view}set view(t){this._view=t,void 0!==this.map&&this.map.updateView(t)}get controls(){return this._controls}set controls(t){this._controls=t,void 0!==this.map&&this.map.updateControls(t)}ngOnInit(){this.status$$=this.map.status$.subscribe(t=>this.handleStatusChange(t))}ngAfterViewInit(){this.map.setTarget(this.id)}ngOnDestroy(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}handleStatusChange(t){t===ve.Working&&void 0===this.activityId?this.activityId=this.activityService.register():t===ve.Done&&void 0!==this.activityId&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(gn))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},ngContentSelectors:my,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(t,o){1&t&&(e.F$t(),e._UZ(0,"div",0),e.Hsn(1)),2&t&&e.Q6J("id",o.id)},styles:["[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     igo-zoom-button{position:absolute;bottom:50px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-zoom-button{display:none}}[_nghost-%COMP%]     igo-offline-button{position:absolute;bottom:15px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-offline-button{bottom:5px}}[_nghost-%COMP%]     igo-geolocate-button{position:absolute;bottom:5px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-geolocate-button{bottom:5px}}[_nghost-%COMP%]     igo-rotation-button{position:absolute;top:50px;right:5px}[_nghost-%COMP%]     igo-wake-lock-button{position:absolute;top:95px;right:5px}[_nghost-%COMP%]     igo-home-extent-button{position:absolute;bottom:135px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-home-extent-button{bottom:5px;right:95px}}[_nghost-%COMP%]     igo-user-button{position:absolute;bottom:5px;right:55px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-user-button{right:90px}}[_nghost-%COMP%]     igo-baselayers-switcher{position:absolute;bottom:5px;left:5px}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}"]}),i})(),hy=(()=>{class i{constructor(t,o){this.component=t,this.mediaService=o,this.pointerPositionDelay=1e3,this.pointerPositionCoord=new e.vpe}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}ngOnInit(){this.listenToMapPointerMove(),this.listenToMapClick()}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",t=>this.onPointerEvent(t,this.pointerPositionDelay))}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",t=>this.onPointerEvent(t,0))}unlistenToMapPointerMove(){(0,et.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapClick(){this.mapClickListener=void 0}onPointerEvent(t,o){if(t.dragging||this.mediaService.isTouchScreen())return;void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest);const n=(0,V.vs)(t.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(()=>{this.pointerPositionCoord.emit(n)},o)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ae,2),e.Y36(gt))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"}}),i})();function jc(){const i=Math.floor(255*Math.random()),r=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),o=new U.Z({color:[i,r,t,1],width:2}),n=new N.Z({color:[i,r,t,.4]});return s=>{const a=s.get("_style");return a?(new no).createStyle(a):new R.ZP({stroke:o,fill:n,image:new Me.Z({radius:5,stroke:o,fill:n}),text:s.get("_mapTitle")?new St.Z({text:s.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new N.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0}):void 0})}}function Yc(){const i=Math.floor(255*Math.random()),r=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),o=new U.Z({color:[i,r,t,1],width:2}),n=new N.Z({color:[i,r,t,.4]});return new R.ZP({stroke:o,fill:n,image:new Me.Z({radius:5,stroke:o,fill:n})})}function fy(i,r){const o=[new R.ZP({text:new St.Z({text:i.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new N.Z({color:"#000"}),backgroundFill:new N.Z({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new U.Z({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];return"Point"===i.getGeometry().getType()?o.push(new R.ZP({image:new Me.Z({radius:10,stroke:new U.Z({color:"blue",width:3})})})):(o.push(new R.ZP({stroke:new U.Z({color:"white",width:5})})),o.push(new R.ZP({stroke:new U.Z({color:"blue",width:3})}))),o}function _y(i,r){return new R.ZP({image:new di.Z({src:"./assets/igo2/geo/icons/cross_black_18px.svg",imgSize:[18,18]}),text:new St.Z({text:i.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new N.Z({color:"#000"}),backgroundFill:new N.Z({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new U.Z({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}let yy=(()=>{class i{constructor(t,o,n){this.component=t,this.mediaService=o,this.styleService=n,this.pointerHoverFeatureStore=new it([]),this.selectionMVT={},this.hoverFeatureId="hoverFeatureId",this.igoHoverFeatureDelay=1e3,this.igoHoverFeatureEnabled=!1}mouseout(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}ngOnInit(){this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick(),this.map.status$.pipe((0,Ee.q)(1)).subscribe(()=>{this.store=new Ct([],{map:this.map}),this.initStore()}),this.layers$$=this.map.layers$.subscribe(t=>{this.store&&!t.find(o=>"hoverFeatureId"===o.id)&&this.initStore()})}initStore(){qo(this.store,new Te({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new Fe,showInLayerList:!1,exportable:!1,browsable:!1,style:fy})),this.selectionLayer=new Fr.Z({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new cc.Z({projection:this.map.projection}),style:(n,s)=>{if(this.mvtStyleOptions&&n.getId()in this.selectionMVT)return this.createHoverStyle(n,this.mvtStyleOptions,s)}})}createHoverStyle(t,o,n){var s;const a=Object.assign({},o);let l=o.label?o.label.attribute:void 0,c=!(null===(s=o.label)||void 0===s||!s.style);if(t.get("_isLabel")){const u=a.data?a.data.length:0,p=[],d=[],g=[],h=[];for(let m=0;m<u;m++)p.push(0),d.push("rgba(255, 255, 255, 0)"),g.push(0),h.push("rgba(255, 255, 255, 0)");a.radius=p,a.stroke=d,a.width=g,a.fill=h}else a.label=void 0,c=!1,l=void 0;return!c&&l&&(a.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(t,a,n)}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(t=>{this.addFeatureOverlay(t)})}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",t=>this.onMapEvent(t))}listenToMapClick(){this.singleClickMapListener=this.map.ol.on("singleclick",t=>this.onMapSingleClickEvent(t))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unlistenToMapPointerMove(){(0,et.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapSingleClick(){(0,et.B)(this.singleClickMapListener),this.singleClickMapListener=void 0}onMapSingleClickEvent(t){this.clearLayer()}onMapEvent(t){if(t.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen())return void this.clearLayer();void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest);let n,o=-1/0;const s=this.map.ol.getPixelFromCoordinate(t.coordinate);this.lastTimeoutRequest=setTimeout(()=>{if(this.map.ol.forEachFeatureAtPixel(s,(a,l)=>{if(!l)return;const c=this.map.getLayerByOlUId(l.ol_uid);!this.canProcessHover(c)||c.zIndex<=o||(o=c.zIndex,n=l)},{hitTolerance:10,layerFilter:a=>a instanceof Jo.Z||a instanceof Fr.Z}),!n)return this.clearLayer(),void this.pointerHoverFeatureStore.clear();this.map.ol.forEachFeatureAtPixel(s,(a,l)=>{var c,u,p,d,g,h;if(void 0===a.get("hoverSummary")&&a.getProperties()!==(null===(c=this.pointerHoverFeatureStore.all()[0])||void 0===c?void 0:c.getProperties())){let m;if(this.clearLayer(),l instanceof Jo.Z){const y=this.map.getLayerByOlUId(l.ol_uid);if(!this.canProcessHover(y))return;let v=this.handleRenderFeature(a);this.setLayerStyleFromOptions(y,v);const S=[v];v.set("_isLabel",!1);const M=new De.Z;M.setProperties(v.getProperties());const A="Point"===v.getGeometry().getType()?v.getGeometry():new Pe.Z(t.coordinate);return M.setGeometry(A),M.setId(v.getId()),M.set("_isLabel",!0),this.setLayerStyleFromOptions(y,M),S.push(M),this.pointerHoverFeatureStore.load(S),m=y,!0}if(l instanceof Fr.Z){const y=this.map.getLayerByOlUId(l.ol_uid);if(!this.canProcessHover(y))return;null!==(d=null===(p=null===(u=null==y?void 0:y.options)||void 0===u?void 0:u.igoStyle)||void 0===p?void 0:p.styleByAttribute)&&void 0!==d&&d.hoverStyle?this.mvtStyleOptions=y.options.igoStyle.styleByAttribute.hoverStyle:!(null===(h=null===(g=null==y?void 0:y.options)||void 0===g?void 0:g.igoStyle)||void 0===h)&&h.hoverStyle&&(this.mvtStyleOptions=y.options.igoStyle.hoverStyle),this.selectionLayer.setSource(l.getSource()),l.getFeatures(t.pixel).then(v=>{if(!v.length)return this.selectionMVT={},this.selectionLayer.changed(),void this.clearLayer();const S=v[0];if(!S)return void this.clearLayer();let M=this.handleRenderFeature(S);M.set("_isLabel",!1);const A=new De.Z;A.setProperties(M.getProperties());const F="Point"===M.getGeometry().getType()?M.getGeometry():new Pe.Z(t.coordinate);A.setGeometry(F),A.setId(M.getId()),A.set("_isLabel",!0),this.setLayerStyleFromOptions(y,A),this.pointerHoverFeatureStore.load([A]),this.selectionMVT[S.getId()]=M,this.selectionLayer.changed()}),m=y}}},{hitTolerance:10,layerFilter:a=>a===n})},this.igoHoverFeatureDelay)}canProcessHover(t){var o,n,s,a,l;return!(!t||!t.visible||!t.options||(null===(o=t.options.igoStyle)||void 0===o||!o.styleByAttribute)&&(null===(n=t.options.igoStyle)||void 0===n||!n.hoverStyle)||(null===(s=t.options.igoStyle)||void 0===s?void 0:s.styleByAttribute)&&(null===(a=t.options.igoStyle)||void 0===a||!a.styleByAttribute.hoverStyle)&&(null===(l=t.options.igoStyle)||void 0===l||!l.hoverStyle))}handleRenderFeature(t){let o;return t instanceof mc.ZP?(o=new De.Z({geometry:this.getGeometry(t)}),o.setId(t.getId())):t instanceof De.Z&&(o=t),o.setProperties(t.getProperties()),o}addFeatureOverlay(t){if(t.length>0){const o=t[0];this.clearLayer();const n=new De.Z({geometry:o.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(o.getProperties())});this.store.setLayerOlFeatures([n],Y.None)}}setLayerStyleFromOptions(t,o){var n,s,a,l,c;const u=this.store.layer.map.viewController.getResolution();null!==(a=null===(s=null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.igoStyle)||void 0===s?void 0:s.styleByAttribute)&&void 0!==a&&a.hoverStyle?this.store.layer.ol.setStyle(this.createHoverStyle(o,t.options.igoStyle.styleByAttribute.hoverStyle,u)):null!==(c=null===(l=null==t?void 0:t.options)||void 0===l?void 0:l.igoStyle)&&void 0!==c&&c.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(o,t.options.igoStyle.hoverStyle,u))}getHoverSummary(t){let o="";for(const[n,s]of Object.entries(t))!n.startsWith("_")&&"geometry"!==n&&(o+=`${n}: ${s}\n`);return o.length>=2?o.slice(0,-2):o}getGeometry(t){let o;if(t.getOrientedFlatCoordinates){const n=t.getOrientedFlatCoordinates(),s=[];switch(n.forEach((a,l)=>{l%2==0&&s.push([parseFloat(n[l]),parseFloat(n[l+1])])}),t.getType()){case"Point":o=new Pe.Z(s);break;case"Polygon":o=new kt.ZP([s]);break;case"LineString":o=new oo.Z([s])}}else o=t.getGeometry();return o}clearLayer(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ae,2),e.Y36(gt),e.Y36(no))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoHoverFeature",""]],hostBindings:function(t,o){1&t&&e.NdJ("mouseout",function(){return o.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"}}),i})();const Vc=function(i){return{zoom:i}};let pt=(()=>{class i{constructor(){}get zoom(){return this.map.viewController.getZoom()}get minZoom(){return this.map.viewController.olView.getMinZoom()||1}get maxZoom(){return this.map.viewController.olView.getMaxZoom()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},decls:7,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","disabled","click"],["svgIcon","plus"],["svgIcon","minus"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return o.map.viewController.zoomIn()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"button",1),e.NdJ("click",function(){return o.map.viewController.zoomOut()}),e.ALo(5,"translate"),e._UZ(6,"mat-icon",3),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("matTooltip",e.xi3(2,6,"igo.geo.mapButtons.zoomIn",e.VKq(12,Vc,o.zoom+1)))("color",o.color)("disabled",o.zoom>=o.maxZoom),e.xp6(3),e.Q6J("matTooltip",e.xi3(5,9,"igo.geo.mapButtons.zoomOut",e.VKq(14,Vc,o.zoom-1)))("color",o.color)("disabled",o.zoom<=o.minZoom))},dependencies:[T.Hw,w.lW,O.gM,L.X$],styles:[".igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}.igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}.igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"]}),i})();function vy(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"button",2),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onGeolocationClick())}),e.ALo(2,"translate"),e.ALo(3,"translate"),e._UZ(4,"mat-icon",3),e.ALo(5,"async"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("matTooltip",t.map.geolocationController.tracking?e.lcZ(2,3,"igo.geo.mapButtons.geolocateInactive"):e.lcZ(3,5,"igo.geo.mapButtons.geolocate"))("color",t.color),e.xp6(3),e.s9C("svgIcon",e.lcZ(5,7,t.icon$))}}let Jn=(()=>{class i{constructor(t){this.configService=t,this.icon$=new b.X("crosshairs-gps")}get map(){return this._map}set map(t){this._map=t}get color(){return this._color}set color(t){this._color=t}ngAfterContentInit(){this.map.ol.once("rendercomplete",()=>{this.tracking$$=this.map.geolocationController.tracking$.subscribe(t=>{t||this.configService.getConfig("geolocate.basic")?this.icon$.next("crosshairs-gps"):this.icon$.next("crosshairs")})})}ngOnDestroy(){this.tracking$$&&this.tracking$$.unsubscribe()}onGeolocationClick(){this.map.geolocationController.tracking=!this.map.geolocationController.tracking}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(J))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],[3,"svgIcon"]],template:function(t,o){1&t&&e.YNc(0,vy,6,9,"div",0),2&t&&e.Q6J("ngIf",o.map.geolocationController)},dependencies:[f.O5,T.Hw,w.lW,O.gM,f.Ov,L.X$],styles:[".igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"]}),i})(),Rn=(()=>{class i{constructor(t){this.configService=t,this.computeHomeExtent()}computeHomeExtent(){this.homeExtentButtonExtent=this.extentOverride||this.configService.getConfig("homeExtentButton.homeExtButtonExtent"),this.homeExtentButtonCenter=this.centerOverride||this.configService.getConfig("homeExtentButton.homeExtButtonCenter"),this.homeExtentButtonZoom=this.zoomOverride||this.configService.getConfig("homeExtentButton.homeExtButtonZoom"),this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}onToggleClick(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){const t=V.mi(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(t),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(J))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},decls:4,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],["svgIcon","home-map-marker"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return o.onToggleClick()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.mapButtons.home-extent"))("color",o.color))},dependencies:[T.Hw,w.lW,O.gM,L.X$],styles:['@charset "UTF-8";.igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}\\a0[_ngcontent-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}']}),i})(),Cy=(()=>{class i{constructor(t){this.storageService=t,this.color="primary",this.icon$=new b.X("sleep"),this.visible=!1,this.noSleep=new y_,ti.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.addEventListener("blur",()=>{this.disableWakeLock(),this.enabled=!1})),this.enabled?this.enableWakeLock():this.disableWakeLock()}get enabled(){return this.storageService.get("wakeLockEnabled")}set enabled(t){this.storageService.set("wakeLockEnabled",t)}enableWakeLock(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("sleep-off")}disableWakeLock(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("sleep")}toggleWakeLock(){this.enabled?this.disableWakeLock():this.enableWakeLock()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(ce))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",enabled:"enabled"},decls:6,vars:9,consts:[[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"color","matTooltip","click"],[3,"svgIcon"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return o.toggleWakeLock()}),e.ALo(2,"translate"),e.ALo(3,"translate"),e._UZ(4,"mat-icon",2),e.ALo(5,"async"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("color",o.color)("matTooltip",o.enabled?e.lcZ(2,3,"igo.geo.mapButtons.preventScreenLock"):e.lcZ(3,5,"igo.geo.mapButtons.letScreenLock")),e.xp6(3),e.s9C("svgIcon",e.lcZ(5,7,o.icon$)))},dependencies:[T.Hw,w.lW,O.gM,f.Ov,L.X$],styles:[".igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"]}),i})();function Sy(i,r){1&i&&(e.TgZ(0,"div",6)(1,"button",7),e.ALo(2,"translate"),e._UZ(3,"mat-icon",8),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function wy(i,r){if(1&i&&(e._UZ(0,"igo-mini-basemap",9),e.ALo(1,"translate")),2&i){const t=r.$implicit,o=r.index,n=e.oxw(2);e.Q6J("map",n.map)("baseLayer",t)("title",n.baseLayers.length>2&&!n.expand?e.lcZ(1,5,"igo.geo.baselayersSwitcher.title"):t.title)("display",n.expand||0===o&&!n.useStaticIcon)("disabled",!n.expand&&n.baseLayers.length>1)}}const Ty=function(i){return{"container-expand":i}};function My(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("@baseLayerSwitcherState.start",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.showButton=!1)})("@baseLayerSwitcherState.done",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.showButton=!0)})("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.collapseOrExpand())}),e.YNc(1,Sy,4,3,"div",2),e.YNc(2,wy,2,7,"igo-mini-basemap",3),e.TgZ(3,"div",4),e._UZ(4,"mat-icon",5),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("ngClass",e.VKq(4,Ty,t.expand))("@baseLayerSwitcherState",t.expand?"expand":t.useStaticIcon?"collapseIcon":"collapseMap"),e.xp6(1),e.Q6J("ngIf",t.useStaticIcon&&!t.expand&&t.showButton),e.xp6(1),e.Q6J("ngForOf",t.baseLayers)}}let Fy=(()=>{class i{constructor(t){this.mediaService=t,this._baseLayers=[],this.expand=!1,this.showButton=!0,this.mediaService.media$.value===Et.Mobile&&void 0===this.useStaticIcon&&(this.useStaticIcon=!0)}ngAfterViewInit(){this.layers$$=this.map.layers$.subscribe(t=>{this._baseLayers=t.filter(o=>o.baseLayer)})}ngOnDestroy(){this.layers$$.unsubscribe()}collapseOrExpand(){this.expand=!!(this.baseLayers.length>1||this.useStaticIcon)&&!this.expand}get baseLayers(){const t=this.map.viewController.getResolution(),o=this.map.viewController.getZoom(),n=this._baseLayers.filter(a=>(!a.options.maxResolution||t<=a.options.maxResolution)&&(!a.options.minResolution||t>=a.options.minResolution)&&(!a.options.source.options.maxZoom||o<=a.options.source.options.maxZoom)&&(!a.options.source.options.minZoom||o>=a.options.source.options.minZoom)),s=n.filter(a=>!a.visible);return s.length+1===n.length?s:n}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(gt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"ngClass","click"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],["class","mat-typography",3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],[1,"more-baselayers"],["color","primary","svgIcon","menu-down",1,"material-icons","mat-icon","mat-list-avatar"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],["svgIcon","image-multiple"],[1,"mat-typography",3,"map","baseLayer","title","display","disabled"]],template:function(t,o){1&t&&e.YNc(0,My,5,6,"div",0),2&t&&e.Q6J("ngIf",o.baseLayers.length>0)},styles:[".igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"],data:{animation:[(0,ae.X$)("baseLayerSwitcherState",[(0,ae.SB)("collapseIcon",(0,ae.oB)({height:"40px",width:"40px",overflow:"hidden"})),(0,ae.SB)("collapseMap",(0,ae.oB)({height:"85px",overflow:"hidden"})),(0,ae.SB)("expand",(0,ae.oB)({overflow:"hidden"})),(0,ae.eR)("collapse => expand",(0,ae.jt)("200ms")),(0,ae.eR)("expand => collapse",(0,ae.jt)("200ms"))])]}}),i})(),Ay=(()=>{class i{constructor(t,o){this.ngxIndexedDBService=t,this.compression=o,this.dbName="geoData",this.collisionsMap=new Map,this._newData=0}update(t,o,n,s,a){if(!n)return;let l=!1;const c=new Se.x;let p,u=(0,X.of)(n);return n instanceof Blob&&(u=this.compression.compressBlob(n),l=!0),u.pipe((0,Gt.P)(),(0,Vt.b)(d=>(p={url:t,regionID:o,object:d,compressed:l,insertSource:s,insertEvent:a},this.ngxIndexedDBService.getByID(this.dbName,t))),(0,Vt.b)(d=>{if(d){const g=d.regionID;if(g!==o){const h=this.collisionsMap.get(g);void 0!==h?(h.push(d.url),this.collisionsMap.set(g,h)):this.collisionsMap.set(g,[d.url])}return this.customUpdate(p)}return this._newData++,this.ngxIndexedDBService.add(this.dbName,p)})).subscribe(d=>{c.next(d),c.complete()}),c}customUpdate(t){const o=new Se.x;return this.ngxIndexedDBService.deleteByKey(this.dbName,t.url).pipe((0,Vt.b)(s=>s?this.ngxIndexedDBService.add(this.dbName,t):(0,X.of)(void 0))).subscribe(s=>{s&&o.next(s),o.complete()}),o}get(t){return this.ngxIndexedDBService.getByID(this.dbName,t).pipe((0,Z.U)(o=>{if(o){const n=o.object;return o.compressed?this.compression.decompressBlob(n):n}}))}getByID(t){return this.ngxIndexedDBService.getByID(this.dbName,t)}deleteByKey(t){return this.ngxIndexedDBService.deleteByKey(this.dbName,t)}getRegionCountByID(t){const o=new Se.x;return this.getRegionByID(t).subscribe(s=>{o.next(s.length),o.complete()}),o}getRegionByID(t){if(!t)return;const o=IDBKeyRange.only(t);return this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",o)}deleteByRegionID(t){if(!t)return;const o=IDBKeyRange.only(t),n=this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",o);return n.subscribe(s=>{s.forEach(a=>{this.ngxIndexedDBService.deleteByKey(this.dbName,a.url)})}),n}openCursor(t=IDBKeyRange.lowerBound(0),o=rr.TA.readonly){return this.ngxIndexedDBService.openCursorByIndex(this.dbName,"regionID",t,o)}resetCounters(){this.resetCollisionsMap(),this._newData=0}resetCollisionsMap(){this.collisionsMap=new Map}revertCollisions(){for(const[t,o]of this.collisionsMap)for(const n of o)this.ngxIndexedDBService.getByKey(this.dbName,n).pipe((0,Ee.q)(1)).subscribe(s=>{s.regionID=t,this.customUpdate(s)})}get newData(){return this._newData}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(rr.ys),e.LFG(pd))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ly=(()=>{class i{constructor(t,o,n){this.http=t,this.geoDBService=o,this.networkService=n,this.networkOnline=!0,this.networkService.currentState().subscribe(s=>{this.networkOnline=s.connection})}get(t,o){return window.navigator.onLine&&this.networkOnline?this.getOnline(t,o):this.getOffline(t)}getOnline(t,o){let n;switch(o.responseType){case"arraybuffer":n=this.http.get(t,{responseType:"arraybuffer",withCredentials:o.withCredentials});break;case"blob":default:n=this.http.get(t,{responseType:"blob",withCredentials:o.withCredentials});break;case"text":n=this.http.get(t,{responseType:"text",withCredentials:o.withCredentials});break;case"json":n=this.http.get(t,{responseType:"json",withCredentials:o.withCredentials})}return n}getOffline(t){return this.geoDBService.get(t)}isOnline(){return this.networkOnline&&window.navigator.onLine}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(Ay),e.LFG(mn))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Iy=(()=>{class i{constructor(t){this.ngxIndexedDBService=t,this.dbName="layerData"}update(t){const o=new Se.x;return this.ngxIndexedDBService.getByID(this.dbName,t.layerId).pipe((0,Gt.P)(),(0,Vt.b)(n=>n?this.customUpdate(t):this.ngxIndexedDBService.add(this.dbName,t))).subscribe(n=>{o.next(n),o.complete()}),o}customUpdate(t){const o=new Se.x;return this.ngxIndexedDBService.deleteByKey(this.dbName,t.layerId).pipe((0,Vt.b)(s=>s?this.ngxIndexedDBService.add(this.dbName,t):(0,X.of)(void 0))).subscribe(s=>{s&&o.next(s),o.complete()}),o}getByID(t){return this.ngxIndexedDBService.getByID(this.dbName,t)}deleteByKey(t){return this.ngxIndexedDBService.deleteByKey(this.dbName,t)}getAll(){return this.ngxIndexedDBService.getAll(this.dbName)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(rr.ys))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Le=(()=>{class i{constructor(t,o,n,s,a,l,c){this.http=t,this.styleService=o,this.dataSourceService=n,this.geoNetworkService=s,this.messageService=a,this.layerDBService=l,this.authInterceptor=c}createLayer(t){if(!t.source)return;let o;switch(t.source.options&&t.source.options._layerOptionsFromSource&&(t=B.mergeDeep(t.source.options._layerOptionsFromSource,t||{})),t.source.constructor){case Oc:case _a:case Zc:case Dc:case Zr:case kn:o=this.createTileLayer(t);break;case Fe:case ji:case ya:case kc:case _o:o=this.createVectorLayer(t);break;case va:case Bt:o=this.createImageLayer(t);break;case Pc:const n=Sc(t);o=this.createVectorTileLayer(n)}return o}createAsyncLayer(t,o){const n=Sc(t);return n.source?new Ke.y(s=>s.next(this.createLayer(n))):this.dataSourceService.createAsyncDataSource(n.sourceOptions,o).pipe((0,Z.U)(s=>{if(void 0!==s)return this.createLayer(Object.assign(n,{source:s}))}))}createImageLayer(t){return new q_(t,this.messageService,this.authInterceptor)}createTileLayer(t){return new G_(t,this.messageService,this.authInterceptor)}createVectorLayer(t){var o,n,s;let l,a=t.style;if(t.igoStyle||(t.igoStyle={}),this.handleLegacyStyles(t,["styleByAttribute","hoverStyle","mapboxStyle","clusterBaseStyle","style"]),!t.igoStyle.igoStyleObject||null!==(o=t.idbInfo)&&void 0!==o&&o.storeToIdb?t.igoStyle.igoStyleObject&&(null===(n=t.idbInfo)||void 0===n?void 0:n.storeToIdb)&&(a=this.styleService.parseStyle("style",t.igoStyle.igoStyleObject)):a=(p,d)=>this.styleService.createStyle(t.igoStyle.igoStyleObject,p,d),t.source instanceof ya)a=t.source.options.params.style;else if(null!==(s=t.igoStyle)&&void 0!==s&&s.styleByAttribute){const p=this.styleService;t.style=(d,g)=>p.createStyleByAttribute(d,t.igoStyle.styleByAttribute,g),l=new Te(t,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}if(t.source instanceof _o){const p=this.styleService,d=t.igoStyle.clusterBaseStyle;t.style=(g,h)=>p.createClusterStyle(g,h,t.clusterParam,d),l=new Te(t,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}const u=Object.assign({},t,{style:a});return l||(l=new Te(u,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)),this.applyMapboxStyle(l,u),l}handleLegacyStyles(t,o){o.map(n=>{if(t[n]){let s=n;if("style"===n){if(t[n]instanceof R.ZP)return;if("object"!=typeof t[n])return;s="igoStyleObject"}t.igoStyle[s]=t[n],delete t[n],console.warn(`\n        The location of this style option (${n}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${n}: {...} must be transfered to igoStyle: { ${s}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `)}})}createVectorTileLayer(t){let o,n;if(t.igoStyle||(t.igoStyle={}),this.handleLegacyStyles(t,["styleByAttribute","hoverStyle","mapboxStyle","style"]),t.igoStyle.igoStyleObject&&(o=(l,c)=>this.styleService.createStyle(t.igoStyle.igoStyleObject,l,c)),t.igoStyle.styleByAttribute){const l=this.styleService;t.style=(c,u)=>l.createStyleByAttribute(c,t.igoStyle.styleByAttribute,u),n=new Ic(t,this.messageService,this.authInterceptor)}const a=Object.assign({},t,{style:o});return n||(n=new Ic(a,this.messageService,this.authInterceptor)),this.applyMapboxStyle(n,a),n}applyMapboxStyle(t,o){var n;null!==(n=o.igoStyle)&&void 0!==n&&n.mapboxStyle&&this.getStuff(o.igoStyle.mapboxStyle.url).subscribe(s=>{if(s.sprite){const a=this.getAbsoluteUrl(o.igoStyle.mapboxStyle.url,s.sprite);this.getStuff(a+".json").subscribe(l=>{(0,hc.uX)(t.ol,s,o.igoStyle.mapboxStyle.source,void 0,l,a+".png")})}else(0,hc.uX)(t.ol,s,o.igoStyle.mapboxStyle.source)})}getStuff(t){return this.http.get(t).pipe((0,Z.U)(o=>o),(0,he.K)(o=>(console.log("No style was found"),(0,X.of)(o))))}getAbsoluteUrl(t,o){return new RegExp("^http|//","i").test(o)?o:"/"===t.substr(t.length-1)?t+o:t+"/"+o}createAsyncIdbLayers(t="*"){return this.layerDBService.getAll().pipe((0,Vt.b)(o=>{const s=("*"!==t?o.filter(a=>a.detailedContextUri===t):o).map(a=>Object.assign({},a.layerOptions,{sourceOptions:a.sourceOptions}));return(0,Qe.a)(s.map(a=>this.createAsyncLayer(a)))}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(no),e.LFG(wt),e.LFG(Ly),e.LFG(_e),e.LFG(Iy),e.LFG(Sr,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Oy(i,r){if(1&i&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.title," ")}}function Zy(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeBaseLayer(n.baseLayer))}),e._UZ(1,"igo-map-browser",3),e.YNc(2,Oy,2,1,"div",4),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("map",t.basemap),e.xp6(1),e.Q6J("ngIf",t.title)}}let zc=(()=>{class i{constructor(t,o,n){this.layerService=t,this.appRef=o,this.cdRef=n,this.basemap=new ot({controls:{},interactions:!1})}get display(){return this._display}set display(t){this._display=t,this.cdRef.detectChanges(),this.basemap.ol.getView().changed()}get baseLayer(){return this._baseLayer}set baseLayer(t){this._baseLayer=t,this.handleBaseLayerChanged(t)}ngAfterViewInit(){this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",t=>{this.handleMainMapViewChange(t.target)}),this.map.ol.on("pointerdrag",t=>{this.handleMainMapViewChange(t.target.getView())})}ngOnDestroy(){this.map.viewController.olView.un("change",t=>{this.handleMainMapViewChange(t.target)}),this.map.ol.un("pointerdrag",t=>{this.handleMainMapViewChange(t.target.getView())})}changeBaseLayer(t){this.disabled||(this.map.changeBaseLayer(t),this.appRef.tick())}handleMainMapViewChange(t){const o=t.getProperties();this.basemap.viewController.olView.setResolution(o.resolution),this.basemap.viewController.olView.setRotation(o.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}handleBaseLayerChanged(t){this.basemap.removeAllLayers();const o=Object.assign(Object.create(t.options),t.options,{visible:!0,baseLayer:!1}),n=this.layerService.createLayer(o);this.basemap.addLayer(n),this.handleLinkedBaseLayer(n)}handleLinkedBaseLayer(t){const o=t.options.linkedLayers;if(!o)return;const s=o.links;s&&o.linkId===t.options.linkedLayers.linkId&&s.map(l=>{l.linkedIds.map(c=>{const u=this.map.layers.find(p=>{var d;return(null===(d=p.options.linkedLayers)||void 0===d?void 0:d.linkId)===c});if(u){const p=Object.assign(Object.create(u.options),u.options,{zIndex:9e3,visible:!0,baseLayer:!1});this.basemap.addLayer(this.layerService.createLayer(p))}})})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Le),e.Y36(e.z2F),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",title:"title",display:"display",baseLayer:"baseLayer"},decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Zy,3,2,"div",1),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.display))},styles:[".igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer;margin-top:5px}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"]}),i})();const Dy=function(i,r){return{azimuth:i,rotation:r}};function ky(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",1),e.ALo(1,"async"),e.ALo(2,"translate"),e.ALo(3,"translate"),e.TgZ(4,"button",2),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.map.viewController.resetRotation())}),e.ALo(5,"async"),e._UZ(6,"mat-icon",3),e.ALo(7,"async"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,4,t.rotated$)?e.xi3(2,6,"igo.geo.mapButtons.resetRotation",e.WLB(15,Dy,t.azimuthRounded,t.rotationRounded)):e.lcZ(3,9,"igo.geo.mapButtons.tipRotation")),e.xp6(4),e.Q6J("color",t.color)("disabled",!1===e.lcZ(5,11,t.rotated$)),e.xp6(2),e.Q6J("ngStyle",e.lcZ(7,13,t.currentStyle$))}}let Bn=(()=>{class i{constructor(){this.rotated$=new b.X(!1),this.azimuthRounded=0,this.rotationRounded=0,this.currentStyle$=new b.X({transform:"rotate(0rad)"})}ngAfterContentInit(){this.map.viewController.rotation$.subscribe(t=>{const o=t||0,n=180*o/Math.PI;this.rotationRounded=Math.round(n),this.azimuthRounded=Math.round((0,v_.Fh)(-1*n)),this.currentStyle$.next({transform:"rotate("+o+"rad)"}),this.rotated$.next(0!==o)})}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"color","disabled","click"],["svgIcon","navigation",3,"ngStyle"]],template:function(t,o){1&t&&(e.YNc(0,ky,8,18,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.rotated$)&&!o.showIfNoRotation||o.showIfNoRotation)},dependencies:[f.O5,f.PC,T.Hw,w.lW,O.gM,f.Ov,L.X$],styles:[".igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){button[_ngcontent-%COMP%]:disabled, [_nghost-%COMP%]     button .mat-button-ripple-round:disabled{display:none}}"]}),i})();function Py(i,r){if(1&i&&(e.TgZ(0,"div",1)(1,"pre"),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.infoContent)}}let $y=(()=>{class i{constructor(){this.infoContent=""}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(t,o){1&t&&e.YNc(0,Py,3,1,"div",0),2&t&&e.Q6J("ngIf",o.infoContent&&o.infoContent.length)},dependencies:[f.O5],styles:[".infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}"]}),i})();var dt=(()=>{return(i=dt||(dt={})).Layer="layer",i.Group="group",dt;var i})(),Ce=(()=>{return(i=Ce||(Ce={}))[i.wms=0]="wms",i[i.wmts=1]="wmts",i[i.baselayers=2]="baselayers",i[i.arcgisrest=3]="arcgisrest",i[i.tilearcgisrest=4]="tilearcgisrest",i[i.imagearcgisrest=5]="imagearcgisrest",i[i.composite=6]="composite",Ce;var i})();class Ki{constructor(r,t){Object.assign(this,r),this.catalogService=t}}class Ey extends Ki{constructor(r,t){super(r,t),this.type=Ce[Ce[Ce.wms]]}collectCatalogItems(){return this.catalogService.loadCatalogWMSLayerItems(this)}}class Jy extends Ki{constructor(r,t){super(r,t),this.type=Ce[Ce[Ce.wmts]]}collectCatalogItems(){return this.catalogService.loadCatalogWMTSLayerItems(this)}}class Ry extends Ki{constructor(r,t){super(r,t),this.type=Ce[Ce[Ce.baselayers]]}collectCatalogItems(){return this.catalogService.loadCatalogBaseLayerItems(this)}}class By extends Ki{constructor(r,t){super(r,t),this.type=Ce[Ce[Ce.arcgisrest]]}collectCatalogItems(){return this.catalogService.loadCatalogArcGISRestItems(this)}}class Wc extends Ki{constructor(r,t,o){super(r,t),this.type=Ce[Ce[o]]}collectCatalogItems(){return this.catalogService.loadCatalogArcGISRestItems(this)}}class Uy extends Ki{constructor(r,t){super(r,t),this.type=Ce[Ce[Ce.composite]],this.url=null}collectCatalogItems(){return this.catalogService.loadCatalogCompositeLayerItems(this)}}class Kc{static createInstanceCatalog(r,t){let o;return o=r.hasOwnProperty("composite")?new Uy(r,t):r.type===Ce[Ce.baselayers]?new Ry(r,t):r.type===Ce[Ce.arcgisrest]?new By(r,t):r.type===Ce[Ce.tilearcgisrest]?new Wc(r,t,Ce.tilearcgisrest):r.type===Ce[Ce.imagearcgisrest]?new Wc(r,t,Ce.imagearcgisrest):r.type===Ce[Ce.wmts]?new Jy(r,t):new Ey(r,t),o}}let Sa=(()=>{class i{constructor(t,o,n){this.http=t,this.messageService=o,this.languageService=n,this.queryEnabled=!0,this.defaultFeatureCount=20,this.featureCount=20,this.previousMessageIds=[]}query(t,o){this.previousMessageIds.length&&this.previousMessageIds.forEach(a=>{this.messageService.remove(a)});const n=t.filter(a=>a.visible&&a.isInResolutionsRange).map(a=>this.queryLayer(a,o));return[].concat.apply([],n)}queryLayer(t,o){const n=this.getQueryUrl(t.dataSource,o,!1,t.map.viewController.getExtent());if(!n)return(0,X.of)([]);const s=t.map.viewController.getResolution(),a=t.map.viewController.getScale();if(t.dataSource.options.queryFormat===qe.HTMLGML2){if("string"==typeof n){const u=this.getQueryUrl(t.dataSource,o,!0);return this.http.get(u,{responseType:"text"}).pipe((0,ia.z)(p=>{const d=this.mergeGML(p,n,t),g=d[0],h=d[1];return this.http.get(n,{responseType:"text"}).pipe((0,Z.U)(m=>this.extractData(m,t,o,n,g,h)))}))}const l=this.getQueryUrl(t.dataSource,o,!0);let c=[];for(let u=0;u<l.length;u++){const p=l[u];this.checkScaleAndResolution(s,a,p)&&c.push(this.requestDataForHTMLGML2(p.url,n[u].url,t,o))}return c}{if("string"==typeof n)return this.http.get(n,{responseType:"text"}).pipe((0,Z.U)(u=>this.extractData(u,t,o,n)));let l=[];for(let c=0;c<n.length;c++){const u=n[c];if(this.checkScaleAndResolution(s,a,u)){const p=this.http.get(u.url,{responseType:"text"});l.push(p.pipe((0,Z.U)(d=>this.extractData(d,t,o,u.url))))}}return l}}requestDataForHTMLGML2(t,o,n,s){return this.http.get(t,{responseType:"text"}).pipe((0,ia.z)(a=>{const l=this.mergeGML(a,o,n),c=l[0],u=l[1];return this.http.get(o,{responseType:"text"}).pipe((0,Z.U)(p=>this.extractData(p,n,s,o,c,u)))}))}checkScaleAndResolution(t,o,n){let s,a;return!(n.minResolution||n.maxResolution||n.minScale||n.maxScale)||(n.minResolution&&n.maxResolution?t>=n.minResolution&&t<=n.maxResolution&&(a=!0):(n.minResolution&&t>=n.minResolution&&(a=!0),n.maxResolution&&t<=n.maxResolution&&(a=!0)),n.minScale&&n.maxScale?o>n.minScale&&o<n.maxScale&&(s=!0):(n.maxScale&&o<=n.maxScale&&(s=!0),n.minScale&&o>=n.minScale&&(s=!0)),!0===s&&!0===a||!0===a&&!s||!0===s&&!a)}mergeGML(t,o,n){var s,a;let c=(new la.Z).readFeatures(t);0===c.length&&(c=(new nc.Z).readFeatures(t));const u=new __.Z([]);let p;const d=[];let h,g=new gc.Z([]);const m=c.length,S=this.getQueryParams(o.toLowerCase()).bbox.split(","),M=Je.lJ();let F,k,ne,se;if(Je.l7(M,S),null!==(a=null===(s=n.options)||void 0===s?void 0:s.source)&&void 0!==a&&a.options){const de=n.options.source.options;de.queryTitle&&(k=de.queryTitle)}switch(c.map(de=>{if(k){let pe=de.getProperties()[k];pe&&(F=F?`${F},${pe}`:pe)}const ge=de.getGeometry().getCoordinates(),xe=de.getGeometry().getType();switch(!h&&(h=xe),xe){case"Point":1===m?p=new Pe.Z(ge,"XY"):d.push(ge);break;case"LineString":u.appendLineString(new oo.Z(ge,"XY"));break;case"Polygon":g.appendPolygon(new kt.ZP(ge,"XY"));break;case"MultiPolygon":g=new gc.Z(ge,"XY");break;default:return}}),ne=0===d.length&&p?{type:p.getType(),coordinates:p.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(d)]},h){case"LineString":se={type:u.getType(),coordinates:u.getCoordinates()};break;case"Point":se=ne;break;case"Polygon":case"MultiPolygon":se={type:g.getType(),coordinates:g.getCoordinates()}}const z={};return k&&(z[k]=F),[se,z]}cross(t,o,n){return(t[0]-n[0])*(o[1]-n[1])-(t[1]-n[1])*(o[0]-n[0])}convexHull(t){t.sort((s,a)=>s[0]===a[0]?s[1]-a[1]:s[0]-a[0]);const o=[];for(const s of t){for(;o.length>=2&&this.cross(o[o.length-2],o[o.length-1],s)<=0;)o.pop();o.push(s)}const n=[];for(let s=t.length-1;s>=0;s--){for(;n.length>=2&&this.cross(n[n.length-2],n[n.length-1],t[s])<=0;)n.pop();n.push(t[s])}return n.pop(),o.pop(),o.concat(n)}extractData(t,o,n,s,a,l){var c,u,p;const d=o.dataSource,g=this.getAllowedFieldsAndAlias(o);let h=[];switch(d.options.queryFormat){case qe.GML3:h=this.extractGML3Data(t,o.zIndex,g);break;case qe.JSON:case qe.GEOJSON:case qe.GEOJSON2:h=this.extractGeoJSONData(t,o.zIndex,g);break;case qe.ESRIJSON:h=this.extractEsriJSONData(t,o.zIndex,g);break;case qe.TEXT:h=this.extractTextData(t);break;case qe.HTML:h=this.extractHtmlData(t,d.queryHtmlTarget,s);break;case qe.HTMLGML2:h=this.extractHtmlData(t,d.queryHtmlTarget,s,a,l);break;default:h=this.extractGML2Data(t,o,g)}if(h.length>0&&(null===h[0].geometry||!h[0].geometry)){const v=this.createGeometryFromUrlClick(s);for(const S of h)S.geometry=v}const m=o.dataSource;if((null!==(c=m.params)&&void 0!==c&&c.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(s)&&((null===(u=m.params)||void 0===u?void 0:u.FEATURE_COUNT)&&this.featureCount>1&&h.length===this.featureCount||(null===(p=m.params)||void 0===p||!p.FEATURE_COUNT)&&h.length===this.defaultFeatureCount)){const v=this.messageService.info("igo.geo.query.featureCountMax",void 0,void 0,{value:o.title});this.previousMessageIds.push(v.toastId)}return h.map((v,S)=>{var M;const A=v.properties[d.mapLabel];let F;if("wms"===(null===(M=o.options.sourceOptions)||void 0===M?void 0:M.type)){const se=o.options.sourceOptions;F=se?se.excludeAttribute:void 0}let k=this.getQueryTitle(v,o);!k&&h.length>1?k=`${o.title} (${S+1})`:k||(k=o.title);const ne=Object.assign({},v.meta||{},{id:Ze(),title:k,mapTitle:A,sourceTitle:o.title,order:1e3-o.zIndex,excludeAttribute:F});return Object.assign(v,{meta:ne,projection:"carto"===d.options.type?"EPSG:4326":n.projection})})}createGeometryFromUrlClick(t){const o=this.getQueryParams(t.toLowerCase()),n=o.bbox,s=parseInt(o.width,10),a=parseInt(o.height,10),l=parseInt(o.i||o.x,10),c=parseInt(o.j||o.y,10),u=n.split(",");let p=.05*(Math.abs(parseFloat(u[0]))-Math.abs(parseFloat(u[2])));Math.abs(parseFloat(u[0]))<180&&(p=.045);const d=parseFloat(u[0])+Math.abs(parseFloat(u[0])-parseFloat(u[2]))*l/s-p,g=parseFloat(u[1])+Math.abs(parseFloat(u[1])-parseFloat(u[3]))*c/a-p,h=d+2*p,m=g+2*p,y="POLYGON(("+d+" "+g+", "+d+" "+m+", "+h+" "+m+", "+h+" "+g+", "+d+" "+g+"))",M=(new Fn.Z).readFeature(y).getGeometry();return{type:M.getType(),coordinates:M.getCoordinates()}}extractGML2Data(t,o,n){let a=(new la.Z).readFeatures(t);if(0===a.length){const l=new nc.Z;try{a=l.readFeatures(t)}catch(c){console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return a.map(l=>this.featureToResult(l,o,n))}extractGML3Data(t,o,n){const s=new sc.Z;let a=[];try{a=s.readFeatures(t)}catch(l){console.warn("query.service: GML3 is not well supported")}return a.map(l=>this.featureToResult(l,o,n))}extractGeoJSONData(t,o,n){let s=[];try{s=JSON.parse(t.replace(/(\r|\n)/g," ")).features}catch(a){console.warn("query.service: Unable to parse geojson","\n",t)}return s.map(a=>a.meta={id:Ze(),order:1e3-o,alias:n}),s}extractEsriJSONData(t,o,n){if(t)try{if(JSON.parse(t).error)return[]}catch(l){}return(new Mr.Z).readFeatures(t).map(l=>this.featureToResult(l,o,n))}extractTextData(t){return[]}extractHtmlData(t,o,n,s,a){const l=this.getQueryParams(n.toLowerCase()),c=l.crs||l.srs||"EPSG:3857",u=this.createGeometryFromUrlClick(n);o!==io.BLANK&&o!==io.IFRAME&&(o=io.IFRAME);const p=t.toLowerCase().indexOf("<body>"),d=t.toLowerCase().lastIndexOf("</body>")+7;return""===b_(t.slice(p,d).replace(/(\r|\n|\s)/g,""))||""===t?[]:[{type:le,projection:c,properties:Object.assign({target:o,body:t,url:n},a),geometry:s||u}]}getQueryParams(t){const o=t.split("?");if(!o[1])return;const n=o[1].split("&"),s={};return n.forEach(a=>{a=a.split("="),s[a[0]]=decodeURIComponent(a[1]||"")}),s}featureToResult(t,o,n){const s=t.getGeometry(),a=Object.assign({},t.getProperties());let l;return delete a.geometry,delete a.GEOMETRIE,delete a.boundedBy,delete a.shape,delete a.SHAPE,delete a.SHAPE_S,delete a.SHAPE_L,delete a.SHAPE_P,delete a.the_geom,delete a.geom,delete a.geom32198,s&&(l={type:s.getType(),coordinates:s.getCoordinates()}),{type:le,projection:void 0,properties:a,geometry:l,meta:{id:Ze(),order:1e3-o,alias:n}}}getQueryUrl(t,o,n=!1,s){let a;if(t.options.queryUrls)return this.getCustomQueryUrl(t,o,s);switch(t.constructor){case Bt:const l=t,c={INFO_FORMAT:l.params.INFO_FORMAT||this.getMimeInfoFormat(t.options.queryFormat),QUERY_LAYERS:l.params.LAYERS,FEATURE_COUNT:l.params.FEATURE_COUNT||this.defaultFeatureCount};l.params.FEATURE_COUNT&&(this.featureCount=l.params.FEATURE_COUNT),n&&(c.INFO_FORMAT=this.getMimeInfoFormat(qe.GML2)),a=l.ol.getFeatureInfoUrl(o.coordinates,o.resolution,o.projection,c);break;case Zr:const u=t;a=`${"https://"+u.options.account+".carto.com/api/v2/sql?"}format=GeoJSON${"&q="+u.options.config.layers[0].options.sql} WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(${o.coordinates[0]+","+o.coordinates[1]+"),3857),"+(u.options.queryPrecision?u.options.queryPrecision:"1000")+"))"}`;break;case va:case kn:const v=t,S=Math.abs(s[0]-s[2]),M=Math.abs(s[1]-s[3]),F=.005*(S>M?S:M),k=v.options.queryPrecision?v.options.queryPrecision:F,ne=Je.f3(Je.hI([o.coordinates]),k);a=`${v.options.url+"/"+v.options.layer+"/query/"}?${["f=json",`geometry=${encodeURIComponent('{"xmin":'+ne[0]+',"ymin":'+ne[1]+',"xmax":'+ne[2]+',"ymax":'+ne[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}`}return a}getMimeInfoFormat(t){let o="application/vnd.ogc.gml";const n=Object.keys(qe).find(s=>qe[s]===t);return n&&(o=Xt[n]),o}getAllowedFieldsAndAlias(t){var o,n,s;let a;return(null===(s=null===(n=null===(o=t.options)||void 0===o?void 0:o.source)||void 0===n?void 0:n.options)||void 0===s?void 0:s.sourceFields)&&t.options.source.options.sourceFields.length>=1&&(a={},t.options.source.options.sourceFields.forEach(l=>{a[l.name]=l.alias?l.alias:l.name})),a}getQueryTitle(t,o){var n,s;let a;if(null!==(s=null===(n=o.options)||void 0===n?void 0:n.source)&&void 0!==s&&s.options){const l=o.options.source.options;l.queryTitle&&(a=this.getLabelMatch(t,l.queryTitle))}return a}getLabelMatch(t,o){let n=o;const s=Array.from(o.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(a=>{n=n.replace(a[0],t.properties[a[1]])}),0===s.length&&n===o&&(n=t.properties[o]||o),n}getCustomQueryUrl(t,o,n){const s=Je.p8(o.coordinates,o.resolution,0,[101,101]);return t.options.queryUrls.map(a=>{let l={url:a.url.replace(/\{bbox\}/g,s.join(",")).replace(/\{x\}/g,o.coordinates[0].toString()).replace(/\{y\}/g,o.coordinates[1].toString()).replace(/\{resolution\}/g,o.resolution.toString()).replace(/\{srid\}/g,o.projection.replace("EPSG:",""))};return n&&l.url.replace(/\{xmin\}/g,n[0].toString()).replace(/\{ymin\}/g,n[1].toString()).replace(/\{xmax\}/g,n[2].toString()).replace(/\{ymax\}/g,n[3].toString()),a.maxResolution&&(l.maxResolution=a.maxResolution),a.minResolution&&(l.minResolution=a.minResolution),a.minScale&&(l.minScale=a.minScale),a.maxScale&&(l.maxScale=a.maxScale),l})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(_e),e.LFG(D))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Un(i){return!0===i.dataSource.options.queryable}function qy(i){const r=i.get("_layer");return void 0!==r&&Un(r)&&function Ny(i){const r=i.dataSource;return void 0===r.options.queryLayerFeatures||!0===r.options.queryLayerFeatures}(r)}let Xc=(()=>{class i{constructor(t,o){this.component=t,this.queryService=o,this.queries$$=[],this.queryFeatures=!1,this.queryFeaturesHitTolerance=0,this.waitForAllQueries=!0,this.query=new e.vpe}get map(){return this.component.map}ngAfterViewInit(){this.listenToMapClick(),this.addDragBoxInteraction()}ngOnDestroy(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",t=>this.onMapEvent(t))}unlistenToMapClick(){(0,et.B)(this.mapClickListener),this.mapClickListener=void 0}onMapEvent(t){if(this.cancelOngoingQueries(),!this.queryService.queryEnabled)return;const o=[];this.queryFeatures&&o.push(this.doQueryFeatures(t));const n=this.map.ol.getView().getResolution(),s=this.map.layers.filter(Un);o.push(...this.queryService.query(s,{coordinates:t.coordinate,projection:this.map.projection,resolution:n})),0!==o.length&&(this.waitForAllQueries?this.queries$$.push((0,Sn.$)(...o).subscribe(a=>{const l=[].concat(...a);this.query.emit({features:l,event:t})})):this.queries$$=o.map(a=>a.subscribe(l=>{this.query.emit({features:l,event:t})})))}doQueryFeatures(t){const o=[];if("singleclick"===t.type)this.map.ol.forEachFeatureAtPixel(t.pixel,(n,s)=>{const a=this.map.getLayerById(s.values_._layer.id);if(!a.dataSource.options.queryFormatAsWms&&n)if(n.get("features"))for(const l of n.get("features")){const c=_i(l,this.map.projection);c.meta={title:l.values_.nom,id:s.values_._layer.id+"."+l.id_,icon:l.values_._icon,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(a)},o.push(c)}else if(n instanceof mc.ZP){const l=function W_(i,r,t,o="EPSG:4326"){let n,s,a,l;t?(s=t.get("title"),t.get("sourceOptions")&&(a=t.get("sourceOptions").excludeAttribute,l=t.get("sourceOptions").excludeAttributeOffline)):s=i.get("_title");const c=new be.Z,u=i.getProperties(),p=i.getType();if("Polygon"===p){const y=i.getEnds();n=new kt.ZP(i.getFlatCoordinates(),"XY",y)}else"Point"===p?n=new Pe.Z(i.getFlatCoordinates(),"XY"):"LineString"===p&&(n=new oo.Z(i.getFlatCoordinates(),"XY"));const d=c.writeGeometryObject(n,{dataProjection:o,featureProjection:r}),g=i.getId()?i.getId():Ze(),h=i.get("_mapTitle"),m=V.$A(i.getExtent(),r,o);return{type:le,projection:o,extent:m,meta:{id:g,title:s||h||g,mapTitle:h,excludeAttribute:a,excludeAttributeOffline:l},properties:u,geometry:d,ol:i}}(n,this.map.projection,s);l.meta={id:s.values_._layer.id+"."+l.meta.id,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(a),title:this.queryService.getQueryTitle(l,a)||l.meta.title},o.push(l)}else{const l=_i(n,this.map.projection,s);l.meta={id:s.values_._layer.id+"."+l.meta.id,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(a),title:this.queryService.getQueryTitle(l,a)||l.meta.title},o.push(l)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:qy});else if("boxend"===t.type){const s=t.target.getGeometry().getExtent();this.map.layers.filter(Un).filter(a=>a instanceof Te&&a.visible).map(a=>{a.dataSource.ol.forEachFeatureIntersectingExtent(s,c=>{const u=_i(c,this.map.projection,a.ol);u.meta={id:a.id+"."+c.getId(),icon:c.values_._icon,sourceTitle:a.title,alias:this.queryService.getAllowedFieldsAndAlias(a),title:this.queryService.getQueryTitle(u,a)||u.meta.title},o.push(u)})})}return(0,X.of)(o)}cancelOngoingQueries(){this.queries$$.forEach(t=>t.unsubscribe()),this.queries$$=[]}addDragBoxInteraction(){let t;const o=this.map.ol.getInteractions().getArray();for(const n of o)if(n instanceof $r){t=n;break}void 0===t&&(t=new $r({condition:Lr}),this.map.ol.addInteraction(t),this.olDragSelectInteraction=t),this.olDragSelectInteractionEndKey=t.on("boxend",n=>this.onMapEvent(n))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,et.B)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ae,2),e.Y36(Sa))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"}}),i})(),_t=(()=>{class i{constructor(t,o){if(this.storageService=o,this.options=t,this.storageService){const n=this.storageService.get(this.getId()+".options");n&&(this.options=B.mergeDeep(this.options,n))}this.options=B.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(n=>{this.setParamFromSetting(n,!1)})}getId(){throw new Error('You have to implement the method "getId".')}getType(){throw new Error('You have to implement the method "getType".')}getDefaultOptions(){throw new Error('You have to implement the method "getDefaultOptions".')}get title(){return this.options.title}get available(){return!1!==this.options.available}set enabled(t){this.options.enabled=t}get enabled(){return this.available&&!1!==this.options.enabled}get showInPointerSummary(){return this.options.showInPointerSummary||!1}get showInSettings(){const t=this.options.showInSettings;return void 0===t||t}get searchUrl(){return this.options.searchUrl}get params(){return void 0===this.options.params?{}:this.options.params}get settings(){return void 0===this.options.settings?[]:this.options.settings}set featureStoresWithIndex(t){this._featureStoresWithIndex=t}get featureStoresWithIndex(){return this._featureStoresWithIndex}setWorkspaces(t){this.options.available=t.filter(s=>s.entityStore.searchDocument).length>=1;const o=[];this.featureStoresWithIndex=t.filter(s=>s.entityStore.searchDocument).map(s=>(o.push({title:s.title,value:s.title,enabled:!0}),s.entityStore));const n=this.options.settings.find(s=>"datasets"===s.title);n&&(n.values=o),this.setParamFromSetting(n)}setParamFromSetting(t,o=!0){switch(t.type){case"radiobutton":t.values.forEach(s=>{s.enabled&&(this.options.params=Object.assign(this.options.params||{},{[t.name]:s.value}))});break;case"checkbox":let n="";t.values.filter(s=>!1!==s.available).forEach(s=>{s.enabled&&(n+=s.value+",")}),n=n.slice(0,-1),this.options.params=Object.assign(this.options.params||{},{[t.name]:n})}o&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}get displayOrder(){return void 0===this.options.order?99:this.options.order}getHashtagsValid(t,o){const n=t.match(/(#[A-Za-z+]+)/g);if(!n)return;const s=this.getSettingsValues(o),a=[];return n.forEach(l=>{s.values.forEach(c=>{const u=l.substring(1);if("string"==typeof c.value){const p=c.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),d=p.indexOf(u.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==d&&a.push(p[d])}c.hashtags&&-1!==c.hashtags.indexOf(u.toLowerCase())&&a.push(c.value)})}),a.filter((l,c)=>a.indexOf(l)===c)}getSettingsValues(t){return this.getDefaultOptions().settings.find(o=>o.name===t)}}return i.id="",i.type="",i})(),eu=(()=>{class i extends _t{constructor(t){super(t)}getId(){return i.id}getType(){return i.type}getDefaultOptions(){return{title:"Carte"}}}return i.id="map",i.type=le,i.\u0275fac=function(t){return new(t||i)(e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();class It{static getGoogleMapsCoordLink(r,t){return"https://www.google.com/maps?q="+t+","+r}static getGoogleStreetViewLink(r,t){return"https://www.google.com/maps?q=&layer=c&cbll="+t+","+r}static getGoogleMapsNameLink(r){return"https://www.google.com/maps?q="+encodeURI(r)}}class Gy{static getOpenStreetMapLink(r,t,o=17){return`https://www.openstreetmap.org/?mlat=${t}&mlon=${r}#map=${o}/${t}/${r}`}static getOpenStreetCamLink(r,t,o=17){return`https://openstreetcam.org/map/@${t},${r},${o}z`}}let wa=(()=>{class i{constructor(t,o,n,s,a){this.http=t,this.config=o,this.languageService=n,this.messageService=s,this.capabilitiesService=a}loadCatalogs(){const t=this.config.getConfig("context")||{},o=this.config.getConfig("catalog")||{},n=o.url||t.url,s=o.sources||[],a=[];if(n){if(o.baseLayers){const u=this.languageService.translate.instant("igo.geo.catalog.baseLayers");a.push((0,X.of)([{id:"catalog.baselayers",title:u,url:`${n}/baselayers`,type:"baselayers"}]))}const l=this.http.get(`${n}/catalogs`).pipe((0,Z.U)(c=>c.map(u=>Object.assign(u,u.options))),(0,he.K)(c=>Bi.E));a.push(l)}return s.length>0&&a.push((0,X.of)(s).pipe((0,Z.U)(l=>l.map(c=>(c.id||(c.id=Ze()),c))))),(0,Sn.$)(...a).pipe((0,Z.U)(l=>[].concat.apply([],l)))}loadCatalogItems(t){let o;return o=Kc.createInstanceCatalog(t,this),o.collectCatalogItems()}loadCatalogBaseLayerItems(t){return this.getCatalogBaseLayersOptions(t).pipe((0,Z.U)(o=>{const n=o.map(s=>({id:Dn(s.sourceOptions),title:s.title,type:dt.Layer,externalProvider:t.externalProvider,options:s}));return[{id:"catalog.group.baselayers",type:dt.Group,externalProvider:t.externalProvider,title:t.title,items:n}]}))}getCatalogBaseLayersOptions(t){return this.http.get(t.url)}loadCatalogWMSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,Z.U)(o=>{const n=[];if(!o)return n;o.Service&&o.Service.Abstract&&o.Service.Abstract.length&&(t.abstract=o.Service.Abstract);const s=[];this.flattenWmsCapabilities(o.Capability.Layer,0,s,t.groupSeparator);const a=Object.assign({},o.Capability.Layer);return a.Layer=s.filter(l=>0!==l.Layer.length),this.includeRecursiveItems(t,a,n),n}))}flattenWmsCapabilities(t,o=0,n,s=" / "){if(!n.includes(t.Title)){const a=Object.assign({},t);a.Layer=[],n.push(a)}for(const a of t.Layer){const l=Object.assign({},a);o>0&&(l.Title=t.Title+s+a.Title),a.Layer?this.flattenWmsCapabilities(l,o+1,n,s):n.find(c=>c.Title===t.Title).Layer.push(a)}}loadCatalogWMTSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,Z.U)(o=>this.getWMTSItems(t,o)))}loadCatalogArcGISRestItems(t){return this.getCatalogCapabilities(t).pipe((0,Z.U)(o=>this.getArcGISRESTItems(t,o)))}loadCatalogCompositeLayerItems(t){const o=t.composite,n=[];o.map(g=>{g.sortDirection=t.sortDirection,n.push(Kc.createInstanceCatalog(g,this))});const s=[];n.map(g=>s.push(g.collectCatalogItems()));let a=[];function l(g){return g.reduce((h,m)=>h.concat(m.type===dt.Group?l(m.items):m),[])}if(Object.keys(o).find(g=>o[g].groupImpose)){const g=(h,m)=>{const y=n[m],v=Object.assign({},y.groupImpose);v.address=y.id,v.type=dt.Group,v.externalProvider=y.externalProvider,void 0===v.sortDirection&&(v.sortDirection=y.sortDirection),v.items=[];const S=l(h);return S.map(M=>M.address=`${v.address}.${v.id}`),v.items=S,v};a=s.map((h,m)=>h.pipe((0,Z.U)(y=>o[m].groupImpose?g(y,m):y)))}else a=s;const c=(0,Sn.$)(...a).pipe((0,Z.U)(g=>[].concat(...g))),p=(g,h)=>g.reduce((m,y,v,S)=>{const M=h(y),A=Object.assign({},y);if(y.type===dt.Layer){const F=[],k=[];if(S.filter((z,de)=>{let ge=!1;return z.title===M&&z.type===dt.Layer&&(de!==v&&z.address!==y.address&&(ge=!0),F.push(de)),ge}).length>0){let z=F.findIndex(de=>de===v)+1;A.title=`${y.title} (${z})`,z=k.findIndex(de=>de===v)+1,A.newMetadataUrl=`${y.newMetadataUrl} (${z})`}m.find(z=>z.title===A.title&&z.type===dt.Layer)||(m[m.length]=A)}else y.type===dt.Group&&(A.items=p(y.items,F=>F.title),m[m.length]=A);return m},[]);return c.pipe((0,Z.U)(g=>((g,h)=>g.reduce((m,y)=>{const v=(h=>h.id)(y),S=m.find(M=>M.id===v);if(S){const M=m.indexOf(S);-1===m[M].address.split("|").indexOf(y.address)&&(m[M].address=`${m[M].address}|${y.address}`),m[M].items.push(...y.items)}else m[m.length]=y;return m},[]))(g)),(0,Z.U)(g=>[].concat(...g)),(0,Z.U)(g=>p(g,h=>h.title)))}getCatalogCapabilities(t){return this.capabilitiesService.getCapabilities(Ce[t.type],t.url,t.version).pipe((0,he.K)(n=>(this.messageService.error(t.title?"igo.geo.catalog.unavailable":"igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle",void 0,t.title?{value:t.title}:void 0),console.error(n),(0,X.of)(void 0))))}computeForcedProperties(t,o){if(!o||0===o.length)return;const n={layerName:t,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},s=o.find(a=>"*"===a.layerName);return s&&(s.metadataAbstractAll&&(n.metadataAbstractAll=s.metadataAbstractAll),s.metadataUrlAll&&(n.metadataUrlAll=s.metadataUrlAll)),o.map(a=>{t===a.layerName&&(a.title&&(n.title=a.title),a.metadataUrl&&(n.metadataUrl=a.metadataUrl),a.metadataAbstract&&(n.metadataAbstract=a.metadataAbstract))}),n}prepareCatalogItemLayer(t,o,n,s){const a=this.retrieveLayerInfoFormat(t.Name,n),l=s.showLegend&&t.Style?this.capabilitiesService.getStyle(t.Style):void 0,c=Object.assign({},s.queryParams,{LAYERS:t.Name,VERSION:s.version}),u={type:"wms",url:s.url,crossOrigin:s.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:a,queryHtmlTarget:a===qe.HTML||a===qe.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},p=Object.assign({},u,s.sourceOptions,{params:c}),d=this.computeForcedProperties(t.Name,s.forcedProperties);let g,h=!0;t.Abstract?g=t.Abstract:!t.Abstract&&s.abstract&&(g=s.abstract);let y=(null==d?void 0:d.metadataUrl)||(null==d?void 0:d.metadataUrlAll)||((null==t?void 0:t.DataURL)&&(null==t?void 0:t.DataURL.length)>0?null==t?void 0:t.DataURL[0].OnlineResource:void 0),v=(null==d?void 0:d.metadataAbstract)||(null==d?void 0:d.metadataAbstractAll)||g;!(null!=d&&d.metadataUrl)&&!(null!=d&&d.metadataUrlAll)&&((null==d?void 0:d.metadataAbstract)||(null==d?void 0:d.metadataAbstractAll))&&(h=!1),(null==d?void 0:d.metadataAbstract)&&(null==d?void 0:d.metadataUrlAll)&&(h=!1);const S={id:Dn(p),type:dt.Layer,title:null!=d&&d.title?d.title:t.Title,address:o,externalProvider:s.externalProvider||!1,options:{maxResolution:ct(t.MaxScaleDenominator),minResolution:ct(t.MinScaleDenominator),metadata:{url:y,extern:h,abstract:v,type:u.type},legendOptions:l,tooltip:{type:s.tooltipType},sourceOptions:p}};return B.removeUndefined(S)}prepareCatalogItemGroup(t,o,n,s,a){return{id:n,type:dt.Group,title:t.Title,address:a.id,externalProvider:a.externalProvider||!1,sortDirection:a.sortDirection,items:t.Layer.reduce((c,u)=>{if(void 0!==u.Layer){const d=this.prepareCatalogItemGroup(u,o,n+`.group.${u.Name||u.Layer[0].Name}`,s,a);c.push(d)}else{if(!1===this.testLayerRegexes(u.Name,o))return c;const p=this.prepareCatalogItemLayer(u,n,s,a);c.push(p)}return c},[])}}includeRecursiveItems(t,o,n,s=0){const a=(t.regFilters||[]).map(l=>new RegExp(l));if(o.Layer)for(const l of o.Layer){if(void 0!==l.Layer){this.includeRecursiveItems(t,l,n,s+1);continue}const c=this.findCatalogInfoFormat(t);if(0!==s){const p=this.prepareCatalogItemGroup(o,a,`catalog.group.${o.Name||l.Name}`,c,t);0!==p.items.length&&n.push(p);break}if(!1!==this.testLayerRegexes(l.Name,a)){const u=this.prepareCatalogItemLayer(l,t.id,c,t);n.push(u)}}}getWMTSItems(t,o){if(!o)return[];const n=o.Contents.Layer,s=(t.regFilters||[]).map(a=>new RegExp(a));return o.ServiceIdentification&&o.ServiceIdentification.Abstract&&o.ServiceIdentification.Abstract.length&&(t.abstract=o.ServiceIdentification.Abstract),n.map(a=>{const l=this.computeForcedProperties(a.Title,t.forcedProperties);let c=!0,u=(null==l?void 0:l.metadataUrl)||(null==l?void 0:l.metadataUrlAll),p=(null==l?void 0:l.metadataAbstract)||(null==l?void 0:l.metadataAbstractAll)||t.abstract;if(!(null!=l&&l.metadataUrl)&&!(null!=l&&l.metadataUrlAll)&&((null==l?void 0:l.metadataAbstract)||(null==l?void 0:l.metadataAbstractAll))&&(c=!1),(null==l?void 0:l.metadataAbstract)&&(null==l?void 0:l.metadataUrlAll)&&(c=!1),!1===this.testLayerRegexes(a.Identifier,s))return;const d=Object.assign({},t.queryParams,{version:"1.0.0"}),g={type:"wmts",url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:a.Identifier,matrixSet:t.matrixSet,optionsFromCapabilities:!0,requestEncoding:t.requestEncoding||"KVP",style:"default"},h=Object.assign({},g,t.sourceOptions,{params:d});return B.removeUndefined({id:Dn(h),type:dt.Layer,title:null!=l&&l.title?l.title:a.Title,address:t.id,externalProvider:t.externalProvider,options:{sourceOptions:h,metadata:{url:u,extern:c,abstract:p,type:g.type}}})}).filter(a=>void 0!==a)}getArcGISRESTItems(t,o){if(!o)return[];const n=o.layers?o.layers.filter(l=>!l.type||"Feature Layer"===l.type):[];o.layers||this.messageService.error("igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle");const s=(t.regFilters||[]).map(l=>new RegExp(l));let a;return o.serviceDescription&&o.serviceDescription.length&&(a=o.serviceDescription.replace(/(<([^>]+)>)/gi,"")),n.map(l=>{const c=this.computeForcedProperties(l.name,t.forcedProperties);let u,p=!0;l.Abstract?u=l.Abstract:!l.Abstract&&t.abstract&&(u=t.abstract);let d=(null==c?void 0:c.metadataUrl)||(null==c?void 0:c.metadataUrlAll),g=(null==c?void 0:c.metadataAbstract)||(null==c?void 0:c.metadataAbstractAll)||u;if(!(null!=c&&c.metadataUrl)&&!(null!=c&&c.metadataUrlAll)&&((null==c?void 0:c.metadataAbstract)||(null==c?void 0:c.metadataAbstractAll))&&(p=!1),(null==c?void 0:c.metadataAbstract)&&(null==c?void 0:c.metadataUrlAll)&&(p=!1),!1===this.testLayerRegexes(l.id,s))return;const h={type:Ce[t.type],url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:l.id,queryable:!0,queryFormat:"esrijson",matrixSet:t.matrixSet,optionsFromCapabilities:!0,style:"default"},m=Object.assign({},h,t.sourceOptions);return B.removeUndefined({id:Dn(m),type:dt.Layer,title:null!=c&&c.title?c.title:l.name,externalProvider:t.externalProvider,address:t.id,options:{sourceOptions:m,minResolution:ct(l.maxScale),maxResolution:ct(l.minScale),metadata:{url:d,extern:p,abstract:g,type:h.type}}})}).filter(l=>void 0!==l)}testLayerRegexes(t,o){return 0===o.length||void 0!==o.find(n=>n.test(t))}retrieveLayerInfoFormat(t,o){const n=o.find(l=>l.layer===t),s=o.find(l=>"*"===l.layer);let a;return n?a=n.queryFormat:s&&(a=s.queryFormat),a}findCatalogInfoFormat(t){const o=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(n=>{t.queryFormat[n]instanceof Array?t.queryFormat[n].forEach(s=>{o.find(a=>a.layer===s)||o.push({layer:s,queryFormat:n})}):o.find(s=>s.layer===t.queryFormat[n])||o.push({layer:t.queryFormat[n],queryFormat:n})}),o}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(J),e.LFG(D),e.LFG(_e),e.LFG(Dr))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Qy(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-group",3),e.NdJ("addedChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onGroupAddedChange(n))})("layerAddedChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerAddedChange(n))}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&i){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("catalog",o.catalog)("group",t)("map",o.map)("state",o.store.state)("resolution",e.lcZ(2,8,o.resolution$))("catalogAllowLegend",o.catalogAllowLegend)("collapsed",1!==o.store.count)("toggleCollapsed",o.toggleCollapsedGroup)}}function jy(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-layer",4),e.NdJ("addedChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerAddedChange(n))}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&i){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("layer",t)("map",o.map)("resolution",e.lcZ(2,5,o.resolution$))("catalogAllowLegend",o.catalogAllowLegend)("added",o.store.state.get(t).added)}}function Yy(i,r){if(1&i&&(e.YNc(0,Qy,3,10,"ng-container",2),e.YNc(1,jy,3,7,"ng-container",2)),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",o.isGroup(t)),e.xp6(1),e.Q6J("ngIf",o.isLayer(t))}}let Ta=(()=>{class i{constructor(t,o){this.layerService=t,this.cdRef=o,this.catalogAllowLegend=!1,this.toggleCollapsedGroup=!0}get resolution$(){return this.map.viewController.resolution$}ngOnInit(){const t=this.map.layers.map(n=>({id:n.options.source.id,title:n.title,type:dt.Layer}));this.store.state.updateMany(t,{added:!0},!0),this.catalog&&void 0!==this.catalog.sortDirection&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:n=>n.title}),this.catalogAllowLegend=!!this.catalog&&this.catalog.showLegend||this.catalogAllowLegend,this.watcher=new yn(this.store,this.cdRef)}ngOnDestroy(){this.watcher.destroy()}isGroup(t){return t.type===dt.Group}isLayer(t){return t.type===dt.Layer}onLayerAddedChange(t){const o=t.layer;this.store.state.update(o,{added:t.added},!1),t.added?this.addLayerToMap(o,t):this.removeLayerFromMap(o)}onGroupAddedChange(t){const o=t.group;this.store.state.update(o,{added:t.added},!1),t.added?this.addGroupToMap(o,t):this.removeGroupFromMap(o)}addLayerToMap(t,o){this.addLayersToMap([t],o)}removeLayerFromMap(t){this.removeLayersFromMap([t])}addLayersToMap(t,o){const n=t.map(s=>{var a;return s.options.sourceOptions.optionsFromApi||(s.options.sourceOptions.optionsFromApi=!0),!(null===(a=this.catalog.profils)||void 0===a)&&a.length&&(s.options.security={profils:this.catalog.profils}),this.layerService.createAsyncLayer(s.options)});(0,Sn.$)(...n).subscribe(s=>{"click"===o.event.type&&o.added&&this.map.layersAddedByClick$.next(s),this.store.state.updateMany(s,{added:!0}),this.map.addLayers(s)})}removeLayersFromMap(t){t.forEach(o=>{if(this.store.state.update(o,{added:!1}),!0===o.options.baseLayer){const n=this.map.getLayerById(o.options.id);void 0!==n&&this.map.removeLayer(n)}else{const n=this.map.getLayerById(o.id);void 0!==n&&this.map.removeLayer(n)}})}sortCatalogItemsByTitle(t,o){const n=t.sort((s,a)=>{const l=s.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),c=a.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return l<c?-1:l>c?1:0});switch(o){case"asc":return n;case"desc":return n.reverse();default:return t}}addGroupToMap(t,o){let n=t.items.filter(s=>{const a=this.store.state.get(s).added||!1;return this.isLayer(s)&&!1===a});void 0!==t.sortDirection&&(n=this.sortCatalogItemsByTitle(n,t.sortDirection)),this.addLayersToMap(n.reverse(),o)}removeGroupFromMap(t){const o=t.items.filter(n=>{const s=this.store.state.get(n).added||!1;return this.isLayer(n)&&!0===s});this.removeLayersFromMap(o)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Le),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"catalog","group","map","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed","addedChange","layerAddedChange"],["igoListItem","",3,"layer","map","resolution","catalogAllowLegend","added","addedChange"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-list",0),e.YNc(1,Yy,2,2,"ng-template",1),e.ALo(2,"async"),e.qZA()),2&t&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,3,o.store.view.all$())))},encapsulation:2,changeDetection:0}),i})();const Hy=["renderedLegend"];function Vy(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.NdJ("toggle",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.toggleLegendItem(n,s))}),e.qZA(),e.TgZ(2,"h4",8),e._uU(3),e.ALo(4,"async"),e.qZA()()}if(2&i){e.oxw();const t=e.MAs(3),o=e.oxw().$implicit,n=e.oxw(3);e.xp6(1),e.Q6J("target",t)("collapsed",o.collapsed),e.xp6(2),e.hij("",e.lcZ(4,3,n.computeItemTitle(o))," ")}}function zy(i,r){if(1&i&&(e.TgZ(0,"mat-option",11),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.name),e.xp6(1),e.Oqu(t.title)}}function Wy(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-form-field")(2,"mat-select",9),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(5);return e.KtG(s.currentStyle=n)})("selectionChange",function(){e.CHM(t);const n=e.oxw(5);return e.KtG(n.onChangeStyle())}),e.ALo(3,"translate"),e.YNc(4,zy,2,2,"mat-option",10),e.qZA()()()}if(2&i){const t=e.oxw(5);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("ngModel",t.currentStyle),e.xp6(2),e.Q6J("ngForOf",t.styles)}}function Ky(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"img",14,15),e.NdJ("load",function(){e.CHM(t);const n=e.oxw(4).$implicit,s=e.oxw(3);return e.KtG(s.onLoadImage(n.title))}),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw(4).$implicit;e.s9C("id",t.title),e.s9C("alt",e.lcZ(2,3,"igo.geo.layer.legend.loadingLegendText")),e.Q6J("src",t.imgGraphValue,e.LSH)}}function Xy(i,r){1&i&&(e.TgZ(0,"small"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function ev(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Ky,3,5,"img",13),e.YNc(2,Xy,3,3,"small",0),e.qZA()),2&i){const t=e.oxw(3).$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.imgGraphValue),e.xp6(1),e.Q6J("ngIf",o.imagesHeight[t.title]<16)}}function tv(i,r){if(1&i&&(e._UZ(0,"div",16),e.ALo(1,"sanitizeHtml")),2&i){const t=e.oxw(3).$implicit;e.Q6J("ngStyle",t.style)("innerHTML",e.lcZ(1,2,t.html),e.oJD)}}function ov(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,ev,3,2,"div",0),e.YNc(2,tv,2,4,"div",12),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",t.url),e.xp6(1),e.Q6J("ngIf",t.html)}}const iv=function(i){return{"with-title":i}};function nv(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Vy,5,5,"mat-list-item",0),e.TgZ(2,"div",5,6),e.YNc(4,Wy,5,5,"div",0),e.YNc(5,ov,3,2,"div",0),e.qZA()()),2&i){const t=e.oxw().$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.title),e.xp6(1),e.Q6J("ngClass",e.VKq(4,iv,t.title)),e.xp6(2),e.Q6J("ngIf",void 0!==o.currentStyle),e.xp6(1),e.Q6J("ngIf",!t.collapsed)}}function rv(i,r){if(1&i&&(e.ynx(0,null,4),e.YNc(2,nv,6,6,"div",1),e.BQk()),2&i){e.oxw(2);const t=e.MAs(3),o=e.oxw();e.xp6(2),e.Q6J("ngIf",o.getLegend)("ngIfElse",t)}}function sv(i,r){if(1&i&&(e.ynx(0),e.YNc(1,rv,3,2,"ng-container",3),e.BQk()),2&i){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t.slice().reverse())}}function av(i,r){1&i&&(e.TgZ(0,"small"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLegendText")," "))}function lv(i,r){if(1&i&&(e.ynx(0),e.YNc(1,sv,2,1,"ng-container",1),e.YNc(2,av,3,3,"ng-template",null,2,e.W1O),e.BQk()),2&i){const t=r.ngIf,o=e.MAs(3);e.xp6(1),e.Q6J("ngIf",t.length)("ngIfElse",o)}}let Nn=(()=>{class i{constructor(t,o,n,s,a){this.capabilitiesService=t,this.languageService=o,this.configService=n,this.http=s,this.cdRef=a,this.updateLegendOnResolutionChange=!1,this.legendItems$=new b.X([]),this.scale=void 0,this.view=void 0,this.imagesHeight={},this.getLegend=!0}ngOnInit(){let t=this.layer.legend;this.styles=this.listStyles();const o=this.layer.options.source.options;if(o&&o.params&&o.params.STYLES?this.currentStyle=this.styles.find(n=>n.name===o.params.STYLES).name:t?this.styles&&this.styles.length>1&&(this.currentStyle=t[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),t=void 0!==this.layer.options.legendOptions&&!1===this.layer.options.legendOptions.display?[]:this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||o.contentDependentLegend)this.state$$=this.layer.map.viewController.state$.subscribe(()=>this.onViewControllerStateChange());else if(t&&0!==t.length){this.legendItems$.next(t);for(const n of t)this.getLegendGraphic(n)}}ngOnDestroy(){void 0!==this.state$$&&this.state$$.unsubscribe()}getLegendGraphic(t){t.url&&new ur(this.http,this.configService).transform(t.url).pipe((0,he.K)(n=>{if(n.error)return n.error.caught=!0,this.getLegend=!1,this.cdRef.detectChanges(),n})).subscribe(n=>{const s=this.legendItems$.value.findIndex(l=>l.title===t.title);this.legendItems$.value[s].imgGraphValue=n,this.cdRef.detectChanges()})}toggleLegendItem(t,o){o.collapsed=t}transfertToggleLegendItem(t){const o=t,n=this.layer.legend;for(let s=0;s<n.length;s++)o[s].collapsed=n[s].collapsed;return o}computeItemTitle(t){const o=this.layer.dataSource.options;if("wms"!==o.type)return(0,X.of)(t.title);const n=o.params.LAYERS.split(","),s=JSON.parse(JSON.stringify(o));return s.params.LAYERS=n.find(a=>a===t.title),this.capabilitiesService.getWMSOptions(s).pipe((0,Z.U)(a=>a._layerOptionsFromSource.title))}onViewControllerStateChange(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}updateLegend(){let t=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(t=this.transfertToggleLegendItem(t)),this.layer.legend=t,0!==t.length||0!==this.legendItems$.value.length){this.legendItems$.next(t);for(const o of this.legendItems$.value)this.getLegendGraphic(o)}}listStyles(){const t=this.layer.options;if(t&&t.legendOptions){let s=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return t.legendOptions.stylesAvailable&&(s=s.concat(t.legendOptions.stylesAvailable.filter(a=>"default"!==a.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==a.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")))),s.filter(a=>!a.title).map(a=>a.title=a.name),s.map(a=>a.title=a.title.charAt(0).toUpperCase()+a.title.slice(1).replace(/_/g," ")),s}}onChangeStyle(){this.updateLegend();let t="";this.layer.dataSource instanceof Bt&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(o=>t+=this.currentStyle+","),t=t.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:t}))}onLoadImage(t){let o;o=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(n=>n.nativeElement.id===t).nativeElement,this.imagesHeight[t]=o.height}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Dr),e.Y36(D),e.Y36(J),e.Y36(q.eN),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-legend"]],viewQuery:function(t,o){if(1&t&&e.Gf(Hy,5),2&t){let n;e.iGM(n=e.CRH())&&(o.renderedLegends=n)}},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["noItems",""],[4,"ngFor","ngForOf"],["renderedLegends",""],[1,"igo-layer-legend",3,"ngClass"],["legend",""],["id","legend-toggle","mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","toggle"],["matLine",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","","hideError","true",3,"id","src","alt","load",4,"ngIf"],["igoImageError","","hideError","true",3,"id","src","alt","load"],["renderedLegend",""],[3,"ngStyle","innerHTML"]],template:function(t,o){1&t&&(e.YNc(0,lv,4,2,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.legendItems$))},dependencies:[I.KE,_.JJ,f.mk,f.sg,f.O5,f.PC,_.On,T.Hw,ue.gD,Q.ey,O.gM,G.Tg,G.eA,Q.X2,Li,Is,f.Ov,L.X$,cr],styles:['.igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;animation:2s linear infinite spin}@-moz-document url-prefix(){img:after{margin-left:19px}}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0}),i})();function cv(i,r){1&i&&e._UZ(0,"mat-icon",9)}function uv(i,r){1&i&&(e.TgZ(0,"mat-icon",12),e.NdJ("click",function(o){return o.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.layer"))}function pv(i,r){if(1&i&&(e.TgZ(0,"button",10),e.YNc(1,uv,2,3,"mat-icon",11),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.layer.externalProvider)}}function dv(i,r){if(1&i&&(e._UZ(0,"igo-layer-legend",3),e.ALo(1,"async")),2&i){const t=e.oxw();e.Q6J("layer",e.lcZ(1,1,t.igoLayer$))}}let tu=(()=>{class i{constructor(t){this.layerService=t,this.inRange$=new b.X(!0),this.isPreview$=new b.X(!1),this.isVisible$=new b.X(!1),this.layerLegendShown$=new b.X(!1),this.igoLayer$=new b.X(void 0),this.mouseInsideAdd=!1,this.catalogAllowLegend=!1,this.added=!1,this.addedChange=new e.vpe,this.addedLayerIsPreview=new e.vpe}get title(){return Yt(this.layer)}get icon(){return lr(this.layer)||"layers"}ngOnInit(){this.isPreview$$=this.isPreview$.subscribe(t=>this.addedLayerIsPreview.emit(t)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.isPreview$$.unsubscribe(),this.resolution$$.unsubscribe(),this.layers$$.unsubscribe()}computeTitleTooltip(){const t=this.layer.options;if(!t.tooltip)return Yt(this.layer);const o=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Wt.TITLE:return this.layer.title;case Wt.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Wt.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}onMouseEvent(t){this.onToggleClick(t)}askForLegend(t){this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe((0,Gt.P)()).subscribe(o=>this.igoLayer$.next(o))}onToggleClick(t){if(void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove(t):this.add(t)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(t),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(t),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer,event:t}))}remove(t){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer,event:t}))}haveGroup(){return!(!this.layer.address||1===this.layer.address.split(".").length)}isInResolutionsRange(t){const o=!this.layer.options.minResolution||Number.isNaN(this.layer.options.minResolution)?0:this.layer.options.minResolution,n=!this.layer.options.maxResolution||Number.isNaN(this.layer.options.maxResolution)?1/0:this.layer.options.maxResolution;this.inRange$.next(t>=o&&t<=n)}isVisible(){var t,o;if(null!==(t=this.layer)&&void 0!==t&&t.id){const n=this.map.getLayerById(null===(o=this.layer)||void 0===o?void 0:o.id);this.isVisible$.next(!!n&&n.visible)}}getBadgeIcon(){return this.inRange$.getValue()&&this.isVisible$.getValue()?"":"eye-off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",map:"map",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},decls:22,vars:35,consts:[["mat-list-avatar","","svgIcon","blank",4,"ngIf"],["mat-line","","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","igoMatBadgeInverseColor","true","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","matBadgeHidden","matBadgeDisabled","svgIcon"],[1,"igo-cataloglayer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],["mat-list-avatar","","svgIcon","blank"],["disabled","true","mat-icon-button",""],["class","igo-cataloglayer-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloglayer-external-icon",3,"matTooltip","click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-list-item"),e.YNc(1,cv,1,0,"mat-icon",0),e.TgZ(2,"h4",1),e.NdJ("click",function(s){return o.askForLegend(s)}),e._uU(3),e.qZA(),e.YNc(4,pv,2,1,"button",2),e._UZ(5,"igo-metadata-button",3),e.TgZ(6,"button",4),e.NdJ("mouseenter",function(s){return o.onMouseEvent(s)})("mouseleave",function(s){return o.onMouseEvent(s)})("click",function(s){return o.onToggleClick(s)}),e.ALo(7,"translate"),e.ALo(8,"async"),e._UZ(9,"mat-icon",5),e.ALo(10,"async"),e.ALo(11,"async"),e.ALo(12,"async"),e.ALo(13,"async"),e.ALo(14,"async"),e.ALo(15,"async"),e.ALo(16,"async"),e.qZA()(),e.TgZ(17,"div",6,7),e.YNc(19,dv,2,3,"igo-layer-legend",8),e.ALo(20,"async"),e.ALo(21,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.haveGroup()),e.xp6(1),e.Q6J("ngClass",o.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",o.computeTitleTooltip()),e.xp6(1),e.Oqu(o.title),e.xp6(1),e.Q6J("ngIf",o.layer.externalProvider),e.xp6(1),e.Q6J("layer",o.layer),e.xp6(1),e.Q6J("matTooltip",e.lcZ(7,13,o.computeTooltip()))("color",e.lcZ(8,15,o.isPreview$)?"":o.added?"warn":""),e.xp6(3),e.Q6J("igoMatBadgeIcon",o.getBadgeIcon())("matBadgeHidden",e.lcZ(10,17,o.inRange$)&&!0===e.lcZ(11,19,o.isVisible$)||e.lcZ(12,21,o.inRange$)&&!o.added||e.lcZ(13,23,o.inRange$)&&e.lcZ(14,25,o.isPreview$))("matBadgeDisabled",!1===e.lcZ(15,27,o.inRange$))("svgIcon",e.lcZ(16,29,o.isPreview$)?"plus":o.added?"delete":"plus"),e.xp6(10),e.Q6J("ngIf",e.lcZ(20,31,o.layerLegendShown$)&&e.lcZ(21,33,o.igoLayer$)&&o.catalogAllowLegend))},dependencies:[f.mk,f.O5,mt.k,w.lW,T.Hw,G.Tg,G.eA,Q.X2,O.gM,Zs,Gi,Nn,f.Ov,L.X$],styles:[".igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0}),i})();function gv(i,r){1&i&&(e.TgZ(0,"mat-icon",9),e.NdJ("click",function(o){return o.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.group"))}function mv(i,r){if(1&i&&(e.TgZ(0,"button",7),e.YNc(1,gv,2,3,"mat-icon",8),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.group.externalProvider)}}function hv(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",10),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleClick(n))}),e.ALo(2,"translate"),e.ALo(3,"async"),e._UZ(4,"mat-icon",11),e.qZA(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",e.lcZ(3,4,t.disabled$))}}function fv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleClick(n))}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",13),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.catalog.group.addToMap"))("disabled",e.lcZ(2,4,t.disabled$))}}function _v(i,r){1&i&&e.GkF(0)}function yv(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-layer",15),e.NdJ("addedLayerIsPreview",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerPreview(n))})("addedChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerAddedChange(n))}),e.qZA(),e.BQk()}if(2&i){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("layer",t)("resolution",o.resolution)("map",o.map)("catalogAllowLegend",o.catalogAllowLegend)("added",o.state.get(t).added)}}function vv(i,r){if(1&i&&(e.YNc(0,_v,1,0,"ng-container",14),e.YNc(1,yv,2,5,"ng-container",14)),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",o.isGroup(t)),e.xp6(1),e.Q6J("ngIf",o.isLayer(t))}}let bv=(()=>{class i{constructor(){this.store=new it([]),this.added$=new b.X(!1),this.preview$=new b.X(!1),this.disabled$=new b.X(!1),this.collapsed=!0,this.catalogAllowLegend=!1,this.toggleCollapsed=!0,this.addedChange=new e.vpe,this.layerAddedChange=new e.vpe}get title(){return this.group.title}ngOnInit(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),void 0!==this.group.sortDirection&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:t=>t.title})}ngOnDestroy(){this.store.destroy()}isGroup(t){return t.type===dt.Group}isLayer(t){return t.type===dt.Layer}onToggleClick(t){this.added$.value?this.remove(t):this.add(t)}onToggleCollapsed(t){this.evaluateDisabled(t)}onLayerAddedChange(t){this.layerAddedChange.emit(t),this.tryToggleGroup(t)}add(t){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group,event:t})}remove(t){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group,event:t})}onLayerPreview(t){this.preview$.next(t)}tryToggleGroup(t){const o=t.added,n=t.layer;this.store.view.all().filter(a=>a.id!==n.id).map(a=>this.state.get(a).added||!1).every(a=>a===o)?o?this.add(t.event):this.remove(t.event):!0===this.added$.value&&this.added$.next(!1)}evaluateAdded(){const t=this.store.all().every(o=>!0===(this.state.get(o).added||!1));this.added$.next(t)}evaluateDisabled(t){let o=!1;!1===this.toggleCollapsed&&(o=t),this.disabled$.next(o)}onTitleClick(){this.collapsed=!this.collapsed}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",map:"map",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},decls:14,vars:14,consts:[["mat-list-avatar","","svgIcon","chevron-up","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["id","catalog-group-title","mat-line","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"matTooltip","click"],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["notadded",""],["items",""],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloggroup-external-icon",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click"],["svgIcon","plus"],[4,"ngIf"],["igoListItem","",3,"layer","resolution","map","catalogAllowLegend","added","addedLayerIsPreview","addedChange"]],template:function(t,o){if(1&t&&(e.TgZ(0,"mat-list-item")(1,"mat-icon",0),e.NdJ("toggle",function(s){return o.onToggleCollapsed(s)}),e.qZA(),e.TgZ(2,"h4",1),e.NdJ("click",function(){return o.onTitleClick()}),e._uU(3),e.qZA(),e.YNc(4,mv,2,1,"button",2),e.YNc(5,hv,5,6,"ng-container",3),e.ALo(6,"async"),e.ALo(7,"async"),e.YNc(8,fv,4,6,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(10,"div",null,5),e.YNc(12,vv,2,2,"ng-template",6),e.ALo(13,"async"),e.qZA()),2&t){const n=e.MAs(9),s=e.MAs(11);e.xp6(1),e.Q6J("target",s)("collapsed",o.collapsed),e.xp6(1),e.Q6J("matTooltip",o.title),e.xp6(1),e.Oqu(o.title),e.xp6(1),e.Q6J("ngIf",o.group.externalProvider),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,8,o.added$)&&!1===e.lcZ(7,10,o.preview$))("ngIfElse",n),e.xp6(7),e.Q6J("ngForOf",e.lcZ(13,12,o.store.view.all$()))}},dependencies:[f.sg,f.O5,w.lW,T.Hw,G.Tg,G.eA,Q.X2,O.gM,Zt,Li,tu,f.Ov,L.X$],styles:[".igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer;opacity:.9}#catalog-group-title[_ngcontent-%COMP%]{font-weight:700}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0}),i})(),Cv=(()=>{class i{constructor(){this.sortAlpha=!1,this.onlyVisible=!1,this.onlyInRange=!1,this.keywordInitialized=!1,this.sortedAlphaInitialized=!1,this.onlyVisibleInitialized=!1,this.onlyInRangeInitialized=!1}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function xv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",9),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.check())}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("checked",t.layerCheck)}}const ou=function(i){return{disabled:i}};function Sv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleVisibility())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",11),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",e.lcZ(1,5,t.eyeTooltip)),e.xp6(2),e.Q6J("matBadgeHidden",e.lcZ(3,7,t.queryBadgeHidden$))("ngClass",e.VKq(13,ou,!1===e.lcZ(4,9,t.inResolutionRange$)))("svgIcon",e.lcZ(5,11,t.layer.visible$)?"eye":"eye-off")}}function wv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleVisibility())}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",11),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,5,"igo.geo.layer.hideLayer"):e.lcZ(2,7,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("matBadgeHidden",e.lcZ(4,9,t.queryBadgeHidden$))("ngClass",e.VKq(13,ou,!1===e.lcZ(5,11,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function Tv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleLayerTool())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",14),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.moreOptions"))}function Mv(i,r){if(1&i&&e._UZ(0,"igo-layer-legend",15),2&i){const t=e.oxw();e.Q6J("layer",t.layer)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}let iu=(()=>{class i{constructor(t,o,n,s){this.networkService=t,this.renderer=o,this.elRef=n,this.cdRef=s,this.focusedCls="igo-layer-item-focused",this.layerTool$=new b.X(!1),this.showLegend$=new b.X(!0),this.inResolutionRange$=new b.X(!0),this.queryBadgeHidden$=new b.X(!0),this._selectAll=!1,this.layers$=new b.X(void 0),this.toggleLegendOnVisibilityChange=!1,this.expandLegendIfVisible=!1,this.updateLegendOnResolutionChange=!1,this.orderable=!0,this.lowerDisabled=!1,this.raiseDisabled=!1,this.queryBadge=!1,this.action=new e.vpe(void 0),this.checkbox=new e.vpe}get activeLayer(){return this._activeLayer}set activeLayer(t){t&&this.layer&&t.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)}get selectAll(){return this._selectAll}set selectAll(t){this._selectAll=t,!0===t&&(this.layerCheck=!0)}get layer(){return this._layer}set layer(t){this._layer=t,this.layers$.next(t)}get opacity(){return 100*this.layer.opacity}set opacity(t){this.layer.opacity=t/100}get eyeTooltip(){return!1===this.inResolutionRange$.getValue()?"igo.geo.layer.notInResolution":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}ngOnInit(){this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge(),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(o=>{this.state=o,this.onResolutionChange()}),this.layers$$=this.layers$.subscribe(()=>{this.layer&&this.layer.options.active&&(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls))}),this.changeDetection&&this.changeDetection.subscribe(()=>this.cdRef.detectChanges())}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe(),this.layers$$.unsubscribe()}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.toggleLegend(this.showLegend$.value)}toggleVisibility(){this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const o=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Wt.TITLE:return this.layer.title;case Wt.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Wt.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){const t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)}updateQueryBadge(){const t=!1===this.queryBadge||!1===this.layer.visible||!Un(this.layer);this.queryBadgeHidden$.next(t)}toggleLayerTool(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)}check(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(mn),e.Y36(e.Qsj),e.Y36(e.SBq),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-item"]],inputs:{activeLayer:"activeLayer",selectAll:"selectAll",layerCheck:"layerCheck",layer:"layer",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendIfVisible:"expandLegendIfVisible",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",orderable:"orderable",lowerDisabled:"lowerDisabled",raiseDisabled:"raiseDisabled",queryBadge:"queryBadge",selectionMode:"selectionMode",changeDetection:"changeDetection"},outputs:{action:"action",checkbox:"checkbox"},decls:11,vars:9,consts:[[1,"igo-layer-list-item"],["class","layerCheck","mat-list-icon","",3,"checked","change",4,"ngIf"],["matLine","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip","click"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","selection-eye","mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["mat-list-icon","",1,"layerCheck",3,"checked","change"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","ngClass","svgIcon"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",1,"selection-eye",3,"color","matTooltip","click"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"matTooltip","click"],["svgIcon","dots-horizontal"],[3,"layer","updateLegendOnResolutionChange"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-list-item",0),e.YNc(1,xv,1,1,"mat-checkbox",1),e.TgZ(2,"h4",2),e.NdJ("click",function(){return o.toggleLegendOnClick()}),e._uU(3),e.qZA(),e.YNc(4,Sv,6,15,"button",3),e.YNc(5,wv,6,15,"button",4),e.YNc(6,Tv,3,3,"button",5),e.qZA(),e.TgZ(7,"div",6,7),e.YNc(9,Mv,1,2,"igo-layer-legend",8),e.ALo(10,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.selectionMode),e.xp6(1),e.Q6J("matTooltip",o.tooltipText),e.xp6(1),e.Oqu(o.layer.title),e.xp6(1),e.Q6J("ngIf",!o.selectionMode),e.xp6(1),e.Q6J("ngIf",o.selectionMode),e.xp6(1),e.Q6J("ngIf",!o.selectionMode),e.xp6(3),e.Q6J("ngIf",e.lcZ(10,7,o.showLegend$)))},styles:["[_nghost-%COMP%]{overflow:hidden}mat-list-item[_ngcontent-%COMP%]     .mat-list-item-content .layerCheck{align-self:baseline;width:16px;padding-right:0}.igo-layer-list-item[_ngcontent-%COMP%]{height:46px;clear:both}.igo-layer-title[_ngcontent-%COMP%]{cursor:pointer}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}.selection-eye[_ngcontent-%COMP%]{padding-right:45px}"],changeDetection:0}),i})();var rt=(()=>{return(i=rt||(rt={})).always="always",i.never="never",i.default="default",rt;var i})(),Qo=(()=>{return(i=Qo||(Qo={})).ALL_VISIBLE="ALL_VISIBLE",i.ALL_HIDDEN="ALL_HIDDEN",i.MIXED="MIXED",i.NULL="NULL",Qo;var i})(),Xi=(()=>{return(i=Xi||(Xi={})).Raise="raise",i.Lower="lower",Xi;var i})();const Fv=["igoLayerItemToolbar"];function Av(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-layer-list-tool",6),e.NdJ("appliedFilterAndSort",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onAppliedFilterAndSortChange(n))})("selection",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.toggleSelectionMode(n))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("layersAreAllVisible",t.layersAreAllVisible)("term",t.layerFilterAndSortOptions.keyword)("onlyVisible",t.layerFilterAndSortOptions.onlyVisible)("sortAlpha",t.layerFilterAndSortOptions.sortAlpha)}}function Lv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-list-item",7)(1,"mat-checkbox",8),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.selectAll())}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("color",!t.selectAllCheck&&t.layersChecked.length>0?"accent":"primary")("checked",t.selectAllCheck)("indeterminate",!t.selectAllCheck&&t.layersChecked.length>0),e.xp6(1),e.hij(" ",t.selectAllCheck?e.lcZ(3,4,"igo.geo.layer.deselectAll"):e.lcZ(4,6,"igo.geo.layer.selectAll")," ")}}function Iv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-layer-item",10),e.NdJ("action",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.toggleLayerTool(n))})("checkbox",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.layersCheck(n))}),e.qZA()}if(2&i){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("layer",t)("activeLayer",o.activeLayer)("orderable",o.orderable&&!t.baseLayer)("lowerDisabled",o.getLowerLayer().id===t.id)("raiseDisabled",o.getUpperLayer().id===t.id)("queryBadge",o.queryBadge)("expandLegendIfVisible",o.expandLegendOfVisibleLayers)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange)("toggleLegendOnVisibilityChange",o.toggleLegendOnVisibilityChange)("selectionMode",o.selection)("selectAll",o.selectAllCheck)("layerCheck",t.options.check)("changeDetection",o.layerItemChangeDetection$)}}function Ov(i,r){if(1&i&&e.YNc(0,Iv,1,13,"igo-layer-item",9),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",!(o.excludeBaseLayers&&t.baseLayer))}}function Zv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.removeLayers())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",27),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.removeLayer"))}function Dv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.zoomLayerExtents(n.activeLayer))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",29),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.zoomLayer"))}const kv=function(i){return{layer:i}};function Pv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-panel",11)(1,"div",12),e.YNc(2,Zv,3,3,"button",13),e.TgZ(3,"button",14),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Lower,!0))}),e.ALo(4,"translate"),e.ALo(5,"translate"),e._UZ(6,"mat-icon",15),e.qZA(),e.TgZ(7,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Raise,!0))}),e.ALo(8,"translate"),e.ALo(9,"translate"),e._UZ(10,"mat-icon",17),e.qZA(),e.TgZ(11,"button",18),e.ALo(12,"translate"),e._UZ(13,"mat-icon",19),e.qZA(),e.TgZ(14,"mat-menu",20,21)(16,"div",22)(17,"mat-slider",23),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeOpacity(n))})("click",function(n){return n.stopPropagation()}),e.ALo(18,"translate"),e.qZA()()(),e.YNc(19,Dv,3,3,"button",24),e.GkF(20,25),e.Hsn(21),e.qZA()()}if(2&i){const t=e.MAs(15),o=e.oxw();e.Q6J("title",o.activeLayer.title),e.xp6(2),e.Q6J("ngIf",o.isLayerRemovable(o.activeLayer)),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(4,20,"igo.geo.layer.filterLowerLayer"):e.lcZ(5,22,"igo.geo.layer.lowerLayer"))("disabled",o.lowerDisabled),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.lowerDisabled),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(8,24,"igo.geo.layer.filterRaiseLayer"):e.lcZ(9,26,"igo.geo.layer.raiseLayer"))("disabled",o.raiseDisabled),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.raiseDisabled),e.xp6(1),e.Q6J("matMenuTriggerFor",t)("matTooltip",e.lcZ(12,28,"igo.geo.layer.opacity")),e.xp6(2),e.Q6J("matBadge",o.badgeOpacity),e.xp6(4),e.Q6J("min",0)("max",100)("value",o.opacity)("matTooltip",e.lcZ(18,30,"igo.geo.layer.opacity")),e.xp6(2),e.Q6J("ngIf",o.activeLayerExtentIsValid(o.activeLayer)),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateLayerToolbar)("ngTemplateOutletContext",e.VKq(32,kv,o.activeLayer))}}function $v(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slider",38),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.checkOpacity=n)})("click",function(n){return n.stopPropagation()}),e.ALo(1,"translate"),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("min",0)("max",100)("ngModel",t.checkOpacity)("matTooltip",e.lcZ(1,4,"igo.geo.layer.opacity"))}}function Ev(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.zoomLayersExtents(n.layersChecked))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",39),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.zoomLayers"))}function Jv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-panel",11),e.ALo(1,"translate"),e.TgZ(2,"div",30)(3,"button",31),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.removeLayers(n.layersChecked))}),e.ALo(4,"translate"),e.ALo(5,"translate"),e._UZ(6,"mat-icon",32),e.qZA(),e.TgZ(7,"button",33),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleVisibility(n.layersChecked))}),e.ALo(8,"translate"),e.ALo(9,"translate"),e._UZ(10,"mat-icon",34),e.qZA(),e.TgZ(11,"button",14),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.lowerLayers(n.layersChecked))}),e.ALo(12,"translate"),e.ALo(13,"translate"),e._UZ(14,"mat-icon",15),e.qZA(),e.TgZ(15,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.raiseLayers(n.layersChecked))}),e.ALo(16,"translate"),e.ALo(17,"translate"),e._UZ(18,"mat-icon",17),e.qZA(),e.TgZ(19,"button",35),e.ALo(20,"translate"),e._UZ(21,"mat-icon",36),e.qZA(),e.TgZ(22,"mat-menu",20,21)(24,"div",22),e.YNc(25,$v,2,6,"mat-slider",37),e.qZA()(),e.YNc(26,Ev,3,3,"button",24),e.qZA()()}if(2&i){const t=e.MAs(23),o=e.oxw();e.Q6J("title",e.lcZ(1,21,"igo.geo.layer.tools")),e.xp6(3),e.Q6J("disabled",0===o.layersChecked.length)("matTooltip",o.isAllLayersRemovable(o.layersChecked)?e.lcZ(4,23,"igo.geo.layer.removeSelectedLayers"):e.lcZ(5,25,"igo.geo.layer.removeSelectedLayersRestriction")),e.xp6(3),e.Q6J("matBadge","!")("matBadgeHidden",o.isAllLayersRemovable(o.layersChecked)),e.xp6(1),e.Q6J("disabled",0===o.layersChecked.length)("matTooltip","ALL_HIDDEN"===o.statusSelectedLayersCheck?e.lcZ(8,27,"igo.geo.layer.showSelectedLayers"):e.lcZ(9,29,"igo.geo.layer.hideSelectedLayers")),e.xp6(3),e.Q6J("svgIcon","ALL_HIDDEN"===o.statusSelectedLayersCheck?"eye-off":"eye"),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(12,31,"igo.geo.layer.filterLowerLayer"):e.lcZ(13,33,"igo.geo.layer.lowerLayer"))("disabled",o.lowerDisabledSelection),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.lowerDisabledSelection),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(16,35,"igo.geo.layer.filterRaiseLayer"):e.lcZ(17,37,"igo.geo.layer.raiseLayer"))("disabled",o.raiseDisabledSelection),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.raiseDisabledSelection),e.xp6(1),e.Q6J("disabled",0===o.layersChecked.length)("matMenuTriggerFor",t)("matTooltip",e.lcZ(20,39,"igo.geo.layer.opacity")),e.xp6(6),e.Q6J("ngIf",o.layersChecked.length),e.xp6(1),e.Q6J("ngIf",0!==o.layersChecked.length&&o.activeLayersExtentAreValid(o.layersChecked))}}const Rv=[[["","igoLayerItemToolbar",""]]],Bv=function(i,r,t){return{"igo-list-tools-multi":i,"igo-list-tools-single":r,"igo-list-no-tools":t}},Uv=["[igoLayerItemToolbar]"];let yi=(()=>{class i{constructor(t){this.elRef=t,this.orderable=!0,this.thresholdToFilterAndSort=5,this.layers$=new b.X([]),this.change$=new hn.t(1),this.showToolbar$=new b.X(!1),this.hideSelectedLayers=!0,this.activeLayer$=new b.X(void 0),this.layersChecked=[],this.layerItemChangeDetection$=new b.X(void 0),this.layersAreAllVisible=!0,this.ogcButton=!0,this.timeButton=!0,this.floatLabel="auto",this.layerFilterAndSortOptions={},this.excludeBaseLayers=!1,this.toggleLegendOnVisibilityChange=!1,this.expandLegendOfVisibleLayers=!1,this.updateLegendOnResolutionChange=!1,this.queryBadge=!1,this.appliedFilterAndSort=new e.vpe,this._keyword=void 0,this._onlyVisible=!1,this._sortedAlpha=!1,this.toggleOpacity=!1,this.selectAllCheck$=new b.X(void 0)}get map(){return this._map}set map(t){this._map=t}set layers(t){this._layers=this.removeProblemLayerInList(t),this.next()}get layers(){return this._layers}set activeLayer(t){this._activeLayer=t,this.activeLayer$.next(t)}get activeLayer(){return this._activeLayer}get keyword(){return this._keyword}set keyword(t){this._keyword=t,this.next()}get onlyVisible(){return this._onlyVisible}set onlyVisible(t){this._onlyVisible=t,this.next()}get sortAlpha(){return this._sortedAlpha}set sortAlpha(t){this._sortedAlpha=t,this.next()}get opacity(){return Math.round(100*this.activeLayer$.getValue().opacity)}set opacity(t){this.activeLayer$.getValue().opacity=t/100}get badgeOpacity(){if(100!==this.opacity)return this.opacity}get raiseDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))}get lowerDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))}get raiseDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck}get lowerDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck}get checkOpacity(){return 100*this.layersCheckedOpacity()}set checkOpacity(t){for(const o of this.layersChecked)o.opacity=t/100}get layerListDisplacement(){return Xi}ngOnInit(){this.change$$=this.change$.pipe((0,Tn.D)(()=>0===this.layers.length?Bi.E:(0,wn.H)(50))).subscribe(()=>{this.showToolbar$.next(this.computeShowToolbar()),this.layers$.next(this.computeLayers(this.layers.slice(0))),this.appliedFilterAndSort.emit({keyword:this.keyword,sortAlpha:this.sortAlpha,onlyVisible:this.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(t=>{this.selectAllCheck=t}),this.layers$$=this.layers$.subscribe(()=>{if(this.layers){let t=0;for(const o of this.layers)o.status$.subscribe(n=>{0===n&&this.map.removeLayer(o)}),o.options.active&&(this.activeLayer=o,this.layerTool=!0),o.options.check&&(t+=1);this.selectAllCheck=this.excludeBaseLayers?t===this.layers.filter(o=>!0!==o.baseLayer&&o.showInLayerList).length:t===this.layers.filter(o=>o.showInLayerList).length}})}ngOnDestroy(){this.change$$.unsubscribe(),this.selectAllCheck$$.unsubscribe(),this.layers$$.unsubscribe()}activeLayerExtentIsValid(t){let o=!1;if(!1===t.options.showButtonZoomToExtent)return!1;const n=t.options.extent,s=this.map.viewController.maxLayerZoomExtent;return n&&(o=!s||Je.r4(s,n)),o}activeLayersExtentAreValid(t){let o=!1;const n=Je.lJ(),s=this.map.viewController.maxLayerZoomExtent;for(const a of t){const l=a.options.extent;l&&!l.includes(1/0)&&Je.l7(n,l)}return Je.xb(n)||(o=!s||Je.r4(s,n)),o}zoomLayerExtents(t){this.map.viewController.zoomToExtent(t.options.extent)}zoomLayersExtents(t){const o=Je.lJ();for(const n of t){const s=n.options.extent;s&&Je.l7(o,s)}this.map.viewController.zoomToExtent(o)}changeOpacity(t){this.opacity=t.value}clearKeyword(){this.keyword=void 0}getLowerLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,o)=>t.zIndex<o.zIndex?t:o,{zIndex:void 0,id:void 0})}isLowerBaselayer(t){const o=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[o+1]||!0!==this.layers[o+1].baseLayer)}getUpperLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,o)=>t.zIndex>o.zIndex?t:o,{zIndex:void 0,id:void 0})}isUpperBaselayer(t){const o=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[o-1]||!0!==this.layers[o-1].baseLayer)}moveActiveLayer(t,o,n=!1){const s=[];Rr(this.map,t,Be.ZINDEX);let a=Rr(this.map,t,Be.ZINDEX);a||(a=t);const l=[a];xa(this.map,a,l,Be.ZINDEX),this.layers.map(c=>{-1!==l.indexOf(c)&&s.push(c)}),o===Xi.Raise?this.raiseLayers(s,n):o===Xi.Lower&&this.lowerLayers(s,n)}raisableLayers(t){let o=!1,n=0;for(const s of t){const a=this.layers.findIndex(u=>s.id===u.id),l=this.layers[a];l.baseLayer&&(n+=1);const c=this.layers[a-1];c&&!0!==c.baseLayer&&!t.find(u=>c.id===u.id)&&!0!==l.baseLayer&&(o=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(o=!1),o}raisableLayer(t){return!(t<1)&&(!this.layers[t-1].options.check||this.raisableLayer(t-1))}raiseLayers(t,o=!0){const n=[];for(const s of t){const a=this.layers.findIndex(l=>l.id===s.id);this.raisableLayer(a)&&n.push(s)}this.map.raiseLayers(n),o&&setTimeout(()=>{const s=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),a=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let l;s.length&&(l=s[0]),a.length&&(l=a[0]),l&&(0,Fs.Z)(l,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}lowerableLayers(t){let o=!1,n=0;for(const s of t){const a=this.layers.findIndex(u=>s.id===u.id);this.layers[a].baseLayer&&(n+=1);const c=this.layers[a+1];c&&!0!==c.baseLayer&&!t.find(u=>c.id===u.id)&&(o=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(o=!1),o}lowerableLayer(t){return!(t>this.layers.filter(o=>!0!==o.baseLayer).length-2)&&(!this.layers[t+1].options.check||this.lowerableLayer(t+1))}lowerLayers(t,o=!0){const n=[];for(const s of t){const a=this.layers.findIndex(l=>l.id===s.id);this.lowerableLayer(a)&&n.push(s)}this.map.lowerLayers(n),o&&setTimeout(()=>{const s=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),a=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let l;s.length&&(l=s[s.length-1]),a.length&&(l=a[0]),l&&(0,Fs.Z)(l,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}next(){this.change$.next()}computeLayers(t){let o=this.filterLayers(t);return o=this.sortAlpha?this.sortLayersByTitle(o):this.sortLayersByZindex(o),o}onKeywordChange(t){this.keyword=t}onAppliedFilterAndSortChange(t){this.keyword=t.keyword,this.onlyVisible=t.onlyVisible,this.sortAlpha=t.sortAlpha}filterLayers(t){if(this.layerFilterAndSortOptions.showToolbar===rt.never||!this.keyword&&!this.onlyVisible)return t;const o=t.map(n=>n.id);return t.forEach(n=>{const a=n.dataSource.options||{},u=(((n.options||{}).metadata||{}).keywordList||[]).map(p=>p.normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(this.keyword&&n.title){const p=this.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),d=n.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),g=a.type||"",h=new RegExp(p,"gi"),m=void 0!==u.find(y=>h.test(y));if(!h.test(d)&&this.keyword.toLowerCase()!==g.toLowerCase()&&!m){const y=o.indexOf(n.id);y>-1&&o.splice(y,1)}}if(this.onlyVisible&&!1===n.visible){const p=o.indexOf(n.id);p>-1&&o.splice(p,1)}}),t.filter(n=>-1!==o.indexOf(n.id))}sortLayersByZindex(t){return t.sort((o,n)=>n.zIndex-o.zIndex)}sortLayersByTitle(t){return t.sort((o,n)=>this.normalize(o.title)<this.normalize(n.title)?-1:this.normalize(o.title)>this.normalize(n.title)?1:0)}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}computeShowToolbar(){switch(this.layerFilterAndSortOptions.showToolbar){case rt.always:return!0;case rt.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}}toggleLayerTool(t){this.toggleOpacity=!1,this.layerTool=!this.layerTool||t!==this.activeLayer;for(const o of this.layers)o.options.active=!1;t.options.active=!0,this.activeLayer=t}removeLayers(t){if(t&&t.length>0){this.layersChecked=[];for(const o of t)!1!==o.options.removable?o.map.removeLayer(o):this.layersChecked.push(o)}else!t&&!1!==this.activeLayer.options.removable&&(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)}toggleVisibility(t){if(t&&t.length>0)for(const o of t)o.visible=this.hideSelectedLayers;this.layerItemChangeDetection$.next(!0)}isLayerRemovable(t){return!1!==t.options.removable}isAllLayersRemovable(t){return t.every(o=>this.isLayerRemovable(o))}get statusSelectedLayersCheck(){let t=Qo.NULL,o=!1,n=!1;if(0===this.layersChecked.length)t=Qo.NULL;else{t=Qo.MIXED,this.hideSelectedLayers=!1;for(const s of this.layersChecked)!0===s.visible&&(o=!0),!1===s.visible&&(n=!0);!0===o&&!1===n&&(t=Qo.ALL_VISIBLE),!1===o&&!0===n&&(t=Qo.ALL_HIDDEN,this.hideSelectedLayers=!0)}return t}layersCheck(t){if(t.layer.options.check=t.check,!0===t.check){const o=this.layers.findIndex(n=>t.layer.id===n.id);for(const n of this.layersChecked)if(o<this.layers.findIndex(a=>n.id===a.id))return this.layersChecked.splice(this.layersChecked.findIndex(a=>n.id===a.id),0,t.layer),void(this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(a=>!0!==a.baseLayer&&a.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(a=>a.showInLayerList).length));this.layersChecked.push(t.layer)}else{const o=this.layersChecked.findIndex(n=>t.layer.id===n.id);this.layersChecked.splice(o,1)}this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(o=>!0!==o.baseLayer&&o.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(o=>o.showInLayerList).length)}toggleSelectionMode(t){if(this.selection=t,this.activeLayer=void 0,!0===t){this.layerTool=!1;for(const o of this.layers)o.options.check&&this.layersChecked.push(o)}}layersCheckedOpacity(){if(this.layersChecked.length>1)return 1;{const t=[];for(const o of this.layersChecked)t.push(o.opacity);return t}}selectAll(){if(this.selectAllCheck){for(const t of this.layers)t.options.check=!1;this.layersChecked=[],this.selectAllCheck$.next(!1)}else{for(const t of this.layers)(this.excludeBaseLayers&&!0!==t.baseLayer&&t.showInLayerList||!this.excludeBaseLayers&&t.showInLayerList)&&(t.options.check=!0,this.layersChecked.push(t));this.selectAllCheck$.next(!0)}}isScrolledIntoView(t,o){const n=t.scrollTop,a=o.offsetTop;return a+o.clientHeight<=n+t.clientHeight&&a>=n}removeProblemLayerInList(t){for(const o of t)!0===o.olLoadingProblem&&this.map.removeLayer(o);return t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.SBq))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-list"]],contentQueries:function(t,o,n){if(1&t&&e.Suo(n,Fv,5),2&t){let s;e.iGM(s=e.CRH())&&(o.templateLayerToolbar=s.first)}},inputs:{layersAreAllVisible:"layersAreAllVisible",ogcButton:"ogcButton",timeButton:"timeButton",map:"map",layers:"layers",floatLabel:"floatLabel",layerFilterAndSortOptions:"layerFilterAndSortOptions",excludeBaseLayers:"excludeBaseLayers",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",queryBadge:"queryBadge"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},ngContentSelectors:Uv,decls:11,vars:16,consts:[["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection",4,"ngIf"],["class","select-all",4,"ngIf"],[3,"ngClass","navigation","selection"],["igoList",""],["ngFor","",3,"ngForOf"],["class","igo-layer-actions-container",3,"title",4,"ngIf"],["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection"],[1,"select-all"],[1,"select-all-checkbox","mat-subheading-2",3,"color","checked","indeterminate","change"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox",4,"ngIf"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"matTooltip","disabled","click"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-down",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"matTooltip","disabled","click"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-up",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["matBadgeColor","primary","matBadgeSize","medium","svgIcon","opacity",3,"matBadge"],[1,"mat-menu-opacity-slider"],["opacityMenu","matMenu"],["id","opacity-menu"],["id","opacity-slider","color","primary","thumbLabel","","tickInterval","5","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","value","matTooltip","input","click"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoLayerItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"matTooltip","click"],["matBadgeColor","primary","matBadgeSize","medium","svgIcon","magnify-scan"],[1,"actions-buttons-multi"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"disabled","matTooltip","click"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","delete",3,"matBadge","matBadgeHidden"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"disabled","matTooltip","click"],[3,"svgIcon"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"disabled","matMenuTriggerFor","matTooltip"],["svgIcon","opacity"],["id","opacity-slider","color","primary","thumbLabel","","tickInterval","5","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click",4,"ngIf"],["id","opacity-slider","color","primary","thumbLabel","","tickInterval","5","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click"],["svgIcon","magnify-scan"]],template:function(t,o){1&t&&(e.F$t(Rv),e.TgZ(0,"mat-list"),e.YNc(1,Av,1,4,"igo-layer-list-tool",0),e.ALo(2,"async"),e.qZA(),e.YNc(3,Lv,5,8,"mat-list-item",1),e._UZ(4,"mat-divider"),e.TgZ(5,"igo-list",2,3),e.YNc(7,Ov,1,1,"ng-template",4),e.ALo(8,"async"),e.qZA(),e.YNc(9,Pv,22,34,"igo-panel",5),e.YNc(10,Jv,27,41,"igo-panel",5)),2&t&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,8,o.showToolbar$)),e.xp6(2),e.Q6J("ngIf",o.selection),e.xp6(2),e.Q6J("ngClass",e.kEZ(12,Bv,o.selection,o.layerTool&&!o.selection,!o.layerTool&&!o.selection))("navigation",!1)("selection",!1),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,10,o.layers$)),e.xp6(2),e.Q6J("ngIf",!o.selection&&o.layerTool&&o.activeLayer),e.xp6(1),e.Q6J("ngIf",o.selection&&o.layers.length>0))},styles:["[_nghost-%COMP%]   .igo-list-no-tools[_ngcontent-%COMP%]{height:calc(100% - 57px);padding-top:8px}[_nghost-%COMP%]   .igo-list-tools-single[_ngcontent-%COMP%]{height:calc(100% - 153px);padding-top:8px}[_nghost-%COMP%]   .igo-list-tools-multi[_ngcontent-%COMP%]{height:calc(100% - 191px);padding-top:8px}mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}.igo-layer-actions-container[_ngcontent-%COMP%]{width:calc(100% - 5px);padding-left:4px}.igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}mat-list-item[_ngcontent-%COMP%]     .mat-list-item-content{margin-bottom:10px}mat-checkbox[_ngcontent-%COMP%]     .mat-checkbox-inner-container{margin-left:8px;margin-right:16px}#opacity-slider[_ngcontent-%COMP%]{float:left;min-width:0;min-width:initial;width:110px;left:10px;top:10px}.igo-layer-button-group[_ngcontent-%COMP%], .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.igo-layer-button-group[_ngcontent-%COMP%]{padding-top:5px}[_nghost-%COMP%]   igo-panel[_ngcontent-%COMP%]{height:auto;height:initial}#opacity-menu[_ngcontent-%COMP%]{max-width:none;max-width:initial;width:132px;height:50px}#opacity-menu[_ngcontent-%COMP%]   .mat-menu-content[_ngcontent-%COMP%]:not(:empty){padding-top:20px}.select-all[_ngcontent-%COMP%]     .mat-list-item-content{margin:0}"],changeDetection:0}),i})();function Nv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.clearTerm())}),e._UZ(1,"mat-icon",10),e.qZA()}}let qv=(()=>{class i{constructor(){this.onlyVisible$=new b.X(!1),this.sortAlpha$=new b.X(!1),this.term$=new b.X(void 0),this.layersAreAllVisible=!0,this.floatLabel="auto",this.selectionMode=!1,this.appliedFilterAndSort=new e.vpe,this.selection=new e.vpe}set onlyVisible(t){this.onlyVisible$.next(t)}get onlyVisible(){return this.onlyVisible$.value}set sortAlpha(t){this.sortAlpha$.next(t)}get sortAlpha(){return this.sortAlpha$.value}set term(t){this.term$.next(t)}get term(){return this.term$.value}ngOnInit(){this.term$$=this.term$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:t,onlyVisible:this.onlyVisible,sortAlpha:this.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:t,sortAlpha:this.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:this.onlyVisible,sortAlpha:t})})}ngOnDestroy(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()}clearTerm(){this.term=void 0}toggleSortAlpha(){this.sortAlpha=!this.sortAlpha}toggleOnlyVisible(){this.onlyVisible=!this.onlyVisible}toggleSelectionMode(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-list-tool"]],inputs:{layersAreAllVisible:"layersAreAllVisible",floatLabel:"floatLabel",onlyVisible:"onlyVisible",sortAlpha:"sortAlpha",term:"term"},outputs:{appliedFilterAndSort:"appliedFilterAndSort",selection:"selection"},decls:21,vars:30,consts:[[1,"inputFilter",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"placeholder","matTooltip","ngModel","ngModelChange"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["matTooltipShowDelay","500",3,"matTooltip"],["mat-icon-button","",1,"sort-alpha",3,"color","click"],[3,"svgIcon"],["mat-icon-button","",1,"only-visible",3,"disabled","color","click"],["matBadge","icon","igoMatBadgeIcon","eye","igoMatBadgeInverseColor","true","igoMatBadgeInheritColor","true",3,"svgIcon"],["mat-icon-button","","color","primary",1,"selection-mode",3,"click"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"],["svgIcon","close"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-list-item")(1,"mat-form-field",0)(2,"input",1),e.NdJ("ngModelChange",function(s){return o.term=s}),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA(),e.YNc(5,Nv,2,0,"button",2),e.qZA(),e.TgZ(6,"div",3),e.ALo(7,"translate"),e.ALo(8,"translate"),e.TgZ(9,"button",4),e.NdJ("click",function(){return o.toggleSortAlpha()}),e._UZ(10,"mat-icon",5),e.qZA()(),e.TgZ(11,"div",3),e.ALo(12,"translate"),e.ALo(13,"translate"),e.TgZ(14,"button",6),e.NdJ("click",function(){return o.toggleOnlyVisible()}),e._UZ(15,"mat-icon",7),e.qZA()(),e.TgZ(16,"div",3),e.ALo(17,"translate"),e.ALo(18,"translate"),e.TgZ(19,"button",8),e.NdJ("click",function(){return o.toggleSelectionMode()}),e._UZ(20,"mat-icon",5),e.qZA()()()),2&t&&(e.xp6(1),e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(3,14,"igo.geo.layer.filterPlaceholder"))("matTooltip",e.lcZ(4,16,"igo.geo.layer.subsetLayersListKeyword"))("ngModel",o.term),e.xp6(3),e.Q6J("ngIf",o.term),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha?e.lcZ(7,18,"igo.geo.layer.sortMapOrder"):e.lcZ(8,20,"igo.geo.layer.sortAlphabetically")),e.xp6(3),e.Q6J("color",o.sortAlpha?"warn":"primary"),e.xp6(1),e.Q6J("svgIcon",o.sortAlpha?"sort-ascending":"sort-alphabetical-ascending"),e.xp6(1),e.Q6J("matTooltip",o.onlyVisible?e.lcZ(12,22,"igo.geo.layer.resetLayersList"):e.lcZ(13,24,"igo.geo.layer.subsetLayersListOnlyVisible")),e.xp6(3),e.Q6J("disabled",o.layersAreAllVisible&&!o.onlyVisible)("color",o.onlyVisible?"warn":"primary"),e.xp6(1),e.Q6J("svgIcon",o.onlyVisible?"filter-remove":"filter"),e.xp6(1),e.Q6J("matTooltip",o.selectionMode?e.lcZ(17,26,"igo.geo.layer.deactivateSelectionMode"):e.lcZ(18,28,"igo.geo.layer.activateSelectionMode")),e.xp6(4),e.Q6J("svgIcon",o.selectionMode?"checkbox-multiple-marked-outline":"checkbox-multiple-blank-outline"))},dependencies:[I.KE,I.R9,H.Nt,_.Fj,_.JJ,f.O5,_.On,T.Hw,w.lW,O.gM,G.Tg,mt.k,Zs,L.X$],styles:["mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}.selection-mode[_ngcontent-%COMP%]{margin-left:5px}"],changeDetection:0}),i})(),Br=(()=>{class i{constructor(t,o,n){this.mapService=o,this.route=n,this.component=t}ngOnInit(){this.layersOrResolutionChange$$=(0,Qe.a)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,fe.b)(10)).subscribe(t=>{const o=t[0].filter(n=>!0===n.showInLayerList);this.component.layers=o,this.setLayersVisibilityStatus(o,this.component.excludeBaseLayers)})}setLayersVisibilityStatus(t,o){void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0),this.layersVisibility$$=(0,Qe.a)(t.filter(n=>n.baseLayer!==o).map(n=>n.visible$)).pipe((0,Z.U)(n=>n.every(Boolean))).subscribe(n=>this.component.layersAreAllVisible=n)}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(yi,2),e.Y36(Ut),e.Y36(Mi,8))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoLayerListBinding",""]]}),i})();function Gv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",6),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.toggleShowAllLegends(n.checked))}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,4,"igo.geo.layer.legend.showAll"))("checked",t.showAllLegendsValue)("labelPosition","before"),e.xp6(2),e.hij(" ",e.lcZ(3,6,"igo.geo.layer.legend.showAll")," ")}}function Qv(i,r){1&i&&e._UZ(0,"mat-divider")}function jv(i,r){if(1&i&&e._UZ(0,"igo-layer-legend-item",8),2&i){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("layer",t)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange)}}function Yv(i,r){if(1&i&&e.YNc(0,jv,1,2,"igo-layer-legend-item",7),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",!(o.excludeBaseLayers&&t.baseLayer))}}function Hv(i,r){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Vv(i,r){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function zv(i,r){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function Wv(i,r){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}let qn=(()=>{class i{constructor(){this.orderable=!0,this.hasVisibleOrInRangeLayers$=new b.X(!0),this.hasVisibleAndNotInRangeLayers$=new b.X(!0),this.layersInUi$=new b.X([]),this.layers$=new b.X([]),this.showAllLegend=!1,this.change$=new hn.t(1),this.excludeBaseLayers=!1,this.updateLegendOnResolutionChange=!1,this.allowShowAllLegends=!1,this.showAllLegendsValue=!1,this.allLegendsShown=new e.vpe(!1)}set layers(t){this._layers=t,this.next()}get layers(){return this._layers}ngOnInit(){this.change$$=this.change$.pipe((0,Tn.D)(()=>0===this.layers.length?Bi.E:(0,wn.H)(50))).subscribe(()=>{const t=this.computeShownLayers(this.layers.slice(0));this.layers$.next(t),this.hasVisibleOrInRangeLayers$.next(this.layers.slice(0).filter(o=>!0!==o.baseLayer).filter(o=>o.visible$.value&&o.isInResolutionsRange$.value).length>0),this.hasVisibleAndNotInRangeLayers$.next(this.layers.slice(0).filter(o=>!0!==o.baseLayer).filter(o=>o.visible$.value&&!o.isInResolutionsRange$.value).length>0),this.layersInUi$.next(this.layers.slice(0).filter(o=>!(!1===o.showInLayerList||this.excludeBaseLayers&&o.baseLayer)))})}ngOnDestroy(){this.change$$.unsubscribe()}next(){this.change$.next()}computeShownLayers(t){let o=t.filter(n=>n.visible&&n.isInResolutionsRange);return this.showAllLegendsValue&&(o=t),this.sortLayersByZindex(o)}sortLayersByZindex(t){return t.sort((o,n)=>n.zIndex-o.zIndex)}toggleShowAllLegends(t){this.showAllLegendsValue=t,this.next(),this.allLegendsShown.emit(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"matTooltip","checked","labelPosition","change"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Gv,4,8,"mat-slide-toggle",1),e.ALo(2,"async"),e.YNc(3,Qv,1,0,"mat-divider",2),e.ALo(4,"async"),e.TgZ(5,"igo-list",3),e.YNc(6,Yv,1,1,"ng-template",4),e.ALo(7,"async"),e.qZA(),e.YNc(8,Hv,3,3,"p",5),e.ALo(9,"async"),e.ALo(10,"async"),e.ALo(11,"async"),e.YNc(12,Vv,3,3,"p",5),e.ALo(13,"async"),e.ALo(14,"async"),e.ALo(15,"async"),e.YNc(16,zv,3,3,"p",5),e.ALo(17,"async"),e.ALo(18,"async"),e.ALo(19,"async"),e.YNc(20,Wv,3,3,"p",5),e.ALo(21,"async"),e.ALo(22,"async"),e.ALo(23,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,9,o.layersInUi$).length&&o.allowShowAllLegends),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,11,o.layersInUi$).length&&o.allowShowAllLegends),e.xp6(2),e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(7,13,o.layers$)),e.xp6(2),e.Q6J("ngIf",!o.showAllLegendsValue&&e.lcZ(9,15,o.layersInUi$).length&&!1===e.lcZ(10,17,o.hasVisibleOrInRangeLayers$)&&!1===e.lcZ(11,19,o.hasVisibleAndNotInRangeLayers$)&&o.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",!o.showAllLegendsValue&&e.lcZ(13,21,o.layersInUi$).length&&!1===e.lcZ(14,23,o.hasVisibleOrInRangeLayers$)&&e.lcZ(15,25,o.hasVisibleAndNotInRangeLayers$)&&o.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",e.lcZ(17,27,o.layersInUi$).length&&!1===e.lcZ(18,29,o.hasVisibleOrInRangeLayers$)&&!1===e.lcZ(19,31,o.hasVisibleAndNotInRangeLayers$)&&!o.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",e.lcZ(21,33,o.layersInUi$).length&&!1===e.lcZ(22,35,o.hasVisibleOrInRangeLayers$)&&e.lcZ(23,37,o.hasVisibleAndNotInRangeLayers$)&&!o.allowShowAllLegends))},styles:["mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}igo-list[_ngcontent-%COMP%]{display:contents}.layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}.layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"],changeDetection:0}),i})();function Kv(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleTrackFeature())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.layer.trackFeature"))("color",t.color)}}let Ur=(()=>{class i{constructor(){this.trackFeature=!1,this.color="primary"}get options(){if(this.layer)return this.layer.options}ngOnInit(){this.color=this.trackFeature?"primary":"basic"}toggleTrackFeature(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","crosshairs-gps"]],template:function(t,o){1&t&&e.YNc(0,Kv,3,4,"button",0),2&t&&e.Q6J("ngIf",o.options.trackFeature)},dependencies:[f.O5,T.Hw,w.lW,O.gM,L.X$],changeDetection:0}),i})(),ru=(()=>{class i{constructor(t){this.networkService=t,this.inResolutionRange$=new b.X(!0),this.updateLegendOnResolutionChange=!1}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(o=>{this.state=o,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const o=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Wt.TITLE:return this.layer.title;case Wt.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Wt.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){this.inResolutionRange$.next(this.layer.isInResolutionsRange)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(mn))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},decls:6,vars:4,consts:[[1,"igo-layer-list-item"],["matLine","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-list-item",0)(1,"h4",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2,3),e._UZ(5,"igo-layer-legend",4),e.qZA()),2&t&&(e.xp6(1),e.Q6J("matTooltip",o.tooltipText),e.xp6(1),e.Oqu(o.layer.title),e.xp6(3),e.Q6J("layer",o.layer)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange))},styles:["[_nghost-%COMP%]{overflow:hidden}.igo-layer-list-item[_ngcontent-%COMP%]{height:46px;clear:both}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}"],changeDetection:0}),i})(),vi=(()=>{class i{static forRoot(){return{ngModule:i,providers:[Le,no,Cv]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[H.c,_.UX,I.lN,f.ez,_.u5,vt.t,$e.Tx,T.Ps,w.ot,at.rP,ue.LD,O.AV,G.ie,mi.KP,mt.g,Ge.p9,Ln.e4,oe,ui,Ii,Qs,Tt,dr,Oi]}),i})();e.B6R(iu,[f.mk,f.O5,T.Hw,w.lW,O.gM,G.Tg,Q.X2,G.Nh,mt.k,Ge.oG,Nn],[f.Ov,L.X$]),e.B6R(ru,[O.gM,G.Tg,Q.X2,Nn],[]),e.B6R(yi,[_.JJ,f.mk,f.sg,f.O5,f.tP,_.On,vt.d,$e.VK,$e.p6,T.Hw,w.lW,O.gM,G.i$,G.Tg,mi.pH,mt.k,Ge.oG,Zt,mo,Dt,iu,qv],[f.Ov,L.X$]),e.B6R(qn,[f.sg,f.O5,vt.d,at.Rr,O.gM,Zt,mo,ru],[f.Ov,L.X$]);let su=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,mt.g,w.ot,T.Ps,G.ie,O.AV,dr,oe,ui,Ii,fi,vi]}),i})();function Xv(i,r){if(1&i&&(e.TgZ(0,"mat-option",17),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("matTooltip",t.title)("value",t),e.xp6(1),e.hij(" ",t.title," ")}}function eb(i,r){if(1&i&&(e.TgZ(0,"mat-option",17),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("matTooltip",t.url)("value",t),e.xp6(1),e.hij(" ",t.url," ")}}function tb(i,r){if(1&i&&(e.TgZ(0,"mat-option",18),e.NdJ("click",function(o){return o.stopPropagation()}),e.TgZ(1,"p",19),e._uU(2),e.qZA()()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(2),e.Oqu(t)}}e.B6R(Ta,[f.sg,f.O5,Zt,mo,bv,tu],[f.Ov]);const ob=function(i,r){return{value:i,email:r}};function ib(i,r){if(1&i&&(e.TgZ(0,"span")(1,"p",20),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",e.WLB(1,ob,t.addedCatalog.url,t.emailAddress)))}}const nb=function(i){return{value:i}};function rb(i,r){if(1&i&&(e.TgZ(0,"span")(1,"p",20),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.languageService.translate.instant("igo.geo.catalog.unavailable",e.VKq(1,nb,t.addedCatalog.url)))}}let sb=(()=>{class i{constructor(t,o,n,s,a){this.formBuilder=t,this.languageService=o,this.configService=n,this.dialogRef=s,this.data=a,this.defaultAddedCatalogType="wms",this.predefinedCatalogsList$=new b.X([]),this.predefinedCatalogs=[],this.error=!1,this.store=a.store,this.predefinedCatalogs=a.predefinedCatalogs,this.error=a.error,this.addedCatalog=a.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[_.kI.required]],type:[this.defaultAddedCatalogType,[_.kI.required]]})}ngOnInit(){this.store.state.clear(),this.typeCapabilities=Object.keys(Yi),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(t=>{"wmts"===t?this.form.get("title").setValidators(_.kI.required):this.form.get("title").setValidators([]),this.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(()=>this.computePredefinedCatalogList()),this.emailAddress=this.configService.getConfig("emailAddress")}ngOnDestroy(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}changeUrlOrTitle(t){this.form.patchValue(t),this.error=!1,this.computePredefinedCatalogList()}computePredefinedCatalogList(){this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(t=>!this.store.get(t.id)))}addCatalog(t){this.error=!1,this.dialogRef.close(t)}cancel(){this.error=!1,this.dialogRef.close()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_.QS),e.Y36(D),e.Y36(J),e.Y36(P.so),e.Y36(P.WI,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-add-catalog-dialog"]],decls:34,vars:25,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto2","matAutocomplete"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["auto","matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"value","click"],["mat-line",""],[1,"error"]],template:function(t,o){if(1&t&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field"),e._UZ(7,"input",4),e.ALo(8,"translate"),e.TgZ(9,"mat-autocomplete",5,6),e.NdJ("optionSelected",function(s){return o.changeUrlOrTitle(s.option.value)}),e.YNc(11,Xv,2,3,"mat-option",7),e.ALo(12,"async"),e.qZA()()(),e.TgZ(13,"div",3)(14,"mat-form-field"),e._UZ(15,"input",8),e.TgZ(16,"mat-autocomplete",5,9),e.NdJ("optionSelected",function(s){return o.changeUrlOrTitle(s.option.value)}),e.YNc(18,eb,2,3,"mat-option",7),e.ALo(19,"async"),e.qZA()()(),e.TgZ(20,"div",3)(21,"mat-form-field")(22,"mat-select",10),e.YNc(23,tb,3,2,"mat-option",11),e.qZA()()()(),e.YNc(24,ib,3,4,"span",12),e.YNc(25,rb,3,3,"span",12),e.qZA(),e.TgZ(26,"div",13)(27,"div",14)(28,"button",15),e.NdJ("click",function(){return o.cancel()}),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",16),e.NdJ("click",function(){return o.addCatalog(o.form.value)}),e._uU(32),e.ALo(33,"translate"),e.qZA()()()),2&t){const n=e.MAs(10),s=e.MAs(17);e.xp6(1),e.Oqu(e.lcZ(2,13,"igo.geo.catalog.library.addTitle")),e.xp6(3),e.Q6J("formGroup",o.form),e.xp6(3),e.s9C("placeholder",e.lcZ(8,15,"igo.geo.printForm.title")),e.Q6J("matAutocomplete",n),e.xp6(4),e.Q6J("ngForOf",e.lcZ(12,17,o.predefinedCatalogsList$)),e.xp6(4),e.Q6J("matAutocomplete",s),e.xp6(3),e.Q6J("ngForOf",e.lcZ(19,19,o.predefinedCatalogsList$)),e.xp6(5),e.Q6J("ngForOf",o.typeCapabilities),e.xp6(1),e.Q6J("ngIf",o.error&&o.addedCatalog&&o.emailAddress),e.xp6(1),e.Q6J("ngIf",o.error&&o.addedCatalog&&!o.emailAddress),e.xp6(4),e.hij(" ",e.lcZ(30,21,"igo.geo.catalog.library.cancel")," "),e.xp6(2),e.Q6J("disabled",!o.form.valid),e.xp6(1),e.hij(" ",e.lcZ(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[f.sg,f.O5,Q.X2,O.gM,w.lW,I.KE,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,H.Nt,ue.gD,Q.ey,Xe.XC,Xe.ZL,P.uh,P.xY,P.H8,f.Ov,L.X$],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]}),i})();function ab(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-catalog-library-item",3),e.NdJ("catalogRemove",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onCatalogRemove(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onCatalogSelect(s))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw();e.Q6J("map",o.map)("catalog",t)}}function lb(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"button",5),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.addCatalogDialog())}),e.ALo(2,"translate"),e._uU(3),e.ALo(4,"translate"),e._UZ(5,"mat-icon",6),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.catalog.library.addBtn")),e.xp6(2),e.hij(" ",e.lcZ(4,4,"igo.geo.catalog.library.addBtn")," "))}let Ma=(()=>{class i{constructor(t,o,n,s){this.capabilitiesService=t,this.messageService=o,this.storageService=n,this.dialog=s,this.addCatalogAllowed=!1,this.predefinedCatalogs=[],this.catalogSelectChange=new e.vpe,this.submitDisabled=!0}get addedCatalogs(){return this.storageService.get("addedCatalogs")||[]}set addedCatalogs(t){this.storageService.set("addedCatalogs",t)}ngOnInit(){this.store.state.clear(),this.predefinedCatalogs=this.predefinedCatalogs.map(t=>(t.id=ho.V8.hashStr((t.type||"wms")+No(t.url)),t.title=""!==t.title&&t.title?t.title:t.url,t))}getCatalogs(){return this.store.view.all$()}onCatalogSelect(t){this.store.state.update(t,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:t})}unsubscribeAddingCatalog(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}addCatalog(t){if(!t)return;let o=ho.V8.hashStr(t.type+No(t.url));const n=this.predefinedCatalogs.find(s=>s.id===t.id);n&&(t.version=n.version,t.externalProvider=n.externalProvider,o=n.id),this.store.get(o)?this.messageService.alert("igo.geo.catalog.library.inlist.message","igo.geo.catalog.library.inlist.title"):(this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(t.type,t.url,t.version).pipe((0,he.K)(s=>{if(s.error)return this.addCatalogDialog(!0,t),s.error.caught=!0,s;throw this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.url}),s})).subscribe(s=>{let a,l;switch(t.type){case"wms":a=t.title||s.Service.Title,l=t.version||s.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":a=t.title||s.mapName;break;case"wmts":a=t.title||s.ServiceIdentification.ServiceType;break;default:a=t.title}const c=B.removeUndefined(Object.assign({},n,B.removeUndefined({id:o,title:a,url:t.url,type:t.type||"wms",externalProvider:t.externalProvider||!1,removable:!0,version:l})));this.store.insert(c);const u=this.addedCatalogs.slice(0);u.push(c),this.addedCatalogs=u,this.unsubscribeAddingCatalog()}))}ngOnDestroy(){this.unsubscribeAddingCatalog()}onCatalogRemove(t){this.store.delete(t),this.addedCatalogs=this.addedCatalogs.slice(0).filter(o=>o.id!==t.id)}addCatalogDialog(t,o){this.dialog.open(sb,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:t,addedCatalog:o}}).afterClosed().subscribe(s=>{this.addCatalog(s)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Dr),e.Y36(_e),e.Y36(ce),e.Y36(P.uw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"map","catalog","catalogRemove","select"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"matTooltip","click"],["svgIcon","earth-plus"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-list",0),e.YNc(1,ab,1,2,"ng-template",1),e.ALo(2,"async"),e.qZA(),e.YNc(3,lb,6,6,"div",2)),2&t&&(e.Q6J("navigation",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,3,o.getCatalogs())),e.xp6(2),e.Q6J("ngIf",o.addCatalogAllowed))},styles:["igo-list[_ngcontent-%COMP%]{height:auto}.btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}"],changeDetection:0}),i})();function cb(i,r){1&i&&(e.TgZ(0,"mat-icon",4),e.NdJ("click",function(o){return o.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.catalog"))}function ub(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.removeCatalogFromLibrary(n))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",6),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.library.remove"))}function pb(i,r){1&i&&(e.TgZ(0,"button",7),e._UZ(1,"mat-icon",8),e.qZA())}let db=(()=>{class i{constructor(){this.catalogRemove=new e.vpe}get title(){return Yt(this.catalog)}removeCatalogFromLibrary(t){t.stopPropagation(),this.catalogRemove.emit()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},decls:6,vars:4,consts:[["mat-line",""],["class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-external-provider",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["disabled","true","mat-icon-button","",1,"igo-blank"],["svgIcon","blank"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-list-item")(1,"h4",0),e._uU(2),e.qZA(),e.YNc(3,cb,2,3,"mat-icon",1),e.YNc(4,ub,3,3,"button",2),e.YNc(5,pb,2,0,"button",3),e.qZA()),2&t&&(e.xp6(2),e.hij(" ",o.title," "),e.xp6(1),e.Q6J("ngIf",o.catalog.externalProvider),e.xp6(1),e.Q6J("ngIf",o.catalog.removable),e.xp6(1),e.Q6J("ngIf",!o.catalog.removable))},dependencies:[f.O5,T.Hw,G.Tg,Q.X2,O.gM,w.lW,L.X$],styles:[".igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0}),i})(),au=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,T.Ps,mt.g,G.ie,O.AV,ui,oe,w.ot,I.lN,_.UX,H.c,ue.LD,Xe.Bb,P.Is]}),i})();e.B6R(Ma,[f.sg,f.O5,T.Hw,O.gM,Zt,mo,w.lW,db],[f.Ov,L.X$]);let lu=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,mt.g,T.Ps,G.ie,O.AV,dr,ui,Ii,su,au]}),i})(),cu=(()=>{class i{transform(t,o){let n;return"time"===o&&(n=t.filter(s=>{const a=s.dataSource;return this.isTimeFilterable(a)&&void 0!==a.options.timeFilter&&Object.keys(a.options.timeFilter).length})),"ogc"===o&&(n=t.filter(s=>this.isOgcFilterable(s.dataSource))),n}isTimeFilterable(t){return"wms"===t.options.type&&t.options.timeFilterable}isOgcFilterable(t){let o=!1;return t.options.ogcFilters&&t.options.ogcFilters.enabled&&t.options.ogcFilters.editable&&(o=!0),t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete)&&(o=!0),o}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275pipe=e.Yjl({name:"filterableDataSource",type:i,pure:!0}),i})(),uu=(()=>{class i{constructor(){}filterByDate(t,o){let n,s,a,l;if(Array.isArray(o)){const u=[];o[0]&&(a=this.reformatDateTime(o[0]),u.push(o[0])),o[1]&&(l=this.reformatDateTime(o[1]),u.push(o[1])),2===u.length&&a!==l&&(n=t instanceof kn?a+","+l:a+"/"+l),a===l&&(n=a)}else o&&(s=this.reformatDateTime(o),n=s);t.ol.updateParams({TIME:n}),t instanceof Bt&&t.setTimeFilter(t.timeFilter,!0)}filterByYear(t,o){let n,s,a;if(Array.isArray(o)){const c=[];o[0]&&(s=o[0],c.push(o[0])),o[1]&&(a=o[1],c.push(o[1])),2===c.length&&s!==a&&(n=t instanceof kn?s+","+a:s+"/"+a),s===a&&(n=s)}else n=o;t.ol.updateParams({TIME:n}),t instanceof Bt&&t.setTimeFilter(t.timeFilter,!0)}reformatDateTime(t){const o=t.getFullYear();let n=t.getMonth()+1,s=t.getUTCDate(),a=t.getUTCHours(),l=t.getUTCMinutes();return Number(n)<10&&(n="0"+n),Number(s)<10&&(s="0"+s),Number(a)<10&&(a="0"+a),Number(l)<10&&(l="0"+l),o+"-"+n+"-"+s+"T"+a+":"+l+":00Z"}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),Fa=(()=>{class i{constructor(){}filterByOgc(t,o){const n=(new Rt).formatProcessedOgcFilter(o,t.options.params.LAYERS);t.ol.updateParams({FILTER:n})}setOgcWFSFiltersOptions(t){const o=t.options,n=new Rt;o.ogcFilters.enabled&&o.ogcFilters.filters&&(o.ogcFilters.filters=n.checkIgoFiltersProperties(o.ogcFilters.filters,o.paramsWFS.fieldNameGeometry,new Ni.Z({code:o.paramsWFS.srsName}),!0),o.ogcFilters.interfaceOgcFilters||(o.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(o.ogcFilters.filters,o.paramsWFS.fieldNameGeometry)))}setOgcWMSFiltersOptions(t){const o=t.options,n=new Rt;o.ogcFilters.enabled&&o.ogcFilters.filters?(o.ogcFilters.filters=n.checkIgoFiltersProperties(o.ogcFilters.filters,o.fieldNameGeometry,void 0,!0),o.ogcFilters.interfaceOgcFilters||(o.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(o.ogcFilters.filters,o.fieldNameGeometry)),this.filterByOgc(t,n.buildFilter(o.ogcFilters.filters,void 0,void 0,void 0,t.options)),o.filtered=!0):(o.ogcFilters.filters=void 0,o.ogcFilters.interfaceOgcFilters=[],o.filtered=!1)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var ye=(()=>{return(i=ye||(ye={})).Predefined="Predefined",i.Polygon="Polygon",i.Point="Point",ye;var i})(),xt=(()=>{return(i=xt||(xt={})).Address="Address",i.Thematics="Thematics",xt;var i})();let Gn=(()=>{class i{constructor(t,o,n){this.http=t,this.languageService=o,this.configService=n,this.baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/",this.urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"},this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}getKeyByValue(t,o){return Object.keys(t).find(n=>t[n]===o)}loadFilterList(t){if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe((0,Z.U)(n=>n.features.map(s=>(s.meta={id:s.properties.code},s))))}loadThematicsList(){const o=[];return this.http.get(this.baseUrl+"types").pipe((0,Z.U)(n=>(n.forEach(s=>{if(s.startsWith("lieux")){const a={name:void 0,source:s};let l=s.substring(6,s.length),c=l;if(l.includes(".")){const u=l.indexOf(".");c=l.substring(u+1,l.length),l=l.substring(0,u)}try{a.name=this.languageService.translate.instant("igo.geo.terrapi."+c)}catch(u){a.name=c.substring(0,1).toUpperCase()+c.substring(1,c.length-1)}try{a.group=this.languageService.translate.instant("igo.geo.spatialFilter.group."+l)}catch(u){a.group=l.substring(0,1).toUpperCase()+l.substring(1,c.length-1)}o.push(a)}else if(this.getKeyByValue(this.urlFilterList,s)){const a={name:void 0,source:s},l=this.getKeyByValue(this.urlFilterList,s);try{a.name=this.languageService.translate.instant("igo.geo.terrapi."+l)}catch(c){a.name=l.substring(0,1).toUpperCase()+l.substring(1,l.length-1)}a.source=s,o.push(a)}}),o)))}loadFilterItem(t,o,n,s,a){if(n){const c=this.baseUrl+this.urlFilterList[n];let u="";return o===xt.Address?(u="adresses",this.http.get(c+"/"+t.properties.code+"/"+u,{params:{geometry:"true",icon:"true",bufferInput:a.toString(),simplified:"100"}}).pipe((0,Z.U)(p=>p.features.map(d=>(d.meta={id:d.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:d.icon},d))))):(u=s.source,this.http.get(c+"/"+t.properties.code+"/"+u,{params:{geometry:"true",icon:"true",bufferInput:a.toString(),simplified:"100"}}).pipe((0,Z.U)(p=>p.features.map(d=>(d.meta={id:d.properties.code,title:s.name,icon:d.icon},d)))))}{const l=this.baseUrl+"locate";return o===xt.Address?this.http.post(l+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:a.toString(),simplified:"100"}).pipe((0,Z.U)(u=>u.features.map(p=>(p.meta={id:p.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:p.icon},p)))):this.http.post(l+"?type="+s.source,{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:a.toString(),simplified:"100"}).pipe((0,Z.U)(u=>u.features.map(p=>(p.meta={id:p.properties.code,title:s.name,icon:p.icon},p))))}}loadItemById(t,o){const n=this.urlFilterList[o],s="/"+t.properties.code;if(n&&s)return this.http.get(this.baseUrl+n+s,{params:{geometry:"true"}}).pipe((0,Z.U)(a=>(a.meta={id:a.properties.code,alias:a.properties.nom,title:a.properties.nom},a)))}loadBufferGeometry(t,o,n,s){if(o!==ye.Predefined)return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:n,loc:JSON.stringify(t)}).pipe((0,Z.U)(a=>a));{const a=this.urlFilterList[s],l="/"+t.properties.code;if(a&&l)return this.http.get(this.baseUrl+a+l,{params:{geometry:"100",bufferOutput:n.toString()}}).pipe((0,Z.U)(c=>(c.meta={id:c.properties.code,alias:c.properties.nom,title:c.properties.nom},c)))}}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(D),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),pu=(()=>{class i{constructor(t){this.messageService=t}open(t){this.messageService.success("igo.geo.download.start","igo.geo.download.title");const o=t.dataSource.options;if(Object.keys(o.download).length>0)if(o.download.dynamicUrl&&void 0===o.download.url){let n,s=new Ni.Z({code:t.map.projection});const a=t.dataSource.options.paramsWFS;a&&Object.keys(a).length>0?(s=a.srsName?new Ni.Z({code:a.srsName}):s,n=t.dataSource.options.paramsWFS):n=t.dataSource.options.params;const l=V.$A(t.map.viewController.getExtent(),new Ni.Z({code:t.map.projection}),s),c=void 0===n.outputFormatDownload?void 0===n.outputFormat?"":"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,u=o.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),p=t.dataSource.options.ogcFilters;let d;d=(new Rt).handleOgcFiltersAppliedValue(t.dataSource.options,p.geometryName,l,s),d=d?"filter="+encodeURIComponent(d):(new Rt).buildFilter(void 0,l,s,p.geometryName),window.open(`${u}&${d}&${c}`,"_blank")}else o.download&&window.open(o.download.url,"_blank")}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(_e))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function mb(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.openDownload(n.layer))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.download.action"))("color",t.color)}}let hb=(()=>{class i{constructor(t){this.downloadService=t,this._color="primary"}get layer(){return this._layer}set layer(t){this._layer=t}get color(){return this._color}set color(t){this._color=t}openDownload(t){this.downloadService.open(t)}get options(){if(this.layer)return this.layer.dataSource.options}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(pu))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","download"]],template:function(t,o){1&t&&e.YNc(0,mb,3,4,"button",0),2&t&&e.Q6J("ngIf",o.options&&o.options.download&&(o.options.download.dynamicUrl||o.options.download.url))},dependencies:[f.O5,T.Hw,w.lW,O.gM,L.X$],changeDetection:0}),i})(),Nr=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,T.Ps,w.ot,O.AV,oe]}),i})();function fb(i,r){if(1&i&&(e.TgZ(0,"td"),e._UZ(1,"mat-icon",7),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.s9C("svgIcon",t.icon)}}function _b(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td")(1,"a",8),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.copyTextToClipboard(n.value))}),e._UZ(5,"mat-icon",10),e.qZA()()}if(2&i){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.s9C("href",t.value,e.LSH),e.xp6(1),e.AsE(" ",e.lcZ(3,3,"igo.geo.targetHtmlUrl")," ",o.title,"")}}function yb(i,r){if(1&i&&(e.TgZ(0,"td",11),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.key," ")}}function vb(i,r){if(1&i&&e._UZ(0,"td",12),2&i){const t=e.oxw().$implicit;e.Q6J("innerHTML",t.value,e.oJD)}}const du=function(){return{cursor:"pointer",color:"blue"}};function bb(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td")(1,"u",13),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openSecureUrl(n.value))}),e._uU(2),e.qZA()()}if(2&i){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngStyle",e.DdM(2,du)),e.xp6(1),e.Oqu(o.getEmbeddedLinkText(t.value))}}function Cb(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td")(1,"u",13),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openSecureUrl(n.value))}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.copyTextToClipboard(n.value))}),e._UZ(5,"mat-icon",10),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,du)),e.xp6(1),e.Oqu(e.lcZ(3,2,"igo.geo.targetHtmlUrl")))}function xb(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td")(1,"a",14),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openSecureUrl(n.value))}),e._UZ(2,"img",15),e.ALo(3,"async"),e.ALo(4,"secureImage"),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(1),e.s9C("href",t.value,e.LSH),e.xp6(1),e.s9C("src",e.lcZ(3,2,e.lcZ(4,4,t.value)),e.LSH)}}function Sb(i,r){if(1&i&&(e._UZ(0,"td",12),e.ALo(1,"json")),2&i){const t=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,t.value),e.oJD)}}function wb(i,r){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,fb,2,1,"td",4),e.YNc(2,_b,6,5,"td",4),e.YNc(3,yb,2,1,"td",5),e.YNc(4,vb,1,1,"td",6),e.YNc(5,bb,3,3,"td",4),e.YNc(6,Cb,6,5,"td",4),e.YNc(7,xb,5,6,"td",4),e.YNc(8,Sb,2,3,"td",6),e.qZA()),2&i){const t=r.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf","_blank"===o.feature.properties.target&&"url"===t.key),e.xp6(1),e.Q6J("ngIf","_blank"===o.feature.properties.target&&"url"===t.key),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&!o.isObject(t.value)&&!o.isUrl(t.value)&&!o.isEmbeddedLink(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&o.isEmbeddedLink(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&!o.isObject(t.value)&&(o.isDoc(t.value)||o.isUrl(t.value))&&!o.isImg(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&!o.isObject(t.value)&&o.isUrl(t.value)&&o.isImg(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&o.isObject(t.value))}}function Tb(i,r){if(1&i&&(e.TgZ(0,"table",2)(1,"tbody"),e.YNc(2,wb,9,8,"tr",3),e.ALo(3,"keyvalue"),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,t.filterFeatureProperties(t.feature)))}}function Mb(i,r){if(1&i&&e._UZ(0,"iframe",16),2&i){const t=e.oxw();e.Q6J("srcdoc",t.htmlSanitizer(t.feature.properties),e.oJD)("src",t.urlSanitizer(t.feature.properties.url),e.uOi)}}let bi=(()=>{class i{constructor(t,o,n,s,a,l){this.http=t,this.cdRef=o,this.sanitizer=n,this.networkService=s,this.messageService=a,this.configService=l,this.unsubscribe$=new Se.x,this.ready=!1,this.routeEvent=new e.vpe,this.selectFeature=new e.vpe,this.htmlDisplayEvent=new e.vpe,this.networkService.currentState().pipe((0,Fo.R)(this.unsubscribe$)).subscribe(c=>{this.state=c})}get source(){return this._source}set source(t){this._source=t,this.cdRef.detectChanges()}get feature(){return this._feature}set feature(t){this._feature=t,this.cdRef.detectChanges(),this.selectFeature.emit()}get title(){return Yt(this.feature)}get icon(){return lr(this.feature)||"link"}ngOnInit(){this.ready=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}urlSanitizer(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}isHtmlDisplay(){return this.feature&&this.isObject(this.feature.properties)&&"iframe"===this.feature.properties.target?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}htmlSanitizer(t){if(t.body){if(!/<base href="[\w:\/\.]+">/.test(t.body)){const n=new URL(t.url,window.location.origin);t.body=t.body.replace("<head>",`<head><base href="${n.origin}">`)}return this.sanitizer.bypassSecurityTrustHtml(t.body)}}isObject(t){return"object"==typeof t}openSecureUrl(t){var o;let n;const s=new RegExp((null===(o=this.configService)||void 0===o?void 0:o.getConfig("depot.url"))+'.*?(?="|$)');if(s.test(t))n=t.match(s)[0],this.http.get(n,{responseType:"blob"}).subscribe(l=>{const c=URL.createObjectURL(l);window.open(c,"_blank"),this.cdRef.detectChanges()},l=>{this.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{let l=t;if(this.isEmbeddedLink(t)){var a=document.createElement("div");a.innerHTML=t,l=a.children[0].getAttribute("href")}window.open(l,"_blank")}}isUrl(t){if("string"==typeof t)return/^https?:\/\//.test(t)}isDoc(t){if("string"==typeof t)return!!this.isUrl(t)&&/(pdf|docx?|xlsx?)$/.test(t.toLowerCase())}isImg(t){if("string"==typeof t)return!!this.isUrl(t)&&/(jpe?g|png|gif)$/.test(t.toLowerCase())}isEmbeddedLink(t){return"string"==typeof t&&1===(t.match(/<a/g)||[]).length}getEmbeddedLinkText(t){let n=t.match(/(?:>).*?(?=<|$)/)[0];return n=n.replace(/>/g,""),n}filterFeatureProperties(t){const o=t.meta?t.meta.alias:void 0,n={};let s;return this.map&&this.map.forcedOffline$.pipe((0,Fo.R)(this.unsubscribe$)).subscribe(a=>{s=a}),t.properties&&t.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete t.properties.Route,o?(Object.keys(o).forEach(a=>{n[o[a]]=t.properties[a]}),n):(void 0!==s&&s?t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(l=>{delete t.properties[l]}):this.state.connection&&t.meta&&t.meta.excludeAttribute?t.meta.excludeAttribute.forEach(l=>{delete t.properties[l]}):!this.state.connection&&t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(l=>{delete t.properties[l]}),t.properties)}copyTextToClipboard(t){Ft.copy(t)&&this.messageService.success("igo.geo.query.link.message")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(q.eN),e.Y36(e.sBO),e.Y36(yt.H7),e.Y36(mn),e.Y36(_e),e.Y36(J))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["mat-list-avatar","",3,"svgIcon"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["svgIcon","content-copy"],["id","keyValue"],[3,"innerHTML"],[3,"ngStyle","click"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(t,o){1&t&&(e.YNc(0,Tb,4,3,"table",0),e.YNc(1,Mb,1,2,"iframe",1)),2&t&&(e.Q6J("ngIf",o.ready&&o.feature&&o.isObject(o.feature.properties)&&"iframe"!==o.feature.properties.target),e.xp6(1),e.Q6J("ngIf",o.isHtmlDisplay()))},dependencies:[f.sg,f.O5,f.PC,T.Hw,Is,f.Ov,f.Ts,L.X$,ci,ur],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}"],changeDetection:0}),i})();var Oe=(()=>{return(i=Oe||(Oe={})).Point="Point",i.LineString="LineString",i.Polygon="Polygon",i.Circle="Circle",Oe;var i})(),ee=(()=>{return(i=ee||(ee={})).Coordinates="Coordinates",i.Length="Length",i.Area="Area",i.Predefined="Predefined",i.Custom="Custom",ee;var i})(),jo=(()=>{return(i=jo||(jo={})).DecimalDegree="DD",i.DegreesMinutesSeconds="DMS",jo;var i})(),yo=(()=>{return(i=yo||(yo={})).Arial="Arial",i.ArialBlack="Arial Black",i.Verdana="Verdana",i.Tahoma="Tahoma",i.TrebuchetMS="Trebuchet MS",i.Impact="Impact",i.TimesNewRoman="Times New Roman",i.Georgia="Georgia",i.AmericanTypewriter="American Typewriter",i.Courier="Courier",i.LucidaConsole="Lucida Console",i.BrushScriptMT="Brush Script MT",i.ComicSansMS="Comic Sans MS",yo;var i})();function gu(i){return new Me.Z({stroke:new U.Z({color:(i=i||[0,153,255]).concat([1]),width:2}),fill:new N.Z({color:i.concat([.2])}),radius:8})}function mu(){return new R.ZP({stroke:new U.Z({color:[0,153,255,1],width:2})})}function Oa(i){const r=i.target;return r instanceof kt.ZP?r.getFlatCoordinates().slice(-4,-2):r.getFlatCoordinates().slice(-2)}Error;class en{constructor(r){this.options=r,this.start$=new Se.x,this.end$=new Se.x,this.changes$=new Se.x,this.modify$=new Se.x,this.select$=new Se.x,this.abort$=new Se.x,this.freehand$=new b.X(!1),this.ispredefinedRadius$=new b.X(!1),this.predefinedRadius$=new b.X(void 0),this.radiusDrawEnd$=new b.X(void 0),this.olDrawingLayer=r.drawingLayer?r.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType,this.olInteractionStyle=this.options.interactionStyle}get radiusVal(){return this.predefinedRadius$.getValue()}set radiusValData(r){this.predefinedRadius$.next(r)}get active(){return void 0!==this.olMap}get olDrawingLayerSource(){return this.olDrawingLayer.getSource()}setOlMap(r,t){if(!r)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),void(this.olMap=r);this.olMap=r,this.addOlInnerOverlayLayer(),this.addOlInteractions(t)}getSource(){return this.olDrawingLayerSource}setOlInteractionStyle(r){this.olInteractionStyle=r}setGeometryType(r){this.olGeometryType=r}getGeometryType(){return this.olGeometryType}createOlInnerOverlayLayer(){return new Jo.Z({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new zt.Z,style:this.options.drawingLayerStyle,zIndex:500})}removeOlInnerOverlayLayer(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}addOlInnerOverlayLayer(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}clearOlInnerOverlaySource(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}addOlInteractions(r){let t;if(t=this.freehand$.getValue()?new In.ZP("Point"===this.olGeometryType?{type:"Circle",source:this.getSource(),style:"function"==typeof this.olInteractionStyle?void 0:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}:{type:this.olGeometryType,source:this.getSource(),style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):this.ispredefinedRadius$.getValue()?new In.ZP({type:"Point",source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}):new In.ZP({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}),this.olMap.addInteraction(t),this.olDrawInteraction=t,this.onDrawStartKey=t.on("drawstart",o=>this.onDrawStart(o)),this.onDrawEndKey=t.on("drawend",o=>this.onDrawEnd(o)),this.onDrawAbortKey=t.on("drawabort",o=>this.abort$.next(o.feature.getGeometry())),r){const o=new ca.Z({source:this.getSource()});if(this.olMap.addInteraction(o),this.olModifyInteraction=o,!this.olSelectInteraction){const n=new na.Z({condition:fc.OK,style:void 0});this.olMap.addInteraction(n),this.olSelectInteraction=n,this.olSelectInteraction.on("select",s=>this.onSelect(s))}}}removeOlInteractions(){this.unsubscribeKeyDown(),(0,et.B)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}onDrawStart(r){const t=r.feature.getGeometry();this.start$.next(t),this.clearOlInnerOverlaySource(),this.onDrawKey=t.on("change",o=>{this.mousePosition=Oa(o),this.changes$.next(o.target)}),this.subscribeKeyDown()}onDrawEnd(r){"Point"===r.feature.getGeometry().getType()&&this.radiusDrawEnd$.next(this.predefinedRadius$.getValue()),this.unsubscribeKeyDown(),(0,et.B)(this.onDrawKey);const t=r.feature.getGeometry();t.on("change",()=>{this.modify$.next(t)}),this.end$.next(t)}onSelect(r){1===r.selected.length&&this.select$.next(r.selected[0])}subscribeKeyDown(){this.unsubscribeKeyDown(),this.keyDown$$=(0,lo.R)(document,"keydown").subscribe(r=>{"Escape"!==r.key?("Backspace"===r.key&&this.olDrawInteraction.removeLastPoint(),"Enter"===r.key&&this.olDrawInteraction.finishDrawing()," "!==r.key||this.olMap.getView().animate({center:this.mousePosition,duration:100})):this.olDrawInteraction.abortDrawing()})}unsubscribeKeyDown(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}}var qt=(()=>{return(i=qt||(qt={})).Length="length",i.Area="area",qt;var i})(),K=(()=>{return(i=K||(K={})).Meters="meters",i.Kilometers="kilometers",i.Miles="miles",i.Feet="feet",K;var i})();const vo={[K.Meters]:"m",[K.Kilometers]:"km",[K.Miles]:"mi",[K.Feet]:"ft"};var Ue=(()=>{return(i=Ue||(Ue={})).SquareMeters="squareMeters",i.SquareKilometers="squareKilometers",i.SquareMiles="squareMiles",i.SquareFeet="squareFeet",i.Hectares="hectares",i.Acres="acres",Ue;var i})();const Yo={[Ue.SquareMeters]:"m\xb2",[Ue.SquareKilometers]:"km\xb2",[Ue.SquareMiles]:"mi\xb2",[Ue.SquareFeet]:"ft\xb2",[Ue.Hectares]:"ha",[Ue.Acres]:"ac"};function Pb(i){return.001*i}function $b(i){return 3.2808*i}function Eb(i){return 621e-6*i}function Jb(i){return 1e-6*i}function Rb(i){return 3.861e-7*i}function Bb(i){return 10.764*i}function Ub(i){return 1e-4*i}function Nb(i){return 24711e-8*i}function Ho(i,r){const o=new Map([[K.Meters,n=>n],[K.Kilometers,Pb],[K.Miles,Eb],[K.Feet,$b]]).get(r);return o?o(i):void 0}function Ci(i,r){const o=new Map([[Ue.SquareMeters,n=>n],[Ue.SquareKilometers,Jb],[Ue.SquareMiles,Rb],[Ue.SquareFeet,Bb],[Ue.Hectares,Ub],[Ue.Acres,Nb]]).get(r);return o?o(i):void 0}function Qn(i,r,t){let o=r.decimal;(void 0===o||o<0)&&(o=1);const n=[];return n.push(void 0!==r.locale?i.toLocaleString(r.locale,{minimumFractionDigits:o,maximumFractionDigits:o}):i.toFixed(o).toString()),void 0!==r.unit&&!0===r.unitAbbr&&n.push(t?t.translate.instant(vo[r.unit]?"igo.geo.measure."+vo[r.unit]:"igo.geo.measure."+Yo[r.unit]):vo[r.unit]||Yo[r.unit]),n.filter(s=>void 0!==s).join(" ")}function Za(){return new R.ZP({stroke:new U.Z({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new N.Z({color:"rgba(255, 255, 255, 0.2)"}),image:new Me.Z({radius:5,stroke:new U.Z({color:"#ffcc33"}),fill:new N.Z({color:"rgba(255, 255, 255, 0.2)"})})})}function tn(i,r){if(!(i instanceof Pe.Z)&&0!==i.getFlatCoordinates().length)return(0,qi.xA)(i,{projection:r})}function jn(i,r){if(!(i instanceof Pe.Z||i instanceof oo.Z)&&0!==i.getFlatCoordinates().length)return(0,qi.bg)(i,{projection:r})}function Da(i,r){const t=tn(i,r),o=jn(i,r),n=[],s=i.getFlatCoordinates(),a=s.length;for(let l=0;l<=a-4;l+=2){const c=new oo.Z([[s[l],s[l+1]],[s[l+2],s[l+3]]]);n.push(tn(c,r))}return{area:o,length:t,lengths:n}}function ka(i){let r;if(i instanceof Pe.Z){const t=new Pe.Z(i.getFlatCoordinates());r=new Array(1),r[0]=t}else{r=hu(i);const t=i.getFlatCoordinates(),o=r.length;for(let n=0;n<o;n++){const s=2*n,l=new oo.Z([[t[s],t[s+1]],[t[s+2],t[s+3]]]).getCoordinateAt(.5),c=r[n];void 0!==c?c.setCoordinates(l):r[n]=new Pe.Z(l)}}return r}function hu(i){let r;r=i instanceof Ro.Z?0:Math.max(i.getFlatCoordinates().length/2-1,0);let t=i.get("_midpoints");if(void 0===t)return t=new Array(i instanceof Pe.Z?1:r),i.set("_midpoints",t,!0),t;if(0===r||r===t.length)return t;if(r>t.length)return t.push(...new Array(r-t.length)),t;for(let o=r;o<t.length;o++){const n=t[r];void 0!==n&&fu(n)}return t.splice(r),t}function fu(i){const r=i.get("_tooltip");if(void 0!==r){const t=r.getMap();void 0!==t&&t.removeOverlay(r)}}function qr(i){const r=[].concat(function Yb(i){return hu(i).map(t=>t?t.get("_tooltip"):void 0)}(i)||[]),t=function Vb(i){const r=i.get("_center");return r?r.get("_tooltip"):void 0}(i);return void 0!==t&&r.push(t),r}function yu(i,r=!1,t=""){const o=new _c.Z({element:document.createElement("div"),offset:[-30,-10],className:(r?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure",`igo-map-tooltip-measure-${t}segments`]).join(" "),stopEvent:!1});return o.setPosition(i.getFlatCoordinates()),i.set("_tooltip",o),o}function Pa(i,r,t,o){return new R.ZP({stroke:new U.Z({color:r||"rgba(143,7,7,1)",width:t||1}),fill:new N.Z({color:i||"rgba(255,255,255,0.4)"}),image:new Me.Z({radius:5,stroke:new U.Z({color:r||"rgba(143,7,7,1)",width:t||1}),fill:new N.Z({color:i||"rgba(255,255,255,0.4)"})})})}function bu(i,r){let o=new Map([[jo.DecimalDegree,n=>xc("number"==typeof n[0]?n:[Number(n[0]),Number(n[1])],5)],[jo.DegreesMinutesSeconds,n=>Cc(n,2)]]).get(r);return o?o(i):void 0}function zb(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-radio-button",11),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onLabelTypeChange(n.value))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t.value)("disabled",o.optionAvailable(t.value))("checked",t.checked),e.xp6(1),e.hij(" ",o.getProperLengthLabel(t.value)," ")}}function Wb(i,r){if(1&i&&(e.TgZ(0,"mat-radio-group",5),e.YNc(1,zb,2,4,"mat-radio-button",10),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.arrayBuiltInType)}}function Kb(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",13),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onLabelTypeChange(n.source.value,n.checked))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t.value)("disabled",o.optionAvailable(t.value))("checked",t.checked),e.xp6(1),e.hij(" ",o.getProperLengthLabel(t.value)," ")}}function Xb(i,r){if(1&i&&(e.ynx(0,5),e.YNc(1,Kb,2,4,"mat-checkbox",12),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.arrayBuiltInType)}}function e1(i,r){if(1&i&&(e.TgZ(0,"mat-option",3),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function t1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-form-field",14),e._UZ(2,"input",15,16),e.qZA(),e.TgZ(4,"mat-form-field",17)(5,"mat-select",18),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onChangeCoordinateUnit(n.value))}),e.YNc(6,e1,2,2,"mat-option",19),e.qZA()()()}if(2&i){const t=e.oxw(2);e.xp6(2),e.s9C("value",t.currentCoordinates),e.xp6(3),e.Q6J("value",t.coordinatesMeasureUnit),e.xp6(1),e.Q6J("ngForOf",t.allCoordinatesUnits)}}function o1(i,r){if(1&i&&(e.TgZ(0,"mat-option",3),e._uU(1),e.qZA()),2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t),e.xp6(1),e.hij(" ",o.getLengthUnitEnum(t)," ")}}function i1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-form-field",14),e._UZ(2,"input",20,16),e.qZA(),e.TgZ(4,"mat-form-field",17)(5,"mat-select",18),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onChangeLengthUnit(n.value))}),e.YNc(6,o1,2,2,"mat-option",19),e.qZA()()()}if(2&i){const t=e.oxw(2);e.xp6(2),e.s9C("placeholder",t.lengthLabelT),e.s9C("value",t.currentLength),e.xp6(3),e.Q6J("value",t.lengthMeasureUnit),e.xp6(1),e.Q6J("ngForOf",t.allLengthUnits)}}function n1(i,r){if(1&i&&(e.TgZ(0,"mat-option",3),e._uU(1),e.qZA()),2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t),e.xp6(1),e.hij(" ",o.getAreaUnitEnum(t)," ")}}function r1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-form-field",14),e._UZ(2,"input",20,16),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-form-field",17)(6,"mat-select",18),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onChangeAreaUnit(n.value))}),e.YNc(7,n1,2,2,"mat-option",19),e.qZA()()()}if(2&i){const t=e.oxw(2);e.xp6(2),e.s9C("placeholder",e.lcZ(4,4,"igo.geo.draw.labelType.Area")),e.s9C("value",t.currentArea),e.xp6(4),e.Q6J("value",t.areaMeasureUnit),e.xp6(1),e.Q6J("ngForOf",t.allAreaUnits)}}function s1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"div")(2,"p",5),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.YNc(5,Wb,2,1,"mat-radio-group",6),e.YNc(6,Xb,2,1,"ng-container",6),e.YNc(7,t1,7,3,"div",4),e.YNc(8,i1,7,4,"div",4),e.YNc(9,r1,8,6,"div",4),e.qZA(),e.TgZ(10,"div",7)(11,"button",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancelDrawing())}),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"button",9),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirm())}),e._uU(15),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,8,"igo.geo.draw.builtInInstructions")),e.xp6(2),e.Q6J("ngIf","Polygon"!==t.olGeometryType),e.xp6(1),e.Q6J("ngIf","Polygon"===t.olGeometryType),e.xp6(1),e.Q6J("ngIf",t.labelFlag===t.labelType.Coordinates),e.xp6(1),e.Q6J("ngIf",t.labelFlag===t.labelType.Length||2===t.polygonCheck),e.xp6(1),e.Q6J("ngIf",t.labelFlag===t.labelType.Area||2===t.polygonCheck),e.xp6(3),e.hij(" ",e.lcZ(13,10,"igo.geo.draw.cancel")," "),e.xp6(3),e.hij(" ",t.noLabelButton()," ")}}function a1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"div")(2,"p",5),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-form-field",21)(6,"input",22,16),e.NdJ("select",function(){return!0})("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.getLabelLength(n.target.value))}),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"div",7)(10,"button",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancelDrawing())}),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"button",9),e.NdJ("click",function(){e.CHM(t);const n=e.MAs(7),s=e.oxw();return e.KtG(s.confirm(n.value))}),e._uU(14),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,5,"igo.geo.draw.dialogInstruction")),e.xp6(3),e.s9C("placeholder",e.lcZ(8,7,"igo.geo.draw.dialogTitle")),e.s9C("value",t.currentLabel),e.xp6(5),e.hij(" ",e.lcZ(12,9,"igo.geo.draw.cancel")," "),e.xp6(3),e.hij(" ",t.noLabelButton()," ")}}let l1=(()=>{class i{constructor(t,o,n){var s;let a;this.languageService=t,this.dialogRef=o,this.data=n,this.confirmFlag=!1,this.labelFlag=ee.Custom,this.geometryType=Oe,this.labelType=ee,this.arrayBuiltInType=[],this.olGeometryType=void 0,this.polygonCheck=0,this.currentLabel=this.data.olGeometry.get("draw"),this.labelLength=this.currentLabel?this.currentLabel.length:0;const l=this.data.map.ol.getView().getProjection();if(this.data.olGeometry instanceof De.Z)if(this.data.olGeometry.get("rad")){const c=[this.data.olGeometry.get("longitude"),this.data.olGeometry.get("latitude")];this.olGeometryType=Oe.Circle,a=new Ro.Z(c,this.data.olGeometry.get("rad"))}else this.olGeometryType=this.data.olGeometry.getGeometry().getType(),a=this.data.olGeometry.get("geometry");else this.olGeometryType=this.data.olGeometry.getType(),a=this.data.olGeometry;if(this.olGeometryType===Oe.Point||this.olGeometryType===Oe.Circle){if(this.data.olGeometry instanceof De.Z){let c=this.data.olGeometry.get("longitude"),u=this.data.olGeometry.get("latitude");this.longlatDD=ft([c,u],5),this.coordinatesInDD="("+u+", "+c+")"}else{let c=(0,V.vs)(this.data.olGeometry.getFlatCoordinates(),l,"EPSG:4326");this.longlatDD=ft([c[0],c[1]],5),this.coordinatesInDD="("+this.longlatDD[1]+", "+this.longlatDD[0]+")"}this.currentCoordinates=this.coordinatesInDD}if(this.olGeometryType===Oe.LineString)this.lengthInMeters=tn(a,l.getCode()).toFixed(2),this.currentLength=this.lengthInMeters;else if(this.olGeometryType===Oe.Polygon)this.lengthInMeters=tn(a,l.getCode()).toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=jn(a,l.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare;else if(this.olGeometryType===Oe.Circle){let c=(0,kt.Bb)(a,1e4);const u=this.getRadius(c);this.lengthInMeters=u.toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=jn(c,l.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare}n.olGeometry.get("labelType")===ee.Coordinates?(this.onLabelTypeChange(ee.Predefined),this.onLabelTypeChange(ee.Coordinates,!0),this.coordinatesMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===ee.Length?(this.onLabelTypeChange(ee.Predefined),this.onLabelTypeChange(ee.Length,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===ee.Area?(this.onLabelTypeChange(ee.Predefined),this.onLabelTypeChange(ee.Area,!0),this.areaMeasureUnit=n.olGeometry.get("measureUnit")):2===(null===(s=n.olGeometry.get("labelType"))||void 0===s?void 0:s.length)&&(this.onLabelTypeChange(ee.Predefined),this.onLabelTypeChange(ee.Length,!0),this.onLabelTypeChange(ee.Area,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")[0],this.areaMeasureUnit=n.olGeometry.get("measureUnit")[1]),this.buildArrayType()}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.labelFlag===ee.Predefined?this.dialogRef.close():this.labelFlag===ee.Custom?this.dialogRef.close({label:t}):this.labelFlag===ee.Coordinates?this.dialogRef.close({label:this.currentCoordinates,measureUnit:this.coordinatesMeasureUnit}):this.olGeometryType===Oe.Polygon?2===this.polygonCheck?(this.labelFlag=[ee.Length,ee.Area],this.dialogRef.close({label:"P: "+this.currentLength+" "+vo[K.Meters]+"\n"+this.languageService.translate.instant("igo.geo.draw.labelType.A")+this.currentArea+" "+Yo[Ue.SquareMeters],measureUnit:[this.lengthMeasureUnit,this.areaMeasureUnit]})):this.dialogRef.close(this.labelFlag===ee.Length?{label:"P: "+this.currentLength+" "+vo[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}:{label:this.currentArea+" "+Yo[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit}):this.labelFlag===ee.Length?this.olGeometryType===Oe.Circle?this.dialogRef.close({label:"R: "+this.currentLength+" "+vo[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.olGeometryType===Oe.LineString&&this.dialogRef.close({label:this.currentLength+" "+vo[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.labelFlag===ee.Area&&this.dialogRef.close({label:this.currentArea+" "+Yo[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit})}onLabelTypeChange(t,o){var n;t!==ee.Predefined&&t!==ee.Custom&&this.olGeometryType===Oe.Polygon?(this.arrayBuiltInType.find(a=>a.value===t)?this.arrayBuiltInType.find(a=>a.value===t).checked=o:this.labelFlag=void 0,this.labelFlag=o?t:null===(n=this.arrayBuiltInType.find(a=>a.checked))||void 0===n?void 0:n.value):this.labelFlag=t,t===ee.Predefined?this.olGeometryType===Oe.Point?(this.labelFlag=ee.Coordinates,this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=jo.DecimalDegree):this.olGeometryType===Oe.LineString&&(this.labelFlag=ee.Length,this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=K.Meters):t===ee.Area?(this.currentArea=this.areaInMetersSquare,this.areaMeasureUnit=Ue.SquareMeters):t===ee.Length?(this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=K.Meters):this.labelFlag===ee.Coordinates&&(this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=jo.DecimalDegree),this.olGeometryType===Oe.Polygon&&[this.labelType.Length,this.labelType.Area].includes(t)?o?this.polygonCheck+=1:this.polygonCheck-=1:this.polygonCheck=0}onChangeLengthUnit(t){this.lengthMeasureUnit=t,this.currentLength=Ho(Number(this.lengthInMeters),t).toFixed(2)}onChangeAreaUnit(t){this.areaMeasureUnit=t,this.currentArea=Ci(Number(this.areaInMetersSquare),t).toFixed(2)}onChangeCoordinateUnit(t){this.coordinatesMeasureUnit=t;let o=bu(this.longlatDD,t);this.currentCoordinates="("+o[1]+", "+o[0]+")"}buildArrayType(){for(const t of Object.values(ee))t!==ee.Custom&&t!==ee.Predefined&&this.arrayBuiltInType.push({value:t,checked:this.selectOptions(t)||this.labelFlag===t||2===this.polygonCheck&&t!==ee.Coordinates})}noLabelButton(){return this.labelFlag===ee.Predefined||this.labelFlag===ee.Custom&&0===this.labelLength?this.languageService.translate.instant("igo.geo.draw.noLabel"):"OK"}get customOrPredefined(){return this.labelFlag===ee.Custom?ee.Custom:ee.Predefined}optionAvailable(t){switch(this.olGeometryType){case Oe.Point:return t!==ee.Coordinates;case Oe.LineString:return t!==ee.Length;case Oe.Polygon:return t===ee.Coordinates;default:return!1}}get allLengthUnits(){return Object.values(K)}getLengthUnitEnum(t){return vo[t]}get allAreaUnits(){return Object.values(Ue)}get allCoordinatesUnits(){return Object.values(jo)}getAreaUnitEnum(t){return Yo[t]}getRadius(t){const o=(0,qi.xA)(t);return Number(o/(2*Math.PI))}get lengthLabelT(){return this.languageService.translate.instant(this.olGeometryType===Oe.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===Oe.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length")}getLabelLength(t){this.labelLength=t.length}selectOptions(t){return this.olGeometryType===Oe.Point?t===ee.Coordinates:this.olGeometryType===Oe.LineString?t===ee.Length:void 0}getProperLengthLabel(t){return this.languageService.translate.instant(t===ee.Length?this.olGeometryType===Oe.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===Oe.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length":"igo.geo.draw.labelType."+t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(P.so),e.Y36(P.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag",labelFlag:"labelFlag",coordinatesMeasureUnit:"coordinatesMeasureUnit",lengthMeasureUnit:"lengthMeasureUnit",areaMeasureUnit:"areaMeasureUnit"},decls:14,vars:14,consts:[["mat-dialog-title",""],[1,"geometry-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[4,"ngIf"],[1,"mat-typography"],["class","mat-typography",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[3,"value","disabled","checked","change"],["class","mat-typography",3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","disabled","checked","change"],[1,"readOnly-Input"],["matInput","","placeholder","(Latitude, Longitude)","readonly","",3,"value"],["input",""],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"placeholder","value"],[1,"input"],["matInput","","cdkFocusInitial","",3,"placeholder","value","select","input"]],template:function(t,o){1&t&&(e.TgZ(0,"div")(1,"h2",0),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",1)(5,"mat-button-toggle-group",2),e.NdJ("change",function(s){return o.onLabelTypeChange(s.value)}),e.TgZ(6,"mat-button-toggle",3),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-button-toggle",3),e._uU(10),e.ALo(11,"translate"),e.qZA()()(),e.YNc(12,s1,16,12,"div",4),e.YNc(13,a1,15,11,"div",4)),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,8,"igo.geo.draw.popupTitle")," "),e.xp6(3),e.Q6J("value",o.customOrPredefined),e.xp6(1),e.Q6J("value",o.labelType.Custom),e.xp6(1),e.hij(" ",e.lcZ(8,10,"igo.geo.draw.labelType.custom")," "),e.xp6(2),e.Q6J("value",o.labelType.Predefined),e.xp6(1),e.hij(" ",e.lcZ(11,12,"igo.geo.draw.labelType.predefined")," "),e.xp6(2),e.Q6J("ngIf",o.labelFlag!==o.labelType.Custom),e.xp6(1),e.Q6J("ngIf",o.labelFlag===o.labelType.Custom))},dependencies:[f.sg,f.O5,w.lW,Re.A9,Re.Yi,I.KE,H.Nt,ue.gD,Q.ey,P.uh,P.H8,nt.VQ,nt.U0,Ge.oG,L.X$],styles:[".mat-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:16px}.readOnly-Input[_ngcontent-%COMP%]{width:200px!important}.unit-field[_ngcontent-%COMP%]{width:50px;margin-left:10px;margin-top:10px}.mat-form-field[_ngcontent-%COMP%]{position:sticky!important}.coordinatesInputView[_ngcontent-%COMP%]{top:5em!important}  .mat-form-field-wrapper{margin-bottom:-1.25em;margin-top:.25em}.geometry-type-toggle[_ngcontent-%COMP%], .mat-dialog-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:center}.input[_ngcontent-%COMP%]{width:auto!important}.mat-button-toggle-group[_ngcontent-%COMP%], .mat-button-toggle[_ngcontent-%COMP%]{width:100%}mat-checkbox[_ngcontent-%COMP%]{margin-right:10px}"]}),i})(),c1=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw-shorcuts"]],decls:24,vars:12,consts:[[1,"shortcut","mat-typography"],["svgIcon","keyboard-return",1,"shortcut-icon"],["svgIcon","backspace-outline",1,"shortcut-icon"],["svgIcon","keyboard-esc",1,"shortcut-icon"],["svgIcon","keyboard-space",1,"shortcut-icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-dialog-content")(1,"div")(2,"span",0),e._UZ(3,"mat-icon",1),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"div")(7,"span",0),e._UZ(8,"mat-icon",2),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.TgZ(11,"div")(12,"span",0),e._UZ(13,"mat-icon",3),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e.TgZ(16,"div")(17,"span",0),e._UZ(18,"mat-icon",4),e._uU(19),e.ALo(20,"translate"),e.qZA()()(),e.TgZ(21,"mat-dialog-actions",5)(22,"button",6),e._uU(23,"OK"),e.qZA()()),2&t&&(e.xp6(4),e.Oqu(e.lcZ(5,4,"igo.geo.draw.finish")),e.xp6(5),e.Oqu(e.lcZ(10,6,"igo.geo.draw.undo")),e.xp6(5),e.Oqu(e.lcZ(15,8,"igo.geo.draw.abort")),e.xp6(5),e.Oqu(e.lcZ(20,10,"igo.geo.draw.move")))},dependencies:[w.lW,T.Hw,P.ZT,P.xY,P.H8,L.X$],styles:[".shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}"]}),i})(),$a=(()=>{class i{constructor(){this.fillColor="rgba(255,255,255,0.4)",this.strokeColor="rgba(143,7,7,1)",this.strokeWidth=1,this.labelsAreShown=!0,this.fontSize="15",this.fontStyle=yo.Arial.toString(),this.offsetX=0,this.offsetY=0}getFillColor(){return this.fillColor}setFillColor(t){this.fillColor=t}getStrokeColor(){return this.strokeColor}setStrokeColor(t){this.strokeColor=t}getStrokeWidth(){return this.strokeWidth}getLabelsAreShown(){return this.labelsAreShown}toggleLabelsAreShown(){this.labelsAreShown=!this.labelsAreShown}setIcon(t){this.icon=t}getIcon(){return this.icon}getFontSize(){return this.fontSize}setFontSize(t){this.fontSize=t}getFontStyle(){return this.fontStyle}setFontStyle(t){this.fontStyle=t}getOffsetX(){return this.offsetX}setOffsetX(t){this.offsetX=t}getOffsetY(){return this.offsetY}setOffsetY(t){this.offsetY=t}createIndividualElementStyle(t,o,n,s,a,l,c,u,p,d){let g,h=!1;if(t.getGeometry()instanceof Pe.Z&&(h=!h),t.get("rad")){const y=(0,V.vs)(t.getGeometry().flatCoordinates,p,"EPSG:4326");return g=new R.ZP({text:new St.Z({text:n?t.get("draw"):"",stroke:new U.Z({color:"white",width:.75}),fill:new N.Z({color:"black"}),font:s,overflow:!0,offsetX:c,offsetY:u}),image:new Me.Z({radius:t.get("rad")/Math.cos(Math.PI/180*y[1])/o,stroke:new U.Z({color:l||this.strokeColor,width:this.strokeWidth}),fill:new N.Z({color:a})})}),g}return d?(this.offsetY=-26,g=new R.ZP({text:new St.Z({text:n?t.get("draw"):"",stroke:new U.Z({color:"white",width:.75}),fill:new N.Z({color:"black"}),font:s,overflow:!0,offsetX:c,offsetY:u}),stroke:new U.Z({color:l,width:this.strokeWidth}),fill:new N.Z({color:a}),image:new di.Z({src:d})}),g):(this.offsetY=h?-15:0,g=new R.ZP({text:new St.Z({text:n?t.get("draw"):"",stroke:new U.Z({color:"white",width:.75}),fill:new N.Z({color:"black"}),font:s,overflow:!0,offsetX:c,offsetY:u}),stroke:new U.Z({color:l,width:this.strokeWidth}),fill:new N.Z({color:a}),image:new Me.Z({radius:5,stroke:new U.Z({color:l,width:this.strokeWidth}),fill:new N.Z({color:a})})}),g)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function u1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",24)(1,"span"),e._UZ(2,"mat-icon",25),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-form-field",26),e.ALo(6,"translate"),e.TgZ(7,"mat-label"),e._uU(8),e.qZA(),e.TgZ(9,"input",27,28),e.NdJ("colorPickerChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.styleModalData.fillColor=n)}),e.ALo(11,"translate"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,14,"igo.geo.style.fill")," "),e.xp6(2),e.Q6J("matTooltip",e.lcZ(6,16,"igo.geo.style.colorPicker")),e.xp6(3),e.Oqu(t.getFeatureFillColor()),e.xp6(1),e.Udp("background",t.getFeatureFillColor()),e.Q6J("readonly",!0)("colorPicker",t.getFeatureFillColor())("cpWidth","200px")("cpOutputFormat","rgba")("cpPosition","bottom")("cpPositionOffset","-75%")("cpCancelButton",!0)("cpCancelButtonText",e.lcZ(11,18,"igo.geo.style.cancel"))("cpOKButton",!0)}}function p1(i,r){if(1&i&&(e.TgZ(0,"mat-option",29),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}let d1=(()=>{class i{constructor(t,o,n,s){this.dialogRef=t,this.formBuilder=o,this.drawStyleService=n,this.data=s,this.confirmFlag=!1,this.buildForm()}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.features)"LineString"!==t.geometry.type&&(this.linestringOnly=!1);this.buildStyleData()}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}buildStyleData(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):yo.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}get allFontStyles(){return Object.values(yo)}getFeatureFontSize(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}getFeatureFontStyle(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):yo.Arial}getFeatureFillColor(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}cancelDrawing(){this.dialogRef.close()}confirm(){this.confirmFlag=!0,this.dialogRef.close(this.styleModalData)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.so),e.Y36(_.QS),e.Y36($a),e.Y36(P.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-style-modal-drawing"]],inputs:{confirmFlag:"confirmFlag"},decls:54,vars:46,consts:[["mat-dialog-content",""],["mat-dialog-title","",1,"mat-typography"],[1,"edition-drawing","mat-typography",3,"hidden"],[1,"igo-form",3,"formGroup"],["class","fill-color-picker mat-typography",4,"ngIf"],[1,"stroke-color-picker","mat-typography"],["svgIcon","square-outline",1,"stroke-palette-icon"],["appearance","outline","floatLabel","always","tooltip-position","below","matTooltipShowDelay","500",1,"stroke-field",3,"matTooltip"],["formControlName","stroke","matInput","","type","text",3,"readonly","colorPicker","cpWidth","cpPosition","cpPositionOffset","cpOutputFormat","cpCancelButton","cpCancelButtonText","cpOKButton","colorPickerChange"],["strokeColorInput",""],[1,"igo-input-container"],["appearance","outline",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"value","input"],["testFontSize",""],["matSuffix",""],[3,"value","selectionChange"],["testFontStyle",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"value","input"],["offsetXInput",""],["offsetYInput",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"fill-color-picker","mat-typography"],["svgIcon","square",1,"stroke-palette-icon"],["appearance","outline","floatLabel","always","tooltip-position","below","matTooltipShowDelay","500",1,"fill-field",3,"matTooltip"],["formControlName","fill","matInput","","type","text",3,"readonly","colorPicker","cpWidth","cpOutputFormat","cpPosition","cpPositionOffset","cpCancelButton","cpCancelButtonText","cpOKButton","colorPickerChange"],["fillColorInput",""],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2)(5,"form",3),e.YNc(6,u1,12,20,"div",4),e.TgZ(7,"div",5)(8,"span"),e._UZ(9,"mat-icon",6),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-form-field",7),e.ALo(13,"translate"),e.TgZ(14,"mat-label"),e._uU(15),e.qZA(),e.TgZ(16,"input",8,9),e.NdJ("colorPickerChange",function(s){return o.styleModalData.strokeColor=s}),e.ALo(18,"translate"),e.qZA()()(),e.TgZ(19,"div",10)(20,"mat-form-field",11)(21,"mat-label"),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"input",12,13),e.NdJ("input",function(s){return o.styleModalData.fontSize=s.target.value}),e.qZA(),e.TgZ(26,"span",14),e._uU(27,"px"),e.qZA()(),e.TgZ(28,"mat-form-field",11)(29,"mat-label"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"mat-select",15,16),e.NdJ("selectionChange",function(s){return o.styleModalData.fontStyle=s.value}),e.YNc(34,p1,2,2,"mat-option",17),e.qZA()()(),e.TgZ(35,"div",10)(36,"mat-form-field",11)(37,"mat-label"),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.TgZ(40,"input",18,19),e.NdJ("input",function(s){return o.styleModalData.offsetX=s.target.value}),e.qZA()(),e.TgZ(42,"mat-form-field",11)(43,"mat-label"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"input",18,20),e.NdJ("input",function(s){return o.styleModalData.offsetY=s.target.value}),e.qZA()()()()()(),e.TgZ(48,"div",21)(49,"button",22),e.NdJ("click",function(){return o.cancelDrawing()}),e._uU(50),e.ALo(51,"translate"),e.qZA(),e.TgZ(52,"button",23),e.NdJ("click",function(){return o.confirm()}),e._uU(53,"OK "),e.qZA()()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,28,"igo.geo.style.styleModal")),e.xp6(2),e.Q6J("hidden",0===o.data.features.length),e.xp6(1),e.Q6J("formGroup",o.form),e.xp6(1),e.Q6J("ngIf",!0!==o.linestringOnly),e.xp6(4),e.hij(" ",e.lcZ(11,30,"igo.geo.style.stroke")," "),e.xp6(2),e.Q6J("matTooltip",e.lcZ(13,32,"igo.geo.style.colorPicker")),e.xp6(3),e.Oqu(o.getFeatureStrokeColor()),e.xp6(1),e.Udp("background",o.getFeatureStrokeColor()),e.Q6J("readonly",!0)("colorPicker",o.getFeatureStrokeColor())("cpWidth","200px")("cpPosition","bottom")("cpPositionOffset","-75%")("cpOutputFormat","rgba")("cpCancelButton",!0)("cpCancelButtonText",e.lcZ(18,34,"igo.geo.style.cancel"))("cpOKButton",!0),e.xp6(6),e.Oqu(e.lcZ(23,36,"igo.geo.style.fontSize")),e.xp6(2),e.Q6J("value",o.getFeatureFontSize()),e.xp6(6),e.Oqu(e.lcZ(31,38,"igo.geo.style.fontStyle")),e.xp6(2),e.Q6J("value",o.getFeatureFontStyle()),e.xp6(2),e.Q6J("ngForOf",o.allFontStyles),e.xp6(4),e.Oqu(e.lcZ(39,40,"igo.geo.style.offsetX")),e.xp6(2),e.Q6J("value",o.getFeatureOffsetX()),e.xp6(4),e.Oqu(e.lcZ(45,42,"igo.geo.style.offsetY")),e.xp6(2),e.Q6J("value",o.getFeatureOffsetY()),e.xp6(4),e.hij("",e.lcZ(51,44,"igo.geo.style.cancel")," "))},dependencies:[Ln.Kk,f.sg,f.O5,_._Y,_.Fj,_.JJ,_.JL,I.KE,I.hX,I.R9,T.Hw,w.lW,H.Nt,ue.gD,Q.ey,O.gM,_.sg,_.u,L.X$],styles:["h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.fill-field[_ngcontent-%COMP%], .stroke-field[_ngcontent-%COMP%]{width:130px}.fill-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.fill-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:8px}.stroke-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.stroke-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:35px}.box[_ngcontent-%COMP%]{width:25px;height:25px}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}.igo-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.igo-form-input-box[_ngcontent-%COMP%]{width:150px}button[_ngcontent-%COMP%]{margin-right:5px}"]}),i})(),g1=(()=>{class i{constructor(t){this.dialogRef=t,this.confirmFlag=!1}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.dialogRef.close(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},decls:14,vars:9,consts:[["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["input",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-form-field",2),e._UZ(5,"input",3,4),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"div",5)(9,"button",6),e.NdJ("click",function(){return o.cancelDrawing()}),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"button",7),e.NdJ("click",function(){e.CHM(n);const a=e.MAs(6);return e.KtG(o.confirm(a.value))}),e._uU(13," OK "),e.qZA()()}2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),e.xp6(3),e.s9C("placeholder",e.lcZ(7,5,"igo.geo.draw.layer.title")),e.xp6(5),e.hij(" ",e.lcZ(11,7,"igo.geo.draw.cancel")," "))},dependencies:[w.lW,I.KE,H.Nt,P.xY,P.H8,L.X$]}),i})(),m1=(()=>{class i{constructor(t){this.config=t,this.getIconsList()}getIcons(){return this.icons}getPath(){return this.config.getConfig("drawingTool.icons")||[]}getIconsList(){this.icons=this.getPath()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const h1=["selectedLayer"];function f1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",5),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleFreehandMode(n))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("checked",t.freehandMode)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.draw.freehandMode")," ")}}function _1(i,r){if(1&i&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}function y1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",22)(1,"form",23)(2,"mat-form-field",24),e._UZ(3,"input",25),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"mat-form-field",26)(6,"mat-select",9),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onMeasureUnitChange(n.value))}),e.YNc(7,_1,3,4,"mat-option",11),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,5,"igo.geo.spatialFilter.radius")),e.Q6J("formControl",t.radiusFormControl)("readonly",t.freehandMode),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function v1(i,r){if(1&i&&(e.TgZ(0,"mat-option",2),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.title," ")}}function b1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.activeDrawingLayer.visible=!n.activeDrawingLayer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",28),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("color",t.activeDrawingLayer.visible?"primary":"default")("matTooltip",t.activeDrawingLayer.visible?e.lcZ(1,3,"igo.geo.layer.hideLayer"):e.lcZ(2,5,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("svgIcon",t.activeDrawingLayer.visible?"eye":"eye-off")}}function C1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.deleteDrawings())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",30),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.draw.delete"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}function x1(i,r){if(1&i&&(e.TgZ(0,"div",34),e._UZ(1,"img",35),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.s9C("src",t.icon,e.LSH)}}function S1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",36),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onIconChange(s))}),e.TgZ(1,"div",34),e._UZ(2,"img",35),e.qZA()()}if(2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(2),e.s9C("src",t,e.LSH)}}function w1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select")(5,"mat-select-trigger"),e.YNc(6,x1,2,1,"div",31),e.qZA(),e.TgZ(7,"mat-option",32),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onIconChange())}),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.YNc(10,S1,3,2,"mat-option",33),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.draw.icon")),e.xp6(4),e.Q6J("ngIf",t.icon),e.xp6(2),e.Oqu(e.lcZ(9,6,"igo.geo.draw.noIcon")),e.xp6(2),e.Q6J("ngForOf",t.icons)}}function T1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",37),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.openStyleModalDialog())}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e._UZ(4,"mat-icon",38),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.style.styleModalTooltipSelected")),e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.geo.style.styleModal")," "),e.xp6(2),e.Q6J("matBadge",t.selectedFeatures$.value.length)}}let Cu=(()=>{class i{constructor(t,o,n,s,a){this.languageService=t,this.formBuilder=o,this.drawStyleService=n,this.dialog=s,this.drawIconService=a,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),valueAccessor:l=>l.properties.draw},{name:"Edition",title:"",sort:!1,valueAccessor:l=>[{editMode:!1,icon:"pencil",color:"primary",click:()=>{this.editLabelDrawing(l)},style:"mat-icon-button"}],renderer:je.ButtonGroup}]},this.geometryType=Oe,this._stores=[],this._drawControls=[],this.activeLayerChange=new e.vpe,this.drawControlsEvent=new e.vpe,this.layersIDEvent=new e.vpe,this.layerCounterID=0,this.draw$=new b.X({}),this.activeDrawingLayerSource=new zt.Z,this.selectedFeatures$=new b.X([]),this.drawControlIsDisabled=!0,this.drawControlIsActive=!1,this.freehandMode=!1,this.subscriptions$$=[],this.position="bottom",this.radiusFormControl=new _.p4(1e3),this.measureUnit=K.Meters,this.radiusFormControlChange$$=new Yf.w0,this.predefinedRadius$=new b.X(void 0),this.radiusDrawEnd$=new b.X(void 0),this.isCreatingNewLayer=!1,this.currGeometryType=this.geometryType.Point,this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}get stores(){return this._stores}set stores(t){this._stores=t}get drawControls(){return this._drawControls}set drawControls(t){this._drawControls=t}get activeDrawingLayer(){return this._activeDrawingLayer}set activeDrawingLayer(t){this._activeDrawingLayer=t}get measureUnits(){return[K.Meters,K.Kilometers]}ngOnInit(){this.stores.length?(this.activeStore=this.stores.find(t=>t.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(t=>t[0]===this.activeDrawingLayer.id)[1],this.deactivateDrawControl(),this.allLayers.forEach(t=>{t.id!==this.activeDrawingLayer.id&&(t.opacity=0);let o=this.stores.find(n=>n.layer.id===t.id);this.subscriptions$$.push(o.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,Gt.P)()).subscribe(n=>{n.forEach(s=>{s.state.selected=!1})})),this.subscriptions$$.push(o.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,ni.T)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(s=>s.entity))})),this.subscriptions$$.push(o.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new Ct([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer)),this.radiusFormControlChange$$=this.radiusFormControl.valueChanges.subscribe(t=>{this.activeDrawControl.ispredefinedRadius$.getValue()&&this.changeRadius(t)})}ngOnDestroy(){this.allLayers.forEach(t=>t.opacity=1),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(t=>t.unsubscribe()),this.radiusFormControlChange$$.unsubscribe()}createDrawControl(t,o,n){return new en({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new R.ZP({}),interactionStyle:Pa(t,o,n)})}initStore(t,o){this.createLayer(t,o),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,ni.T)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(s=>s.entity))})),this.subscriptions$$.push(this.activeStore.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}openStyleModalDialog(){setTimeout(()=>{const t=this.dialog.open(d1,{disableClose:!1,data:{features:this.selectedFeatures$.getValue(),icons:this.icons,icon:this.icon},autoFocus:!1});t.afterClosed().subscribe(o=>{t.componentInstance.confirmFlag&&(this.onFontChange(this.labelsAreShown,o.fontSize,o.fontStyle),this.onColorChange(this.labelsAreShown,!!this.icon,o.fillColor,o.strokeColor),this.onOffsetLabelChange(this.labelsAreShown,o.offsetX,o.offsetY))})},250)}openDrawDialog(t,o){setTimeout(()=>{const n=this.dialog.open(l1,{disableClose:!1,data:{olGeometry:t,map:this.map}});n.afterClosed().subscribe(s=>{n.componentInstance.confirmFlag?(this.updateLabelOfOlGeometry(t,s.label),this.updateLabelType(t,n.componentInstance.labelFlag),this.updateMeasureUnit(t,s.measureUnit),t instanceof De.Z||(this.updateFontSizeAndStyle(t,"15",yo.Arial),this.updateFillAndStrokeColor(t,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),this.updateOffset(t,0,t instanceof Pe.Z?-15:0)),o?this.onDrawEnd(t):this.onSelectDraw(t,s.label,[n.componentInstance.labelFlag,s.measureUnit]),this.updateHeightTable()):this.activeDrawingLayerSource.getFeatures().forEach(a=>{const l=a.getGeometry();t===l&&this.activeDrawingLayerSource.removeFeature(a)})})},250)}onDrawEnd(t,o){this.addFeatureToStore(t,o),this.clearLabelsOfOlGeometry(t),this.activeStore.layer.ol.getSource().refresh()}onModifyDraw(t){this.activeStore.all().forEach(n=>{if(n.properties.id===t.ol_uid){if(n.properties.labelType===ee.Coordinates){let l=bu([n.properties.longitude,n.properties.latitude],n.properties.measureUnit);this.updateLabelOfOlGeometry(t,"("+l[1]+", "+l[0]+")")}else if(n.properties.labelType===ee.Length)if(t instanceof Ro.Z){let l=(0,kt.Bb)(t,1e4);const c=Ho(this.getRadius(l),n.properties.measureUnit),u=vo[n.properties.measureUnit],p="R: "+c.toFixed(2).toString()+" "+u;this.updateLabelOfOlGeometry(t,p)}else{let c,l=tn(t,this.map.ol.getView().getProjection().getCode());c=vo[n.properties.measureUnit],l=Ho(l,n.properties.measureUnit);let p=t instanceof kt.ZP?"P: "+l.toFixed(2).toString()+" "+c:l.toFixed(2).toString()+" "+c;this.updateLabelOfOlGeometry(t,p)}else if(n.properties.labelType===ee.Area)if(t instanceof Ro.Z){let c=jn((0,kt.Bb)(t,1e4),this.map.ol.getView().getProjection().getCode());const u=Yo[n.properties.measureUnit];c=Ci(c,n.properties.measureUnit);const d=c.toFixed(2).toString()+" "+u;this.updateLabelOfOlGeometry(t,d)}else{let c,l=jn(t,this.map.ol.getView().getProjection().getCode());c=Yo[n.properties.measureUnit],l=Ci(l,n.properties.measureUnit);const p=l.toFixed(2).toString()+" "+c;this.updateLabelOfOlGeometry(t,p)}else this.updateLabelOfOlGeometry(t,n.properties.draw);this.updateLabelType(t,n.properties.labelType),this.updateMeasureUnit(t,n.properties.measureUnit),this.updateFontSizeAndStyle(t,n.properties.fontStyle.split(" ")[0].replace("px",""),n.properties.fontStyle.substring(n.properties.fontStyle.indexOf(" ")+1)),this.updateFillAndStrokeColor(t,n.properties.drawingStyle.fill,n.properties.drawingStyle.stroke),this.updateOffset(t,n.properties.offsetX,n.properties.offsetY),this.replaceFeatureInStore(n,t)}})}onSelectDraw(t,o,n){const s=this.activeStore.all(),a=t.getGeometry();a.ol_uid=t.get("id");const l=JSON.stringify(a.getCoordinates()[0]);s.forEach(c=>{const u=JSON.stringify(c.geometry.coordinates[0]);if(l===u){const p=t.get("fontStyle").split(" ")[0].replace("px",""),d=t.get("fontStyle").substring(t.get("fontStyle").indexOf(" ")+1),g=t.get("drawingStyle").fill,h=t.get("drawingStyle").stroke,m=t.get("offsetX"),y=t.get("offsetY"),v=c.properties.rad?c.properties.rad:void 0;this.updateLabelOfOlGeometry(a,o),this.updateFontSizeAndStyle(a,p,d),this.updateFillAndStrokeColor(a,g,h),this.updateOffset(a,m,y),this.updateLabelType(a,n[0]),this.updateMeasureUnit(a,n[1]),this.replaceFeatureInStore(c,a,v)}})}addFeatureToStore(t,o,n){let s,a,l,c,u;const p=n?n.properties.id:t.ol_uid,d=this.map.ol.getView().getProjection(),g=(new be.Z).writeGeometryObject(t,{featureProjection:d,dataProjection:d});if(t instanceof Ro.Z||o)if(o)s=o;else{g.type="Point",g.coordinates=t.getCenter();const h=(0,V.vs)([t.getFlatCoordinates()[2],t.getFlatCoordinates()[3]],d,"EPSG:4326");a=(0,V.vs)([t.getFlatCoordinates()[0],t.getFlatCoordinates()[1]],d,"EPSG:4326"),c=a[0],u=a[1],s=(0,qi.Sp)(a,h),this.radiusFormControl.setValue(Math.round(s))}this.activeDrawControl.radiusDrawEnd$.getValue()&&(s=this.activeDrawControl.radiusDrawEnd$.getValue()),t instanceof Pe.Z&&(l=(0,V.vs)(t.getFlatCoordinates(),d,"EPSG:4326"),c=l[0],u=l[1]),this.activeStore.update({type:le,geometry:g,projection:d.getCode(),properties:{id:p,draw:t.get("_label"),longitude:c||null,latitude:u||null,rad:s||null,fontStyle:t.get("fontStyle_"),drawingStyle:{fill:t.get("fillColor_"),stroke:t.get("strokeColor_")},offsetX:t.get("offsetX_"),offsetY:t.get("offsetY_"),labelType:t.get("labelType_"),measureUnit:t.get("measureUnit_")},meta:{id:p}}),this.activeStore.setLayerExtent(),this.activeDrawControl.predefinedRadius$.next(void 0),this.activeDrawControl.radiusDrawEnd$.next(void 0)}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}setupLayer(t){setTimeout(()=>{const o=this.dialog.open(g1,{disableClose:!1});o.afterClosed().subscribe(n=>{o.componentInstance.confirmFlag?(this.activeStore.state.updateAll({selected:!1}),this.activeStore=new Ct([],{map:this.map}),this.activeDrawingLayerSource=new zt.Z,this.activeDrawingLayer.opacity=0,this.deactivateDrawControl(),this.initStore(n,t),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.isCreatingNewLayer=!1,this.labelsAreShown||this.onToggleLabels(),this.activeLayerChange.emit(this.activeDrawingLayer)):(this.select.value=this.activeDrawingLayer,this.select.selectionChange.emit(this.activeDrawingLayer))})},250)}editLabelDrawing(t){const o=bt(t,this.map.ol.getView().getProjection().getCode());this.openDrawDialog(o,!1)}openShorcutsDialog(){this.dialog.open(c1)}deleteDrawings(){this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.activeDrawingLayerSource.getFeatures().forEach(o=>{const n=o.getGeometry();t.properties.id===n.ol_uid&&this.activeDrawingLayerSource.removeFeature(o)})}),this.updateHeightTable(),this.activeStore.setLayerExtent()}onToggleLabels(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.elementStyle(this.labelsAreShown,!!this.icon),this.createDrawControl()}onToggleDrawControl(t){t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleFreehandMode(t){this.isCircle()&&!t.checked?(this.activeDrawControl.ispredefinedRadius$.next(!0),this.changeRadius(this.radiusFormControl.value)):(this.activeDrawControl.setOlInteractionStyle(Pa(this.fillColor,this.strokeColor,this.strokeWidth)),this.activeDrawControl.ispredefinedRadius$.next(!1)),this.freehandMode=t.checked,this.activeDrawControl.freehand$.next(t.checked),this.toggleDrawControl()}onLayerChange(t){t?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=t,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(o=>o.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(o=>o[0]===this.activeDrawingLayer.id)[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}createLayer(t,o){for(const n of this.allLayers){let s=Number(n.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(s,this.layerCounterID)}this.activeDrawingLayer=new Te({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:o?t:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new Fe,style:(n,s)=>this.drawStyleService.createIndividualElementStyle(n,s,this.labelsAreShown,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.icon),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),qo(this.activeStore,this.activeDrawingLayer),Vi(this.activeStore,new Nt({motion:Y.None})),Ca(this.activeStore,new Mt({map:this.map,motion:Y.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",n=>{const s=n.feature.getGeometry();this.clearLabelsOfOlGeometry(s)})}onColorChange(t,o,n,s){this.selectedFeatures$.value.length>0&&!o&&this.selectedFeatures$.value.forEach(a=>{let l=bt(a,this.map.ol.getView().getProjection().getCode());this.updateFillAndStrokeColor(l,n,s);const c=this.activeStore.all().find(u=>u.meta.id===l.getId());c.properties.drawingStyle.fill=l.get("fillColor_"),c.properties.drawingStyle.stroke=l.get("strokeColor_"),this.activeStore.update(c)}),this.elementStyle(t,o),this.createDrawControl()}onFontChange(t,o,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(s=>{let a=bt(s,this.map.ol.getView().getProjection().getCode());this.updateFontSizeAndStyle(a,o,n);const l=this.activeStore.all().find(c=>c.meta.id===a.getId());l.properties.fontStyle=a.get("fontStyle_"),this.activeStore.update(l),a=this.activeStore.layer.ol.getSource().getFeatures().find(c=>c.getId()===l.meta.id),a.setProperties({fontStyle:l.properties.fontStyle}),a.changed()}),this.fontSize=o,this.fontStyle=n,this.drawStyleService.setFontSize(o),this.drawStyleService.setFontStyle(n),this.elementStyle(t))}onOffsetLabelChange(t,o,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(s=>{let a=bt(s,this.map.ol.getView().getProjection().getCode());this.updateOffset(a,o,n);const l=this.activeStore.all().find(c=>c.meta.id===a.getId());l.properties.offsetX=a.get("offsetX_"),l.properties.offsetY=a.get("offsetY_"),this.activeStore.update(l),a=this.activeStore.layer.ol.getSource().getFeatures().find(c=>c.getId()===l.meta.id),a.setProperties({offsetX:l.properties.offsetX,offsetY:l.properties.offsetY}),a.changed()}),this.elementStyle(t))}onIconChange(t){this.icon=t,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}onGeometryTypeChange(t){this.currGeometryType=t,this.activeDrawControl.setGeometryType(t),this.onToggleFreehandMode(this.freehandMode?{checked:!0}:{checked:!1}),this.toggleDrawControl()}updateLabelOfOlGeometry(t,o){t.setProperties({_label:o},!0)}updateFontSizeAndStyle(t,o,n){t.setProperties({fontStyle_:`${o}px ${n}`},!0)}updateFillAndStrokeColor(t,o,n){t.setProperties({fillColor_:o,strokeColor_:n},!0)}updateOffset(t,o,n){t.setProperties({offsetX_:o,offsetY_:n},!0)}updateLabelType(t,o){t.setProperties({labelType_:o},!0)}updateMeasureUnit(t,o){t.setProperties({measureUnit_:o},!0)}getFeatureFontSize(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"15"}getFeatureFontStyle(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):yo.Arial}getFeatureFillColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}get allFontStyles(){return Object.values(yo)}get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-draw-layer"))}updateHeightTable(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.tableTemplate.tableHeight=this.numberOfDrawings>10?"35vh":"auto"}updateActiveLayer(){return this.allLayers.find(o=>o.title===this.activeDrawingLayer.title)||this.allLayers[0]}toggleDrawControl(){this.deactivateDrawControl(),this.activateDrawControl()}clearLabelsOfOlGeometry(t){qr(t).forEach(o=>{o&&o.getMap()&&this.map.ol.removeOverlay(o)})}replaceFeatureInStore(t,o,n){this.activeStore.delete(t),this.onDrawEnd(o,n)}deactivateDrawControl(){!this.activeDrawControl||(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}activateDrawControl(){this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(t=>{this.openDrawDialog(t,!0)}),this.activeDrawControl.modify$.subscribe(t=>{this.onModifyDraw(t)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(t=>{this.openDrawDialog(t,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}isPoint(){return this.activeDrawControl.getGeometryType()===this.geometryType.Point}isLineString(){return this.activeDrawControl.getGeometryType()===this.geometryType.LineString}isPolygon(){return this.activeDrawControl.getGeometryType()===this.geometryType.Polygon}isCircle(){return this.activeDrawControl.getGeometryType()===this.geometryType.Circle}changeRadius(t){let o;o=t?this.measureUnit===K.Meters?t:1e3*t:void 0,this.activeDrawControl.setOlInteractionStyle((s,a)=>{const l=s.getGeometry(),c=V.vs(l.getCoordinates(),this.map.projection,"EPSG:4326"),u=o/Math.cos(Math.PI/180*c[1])/a;return this.activeDrawControl.predefinedRadius$.next(o),new R.ZP({image:new Me.Z({radius:u,stroke:new U.Z({width:1,color:"rgba(143,7,7,1)"}),fill:new N.Z({color:"rgba(255,255,255,0.4)"})})})}),this.toggleDrawControl()}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.radiusFormControl.setValue(this.measureUnit===K.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}elementStyle(t,o){this.activeStore.layer.ol.setStyle(o?(n,s)=>this.drawStyleService.createIndividualElementStyle(n,s,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.icon):(n,s)=>this.drawStyleService.createIndividualElementStyle(n,s,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection))}getRadius(t){const o=(0,qi.xA)(t);return Number(o/(2*Math.PI))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(_.QS),e.Y36($a),e.Y36(P.uw),e.Y36(m1))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw"]],viewQuery:function(t,o){if(1&t&&e.Gf(h1,5),2&t){let n;e.iGM(n=e.CRH())&&(o.select=n.first)}},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},decls:49,vars:47,consts:[[1,"geometry-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"draw-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[3,"checked","labelPosition","change"],[3,"checked","labelPosition","change",4,"ngIf"],["class","radius-unit",4,"ngIf"],["appearance","outline",1,"layer-select"],[3,"value","selectionChange"],["selectedLayer",""],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[1,"icon-options"],[4,"ngIf"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["svgIcon","keyboard-outline","tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"radius-unit"],[1,"radius-form"],[1,"radius"],["matInput","","type","number","min","0",3,"placeholder","formControl","readonly"],[1,"unit-field"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"svgIcon"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"value","click"],["mat-raised-button","","color","primary",3,"matTooltip","click"],["svgIcon","palette","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.NdJ("change",function(a){return o.onGeometryTypeChange(a.value)}),e.TgZ(3,"mat-button-toggle",2),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-button-toggle",2),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-button-toggle",2),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-button-toggle",2),e._uU(13),e.ALo(14,"translate"),e.qZA()()(),e.TgZ(15,"div",3)(16,"mat-slide-toggle",4),e.NdJ("change",function(a){return o.onToggleDrawControl(a.checked)}),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"mat-slide-toggle",5),e.NdJ("change",function(){return o.onToggleLabels()}),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.YNc(22,f1,3,5,"mat-slide-toggle",6),e.YNc(23,y1,8,7,"div",7),e.qZA(),e._UZ(24,"mat-divider"),e.TgZ(25,"div")(26,"mat-form-field",8)(27,"mat-label"),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"mat-select",9,10),e.NdJ("selectionChange",function(){e.CHM(n);const a=e.MAs(31);return e.KtG(o.onLayerChange(a.value))}),e.YNc(32,v1,2,2,"mat-option",11),e.TgZ(33,"mat-option",12),e._uU(34),e.ALo(35,"translate"),e.qZA()()(),e.YNc(36,b1,4,7,"button",13),e.qZA(),e._UZ(37,"mat-divider"),e.TgZ(38,"div"),e.YNc(39,C1,4,6,"button",14),e.TgZ(40,"div"),e._UZ(41,"igo-entity-table",15,16),e.qZA()(),e.TgZ(43,"div",17),e.YNc(44,w1,11,8,"mat-form-field",18),e.qZA(),e.TgZ(45,"button",19),e.NdJ("click",function(){return o.openShorcutsDialog()}),e._UZ(46,"mat-icon",20),e.ALo(47,"translate"),e.qZA(),e.YNc(48,T1,5,7,"button",21),e.qZA()}2&t&&(e.xp6(2),e.Q6J("value",o.geometryType.Point),e.xp6(1),e.Q6J("value",o.geometryType.Point),e.xp6(1),e.hij(" ",e.lcZ(5,29,"igo.geo.draw."+o.geometryType.Point)," "),e.xp6(2),e.Q6J("value",o.geometryType.LineString),e.xp6(1),e.hij(" ",e.lcZ(8,31,"igo.geo.draw."+o.geometryType.LineString)," "),e.xp6(2),e.Q6J("value",o.geometryType.Polygon),e.xp6(1),e.hij(" ",e.lcZ(11,33,"igo.geo.draw."+o.geometryType.Polygon)," "),e.xp6(2),e.Q6J("value",o.geometryType.Circle),e.xp6(1),e.hij(" ",e.lcZ(14,35,"igo.geo.draw."+o.geometryType.Circle)," "),e.xp6(3),e.Q6J("disabled",o.drawControlIsDisabled)("checked",o.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(18,37,"igo.geo.spatialFilter.drawControl")," "),e.xp6(2),e.Q6J("checked",o.labelsAreShown)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(21,39,"igo.geo.draw.toggleMapTooltips")," "),e.xp6(2),e.Q6J("ngIf",!o.isPoint()),e.xp6(1),e.Q6J("ngIf",o.isCircle()),e.xp6(5),e.Oqu(e.lcZ(29,41,"igo.geo.draw.layer.title")),e.xp6(2),e.Q6J("value",o.updateActiveLayer()),e.xp6(2),e.Q6J("ngForOf",o.allLayers),e.xp6(2),e.hij(" ",e.lcZ(35,43,"igo.geo.draw.layer.createNewLayer")," "),e.xp6(2),e.Q6J("ngIf",o.activeDrawingLayer),e.xp6(3),e.Q6J("ngIf",o.activeStore.count$.getValue()>0),e.xp6(2),e.Q6J("store",o.activeStore)("template",o.tableTemplate),e.xp6(3),e.Q6J("ngIf",o.icons.length>=1),e.xp6(2),e.Q6J("matTooltip",e.lcZ(47,45,"igo.geo.draw.shortcuts")),e.xp6(2),e.Q6J("ngIf",o.selectedFeatures$.value.length))},dependencies:[_._Y,_.Fj,_.wV,_.JJ,_.JL,_.qQ,_.F,_.oH,f.sg,f.O5,w.lW,Re.A9,Re.Yi,vt.d,I.KE,I.hX,T.Hw,mt.k,O.gM,H.Nt,ue.gD,ue.$L,Q.ey,at.Rr,li,f.Ov,L.X$],styles:[".geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}.draw-options[_ngcontent-%COMP%]{overflow-x:hidden}.draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}img[_ngcontent-%COMP%]{width:100%;height:100%}.deleteBtn[_ngcontent-%COMP%]{margin-left:12px}.storeTable[_ngcontent-%COMP%]{height:auto!important}.layer-select[_ngcontent-%COMP%]{width:85%;padding:10px 10px 0%}.input-button-container[_ngcontent-%COMP%]{padding:10px}.input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}.input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}.radius[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}.unit-field[_ngcontent-%COMP%]{width:110px;margin-left:30px}.radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;margin-left:2px;padding:5px}  igo-entity-table td:last-child{text-align:right!important}  igo-entity-table td:last-child button{margin:0%!important}"],data:{animation:[(0,ae.X$)("openClose",[(0,ae.SB)("open",(0,ae.oB)({opacity:1})),(0,ae.SB)("closed",(0,ae.oB)({opacity:0})),(0,ae.eR)("open => closed",[(0,ae.jt)("600ms ease")]),(0,ae.eR)("closed => open",[(0,ae.jt)("800ms ease")])])]},changeDetection:0}),i})(),xu=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[_.u5,_.UX,f.ez,w.ot,Re.vV,vt.t,I.lN,T.Ps,mt.g,O.AV,I.lN,H.c,G.ie,ue.LD,at.rP,P.Is,oe,Zi,Ln.e4,yt.b2,pn.PW,nt.Fk,Ge.p9]}),i})(),Ea=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,T.Ps,oe,ki,Qs]}),i})(),F1=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Cn,Cn]}),i})(),Ao=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Ea,F1]}),i})();class wu{constructor(r){this.options=r,this.start$=new Se.x,this.end$=new Se.x,this.changes$=new Se.x,this.olModifyInteractionIsActive=!1,this.olTranslateInteractionIsActive=!1,this.olDrawInteractionIsActive=!1,this.removedOlInteractions=[],this.modify=!0,this.translate=!0,void 0!==r.modify&&(this.modify=r.modify),void 0!==r.translate&&(this.translate=r.translate),this.olOverlayLayer=void 0!==r.layer?r.layer:this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}get active(){return void 0!==this.olMap}get olOverlaySource(){return this.olOverlayLayer.getSource()}get olLinearRingsSource(){return this.olLinearRingsLayer.getSource()}setOlMap(r){if(void 0===r)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=r);this.olMap=r,this.addOlInnerOverlayLayer(),!0===this.modify&&this.addOlDrawInteraction(),!0===this.translate&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),!0===this.modify&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}getSource(){return this.olOverlaySource}setOlGeometry(r){const t=new De.Z({geometry:r});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)}createOlInnerOverlayLayer(){return new Jo.Z({source:this.options.source?this.options.source:new zt.Z,style:this.options.layerStyle,zIndex:500})}addOlInnerOverlayLayer(){void 0===this.options.layer&&this.olMap.addLayer(this.olOverlayLayer)}removeOlInnerOverlayLayer(){void 0===this.options.layer&&void 0!==this.olMap&&this.olMap.removeLayer(this.olOverlayLayer)}clearOlInnerOverlaySource(){void 0===this.options.layer&&void 0===this.options.source&&this.olOverlaySource.clear(!0)}createOlLinearRingsLayer(){return new Jo.Z({source:new zt.Z,style:mu(),zIndex:500})}addOlLinearRingsLayer(){this.olMap.addLayer(this.olLinearRingsLayer)}removeOlLinearRingsLayer(){this.olMap.removeLayer(this.olLinearRingsLayer)}clearOlLinearRingsSource(){this.olLinearRingsSource.clear(!0)}addOlModifyInteraction(){const r=new ca.Z({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=r}removeOlModifyInteraction(){void 0!==this.olModifyInteraction&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}activateModifyInteraction(){!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",r=>this.onModifyStart(r)),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",r=>this.onModifyEnd(r)),this.olMap.addInteraction(this.olModifyInteraction))}deactivateModifyInteraction(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,(0,et.B)([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olModifyInteraction))}onModifyStart(r){const t=r.features.item(0).getGeometry();this.start$.next(t),this.onModifyKey=t.on("change",o=>{this.mousePosition=Oa(o),this.changes$.next(o.target)}),this.subscribeToKeyDown()}onModifyEnd(r){(0,et.B)(this.onModifyKey),this.end$.next(r.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}subscribeToKeyDown(){this.keyDown$$=(0,lo.R)(document,"keydown").subscribe(r=>{" "!==r.key||this.olMap.getView().animate({center:this.mousePosition,duration:0})})}unsubscribeToKeyDown(){void 0!==this.keyDown$$&&this.keyDown$$.unsubscribe()}addOlTranslateInteraction(){const r=new oc.Z({layers:[this.olOverlayLayer]});this.olTranslateInteraction=r}removeOlTranslateInteraction(){void 0!==this.olTranslateInteraction&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}activateTranslateInteraction(){!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",r=>this.onTranslateStart(r)),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",r=>this.onTranslateEnd(r)),this.olMap.addInteraction(this.olTranslateInteraction))}deactivateTranslateInteraction(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,(0,et.B)([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olTranslateInteraction))}onTranslateStart(r){const t=r.features.item(0).getGeometry();this.start$.next(t),this.onTranslateKey=t.on("change",o=>{})}onTranslateEnd(r){(0,et.B)(this.onTranslateKey),this.end$.next(r.features.item(0).getGeometry())}addOlDrawInteraction(){const r=new In.ZP({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:mu(),condition:t=>(this.olOuterGeometry||this.getOlGeometry()).intersectsCoordinate(t.coordinate)});this.olDrawInteraction=r,this.subscribeToDrawKeyDown()}subscribeToDrawKeyDown(){this.drawKeyDown$$=(0,lo.R)(document,"keydown").subscribe(r=>{if("Control"!==r.key)return;this.unsubscribeToDrawKeyDown();const t=this.getOlGeometry();!t||!(t instanceof kt.ZP)||(this.subscribeToDrawKeyUp(),this.deactivateModifyInteraction(),this.deactivateTranslateInteraction(),this.activateDrawInteraction())})}subscribeToDrawKeyUp(){this.drawKeyUp$$=(0,lo.R)(document,"keyup").subscribe(r=>{"Control"===r.key&&(this.unsubscribeToDrawKeyUp(),this.unsubscribeToKeyDown(),this.deactivateDrawInteraction(),this.activateModifyInteraction(),!0===this.translate&&this.activateTranslateInteraction(),this.subscribeToDrawKeyDown(),this.olOuterGeometry=void 0,this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()))})}unsubscribeToDrawKeyDown(){void 0!==this.drawKeyDown$$&&this.drawKeyDown$$.unsubscribe()}unsubscribeToDrawKeyUp(){void 0!==this.drawKeyUp$$&&this.drawKeyUp$$.unsubscribe()}removeOlDrawInteraction(){void 0!==this.olDrawInteraction&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}activateDrawInteraction(){!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(r=>{r instanceof pc.Z&&(this.olMap.removeInteraction(r),this.removedOlInteractions.push(r))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",r=>this.onDrawStart(r)),this.onDrawEndKey=this.olDrawInteraction.on("drawend",r=>this.onDrawEnd(r)),this.olMap.addInteraction(this.olDrawInteraction))}deactivateDrawInteraction(){!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(r=>{this.olMap.addInteraction(r)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,(0,et.B)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olDrawInteraction))}onDrawStart(r){const t=r.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();const o=t.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(o),this.start$.next(this.getOlGeometry()),this.onDrawKey=t.on("change",n=>{this.mousePosition=Oa(n);const a=n.target.getLinearRing(0).getCoordinates();this.updateLinearRingOfOlGeometry(a),this.changes$.next(this.getOlGeometry())}),this.subscribeToKeyDown()}onDrawEnd(r){(0,et.B)(this.onDrawKey),this.olOuterGeometry=void 0;const t=r.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(t),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}addLinearRingToOlGeometry(r){!function kb(i,r){i.appendLinearRing(r)}(this.getOlGeometry(),new C_.Z(r))}updateLinearRingOfOlGeometry(r){const t=this.getOlGeometry(),n=t.getLinearRings().slice(0,-1).map(s=>s.getCoordinates());n.push(r),t.setCoordinates(n)}getOlGeometry(){const r=this.olOverlaySource.getFeatures();return r.length>0?r[0].getGeometry():void 0}}const Yn="Layer";function A1(i,r){if(1&i&&(e.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),e._uU(4),e.ALo(5,"translate"),e.qZA()()(),e.TgZ(6,"tbody")(7,"tr")(8,"td"),e._uU(9),e.ALo(10,"measureFormat"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"tr")(15,"td"),e._uU(16),e.ALo(17,"measureFormat"),e.qZA(),e.TgZ(18,"td"),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"tr")(22,"td"),e._uU(23),e.ALo(24,"measureFormat"),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"tr")(29,"td"),e._uU(30),e.ALo(31,"measureFormat"),e.qZA(),e.TgZ(32,"td"),e._uU(33),e.ALo(34,"translate"),e.qZA()()()()),2&i){const t=e.oxw();e.xp6(4),e.Oqu(e.lcZ(5,9,"igo.geo.measure.dialog.length.title")),e.xp6(5),e.Oqu(e.xi3(10,11,t.data.length,t.measureLengthUnit.Meters)),e.xp6(3),e.Oqu(e.lcZ(13,14,"igo.geo.measure.dialog.lengthInMeters")),e.xp6(4),e.Oqu(e.xi3(17,16,t.data.length,t.measureLengthUnit.Kilometers)),e.xp6(3),e.Oqu(e.lcZ(20,19,"igo.geo.measure.dialog.lengthInKilometers")),e.xp6(4),e.Oqu(e.xi3(24,21,t.data.length,t.measureLengthUnit.Miles)),e.xp6(3),e.Oqu(e.lcZ(27,24,"igo.geo.measure.dialog.lengthInMiles")),e.xp6(4),e.Oqu(e.xi3(31,26,t.data.length,t.measureLengthUnit.Feet)),e.xp6(3),e.Oqu(e.lcZ(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function L1(i,r){if(1&i&&(e.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),e._uU(4),e.ALo(5,"translate"),e.qZA()()(),e.TgZ(6,"tbody")(7,"tr")(8,"td"),e._uU(9),e.ALo(10,"measureFormat"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"tr")(15,"td"),e._uU(16),e.ALo(17,"measureFormat"),e.qZA(),e.TgZ(18,"td"),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"tr")(22,"td"),e._uU(23),e.ALo(24,"measureFormat"),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"tr")(29,"td"),e._uU(30),e.ALo(31,"measureFormat"),e.qZA(),e.TgZ(32,"td"),e._uU(33),e.ALo(34,"translate"),e.qZA()(),e.TgZ(35,"tr")(36,"td"),e._uU(37),e.ALo(38,"measureFormat"),e.qZA(),e.TgZ(39,"td"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"tr")(43,"td"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"td"),e._uU(47),e.ALo(48,"measureFormat"),e.qZA()()()()),2&i){const t=e.oxw();e.xp6(4),e.Oqu(e.lcZ(5,13,"igo.geo.measure.dialog.area.title")),e.xp6(5),e.Oqu(e.xi3(10,15,t.data.area,t.measureAreaUnit.SquareMeters)),e.xp6(3),e.Oqu(e.lcZ(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),e.xp6(4),e.Oqu(e.xi3(17,20,t.data.area,t.measureAreaUnit.SquareKilometers)),e.xp6(3),e.Oqu(e.lcZ(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")),e.xp6(4),e.Oqu(e.xi3(24,25,t.data.area,t.measureAreaUnit.SquareMiles)),e.xp6(3),e.Oqu(e.lcZ(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),e.xp6(4),e.Oqu(e.xi3(31,30,t.data.area,t.measureAreaUnit.Acres)),e.xp6(3),e.Oqu(e.lcZ(34,33,"igo.geo.measure.dialog.areaInAcres")),e.xp6(4),e.Oqu(e.xi3(38,35,t.data.area,t.measureAreaUnit.Hectares)),e.xp6(3),e.Oqu(e.lcZ(41,38,"igo.geo.measure.dialog.areaInHectares")),e.xp6(4),e.Oqu(e.lcZ(45,40,"igo.geo.measure.dialog.perimeterInMeters")),e.xp6(3),e.Oqu(e.xi3(48,42,t.data.perimeter,t.measureLengthUnit.Meters))}}let Tu=(()=>{class i{constructor(t,o){this.dialogRef=t,this.data=o,this.measureAreaUnit=Ue,this.measureLengthUnit=K}onNoClick(){this.dialogRef.close()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.so),e.Y36(P.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-measurer-dialog"]],decls:5,vars:5,consts:[["mat-dialog-title",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function(t,o){1&t&&(e.TgZ(0,"h3",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.YNc(3,A1,35,31,"table",1),e.YNc(4,L1,49,45,"table",1)),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,3,"igo.geo.measure.dialog.title")),e.xp6(2),e.Q6J("ngIf",o.data.length>0),e.xp6(1),e.Q6J("ngIf",o.data.area>0))},styles:["[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}"]}),i})();const I1=["table"];function O1(i,r){1&i&&e._UZ(0,"mat-divider")}function Z1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleDisplayLines(n.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("checked",t.displayLines)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function D1(i,r){1&i&&e._UZ(0,"mat-divider")}function k1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleDisplayDistance(n.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("checked",t.displayDistance)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function P1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleDisplayAreas(n.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("checked",t.displayAreas)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function $1(i,r){1&i&&e._UZ(0,"mat-divider")}function E1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-measurer-item",14),e.NdJ("measureUnitChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLengthUnitChange(n))}),e.ALo(1,"translate"),e.qZA()}if(2&i){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("measureType",o.measureType.Length)("measureUnit",o.measureLengthUnit.Meters)("measure",t.length)("auto",o.measureUnitsAuto)("placeholder",e.lcZ(1,5,o.activeMeasureType===o.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function J1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-measurer-item",14),e.NdJ("measureUnitChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onAreaUnitChange(n))}),e.ALo(1,"translate"),e.qZA()}if(2&i){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("measureType",o.measureType.Area)("measureUnit",o.measureAreaUnit.SquareMeters)("measure",t.area)("auto",o.measureUnitsAuto)("placeholder",e.lcZ(1,5,"igo.geo.measure.area"))}}function R1(i,r){if(1&i&&(e.ynx(0),e.YNc(1,E1,2,7,"igo-measurer-item",13),e.YNc(2,J1,2,7,"igo-measurer-item",13),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.activeMeasureType===t.measureType.Length||t.activeMeasureType===t.measureType.Area),e.xp6(1),e.Q6J("ngIf",t.activeMeasureType===t.measureType.Area)}}function B1(i,r){1&i&&e._UZ(0,"mat-divider")}function U1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onCalculateClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",16),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}function N1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onDeleteClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",18),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}let Ja=(()=>{class i{constructor(t,o,n){this.languageService=t,this.dialog=o,this.storageService=n,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:s=>{const a=this.activeLengthUnit;return Qn(Ho(s.properties.measure.length,a),{decimal:1,unit:a,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:s=>{const a=this.activeAreaUnit,l=Ci(s.properties.measure.area,a);return l?Qn(l,{decimal:1,unit:a,unitAbbr:!1,locale:"fr"}):""}}]},this.subscriptions$$=[],this.measureType=qt,this.measureAreaUnit=Ue,this.measureLengthUnit=K,this.measureUnitsAuto=!1,this.displayDistance=!0,this.displayLines=!0,this.displayAreas=!0,this.hasLine$=new b.X(!1),this.hasArea$=new b.X(!1),this.measure$=new b.X({}),this.selectedFeatures$=new b.X([]),this.showTooltips=!0,this.drawControlIsDisabled=!0,this.activeLengthUnit=K.Meters,this.activeAreaUnit=Ue.SquareMeters,this.olDrawSource=new zt.Z,this.minSegmentLength=10}set activeMeasureType(t){this.setActiveMeasureType(t)}get activeMeasureType(){return this._activeMeasureType}get drawControlIsActive(){return void 0!==this.activeDrawControl}get projection(){return this.map.ol.getView().getProjection().getCode()}ngOnInit(){this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(qt.Length)}ngOnDestroy(){this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(t=>t.unsubscribe())}onMeasureTypeChange(t){this.activeMeasureType=t}onToggleDrawControl(t){!0===t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleMeasureUnitsAuto(t){this.measureUnitsAuto=t}onToggleDisplayDistance(t){this.displayDistance=t,this.onDisplayDistance(),this.storageService.set("distanceToggle",!!t,Ie.SESSION)}onToggleDisplayLines(t){this.displayLines=t,this.onDisplayLines(),this.storageService.set("linesToggle",!!t,Ie.SESSION)}onToggleDisplayAreas(t){this.displayAreas=t,this.onDisplayAreas(),this.storageService.set("areasToggle",!!t,Ie.SESSION)}checkDistanceAreaToggle(){!1===this.storageService.get("distanceToggle")&&(this.displayDistance=!1),!1===this.storageService.get("linesToggle")&&(this.displayLines=!1),!1===this.storageService.get("areasToggle")&&(this.displayAreas=!1)}onDisplayDistance(){this.displayDistance?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments")).map(t=>t.classList.remove("igo-map-tooltip-hidden")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments")).map(t=>t.classList.add("igo-map-tooltip-hidden"))}onDisplayLines(){this.displayLines?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-line-segments")).map(t=>t.classList.remove("igo-map-tooltip-hidden")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-line-segments")).map(t=>t.classList.add("igo-map-tooltip-hidden"))}onDisplayAreas(){this.displayAreas?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-area")).map(t=>t.classList.remove("igo-map-tooltip-hidden")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-area")).map(t=>t.classList.add("igo-map-tooltip-hidden"))}onLengthUnitChange(t){this.activeLengthUnit=t,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onAreaUnitChange(t){this.activeAreaUnit=t,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onCalculateClick(){const t=this.selectedFeatures$.value,o=t.reduce((a,l)=>a+l.properties.measure.area||0,0),n=t.reduce((a,l)=>"Polygon"===l.geometry.type?a:a+l.properties.measure.length||0,0),s=t.reduce((a,l)=>"LineString"===l.geometry.type?a:a+l.properties.measure.length||0,0);this.openDialog({area:o,length:n,perimeter:s})}onDeleteClick(){this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.olDrawSource.getFeatures().forEach(o=>{const n=o.getGeometry();t.properties.id===n.ol_uid&&this.olDrawSource.removeFeature(o)})})}onModifyClick(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{const t=this.selectedFeatures$.value[0],n=this.store.layer.ol.getSource().getFeatures().find(s=>s.get("id")===t.properties.id);if(void 0!==n){this.deactivateDrawControl(),this.activateModifyControl();const s=n.getGeometry();this.clearTooltipsOfOlGeometry(s),this.modifyControl.setOlGeometry(s)}}}openDialog(t){this.dialog.open(Tu,{data:t})}initStore(){const t=this.store,o=new Te({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:`igo-measures-${Ze()}`,zIndex:200,source:new Fe,style:new R.ZP({stroke:new U.Z({color:"#ffcc33",width:2}),fill:new N.Z({color:"rgba(255, 255, 255, 0.2)"})}),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}});qo(t,o),t.layer.visible=!0,o.visible$.subscribe(n=>{n?Array.from(document.getElementsByClassName("igo-map-tooltip-measure")).map(s=>s.classList.remove("igo-map-tooltip-measure-by-display")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure")).map(s=>s.classList.add("igo-map-tooltip-measure-by-display"))}),Vi(t),Ca(t,new Mt({map:this.map,many:!0})),this.onFeatureAddedKey=t.source.ol.on("addfeature",n=>{const s=n.feature,a=s.getGeometry();this.updateMeasureOfOlGeometry(a,s.get("measure")),this.onDisplayDistance()}),this.onFeatureRemovedKey=t.source.ol.on("removefeature",n=>{const s=n.feature.getGeometry();this.clearTooltipsOfOlGeometry(s)}),this.selectedFeatures$$=t.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,ni.T)(1)).subscribe(n=>{!0===this.modifyControl.active&&this.deactivateModifyControl(),this.selectedFeatures$.next(n.map(s=>s.entity))}),this.subscriptions$$.push(this.store.entities$.subscribe(n=>{n.find(s=>"Polygon"===s.geometry.type)?this.hasArea$.next(!0):this.hasArea$.next(!1),n.find(s=>"LineString"===s.geometry.type)?this.hasLine$.next(!0):this.hasLine$.next(!1)})),this.subscriptions$$.push(this.store.count$.subscribe(n=>{this.store.layer.options.showInLayerList=n>=1}))}freezeStore(){const t=this.store;this.selectedFeatures$$.unsubscribe(),(0,et.B)(this.onFeatureAddedKey),(0,et.B)(this.onFeatureRemovedKey),t.deactivateStrategyOfType(Nt),t.deactivateStrategyOfType(Mt)}createDrawLineControl(){this.drawLineControl=new en({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:Za(),drawingLayerStyle:new R.ZP({})})}createDrawPolygonControl(){this.drawPolygonControl=new en({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:Za(),drawingLayerStyle:new R.ZP({})})}createModifyControl(){this.modifyControl=new wu({source:this.olDrawSource,drawStyle:Za(),layerStyle:new R.ZP({})})}toggleDrawControl(){this.deactivateDrawControl(),this.activeMeasureType===qt.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===qt.Area&&this.activateDrawControl(this.drawPolygonControl)}activateDrawControl(t){this.drawControlIsDisabled=!1,this.activeDrawControl=t,this.drawStart$$=t.start$.subscribe(o=>this.onDrawStart(o)),this.drawEnd$$=t.end$.subscribe(o=>this.onDrawEnd(o)),this.drawChanges$$=t.changes$.subscribe(o=>this.onDrawChanges(o)),this.drawChanges$$=t.abort$.subscribe(o=>{this.clearTooltipsOfOlGeometry(o),this.clearMeasures()}),t.setOlMap(this.map.ol,!1)}deactivateDrawControl(){void 0!==this.activeDrawControl&&(this.olDrawSource.clear(),void 0!==this.drawStart$$&&this.drawStart$$.unsubscribe(),void 0!==this.drawEnd$$&&this.drawEnd$$.unsubscribe(),void 0!==this.drawChanges$$&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),void 0!==this.activeOlGeometry&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}setActiveMeasureType(t){this._activeMeasureType=t,this.clearMeasures(),this.toggleDrawControl()}onDrawStart(t){this.activeOlGeometry=t}onDrawEnd(t){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(t),this.addFeatureToStore(t),this.clearTooltipsOfOlGeometry(t),this.olDrawSource.clear(!0)}onDrawChanges(t){const o=Da(t,this.projection);this.updateMeasureOfOlGeometry(t,Object.assign({},o,{area:void 0})),this.measure$.next(o)}activateModifyControl(){const t=this.store.getStrategyOfType(Mt);t.deactivate(),t.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(o=>this.onModifyStart(o)),this.modifyEnd$$=this.modifyControl.end$.subscribe(o=>this.onModifyEnd(o)),this.modifyChanges$$=this.modifyControl.changes$.subscribe(o=>this.onModifyChanges(o)),this.modifyControl.setOlMap(this.map.ol)}deactivateModifyControl(){void 0!==this.modifyStart$$&&this.modifyStart$$.unsubscribe(),void 0!==this.modifyEnd$$&&this.modifyEnd$$.unsubscribe(),void 0!==this.modifyChanges$$&&this.modifyChanges$$.unsubscribe(),void 0!==this.activeOlGeometry&&(1===this.selectedFeatures$.value.length&&this.addFeatureToStore(this.activeOlGeometry,this.selectedFeatures$.value[0]),this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)),this.olDrawSource.clear(),this.store.activateStrategyOfType(Mt),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}onModifyStart(t){this.onDrawStart(t)}onModifyChanges(t){this.onDrawChanges(t)}onModifyEnd(t){this.finalizeMeasureOfOlGeometry(t)}finalizeMeasureOfOlGeometry(t){const o=Da(t,this.projection);this.updateMeasureOfOlGeometry(t,o)}updateMeasureOfOlGeometry(t,o){t.setProperties({_measure:o},!0),this.updateTooltipsOfOlGeometry(t)}clearMeasures(){this.measure$.next({})}addFeatureToStore(t,o){const n=o?o.properties.id:t.ol_uid,s=this.map.ol.getView().getProjection(),a=(new be.Z).writeGeometryObject(t,{featureProjection:s,dataProjection:s});this.store.update({type:le,geometry:a,projection:s.getCode(),properties:{id:n,measure:t.get("_measure")},meta:{id:n}})}updateTooltipsOfOlGeometry(t){const o=t.get("_measure"),n=o.lengths,s=o.area,a=function jb(i){const r=ka(i);let t="";return i instanceof oo.Z?t="line-":i instanceof kt.ZP&&(t="polygone-"),r.map(n=>{let s=n.get("_tooltip");return void 0===s?s=yu(n,!1,t):s.setPosition(n.getFlatCoordinates()),s})}(t);if(n.length===a.length)for(let l=0;l<a.length;l++){const c=n[l];void 0!==c&&this.updateOlTooltip(a[l],Ho(c,this.activeLengthUnit),this.activeLengthUnit,qt.Length)}void 0!==s&&this.updateOlTooltip(function Hb(i){const r=function _u(i){let r=i.get("_center");const t=(0,Je.qg)(i.getExtent());return void 0!==r?r.setCoordinates(t):(r=new Pe.Z(t),i.set("_center",r)),r}(i);let t=r.get("_tooltip");return void 0===t?t=yu(r,!0):t.setPosition(r.getFlatCoordinates()),t}(t),Ci(s,this.activeAreaUnit),this.activeAreaUnit,qt.Area)}showTooltipsOfOlGeometry(t){qr(t).forEach(o=>{this.shouldShowTooltip(o)&&this.map.ol.addOverlay(o)})}clearTooltipsOfOlGeometry(t){qr(t).forEach(o=>{void 0!==o&&void 0!==o.getMap()&&this.map.ol.removeOverlay(o)})}updateTooltipsOfOlSource(t){t.forEachFeature(o=>{this.updateTooltipsOfOlGeometry(o.getGeometry())})}showTooltipsOfOlSource(t){t.forEachFeature(o=>{this.showTooltipsOfOlGeometry(o.getGeometry())})}clearTooltipsOfOlSource(t){t.forEachFeature(o=>{void 0!==o.getGeometry()&&this.clearTooltipsOfOlGeometry(o.getGeometry())})}updateOlTooltip(t,o,n,s){t.setProperties({_measure:o,_unit:n,_type:s},!0),t.getElement().innerHTML=this.computeTooltipInnerHTML(t),this.shouldShowTooltip(t)&&this.map.ol.addOverlay(t)}computeTooltipInnerHTML(t){const o=t.getProperties();return Qn(o._measure,{decimal:1,unit:o._unit,unitAbbr:!0,locale:"fr"},this.languageService)}shouldShowTooltip(t){if(!1===this.showTooltips)return!1;const o=t.getProperties(),n=o._measure;if(void 0===n)return!1;if(o._unit===qt.Length){const s=Ho(this.minSegmentLength,o._unit)||0;return n>Math.max(s,0)}return!0}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(P.uw),e.Y36(ce))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-measurer"]],viewQuery:function(t,o){if(1&t&&e.Gf(I1,7),2&t){let n;e.iGM(n=e.CRH())&&(o.table=n.first)}},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},decls:43,vars:60,consts:[[1,"measure-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"measure-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click"],["svgIcon","calculator"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"]],template:function(t,o){1&t&&(e.TgZ(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.NdJ("change",function(s){return o.onMeasureTypeChange(s.value)}),e.TgZ(3,"mat-button-toggle",2),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-button-toggle",2),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"div",3)(10,"mat-slide-toggle",4),e.NdJ("change",function(s){return o.onToggleDrawControl(s.checked)}),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.YNc(13,O1,1,0,"mat-divider",5),e.ALo(14,"async"),e.YNc(15,Z1,3,5,"mat-slide-toggle",6),e.ALo(16,"async"),e.YNc(17,D1,1,0,"mat-divider",5),e.ALo(18,"async"),e.ALo(19,"async"),e.YNc(20,k1,3,5,"mat-slide-toggle",6),e.ALo(21,"async"),e.YNc(22,P1,3,5,"mat-slide-toggle",6),e.ALo(23,"async"),e.YNc(24,$1,1,0,"mat-divider",5),e.ALo(25,"async"),e.TgZ(26,"mat-slide-toggle",7),e.NdJ("change",function(s){return o.onToggleMeasureUnitsAuto(s.checked)}),e._uU(27),e.ALo(28,"translate"),e.qZA()(),e.YNc(29,R1,3,2,"ng-container",5),e.ALo(30,"async"),e.YNc(31,B1,1,0,"mat-divider",5),e.ALo(32,"async"),e.ALo(33,"async"),e.TgZ(34,"div",8),e.YNc(35,U1,4,6,"button",9),e.ALo(36,"async"),e.ALo(37,"async"),e.YNc(38,N1,4,6,"button",10),e.ALo(39,"async"),e.ALo(40,"async"),e.qZA(),e._UZ(41,"igo-entity-table",11,12),e.qZA()),2&t&&(e.xp6(2),e.Q6J("value",o.activeMeasureType),e.xp6(1),e.Q6J("value",o.measureType.Length),e.xp6(1),e.hij(" ",e.lcZ(5,24,"igo.geo.measure."+o.measureType.Length)," "),e.xp6(2),e.Q6J("value",o.measureType.Area),e.xp6(1),e.hij(" ",e.lcZ(8,26,"igo.geo.measure."+o.measureType.Area)," "),e.xp6(3),e.Q6J("disabled",o.drawControlIsDisabled)("checked",o.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(12,28,"igo.geo.measure.toggleActive")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(14,30,o.hasLine$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(16,32,o.hasLine$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(18,34,o.hasLine$)||e.lcZ(19,36,o.hasArea$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(21,38,o.hasArea$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(23,40,o.hasArea$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(25,42,o.hasArea$)),e.xp6(2),e.Q6J("checked",o.measureUnitsAuto)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(28,44,"igo.geo.measure.toggleAutoUnits")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(30,46,o.measure$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(32,48,o.hasLine$)||e.lcZ(33,50,o.hasArea$)),e.xp6(4),e.Q6J("ngIf",e.lcZ(36,52,o.hasLine$)||e.lcZ(37,54,o.hasArea$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(39,56,o.hasLine$)||e.lcZ(40,58,o.hasArea$)),e.xp6(3),e.Q6J("store",o.store)("template",o.tableTemplate))},styles:[".measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}.measure-options[_ngcontent-%COMP%]{overflow-x:hidden}.measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}.measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}.table-compact[_ngcontent-%COMP%]     .mat-header-cell.mat-column-selectionCheckbox{width:52px}"],changeDetection:0}),i})(),Mu=(()=>{class i{transform(t,o,n=!1,s=1){let a;return Object.values(Ue).indexOf(o)>=0?a=Ci(t,o):Object.values(K).indexOf(o)>=0&&(a=Ho(t,o)),a&&Qn(a,{decimal:1,unit:o,unitAbbr:n,locale:"fr"})}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275pipe=e.Yjl({name:"measureFormat",type:i,pure:!0}),i})();function q1(i,r){}let Fu=(()=>{class i{constructor(t,o){this.cdRef=t,this.ngControl=o,this.olGeoJSON=new be.Z,this.ready=!1,this.olTooltip=this.createMeasureTooltip(),this.drawGuide=null,this.measure=!1,this._drawControlIsActive=!0,this.controlOptions={},this.onChange=()=>{},this.onTouched=()=>{},void 0!==this.ngControl&&(this.ngControl.valueAccessor=this)}set geometryType(t){this._geometryType=t,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get geometryType(){return this._geometryType}get drawControlIsActive(){return this._drawControlIsActive}set drawControlIsActive(t){if(this._drawControlIsActive=t,!1!==this.ready){if(this.deactivateControl(),!this._drawControlIsActive)return;this.toggleControl()}}get freehandDrawIsActive(){return this._freehandDrawIsActive}set freehandDrawIsActive(t){this._freehandDrawIsActive=t,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&(!this.drawControlIsActive||this.toggleControl())}get predefinedRadius(){return this._predefinedRadius}set predefinedRadius(t){this._predefinedRadius=t,this.drawControl.ispredefinedRadius$.next(t)}set drawStyle(t){void 0===t&&(t=gu()),this._drawStyle=t;const o=this.getGuideStyleFromDrawStyle(t);this.defaultDrawStyleRadius=void 0!==o?o.getRadius():null,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get drawStyle(){return this._drawStyle}set overlayStyle(t){this._overlayStyle=t}get overlayStyle(){return this._overlayStyle}set value(t){this._value=t,!1!==this.ready&&(t?this.addGeoJSONToOverlay(t):this.olOverlaySource.clear(!0),this.onChange(t),this.toggleControl(),this.cdRef.detectChanges())}get value(){return this._value}get olOverlaySource(){return this.olOverlayLayer.getSource()}set radius(t){if(!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)){let o;setTimeout(()=>{o=this.modifyControl.olModifyInteraction,o&&o.features_&&(o.features_.clear(),this.addGeoJSONToOverlay(this.value))},0)}}ngOnInit(){void 0===this.drawStyle&&(this.drawStyle=gu()),void 0===this.overlayStyle&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}ngOnDestroy(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}writeValue(t){this.value=t}addOlOverlayLayer(){this.olOverlayLayer=new Jo.Z({source:new zt.Z,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}createDrawControl(){const t=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:"function"==typeof this.drawStyle?this.drawStyle:(o,n)=>{const s=this.drawStyle;return this.updateDrawStyleWithDrawGuide(s,n),s}});this.drawControl=new en(t)}createModifyControl(){const t=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:(o,n)=>{const s=this.drawStyle;return this.updateDrawStyleWithDrawGuide(s,n),s}});this.modifyControl=new wu(t)}toggleControl(){let t;t=!this.value&&this.geometryType?this.drawControl:this.modifyControl,t!==this.activeControl&&(this.deactivateControl(),this.activateControl(t))}activateControl(t){this.activeControl=t,this.olGeometryEnds$$=t.end$.subscribe(o=>this.onOlGeometryEnds(o)),!0===this.measure&&t===this.drawControl&&(this.olGeometryChanges$$=t.changes$.subscribe(o=>this.onOlGeometryChanges(o))),t.setOlMap(this.map.ol,!1)}deactivateControl(){this.removeMeasureTooltip(),void 0!==this.activeControl&&this.activeControl.setOlMap(void 0),void 0!==this.olGeometryEnds$$&&this.olGeometryEnds$$.unsubscribe(),void 0!==this.olGeometryChanges$$&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}onOlGeometryEnds(t){this.removeMeasureTooltip(),this.setOlGeometry(t)}onOlGeometryChanges(t){"Point"!==t.getType()&&this.updateMeasureTooltip(t)}setOlGeometry(t){let o;void 0!==t&&("Circle"===t.getType()&&(t=this.circleToPoint(t)),o=this.olGeoJSON.writeGeometryObject(t,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),t.get("radius")&&(o.radius=t.get("radius"),t.set("radius",o.radius)),this.writeValue(o))}circleToPoint(t){const o=t.getCenter(),n=V.vs(o,this.map.projection,"EPSG:4326"),s=Math.round(t.getRadius()*Math.cos(Math.PI/180*n[1]));return(t=new Pe.Z(o)).set("radius",s,!0),t}addGeoJSONToOverlay(t){const o=this.olGeoJSON.readGeometry(t,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),n=new De.Z({geometry:o});n.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(n)}createMeasureTooltip(){return new _c.Z({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}updateMeasureTooltip(t){const n=Da(t,this.map.projection).lengths,s="Polygon"===t.getType()?n.length-2:n.length-1,a=n[s],l=ka(t),c=l[s];if(0===l.length||void 0===c)return void this.removeMeasureTooltip();this.olTooltip.setPosition(c.getFlatCoordinates());const u=Qn(a,{decimal:1,unit:K.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=u,void 0===this.olTooltip.getMap()&&this.map.ol.addOverlay(this.olTooltip)}removeMeasureTooltip(){this.olTooltip.getMap&&void 0!==this.olTooltip.getMap()&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}updateDrawStyleWithDrawGuide(t,o){const n=this.getGuideStyleFromDrawStyle(t);if(void 0===n)return;const s=this.drawGuide;let a;a=!s||s<0?this.defaultDrawStyleRadius:s>0?s/o:s,n.setRadius(a)}getGuideStyleFromDrawStyle(t){let o,n;return o=Array.isArray(t)?t[0]:t,"function"==typeof o.getImage&&(o=o.getImage()),"function"==typeof o.setRadius&&(n=o),n}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(_.a5,10))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",predefinedRadius:"predefinedRadius",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},decls:1,vars:0,template:function(t,o){1&t&&e.YNc(0,q1,0,0,"ng-template")},encapsulation:2,changeDetection:0}),i})(),Au=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,T.Ps,I.lN,H.c,w.ot,Re.vV,oe]}),i})(),Ra=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,Au,Au]}),i})();function j1(i,r){if(1&i&&(e.TgZ(0,"button",2),e.ALo(1,"translate"),e._UZ(2,"mat-icon",3),e.qZA()),2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.xp6(2),e.Q6J("matBadge",t.badge)}}function Y1(i,r){if(1&i&&e._UZ(0,"igo-time-filter-item",7),2&i){const t=e.oxw(2);e.Q6J("header",!1)("layer",t.layer)}}function H1(i,r){if(1&i&&(e.TgZ(0,"div",4,5),e.YNc(2,Y1,1,2,"igo-time-filter-item",6),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.timeFilterCollapse&&t.options.timeFilter)}}let Hn=(()=>{class i{constructor(){this.color="primary",this.header=!0,this.timeFilterCollapse=!1}get badge(){const t=this.options.timeFilter;if(t&&t.enabled)return 1}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}ngOnInit(){this.options=this.layer.dataSource.options}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","history",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(t,o){1&t&&(e.YNc(0,j1,3,5,"button",0),e.YNc(1,H1,3,1,"div",1)),2&t&&(e.Q6J("ngIf",o.header&&o.options.timeFilterable&&o.options.timeFilter),e.xp6(1),e.Q6J("ngIf",o.header&&o.options.timeFilterable&&o.options.timeFilter))},changeDetection:0}),i})();function V1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-form-field"),e._UZ(2,"mat-datetimepicker-toggle",4)(3,"mat-datetimepicker",5,6),e.TgZ(5,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.date=n)})("dateChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleDateChange(n))}),e.ALo(6,"translate"),e.qZA()()()}if(2&i){const t=e.MAs(4),o=e.oxw(2);e.xp6(2),e.Q6J("for",t),e.xp6(1),e.s9C("type",o.type),e.xp6(2),e.s9C("placeholder",e.lcZ(6,7,"igo.geo.timeFilter.date")),e.Q6J("matDatetimepicker",t)("ngModel",o.date)("min",o.min)("max",o.max)}}function z1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"div",8)(2,"mat-form-field"),e._UZ(3,"mat-datetimepicker-toggle",4)(4,"mat-datetimepicker",5,9),e.TgZ(6,"input",10),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.startDate=n)})("input",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.startDate)})("dateChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleDateChange(n))}),e.ALo(7,"translate"),e.qZA()()(),e.TgZ(8,"div",8)(9,"mat-form-field"),e._UZ(10,"mat-datetimepicker-toggle",4)(11,"mat-datetimepicker",5,11),e.TgZ(13,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.endDate=n)})("dateChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleDateChange(n))}),e.ALo(14,"translate"),e.qZA()()()()}if(2&i){const t=e.MAs(5),o=e.MAs(12),n=e.oxw(2);e.xp6(3),e.Q6J("for",t),e.xp6(1),e.s9C("type",n.type),e.xp6(2),e.s9C("placeholder",e.lcZ(7,14,"igo.geo.timeFilter.startDate")),e.Q6J("matDatetimepicker",t)("ngModel",n.startDate)("min",n.min)("max",n.getRangeMaxDate()),e.xp6(4),e.Q6J("for",o),e.xp6(1),e.s9C("type",n.type),e.xp6(2),e.s9C("placeholder",e.lcZ(14,16,"igo.geo.timeFilter.endDate")),e.Q6J("matDatetimepicker",o)("ngModel",n.endDate)("min",n.getRangeMinDate())("max",n.max)}}function W1(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,V1,7,9,"div",2),e.YNc(2,z1,15,18,"div",0),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isRange),e.xp6(1),e.Q6J("ngIf",t.isRange)}}function K1(i,r){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function X1(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-form-field")(2,"mat-select",12),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.year=n)})("selectionChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleYearChange(n))}),e.ALo(3,"translate"),e.YNc(4,K1,2,2,"mat-option",13),e.qZA()()()}if(2&i){const t=e.oxw(2);e.xp6(2),e.s9C("placeholder",e.lcZ(3,3,"igo.geo.timeFilter.date")),e.Q6J("ngModel",t.year),e.xp6(2),e.Q6J("ngForOf",t.listYears)}}function e0(i,r){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function t0(i,r){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function o0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"div",8)(2,"mat-form-field")(3,"mat-select",12),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.startYear=n)})("selectionChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleYearChange(n))}),e.ALo(4,"translate"),e.YNc(5,e0,2,2,"mat-option",13),e.qZA()()(),e.TgZ(6,"div",8)(7,"mat-form-field")(8,"mat-select",12),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.endYear=n)})("selectionChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleYearChange(n))}),e.ALo(9,"translate"),e.YNc(10,t0,2,2,"mat-option",13),e.qZA()()()()}if(2&i){const t=e.oxw(2);e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.timeFilter.startDate")),e.Q6J("ngModel",t.startYear),e.xp6(2),e.Q6J("ngForOf",t.startListYears),e.xp6(3),e.s9C("placeholder",e.lcZ(9,8,"igo.geo.timeFilter.endDate")),e.Q6J("ngModel",t.endYear),e.xp6(2),e.Q6J("ngForOf",t.endListYears)}}function n0(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,X1,5,5,"div",2),e.YNc(2,o0,11,10,"div",0),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isRange),e.xp6(1),e.Q6J("ngIf",t.isRange)}}function r0(i,r){if(1&i&&(e.TgZ(0,"p",23),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.year)}}function s0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"mat-slider",16),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.handleSliderYearChange(n))})("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.handleSliderYearChange(n))}),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA(),e.YNc(6,r0,2,1,"p",17),e.TgZ(7,"div",18,19)(9,"mat-slide-toggle",20),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleFilterState())}),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"button",21),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.playYear(n))}),e._UZ(12,"mat-icon",22),e.qZA(),e.TgZ(13,"button",21),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.resetFilter(n))}),e._UZ(14,"mat-icon",22),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.startYear),e.xp6(1),e.s9C("step",t.step),e.Q6J("min",t.startYear)("max",t.endYear)("value",t.handleSliderValue())("color",t.color)("disabled",!t.options.enabled||!t.layer.visible),e.xp6(2),e.Oqu(t.endYear),e.xp6(1),e.Q6J("ngIf",t.options.enabled),e.xp6(3),e.Q6J("matTooltip",e.lcZ(10,17,"igo.geo.filter.toggleFilterState"))("color",t.color)("checked",t.options.enabled)("disabled",!t.layer.visible),e.xp6(2),e.Q6J("disabled",!t.options.enabled||!t.layer.visible),e.xp6(1),e.s9C("svgIcon",t.playIcon),e.xp6(1),e.Q6J("disabled",!t.options.enabled||!t.layer.visible),e.xp6(1),e.s9C("svgIcon",t.resetIcon)}}function a0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-slider",24),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.handleSliderDateChange(n))})("selectionChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.handleSliderDateChange(n))}),e.qZA(),e.TgZ(2,"p",23),e._uU(3),e.qZA(),e.TgZ(4,"button",25),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.playFilter(n))}),e._UZ(5,"mat-icon",22),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.s9C("step",t.step),e.Q6J("min",t.dateToNumber(t.min))("max",t.dateToNumber(t.max))("value",t.handleSliderValue()),e.xp6(2),e.Oqu(t.handleSliderTooltip()),e.xp6(2),e.s9C("svgIcon",t.playIcon)}}let l0=(()=>{class i{constructor(t){this.dateAdapter=t,this.color="primary",this.listYears=[],this.startListYears=[],this.endListYears=[],this.playIcon="play-circle",this.resetIcon="replay",this.change=new e.vpe,this.yearChange=new e.vpe,this.dateAdapter.setLocale("fr")}set currentValue(t){if(t&&this.type!==tt.YEAR){const o=t.split("/");if(o.length>0){const n=new Date(o[0]),s=new Date(o[1]);isNaN(n.valueOf())||(this.startDate=n),isNaN(s.valueOf())||(this.endDate=s)}}}get type(){return void 0===this.options.type?tt.DATE:this.options.type}get isRange(){return void 0!==this.options.range&&this.options.style!==Lt.SLIDER&&this.options.range}get style(){return void 0===this.options.style?Lt.SLIDER:this.options.style}get step(){let t=108e5;if(void 0===this.options.step)switch(this.type){case tt.DATE:case tt.DATETIME:t=108e5;break;case tt.TIME:t=36e5;break;case tt.YEAR:t=31536e6;break;default:t=108e5}else t=this.getStepDefinition(this.options.step);return t}get timeInterval(){return void 0===this.options.timeInterval?2e3:this.options.timeInterval}get min(){if(this.options.min){const t=new Date(this.options.min);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get max(){if(this.options.max){const t=new Date(this.options.max);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get is(){return void 0!==this.options.range&&this.options.range}ngOnInit(){if(void 0===this.startDate&&(this.startDate=new Date(this.min)),void 0===this.endDate&&(this.endDate=new Date(this.max)),void 0===this.startYear&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),void 0===this.endYear&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(let t=this.startYear;t<this.endYear;t++)this.startListYears.push(t);for(let t=this.startYear+1;t<=this.endYear;t++)this.endListYears.push(t)}else for(let t=this.startYear;t<=this.endYear+1;t++)this.listYears.push(t);this.options.enabled=void 0===this.options.enabled||this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&"slider"===this.style&&"year"===this.type&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}storeCurrentFilterValue(){!this.isRange&&this.style===Lt.SLIDER&&this.type===tt.YEAR&&(this.options.value=this.year.toString())}checkFilterValue(){const o=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==Lt.SLIDER||this.type!==tt.YEAR){if(this.isRange&&this.style===Lt.CALENDAR&&this.type===tt.YEAR&&o){this.startYear=parseInt(o.substr(0,4),10),this.endYear=parseInt(o.substr(5,4),10);const n=[],s=[];for(let a=this.initStartYear;a<this.endYear;a++)n.push(a);for(let a=this.startYear+1;a<=this.initEndYear;a++)s.push(a);this.startListYears=n,this.endListYears=s}}else this.year=o?new Date(o.toString()).getFullYear()+1:this.options.value?new Date(this.options.value.toString()).getFullYear()+1:new Date(this.min).getFullYear()+1}handleDateChange(t){this.setupDateOutput(),this.applyTypeChange(),this.change.emit(this.isRange?[this.startDate,this.endDate]:this.startDate)}handleYearChange(t){if(this.isRange){this.endListYears=[];for(let o=this.startYear+1;o<=this.initEndYear;o++)this.endListYears.push(o);this.startListYears=[];for(let o=this.initStartYear+1;o<this.endYear;o++)this.startListYears.push(o);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}handleListYearChange(t){this.handleYearChange([this.startYear,this.endYear])}handleListYearStartChange(t){this.change.emit([this.startDate,this.endDate])}dateToNumber(t){let o;return o=t?new Date(t):new Date(this.min),o.getTime()}setSliderThumbLabel(t){const o=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);o&&(o.textContent=t)}findThumbLabel(t){let o;return t.forEach(n=>{"mat-slider-thumb-label-text"===n.className&&(o=n),n.children.length>0&&!o&&(o=this.findThumbLabel(n.childNodes))},this),o}toggleFilterState(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&Lt.SLIDER&&this.type===tt.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}resetFilter(t){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&Lt.SLIDER&&this.type===tt.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(o=>{let n;const s=new Date(o.max);n=void 0===o.date?o.min.getTime():o.date.getTime(),n+=o.mySlider.step,o.date=new Date(n),n>s.getTime()&&o.stopFilter(),o.handleDateChange({value:o.date,date:o.date})},this.timeInterval,this))}playYear(t){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(t)),this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(()=>{this.year+this.mySlider.step>this.max.getFullYear()?this.stopFilter():this.year=this.year+this.mySlider.step,this.yearChange.emit(this.year)},this.timeInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}handleSliderDateChange(t){this.date=new Date(t.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(t)}handleSliderYearChange(t){this.year=t.value,this.yearChange.emit(this.year)}handleSliderValue(){if(!0===this.options.current||!this.min){const t=new Date;this.date=this.getRoundedDate(t)}return this.type===tt.YEAR?this.year:void 0===this.date?this.min.getTime():this.date.getTime()}handleSliderTooltip(){let t;switch(this.type){case tt.DATE:t=void 0===this.date?this.min.toDateString():this.date.toDateString();break;case tt.TIME:t=void 0===this.date?this.min.toTimeString():this.date.toTimeString();break;default:t=void 0===this.date?this.min.toUTCString():this.date.toUTCString()}return t}setupDateOutput(){this.style===Lt.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=void 0===this.startDate?new Date(this.min):this.startDate,this.endDate=void 0===this.endDate?new Date(this.max):this.endDate)}applyTypeChange(){switch(this.type){case tt.DATE:(void 0!==this.startDate||void 0!==this.endDate)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case tt.TIME:if(this.style===Lt.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){const t=this.startDate.getHours(),o=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(t),this.startDate.setMinutes(o)}if(this.endDate.getDay()!==this.min.getDay()){const t=this.endDate.getHours(),o=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(t),this.endDate.setMinutes(o)}}!this.isRange&&this.step>36e5&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}}getRangeMinDate(){return void 0===this.startDate?this.min:this.startDate}getRangeMaxDate(){return void 0===this.endDate?this.max:this.endDate}getRoundedDate(t,o=10){const n=6e4*o;return new Date(Math.round(t.getTime()/n)*n)}getStepDefinition(t){return E.duration(t).asMilliseconds()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Q._A))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-form"]],viewQuery:function(t,o){if(1&t&&e.Gf(mi.pH,5),2&t){let n;e.iGM(n=e.CRH())&&(o.mySlider=n.first)}},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},decls:5,vars:4,consts:[[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],["openOnFocus","true","timeInterval","5",3,"type"],["datetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","dateChange"],[1,"igo-col","igo-col-100"],["minDatetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","input","dateChange"],["maxDatetimePicker",""],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","tickInterval","auto","thumbLabel","",3,"step","min","max","value","color","disabled","input","change"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["actions",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","checked","disabled","change"],["mat-icon-button","","color","primary",3,"disabled","click"],[3,"svgIcon"],[1,"date-below"],["id","time-slider","tickInterval","auto","thumbLabel","",3,"step","min","max","value","input","selectionChange"],["mat-icon-button","","color","primary",3,"click"]],template:function(t,o){1&t&&(e.YNc(0,W1,3,2,"div",0),e.YNc(1,n0,3,2,"div",0),e._UZ(2,"br"),e.YNc(3,s0,15,19,"div",1),e.YNc(4,a0,6,6,"div",2)),2&t&&(e.Q6J("ngIf","calendar"===o.style&&"year"!==o.type),e.xp6(1),e.Q6J("ngIf","calendar"===o.style&&"year"===o.type),e.xp6(2),e.Q6J("ngIf",!o.isRange&&"slider"===o.style&&"year"===o.type),e.xp6(1),e.Q6J("ngIf","slider"===o.style&&"year"!==o.type))},dependencies:[f.sg,f.O5,_.Fj,_.JJ,_.On,Q.ey,T.Hw,w.lW,mi.pH,at.Rr,I.KE,I.R9,H.Nt,ue.gD,O.gM,On._R,On.C,On.RZ,L.X$],styles:[".igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}mat-slider[_ngcontent-%COMP%]     div.mat-slider-thumb-label{width:32px;height:32px;margin:0 auto}mat-slider[_ngcontent-%COMP%]     span.mat-slider-thumb-label-text{font-size:10px}#time-slider[_ngcontent-%COMP%]{width:70%;margin:0 auto}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){#time-slider[_ngcontent-%COMP%]{width:60%;margin:0 auto}}.date-below[_ngcontent-%COMP%]{margin:0}mat-form-field[_ngcontent-%COMP%]{text-align:center}mat-datetimepicker-toggle[_ngcontent-%COMP%]     .mat-icon{padding-bottom:30px}.igo-layer-actions-container[_ngcontent-%COMP%] > .mat-slide-toggle[_ngcontent-%COMP%]{vertical-align:middle}.time-filter-mat-datetimepicker-toggle[_ngcontent-%COMP%]     .mat-icon{width:auto}"]}),i})();const c0=function(i){return{disabled:i}};function u0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.layer.visible=!n.layer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",11),e.ALo(4,"async"),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,4,"igo.geo.layer.hideLayer"):e.lcZ(2,6,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("ngClass",e.VKq(10,c0,!1===e.lcZ(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}const p0=function(i){return{cursor:i}};function d0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleFiltersCollapsed())}),e.qZA(),e.TgZ(2,"h4",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleLegendOnClick())}),e._uU(3),e.qZA(),e.YNc(4,u0,5,12,"button",9),e.qZA()}if(2&i){const t=e.oxw(),o=e.MAs(2);e.xp6(1),e.Q6J("target",o)("collapsed",t.filtersCollapsed),e.xp6(1),e.Q6J("ngStyle",e.VKq(5,p0,t.filtersCollapsed?"default":"pointer")),e.xp6(1),e.Oqu(t.layer.title),e.xp6(1),e.Q6J("ngIf",t.header)}}function g0(i,r){if(1&i&&e._UZ(0,"igo-layer-legend",12),2&i){const t=e.oxw();e.Q6J("layer",t.layer)}}let Gr=(()=>{class i{constructor(t){this.timeFilterService=t,this.color="primary",this.showLegend$=new b.X(!1),this.inResolutionRange$=new b.X(!0),this.filtersCollapsed=!1,this.header=!0}get datasource(){return this.layer.dataSource}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}handleYearChange(t){this.timeFilterService.filterByYear(this.datasource,t)}handleDateChange(t){this.timeFilterService.filterByDate(this.datasource,t)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}setVisible(){this.layer.visible=!0}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(uu))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},decls:8,vars:7,consts:[[4,"ngIf"],[1,"igo-datasource-filters-container"],["filters",""],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer","options","currentValue","change","yearChange"],["mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matLine","",3,"ngStyle","click"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[3,"layer"]],template:function(t,o){1&t&&(e.YNc(0,d0,5,7,"mat-list-item",0),e.TgZ(1,"div",1,2)(3,"div",3,4),e.YNc(5,g0,1,1,"igo-layer-legend",5),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"igo-time-filter-form",6),e.NdJ("change",function(s){return o.handleDateChange(s)})("yearChange",function(s){return o.handleYearChange(s)}),e.qZA()()),2&t&&(e.Q6J("ngIf",o.header),e.xp6(5),e.Q6J("ngIf",e.lcZ(6,5,o.showLegend$)),e.xp6(2),e.Q6J("layer",o.layer)("options",o.datasource.options.timeFilter)("currentValue",o.datasource.options.params.TIME))},styles:["[_nghost-%COMP%]{overflow:hidden}.igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}"]}),i})();function m0(i,r){if(1&i&&e._UZ(0,"igo-time-filter-item",2),2&i){const t=r.$implicit;e.Q6J("header",!0)("layer",t)}}let Qr=(()=>{class i{constructor(t){this.cdRef=t,this._layers=[]}get layers(){return this._layers}set layers(t){this._layers=t,this.cdRef.detectChanges()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-list",0),e.YNc(1,m0,1,2,"ng-template",1),e.ALo(2,"filterableDataSource"),e.qZA()),2&t&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.xi3(2,3,o.layers,"time")))},encapsulation:2,changeDetection:0}),i})(),f0=(()=>{class i{constructor(){}wktToFeature(t,o,n){return(new Fn.Z).readFeature(t,{dataProjection:o,featureProjection:n})}extentToWkt(t,o,n){let s=V.$A(o,n,t);return s=this.roundCoordinateArray(s,t,0),{wktPoly:`POLYGON((\n      ${o[0]} ${o[1]},\n      ${o[0]} ${o[3]},\n      ${o[2]} ${o[3]},\n      ${o[2]} ${o[1]},\n      ${o[0]} ${o[1]}))`,wktLine:`LINESTRING(\n      ${o[0]} ${o[1]},\n      ${o[0]} ${o[3]},\n      ${o[2]} ${o[3]},\n      ${o[2]} ${o[1]},\n      ${o[0]} ${o[1]})`,wktMultiPoints:`MULTIPOINT(\n        ${o[0]} ${o[1]},\n        ${o[0]} ${o[3]},\n        ${o[2]} ${o[3]},\n        ${o[2]} ${o[1]})`}}roundCoordinateArray(t,o,n=0){const a=V.U2(o).getUnits();return-1!==["ft","m","us-ft"].indexOf(a)&&(t=this.roundArray(t,n)),t}roundArray(t,o=0){let n=0;for(;n<t.length;)t[n]=t[n].toFixed(o),n++;return t}snrcToWkt(t,o){let n;t=t.toLowerCase();const s={1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}},a={1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}},l=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],c=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]];let g=!1,h=!1,m=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(t)?m=!0:/\d{2,3}[a-p]/gi.test(t)?h=!0:/\d{2,3}/gi.test(t)&&(g=!0),g?t+="a01":h&&(t+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(t)){const v=t.split(/(?=[a-p])/gi),S=v[0],M=v[1][0],A=v[1].split(M)[1];let F=1;3===S.length&&(F=2);const k=S.substring(0,F),ne=S.substring(F),se=8,z=4,de=2,ge=1,xe=.5,pe=.25;let W=0,ze=0,me=0,We=0;l.forEach(So=>{-1!==So.indexOf(M)&&(ze=l.indexOf(So),W=So.indexOf(M))}),c.forEach(So=>{-1!==So.indexOf(A)&&(We=c.indexOf(So),me=So.indexOf(A))});let zo=0,Zo=0,ir=0,cn=0,wi=se,un=z;h?(zo=W*de,Zo=ze*ge,ir=0,cn=0,wi=de,un=ge):m&&(zo=W*de,Zo=ze*ge,ir=me*xe,cn=We*pe,wi=xe,un=pe);const re={ul:[s[k].to+zo+ir,a[ne].to-Zo-cn]};return re.lr=[re.ul[0]+wi,re.ul[1]-un],re.ur=[re.ul[0],re.ul[1]-un],re.ll=[re.ul[0]+wi,re.ul[1]],re.ul=V.vs([re.ul[0],re.ul[1]],"EPSG:4326",o),re.lr=V.vs([re.lr[0],re.lr[1]],"EPSG:4326",o),re.ur=V.vs([re.ur[0],re.ur[1]],"EPSG:4326",o),re.ll=V.vs([re.ll[0],re.ll[1]],"EPSG:4326",o),re.ul=this.roundCoordinateArray(re.ul,o,0),re.lr=this.roundCoordinateArray(re.lr,o,0),re.ur=this.roundCoordinateArray(re.ur,o,0),re.ll=this.roundCoordinateArray(re.ll,o,0),n="POLYGON(("+[re.ul.join(" "),re.ur.join(" "),re.lr.join(" "),re.ll.join(" "),re.ul.join(" ")].join(",")+"))",{wktPoly:n,wktLine:"LINESTRING("+[re.ul.join(" "),re.ur.join(" "),re.lr.join(" "),re.ll.join(" "),re.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[re.ul.join(" "),re.ur.join(" "),re.lr.join(" "),re.ll.join(" ")].join(",")+")"}}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function _0(i,r){if(1&i&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.alias)("id",t.name)("matTooltip",t.alias),e.xp6(1),e.hij(" ",t.alias," ")}}function y0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.clearSelectedField())}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function v0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",17),e.NdJ("mouseenter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable="selectField")})("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable=void 0)}),e.TgZ(1,"input",18),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.updateFieldsList(n.target.value))}),e.ALo(2,"translate"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"mat-autocomplete",19,20),e.NdJ("optionSelected",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeField(n.option.id))}),e.YNc(10,_0,2,4,"mat-option",21),e.ALo(11,"async"),e.qZA(),e.YNc(12,y0,2,1,"button",22),e.qZA()}if(2&i){const t=e.MAs(9),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,8,"igo.geo.sourceFields.selectField"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value",e.lcZ(3,10,o.selectedField$)?e.lcZ(4,12,o.selectedField$).alias:"")("matTooltip",e.lcZ(5,14,o.selectedField$)?e.lcZ(6,16,o.selectedField$).alias:e.lcZ(7,18,"igo.geo.sourceFields.selectField")),e.xp6(9),e.Q6J("ngForOf",e.lcZ(11,20,o.filteredFields$)),e.xp6(2),e.Q6J("ngIf",o.currentFilter.propertyName&&"selectField"===o.inputClearable&&o.currentFilter.active)}}function b0(i,r){if(1&i&&(e.TgZ(0,"mat-option",3),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key)("matTooltip",e.lcZ(1,3,"igo.geo.operators.tooltip."+t.key)),e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.geo.operators."+t.key)," ")}}function C0(i,r){if(1&i&&(e.TgZ(0,"mat-option",29),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.type),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialSelector."+t.type)," ")}}function x0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",26)(1,"mat-select",27),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeSpatialSelector(n.value))}),e.YNc(2,C0,3,4,"mat-option",28),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("disabled",!t.currentFilter.active)("value",t.currentFilter.igoSpatialSelector),e.xp6(1),e.Q6J("ngForOf",t.igoSpatialSelectors)}}function S0(i,r){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t),e.xp6(1),e.hij(" ",t," ")}}function w0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.clearProperty())}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function T0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",30),e.NdJ("mouseenter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable="selectProperty")})("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable=void 0)}),e.TgZ(1,"input",18),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.updateValuesList(n.target.value))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",19,31),e.NdJ("optionSelected",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeProperty(n.option.value))}),e.YNc(5,S0,2,3,"mat-option",32),e.ALo(6,"async"),e.qZA(),e.YNc(7,w0,2,1,"button",22),e.qZA()}if(2&i){const t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,8,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","expression"===o.detectProperty()?o.currentFilter.expression:o.currentFilter.pattern)("matTooltip","expression"===o.detectProperty()?o.currentFilter.expression||"":o.currentFilter.pattern||""),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,10,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable()&&"selectProperty"===o.inputClearable&&o.currentFilter.active)}}function M0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.currentFilter.igoSNRC="")}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active&&"selectSNRC"===t.inputClearable&&t.currentFilter.active)}}function F0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",34),e.NdJ("mouseenter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable="selectSNRC")})("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable=void 0)}),e.TgZ(1,"input",35),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeSNRC(n.target.value))}),e.ALo(2,"translate"),e.qZA(),e.YNc(3,M0,2,1,"button",22),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("floatLabel",t.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,5,"igo.geo.filter.placeholderSnrc"))("value",t.currentFilter.igoSNRC)("matTooltip",t.currentFilter.igoSNRC?t.currentFilter.igoSNRC:""),e.xp6(2),e.Q6J("ngIf",t.currentFilter.igoSNRC)}}function A0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",37),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.changeMapExtentGeometry())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",38),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)("disabled",!t.currentFilter.active)("matTooltip",e.lcZ(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function L0(i,r){if(1&i&&(e.ynx(0),e.YNc(1,A0,3,5,"button",36),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf","fixedExtent"===t.currentFilter.igoSpatialSelector)}}function I0(i,r){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t),e.xp6(1),e.hij(" ",t," ")}}function O0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.clearProperty(1))}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function Z0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",39),e.NdJ("mouseenter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable="selectProperty1")})("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable=void 0)}),e.TgZ(1,"input",40),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.updateValuesList(n.target.value,1))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",19,41),e.NdJ("optionSelected",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeNumericProperty(n.option.value,1))}),e.YNc(5,I0,2,3,"mat-option",32),e.ALo(6,"async"),e.qZA(),e.YNc(7,O0,2,1,"button",22),e.qZA()}if(2&i){const t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,7,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","lowerBoundary"===o.detectProperty(1)?o.currentFilter.lowerBoundary:o.currentFilter.begin),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,9,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable(1)&&"selectProperty1"===o.inputClearable&&o.currentFilter.active)}}function D0(i,r){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t),e.xp6(1),e.hij(" ",t," ")}}function k0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.clearProperty(2))}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function P0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",39),e.NdJ("mouseenter",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable="selectProperty2")})("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.inputClearable=void 0)}),e.TgZ(1,"input",40),e.NdJ("input",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.updateValuesList(n.target.value,2))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",19,42),e.NdJ("optionSelected",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeNumericProperty(n.option.value,2))}),e.YNc(5,D0,2,3,"mat-option",32),e.ALo(6,"async"),e.qZA(),e.YNc(7,k0,2,1,"button",22),e.qZA()}if(2&i){const t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,7,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","upperBoundary"===o.detectProperty(2)?o.currentFilter.upperBoundary:o.currentFilter.end),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,9,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable(2)&&"selectProperty2"===o.inputClearable&&o.currentFilter.active)}}function $0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-ogc-filter-time",43),e.NdJ("datasourceChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.datasource=n)})("currentFilterChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.currentFilter=n)})("changeProperty",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeProperty(n.value,n.pos))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("datasource",t.datasource)("currentFilter",t.currentFilter)}}const E0=function(i,r){return{logical:i,logicalHidden:r}},J0=function(i,r){return{operator:i,dualInput:r}},R0=function(){return["expression","pattern"]},B0=function(){return["lowerBoundary","begin"]},U0=function(){return["upperBoundary","end"]};let Lu=(()=>{class i{constructor(t){this.wktService=t,this.ogcFilterOperator=$,this.ogcFilterOperators$=new b.X(void 0),this.value="",this.selectedField$=new b.X(void 0),this.fields$=new b.X([]),this.color="primary",this.currentFilterIsSpatial$=new b.X(!1),this.defaultStepMillisecond=6e3,this._snrc="",this.floatLabel="never",this.allOgcFilterOperators=(new Rt).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}set snrc(t){(/^\d{2}$/gi.test(t)||/^\d{2}[a-p]$/gi.test(t)||/^\d{2}[a-l][0,1][0-9]$/gi.test(t))&&(this._snrc=t,this.currentFilter.igoSNRC=t)}get snrc(){return this._snrc}get activeFilters(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(t=>!0===t.active)}get allowedOperators(){return(new Rt).computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}ngOnInit(){if(this.datasource.options.sourceFields){const t=this.datasource.options.sourceFields.filter(o=>void 0===o.excludeFromOgcFilters||!o.excludeFromOgcFilters);t.map(o=>{o.values&&o.values.sort()}),this.fields$.next(t)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(t=>t.name===this.currentFilter.propertyName)),this.updateValuesList(),this.selectedField$.subscribe(t=>{this.ogcFilterOperators$.next(this.allowedOperators),-1===Object.keys(this.allowedOperators).indexOf(this.currentFilter.operator)&&(this.currentFilter.operator=Object.keys(this.allowedOperators)[0],this.currentFilter.operator=Object.keys(this.allowedOperators)[0]),this.updateValuesList()}),this.currentFilterIsSpatial()}updateFieldsList(t){this.filteredFields$=t&&t.length>0?(0,X.of)(this._filterFields(t)):this.fields$,this.fields$.value.find(o=>o.name===t)&&this.changeField(t)}updateValuesList(t,o){this.filteredValues$=(0,X.of)(t&&t.length>0?this._filterValues(t):this.selectedField$.value?this.selectedField$.value.values:[]),t&&t.length>=1&&this.changeProperty(t,o)}_filterFields(t){const o=new RegExp(t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(n=>o.test(n.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}_filterValues(t){const o=new RegExp(t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value.values.filter(n=>n&&o.test(n.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}clearSelectedField(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}isClearable(t){const o=this.detectProperty(t);if(o)return this.currentFilter[o]}clearProperty(t){const o=this.detectProperty(t);if(o)return this.currentFilter[o]=""}toggleFilterState(t){this.datasource.options.ogcFilters.interfaceOgcFilters.find(o=>o.filterid===this.currentFilter.filterid).active=t.checked,this.refreshFilters()}deleteFilter(){const t=this.datasource.options.ogcFilters;t.interfaceOgcFilters=t.interfaceOgcFilters.filter(o=>o.filterid!==this.currentFilter.filterid),this.refreshFilters()}changeLogical(t){this.currentFilter.parentLogical=t,this.refreshFilters()}changeOperator(t){this.currentFilter.operator=t,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&0===this.currentFilter.wkt_geometry.length?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}changeField(t){this.currentFilter.propertyName=t,this.selectedField$.next(this.fields$.value.find(o=>o.name===this.currentFilter.propertyName)),this.refreshFilters()}changeCaseSensitive(t){this.currentFilter.matchCase=t.checked,this.refreshFilters()}changeProperty(t,o,n=!0){const s=this.detectProperty(o);s&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(a=>a.filterid===this.currentFilter.filterid)[s]=t,n&&this.refreshFilters())}changeNumericProperty(t,o){this.changeProperty(parseFloat(t),o)}changeSpatialSelector(t){this.currentFilter.igoSpatialSelector=t,"fixedExtent"===t&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}changeSNRC(t){this.snrc=t,this.changeSNRCGeometry()}changeSNRCGeometry(){!this.datasource.options.ogcFilters.interfaceOgcFilters.find(o=>o.filterid===this.currentFilter.filterid)||(this.snrc&&"snrc"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}changeMapExtentGeometry(t=!0){!this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid)||("fixedExtent"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),t&&this.refreshFilters())}detectProperty(t){switch(this.currentFilter.operator){case $.PropertyIsNotEqualTo:case $.PropertyIsEqualTo:case $.PropertyIsGreaterThan:case $.PropertyIsGreaterThanOrEqualTo:case $.PropertyIsLessThan:case $.PropertyIsLessThanOrEqualTo:return"expression";case $.PropertyIsLike:return"pattern";case $.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case $.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}currentFilterIsSpatial(){let t=!1;this.currentFilter&&(t=-1!==[$.Contains,$.Intersects,$.Within].indexOf(this.currentFilter.operator)),this.currentFilterIsSpatial$.next(t)}isTemporalOperator(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},decls:42,vars:76,consts:[["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","click","change"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"disabled","value","matTooltip","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","value","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty",4,"ngIf"],[1,"field",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","disabled","matAutocomplete","value","matTooltip","input"],[3,"optionSelected"],["autoCompleteField","matAutocomplete"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click"],["svgIcon","close"],[1,"spatialSelector"],[3,"disabled","value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"floatLabel","mouseenter","mouseleave"],["autoCompleteValues","matAutocomplete"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","value","matTooltip","input"],["mat-button","","matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["mat-button","","matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click"],["svgIcon","arrow-expand-all"],[1,"dualInput",3,"floatLabel","mouseenter","mouseleave"],["matInput","","type","number",3,"placeholder","disabled","matAutocomplete","value","input"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-checkbox",0),e.NdJ("click",function(s){return s.stopPropagation()})("change",function(s){return o.toggleFilterState(s)}),e.ALo(1,"translate"),e.qZA(),e.TgZ(2,"mat-form-field",1)(3,"mat-select",2),e.NdJ("selectionChange",function(s){return o.changeLogical(s.value)}),e.ALo(4,"translate"),e.TgZ(5,"mat-option",3),e.ALo(6,"translate"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-option",3),e.ALo(10,"translate"),e._uU(11),e.ALo(12,"translate"),e.qZA()()(),e.YNc(13,v0,13,22,"mat-form-field",4),e.ALo(14,"async"),e.ALo(15,"async"),e.ALo(16,"async"),e.ALo(17,"async"),e.TgZ(18,"mat-form-field",5),e.ALo(19,"async"),e.ALo(20,"async"),e.TgZ(21,"mat-select",6),e.NdJ("selectionChange",function(s){return o.changeOperator(s.value)}),e.ALo(22,"translate"),e.ALo(23,"translate"),e.YNc(24,b0,4,7,"mat-option",7),e.ALo(25,"keyvalue"),e.ALo(26,"async"),e.qZA()(),e.YNc(27,x0,3,3,"mat-form-field",8),e.ALo(28,"async"),e.YNc(29,T0,8,12,"mat-form-field",9),e.TgZ(30,"div",10)(31,"button",11),e.NdJ("click",function(){return o.deleteFilter()}),e.ALo(32,"translate"),e._UZ(33,"mat-icon",12),e.qZA()(),e.YNc(34,F0,4,7,"mat-form-field",13),e.ALo(35,"async"),e.YNc(36,L0,2,1,"ng-container",14),e.ALo(37,"async"),e._UZ(38,"br"),e.YNc(39,Z0,8,11,"mat-form-field",15),e.YNc(40,P0,8,11,"mat-form-field",15),e.YNc(41,$0,1,2,"igo-ogc-filter-time",16)),2&t&&(e.Q6J("matTooltip",e.lcZ(1,27,"igo.geo.filter.toggleFilterState"))("checked",o.currentFilter.active),e.xp6(2),e.Q6J("ngClass",e.WLB(67,E0,0!==o.activeFilters.indexOf(o.currentFilter)&&!0===o.currentFilter.active,0===o.activeFilters.indexOf(o.currentFilter)||!0!==o.currentFilter.active)),e.xp6(1),e.Q6J("disabled",!o.currentFilter.active)("value",o.currentFilter.parentLogical)("matTooltip",o.currentFilter.parentLogical?e.lcZ(4,29,"igo.geo.operators.tooltip."+o.currentFilter.parentLogical):""),e.xp6(2),e.Q6J("value",o.ogcFilterOperator.And)("matTooltip",e.lcZ(6,31,"igo.geo.operators.tooltip.And")),e.xp6(2),e.hij(" ",e.lcZ(8,33,"igo.geo.operators.And")," "),e.xp6(2),e.Q6J("value",o.ogcFilterOperator.Or)("matTooltip",e.lcZ(10,35,"igo.geo.operators.tooltip.Or")),e.xp6(2),e.hij(" ",e.lcZ(12,37,"igo.geo.operators.Or")," "),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(14,39,o.currentFilterIsSpatial$)&&e.lcZ(15,41,o.fields$)&&e.lcZ(16,43,o.fields$).length>0&&""!==e.lcZ(17,45,o.fields$)[0].name),e.xp6(5),e.Q6J("ngClass",e.WLB(70,J0,!1===e.lcZ(19,47,o.currentFilterIsSpatial$),e.lcZ(20,49,o.currentFilterIsSpatial$)))("floatLabel",o.floatLabel),e.xp6(3),e.Q6J("matTooltip",o.currentFilter.operator?e.lcZ(22,51,"igo.geo.operators.tooltip."+o.currentFilter.operator):e.lcZ(23,53,"igo.geo.filter.selectOperator"))("disabled",!o.currentFilter.active)("value",o.currentFilter.operator),e.xp6(3),e.Q6J("ngForOf",e.lcZ(25,55,e.lcZ(26,57,o.ogcFilterOperators$))),e.xp6(3),e.Q6J("ngIf",e.lcZ(28,59,o.currentFilterIsSpatial$)),e.xp6(2),e.Q6J("ngIf",-1!==e.DdM(73,R0).indexOf(o.detectProperty())),e.xp6(2),e.Q6J("matTooltip",e.lcZ(32,61,"igo.geo.filter.removeFilter")),e.xp6(3),e.Q6J("ngIf",e.lcZ(35,63,o.currentFilterIsSpatial$)&&"snrc"===o.currentFilter.igoSpatialSelector),e.xp6(2),e.Q6J("ngIf",e.lcZ(37,65,o.currentFilterIsSpatial$)&&"fixedExtent"===o.currentFilter.igoSpatialSelector),e.xp6(3),e.Q6J("ngIf",!o.isTemporalOperator()&&-1!==e.DdM(74,B0).indexOf(o.detectProperty(1))),e.xp6(1),e.Q6J("ngIf",!o.isTemporalOperator()&&-1!==e.DdM(75,U0).indexOf(o.detectProperty(2))),e.xp6(1),e.Q6J("ngIf",o.isTemporalOperator()))},styles:["[_nghost-%COMP%]{width:100%;padding:5px 10px}  .mat-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}.mat-form-field[_ngcontent-%COMP%]{width:100%}.mat-select-arrow[_ngcontent-%COMP%]{visibility:hidden}.mat-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}.logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:10%;max-width:45px;margin-left:5px}.logicalHidden[_ngcontent-%COMP%]{flex-flow:column nowrap;width:10%;visibility:hidden;max-width:45px;margin-left:5px}  .logical .mat-select-arrow{visibility:hidden}  .logicalHidden .mat-select-arrow{visibility:hidden}.field[_ngcontent-%COMP%]{width:20%}  .field .mat-select-arrow{visibility:hidden}.operator[_ngcontent-%COMP%]{width:12%;margin-left:10px;text-align:center}  .operator .mat-select-arrow{visibility:hidden}.spatialSelector[_ngcontent-%COMP%]{width:15%;margin-left:5px}  .spatialSelector .mat-select-arrow{visibility:hidden}.singleInput[_ngcontent-%COMP%]{width:30%;margin-left:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.singleInput[_ngcontent-%COMP%]{width:27%}}.snrc[_ngcontent-%COMP%]{width:20%;margin-left:5px}  .singleInput .mat-select-arrow{visibility:hidden}.dualInput[_ngcontent-%COMP%]{width:20%;margin-left:5px}  .dualInput .mat-select-arrow{visibility:hidden}.igo-layer-button-group[_ngcontent-%COMP%]{display:flex;float:right;padding-top:5px}.container[_ngcontent-%COMP%]{display:flex}"]}),i})();function N0(i,r){if(1&i&&e._UZ(0,"igo-ogc-filter-selection",2),2&i){const t=e.oxw();e.Q6J("refreshFilters",t.refreshFunc)("datasource",t.datasource)("map",t.map)("currentFilter",t.currentFilter)}}function q0(i,r){if(1&i&&e._UZ(0,"igo-ogc-filter-form",4),2&i){const t=r.$implicit,o=e.oxw(2);e.Q6J("currentFilter",t)("refreshFilters",o.refreshFunc)("datasource",o.datasource)("map",o.map)}}function G0(i,r){if(1&i&&e.YNc(0,q0,1,4,"ng-template",3),2&i){const t=e.oxw();e.Q6J("ngForOf",t.datasource.options.ogcFilters.interfaceOgcFilters)}}let Iu=(()=>{class i{constructor(){this.color="primary"}get refreshFunc(){return this.refreshFilters}get advancedOgcFilters(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}get currentFilter(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(t,o){1&t&&(e.YNc(0,N0,1,4,"igo-ogc-filter-selection",0),e.YNc(1,G0,1,1,null,1)),2&t&&(e.Q6J("ngIf",!o.advancedOgcFilters),e.xp6(1),e.Q6J("ngIf",o.advancedOgcFilters&&o.datasource.options.ogcFilters.editable))},encapsulation:2}),i})();function Q0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-icon",9),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleFiltersCollapsed())}),e.qZA()}if(2&i){const t=e.oxw(),o=e.MAs(7);e.Q6J("target",o)("collapsed",t.filtersCollapsed)}}const j0=function(i){return{cursor:i}};function Y0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"h4",10),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleLegendOnClick())}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngStyle",e.VKq(3,j0,t.filtersCollapsed?"default":"pointer"))("matTooltip",t.layer.title),e.xp6(1),e.Oqu(t.layer.title)}}function H0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.addFilterToSequence())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",12),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.addFilterDisabled())("matTooltip",e.lcZ(1,3,"igo.geo.filter.addFilter"))("color",t.color)}}const V0=function(i){return{disabled:i}};function z0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.layer.visible=!n.layer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",14),e.ALo(4,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,4,"igo.geo.layer.hideLayer"):e.lcZ(2,6,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("ngClass",e.VKq(10,V0,!1===e.lcZ(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function W0(i,r){if(1&i&&e._UZ(0,"igo-layer-legend",18),2&i){const t=e.oxw(2);e.Q6J("layer",t.layer)}}function K0(i,r){if(1&i&&(e.TgZ(0,"div",15,16),e.YNc(2,W0,1,1,"igo-layer-legend",17),e.ALo(3,"async"),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",e.lcZ(3,1,t.showLegend$))}}function X0(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"section",19),e._UZ(1,"mat-divider"),e.TgZ(2,"mat-checkbox",20),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeOgcFilterType(n))})("ngModelChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.datasource.options.ogcFilters.advancedOgcFilters=n)}),e._uU(3),e.ALo(4,"translate"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.datasource.options.ogcFilters.advancedOgcFilters),e.xp6(1),e.hij(" ",e.lcZ(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}const eC=function(i){return{"separate-item":i}};let Vn=(()=>{class i{constructor(t){this.ogcFilterService=t,this.color="primary",this.defaultLogicalParent=$.And,this.hasActiveSpatialFilter=!1,this.filtersAreEditable=!0,this.filtersCollapsed=!0,this.hasSelector=!1,this.showLegend$=new b.X(!1),this.inResolutionRange$=new b.X(!0),this.header=!0,this.ogcFilterWriter=new Rt}get refreshFunc(){return this.refreshFilters.bind(this)}get datasource(){return this.layer.dataSource}ngOnInit(){this.layer.visible&&(this.filtersCollapsed=!1);const t=this.datasource.options.ogcFilters;switch((t.pushButtons&&t.pushButtons.bundles.length>0||t.checkboxes&&t.checkboxes.bundles.length>0||t.radioButtons&&t.radioButtons.bundles.length>0||t.select&&t.select.bundles.length>0||t.autocomplete&&t.autocomplete.bundles.length>0)&&(void 0===t.advancedOgcFilters&&(t.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}t&&(t.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(t.interfaceOgcFilters)),t.interfaceOgcFilters.filter(n=>n.wkt_geometry).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!t.editable&&t.editable),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}addFilterToSequence(){this.filtersCollapsed=!1;const o=this.datasource.options.ogcFilters.interfaceOgcFilters||[],n=0===o.length?0:o[o.length-1].level;let s="";const a=this.datasource.options.sourceFields.filter(d=>!d.excludeFromOgcFilters);let l;a.length>0&&(s=void 0===a[0].name?"":a[0].name);const c=this.datasource.options;c.fieldNameGeometry?l=c.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(l=this.datasource.options.paramsWFS.fieldNameGeometry);const u=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,s,this.datasource.options.ogcFilters.allowedOperatorsType),p=Object.keys(u)[0];o.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:s,operator:p,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},l,n,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=o}refreshFilters(t){!0===t&&(this.lastRunOgcFilter=void 0);const o=this.datasource.options.ogcFilters,n=o.interfaceOgcFilters?o.interfaceOgcFilters.filter(s=>!0===s.active):[];if(0===n.length&&(o.filters=void 0,o.filtered=!1),n.length>1&&(n[0].parentLogical=n[1].parentLogical),this.hasActiveSpatialFilter=0!==n.filter(s=>-1!==["Contains","Intersects","Within"].indexOf(s.operator)).length,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(n)){if("wfs"===this.layer.dataSource.options.type)this.layer.dataSource.options.ogcFilters.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),this.layer.dataSource.ol.refresh();else if("wms"===this.layer.dataSource.options.type&&o.enabled){let s="";if(n.length>=1){const a=this.layer.dataSource,l=a.options.ogcFilters;l.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),s=this.ogcFilterWriter.buildFilter(l.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,a.options)}this.ogcFilterService.filterByOgc(this.datasource,s),this.datasource.options.ogcFilters.filtered=0!==n.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(n))}this.layer.dataSource.setOgcFilters(o,!0)}setVisible(){this.layer.visible=!0}isAdvancedOgcFilters(){return this.datasource.options.ogcFilters.advancedOgcFilters}addFilterDisabled(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length}changeOgcFiltersAdvancedOgcFilters(t){this.datasource.options.ogcFilters.advancedOgcFilters=t}changeOgcFilterType(t){this.changeOgcFiltersAdvancedOgcFilters(t.checked),t.checked&&this.refreshFilters(!0)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Fa))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},decls:11,vars:12,consts:[[3,"ngClass"],["class","igo-chevron","mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",3,"target","collapsed","click",4,"ngIf"],["matLine","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["ogcFilters",""],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matLine","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click"],["svgIcon","plus"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],["labelPosition","before",3,"ngModel","change","ngModelChange"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mat-list-item"),e.YNc(2,Q0,1,2,"mat-icon",1),e.YNc(3,Y0,2,5,"h4",2),e.YNc(4,H0,3,5,"button",3),e.YNc(5,z0,5,12,"button",4),e.qZA(),e.TgZ(6,"div",null,5),e.YNc(8,K0,4,3,"div",6),e._UZ(9,"igo-ogc-filterable-form",7),e.YNc(10,X0,5,4,"section",8),e.qZA()()),2&t&&(e.Q6J("ngClass",e.VKq(10,eC,!0===o.header)),e.xp6(2),e.Q6J("ngIf",o.header),e.xp6(1),e.Q6J("ngIf",o.header),e.xp6(1),e.Q6J("ngIf",o.isAdvancedOgcFilters()&&o.filtersAreEditable),e.xp6(1),e.Q6J("ngIf",o.header),e.xp6(3),e.Q6J("ngIf",o.header),e.xp6(1),e.Q6J("datasource",o.datasource)("map",o.map)("refreshFilters",o.refreshFunc),e.xp6(1),e.Q6J("ngIf",o.hasSelector&&o.filtersAreEditable))},styles:["[_nghost-%COMP%]{overflow:hidden}.advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}.mat-list-item[_ngcontent-%COMP%]{height:auto}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}.separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}"]}),i})();function tC(i,r){1&i&&(e.TgZ(0,"div",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.geo.filter.noFilterableLayer")))}function oC(i,r){if(1&i&&e._UZ(0,"igo-ogc-filterable-item",4),2&i){const t=r.$implicit;e.Q6J("header",!0)("layer",t)("map",t.map)}}let jr=(()=>{class i{constructor(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-list",0),e.YNc(1,tC,3,3,"div",1),e.ALo(2,"filterableDataSource"),e.YNc(3,oC,1,3,"ng-template",2),e.ALo(4,"filterableDataSource"),e.qZA()),2&t&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngIf",0===e.xi3(2,4,o.layers,"ogc").length),e.xp6(2),e.Q6J("ngForOf",e.xi3(4,7,o.layers,"ogc")))},styles:["#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}"],changeDetection:0}),i})();function nC(i,r){if(1&i&&(e.TgZ(0,"button",2),e.ALo(1,"translate"),e._UZ(2,"mat-icon",3),e.qZA()),2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.xp6(2),e.Q6J("matBadge",t.badge)}}function rC(i,r){if(1&i&&e._UZ(0,"igo-ogc-filterable-item",7),2&i){const t=e.oxw(2);e.Q6J("header",!1)("map",t.layer.map)("layer",t.layer)}}function sC(i,r){if(1&i&&(e.TgZ(0,"div",4,5),e.YNc(2,rC,1,3,"igo-ogc-filterable-item",6),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.ogcFilterCollapse&&t.options.ogcFilters.enabled)}}let zn=(()=>{class i{constructor(){this.color="primary",this.ogcFilterCollapse=!1}get badge(){var t,o,n,s,a;const l=this.options.ogcFilters;let c=0;if(l&&!l.advancedOgcFilters){if(l.pushButtons){const p=l.pushButtons.groups.find(g=>g.enabled);let d=0;p&&(null===(t=p.computedSelectors)||void 0===t||t.map(g=>{var h;return d+=null===(h=g.selectors)||void 0===h?void 0:h.filter(m=>m.enabled).length})),c+=d}if(l.checkboxes){const p=l.checkboxes.groups.find(g=>g.enabled);let d=0;p&&(null===(o=p.computedSelectors)||void 0===o||o.map(g=>{var h;return d+=null===(h=g.selectors)||void 0===h?void 0:h.filter(m=>m.enabled).length})),c+=d}if(l.radioButtons){const p=l.radioButtons.groups.find(g=>g.enabled);let d=0;p&&(null===(n=p.computedSelectors)||void 0===n||n.map(g=>{var h;return d+=null===(h=g.selectors)||void 0===h?void 0:h.filter(m=>m.enabled).length})),c+=d}if(l.select){const p=l.select.groups.find(g=>g.enabled);let d=0;p&&(null===(s=p.computedSelectors)||void 0===s||s.map(g=>{var h;return d+=null===(h=g.selectors)||void 0===h?void 0:h.filter(m=>m.enabled).length})),c+=d}if(l.autocomplete){const p=l.autocomplete.groups.find(g=>g.enabled);let d=0;p&&(null===(a=p.computedSelectors)||void 0===a||a.map(g=>{var h;return d+=null===(h=g.selectors)||void 0===h?void 0:h.filter(m=>m.enabled).length})),c+=d}}else{if(l&&l.filters&&!l.filters.filters)return 1;if(l&&l.filters&&l.filters.filters)return l.filters.filters.length}if(l.filters&&"During"===l.filters.operator&&l.filters.active&&l.interfaceOgcFilters&&l.interfaceOgcFilters[0].active){const u=l.interfaceOgcFilters[0];l.filters.calendarModeYear?(u.begin.substring(0,4)!==this.options.minDate.substring(0,4)||u.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(c+=1):(u.begin!==this.options.minDate||u.end!==this.options.maxDate)&&(c+=1)}return c>0?c:void 0}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}ngOnInit(){this.options=this.layer.dataSource.options}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","filter",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(t,o){1&t&&(e.YNc(0,nC,3,5,"button",0),e.YNc(1,sC,3,1,"div",1)),2&t&&(e.Q6J("ngIf",o.header&&o.options.ogcFilters&&o.options.ogcFilters.enabled&&(o.options.ogcFilters.pushButtons||o.options.ogcFilters.checkboxes||o.options.ogcFilters.radioButtons||o.options.ogcFilters.select||o.options.ogcFilters.autocomplete||o.options.ogcFilters.editable)),e.xp6(1),e.Q6J("ngIf",o.options.ogcFilters&&o.options.ogcFilters.enabled&&(o.options.ogcFilters.pushButtons||o.options.ogcFilters.checkboxes||o.options.ogcFilters.radioButtons||o.options.ogcFilters.select||o.options.ogcFilters.autocomplete||o.options.ogcFilters.editable)))},changeDetection:0}),i})(),Ba=(()=>{class i{constructor(){this.defaultStepMillisecond=6e4}step(t,o){return t.options.stepDate?t.options.stepDate:o.step}stepMillisecond(t,o){const n=E.duration(this.step(t,o)).asMilliseconds();return 0===n?this.defaultStepMillisecond:n}stepIsYearDuration(t){const o=E.duration(t);return 0!==o.years()&&0===o.months()&&0===o.weeks()&&0===o.days()&&0===o.hours()&&0===o.minutes()}stepIsMonthDuration(t){const o=E.duration(t);return 0!==o.months()&&0===o.weeks()&&0===o.days()&&0===o.hours()&&0===o.minutes()}stepIsWeekDuration(t){const o=E.duration(t);return 0!==o.weeks()&&7===o.days()&&0===o.hours()&&0===o.minutes()}stepIsDayDuration(t){const o=E.duration(t);return 0!==o.days()&&0===o.hours()&&0===o.minutes()}stepIsHourDuration(t){const o=E.duration(t);return 0!==o.hours()&&0===o.minutes()}stepIsMinuteDuration(t){return 0!==E.duration(t).minutes()}dateToNumber(t){let o=new Date;return t&&(o=new Date(t)),o.getTime()}addStep(t,o){return E(t).add(o,"milliseconds").toDate()}subtractStep(t,o){return E(t).subtract(o,"milliseconds").toDate()}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();const aC=["selection"];function lC(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function cC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",11),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentPushButtonsGroup=n)}),e.ALo(3,"translate"),e.YNc(4,lC,2,2,"mat-option",12),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentPushButtonsGroup),e.xp6(2),e.Q6J("ngForOf",t.getPushButtonsGroups())}}function uC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-button-toggle",16),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectionChange(s,a.selectorType))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("ngStyle",o.getButtonColor(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function pC(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"mat-button-toggle-group",14),e.YNc(4,uC,2,5,"mat-button-toggle",15),e.qZA(),e.BQk()),2&i){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(1),e.s9C("vertical",o.bundleIsVertical(t)),e.xp6(1),e.Q6J("ngForOf",t.selectors)}}function dC(i,r){if(1&i&&(e.TgZ(0,"div",8),e._UZ(1,"mat-divider"),e.YNc(2,cC,5,5,"div",9),e.YNc(3,pC,5,3,"ng-container",1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getPushButtonsGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentPushButtonsGroup.computedSelectors)}}function gC(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function mC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",18),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentCheckboxesGroup=n)}),e.ALo(3,"translate"),e.YNc(4,gC,2,2,"mat-option",12),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentCheckboxesGroup),e.xp6(2),e.Q6J("ngForOf",t.getCheckboxesGroups())}}function hC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",21),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectionChange(s,a.selectorType))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function fC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"u",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(5);return e.KtG(n.displayLessResults("checkbox"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayLessResults")," "))}function _C(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"u",25),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(5);return e.KtG(n.displayMoreResults("checkbox"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayMoreResults")," "))}function yC(i,r){if(1&i&&(e.TgZ(0,"p"),e.YNc(1,fC,3,3,"u",22),e.YNc(2,_C,3,3,"u",23),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"checkbox")),e.xp6(1),e.Q6J("ngIf",o.isMoreResults(t,"checkbox"))}}function vC(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div",19),e.YNc(4,hC,2,4,"mat-checkbox",20),e.qZA(),e.YNc(5,yC,3,2,"p",2),e.BQk()),2&i){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngForOf",t.selectors),e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"checkbox")||o.isMoreResults(t,"checkbox"))}}function bC(i,r){if(1&i&&(e.TgZ(0,"div",17),e._UZ(1,"mat-divider"),e.YNc(2,mC,5,5,"div",9),e.YNc(3,vC,6,3,"ng-container",1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getCheckboxesGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentCheckboxesGroup.computedSelectors)}}function CC(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function xC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",27),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentRadioButtonsGroup=n)}),e.ALo(3,"translate"),e.YNc(4,CC,2,2,"mat-option",12),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentRadioButtonsGroup),e.xp6(2),e.Q6J("ngForOf",t.getRadioButtonsGroups())}}function SC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-radio-button",30),e.NdJ("change",function(){e.CHM(t);const n=e.oxw(4);return e.KtG(n.emptyRadioButtons())}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&i&&(e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.filter.resetFilters")),e.xp6(2),e.hij("",e.lcZ(3,4,"igo.geo.filter.resetFilters")," "))}function wC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-radio-button",21),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectionChange(s,a.selectorType))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function TC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"u",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(5);return e.KtG(n.displayLessResults("radio"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayLessResults")," "))}function MC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"u",25),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(5);return e.KtG(n.displayMoreResults("radio"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayMoreResults")," "))}function FC(i,r){if(1&i&&(e.TgZ(0,"p"),e.YNc(1,TC,3,3,"u",22),e.YNc(2,MC,3,3,"u",23),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"radio")),e.xp6(1),e.Q6J("ngIf",o.isMoreResults(t,"radio"))}}function AC(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"mat-radio-group",28),e.YNc(4,SC,4,6,"mat-radio-button",29),e.YNc(5,wC,2,4,"mat-radio-button",20),e.YNc(6,FC,3,2,"p",2),e.qZA(),e.BQk()),2&i){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",t.unfiltered),e.xp6(1),e.Q6J("ngForOf",t.selectors),e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"radio")||o.isMoreResults(t,"radio"))}}function LC(i,r){if(1&i&&(e.TgZ(0,"div",26),e._UZ(1,"mat-divider"),e.YNc(2,xC,5,5,"div",9),e.YNc(3,AC,7,4,"ng-container",1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getRadioButtonsGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentRadioButtonsGroup.computedSelectors)}}function IC(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function OC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",32),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentSelectGroup=n)}),e.ALo(3,"translate"),e.YNc(4,IC,2,2,"mat-option",12),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentSelectGroup),e.xp6(2),e.Q6J("ngForOf",t.getSelectGroups())}}function ZC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-button",36),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(4);return e.KtG(n.emptySelect())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",37),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.filter.resetFilters"))}const DC=function(){return{standalone:!0}};function kC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",42),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw(5);return e.KtG(s.selectAllSelected=n)})("change",function(){e.CHM(t);const n=e.oxw(5);return e.KtG(n.toggleAllSelection())}),e._uU(1,"Tous "),e.qZA()}if(2&i){const t=e.oxw(5);e.Q6J("ngModel",t.selectAllSelected)("ngModelOptions",e.DdM(2,DC))}}function PC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",43),e.NdJ("onSelectionChange",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.selectOptionClick(n.source.value,s,n))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(5);e.Q6J("matTooltip",o.getToolTip(t))("value",t),e.xp6(1),e.hij("",t.title," ")}}function $C(i,r){if(1&i&&(e.TgZ(0,"div")(1,"mat-select",38,39)(3,"div",19),e.YNc(4,kC,2,3,"mat-checkbox",40),e.qZA(),e.YNc(5,PC,2,3,"mat-option",41),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("multiple",t.multiple)("placeholder",t.title),e.xp6(3),e.Q6J("ngIf",t.multiple),e.xp6(1),e.Q6J("ngForOf",t.selectors)}}function EC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",43),e.NdJ("onSelectionChange",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.selectOptionClick(n.source.value,s))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(5);e.Q6J("matTooltip",o.getToolTip(t))("value",t),e.xp6(1),e.hij("",t.title," ")}}function JC(i,r){if(1&i&&(e.TgZ(0,"mat-select",44),e.YNc(1,EC,2,3,"mat-option",41),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("placeholder",t.title),e.xp6(1),e.Q6J("ngForOf",t.selectors)}}function RC(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,ZC,3,3,"mat-button",33),e.TgZ(5,"mat-form-field"),e.YNc(6,$C,6,4,"div",34),e.YNc(7,JC,2,2,"ng-template",null,35,e.W1O),e.qZA()(),e.BQk()),2&i){const t=r.$implicit,o=e.MAs(8);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",t.unfiltered&&!t.multiple),e.xp6(1),e.Udp("width",t.width?t.width:void 0,"%"),e.xp6(1),e.Q6J("ngIf",t.multiple)("ngIfElse",o)}}function BC(i,r){if(1&i&&(e.TgZ(0,"div",31),e._UZ(1,"mat-divider"),e.YNc(2,OC,5,5,"div",9),e.YNc(3,RC,9,6,"ng-container",1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getSelectGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentSelectGroup.computedSelectors)}}function UC(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function NC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",46),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentAutocompleteGroup=n)}),e.ALo(3,"translate"),e.YNc(4,UC,2,2,"mat-option",12),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentAutocompleteGroup),e.xp6(2),e.Q6J("ngForOf",t.getAutocompleteGroups())}}function qC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-button",36),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(4);return e.KtG(n.emptyAutocomplete())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",37),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.filter.resetFilters"))}function GC(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.value," ")}}function QC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field"),e._UZ(1,"input",48,49),e.TgZ(3,"mat-autocomplete",50,51),e.NdJ("optionSelected",function(n){e.CHM(t);const s=e.oxw(4);return e.KtG(s.autocompleteOptionClick(n.option.value))}),e.YNc(6,GC,2,2,"mat-option",12),e.ALo(7,"async"),e.qZA()()}if(2&i){const t=e.MAs(4),o=e.oxw().$implicit,n=e.oxw(3);e.Udp("width",o.width?o.width:void 0,"%"),e.xp6(1),e.Q6J("matAutocomplete",t)("placeholder",o.title),e.xp6(2),e.Q6J("displayWith",n.displayFn),e.xp6(3),e.Q6J("ngForOf",e.lcZ(7,6,n.filteredOgcAutocomplete[o.id]))}}function jC(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,qC,3,3,"mat-button",33),e.YNc(5,QC,8,8,"mat-form-field",47),e.qZA(),e.BQk()),2&i){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",t.unfiltered),e.xp6(1),e.Q6J("ngIf",o.filteredOgcAutocomplete[t.id])}}function YC(i,r){if(1&i&&(e.TgZ(0,"div",45),e._UZ(1,"mat-divider"),e.YNc(2,NC,5,5,"div",9),e.YNc(3,jC,6,3,"ng-container",1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getAutocompleteGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentAutocompleteGroup.computedSelectors)}}function HC(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,dC,4,2,"div",3),e.YNc(2,bC,4,2,"div",4),e.YNc(3,LC,4,2,"div",5),e.YNc(4,BC,4,2,"div",6),e.YNc(5,YC,4,2,"div",7),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf","pushButton"===t.selectorType),e.xp6(1),e.Q6J("ngIf","checkbox"===t.selectorType),e.xp6(1),e.Q6J("ngIf","radioButton"===t.selectorType),e.xp6(1),e.Q6J("ngIf","select"===t.selectorType),e.xp6(1),e.Q6J("ngIf","autocomplete"===t.selectorType)}}function VC(i,r){1&i&&(e.TgZ(0,"h4"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.geo.filter.reportingDate")))}function zC(i,r){if(1&i&&(e.TgZ(0,"h4"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.currentFilter.title)}}function WC(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"mat-divider"),e.YNc(2,VC,3,3,"h4",2),e.YNc(3,zC,2,1,"h4",2),e.TgZ(4,"igo-ogc-filter-time",52),e.NdJ("datasourceChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.datasource=n)})("currentFilterChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.currentFilter=n)})("changeProperty",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeProperty(n.value,n.pos))}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.currentFilter.title),e.xp6(1),e.Q6J("ngIf",t.currentFilter.title),e.xp6(1),e.Q6J("datasource",t.datasource)("currentFilter",t.currentFilter)}}let Ou=(()=>{class i{constructor(t,o,n,s,a){this.ogcFilterService=t,this.formBuilder=o,this.domService=n,this.configService=s,this.cdRef=a,this.checkboxesIndex=5,this.radioButtonsIndex=5,this.baseIndex=5,this.ogcFilterOperator=$,this.color="primary",this.selectAllSelected=!1,this.selectEnabled$=new b.X(void 0),this.selectEnableds$=new b.X([]),this.autocompleteEnabled$=new b.X(void 0),this.filteredOgcAutocomplete={},this.ogcFilterWriter=new Rt,this.buildForm()}get currentFilter(){return this._currentFilter}set currentFilter(t){var o;this._currentFilter=t,null!==(o=this._currentFilter)&&void 0!==o&&o.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}get ogcFiltersSelectors(){var t,o,n,s,a,l,c,u,p,d,g,h,m,y,v,S,M,A,F,k,ne,se,z,de,ge,xe,pe,W,ze,me;const We=[];return!(null===(n=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)||void 0===n)&&n.pushButtons&&We.push(null===(l=null===(a=null===(s=this.datasource)||void 0===s?void 0:s.options)||void 0===a?void 0:a.ogcFilters)||void 0===l?void 0:l.pushButtons),!(null===(p=null===(u=null===(c=this.datasource)||void 0===c?void 0:c.options)||void 0===u?void 0:u.ogcFilters)||void 0===p)&&p.checkboxes&&We.push(null===(h=null===(g=null===(d=this.datasource)||void 0===d?void 0:d.options)||void 0===g?void 0:g.ogcFilters)||void 0===h?void 0:h.checkboxes),!(null===(v=null===(y=null===(m=this.datasource)||void 0===m?void 0:m.options)||void 0===y?void 0:y.ogcFilters)||void 0===v)&&v.radioButtons&&We.push(null===(A=null===(M=null===(S=this.datasource)||void 0===S?void 0:S.options)||void 0===M?void 0:M.ogcFilters)||void 0===A?void 0:A.radioButtons),!(null===(ne=null===(k=null===(F=this.datasource)||void 0===F?void 0:F.options)||void 0===k?void 0:k.ogcFilters)||void 0===ne)&&ne.select&&We.push(null===(de=null===(z=null===(se=this.datasource)||void 0===se?void 0:se.options)||void 0===z?void 0:z.ogcFilters)||void 0===de?void 0:de.select),!(null===(pe=null===(xe=null===(ge=this.datasource)||void 0===ge?void 0:ge.options)||void 0===xe?void 0:xe.ogcFilters)||void 0===pe)&&pe.autocomplete&&We.push(null===(me=null===(ze=null===(W=this.datasource)||void 0===W?void 0:W.options)||void 0===ze?void 0:ze.ogcFilters)||void 0===me?void 0:me.autocomplete),We.sort((zo,Zo)=>zo.order<Zo.order?-1:zo.order>Zo.order?1:0),We}get currentPushButtonsGroup(){return this.form.get("pushButtonsGroup").value}set currentPushButtonsGroup(t){this.form.patchValue({pushButtonsGroup:t})}get currentCheckboxesGroup(){return this.form.get("checkboxesGroup").value}set currentCheckboxesGroup(t){this.form.patchValue({checkboxesGroup:t})}get currentRadioButtonsGroup(){return this.form.get("radioButtonsGroup").value}set currentRadioButtonsGroup(t){this.form.patchValue({radioButtonsGroup:t})}get currentSelectGroup(){return this.form.get("selectGroup").value}set currentSelectGroup(t){this.form.patchValue({selectGroup:t}),this.cdRef.detectChanges()}get currentAutocompleteGroup(){return this.form.get("autocompleteGroup").value}set currentAutocompleteGroup(t){this.form.patchValue({autocompleteGroup:t}),this.cdRef.detectChanges()}get selectEnabled(){return this.selectEnabled$.value}set selectEnabled(t){this.selectEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(o=>{var n;null===(n=o.selectors)||void 0===n||n.forEach(s=>{s.enabled=t===s})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get selectEnableds(){return this.selectEnableds$.value}set selectEnableds(t){this.selectEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(o=>{var n;null===(n=o.selectors)||void 0===n||n.forEach(s=>{s.enabled=!!t.includes(s)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get autocompleteEnabled(){return this.autocompleteEnabled$.value}set autocompleteEnabled(t){this.autocompleteEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(o=>{var n;null===(n=o.selectors)||void 0===n||n.forEach(s=>{s.enabled=t===s.title})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}buildForm(){this.form=this.formBuilder.group({pushButtons:["",[_.kI.required]],radioButtons:["",[_.kI.required]],pushButtonsGroup:["",[_.kI.required]],checkboxesGroup:["",[_.kI.required]],radioButtonsGroup:["",[_.kI.required]],selectGroup:["",[_.kI.required]],select:["",[_.kI.required]],selectMulti:["",[_.kI.required]],autocompleteGroup:["",[_.kI.required]],autocomplete:["",[_.kI.required]]})}getPushButtonsGroups(){var t,o,n;if(null!==(n=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==n&&n.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}getCheckboxesGroups(){var t,o,n;if(null!==(n=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==n&&n.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}getRadioButtonsGroups(){var t,o,n;if(null!==(n=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==n&&n.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}getSelectGroups(){var t,o,n;if(null!==(n=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==n&&n.select)return this.datasource.options.ogcFilters.select.groups}getAutocompleteGroups(){var t,o,n;if(null!==(n=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==n&&n.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}ngOnInit(){return(0,j.mG)(this,void 0,void 0,function*(){this.datasource.options.ogcFilters&&(this.datasource.options.ogcFilters.pushButtons&&(this.currentPushButtonsGroup=this.datasource.options.ogcFilters.pushButtons.groups.find(t=>t.enabled)||this.datasource.options.ogcFilters.pushButtons.groups[0]),this.datasource.options.ogcFilters.checkboxes&&(this.currentCheckboxesGroup=this.datasource.options.ogcFilters.checkboxes.groups.find(t=>t.enabled)||this.datasource.options.ogcFilters.checkboxes.groups[0]),this.datasource.options.ogcFilters.radioButtons&&(this.currentRadioButtonsGroup=this.datasource.options.ogcFilters.radioButtons.groups.find(t=>t.enabled)||this.datasource.options.ogcFilters.radioButtons.groups[0]),this.datasource.options.ogcFilters.select&&(this.currentSelectGroup=this.datasource.options.ogcFilters.select.groups.find(t=>t.enabled)||this.datasource.options.ogcFilters.select.groups[0],this.getSelectEnabled(),yield this.getSelectDomValues()),this.datasource.options.ogcFilters.autocomplete&&(this.currentAutocompleteGroup=this.datasource.options.ogcFilters.autocomplete.groups.find(t=>t.enabled)||this.datasource.options.ogcFilters.autocomplete.groups[0],this.getAutocompleteEnabled(),yield this.getAutocompleteDomValues()),this.applyFilters()),this.form.get("pushButtonsGroup").valueChanges.pipe((0,fe.b)(750)).subscribe(()=>{this.onPushButtonsChangeGroup(),this.applyFilters()}),this.form.get("checkboxesGroup").valueChanges.pipe((0,fe.b)(750)).subscribe(()=>{this.onCheckboxesChangeGroup(),this.applyFilters()}),this.form.get("radioButtonsGroup").valueChanges.pipe((0,fe.b)(750)).subscribe(()=>{this.onRadioButtonsChangeGroup(),this.applyFilters()}),this.form.get("selectGroup").valueChanges.pipe((0,fe.b)(750)).subscribe(()=>{this.onSelectChangeGroup(),this.applyFilters()}),this.form.get("autocompleteGroup").valueChanges.pipe((0,fe.b)(750)).subscribe(()=>{this.onAutocompleteChangeGroup(),this.applyFilters()}),this.form.get("pushButtons").valueChanges.pipe((0,fe.b)(750)).subscribe(()=>{this.applyFilters()}),this.form.get("radioButtons").valueChanges.pipe((0,fe.b)(750)).subscribe(()=>{this.applyFilters()})})}getSelectEnabled(){const t=[];let o;this.currentSelectGroup.computedSelectors.forEach(n=>{var s,a;n.multiple?(null===(s=n.selectors)||void 0===s||s.forEach(l=>{l.enabled&&t.push(l)}),this.selectEnableds=t,this.form.controls.selectMulti.setValue(t)):(null===(a=n.selectors)||void 0===a||a.forEach(l=>{l.enabled&&(o=l)}),this.form.controls.select.reset(o),this.selectEnabled$.subscribe(l=>{this.form.controls.select.value!==l&&this.form.controls.select.setValue(l)}),this.selectEnabled=o)})}getAutocompleteEnabled(){let t;this.currentAutocompleteGroup.computedSelectors.forEach(o=>{var n;null===(n=o.selectors)||void 0===n||n.forEach(s=>{s.enabled&&(t=s.title,this.form.controls.autocomplete.setValue({id:s.filters.expression,value:s.title}))}),this.autocompleteEnabled=t})}getToolTip(t){let o;return t.tooltip&&(o=Array.isArray(t.tooltip)?t.tooltip.join("\n"):t.tooltip),o||""}getSelectDomValues(){var t,o;return(0,j.mG)(this,void 0,void 0,function*(){for(const n of this.datasource.options.ogcFilters.select.bundles)if(n.domSelectors){let s;for(const a of n.domSelectors){let l;for(const c of this.configService.getConfig("dom"))(a.id===c.id||a.name===c.name)&&(l={id:c.id,url:c.url,name:c.name,values:c.values});if(s=l.url?yield this.domService.getDom(l):l.values,s){let u,c=n;c.selectors=[];for(const p of s){if(n.multiple){let d;d=!(null===(t=this.selectEnableds)||void 0===t||!t.find(g=>g.title===p.value)),u={title:p.value,enabled:d,filters:{operator:a.operator,propertyName:a.propertyName,expression:p.id}}}else u={title:p.value,enabled:(null===(o=this.selectEnabled)||void 0===o?void 0:o.title)===p.value,filters:{operator:a.operator,propertyName:a.propertyName,expression:p.id}};c.selectors.push(u)}this.getSelectGroups().find(p=>p.ids.includes(c.id)).computedSelectors.find(p=>p.title===c.title).selectors=c.selectors}}this.getSelectEnabled()}})}getAutocompleteDomValues(){return(0,j.mG)(this,void 0,void 0,function*(){for(const t of this.datasource.options.ogcFilters.autocomplete.bundles)if(t.domSelectors){let o;for(const n of t.domSelectors){let s;for(const a of this.configService.getConfig("dom"))(n.id===a.id||n.name===a.name)&&(s={id:a.id,url:a.url,name:a.name,values:a.values});if(o=s.url?yield this.domService.getDom(s):s.values,o){let l,a=t;a.selectors=[];for(const c of o)l={title:c.value,enabled:!(!this.autocompleteEnabled||this.autocompleteEnabled!==c.value),filters:{operator:n.operator,propertyName:n.propertyName,expression:c.id}},a.selectors.push(l);this.getAutocompleteGroups().find(c=>c.ids.includes(a.id)).computedSelectors.find(c=>c.title===a.title).selectors=a.selectors}}this.filteredOgcAutocomplete[t.id]=new Ke.y,this.cdRef.detectChanges(),this.filteredOgcAutocomplete[t.id]=this.form.controls.autocomplete.valueChanges.pipe((0,Z.U)(n=>{if(n.length)return null==o?void 0:o.filter(s=>{const a=n?n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return s.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(a)})}))}})}getButtonColor(t){let o;return t.color&&t.enabled&&(o={"background-color":`rgba(${t.color})`}),o}bundleIsVertical(t){return!!t.vertical&&t.vertical}onPushButtonsChangeGroup(){this.getPushButtonsGroups().map(t=>t.enabled=!1),this.getPushButtonsGroups().find(t=>t===this.currentPushButtonsGroup).enabled=!0}onCheckboxesChangeGroup(){this.getCheckboxesGroups().map(t=>t.enabled=!1),this.getCheckboxesGroups().find(t=>t===this.currentCheckboxesGroup).enabled=!0}onRadioButtonsChangeGroup(){this.getRadioButtonsGroups().map(t=>t.enabled=!1),this.getRadioButtonsGroups().find(t=>t===this.currentRadioButtonsGroup).enabled=!0}onSelectChangeGroup(){this.getSelectGroups().map(t=>t.enabled=!1),this.getSelectGroups().find(t=>t===this.currentSelectGroup).enabled=!0}onAutocompleteChangeGroup(){this.getAutocompleteGroups().map(t=>t.enabled=!1),this.getAutocompleteGroups().find(t=>t===this.currentAutocompleteGroup).enabled=!0}onSelectionChange(t,o){clearTimeout(this.applyFiltersTimeout),"radioButton"===o&&this.emptyRadioButtons(),t&&(t.enabled=!t.enabled),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}emptyRadioButtons(){this.currentRadioButtonsGroup.computedSelectors.forEach(t=>{t.selectors.map(o=>o.enabled=!1),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)})}emptySelect(){this.selectEnabled=void 0}emptyAutocomplete(){this.autocompleteEnabled=void 0,this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}toggleAllSelection(){if(this.selectAllSelected){const t=[];this.currentSelectGroup.computedSelectors.forEach(o=>{var n;null===(n=o.selectors)||void 0===n||n.forEach(s=>{t.push(s)})}),this.sel.options.forEach(o=>o.select()),this.selectEnableds=t}else this.sel.options.forEach(t=>t.deselect()),this.selectEnableds=[]}selectOptionClick(t,o,n){if(o.multiple){const s=this.selectEnableds;let a=!0;if(this.sel.options.forEach(l=>{l.selected||(a=!1)}),this.selectAllSelected=a,n.isUserInput)if(s.length){for(const l of s)if(l.title===t.title){if(l.enabled&&t.enabled){s.splice(s.indexOf(l),1),this.selectEnableds=s;break}}else if(s.indexOf(l)===s.length-1){s.push(t),this.selectEnableds=s;break}}else s.push(t),this.selectEnableds=s}else this.selectEnabled=t}autocompleteOptionClick(t){this.autocompleteEnabled=t.value}displayFn(t){return t?t.value:void 0}applyFilters(){let t="";const o=[],n=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];for(const s of n)s.computedSelectors&&s.computedSelectors.map(a=>{var l;const c=[];null===(l=a.selectors)||void 0===l||l.filter(u=>!0===u.enabled).forEach(u=>c.push(u.filters)),c.length>=1&&o.push(1===c.length?c[0]:{logical:a.logical,filters:c})});this.isTemporalOperator()&&this._currentFilter.active&&o.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),o.length>=1&&(t=this.ogcFilterWriter.buildFilter(1===o.length?o[0]:{logical:"And",filters:o})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}isMoreResults(t,o){let n=0;for(const a of t.selectors)n++;return n>("radio"===o?this.radioButtonsIndex:this.checkboxesIndex)}displayMoreResults(t){"radio"===t?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}isLessResults(t,o){let n=0;for(const a of t.selectors)n++;return this.baseIndex!==("radio"===o?this.radioButtonsIndex:this.checkboxesIndex)&&n>this.baseIndex}displayLessResults(t){"radio"===t?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}isTemporalOperator(){var t,o;return(null===(o=null===(t=this.currentFilter)||void 0===t?void 0:t.operator)||void 0===o?void 0:o.toLowerCase())===this.ogcFilterOperator.During.toLowerCase()}changeProperty(t,o,n=!0){const s=this.detectProperty(o);s&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(a=>a.filterid===this.currentFilter.filterid)[s]=t,n&&this.applyFilters())}detectProperty(t){switch(this.currentFilter.operator){case $.PropertyIsNotEqualTo:case $.PropertyIsEqualTo:case $.PropertyIsGreaterThan:case $.PropertyIsGreaterThanOrEqualTo:case $.PropertyIsLessThan:case $.PropertyIsLessThanOrEqualTo:return"expression";case $.PropertyIsLike:return"pattern";case $.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case $.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Fa),e.Y36(_.QS),e.Y36(gr),e.Y36(J),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(t,o){if(1&t&&e.Gf(aC,5),2&t){let n;e.iGM(n=e.CRH())&&(o.sel=n.first)}},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},features:[e._Bn([gr])],decls:3,vars:3,consts:[[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["notMulti",""],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click"],["svgIcon","filter-remove"],["formControlName","selectMulti",3,"multiple","placeholder"],["selection",""],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange","change"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"width",4,"ngIf"],["matInput","","type","text","formControlName","autocomplete",1,"autocomplete",3,"matAutocomplete","placeholder"],["autocomplete",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete","autocomplete",""],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.YNc(1,HC,6,5,"div",1),e.qZA(),e.YNc(2,WC,5,4,"div",2)),2&t&&(e.Q6J("formGroup",o.form),e.xp6(1),e.Q6J("ngForOf",o.ogcFiltersSelectors),e.xp6(1),e.Q6J("ngIf",o.isTemporalOperator()))},styles:[".mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}.checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}.groupsSelector[_ngcontent-%COMP%]{text-align:center}mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:inherit;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){mat-button-toggle[_ngcontent-%COMP%]{width:45%}}  .material-tooltip{white-space:pre-wrap}mat-checkbox[_ngcontent-%COMP%], mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}mat-checkbox[_ngcontent-%COMP%]     label, mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}h4[_ngcontent-%COMP%]{margin:7px;text-align:left}u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}p[_ngcontent-%COMP%]{margin:0;margin:initial}"]}),i})();function KC(i,r){if(1&i&&(e.TgZ(0,"mat-option",10),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.terrapi."+t)," ")}}let Ua=(()=>{class i{constructor(){this.queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"],this.selectedTypeIndex=new _.p4(0),this.spatialType=ye,this.activeDrawType=this.spatialType.Polygon,this.layers=[],this.eventType=new e.vpe,this.eventQueryType=new e.vpe,this.zoneChange=new e.vpe,this.zoneWithBufferChange=new e.vpe,this.bufferChange=new e.vpe,this.measureUnitChange=new e.vpe}get store(){return this._store}set store(t){this._store=t}ngOnInit(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onTypeChange(t){0===this.selectedTypeIndex.value&&(this.type=ye.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onDrawTypeChange(t){this.activeDrawType=t,this.eventType.emit(this.activeDrawType)}onSelectionChange(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},decls:20,vars:25,consts:[[3,"selectedIndex","selectedIndexChange","selectedTabChange"],[3,"label"],[3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"store","queryType","zone","layers","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[1,"spatial-type-toggle"],[3,"value","change"],[3,"value","matTooltip"],["svgIcon","pentagon-outline"],["svgIcon","record-circle-outline"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-tab-group",0),e.NdJ("selectedIndexChange",function(s){return o.selectedTypeIndex.setValue(s)})("selectedTabChange",function(s){return o.onTypeChange(s)}),e.TgZ(1,"mat-tab",1),e.ALo(2,"translate"),e.TgZ(3,"mat-form-field")(4,"mat-label"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-select",2),e.NdJ("selectionChange",function(){return o.onSelectionChange()})("valueChange",function(s){return o.selectedQueryType=s}),e.YNc(8,KC,3,4,"mat-option",3),e.qZA()(),e.TgZ(9,"igo-spatial-filter-list",4),e.NdJ("zoneChange",function(s){return o.zoneChange.emit(s)})("zoneWithBufferChange",function(s){return o.zoneWithBufferChange.emit(s)})("bufferChange",function(s){return o.bufferChange.emit(s)})("measureUnitChange",function(s){return o.measureUnitChange.emit(s)}),e.qZA()(),e.TgZ(10,"mat-tab",1),e.ALo(11,"translate"),e.TgZ(12,"div",5)(13,"mat-button-toggle-group",6),e.NdJ("change",function(s){return o.onDrawTypeChange(s.value)}),e.TgZ(14,"mat-button-toggle",7),e.ALo(15,"translate"),e._UZ(16,"mat-icon",8),e.qZA(),e.TgZ(17,"mat-button-toggle",7),e.ALo(18,"translate"),e._UZ(19,"mat-icon",9),e.qZA()()()()()),2&t&&(e.Q6J("selectedIndex",o.selectedTypeIndex.value),e.xp6(1),e.Q6J("label",e.lcZ(2,15,"igo.geo.spatialFilter.predefined")),e.xp6(4),e.Oqu(e.lcZ(6,17,"igo.geo.spatialFilter.searchLabel")),e.xp6(2),e.Q6J("value",o.selectedQueryType),e.xp6(1),e.Q6J("ngForOf",o.queryType),e.xp6(1),e.Q6J("store",o.store)("queryType",o.selectedQueryType)("zone",o.zone)("layers",o.layers),e.xp6(1),e.Q6J("label",e.lcZ(11,19,"igo.geo.spatialFilter.draw")),e.xp6(3),e.Q6J("value",o.activeDrawType),e.xp6(1),e.Q6J("value",o.spatialType.Polygon)("matTooltip",e.lcZ(15,21,"igo.geo.spatialFilter.drawPolygon")),e.xp6(3),e.Q6J("value",o.spatialType.Point)("matTooltip",e.lcZ(18,23,"igo.geo.spatialFilter.drawCircle")))},styles:[".mat-form-field[_ngcontent-%COMP%]{padding:5px;width:95%;margin-left:2px}.mat-tab-group[_ngcontent-%COMP%]     .mat-tab-body-content{overflow:hidden}.mat-tab-group[_ngcontent-%COMP%]     .mat-tab-label{padding:10px}.mat-tab-group[_ngcontent-%COMP%]     .mat-tab-body-wrapper{margin-top:5px}.spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}.spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}"],changeDetection:0}),i})();function XC(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.properties.nom," ")}}function ex(i,r){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}let tx=(()=>{class i{constructor(t,o){this.spatialFilterService=t,this.messageService=o,this.layers=[],this.measureUnit=K.Meters,this.formControl=new _.p4,this.bufferFormControl=new _.p4,this.zoneChange=new e.vpe,this.zoneWithBufferChange=new e.vpe,this.bufferChange=new e.vpe,this.measureUnitChange=new e.vpe}get store(){return this._store}set store(t){this._store=t}get queryType(){return this._queryType}set queryType(t){this.formControl.setValue(""),this._queryType=t}get zone(){return this._zone}set zone(t){this._zone=t,t||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}get measureUnits(){return[K.Meters,K.Kilometers]}ngOnInit(){this.formValueChanges$$=this.formControl.valueChanges.subscribe(t=>{t.length&&this.store.view.filter(o=>{const n=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(n)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe((0,fe.b)(500),(0,ei.x)()).subscribe(t=>{this.measureUnit===K.Meters&&t>0&&t<=1e5?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,ye.Predefined,t,this.queryType).subscribe(o=>{this.zoneWithBuffer=o,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===K.Kilometers&&t>0&&t<=100?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,ye.Predefined,1e3*t,this.queryType).subscribe(o=>{this.zoneWithBuffer=o,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===t&&this.layers.length>0?(this.bufferChange.emit(t),this.zoneWithBufferChange.emit(this.selectedZone)):(t<0||this.measureUnit===K.Meters&&t>1e5||this.measureUnit===K.Kilometers&&t>100)&&(this.bufferFormControl.setValue(0),this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))})}ngOnDestroy(){this.formValueChanges$$.unsubscribe()}displayFn(t){return t?t.properties.nom:void 0}onZoneChange(t){t&&this.queryType&&this.spatialFilterService.loadItemById(t,this.queryType).subscribe(o=>{this.selectedZone=o,this.zoneChange.emit(o)})}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.bufferFormControl.setValue(this.measureUnit===K.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Gn),e.Y36(_e))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},decls:18,vars:17,consts:[[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],["input",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer-form"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value"]],template:function(t,o){if(1&t&&(e.TgZ(0,"form",0)(1,"mat-form-field",1),e._UZ(2,"input",2,3),e.ALo(4,"translate"),e.TgZ(5,"mat-autocomplete",4,5),e.NdJ("optionSelected",function(s){return o.onZoneChange(s.option.value)}),e.YNc(7,XC,2,2,"mat-option",6),e.ALo(8,"async"),e.qZA()(),e.TgZ(9,"form")(10,"div",7)(11,"form",8)(12,"mat-form-field",9),e._UZ(13,"input",10),e.ALo(14,"translate"),e.qZA()(),e.TgZ(15,"mat-form-field",11)(16,"mat-select",12),e.NdJ("selectionChange",function(s){return o.onMeasureUnitChange(s.value)}),e.YNc(17,ex,3,4,"mat-option",6),e.qZA()()()()()),2&t){const n=e.MAs(6);e.xp6(2),e.s9C("placeholder",e.lcZ(4,11,"igo.geo.spatialFilter.listLabel")),e.Q6J("formControl",o.formControl)("matAutocomplete",n),e.xp6(3),e.Q6J("displayWith",o.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,13,o.store.view.all$())),e.xp6(6),e.s9C("placeholder",e.lcZ(14,15,"igo.geo.spatialFilter.buffer")),e.Q6J("formControl",o.bufferFormControl)("value",0)("readonly",!o.zone),e.xp6(3),e.Q6J("value",o.measureUnit),e.xp6(1),e.Q6J("ngForOf",o.measureUnits)}},dependencies:[f.sg,_._Y,_.Fj,_.wV,_.JJ,_.JL,_.F,_.oH,Xe.XC,Xe.ZL,Q.ey,I.KE,H.Nt,ue.gD,f.Ov,L.X$],styles:[".buffer-div[_ngcontent-%COMP%]{display:flex;width:100%;margin-left:2px;padding:5px}.zone-list[_ngcontent-%COMP%]{padding:5px;width:95%;margin-left:2px}.buffer[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}.unit-field[_ngcontent-%COMP%]{width:110px;margin-left:30px}"],changeDetection:0}),i})();function ox(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",17),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onDrawControlChange())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("checked",t.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function ix(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",17),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onfreehandControlChange())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("checked",t.freehandDrawIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function nx(i,r){if(1&i&&(e.TgZ(0,"mat-option",6),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}function rx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",18)(1,"form",19)(2,"mat-form-field",20),e._UZ(3,"input",21),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"mat-form-field",22)(6,"mat-select",23),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onMeasureUnitChange(n.value))}),e.YNc(7,nx,3,4,"mat-option",24),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.spatialFilter.buffer")),e.Q6J("formControl",t.bufferFormControl)("value",0)("readonly",null===t.formControl.value),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function sx(i,r){if(1&i&&(e.TgZ(0,"mat-option",6),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}function ax(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",25)(1,"form",26)(2,"mat-form-field",27)(3,"input",28),e.NdJ("input",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.getRadius())}),e.ALo(4,"translate"),e.qZA()()(),e.TgZ(5,"mat-form-field",22)(6,"mat-select",23),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onMeasureUnitChange(n.value))}),e.YNc(7,sx,3,4,"mat-option",24),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.spatialFilter.radius")),e.Q6J("formControl",t.radiusFormControl)("value",1e3)("readonly",t.freehandDrawIsActive&&null===t.formControl.value),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function lx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-radio-button",29),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onItemTypeChange(n))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter."+t)," ")}}function cx(i,r){1&i&&(e.TgZ(0,"mat-header-cell",40),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.geo.spatialFilter.Thematics")))}function ux(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-header-cell",41)(1,"mat-checkbox",42),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(n?s.masterToggle():null)}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("checked",t.isAllSelected())("indeterminate",t.selectedThematics.hasValue()&&!t.isAllSelected())}}function px(i,r){1&i&&e._UZ(0,"mat-header-row")}function dx(i,r){1&i&&e._UZ(0,"mat-row")}function gx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-tree-node",43)(1,"li",44),e._UZ(2,"button",45),e._uU(3),e.TgZ(4,"mat-checkbox",46),e.NdJ("click",function(n){return n.stopPropagation()})("change",function(n){const a=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(n?l.onToggleChange(a):null)}),e.qZA()()()}if(2&i){const t=r.$implicit,o=e.oxw(2);e.xp6(3),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("checked",o.selectedThematics.isSelected(t))}}function mx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-nested-tree-node")(1,"div",44)(2,"button",47),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onToggleClick(s))}),e._UZ(3,"mat-icon",48),e.qZA(),e._uU(4),e.TgZ(5,"mat-checkbox",49),e.NdJ("change",function(n){const a=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(n?l.childrensToggle(a):null)}),e.qZA()(),e.TgZ(6,"ul",50),e.GkF(7,51),e.qZA()()}if(2&i){const t=r.$implicit,o=e.oxw(2);e.xp6(3),e.Q6J("svgIcon",o.treeControl.isExpanded(t)?"chevron-down":"chevron-right"),e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("checked",o.isAllSelected(t))("indeterminate",o.hasChildrenSelected(t)&&!o.isAllSelected(t)),e.xp6(1),e.ekj("example-tree-invisible",!o.treeControl.isExpanded(t))}}function hx(i,r){if(1&i&&(e.TgZ(0,"div",30)(1,"mat-table"),e.ynx(2,31),e.YNc(3,cx,3,3,"mat-header-cell",32),e.BQk(),e.ynx(4,33),e.YNc(5,ux,2,2,"mat-header-cell",34),e.BQk(),e.YNc(6,px,1,0,"mat-header-row",35),e.YNc(7,dx,1,0,"mat-row",36),e.qZA(),e.TgZ(8,"mat-tree",37),e.YNc(9,gx,5,2,"mat-tree-node",38),e.YNc(10,mx,8,6,"mat-nested-tree-node",39),e.qZA()()),2&i){const t=e.oxw();e.xp6(6),e.Q6J("matHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("dataSource",t.dataSource)("treeControl",t.treeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",t.hasChild)}}function fx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",52),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.clearSearch())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.disabledClearSearch()),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function _x(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.clearDrawZone())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",null===t.formControl.value),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function yx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",54),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleVisibleList())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",55),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.spatialFilter.showSearchResults"))}function vx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",59),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleVisibleList())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",60),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function bx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",56),e.YNc(1,vx,3,3,"button",57),e.TgZ(2,"igo-entity-table",58),e.NdJ("entitySelectChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.entityChange.emit(n))}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.listIsVisible),e.xp6(1),e.Q6J("template",t.tableTemplate)("store",t.store)}}let Na=(()=>{class i{constructor(t,o,n,s){this.cdRef=t,this.spatialFilterService=o,this.messageService=n,this.languageService=s,this.layers=[],this.allLayers=[],this.toggleSearch=new e.vpe,this.itemTypeChange=new e.vpe,this.thematicChange=new e.vpe,this.drawZoneEvent=new e.vpe,this.bufferEvent=new e.vpe,this.zoneWithBufferChange=new e.vpe,this.measureUnitChange=new e.vpe,this.radiusEvent=new e.vpe,this.freehandControl=new e.vpe,this.predefinedRadius=new e.vpe,this.clearButtonEvent=new e.vpe,this.clearSearchEvent=new e.vpe,this.export=new e.vpe,this.openWorkspace=new e.vpe,this.entityChange=new e.vpe,this.itemType=[xt.Address,xt.Thematics],this.selectedItemType=xt.Address,this.treeControl=new x_.VY(a=>a.children),this.displayedColumns=["name","select"],this.childrens=[],this.groups=[],this.thematics=[],this.dataSource=new Bo.WX,this.selectedThematics=new Ls.Ov(!0,[]),this.value$=new b.X(void 0),this.drawGuide$=new b.X(null),this.overlayStyle$=new b.X(void 0),this.drawStyle$=new b.X(void 0),this.formControl=new _.p4,this.geometryTypeField=!1,this.geometryTypes=["Point","Polygon"],this.drawGuideField=!1,this.drawGuide=null,this.drawGuidePlaceholder="",this.measure=!1,this.drawControlIsActive=!0,this.freehandDrawIsActive=!1,this.buffer=0,this.radiusFormControl=new _.p4,this.bufferFormControl=new _.p4,this.measureUnit=K.Meters,this.listIsVisible=!0}get type(){return this._type}set type(t){this._type=t;const o=this.geometryTypes.findIndex(n=>n===this.type);if(this.geometryType=this.geometryTypes[o],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===ye.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===ye.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=(n,s)=>{const a=n.getGeometry(),l=V.vs(a.getCoordinates(),this.map.projection,"EPSG:4326");return new R.ZP({image:new Me.Z({radius:this.radius/Math.cos(Math.PI/180*l[1])/s,stroke:new U.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new N.Z({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=()=>new R.ZP({stroke:new U.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new N.Z({color:"rgba(0, 153, 255, 0.2)"})});const n=[0,153,255],s=()=>new R.ZP({image:new Me.Z({radius:8,stroke:new U.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new N.Z({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new U.Z({color:n.concat([1]),width:2}),fill:new N.Z({color:n.concat([.2])})});this.overlayStyle=this.PolyStyle,this.drawStyle$.next(s)}this.overlayStyle$.next(this.overlayStyle)}get store(){return this._store}set store(t){this._store=t,this._store.entities$.subscribe(()=>{this.cdRef.detectChanges()})}get measureUnits(){return[K.Meters,K.Kilometers]}get thematicLength(){return this._thematicLength}set thematicLength(t){this._thematicLength=t}ngOnInit(){this.spatialFilterService.loadThematicsList().subscribe(n=>{for(const a of n)this.childrens.push(a),this.childrens.sort((l,c)=>l.name.localeCompare(c.name));this.groups.push(this.languageService.translate.instant("igo.geo.terrapi.limites"));const s={name:this.groups[0],children:[]};this.thematics.push(s),this.childrens.forEach(a=>{a.group&&-1===this.groups.indexOf(a.group)&&(this.groups.push(a.group),this.thematics.push({name:a.group,children:[]})),a.group||(a.name===this.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||a.name===this.languageService.translate.instant("igo.geo.terrapi.Mun")||a.name===this.languageService.translate.instant("igo.geo.terrapi.Arrond")||a.name===this.languageService.translate.instant("igo.geo.terrapi.CircFed")||a.name===this.languageService.translate.instant("igo.geo.terrapi.CircProv")||a.name===this.languageService.translate.instant("igo.geo.terrapi.DirReg")||a.name===this.languageService.translate.instant("igo.geo.terrapi.MRC")||a.name===this.languageService.translate.instant("igo.geo.terrapi.RegTour")?a.group=s.name:a.name===this.languageService.translate.instant("igo.geo.terrapi.routes")?a.group=this.languageService.translate.instant("igo.geo.spatialFilter.group.transport"):this.thematics.push({name:a.name,children:[],source:a.source})),this.thematics.sort((l,c)=>l.name.localeCompare(c.name))}),this.thematics.forEach(a=>{for(const l of this.childrens)l.group===a.name&&a.children.push(l)})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(n=>{n?(this.value$.next(n),this.drawZone=this.formControl.value,0!==this.buffer&&(this.drawZoneEvent.emit(this.drawZone),this.bufferFormControl.setValue(this.buffer))):(this.value$.next(void 0),this.drawZone=void 0)}),this.value$.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe((0,fe.b)(500)).subscribe(n=>{this.measureUnit===K.Meters&&n>0&&n<=1e5?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,ye.Polygon,n).subscribe(s=>{this.zoneWithBuffer=s,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===K.Kilometers&&n>0&&n<=100?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,ye.Polygon,1e3*n).subscribe(s=>{this.zoneWithBuffer=s,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===n?(this.buffer=n,this.bufferEvent.emit(n),this.drawZoneEvent.emit(this.drawZone)):(n<0||this.measureUnit===K.Meters&&n>1e5||this.measureUnit===K.Kilometers&&n>100)&&(this.bufferFormControl.setValue(0),this.buffer=0,this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))});const t=new To({}),o=new Mt({layer:new Te({zIndex:300,source:new Fe,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:Y.Default,many:!0,dragBox:!0});this.store.addStrategy(o,!0),this.store.addStrategy(t,!1)}ngOnDestroy(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}onItemTypeChange(t){this.selectedItemType=t.value,this.itemTypeChange.emit(this.selectedItemType)}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.bufferFormControl.setValue(this.measureUnit===K.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3):this.isPoint()&&this.radiusFormControl.setValue(this.measureUnit===K.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}isPredefined(){return this.type===ye.Predefined}isPolygon(){return this.type===ye.Polygon}isPoint(){return this.type===ye.Point}hasChild(t,o){return!!o.children&&o.children.length}onToggleClick(t){this.treeControl.isExpanded(t)?this.treeControl.collapse(t):this.treeControl.expand(t)}isAllSelected(t){let o,n=0;return t?(o=t.children.length,t.children.forEach(s=>{this.selectedThematics.selected.find(a=>a===s)&&n++})):(o=this.selectedThematics.selected.length,this.thematics.forEach(s=>{-1===this.groups.indexOf(s.name)&&n++}),this.childrens.forEach(s=>{this.thematics.find(a=>a.source===s.source)||n++})),n>=1&&o===n}hasChildrenSelected(t){let o=!1;return t.children.forEach(n=>{this.selectedThematics.selected.find(s=>s.source===n.source)&&(o=!0)}),o}masterToggle(){this.isAllSelected()?this.selectedThematics.clear():this.selectAll();const t=[];for(const o of this.selectedThematics.selected)t.push(o);this.isAllSelected()?this.thematics.forEach(o=>{this.hasChild(0,o)&&this.treeControl.expand(o)}):this.thematics.forEach(o=>{this.hasChild(0,o)&&this.treeControl.collapse(o)}),this.thematicChange.emit(t)}selectAll(t){t?this.hasChild(0,t)&&t.children.forEach(o=>this.selectedThematics.select(o)):(this.thematics.forEach(o=>{-1===this.groups.indexOf(o.name)&&this.selectedThematics.select(o)}),this.childrens.forEach(o=>{this.selectedThematics.selected.find(n=>n.source===o.source)||this.selectedThematics.select(o)}))}childrensToggle(t){this.isAllSelected(t)?t.children.forEach(n=>this.selectedThematics.deselect(n)):this.selectAll(t);const o=[];for(const n of this.selectedThematics.selected)o.push(n);this.treeControl.expand(t),this.thematicChange.emit(o)}onToggleChange(t){let o=!1;void 0!==this.selectedThematics.selected.find(s=>s.source===t.source)&&(o=!0),this.childrens.forEach(s=>{s===t&&!1===o&&this.selectedThematics.select(s),s===t&&!0===o&&this.selectedThematics.deselect(s)}),this.thematics.forEach(s=>{s===t&&!1===o&&this.selectedThematics.select(s),s===t&&!0===o&&this.selectedThematics.deselect(s)});const n=[];for(const s of this.selectedThematics.selected)n.push(s);this.thematicChange.emit(n)}onDrawControlChange(){this.drawControlIsActive=!this.drawControlIsActive}onfreehandControlChange(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive),this.isPoint()?(this.predefinedRadius.emit(!this.freehandDrawIsActive),this.freehandDrawIsActive&&(this.overlayStyle$.next(void 0),this.drawStyle$.next(void 0))):this.predefinedRadius.emit(!1)}toggleSearchButton(){this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe((0,fe.b)(500)).subscribe(t=>{t.length&&this.layers.length===this.thematicLength+1&&(this.openWorkspace.emit(),this.createTableTemplate())})}clearButton(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}clearDrawZone(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}clearSearch(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}disableSearchButton(){if(this.type===ye.Predefined){if(this.selectedItemType===xt.Address&&void 0!==this.queryType&&void 0!==this.zone)return this.loading;if(this.selectedItemType===xt.Thematics&&void 0!==this.queryType&&void 0!==this.zone&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===ye.Polygon||this.type===ye.Point){if(this.selectedItemType===xt.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===xt.Thematics&&this.selectedThematics.selected.length>0&&null!==this.formControl.value)return this.loading}return!0}disabledClearSearch(){let t=!0;return t=this.selectedItemType===xt.Address?void 0===this.queryType:void 0===this.queryType&&0===this.selectedThematics.selected.length,t}getRadius(){let t;if(t=null!==this.formControl.value?this.measureUnit===K.Meters?this.formControl.value.radius:this.formControl.value.radius/1e3:void 0,this.type===ye.Point){if(this.freehandDrawIsActive){if(t){if(t>=1e5)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),void this.formControl.reset();if(t!==this.radiusFormControl.value)return void this.radiusFormControl.setValue(t)}}else if(this.radiusFormControl.value<0||this.measureUnit===K.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===K.Kilometers&&this.radiusFormControl.value>=100)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.radius=1e3,this.radiusFormControl.setValue(this.measureUnit===K.Meters?this.radius:this.radius/1e3),void this.drawGuide$.next(this.radius);this.measureUnit===K.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=1e3*this.radiusFormControl.value,this.drawGuide$.next(1e3*this.radius)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}toggleVisibleList(){this.listIsVisible=!this.listIsVisible}createTableTemplate(){const t={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:je.UnsanitizedHTML},o={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:je.UnsanitizedHTML};this.tableTemplate={selection:!0,sort:!0,columns:[t,o]}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(Gn),e.Y36(_e),e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",predefinedRadius:"predefinedRadius",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},decls:29,vars:43,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius","predefinedRadius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"disabled","click"],["mat-raised-button","",1,"remove-button",3,"disabled","click"],["mat-raised-button","",1,"export-button",3,"disabled","click"],["class","chevron-down","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"buffer-unit"],[1,"buffer-form"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius-form"],[1,"radius"],["type","number","matInput","",3,"placeholder","formControl","value","readonly","input"],[3,"value","change"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"checked","indeterminate","change"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"checked","click","change"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"tree-check-2",3,"checked","indeterminate","change"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"disabled","click"],["mat-raised-button","",1,"clear-form-button",3,"disabled","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"chevron-down",3,"matTooltip","click"],["svgIcon","chevron-down"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"template","store","entitySelectChange"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"]],template:function(t,o){1&t&&(e._UZ(0,"igo-geometry-form-field-input",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.TgZ(4,"div",1),e.YNc(5,ox,3,5,"mat-slide-toggle",2),e.YNc(6,ix,3,5,"mat-slide-toggle",2),e.qZA(),e.YNc(7,rx,8,8,"div",3),e.YNc(8,ax,8,8,"div",4),e.TgZ(9,"mat-label",5),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-radio-group",6),e.YNc(13,lx,3,4,"mat-radio-button",7),e.qZA(),e.YNc(14,hx,11,5,"div",8),e.TgZ(15,"div",9),e.YNc(16,fx,3,4,"button",10),e.YNc(17,_x,3,4,"button",11),e.TgZ(18,"button",12),e.NdJ("click",function(){return o.toggleSearchButton()}),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"button",13),e.NdJ("click",function(){return o.clearButton()}),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"button",14),e.NdJ("click",function(){return o.export.emit()}),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e.YNc(27,yx,3,3,"button",15),e.YNc(28,bx,3,3,"div",16)),2&t&&(e.Q6J("formControl",o.formControl)("map",o.map)("geometryType",o.geometryType)("drawGuide",e.lcZ(1,29,o.drawGuide$))("measure",o.measure)("drawControlIsActive",o.drawControlIsActive)("freehandDrawIsActive",o.freehandDrawIsActive)("drawStyle",e.lcZ(2,31,o.drawStyle$))("overlayStyle",e.lcZ(3,33,o.overlayStyle$))("radius",o.radius)("predefinedRadius",o.predefinedRadius),e.xp6(5),e.Q6J("ngIf",!o.isPredefined()),e.xp6(1),e.Q6J("ngIf",!o.isPredefined()),e.xp6(1),e.Q6J("ngIf",o.isPolygon()),e.xp6(1),e.Q6J("ngIf",o.isPoint()),e.xp6(2),e.hij("",e.lcZ(11,35,"igo.geo.spatialFilter.search")," : "),e.xp6(2),e.Q6J("value",o.selectedItemType),e.xp6(1),e.Q6J("ngForOf",o.itemType),e.xp6(1),e.Q6J("ngIf","Thematics"===o.selectedItemType&&!o.tableTemplate||"Thematics"===o.selectedItemType&&o.tableTemplate&&!o.listIsVisible),e.xp6(2),e.Q6J("ngIf",o.isPredefined()),e.xp6(1),e.Q6J("ngIf",o.isPolygon()||o.isPoint()),e.xp6(1),e.Q6J("disabled",o.disableSearchButton()),e.xp6(1),e.hij(" ",e.lcZ(20,37,"igo.geo.spatialFilter.goSearch")," "),e.xp6(2),e.Q6J("disabled",0===o.allLayers.length),e.xp6(1),e.hij(" ",e.lcZ(23,39,"igo.geo.spatialFilter.removeLayer")," "),e.xp6(2),e.Q6J("disabled",!o.store.entities$.getValue().length),e.xp6(1),e.hij(" ",e.lcZ(26,41,"igo.geo.spatialFilter.exportLayer")," "),e.xp6(2),e.Q6J("ngIf",o.store.all().length&&o.tableTemplate&&!o.listIsVisible),e.xp6(1),e.Q6J("ngIf",o.store.all().length&&o.tableTemplate&&o.listIsVisible))},styles:[".header[_ngcontent-%COMP%]{margin-top:5px;width:100%}.mat-slide-toggle[_ngcontent-%COMP%]{padding:5px;margin-bottom:15px;width:98%}.mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 20px)}.title[_ngcontent-%COMP%]{margin-left:5px;font-size:medium;font-size:initial}.mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-top:10px}.mat-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:16px;margin-top:10px}.mat-form-field[_ngcontent-%COMP%]{margin-top:5px}.mat-column-select[_ngcontent-%COMP%]{overflow:auto}.buttons[_ngcontent-%COMP%]{margin-top:15px}.search-button[_ngcontent-%COMP%]{left:15px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.search-button[_ngcontent-%COMP%]{left:10px;width:45%;min-height:35px;white-space:normal;line-height:normal}}.export-button[_ngcontent-%COMP%]{left:15px;width:46%;margin-bottom:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.export-button[_ngcontent-%COMP%]{left:10px;margin-top:10px;width:45%;min-height:35px;white-space:normal;line-height:normal}}.remove-button[_ngcontent-%COMP%]{margin-top:12px;left:5px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.remove-button[_ngcontent-%COMP%]{margin:0;width:45%;min-height:35px;white-space:normal;line-height:normal}}.clear-form-button[_ngcontent-%COMP%]{left:5px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.clear-form-button[_ngcontent-%COMP%]{width:45%;min-height:35px;white-space:normal;line-height:normal}}.clear-search-button[_ngcontent-%COMP%]{left:5px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.clear-search-button[_ngcontent-%COMP%]{width:45%;min-height:35px;white-space:normal;line-height:normal}}.thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}.results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}.mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}.buffer-unit[_ngcontent-%COMP%], .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;margin-left:2px;padding:5px}.radius[_ngcontent-%COMP%], .buffer[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}.unit-field[_ngcontent-%COMP%]{width:110px;margin-left:30px}.example-tree-invisible[_ngcontent-%COMP%]{display:none}.tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}.tree-check[_ngcontent-%COMP%], .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}.thematics-header[_ngcontent-%COMP%]{max-width:250px}.checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}.mat-checkbox[_ngcontent-%COMP%]{padding:5px}.mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}.mat-header-cell[_ngcontent-%COMP%]{height:56px}.results[_ngcontent-%COMP%]{max-height:45%;width:98%}.results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:visible;overflow:initial}"],changeDetection:0}),i})();const Cx=["endDatepickerTime"],xx=["beginDatepickerTime"],Sx=["beginTime"],wx=["endTime"];function Tx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",4),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.sliderMode=n)})("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.modeChange(n))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.sliderMode),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function Mx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",5)(1,"igo-ogc-filter-time-slider",6),e.NdJ("changeProperty",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changePropertyByPass(n))}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("begin",t.beginValue)("max",t.restrictedToStep()?t.maxDate:t.endValue)("currentFilter",t.currentFilter)("datasource",t.datasource)}}function Fx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"input",11),e.NdJ("change",function(n){e.CHM(t);const s=e.MAs(8),a=e.oxw(2);return e.KtG(a.yearOnlyInputChange(n,s,"begin"))}),e.qZA(),e._UZ(6,"mat-datepicker-toggle",12),e.TgZ(7,"mat-datepicker",13,14),e.NdJ("yearSelected",function(n){e.CHM(t);const s=e.MAs(8),a=e.oxw(2);return e.KtG(a.yearSelected(n,s,"begin"))}),e.qZA(),e._UZ(9,"input",15,16),e.qZA(),e.TgZ(11,"mat-form-field",10)(12,"mat-label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"input",11),e.NdJ("change",function(n){e.CHM(t);const s=e.MAs(18),a=e.oxw(2);return e.KtG(a.yearOnlyInputChange(n,s,"end"))}),e.qZA(),e._UZ(16,"mat-datepicker-toggle",12),e.TgZ(17,"mat-datepicker",13,17),e.NdJ("yearSelected",function(n){e.CHM(t);const s=e.MAs(18),a=e.oxw(2);return e.KtG(a.yearSelected(n,s,"end"))}),e.qZA(),e._UZ(19,"input",15,18),e.qZA(),e.TgZ(21,"button",19),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.resetFilter())}),e.ALo(22,"translate"),e._UZ(23,"mat-icon",20),e.qZA(),e.TgZ(24,"mat-slide-toggle",21),e.NdJ("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleFilterState())}),e.ALo(25,"translate"),e.qZA()()}if(2&i){const t=e.MAs(8),o=e.MAs(18),n=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,27,"igo.geo.timeFilter.startYear")),e.xp6(2),e.s9C("value",n.onlyYearBegin),e.Q6J("disabled",n.filterStateDisable),e.xp6(1),e.Q6J("for",t)("disabled",n.filterStateDisable),e.xp6(1),e.Q6J("startView",n.calendarView())("startAt",n.beginValue),e.xp6(2),e.Q6J("matDatepicker",t)("value",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("min",n.handleDate(n.datasource.options.minDate))("max",n.endValue&&!n.restrictedToStep()?n.endValue:n.handleDate(n.datasource.options.maxDate)),e.xp6(4),e.Oqu(e.lcZ(14,29,"igo.geo.timeFilter.endYear")),e.xp6(2),e.s9C("value",n.onlyYearEnd),e.Q6J("disabled",n.filterStateDisable),e.xp6(1),e.Q6J("for",o)("disabled",n.filterStateDisable),e.xp6(1),e.Q6J("startView",n.calendarView())("startAt",n.endValue),e.xp6(2),e.Q6J("matDatepicker",o)("value",n.endValue?n.endValue:n.handleDate(n.datasource.options.maxDate))("min",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("max",n.handleDate(n.datasource.options.maxDate)),e.xp6(2),e.Q6J("matTooltip",e.lcZ(22,31,"igo.geo.filter.resetFilters"))("disabled",n.filterStateDisable),e.xp6(2),e.s9C("svgIcon",n.resetIcon),e.xp6(1),e.Q6J("matTooltip",e.lcZ(25,33,"igo.geo.filter.toggleFilterState"))("checked",!n.filterStateDisable)}}function Ax(i,r){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Lx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",33)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const n=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(n.value,1))}),e.YNc(5,Ax,2,2,"mat-option",35),e.qZA()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.hour")),e.xp6(2),e.Q6J("formControl",t.beginHourFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.beginHours)}}function Ix(i,r){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Ox(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",37)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const n=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(n.value,1))}),e.YNc(5,Ix,2,2,"mat-option",35),e.qZA()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.minute")),e.xp6(2),e.Q6J("formControl",t.beginMinuteFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.beginMinutes)}}function Zx(i,r){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Dx(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",33)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const n=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(n.value,2))}),e.YNc(5,Zx,2,2,"mat-option",35),e.qZA()()}if(2&i){const t=e.oxw(4);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.hour")),e.xp6(2),e.Q6J("formControl",t.endHourFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.endHours)}}function kx(i,r){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Px(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",37)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const n=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(n.value,2))}),e.YNc(5,kx,2,2,"mat-option",35),e.qZA()()}if(2&i){const t=e.oxw(4);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.minute")),e.xp6(2),e.Q6J("formControl",t.endMinuteFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.endMinutes)}}function $x(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",23)(1,"mat-form-field",24),e._UZ(2,"mat-datepicker-toggle",12),e.TgZ(3,"input",25,38),e.NdJ("dateChange",function(){e.CHM(t);const n=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(n.value,2))}),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"span",27),e.TgZ(7,"mat-datepicker",28,17),e.NdJ("yearSelected",function(n){e.CHM(t);const s=e.MAs(8),a=e.oxw(3);return e.KtG(a.yearSelected(n,s,"end"))})("monthSelected",function(n){e.CHM(t);const s=e.MAs(8),a=e.oxw(3);return e.KtG(a.monthSelected(n,s,"end"))}),e.qZA()(),e.TgZ(9,"div",29),e.YNc(10,Dx,6,6,"mat-form-field",30),e.YNc(11,Px,6,6,"mat-form-field",31),e.qZA()()}if(2&i){const t=e.MAs(8),o=e.oxw(3);e.xp6(2),e.Q6J("for",t)("disabled",o.filterStateDisable),e.xp6(1),e.Q6J("matDatepicker",t)("placeholder",e.lcZ(5,14,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",o.filterEndFunction)("value",o.endValue?o.endValue:o.handleDate(o.datasource.options.maxDate))("min",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("max",o.handleDate(o.datasource.options.maxDate))("disabled",o.filterStateDisable),e.uIk("disabled",!o.currentFilter.active),e.xp6(4),e.Q6J("startView",o.calendarView())("startAt",o.endValue),e.xp6(3),e.Q6J("ngIf","datetime"===o.calendarType()),e.xp6(1),e.Q6J("ngIf","datetime"===o.calendarType())}}function Ex(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",22)(1,"div",23)(2,"mat-form-field",24),e._UZ(3,"mat-datepicker-toggle",12),e.TgZ(4,"input",25,26),e.NdJ("dateChange",function(){e.CHM(t);const n=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(n.value,1))}),e.ALo(6,"translate"),e.qZA(),e._UZ(7,"span",27),e.TgZ(8,"mat-datepicker",28,14),e.NdJ("yearSelected",function(n){e.CHM(t);const s=e.MAs(9),a=e.oxw(2);return e.KtG(a.yearSelected(n,s,"begin"))})("monthSelected",function(n){e.CHM(t);const s=e.MAs(9),a=e.oxw(2);return e.KtG(a.monthSelected(n,s,"begin"))}),e.qZA()(),e.TgZ(10,"div",29),e.YNc(11,Lx,6,6,"mat-form-field",30),e.YNc(12,Ox,6,6,"mat-form-field",31),e.qZA()(),e.YNc(13,$x,12,16,"div",32),e.TgZ(14,"button",19),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.resetFilter())}),e.ALo(15,"translate"),e._UZ(16,"mat-icon",20),e.qZA(),e.TgZ(17,"mat-slide-toggle",21),e.NdJ("change",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleFilterState())}),e.ALo(18,"translate"),e.qZA()()}if(2&i){const t=e.MAs(9),o=e.oxw(2);e.xp6(3),e.Q6J("for",t)("disabled",o.filterStateDisable),e.xp6(1),e.Q6J("matDatepicker",t)("placeholder",e.lcZ(6,20,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",o.filterBeginFunction)("value",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("min",o.handleDate(o.datasource.options.minDate))("max",o.endValue&&!o.restrictedToStep()?o.endValue:o.handleDate(o.datasource.options.maxDate))("disabled",o.filterStateDisable),e.uIk("disabled",!o.currentFilter.active),e.xp6(4),e.Q6J("startView",o.calendarView())("startAt",o.beginValue),e.xp6(3),e.Q6J("ngIf","datetime"===o.calendarType()),e.xp6(1),e.Q6J("ngIf","datetime"===o.calendarType()),e.xp6(1),e.Q6J("ngIf",!o.restrictedToStep()),e.xp6(1),e.Q6J("matTooltip",e.lcZ(15,22,"igo.geo.filter.resetFilters"))("disabled",o.filterStateDisable),e.xp6(2),e.s9C("svgIcon",o.resetIcon),e.xp6(1),e.Q6J("matTooltip",e.lcZ(18,24,"igo.geo.filter.toggleFilterState"))("checked",!o.filterStateDisable)}}function Jx(i,r){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Fx,26,35,"div",7),e.YNc(2,Ex,19,26,"div",8),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.calendarTypeYear),e.xp6(1),e.Q6J("ngIf","year"!==t.calendarType())}}let qa=(()=>{class i{constructor(t){this.ogcFilterTimeService=t,this.changeProperty=new e.vpe,this.beginHourFormControl=new _.p4,this.beginMinuteFormControl=new _.p4,this.endHourFormControl=new _.p4,this.endMinuteFormControl=new _.p4,this._defaultMin="1900-01-01",this._defaultMax="2052-01-06",this._defaultDisplayFormat="DD/MM/YYYY HH:mm A",this._defaultSliderModeEnabled=!0,this.ogcFilterOperator=$,this.sliderMode=!1,this.defaultStepMillisecond=6e4,this.calendarTypeYear=!1,this.resetIcon="replay"}get step(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}get stepMilliseconds(){const t=E.duration(this.step).asMilliseconds();return 0===t?this.defaultStepMillisecond:t}set beginValue(t){this._beginValue=t}get beginValue(){return this._beginValue}set endValue(t){this._endValue=t}get endValue(){return this._endValue}get sliderInterval(){return void 0===this.currentFilter.sliderInterval?2e3:this.currentFilter.sliderInterval}get maxDate(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}get displayFormat(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}ngOnInit(){this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=void 0!==this.currentFilter.sliderOptions.enabled?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues(),this.dateFilter(this.filterBeginFunction,"begin"),this.dateFilter(this.filterEndFunction,"end")}parseFilter(t){if(!t)return new Date;if(isNaN(new Date(t).getTime())){if(t.search("now")>=0){const o=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const n=parseInt(t.substring(t.search("+")+1,o.index),10);return E().add(n,o[0]).toDate()}if(t.match(/\-/)){const n=parseInt(t.substring(t.search("-")+1,o.index),10);return E().subtract(n,o[0]).toDate()}return new Date}if(t.search("today")>=0){const o=E().endOf("day").toDate(),n=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const s=parseInt(t.substring(t.search("+")+1,n.index),10);return E(o).add(s,n[0]).toDate()}if(t.match(/\-/)){const s=parseInt(t.substring(t.search("-")+1,n.index),10);return E(o).subtract(s,n[0]).toDate()}return o}return new Date}return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):t?new Date(t):new Date}changeTemporalProperty(t,o,n=!0){let s=this.getDateTime(t,o);if(this.isCalendarYearMode()){let a;return 1===o?(this.beginValue=t,this.onlyYearBegin=this.beginValue.getFullYear(),a=`${this.onlyYearBegin}-01-01`):(this.endValue=t,this.onlyYearEnd=this.endValue.getFullYear(),a=`${this.onlyYearEnd}-01-01`),void this.changeProperty.next({value:a,pos:o,refreshFilter:n})}2===o&&"date"===this.calendarType()&&!this.sliderMode&&(s=E(s).endOf("day").toDate()),1===o?(this.beginValue=s,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(s,this.stepMilliseconds),2,n)):this.endValue=s,this.updateHoursMinutesArray(),this.changeProperty.next({value:s.toISOString(),pos:o,refreshFilter:n})}handleDate(t){if(t&&""!==t)return"string"==typeof t&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):new Date(t)}calendarType(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}isCalendarYearMode(){return"year"===this.calendarType()}yearOnlyInputChange(t,o,n){const a=this.getDateFromStringWithoutTime(t.target.value);this.yearSelected(a,o,n)}yearSelected(t,o,n,s=!0){this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(o&&o.close(),"end"===n?t=E(t).endOf("year").toDate():"begin"===n&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,s))}monthSelected(t,o,n,s=!0){this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(o&&o.close(),"end"===n?t=E(t).endOf("month").toDate():"begin"===n&&this.restrictedToStep()&&this.monthSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,s))}calendarView(){const t=this.stepMilliseconds,o=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":t<864e5&&o<864e5?"clock":"month"}dateFilter(t,o){const n=new Date(o),s=n.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){const a=E(n).diff(E(this.handleMin()),"years",!0);if("end"===t){const l=E(n).add(1,"d"),c=E(l).diff(E(this.handleMin()),"years",!0);return void(this.filterEndFunction=c%E.duration(this.step).asYears()==0)}if("begin"===t)return void(this.filterBeginFunction=a%E.duration(this.step).asYears()==0)}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){const a=E(n).diff(E(this.handleMin()),"months",!0);if("end"===t){const l=E(n).add(1,"d"),c=E(l).diff(E(this.handleMin()),"months",!0);return void(this.filterEndFunction=c%E.duration(this.step).asMonths()==0)}if("begin"===t)return void(this.filterBeginFunction=a%E.duration(this.step).asMonths()==0)}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){const a=E(n).diff(E(this.handleMin()),"weeks",!0);if("end"===t){const l=E(n).add(1,"d"),c=E(l).diff(E(this.handleMin()),"weeks",!0);return void(this.filterEndFunction=c%E.duration(this.step).asWeeks()==0)}if("begin"===t)return void(this.filterBeginFunction=a%E.duration(this.step).asWeeks()==0)}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){const a=E(n).diff(E(this.handleMin()),"days",!0);if("end"===t){const l=E(n).add(1,"d"),u=E(l).diff(E(this.handleMin()),"days",!0)%E.duration(this.step).asDays();return void(this.filterEndFunction=u<1e-7&&u>-1e-7||0===u)}if("begin"===t){const l=a%E.duration(this.step).asDays()+1;return void(this.filterBeginFunction=l<1e-7&&l>-1e-7&&0!==l||1===l)}}else if(this.ogcFilterTimeService.stepIsHourDuration(this.step)){if("end"===t){const a=E(n).diff(E(this.handleMin()),"hours",!0);return void(this.filterEndFunction=a%E.duration(this.step).asHours()==0)}if("begin"===t){const a=E(n).diff(E(this.handleMin()),"hours",!0);return void(this.filterBeginFunction=a%E.duration(this.step).asHours()==0)}}else if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step)){if("end"===t)return void(this.filterEndFunction=!0);if("begin"===t)return void(this.filterBeginFunction=!0)}this.filterEndFunction=s%this.stepMilliseconds==0,this.filterBeginFunction=s%this.stepMilliseconds==0}getDateTime(t,o){const n=new Date(t);let s;if(!this.sliderMode)switch(o){case 1:if(this.currentFilter.calendarModeYear){s=n.setHours(0,0);break}s=n.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break;case 2:if(this.currentFilter.calendarModeYear){s=n.setHours(0,0);break}s=n.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value)}return new Date(s||n)}handleMinuteIncrement(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3==60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}handleHourIncrement(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}fullBeginHoursArray(t){this.beginHours=Array.from(t?{length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1}:{length:23/this.handleHourIncrement()+1},(o,n)=>0+n*this.handleHourIncrement()),this.beginHourFormControl.setValue(this.beginValue.getHours())}fullEndHoursArray(t){this.endHours=t?Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},(o,n)=>this.beginHourFormControl.value+n*this.handleHourIncrement()):Array.from({length:23/this.handleHourIncrement()+1},(o,n)=>0+n*this.handleHourIncrement()),this.endHourFormControl.setValue(this.endValue.getHours())}fullBeginMinutesArray(t){this.beginMinutes=Array.from(t?{length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1}:{length:59/this.handleMinuteIncrement()+1},(o,n)=>0+n*this.handleMinuteIncrement()),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}fullEndMinutesArray(t){this.endMinutes=t?Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},(o,n)=>this.beginMinuteFormControl.value+n*this.handleMinuteIncrement()):Array.from({length:59/this.handleMinuteIncrement()+1},(o,n)=>0+n*this.handleMinuteIncrement()),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}updateHoursMinutesArray(){const t=new Date(this.beginValue),o=new Date(this.endValue);t.setHours(0,0)===o.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}updateValues(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}restrictedToStep(){return!!this.currentFilter.restrictToStep&&this.currentFilter.restrictToStep}handleMin(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}handleMax(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}changePropertyByPass(t){this.changeProperty.next(t)}modeChange(t){t.checked||this.updateValues()}setFilterStateDisable(){this.filterStateDisable=!!this.currentFilter&&!this.currentFilter.active,"datetime"===this.calendarType()&&(!0===this.filterStateDisable?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}getDateFromStringWithoutTime(t){let o,n="01",s="01";if(10===t.length){const a=t.split("-");if(3!==a.length)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");o=a[0],n=a[1],s=a[2]}else{if(4!==t.length)return new Date(t);o=t}return new Date(`${o}-${n}-${s} 00:00:00`)}resetFilter(){let o,n,s,a,t=this.datasource.options.ogcFilters.filters;this.calendarTypeYear?(a="today"===t.end?`${(new Date).toLocaleDateString("en-CA").substring(0,4)}-01-01`:`${t.end.substring(0,4)}-01-01`,s=`${t.begin.substring(0,4)}-01-01`,o=this.getDateFromStringWithoutTime(s),n=this.getDateFromStringWithoutTime(a)):(o=this.parseFilter(t.begin),n=this.parseFilter(t.end),s=o.toISOString(),a=n.toISOString()),(this.currentFilter.begin!==s||this.currentFilter.end!==a)&&(this.beginValue=o,this.endValue=n,this.updateValues())}toggleFilterState(){this.currentFilter.active=!0!==this.currentFilter.active,this.setFilterStateDisable(),this.updateValues()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ba))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-time"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Cx,5),e.Gf(xx,5),e.Gf(Sx,5),e.Gf(wx,5)),2&t){let n;e.iGM(n=e.CRH())&&(o.endDatepickerTime=n.first),e.iGM(n=e.CRH())&&(o.beginDatepickerTime=n.first),e.iGM(n=e.CRH())&&(o.beginTime=n.first),e.iGM(n=e.CRH())&&(o.endTime=n.first)}},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},decls:4,vars:3,consts:[[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModel","ngModelChange","change"],[1,"slider-container"],[3,"begin","max","currentFilter","datasource","changeProperty"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],[1,"year-input"],["matInput","",1,"year-input-only-year",3,"value","disabled","change"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"startView","startAt","yearSelected"],["beginDatepicker",""],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],["beginYear",""],["endDatepicker",""],["endYear",""],["mat-icon-button","","color","primary",1,"reset-button",3,"matTooltip","disabled","click"],[3,"svgIcon"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"matTooltip","checked","change"],[1,"datetime-input-container"],[1,"datetime-input"],[1,"date-input"],["matInput","",3,"matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled","dateChange"],["begin",""],[1,"filler"],[3,"startView","startAt","yearSelected","monthSelected"],[1,"time-input"],["class","hour-input",4,"ngIf"],["class","minute-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"hour-input"],[3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"minute-input"],["end",""]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Tx,3,4,"mat-slide-toggle",1),e.YNc(2,Mx,2,4,"div",2),e.YNc(3,Jx,3,2,"div",3),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",null==o.currentFilter.sliderOptions?null:o.currentFilter.sliderOptions.enabled),e.xp6(1),e.Q6J("ngIf",o.sliderMode),e.xp6(1),e.Q6J("ngIf",!o.sliderMode))},styles:["input{text-align:center!important;margin:auto 5px!important}.slider-container[_ngcontent-%COMP%]{text-align:center}.datetime-input[_ngcontent-%COMP%]{display:inline-block;width:100px;margin:10px 0 5px 10px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.datetime-input[_ngcontent-%COMP%]{width:36%;margin:0}}.date-input[_ngcontent-%COMP%]{width:100px;margin-right:25px}.time-input[_ngcontent-%COMP%]{margin-right:25px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.time-input[_ngcontent-%COMP%]{margin-right:5px}}.hour-input[_ngcontent-%COMP%], .minute-input[_ngcontent-%COMP%]{width:35px;margin-left:7px}.year-input[_ngcontent-%COMP%]{width:98px;margin:10px 14px 5px 4px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.year-input[_ngcontent-%COMP%]{width:32%;margin:0 0 0 10px}}.year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}.year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px}.reset-button[_ngcontent-%COMP%]{width:25px;padding-left:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.reset-button[_ngcontent-%COMP%]{padding-left:8px}}.toggle-filter-state[_ngcontent-%COMP%]{padding-left:20px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.toggle-filter-state[_ngcontent-%COMP%]{padding-left:12px}}  .datepicker-year   .mat-calendar-arrow{display:none}  .datepicker-year   .mat-calendar-period-button{pointer-events:none}  .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}"]}),i})(),Rx=(()=>{class i{constructor(t){this.ogcFilterTimeService=t,this.changeProperty=new e.vpe,this.sliderValue=1,this.calculatedStep=0,this._defaultDisplayFormat="DD/MM/YYYY HH:mm A",this._defaultSliderInterval=2e3,this.playIcon="play-circle",this.resetIcon="replay",this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}get sliderInterval(){return void 0===this.currentFilter.sliderInterval?this._defaultSliderInterval:this.currentFilter.sliderInterval}get displayFormat(){var t;return null!==(t=this.currentFilter.sliderOptions)&&void 0!==t&&t.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}get beginMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.begin)}get maxMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.max)}get stepMillisecond(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}ngOnInit(){this.calculateStep(),this.handleSliderInput({value:1})}sliderDisplayWith(t){let o=new Date(this.beginMillisecond+(t-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=E.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();o=E(this.beginMillisecond).add((t-1)*n,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=E.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();o=E(this.beginMillisecond).add((t-1)*n,"month").toDate()}return E(o).format(this.displayFormat)}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(o=>{if(this.slider.value<this.calculatedStep){const s="_emitInputEvent";this.slider._increment(1),this.slider[s]()}else this.stopFilter()},this.sliderInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}resetFilter(t){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle",this.slider.value=1,this.slider._emitInputEvent()}handleSliderInput(t){if(t)if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const o=E.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),n=E(this.beginMillisecond).add((t.value-1)*o,"year").toDate(),s=E(n).add(o,"year").toDate();this.changeProperty.next({value:E(n).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:E(s).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const o=E.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),n=E(this.beginMillisecond).add((t.value-1)*o,"month").toDate(),s=E(n).add(o,"month").toDate();this.changeProperty.next({value:E(n).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:E(s).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const o=new Date(this.beginMillisecond+this.stepMillisecond*(t.value-1));this.changeProperty.next({value:o.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(o.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}calculateStep(){for(let t=1;this.maxMillisecond-(this.beginMillisecond+t*this.stepMillisecond)>=-1;t++)this.calculatedStep=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ba))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(t,o){if(1&t&&e.Gf(mi.pH,5),2&t){let n;e.iGM(n=e.CRH())&&(o.slider=n.first)}},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},decls:6,vars:7,consts:[[1,"slider-container"],["id","time-slider","thumbLabel","",3,"step","min","max","ngModel","displayWith","ngModelChange","input"],["mat-icon-button","","color","primary",3,"click"],[3,"svgIcon"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mat-slider",1),e.NdJ("ngModelChange",function(s){return o.sliderValue=s})("input",function(s){return o.handleSliderInput(s)}),e.qZA(),e.TgZ(2,"button",2),e.NdJ("click",function(s){return o.playFilter(s)}),e._UZ(3,"mat-icon",3),e.qZA(),e.TgZ(4,"button",2),e.NdJ("click",function(s){return o.resetFilter(s)}),e._UZ(5,"mat-icon",3),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("step",1)("min",1)("max",o.calculatedStep)("ngModel",o.sliderValue)("displayWith",o.sliderDisplayWith),e.xp6(2),e.Q6J("svgIcon",o.playIcon),e.xp6(2),e.s9C("svgIcon",o.resetIcon))},dependencies:[_.JJ,_.On,T.Hw,w.lW,mi.pH],styles:["input{text-align:center!important;margin:auto 5px!important}  .mat-slider-thumb{transform:scale(0)!important}  .mat-slider-thumb-label{transform:rotate(45deg)!important;border-radius:50% 50% 0!important;background-color:#ffd740!important}  .mat-slider-thumb-label-text{opacity:1!important;transform:rotate(135deg)!important}  .mat-slider-horizontal .mat-slider-thumb-label{top:10px!important;transform:rotate(225deg)!important}  .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(225deg)!important}.datetime-container[_ngcontent-%COMP%], .slider-container[_ngcontent-%COMP%]{text-align:center}.datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}.date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}.time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}.hour-input[_ngcontent-%COMP%], .minute-input[_ngcontent-%COMP%]{width:40px}.minute-input[_ngcontent-%COMP%]{margin-left:10px}"]}),i})(),Lo=(()=>{class i{static forRoot(){return{ngModule:i,providers:[{provide:Q.Ad,useValue:"fr-FR"}]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[uu,Fa,Ba,Gn],imports:[f.ez,_.u5,_.UX,Xe.Bb,T.Ps,w.ot,lt.Nh,nt.Fk,$e.Tx,we.p0,Bo.dp,Re.vV,Ge.p9,mi.KP,at.rP,I.lN,H.c,Q.Ng,ue.LD,G.ie,O.AV,Po.FA,Q.XK,On.ni,On.IZ,oe,vi,Ii,ui,Ul,Gg,ki,Ra,mt.g]}),i})();e.B6R(Hn,[f.O5,T.Hw,w.lW,O.gM,Zt,mt.k,Gr],[L.X$]),e.B6R(Gr,[f.mk,f.O5,f.PC,T.Hw,w.lW,G.Tg,G.eA,Q.X2,O.gM,Nn,Li,l0],[f.Ov,L.X$]),e.B6R(Qr,[f.sg,Zt,mo,Gr],[cu]),e.B6R(Lu,[f.mk,f.sg,f.O5,Xe.XC,Xe.ZL,Q.ey,T.Hw,w.lW,Ge.oG,I.KE,I.R9,H.Nt,ue.gD,O.gM,qa],[f.Ov,L.X$,ci]),e.B6R(zn,[f.O5,T.Hw,w.lW,O.gM,Zt,mt.k,Vn],[L.X$]),e.B6R(Ou,[f.sg,f.O5,f.PC,_._Y,_.Fj,_.JJ,_.JL,_.On,_.sg,_.u,Xe.XC,Xe.ZL,Q.ey,T.Hw,nt.VQ,nt.U0,Re.A9,Re.Yi,Ge.oG,I.KE,H.Nt,ue.gD,vt.d,O.gM,qa],[f.Ov,L.X$]),e.B6R(Iu,[f.sg,f.O5,Zt,Lu,Ou],[]),e.B6R(Vn,[f.mk,f.O5,f.PC,_.JJ,_.On,T.Hw,w.lW,Ge.oG,G.Tg,G.eA,Q.X2,vt.d,O.gM,Nn,Li,Iu],[f.Ov,L.X$]),e.B6R(jr,[f.sg,f.O5,Zt,mo,Vn],[L.X$,cu]),e.B6R(Ua,[f.sg,Q.ey,T.Hw,lt.SP,lt.uX,Re.A9,Re.Yi,I.KE,I.hX,ue.gD,O.gM,tx],[L.X$]),e.B6R(Na,[f.sg,f.O5,_._Y,_.Fj,_.wV,_.JJ,_.JL,_.F,_.oH,Q.ey,T.Hw,w.lW,nt.VQ,nt.U0,we.BZ,we.fO,we.as,we.w1,we.nj,we.ge,we.XQ,we.Gk,Bo.GZ,Bo.fQ,Bo.eu,Bo.gi,Bo.uo,Bo.Ar,Ge.oG,at.Rr,I.KE,I.hX,H.Nt,ue.gD,O.gM,li,Fu],[f.Ov,L.X$]),e.B6R(qa,[f.sg,f.O5,_.JJ,_.On,_.oH,Q.ey,T.Hw,w.lW,at.Rr,I.KE,I.hX,I.R9,H.Nt,ue.gD,O.gM,Po.Mq,Po.hl,Po.nW,Rx],[L.X$]);class Zu extends Error{}class Qa extends Zu{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Qa.prototype)}}class Yr extends Zu{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,Yr.prototype)}}const ie=co(["URL","GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon"]),ro=co(["UTF8","LATIN1"]);let Hr=(()=>{class i{constructor(t){this.config=t,this.aggregateInComment=!0,this.ogreUrl=this.config.getConfig("importExport.url");const o=this.config.getConfig("importExport.gpxAggregateInComment");void 0!==o&&(this.aggregateInComment=o)}export(t,o,n,s,a="EPSG:4326",l="EPSG:4326"){const c=this.generateFeature(t,o);return this.exportAsync(c,o,n,s,a,l)}generateFeature(t,o,n="_"){return o===ie.GPX&&this.aggregateInComment?this.generateAggregatedFeature(t):t.map(s=>{const l=s.getKeys().filter(c=>!c.startsWith(n)).reduce((c,u)=>(c[u]=s.get(u),c),{geometry:s.getGeometry()});return new De.Z(l)})}generateAggregatedFeature(t){return t.map(o=>{const n=o.getKeys().filter(c=>!c.startsWith("_"));let s="";const a=n.reduce((c,u)=>(u&&"geometry"!==u&&("id"===u&&o.get("draw")?s+=u+":"+o.get("draw")+"   \r\n":s+=u+":"+o.get(u)+"   \r\n"),c[u]=o.get(u),c),{geometry:o.getGeometry()}),l=new De.Z(a);return l.set("name",o.getId()),l.set("cmt",s),l})}exportAsync(t,o,n,s,a,l){return new Ke.y(u=>{if(this.nothingToExport(t,o))u.error(new Yr);else if(Object.keys(i.ogreFormats).indexOf(o)>=0){if(!this.ogreUrl)return void(i.noOgreFallbacks.indexOf(o)>=0?this.exportToFile(t,u,o,n,a,l):u.error(new Qa));this.exportWithOgre(t,u,o,n,s,a,l)}else this.exportToFile(t,u,o,n,a,l)})}exportToFile(t,o,n,s,a,l){(function xl(i,r,t){!function ed(i,r){const t=document.createElement("a");t.setAttribute("href",i),t.setAttribute("download",r),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}(`data:${r},${encodeURIComponent(i)}`,t)})((new Tr[n]).writeFeatures(t,{dataProjection:l,featureProjection:a,featureType:"feature",featureNS:"http://example.com/feature"}),"text/plain;charset=utf-8",`${s}.${n.toLowerCase()}`),o.complete()}exportWithOgre(t,o,n,s,a,l,c){let u=(new be.Z).writeFeatures(t,{dataProjection:c,featureProjection:l});const p=`${this.ogreUrl}/convertJson`,d=document.createElement("form");if(d.style.display="none",document.body.appendChild(d),d.setAttribute("method","post"),d.setAttribute("target","_blank"),d.setAttribute("action",p),a===ro.UTF8)d.acceptCharset="UTF-8",d.enctype="application/x-www-form-urlencoded; charset=utf-8;";else if(a===ro.LATIN1){const S="ISO-8859-1",M=JSON.parse(u);M.features.map(F=>{const k=String.fromCharCode.apply(null,(0,S_.cv)(JSON.stringify(F.properties),{mode:"replacement"}));F.properties=JSON.parse(k)}),u=JSON.stringify(M);const A=document.createElement("input");A.setAttribute("type","hidden"),A.setAttribute("name","encoding"),A.setAttribute("value",S),d.appendChild(A)}if("CSVsemicolon"===n){const S=document.createElement("input");S.setAttribute("type","hidden"),S.setAttribute("name","lco"),S.setAttribute("value","SEPARATOR=SEMICOLON"),d.appendChild(S)}const g=document.createElement("input");g.setAttribute("type","hidden"),g.setAttribute("name","json"),g.setAttribute("value",u),d.appendChild(g);const h=document.createElement("input");let m="Shapefile"===n?`${s}.zip`:`${s}.${n.toLowerCase()}`;("CSVcomma"===n||"CSVsemicolon"===n)&&(m=`${s}.csv`),m=m.replace(" ","_"),m=m.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\u2019/g,"'"),h.setAttribute("type","hidden"),h.setAttribute("name","outputName"),h.setAttribute("value",m),d.appendChild(h);let y=i.ogreFormats[n];("CSVcomma"===n||"CSVsemicolon"===n)&&(y="CSV");const v=document.createElement("input");v.setAttribute("type","hidden"),v.setAttribute("name","format"),v.setAttribute("value",y),d.appendChild(v),d.submit(),document.body.removeChild(d),o.complete()}nothingToExport(t,o){return 0===t.length||"GPX"===o&&void 0===t.find(s=>["Point","LineString","MultiLineString"].indexOf(s.getGeometry().getType())>=0)}}return i.ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"},i.noOgreFallbacks=["GML","GPX","KML"],i.\u0275fac=function(t){return new(t||i)(e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Vr(i){return i.toString().padStart(2,"0")}function zr(i,r,t,o,n,s,a,l,c){if(0===r.length)return void function Vx(i,r){r.error("igo.geo.dropGeoFile.empty.text","igo.geo.dropGeoFile.empty.title",void 0,{value:i.name,mimeType:i.type})}(i,n);let u=ja(i);(a?a.open("igo.geo.import.promptStoreToIdb"):(0,X.of)(!1)).pipe((0,Gt.P)()).subscribe(d=>{const g=new Date,h=[g.getFullYear(),Vr(g.getMonth()+1),Vr(g.getDate())].join("/")+" "+[Vr(g.getHours()),Vr(g.getMinutes())].join(":");u=d?`${u} (${h})`:u,l?function Qx(i,r,t,o,n,s,a,l,c=!0){const u=i.map(m=>bt(m,r.projection));let p,d,g;if(o.getStyleList(t.toString()+".styleByAttribute")){const m=o.getStyleList(t.toString()+".styleByAttribute");p=(y,v)=>n.createStyleByAttribute(y,m,v)}else if(o.getStyleList(t.toString()+".clusterStyle")){const m=o.getStyleList(t.toString()+".clusterParam");d=o.getStyleList(t.toString()+".distance"),p=(y,v)=>{const S=n.createStyle(o.getStyleList(t.toString()+".clusterStyle"),y,v);return n.createClusterStyle(y,v,m,S)}}else if(o.getStyleList(t.toString()+".style"))p=(m,y)=>n.createStyle(o.getStyleList(t.toString()+".style"),m,y);else if(o.getStyleList("default.clusterStyle")&&"Point"===i[0].geometry.type){const m=o.getStyleList("default.clusterParam");d=o.getStyleList("default.distance"),p=(y,v)=>{const S=n.createStyle(o.getStyleList("default.clusterStyle"),y,v);return n.createClusterStyle(y,v,m,S)}}else p=(m,y)=>n.createStyle(o.getStyleList("default.style"),m,y);o.getStyleList(t.toString()+".clusterStyle")?(g=new _o(Object.assign({distance:d,type:"cluster",queryable:!0},a)),g.ol.source.addFeatures(u)):o.getStyleList(t.toString())?(g=new Fe(Object.assign({type:"vector",queryable:!0},a)),g.ol.addFeatures(u)):o.getStyleList("default.clusterStyle")&&"Point"===i[0].geometry.type?(g=new _o(Object.assign({distance:d,type:"cluster",queryable:!0},a)),g.ol.source.addFeatures(u)):(g=new Fe(Object.assign({type:"vector",queryable:!0},a)),g.ol.addFeatures(u));const h=new Te(Object.assign({title:t,id:s||Ze(),isIgoInternalLayer:!0,source:g,style:p},l));r.addLayer(h),c&&eo(r,u)}(r,t,u,l,c):function Gx(i,r,t,o,n,s=!1){const a=i.map(h=>bt(h,r.projection)),l=Ze(),u=new Fe({id:l,type:"vector",queryable:!0});u.ol.addFeatures(a);let p,d=!1;a[0].getKeys().includes("_style")||a[0].getKeys().includes("_mapTitle")?p=jc():(p=Yc(),d=!0);const g=n.createLayer({id:l,title:o,workspace:{enabled:!0,searchIndexEnabled:!0},isIgoInternalLayer:!0,source:u,igoStyle:{editable:d},idbInfo:{firstLoad:!0,storeToIdb:s,contextUri:t||"*"},style:p});g.setExtent($n(r,a)),r.addLayer(g),eo(r,a)}(r,t,o,u,s,d),n.success("igo.geo.dropGeoFile.success.text","igo.geo.dropGeoFile.success.title",void 0,{value:u})})}function jx(i,r,t){t.error("igo.geo.dropGeoFile.invalid.text","igo.geo.dropGeoFile.invalid.title",void 0,{value:i.name,mimeType:i.type})}function Yx(i,r,t){t.error("igo.geo.dropGeoFile.unreadable.text","igo.geo.dropGeoFile.unreadable.title",void 0,{value:i.name})}function Hx(i,r,t,o){t.error("igo.geo.dropGeoFile.tooLarge.text","igo.geo.dropGeoFile.tooLarge.title",void 0,{value:i.name,size:o})}function zx(i,r){r.error("igo.geo.dropGeoFile.invalidSRS.text","igo.geo.dropGeoFile.invalidSRS.title",void 0,{value:i.name,mimeType:i.type})}function Wx(i,r,t){t.error("igo.geo.dropGeoFile.ogreServer.text","igo.geo.dropGeoFile.ogreServer.title")}function ku(i){return i.name.split(".").pop().toLowerCase()}function ja(i){return i.name.substr(0,i.name.lastIndexOf("."))}class on extends Error{}class Wr extends on{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Wr.prototype)}}class xi extends on{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,xi.prototype)}}class Kr extends on{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Kr.prototype)}}class Kx extends on{constructor(){super("File is too large"),Object.setPrototypeOf(this,Kr.prototype)}}class Xx extends on{constructor(){super("Invalid SRS definition"),Object.setPrototypeOf(this,Kr.prototype)}}class Ya extends on{constructor(){super("Error 500 with OGRE"),Object.setPrototypeOf(this,Ya.prototype)}}let Pu=(()=>{class i{constructor(t,o){this.http=t,this.config=o;const n=this.config.getConfig("importExport");this.ogreUrl=n.url,this.clientSideFileSizeMax=(n.clientSideFileSizeMaxMb||30)*Math.pow(1024,2),n.formats&&(i.allowedExtensions=n.formats.map(a=>i.formatExtensionAssociation[a]).filter(a=>a),i.allowedExtensions.includes("geojson")&&i.allowedExtensions.push("json"))}import(t,o="EPSG:4326",n="EPSG:4326"){return this.importAsync(t,o,n)}getFileImporter(t){const o=ku(t),n=i.allowedExtensions;let s=[];n.includes("zip")&&(s=i.allowedZipMimeTypes);const a=t.type;if(!([...i.allowedMimeTypes,...s].indexOf(a)<0&&n.indexOf(o)<0)){if("application/json"===a||["json","geojson","kml","gpx"].indexOf(o)>=0)return this.importFile;if(void 0!==this.ogreUrl)return this.importFileWithOgre}}importAsync(t,o,n){return new Ke.y(a=>{if(t.size>=this.clientSideFileSizeMax)return void a.error(new Kx);const l=this.getFileImporter(t);void 0!==l?l.call(this,t,a,o,n):a.error(new Wr)})}importFile(t,o,n,s){const a=new FileReader;a.onload=l=>{try{const c=this.parseFeaturesFromFile(t,l.target.result,n,s);o.next(c)}catch(c){o.error(new xi)}o.complete()},a.onerror=l=>{o.error(new xi)},a.readAsText(t,"UTF-8")}importFileWithOgre(t,o,n,s){const a=`${this.ogreUrl}/convert`,l=new FormData;l.append("upload",t),l.append("sourceSrs",n),l.append("targetSrs",s),l.append("formatOutput","GEOJSON"),l.append("skipFailures",""),this.http.post(a,l,{headers:new q.WM}).subscribe(c=>{if(null!==c)if((c.errors||[]).length>0)o.error(new xi);else{const p=this.parseFeaturesFromGeoJSON(t,c,s);o.next(p),o.complete()}else o.error(new xi)},c=>{c.error.caught=!0;const u=c.error.msg||"";"No valid files found"===u?o.error(new Wr):u&&u.startWith("ERROR 1: Failed to process SRS definition")?o.error(new Xx):o.error(500===c.status?new Ya:new xi)})}parseFeaturesFromFile(t,o,n,s){const a=ku(t),l=t.type,c=new be.Z;let u;if("application/vnd.google-earth.kml+xml"===l)u=new aa.ZP;else if("application/gml+xml"===l)u=new rc.Z;else if("application/gpx+xml"===l)u=new sa.Z;else switch(a){case"kml":u=new aa.ZP;break;case"gpx":u=new sa.Z;break;case"gml":u=new rc.Z;break;default:u=c}return u.readFeatures(o,{dataProjection:n,featureProjection:s}).map(g=>Object.assign(c.writeFeatureObject(g),{projection:s,meta:{id:Ze(),title:ja(t)}}))}parseFeaturesFromGeoJSON(t,o,n){const s=new be.Z;return s.readFeatures(o).map(c=>Object.assign(s.writeFeatureObject(c),{projection:n,meta:{id:Ze(),title:ja(t)}}))}}return i.formatExtensionAssociation={GeoJSON:"geojson",GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"zip"},i.allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"],i.allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"],i.allowedExtensions=["geojson","kml","gpx","json","gml","zip"],i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Xr=(()=>{class i{constructor(t){this.injector=t,this.styleList={}}getStyleList(t){return B.resolve(this.styleList,t)}load(t){const o=t.default||{};if(!t.path)return this.styleList=o,!0;const n=this.injector.get(q.eN);return new Promise((s,a)=>{n.get(t.path).pipe((0,he.K)(l=>(console.log(`StyleList file ${t.path} could not be read`),s(!0),(0,dn._)(l.error||"Server error")))).subscribe(l=>{this.styleList=B.mergeDeep(o,l),s(!0)})})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function eS(i,r){if(1&i&&(e.TgZ(0,"p",16),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.importExportForm.projections."+t.translateKey,t))}}function tS(i,r){if(1&i&&(e.TgZ(0,"p",16),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.alias)}}function oS(i,r){if(1&i&&(e.TgZ(0,"mat-option",14),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(1,eS,3,4,"p",15),e.YNc(2,tS,2,1,"p",15),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Q6J("ngIf",t.translateKey),e.xp6(1),e.Q6J("ngIf",!t.translateKey)}}function iS(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",7),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.inputProj=n)}),e.YNc(7,oS,3,3,"mat-option",8),e.ALo(8,"async"),e.qZA()()(),e.TgZ(9,"div",9),e.ALo(10,"translate"),e.ALo(11,"translate"),e.TgZ(12,"button",10),e.NdJ("click",function(){e.CHM(t);const n=e.MAs(19);return e.KtG(n.click())}),e.ALo(13,"async"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"igo-spinner",11),e.ALo(17,"async"),e.TgZ(18,"input",12,13),e.NdJ("click",function(){e.CHM(t);const n=e.MAs(19);return e.KtG(n.value=null)})("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.importFiles(n.target.files))}),e.qZA()()()}if(2&i){const t=e.oxw();e.Q6J("formGroup",t.importForm),e.xp6(4),e.Oqu(e.lcZ(5,10,"igo.geo.importExportForm.importProjPlaceholder")),e.xp6(2),e.Q6J("value",t.inputProj),e.xp6(1),e.Q6J("ngForOf",e.lcZ(8,12,t.projections$)),e.xp6(2),e.Q6J("matTooltip",t.importForm.invalid?e.lcZ(10,14,"igo.geo.importExportForm.projections.choose"):e.lcZ(11,16,"igo.geo.importExportForm.importButton")),e.xp6(3),e.Q6J("disabled",t.importForm.invalid||e.lcZ(13,18,t.loading$)),e.xp6(2),e.hij(" ",e.lcZ(15,20,"igo.geo.importExportForm.importButton")," "),e.xp6(2),e.Q6J("shown",e.lcZ(17,22,t.loading$)),e.xp6(2),e.Udp("display","none")}}const nS=function(i){return{size:i}};function rS(i,r){if(1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ul")(5,"li"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"li"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"li"),e._uU(12),e.ALo(13,"translate"),e.qZA()()()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.importExportForm.importClarifications")),e.xp6(4),e.Oqu(e.xi3(7,6,"igo.geo.importExportForm.importSizeMax",e.VKq(13,nS,t.fileSizeMb))),e.xp6(3),e.Oqu(e.lcZ(10,9,"igo.geo.importExportForm.importFormatAuthorized")),e.xp6(3),e.Oqu(e.lcZ(13,11,"igo.geo.importExportForm.importShpZip"))}}function sS(i,r){if(1&i&&e._UZ(0,"igo-custom-html",20),2&i){const t=e.oxw(2);e.Q6J("html",t.importHtmlClarifications)}}function aS(i,r){if(1&i&&(e.TgZ(0,"section",17),e.YNc(1,rS,14,15,"div",18),e.YNc(2,sS,1,1,"igo-custom-html",19),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",""===t.importHtmlClarifications),e.xp6(1),e.Q6J("ngIf",""!==t.importHtmlClarifications)}}function lS(i,r){1&i&&(e.TgZ(0,"section",17)(1,"h4"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function cS(i,r){if(1&i&&(e.TgZ(0,"span",31),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE(" (+",t.layers.length-1," ",e.lcZ(2,2,2===(null==t.layers?null:t.layers.length)?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function uS(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",34),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.onlySelectedClick(n,s.id))})("checked",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.inLayersIdToExportSelectionOnly(n))})("change",function(n){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.onlySelected(n,s.id))}),e.TgZ(1,"small"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&i&&(e.Q6J("labelPosition","after"),e.xp6(2),e.Oqu(e.lcZ(3,2,"igo.geo.importExportForm.exportSelectedFeature")))}const pS=function(i){return{"igo-export-layer-mat-option":i}};function dS(i,r){if(1&i&&(e.TgZ(0,"mat-option",32),e.NdJ("click",function(o){return o.stopPropagation()}),e.TgZ(1,"p",16),e._uU(2),e.qZA(),e.TgZ(3,"p",16),e.YNc(4,uS,4,4,"mat-slide-toggle",33),e.qZA()()),2&i){const t=r.$implicit,o=e.oxw(2);e.Q6J("ngClass",e.VKq(4,pS,o.layerHasSelectedFeatures(t)))("value",t.id),e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",o.layerHasSelectedFeatures(t))}}function gS(i,r){if(1&i&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.export.format."+t.value)," ")}}function mS(i,r){if(1&i&&(e.ynx(0),e.YNc(1,gS,3,4,"mat-option",35),e.ALo(2,"keyvalue"),e.ALo(3,"async"),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,e.lcZ(3,3,t.formats$)))}}function hS(i,r){1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.export.noFormat.title")," "))}function fS(i,r){1&i&&(e.TgZ(0,"div",6)(1,"mat-form-field"),e._UZ(2,"input",37),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.s9C("placeholder",e.lcZ(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function _S(i,r){if(1&i&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.export.encoding."+t.value)," ")}}function yS(i,r){if(1&i&&(e.ynx(0),e.YNc(1,_S,3,4,"mat-option",35),e.ALo(2,"keyvalue"),e.ALo(3,"async"),e.BQk()),2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,e.lcZ(3,3,t.encodings$)))}}function vS(i,r){if(1&i&&(e.TgZ(0,"div",6)(1,"mat-form-field")(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-select",38),e.YNc(6,yS,4,5,"ng-container",18),e.ALo(7,"async"),e.qZA()()()),2&i){const t=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,2,"igo.geo.importExportForm.encodingPlaceholder")),e.xp6(3),e.Q6J("ngIf",0!==e.lcZ(7,4,t.encodings$).length)}}function bS(i,r){1&i&&(e.TgZ(0,"div",39)(1,"mat-slide-toggle",40),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function CS(i,r){1&i&&(e.TgZ(0,"div",41)(1,"mat-slide-toggle",42),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function xS(i,r){1&i&&(e.TgZ(0,"div",43)(1,"mat-slide-toggle",44),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function SS(i,r){if(1&i&&e._UZ(0,"igo-custom-html",20),2&i){const t=e.oxw(2);e.Q6J("html",t.exportHtmlClarifications)}}function wS(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",21),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.layers=n)}),e.TgZ(7,"mat-select-trigger"),e._uU(8),e.YNc(9,cS,3,4,"span",22),e.qZA(),e.YNc(10,dS,5,6,"mat-option",23),e.ALo(11,"async"),e.qZA()()(),e.TgZ(12,"div",6)(13,"mat-form-field")(14,"mat-label"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"mat-select",24),e.YNc(18,mS,4,5,"ng-container",18),e.ALo(19,"async"),e.YNc(20,hS,3,3,"mat-option",25),e.ALo(21,"async"),e.qZA()()(),e.YNc(22,fS,4,3,"div",26),e.YNc(23,vS,8,6,"div",26),e.YNc(24,bS,4,4,"div",27),e.YNc(25,CS,4,4,"div",28),e.YNc(26,xS,4,4,"div",29),e.TgZ(27,"div",30)(28,"button",10),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.handleExportFormSubmit(n.form.value))}),e.ALo(29,"async"),e._uU(30),e.ALo(31,"translate"),e.ALo(32,"translate"),e.ALo(33,"translate"),e.qZA(),e._UZ(34,"igo-spinner",11),e.ALo(35,"async"),e.qZA(),e.YNc(36,SS,1,1,"igo-custom-html",19),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(4),e.Oqu(e.lcZ(5,18,"igo.geo.importExportForm.exportLayerPlaceholder")),e.xp6(2),e.Q6J("value",t.layers),e.xp6(2),e.hij(" ",t.layers.length?t.getLayerTitleById(t.layers[0]):""," "),e.xp6(1),e.Q6J("ngIf",t.layers.length>1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(11,20,t.exportableLayers$)),e.xp6(5),e.Oqu(e.lcZ(16,22,"igo.geo.importExportForm.exportFormatPlaceholder")),e.xp6(3),e.Q6J("ngIf",0!==e.lcZ(19,24,t.formats$).length),e.xp6(2),e.Q6J("ngIf",0===e.lcZ(21,26,t.formats$).length),e.xp6(2),e.Q6J("ngIf",t.forceNaming&&"URL"!==t.form.value.format),e.xp6(1),e.Q6J("ngIf","CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format),e.xp6(1),e.Q6J("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)),e.xp6(1),e.Q6J("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)&&t.form.value.combineLayers),e.xp6(1),e.Q6J("ngIf","URL"!==t.form.value.format),e.xp6(2),e.Q6J("disabled",!t.form.valid||e.lcZ(29,28,t.loading$)),e.xp6(2),e.hij(" ","URL"!==t.form.value.format?e.lcZ(31,30,"igo.geo.importExportForm.exportButton"):t.form.value.layers.length>1?e.lcZ(32,32,"igo.geo.importExportForm.exportButtonLinks"):e.lcZ(33,34,"igo.geo.importExportForm.exportButtonLink")," "),e.xp6(4),e.Q6J("shown",e.lcZ(35,36,t.loading$)),e.xp6(2),e.Q6J("ngIf",""!==t.exportHtmlClarifications)}}let $u=(()=>{class i{constructor(t,o,n,s,a,l,c,u,p,d,g,h,m){this.importService=t,this.exportService=o,this.languageService=n,this.messageService=s,this.styleListService=a,this.styleService=l,this.formBuilder=c,this.config=u,this.cdRef=p,this.storageService=d,this.downloadService=g,this.layerService=h,this.confirmDialogService=m,this.formats$=new b.X(void 0),this.encodings$=new b.X(void 0),this.exportableLayers$=new b.X([]),this.loading$=new b.X(!1),this.forceNaming=!1,this.controlFormat="format",this.espgCodeRegex=new RegExp("^\\d{4,6}"),this.projections$=new b.X([]),this.popupChecked=!1,this.previousLayerSpecs$=new b.X(void 0),this.selectFirstProj=!1,this._projectionsLimitations={},this.selectedMode="import",this.selectMode=new e.vpe,this.exportOptions$=new b.X(void 0),this.exportOptionsChange=new e.vpe,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}set projectionsLimitations(t){this._projectionsLimitations=t,this.computeProjections()}get projectionsLimitations(){return this._projectionsLimitations||{}}get layers(){return this.form.get("layers").value}set layers(t){this.form.patchValue({layers:t})}get inputProj(){return this.importForm.get("inputProj").value}set inputProj(t){this.importForm.patchValue({inputProj:t})}get popupAllowed(){return this.storageService.get("importExportPopupAllowed")||!1}set popupAllowed(t){this.storageService.set("importExportPopupAllowed",t)}ngOnInit(){this.layers$$=this.map.layers$.subscribe(o=>{this.exportableLayers$.next(o.filter(n=>n instanceof Te&&!0===n.exportable||n.dataSource.options.download&&n.dataSource.options.download.url))});const t=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(t||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe((0,At.n)(o=>!o)).subscribe(o=>{this.form.patchValue(o,{emitEvent:!0}),o.layers&&this.computeFormats(o.layers.map(n=>this.map.getLayerById(n)))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(o=>{var n;const s=Object.keys(Hr.ogreFormats);!this.popupChecked&&(null===(n=this.form.get("layers").value)||void 0===n?void 0:n.length)>1&&(s.indexOf(o)>=0||o===ie.URL)&&(this.handlePopup(!0)||this.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(o=>{this.handlePreviousLayerSpecs();const n=o instanceof Array?o:[o];this.form.patchValue({layers:n},{emitEvent:!1});const s=n.map(l=>this.map.getLayerById(l));this.computeFormats(s),-1===Object.keys(this.formats$.value).indexOf(this.form.value.format)&&this.form.patchValue({format:void 0}),this.loading$.next(!0);const a=[];s.forEach(l=>{l instanceof Te&&0===l.dataSource.ol.getFeatures().length&&(a.push({id:l.id,visible:l.visible,opacity:l.opacity,queryable:l.queryable}),l.opacity=0,l.visible=!0)}),this.previousLayerSpecs$.next(a),setTimeout(()=>{this.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe((0,At.n)(o=>!o)).subscribe(o=>{1===Object.keys(o).length&&this.form.patchValue({format:o[Object.keys(o)[0]]})}),this.encodings$$=this.encodings$.pipe((0,At.n)(o=>!o)).subscribe(o=>{1===Object.keys(o).length&&this.form.patchValue({encoding:o[Object.keys(o)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe((0,At.n)(o=>!o)).subscribe(o=>{1===o.length&&this.form.patchValue({layers:o[0].id})}),this.form.controls[this.controlFormat].valueChanges.subscribe(o=>{this.form.patchValue(o===ie.CSVcomma||o===ie.CSVsemicolon?{encoding:ro.LATIN1}:{encoding:ro.UTF8}),this.cdRef.detectChanges()}),this.importForm.patchValue(this.selectFirstProj?0===this.projections$.value.length?{inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}:{inputProj:this.projections$.value[0]}:{inputProj:void 0})}computeProjections(){this.projectionsConstraints=function Hc(i){const r=i.mtmZone,t=i.utmZone;return{projFromConfig:!1!==i.projFromConfig,nad83:!1!==i.nad83,wgs84:!1!==i.wgs84,webMercator:!1!==i.webMercator,utm:!1!==i.utm,mtm:!1!==i.mtm,utmZone:{minZone:t&&t.minZone?t.minZone:17,maxZone:t&&t.maxZone?t.maxZone:21},mtmZone:{minZone:r&&r.minZone?r.minZone:2,maxZone:r&&r.maxZone?r.maxZone:10}}}(this.projectionsLimitations);const t=[];if(this.projectionsConstraints.nad83&&t.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:""}),this.projectionsConstraints.wgs84&&t.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:""}),this.projectionsConstraints.webMercator&&t.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:""}),this.projectionsConstraints.mtm){const s=this.projectionsConstraints.mtmZone.maxZone;for(let a=this.projectionsConstraints.mtmZone.minZone;a<=s;a++)t.push({translateKey:"mtm",alias:`MTM ${a}`,code:a<10?`EPSG:3218${a}`:`EPSG:321${80+a}`,zone:`${a}`})}if(this.projectionsConstraints.utm){const s=this.projectionsConstraints.utmZone.maxZone;for(let a=this.projectionsConstraints.utmZone.minZone;a<=s;a++)t.push({translateKey:"utm",alias:`UTM ${a}`,code:a<10?`EPSG:3260${a}`:`EPSG:326${a}`,zone:`${a}`})}let o=[];this.projectionsConstraints.projFromConfig&&(o=this.config.getConfig("projections")||[]),this.projections$.next(o.concat(t))}getWorkspaceByLayerId(t){const o=this.store.all().find(n=>n.layer.id===t);if(o)return o}getLayerTitleById(t){var o;return null===(o=this.map.getLayerById(t))||void 0===o?void 0:o.title}layerHasSelectedFeatures(t){const o=this.getWorkspaceByLayerId(t.id);if(o)return!!o.entityStore.stateView.firstBy(s=>!0===s.state.selected)}onlySelected(t,o){let n=this.form.value.layersWithSelection;t.checked?n.push(o):n=n.filter(s=>s!==o),this.form.patchValue({layersWithSelection:n})}onlySelectedClick(t,o){this.form.value.layers.find(n=>n===o)&&t.stopPropagation()}inLayersIdToExportSelectionOnly(t){return!!this.form.value.layersWithSelection.find(o=>o===t.id)}ngOnDestroy(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.encodings$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}handlePreviousLayerSpecs(){const t=this.previousLayerSpecs$.value;t&&t.length&&t.forEach(o=>{const n=this.map.getLayerById(o.id);n.visible=o.visible,n.opacity=o.opacity,n.queryable=o.queryable}),this.previousLayerSpecs$.next(void 0)}importFiles(t){let o=this.inputProj.code;this.espgCodeRegex.test(o)&&(o=`EPSG:${o}`),this.loading$.next(!0);for(const n of t)this.importService.import(n,o).subscribe(s=>this.onFileImportSuccess(n,s),s=>this.onFileImportError(n,s),()=>{this.loading$.next(!1)})}handlePopup(t=!0){window.open("","popup","width=1, height=1").close();const n=window.open("","popup","width=1, height=1");return!n||n.closed||void 0===n.closed||null===n?(this.onPopupBlockedError(t),this.popupAllowed=!1):(n.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}handleExportFormSubmit(t){this.loading$.next(!0);const o=Object.keys(Hr.ogreFormats);!this.popupChecked&&t.layers.length>1&&(o.indexOf(t.format)>=0||t.format===ie.URL)&&!this.popupAllowed&&this.handlePopup();let n=[],s=[],a="";for(const[l,c]of t.layers.entries()){const u=this.map.getLayerById(c);t.format!==ie.CSVsemicolon&&t.format!==ie.CSVcomma||!t.combineLayers||1===t.layers.length?(a=u.title,t.name&&(a=t.name)):a=this.languageService.translate.instant("igo.geo.export.combinedLayers");const p=u.dataSource.options;if(t.format===ie.URL&&p.download&&(p.download.url||p.download.dynamicUrl))return void setTimeout(()=>{const m=p.download.url||p.download.dynamicUrl;m.match(/service=wfs/gi)?this.downloadService.open(u):window.open(m,"_blank"),this.loading$.next(!1)},500);const d=this.getWorkspaceByLayerId(c);let g;if(d&&d.entityStore&&d.entityStore.stateView.all().length)g=-1!==t.layersWithSelection.indexOf(c)&&t.featureInMapExtent?d.entityStore.stateView.all().filter(m=>m.state.inMapExtent&&m.state.selected).map(m=>m.entity.ol):-1===t.layersWithSelection.indexOf(c)||t.featureInMapExtent?t.featureInMapExtent?d.entityStore.stateView.all().filter(m=>m.state.inMapExtent).map(m=>m.entity.ol):d.entityStore.stateView.all().map(m=>m.entity.ol):d.entityStore.stateView.all().filter(m=>m.state.selected).map(m=>m.entity.ol);else{const m=u.dataSource.ol;g=t.featureInMapExtent?m.getFeaturesInExtent(u.map.viewController.getExtent()):m.getFeatures(),u.dataSource instanceof _o&&(g=g.flatMap(y=>y.get("features")))}let h=[];if(t.format===ie.Shapefile||t.format===ie.GPX?g.forEach(m=>{const y=m.getGeometry().getType(),v=h.find(S=>S.geometryType===y);v?v.features.push(m):h.push({geometryType:y,features:[m]})}):h=[{geometryType:"",features:g}],h.forEach(m=>{m.features.forEach(y=>{const v=y.get("rad");if(v){const S=[y.get("longitude"),y.get("latitude")],M=(0,kt.iu)(S,v,500);M.transform("EPSG:4326",y.get("_projection")),y.setGeometry(M)}})}),t.format===ie.GPX){const m=h.length;h=h.filter(v=>["LineString","Point"].includes(v.geometryType)),m>h.length&&this.messageService.error("igo.geo.export.gpx.error.poly.text","igo.geo.export.gpx.error.poly.title",{timeOut:2e4})}else if((t.format===ie.CSVsemicolon||t.format===ie.CSVcomma)&&t.combineLayers){if(h.forEach(m=>n.push(m)),l!==t.layers.length-1)continue;{let m;n.forEach(y=>{y.features.forEach(v=>{if(t.separator)if(m){if(v.get("_featureStore").layer.options.title!==m.get("_featureStore").layer.options.title){const S=this.createTitleEmptyRows(m,v);s.push(S[2]),s.push(S[0]),s.push(S[1])}}else{const S=this.createTitleEmptyRows(v,v);s.push(S[0])}s.push(v),m=v})})}}0===h.length?(this.loading$.next(!1),this.messageService.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title",{timeOut:2e4})):(t.format!==ie.CSVsemicolon&&t.format!==ie.CSVcomma||!t.combineLayers)&&h.map(m=>this.exportService.export(m.features,t.format,a+m.geometryType,t.encoding,this.map.projection).subscribe(()=>{},y=>this.onFileExportError(y),()=>{this.onFileExportSuccess(),m.features.forEach(y=>{this.circleToPoint(y)}),this.loading$.next(!1)}))}(t.format===ie.CSVsemicolon||t.format===ie.CSVcomma)&&t.combineLayers&&this.exportService.export(s,t.format,a,t.encoding,this.map.projection).subscribe(()=>{},l=>this.onFileExportError(l),()=>{this.onFileExportSuccess(),s.forEach(l=>{this.circleToPoint(l)}),this.loading$.next(!1)})}createTitleEmptyRows(t,o){const n=o.clone(),s=o.clone(),a=o.clone(),l=t.getKeys();let c="";for(const m in l)if("geometry"!==l[m]){c=l[m];break}const u=o.getKeys();let p="";for(const m in u)if("geometry"!==u[m]){p=u[m];break}const d=o.getKeys();l.forEach(m=>{d.includes(m)&&m!==c&&d.push(m)}),d.unshift(c);let g="";for(const m in d)if("geometry"!==d[m]){g=d[m];break}return d.forEach(m=>{const y=l.length===u.length&&l.every((v,S)=>v===u[S]);m!==g||y?m===g&&y||m===p?(n.set(m,o.get("_featureStore").layer.options.title,!0),s.set(m,m,!0),a.unset(m,!0)):"geometry"!==m?(n.unset(m,!0),s.set(m,m,!0),a.unset(m,!0)):(n.unset(m,!0),a.unset(m,!0)):(n.set(m,o.get("_featureStore").layer.options.title+" ===============>",!0),s.set(m,m,!0),a.unset(m,!0)),u.includes(m)||s.unset(m,!0)}),[n,s,a]}circleToPoint(t){if(t.get("rad")){const n=new Pe.Z([t.get("longitude"),t.get("latitude")]);n.transform("EPSG:4326",t.get("_projection")),t.setGeometry(n)}}buildForm(){this.importForm=this.formBuilder.group({inputProj:["",[_.kI.required]]}),this.form=this.formBuilder.group(this.forceNaming?{format:["",[_.kI.required]],layers:[[],[_.kI.required]],layersWithSelection:[[]],encoding:[ro.UTF8,[_.kI.required]],combineLayers:[!0,[_.kI.required]],separator:[!1,[_.kI.required]],featureInMapExtent:[!1,[_.kI.required]],name:["",[_.kI.required]]}:{format:["",[_.kI.required]],layers:[[],[_.kI.required]],layersWithSelection:[[]],encoding:[ro.UTF8,[_.kI.required]],combineLayers:[!0,[_.kI.required]],separator:[!1,[_.kI.required]],featureInMapExtent:[!1,[_.kI.required]]})}onFileImportSuccess(t,o){const n=this.config.getConfig("importExport"),s=null!=n&&n.allowToStoreLayer?this.confirmDialogService:void 0,a=(null==n?void 0:n.importWithStyle)||this.config.getConfig("importWithStyle");this.config.getConfig("importWithStyle")&&console.warn("\n      The location of this config importWithStyle is deprecated.\n      Please move this property within importExport configuration.\n      Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\n      Refer to environnement.ts OR config/config.json\n      This legacy conversion will be deleted in 2024.\n      "),a?zr(t,o,this.map,this.contextUri,this.messageService,this.layerService,s,this.styleListService,this.styleService):zr(t,o,this.map,this.contextUri,this.messageService,this.layerService,s)}onFileImportError(t,o){this.loading$.next(!1),function Du(i,r,t,o){({"Invalid file":jx,"File is too large":Hx,"Failed to read file":Yx,"Invalid SRS definition":zx,"Error 500 with OGRE":Wx})[r.message](i,r,t,o=o||30)}(t,o,this.messageService,this.fileSizeMb)}onPopupBlockedError(t=!0){this.loading$.next(!1),this.messageService.error("igo.geo.export.popupBlocked.text","igo.geo.export.popupBlocked.title",{timeOut:2e4},{extraMessage:t?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry"})}onFileExportError(t){this.loading$.next(!1),function Ux(i,r){i instanceof Yr?function qx(i){i.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title")}(r):r.error("igo.geo.export.failed.text","igo.geo.export.failed.title")}(t,this.messageService)}loadConfig(){void 0!==this.config.getConfig("importExport.forceNaming")&&(this.forceNaming=this.config.getConfig("importExport.forceNaming")),this.computeFormats(),this.loadEncodings()}encodingDefaultValue(t){return t===ie.CSVcomma||t===ie.CSVsemicolon?(this.form.patchValue({encoding:ro.LATIN1}),ro.LATIN1):(this.form.patchValue({encoding:ro.UTF8}),ro.UTF8)}loadEncodings(){this.encodings$.next(ro)}computeFormats(t){let o=Object.keys(ie);const n={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},s=[];if(t&&t.length)if(t.forEach(l=>{var c;!l||(null!==(c=l.dataSource.options.download)&&void 0!==c&&c.allowedFormats?(n.customList=!0,s.push({layer:l.title,formats:this.validateListFormat(l.dataSource.options.download.allowedFormats)})):l instanceof Te||!l.dataSource.options.download||!l.dataSource.options.download.url?l.dataSource.options.download&&(l.dataSource.options.download.url||l.dataSource.options.download.dynamicUrl)?n.vectorAndUrl=!0:l instanceof Te&&(n.onlyVector=!0):n.onlyUrl=!0)}),!0===n.onlyUrl&&!1===n.onlyVector)o=["URL"];else if(!0===n.onlyVector&&!1===n.onlyUrl)this.computeFormats(),ie.URL in this.formats$.value&&(o=Object.keys(this.formats$.value).filter(c=>"URL"!==c));else if(!0===n.vectorAndUrl&&!1===n.onlyUrl&&!1===n.onlyVector&&(this.computeFormats(),!(ie.URL in this.formats$.value))){const l=Object.keys(this.formats$.value);l.push("URL"),o=l}const a=this.config.getConfig("importExport.formats");if(a){const l=this.validateListFormat(a);o=o.filter(c=>l.includes(c))}if(n.customList){let l;const c=[];let u=s[0].formats;s.map(d=>{c.push(d.layer),l=d.formats.filter(g=>u.includes(g)),u=d.formats});const p=l.filter(d=>o.includes(d));p.length>0?(this.formats$.next(co(p)),t&&t.length&&t.length>1&&this.messageService.alert("igo.geo.export.customList.text","igo.geo.export.customList.title",void 0,{value:c.join()})):(this.formats$.next([]),this.messageService.alert("igo.geo.export.noFormat.text","igo.geo.export.noFormat.title"))}else this.formats$.next(co(o))}validateListFormat(t){return t.filter(o=>{if(o.toUpperCase()===ie.CSVcomma.toUpperCase()||o.toUpperCase()===ie.CSVsemicolon.toUpperCase()||o.toUpperCase()===ie.GML.toUpperCase()||o.toUpperCase()===ie.GPX.toUpperCase()||o.toUpperCase()===ie.GeoJSON.toUpperCase()||o.toUpperCase()===ie.KML.toUpperCase()||o.toUpperCase()===ie.Shapefile.toUpperCase()||o.toUpperCase()===ie.URL.toUpperCase())return o}).map(o=>o.toUpperCase()===ie.CSVcomma.toUpperCase()?o=ie.CSVcomma:o.toUpperCase()===ie.CSVsemicolon.toUpperCase()?o=ie.CSVsemicolon:o.toUpperCase()===ie.GML.toUpperCase()?o=ie.GML:o.toUpperCase()===ie.GPX.toUpperCase()?o=ie.GPX:o.toUpperCase()===ie.GeoJSON.toUpperCase()?o=ie.GeoJSON:o.toUpperCase()===ie.KML.toUpperCase()?o=ie.KML:o.toUpperCase()===ie.Shapefile.toUpperCase()?o=ie.Shapefile:o.toUpperCase()===ie.URL.toUpperCase()?o=ie.URL:void 0)}modeChanged(t){this.selectMode.emit(t)}onFileExportSuccess(){!function Nx(i){i.success("igo.geo.export.success.text","igo.geo.export.success.title")}(this.messageService)}onImportExportChange(t){this.selectedMode=t.value}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Pu),e.Y36(Hr),e.Y36(D),e.Y36(_e),e.Y36(Xr),e.Y36(no),e.Y36(_.QS),e.Y36(J),e.Y36(e.sBO),e.Y36(ce),e.Y36(pu),e.Y36(Le),e.Y36(bn))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",contextUri:"contextUri",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},decls:14,vars:17,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],["class","mat-typography",4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"value","valueChange"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["hidden","","type","file",3,"click","change"],["fileInput",""],[3,"value","click"],["mat-line","",4,"ngIf"],["mat-line",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["multiple","",3,"value","valueChange"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-combine-layers mat-typography",4,"ngIf"],["class","export-separator mat-typography",4,"ngIf"],["class","export-options mat-typography",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"ngClass","value","click"],[3,"labelPosition","click","checked","change",4,"ngIf"],[3,"labelPosition","click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","encoding"],[1,"export-combine-layers","mat-typography"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator","mat-typography"],["formControlName","separator",3,"labelPosition"],[1,"export-options","mat-typography"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mat-button-toggle-group",1),e.NdJ("change",function(s){return o.onImportExportChange(s)}),e.TgZ(2,"mat-button-toggle",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-button-toggle",2),e._uU(6),e.ALo(7,"translate"),e.qZA()()(),e.YNc(8,iS,20,24,"form",3),e.YNc(9,aS,3,2,"section",4),e.YNc(10,lS,4,3,"section",4),e.ALo(11,"async"),e.YNc(12,wS,37,38,"form",3),e.ALo(13,"async")),2&t&&(e.xp6(1),e.Q6J("value",o.selectedMode),e.xp6(1),e.Q6J("value","import"),e.xp6(1),e.hij(" ",e.lcZ(4,9,"igo.geo.importExportForm.importTabTitle")," "),e.xp6(2),e.Q6J("value","export"),e.xp6(1),e.hij(" ",e.lcZ(7,11,"igo.geo.importExportForm.exportTabTitle")," "),e.xp6(2),e.Q6J("ngIf","import"===o.selectedMode),e.xp6(1),e.Q6J("ngIf","import"===o.selectedMode),e.xp6(1),e.Q6J("ngIf",0===e.lcZ(11,13,o.exportableLayers$).length&&"export"===o.selectedMode),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,15,o.exportableLayers$).length>0&&"export"===o.selectedMode))},dependencies:[O.gM,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,f.mk,f.sg,f.O5,w.lW,Re.A9,Re.Yi,I.KE,I.hX,ue.gD,ue.$L,Q.ey,H.Nt,at.Rr,br,ks,f.Ov,L.X$,ci],styles:["mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}.import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}h4[_ngcontent-%COMP%]{padding:0 5px}.igo-form[_ngcontent-%COMP%]{padding:15px 5px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}.export-options[_ngcontent-%COMP%], .export-combine-layers[_ngcontent-%COMP%], .export-separator[_ngcontent-%COMP%]{overflow-x:hidden}.export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content, .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content, .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}"]}),i})(),es=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[T.Ps,O.AV,_.u5,_.UX,f.ez,w.ot,Re.vV,lt.Nh,ue.LD,Q.Ng,I.lN,H.c,at.rP,oe,Cr,ki,jg,Oi]}),i})(),st=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,oe,kl,T.Ps,w.ot,O.AV]}),i})();function TS(i,r){if(1&i&&(e.TgZ(0,"mat-option",5),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}e.B6R(Fy,[f.mk,f.sg,f.O5,T.Hw,w.lW,O.gM,zc],[L.X$]),e.B6R(zc,[f.O5,Ae],[]);let MS=(()=>{class i{constructor(){this.measure$=new b.X(void 0),this._auto=!1,this.measureUnitChange=new e.vpe}set measure(t){this.measure$.next(t)}get measure(){return this.measure$.value}set auto(t){this.toggleAutoUnit(t)}get auto(){return this._auto}get measureUnits(){return Object.values(this.measureType===qt.Area?Ue:K)}ngOnDestroy(){this.toggleAutoUnit(!1)}onMeasureUnitChange(t){this.measureUnit=t,this.measureUnitChange.emit(t)}toggleAutoUnit(t){void 0!==this.measure$$&&this.measure$$.unsubscribe(),!0===t&&(this.measure$$=this.measure$.subscribe(o=>{this.computeBestMeasureUnit(o)})),this._auto=t}computeBestMeasureUnit(t){let o=this.measureUnit;this.measureType===qt.Area?o=function Gb(i){let r=Ue.SquareMeters,t=i;const o=[Ue.SquareKilometers];for(;t>1e6&&o.length>0;)r=o.pop(),t=Ci(i,r);return r}(t):this.measureType===qt.Length&&(o=function qb(i){let r=K.Meters,t=i;const o=[K.Kilometers];for(;t>1e3&&o.length>0;)r=o.pop(),t=Ho(i,r);return r}(t)),o!==this.measureUnit&&this.onMeasureUnitChange(o)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},decls:9,vars:11,consts:[["appearance","outline","floatLabel","always",1,"measure-field"],["matInput","",3,"readonly","value"],[1,"unit-field"],[3,"value","disabled","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-form-field",0)(1,"mat-label"),e._uU(2),e.qZA(),e._UZ(3,"input",1),e.ALo(4,"measureFormat"),e.ALo(5,"async"),e.qZA(),e.TgZ(6,"mat-form-field",2)(7,"mat-select",3),e.NdJ("selectionChange",function(s){return o.onMeasureUnitChange(s.value)}),e.YNc(8,TS,3,4,"mat-option",4),e.qZA()()),2&t&&(e.xp6(2),e.Oqu(o.placeholder),e.xp6(1),e.Q6J("readonly",!0)("value",e.xi3(4,6,e.lcZ(5,9,o.measure$)||0,o.measureUnit)),e.xp6(4),e.Q6J("value",o.measureUnit)("disabled",o.auto),e.xp6(1),e.Q6J("ngForOf",o.measureUnits))},dependencies:[f.sg,I.KE,I.hX,H.Nt,ue.gD,Q.ey,f.Ov,L.X$,Mu],styles:["[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}.measure-field[_ngcontent-%COMP%]{pointer-events:none;display:flex;flex-flow:column nowrap;width:100%}.unit-field[_ngcontent-%COMP%]{width:50px;margin-left:10px;margin-top:10px}"],changeDetection:0}),i})(),Eu=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,w.ot,Re.vV,T.Ps,O.AV,I.lN,H.c,ue.LD,at.rP,vt.t,oe,Zi]}),i})();e.B6R(Ja,[f.O5,w.lW,Re.A9,Re.Yi,T.Hw,O.gM,at.Rr,vt.d,li,MS],[f.Ov,L.X$]),e.B6R(Tu,[f.O5],[L.X$,Mu]);let Ju=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Eu]}),i})();var Wn=(()=>{return(i=Wn||(Wn={}))[i.None=0]="None",i[i.Move=1]="Move",i[i.Zoom=2]="Zoom",i[i.ZoomIfOutMapExtent=3]="ZoomIfOutMapExtent",Wn;var i})();let Ru=(()=>{class i{constructor(){this.features$=new b.X([[],void 0])}setFeatures(t,o=Wn.None){this.features$.next([t,o])}clear(){this.features$.next([[],Wn.None])}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),FS=(()=>{class i{constructor(t,o){this.component=t,this.overlayService=o,this.format=new be.Z}get map(){return this.component.map}ngOnInit(){this.features$$=this.overlayService.features$.subscribe(t=>this.handleFeatures(t[0],t[1]))}ngOnDestroy(){this.features$$.unsubscribe()}handleFeatures(t,o){}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ae,2),e.Y36(Ru))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoOverlay",""]]}),i})(),ts=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})();function AS(i){const r=function(t,o){const n=t.join(" "),s=o[0],a=o[2],l=o[1],c=o[3],u=[c,s,l,s,l,a,c,a].join(" "),p=this.internal.newAdditionalObject(),d=this.internal.newAdditionalObject(),g=this.internal.newAdditionalObject();g.content='<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.017453292519943295]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",0.0],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]) >>',d.content="<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS "+g.objId+" 0 R /GPTS [ "+u+" ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>",p.content="<< /BBox [ "+n+" ] /Measure "+d.objId+" 0 R /Name (Layer) /Type /Viewport >>";const h=this.internal.newAdditionalObject(),m=(new Date).toLocaleDateString("en-CA");return h.content="<< /Name IGO2 /Type /OCG /Date "+m+" >>",p.objId};i.setGeoArea=function(t,o){this.internal.events.subscribe("putPage",function(){const n=r.call(this,t,o);this.internal.write("/VP [ "+n+" 0 R ]")})}}const Bu=co(["Pdf","Image"]),so=co(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),bo=co(["landscape","portrait"]),Uu=co(["72","96","150","300"]),Nu=co(["Bmp","Gif","Jpeg","Png","Tiff"]),qu=co(["none","topright","topleft","bottomleft","bottomright","newpage"]);let LS=(()=>{class i{constructor(t,o,n,s,a){this.http=t,this.messageService=o,this.activityService=n,this.languageService=s,this.configService=a,this.TEXTPDFFONT={titleFont:"Times",titleFontStyle:"bold",subtitleFont:"Times",subtitleFontStyle:"bold",commentFont:"courier",commentFontStyle:"normal",commentFontSize:12}}print(t,o){const n=new Se.x,s=o.paperFormat,a=+o.resolution,l=o.orientation;this.activityId=this.activityService.register(),AS(yc.ZP.API);const u=new yc.ZP({orientation:l,format:s.toLowerCase(),unit:"mm"}),p=[u.internal.pageSize.width,u.internal.pageSize.height],d=[10,10,10,10],h=p[1]-d[0]-d[2],m=[p[0]-d[3]-d[1],h];let y,v;(""!==o.title||o.subtitle)&&(s===so.A1||s===so.A0)&&(d[0]+=10);const S=Math.round(2*(h+145)*.05)/2;return void 0!==o.title&&""!==o.title&&(y=this.getTextPdfObjectSizeAndMarg(o.title,d,this.TEXTPDFFONT.titleFont,S,this.TEXTPDFFONT.titleFontStyle,u),this.addTextInPdfDoc(u,o.title,this.TEXTPDFFONT.titleFont,this.TEXTPDFFONT.titleFontStyle,y.fontSize,y.marginLeft+d[3],d[0]),d[0]=y.height+d[0]),void 0!==o.subtitle&&""!==o.subtitle&&(v=this.getTextPdfObjectSizeAndMarg(o.subtitle,d,this.TEXTPDFFONT.subtitleFont,""!==o.title?.7*y.fontSize:.7*S,this.TEXTPDFFONT.subtitleFontStyle,u),this.addTextInPdfDoc(u,o.subtitle,this.TEXTPDFFONT.subtitleFont,this.TEXTPDFFONT.subtitleFontStyle,v.fontSize,v.marginLeft+d[3],d[0]),d[0]+=5),(!0===o.showProjection||!0===o.showScale)&&this.addProjScale(u,t,a,o.showProjection,o.showScale),void 0!==o.comment&&""!==o.comment&&this.addComment(u,o.comment),this.addMap(u,t,a,m,d).subscribe(M=>(0,j.mG)(this,void 0,void 0,function*(){M===ve.Done&&(yield this.addScale(u,t,d),yield this.handleMeasureLayer(u,t,d),this.addGeoRef(u,t,this.imgSizeAdded[0],this.imgSizeAdded[1],1,d),"none"!==o.legendPosition?["topleft","topright","bottomleft","bottomright"].indexOf(o.legendPosition)>-1?yield this.addLegendSamePage(u,t,d,a,o.legendPosition):"newpage"===o.legendPosition&&(yield this.addLegend(u,t,d,a)):yield this.saveDoc(u)),(M===ve.Done||M===ve.Error)&&(this.activityService.unregister(this.activityId),n.next(ve.Done))})),n}addGeoRef(t,o,n,s,a,l){const u=t.internal.pageSize.getHeight(),p=l[3],d=u-l[0]-s;let g=[p,d,p+n,d+s];for(let m=0;m<g.length;m++)g[m]=this.pdf_units2points(g[m],"mm");const h=o.viewController.getExtent("EPSG:3857");t.setGeoArea(g,h)}handleMeasureLayer(t,o,n){return(0,j.mG)(this,void 0,void 0,function*(){if(o.layers.find(s=>s.visible&&s.id.startsWith("igo-measures-"))){let s;const a=o.ol.getOverlayContainer();yield hi(a,{scale:1,backgroundColor:null}).then(l=>{s=l}),this.addCanvas(t,s,n)}})}getLayersLegendHtml(t,o,n){return new Ke.y(s=>{let a="";const l=function $_(i,r){const t=[];for(const o of i){const n=o.options.legendOptions;if(!1===o.visible)continue;const s=o.dataSource.getLegend(void 0,r)||[];for(const a of s)void 0!==a.url&&t.push({title:o.title||"",url:a.url,display:void 0===(null==n?void 0:n.display)||n.display,isInResolutionsRange:o.isInResolutionsRange})}return t}(t.layers,{resolution:t.viewController.getResolution(),extent:t.viewController.getExtent(),projection:t.viewController.getOlProjection().getCode(),size:t.ol.getSize()});if(0===l.filter(u=>!0===u.display).length)return s.next(a),void s.complete();a+='<style media="screen" type="text/css">',a+=".html2canvas-container { width: "+o+"mm !important; height: 2000px !important; }",a+="table.tableLegend {table-layout: auto;}",a+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",a+="</style>",a+='<font size="3" face="Times" >',a+='<div class="styleLegend">',a+='<table class="tableLegend" >';const c=l.filter(u=>u.display&&!0===u.isInResolutionsRange).map(u=>this.getDataImage(u.url).pipe((0,Z.U)(p=>{let d="<tr><td>"+u.title.toUpperCase()+"</td></tr>";return d+='<tr><td><img src="'+p+'"></td></tr>',d})));(0,Qt.D)(c).subscribe(u=>{a=u.reduce((p,d)=>p+d,a),a+="</table>",a+="</div>",s.next(a),s.complete()})})}getDataImage(t){return new ur(this.http,this.configService).transform(t)}getLayersLegendImage(t,o="png",n,s){return(0,j.mG)(this,void 0,void 0,function*(){const a=new Se.x;let c=yield this.getLayersLegendHtml(t,200,s).toPromise();o=o.toLowerCase(),0===c.length&&(c='<font size="12" face="Courier New" >',c+='<div align="center"><b>NO LEGEND</b></div>');const u=window.document.createElement("div");u.style.position="absolute",u.style.top="0",window.document.body.appendChild(u),u.innerHTML=c,yield this.timeout(1);const p=yield hi(u,{useCORS:!0}).catch(d=>{console.log(d)});if(p){let d=ve.Done;try{n?this.generateCanvaFileToZip(p,"legendImage."+o):this.saveCanvasImageAsFile(p,"legendImage",o)}catch(g){d=ve.Error}a.next(d)}return a})}getTextPdfObjectSizeAndMarg(t,o,n,s,a,l){const p=l.internal.pageSize.getWidth()-o[1]-o[3];l.setFont(n,a),l.setFontSize(s);let g,d=l.getTextDimensions(t);return d.w>p?(g=0,l.setFontSize(s*=.7),d=l.getTextDimensions(t)):g=(p-d.w)/2,{fontSize:s,marginLeft:g,height:d.h}}addComment(t,o){this.addTextInPdfDoc(t,o,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,10,t.internal.pageSize.height-10,!0)}addTextInPdfDoc(t,o,n,s,a,l,c,u=!1){t.setFont(n,s),t.setFontSize(a),u&&(o=t.splitTextToSize(o,t.internal.pageSize.getWidth()-3*l)),t.text(o,l,c)}addProjScale(t,o,n,s,a){const l=this.languageService.translate,d=t.internal.pageSize.height-15;let g="";!0===s&&(g+=l.instant("igo.geo.printForm.projection")+": "+o.projection),!0===a&&(!0===s&&(g+="   "),g+=l.instant("igo.geo.printForm.scale")+": ~ 1 / "+pa(o.viewController.getScale(n))),t.setFont("courier"),t.setFontSize(12),t.text(g,10,d)}addLegend(t,o,n,s){return(0,j.mG)(this,void 0,void 0,function*(){const a=t.internal.pageSize.width,l=yield this.getLayersLegendHtml(o,a,s).toPromise();if(""===l)return yield this.saveDoc(t),!0;const c=window.document.createElement("div");c.style.position="absolute",c.style.top="0",window.document.body.appendChild(c),c.innerHTML=l,yield this.timeout(1);const u=yield hi(c,{useCORS:!0}).catch(p=>{console.log(p)});if(u){const d=[25.4*u.width*.85/s,25.4*u.height*.85/s];let g;t.addPage(),g=u.toDataURL("image/png"),t.addImage(g,"PNG",10,10,d[0],d[1])}yield this.saveDoc(t)})}addLegendSamePage(t,o,n,s,a){return(0,j.mG)(this,void 0,void 0,function*(){const l=t.internal.pageSize.width,c=yield this.getLayersLegendHtml(o,l,s).toPromise();if(""===c)return yield this.saveDoc(t),!0;const u=window.document.createElement("div");u.style.position="absolute",u.style.top="0",window.document.body.appendChild(u),u.innerHTML=c,yield this.timeout(1);const p=yield hi(u,{useCORS:!0}).catch(g=>{console.log(g)});let d;if(p){const h=[25.4*p.width*.85/s,25.4*p.height*.85/s];"bottomright"===a?d=[t.internal.pageSize.height-n[2]-h[1],n[1],n[2],t.internal.pageSize.width-n[1]-h[0]]:"topright"===a?d=[n[0],n[1],t.internal.pageSize.height-n[0]-h[1],t.internal.pageSize.width-n[1]-h[0]]:"bottomleft"===a?d=[t.internal.pageSize.height-n[2]-h[1]-15,t.internal.pageSize.width-n[3]-h[0],n[2]+15,n[3]]:"topleft"===a&&(d=[n[0],t.internal.pageSize.width-n[3]-h[0],t.internal.pageSize.height-n[0]-h[1],n[3]]),this.addCanvas(t,p,d),yield this.saveDoc(t)}})}addScale(t,o,n){return(0,j.mG)(this,void 0,void 0,function*(){const s=o.ol.getSize();let l;o.ol.getView().calculateExtent(s);const c=o.ol.getOverlayContainerStopEvent(),u=c.getElementsByTagName("button"),p=Array.from(u);for(const m of p)m.setAttribute("data-html2canvas-ignore","true");const d=c.querySelector(".ol-attribution"),g=d.classList.contains("ol-collapsed");g&&d.classList.remove("ol-collapsed"),yield hi(c,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0}).then(m=>{l=m}),this.addCanvas(t,l,n),g&&d.classList.add("ol-collapsed")})}addCopyrightToImage(t,o){return(0,j.mG)(this,void 0,void 0,function*(){const n=o.getContext("2d");let s;const a=t.ol.getOverlayContainerStopEvent(),l=a.getElementsByTagName("button"),c=Array.from(l);for(const d of c)d.setAttribute("data-html2canvas-ignore","true");const u=a.querySelector(".ol-attribution"),p=u.classList.contains("ol-collapsed");p&&u.classList.remove("ol-collapsed"),yield hi(a,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0}).then(d=>{s=d}),n.drawImage(s,0,0),p&&u.classList.add("ol-collapsed")})}defineNbFileToProcess(t){this.nbFileToProcess=t}timeout(t){return new Promise(o=>setTimeout(o,t))}addCanvas(t,o,n){let s;if(o&&(s=o.toDataURL("image/png")),void 0!==s){if(s.length<20)return void console.log("Warning: An image cannot be print in pdf file");const a=this.getImageSizeToFitPdf(t,o,n);t.addImage(s,"PNG",n[3],n[0],a[0],a[1]),t.rect(n[3],n[0],a[0],a[1]),this.imgSizeAdded=a}}addMap(t,o,n,s,a){const l=new Se.x,c=o.ol.getSize(),u=o.ol.getView().calculateExtent(c),p=Math.round(s[0]*n/25.4),d=Math.round(s[1]*n/25.4);let g;return o.ol.once("rendercomplete",h=>{const m=h.target.getViewport().getElementsByTagName("canvas"),y=o.status$.subscribe(v=>{if(clearTimeout(g),v!==ve.Done)return;y.unsubscribe();let S=ve.Done;try{for(const M of m)0!==M.width&&this.addCanvas(t,M,a)}catch(M){S=ve.Error,this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}this.renderMap(o,c,u),l.next(S)});g=window.setTimeout(()=>{y.unsubscribe();let v=ve.Done;try{for(const S of m)0!==S.width&&this.addCanvas(t,S,a)}catch(S){v=ve.Error,this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}this.renderMap(o,c,u),l.next(v)},200)}),this.renderMap(o,[p,d],u),l}downloadMapImage(t,o,n="png",s=!1,a=!1,l="",c="",u="",p=!0,d){const g=new Se.x;this.activityId=this.activityService.register();const h=this.languageService.translate;return t.ol.once("rendercomplete",m=>(0,j.mG)(this,void 0,void 0,function*(){n=n.toLowerCase();const y=m.target.getViewport().getElementsByTagName("canvas")[0],v=document.createElement("canvas"),S=v.getContext("2d");let M=0;const A=y.width;let F=y.height;S.font="20px Calibri";const k=S.measureText(u).width;F=""!==l?F+30:F,F=""!==c?F+30:F,F=!1!==s||!1!==a?F+30:F;const ne=F-10,se=Math.ceil(k/A);F=""!==u?F+30*se:F;let z=F-20*se+5;if(v.width=A,v.height=F,["bmp","gif","jpeg","png","tiff"].indexOf(n)>-1&&("jpeg"===n||""!==l||""!==c||""!==u||!1!==s||!1!==a)&&(S.fillStyle="#ffffff",S.fillRect(0,0,A,F),S.fillStyle="#000000"),""!==l&&(S.font="26px Calibri",M=30,S.textAlign="center",S.fillText(l,A/2,20,.9*A)),""!==c&&(S.font="26px Calibri",M=60,S.textAlign="center",S.fillText(c,A/2,50,.9*A)),S.font="20px Calibri",!1!==s||!1!==a){let xe="";!1!==s&&(xe=h.instant("igo.geo.printForm.projection")+": "+t.projection+"         "),!1!==a&&(xe+=h.instant("igo.geo.printForm.scale")+": ~ 1 / "+pa(t.viewController.getScale(o))),S.textAlign="center",S.fillText(xe,A/2,ne,.9*A)}if(""!==u)if(S.textAlign="center",1===se)S.fillText(u,A/2,z);else{const pe=Math.floor(u.length/se);let me,W="",ze=0;for(let We=0;We<se;We++)se-1>We?(W=u.substr(ze,pe),me=W.lastIndexOf(" "),S.fillText(W.substr(0,me),A/2,z),ze+=me,z+=20):S.fillText(u.substr(ze),A/2,z)}S.drawImage(y,0,M),yield this.addCopyrightToImage(t,v),"none"!==d&&(["topleft","topright","bottomleft","bottomright"].indexOf(d)>-1?yield this.addLegendToImage(v,t,o,d,n):"newpage"===d&&(yield this.getLayersLegendImage(t,n,p,o)));let de=ve.Done,ge="map."+n;"tiff"===n.toLowerCase()&&(ge="map"+t.projection.replace(":","_")+"."+n);try{p?(n.toLowerCase(),this.generateCanvaFileToZip(v,ge)):this.saveCanvasImageAsFile(v,ge,n)}catch(xe){de=ve.Error}if(g.next(de),"tiff"===n.toLowerCase()){const xe=ge.substring(0,ge.toLowerCase().indexOf(".tiff"))+".tfw",pe=this.getWorldFileInformation(t),W=new Blob([pe],{type:"text/plain;charset=utf-8"});p?this.addFileToZip(xe,W):((0,ua.saveAs)(W,xe),this.saveFileProcessing())}})),t.ol.renderSync(),g}addLegendToImage(t,o,n,s,a){return(0,j.mG)(this,void 0,void 0,function*(){const l="map."+a,c=t.getContext("2d"),u=yield this.getLayersLegendHtml(o,t.width,n).toPromise();if(""===u)return yield this.saveCanvasImageAsFile(t,l,a),!0;const p=window.document.createElement("div");p.style.position="absolute",p.style.top="0",window.document.body.appendChild(p),p.innerHTML=u,yield this.timeout(1);const d=yield hi(p,{useCORS:!0}).catch(g=>{console.log(g)});if(d){const g=t.height,h=t.width,m=d.height,y=d.width,v=.01*g;let S,M;return"bottomright"===s?(S=h-y-v,M=g-m-v):"topright"===s?(S=h-y-v,M=v):"bottomleft"===s?(S=v,M=g-m-v-15):"topleft"===s&&(S=v,M=v),c.drawImage(d,S,M,y,m),c.strokeRect(S,M,y,m),p.parentNode.removeChild(p),!0}})}renderMap(t,o,n){t.ol.updateSize(),t.ol.renderSync()}saveDoc(t){return(0,j.mG)(this,void 0,void 0,function*(){yield t.save("map_georef.pdf",{returnPromise:!0})})}getImageSizeToFitPdf(t,o,n){const s=t.internal.pageSize.getHeight()-(n[0]+n[2]+10),a=t.internal.pageSize.getWidth()-(n[1]+n[3]),l=this.pdf_units2points(o.height,"mm"),c=this.pdf_units2points(o.width,"mm"),u=l/s,p=c/a,d=u>p?u:p;return[d>1?c/d:c,d>1?l/d:l]}getWorldFileInformation(t){const o=t.viewController.getResolution(),n=t.viewController.getExtent();return[o,0,0,-o,n[0]+o/.5,n[3]-o/.5].join("\n")}saveCanvasImageAsFile(t,o,n){const s="image/"+n,a=this;try{t.toDataURL(),t.toBlob(l=>{(0,ua.saveAs)(l,o),a.saveFileProcessing()},s)}catch(l){this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}generateCanvaFileToZip(t,o){const s=this;(!this.hasOwnProperty("zipFile")||void 0===this.zipFile)&&(this.zipFile=new w_);try{t.toDataURL(),navigator.msSaveBlob?this.addFileToZip(o,t.msToBlob()):t.toBlob(a=>{s.addFileToZip(o,a)},"image/jpeg")}catch(a){this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}addFileToZip(t,o){this.zipFile.file(t,o),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))}saveFileProcessing(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)}getZipFile(){const t=this;this.zipFile.generateAsync({type:"blob"}).then(o=>{(0,ua.saveAs)(o,"map.zip"),delete t.zipFile})}pdf_units2points(t,o){let n=1;switch(o){case"pt":n=1;break;case"mm":n=72/25.4;break;case"cm":n=72/2.54;break;case"in":n=72;break;case"px":n=96/72;break;case"pc":case"em":n=12;break;case"ex":n=6;break;default:throw new Error("Invalid unit: "+o)}return t*n}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(_e),e.LFG(gn),e.LFG(D),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const IS=function(i){return{column:i,value:130}};function OS(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.formValidation.maxLength",e.VKq(6,IS,e.lcZ(3,4,"igo.geo.printForm.title")))))}const ZS=function(i){return{column:i,value:120}};function DS(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.formValidation.maxLength",e.VKq(6,ZS,e.lcZ(3,4,"igo.geo.printForm.subtitle")))))}const kS=function(i,r){return{column:i,value:r}};function PS(i,r){if(1&i&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.formValidation.maxLength",e.WLB(6,kS,e.lcZ(3,4,"igo.geo.printForm.comment"),t.maxLength)))}}function $S(i,r){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.printForm.legendPositions."+t.value)," ")}}function ES(i,r){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.lcZ(2,1,"Pdf"===t.outputFormat?"igo.geo.printForm.legendPositions.newpage":"igo.geo.printForm.legendPositions.newimage")," ")}}const Gu=function(){return["newpage","newimage"]};function JS(i,r){if(1&i&&(e.TgZ(0,"mat-option",20),e.YNc(1,$S,3,3,"ng-container",3),e.YNc(2,ES,3,3,"ng-container",3),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.Q6J("ngIf",!e.DdM(3,Gu).includes(t.value)),e.xp6(1),e.Q6J("ngIf",e.DdM(4,Gu).includes(t.value))}}function RS(i,r){if(1&i&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",t.value," ")}}function BS(i,r){if(1&i&&(e.TgZ(0,"mat-option",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.printForm.paperFormats."+t.value)," ")}}function US(i,r){if(1&i&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",t.value," ")}}function NS(i,r){if(1&i&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",t.value+" PPI"," ")}}function qS(i,r){if(1&i&&(e.TgZ(0,"mat-option",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.printForm."+t.value)," ")}}let GS=(()=>{class i{constructor(t){this.formBuilder=t,this.outputFormats=Bu,this.paperFormats=so,this.orientations=bo,this.resolutions=Uu,this.imageFormats=Nu,this.legendPositions=qu,this.isPrintService=!0,this.submit=new e.vpe,this.maxLength=180,this.form=this.formBuilder.group({title:["",[_.kI.minLength(0),_.kI.maxLength(130)]],subtitle:["",[_.kI.minLength(0),_.kI.maxLength(120)]],comment:["",[_.kI.minLength(0),_.kI.maxLength(this.maxLength)]],outputFormat:["",[_.kI.required]],paperFormat:["",[_.kI.required]],imageFormat:["",[_.kI.required]],resolution:["",[_.kI.required]],orientation:["",[_.kI.required]],legendPosition:["",[_.kI.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}get imageFormat(){return this.imageFormatField.value}set imageFormat(t){this.imageFormatField.setValue(t||Nu.Jpeg,{onlySelf:!0})}get outputFormat(){return this.outputFormatField.value}set outputFormat(t){this.outputFormatField.setValue(t||Bu.Pdf,{onlySelf:!0})}get paperFormat(){return this.paperFormatField.value}set paperFormat(t){this.paperFormatField.setValue(t||so.Letter,{onlySelf:!0})}get orientation(){return this.orientationField.value}set orientation(t){this.orientationField.setValue(t||bo.landscape,{onlySelf:!0})}get resolution(){return this.resolutionField.value}set resolution(t){this.resolutionField.setValue(t||Uu[96],{onlySelf:!0})}get legendPosition(){return this.legendPositionField.value}set legendPosition(t){this.legendPositionField.setValue(t||qu.none,{onlySelf:!0})}get title(){return this.titleField.value}set title(t){this.titleField.setValue(t,{onlySelf:!0})}get subtitle(){return this.subtitleField.value}set subtitle(t){this.subtitleField.setValue(t,{onlySelf:!0})}get comment(){return this.commentField.value}set comment(t){this.commentField.setValue(t,{onlySelf:!0})}get showProjection(){return this.showProjectionField.value}set showProjection(t){this.showProjectionField.setValue(t,{onlySelf:!0})}get showScale(){return this.showScaleField.value}set showScale(t){this.showScaleField.setValue(t,{onlySelf:!0})}get showLegend(){return this.showLegendField.value}set showLegend(t){this.showLegendField.setValue(t,{onlySelf:!0})}get doZipFile(){return this.doZipFileField.value}set doZipFile(t){this.doZipFileField.setValue(t,{onlySelf:!0})}get outputFormatField(){return this.form.controls.outputFormat}get paperFormatField(){return this.form.controls.paperFormat}get imageFormatField(){return this.form.controls.imageFormat}get orientationField(){return this.form.controls.orientation}get resolutionField(){return this.form.controls.resolution}get commentField(){return this.form.controls.comment}get showProjectionField(){return this.form.controls.showProjection}get showScaleField(){return this.form.controls.showScale}get showLegendField(){return this.form.controls.showLegend}get doZipFileField(){return this.form.controls.doZipFile}get titleField(){return this.form.controls.title}get subtitleField(){return this.form.controls.subtitle}get legendPositionField(){return this.form.controls.legendPosition}ngOnInit(){this.doZipFileField.setValue(!1)}handleFormSubmit(t,o){t.isPrintService=this.isPrintService,o&&this.submit.emit(t)}toggleImageSaveProp(){"Image"===this.outputFormatField.value?(this.isPrintService=!1,this.commentField.clearValidators(),this.commentField.updateValueAndValidity()):this.isPrintService=!0}changeCommentLength(){switch(this.paperFormat){case so.A0:this.maxLength=this.orientation===bo.landscape?900:600;break;case so.A1:this.maxLength=this.orientation===bo.landscape?600:400;break;case so.A2:this.maxLength=this.orientation===bo.landscape?400:300;break;case so.A3:this.maxLength=this.orientation===bo.landscape?300:200;break;case so.A4:this.maxLength=this.orientation===bo.landscape?200:100;break;case so.A5:this.maxLength=this.orientation===bo.landscape?120:80;break;case so.Letter:this.maxLength=this.orientation===bo.landscape?180:140;break;default:this.maxLength=this.orientation===bo.landscape?200:140}this.commentField.setValidators([_.kI.maxLength(this.maxLength)]),this.commentField.updateValueAndValidity()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_.QS))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile"},outputs:{submit:"submit"},decls:68,vars:75,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"print-slide-toggle-container","mat-typography"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"placeholder","selectionChange"],["formControlName","paperFormat",3,"placeholder","selectionChange"],["formControlName","imageFormat",3,"placeholder"],[1,"igo-input-container",2,"display","none"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"placeholder","selectionChange"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0)(1,"div",1)(2,"mat-form-field"),e._UZ(3,"input",2),e.ALo(4,"translate"),e.YNc(5,OS,4,8,"mat-error",3),e.qZA()(),e.TgZ(6,"div",1)(7,"mat-form-field"),e._UZ(8,"input",4),e.ALo(9,"translate"),e.YNc(10,DS,4,8,"mat-error",3),e.qZA()(),e.TgZ(11,"div",1)(12,"mat-form-field"),e._UZ(13,"input",5),e.ALo(14,"translate"),e.YNc(15,PS,4,9,"mat-error",3),e.qZA()(),e.TgZ(16,"div",1)(17,"div",6)(18,"mat-slide-toggle",7),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"mat-slide-toggle",8),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"mat-slide-toggle",9),e._uU(25),e.ALo(26,"translate"),e.qZA()()(),e.TgZ(27,"div",1)(28,"mat-form-field")(29,"mat-select",10),e.ALo(30,"translate"),e.YNc(31,JS,3,5,"mat-option",11),e.ALo(32,"keyvalue"),e.qZA()()(),e.TgZ(33,"div",1)(34,"mat-form-field")(35,"mat-select",12),e.NdJ("selectionChange",function(){return o.toggleImageSaveProp()}),e.ALo(36,"translate"),e.YNc(37,RS,2,2,"mat-option",11),e.ALo(38,"keyvalue"),e.qZA()()(),e.TgZ(39,"div",1)(40,"mat-form-field")(41,"mat-select",13),e.NdJ("selectionChange",function(){return o.changeCommentLength()}),e.ALo(42,"translate"),e.YNc(43,BS,3,4,"mat-option",11),e.ALo(44,"keyvalue"),e.qZA()()(),e.TgZ(45,"div",1)(46,"mat-form-field")(47,"mat-select",14),e.ALo(48,"translate"),e.YNc(49,US,2,2,"mat-option",11),e.ALo(50,"keyvalue"),e.qZA()()(),e.TgZ(51,"div",15)(52,"mat-form-field")(53,"mat-select",16),e.ALo(54,"translate"),e.YNc(55,NS,2,2,"mat-option",11),e.ALo(56,"keyvalue"),e.qZA()()(),e.TgZ(57,"div",1)(58,"mat-form-field")(59,"mat-select",17),e.NdJ("selectionChange",function(){return o.changeCommentLength()}),e.ALo(60,"translate"),e.YNc(61,qS,3,4,"mat-option",11),e.ALo(62,"keyvalue"),e.qZA()()(),e.TgZ(63,"div",18)(64,"button",19),e.NdJ("click",function(){return o.handleFormSubmit(o.form.value,o.form.valid)}),e.ALo(65,"async"),e._uU(66),e.ALo(67,"translate"),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.form),e.xp6(3),e.s9C("placeholder",e.lcZ(4,35,"igo.geo.printForm.title")),e.xp6(2),e.Q6J("ngIf",null==o.titleField.errors?null:o.titleField.errors.maxlength),e.xp6(3),e.s9C("placeholder",e.lcZ(9,37,"igo.geo.printForm.subtitle")),e.xp6(2),e.Q6J("ngIf",null==o.subtitleField.errors?null:o.subtitleField.errors.maxlength),e.xp6(3),e.s9C("placeholder",e.lcZ(14,39,"igo.geo.printForm.comment")),e.xp6(2),e.Q6J("ngIf",null==o.commentField.errors?null:o.commentField.errors.maxlength),e.xp6(3),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(20,41,"igo.geo.printForm.showProjection")," "),e.xp6(2),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(23,43,"igo.geo.printForm.showScale")," "),e.xp6(2),e.Udp("display",o.isPrintService?"none":""),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(26,45,"igo.geo.printForm.doZipFile")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(30,47,"igo.geo.printForm.legendPosition")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(32,49,o.legendPositions)),e.xp6(4),e.s9C("placeholder",e.lcZ(36,51,"igo.geo.printForm.outputFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(38,53,o.outputFormats)),e.xp6(2),e.Udp("display",o.isPrintService?"block":"none"),e.xp6(2),e.s9C("placeholder",e.lcZ(42,55,"igo.geo.printForm.paperFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(44,57,o.paperFormats)),e.xp6(2),e.Udp("display",o.isPrintService?"none":"block"),e.xp6(2),e.s9C("placeholder",e.lcZ(48,59,"igo.geo.printForm.imageFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(50,61,o.imageFormats)),e.xp6(4),e.s9C("placeholder",e.lcZ(54,63,"igo.geo.printForm.resolution")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(56,65,o.resolutions)),e.xp6(2),e.Udp("display",o.isPrintService?"block":"none"),e.xp6(2),e.s9C("placeholder",e.lcZ(60,67,"igo.geo.printForm.orientation")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(62,69,o.orientations)),e.xp6(3),e.Q6J("disabled",!o.form.valid||e.lcZ(65,71,o.disabled$)),e.xp6(2),e.hij(" ",e.lcZ(67,73,"igo.geo.printForm.saveBtn")," "))},dependencies:[f.sg,f.O5,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,w.lW,I.TO,I.KE,ue.gD,Q.ey,H.Nt,at.Rr,f.Ov,L.X$,ci],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.print-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.print-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.print-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}"]}),i})(),Qu=(()=>{class i{constructor(t){this.printService=t,this.disabled$=new b.X(!1)}get map(){return this._map}set map(t){this._map=t}get outputFormat(){return this._outputFormat}set outputFormat(t){this._outputFormat=t}get paperFormat(){return this._paperFormat}set paperFormat(t){this._paperFormat=t}get orientation(){return this._orientation}set orientation(t){this._orientation=t}get imageFormat(){return this._imageFormat}set imageFormat(t){this._imageFormat=t}get legendPosition(){return this._legendPosition}set legendPosition(t){this._legendPosition=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}handleFormSubmit(t){if(this.disabled$.next(!0),!0===t.isPrintService)this.printService.print(this.map,t).pipe((0,Ee.q)(1)).subscribe(()=>{this.disabled$.next(!1)});else{let o=1;t.showLegend&&o++,"tiff"===t.imageFormat.toLowerCase()&&o++,"newpage"===t.legendPosition&&o++,this.printService.defineNbFileToProcess(o),this.printService.downloadMapImage(this.map,+t.resolution,t.imageFormat,t.showProjection,t.showScale,t.title,t.subtitle,t.comment,t.doZipFile,t.legendPosition).pipe((0,Ee.q)(1)).subscribe(()=>{this.disabled$.next(!1)})}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(LS))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},decls:1,vars:7,consts:[[3,"outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$","submit"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-print-form",0),e.NdJ("submit",function(s){return o.handleFormSubmit(s)}),e.qZA()),2&t&&e.Q6J("outputFormat",o.outputFormat)("paperFormat",o.paperFormat)("orientation",o.orientation)("imageFormat",o.imageFormat)("resolution",o.resolution)("legendPosition",o.legendPosition)("disabled$",o.disabled$)},dependencies:[GS],encapsulation:2}),i})(),Ha=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,T.Ps,w.ot,ue.LD,Q.Ng,H.c,I.lN,at.rP,oe,ki]}),i})();function QS(i){return new eu(i.getConfig(`searchSources.${eu.id}`)||{})}let Kn=(()=>{class i{static forRoot(){return{ngModule:i,providers:[{provide:_t,useFactory:QS,multi:!0,deps:[J]}]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Sa],imports:[f.ez,oe,wo]}),i})();class Va{}class za{constructor(r){this.sources=r}}function YS(i){return new za(i)}var os=(()=>{return(i=os||(os={}))[i.GeoJSON=0]="GeoJSON",i[i.JSON=1]="JSON",os;var i})(),is=(()=>{return(i=is||(is={})).Route="route",i.Trip="trip",is;var i})(),Si=(()=>{return(i=Si||(Si={})).Coord="coord",i.Text="text",Si;var i})(),Io=(()=>{return(i=Io||(Io={})).Stop="stop",i.Route="route",i.Vertex="vertex",Io;var i})(),Oo=(()=>{return(i=Oo||(Oo={})).Start="start",i.Intermediate="intermediate",i.End="end",Oo;var i})();function Wa(i,r="asc",t="position"){i.view.sort({direction:r,valueAccessor:o=>o[t]})}function ns(i,r){let t=Oo.Intermediate;return 0===i?t=Oo.Start:i===r-1&&(t=Oo.End),t}function Ka(i){const r=Ze(),t=i.all();let o;o=0===i.count?[0]:t.map(c=>c.position);const n=Math.max(...o),s=n,a=n+1,l=i.all().find(c=>c.position===n);return l&&(l.position=a,l.relativePosition=ns(a,i.count+1)),i.insert({id:r,position:s,relativePosition:ns(s,i.count+1)}),Wa(i),i.get(r)}function Xa(i,r){const t=[new R.ZP({geometry:i.getGeometry(),image:new Me.Z({radius:7,stroke:new U.Z({color:"#FF0000",width:3})})})],o=Go({text:i.get("stopText"),opacity:i.get("stopOpacity"),markerColor:i.get("stopColor"),markerOutlineColor:[255,255,255]}),n=[new R.ZP({stroke:new U.Z({color:`rgba(106, 121, 130, ${i.get("active")?.75:0})`,width:10})}),new R.ZP({stroke:new U.Z({color:`rgba(79, 169, 221, ${i.get("active")?.75:0})`,width:6})})];return i.get("type")===Io.Stop?o:"vertex"===i.get("type")?t:i.get("type")===Io.Route?n:void 0}function rs(i){if(0!==i)return i>=1e5?ii.roundToNDecimal(Math.round(i)/1e3,1)+" km":i>=1e4||i>=1e3?ii.roundToNDecimal(Math.round(i)/100/10,1)+" km":ii.roundToNDecimal(i,0)+" m"}function ju(i){if(i>=3600){const r=Math.floor(i/3600),t=Math.round(60*(i/3600-r));return 60===t?r+1+" h":r+" h "+t+" min"}return i>=60?Math.round(i/60)+" min":i+" s"}function Yu(i,r,t,o,n,s,a,l=!1){const c=a.translate;let u,p="forward",d="rotate-270";const g=function iw(i,r){const t=r.translate;return i>=337||i<23?t.instant("igo.geo.cardinalPoints.n"):i<67?t.instant("igo.geo.cardinalPoints.ne"):i<113?t.instant("igo.geo.cardinalPoints.e"):i<157?t.instant("igo.geo.cardinalPoints.se"):i<203?t.instant("igo.geo.cardinalPoints.s"):i<247?t.instant("igo.geo.cardinalPoints.sw"):i<293?t.instant("igo.geo.cardinalPoints.w"):i<337?t.instant("igo.geo.cardinalPoints.nw"):void 0}(o,a),h=function ow(i,r){const t=r.translate;return"uturn"===i?t.instant("igo.geo.directions.uturn"):"sharp right"===i?t.instant("igo.geo.directions.sharp right"):"right"===i?t.instant("igo.geo.directions.right"):"slight right"===i?t.instant("igo.geo.directions.slight right"):"sharp left"===i?r.translate.instant("igo.geo.directions.sharp left"):"left"===i?r.translate.instant("igo.geo.directions.left"):"slight left"===i?r.translate.instant("igo.geo.directions.slight left"):"straight"===i?r.translate.instant("igo.geo.directions.straight"):i}(r,a);let y=("straight"===r?"":c.instant("igo.geo.directions.modifier.prefix"))+h;if((null==r?void 0:r.search("slight"))>=0&&(y=h),"uturn"===r?(p="forward",d="rotate-90"):"sharp right"===r||"right"===r?(p="subdirectory-arrow-right",d="icon-flipped"):"slight right"===r?(p="forward",d="rotate-290"):"straight"===r?p="forward":"slight left"===r?(p="forward",d="rotate-250"):("left"===r||"sharp left"===r)&&(p="subdirectory-arrow-left",d="icon-flipped"),"turn"===i)u="straight"===r?c.instant("igo.geo.directions.turn.straight",{route:t}):"uturn"===r?c.instant("igo.geo.directions.turn.uturn",{route:t}):c.instant("igo.geo.directions.turn.else",{route:t,aggregatedDirection:y,translatedModifier:h});else if("new name"===i)u=c.instant("igo.geo.directions.new name",{route:t,translatedDirection:g}),p="compass",d="";else if("depart"===i)u=c.instant("igo.geo.directions.depart",{route:t,translatedDirection:g}),p="compass",d="";else if("arrive"===i)l?(y=h?y:"",u=c.instant("igo.geo.directions.arrive.lastStep",{coma:h?", ":"",aggregatedDirection:y})):(u=c.instant("igo.geo.directions.arrive.intermediate",{route:t}),p="map-marker",d="");else if("merge"===i)u=c.instant("igo.geo.directions.merge",{route:t}),p="forward",d="rotate-270";else if("on ramp"===i)u=c.instant("igo.geo.directions.on ramp",{aggregatedDirection:y});else if("off ramp"===i)u=c.instant("igo.geo.directions.off ramp",{aggregatedDirection:y});else if("fork"===i)u=r.search("left")>=0?c.instant("igo.geo.directions.fork.left",{route:t}):r.search("right")>=0?c.instant("igo.geo.directions.fork.right",{route:t}):c.instant("igo.geo.directions.fork.else",{route:t});else if("end of road"===i)u=c.instant("igo.geo.directions.end of road",{translatedModifier:h,route:t});else if("use lane"===i)u=c.instant("igo.geo.directions.use lane");else if("continue"===i&&"uturn"!==r)u=c.instant("igo.geo.directions.continue.notUturn",{route:t}),p="forward",d="rotate-270";else if("roundabout"===i){const v=c.instant(1===s?"igo.geo.directions.cntSuffix.first":"igo.geo.directions.cntSuffix.secondAndMore");u=c.instant("igo.geo.directions.roundabout",{exit:s,cntSuffix:v,route:t}),p="chart-donut",d=""}else"rotary"===i?(u=c.instant("igo.geo.directions.rotary"),p="chart-donut",d=""):"roundabout turn"===i?(u=c.instant("igo.geo.directions.roundabout turn"),p="chart-donut",d=""):"exit roundabout"===i?(u=c.instant("igo.geo.directions.exit roundabout",{route:t}),p="forward",d="rotate-270"):u="notification"===i?c.instant("igo.geo.directions.notification"):"uturn"===r?c.instant("igo.geo.directions.uturnText",{translatedDirection:g,route:t}):c.instant("igo.geo.directions.unknown");return p=l?"flag-variant":p,d=l?"":d,p=0===n?"compass":p,d=0===n?"":d,{instruction:u,image:p,cssClass:d}}function nw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,s=e.oxw();return e.KtG(s.clearStop(n))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",11),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.clearStop"))}function rw(i,r){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t.meta?t.meta.title:""),e.xp6(1),e.hij(" ",t.meta?t.meta.title:""," ")}}function sw(i,r){if(1&i&&(e.TgZ(0,"mat-optgroup",12),e.YNc(1,rw,2,3,"mat-option",13),e.qZA()),2&i){const t=r.$implicit;e.Q6J("label",t.source.title)("disabled",!1===t.source.enabled),e.xp6(1),e.Q6J("ngForOf",t.results)}}function aw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2).$implicit,s=e.oxw();return e.KtG(s.removeStop(n))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",21),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.removeStop"))}function lw(i,r){1&i&&(e.TgZ(0,"button",22),e.ALo(1,"translate"),e._UZ(2,"mat-icon",23),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.removeStop"))}function cw(i,r){if(1&i&&(e.TgZ(0,"div",15)(1,"button",16),e.ALo(2,"translate"),e._UZ(3,"mat-icon",17),e.qZA(),e.YNc(4,aw,3,3,"button",18),e.ALo(5,"async"),e.YNc(6,lw,3,3,"button",19),e.ALo(7,"async"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,3,"igo.geo.directionsForm.moveStop")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,5,t.stopsStore.count$)>2),e.xp6(2),e.Q6J("ngIf",e.lcZ(7,7,t.stopsStore.count$)<=2)}}function uw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",2),e.NdJ("touchenter",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onStopEnter(s))})("touchleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onStopLeave())})("mouseover",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onStopEnter(s))})("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onStopLeave())})("cdkDragStarted",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.stopIsDragged=!0)})("cdkDragEnded",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.stopIsDragged=!1)}),e.TgZ(1,"div",3)(2,"mat-form-field")(3,"input",4),e.NdJ("focus",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onInputFocus(s))})("ngModelChange",function(n){const a=e.CHM(t).$implicit;return e.KtG(a.text=n)})("keyup",function(n){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.setStopText(n,a))})("keydown.enter",function(n){return n.preventDefault()}),e.qZA(),e.YNc(4,nw,3,3,"button",5),e.TgZ(5,"mat-autocomplete",6,7),e.NdJ("optionSelected",function(n){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.chooseProposal(n,a))}),e.YNc(7,sw,2,3,"mat-optgroup",8),e.qZA()()(),e.YNc(8,cw,8,9,"div",9),e.qZA()}if(2&i){const t=r.$implicit,o=e.MAs(6),n=e.oxw();e.xp6(1),e.Q6J("ngClass",n.getNgClass(t)),e.xp6(2),e.s9C("id",t.id),e.Q6J("placeholder",n.getPlaceholder(t))("matTooltip",t.text)("ngModel",t.text)("matAutocomplete",o),e.xp6(1),e.Q6J("ngIf",(t.text||t.coordinates)&&n.stopWithHover&&t.id===n.stopWithHover.id),e.xp6(1),e.Q6J("displayWith",n.getOptionText),e.xp6(2),e.Q6J("ngForOf",t.searchProposals),e.xp6(1),e.Q6J("ngIf",!n.stopIsDragged&&n.stopWithHover&&t.id===n.stopWithHover.id)}}let pw=(()=>{class i{constructor(t){this.languageService=t,this.invalidKeys=["Control","Shift","Alt"],this.onMapClickEventKeys=[],this.stopIsDragged=!1,this.coordRoundedDecimals=6,this.debounce=200,this.length=2,this.stopInputHasFocus=new e.vpe(!1)}ngOnDestroy(){this.unlistenMapSingleClick()}onStopEnter(t){this.stopWithHover=t}onStopLeave(){this.stopWithHover=void 0}getOptionText(t){return t instanceof Object?null!=t&&t.meta?t.meta.title:"":t}chooseProposal(t,o){const n=t.option.value;if(n){let s;const a=n.geometry;if("Point"===a.type)s=a.coordinates;else{const l=(0,Ar.Z)(n.geometry);s=[l.geometry.coordinates[0],l.geometry.coordinates[1]]}s&&(o.coordinates=s,o.text=n.meta.title,this.stopsStore.update(o))}}setStopText(t,o){this.unlistenMapSingleClick();const n=t.target.value;0===n.length?this.clearStop(o):this.validateTerm(n)&&(o.text=n,this.stopsStore.update(o))}validateTerm(t){return!(!this.keyIsValid(t)||!(t.length>=this.length||0===t.length))}keyIsValid(t){return void 0===this.invalidKeys.find(o=>o===t)}getNgClass(t){return this.stopWithHover&&t.id===this.stopWithHover.id?"igo-input-container reduce":"igo-input-container"}getPlaceholder(t){let o="";return t.relativePosition?(t.relativePosition===Oo.Intermediate&&(o=" #"+t.position),this.languageService.translate.instant("igo.geo.directionsForm."+t.relativePosition)+o):""}removeStop(t){!function zS(i,r){i.delete(r),function VS(i){const r=[...i.all()];r.sort((t,o)=>t.position-o.position),r.map((t,o)=>{t.position=o,t.relativePosition=ns(t.position,r.length)}),r&&i.updateMany(r)}(i)}(this.stopsStore,t)}clearStop(t){this.stopsStore.update({id:t.id,relativePosition:t.relativePosition,position:t.position})}drop(t){this.moveStops(t.previousIndex,t.currentIndex)}moveStops(t,o){if(t!==o){const n=[...this.stopsStore.view.all()];(0,Zn.bA)(n,t,o),n.map((s,a)=>{s.relativePosition=ns(a,n.length),s.position=a}),this.stopsStore.updateMany(n),Wa(this.stopsStore)}}onInputFocus(t){var o;(!t.text||0===(null===(o=t.text)||void 0===o?void 0:o.length))&&(this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(t))}listenMapSingleClick(t){const o=this.stopsFeatureStore.layer.map.ol.once("singleclick",n=>{const a=ft(V.vs(n.coordinate,this.stopsFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals);t.text=a.join(","),t.coordinates=a,this.stopsStore.update(t),setTimeout(()=>{this.stopInputHasFocus.emit(!1)},500)});this.onMapClickEventKeys.push(o)}unlistenMapSingleClick(){this.onMapClickEventKeys.map(t=>{et.B(t)}),this.onMapClickEventKeys=[]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},decls:3,vars:3,consts:[["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["touchleave","","cdkDragLockAxis","y","class","stop-box mat-typography","cdkDrag","",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded",4,"ngFor","ngForOf"],["touchleave","","cdkDragLockAxis","y","cdkDrag","",1,"stop-box","mat-typography",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],[3,"ngClass"],["type","text","matTooltipShowDelay","500","aria-label","Number","matInput","",3,"id","placeholder","matTooltip","ngModel","matAutocomplete","focus","ngModelChange","keyup","keydown.enter"],["mat-button","","matTooltipShowDelay","500","matSuffix","","mat-icon-button","","color","warn","aria-label","Clear",3,"matTooltip","click",4,"ngIf"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","igo-form-button-group",4,"ngIf"],["mat-button","","matTooltipShowDelay","500","matSuffix","","mat-icon-button","","color","warn","aria-label","Clear",3,"matTooltip","click"],["svgIcon","close"],[3,"label","disabled"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"igo-form-button-group"],["cdkDragHandle","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"swipe-vertical",3,"matTooltip"],["svgIcon","gesture-swipe-vertical"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["disabled","true","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["disabled","true","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip"],["svgIcon","blank"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.NdJ("cdkDropListDropped",function(s){return o.drop(s)}),e.YNc(1,uw,9,10,"div",1),e.ALo(2,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,o.stopsStore.view.all$())))},dependencies:[f.mk,f.sg,f.O5,Zn.Wj,Zn.Zt,Zn.Bh,_.Fj,_.JJ,_.On,T.Hw,w.lW,I.KE,I.R9,H.Nt,Q.ey,Q.Nv,O.gM,Xe.XC,Xe.ZL,f.Ov,L.X$],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.igo-input-container.reduce[_ngcontent-%COMP%]{width:70%}.igo-input-container.reduce[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.stops-list[_ngcontent-%COMP%]{max-width:100%;min-height:60px;display:block;background:white;border-radius:4px;overflow:hidden;padding:20px 10px}.swipe-vertical[_ngcontent-%COMP%]{cursor:move}.stop-box[_ngcontent-%COMP%]{height:60px;padding:20px 10px;color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:white}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}),i})(),dw=(()=>{class i{constructor(t){this.directionsSourceService=t}route(t,o={}){if(0!==t.length)return this.directionsSourceService.sources.filter(n=>n.enabled).map(n=>this.routeSource(n,t,o))}routeSource(t,o,n={}){return t.route(o,n)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(za))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Xn(i){return void 0!==i.search}function Hu(i){return void 0!==i.reverseSearch}function el(i){return void 0!==i.reverseSearch&&!0===i.showInPointerSummary}function Vu(i,r){let t="";return r.split("").forEach((o,n)=>{o!==i.charAt(n)&&(t+=o)}),t}function nn(i,r,t=!1){if(!i||!r)return 0;const o=t?i:i.toString().toLowerCase(),n=t?r:r.toString().toLowerCase(),l=Vu(o,n)+Vu(n,o);let c=0;return l.length&&(c=l.length/o.length*100),100-Math.floor(c)}class ao{constructor(r){this.sources=r}getSources(){return this.sources}getEnabledSources(){return this.getSources().filter(r=>!0===r.enabled)}enableSourcesByType(r){this.getSources().forEach(t=>{t.enabled=t.constructor.type===r})}setParamFromSetting(r,t){r.setParamFromSetting(t)}setWorkspaces(r,t){r.setWorkspaces(t)}}let er=(()=>{class i{constructor(t,o,n){this.searchSourceService=t,this.mapService=o,this.storageService=n}search(t,o={}){var n,s;if(!this.termIsValid(t))return[];const l=bc(t,(null===(n=this.mapService.getMap())||void 0===n?void 0:n.projection)||"EPSG:3857",{forceNA:o.forceNA});if(l.lonLat)return this.reverseSearch(l.lonLat,{distance:l.radius,conf:l.conf});let c;return l.message&&console.log(l.message),o.extent=null===(s=this.mapService.getMap())||void 0===s?void 0:s.viewController.getExtent("EPSG:4326"),c=o.getEnabledOnly||void 0===o.getEnabledOnly?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),o.sourceId?c=c.filter(u=>u.getId()===o.sourceId):o.searchType&&(c=c.filter(u=>u.getType()===o.searchType)),c=c.filter(Xn),this.searchSources(c,t,o)}reverseSearch(t,o,n=!1){const s=n?el:Hu,a=this.searchSourceService.getEnabledSources().filter(s),l=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1;return this.reverseSearchSources(a,t,o||{},l)}searchSources(t,o,n){return t.map(s=>({request:s.search(o,n),reverse:!1,source:s}))}reverseSearchSources(t,o,n,s){return t.map(a=>({request:a.reverseSearch(o,n,s),reverse:!0,source:a}))}termIsValid(t){return"string"==typeof t&&""!==t}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ao),e.LFG(Ut),e.LFG(ce))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function gw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.resetStops())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",6),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.resetDirectionsBtn"))}function mw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.zoomRoute())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",7),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.zoomRoute"))}function hw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.copyDirectionsToClipboard())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",8),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.copy"))}function fw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.copyLinkToClipboard())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",9),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.link"))}let _w=(()=>{class i{constructor(t,o,n){this.languageService=t,this.messageService=o,this.route=n,this.zoomToActiveRoute$=new Se.x}get activeRoute(){return this.routesFeatureStore.all().find(t=>t.properties.active)}resetStops(){this.stopsStore.clearStops()}addStop(){Ka(this.stopsStore)}copyLinkToClipboard(){Ft.copy(this.getUrl())&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsgLink","igo.geo.directionsForm.dialog.copyTitle")}zoomRoute(){this.zoomToActiveRoute$.next()}copyDirectionsToClipboard(){const t=this.directionsToText();Ft.copy(t)&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsg","igo.geo.directionsForm.dialog.copyTitle")}directionsToText(){const t="\t";let o=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",n="";const s=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n"+t+this.activeRoute.properties.direction.title+"\n"+t+rs(this.activeRoute.properties.direction.distance)+"\n"+t+ju(this.activeRoute.properties.direction.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",a=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n"+t+this.getUrl();let l=1;this.stopsStore.view.all().forEach(p=>{let d="",g="";p.text!==ft(p.coordinates).join(",")?(g=p.text,d=` ( ${ft(p.coordinates).join(",")} )`):g=ft(p.coordinates).join(","),n=n+t+l.toLocaleString()+". "+g+d+"\n",l++});let c=0;return this.activeRoute.properties.direction.steps.forEach(p=>{const d=this.formatStep(p,c).instruction,g=void 0===rs(p.distance)?"":" ("+rs(p.distance)+")";o=o+t+(c+1).toLocaleString()+". "+d+g+"\n",c++}),s+n+"\n"+a+"\n\n"+o}formatStep(t,o){return Yu(t.maneuver.type,t.maneuver.modifier,t.name,t.maneuver.bearing_after,o,t.maneuver.exit,this.languageService,o===this.activeRoute.properties.direction.steps.length-1)}getUrl(){if(!this.route)return;let t="";this.contextUri&&(t=`context=${this.contextUri}&`);const o=this.routesFeatureStore.all().map(c=>c.properties.id).indexOf(this.activeRoute.properties.id);let n="";0!==o&&(n=`&${this.route.options.directionsOptionsKey}=result:${o}`);const s=this.route.options.directionsCoordKey,a=this.stopsStore.view.all().map(c=>ft(c.coordinates,6));let l="";return a.length>=2?(l=`${s}=${a.join(";")}`,`${location.origin}${location.pathname}?${t}tool=directions&sidenav=1&${l}${n}`):void 0}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(_e),e.Y36(Mi,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomToActiveRoute$:"zoomToActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore"},decls:13,vars:17,consts:[[1,"igo-form-button-group"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","map-marker-plus"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","file-restore"],["svgIcon","magnify-plus-outline"],["svgIcon","content-copy"],["svgIcon","link"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return o.addStop()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.YNc(4,gw,3,3,"button",3),e.ALo(5,"async"),e.ALo(6,"async"),e.YNc(7,mw,3,3,"button",4),e.ALo(8,"async"),e.YNc(9,hw,3,3,"button",4),e.ALo(10,"async"),e.YNc(11,fw,3,3,"button",4),e.ALo(12,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,5,"igo.geo.directionsForm.addStop")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,7,o.routesFeatureStore.count$)>=1||e.lcZ(6,9,o.stopsStore.count$)>=1),e.xp6(3),e.Q6J("ngIf",e.lcZ(8,11,o.routesFeatureStore.count$)>=1),e.xp6(2),e.Q6J("ngIf",e.lcZ(10,13,o.routesFeatureStore.count$)>=1),e.xp6(2),e.Q6J("ngIf",e.lcZ(12,15,o.routesFeatureStore.count$)>=1))},dependencies:[f.O5,T.Hw,w.lW,O.gM,f.Ov,L.X$]}),i})();function yw(i,r){if(1&i&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&i){const t=r.$implicit,o=r.index,n=e.oxw(3);e.Q6J("value",t),e.xp6(1),e.lnq(" Option ",o+1," : ",n.formatDistance(t.distance)," (",n.formatDuration(t.duration),") ")}}function vw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-select",7),e.NdJ("selectionChange",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.changeRoute())})("ngModelChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeDirection=n)}),e.ALo(2,"translate"),e.YNc(3,yw,2,4,"mat-option",8),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.s9C("placeholder",e.lcZ(2,3,"igo.geo.directionsForm.drivingOptions")),e.Q6J("ngModel",t.activeDirection),e.xp6(2),e.Q6J("ngForOf",t.directions)}}function bw(i,r){1&i&&e._UZ(0,"mat-divider")}function Cw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-list-item",10),e.NdJ("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.showSegment(s))})("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.showSegment(s,!0))}),e._UZ(1,"mat-icon",11),e.TgZ(2,"h4",12),e._uU(3),e.qZA(),e.TgZ(4,"h4",13),e._uU(5),e.qZA()()}if(2&i){const t=r.$implicit,o=r.index,n=e.oxw(2);e.xp6(1),e.s9C("svgIcon",n.formatStep(t,o).image),e.Q6J("ngClass",n.formatStep(t,o).cssClass),e.xp6(2),e.AsE("",o+1,". ",n.formatStep(t,o).instruction,""),e.xp6(2),e.Oqu(n.formatDistance(t.distance))}}function xw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",1),e.YNc(1,vw,4,5,"mat-form-field",2),e.YNc(2,bw,1,0,"mat-divider",2),e.TgZ(3,"mat-list",3),e.NdJ("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onStepsListBlur())}),e.TgZ(4,"h2",4),e._uU(5),e.qZA(),e.TgZ(6,"h2",5),e._uU(7),e.qZA(),e.YNc(8,Cw,6,5,"mat-list-item",6),e._UZ(9,"mat-divider"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.directions&&t.directions.length>1),e.xp6(1),e.Q6J("ngIf",t.directions&&0===t.directions.length),e.xp6(3),e.Oqu(t.activeDirection.title),e.xp6(2),e.AsE("",t.formatDistance(t.activeDirection.distance),", ",t.formatDuration(t.activeDirection.duration),""),e.xp6(1),e.Q6J("ngForOf",t.activeDirection.steps)}}let Sw=(()=>{class i{constructor(t,o){this.languageService=t,this.cdRef=o}ngOnInit(){this.entities$$=this.routesFeatureStore.entities$.pipe((0,fe.b)(200)).subscribe(t=>{const o=t.find(n=>n.properties.active);this.directions=t.map(n=>n.properties.direction),this.activeDirection=o?o.properties.direction:void 0,this.cdRef.detectChanges()})}ngOnDestroy(){this.entities$$.unsubscribe()}changeRoute(){this.routesFeatureStore.entities$.value.map(t=>t.properties.active=!t.properties.active),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(t=>t.set("active",!t.get("active")))}formatDistance(t){return rs(t)}formatDuration(t){return ju(t)}formatStep(t,o){return Yu(t.maneuver.type,t.maneuver.modifier,t.name,t.maneuver.bearing_after,o,t.maneuver.exit,this.languageService,o===this.activeDirection.steps.length-1)}onStepsListBlur(){this.stepFeatureStore.clear()}showSegment(t,o=!1){this.showRouteSegmentGeometry(t,o)}showRouteSegmentGeometry(t,o=!1){const s="vertex",u=new oo.Z(t.geometry.coordinates).transform("EPSG:4326",this.stepFeatureStore.layer.map.projection).getCoordinates()[0],p=new Pe.Z(u),d=new De.Z({geometry:p}),g=(new be.Z).writeGeometryObject(p,{featureProjection:this.stepFeatureStore.layer.map.projection,dataProjection:this.stepFeatureStore.layer.map.projection}),h=this.stepFeatureStore.get(s);this.stepFeatureStore.update({type:le,geometry:g,projection:this.stepFeatureStore.layer.map.projection,properties:{id:s,step:t,type:Io.Vertex},meta:{id:s,revision:(h?h.meta.revision:0)+1},ol:d}),o&&this.stepFeatureStore.layer.map.viewController.zoomToExtent(d.getGeometry().getExtent())}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[4,"ngIf"],[3,"mouseleave"],["mat-header","",1,"igo-route-title","mat-typography"],["mat-subheader",""],["class","igo-steps","igoListItem","",3,"mouseenter","click",4,"ngFor","ngForOf"],[3,"placeholder","ngModel","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["igoListItem","",1,"igo-steps",3,"mouseenter","click"],["mat-list-icon","",3,"ngClass","svgIcon"],["mat-line",""],["mat-line","",1,"right"]],template:function(t,o){1&t&&e.YNc(0,xw,10,6,"div",0),2&t&&e.Q6J("ngIf",o.directions&&o.activeDirection)},dependencies:[f.mk,f.sg,f.O5,_.JJ,_.On,T.Hw,G.i$,G.Tg,Q.X2,G.Nh,G.gs,vt.d,I.KE,Q.ey,ue.gD,L.X$],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:70%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700}.igo-steps[_ngcontent-%COMP%]{cursor:pointer}.mat-line[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:pre-wrap!important}.mat-line.right[_ngcontent-%COMP%]{text-align:right}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg)}.rotate-45[_ngcontent-%COMP%]{transform:rotate(45deg)}.rotate-270[_ngcontent-%COMP%]{transform:rotate(270deg)}.rotate-250[_ngcontent-%COMP%]{transform:rotate(250deg)}.rotate-290[_ngcontent-%COMP%]{transform:rotate(290deg)}.icon-flipped[_ngcontent-%COMP%]{transform:scaleY(-1)}"]}),i})(),zu=(()=>{class i{constructor(t,o,n,s,a){this.cdRef=t,this.languageService=o,this.directionsService=n,this.searchService=s,this.queryService=a,this.projection="EPSG:4326",this.routesQueries$$=[],this.focusOnStop=!1,this.isTranslating=!1,this.previousStops=[],this.searchs$$=[],this.debounce=200,this.length=2,this.coordRoundedDecimals=6,this.zoomToActiveRoute$=new Se.x}ngOnInit(){this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(()=>{(function WS(i,r){const t=new Nt({motion:Y.None});qo(i,new Te({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:r.translate.instant("igo.geo.directionsForm.stopLayer"),zIndex:911,source:new Fe,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:Xa})),i.layer.visible=!0,Vi(i,t)})(this.stopsFeatureStore,this.languageService),function KS(i,r){const t=new Nt({motion:Y.None});qo(i,new Te({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:r.translate.instant("igo.geo.directionsForm.routeLayer"),zIndex:910,source:new Fe,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:Xa})),i.layer.visible=!0,Vi(i,t)}(this.routesFeatureStore,this.languageService),function XS(i){const r=new Nt({motion:Y.None});qo(i,new Te({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new Fe,showInLayerList:!1,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:Xa})),i.layer.visible=!0,Vi(i,r)}(this.stepFeatureStore),this.initOlInteraction()},1)}ngOnDestroy(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(t=>t.unsubscribe()),this.zoomRoute$$.unsubscribe(),this.freezeStores()}freezeStores(){this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction),this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop),this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute),this.stopsFeatureStore.deactivateStrategyOfType(Nt),this.routesFeatureStore.deactivateStrategyOfType(Nt),this.stepFeatureStore.deactivateStrategyOfType(Nt)}initEntityStores(){this.watcher=new yn(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}monitorActiveRouteZoom(){this.zoomRoute$$=this.zoomToActiveRoute$.subscribe(()=>{if(this.routesFeatureStore.count>=1){const t=this.routesFeatureStore.all().find(o=>o.properties.active);if(t){t.ol.getGeometry();const o=t.ol.getGeometry().getExtent();this.routesFeatureStore.layer.map.viewController.zoomToExtent(o)}}})}initOlInteraction(){this.selectStopInteraction=new na.Z({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:t=>"pointermove"===t.type&&!t.dragging}),this.translateStop=new oc.Z({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",t=>{this.isTranslating=!0,this.executeStopTranslation(t.features)}),this.translateStop.on("translateend",t=>{this.isTranslating=!1,this.executeStopTranslation(t.features)}),this.selectedRoute=new na.Z({layers:[this.routesFeatureStore.layer.ol],condition:fc.V4,hitTolerance:7,filter:t=>t.get("type")===Io.Route&&t.get("active")&&!this.isTranslating}),this.selectedRoute.on("select",t=>{if(!1===this.focusOnStop){const o=ft(V.vs(t.mapBrowserEvent.coordinate,this.routesFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals),n=Ka(this.stopsStore);n.text=o.join(","),n.coordinates=[o[0],o[1]]}}),this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction),this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop),this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}onStopInputHasFocusChange(t){t?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}executeStopTranslation(t){if(0===t.getLength())return;const o=t.getArray()[0],n=o.getId(),s=V.vs(o.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),a=this.stopsStore.get(n),l=ft(s,this.coordRoundedDecimals);a.coordinates=l,a.text=l.join(","),this.stopsStore.update(a)}monitorEmptyEntityStore(){this.storeEmpty$$=this.stopsStore.count$.pipe((0,ei.x)()).subscribe(t=>{if(t<2){if(Ka(this.stopsStore),2===this.stopsStore.count)return void this.stopsStore.storeInitialized$.next(!0);this.stopsStore.storeInitialized$.next(!1)}this.routesQueries$$.map(o=>o.unsubscribe())})}monitorEntityStoreChange(){this.storeChange$$=this.stopsStore.entities$.pipe((0,fe.b)(this.debounce)).subscribe(t=>{this.handleStopDiff(t),Wa(this.stopsStore),this.handleStopsFeature(),this.getRoutes(this.isTranslating)})}cancelSearch(){this.searchs$$.map(t=>t.unsubscribe())}handleStopDiff(t){const o=t.map(a=>B.removeUndefined(Object.assign({id:a.id,text:a.text,coordinates:a.coordinates}))),n=vs.findChanges(this.previousStops,o,["coordinates"]),s=n.added.concat(n.modified);s&&s.map(a=>{const l=a.newValue;if(l){const c=this.stopsStore.get(l.id),u=c.text;if(!u||0===u.length)return;const p=bc(u,this.stopsFeatureStore.layer.map.projection);let d,g=!1;p.lonLat&&(g=!0),d=this.searchService.search(u,{searchType:"Feature"}),this.cancelSearch();const h=d.map(m=>m.request.pipe((0,Z.U)(y=>y.filter(v=>g?"Point"===v.data.geometry.type&&v.data.geometry:v.data.geometry))));this.searchs$$=h.map(m=>m.pipe((0,Z.U)(y=>y.filter(v=>g?"Point"===v.data.geometry.type&&v.data.geometry:v.data.geometry))).subscribe(y=>{if(y.length>0){const v=y[0].source,S=y[0].meta,M=y.map(F=>F.data);c.searchProposals||(c.searchProposals=[]),c.searchProposals=c.searchProposals.filter(F=>F.type===(g?Si.Coord:Si.Text));let A=c.searchProposals.find(F=>F.source===v);A?A.results=M:c.searchProposals.push({type:g?Si.Coord:Si.Text,source:v,meta:S,results:M})}this.cdRef.detectChanges()}))}}),this.previousStops=o}handleStopsFeature(){const t=this.stopsStore.all();t.filter(s=>s.coordinates).map(s=>this.addStopOverlay(s)),this.stopsFeatureStore.all().map(s=>{this.stopsStore.get(s.properties.id)||this.stopsFeatureStore.delete(s)}),t.filter(s=>!s.coordinates).map(s=>{const a=this.stopsFeatureStore.get(s.id);a&&this.stopsFeatureStore.delete(a)})}getRoutes(t=!1){const o=this.stopsStore.view.all().filter(l=>l.coordinates);if(o.length<2)return void this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());const n=o.map(l=>ft(l.coordinates,this.coordRoundedDecimals));this.routesQueries$$.map(l=>l.unsubscribe());const a=this.directionsService.route(n,t?{overview:!0,steps:!1,alternatives:!1,continue_straight:!1}:void 0);a&&a.map(l=>this.routesQueries$$.push(l.subscribe(c=>{this.routesFeatureStore.deleteMany(this.routesFeatureStore.all()),c.map(u=>function tw(i,r,t,o=!1,n=!1){const l=new oo.Z(r.geometry.coordinates).transform(t,i.map.projection),c=(new be.Z).writeGeometryObject(l,{featureProjection:i.map.projection,dataProjection:i.map.projection}),u=i.get(r.id),d={type:le,geometry:c,projection:i.map.projection,properties:{id:r.id,type:Io.Route,active:o,direction:r},meta:{id:r.id,revision:(u?u.meta.revision:0)+1},ol:new De.Z({geometry:l})};i.update(d)}(this.routesFeatureStore,u,this.projection,u===c[0]))})))}addStopOverlay(t){!function ew(i,r,t,o,n){let s,a;switch(i.relativePosition){case Oo.Start:s="#008000",a=n.translate.instant("igo.geo.directionsForm.start");break;case Oo.End:s="#f64139",a=n.translate.instant("igo.geo.directionsForm.end");break;default:s="#ffd700",a=n.translate.instant("igo.geo.directionsForm.intermediate")+" #"+i.position}const l=new Pe.Z(V.vs(i.coordinates,o,t.map.projection)),c=(new be.Z).writeGeometryObject(l,{featureProjection:t.map.projection,dataProjection:t.map.projection}),u=t.get(i.id),d={type:le,geometry:c,projection:t.map.projection,properties:{id:i.id,type:Io.Stop,stopText:a,stopColor:s,stopOpacity:1,stop:i},meta:{id:i.id,revision:(u?u.meta.revision:0)+1},ol:new De.Z({geometry:l})};t.update(d)}(t,0,this.stopsFeatureStore,this.projection,this.languageService)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(D),e.Y36(dw),e.Y36(er),e.Y36(Sa))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomToActiveRoute$:"zoomToActiveRoute$"},decls:4,vars:12,consts:[[3,"contextUri","zoomToActiveRoute$","routesFeatureStore","stopsStore"],[3,"coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length","stopInputHasFocus"],[3,"stepFeatureStore","routesFeatureStore"]],template:function(t,o){1&t&&(e._UZ(0,"igo-directions-buttons",0),e.TgZ(1,"igo-directions-inputs",1),e.NdJ("stopInputHasFocus",function(s){return o.onStopInputHasFocusChange(s)}),e.qZA(),e._UZ(2,"br")(3,"igo-directions-results",2)),2&t&&(e.Q6J("contextUri",o.contextUri)("zoomToActiveRoute$",o.zoomToActiveRoute$)("routesFeatureStore",o.routesFeatureStore)("stopsStore",o.stopsStore),e.xp6(1),e.Q6J("coordRoundedDecimals",o.coordRoundedDecimals)("projection",o.projection)("stopsFeatureStore",o.stopsFeatureStore)("stopsStore",o.stopsStore)("debounce",o.debounce)("length",o.length),e.xp6(2),e.Q6J("stepFeatureStore",o.stepFeatureStore)("routesFeatureStore",o.routesFeatureStore))},dependencies:[pw,_w,Sw]}),i})(),tl=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:za,useFactory:YS,deps:[Va]}],imports:[f.ez,Zn._t,_.u5,_.UX,T.Ps,w.ot,G.ie,vt.t,I.lN,H.c,Q.Ng,ue.LD,O.AV,Xe.Bb,oe]}),i})();function ww(i){return new ao(i)}let ss=(()=>{class i{constructor(t){this.languageService=t}formatResult(t){return t}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(D))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();class Mw{encodeKey(r){return encodeURIComponent(r)}encodeValue(r){return encodeURIComponent(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}}let Wu=(()=>{class i extends _t{constructor(t,o,n,s,a,l){super(s,n),this.http=t,this.languageService=o,this.formatter=a,this.title$=new b.X(""),this.hashtagsLieuxToKeep=[];const c=l.get(Ye);this.settings.length&&(c?c.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes()),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}get title(){return this.title$.getValue()}getId(){return i.id}getType(){return i.type}getDefaultOptions(){var t;const o=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,n=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,s=null!==(t=this.options.params)&&void 0!==t&&t.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"];return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==s.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==s.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==s.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:-1!==s.indexOf("bornes-cn"),hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==s.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:-1!==s.indexOf("cadastre"),hashtags:["cadastre"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==s.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==s.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.cycleStop",value:"haltes_cyclables",enabled:-1!==s.indexOf("haltes_cyclables"),hashtags:["haltevelo","haltes_cyclables"]},{title:"igo.geo.search.icherche.type.restArea",value:"haltes_routieres",enabled:-1!==s.indexOf("haltes_routieres"),hashtags:["halteroute","haltes_routieres"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:-1!==s.indexOf("hq"),hashtags:["hq"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:-1!==s.indexOf("intersections"),hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==s.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==s.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==s.indexOf("municipalites"),hashtags:["municipalit\xe9","mun"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==s.indexOf("regadmin"),hashtags:["r\xe9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:-1!==s.indexOf("bornes-gcc"),hashtags:["borne","bornes","rep\xe8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:-1!==s.indexOf("bornes-km"),hashtags:["borne","bornes","rep\xe8re","km"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==s.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:-1!==s.indexOf("sorties-autoroute"),hashtags:["sortie","sorties","exit"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===o},{title:"5",value:5,enabled:5===o||!o},{title:"10",value:10,enabled:10===o},{title:"25",value:25,enabled:25===o},{title:"50",value:50,enabled:50===o}]},{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===n},{title:"30 %",value:30,enabled:30===n||!n},{title:"50 %",value:50,enabled:50===n},{title:"75 %",value:75,enabled:75===n},{title:"100 %",value:100,enabled:100===n}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}]}}search(t,o){const n=this.computeRequestParams(t,o||{});return n.get("type").length?(this.options.params.page=n.get("page")||"1",this.http.get(`${this.searchUrl}/geocode`,{params:n}).pipe((0,Z.U)(s=>this.extractResults(s,t)),(0,he.K)(s=>{throw s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant(this.getDefaultOptions().title),s}))):(0,X.of)([])}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(t=>{const o=this.settings.find(n=>"type"===n.name);o.values.forEach(n=>{const s=new RegExp(`^${n.value}(\\.|$)`),a=t.filter(l=>s.test(l));n.available=a.length>0,"lieux"===n.value&&(this.hashtagsLieuxToKeep=[...new Set(a.map(l=>l.split(".")).reduce((l,c)=>l.concat(c)).filter(l=>"lieux"!==l))])}),this.setParamFromSetting(o,!1)})}computeRequestParams(t,o){const n=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(t,o||{}).params,{q:this.computeTerm(t),page:o.page});if("true"===n.loc){const[s,a,l,c]=o.extent;n.loc=`${s},${a};${l},${a};${l},${c};${s},${c};${s},${a}`}else"false"===n.loc&&delete n.loc;return/#[A-Za-z]+/.test(n.q)&&(n.type="lieux"),new q.LE({fromObject:B.removeUndefined(n),encoder:new Mw})}extractResults(t,o){return t.features.map(n=>this.formatter.formatResult(this.dataToResult(n,o,t)))}dataToResult(t,o,n){const s=this.computeProperties(t),a=[this.getId(),s.type,s.code].join(".");return{source:this,data:{type:le,projection:"EPSG:4326",geometry:t.geometry,extent:t.bbox,properties:s,meta:{id:a,title:t.properties.nom}},meta:{dataType:le,id:a,title:t.properties.nom,titleHtml:(t.highlight.title||t.properties.nom)+(t.highlight.title2?" <small> "+t.highlight.title2+"</small>":"")+(t.highlight.title3?"<br><small> "+t.highlight.title3+"</small>":""),icon:t.icon||"map-marker",score:t.score||nn(o.trim(),t.properties.nom),nextPage:n.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}}computeProperties(t){const o=B.removeKeys(t.properties,i.propertiesBlacklist);if(!t.geometry)return Object.assign({type:t.index},o);const n={GoogleMaps:""};let s,a;if("Point"===t.geometry.type)s=It.getGoogleMapsCoordLink(t.geometry.coordinates[0],t.geometry.coordinates[1]);else{const c=(0,Ar.Z)(t.geometry);s=It.getGoogleMapsCoordLink(c.geometry.coordinates[0],c.geometry.coordinates[1])}a=It.getGoogleMapsNameLink("routes"===t.index?t.properties.nom+", "+t.properties.municipalite:"municipalites"===t.index?t.properties.nom+", ville":"mrc"===t.index?"mrc+"+t.properties.nom:"regadmin"===t.index?t.properties.nom+",+QC":t.properties.nom||t.highlight.title),n.GoogleMaps="<a href="+s+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+a+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===t.geometry.type&&(n.GoogleStreetView=It.getGoogleStreetViewLink(t.geometry.coordinates[0],t.geometry.coordinates[1]));const l={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:t.index},o,n,l)}computeTerm(t){let n=!1;return n=(t.match(/(#[A-Za-z]+)/g)||[]).some(s=>{const a=s.substring(1);return this.hashtagsLieuxToKeep.some(l=>l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),n||(t=t.replace(/(#[A-Za-z]+)/g,"")),t.replace(/[^\w\xc0-\xff !\-\+\(\)\.\/\xbd\xbc\xbe,'#]+/g,"")}computeOptionsParam(t,o){const n=super.getHashtagsValid(t,"type");return n&&(o.params=Object.assign(o.params||{},{type:n.join(",")})),o}}return i.id="icherche",i.type=le,i.propertiesBlacklist=[],i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(D),e.LFG(ce),e.LFG("options"),e.LFG(ss),e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"search",null),i})(),Ku=(()=>{class i extends _t{constructor(t,o,n,s,a){super(s,n),this.http=t,this.languageService=o,this.title$=new b.X(""),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))});const l=a.get(Ye);this.settings.length&&(l?l.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes())}get title(){return this.title$.getValue()}getId(){return i.id}getType(){return i.type}getDefaultOptions(){const t=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==t.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==t.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==t.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==t.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==t.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==t.indexOf("regadmin")}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}}reverseSearch(t,o){const n=this.computeRequestParams(t,o||{});return n.get("type").length?this.http.get(`${this.searchUrl}/locate`,{params:n}).pipe((0,Z.U)(s=>this.extractResults(s))):(0,X.of)([])}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(t=>{const o=this.settings.find(n=>"type"===n.name);o.values.forEach(n=>{n.available=t.indexOf(n.value)>-1}),this.setParamFromSetting(o,!1)})}computeRequestParams(t,o){return(o.distance||this.options.distance)&&(o.params=Object.assign(o.params||{},{bufferInput:o.distance||this.options.distance})),new q.LE({fromObject:Object.assign({loc:t.join(","),sort:"distance",geometry:!0,icon:!0},o.params||{},this.params)})}extractResults(t){return t.features.map(o=>this.dataToResult(o))}getSubtitle(t){if(!this.settings.length)return"";let o="";if("arrondissements"===t.properties.type)o=t.properties.municipalite+" (Arrondissement)";else{const s=this.settings.find(a=>"type"===a.name).values.find(a=>a.value===t.properties.type);s&&(o=this.languageService.translate.instant(s.title))}return o}dataToResult(t){const o=this.computeProperties(t),n=this.computeExtent(t),s=[this.getId(),o.type,o.code].join("."),a=t.properties.nom,l=" <small> "+this.getSubtitle(t)+"</small>";return{source:this,data:{type:le,projection:"EPSG:4326",geometry:t.geometry,extent:n,properties:o,meta:{id:s,title:t.properties.nom}},meta:{dataType:le,id:s,title:t.properties.nom,titleHtml:a+l,icon:t.icon||"map-marker",pointerSummaryTitle:this.getSubtitle(t)+": "+t.properties.nom}}}computeProperties(t){const o=B.removeKeys(t.properties,i.propertiesBlacklist),n={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(o,n)}computeExtent(t){return t.bbox?[t.bbox[0],t.bbox[2],t.bbox[1],t.bbox[3]]:void 0}}return i.id="icherchereverse",i.type=le,i.propertiesBlacklist=[],i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(D),e.LFG(ce),e.LFG("options"),e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"reverseSearch",null),i})();function Fw(i){return new ss(i)}function Lw(i,r,t,o,n,s){return new Wu(i,r,t,o.getConfig(`searchSources.${Wu.id}`),n,s)}function Ow(i,r,t,o,n){return new Ku(i,r,t,o.getConfig(`searchSources.${Ku.id}`),n)}let Xu=(()=>{class i{constructor(t){this.languageService=t}formatResult(t){return t}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(D))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),ep=(()=>{class i extends _t{constructor(t,o,n,s){super(t,n),this.languageService=o,this.title$=new b.X(""),this.projections=s,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}get title(){return this.title$.getValue()}getId(){return i.id}getType(){return i.type}getDefaultOptions(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}reverseSearch(t,o,n){return(0,X.of)([this.dataToResult(t,o,n)])}dataToResult(t,o,n){const s=Cc(t),l=function Z_(i,r){const t=V.vs(i,"EPSG:4326","EPSG:3857"),o=[{code:"EPSG:3857",alias:"Web Mercator",coord:t,igo2CoordFormat:`${ft(t).join(", ")} ; 3857`}],n=function D_(i){return Math.ceil((i[0]+180)/6)}(i),s=n<10?`EPSG:3260${n}`:`EPSG:326${n}`,a=`UTM-${n}`,l=V.vs(i,"EPSG:4326",s);o.push({code:s,alias:"UTM",coord:l,igo2CoordFormat:`${a} ${ft(l).join(", ")}`});const c=function k_(i){const r=i[0];let t;return r<-51&&r>-54&&(t=1),r<-54&&r>-57&&(t=2),r<-57&&r>-60&&(t=3),r<-60&&r>-63&&(t=4),r<-63&&r>-66&&(t=5),r<-66&&r>-69&&(t=6),r<-69&&r>-72&&(t=7),r<-72&&r>-75&&(t=8),r<-75&&r>-78&&(t=9),r<-78&&r>-81&&(t=10),t}(i);if(c){const u=c<10?`EPSG:3218${c}`:`EPSG:321${80+c}`,p=`MTM-${c}`,d=V.vs(i,"EPSG:4326",u);o.push({code:u,alias:"MTM",coord:d,igo2CoordFormat:`${p} ${ft(d).join(", ")}`})}return r.forEach(u=>{const p=V.vs(i,"EPSG:4326",u.code),d=u.code.split(":")[1];o.push({code:u.code,alias:u.alias||u.code,coord:p,igo2CoordFormat:`${ft(p).join(", ")} ; ${d}`})}),o}(t,this.projections).reduce((y,v)=>(y[v.alias]=v.igo2CoordFormat,y),{}),c=n?ft(t,6).reverse().join(", "):ft(t,6).join(", "),u=n?s.reverse().join(", "):s.join(", ");let p={type:"Point",coordinates:[t[0],t[1]]};const d={};let g="";if(o.distance){d[this.languageService.translate.instant("igo.geo.search.coordinates.radius")]=o.distance,g="<br><small>Rayon: "+o.distance+" m</small>";const v=V.vs([t[0],t[1]],"EPSG:4326","EPSG:3857"),S=new Ro.Z(v,o.distance),M=(0,kt.Bb)(S),A=new be.Z;p=JSON.parse(A.writeGeometry(M.transform("EPSG:3857","EPSG:4326")))}return o.conf&&(d[this.languageService.translate.instant("igo.geo.search.coordinates.conf")]=o.conf,g+=""===g?"<br>":"<small> - </small>",g+="<small>Confiance: "+o.conf+"%</small>"),d[this.languageService.translate.instant(n?"igo.geo.search.coordinates.reversedCoord":"igo.geo.search.coordinates.coord")]=c,d[this.languageService.translate.instant(n?"igo.geo.search.coordinates.reversedCoordDMS":"igo.geo.search.coordinates.coordDMS")]=u,{source:this,data:{type:le,projection:"EPSG:4326",geometry:p,extent:void 0,properties:Object.assign(d,l,{GoogleMaps:It.getGoogleMapsCoordLink(t[0],t[1]),GoogleStreetView:It.getGoogleStreetViewLink(t[0],t[1]),OpenStreetMap:Gy.getOpenStreetMapLink(t[0],t[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:t[0].toString()+","+t[1].toString(),title:c}},meta:{dataType:le,id:t[0].toString()+","+t[1].toString(),title:c,titleHtml:c+g,icon:"map-marker",score:100}}}}return i.id="coordinatesreverse",i.type=le,i.\u0275fac=function(t){return new(t||i)(e.LFG("options"),e.LFG(D),e.LFG(ce),e.LFG("projections"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"reverseSearch",null),i})();function Dw(i){return new Xu(i)}function Pw(i,r,t,o){return new ep(i.getConfig(`searchSources.${ep.id}`),r,t,i.getConfig("projections")||[])}let as=(()=>{class i{constructor(t){this.languageService=t}formatResult(t){const o=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],n=Object.entries(t.properties).filter(([a])=>-1!==o.indexOf(a)).reduce((a,l)=>{const[c,u]=l;let p;try{p=this.languageService.translate.instant("igo.geo.search.ilayer.properties."+c)}catch(d){p=c}return a[p]=u||"",a},{}),s=Object.assign({},t);return s.properties=n,s}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(D))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),tp=(()=>{class i extends _t{constructor(t,o,n,s,a){super(s,n),this.http=t,this.languageService=o,this.formatter=a,this.title$=new b.X(""),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}get title(){return this.title$.getValue()}getId(){return i.id}getType(){return i.type}getDefaultOptions(){const t=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,o=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===t},{title:"5",value:5,enabled:5===t||!t},{title:"10",value:10,enabled:10===t},{title:"25",value:25,enabled:25===t},{title:"50",value:50,enabled:50===t}]},{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===o},{title:"30 %",value:30,enabled:30===o},{title:"50 %",value:50,enabled:50===o||!o},{title:"75 %",value:75,enabled:75===o},{title:"100 %",value:100,enabled:100===o}]}]}}search(t,o){const n=this.computeSearchRequestParams(t,o||{});return n.get("q")&&n.get("type")?(this.options.params.page=n.get("page")||"1",this.http.get(this.searchUrl,{params:n}).pipe((0,Z.U)(s=>this.extractResults(s,t)))):(0,X.of)([])}computeSearchRequestParams(t,o){return new q.LE({fromObject:B.removeUndefined(Object.assign({q:this.computeTerm(t)},this.params,this.computeOptionsParam(t,o||{}).params,{page:o.page}))})}computeTerm(t){return t.replace(/(#[^\s]*)/g,"").replace(/[^\w\xc0-\xff !\-\(\),'#]+/g,"")}computeOptionsParam(t,o){const n=super.getHashtagsValid(t,"type");return n&&(o.params=Object.assign(o.params||{},{type:n.join(",")})),o}extractResults(t,o){return t.items.map(n=>this.dataToResult(n,o,t))}dataToResult(t,o,n){const s=this.computeLayerOptions(t),a=t.highlight.title||t.properties.title,l=t.highlight.groupTitle||t.properties.groupTitle,c=l?' <small style="color: #6f6969"> '+l+"</small>":"";return{source:this,meta:{dataType:Yn,id:[this.getId(),t.properties.id].join("."),title:t.properties.title,titleHtml:a+c,icon:"Layer"===t.properties.type?"layers":"map",score:t.score||nn(o.trim(),t.properties.name),nextPage:n.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:s}}computeLayerOptions(t){const o=t.properties.url,n=this.extractQueryParamsFromSourceUrl(o);return B.removeUndefined({sourceOptions:{id:t.properties.id,type:t.properties.format,url:o,queryFormat:n.queryFormat,queryHtmlTarget:n.queryHtmlTarget,params:"wms"===t.properties.format?{LAYERS:t.properties.name}:void 0,layer:"wms"===t.properties.format?void 0:t.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:t.properties.title,maxResolution:ct(Number(t.properties.maxScaleDenom)),minResolution:ct(Number(t.properties.minScaleDenom)),metadata:{url:t.properties.metadataUrl,extern:!!t.properties.metadataUrl||void 0,abstract:t.properties.abstract||void 0},properties:this.formatter.formatResult(t).properties})}extractQueryParamsFromSourceUrl(t){let o,n;const s=this.options.queryFormat;if(s){for(const a of Object.keys(s)){const l=s[a];if("*"===l){o=qe[a.toUpperCase()];break}const c=l.urls;if(Array.isArray(c)){c.forEach(u=>{-1!==t.indexOf(u)&&(o=qe[a.toUpperCase()])});break}}(o===qe.HTML||o===qe.HTMLGML2)&&(n="iframe")}return{queryFormat:o,queryHtmlTarget:n}}}return i.id="ilayer",i.type=Yn,i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(D),e.LFG(ce),e.LFG("options"),e.LFG(as))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"search",null),i})();function Ew(i){return new as(i)}function Rw(i,r,t,o,n){return new tp(i,r,t,o.getConfig(`searchSources.${tp.id}`),n)}const op=[le,Yn];function Uw(i,r){if(1&i&&(e.TgZ(0,"mat-radio-button",7),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,o.getSearchTypeTitle(t))," ")}}let Nw=(()=>{class i{constructor(t){this.searchSourceService=t,this.searchType$=new b.X(void 0),this.searchTypes=op,this.searchTypeChange=new e.vpe}set searchType(t){this.setSearchType(t)}get searchType(){return this.searchType$.value}ngOnInit(){this.searchType$$=this.searchType$.pipe((0,ei.x)()).subscribe(t=>this.onSetSearchType(t))}ngOnDestroy(){this.searchType$$.unsubscribe()}onSearchTypeChange(t){this.setSearchType(t)}getSearchTypeTitle(t){return`igo.geo.search.${t.toLowerCase()}.title`}setSearchType(t){this.searchType$.next(t)}onSetSearchType(t){null!=t&&(this.searchSourceService.enableSourcesByType(t),this.searchTypeChange.emit(t))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(ao))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},decls:9,vars:8,consts:[[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","menu-down"],["xPosition","before","yPosition","above",1,"no-border-radius"],["searchSelectorMenu","matMenu"],[1,"igo-search-selector-radio-group",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"mat-menu",3,4)(6,"mat-radio-group",5),e.NdJ("change",function(s){return o.onSearchTypeChange(s.value)}),e.ALo(7,"async"),e.YNc(8,Uw,3,4,"mat-radio-button",6),e.qZA()()()),2&t){const n=e.MAs(5);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",n),e.xp6(5),e.Q6J("value",e.lcZ(7,6,o.searchType$)),e.xp6(2),e.Q6J("ngForOf",o.searchTypes)}},dependencies:[f.sg,O.gM,T.Hw,w.lW,$e.VK,$e.p6,nt.VQ,nt.U0,f.Ov,L.X$],styles:[".igo-search-selector-button[_ngcontent-%COMP%]     div.mat-button-ripple-round{border-radius:0}.igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}.igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}"],changeDetection:0}),i})(),ol=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,O.AV,T.Ps,w.ot,$e.Tx,nt.Fk,lt.Nh,Ge.p9,oe]}),i})();function qw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.checkUncheckAllSources(n))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.searchSourcesAllEnabled?e.lcZ(4,3,"igo.geo.search.searchSources.selectAll"):e.lcZ(3,1,"igo.geo.search.searchSources.unselectAll"))}}function Gw(i,r){if(1&i&&(e.TgZ(0,"button",15),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.MAs(6);e.Q6J("matMenuTriggerFor",o),e.xp6(1),e.hij("",t.title," ")}}function Qw(i,r){if(1&i&&(e.TgZ(0,"button",16),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function jw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-radio-button",22),e.NdJ("click",function(n){return n.stopPropagation()})("change",function(n){const a=e.CHM(t).$implicit,l=e.oxw(2).$implicit,c=e.oxw().$implicit,u=e.oxw();return e.KtG(u.settingsValueCheckedRadioButton(n,c,l,a))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(4);e.Q6J("value",t)("matTooltip",o.getAvailableHashtagsValues(t))("checked",t.enabled),e.xp6(1),e.hij(" ",e.lcZ(2,4,t.title)," ")}}function Yw(i,r){if(1&i&&(e.TgZ(0,"span")(1,"mat-radio-group",20),e.YNc(2,jw,3,6,"mat-radio-button",21),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.Q6J("ngForOf",t.values)}}function Hw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw().$implicit,l=e.oxw();return e.KtG(l.checkUncheckAll(n,a,s))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&i){const t=e.oxw(2).$implicit;e.xp6(2),e.Oqu(t.allEnabled||void 0===t.allEnabled?e.lcZ(3,1,"igo.geo.search.searchSources.settings.unselectAll"):e.lcZ(4,3,"igo.geo.search.searchSources.settings.selectAll"))}}function Vw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",24),e.NdJ("click",function(n){return n.stopPropagation()})("change",function(n){const a=e.CHM(t).$implicit,l=e.oxw(2).$implicit,c=e.oxw().$implicit,u=e.oxw();return e.KtG(u.settingsValueCheckedCheckbox(n,c,l,a))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(2).$implicit,n=e.oxw(2);e.Udp("display",n.displayBlock),e.Q6J("checked",t.enabled)("value",o)("matTooltip",n.getAvailableHashtagsValues(t)),e.xp6(1),e.hij(" ",e.lcZ(2,6,t.title)," ")}}function zw(i,r){if(1&i&&(e.TgZ(0,"span"),e.YNc(1,Hw,5,5,"div",5),e.YNc(2,Vw,3,8,"mat-checkbox",23),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.values.length>3),e.xp6(1),e.Q6J("ngForOf",o.getAvailableValues(t))}}function Ww(i,r){if(1&i&&(e.ynx(0),e.TgZ(1,"button",15),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-menu",17,18),e.YNc(6,Yw,3,2,"span",19),e.YNc(7,zw,3,2,"span",19),e.qZA(),e.BQk()),2&i){const t=r.$implicit,o=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",o),e.xp6(1),e.hij(" ",e.lcZ(3,5,"igo.geo.search.searchSources.settings."+t.title)," "),e.xp6(2),e.Q6J("ngSwitch",t.type),e.xp6(2),e.Q6J("ngSwitchCase","radiobutton"),e.xp6(1),e.Q6J("ngSwitchCase","checkbox")}}function Kw(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"span",10)(2,"mat-checkbox",11),e.NdJ("click",function(n){return n.stopPropagation()})("change",function(n){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onCheckSearchSource(n,a))}),e.qZA(),e.YNc(3,Gw,2,2,"button",12),e.YNc(4,Qw,2,1,"button",13),e.qZA(),e.TgZ(5,"mat-menu",null,14),e.YNc(7,Ww,8,7,"ng-container",6),e.qZA(),e.BQk()}if(2&i){const t=r.$implicit;e.xp6(2),e.Q6J("checked",t.enabled)("value",t),e.xp6(1),e.Q6J("ngIf",t.settings.length>0),e.xp6(1),e.Q6J("ngIf",0===t.settings.length),e.xp6(3),e.Q6J("ngForOf",t.settings)}}function Xw(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"span"),e._UZ(1,"mat-divider"),e.TgZ(2,"span",25)(3,"mat-slide-toggle",26),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changePointerReverseSearch(n))})("click",function(n){return n.stopPropagation()}),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-slide-toggle",26),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.changeSearchResultsGeometry(n))})("click",function(n){return n.stopPropagation()}),e.ALo(8,"translate"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"mat-slide-toggle",26),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.reverseSearchCoordsFormat(n))})("click",function(n){return n.stopPropagation()}),e.ALo(12,"translate"),e.ALo(13,"translate"),e._uU(14),e.ALo(15,"translate"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("matTooltip",e.lcZ(4,12,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",t.pointerSummaryEnabled)("labelPosition","after"),e.xp6(2),e.hij(" ",e.lcZ(6,14,"igo.geo.search.pointerSearchSummary.title")," "),e.xp6(2),e.Q6J("matTooltip",e.lcZ(8,16,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",t.searchResultsGeometryEnabled)("labelPosition","after"),e.xp6(2),e.hij(" ",e.lcZ(10,18,"igo.geo.search.searchResultsGeometry.title")," "),e.xp6(2),e.Q6J("matTooltip",t.reverseSearchCoordsFormatEnabled?e.lcZ(12,20,"igo.geo.search.reverseCoordFormat.tooltipLatLon"):e.lcZ(13,22,"igo.geo.search.reverseCoordFormat.tooltipLonLat"))("checked",t.reverseSearchCoordsFormatEnabled)("labelPosition","after"),e.xp6(3),e.hij(" ",e.lcZ(15,24,"igo.geo.search.reverseCoordFormat.title")," ")}}let eT=(()=>{class i{constructor(t,o,n){this.searchSourceService=t,this.mediaService=o,this.storageService=n,this.hasPointerReverseSearchSource=!1,this.searchSourcesAllEnabled=!1,this.buffer=[],this.lastKeyTime=Date.now(),this.displayBlock="block",this.pointerSummaryEnabled=!1,this.searchResultsGeometryEnabled=!1,this.reverseSearchCoordsFormatEnabled=!1,this.searchSourceChange=new e.vpe,this.pointerSummaryStatus=new e.vpe,this.searchResultsGeometryStatus=new e.vpe,this.reverseSearchCoordsFormatStatus=new e.vpe}get isTouchScreen(){return this.mediaService.isTouchScreen()}handleKeyboardEvent(t){"F2"===t.key&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}ngOnInit(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}getSearchSources(){const t=this.searchSourceService.getSources().filter(Xn).filter(s=>s.available&&"map"!==s.getId()&&s.showInSettings),o=this.searchSourceService.getSources().filter(Hu).filter(s=>s.available&&"map"!==s.getId()&&s.showInSettings),n=t.concat(o);return this.computeSourcesCheckAllBehavior(n),n}hasReverseSearchSourcesForPointerSummary(){return!!this.searchSourceService.getEnabledSources().filter(el).length}settingsValueCheckedCheckbox(t,o,n,s){s.enabled=t.checked,o.setParamFromSetting(n),this.searchSourceChange.emit(o)}computeSettingCheckAllBehavior(t){t.allEnabled=void 0===t.allEnabled?!t.values.find(o=>o.enabled):!t.allEnabled}computeSourcesCheckAllBehavior(t){const o=t.filter(s=>s.enabled).length,n=t.filter(s=>!s.enabled).length;this.searchSourcesAllEnabled=!(o>=n)}checkUncheckAll(t,o,n){t.stopPropagation(),this.computeSettingCheckAllBehavior(n),n.values.forEach(s=>{s.enabled=n.allEnabled}),o.setParamFromSetting(n),this.searchSourceChange.emit(o)}checkUncheckAllSources(t){t.stopPropagation(),this.getSearchSources().map(o=>{o.enabled=this.searchSourcesAllEnabled,this.searchSourceChange.emit(o)})}settingsValueCheckedRadioButton(t,o,n,s){n.values.forEach(a=>{a.enabled=a.value!==s.value?!t.source.checked:t.source.checked}),o.setParamFromSetting(n),this.searchSourceChange.emit(o)}onCheckSearchSource(t,o){o.enabled=t.checked;const n=this.storageService.get(o.getId()+".options")||{};n.enabled=o.enabled,this.storageService.set(o.getId()+".options",n),this.searchSourceChange.emit(o)}getAvailableValues(t){return t.values.filter(o=>!1!==o.available)}getAvailableHashtagsValues(t){if(t.hashtags)return t.hashtags.map(o=>"#"+o).join(", ")}stopPropagation(t){t.stopPropagation()}changePointerReverseSearch(t){this.pointerSummaryEnabled=t.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}changeSearchResultsGeometry(t){this.searchResultsGeometryEnabled=t.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}reverseSearchCoordsFormat(t){this.reverseSearchCoordsFormatEnabled=t.checked,this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(ao),e.Y36(gt),e.Y36(ce))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-settings"]],hostBindings:function(t,o){1&t&&e.NdJ("keydown",function(s){return o.handleKeyboardEvent(s)},!1,e.evT)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus"},decls:9,vars:7,consts:[[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","chevron-down"],[1,"no-border-radius"],["searchSettingsMenu","matMenu"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"checked","value","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["sub_menu","matMenu"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item",""],["yPosition","above",3,"ngSwitch"],["test_sub_menu","matMenu"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","matTooltip","checked","click","change"],["class","mat-menu-item",3,"display","checked","value","matTooltip","click","change",4,"ngFor","ngForOf"],[1,"mat-menu-item",3,"checked","value","matTooltip","click","change"],[1,"pointer-summary-slide-toggle-container","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500",1,"search-option",3,"matTooltip","checked","labelPosition","change","click"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"mat-menu",3,4),e.YNc(6,qw,5,5,"div",5),e.YNc(7,Kw,8,5,"ng-container",6),e.YNc(8,Xw,16,26,"span",7),e.qZA()()),2&t){const n=e.MAs(5);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,5,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",n),e.xp6(5),e.Q6J("ngIf",o.getSearchSources().length>4),e.xp6(1),e.Q6J("ngForOf",o.getSearchSources()),e.xp6(1),e.Q6J("ngIf",o.hasPointerReverseSearchSource&&!o.isTouchScreen)}},dependencies:[f.sg,f.O5,f.RF,f.n9,O.gM,T.Hw,w.lW,$e.VK,$e.OP,$e.p6,nt.VQ,nt.U0,Ge.oG,vt.d,at.Rr,L.X$],styles:[".checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-button[_ngcontent-%COMP%]     div.mat-button-ripple-round{border-radius:0}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.igo-search-settings-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.search-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px}"],changeDetection:0}),i})(),il=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,O.AV,T.Ps,w.ot,$e.Tx,nt.Fk,Ge.p9,vt.t,at.rP,oe]}),i})();const tT=["input"];function oT(i,r){if(1&i&&(e.TgZ(0,"mat-label"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.label)}}function iT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onClearButtonClick())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",11),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.geo.search.clearSearch"))}}function nT(i,r){if(1&i&&(e.TgZ(0,"button",12),e._UZ(1,"mat-icon",13),e.qZA()),2&i){const t=e.oxw();e.Q6J("color",t.color)}}function rT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-search-selector",14),e.NdJ("searchTypeChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onSearchTypeChange(n))}),e.ALo(1,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("searchTypes",t.searchTypes)("searchType",e.lcZ(1,2,t.searchType$))}}function sT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-search-settings",15),e.NdJ("pointerSummaryStatus",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.pointerSummaryStatus.emit(n))})("searchResultsGeometryStatus",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.searchResultsGeometryStatus.emit(n))})("reverseSearchCoordsFormatStatus",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.reverseSearchCoordsFormatStatus.emit(n))})("searchSourceChange",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onSearchSettingsChange())}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("pointerSummaryEnabled",t.pointerSummaryEnabled)("searchResultsGeometryEnabled",t.searchResultsGeometryEnabled)("reverseSearchCoordsFormatEnabled",t.reverseSearchCoordsFormatEnabled)}}const aT=function(i){return{empty:i}},lT=function(i){return{hasSearchIcon:i}};let nl=(()=>{class i{constructor(t,o,n){this.configService=t,this.searchService=o,this.searchSourceService=n,this.placeholder$=new b.X("igo.geo.search.placeholder"),this.empty$=new b.X(!0),this.stream$=new b.X(""),this.showSearchButton=!1,this.searchTypes=op,this.searchType$=new b.X(void 0),this.pointerSummaryStatus=new e.vpe,this.searchResultsGeometryStatus=new e.vpe,this.reverseSearchCoordsFormatStatus=new e.vpe,this.term$=new b.X(""),this.disabled$=new b.X(!1),this.pointerSummaryEnabled=!1,this.searchResultsGeometryEnabled=!1,this._reverseSearchCoordsFormatEnabled=!1,this.floatLabel="never",this.appearance="legacy",this.color="primary",this.termSplitter="|",this.debounce=200,this.minLength=2,this.searchSelector=!1,this.searchSettings=!1,this.forceNA=!1,this.searchTermChange=new e.vpe,this.search=new e.vpe,this.searchTypeChange=new e.vpe,this.clearFeature=new e.vpe,this.searchSettingsChange=new e.vpe}set searchType(t){this.setSearchType(t)}get searchType(){return this.searchType$.value}set term(t){this.setTerm(t)}get term(){return this.term$.value}set disabled(t){this.disabled$.next(t)}get disabled(){return this.disabled$.value}get reverseSearchCoordsFormatEnabled(){return this._reverseSearchCoordsFormatEnabled}set reverseSearchCoordsFormatEnabled(t){this._reverseSearchCoordsFormatEnabled=t,this.setTerm(this.term,!0)}get empty(){return 0===this.term.length}ngOnInit(){this.term$$=this.term$.subscribe(o=>{this.empty$.next(void 0===o||0===o.length)}),this.stream$$=this.stream$.pipe((0,Tn.D)(()=>(0,wn.H)(this.debounce))).subscribe(o=>this.onSetTerm(o)),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe((0,ei.x)()).subscribe(o=>this.onSetSearchType(o));const t=this.configService.getConfig("searchBar.showSearchButton");this.showSearchButton=void 0!==t&&t}ngOnDestroy(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}onKeyup(t){this.keyIsValid(t.key)&&this.setTerm(t.target.value)}onClearButtonClick(){this.clear(),this.clearFeature.emit()}onSearchTypeChange(t){this.setSearchType(t)}setSearchType(t){this.searchType$.next(t)}onSearchSettingsChange(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}setTerm(t,o){if(this.disabled)return;(t=t||"")!==this.term&&!o&&this.term$.next(t);const n=t.replace(/(#[^\s]*)/g,"").trim();(n.length>=this.minLength||0===n.length)&&this.stream$.next(t)}clear(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}keyIsValid(t){return-1===i.invalidKeys.indexOf(t)}onSetTerm(t){this.searchTermChange.emit(t),this.doSearch(t)}handlePlaceholder(){const t=[...new Set(this.searchSourceService.getEnabledSources().filter(n=>!["map","coordinatesreverse"].includes(n.getId())).map(n=>n.getType()))];let o="igo.geo.search.placeholder";1===t.length?o=`igo.geo.search.${t[0].toLowerCase()}.placeholder`:0===t.length&&(o="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(o)}onSetSearchType(t){if(null==t)return;this.searchTypeChange.emit(t);const o=`igo.geo.search.${t.toLowerCase()}.placeholder`;this.placeholder$.next(o),this.setTerm(this.term)}doSearch(t){let o;this.researches$$&&(this.researches$$.map(s=>s.unsubscribe()),this.researches$$=void 0),this.termSplitter&&t.match(new RegExp(this.termSplitter,"g"))?(o=t.split(this.termSplitter).filter(s=>s.length>=this.minLength),this.store&&this.store.clear()):o=[t];let n=[];o.map(s=>{""!==(s?s.replace(/(#[^\s]*)/g,"").trim():"")?n=n.concat(this.searchService.search(s,{forceNA:this.forceNA})):void 0!==this.store&&this.store.clear()}),this.researches$$=n.map(s=>s.request.subscribe(a=>{this.onResearchCompleted(s,a)}))}onResearchCompleted(t,o){if(this.search.emit({research:t,results:o}),void 0!==this.store){const n=this.store.all().filter(s=>s.source!==t.source).concat(o);this.store.updateMany(n)}}}return i.invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"],i.\u0275fac=function(t){return new(t||i)(e.Y36(J),e.Y36(er),e.Y36(ao))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-bar"]],viewQuery:function(t,o){if(1&t&&e.Gf(tT,7),2&t){let n;e.iGM(n=e.CRH())&&(o.input=n.first)}},inputs:{searchTypes:"searchTypes",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},decls:16,vars:28,consts:[[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"ngClass","disabled","placeholder","value","keyup","touchend"],["input",""],[1,"search-bar-buttons"],["mat-icon-button","",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"color",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","",3,"color","matTooltip","click"],["svgIcon","close"],["mat-icon-button","",3,"color"],["svgIcon","magnify"],[3,"searchTypes","searchType","searchTypeChange"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e.TgZ(2,"mat-form-field",1),e.YNc(3,oT,2,1,"mat-label",2),e.TgZ(4,"input",3,4),e.NdJ("keyup",function(s){return o.onKeyup(s)})("touchend",function(s){return o.onKeyup(s)}),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"translate"),e.ALo(9,"async"),e.qZA()(),e.TgZ(10,"div",5),e.YNc(11,iT,3,4,"button",6),e.ALo(12,"async"),e.YNc(13,nT,2,1,"button",7),e.YNc(14,rT,2,4,"igo-search-selector",8),e.YNc(15,sT,1,3,"igo-search-settings",9),e.qZA()()),2&t&&(e.Q6J("ngClass",e.VKq(24,aT,e.lcZ(1,12,o.empty$))),e.xp6(2),e.Q6J("floatLabel",o.floatLabel)("appearance",o.appearance),e.xp6(1),e.Q6J("ngIf",o.label),e.xp6(1),e.Q6J("ngClass",e.VKq(26,lT,o.showSearchButton))("disabled",e.lcZ(6,14,o.disabled$))("placeholder",o.placeholder?o.placeholder:e.lcZ(7,16,o.placeholder$)?e.lcZ(8,18,o.placeholder$.value):void 0)("value",e.lcZ(9,20,o.term$)),e.xp6(7),e.Q6J("ngIf",!1===e.lcZ(12,22,o.empty$)),e.xp6(2),e.Q6J("ngIf",o.showSearchButton),e.xp6(1),e.Q6J("ngIf",o.searchSelector),e.xp6(1),e.Q6J("ngIf",o.searchSettings))},dependencies:[f.mk,f.O5,O.gM,T.Hw,w.lW,I.KE,I.hX,H.Nt,Nw,eT,f.Ov,L.X$],styles:['[_nghost-%COMP%]     .mat-form-field{padding:0 5px}[_nghost-%COMP%]     .mat-form-field-wrapper{margin-bottom:-1.5em}[_nghost-%COMP%]     span.mat-form-field-label-wrapper{top:-20px}[_nghost-%COMP%]     div.mat-form-field-infix{left:5px;right:5px;padding:0 0 12px!important}[_nghost-%COMP%]     div.mat-form-field-underline{display:none}.igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:inline-flex;overflow:hidden}.igo-search-bar-container[_ngcontent-%COMP%] > mat-form-field[_ngcontent-%COMP%]{width:calc(100% - 80px)}.igo-search-bar-container.empty[_ngcontent-%COMP%] > mat-form-field[_ngcontent-%COMP%]{width:calc(100% - 40px)}.search-bar-buttons[_ngcontent-%COMP%]{position:relative;right:0;display:inline-flex;top:0}.search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";left:0;top:5px;border-right:1px solid #ddd;height:28px}igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}'],changeDetection:0}),i})(),ip=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,O.AV,T.Ps,w.ot,$e.Tx,nt.Fk,I.lN,H.c,oe,ol,il]}),i})();function cT(i,r){if(1&i&&e._UZ(0,"mat-icon",5),2&i){const t=e.oxw();e.s9C("svgIcon",t.showIcons?t.icon:"blank")}}function uT(i,r){if(1&i&&e._UZ(0,"h4",6),2&i){const t=e.oxw();e.Q6J("innerHtml",t.titleHtml,e.oJD)("matTooltip",t.tooltipHtml)}}function pT(i,r){if(1&i&&(e.TgZ(0,"h4",7),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.Q6J("matTooltip",t.title),e.xp6(1),e.Oqu(t.title)}}function dT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onZoomHandler())}),e._UZ(1,"mat-icon",9),e.qZA()}}const gT=[[["","igoSearchItemToolbar",""]]],mT=["[igoSearchItemToolbar]"];let np=(()=>{class i{constructor(){this.withZoomButton=!1,this.zoomEvent=new e.vpe,this.format=new be.Z}get title(){return Yt(this.result)}get titleHtml(){return function fd(i){const r=i.meta||{};return r.titleHtml?r.titleHtml:ai(i,r.titleHtmlProperty||"titleHtml")}(this.result)}get tooltipHtml(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")}get icon(){return lr(this.result)}onZoomHandler(){const t=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});eo(this.map,[t],Y.Default)}onMouseEvent(t){const o=t.target;switch(t.type){case"mouseenter":const s=o.querySelector("#hide-save-search-result-btn");s&&s.setAttribute("id","show-save-search-result-btn");break;case"mouseleave":const a=o.querySelector("#show-save-search-result-btn");a&&a.setAttribute("id","hide-save-search-result-btn")}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},ngContentSelectors:mT,decls:6,vars:4,consts:[[3,"mouseenter","mouseleave"],["mat-list-avatar","",3,"svgIcon",4,"ngIf"],["matLine","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf"],["matLine","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["mat-list-avatar","",3,"svgIcon"],["matLine","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matLine","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"],["svgIcon","magnify"]],template:function(t,o){1&t&&(e.F$t(gT),e.TgZ(0,"mat-list-item",0),e.NdJ("mouseenter",function(s){return o.onMouseEvent(s)})("mouseleave",function(s){return o.onMouseEvent(s)}),e.YNc(1,cT,1,1,"mat-icon",1),e.YNc(2,uT,1,2,"h4",2),e.YNc(3,pT,2,2,"h4",3),e.YNc(4,dT,2,0,"button",4),e.Hsn(5),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.icon),e.xp6(1),e.Q6J("ngIf",o.titleHtml),e.xp6(1),e.Q6J("ngIf",!o.titleHtml),e.xp6(1),e.Q6J("ngIf",o.withZoomButton))},dependencies:[f.O5,O.gM,T.Hw,G.Tg,G.eA,Q.X2,w.lW,Ai],styles:["[_nghost-%COMP%]     small{color:#8c8c8c}  .search-result-tooltip{white-space:pre-line}"],changeDetection:0}),i})();const hT=["igoSearchItemToolbar"];function fT(i,r){1&i&&e.GkF(0)}const rp=function(i){return{results:i}};function _T(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-collapsible",7),e.NdJ("toggle",function(n){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.collapsed[s.source.title]=n)}),e.YNc(1,fT,1,0,"ng-container",8),e.qZA()}if(2&i){const t=e.oxw().$implicit,o=e.MAs(4),n=e.oxw(2);e.Tol(t.source.getId()),e.Q6J("title",n.computeGroupTitle(t))("collapsed",n.collapsed[t.source.title]),e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(6,rp,t.results))}}function yT(i,r){1&i&&e.GkF(0)}function vT(i,r){if(1&i&&e.YNc(0,yT,1,0,"ng-container",8),2&i){const t=e.oxw().$implicit,o=e.MAs(4);e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,rp,t.results))}}const sp=function(i){return{result:i}};function bT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-search-results-item",10),e.NdJ("focus",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultFocus.emit(s))})("unfocus",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultUnfocus.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.onResultSelect(s))})("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultFocus.emit(s))})("mouseleave",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultUnfocus.emit(s))}),e.GkF(1,11),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(4);e.Q6J("map",o.map)("result",t)("showIcons",o.showIcons)("withZoomButton",o.withZoomButton)("focused",o.store.state.get(t).focused)("selected",o.store.state.get(t).selected),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateSearchToolbar)("ngTemplateOutletContext",e.VKq(8,sp,t))}}function CT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"span",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2).$implicit,s=e.oxw(2);return e.KtG(s.displayMoreResults(n))}),e.TgZ(1,"u"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&i&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.search.displayMoreResults")))}function xT(i,r){if(1&i&&(e.YNc(0,bT,2,10,"ng-template",2),e.YNc(1,CT,4,3,"span",9)),2&i){const t=r.results,o=e.oxw().$implicit,n=e.oxw(2);e.Q6J("ngForOf",t),e.xp6(1),e.Q6J("ngIf",n.isMoreResults(o))}}function ST(i,r){if(1&i&&(e.YNc(0,_T,2,8,"igo-collapsible",4),e.YNc(1,vT,1,4,"ng-template",null,5,e.W1O),e.YNc(3,xT,2,2,"ng-template",null,6,e.W1O)),2&i){const t=e.MAs(2),o=e.oxw(2);e.Q6J("ngIf",o.mode===o.searchResultMode.Grouped)("ngIfElse",t)}}function wT(i,r){if(1&i&&(e.TgZ(0,"igo-list",1),e.YNc(1,ST,5,2,"ng-template",2,3,e.W1O),e.ALo(3,"async"),e.qZA()),2&i){const t=e.oxw();e.Q6J("navigation",!0),e.xp6(1),e.Q6J("ngForOf",e.lcZ(3,2,t.results$))}}function TT(i,r){1&i&&e.GkF(0)}function MT(i,r){1&i&&e.GkF(0)}const ap=function(i){return{group:i}};function FT(i,r){if(1&i&&(e.TgZ(0,"mat-tab",17),e.YNc(1,MT,1,0,"ng-container",8),e.qZA()),2&i){const t=r.$implicit;e.oxw(2);const o=e.MAs(7),n=e.oxw();e.Q6J("label",n.computeGroupTitle(t)),e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(3,ap,t))}}function AT(i,r){if(1&i&&(e.TgZ(0,"mat-tab-group",15),e.YNc(1,FT,2,5,"mat-tab",16),e.ALo(2,"async"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,t.results$))}}function LT(i,r){1&i&&e.GkF(0)}function IT(i,r){if(1&i&&e.YNc(0,LT,1,0,"ng-container",8),2&i){const t=r.$implicit;e.oxw(2);const o=e.MAs(7);e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,ap,t))}}function OT(i,r){if(1&i&&(e.YNc(0,IT,1,4,"ng-template",2),e.ALo(1,"async")),2&i){const t=e.oxw(2);e.Q6J("ngForOf",e.lcZ(1,1,t.results$))}}function ZT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-search-results-item",10),e.NdJ("focus",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultFocus.emit(s))})("unfocus",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultUnfocus.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.onResultSelect(s))})("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultFocus.emit(s))})("mouseleave",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultUnfocus.emit(s))}),e.GkF(1,11),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("map",o.map)("result",t)("showIcons",o.showIcons)("withZoomButton",o.withZoomButton)("focused",o.store.state.get(t).focused)("selected",o.store.state.get(t).selected),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateSearchToolbar)("ngTemplateOutletContext",e.VKq(8,sp,t))}}function DT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"span",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().group,s=e.oxw(2);return e.KtG(s.displayMoreResults(n))}),e.TgZ(1,"u"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&i&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.search.displayMoreResults")))}function kT(i,r){if(1&i&&(e.YNc(0,ZT,2,10,"ng-template",2),e.YNc(1,DT,4,3,"span",9)),2&i){const t=r.group,o=e.oxw(2);e.Q6J("ngForOf",t.results),e.xp6(1),e.Q6J("ngIf",o.isMoreResults(t))}}function PT(i,r){if(1&i&&(e.TgZ(0,"igo-list",1),e.YNc(1,TT,1,0,"ng-container",13),e.YNc(2,AT,3,3,"ng-template",null,14,e.W1O),e.YNc(4,OT,2,3,"ng-template",null,5,e.W1O),e.YNc(6,kT,2,2,"ng-template",null,6,e.W1O),e.qZA()),2&i){const t=e.MAs(3),o=e.MAs(5),n=e.oxw();e.Q6J("navigation",!0),e.xp6(1),e.Q6J("ngIf",n.mode===n.searchResultMode.Grouped)("ngIfThen",t)("ngIfElse",o)}}var tr=(()=>{return(i=tr||(tr={})).Grouped="grouped",i.Flat="flat",tr;var i})();let lp=(()=>{class i{constructor(t,o,n){this.cdRef=t,this.searchService=o,this.configService=n,this.showResultsCount=!0,this.searchResultMode=tr,this.pageIterator=[],this.collapsed=[],this.mode=tr.Grouped,this.withZoomButton=!1,this.tabsMode=!1,this.settingsChange$=new b.X(void 0),this.termSplitter="|",this.resultFocus=new e.vpe,this.resultUnfocus=new e.vpe,this.resultSelect=new e.vpe,this.moreResults=new e.vpe,this.resultMouseenter=new e.vpe,this.resultMouseleave=new e.vpe}get term(){return this._term}set term(t){this._term=t,this.pageIterator=[]}get results$(){return void 0===this._results$&&(this._results$=this.liftResults()),this._results$}ngOnInit(){this.watcher=new yn(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(()=>{this.pageIterator=[]}),!1===this.configService.getConfig("searchSources.showResultsCount")&&(this.showResultsCount=!1)}ngOnDestroy(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}computeGroupTitle(t){const o=[t.source.title],n=t.results.length;return n>1&&this.showResultsCount&&o.push(`(${n})`),o.join(" ")}onResultSelect(t){this.store.state.get(t)&&!0===this.store.state.get(t).selected||(this.store.state.update(t,{focused:!0,selected:!0},!0),this.resultSelect.emit(t))}liftResults(){return this.store.stateView.all$().pipe((0,Tn.D)(t=>0===t.length?Bi.E:(0,wn.H)(200)),(0,Z.U)(t=>this.groupResults(t.map(o=>o.entity).sort(this.sortByOrder))))}sortByOrder(t,o){return t.source.displayOrder-o.source.displayOrder}groupResults(t){const o=new Map;return t.forEach(n=>{const s=n.source;let a=o.get(s);void 0===a&&(a=[],o.set(s,a)),a.push(n)}),Array.from(o.keys()).map(n=>(void 0===this.pageIterator[n.getId()]&&(this.pageIterator[n.getId()]=1),{source:n,results:o.get(n)}))}isMoreResults(t){var o;const n=this.store.getStrategyOfType(Jt);return(null==n?void 0:n.active)?(null===(o=t.results)||void 0===o?void 0:o.length)%+t.source.params.limit==0&&+t.source.params.page<30:t.results&&!0===t.results[t.results.length-1].meta.nextPage}displayMoreResults(t){const o={sourceId:t.source.getId(),page:++this.pageIterator[t.source.getId()]};let n;n=this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?this.term.split(this.termSplitter):[this.term];let s=[];n.map(a=>{s=s.concat(this.searchService.search(a,o))}),s.map(a=>{a.request.subscribe(l=>{const c=t.results.concat(l);l.length||(c[c.length-1].meta.nextPage=!1),this.moreResults.emit({research:a,results:c})})})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(er),e.Y36(J))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-results"]],contentQueries:function(t,o,n){if(1&t&&e.Suo(n,hT,5),2&t){let s;e.iGM(s=e.CRH())&&(o.templateSearchToolbar=s.first)}},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",tabsMode:"tabsMode",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},decls:2,vars:2,consts:[[3,"navigation",4,"ngIf"],[3,"navigation"],["ngFor","",3,"ngForOf"],["groupTemplate",""],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],["flatTemplate",""],["storeItemTemplate",""],[3,"title","collapsed","toggle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"map","result","showIcons","withZoomButton","focused","selected","focus","unfocus","select","mouseenter","mouseleave"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["tabsTemplate",""],["dynamicHeight","",1,"custom-tabs-view"],[3,"label",4,"ngFor","ngForOf"],[3,"label"]],template:function(t,o){1&t&&(e.YNc(0,wT,4,4,"igo-list",0),e.YNc(1,PT,8,4,"igo-list",0)),2&t&&(e.Q6J("ngIf",!1===o.tabsMode),e.xp6(1),e.Q6J("ngIf",o.tabsMode))},dependencies:[f.sg,f.O5,f.tP,lt.SP,lt.uX,Ds,Zt,mo,np,f.Ov,L.X$],styles:[".moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}igo-list[_ngcontent-%COMP%]     mat-list{height:100%}igo-list[_ngcontent-%COMP%]     mat-list .custom-tabs-view .mat-tab-header-pagination{min-width:20px}"],changeDetection:0}),i})();function $T(i,r){if(1&i&&(e.TgZ(0,"mat-option",14)(1,"p",15),e._uU(2),e.qZA()()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(2),e.Oqu(t.title)}}let ET=(()=>{class i{constructor(t,o,n,s){this.formBuilder=t,this.languageService=o,this.dialogRef=n,this.data=s,this.layers=[],this.form=this.formBuilder.group({layerName:["",[_.kI.required]]})}ngOnInit(){this.feature=this.data.feature,this.layers=this.data.layers,this.filteredLayers$=this.form.controls.layerName.valueChanges.pipe((0,Cl.O)(""),(0,Z.U)(t=>this.filter(t)))}filter(t){if("string"==typeof t)return this.layers.map(o=>o).filter(o=>{var n;return null===(n=null==o?void 0:o.title)||void 0===n?void 0:n.toLowerCase().includes(t.toLowerCase())})}displayFn(t){return t&&t.title?t.title:""}save(){this.dialogRef.close({layer:this.form.value.layerName,feature:this.feature})}cancel(){this.dialogRef.close()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_.QS),e.Y36(D),e.Y36(P.so),e.Y36(P.WI,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-save-feature-dialog"]],decls:23,vars:21,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[3,"navigation","selection"],["igoListItem","","color","accent","showIcons","true",3,"result"],[1,"igo-input-container"],["type","text","matInput","","formControlName","layerName",3,"placeholder","matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","create-layer-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","createLayerBtnDialog","mat-raised-button","","type","button","color","primary",3,"click"],[3,"value"],["mat-line",""]],template:function(t,o){if(1&t&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"form",2)(5,"igo-list",3),e._UZ(6,"igo-search-results-item",4),e.qZA(),e.TgZ(7,"div",5)(8,"mat-form-field"),e._UZ(9,"input",6),e.ALo(10,"translate"),e.TgZ(11,"mat-autocomplete",7,8),e.YNc(13,$T,3,2,"mat-option",9),e.ALo(14,"async"),e.qZA()()()()(),e.TgZ(15,"div",10)(16,"div",11)(17,"button",12),e.NdJ("click",function(){return o.cancel()}),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"button",13),e.NdJ("click",function(){return o.save()}),e._uU(21),e.ALo(22,"translate"),e.qZA()()()),2&t){const n=e.MAs(12);e.xp6(1),e.Oqu(e.lcZ(2,11,"igo.geo.layer.saveFeatureInLayer")),e.xp6(3),e.Q6J("formGroup",o.form),e.xp6(1),e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("result",o.feature),e.xp6(3),e.s9C("placeholder",e.lcZ(10,13,"igo.geo.layer.chooseOrSet")),e.Q6J("matAutocomplete",n),e.xp6(2),e.Q6J("displayWith",o.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(14,15,o.filteredLayers$)),e.xp6(5),e.hij(" ",e.lcZ(19,17,"igo.geo.layer.cancelBtn")," "),e.xp6(3),e.hij(" ",e.lcZ(22,19,"igo.geo.layer.saveBtn")," ")}},dependencies:[f.sg,Q.X2,w.lW,P.uh,P.xY,P.H8,Zt,mo,I.KE,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,H.Nt,Q.ey,Xe.XC,Xe.ZL,np,f.Ov,L.X$],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.create-layer-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#createLayerBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]}),i})();function JT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",2),e.NdJ("mouseenter",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onMouseEvent(n))})("mouseleave",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onMouseEvent(n))})("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleClick(n))}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",3),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"async"),e.ALo(9,"async"),e.ALo(10,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,6,t.computeTooltip()))("color",e.lcZ(2,8,t.isPreview$)?"":t.added?"warn":""),e.xp6(3),e.Q6J("igoMatBadgeIcon",t.getBadgeIcon())("matBadgeHidden",e.lcZ(4,10,t.inRange$)&&!0===e.lcZ(5,12,t.isVisible$)||e.lcZ(6,14,t.inRange$)&&!t.added||e.lcZ(7,16,t.inRange$)&&e.lcZ(8,18,t.isPreview$))("matBadgeDisabled",!1===e.lcZ(9,20,t.inRange$))("svgIcon",e.lcZ(10,22,t.isPreview$)?"plus":t.added?"delete":"plus")}}function RT(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.addFeatureToLayer())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",5),e.ALo(4,"async"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("id",t.isMobile?"":"hide-save-search-result-btn")("matTooltip",e.lcZ(1,3,e.lcZ(2,5,t.addFeatureToLayerTooltip$))),e.xp6(3),e.Q6J("matBadgeHidden",e.lcZ(4,7,t.inRange$))}}let cp=(()=>{class i{constructor(t,o,n,s){this.layerService=t,this.dialog=o,this.dataSourceService=n,this.mediaService=s,this.tooltip$=new b.X("igo.geo.catalog.layer.addToMap"),this.addFeatureToLayerTooltip$=new b.X("igo.geo.search.addToLayer"),this.inRange$=new b.X(!0),this.isVisible$=new b.X(!1),this.isPreview$=new b.X(!1),this.layersSubcriptions=[],this.mouseInsideAdd=!1,this.saveSearchResultInLayer=!1,this._color="primary",this.stores=[],this.isMobile=!1}get color(){return this._color}set color(t){this._color=t}get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-search-layer"))}ngOnInit(){this.mediaService$$=this.mediaService.media$.subscribe(t=>{t===Et.Mobile&&(this.isMobile=!0)}),"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(t=>t.id===this.layer.data.sourceOptions.id)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.layers$$.unsubscribe(),this.mediaService$$&&this.mediaService$$.unsubscribe()}onMouseEvent(t){this.onToggleClick(t)}onToggleClick(t){if(void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add(t)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addLayerToMap(t))}remove(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(t=>t.unsubscribe()),this.layersSubcriptions=[])}addLayerToMap(t){if(void 0===this.map||this.layer.meta.dataType!==Yn)return;const o=this.layer.data;void 0===o.sourceOptions.optionsFromApi&&(o.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(o).subscribe(n=>{"click"===t.type&&this.map.layersAddedByClick$.next([n]),this.map.addLayer(n)}))}removeLayerFromMap(){if(void 0===this.map||this.layer.meta.dataType!==Yn)return;const t=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(t)}isInResolutionsRange(t){this.inRange$.next(t>=(this.layer.data.minResolution||0)&&t<=(this.layer.data.maxResolution||1/0))}isVisible(){var t,o,n;if(null!==(n=null===(o=null===(t=this.layer)||void 0===t?void 0:t.data)||void 0===o?void 0:o.sourceOptions)&&void 0!==n&&n.id){const s=this.map.getLayerById(this.layer.data.sourceOptions.id);this.isVisible$.next(!!s&&s.visible)}}getBadgeIcon(){return this.inRange$.value&&this.isVisible$.value?"":"eye-off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}addFeatureToLayer(){"Feature"===this.layer.meta.dataType&&this.dialog.open(ET,{width:"700px",data:{feature:this.layer,layers:this.allLayers}}).afterClosed().subscribe(n=>{if(n)if(this.stores.length>0&&this.stores.map(s=>(s.state.updateAll({selected:!1}),(null==s?void 0:s.layer).visible=!1,s)),"string"==typeof n.layer)this.createLayer(n.layer,n.feature);else{const s=this.stores.find(a=>a.layer.id===n.layer.id);s.layer.visible=!0,s.layer.opacity=1,this.addFeature(n.feature,s)}})}createLayer(t,o){const n=new Ct([],{map:this.map}),s=[new R.ZP({image:new Me.Z({radius:5,stroke:new U.Z({width:1,color:"rgba(143,7,7,1)"}),fill:new N.Z({color:"rgba(143,7,7,1)"})})}),new R.ZP({stroke:new U.Z({width:1,color:"rgba(143,7,7,1)"}),fill:new N.Z({color:"rgba(0, 0, 255, 0.1)"})})];let a=0;for(const l of this.allLayers){let c=Number(l.id.replace("igo-search-layer",""));a=Math.max(c,a)}this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,Ee.q)(1)).subscribe(l=>{let c=new Te({isIgoInternalLayer:!0,id:"igo-search-layer"+ ++a,title:t,source:l,igoStyle:{editable:!1,igoStyleObject:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},circle:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},radius:5}}},style:s,showInLayerList:!0,exportable:!0,workspace:{enabled:!0}});qo(n,c),Vi(n,new Nt({motion:Y.None})),Ca(n,new Mt({map:this.map,motion:Y.None,many:!0})),n.layer.visible=!0,n.source.ol.on("removefeature",u=>{const p=u.feature.getGeometry();this.clearLabelsOfOlGeometry(p)}),this.addFeature(o,n),this.stores.push(n)})}addFeature(t,o){const n={type:t.data.type,geometry:{coordinates:t.data.geometry.coordinates,type:t.data.geometry.type},projection:t.data.projection,properties:t.data.properties,meta:{id:t.meta.id}};delete n.properties.Route,o.update(n),o.setLayerExtent(),o.layer.ol.getSource().refresh()}clearLabelsOfOlGeometry(t){qr(t).forEach(o=>{o&&o.getMap()&&this.map.ol.removeOverlay(o)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Le),e.Y36(P.uw),e.Y36(wt),e.Y36(gt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",store:"store",added:"added",map:"map",saveSearchResultInLayer:"saveSearchResultInLayer",color:"color",stores:"stores"},decls:2,vars:2,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","igoMatBadgeInverseColor","true","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","matBadgeHidden","matBadgeDisabled","svgIcon"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click"],["matBadge","icon","igoMatBadgeIcon","eye-off","igoMatBadgeInverseColor","true","matBadgeDisabled","true","matBadgeSize","small","matBadgePosition","after","svgIcon","file-plus-outline",3,"matBadgeHidden"]],template:function(t,o){1&t&&(e.YNc(0,JT,11,24,"button",0),e.YNc(1,RT,5,9,"button",1)),2&t&&(e.Q6J("ngIf","Layer"===o.layer.meta.dataType),e.xp6(1),e.Q6J("ngIf","Feature"===o.layer.meta.dataType&&o.saveSearchResultInLayer))},dependencies:[f.O5,mt.k,O.gM,T.Hw,w.lW,Ai,Zs,f.Ov,L.X$],styles:["#hide-save-search-result-btn[_ngcontent-%COMP%]{display:none}#show-save-search-result-btn[_ngcontent-%COMP%]{display:block}"],changeDetection:0}),i})(),up=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,mt.g,O.AV,T.Ps,G.ie,w.ot,lt.Nh,P.Is,Ii,ui,vr,oe,dr,fi,I.lN,_.UX,H.c,ue.LD,Xe.Bb]}),i})(),BT=(()=>{class i{constructor(t,o,n,s){this.component=t,this.searchService=o,this.searchSourceService=n,this.mediaService=s,this.pointerSearchStore=new it([]),this.reverseSearch$$=[],this.hasPointerReverseSearchSource=!1,this.searchPointerSummaryFeatureId="searchPointerSummaryFeatureId",this.igoSearchPointerSummaryDelay=1e3,this.igoSearchPointerSummaryEnabled=!1}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}ngOnInit(){this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.map.status$.pipe((0,Ee.q)(1)).subscribe(()=>{this.store=new Ct([],{map:this.map}),this.initStore()}),this.layers$$=this.map.layers$.subscribe(t=>{this.store&&!t.find(o=>"searchPointerSummaryId"===o.id)&&this.initStore()})}initStore(){qo(this.store,new Te({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new Fe,showInLayerList:!1,exportable:!1,browsable:!1,style:_y}))}ngAfterContentChecked(){this.hasPointerReverseSearchSource=!!this.searchSourceService.getEnabledSources().filter(el).length}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerSearchStore.entities$.subscribe(t=>{this.entitiesToPointerOverlay(t)})}computeSummaryClosestFeature(t){const o={};return t.map(n=>{n.data.properties.type&&n.data.properties.distance>=0&&(o.hasOwnProperty(n.data.properties.type)?n.data.properties.distance<o[n.data.properties.type].distance&&(o[n.data.properties.type]={distance:n.data.properties.distance,title:n.meta.pointerSummaryTitle||n.meta.title}):o[n.data.properties.type]={distance:n.data.properties.distance,title:n.meta.pointerSummaryTitle||n.meta.title})}),o}entitiesToPointerOverlay(t){const o=this.computeSummaryClosestFeature(t),n=Object.keys(o),s=[],a=[];t.map(l=>{const c=n.indexOf(l.data.properties.type);-1!==c?(a.push(o[l.data.properties.type].title),n.splice(c,1),s.push(l.data.properties.type)):-1===s.indexOf(l.data.properties.type)&&a.push(l.meta.pointerSummaryTitle||l.meta.title)}),a.length&&this.addPointerOverlay(a.join("\n"))}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",t=>this.onMapEvent(t))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unsubscribeReverseSearch(){this.reverseSearch$$.map(t=>t.unsubscribe()),this.reverseSearch$$=[]}unlistenToMapPointerMove(){(0,et.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}onMapEvent(t){!t.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?(void 0!==this.lastTimeoutRequest&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=(0,V.vs)(t.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(()=>{this.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()}sortByOrder(t,o){return t.source.displayOrder-o.source.displayOrder}onSearchCoordinate(){this.pointerSearchStore.clear();const t=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0);for(const o in t)t.length>0&&this.reverseSearch$$.push(t[o].request.subscribe(n=>{this.onSearch({research:t[o],results:n})}))}onSearch(t){const o=t.results,n=this.pointerSearchStore.all().filter(s=>s.source!==t.research.source).concat(o);this.pointerSearchStore.load(n.sort(this.sortByOrder))}addPointerOverlay(t){this.clearLayer();const o=new Pe.Z((0,V.vs)(this.lonLat,"EPSG:4326",this.mapProjection)),n=new De.Z({geometry:o}),s=(new be.Z).writeGeometryObject(o,{featureProjection:this.mapProjection,dataProjection:this.mapProjection});this.store.setLayerFeatures([{type:le,geometry:s,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:t},meta:{id:this.searchPointerSummaryFeatureId},ol:n}],Y.None)}clearLayer(){this.store&&this.store.clearLayer()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ae,2),e.Y36(er),e.Y36(ao),e.Y36(gt))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoSearchPointerSummary",""]],inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"}}),i})(),ls=(()=>{class i{static forRoot(){return{ngModule:i,providers:[er,{provide:ao,useFactory:ww,deps:[_t]},{provide:ss,useFactory:Fw,deps:[D]},{provide:Xu,useFactory:Dw,deps:[D]},{provide:as,useFactory:Ew,deps:[D]}]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,ip,ol,up,il,ip,ol,up,il]}),i})(),GT=(()=>{class i{constructor(t){this.cdRef=t,this.complete=new e.vpe,this.cancel=new e.vpe}onUpdateInputs(){this.cdRef.detectChanges()}onClose(){this.cancel.emit()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(t,o){1&t&&e._UZ(0,"igo-ogc-filterable-item",0),2&t&&e.Q6J("layer",o.layer)("header",!1)("map",o.map)},dependencies:[Vn],changeDetection:0}),i})();const rl=new e.OlP("OgcFilterWidget");function QT(i){return i.create(GT)}let pp=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,w.ot,oe,Lo]}),i})();function Vo({feature:i,markerColor:r=[0,161,222],markerOpacity:t=1,markerOutlineColor:o=[0,255,255],fillColor:n,fillOpacity:s=.15,strokeColor:a=[0,255,255],strokeOpacity:l=.5,strokeWidth:c=4}){return function sl({feature:i,markerColor:r=[0,161,222],markerOpacity:t=.5,markerOutlineColor:o,fillColor:n=[0,161,222],fillOpacity:s=.15,strokeColor:a=[0,161,222],strokeOpacity:l=.5,strokeWidth:c=2}){const u=i instanceof De.Z;let p,d;u?p=i.getGeometry():(p=i.geometry,d=i.meta.mapTitle);const g=u?p.getType():p.type;if(p&&"Point"!==g){const h=(0,fo._2)(n).slice(0),m=(0,fo._2)(a).slice(0);return 4===h.length&&("string"!=typeof n||/^#[0-9A-F]{8}$/i.test(n))||(h[3]=s),4===m.length&&("string"!=typeof a||/^#[0-9A-F]{8}$/i.test(a))||(m[3]=l),Bc({text:d,strokeWidth:c,strokeColor:m,fillColor:h})}{const h=(0,fo._2)(r).slice(0),m=h.slice(0,3);return 4===h.length&&("string"!=typeof r||/^#[0-9A-F]{8}$/i.test(r))&&(t=h[3]),Go({text:d,opacity:t,markerOutlineColor:o,markerColor:m})}}({feature:i,markerColor:r,markerOpacity:t,markerOutlineColor:o,fillColor:n,fillOpacity:s,strokeColor:a,strokeOpacity:l,strokeWidth:c})}class al extends zs{constructor(r){super(r),this.options=r,this.inResolutionRange$=new b.X(!0),this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}get layer(){return this.options.layer}get map(){return this.options.map}getLayerWksOptionTabQuery(){var r;return void 0===(null===(r=this.layer.options.workspace.queryOptions)||void 0===r?void 0:r.tabQuery)||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){var r;return void 0===(null===(r=this.layer.options.workspace.queryOptions)||void 0===r?void 0:r.mapQueryOnOpenTab)||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}let dp=(()=>{class i{constructor(t,o){this.storageService=t,this.configService=o,this.ws$=new b.X(void 0)}get zoomAuto(){return this.storageService.get("zoomAuto")}createWorkspace(t,o){var n;if(!1===(null===(n=t.options.workspace)||void 0===n?void 0:n.enabled)||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const s=new al({id:t.id,title:t.title,layer:t,map:o,entityStore:this.createFeatureStore(t,o),actionStore:new Eo([]),meta:{tableTemplate:void 0}});return this.createTableTemplate(s,t),s}createFeatureStore(t,o){const n=new Ct([],{map:o});n.bindLayer(t);const s=new Pr({}),a=new Hi({}),l=new kr({}),c=new To({}),u=this.configService.getConfig("queryOverlayStyle"),p=new Mt({layer:new Te({zIndex:300,source:new Fe,style:d=>Vo(Object.assign({},{feature:d},u.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return n.addStrategy(s,!0),n.addStrategy(a,!0),n.addStrategy(l,!0),n.addStrategy(p,!0),n.addStrategy(c,!1),n.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),n}createTableTemplate(t,o){const n=o.dataSource.options.sourceFields||[],s=o.dataSource.options.relations||[];if(0===n.length)return void t.entityStore.entities$.pipe((0,At.n)(c=>0===c.length),(0,Ee.q)(1)).subscribe(c=>{const u=c[0].ol,p=u.getKeys().filter(d=>!d.startsWith("_")&&"geometry"!==d&&d!==u.getGeometryName()&&!d.match(/boundedby/gi)).map(d=>({name:`properties.${d}`,title:d,renderer:je.UnsanitizedHTML}));t.meta.tableTemplate={selection:!0,sort:!0,columns:p}});const a=n.map(c=>({name:`properties.${c.name}`,title:c.alias?c.alias:c.name,renderer:je.UnsanitizedHTML,tooltip:c.tooltip})),l=s.map(c=>({name:`properties.${c.name}`,title:c.alias?c.alias:c.name,renderer:je.Icon,icon:c.icon,parent:c.parent,type:"relation",tooltip:c.tooltip,onClick:()=>{this.ws$.next(c.title)},cellClassFunc:()=>({class_icon:!0})}));a.push(...l),t.meta.tableTemplate={selection:!0,sort:!0,columns:a}}createFilterInMapExtentOrResolutionStrategy(){return new Jt({filterClauseFunc:o=>!0===o.state.inMapExtent&&!0===o.state.inMapResolution})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ce),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),gp=(()=>{class i{constructor(t,o,n,s){this.layerService=t,this.storageService=o,this.styleService=n,this.configService=s,this.ws$=new b.X(void 0)}get zoomAuto(){return this.storageService.get("zoomAuto")}createWorkspace(t,o){var n,s,a,l,c,u,p,d,g,h,m,y;if(!t.options.workspace||o.layers.find(z=>z.id===t.id+".WfsWorkspaceTableDest")||t.dataSource.options.edition)return;const v=t.dataSource,S=t.id+".WmsWorkspaceTableSrc",M=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:S,links:[]});const A={syncedDelete:!0,linkedIds:[M],properties:[Be.ZINDEX,Be.VISIBLE]};null!==(n=t.options.workspace)&&void 0!==n&&n.minResolution||A.properties.push(Be.MINRESOLUTION);let F=!1;!(null===(s=v.options.ogcFilters)||void 0===s)&&s.enabled&&(A.properties.push(Be.OGCFILTERS),F=!0),null!==(a=t.options.workspace)&&void 0!==a&&a.maxResolution||A.properties.push(Be.MAXRESOLUTION);let k=[];t.options.linkedLayers.links&&(k=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),k.push(A),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:S,t.options.linkedLayers.links=k;let ne,se={srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:null===(c=null===(l=t.options.workspace)||void 0===l?void 0:l.queryOptions)||void 0===c?void 0:c.mapQueryOnOpenTab,tabQuery:null===(p=null===(u=t.options.workspace)||void 0===u?void 0:u.queryOptions)||void 0===p?void 0:p.tabQuery},pageSize:null===(d=t.options.workspace)||void 0===d?void 0:d.pageSize,pageSizeOptions:null===(g=t.options.workspace)||void 0===g?void 0:g.pageSizeOptions};return this.layerService.createAsyncLayer({isIgoInternalLayer:!0,id:M,linkedLayers:{linkId:M},workspace:se,showInLayerList:!1,opacity:0,title:t.title,minResolution:(null===(h=t.options.workspace)||void 0===h?void 0:h.minResolution)||t.minResolution||0,maxResolution:(null===(m=t.options.workspace)||void 0===m?void 0:m.maxResolution)||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:v.options.download,type:"wfs",url:v.options.urlWfs||v.options.url,queryable:!0,relations:v.options.relations,queryTitle:v.options.queryTitle,queryFormatAsWms:null===(y=t.options.workspace)||void 0===y||!y.enabled||v.options.queryFormatAsWms,params:v.options.paramsWFS,ogcFilters:Object.assign({},v.ogcFilters,{enabled:F}),sourceFields:v.options.sourceFields||void 0}}).subscribe(z=>{var de,ge,xe,pe,W,ze,me;if(o.addLayer(z),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:k}},!1),z.dataSource.ol.refresh(),null!==(de=t.options.workspace)&&void 0!==de&&de.enabled)return ne=new al({id:t.id,title:t.title,layer:z,map:o,entityStore:this.createFeatureStore(z,o),actionStore:new Eo([]),meta:{tableTemplate:void 0}}),this.createTableTemplate(ne,z),z.options.workspace.workspaceId=z.id,t.options.workspace=Object.assign({},t.options.workspace,{enabled:!0,srcId:t.id,workspaceId:z.id,queryOptions:{mapQueryOnOpenTab:null===(xe=null===(ge=t.options.workspace)||void 0===ge?void 0:ge.queryOptions)||void 0===xe?void 0:xe.mapQueryOnOpenTab,tabQuery:null===(W=null===(pe=t.options.workspace)||void 0===pe?void 0:pe.queryOptions)||void 0===W?void 0:W.tabQuery},pageSize:null===(ze=t.options.workspace)||void 0===ze?void 0:ze.pageSize,pageSizeOptions:null===(me=t.options.workspace)||void 0===me?void 0:me.pageSizeOptions}),delete v.options.download,ne}),ne}createFeatureStore(t,o){const n=new Ct([],{map:o});n.bindLayer(t);const s=new Pr({}),a=new Hi({}),l=new kr({}),c=new To({}),u=this.configService.getConfig("queryOverlayStyle"),p=new Mt({layer:new Te({zIndex:300,source:new Fe,style:d=>Vo(Object.assign({},{feature:d},u.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return n.addStrategy(s,!0),n.addStrategy(a,!0),n.addStrategy(l,!0),n.addStrategy(p,!0),n.addStrategy(c,!1),n.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),n}createTableTemplate(t,o){const n=o.dataSource.options.sourceFields||[],s=o.dataSource.options.relations||[];if(0===n.length)return void t.entityStore.entities$.pipe((0,At.n)(c=>0===c.length),(0,Ee.q)(1)).subscribe(c=>{const u=c[0].ol,p=u.getKeys().filter(d=>!d.startsWith("_")&&"geometry"!==d&&d!==u.getGeometryName()&&!d.match(/boundedby/gi)).map(d=>({name:`properties.${d}`,title:d,renderer:je.UnsanitizedHTML}));t.meta.tableTemplate={selection:!0,sort:!0,columns:p}});const a=n.map(c=>({name:`properties.${c.name}`,title:c.alias?c.alias:c.name,renderer:je.UnsanitizedHTML,tooltip:c.tooltip})),l=s.map(c=>({name:`properties.${c.name}`,title:c.alias?c.alias:c.name,renderer:je.Icon,icon:c.icon,parent:c.parent,type:"relation",tooltip:c.tooltip,onClick:()=>{this.ws$.next(c.title)},cellClassFunc:()=>({class_icon:!0})}));a.push(...l),t.meta.tableTemplate={selection:!0,sort:!0,columns:a}}createFilterInMapExtentOrResolutionStrategy(){return new Jt({filterClauseFunc:o=>!0===o.state.inMapExtent&&!0===o.state.inMapResolution})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Le),e.LFG(ce),e.LFG(no),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),YT=(()=>{class i{constructor(t,o,n){this.dialogRef=t,this.languageService=o,this.data=n}cancelAction(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}confirmedAction(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.so),e.Y36(D),e.Y36(P.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-confirmation-popup-component"]],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2)(4,"button",3),e.NdJ("click",function(){return o.confirmedAction()}),e._uU(5,"Ok "),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return o.cancelAction()}),e._uU(7),e.qZA()()),2&t&&(e.xp6(2),e.Oqu(o.languageService.translate.instant("add"===o.data.type?"igo.geo.workspace.addConfirmation":"igo.geo.workspace.deleteConfirmation")),e.xp6(5),e.hij("",o.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[w.lW,P.xY,P.H8],styles:["div.mat-dialog-actions[_ngcontent-%COMP%]{justify-content:center}"]}),i})();class mp extends zs{constructor(r,t,o,n){super(r),this.options=r,this.editionWorkspaceService=t,this.dialog=o,this.configService=n,this.inResolutionRange$=new b.X(!0),this.olDrawingLayerSource=new zt.Z,this.geometryType=Oe,this.modifyStyle=new R.ZP({stroke:new U.Z({color:"rgba(255,255,255,1)",width:1}),fill:new N.Z({color:"rgba(0,161,222,1)"}),image:new Me.Z({radius:7,stroke:new U.Z({color:"rgba(255,255,255,1)",width:1}),fill:new N.Z({color:"rgba(0,161,222,1)"})})}),this.newFeaturefilterClauseFunc=s=>!0===s.state.newFeature,this.editFeaturefilterClauseFunc=s=>!0===s.state.edit,this.map.viewController.resolution$.subscribe(s=>{this.inResolutionRange$.next(s>this.layer.minResolution&&s<this.layer.maxResolution)}),this.drawControl=this.createDrawControl(),this.drawControl.setGeometryType(this.geometryType.Point),this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayer=new Te({id:"igo-draw-layer",title:"edition",zIndex:300,source:new Fe,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}})}get layer(){return this.options.layer}get map(){return this.options.map}getInResolutionRange(){return this.inResolutionRange$.value}deleteFeature(r,t){setTimeout(()=>{this.dialog.open(YT,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(n=>{if(!1===n){let s,a;const l=t.layer.dataSource.options.edition.baseUrl,c=t.layer.dataSource.options.edition.deleteUrl;a=l.length?this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+l+"?"+c:l+"?"+c:this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+c:c;for(const u of t.meta.tableTemplate.columns)for(const p in r.properties){let d=u.name;d.includes("properties.")&&(d=d.split(".")[1]),d===p&&!0===u.primary&&(s=r.properties[p])}a&&(a+=s,this.editionWorkspaceService.deleteFeature(t,a))}})},250)}editFeature(r,t){r.edition=!0;let o,n=!1;const s=t.layer.dataSource.options.edition;for(const a of t.meta.tableTemplate.columns)if(("list"===a.type||"autocomplete"===a.type)&&this.editionWorkspaceService.getDomainValues(a.relation).subscribe(l=>{a.domainValues=l}),!1===n)for(const l in r.properties){let c=a.name;if(c.includes("properties.")&&(c=c.split(".")[1]),c===l&&!0===a.primary){o=r.properties[l],n=!0;break}}o?(r.original_properties=JSON.parse(JSON.stringify(r.properties)),r.original_geometry=r.geometry,r.idkey=o,t.entityStore.state.updateAll({edit:!1}),t.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(r,t)):!r.newFeature&&s.geomType&&(r.newFeature=!0,this.editionWorkspaceService.adding$.next(!0),t.entityStore.state.updateAll({newFeature:!1}),t.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),s.addWithDraw?this.onGeometryTypeChange(s.geomType,r,t):(t.entityStore.insert(r),t.entityStore.state.update(r,{newFeature:!0},!0)))}createDrawControl(r,t,o){return new en({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new R.ZP({}),interactionStyle:Pa(r,t,o)})}onGeometryTypeChange(r,t,o){this.drawControl.setGeometryType(r),this.toggleDrawControl(t,o)}toggleDrawControl(r,t){this.deactivateDrawControl(),this.activateDrawControl(r,t)}deactivateDrawControl(){!this.drawControl||(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}activateDrawControl(r,t){this.drawEnd$$=this.drawControl.end$.subscribe(o=>{this.addFeatureToStore(r,t,o)}),this.drawControl.setOlMap(this.map.ol,!0)}addFeatureToStore(r,t,o){const n=this.map.ol.getView().getProjection();let s=r.geometry;o?(t.entityStore.insert(r),t.entityStore.state.update(r,{newFeature:!0},!0),s=(new be.Z).writeGeometryObject(o,{featureProjection:n,dataProjection:"EPSG:4326"}),r.geometry=s):t.entityStore.state.update(r,{edit:!0},!0),r.projection="EPSG:4326";const a=bt(r,n.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(a),this.map.addLayer(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(a,r,t)}deleteDrawings(){this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}createModifyInteraction(r,t,o){this.map.ol.removeInteraction(this.modify);const n=new T_.Z([r],{unique:!0});this.modify=new ca.Z({features:n}),this.map.ol.addInteraction(this.modify),n.forEach(s=>{s.setStyle(this.modifyStyle)}),this.modify.on("modifyend",s=>{var a;const l=null===(a=s.features.getArray()[0])||void 0===a?void 0:a.getGeometry();l&&this.addFeatureToStore(t,o,l)})}}let hp=(()=>{class i{constructor(t,o,n,s,a,l,c,u){this.layerService=t,this.storageService=o,this.configService=n,this.messageService=s,this.http=a,this.dialog=l,this.styleService=c,this.authInterceptor=u,this.ws$=new b.X(void 0),this.adding$=new b.X(!1),this.relationLayers$=new b.X(void 0),this.rowsInMapExtentCheckCondition$=new b.X(!0),this.loading=!1,this.wktFormat=new Fn.Z,this.geoJsonFormat=new be.Z}get zoomAuto(){return this.storageService.get("zoomAuto")}createWorkspace(t,o){var n,s,a,l,c,u,p,d,g,h,m,y;if(!0!==(null===(n=t.options.workspace)||void 0===n?void 0:n.enabled)||!0!==t.dataSource.options.edition.enabled)return;let v;v=t.options.workspace?t.options.workspace:{},v.srcId=t.id,v.workspaceId=t.id,v.enabled=!0,v.pageSize=null===(s=t.options.workspace)||void 0===s?void 0:s.pageSize,v.pageSizeOptions=null===(a=t.options.workspace)||void 0===a?void 0:a.pageSizeOptions;const S=t.dataSource,M=t.id+".WmsWorkspaceTableSrc",A=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:M,links:[]});const F={syncedDelete:!0,linkedIds:[A],properties:[Be.ZINDEX,Be.VISIBLE]};null!==(l=t.options.workspace)&&void 0!==l&&l.minResolution||F.properties.push(Be.MINRESOLUTION);let k=!1;!(null===(c=S.options.ogcFilters)||void 0===c)&&c.enabled&&(F.properties.push(Be.OGCFILTERS),k=!0),null!==(u=t.options.workspace)&&void 0!==u&&u.maxResolution||F.properties.push(Be.MAXRESOLUTION);let se,ne=[];return t.options.linkedLayers.links&&(ne=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),ne.push(F),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:M,t.options.linkedLayers.links=ne,this.layerService.createAsyncLayer({id:A,linkedLayers:{linkId:A},workspace:{srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:null===(d=null===(p=t.options.workspace)||void 0===p?void 0:p.queryOptions)||void 0===d?void 0:d.mapQueryOnOpenTab,tabQuery:!1},pageSize:null===(g=t.options.workspace)||void 0===g?void 0:g.pageSize,pageSizeOptions:null===(h=t.options.workspace)||void 0===h?void 0:h.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:(null===(m=t.options.workspace)||void 0===m?void 0:m.minResolution)||t.minResolution||0,maxResolution:(null===(y=t.options.workspace)||void 0===y?void 0:y.maxResolution)||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:S.options.download,type:"wfs",url:S.options.urlWfs||S.options.url,queryable:!0,relations:S.options.relations,queryTitle:S.options.queryTitle,params:S.options.paramsWFS,ogcFilters:Object.assign({},S.ogcFilters,{enabled:k}),sourceFields:S.options.sourceFields||void 0,edition:S.options.edition}}).subscribe(z=>(o.addLayer(z),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:ne}},!1),z.dataSource.ol.refresh(),se=new mp({id:t.id,title:t.title,layer:z,map:o,entityStore:this.createFeatureStore(z,o),actionStore:new Eo([]),meta:{tableTemplate:void 0}},this,this.dialog,this.configService),this.createTableTemplate(se,z),z.options.workspace.workspaceId=z.id,t.options.workspace=Object.assign({},t.options.workspace,{wksConfig:v}),delete S.options.download,se)),se}createFeatureStore(t,o){const n=new Ct([],{map:o});n.bindLayer(t);const s=new Pr({}),a=new Hi({}),l=new kr({}),c=new To({}),u=new Mt({layer:new Te({zIndex:300,source:new Fe,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return n.addStrategy(s,!0),n.addStrategy(a,!0),n.addStrategy(l,!0),n.addStrategy(u,!0),n.addStrategy(c,!1),n.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),n}createTableTemplate(t,o){const n=o.dataSource.options.sourceFields||[],s=o.dataSource.options.relations||[];let a=je.UnsanitizedHTML,l=[],c=[],u=[];l=[{name:"edition",title:void 0,renderer:je.ButtonGroup,primary:!1,valueAccessor:()=>[{editMode:!1,icon:"pencil",color:"primary",disabled:!1===o.dataSource.options.edition.modifyButton,click:p=>{t.editFeature(p,t)}},{editMode:!1,icon:"delete",color:"warn",disabled:!1===o.dataSource.options.edition.deleteButton,click:p=>{t.deleteFeature(p,t)}},{editMode:!0,icon:"check",color:"primary",disabled:this.loading,click:p=>{this.saveFeature(p,t)}},{editMode:!0,icon:"alpha-x",color:"primary",disabled:this.loading,click:p=>{this.cancelEdit(t,p)}}]}],0!==n.length?(c=n.map(p=>{let d={name:`properties.${p.name}`,title:p.alias?p.alias:p.name,renderer:a,valueAccessor:void 0,cellClassFunc:()=>{const g={};if(p.type)return g[`class_${p.type}`]=!0,g},primary:!0===p.primary,visible:p.visible,validation:p.validation,linkColumnForce:p.linkColumnForce,type:p.type,domainValues:void 0,relation:void 0,multiple:p.multiple,step:p.step,tooltip:p.tooltip};return("list"===p.type||"autocomplete"===p.type)&&this.getDomainValues(p.relation).subscribe(g=>{d.domainValues=g,d.relation=p.relation}),d}),u=s.map(p=>({name:`properties.${p.name}`,title:p.alias?p.alias:p.name,renderer:je.Icon,icon:p.icon,parent:p.parent,type:"relation",tooltip:p.tooltip,onClick:()=>{!1===this.adding$.getValue()&&this.ws$.next(p.title)},cellClassFunc:()=>({class_icon:!0})})),c.push(...u),c.push(...l),t.meta.tableTemplate={selection:!1,sort:!0,columns:c}):t.entityStore.entities$.pipe((0,At.n)(p=>0===p.length),(0,Ee.q)(1)).subscribe(p=>{const d=p[0].ol,g=d.getKeys().filter(h=>!h.startsWith("_")&&"geometry"!==h&&h!==d.getGeometryName()&&!h.match(/boundedby/gi)).map(h=>({name:`properties.${h}`,title:h,renderer:a}));t.meta.tableTemplate={selection:!1,sort:!0,columns:g}})}createFilterInMapExtentOrResolutionStrategy(){return new Jt({filterClauseFunc:o=>!0===o.state.inMapExtent&&!0===o.state.inMapResolution})}saveFeature(t,o){if(!this.validateFeature(t,o))return!1;this.sanitizeParameter(t,o);const n=o.layer.dataSource.options.edition.baseUrl;let s=this.configService.getConfig("edition.url");if(s?s+=n||"":s=n,t.newFeature){s+=o.layer.dataSource.options.edition.addUrl;const l=new q.WM(o.layer.dataSource.options.edition.addHeaders);this.addFeature(t,o,s,l)}else{s+="post"!==o.layer.dataSource.options.edition.modifyProtocol?"?"+o.layer.dataSource.options.edition.modifyUrl+t.idkey:o.layer.dataSource.options.edition.modifyUrl;const a=o.layer.dataSource.options.edition.modifyProtocol,c=new q.WM(o.layer.dataSource.options.edition.modifyHeaders);this.modifyFeature(t,o,s,c,a)}}addFeature(t,o,n,s){var a,l;if(o.layer.dataSource.options.edition.hasGeometry){const c=o.layer.options.sourceOptions.edition.geomDatabaseProj;t.properties[o.layer.dataSource.options.params.fieldNameGeometry]="SRID="+c.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",c),{dataProjection:c})}for(const c in t.properties)for(const u of o.layer.dataSource.options.sourceFields)(u.name===c&&(null===(a=u.validation)||void 0===a?void 0:a.readonly)||u.name===c&&!1===(null===(l=u.validation)||void 0===l?void 0:l.send))&&delete t.properties[c];this.loading=!0,this.http.post(`${n}`,t.properties,{headers:s}).subscribe(()=>{this.loading=!1,o.entityStore.stateView.clear(),o.deleteDrawings(),o.entityStore.delete(t),this.messageService.success("igo.geo.workspace.addSuccess"),this.refreshMap(o.layer,o.layer.map),this.adding$.next(!1),this.rowsInMapExtentCheckCondition$.next(!0)},c=>{this.loading=!1,c.error.caught=!0;const u=o.layer.dataSource.options.edition.messages;if(u){let p;u.forEach(d=>{const g=Object.keys(d)[0];c.error.message.includes(g)&&(p=d[g],this.messageService.error(p))}),p||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}deleteFeature(t,o){this.loading=!0,this.http.delete(`${o}`,{}).subscribe(()=>{this.loading=!1,this.messageService.success("igo.geo.workspace.deleteSuccess"),this.refreshMap(t.layer,t.layer.map);for(const n of t.layer.options.sourceOptions.relations)t.map.layers.forEach(s=>{s.title===n.title&&s.dataSource.ol.refresh()})},n=>{this.loading=!1,n.error.caught=!0;const s=t.layer.dataSource.options.edition.messages;if(s){let a;s.forEach(l=>{const c=Object.keys(l)[0];n.error.message.includes(c)&&(a=l[c],this.messageService.error(a))}),a||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}modifyFeature(t,o,n,s,a="patch"){var l,c;if(o.layer.dataSource.options.edition.hasGeometry){const u=o.layer.options.sourceOptions.edition.geomDatabaseProj;t.geometry.coordinates=fp(t.geometry.coordinates),t.properties[o.layer.dataSource.options.params.fieldNameGeometry]="SRID="+u.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",u),{dataProjection:u})}for(const u in t.properties)for(const p of o.layer.dataSource.options.sourceFields)(p.name===u&&(null===(l=p.validation)||void 0===l?void 0:l.readonly)||p.name===u&&!1===(null===(c=p.validation)||void 0===c?void 0:c.send)||"boundedBy"===u)&&delete t.properties[u];this.loading=!0,this.http[a](`${n}`,t.properties,{headers:s}).subscribe(()=>{this.loading=!1,this.cancelEdit(o,t,!0),this.messageService.success("igo.geo.workspace.modifySuccess"),this.refreshMap(o.layer,o.layer.map);let u=[];for(const p of o.layer.options.sourceOptions.relations)o.map.layers.forEach(d=>{d.title===p.title&&(u.push(d),d.dataSource.ol.refresh())});this.relationLayers$.next(u)},u=>{this.loading=!1,u.error.caught=!0;const p=o.layer.dataSource.options.edition.messages;if(p){let d;p.forEach(g=>{const h=Object.keys(g)[0];u.error.message.includes(h)&&(d=g[h],this.messageService.error(d))}),d||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}cancelEdit(t,o,n=!1){o.edition=!1,this.adding$.next(!1),t.deleteDrawings(),t.entityStore.stateView.clear(),o.newFeature?(t.entityStore.delete(o),t.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(n||(o.properties=o.original_properties,o.geometry=o.original_geometry),delete o.original_properties,delete o.original_geometry)}getDomainValues(t){let o=t.url;return o||(o=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+t.table:t.table),this.http.get(o).pipe((0,Z.U)(n=>n),(0,he.K)(n=>(n.error.caught=!0,(0,dn._)(n))))}refreshMap(t,o){var n,s;const a=t.dataSource.ol;a.setLoader((c,u,p,d,g)=>{t.customWFSLoader(t.ol.getSource(),t.options.sourceOptions,this.authInterceptor,c,u,p,d,g,!0)}),a.refresh();for(const c of o.layers)if(c.id!==t.id&&(null===(n=c.options.linkedLayers)||void 0===n?void 0:n.linkId.includes(t.id.substr(0,t.id.indexOf(".")-1)))&&(null===(s=c.options.linkedLayers)||void 0===s?void 0:s.linkId.includes("WmsWorkspaceTableSrc"))){const u=c.dataSource.ol;let p=u.getParams();p._t=(new Date).getTime(),u.updateParams(p)}}validateFeature(t,o){let s,a=!0;return o.meta.tableTemplate.columns.forEach(l=>{l.hasOwnProperty("validation")&&l.validation&&(s=cs(l.name),Object.keys(l.validation).forEach(c=>{switch(c){case"mandatory":l.validation[c]&&(!t.properties.hasOwnProperty(s)||!t.properties[s])&&(a=!1,this.messageService.error("igo.geo.formValidation.mandatory",void 0,void 0,{column:l.title}));break;case"minValue":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s]<l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.minValue",void 0,void 0,{column:l.title,value:l.validation[c]}));break;case"maxValue":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s]>l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.maxValue",void 0,void 0,{column:l.title,value:l.validation[c]}));break;case"minLength":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s].length<l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.minLength",void 0,void 0,{column:l.title,value:l.validation[c]}));break;case"maxLength":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s].length>l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.maxLength",void 0,void 0,{column:l.title,value:l.validation[c]}))}}))}),a}sanitizeParameter(t,o){o.meta.tableTemplate.columns.forEach(n=>{"list"===n.type&&t.properties[cs(n.name)]&&(t.properties[cs(n.name)]=t.properties[cs(n.name)].toString())})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Le),e.LFG(ce),e.LFG(J),e.LFG(_e),e.LFG(q.eN),e.LFG(P.uw),e.LFG(no),e.LFG(Sr))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function cs(i){return i.includes("properties.")?i.split(".")[1]:i}function fp(i){return 0===i.length?i:"number"==typeof i[0]?i.slice(0,2):i.map(fp)}class ll extends zs{constructor(r){super(r),this.options=r,this.inResolutionRange$=new b.X(!0),this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}get layer(){return this.options.layer}get map(){return this.options.map}getLayerWksOptionTabQuery(){var r;return void 0===(null===(r=this.layer.options.workspace.queryOptions)||void 0===r?void 0:r.tabQuery)||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){var r;return void 0===(null===(r=this.layer.options.workspace.queryOptions)||void 0===r?void 0:r.mapQueryOnOpenTab)||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}let _p=(()=>{class i{constructor(t,o){this.storageService=t,this.configService=o,this.ws$=new b.X(void 0)}get zoomAuto(){return this.storageService.get("zoomAuto")}createWorkspace(t,o){var n;if(!1===(null===(n=t.options.workspace)||void 0===n?void 0:n.enabled)||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const s=new ll({id:t.id,title:t.title,layer:t,map:o,entityStore:this.createFeatureStore(t,o),actionStore:new Eo([]),meta:{tableTemplate:void 0}});return this.createTableTemplate(s,t),s}createFeatureStore(t,o){var n;const s=new Ct([],{map:o});s.bindLayer(t);const a=new Pr({}),l=new ey({percentDistinctValueRatio:2,sourceFields:t.dataSource.options.sourceFields}),c=new Hi({}),u=new kr({}),p=new To({}),d=this.configService.getConfig("queryOverlayStyle"),g=new Mt({layer:new Te({zIndex:300,source:new Fe,style:h=>Vo(Object.assign({},{feature:h},d.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return!(null===(n=t.options.workspace)||void 0===n)&&n.searchIndexEnabled&&s.addStrategy(l,!0),s.addStrategy(a,!0),s.addStrategy(c,!0),s.addStrategy(u,!0),s.addStrategy(g,!0),s.addStrategy(p,!1),s.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),s}createTableTemplate(t,o){const n=o.dataSource.options.sourceFields||[],s=o.dataSource.options.relations||[];if(0===n.length)return void t.entityStore.entities$.pipe((0,At.n)(c=>0===c.length),(0,Ee.q)(1)).subscribe(c=>{const u=c[0].ol,p=u.getKeys().filter(d=>!d.startsWith("_")&&"geometry"!==d&&d!==u.getGeometryName()&&!d.match(/boundedby/gi)).map(d=>({name:`properties.${d}`,title:d,renderer:je.UnsanitizedHTML}));t.meta.tableTemplate={selection:!0,sort:!0,columns:p}});const a=n.map(c=>({name:`properties.${c.name}`,title:c.alias?c.alias:c.name,renderer:je.UnsanitizedHTML,tooltip:c.tooltip})),l=s.map(c=>({name:`properties.${c.name}`,title:c.alias?c.alias:c.name,renderer:je.Icon,icon:c.icon,parent:c.parent,type:"relation",tooltip:c.tooltip,onClick:()=>{this.ws$.next(c.title)},cellClassFunc:()=>({class_icon:!0})}));a.push(...l),t.meta.tableTemplate={selection:!0,sort:!0,columns:a}}createFilterInMapExtentOrResolutionStrategy(){return new Jt({filterClauseFunc:o=>!0===o.state.inMapExtent&&!0===o.state.inMapResolution})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ce),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),HT=(()=>{class i{constructor(t,o,n,s,a){this.component=t,this.wfsWorkspaceService=o,this.wmsWorkspaceService=n,this.editionWorkspaceService=s,this.featureWorkspaceService=a,this.entities$$=[],this.changeWorkspace=new e.vpe,this.disableSwitch=new e.vpe,this.relationLayers=new e.vpe,this.rowsInMapExtentCheckCondition=new e.vpe}get workspaceStore(){return this.component.store}ngOnInit(){this.layers$$=this.map.layers$.pipe((0,fe.b)(50)).subscribe(t=>this.onLayersChange(t)),this.featureWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wmsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wfsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.adding$.subscribe(t=>{this.disableSwitch.emit(t)}),this.editionWorkspaceService.relationLayers$.subscribe(t=>{this.relationLayers.emit(t)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(t=>{this.rowsInMapExtentCheckCondition.emit(t)})}ngOnDestroy(){this.layers$$.unsubscribe(),this.entities$$.map(t=>t.unsubscribe())}onLayersChange(t){const o=t.filter(l=>this.layerIsEditable(l)),n=o.map(l=>l.id),s=o.map(l=>this.getOrCreateWorkspace(l)).filter(l=>void 0!==l),a=this.workspaceStore.all().filter(l=>n.indexOf(l.id)<0);a.length>0&&(a.forEach(l=>{l.entityStore.deactivateStrategyOfType(Hi),l.deactivate()}),this.workspaceStore.state.updateMany(a,{active:!1,selected:!1}),this.workspaceStore.deleteMany(a)),s.length>0&&this.workspaceStore.insertMany(s)}getOrCreateWorkspace(t){var o,n,s,a;if(void 0===this.workspaceStore.get(t.id)){if(t.dataSource instanceof ji&&!0!==(null===(o=t.dataSource.options.edition)||void 0===o?void 0:o.enabled))return this.wfsWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Bt&&!0!==(null===(n=t.dataSource.options.edition)||void 0===n?void 0:n.enabled)){if(!t.dataSource.options.paramsWFS)return;const c=this.wmsWorkspaceService.createWorkspace(t,this.map);return null==c||c.inResolutionRange$.subscribe(u=>{t.dataSource.options.queryable=!u,c.layer.dataSource.options.queryable=u}),c}if(t.dataSource instanceof Fe&&!0===t.exportable&&!0!==(null===(s=t.dataSource.options.edition)||void 0===s?void 0:s.enabled))return this.featureWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Bt&&!0===(null===(a=t.dataSource.options.edition)||void 0===a?void 0:a.enabled))return this.editionWorkspaceService.createWorkspace(t,this.map)}}layerIsEditable(t){var o,n;const s=t.dataSource;return s instanceof ji||s instanceof Fe||s instanceof Bt&&((null===(o=(s.options||{}).ogcFilters)||void 0===o?void 0:o.enabled)||void 0!==(null===(n=s.options.paramsWFS)||void 0===n?void 0:n.featureTypes))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Vl),e.Y36(dp),e.Y36(gp),e.Y36(hp),e.Y36(_p))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"}}),i})(),yp=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez]}),i})(),vp=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez]}),i})(),VT=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,w.ot,P.Is,Re.vV]}),i})(),bp=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:rl,useFactory:QT,deps:[Vs]}],imports:[f.ez,oe,Hl,yp,vp,pp,P.Is,yp,vp,pp,VT]}),i})(),Cp=new e.OlP("styleListOptions");function xp(i){return{provide:Cp,useValue:i}}function WT(i,r){return()=>i.load(r)}let Sp=(()=>{class i{static forRoot(){return{ngModule:i,providers:[xp({}),{provide:e.ip1,useFactory:WT,multi:!0,deps:[Xr,Cp]}]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})(),us=(()=>{class i{static forRoot(){return{ngModule:i,providers:[no,$a]}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Ln.e4,f.ez,_.u5,oe,I.lN,T.Ps,w.ot,H.c,ue.LD,O.AV,_.UX,Sp.forRoot(),Sp]}),i})();class wp extends it{constructor(){super(...arguments),this.storeInitialized$=new b.X(!1)}clearStops(){this.storeInitialized$.next(!1),this.clear()}}class Tp extends Ct{}class Mp extends Ct{}class Fp extends Ct{}let o2=(()=>{class i extends Va{constructor(t,o){super(),this.http=t,this.config=o,this.directionsUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/",this.options=this.config.getConfig("directionsSources.osrm")||{},this.directionsUrl=this.options.url||this.directionsUrl}get enabled(){return!1!==this.options.enabled}set enabled(t){this.options.enabled=t}getName(){return i._name}route(t,o={}){const n=this.getRouteParams(o);return this.http.get(this.directionsUrl+t.join(";"),{params:n}).pipe((0,Z.U)(s=>this.extractRoutesData(s)))}extractRoutesData(t){const o=[];return t.routes.forEach(n=>{o.push(this.formatRoute(n,t.waypoints))}),o}getRouteParams(t={}){return t.alternatives=void 0===t.alternatives||t.alternatives,t.steps=void 0===t.steps||t.steps,t.geometries=void 0!==t.geometries?t.geometries:"geojson",t.overview=void 0!==t.overview&&t.overview,t.continue_straight=void 0!==t.continue_straight&&t.continue_straight,new q.LE({fromObject:{alternatives:t.alternatives?"true":"false",overview:t.overview?"simplified":"full",steps:t.steps?"true":"false",geometries:t.geometries?t.geometries:"geojson",continue_straight:t.continue_straight?"true":"false"}})}formatRoute(t,o){const n=[];return t.legs.forEach(s=>{s.steps.forEach(a=>{n.push(a)})}),{id:Ze(),title:t.legs[0].summary,source:i._name,sourceType:is.Route,order:1,format:os.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:o,distance:t.distance,duration:t.duration,geometry:t.geometry,legs:t.legs,steps:n,weight:t.weight,weight_name:t.weight_name}}}return i._name="OSRM Qu\xe9bec",i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"route",null),i})();function n2(i,r){return new o2(i,r)}let Ap=(()=>{class i extends _t{constructor(t,o,n){super(o,n),this.http=t}getId(){return i.id}getType(){return i.type}getDefaultOptions(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}search(t,o){const n=this.computeSearchRequestParams(t,o||{});return n.get("q")?this.http.get(this.searchUrl,{params:n}).pipe((0,Z.U)(s=>this.extractResults(s,t))):(0,X.of)([])}computeSearchRequestParams(t,o){return new q.LE({fromObject:Object.assign({q:this.computeTerm(t),format:"json"},this.params,o.params||{})})}extractResults(t,o){return t.map(n=>this.dataToResult(n,o))}dataToResult(t,o){const n=this.computeProperties(t),s=this.computeGeometry(t),a=this.computeExtent(t),l=[this.getId(),"place",t.place_id].join(".");return{source:this,meta:{dataType:le,id:l,title:t.display_name,icon:"map-marker",score:nn(o.trim(),t.display_name)},data:{type:le,projection:"EPSG:4326",geometry:s,extent:a,properties:n,meta:{id:l,title:t.display_name}}}}computeProperties(t){return{display_name:t.display_name,place_id:t.place_id,osm_type:t.osm_type,class:t.class,type:t.type}}computeGeometry(t){return{type:"Point",coordinates:[parseFloat(t.lon),parseFloat(t.lat)]}}computeExtent(t){return[parseFloat(t.boundingbox[2]),parseFloat(t.boundingbox[0]),parseFloat(t.boundingbox[3]),parseFloat(t.boundingbox[1])]}computeTerm(t){return this.computeTermTags(t)}computeTermTags(t){const o=super.getHashtagsValid(t,"amenity");return o?o.length?(t=t.replace(/(#[^\s]*)/g,""),o.forEach(n=>{t+="+["+n+"]"}),t):null:this.computeTermSettings(t)}computeTermSettings(t){return this.options.settings.forEach(o=>{"amenity"===o.name&&o.values.forEach(n=>{n.enabled&&"string"==typeof n.value&&n.value.split(",").forEach(a=>{t+="+["+a+"]"})})}),t}}return i.id="nominatim",i.type=le,i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG("options"),e.LFG(ce))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"search",null),i})();function s2(i,r,t){return new Ap(i,r.getConfig(`searchSources.${Ap.id}`),t)}let Lp=(()=>{class i extends _t{constructor(t,o,n,s){if(super(s,n),this.http=t,this.languageService=o,this.storedQueriesOptions=s,this.storedQueriesOptions&&!this.storedQueriesOptions.available)return;const p="title";if(this.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),this.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:p},this.resultTitle=p,console.log("Default values",this.storedQueriesOptions)),!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&this.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){let g="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw g+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(g)}this.storedQueriesOptions.fields instanceof Array||(this.storedQueriesOptions.fields=[this.storedQueriesOptions.fields]),this.multipleFieldsQuery=this.storedQueriesOptions.fields.length>1,this.storedQueriesOptions.fields.forEach((g,h)=>{if(this.multipleFieldsQuery&&!g.splitPrefix&&0!==h)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!g.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}getId(){return i.id}getType(){return i.type}getDefaultOptions(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}search(t,o){const n=this.termSplitter(t,this.storedQueriesOptions.fields),s=this.computeRequestParams(o||{},n);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=o.page?String(o.page):"1",new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:s,responseType:"text"}).pipe((0,Z.U)(a=>{let l=this.extractResults(this.extractWFSData(a),t);if(l.sort((c,u)=>c.meta.score>u.meta.score||c.meta.score===u.meta.score&&c.meta.titleHtml<u.meta.titleHtml?1:-1),l.reverse(),l.length>Number(this.options.params.limit)){const c=Number(this.options.params.limit)*Number(this.options.params.page),u=l.length;l=l.slice(0,c),l[l.length-1].meta.nextPage=c<u}return l})):this.http.get(this.searchUrl,{params:s}).pipe((0,Z.U)(a=>this.extractResults(this.extractWFSData(a),t)))}getFormatFromOptions(){let t;const o=this.storedQueriesOptions.outputformat,n=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(o)&&(t=be.Z),n.test(o)&&(t=pi.Z),new t}extractWFSData(t){const o=this.getFormatFromOptions(),n=be.Z,s=o.readFeatures(t);return JSON.parse((new n).writeFeatures(s))}termSplitter(t,o){const n={};let s=t,a=0;return o.forEach(c=>{n[c.name]=c.defaultValue;const u=new RegExp(c.splitPrefix+"(.+)","i");u.test(s)&&(a=c.splitPrefix?a+=1:a,s=s.split(u)[1])}),0===a?(n[o[0].name]=t,n):(s=t,[...o].reverse().forEach(c=>{const u=new RegExp(c.splitPrefix||"(.+)","i");if(s||""!==s){const p=s.split(u);s=p[0],p[1]&&(n[c.name]=p[1].trim())}}),n)}computeRequestParams(t,o){const n=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new q.LE({fromObject:Object.assign({service:"wfs",version:n,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},o,this.params,t.params||{})})}extractResults(t,o){return t.features.map(n=>this.dataToResult(n,o))}dataToResult(t,o){const n=this.computeProperties(t),s=[this.getId(),n.type,t.id].join("."),a=t.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:le,projection:"EPSG:4326",geometry:t.geometry,properties:n,meta:{id:s,title:t.properties[a]}},meta:{dataType:le,id:s,title:t.properties.title,titleHtml:t.properties[a],icon:"map-marker",score:nn(o.trim(),t.properties.title?t.properties.title:t.properties[a])}}}computeProperties(t){return Object.assign({},B.removeKeys(t.properties,i.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}}return i.id="storedqueries",i.type=le,i.propertiesBlacklist=["boundedBy","id","coord_x","coord_y"],i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(D),e.LFG(ce),e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"search",null),i})(),Ip=(()=>{class i extends _t{constructor(t,o,n,s){if(super(s,n),this.http=t,this.languageService=o,this.storedQueriesOptions=s,this.storedQueriesOptions&&(!this.storedQueriesOptions||this.storedQueriesOptions.available)){if(!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!this.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return i.id}getType(){return i.type}getDefaultOptions(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}reverseSearch(t,o){const n=this.computeRequestParams(t,o||{});return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:n,responseType:"text"}).pipe((0,Z.U)(s=>this.extractResults(this.extractWFSData(s)))):this.http.get(this.searchUrl,{params:n}).pipe((0,Z.U)(s=>this.extractResults(this.extractWFSData(s))))}getFormatFromOptions(){let t;const o=this.storedQueriesOptions.outputformat,n=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(o)&&(t=be.Z),n.test(o)&&(t=pi.Z),new t}extractWFSData(t){const o=this.getFormatFromOptions(),n=be.Z,s=o.readFeatures(t);return JSON.parse((new n).writeFeatures(s))}computeRequestParams(t,o){const n={};return n[this.storedQueriesOptions.longField]=t[0],n[this.storedQueriesOptions.latField]=t[1],new q.LE({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},n,this.params,o.params||{})})}extractResults(t){return t.features.map(o=>this.dataToResult(o))}dataToResult(t){const o=this.computeProperties(t),n=[this.getId(),o.type,t.id].join("."),s=t.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:le,projection:"EPSG:4326",geometry:t.geometry,properties:o,meta:{id:n,title:t.properties[s]}},meta:{dataType:le,id:n,title:t.properties[s],icon:"map-marker"}}}computeProperties(t){const o=B.removeKeys(t.properties,i.propertiesBlacklist),n={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(o,{type:t.properties.doc_type},n)}}return i.id="storedqueriesreverse",i.type=le,i.propertiesBlacklist=[],i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(D),e.LFG(ce),e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,j.gn)([(0,Ot.q)({maxCacheCount:20})],i.prototype,"reverseSearch",null),i})();function l2(i,r,t,o){return new Lp(i,r,t,o.getConfig(`searchSources.${Lp.id}`))}function u2(i,r,t,o){return new Ip(i,r,t,o.getConfig(`searchSources.${Ip.id}`))}let Op=(()=>{class i extends _t{constructor(t,o,n){super(n,o),this.languageService=t,this.title$=new b.X(""),this.languageService.translate.get(this.options.title).subscribe(s=>this.title$.next(s))}get title(){return this.title$.getValue()}getId(){return i.id}getType(){return i.type}getDefaultOptions(){return{title:"igo.geo.search.workspace.name",searchUrl:void 0,settings:[{type:"checkbox",title:"datasets",name:"datasets",values:[]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]}]}}search(t,o){const s=this.settings.find(d=>"limit"===d.name).values.find(d=>d.enabled).value||5;this.options.params.limit=s.toLocaleString();const a=[];this.options.params.page=(o.page||1).toLocaleString();const l=o.page||1,c=this.options.params.datasets.split(",");this.featureStoresWithIndex.filter(d=>d.searchDocument&&c.includes(d.layer.title)).map(d=>{const g=t;d.searchDocument.search(g,{limit:l*s}).map(h=>{const y=h.field;h.result.map(v=>{const S=d.index.get(v),M=nn(g.trim(),S.properties[y]);a.push({index:v,feature:S,layer:d.layer,field:y,score:M})})})}),a.sort((d,g)=>d.score>g.score?-1:1);const u=[],p=[];return a.map(d=>{u.includes(d.index)||(u.push(d.index),p.push(d))}),(0,X.of)(this.extractResults(p.sort((d,g)=>d.score>g.score?-1:1).slice(0,l*s)))}extractResults(t){return t.map(o=>this.dataToResult(o,t.length))}dataToResult(t,o){const n=this.computeProperties(t),s=[this.getId(),n.type,t.index].join("."),a=t.feature.properties[t.field],l="<br><small> "+t.layer.title+"</small>";return{source:this,data:{type:le,projection:"EPSG:4326",geometry:t.feature.geometry,extent:t.feature.extent,properties:n,meta:{id:s,title:t.feature.properties[t.field],alias:this.getAllowedFieldsAndAlias(t.layer)}},meta:{dataType:le,id:s,title:t.feature.meta.title,titleHtml:a+l,icon:"map-marker",score:t.score,nextPage:o%+this.options.params.limit==0&&+this.options.params.page<10}}}getAllowedFieldsAndAlias(t){var o,n,s;let a;return(null===(s=null===(n=null===(o=t.options)||void 0===o?void 0:o.source)||void 0===n?void 0:n.options)||void 0===s?void 0:s.sourceFields)&&t.options.source.options.sourceFields.length>=1&&(a={},t.options.source.options.sourceFields.forEach(l=>{a[l.name]=l.alias?l.alias:l.name})),a}computeProperties(t){if(!t.feature.geometry)return Object.assign({type:t.layer.title+"."+t.field},t.feature.properties);const o={GoogleMaps:""};let n;if("Point"===t.feature.geometry.type)n=It.getGoogleMapsCoordLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]);else{const a=(0,Ar.Z)(t.feature.geometry);n=It.getGoogleMapsCoordLink(a.geometry.coordinates[0],a.geometry.coordinates[1])}o.GoogleMaps="<a href="+n+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a>","Point"===t.feature.geometry.type&&(o.GoogleStreetView=It.getGoogleStreetViewLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]));const s={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:t.feature.sourceId},t.feature.properties,o,s)}}return i.id="workspace",i.type=le,i.\u0275fac=function(t){return new(t||i)(e.LFG(D),e.LFG(ce),e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();function d2(i,r,t){return new Op(i,r,t.getConfig(`searchSources.${Op.id}`))}function cl(i){return i.entityStore.getStrategyOfType(Jt).active$.pipe((0,Z.U)(r=>r?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"))}function ul(i){return i.entityStore.stateView.manyBy$(r=>!0===r.state.selected).pipe((0,Z.U)(r=>r.length>=1))}function m2(i,r){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.pointerCoord)}}const f2=te.Bz.forChild([{path:"simple-map",component:(()=>{class i{constructor(t,o,n,s){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.mediaService=s,this.pointerCoordDelay=0,this.map=new ot({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:6,rotation:.75},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:a}))})}get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}onPointerMove(t){this.pointerCoord=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le),e.Y36(gt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-simple-map"]],decls:21,vars:10,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/simple-map"],["igoPointerPosition","",3,"map","view","pointerPositionDelay","pointerPositionCoord"],[3,"infoContent"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[4,"ngIf"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e.NdJ("pointerPositionCoord",function(s){return o.onPointerMove(s)}),e._UZ(14,"igo-info-section",2)(15,"igo-zoom-button",3)(16,"igo-geolocate-button",3)(17,"igo-home-extent-button",3)(18,"igo-rotation-button",4)(19,"igo-wake-lock-button"),e.qZA()(),e.YNc(20,m2,2,1,"p",5)),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view)("pointerPositionDelay",o.pointerCoordDelay),e.xp6(1),e.Q6J("infoContent",o.pointerCoord),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map)("showIfNoRotation",!0),e.xp6(2),e.Q6J("ngIf",!o.isTouchScreen))},dependencies:[f.O5,x.a8,x.dn,x.n5,x.$j,Ae,pt,Jn,Rn,Bn,$y,Cy,hy],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:350px}"]}),i})()}]);let _2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,f2,x.QW,w.ot,st]}),i})();function y2(i,r){if(1&i&&e._UZ(0,"igo-metadata-button",6)(1,"igo-download-button",6)(2,"igo-ogc-filter-button",7)(3,"igo-time-filter-button",7)(4,"igo-track-feature-button",8),2&i){const t=r.layer;e.Q6J("layer",t),e.xp6(1),e.Q6J("layer",t),e.xp6(1),e.Q6J("header",!0)("layer",t),e.xp6(1),e.Q6J("header",!0)("layer",t),e.xp6(1),e.Q6J("layer",t)("trackFeature",!0)}}const b2=te.Bz.forChild([{path:"layer",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],maxLayerZoomExtent:[-11e6,45e5,-45e5,1e7],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!0,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"}}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS ",visible:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson_utf8",srsName:"EPSG:32198",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!0,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"12072"}},formatOptions:{dataProjection:"EPSG:32198"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (Custom EPSG)",visible:!0,source:c,removable:!1}))}),this.layerService.createAsyncLayer({sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"parc_routier",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"lieu habit\xe9",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"sh_dis_eco",visible:!1,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"nurc:Arc_Sample_Parent",visible:!1,legendOptions:{display:!0,stylesAvailable:[{name:"rain",title:"Pluie"},{name:"raster",title:"D\xe9faut"}]},sourceOptions:{type:"wms",url:"https://demo.geo-solutions.it/geoserver/ows",optionsFromCapabilities:!0,params:{LAYERS:"nurc:Arc_Sample",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"Avertissements routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle",source:c,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-layer"]],decls:19,vars:7,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer"],[3,"map","view"],["color","primary",3,"map"],["title","Layers"],["floatLabel","never",3,"map","layers","expandLegendOfVisibleLayers","queryBadge"],["igoLayerItemToolbar",""],[3,"layer"],[3,"header","layer"],[3,"layer","trackFeature"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3)(16,"igo-layer-list",4),e.YNc(17,y2,5,8,"ng-template",null,5,e.W1O),e.qZA()()()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(2),e.Q6J("map",o.map)("layers",o.map.layers)("expandLegendOfVisibleLayers",!1)("queryBadge",!0))},dependencies:[x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,yi,Ur,Hn,zn,Gi,hb],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let C2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[b2,x.QW,w.ot,T.Ps,Tt,st,vi,Lo,fi,Nr]}),i})();const S2=te.Bz.forChild([{path:"legend",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:l}))}),this.layerService.createAsyncLayer({title:"legend with display:false",visible:!0,legendOptions:{display:!1,html:"test html"},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"legend in html",visible:!0,legendOptions:{display:!0,html:'<h2 style="background-color: blue;">HTML l\xe9gende</h2>'},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!1,params:{LAYERS:"sh_sreg_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"legend with url param",visible:!0,legendOptions:{url:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEhUQEBISFRUVFRAQFRUQFRUVFRAPFRUWFhUVFRUYHSggGBolGxUVITEiJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGy0dHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAACAQMEBQYAB//EADwQAAIBAwEGAwYFAgUEAwAAAAECAAMEESEFEjFBUWETInEGFDKBkaFCscHR8FJyFSNTYoIzQ5LxFqLh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJREBAQACAgEFAAEFAAAAAAAAAAECERIhAwQTMUFRYRQiI3Gh/9oADAMBAAIRAxEAPwB0QhAEMTFQhCEEQhACEIQRFEYEIQgiEIAU6IIsAWLEnQAp0KmBqSdFBY+g5D1OBGD4nxYBHQafQzLPzTDLVbYeHLObh2LARwwyD+4PQiFNJZZuMrLLqlnRJ0ZFiTp0A6KEOM4OITuF8q4L8ydVp9sc2+0atrlw/hVGLBw2MnO66gsMdBpjHeYZeoxmXGOjH0+Vx5UsSLEm7ndEM6IYAhgmEYJgCGCYRgmIBMEwjAJgAmAYRgkwAGjTxxjGniBipGo5UjcAthCEAGEIwMQhAEIGAHFEERcxgYiiBmEDADzFgAxcwA50HMXMANh5H/tA+rrJhXy8JDXJDAcSpx6jB/SE18u6uuhGnqeU4vPP8m7+PR9N34tT9V20FZD4ifMcmHSSra5V1DKdD9Qeh7yLd1d4HAOJm7W9q27NlWKE55cOozzleLLTPz4b7bPM7MrbXbC1AFRQGb4d84OemP17Rk7YYsUREJUn8XxhfjI7gzp5xyXGrjMj3l5uYVfjYeX/AGrzb15D5mRau0N0Bt3e3uAVhoO56ympms1Z6lTtgaaDHAdgBiZZ+Tc1G3i8fe60FsN0AZ1iLUzXpDTRifqpHGVh2ioGMP8AIQtm3G9WUdmbX+04nNw3Y7+Wsb/peRJ0Qz0HkOMQzokQcTBM4xCYBxgGKTBJgCEwTFJgEwBCYBMUmCTABaMvHGMacxGZeNw3jUCWwMIGNAwgYwdBhAxoGEDAHAYQMbBigwBzMIGNAwgYA4DFzGwYWYwPMXMbzCBgD1PjxxylRUuEpv4J0PDXPx9BLNDrI17bMtd2PmVgrNngHwNdZzeeTqur02dm4RquAWK4A111yOxme2tXZicaAcuZGf3/ADl7UrFtRwA68x69jM/eVGffZcBkyxA0bdAGZHjna/Jl0pKdJmuFUN8A3ufyA+UGz3jVABIOWBOez5z05fWSrxs0qV2g1DbrY/pJAx35H6yMoxWDjhq2Ou8Dp/5GdDmBYsy7yF87rnGpx/NZfWd4yrg65JGeJHM6SjpjcthUK+apUI7glifyMnUKhV9zPH4vpjT7yMpteF0tL6qwAK6j0zr6x72YY1HLlQNwNnHMnQfrIyVAujHThx0lt7MhQKqjj5W/46iRjO42zyvG6XGYhMSJmdLjdmITOJgkwBSYJMQmITAOJgkziYJMA4mATOJgEwDiYBM4mATAOYxpzCJjTGIG3MbzFcwMwCzBhAxpQekPdPSPVLcOAwgYzgxd6GjPAwsxkNFDQB7MUNGhnpDCGPVLcOAxQY3unpFzA9nQYoMaBhAxBO2bS3qijvk+g1kXbFVqlY0qWAB56jHn0EnbPfw1ZzngeExu3L2qRu0iVNVtWGclQPyyZz+T+7LTfx9Y7XdfaNvRQh2ydFAXBJY6AADhrjjMlW2jRSqCyVFLb2vlO8uobKjQj9oT2lMUmpHILbp8TGSHU6b2OIzIVwtVt1moFmUEK9IhlI7a9esMJB5Ll9L1dnqLUCk29TJJ05KSfuAT9BK/w/PpodBwGdOGny9NInsrfstSpQq+UMDuqdd0jj+hkg4Fbf5Zzj7Qm5bKq9yWHLq1QUEeqd1UffAxx5LpzPDSU9G/pl2dKTnd0YlgCfly4R72huHqV6dKjhgi4wdBvEfY6SOthUGfFZKYbG8KZLVHA5Y5SsZNdoz3vpate0agXdyuQG3X4gH85P8AZ2p4dfdfmCgP+08P0lNcW3jDK090IMIc6jHAd47sWuxanv8AEFR8wZOuul7beoMEiBmFVyTnrGjmdHbmKTBJiZnYgCExCYpWAYg4mAWiEwC0AItAJiFoBaAKTAJiFoJMA5jGnMJjG2gDTmDmKwMHBhomsFsI4trLJLaP07aepxjjtqmNn2jbWA6TRi1gNbCK4Y0TLJnvch0hrZdpc+COkcShJ4YnyyVVOzjwtO0tVoiOCkJWoXalNnANl2l74U4UIaxPtRe59oq2faXvgTnTAJ0+gkZSKm2M9pK2F8NSQeOnT9pQJbFqbVq9ZRpujGm4O2ect/amoynLZ3dfh00PUzMW9AK2uMH4S3mHbAPOeLbvderJrUO+IHXcRqjqOBekx9QGUg4+RjKW1VGyhK9cAjP/ABM0lihGFqPT64Ua/wD1kza9gXVGViMHOFpv59eBMmZ96O4xjaNBxVNTdw7ndXPEA8TIj3JBPE68wdZtKeyvGTB31ZSSrqGTB5EZOT85namyqu97rk+Lx8TAx4e98Weu7p1zNMcti46VtrSZnFRR5hkH04D6ayStlU1YAknJydSPU/WaB9jigoCbxYnLMys28Txzidsy2KKcsxzyKFQO2WzFzK4M8XXIR9/e0KsWA83TdXQQrOo6VlBXy7+8OfHiJZ7QsS2rboA1UhRnI4a6SHswO9dd4g6jkVOnYiPG7icpp6LTtwVB7RDajpBt78DRvvH/AH1ZvPPYxvilR/dlne7iSPGUwHdYf1U/C9j+TDWwgGzzHGrATkuR1mmPqML8xN8GU+Ki1LDtGv8ADzLujWUyQKAM6Zhhe3PblOmaNlBNjNT7oOkZqW4j9vEuVZr3CC1oJoDbxipZw4Q+VULUBGzb9polsIZsBF7cHJmPdD0ie5zTe4RPcu0qeKJudaJbacaMaW9ne9TH3m3tnRTMUWxMKjWllQIMfvUe3FctnFNsZdLTE40BF7lPhFL7tE92ls9CR3oGL3aOEREoR8W8NaZEdEPdo4REa2kPaFLdQky33pA2yM0mHaTl5bqqmE2yF8ErJgg4xxI4ntnjMc9N0yppgINTUYjyjkWc8PQYlvR2luVGSrndUgZ6k8FH3k7aNrTqqoqaLxWmuSSepxr+vpPPn8uxmLFwrb9Niyg6u5O4D0A+Jzrw9Jq7C/p1BuFjjucHeHHOD3GnLnrpMnteg4ICEBVyCyjSmnMKvXlnnnAwDqxb3wUhcYxhDg5wF1K/fB6lm7StS9lu/bf+5Mo8gU548vrxMpG2NW8fxd8cMbpXQjP1kKx2zcAZVsjjg8DrJr+0tXnTXPDOsXU+D+Vi1uxH+YFUDnnOR+kp9pbVpou4nDUZ46+n8/SQ7zaNWpjeY45gcBKa+vV1GBk/U6/nz/8AcJjunbqHql+w1NUlTwHEHtrofQiFb3qrh38nJQOHqU5fKV1FN3LvjH9J4N0P84QqVJqzg/g7jgOhmmmdu2pvr1t1cZ1Gc/hP04SGu2WQ7rR2nWVk3AVwowN7OCZn9s13yKemBqMYixm+itaVdtA8DJ9ttANznm4uWXnLSy2lgZzDLx/gmbZ3lbTIMrqN6d7GZWU9rqeJkb3vLgrFMP1VybaxdidJorJmHGUGwwzAEiX7XAAwY/H5ssPhOfjmS0R1Mbq0hK1nIGQY5bXe8NTOvH1Eyc98OkoUYnu8RLgR9amZtM2dxAtvOahJIEBjK5xPFEqUwJBeprJt3UAEzdzdeY6zPLzaOePbcps9e0L/AA4dJW09o1BxWSKe1+oM5OUdXE89liAodYX+KrOF6hj5wcTyXhHGODaYkZipgG3Uw5jinC/U84a3APOVhsl6wDa9GMXKjiuBVWGMGUPgVOTSXRFQcY5kNLTwRIm0LfyH0MEXbDiI1dbSBUiPotMNtawR8OOKZO7nAL/zny5a6jF3l/cU3L587ZHDRKY00HLJ4dh3mr2lvhjVpkFMtvr1A79ZE8ajcDBAD8xzHQZ+k5rdNpNswdsOiDxBlm1HLGuhx24/MSDUuVxvU9NBkdcgZ/naX+1dj7zDGCNEHYAfw/OUd7sKoDoDz4fQSsbiLMg0L9eRZTofLwJ5nEsVvSQMEHn007zPvs6qOXI4wOcdt7e4A3TqOGvDMu4xPKrK8r1GGE0zrK0lE1Ygtr9ZEqUq+8QoYZ5dPST9mbHz56p0HIx6khbtqRs62asByAz5Tkj+cZZ3VZKaGjTxvt9usgXF+f8Ap0RjGBnkO8C2UJlmbLccnv0zJ190966iws3VFwQGxqe31lZcMu8TjGekds7nVmYZz5cc4l5bEciM8MjEufKag3FvkZWQDvLLClX3TumSXtlaVtOlNTZidJodhW53gWjFCgqydZVSGzIzvS8Me29s75KaY5yBd7Wzw+0qQ5PGMuxBnJa6pjFqu1anDlJFLaeBrKRq2kAVsysUZRa0/aDdfBOk0uydso/AzynajkHIh7P2g9MhgSJ1Y7nbmuq9sN0McZWXe1FHEiZq22m1ZNG+kS22O1U5ZjD3h7azvdrKRoZlbi5JYnM1dD2YTmWPzjh2BRGm4PpJ7vdPUnw0NGgx+IYhtbCW7UpFqWy88iGhtULa68ZKS1XtHfcFJyHM6tZNyePUG3NZ9DGXsao+FozVsq/4XEVLW6/1F+kWv4Dmo3A6GMV2uRwUH5yZv3K8d0wm2qy/HSPy1ho0K2vao+ND8pY09rrzBHqIFLbFBtOB7x2rbpUGVIilB9b6mw4iQ7w02U4xwMYr7PbGglXWsXXJ1Eq5CRQ1qLGk3hnO4xGP9szW6lQgklH+IngSM66GW3+IFC6qMgtu4P4uWgme2xc+bygZGpI7Hh9dJGrs9xOb3mm3HfGOXEAc+8JNsgndIKnkCMcOEpBt5kwTjQa4568B9oR21Tc+dRoQo7aZOvpF7d+4rnPqr1LpSQB3PXGRgfpGGZs4ABGn01IP86SppIh1QkajTPLOknWTMjEE59f6c4+uknjpUy2kJqx0Hy5aZlZtO6GoB04a8AeklOzZYKJQ3jK2jNjtLwxRlkb97J8qDA4EnnOe4Pwrr8v3nF6IGCfl1hU95x/lKFX+o8Zqz2KgAmrnXiB0mh9/NWhlk0XTMzFeg40G8x68pK2O1Viafhs2RoADmFn2UokUE4IkqpSKiC9AqcEFSDqDxEnOuV1itVIrLepvHEuLeljUyBQoYOZNNWZZ1rhE4NOqtI9N51SpMuDbloDVI2z44Rlt5jhQT/aM/lJFLZF2w0oVPmMfnNJGWWSDdJvSFd6LiXjez17/AKLfMr+8hXexrofFRf5YP5TWVjew+z+0igmq2f7UAYXHGU+xvZhviqndHTnLC62Va6qr+YDkRmZZZY29LmOWu24ttpBlGCIFVWJ4mZT2c2dVQ5Z/T0mqLGLnvo+Om4DwWAPKMLCDTfbLTmtUPLEaOzRyJj2/6wg8Ogrq+yHPwuZCqbGuR8NQ/OX+8YYc9fyhqBl22Rd/6sae0vV/Eh9QZqKtZxwUn+3EHxcjJRvprFYcrJVEqf8AdoBu6a/Yxmnof8moyH+ipn9ZsPBzqAV9RKu+2dVbiiOv0Mjirki2ntCVIS4XHLe5H5y2uHpumQRqJm721qoMeE7pzUgkj+085SJfvRPlLGm3JshkPTBi3Z8nqX4RtpWtKmlR6jYPiNu4x5RMlV2Z4qnwgxUebI54zgA8M/vNPV2OtxVFWuc0qYyFzoWJzrJVrWp1AapA8FDu00XgzD8Rx3hy0VxYil7NVCm8FJAIAAGdSAePPlIdXZaqPMCOJJweWh/Oenrf1ar+HTUIAN9ieRI8oA689eEZuEWoDSuAjZ47vlA7b2fN8oTy/o4fjzZaCqcjTHCPVr8annqPUHj+8l7Z2HUouSgLodQVGcfIcJR1mA0PPryM11Kjek6zqkNkNnXnKe8phqrdznEstnWdWq2KSlsfTHrNLsj2URH8W4IJ4hAeJ7mFymI1az+yNg75B0A5F8y7q0UoEK64HBWOCra6AGLta7u97IUIg0AQ4wO3IwrfaAqLuVNQ2hBBAJ7f0kdpF3e1TU6NeDSqkKh3W6/hbtkcD2jaq1u281XXBwFVgQegbGD9Yxf7JqU8VKJ38fhPxYGvz/PSS6hS5okjRlBOD8SkcQecc/4VDWvKdUZyS3VskyOwPIymt3K1N09cazTWNMtooLHoNZVx0UyRKNJzyku12RVqHyAn0ms2T7Lu2GqkAdBrNTQtqNEYAGn84CRdLlrIbO9i3YDxHx2XUy+tfY61p6shc/7tf/yWr7RxooP/AIn8sSK+0UY+YVVPZTg/XSLo7s74NOmMU6aL6LGffQ3lzg+kYN1RByXYf8WB9eOPtHqN5bVPxjPDJGDJCsudpVkbcYadeokG6vqg83FTx04TV07ZOJdHXln9JL8OnjAVT2wBCSj4YY12chcZzoMSds72NtUqeNVyznXU6D5cJqVorn/poMcMYMSuBzXP7R446K3Y1taOBhRpwkKvbrn4BCNUE+Rs9uYjqk8xH0O04Oen3hmQaVxHQ8pKauOs7HeRd4wlJ6wCSSP/AFBL9MxsRcmAPo/Uzt8dzGgIYWMONbtAas3yhPpIdZzHsaSTV7/eMXNJXGHVWHRgD+cbWqOAEcCdY52FTfbCouhRVZAcE+G3T1z9pSXexqlNadOnh0Vt473kxrkZHMCbMiRquDpJuMPahegtOmFGMsxZyPxdsyjvL2lTfKrvMRrnXHp0mpvLEOMA4lDtL2WqMd5GGnUcfpMbhdtJlNKOl7TVN4gBR2lXdWdC8rA1PIx0O7oGMXbOzqlFt90I5EjUGVlglZ6quadUIuSCqnX7TTDH7ic7GztLBLVXRMKgAJJ1Zmmd2rdMy75JGuF5GOUPfXfd3SygkgucEjlkTrzYl61QOyAqOQPOTwvLsTKadTu2NMipwA4HnGNneEy7yjUHjnOnTEtP/itzVQhmCZ+ZxFs/YitSXcVxgnU45RzHorlNoV9cimA3MlcfvHqQtCQ7O9NyDnChlIP9XD85p7T2ctwAKi75HNjmHfez1vU0A3ca+XT6yuPSeW2HX2cUtvU7iiykg+clGHyOn3m02PbW9BQDUTqSGBLH5cpW3fskRqnm7DQ/aV52Qy6MHHqTC205I2F17UUlG7SBbvwEz9z7Q12/Hx5KMYjVts4D8DH6mFb7IqbxCocciREfR+32rWHmZyf1k239oXPHQyPU2DXOuAOgzGDs9wQCsCae020rDDYj1SiG1plfRgCJkLi2qLjcU9TLjZVZ9CYocy0sjQdf+zSz/tHGLb+Lzor8s/vJi3MJLnJ0jvRy7O0Cw/CAPU/vHDUx3iUzn4sQXccBHpBqqik7w0PUfr1jxRzqpGO/WNEQPFxwMVitomHzHkqHrEnQkI5TrmOi4nTpRDW5jouDOnRmIV2jq3ESdFQJ68YJJnToASkLqZFr7S1wonTobBErMRrG3M6dEAKxkynV0nTowi3Qpt8QBi0FpcAonToEbr2VPO9gQhTUjAnTpROWniGyTp0ZK+uwBgb/AEE6dIqofpEwy4X4hn1nToqccbxQMhRH7a7zyAnToYlXVq0ZVA3ETp0mnB1LVcaxilQXOAIk6HxSSjSAEra+8moiTppZuJnRy3vAeJklWXOQZ06R8KO+IesBlnTo7Q//2Q=="},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_reg_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!0,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"}}}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"WFS ",visible:!0,source:l}))}),this.layerService.createAsyncLayer({title:"Commission scolaire anglophone",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{LAYERS:"WMS_MEQ_CS_ANGLO",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"lieu habit\xe9",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"Avertissements routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle",visible:!0,source:l,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-legend"]],decls:17,vars:8,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer"],[3,"map","view"],["color","primary",3,"map"],["title","Legends"],[3,"layers","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map with a legend list"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3),e._UZ(16,"igo-layer-legend-list",4),e.qZA()()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(2),e.Q6J("layers",o.map.layers)("excludeBaseLayers",!0)("allowShowAllLegends",!0)("updateLegendOnResolutionChange",!1)("showAllLegendsValue",!1))},dependencies:[x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,qn],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let w2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[S2,x.QW,w.ot,T.Ps,Tt,st,vi,Lo,fi,Nr]}),i})();const M2=te.Bz.forChild([{path:"overlay",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.map=new ot({overlay:!0,controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6}}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(t=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:t}))})}ngAfterViewInit(){this.map.overlay.setFeatures([{type:le,projection:"EPSG:4326",meta:{id:1},properties:{},geometry:{type:"Point",coordinates:[-73,46.6]}},{type:le,projection:"EPSG:4326",meta:{id:2},properties:{},geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]}},{type:le,projection:"EPSG:4326",meta:{id:3},properties:{},geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]}}],Y.None)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-overlay"]],decls:15,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/overlay"],[3,"map","view"],["color","primary",3,"map"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Overlay"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA()()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map))},dependencies:[x.a8,x.dn,x.n5,x.$j,Ae,pt],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]}),i})()}]);let F2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[M2,x.QW,w.ot,st,ts]}),i})();function A2(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-form",4),e.NdJ("submitForm",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.onSubmit(n))}),e.ALo(1,"async"),e._UZ(2,"igo-form-group",5),e.TgZ(3,"div",6)(4,"button",7),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.fillForm())}),e._uU(5," Fill Form "),e.qZA(),e.TgZ(6,"button",7),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.clearForm())}),e._uU(7," Clear Form "),e.qZA(),e.TgZ(8,"button",8),e._uU(9," Submit "),e.qZA()()()}if(2&i){const t=r.ngIf,o=e.oxw();e.Q6J("form",t)("formData",e.lcZ(1,4,o.data$)),e.xp6(2),e.Q6J("group",t.groups[0]),e.xp6(6),e.Q6J("disabled",o.submitDisabled)}}const I2=te.Bz.forChild([{path:"geometry",component:(()=>{class i{constructor(t,o,n,s){this.languageService=t,this.formService=o,this.dataSourceService=n,this.layerService=s,this.map=new ot({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:15},this.form$=new b.X(void 0),this.data$=new b.X(void 0),this.submitDisabled=!0}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))});const o=[{name:"geometry",title:"Geometry",options:{validator:_.kI.required},type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!0,drawGuide:50,drawGuidePlaceholder:"Draw Guide",drawStyle:new R.ZP({stroke:new U.Z({color:[255,0,0,1],width:2}),fill:new N.Z({color:[255,0,0,.2]}),image:new Me.Z({radius:8,stroke:new U.Z({color:[255,0,0,1]}),fill:new N.Z({color:[255,0,0,.2]})})})}},{name:"name",title:"Name",options:{validator:_.kI.required}}].map(s=>this.formService.field(s)),n=this.formService.form([],[this.formService.group({name:"info"},o)]);this.valueChanges$$=n.control.valueChanges.subscribe(()=>{this.submitDisabled=!n.control.valid}),this.form$.next(n)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({name:"Place",geometry:JSON.stringify({type:"Polygon",coordinates:[[[-106,42],[-107,31],[-81,32],[-82,42],[-106,42]]]})})}clearForm(){this.form$.value.control.reset()}onSubmit(t){alert(JSON.stringify(t))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(Bs),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-geometry"]],decls:13,vars:6,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form"],[3,"map","view"],["color","primary",3,"map"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Geometry Form"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-map-browser",1),e._UZ(10,"igo-zoom-button",2),e.qZA(),e.YNc(11,A2,10,6,"igo-form",3),e.ALo(12,"async"),e.qZA()),2&t&&(e.xp6(9),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("ngIf",e.lcZ(12,4,o.form$)))},dependencies:[f.O5,w.lW,x.a8,x.dn,x.n5,x.$j,Rs,Rl,Ae,pt,f.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}igo-map-browser[_ngcontent-%COMP%]{width:500px;height:500px}"]}),i})()}]);let O2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,I2,w.ot,x.QW,Cn,Ra,st]}),i})();const D2=te.Bz.forChild([{path:"feature",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.tableTemplate={selection:!0,selectMany:!0,sort:!0,columns:[{name:"properties.id",title:"ID"},{name:"properties.name",title:"Name"},{name:"properties.description",title:"Description"}]},this.store=new Ct([],{map:this.map})}ngOnInit(){const t=new Nt({});this.store.addStrategy(t);const o=new Mt({map:this.map,motion:Y.Default});this.store.addStrategy(o),this.store.load([{meta:{id:1},type:"Feature",geometry:{type:"Point",coordinates:[-72,47.8]},projection:"EPSG:4326",properties:{id:1,name:"Name 1",description:"Description 1"}},{meta:{id:4},type:"Feature",geometry:{type:"Point",coordinates:[-71,46.8]},projection:"EPSG:4326",properties:{id:4,name:"Name 4",description:"Description 4"}},{meta:{id:5},type:"Feature",geometry:{type:"Point",coordinates:[-73,45.8]},projection:"EPSG:4326",properties:{id:5,name:"Name 5",description:"Description 5"}},{meta:{id:2},type:"Feature",geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]},projection:"EPSG:4326",properties:{id:2,name:"Name 2",description:"Description 2"}},{meta:{id:3},type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]},projection:"EPSG:4326",properties:{id:3,name:"Name 3",description:"Description 3"}}]),this.layerService.createAsyncLayer({title:"MVT test",visible:!0,sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}}).subscribe(n=>this.map.addLayer(n)),this.dataSourceService.createAsyncDataSource({type:"vector"}).subscribe(n=>{const s=this.layerService.createLayer({title:"Vector Layer",source:n,animation:{duration:2e3},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-feature.json",source:"source_nameX"}}});this.map.addLayer(s),this.store.bindLayer(s),t.activate(),o.activate()})}ngOnDestroy(){this.store.destroy()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-feature"]],decls:12,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geom/feature"],[3,"map","view"],["color","primary",3,"map"],[3,"store","template"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Feature"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-map-browser",1),e._UZ(10,"igo-zoom-button",2),e.qZA(),e._UZ(11,"igo-entity-table",3),e.qZA()),2&t&&(e.xp6(9),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("store",o.store)("template",o.tableTemplate))},dependencies:[x.a8,x.dn,x.n5,x.$j,li,Ae,pt],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let k2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[D2,f.ez,x.QW,w.ot,T.Ps,Tt,Zi,st,Ao]}),i})();const $2=te.Bz.forChild([{path:"hover",component:(()=>{class i{constructor(t,o,n,s){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.mediaService=s,this.pointerCoordDelay=0,this.pointerHoverFeatureDelay=0,this.map=new ot({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:8,projection:"EPSG:3857"},this.dataSourceService.createAsyncDataSource({type:"wmts",url:"https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts",layer:"carte_gouv_qc_public",matrixSet:"EPSG_3857",version:"1.3.0"}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"Quebec",visible:!0,baseLayer:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"adn_bassin_n1_public_v",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"3.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (polygon)",visible:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{featureTypes:"MSP_CASERNE_PUBLIC",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (point)",visible:!0,source:c,igoStyle:{styleByAttribute:{attribute:"en_caserne",data:["true","false"],stroke:["red","blue"],fill:["#ffffff","#ffffff"],radius:[7,7],width:[2,2]},hoverStyle:{label:{attribute:"Caserne: ${no_caserne}\xa0\n Mun: ${nom_ssi}",style:{textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:20,offsetY:10,padding:[2.5,2.5,2.5,2.5]}},baseStyle:{circle:{stroke:{color:"orange",width:5},width:[5],radius:15}}}}}))})}get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le),e.Y36(gt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-hover"]],decls:18,vars:9,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/hover"],["igoHoverFeature","",3,"map","view","igoHoverFeatureDelay","igoHoverFeatureEnabled"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Hover"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2)(15,"igo-geolocate-button",2)(16,"igo-home-extent-button",2)(17,"igo-rotation-button",3),e.qZA()()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view)("igoHoverFeatureDelay",o.pointerHoverFeatureDelay)("igoHoverFeatureEnabled",!0),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map)("showIfNoRotation",!0))},dependencies:[x.a8,x.dn,x.n5,x.$j,Ae,pt,Jn,Rn,Bn,yy],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:500px}"]}),i})()}]);let E2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,$2,x.QW,w.ot,st]}),i})();const R2=te.Bz.forChild([{path:"measure",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.map=new ot({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"},this.store=new Ct([],{map:this.map}),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-measure"]],decls:16,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/measure"],[3,"map","view"],["color","primary",3,"map"],[3,"store","map"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e._UZ(15,"igo-measurer",3),e.qZA()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("store",o.store)("map",o.map))},dependencies:[x.a8,x.dn,x.n5,x.$j,Ae,pt,Ja],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-measurer[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]}),i})()}]);let B2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[R2,x.QW,st,Ju]}),i})();const N2=te.Bz.forChild([{path:"draw",component:(()=>{class i{constructor(t,o,n,s){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.mapService=s,this.map=new ot({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"},this.stores=[],this.mapService.setMap(this.map),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:a}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le),e.Y36(Ut))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-draw"]],decls:16,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/draw"],[3,"map","view"],["color","primary",3,"map"],[3,"stores","map"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e._UZ(15,"igo-draw",3),e.qZA()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("stores",o.stores)("map",o.map))},dependencies:[x.a8,x.dn,x.n5,x.$j,Ae,pt,Cu],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-draw[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]}),i})()}]);let q2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[N2,x.QW,st,xu]}),i})();function G2(i,r){if(1&i&&(e.TgZ(0,"div")(1,"h1"),e._uU(2,"Query Title : "),e.TgZ(3,"span",6),e._uU(4),e.qZA()(),e._UZ(5,"igo-feature-details",7),e.qZA()),2&i){const t=r.$implicit,o=e.oxw(2);e.xp6(4),e.Oqu(o.getTitle(t)),e.xp6(1),e.Q6J("feature",t)}}function Q2(i,r){if(1&i&&(e.ynx(0),e.YNc(1,G2,6,2,"div",5),e.BQk()),2&i){const t=r.ngIf;e.xp6(1),e.Q6J("ngForOf",t)}}const Y2=te.Bz.forChild([{path:"query",component:(()=>{class i{constructor(t,o){this.dataSourceService=t,this.layerService=o,this.features$=new b.X([]),this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(n=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:n}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryTitle:"num_rts",params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe(n=>{this.map.addLayer(this.layerService.createLayer({title:"WMS",source:n,sourceOptions:n.options}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryFormat:qe.HTMLGML2,queryHtmlTarget:io.IFRAME,params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe(n=>{this.map.addLayer(this.layerService.createLayer({title:"WMS html with a pre call in GML",source:n,sourceOptions:n.options}))}),this.layerService.createAsyncLayer({title:"Query url test",visible:!0,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",queryable:!0,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application/geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}"}],queryLayerFeatures:!1,queryFormat:"geojson",params:{layers:"SDA_MUNIC_S_20K",version:"1.3.0"}}}).subscribe(n=>this.map.addLayer(n)),this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0,queryTitle:"So beautiful ${name}",sourceFields:[{name:"name",alias:"Alias name"},{name:"description",alias:"Alias description"}]}).subscribe(n=>{this.map.addLayer(this.layerService.createLayer({title:"Vector Layer",source:n,sourceOptions:n.options})),this.addFeatures(n)})}addFeatures(t){const o=new De.Z({name:"feature1",geometry:new oo.Z([V.vs([-72,47.8],"EPSG:4326","EPSG:3857"),V.vs([-73.5,47.4],"EPSG:4326","EPSG:3857"),V.vs([-72.4,48.6],"EPSG:4326","EPSG:3857")])}),n=new De.Z({name:"feature2",geometry:new Pe.Z(V.vs([-73,46.6],"EPSG:4326","EPSG:3857"))}),s=new De.Z({name:"feature3",geometry:new kt.ZP([[V.vs([-71,46.8],"EPSG:4326","EPSG:3857"),V.vs([-73,47],"EPSG:4326","EPSG:3857"),V.vs([-71.2,46.6],"EPSG:4326","EPSG:3857")]])});t.ol.addFeatures([o,n,s]),this.layerService.createAsyncLayer({title:"Vector tile with custom getfeatureinfo url",visible:!0,sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application%2Fgeojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}"}],queryLayerFeatures:!1},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe(a=>this.map.addLayer(a)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi",queryable:!0,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&INFO_FORMAT=geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}",minResolution:0,maxResolution:400}],queryFormat:"geojson",params:{version:"1.3.0",layers:"MSP_CASERNE_PUBLIC"}}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"WMS with custom getfeatureinfo url",source:a,sourceOptions:a.options}))})}handleQueryResults(t){const o=t.features;o.length&&o[0]&&(this.features$.next(o),this.map.queryResultsOverlay.setFeatures(o,Y.None))}getTitle(t){return Yt(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-query"]],decls:18,vars:7,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures","query"],["color","primary",3,"map"],["title","Details"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"background-color","#e0e0e0"],[3,"feature"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Query"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e.NdJ("query",function(s){return o.handleQueryResults(s)}),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3),e.YNc(16,Q2,2,1,"ng-container",4),e.ALo(17,"async"),e.qZA()()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view)("queryFeatures",!0),e.xp6(1),e.Q6J("map",o.map),e.xp6(2),e.Q6J("ngIf",e.lcZ(17,5,o.features$)))},dependencies:[f.sg,f.O5,x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,FS,Xc,bi,f.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let H2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Y2,f.ez,x.QW,w.ot,T.Ps,Tt,st,ts,Kn,Ao]}),i})();const z2=te.Bz.forChild([{path:"catalog",component:(()=>{class i{constructor(t,o,n,s,a,l){this.configService=t,this.languageService=o,this.layerService=n,this.catalogService=s,this.storageService=a,this.mapService=l,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.catalogStore=new it([]),this.catalogItemStore=new it([])}ngOnInit(){this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(t=>this.map.addLayer(t)),this.loadCatalogs(),this.mapService.setMap(this.map),this.catalogStore.stateView.firstBy$(t=>!0===t.state.selected).subscribe(t=>{t&&t.entity&&(this.catalog=t.entity)})}onCatalogSelectChange(t){this.loadCatalogItems(t.catalog)}loadCatalogs(){this.catalogService.loadCatalogs().subscribe(t=>{this.catalogStore.clear(),this.catalogStore.load(t.concat(this.storageService.get("addedCatalogs")||[]))})}loadCatalogItems(t){this.catalogService.loadCatalogItems(t).subscribe(o=>{this.catalogItemStore.clear(),this.catalogItemStore.load(o)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(J),e.Y36(D),e.Y36(Le),e.Y36(wa),e.Y36(ce),e.Y36(Ut))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-catalog"]],decls:23,vars:7,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/catalog"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"],[3,"map","view"],["color","primary",3,"map"],["title","Catalog Library"],[3,"store","catalogSelectChange"],["title","Catalog Browser"],[3,"catalog","store","map"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Catalog"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: ConfigService, LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See catalog section of the "),e.TgZ(14,"a",1),e._uU(15," environment config"),e.qZA(),e._UZ(16,"hr"),e.qZA(),e.TgZ(17,"igo-map-browser",2),e._UZ(18,"igo-zoom-button",3),e.qZA(),e.TgZ(19,"igo-panel",4)(20,"igo-catalog-library",5),e.NdJ("catalogSelectChange",function(s){return o.onCatalogSelectChange(s)}),e.qZA()(),e.TgZ(21,"igo-panel",6),e._UZ(22,"igo-catalog-browser",7),e.qZA()()),2&t&&(e.xp6(17),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(2),e.Q6J("store",o.catalogStore),e.xp6(2),e.Q6J("catalog",o.catalog)("store",o.catalogItemStore)("map",o.map))},dependencies:[x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,Ta,Ma],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]}),i})()}]);let W2=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Cs({default:Ws.igo})],imports:[f.ez,z2,x.QW,w.ot,T.Ps,O.AV,sr,Tt,st,lu]}),i})();var K2=C(39051);Error,Error;var Pt=(()=>{return(i=Pt||(Pt={}))[i.null=0]="null",i[i.read=1]="read",i[i.write=2]="write",Pt;var i})();let Co=(()=>{class i{constructor(t,o,n,s,a,l,c,u){this.http=t,this.authService=o,this.languageService=n,this.config=s,this.messageService=a,this.storageService=l,this.exportService=c,this.route=u,this.context$=new b.X(void 0),this.contexts$=new b.X({ours:[]}),this.defaultContextId$=new b.X(void 0),this.editedContext$=new b.X(void 0),this.importedContext=[],this.toolsChanged$=new Se.x,this.mapViewFromRoute={},this.options=Object.assign({basePath:"contexts",contextListFile:"_contexts.json",defaultContextUri:"_default"},this.config.getConfig("context")),this.baseUrl=this.options.url,this.readParamsFromRoute(),this.authService.hasAuthService?this.authService.logged$.subscribe(p=>{p&&(this.contexts$.pipe((0,ni.T)(1),(0,Gt.P)()).subscribe(d=>{this.handleContextsChange()}),this.loadContexts())}):(this.loadContexts(),this.handleContextsChange(!1))}get defaultContextUri(){return this.storageService.get("favorite.context.uri")||this._defaultContextUri||this.options.defaultContextUri}set defaultContextUri(t){this._defaultContextUri=t}get(t,o){let n=this.baseUrl+"/contexts";return t&&this.authService.authenticated&&(n+="?permission="+t.join(),o&&(n+="&hidden=true")),this.http.get(n)}getById(t){return this.http.get(this.baseUrl+"/contexts/"+t)}getDetails(t){return this.http.get(`${this.baseUrl}/contexts/${t}/details`).pipe((0,he.K)(n=>{throw this.handleError(n,t),n}))}getDefault(){if(this.authService.authenticated)return this.http.get(this.baseUrl+"/contexts/default").pipe((0,Ji.b)(o=>{this.defaultContextId$.next(o.id)}));{const t=this.storageService.get("favorite.context.uri");return this.defaultContextId$.next(t),this.getContextByUri(t)}}getProfilByUser(){return this.baseUrl?this.http.get(this.baseUrl+"/profils?"):(0,X.of)([])}setDefault(t){return this.authService.authenticated?this.http.post(this.baseUrl+"/contexts/default",{defaultContextId:t}):(this.storageService.set("favorite.context.uri",t),(0,X.of)(void 0))}hideContext(t){return this.http.post(this.baseUrl+"/contexts/"+t+"/hide",{})}showContext(t){return this.http.post(this.baseUrl+"/contexts/"+t+"/show",{})}delete(t,o=!1){const n={ours:[]};return Object.keys(this.contexts$.value).forEach(a=>n[a]=this.contexts$.value[a].filter(l=>l.id!==t)),o?(this.importedContext=this.importedContext.filter(a=>a.id!==t),(0,X.of)(this.contexts$.next(n))):this.http.delete(this.baseUrl+"/contexts/"+t).pipe((0,Ji.b)(a=>{this.contexts$.next(n)}))}create(t){return this.http.post(this.baseUrl+"/contexts",t).pipe((0,Z.U)(n=>(n.permission=this.authService.authenticated?Pt[Pt.write]:Pt[Pt.read],this.contexts$.value.ours.unshift(n),this.contexts$.next(this.contexts$.value),n)))}clone(t,o={}){return this.http.post(this.baseUrl+"/contexts/"+t+"/clone",o).pipe((0,Z.U)(s=>(s.permission=Pt[Pt.write],this.contexts$.value.ours.unshift(s),this.contexts$.next(this.contexts$.value),s)))}update(t,o){return this.http.patch(this.baseUrl+"/contexts/"+t,o)}addToolAssociation(t,o){return this.http.post(`${this.baseUrl}/contexts/${t}/tools`,{toolId:o})}deleteToolAssociation(t,o){return this.http.delete(`${this.baseUrl}/contexts/${t}/tools/${o}`)}getPermissions(t){return this.http.get(this.baseUrl+"/contexts/"+t+"/permissions")}addPermissionAssociation(t,o,n){return this.http.post(`${this.baseUrl}/contexts/${t}/permissions`,{profil:o,typePermission:n}).pipe((0,he.K)(l=>{throw this.handleError(l,void 0,!0),[l]}))}deletePermissionAssociation(t,o){return this.http.delete(`${this.baseUrl}/contexts/${t}/permissions/${o}`)}getLocalContexts(){const t=this.getPath(this.options.contextListFile);return this.http.get(t).pipe((0,Z.U)(o=>({ours:o})))}getLocalContext(t){const o=this.getPath(`${t}.json`);return this.http.get(o).pipe((0,ia.z)(n=>{if(!n.base)return(0,X.of)(n);const s=this.getPath(`${n.base}.json`);return this.http.get(s).pipe((0,Z.U)(a=>{const l=n;return l.map=B.mergeDeep(a.map,n.map),l.layers=(a.layers||[]).concat(n.layers||[]).reverse().filter((c,u,p)=>!c.id||p.findIndex(d=>d.id===c.id)===u).reverse(),l.toolbar=n.toolbar||a.toolbar,l.message=n.message||a.message,l.messages=n.messages||a.messages,l.tools=(n.tools||[]).concat(a.tools||[]).filter((c,u,p)=>p.findIndex(d=>d.name===c.name)===u),l}),(0,he.K)(a=>{throw this.handleError(a,t),a}))}),(0,he.K)(n=>{throw this.handleError(n,t),n}))}loadContexts(t,o){let n;n=this.baseUrl?this.get(t,o):this.getLocalContexts(),n.subscribe(s=>{s.ours=this.importedContext.concat(s.ours),this.contexts$.next(s)})}loadDefaultContext(){const t=(o=!1)=>{!o&&this.baseUrl&&this.authService.authenticated?this.getDefault().subscribe(n=>{this.defaultContextUri=n.uri,this.addContextToList(n),this.setContext(n)},()=>{this.defaultContextId$.next(void 0),this.loadContext(this.defaultContextUri)}):this.loadContext(this.defaultContextUri)};this.route&&this.route.options.contextKey?this.route.queryParams.pipe((0,fe.b)(100)).subscribe(o=>{const n=o[this.route.options.contextKey];let s=!1;n&&(this.defaultContextUri=n,s=!0),t(s)}):t()}loadContext(t){const o=this.context$.value;o&&o.uri===t||this.getContextByUri(t).pipe((0,Gt.P)()).subscribe(n=>{this.addContextToList(n),this.setContext(n)},n=>{t!==this.options.defaultContextUri&&this.loadContext(this.options.defaultContextUri)})}setContext(t){this.handleContextMessage(t);const o=this.context$.value;if(o&&t&&t.id===o.id)return void 0===t.map.view.keepCurrentView&&(t.map.view.keepCurrentView=!0),void this.context$.next(t);t.map||(t.map={view:{}}),Object.assign(t.map.view,this.mapViewFromRoute),this.context$.next(t)}loadEditedContext(t){this.getContextByUri(t).subscribe(o=>{this.setEditedContext(o)})}setEditedContext(t){this.editedContext$.next(t)}getContextFromMap(t,o){const n=t.ol.getView(),s=n.getProjection().getCode(),a=new Pe.Z(n.getCenter()).transform(s,"EPSG:4326"),l={uri:Ze(),title:"",scope:"private",map:{view:{center:a.getCoordinates(),zoom:n.getZoom(),projection:s,maxZoomOnExtent:t.viewController.maxZoomOnExtent}},layers:[],tools:[]};let c=[];c=!0===o?t.layers$.getValue().filter(p=>!0===p.baseLayer||"searchPointerSummaryId"===p.options.id).sort((p,d)=>p.zIndex-d.zIndex):t.layers$.getValue().filter(p=>!p.id.includes("WfsWorkspaceTableDest")).sort((p,d)=>p.zIndex-d.zIndex);let u=0;for(const p of c){const d=p,g={id:d.options.id?String(d.options.id):void 0,layerOptions:{title:d.options.title,zIndex:++u,visible:d.visible,security:d.security},sourceOptions:{type:d.dataSource.options.type,params:d.dataSource.options.params,url:d.dataSource.options.url,queryable:d.queryable}};g.sourceOptions.type&&l.layers.push(g)}return l.tools=this.tools.map(p=>({id:String(p.id),global:p.global})),l}getContextFromLayers(t,o,n){const s=this.context$.getValue(),a=t.ol.getView(),l=a.getProjection().getCode(),u={uri:n,title:n,map:{view:{center:new Pe.Z(a.getCenter()).transform(l,"EPSG:4326").getCoordinates(),zoom:a.getZoom(),projection:l}},layers:[],toolbar:[],tools:[],extraFeatures:[]},p=t.layers$.getValue();return u.layers=p.filter(d=>d.baseLayer).map(d=>({baseLayer:!0,sourceOptions:d.options.sourceOptions,title:d.options.title,visible:d.visible})),o.forEach(d=>{const g=s.layers.find(h=>{const m=h.source;return m&&d.id===m.id&&!h.baseLayer});if(g){let h=g.style;g.igoStyle.styleByAttribute?h=void 0:g.igoStyle.clusterBaseStyle&&(h=void 0,delete g.sourceOptions.source,delete g.sourceOptions.format),u.layers.push({baseLayer:g.baseLayer,title:d.options.title,zIndex:d.zIndex,igoStyle:{styleByAttribute:g.igoStyle.styleByAttribute,clusterBaseStyle:g.igoStyle.clusterBaseStyle},style:h,clusterParam:g.clusterParam,visible:d.visible,opacity:d.opacity,sourceOptions:g.sourceOptions})}else if(d.ol.getSource()instanceof zt.Z){let h;const m=new be.Z;if(d.ol.getSource()instanceof ic.Z){let v=d.ol.getSource().getFeatures();v=v.flatMap(M=>M.get("features"));const S=this.exportService.generateFeature(v,"GeoJSON","_featureStore");h=m.writeFeatures(S,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}else{const v=d.ol.getSource().getFeatures(),S=this.exportService.generateFeature(v,"GeoJSON","_featureStore");h=m.writeFeatures(S,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}h=JSON.parse(h),h.name=d.options.title,u.extraFeatures.push(h)}else{const h=d.options;h.zIndex=d.zIndex,delete h.source,u.layers.push(h)}}),u.toolbar=this.toolbar,u.tools=this.tools,u}setTools(t){this.tools=t}setToolbar(t){this.toolbar=t}handleContextMessage(t){this.context$.value&&t.uri&&this.context$.value.uri!==t.uri&&this.messageService.removeAllAreNotError(),t.messages=t.messages?t.messages:[],t.messages.push(t.message),t.messages.map(o=>{o&&this.messageService.message(o)})}getContextByUri(t){if(this.baseUrl){let n;for(const a of Object.keys(this.contexts$.value))if(n=this.contexts$.value[a].find(l=>l.uri===t),n)break;return n&&n.imported?(0,X.of)(n):this.getDetails(n?n.id:t)}const o=this.contexts$.value.ours.find(n=>n.uri===t&&!0===n.imported);return o?(0,X.of)(o):this.getLocalContext(t)}getContextLayers(t){const o=[];return t.layers$.getValue().forEach(s=>{!s.baseLayer&&"searchPointerSummaryId"!==s.options.id&&o.push(s)}),o}readParamsFromRoute(){!this.route||this.route.queryParams.subscribe(t=>{const o=this.route.options.centerKey;o&&t[o]&&(this.mapViewFromRoute.center=t[o].split(",").map(Number));const n=this.route.options.projectionKey;n&&t[n]&&(this.mapViewFromRoute.projection=t[n]);const s=this.route.options.zoomKey;s&&t[s]&&(this.mapViewFromRoute.zoom=Number(t[s]))})}getPath(t){return`${this.options.basePath.replace(/\/$/,"")}/${t}`}handleError(t,o,n){const s=this.contexts$.value.ours.find(l=>l.uri===o),a=s?s.title:o;t.error.title=this.languageService.translate.instant("igo.context.contextManager.invalid.title"),t.error.message=this.languageService.translate.instant("igo.context.contextManager.invalid.text",{value:a}),t.error.toDisplay=!0,n&&(t.error.title=this.languageService.translate.instant("igo.context.contextManager.errors.addPermissionTitle"),t.error.message=this.languageService.translate.instant("igo.context.contextManager.errors.addPermission")),this.messageService.error("igo.context.contextManager.errors.addPermission","igo.context.contextManager.errors.addPermissionTitle")}handleContextsChange(t=!0){const o=this.context$.value,n=this.editedContext$.value;(!o||o.uri===this.options.defaultContextUri)&&(t=!1),t&&this.findContext(o)?(this.getContextByUri(o.uri).pipe((0,Gt.P)()).subscribe(a=>{this.toolsChanged$.next(a)}),this.baseUrl&&this.authService.authenticated&&this.getDefault().subscribe()):(this.defaultContextUri=void 0,this.loadDefaultContext());const s=this.findContext(n);(!s||"write"!==s.permission)&&this.setEditedContext(void 0)}addContextToList(t){if(!this.findContext(t)){const n={id:t.id,uri:t.uri,title:t.title,scope:t.scope,permission:Pt[Pt.read]};this.contexts$.value&&this.contexts$.value.public&&(this.contexts$.value.public.push(n),this.contexts$.next(this.contexts$.value))}}findContext(t){if(!t)return!1;const o=this.contexts$.value;let n;for(const s of Object.keys(o))if(n=o[s].find(l=>t.id&&l.id===t.id||t.uri&&l.uri===t.uri),n)break;return n}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(Ye),e.LFG(D),e.LFG(J),e.LFG(_e),e.LFG(ce),e.LFG(Hr),e.LFG(Mi,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),dl=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[_.u5,_.UX,f.ez,w.ot,Re.vV,vt.t,lt.Nh,ue.LD,Q.Ng,I.lN,H.c,Ge.p9,oe,Cr,O.AV]}),i})(),Dp=(()=>{class i{constructor(t,o,n){this.contextService=o,this.mediaService=n,this.component=t}get map(){return this.component.map}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,ri.h)(t=>void 0!==t)).subscribe(t=>this.handleContextChange(t))}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(t){if(void 0===t.map)return;const o=t.map.view;(!this.component.view||!0!==o.keepCurrentView||t.map.view.projection!==this.map.projection)&&(this.component.view=o),this.component.map.geolocationController&&this.component.map.geolocationController.updateGeolocationOptions(o);const n=t.map.controls;if(!this.component.controls&&n){if(this.mediaService.isMobile()&&"boolean"!=typeof n.scaleLine){const s=n.scaleLine;s.minWidth||(s.minWidth=Math.min(64,s.minWidth),n.scaleLine=s)}this.component.controls=n}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ae),e.Y36(Co),e.Y36(gt))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoMapContext",""]]}),i})(),kp=(()=>{class i{constructor(t,o,n,s,a,l,c){this.component=t,this.contextService=o,this.layerService=n,this.configService=s,this.styleListService=a,this.styleService=l,this.route=c,this.contextLayers=[],this.removeLayersOnContextChange=!0}get map(){return this.component.map}ngOnInit(){if(this.context$$=this.contextService.context$.pipe((0,ri.h)(t=>void 0!==t)).subscribe(t=>this.handleContextChange(t)),this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&this.route.options.contextKey){const t=this.route.queryParams.subscribe(o=>{Object.keys(o).length>0&&(this.queryParams=o,t.unsubscribe())})}}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(t){if(void 0===t.layers)return;!0===this.removeLayersOnContextChange?this.map.removeAllLayers():this.map.removeLayers(this.contextLayers),this.contextLayers=[];const o=(0,Ms.T)(...t.layers.map((n,s)=>this.layerService.createAsyncLayer(n,t.uri)));o.pipe((0,K2.f)(o.pipe((0,fe.b)(500)))).subscribe(n=>{this.handleAddLayers(n),t.extraFeatures&&t.extraFeatures.forEach(s=>{const a=new be.Z,l=s.name;s=JSON.stringify(s),s=a.readFeatures(s,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});const c=this.configService.getConfig("importExport"),u=(null==c?void 0:c.importWithStyle)||this.configService.getConfig("importWithStyle");this.configService.getConfig("importWithStyle")&&console.warn("\n              The location of this config importWithStyle is deprecated.\n              Please move this property within importExport configuration.\n              Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\n              Refer to environnement.ts OR config/config.json\n              This legacy conversion will be deleted in 2024.\n              "),u?function dM(i,r,t,o,n){let s,a,l;if(o.getStyleList(t.toString()+".styleByAttribute")){const u=o.getStyleList(t.toString()+".styleByAttribute");s=(p,d)=>n.createStyleByAttribute(p,u,d)}else if(o.getStyleList(t.toString()+".clusterStyle")){const u=o.getStyleList(t.toString()+".clusterParam");a=o.getStyleList(t.toString()+".distance"),s=(p,d)=>{const g=n.createStyle(o.getStyleList(t.toString()+".clusterStyle"),p,d);return n.createClusterStyle(p,d,u,g)}}else s=o.getStyleList(t.toString()+".style")?(u,p)=>n.createStyle(o.getStyleList(t.toString()+".style"),u,p):(u,p)=>n.createStyle(o.getStyleList("default.style"),u,p);o.getStyleList(t.toString()+".clusterStyle")?(l=new _o({distance:a,type:"cluster",queryable:!0}),l.ol.source.addFeatures(i)):(l=new Fe({type:"vector",queryable:!0}),l.ol.addFeatures(i));const c=new Te({title:t,isIgoInternalLayer:!0,source:l,style:s});r.addLayer(c)}(s,this.map,l,this.styleListService,this.styleService):function pM(i,r,t){const n=new Fe({type:"vector",queryable:!0});n.ol.addFeatures(i);let s,a=!1;i[0].getKeys().includes("_style")||i[0].getKeys().includes("_mapTitle")?s=jc():(s=Yc(),a=!0);const l=new Te({title:t,isIgoInternalLayer:!0,source:n,igoStyle:{editable:a},style:s});r.addLayer(l)}(s,this.map,l)})}),this.layerService.createAsyncIdbLayers(t.uri).pipe((0,fe.b)(500)).subscribe(n=>this.handleAddLayers(n))}handleAddLayers(t){t=t.filter(o=>void 0!==o).map(o=>(o.visible=this.computeLayerVisibilityFromUrl(o),o.zIndex=o.zIndex,o)),this.contextLayers.concat(t),this.map.addLayers(t)}computeLayerVisibilityFromUrl(t){const o=this.queryParams,s=t.id;let a=t.visible;if(!o||!s)return a;const l=o[this.route.options.contextKey];if(l===this.contextService.context$.value.uri||!l){let c="",u="",p=[],d=[];this.route.options.visibleOnLayersKey&&o[this.route.options.visibleOnLayersKey]&&(c=o[this.route.options.visibleOnLayersKey]),this.route.options.visibleOffLayersKey&&o[this.route.options.visibleOffLayersKey]&&(u=o[this.route.options.visibleOffLayersKey]),"*"===c&&(a=!0),"*"===u&&(a=!1),p=c.split(","),d=u.split(","),(p.indexOf(s)>-1||p.indexOf(s.toString())>-1)&&(a=!0),(d.indexOf(s)>-1||d.indexOf(s.toString())>-1)&&(a=!1)}return a}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ae),e.Y36(Co),e.Y36(Le),e.Y36(J),e.Y36(Xr),e.Y36(no),e.Y36(Mi,8))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoLayerContext",""]],inputs:{removeLayersOnContextChange:"removeLayersOnContextChange"}}),i})();var rn=(()=>{return(i=rn||(rn={})).always="always",i.never="never",i.default="default",rn;var i})();let Pp=(()=>{class i{constructor(t){this.dialogRef=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-bookmark-dialog"]],decls:14,vars:14,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["matInput","","required","","autocomplete","off","maxlength","128",3,"placeholder","ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"mat-form-field")(5,"input",2),e.NdJ("ngModelChange",function(s){return o.title=s}),e.ALo(6,"translate"),e.qZA()()(),e.TgZ(7,"div",3)(8,"button",4),e.NdJ("click",function(){return o.dialogRef.close(o.title)}),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"button",5),e.NdJ("click",function(){return o.dialogRef.close(!1)}),e._uU(12),e.ALo(13,"translate"),e.qZA()()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,6,"igo.context.bookmarkButton.dialog.title")),e.xp6(4),e.Q6J("placeholder",e.lcZ(6,8,"igo.context.bookmarkButton.dialog.placeholder"))("ngModel",o.title),e.xp6(3),e.Q6J("disabled",!o.title),e.xp6(1),e.hij(" ",e.lcZ(10,10,"igo.common.confirmDialog.confirmBtn")," "),e.xp6(3),e.hij(" ",e.lcZ(13,12,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[_.Fj,_.JJ,_.Q7,_.nD,_.On,w.lW,I.KE,P.uh,P.xY,P.H8,H.Nt,L.X$],encapsulation:2}),i})();function CM(i,r){if(1&i&&e._UZ(0,"mat-icon",7),2&i){const t=e.oxw(2);e.s9C("svgIcon",t.context.icon?t.context.icon:"public"===t.context.scope?"earth":"star")}}function xM(i,r){if(1&i&&e._UZ(0,"img",8),2&i){const t=e.oxw(2);e.Q6J("src",t.context.iconImage,e.LSH)}}function SM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.favoriteClick(n.context))}),e.ALo(1,"translate"),e.YNc(2,CM,1,1,"mat-icon",5),e.YNc(3,xM,1,1,"img",6),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",t.auth.authenticated?e.lcZ(1,4,"igo.context.contextManager.favorite"):"")("color",t.default?"primary":"default"),e.xp6(2),e.Q6J("ngIf",!t.context.iconImage),e.xp6(1),e.Q6J("ngIf",t.context.iconImage)}}function wM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.favoriteClick(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",9),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.favorite"))("color",t.default?"primary":"default")}}function TM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.save.emit(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",22),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.save"))("color",t.color)}}function MM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.managePermissions.emit(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",24),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.managePermissions"))("color",t.color)}}function FM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.clone.emit(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",26),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.clone"))("color",t.color)}}function AM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.edit.emit(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",28),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.edit"))}}function LM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.hide.emit(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",30),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.hide"))}}function IM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.show.emit(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",31),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.show"))}}function OM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.delete.emit(n.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",33),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.delete"))}function ZM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",10),e.YNc(1,TM,3,4,"button",11),e.TgZ(2,"div",12,13),e.YNc(4,MM,3,4,"button",14),e.YNc(5,FM,3,4,"button",15),e.YNc(6,AM,3,4,"button",16),e.YNc(7,LM,3,4,"button",17),e.YNc(8,IM,3,4,"button",17),e.YNc(9,OM,3,3,"button",18),e.qZA(),e.TgZ(10,"button",19),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.collapsed=!n.collapsed)}),e._UZ(11,"mat-icon",20),e.qZA()()}if(2&i){const t=e.MAs(3),o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.collapsed&&o.selected&&(o.context.permission===o.typePermission[o.typePermission.write]||o.context.imported)),e.xp6(3),e.Q6J("ngIf",o.canShare&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.permission===o.typePermission[o.typePermission.write]&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",!o.context.hidden&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.hidden&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.permission===o.typePermission[o.typePermission.write]||o.context.imported),e.xp6(1),e.Q6J("color",o.color)("target",t)("collapsed",o.collapsed)}}const DM=function(i){return{"mat-list-item-light":i}};let kM=(()=>{class i{constructor(t,o){this.auth=t,this.storageService=o,this.typePermission=Pt,this.color="primary",this.collapsed=!0,this.showFavorite=!0,this.edit=new e.vpe,this.delete=new e.vpe,this.save=new e.vpe,this.clone=new e.vpe,this.hide=new e.vpe,this.show=new e.vpe,this.favorite=new e.vpe,this.managePermissions=new e.vpe,this.manageTools=new e.vpe}get hidden(){return this.context.hidden}get canShare(){return!0===this.storageService.get("canShare")}favoriteClick(t){this.favorite.emit(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye),e.Y36(ce))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-context-item"]],inputs:{showFavorite:"showFavorite",context:"context",default:"default",selected:"selected"},outputs:{edit:"edit",delete:"delete",save:"save",clone:"clone",hide:"hide",show:"show",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools"},decls:6,vars:7,consts:[[1,"mat-list-item",3,"ngClass"],["mat-list-avatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["matLine",""],["igoStopPropagation","","class","igo-actions-container",4,"ngIf"],["mat-list-avatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click"],[3,"svgIcon",4,"ngIf"],[3,"src",4,"ngIf"],[3,"svgIcon"],[3,"src"],["svgIcon","star"],["igoStopPropagation","",1,"igo-actions-container"],["class","save-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],[1,"igo-actions-expand-container"],["actions",""],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","clone-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","edit-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","hide-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","delete-button","mat-icon-button","","color","warn","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","igoCollapse","",1,"actions-button",3,"color","target","collapsed","click"],["svgIcon","dots-horizontal"],["mat-icon-button","","matTooltipShowDelay","500",1,"save-button",3,"matTooltip","color","click"],["svgIcon","content-save"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","account-arrow-right"],["mat-icon-button","","matTooltipShowDelay","500",1,"clone-button",3,"matTooltip","color","click"],["svgIcon","content-copy"],["mat-icon-button","","matTooltipShowDelay","500",1,"edit-button",3,"color","matTooltip","click"],["svgIcon","pencil"],["mat-icon-button","","matTooltipShowDelay","500",1,"hide-button",3,"color","matTooltip","click"],["svgIcon","eye"],["svgIcon","eye-off"],["mat-icon-button","","color","warn","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-list-item",0),e.YNc(1,SM,4,6,"button",1),e.YNc(2,wM,3,4,"button",1),e.TgZ(3,"h4",2),e._uU(4),e.qZA(),e.YNc(5,ZM,12,10,"div",3),e.qZA()),2&t&&(e.Q6J("ngClass",e.VKq(5,DM,o.hidden)),e.xp6(1),e.Q6J("ngIf",o.auth.authenticated),e.xp6(1),e.Q6J("ngIf",!o.auth.authenticated&&o.showFavorite),e.xp6(2),e.Oqu(o.context.title),e.xp6(1),e.Q6J("ngIf",o.auth.authenticated))},dependencies:[f.mk,f.O5,T.Hw,w.lW,O.gM,G.Tg,G.eA,Q.X2,Li,Ai,L.X$],styles:["[_nghost-%COMP%]{overflow:hidden}.igo-actions-container[_ngcontent-%COMP%]{flex-shrink:0}.igo-actions-expand-container[_ngcontent-%COMP%]{display:inline-flex}mat-list-item[_ngcontent-%COMP%]     .mat-list-item-content .mat-list-text{padding:0}mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}mat-list-item.mat-list-item-light[_ngcontent-%COMP%]     .mat-list-item-content{color:#969696}"],changeDetection:0}),i})();function PM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.clearFilter())}),e._UZ(1,"mat-icon",15),e.qZA()}}function $M(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",11)(1,"input",12),e.NdJ("ngModelChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.term=n)}),e.ALo(2,"translate"),e.qZA(),e.YNc(3,PM,2,0,"button",13),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngClass",t.auth.authenticated&&t.configService.getConfig("context")?"context-filter-min-width":"context-filter-max-width"),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,4,"igo.context.contextManager.filterPlaceHolder"))("ngModel",t.term),e.xp6(2),e.Q6J("ngIf",t.term.length)}}function EM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleSort(!0))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",17),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.sortAlphabetically"))}function JM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.toggleSort(!1))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",18),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.sortContextOrder"))}function RM(i,r){if(1&i&&e._UZ(0,"igo-actionbar",19),2&i){const t=e.oxw();e.Q6J("iconColor",t.color)("store",t.actionStore)("withIcon",!0)("withTitle","overlay"===t.actionbarMode)("horizontal",!1)("mode",t.actionbarMode)}}function BM(i,r){if(1&i&&(e.TgZ(0,"button",20),e.ALo(1,"translate"),e._UZ(2,"mat-icon",21),e.qZA()),2&i){e.oxw();const t=e.MAs(7);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.filterUser"))("matMenuTriggerFor",t)}}function UM(i,r){if(1&i&&(e.TgZ(0,"button",27),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.MAs(6);e.Q6J("matMenuTriggerFor",o),e.xp6(1),e.hij(" ",t.title," ")}}function NM(i,r){if(1&i&&(e.TgZ(0,"button",9),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function qM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",8),e.NdJ("click",function(n){return n.stopPropagation()})("change",function(){const s=e.CHM(t).$implicit,a=e.oxw().$implicit,l=e.oxw();return e.KtG(l.userSelection(s,a))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(2);e.Q6J("checked",o.getPermission(t).checked),e.xp6(1),e.hij(" ",t.title," ")}}function GM(i,r){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"span",7)(2,"mat-checkbox",22),e.NdJ("click",function(n){return n.stopPropagation()})("change",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.userSelection(s))}),e.qZA(),e.YNc(3,UM,2,2,"button",23),e.YNc(4,NM,2,1,"button",24),e.qZA(),e.TgZ(5,"mat-menu",null,25),e.YNc(7,qM,2,2,"mat-checkbox",26),e.qZA(),e.BQk()}if(2&i){const t=r.$implicit,o=e.oxw();e.xp6(2),e.Q6J("checked",o.getPermission(t).checked)("indeterminate",o.getPermission(t).indeterminate),e.xp6(1),e.Q6J("ngIf",t.childs),e.xp6(1),e.Q6J("ngIf",!t.childs),e.xp6(3),e.Q6J("ngForOf",t.childs)}}function QM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-context-item",31),e.NdJ("edit",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.edit.emit(s))})("delete",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.delete.emit(s))})("clone",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.clone.emit(s))})("save",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.save.emit(s))})("hide",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.hideContext(s))})("show",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.showContext(s))})("favorite",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.favorite.emit(s))})("manageTools",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.manageTools.emit(s))})("managePermissions",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.managePermissions.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.select.emit(s))})("unselect",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.unselect.emit(s))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("selected",o.selectedContext&&o.selectedContext.uri===t.uri)("context",t)("default",t.id&&o.defaultContextId&&o.defaultContextId===t.id)}}function jM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-collapsible",30),e.NdJ("toggle",function(n){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw();return e.KtG(a.collapsed[a.titleMapping[s.key]]=n)}),e.ALo(1,"translate"),e.YNc(2,QM,1,3,"ng-template",10),e.qZA()}if(2&i){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("title",e.lcZ(1,3,o.titleMapping[t.key]))("collapsed",o.collapsed[o.titleMapping[t.key]]),e.xp6(2),e.Q6J("ngForOf",t.value)}}function YM(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-context-item",32),e.NdJ("favorite",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.favorite.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.select.emit(s))})("unselect",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.unselect.emit(s))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw(3);e.Q6J("showFavorite",o.configService.getConfig("favoriteContext4NonAuthenticated"))("selected",o.selectedContext&&o.selectedContext.uri===t.uri)("context",t)("default",o.configService.getConfig("context")?o.defaultContextId===t.id:o.defaultContextId===t.uri)}}function HM(i,r){if(1&i&&e.YNc(0,YM,1,4,"ng-template",10),2&i){const t=e.oxw().$implicit;e.Q6J("ngForOf",t.value)}}function VM(i,r){if(1&i&&(e.YNc(0,jM,3,5,"igo-collapsible",28),e.YNc(1,HM,1,1,null,29)),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",t.value.length&&o.auth.authenticated),e.xp6(1),e.Q6J("ngIf",t.value.length&&!o.auth.authenticated)}}let hs=(()=>{class i{constructor(t,o,n,s,a,l){this.cdRef=t,this.configService=o,this.auth=n,this.dialog=s,this.languageService=a,this.storageService=l,this.contextsInitial={ours:[]},this.contexts$=new b.X(this.contextsInitial),this.change$=new hn.t(1),this._contexts={ours:[]},this.collapsed=[],this.select=new e.vpe,this.unselect=new e.vpe,this.edit=new e.vpe,this.delete=new e.vpe,this.save=new e.vpe,this.clone=new e.vpe,this.create=new e.vpe,this.hide=new e.vpe,this.show=new e.vpe,this.showHiddenContexts=new e.vpe,this.favorite=new e.vpe,this.managePermissions=new e.vpe,this.manageTools=new e.vpe,this.filterPermissionsChanged=new e.vpe,this.titleMapping={ours:"igo.context.contextManager.ourContexts",shared:"igo.context.contextManager.sharedContexts",public:"igo.context.contextManager.publicContexts"},this.permissions=[],this.actionStore=new Eo([]),this.actionbarMode=Mo.Overlay,this.color="primary",this.showHidden=!1,this._term="",this._sortedAlpha=void 0,this.showContextFilter=rn.always,this.thresholdToFilter=5}get contexts(){return this._contexts}set contexts(t){this._contexts=t,this.cdRef.detectChanges(),this.next()}get selectedContext(){return this._selectedContext}set selectedContext(t){this._selectedContext=t,this.cdRef.detectChanges()}get map(){return this._map}set map(t){this._map=t}get defaultContextId(){return this.configService.getConfig("context")?this._defaultContextId:this.storageService.get("favorite.context.uri")||this._defaultContextId}set defaultContextId(t){this._defaultContextId=t}set term(t){this._term=t,this.next()}get term(){return this._term}get sortedAlpha(){return this._sortedAlpha}set sortedAlpha(t){this._sortedAlpha=t,this.next()}ngOnInit(){this.change$$=this.change$.pipe((0,Tn.D)(()=>{var t,o;return 0===this.contexts.ours.length&&0===(null===(t=this.contexts.public)||void 0===t?void 0:t.length)&&0===(null===(o=this.contexts.shared)||void 0===o?void 0:o.length)?Bi.E:(0,wn.H)(50)})).subscribe(()=>{this.contexts$.next(this.filterContextsList(this.contexts))}),this.actionStore.load([{id:"emptyContext",title:this.languageService.translate.instant("igo.context.contextManager.emptyContext"),icon:"map-outline",tooltip:this.languageService.translate.instant("igo.context.contextManager.emptyContextTooltip"),handler:()=>{this.createContext(!0)}},{id:"contextFromMap",title:this.languageService.translate.instant("igo.context.contextManager.contextMap"),icon:"map-check",tooltip:this.languageService.translate.instant("igo.context.contextManager.contextMapTooltip"),handler:()=>{this.createContext(!1)}}])}next(){this.change$.next()}filterContextsList(t){if(""===this.term)return this.sortedAlpha&&(t=this.sortContextsList(t)),t;{let n={ours:t.ours.filter(s=>{const a=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return s.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(a)})};if(this.contexts.public){const s=t.public.filter(a=>{const l=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(l)});n.public=s}if(this.contexts.shared){const s=t.shared.filter(a=>{const l=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(l)});n.shared=s}return this.sortedAlpha&&(n=this.sortContextsList(n)),n}}ngOnDestroy(){this.change$$.unsubscribe()}showFilter(){switch(this.showContextFilter){case rn.always:return!0;case rn.never:return!1;default:let t=this.contexts.ours.length;return t+=this.contexts.public?this.contexts.public.length:0,t+=this.contexts.shared?this.contexts.shared.length:0,t>=this.thresholdToFilter}}sortContextsList(t){if(t){const o=JSON.parse(JSON.stringify(t));return o.ours.sort((n,s)=>this.normalize(n.title)<this.normalize(s.title)?-1:this.normalize(n.title)>this.normalize(s.title)?1:0),o.shared?o.shared.sort((n,s)=>this.normalize(n.title)<this.normalize(s.title)?-1:this.normalize(n.title)>this.normalize(s.title)?1:0):o.public&&o.public.sort((n,s)=>this.normalize(n.title)<this.normalize(s.title)?-1:this.normalize(n.title)>this.normalize(s.title)?1:0),o}}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}toggleSort(t){this.sortedAlpha=t}clearFilter(){this.term=""}createContext(t){this.dialog.open(Pp,{disableClose:!1}).afterClosed().pipe((0,Ee.q)(1)).subscribe(o=>{o&&this.create.emit({title:o,empty:t})})}getPermission(t){if(t)return this.permissions.find(n=>n.name===t.name)}userSelection(t,o){const n=this.getPermission(t);if(n&&(n.checked=!n.checked,this.storageService.set("contexts.permissions."+n.name,n.checked),n.indeterminate=!1),o){let s=!1;for(const l of o.childs)if(this.getPermission(l).checked!==n.checked){s=!0;break}const a=this.getPermission(o);a&&(a.checked=n.checked,this.storageService.set("contexts.permissions."+a.name,n.checked),a.indeterminate=s)}if(t.childs)for(const s of t.childs){const a=this.getPermission(s);a&&a.checked!==n.checked&&(a.checked=n.checked,this.storageService.set("contexts.permissions."+a.name,n.checked))}this.filterPermissionsChanged.emit(this.permissions)}hideContext(t){if(t.hidden=!0,!this.showHidden){const o={ours:[],shared:[],public:[]};o.ours=this.contexts.ours.filter(n=>n.id!==t.id),o.shared=this.contexts.shared.filter(n=>n.id!==t.id),o.public=this.contexts.public.filter(n=>n.id!==t.id),this.contexts=o}this.hide.emit(t)}showContext(t){t.hidden=!1,this.show.emit(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(J),e.Y36(Ye),e.Y36(P.uw),e.Y36(D),e.Y36(ce))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-context-list"]],inputs:{contexts:"contexts",selectedContext:"selectedContext",map:"map",defaultContextId:"defaultContextId",term:"term"},outputs:{select:"select",unselect:"unselect",edit:"edit",delete:"delete",save:"save",clone:"clone",create:"create",hide:"hide",show:"show",showHiddenContexts:"showHiddenContexts",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools",filterPermissionsChanged:"filterPermissionsChanged"},decls:17,vars:16,consts:[[3,"navigation"],[3,"ngClass",4,"ngIf"],["class","sort-alpha","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","add-context-button","icon","plus",3,"iconColor","store","withIcon","withTitle","horizontal","mode",4,"ngIf"],["class","users-filter","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["accountMenu","matMenu"],[4,"ngFor","ngForOf"],[1,"profilsMenu"],[1,"mat-menu-item",3,"checked","click","change"],["mat-menu-item",""],["ngFor","",3,"ngForOf"],[3,"ngClass"],["matInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["mat-button","","mat-icon-button","","matSuffix","","class","clear-button","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["mat-button","","mat-icon-button","","matSuffix","","aria-label","Clear","color","warn",1,"clear-button",3,"click"],["svgIcon","close"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"matTooltip","click"],["color","primary","svgIcon","sort-alphabetical-variant"],["color","warn","svgIcon","sort-variant-remove"],["icon","plus",1,"add-context-button",3,"iconColor","store","withIcon","withTitle","horizontal","mode"],["mat-icon-button","","matTooltipShowDelay","500",1,"users-filter",3,"matTooltip","matMenuTriggerFor"],["color","primary","svgIcon","filter-menu"],[1,"mat-menu-item",3,"checked","indeterminate","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["subAccountMenu","matMenu"],["class","mat-menu-item",3,"checked","click","change",4,"ngFor","ngForOf"],["mat-menu-item","",3,"matMenuTriggerFor"],[3,"title","collapsed","toggle",4,"ngIf"],[4,"ngIf"],[3,"title","collapsed","toggle"],["igoListItem","","color","accent",3,"selected","context","default","edit","delete","clone","save","hide","show","favorite","manageTools","managePermissions","select","unselect"],["igoListItem","","color","accent",3,"showFavorite","selected","context","default","favorite","select","unselect"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-list",0),e.YNc(1,$M,4,6,"mat-form-field",1),e.YNc(2,EM,3,3,"button",2),e.YNc(3,JM,3,3,"button",2),e.YNc(4,RM,1,6,"igo-actionbar",3),e.YNc(5,BM,3,4,"button",4),e.TgZ(6,"mat-menu",null,5),e.YNc(8,GM,8,5,"ng-container",6),e.TgZ(9,"span",7)(10,"mat-checkbox",8),e.NdJ("click",function(s){return s.stopPropagation()})("change",function(){return o.showHiddenContexts.emit()}),e.qZA(),e.TgZ(11,"button",9),e._uU(12),e.ALo(13,"translate"),e.qZA()()(),e.YNc(14,VM,2,2,"ng-template",10),e.ALo(15,"keyvalue"),e.ALo(16,"async"),e.qZA()),2&t&&(e.Q6J("navigation",!0),e.xp6(1),e.Q6J("ngIf",o.showFilter()),e.xp6(1),e.Q6J("ngIf",!o.sortedAlpha),e.xp6(1),e.Q6J("ngIf",o.sortedAlpha),e.xp6(1),e.Q6J("ngIf",o.auth.authenticated&&o.configService.getConfig("context")),e.xp6(1),e.Q6J("ngIf",o.auth.authenticated&&o.configService.getConfig("context")),e.xp6(3),e.Q6J("ngForOf",o.users),e.xp6(2),e.Q6J("checked",o.showHidden),e.xp6(2),e.hij(" ",e.lcZ(13,10,"igo.context.contextManager.showHidden")," "),e.xp6(2),e.Q6J("ngForOf",e.lcZ(15,12,e.lcZ(16,14,o.contexts$))))},dependencies:[f.mk,f.sg,f.O5,_.Fj,_.JJ,_.On,I.KE,I.R9,H.Nt,T.Hw,w.lW,O.gM,Ge.oG,$e.VK,$e.OP,$e.p6,Zt,mo,Ds,vn,kM,f.Ov,ci,L.X$],styles:[".context-filter-max-width[_ngcontent-%COMP%]{width:calc(100% - 100px);margin:5px;padding-left:6px}.context-filter-min-width[_ngcontent-%COMP%]{width:calc(100% - 135px);margin:5px;padding-left:6px}mat-form-field[_ngcontent-%COMP%]{height:40px}.profilsMenu[_ngcontent-%COMP%]{display:flex}.profilsMenu[_ngcontent-%COMP%] > mat-checkbox[_ngcontent-%COMP%]{width:8px}.add-context-button[_ngcontent-%COMP%]{margin:0;width:40px;display:inline-flex;overflow:hidden}"],changeDetection:0}),i})(),gl=(()=>{class i{constructor(t,o,n,s,a,l,c,u,p){this.contextService=o,this.mapService=n,this.languageService=s,this.confirmDialogService=a,this.messageService=l,this.auth=c,this.storageService=u,this.cdRef=p,this.component=t}onSelect(t){this.contextService.loadContext(t.uri)}onEdit(t){this.contextService.loadEditedContext(t.uri)}onSave(t){const o=this.mapService.getMap(),n=this.contextService.getContextFromMap(o),s=()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:t.title})};if(t.imported)return n.title=t.title,this.contextService.delete(t.id,!0),void this.contextService.create(n).subscribe(l=>{this.contextService.loadContext(l.uri),s()});this.contextService.update(t.id,{layers:n.layers,map:{view:n.map.view}}).subscribe(()=>{s()})}onFavorite(t){t.id||(t.id=t.uri),this.contextService.setDefault(t.id).subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId),this.contextService.defaultContextId$.next(t.id);const o=this.messageService.success("igo.context.contextManager.dialog.favoriteMsg","igo.context.contextManager.dialog.favoriteTitle",void 0,{value:t.title});this.previousMessageId=o.toastId,this.cdRef.detectChanges()})}onManageTools(t){this.contextService.loadEditedContext(t.uri)}onManagePermissions(t){this.contextService.loadEditedContext(t.uri)}onDelete(t){this.confirmDialogService.open(this.languageService.translate.instant("igo.context.contextManager.dialog.confirmDelete")).subscribe(n=>{n&&this.contextService.delete(t.id,t.imported).subscribe(()=>{this.messageService.info("igo.context.contextManager.dialog.deleteMsg","igo.context.contextManager.dialog.deleteTitle",void 0,{value:t.title})})})}onClone(t){this.contextService.clone(t.id,{title:t.title+"-copy",uri:t.uri+"-copy"}).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.cloneMsg","igo.context.contextManager.dialog.cloneTitle",void 0,{value:t.title})})}onCreate(t){const{title:o,empty:n}=t,s=this.contextService.getContextFromMap(this.component.map,n);s.title=o,this.contextService.create(s).subscribe(()=>{this.messageService.success("igo.context.bookmarkButton.dialog.createMsg","igo.context.bookmarkButton.dialog.createTitle",void 0,{value:s.title}),this.contextService.loadContext(s.uri)})}loadContexts(){const t=["none"];for(const o of this.component.permissions)(!0===o.checked||!0===o.indeterminate)&&t.push(o.name);this.contextService.loadContexts(t,!!this.component.showHidden)}showHiddenContexts(){this.component.showHidden=!this.component.showHidden,this.storageService.set("contexts.showHidden",this.component.showHidden),this.loadContexts()}onShowContext(t){this.contextService.showContext(t.id).subscribe()}onHideContext(t){this.contextService.hideContext(t.id).subscribe()}ngOnInit(){this.component.contexts={ours:[]},this.component.showHidden=this.storageService.get("contexts.showHidden"),this.contexts$$=this.contextService.contexts$.subscribe(o=>this.handleContextsChange(o)),this.defaultContextId$$=this.contextService.defaultContextId$.subscribe(o=>{this.component.defaultContextId=o});const t=this.storageService.get("favorite.context.uri");t&&!this.auth.authenticated&&this.contextService.defaultContextId$.next(t),this.selectedContext$$=this.contextService.context$.pipe((0,fe.b)(100)).subscribe(o=>this.component.selectedContext=o),this.auth.authenticate$.subscribe(o=>{o&&this.contextService.getProfilByUser().subscribe(n=>{this.component.users=n,this.component.permissions=[];const s=this.component.users.reduce((l,c)=>(l=l.concat(c),c.childs?l.concat(c.childs):l),[]);for(const l of s){const c={name:l.name,checked:this.storageService.get("contexts.permissions."+l.name)};null===c.checked&&(c.checked=!0),this.component.permissions.push(c)}const a=["none"];for(const l of this.component.permissions)(!0===l.checked||!0===l.indeterminate)&&a.push(l.name);this.contextService.loadContexts(a,!!this.component.showHidden)})})}ngOnDestroy(){this.contexts$$.unsubscribe(),this.selectedContext$$.unsubscribe(),this.defaultContextId$$.unsubscribe()}handleContextsChange(t){this.component.contexts=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(hs,2),e.Y36(Co),e.Y36(Ut),e.Y36(D),e.Y36(bn),e.Y36(_e),e.Y36(Ye),e.Y36(ce),e.Y36(e.sBO))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoContextListBinding",""]],hostBindings:function(t,o){1&t&&e.NdJ("select",function(s){return o.onSelect(s)})("edit",function(s){return o.onEdit(s)})("save",function(s){return o.onSave(s)})("favorite",function(s){return o.onFavorite(s)})("manageTools",function(s){return o.onManageTools(s)})("managePermissions",function(s){return o.onManagePermissions(s)})("delete",function(s){return o.onDelete(s)})("clone",function(s){return o.onClone(s)})("create",function(s){return o.onCreate(s)})("filterPermissionsChanged",function(){return o.loadContexts()})("showHiddenContexts",function(){return o.showHiddenContexts()})("show",function(s){return o.onShowContext(s)})("hide",function(s){return o.onHideContext(s)})}}),i})(),Jp=(()=>{class i{constructor(t,o){this.http=t,this.config=o,this.baseUrl=this.config.getConfig("context.url")}get(){return this.baseUrl?this.http.get(this.baseUrl+"/pois"):Bi.E}delete(t){return this.http.delete(this.baseUrl+"/pois/"+t)}create(t){return this.http.post(this.baseUrl+"/pois",t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(q.eN),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),Rp=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Jp],imports:[f.ez,oe,kl,vr,oa,_.u5,T.Ps,w.ot,ue.LD,Q.Ng,O.AV,I.lN,P.Is,H.c]}),i})(),ml=(()=>{class i{static forRoot(){return{ngModule:i}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,I.lN,H.c,T.Ps,w.ot,O.AV,G.ie,Ge.p9,nt.Fk,P.Is,$e.Tx,Q.Ng,Xe.Bb,oa,ui,ki,Ii,vr,oe,dl,Rp,pr]}),i})();var sn=(()=>{return(i=sn||(sn={})).layer="layer",i.context="context",sn;var i})(),xo=(()=>{return(i=xo||(xo={})).import="import",i.export="export",xo;var i})();let an=(()=>{class i{constructor(){this.importExportType$=new b.X(sn.layer),this.selectedMode$=new b.X(xo.import),this.exportOptions$=new b.X(void 0)}setImportExportType(t){this.importExportType$.next(t)}setMode(t){this.selectedMode$.next(t)}setsExportOptions(t){this.exportOptions$.next(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),$t=(()=>{class i{constructor(t,o){this.toolService=t,this.importExportState=o,this.openSidenav$=new b.X(void 0)}get toolbox(){return this.toolService.toolbox}toolToActivateFromOptions(t){if(t){if("importExport"===t.tool){let o=this.importExportState.exportOptions$.value;o?(o.layers=t.options.layers,o.featureInMapExtent=t.options.featureInMapExtent):o={layers:t.options.layers,featureInMapExtent:t.options.featureInMapExtent},this.importExportState.setsExportOptions(o),this.importExportState.setMode(xo.export)}this.toolbox.getTool(t.tool)&&(this.toolbox.activateTool(t.tool),this.openSidenav$.next(!0))}}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Di),e.LFG(an))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ne=(()=>{class i{constructor(t,o,n,s){this.mapService=t,this.projectionService=o,this.storageService=n,this.configService=s,this._map=new ot({controls:{scaleLine:!0,attribution:{collapsed:!0}}},this.storageService,this.configService),this.mapService.setMap(this.map)}get showAllLegendsValue(){return this._legendToolShowAll}set showAllLegendsValue(t){this._legendToolShowAll=t}get map(){return this._map}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Ut),e.LFG(Pn),e.LFG(ce),e.LFG(J))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function ln(i,r){i.entityStore.getStrategyOfType(Mt).setMotion(r.get("zoomAuto")?Y.Default:Y.None)}let hl=(()=>{class i{constructor(t){this.igoStorageService=t}get storageService(){return this.igoStorageService}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ce))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),iA=(()=>{class i{constructor(t,o,n,s){this.storageState=t,this.languageService=o,this.toolState=n,this.mediaService=s,this.maximize$=new b.X(this.storageService.get("workspaceMaximize")),this.zoomAuto$=new b.X(!1)}get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(t,o,n){const s=this.buildActions(t,o,n);t.actionStore.load(s)}buildActions(t,o,n){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,At.n)(s=>"zoomAuto"!==s.key||s.event===go.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ln(t,this.storageService)}),[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:this.zoomAuto$,handler:()=>{ln(t,this.storageService),this.storageService.set("zoomAuto",!this.storageService.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:cl(t),checkCondition:o,handler:()=>o.next(!o.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.tooltip",checkCondition:n,handler:()=>n.next(!n.value)},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:s=>{s.entityStore.state.updateMany(s.entityStore.view.all(),{selected:!1})},args:[t],availability:s=>ul(s)},{id:"featureDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:s=>{const a=s.entityStore.getStrategyOfType(Jt),c=s.entityStore.getStrategyOfType(To).active?[s.layer.id]:[];this.toolState.toolToActivateFromOptions({tool:"importExport",options:{layers:[s.layer.id],featureInMapExtent:a.active,layersWithSelection:c}})},args:[t]},{id:"maximize",title:this.languageService.translate.instant("igo.integration.workspace.maximize"),tooltip:this.languageService.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>this.maximize$.pipe((0,Z.U)(s=>!s&&!this.mediaService.isMobile())),handler:()=>{this.mediaService.isMobile()||this.maximize$.next(!0)}},{id:"standardExtent",title:this.languageService.translate.instant("igo.integration.workspace.standardExtent"),tooltip:this.languageService.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>this.maximize$.pipe((0,Z.U)(s=>s&&!this.mediaService.isMobile())),handler:()=>{this.maximize$.next(!1)}}]}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(hl),e.LFG(D),e.LFG($t),e.LFG(gt))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),nA=(()=>{class i{constructor(t,o,n,s,a){this.ogcFilterWidget=t,this.storageState=o,this.languageService=n,this.mediaService=s,this.toolState=a,this.maximize$=new b.X(this.storageService.get("workspaceMaximize")),this.selectOnlyCheckCondition$=new b.X(!1),this.zoomAuto$=new b.X(!1)}get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(t,o,n){const s=this.buildActions(t,o,n);t.actionStore.load(s)}buildActions(t,o,n){var s;this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,At.n)(l=>"zoomAuto"!==(null==l?void 0:l.key)||(null==l?void 0:l.event)===go.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ln(t,this.storageService)});const a=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:this.zoomAuto$,handler:()=>{ln(t,this.storageService),this.storageService.set("zoomAuto",!this.storageService.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:cl(t),checkCondition:o,handler:()=>o.next(!o.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.title",checkCondition:n,handler:()=>n.next(!n.value)},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:l=>{l.entityStore.state.updateMany(l.entityStore.view.all(),{selected:!1})},args:[t],availability:l=>ul(l)},{id:"wfsDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:l=>{const c=l.entityStore.getStrategyOfType(Jt),p=l.entityStore.getStrategyOfType(To).active?[l.layer.id]:[];this.toolState.toolToActivateFromOptions({tool:"importExport",options:{layers:[l.layer.id],featureInMapExtent:c.active,layersWithSelection:p}})},args:[t]},{id:"ogcFilter",icon:"filter",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:(l,c)=>{c.activateWidget(l,{map:c.map,layer:c.layer})},args:[this.ogcFilterWidget,t]},{id:"maximize",title:this.languageService.translate.instant("igo.integration.workspace.maximize"),tooltip:this.languageService.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>this.maximize$.pipe((0,Z.U)(l=>!l&&!this.mediaService.isMobile())),handler:()=>{this.mediaService.isMobile()||this.maximize$.next(!0)}},{id:"standardExtent",title:this.languageService.translate.instant("igo.integration.workspace.standardExtent"),tooltip:this.languageService.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>this.maximize$.pipe((0,Z.U)(l=>l&&!this.mediaService.isMobile())),handler:()=>{this.maximize$.next(!1)}}];return null!==(s=t.layer.dataSource.options.ogcFilters)&&void 0!==s&&s.enabled?a:a.filter(l=>"ogcFilter"!==l.id)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(rl),e.LFG(hl),e.LFG(D),e.LFG(gt),e.LFG($t))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),rA=(()=>{class i{constructor(t,o,n,s,a){this.ogcFilterWidget=t,this.storageState=o,this.languageService=n,this.mediaService=s,this.toolState=a,this.maximize$=new b.X(this.storageService.get("workspaceMaximize")),this.zoomAuto$=new b.X(!1)}get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(t,o,n){const s=this.buildActions(t,o,n);t.actionStore.load(s)}buildActions(t,o,n){var s;this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,At.n)(l=>"zoomAuto"!==(null==l?void 0:l.key)||(null==l?void 0:l.event)===go.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ln(t,this.storageService)});const a=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:this.zoomAuto$,handler:()=>{ln(t,this.storageService),this.storageService.set("zoomAuto",!this.storageService.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:cl(t),checkCondition:o,handler:()=>o.next(!o.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.title",checkCondition:n,handler:()=>n.next(!n.value)},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:l=>{l.entityStore.state.updateMany(l.entityStore.view.all(),{selected:!1})},args:[t],availability:l=>ul(l)},{id:"wfsDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:l=>{const c=l.entityStore.getStrategyOfType(Jt),p=l.entityStore.getStrategyOfType(To).active?[l.layer.id]:[];this.toolState.toolToActivateFromOptions({tool:"importExport",options:{layers:[l.layer.id],featureInMapExtent:c.active,layersWithSelection:p}})},args:[t]},{id:"ogcFilter",icon:"filter",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:(l,c)=>{c.activateWidget(l,{map:c.map,layer:c.layer})},args:[this.ogcFilterWidget,t]},{id:"maximize",title:this.languageService.translate.instant("igo.integration.workspace.maximize"),tooltip:this.languageService.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>this.maximize$.pipe((0,Z.U)(l=>!l&&!this.mediaService.isMobile())),handler:()=>{this.mediaService.isMobile()||this.maximize$.next(!0)}},{id:"standardExtent",title:this.languageService.translate.instant("igo.integration.workspace.standardExtent"),tooltip:this.languageService.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>this.maximize$.pipe((0,Z.U)(l=>l&&!this.mediaService.isMobile())),handler:()=>{this.maximize$.next(!1)}}];return null!==(s=t.layer.dataSource.options.ogcFilters)&&void 0!==s&&s.enabled?a:a.filter(l=>"ogcFilter"!==l.id)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(rl),e.LFG(hl),e.LFG(D),e.LFG(gt),e.LFG($t))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),or=(()=>{class i{constructor(t,o,n,s){this.featureActionsService=t,this.wfsActionsService=o,this.editionActionsService=n,this.storageService=s,this.workspacePanelExpanded=!1,this.workspaceEnabled$=new b.X(!1),this.rowsInMapExtentCheckCondition$=new b.X(!0),this.selectOnlyCheckCondition$=new b.X(!1),this.workspaceMaximize$=new b.X(this.storageService.get("workspaceMaximize")),this.actionMaximize$$=[],this.activeWorkspaceWidget$=new b.X(void 0),this.workspace$=new b.X(void 0),this.initWorkspaces()}get store(){return this._store}get workspaceSelection(){var t;return this.workspace$.value?null===(t=this.workspace$.value)||void 0===t?void 0:t.entityStore.stateView.manyBy(o=>!0===o.state.selected):[]}get workspaceSelection$(){var t,o;return this.workspace$.value?null===(o=null===(t=this.workspace$.value)||void 0===t?void 0:t.entityStore)||void 0===o?void 0:o.stateView.manyBy$(n=>!0===n.state.selected):(0,X.of)([])}initWorkspaces(){this._store=new zl([]),this._store.stateView.firstBy$(t=>!0===t.state.active).subscribe(t=>{this.workspace$.next(t?t.entity:void 0)}),this._store.stateView.all$().subscribe(t=>{t.map(o=>{o.entity.actionStore.empty&&(o.entity instanceof al?this.wfsActionsService.loadActions(o.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):o.entity instanceof ll?this.featureActionsService.loadActions(o.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):o.entity instanceof mp&&this.editionActionsService.loadActions(o.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$))})}),this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(t=>{this.setWorkspaceIsMaximized(t)})),this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(t=>{this.setWorkspaceIsMaximized(t)})),this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(t=>{this.setWorkspaceIsMaximized(t)})),this.activeWorkspace$$=this.workspace$.subscribe(t=>{void 0!==this.activeWorkspaceWidget$$&&(this.activeWorkspaceWidget$$.unsubscribe(),this.activeWorkspaceWidget$$=void 0),void 0!==t&&(this.activeWorkspaceWidget$$=t.widget$.subscribe(o=>this.activeWorkspaceWidget$.next(o)))}),this.rowsInMapExtentCheckCondition$$=this.rowsInMapExtentCheckCondition$.subscribe(t=>{this._store.stateView.all().map(o=>{if(!o.entity.actionStore.empty){const n=o.entity.entityStore.getStrategyOfType(Jt);n&&(t?n.activate():n.deactivate())}})}),this.selectOnlyCheckCondition$$=this.selectOnlyCheckCondition$.subscribe(t=>{this._store.stateView.all().map(o=>{if(!o.entity.actionStore.empty){const n=o.entity.entityStore.getStrategyOfType(To);n&&(t?n.activate():n.deactivate())}})})}setWorkspaceIsMaximized(t){this.storageService.set("workspaceMaximize",t),this.workspaceMaximize$.next(t)}setActiveWorkspaceById(t){const o=this.store.all().find(n=>n.id===t);o&&this.store.activateWorkspace(o)}setActiveWorkspaceByTitle(t){const o=this.store.all().find(n=>n.title===t);o&&this.store.activateWorkspace(o)}ngOnDestroy(){this.teardownWorkspaces(),this.actionMaximize$$.map(t=>t.unsubscribe()),this.rowsInMapExtentCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe(),this.selectOnlyCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe()}teardownWorkspaces(){this.store.clear(),void 0!==this.activeWorkspaceWidget$$&&this.activeWorkspaceWidget$$.unsubscribe(),void 0!==this.activeWorkspace$$&&this.activeWorkspace$$.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(iA),e.LFG(nA),e.LFG(rA),e.LFG(ce))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),_l=(()=>{class i{constructor(t,o,n,s,a){this.searchSourceService=t,this.storageService=o,this.workspaceState=n,this.configService=s,this.mapState=a,this.searchLayerStores=[],this.searchOverlayStyle={},this.searchOverlayStyleSelection={},this.searchOverlayStyleFocus={},this.searchTermSplitter$=new b.X("|"),this.searchTerm$=new b.X(void 0),this.searchType$=new b.X(void 0),this.searchDisabled$=new b.X(!1),this.searchResultsGeometryEnabled$=new b.X(!1),this.searchSettingsChange$=new b.X(void 0),this.selectedResult$=new b.X(void 0),this.store=new it([]);const l=this.configService.getConfig("searchOverlayStyle");l&&(this.searchOverlayStyle=l.base,this.searchOverlayStyleSelection=l.selection,this.searchOverlayStyleFocus=l.focus);const c=this.storageService.get("searchResultsGeometryEnabled");c&&this.searchResultsGeometryEnabled$.next(c),this.store.addStrategy(this.createCustomFilterTermStrategy(),!1);const u=this.searchSourceService.getSources().find(p=>"workspace"===p.getId());this.workspaceState.store.entities$.subscribe(p=>{const d=p.filter(g=>g instanceof ll&&g.layer.options.workspace.searchIndexEnabled);this.searchSourceService.setWorkspaces(u,d)}),this.monitorLayerDeletion()}get searchTypes(){return this.searchSourceService.getEnabledSources().map(t=>t.constructor.type)}monitorLayerDeletion(){this.mapState.map.layers$.subscribe(t=>{this.searchLayerStores.forEach(o=>{if(!t.find(s=>s.id===o.layer.id)){const s=this.searchLayerStores.indexOf(o);this.searchLayerStores.splice(s,1)}})})}createCustomFilterTermStrategy(){return new Jt({filterClauseFunc:o=>100===o.entity.meta.score})}activateCustomFilterTermStrategy(){const t=this.store.getStrategyOfType(Jt);void 0!==t&&t.activate()}deactivateCustomFilterTermStrategy(){const t=this.store.getStrategyOfType(Jt);void 0!==t&&t.deactivate()}enableSearch(){this.searchDisabled$.next(!1)}disableSearch(){this.searchDisabled$.next(!0)}setSearchTerm(t){this.searchTerm$.next(t)}setSearchType(t){this.searchSourceService.enableSourcesByType(t),this.searchType$.next(t)}setSearchSettingsChange(){this.searchSettingsChange$.next(!0)}setSelectedResult(t){this.selectedResult$.next(t)}setSearchResultsGeometryStatus(t){this.storageService.set("searchResultsGeometryEnabled",t),this.searchResultsGeometryEnabled$.next(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ao),e.LFG(ce),e.LFG(or),e.LFG(J),e.LFG(Ne))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),gL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[ls]}),i})(),vL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,T.Ps,mt.g,O.AV,w.ot,oe,Ao,ls,Js,Tt,Ea,Oi]}),i})(),Hp=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[gL,vL]}),i})();const OL=["mapBrowser"];function ZL(i,r){1&i&&(e.TgZ(0,"span",11),e._uU(1," F2 activate/deactivate the pointer location. "),e.qZA())}function DL(i,r){if(1&i&&e._UZ(0,"igo-search-add-button",12),2&i){const t=r.result,o=e.oxw();e.Q6J("map",o.map)("layer",t)}}function kL(i,r){if(1&i&&(e.TgZ(0,"igo-panel",11),e._UZ(1,"igo-feature-details",13),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("feature",t.selectedFeature)}}function PL(i,r){if(1&i&&e._UZ(0,"igo-actionbar",14),2&i){const t=e.oxw();e.Q6J("store",t.store)("withIcon",!1)("horizontal",!0)("mode","context")}}const EL=te.Bz.forChild([{path:"search",component:(()=>{class i{constructor(t,o,n,s,a,l,c){this.languageService=t,this.projectionService=o,this.mapService=n,this.layerService=s,this.searchState=a,this.mediaService=l,this.storageService=c,this.store=new Eo([]),this.igoSearchPointerSummaryEnabled=!1,this.termSplitter="|",this.map=new ot({overlay:!0,controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.settingsChange$=new b.X(void 0),this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(u=>{this.osmLayer=u,this.map.addLayer(u)}),this.igoReverseSearchCoordsFormatEnabled=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1}get searchStore(){return this.searchState.store}get isTouchScreen(){return this.mediaService.isTouchScreen()}onPointerSummaryStatusChange(t){this.igoSearchPointerSummaryEnabled=t}onSearchTermChange(t){this.term=t,this.searchState.setSearchTerm(t),t.replace(/(#[^\s]*)/g,"").trim().length<2&&(this.searchStore.clear(),this.selectedFeature=void 0)}onSearch(t){const o=t.results;this.searchStore.state.updateAll({focused:!1,selected:!1});const n=this.searchStore.entities$.value.filter(s=>s.source!==t.research.source).concat(o);this.searchStore.updateMany(n)}onReverseCoordsFormatStatusChange(t){this.storageService.set("reverseSearchCoordsFormatEnabled",t),this.igoReverseSearchCoordsFormatEnabled=t}onSearchSettingsChange(){this.settingsChange$.next(!0)}onResultFocus(t){this.tryAddFeatureToMap(t),this.selectedFeature=t.data}tryAddFeatureToMap(t){t.meta.dataType===le&&void 0!==t.data.geometry&&this.map.searchResultsOverlay.setFeatures([t.data],Y.Default)}ngOnInit(){this.store.load([{id:"coordinates",title:"coordinates",handler:()=>this.searchCoordinate(this.lonlat)},{id:"googleMaps",title:"googleMap",handler:()=>this.openGoogleMaps(this.lonlat)},{id:"googleStreetView",title:"googleStreetView",handler:()=>this.openGoogleStreetView(this.lonlat)}])}ngOnDestroy(){this.store.destroy()}removeFeatureFromMap(){this.map.searchResultsOverlay.clear()}onContextMenuOpen(t){const o=this.mapPosition(t),n=this.mapService.getMap().ol.getCoordinateFromPixel(o);this.mapProjection=this.mapService.getMap().projection,this.lonlat=V.vs(n,this.mapProjection,"EPSG:4326")}mapPosition(t){const o=t;return o.y=o.y-this.mapBrowser.nativeElement.getBoundingClientRect().top+window.scrollY,o.x=o.x-this.mapBrowser.nativeElement.getBoundingClientRect().left+window.scrollX,[o.x,o.y]}searchCoordinate(t){this.searchStore.clear(),this.term=this.igoReverseSearchCoordsFormatEnabled?t.reverse().map(o=>o.toFixed(6)).join(", "):t.map(o=>o.toFixed(6)).join(", ")}openGoogleMaps(t){window.open(It.getGoogleMapsCoordLink(t[0],t[1]))}openGoogleStreetView(t){window.open(It.getGoogleStreetViewLink(t[0],t[1]))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(Pn),e.Y36(Ut),e.Y36(Le),e.Y36(_l),e.Y36(gt),e.Y36(ce))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-search"]],viewQuery:function(t,o){if(1&t&&e.Gf(OL,7,e.SBq),2&t){let n;e.iGM(n=e.CRH())&&(o.mapBrowser=n.first)}},decls:30,vars:17,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/search"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"],["title","Details",4,"ngIf"],["igoOverlay","","igoLongPress","","igoSearchPointerSummary","",3,"map","view","igoContextMenu","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","menuPosition"],["mapBrowser",""],["color","primary",3,"map"],["title","Search"],[3,"term","searchSettings","store","termSplitter","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchTermChange","search","clearFeature","searchSettingsChange","reverseSearchCoordsFormatStatus"],["placeholder","false",3,"store","term","termSplitter","settingsChange$","resultFocus","resultSelect","moreResults"],["igoSearchItemToolbar",""],["actionbarMenu",""],["title","Details"],[3,"map","layer"],[3,"feature"],[3,"store","withIcon","horizontal","mode"]],template:function(t,o){if(1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Search"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: ConfigService, LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See search section of the "),e.TgZ(14,"a",1),e._uU(15," environment config"),e.qZA(),e._UZ(16,"hr")(17,"br"),e.YNc(18,ZL,2,0,"span",2),e.qZA(),e.TgZ(19,"igo-map-browser",3,4),e.NdJ("menuPosition",function(s){return o.onContextMenuOpen(s)}),e._UZ(21,"igo-zoom-button",5),e.qZA(),e.TgZ(22,"igo-panel",6)(23,"igo-search-bar",7),e.NdJ("pointerSummaryStatus",function(s){return o.onPointerSummaryStatusChange(s)})("searchTermChange",function(s){return o.onSearchTermChange(s)})("search",function(s){return o.onSearch(s)})("clearFeature",function(){return o.removeFeatureFromMap()})("searchSettingsChange",function(){return o.onSearchSettingsChange()})("reverseSearchCoordsFormatStatus",function(s){return o.onReverseCoordsFormatStatusChange(s)}),e.qZA(),e.TgZ(24,"igo-search-results",8),e.NdJ("resultFocus",function(s){return o.onResultFocus(s)})("resultSelect",function(s){return o.onResultFocus(s)})("moreResults",function(s){return o.onSearch(s)}),e.YNc(25,DL,1,2,"ng-template",null,9,e.W1O),e.qZA()(),e.YNc(27,kL,2,1,"igo-panel",2),e.qZA(),e.YNc(28,PL,1,4,"ng-template",null,10,e.W1O)),2&t){const n=e.MAs(29);e.xp6(18),e.Q6J("ngIf",!o.isTouchScreen),e.xp6(1),e.Q6J("map",o.map)("view",o.view)("igoContextMenu",n)("igoSearchPointerSummaryDelay",500)("igoSearchPointerSummaryEnabled",o.igoSearchPointerSummaryEnabled),e.xp6(2),e.Q6J("map",o.map),e.xp6(2),e.Q6J("term",o.term)("searchSettings",!0)("store",o.searchStore)("termSplitter",o.termSplitter)("reverseSearchCoordsFormatEnabled",o.igoReverseSearchCoordsFormatEnabled),e.xp6(1),e.Q6J("store",o.searchStore)("term",o.term)("termSplitter",o.termSplitter)("settingsChange$",o.settingsChange$),e.xp6(3),e.Q6J("ngIf",o.selectedFeature)}},dependencies:[f.O5,x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,nl,lp,cp,BT,vn,Pl,qg,bi],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{height:100%;width:100%;padding-top:10px}"]}),i})()}]);let JL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:_t,useFactory:Pw,multi:!0,deps:[J,D,ce,Pn]},{provide:_t,useFactory:Lw,multi:!0,deps:[q.eN,D,ce,J,ss,e.zs3]},{provide:_t,useFactory:d2,multi:!0,deps:[D,ce,J]},{provide:_t,useFactory:Rw,multi:!0,deps:[q.eN,D,ce,J,as]},{provide:_t,useFactory:s2,multi:!0,deps:[q.eN,J,ce]},{provide:_t,useFactory:Ow,multi:!0,deps:[q.eN,D,ce,J,e.zs3]},{provide:_t,useFactory:l2,multi:!0,deps:[q.eN,D,ce,J]},{provide:_t,useFactory:u2,multi:!0,deps:[q.eN,D,ce,J]}],imports:[f.ez,EL,x.QW,w.ot,T.Ps,O.AV,wo.forRoot(),Tt,st,ls.forRoot(),Hp,pr,$l,Ao]}),i})();const BL=te.Bz.forChild([{path:"print",component:(()=>{class i{constructor(t,o){this.languageService=t,this.layerService=o,this.map=new ot({controls:{attribution:{collapsed:!1}}}),this.view={center:[-73,47.2],zoom:9},this.layerService.createAsyncLayer({title:"Quebec Base Map",sourceOptions:{type:"wmts",url:"https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts",layer:"carte_gouv_qc_ro",matrixSet:"EPSG_3857",version:"1.3.0",crossOrigin:"anonymous",attributions:"\xa9 <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qu\xe9bec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>"}}).subscribe(n=>this.map.addLayer(n)),this.layerService.createAsyncLayer({title:"School board",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{LAYERS:"MELS_CS_ANGLO_S",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(n=>this.map.addLayer(n)),this.layerService.createAsyncLayer({title:"Embacle",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(n=>this.map.addLayer(n))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-print"]],decls:19,vars:8,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/print"],[3,"map","view"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[3,"map"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Print"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2)(15,"igo-geolocate-button",2)(16,"igo-home-extent-button",2)(17,"igo-rotation-button",3),e.qZA(),e._UZ(18,"igo-print",4),e.qZA()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map)("showIfNoRotation",!1),e.xp6(1),e.Q6J("map",o.map))},dependencies:[x.a8,x.dn,x.n5,x.$j,Ae,pt,Jn,Rn,Bn,Qu],styles:["igo-map-browser[_ngcontent-%COMP%]{width:900px;height:1000px}"]}),i})()}]);let UL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[BL,x.QW,w.ot,wo,st,Ha]}),i})();const qL=te.Bz.forChild([{path:"import-export",component:(()=>{class i{constructor(t,o){this.languageService=t,this.layerService=o,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:9},this.store=new zl([]),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(n=>this.map.addLayer(n))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-import-export"]],decls:16,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/import-export"],[3,"map","view"],["color","primary",3,"map"],[3,"store","map"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Import / Export"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e._UZ(15,"igo-import-export",3),e.qZA()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("store",o.store)("map",o.map))},dependencies:[x.a8,x.dn,x.n5,x.$j,Ae,pt,$u],styles:["igo-map-browser[_ngcontent-%COMP%]{width:900px;height:1000px}"]}),i})()}]);let GL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[xp({path:"./assets/import-style.json"})],imports:[qL,x.QW,w.ot,wo,st,us,es]}),i})();const jL=te.Bz.forChild([{path:"directions",component:(()=>{class i{constructor(t,o,n,s){this.projectionService=t,this.languageService=o,this.layerService=n,this.mapService=s,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:9,geolocate:!1},this.stopsStore=new wp([]),this.stopsFeatureStore=new Tp([],{map:this.map}),this.stepFeatureStore=new Fp([],{map:this.map}),this.routesFeatureStore=new Mp([],{map:this.map}),this.zoomToActiveRoute$=new Se.x,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(a=>this.map.addLayer(a))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Pn),e.Y36(D),e.Y36(Le),e.Y36(Ut))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-directions"]],decls:19,vars:12,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/directions"],[3,"map","view"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[3,"stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Directions"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2)(15,"igo-geolocate-button",2)(16,"igo-home-extent-button",2)(17,"igo-rotation-button",3),e.qZA(),e._UZ(18,"igo-directions",4),e.qZA()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map)("showIfNoRotation",!1),e.xp6(1),e.Q6J("stopsStore",o.stopsStore)("stopsFeatureStore",o.stopsFeatureStore)("stepFeatureStore",o.stepFeatureStore)("routesFeatureStore",o.routesFeatureStore)("zoomToActiveRoute$",o.zoomToActiveRoute$))},dependencies:[x.a8,x.dn,x.n5,x.$j,Ae,pt,Jn,Rn,Bn,zu],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]}),i})()}]);let YL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:Va,useFactory:n2,multi:!0,deps:[q.eN,J]}],imports:[jL,x.QW,w.ot,wo,st,tl]}),i})();const VL=te.Bz.forChild([{path:"time-filter",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:a}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},timeFilterable:!0,timeFilter:{min:"2013",max:"2019",range:!1,type:tt.YEAR,style:Lt.SLIDER,step:1,timeInterval:2e3}}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle YEAR",visible:!0,source:a}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-time-filter"]],decls:21,vars:4,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/time-filter"],[3,"map","view"],["color","primary",3,"map"],["title","Layers"],[3,"layers"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Time filter"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"npm install --save moment@2.22.2"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"npm install --save @mat-datetimepicker/core@3.0.0-beta.0"),e.qZA(),e.TgZ(10,"li"),e._uU(11,"Dependencies: LanguageService"),e.qZA(),e._UZ(12,"br"),e._uU(13," See the "),e.TgZ(14,"a",0),e._uU(15,"code of this example"),e.qZA(),e._UZ(16,"hr"),e.qZA(),e.TgZ(17,"igo-map-browser",1),e._UZ(18,"igo-zoom-button",2),e.qZA(),e.TgZ(19,"igo-panel",3),e._UZ(20,"igo-time-filter-list",4),e.qZA()()),2&t&&(e.xp6(17),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(2),e.Q6J("layers",o.map.layers))},dependencies:[x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,Qr],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let zL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[VL,x.QW,w.ot,T.Ps,Tt,st,Lo]}),i})();const KL=te.Bz.forChild([{path:"ogc-filter",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:m}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"code_municipalite",alias:"# de la municipalit\xe9e"},{name:"date_observation",excludeFromOgcFilters:!0},{name:"urgence",values:["imm\xe9diate","inconnue"]}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:He.All,filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"},{operator:"Intersects",geometryName:"the_geom",wkt_geometry:"MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))"}]}}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (PropertyIsEqualTo OR Intersects)",source:m,style:new R.ZP({image:new Me.Z({radius:5,fill:new N.Z({color:"white"}),stroke:new U.Z({color:"orange",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:He.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-21T00:00:00-05:00",end:"2016-01-26T00:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-10T00:00:00-05:00",stepDate:"P2D"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P2D)",id:"1",source:m,style:new R.ZP({image:new Me.Z({radius:5,fill:new N.Z({color:"white"}),stroke:new U.Z({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:He.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T04:00:00-05:00",end:"2016-01-12T16:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-14T20:00:00-05:00",stepDate:"PT4H"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: PT4H)",id:"2",source:m,style:new R.ZP({image:new Me.Z({radius:5,fill:new N.Z({color:"white"}),stroke:new U.Z({color:"blue",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:He.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T00:00:00-05:00",end:"2016-03-31T00:00:00-05:00",displayFormat:"MMMM"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2018-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P1M)",id:"3",source:m,style:new R.ZP({image:new Me.Z({radius:5,fill:new N.Z({color:"white"}),stroke:new U.Z({color:"yellow",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:He.All,filters:{operator:"During",propertyName:"date_observation",begin:"2014-01-01T00:00:00-05:00",end:"2019-12-31T00:00:00-05:00",sliderOptions:{interval:2e3,displayFormat:"YY"},displayFormat:"YYYY"}},minDate:"2014-01-01T00:00:00-05:00",maxDate:"2019-12-31T00:00:00-05:00",stepDate:"P1Y"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P1Y)",id:"4",source:m,style:new R.ZP({image:new Me.Z({radius:5,fill:new N.Z({color:"white"}),stroke:new U.Z({color:"green",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:He.All,filters:{operator:"During",propertyName:"date_observation",begin:"today - 2 days",end:"today"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1D"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Interval from Now, Step: P1D)",id:"5",source:m,style:new R.ZP({image:new Me.Z({radius:5,fill:new N.Z({color:"white"}),stroke:new U.Z({color:"black",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:He.All,filters:{operator:"During",propertyName:"date_observation",begin:"2019-01-01 00:00:00",restrictToStep:!0}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, RestrictToStep, Step: P1M)",id:"6",source:m,style:new R.ZP({image:new Me.Z({radius:5,fill:new N.Z({color:"black"}),stroke:new U.Z({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"vg_observation_v_inondation23avril2017_wmst",VERSION:"1.3.0"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,filters:{operator:"During",propertyName:"date_observation"},allowedOperatorsType:He.Time}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Inondation (During, optionsFromCapabilities)",source:m}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",urlWfs:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"radars_photos",VERSION:"1.3.0"},ogcFilters:{enabled:!0,editable:!0,pushButtons:{selectorType:"pushButton",order:2,groups:[{title:"Nom du group1 - push",name:"1 - push",ids:["id1"]}],bundles:[{id:"id1",title:"R\xe9gions",logical:"Or",vertical:!0,selectors:[{title:"Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Laval"}]}},{title:"Outside Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{logical:"And",filters:[{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Laval"}]}}]}]},checkboxes:{selectorType:"checkbox",order:1,groups:[{title:"Nom du group1 - checkbox",name:"1 - checkbox",ids:["id1"]}],bundles:[{id:"id1",title:"Type de radar photo",logical:"Or",selectors:[{title:"Radar photo fixe",enabled:!0,tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe"}},{title:"Radar photo mobile",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo mobile"}},{title:"Radar photo fixe + feu rouge",enabled:!1,color:"0,200,0",tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe et surveillance au feu rouge"}},{title:"Radar feu rouge",enabled:!1,color:"255,0,0",tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Appareil de surveillance au feu rouge"}}]}]},allowedOperatorsType:He.Basic},paramsWFS:{featureTypes:"radars_photos",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"1.1.0",outputFormat:"geojson",outputFormatDownload:"shp"}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Filterable WMS layers with predefined filters (push buttons)",source:m}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-ogc-filter"]],decls:17,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/ogc-filter"],[3,"map","view"],["color","primary",3,"map"],["title","Layers"],[3,"map","layers"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Ogc filter"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3),e._UZ(16,"igo-ogc-filterable-list",4),e.qZA()()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(2),e.Q6J("map",o.map)("layers",o.map.layers))},dependencies:[x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,jr],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let XL=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[KL,x.QW,w.ot,T.Ps,Tt,st,Lo]}),i})();function e6(i,r){if(1&i&&(e.ynx(0),e._UZ(1,"igo-feature-details",6),e.BQk()),2&i){const t=r.ngIf;e.xp6(1),e.Q6J("feature",t)}}const o6=te.Bz.forChild([{path:"spatial-filter",component:(()=>{class i{constructor(t,o,n,s,a,l,c){this.matIconRegistry=t,this.spatialFilterService=o,this.dataSourceService=n,this.layerService=s,this.messageService=a,this.languageService=l,this.cdRef=c,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.itemType=xt.Address,this.layers=[],this.activeLayers=[],this.buffer=0,this.iterator=1,this.selectedFeature$=new b.X(void 0),this.format=new be.Z,this.store=new it([]),this.spatialListStore=new it([]),this.loading=!1,this.thematicLength=0,this.measureUnit=K.Meters,this.unsubscribe$=new Se.x,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(u=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:u}))})}ngOnInit(){for(const t of this.map.layers)t.title&&t.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(t)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(t){this.type=t,this.queryType=void 0}getOutputQueryType(t){this.queryType=t,this.queryType&&this.loadFilterList()}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,Fo.R)(this.unsubscribe$)).subscribe(t=>{t.sort((o,n)=>o.properties.nom<n.properties.nom?-1:o.properties.nom>n.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(t)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===ye.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let o,t=!0;(0===this.buffer||this.type===ye.Point)&&this.tryAddFeaturesToMap([this.zone]),o=this.itemType!==xt.Thematics?[{name:""}]:this.thematics,this.measureUnit===K.Kilometers&&this.type!==ye.Point&&(this.buffer=1e3*this.buffer),this.type===ye.Polygon&&(this.buffer=0);const n=[];o.forEach(s=>{n.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,s,this.buffer).pipe((0,Ji.b)(a=>{this.store.insertMany(a);const l=[],c=[];let u,p;a.forEach(d=>{"Point"===d.geometry.type?(d.properties.longitude=d.geometry.coordinates[0],d.properties.latitude=d.geometry.coordinates[1],l.push(d),u=d.meta.id):(c.push(d),p=d.meta.id)}),this.tryAddPointToMap(l,u),this.tryAddLayerToMap(c,p),a.length?(t=!1,this.thematicLength+=1,s.zeroResults=!1,this.cdRef.detectChanges()):s.zeroResults=!0,a.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,Qt.D)(n).pipe((0,Fo.R)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,t&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(t,o){this.zone=t,t&&(o?this.tryAddFeaturesToMap([t],!0):this.tryAddFeaturesToMap([t]),this.zoomToFeatureExtent(t))}tryAddFeaturesToMap(t,o){var n,s,a,l;let c=1;for(const u of t){if(this.type===ye.Predefined)for(const p of this.layers){if(p.options._internal&&p.options._internal.code===u.properties.code&&!o){if(null===(n=p.title)||void 0===n||!n.startsWith("Zone")){const d=this.layers.indexOf(p);this.layers.splice(d,1)}return}if(null!==(s=p.title)&&void 0!==s&&s.startsWith("Zone")){this.activeLayers=[];const d=this.layers.indexOf(p);this.layers.splice(d,1),this.map.removeLayer(p)}}else{if(o)for(const p of this.activeLayers)if(1===this.activeLayers.length&&(null===(a=p.title)||void 0===a?void 0:a.startsWith("Zone"))){const d=this.layers.indexOf(p);this.layers.splice(d,1),this.map.removeLayer(p)}this.activeLayers=[]}for(const p of this.layers)null!==(l=p.title)&&void 0!==l&&l.startsWith("Zone")&&c++;this.defaultStyle=(p,d)=>{const g=t[0].coordinates;return new R.ZP({image:new Me.Z({radius:g?this.buffer/Math.cos(Math.PI/180*g[1])/d:void 0,fill:new N.Z({color:"rgba(200, 200, 20, 0.2)"}),stroke:new U.Z({width:1,color:"orange"})}),stroke:new U.Z({width:1,color:"orange"}),fill:new N.Z({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,Ee.q)(1)).subscribe(p=>{const d=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+c+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===ye.Predefined?u.properties.code:void 0},source:p,visible:!0}),g=t.map(m=>bt(m,this.map.projection));if(this.type!==ye.Predefined){const m=this.type===ye.Point?"Cercle":"Polygone";g[0].set("nom","Zone",!0),g[0].set("type",m,!0)}p.ol.addFeatures(g),d.ol.setStyle(this.defaultStyle),this.map.addLayer(d),this.layers.push(d),this.activeLayers.push(d),this.cdRef.detectChanges()})}}tryAddPointToMap(t,o){var n;let s=1;if(t.length){if(void 0===this.map)return;for(const a of this.layers)null!==(n=a.title)&&void 0!==n&&n.startsWith(t[0].meta.title)&&s++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:o,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,Ee.q)(1)).subscribe(a=>{const l=t[0].meta.icon;let c;c=l&&this.createSvgIcon(l)||Go();const u=this.layerService.createLayer({isIgoInternalLayer:!0,title:t[0].meta.title+" "+s+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:a,visible:!0,style:c}),p=t.map(g=>bt(g,this.map.projection));a.ol.getSource().addFeatures(p),this.layers.find(g=>g.id===u.id)&&(this.map.removeLayer(this.layers.find(g=>g.id===u.id)),s-=1,u.title=t[0].meta.title+" "+s+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),u.options.title=u.title),this.iterator=s,this.map.addLayer(u),this.layers.push(u),this.pushLayer(u),this.cdRef.detectChanges()})}}createSvgIcon(t){let o;return this.matIconRegistry.getNamedSvgIcon(t).subscribe(n=>{const s=new XMLSerializer;n.setAttribute("width","30"),n.setAttribute("height","30"),n.setAttribute("fill","rgba(0, 128, 255)"),n.setAttribute("stroke","white");const a=s.serializeToString(n);o=new R.ZP({image:new di.Z({src:"data:image/svg+xml;utf8,"+a})})}),o}tryAddLayerToMap(t,o){var n;let s=1;if(t.length){if(void 0===this.map)return;for(const a of this.layers)null!==(n=a.title)&&void 0!==n&&n.startsWith(t[0].meta.title)&&s++;this.dataSourceService.createAsyncDataSource({type:"vector",id:o,queryable:!0}).pipe((0,Ee.q)(1)).subscribe(a=>{const l=this.layerService.createLayer({isIgoInternalLayer:!0,title:t[0].meta.title+" "+s+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:a,visible:!0}),c=t.map(p=>bt(p,this.map.projection));a.ol.addFeatures(c),this.layers.find(p=>p.id===l.id)&&(this.map.removeLayer(this.layers.find(p=>p.id===l.id)),s-=1,l.title=t[0].meta.title+" "+s+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),l.options.title=l.title),this.map.addLayer(l),this.layers.push(l),this.pushLayer(l),this.cdRef.detectChanges()})}}zoomToFeatureExtent(t){if(t){const o=this.format.readFeature(t,{dataProjection:t.projection,featureProjection:this.map.projection});eo(this.map,[o],Y.Zoom)}}pushLayer(t){for(const o of this.activeLayers)if(o.id===t.id)return;this.activeLayers.push(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T.jv),e.Y36(Gn),e.Y36(wt),e.Y36(Le),e.Y36(_e),e.Y36(D),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-spatial-filter"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},decls:21,vars:20,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures"],["color","primary",3,"map"],[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent"],[4,"ngIf"],[3,"feature"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Query"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel")(16,"igo-spatial-filter-type",3),e.NdJ("eventType",function(s){return o.getOutputType(s)})("eventQueryType",function(s){return o.getOutputQueryType(s)})("zoneChange",function(s){return o.onZoneChange(s)})("zoneWithBufferChange",function(s){return o.onZoneChange(s,!0)})("bufferChange",function(s){return o.buffer=s})("measureUnitChange",function(s){return o.measureUnit=s}),e.qZA(),e.TgZ(17,"igo-spatial-filter-item",4),e.NdJ("radiusEvent",function(s){return o.buffer=s})("bufferEvent",function(s){return o.buffer=s})("measureUnitChange",function(s){return o.measureUnit=s})("freehandControl",function(s){return o.freehandDrawIsActive=s})("drawZoneEvent",function(s){return o.zone=s})("zoneWithBufferChange",function(s){return o.onZoneChange(s,!0)})("itemTypeChange",function(s){return o.itemType=s})("thematicChange",function(s){return o.thematics=s})("toggleSearch",function(){return o.getOutputToggleSearch()})("clearButtonEvent",function(){return o.clearMap()})("clearSearchEvent",function(){return o.getOutputClearSearch()}),e.qZA()(),e.TgZ(18,"igo-panel"),e.YNc(19,e6,2,1,"ng-container",5),e.ALo(20,"async"),e.qZA()()),2&t&&(e.xp6(13),e.Q6J("map",o.map)("view",o.view)("queryFeatures",!0),e.xp6(1),e.Q6J("map",o.map),e.xp6(2),e.Q6J("store",o.spatialListStore)("selectedQueryType",o.queryType)("zone",o.zone)("layers",o.activeLayers),e.xp6(1),e.Q6J("type",o.type)("queryType",o.queryType)("map",o.map)("zone",o.zone)("loading",o.loading)("store",o.store)("layers",o.activeLayers)("allLayers",o.layers)("thematicLength",o.thematicLength),e.xp6(2),e.Q6J("ngIf",e.lcZ(20,18,o.selectedFeature$)))},dependencies:[x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,Xc,bi,Ua,Na,f.O5,f.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-form[_ngcontent-%COMP%]{display:none}igo-spatial-filter-item[_ngcontent-%COMP%]     .thematics-header{max-width:225px}"],changeDetection:0}),i})()}]);let i6=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[o6,x.QW,w.ot,T.Ps,Tt,st,wo,Kn,Ao,Ea,Lo,Cn,f.ez]}),i})();function n6(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"igo-entity-table-paginator",6),e.NdJ("paginatorChange",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.paginatorChange(n))}),e.qZA()}if(2&i){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("store",t.entityStore)("paginatorOptions",o.paginatorOptions)("entitySortChange$",o.entitySortChange$)}}function r6(i,r){if(1&i&&(e.ynx(0),e.YNc(1,n6,1,3,"igo-entity-table-paginator",5),e.ALo(2,"async"),e.BQk()),2&i){const t=r.ngIf;e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.inResolutionRange$))}}function s6(i,r){if(1&i&&e._UZ(0,"igo-actionbar",10),2&i){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("store",t.actionStore)("horizontal",!0)("withToggleButton",!0)("withTitle",!0)("mode",o.actionbarMode)}}function a6(i,r){if(1&i&&e._UZ(0,"igo-entity-table",11),2&i){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("paginator",o.workspacePaginator)("scrollBehavior",o.scrollBehavior)("store",t.entityStore)("template",t.meta.tableTemplate)}}function l6(i,r){1&i&&(e.TgZ(0,"mat-card-content"),e._uU(1," No data available at this scale. Please zoom in. "),e.qZA())}function c6(i,r){if(1&i&&(e.ynx(0),e.YNc(1,s6,1,5,"igo-actionbar",7),e.YNc(2,a6,1,4,"igo-entity-table",8),e.ALo(3,"async"),e.YNc(4,l6,2,0,"mat-card-content",4),e.ALo(5,"async"),e._UZ(6,"igo-workspace-widget-outlet",9),e.BQk()),2&i){const t=r.ngIf;e.xp6(1),e.Q6J("ngIf",t.actionStore),e.xp6(1),e.Q6J("ngIf",t.entityStore&&t.meta&&t.meta.tableTemplate&&e.lcZ(3,4,t.inResolutionRange$)),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(5,6,t.inResolutionRange$)),e.xp6(2),e.Q6J("workspace",t)}}const p6=te.Bz.forChild([{path:"workspace",component:(()=>{class i{constructor(t,o,n,s){this.languageService=t,this.dataSourceService=o,this.layerService=n,this.workspaceState=s,this.entitySortChange$=new b.X(!1),this.paginatorOptions={pageSize:5,pageSizeOptions:[1,5,10,15,30,50,100],showFirstLastButtons:!0},this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-72,47.2],zoom:5},this.actionbarMode=Mo.Overlay,this.scrollBehavior=Fi.Instant}get workspaceStore(){return this.workspaceState.store}ngOnInit(){this.selectedWorkspace$=this.workspaceStore.stateView.firstBy$(o=>!0===o.state.selected).pipe((0,Z.U)(o=>{const n=void 0===o?void 0:o.entity;return n&&n.actionStore.view.filter(s=>"wfsDownload"!==s.id),n})),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(o=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:o}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{featureTypes:"etablissement_mtq",fieldNameGeometry:"geometry",version:"2.0.0",outputFormat:"geojson"},sourceFields:[{name:"idetablis",alias:"ID"},{name:"nometablis",alias:"Name"},{name:"typetablis",alias:"Type"}]}).subscribe(o=>{this.map.addLayer(this.layerService.createLayer({title:"Simple WFS ",maxResolution:3e3,visible:!0,source:o}))})}paginatorChange(t){this.workspacePaginator=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(wt),e.Y36(Le),e.Y36(or))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-workspace"]],decls:16,vars:11,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/workspace"],[3,"map","view"],["color","primary",3,"map"],["igoWorkspaceSelector","",3,"store","map"],[4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"],[3,"store","horizontal","withToggleButton","withTitle","mode",4,"ngIf"],["class","table-compact table-centered",3,"paginator","scrollBehavior","store","template",4,"ngIf"],[3,"workspace"],[3,"store","horizontal","withToggleButton","withTitle","mode"],[1,"table-compact","table-centered",3,"paginator","scrollBehavior","store","template"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Workspace"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-map-browser",1),e._UZ(10,"igo-zoom-button",2),e.qZA(),e._UZ(11,"igo-workspace-selector",3),e.YNc(12,r6,3,3,"ng-container",4),e.ALo(13,"async"),e.YNc(14,c6,7,8,"ng-container",4),e.ALo(15,"async"),e.qZA()),2&t&&(e.xp6(9),e.Q6J("map",o.map)("view",o.view),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("store",o.workspaceStore)("map",o.map),e.xp6(1),e.Q6J("ngIf",e.lcZ(13,7,o.selectedWorkspace$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(15,9,o.selectedWorkspace$)))},dependencies:[f.O5,x.a8,x.dn,x.n5,x.$j,vn,li,Dl,Vl,gh,Ae,pt,HT,f.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-entity-table[_ngcontent-%COMP%]{height:400px}igo-actionbar[_ngcontent-%COMP%]{height:48px}"]}),i})()}]);let d6=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,p6,x.QW,w.ot,T.Ps,Os,Ul,hh,Tt,st,bp]}),i})();function g6(i,r){1&i&&e._UZ(0,"igo-metadata-button",10),2&i&&e.Q6J("layer",r.layer)}const h6=te.Bz.forChild([{path:"context",component:(()=>{class i{constructor(t,o,n){this.languageService=t,this.mapService=o,this.overlayService=n,this.map=new ot({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.mapService.setMap(this.map)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D),e.Y36(Ut),e.Y36(Ru))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-context"]],decls:28,vars:8,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/context/context"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/contexts"],["igoMapContext","","igoLayerContext","",3,"map"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],["title","Contexts list"],["igoContextListBinding","",3,"map"],["title","Layers"],["igoLayerListBinding","",3,"map"],["igoLayerItemToolbar",""],[3,"layer"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Context"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"* Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See "),e.TgZ(14,"a",1),e._uU(15," contexts"),e.qZA(),e._UZ(16,"hr"),e.qZA(),e.TgZ(17,"igo-map-browser",2),e._UZ(18,"igo-zoom-button",3)(19,"igo-geolocate-button",3)(20,"igo-home-extent-button",3)(21,"igo-rotation-button",4),e.qZA(),e.TgZ(22,"igo-panel",5),e._UZ(23,"igo-context-list",6),e.qZA(),e.TgZ(24,"igo-panel",7)(25,"igo-layer-list",8),e.YNc(26,g6,1,1,"ng-template",null,9,e.W1O),e.qZA()()()),2&t&&(e.xp6(17),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map),e.xp6(1),e.Q6J("map",o.map)("showIfNoRotation",!0),e.xp6(2),e.Q6J("map",o.map),e.xp6(2),e.Q6J("map",o.map))},dependencies:[x.a8,x.dn,x.n5,x.$j,Dt,Ae,pt,Jn,Rn,Bn,yi,Br,Gi,hs,gl,Dp,kp],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{margin-bottom:5px}"]}),i})()}]);let f6=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[q.Ed,h6,x.QW,w.ot,T.Ps,Tt,st,vi,fi,ts,Kn,Ao,ml]}),i})();const _6=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"**",redirectTo:"/home"}];let y6=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[te.Bz.forRoot(_6,{useHash:!0}),te.Bz]}),i})(),v6=(()=>{class i{constructor(t,o,n){this.changeDetectorRef=t,this.media=o,this.renderer=n,this.title="IGO",this.version=wl,this.themeClass="deeppurple-theme",this.mobileQuery=o.matchMedia("(max-width: 600px)"),this._mobileQueryListener=()=>t.detectChanges(),this.mobileQuery.addEventListener("change",this._mobileQueryListener),this.renderer.addClass(document.body,this.themeClass),this.detectOldBrowser()}ngOnDestroy(){this.mobileQuery.removeEventListener("change",this._mobileQueryListener)}detectOldBrowser(){ti.satisfies({ie:"<=11",chrome:"<64",firefox:"<60"})&&console.log("Very old browser ! ",ti.getBrowser())}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO),e.Y36(ko.vx),e.Y36(e.Qsj))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-root"]],decls:91,vars:8,consts:[[1,"example-container"],["color","primary",1,"example-toolbar"],["mat-icon-button","",3,"click"],["svgIcon","menu"],[1,"example-sidenav-container"],["opened","true","fixedTopGap","56",3,"mode","fixedInViewport"],["snav",""],["mat-list-item","","routerLink","."],["mat-list-item","","routerLink","activity"],["mat-list-item","","routerLink","config"],["mat-list-item","","routerLink","language"],["mat-list-item","","routerLink","media"],["mat-list-item","","routerLink","message"],["mat-list-item","","routerLink","request"],["mat-list-item","","routerLink","auth-form"],["mat-list-item","","routerLink","action"],["mat-list-item","","routerLink","dynamic-component"],["mat-list-item","","routerLink","entity-table"],["mat-list-item","","routerLink","entity-selector"],["mat-list-item","","routerLink","form"],["mat-list-item","","routerLink","table"],["mat-list-item","","routerLink","tool"],["mat-list-item","","routerLink","widget"],["mat-list-item","","routerLink","simple-map"],["mat-list-item","","routerLink","layer"],["mat-list-item","","routerLink","legend"],["mat-list-item","","routerLink","overlay"],["mat-list-item","","routerLink","geometry"],["mat-list-item","","routerLink","feature"],["mat-list-item","","routerLink","hover"],["mat-list-item","","routerLink","measure"],["mat-list-item","","routerLink","draw"],["mat-list-item","","routerLink","query"],["mat-list-item","","routerLink","catalog"],["mat-list-item","","routerLink","search"],["mat-list-item","","routerLink","print"],["mat-list-item","","routerLink","import-export"],["mat-list-item","","routerLink","directions"],["mat-list-item","","routerLink","time-filter"],["mat-list-item","","routerLink","ogc-filter"],["mat-list-item","","routerLink","spatial-filter"],["mat-list-item","","routerLink","workspace"],["mat-list-item","","routerLink","context"]],template:function(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div",0)(1,"mat-toolbar",1)(2,"button",2),e.NdJ("click",function(){e.CHM(n);const a=e.MAs(10);return e.KtG(a.toggle())}),e._UZ(3,"mat-icon",3),e.qZA(),e.TgZ(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"h5"),e._uU(7),e.qZA()(),e.TgZ(8,"mat-sidenav-container",4)(9,"mat-sidenav",5,6)(11,"mat-nav-list")(12,"a",7),e._uU(13,"Home"),e.qZA(),e._UZ(14,"hr"),e.TgZ(15,"a",8),e._uU(16,"Activity"),e.qZA(),e.TgZ(17,"a",9),e._uU(18,"Config"),e.qZA(),e.TgZ(19,"a",10),e._uU(20,"Language"),e.qZA(),e.TgZ(21,"a",11),e._uU(22,"Media"),e.qZA(),e.TgZ(23,"a",12),e._uU(24,"Message"),e.qZA(),e.TgZ(25,"a",13),e._uU(26,"Request"),e.qZA(),e._UZ(27,"hr"),e.TgZ(28,"a",14),e._uU(29,"Authentification"),e.qZA(),e._UZ(30,"hr"),e.TgZ(31,"a",15),e._uU(32,"Action"),e.qZA(),e.TgZ(33,"a",16),e._uU(34,"Dynamic Component"),e.qZA(),e.TgZ(35,"a",17),e._uU(36,"Entity Table"),e.qZA(),e.TgZ(37,"a",18),e._uU(38,"Entity Selector"),e.qZA(),e.TgZ(39,"a",19),e._uU(40,"Form"),e.qZA(),e.TgZ(41,"a",20),e._uU(42,"Table"),e.qZA(),e.TgZ(43,"a",21),e._uU(44,"Tool"),e.qZA(),e.TgZ(45,"a",22),e._uU(46,"Widget"),e.qZA(),e._UZ(47,"hr"),e.TgZ(48,"a",23),e._uU(49,"Simple map"),e.qZA(),e.TgZ(50,"a",24),e._uU(51,"Layer"),e.qZA(),e.TgZ(52,"a",25),e._uU(53,"Legend"),e.qZA(),e.TgZ(54,"a",26),e._uU(55,"Overlay"),e.qZA(),e.TgZ(56,"a",27),e._uU(57,"Geometry"),e.qZA(),e.TgZ(58,"a",28),e._uU(59,"Feature"),e.qZA(),e.TgZ(60,"a",29),e._uU(61,"Hover"),e.qZA(),e.TgZ(62,"a",30),e._uU(63,"Measure"),e.qZA(),e.TgZ(64,"a",31),e._uU(65,"Draw"),e.qZA(),e.TgZ(66,"a",32),e._uU(67,"Query"),e.qZA(),e.TgZ(68,"a",33),e._uU(69,"Catalog"),e.qZA(),e.TgZ(70,"a",34),e._uU(71,"Search"),e.qZA(),e.TgZ(72,"a",35),e._uU(73,"Print"),e.qZA(),e.TgZ(74,"a",36),e._uU(75,"Import/Export"),e.qZA(),e.TgZ(76,"a",37),e._uU(77,"Directions"),e.qZA(),e.TgZ(78,"a",38),e._uU(79,"Time filter"),e.qZA(),e.TgZ(80,"a",39),e._uU(81,"OGC filter"),e.qZA(),e.TgZ(82,"a",40),e._uU(83,"Spatial filter"),e.qZA(),e.TgZ(84,"a",41),e._uU(85,"Workspace"),e.qZA(),e._UZ(86,"hr"),e.TgZ(87,"a",42),e._uU(88,"Context"),e.qZA()()(),e.TgZ(89,"mat-sidenav-content"),e._UZ(90,"router-outlet"),e.qZA()()()}2&t&&(e.ekj("example-is-mobile",o.mobileQuery.matches),e.xp6(5),e.Oqu(o.title),e.xp6(2),e.Oqu(o.version.lib),e.xp6(1),e.Udp("margin-top",o.mobileQuery.matches?56:0,"px"),e.xp6(1),e.Q6J("mode",o.mobileQuery.matches?"over":"side")("fixedInViewport",o.mobileQuery.matches))},dependencies:[Xo.JX,Xo.TM,Xo.Rh,vl.Ye,w.lW,T.Hw,G.Hk,G.Tg,te.lC,te.yS],styles:["h1[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:26px}.example-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;inset:0}.example-is-mobile[_ngcontent-%COMP%]   .example-toolbar[_ngcontent-%COMP%]{position:fixed;z-index:2}.example-sidenav-container[_ngcontent-%COMP%]{flex:1}.example-is-mobile[_ngcontent-%COMP%]   .example-sidenav-container[_ngcontent-%COMP%]{flex:1 0 auto}mat-sidenav[_ngcontent-%COMP%]{background-color:#00000008}.example-is-mobile[_ngcontent-%COMP%]   mat-sidenav[_ngcontent-%COMP%]{background-color:#fff}mat-sidenav-content[_ngcontent-%COMP%]{padding:10px}[_ngcontent-%COMP%]:ng-deep   .mat-tooltip-hide[_ngcontent-%COMP%]{display:none!important}  .mat-form-field-suffix   mat-icon{width:auto!important;height:-webkit-fill-available!important}"]}),i})();const b6={showDelay:500,hideDelay:0,touchendHideDelay:0,disableTooltipInteractivity:!0};let C6=(()=>{class i{constructor(t,o){t.addSvgIconSet(o.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(T.jv),e.LFG(yt.H7))},i.\u0275mod=e.oAB({type:i,bootstrap:[v6]}),i.\u0275inj=e.cJS({providers:[{provide:e.ip1,useFactory:x6,deps:[e.zs3,e.z2F],multi:!0},{provide:O.Jm,useValue:b6}],imports:[cd,yt.b2,pn.PW,Xo.SJ,vl.g0,w.ot,T.Ps,G.ie,vh,xh,Th,Ah,Oh,kh,Eh,Uh,Qh,Hh,Kh,nf,af,df,ff,jf,_2,C2,w2,F2,O2,k2,E2,B2,q2,H2,W2,JL,UL,GL,YL,zL,XL,i6,d6,f6,y6,yt.t6]}),i})();function x6(i,r){return()=>new Promise(t=>{r.isStable.pipe((0,Gt.P)(o=>!0===o),(0,Vt.b)(()=>{const o=i.get(D),n=o.getLanguage();return o.translate.getTranslation(n)})).subscribe(o=>{const n=i.get(D),s=n.getLanguage();n.translate.setTranslation(s,o),t()})})}C(15977),Ws.production&&(0,e.G48)(),yt.q6().bootstrapModule(C6).catch(i=>console.log(i))},46700:(Ko,ys,C)=>{var yt={"./af":58685,"./af.js":58685,"./ar":254,"./ar-dz":4312,"./ar-dz.js":4312,"./ar-kw":32614,"./ar-kw.js":32614,"./ar-ly":18630,"./ar-ly.js":18630,"./ar-ma":28674,"./ar-ma.js":28674,"./ar-sa":49032,"./ar-sa.js":49032,"./ar-tn":24730,"./ar-tn.js":24730,"./ar.js":254,"./az":53052,"./az.js":53052,"./be":60150,"./be.js":60150,"./bg":63069,"./bg.js":63069,"./bm":13466,"./bm.js":13466,"./bn":18516,"./bn-bd":90557,"./bn-bd.js":90557,"./bn.js":18516,"./bo":26273,"./bo.js":26273,"./br":9588,"./br.js":9588,"./bs":19815,"./bs.js":19815,"./ca":83331,"./ca.js":83331,"./cs":21320,"./cs.js":21320,"./cv":72219,"./cv.js":72219,"./cy":68266,"./cy.js":68266,"./da":66427,"./da.js":66427,"./de":67435,"./de-at":52871,"./de-at.js":52871,"./de-ch":12994,"./de-ch.js":12994,"./de.js":67435,"./dv":82357,"./dv.js":82357,"./el":95649,"./el.js":95649,"./en-au":59961,"./en-au.js":59961,"./en-ca":19878,"./en-ca.js":19878,"./en-gb":3924,"./en-gb.js":3924,"./en-ie":70864,"./en-ie.js":70864,"./en-il":91579,"./en-il.js":91579,"./en-in":30940,"./en-in.js":30940,"./en-nz":16181,"./en-nz.js":16181,"./en-sg":44301,"./en-sg.js":44301,"./eo":85291,"./eo.js":85291,"./es":54529,"./es-do":53764,"./es-do.js":53764,"./es-mx":12584,"./es-mx.js":12584,"./es-us":63425,"./es-us.js":63425,"./es.js":54529,"./et":35203,"./et.js":35203,"./eu":70678,"./eu.js":70678,"./fa":83483,"./fa.js":83483,"./fi":96262,"./fi.js":96262,"./fil":52521,"./fil.js":52521,"./fo":34555,"./fo.js":34555,"./fr":63131,"./fr-ca":88239,"./fr-ca.js":88239,"./fr-ch":21702,"./fr-ch.js":21702,"./fr.js":63131,"./fy":267,"./fy.js":267,"./ga":23821,"./ga.js":23821,"./gd":71753,"./gd.js":71753,"./gl":4074,"./gl.js":4074,"./gom-deva":92762,"./gom-deva.js":92762,"./gom-latn":5969,"./gom-latn.js":5969,"./gu":82809,"./gu.js":82809,"./he":45402,"./he.js":45402,"./hi":315,"./hi.js":315,"./hr":10410,"./hr.js":10410,"./hu":38288,"./hu.js":38288,"./hy-am":67928,"./hy-am.js":67928,"./id":71334,"./id.js":71334,"./is":86959,"./is.js":86959,"./it":34864,"./it-ch":51124,"./it-ch.js":51124,"./it.js":34864,"./ja":36141,"./ja.js":36141,"./jv":29187,"./jv.js":29187,"./ka":42136,"./ka.js":42136,"./kk":94332,"./kk.js":94332,"./km":18607,"./km.js":18607,"./kn":84305,"./kn.js":84305,"./ko":70234,"./ko.js":70234,"./ku":16003,"./ku.js":16003,"./ky":75061,"./ky.js":75061,"./lb":32786,"./lb.js":32786,"./lo":66183,"./lo.js":66183,"./lt":50029,"./lt.js":50029,"./lv":24169,"./lv.js":24169,"./me":68577,"./me.js":68577,"./mi":68177,"./mi.js":68177,"./mk":50337,"./mk.js":50337,"./ml":65260,"./ml.js":65260,"./mn":52325,"./mn.js":52325,"./mr":14695,"./mr.js":14695,"./ms":75334,"./ms-my":37151,"./ms-my.js":37151,"./ms.js":75334,"./mt":63570,"./mt.js":63570,"./my":97963,"./my.js":97963,"./nb":88028,"./nb.js":88028,"./ne":86638,"./ne.js":86638,"./nl":50302,"./nl-be":66782,"./nl-be.js":66782,"./nl.js":50302,"./nn":33501,"./nn.js":33501,"./oc-lnc":50563,"./oc-lnc.js":50563,"./pa-in":50869,"./pa-in.js":50869,"./pl":65302,"./pl.js":65302,"./pt":49687,"./pt-br":74884,"./pt-br.js":74884,"./pt.js":49687,"./ro":79107,"./ro.js":79107,"./ru":33627,"./ru.js":33627,"./sd":30355,"./sd.js":30355,"./se":83427,"./se.js":83427,"./si":11848,"./si.js":11848,"./sk":54590,"./sk.js":54590,"./sl":20184,"./sl.js":20184,"./sq":56361,"./sq.js":56361,"./sr":78965,"./sr-cyrl":81287,"./sr-cyrl.js":81287,"./sr.js":78965,"./ss":25456,"./ss.js":25456,"./sv":70451,"./sv.js":70451,"./sw":77558,"./sw.js":77558,"./ta":51356,"./ta.js":51356,"./te":73693,"./te.js":73693,"./tet":21243,"./tet.js":21243,"./tg":42500,"./tg.js":42500,"./th":55768,"./th.js":55768,"./tk":77761,"./tk.js":77761,"./tl-ph":35780,"./tl-ph.js":35780,"./tlh":29590,"./tlh.js":29590,"./tr":33807,"./tr.js":33807,"./tzl":93857,"./tzl.js":93857,"./tzm":60654,"./tzm-latn":8806,"./tzm-latn.js":8806,"./tzm.js":60654,"./ug-cn":30845,"./ug-cn.js":30845,"./uk":19232,"./uk.js":19232,"./ur":47052,"./ur.js":47052,"./uz":77967,"./uz-latn":32233,"./uz-latn.js":32233,"./uz.js":77967,"./vi":98615,"./vi.js":98615,"./x-pseudo":12320,"./x-pseudo.js":12320,"./yo":31313,"./yo.js":31313,"./zh-cn":64490,"./zh-cn.js":64490,"./zh-hk":55910,"./zh-hk.js":55910,"./zh-mo":98262,"./zh-mo.js":98262,"./zh-tw":44223,"./zh-tw.js":44223};function e(w){var T=pn(w);return C(T)}function pn(w){if(!C.o(yt,w)){var T=new Error("Cannot find module '"+w+"'");throw T.code="MODULE_NOT_FOUND",T}return yt[w]}e.keys=function(){return Object.keys(yt)},e.resolve=pn,Ko.exports=e,e.id=46700}},Ko=>{Ko.O(0,[736],()=>Ko(Ko.s=73750)),Ko.O()}]);
//# sourceMappingURL=main.caeaf6a7abfc9d92.js.map