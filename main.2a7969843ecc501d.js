(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[179],{86257:(gi,bs,v)=>{"use strict";var $t=v(36480),e=v(61699),f=(v(4700),v(26575)),S=v(90895),F=v(71268),w=v(86515),Z=v(13228),ln=v(31465),Xl=v(52484),P=v(60702),ec=v(22868),$=v(54860),er=v(12187),tc=v(17474);let zd=(()=>class n{static PADCHAR="=";static ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static getByte(t,o){return t.charCodeAt(o)}static getByte64(t,o){return this.ALPHA.indexOf(t.charAt(o))}static decode(t){let i,s,o=0,a=t.length,l=[];if(t=String(t),0===a)return t;for(t.charAt(a-1)===this.PADCHAR&&(o=1,t.charAt(a-2)===this.PADCHAR&&(o=2),a-=4),i=0;i<a;i+=4)s=this.getByte64(t,i)<<18|this.getByte64(t,i+1)<<12|this.getByte64(t,i+2)<<6|this.getByte64(t,i+3),l.push(String.fromCharCode(s>>16,s>>8&255,255&s));switch(o){case 1:s=this.getByte64(t,i)<<18|this.getByte64(t,i+1)<<12|this.getByte64(t,i+2)<<6,l.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=this.getByte64(t,i)<<18|this.getByte64(t,i+1)<<12,l.push(String.fromCharCode(s>>16))}return l.join("")}static encode(t){let o,i,s=[],a=(t=String(t)).length-t.length%3;if(0===t.length)return t;for(o=0;o<a;o+=3)i=this.getByte(t,o)<<16|this.getByte(t,o+1)<<8|this.getByte(t,o+2),s.push(this.ALPHA.charAt(i>>18)),s.push(this.ALPHA.charAt(i>>12&63)),s.push(this.ALPHA.charAt(i>>6&63)),s.push(this.ALPHA.charAt(63&i));switch(t.length-a){case 1:i=this.getByte(t,o)<<16,s.push(this.ALPHA.charAt(i>>18)+this.ALPHA.charAt(i>>12&63)+this.PADCHAR+this.PADCHAR);break;case 2:i=this.getByte(t,o)<<16|this.getByte(t,o+1)<<8,s.push(this.ALPHA.charAt(i>>18)+this.ALPHA.charAt(i>>12&63)+this.ALPHA.charAt(i>>6&63)+this.PADCHAR)}return s.join("")}})();function Uo(n){return n.map(r=>r instanceof $.LE?r.toString():void 0!==r?JSON.parse(JSON.stringify(r)):r)}const mi=v(95138).getParser(window.navigator.userAgent);class At{static copy(r){let t=!1;if("string"==typeof r){const o=At.createTextArea(r);At.selectText(o),t=At.copyTextToClipboard(),At.destroyTextArea(o)}else At.selectText(r),t=At.copyTextToClipboard();return t}static createTextArea(r){const t=document.createElement("textArea");return t.value=r,document.body.appendChild(t),t}static destroyTextArea(r){document.body.removeChild(r)}static selectText(r){if("iOS"===mi.getOSName()){const t=r.contentEditable,o=r.readOnly,i=document.createRange(),s=window.getSelection();r.contenteditable=!0,r.readonly=!1,i.selectNodeContents(r),s.removeAllRanges(),s.addRange(i),r.setSelectionRange(0,999999),r.contentEditable=t,r.readOnly=o}else r.select()}static copyTextToClipboard(){return("iOS"!==mi.getOSName()||!mi.compareVersion("<10"))&&document.execCommand("copy")}}var tr=function(n){return n.ADDED="added",n.DELETED="deleted",n.MODIFIED="modified",n}(tr||{});class Dt{static diff(r,t,o=4){if(!r&&!t)return"";if(!r)return'<span class="inserted">'+t+"</span>";if(!t)return'<span class="deleted">'+r+"</span>";r=r.toString(),t=t.toString();const i=Dt.getChanges(r,t,"",o),s=t.slice(i.mtc.length+i.ins.length+i.sbs.length),a=r.slice(i.mtc.length+i.del.length+i.sbs.length);let l="";return i.del.length>0&&(i.del='<span class="deleted">'+i.del+"</span>"),i.ins.length>0&&(i.ins='<span class="inserted">'+i.ins+"</span>"),l=i.mtc+i.del+i.ins+i.sbs,l+=""!==a||""!==s?Dt.diff(a,s,o):"",l}static getMatchingSubstring(r,t,o){let i=0,s=!1;const a=r.length,l={fis:a,mtc:o,sbs:""};for(;i<a;)t[i]===r[i]?s?l.sbs+=r[i]:(s=!0,l.fis=i,l.sbs=r[i]):s&&(i=a),++i;return l}static getChanges(r,t,o,i){const s=r.length>=r.length;let[a,l]=s?[r,t]:[t,r],c=0;for(;l[c]===a[c]&&c<l.length;)++c;a=a.split("").slice(c),l=l.slice(c);const u=a.length;let p={fis:l.length,fil:u,sbs:"",mtc:o+t.slice(0,c)},d={sbs:""};if(""!==l)for(let g=0;g<u&&d.sbs.length<i;g++)d=Dt.getMatchingSubstring(l,Dt.rotateArray(a,g),p.mtc),d.fil=g<u-d.fis?d.fis+g:d.fis-u+g,d.sbs.length>p.sbs.length&&(p=d);return[p.del,p.ins]=s?[a.slice(0,p.fil).join(""),l.slice(0,p.fis)]:[l.slice(0,p.fis),a.slice(0,p.fil).join("")],-1===p.del.indexOf(" ")||-1===p.ins.indexOf(" ")||""===p.del||""===p.ins||""===p.sbs?p:Dt.getChanges(p.del,p.ins,p.mtc,i)}static rotateArray(r,t){const o=r.length,i=new Array(r.length);if(t%o==0)return r.slice();for(let s=0;s<o;s++)i[s]=r[(s+(o+t%o))%o];return i}static isValidNumber(r){return!isNaN(Number(r))}static isOctalNumber(r){return Dt.isValidNumber(r)&&r.startsWith("0")&&r.length>1}}class Cs{static findChanges(r,t,o=[]){const i={added:[],deleted:[],modified:[]};if(!r||!t)return i;const s=[...r],a=[...t];for(const l of s){const c=a.findIndex(h=>h.id===l.id);if(-1===c){i.deleted.push({change:{type:tr.DELETED},value:l});continue}const u=a.splice(c,1)[0],p=JSON.parse(JSON.stringify(l)),d=JSON.parse(JSON.stringify(u)),g=Cs.compareObject(p,d,void 0,o);g.length&&i.modified.push({change:{type:tr.MODIFIED,keysChanged:g},value:p,oldValue:l,newValue:u})}return i.added=a.map(l=>({change:{type:tr.ADDED},value:l})),i}static compareObject(r,t,o,i=[]){const s=JSON.parse(JSON.stringify(r)),a=JSON.parse(JSON.stringify(t)),l=new Set([...Object.keys(r),...Object.keys(t)]);let c=[];return l.forEach(u=>{const p=o?`${o}.${u}`:u;-1===i.indexOf(p)&&(Array.isArray(r[u])&&(r[u]=r[u].join(",<br>")),Array.isArray(t[u])&&(t[u]=t[u].join(",<br>")),"object"==typeof r[u]&&"object"==typeof t[u]&&null!==r[u]&&null!==t[u]?c=c.concat(this.compareObject(r[u],t[u],p)):r[u]!==t[u]&&(c.push({key:p,oldValue:s[u],newValue:a[u]}),r[u]=Dt.diff(r[u],t[u])))}),c}}class oc{static create(r,t,o){const i=r.createElement(t);for(const s in o)i[s]=o[s];return i}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}function ic(n,r,t){!function Wd(n,r){const t=document.createElement("a");t.setAttribute("href",n),t.setAttribute("download",r),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}(`data:${r},${encodeURIComponent(n)}`,t)}class R{static resolve(r,t){const o=t.replace(/\[/g,".").replace(/\]/g,"").split(".");let i=r;for(;o.length;){if("object"!=typeof i)return;i=i[o.shift()]}return i}static isObject(r){return r&&"object"==typeof r&&!Array.isArray(r)&&null!==r&&!(r instanceof Date)}static mergeDeep(r,t,o=!1){const i=Object.assign({},r);return R.isObject(r)&&R.isObject(t)&&Object.keys(t).filter(s=>!o||void 0!==t[s]).forEach(s=>{R.isObject(t[s])?s in r?i[s]=R.mergeDeep(r[s],t[s],o):Object.assign(i,{[s]:t[s]}):Object.assign(i,{[s]:t[s]})}),i}static copyDeep(r){const t=Array.isArray(r)?[]:{};for(const o in r)if(r.hasOwnProperty(o)){const i=r[o];t[o]=i&&"object"==typeof i?this.copyDeep(i):i}return t}static removeDuplicateCaseInsensitive(r){const t={},o={},i=[];for(const s in r)if(r.hasOwnProperty(s)){const a=s.toUpperCase();t.hasOwnProperty(a)?t[a].push({[s]:r[s]}):t[a]=[{[s]:r[s]}],i.push({key:s,count:s.replace(/[^A-Z]/g,"").length})}for(const s in t)if(t.hasOwnProperty(s)&&t.hasOwnProperty(s)){const a=t[s];if(1===a.length){const l=a[0];o[s]=l[Object.keys(l)[0]]}else if(a.length>1){const l=i.filter(c=>c.key.toLowerCase()===s.toLowerCase()).reduce((c,u)=>c.y<u.y?c:u);o[l.key.toUpperCase()]=r[l.key]}}for(const s in r)r.hasOwnProperty(s)&&delete r[s];for(const s in o)o.hasOwnProperty(s)&&(r[s]=o[s])}static removeUndefined(r){const t={};return R.isObject(r)?(Object.keys(r).filter(o=>void 0!==r[o]).forEach(o=>{t[o]=R.isObject(r[o])||Array.isArray(r[o])?R.removeUndefined(r[o]):r[o]}),t):Array.isArray(r)?r.map(o=>R.removeUndefined(o)):r}static removeNull(r){const t={};return R.isObject(r)?(Object.keys(r).filter(o=>null!==r[o]).forEach(o=>{t[o]=R.isObject(r[o])||Array.isArray(r[o])?R.removeNull(r[o]):r[o]}),t):Array.isArray(r)?r.map(o=>R.removeNull(o)):r}static naturalCompare(r,t,o="asc",i){if("desc"===o&&(t=[r,r=t][0]),null===r||""===r||void 0===r||null===t||""===t||void 0===t){const l=r===t?0:void 0===r?3:void 0===t?-3:null===r?2:null===t?-2:""===r?1:-1;return"desc"===o?!1!==i?l:-1*l:!0===i?-1*l:l}const s=[],a=[];for(t=""+t,(r=""+r).replace(/(\d+)|(\D+)/g,(l,c,u)=>{s.push([c||1/0,u||""])}),t.replace(/(\d+)|(\D+)/g,(l,c,u)=>{a.push([c||1/0,u||""])});s.length&&a.length;){const l=s.shift(),c=a.shift(),u=l[0]-c[0]||l[1].localeCompare(c[1]);if(u)return u}return s.length-a.length}static objectsAreEquivalent(r,t){if(r===t)return!0;const o=Object.getOwnPropertyNames(r),i=Object.getOwnPropertyNames(t);if(o.length!==i.length)return!1;for(const s of o)if(r[s]!==t[s])return!1;return!0}static removeKeys(r,t){return Object.keys(r).filter(i=>t.indexOf(i)<0).reduce((i,s)=>(i[s]=r[s],i),{})}static isEmpty(r){return 0===Object.keys(r).length}}class hi{static roundToNDecimal(r,t=3){const o=Math.pow(10,t);return Math.round(r*o)/o}}function po(n){return n.reduce((r,t)=>(r[t]=t,r),Object.create(null))}function Go(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Ie(){return`${Go()}${Go()}-${Go()}-${Go()}-${Go()}-${Go()}${Go()}${Go()}`.toLowerCase()}var fe=v(59877),fi=v(53317),ge=function(n){return n[n.Error=0]="Error",n[n.Done=1]="Done",n[n.Working=2]="Working",n[n.Waiting=3]="Waiting",n}(ge||{});class or{status$=new fe.x;status$$;get status(){return this._status}set status(r){this._status=r,this.status$.next(r)}_status;subscribe(r,t){this.watch(),this.status$$=this.status$.pipe((0,fi.x)()).subscribe(o=>{this.handleStatusChange(o),r.call(t,this)})}unsubscribe(){this.unwatch(),void 0!==this.status$$&&(this.status$$.unsubscribe(),this.status$$=void 0),this.status=ge.Waiting}handleStatusChange(r){}}var y=v(58071);let Ni=(()=>{class n{counter$=new y.X(0);ids=[];constructor(){}register(){const t=Ie();return this.ids.push(t),this.counter$.next(this.ids.length),t}unregister(t){const o=this.ids.indexOf(t);-1!==o&&(this.ids.splice(o,1),this.counter$.next(this.ids.length))}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Xd=(()=>{class n{activityService;constructor(t){this.activityService=t}intercept(t,o){const i=t.headers.get("activityInterceptor");if(i){const a=t.clone({headers:t.headers.delete("activityInterceptor")});if("false"===i)return o.handle(a)}const s=this.activityService.register();return o.handle(t).pipe((0,tc.x)(()=>{this.activityService.unregister(s)}))}static \u0275fac=function(o){return new(o||n)(e.LFG(Ni))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})(),xs=(()=>{class n{static forRoot(){return{ngModule:n,providers:[{provide:$.TP,useClass:Xd,multi:!0}]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})();var cn=v(33252),ce=v(2389);const nc={showMenuButton:{alternativeKey:"menu.button.visible",mayBeRemoveIn:new Date("2024-06-06")},menuButtonReverseColor:{alternativeKey:"menu.button.useThemeColor",mayBeRemoveIn:new Date("2024-06-06")},importWithStyle:{alternativeKey:"importExport.importWithStyle",mayBeRemoveIn:new Date("2024-06-06")},hasGeolocateButton:{alternativeKey:"geolocate.button.visible",mayBeRemoveIn:new Date("2024-06-06")}},eg=new Map(Object.entries(nc).filter(([n,r])=>r.alternativeKey).map(([n,r])=>[r.alternativeKey,{deprecatedKey:n}])),Ss={lib:"16.0.2",releaseDate:1699370754368};let N=(()=>{class n{config;httpClient;configDeprecated=new Map(Object.entries(nc));constructor(t){this.httpClient=new $.eN(t)}getConfigs(){return Array.from(this.configDeprecated.keys()).map(t=>{void 0!==R.resolve(this.config,t)&&this.handleDeprecatedConfig(t)}),this.config}getConfig(t,o){let i=R.resolve(this.config,t);return this.configDeprecated.get(t)&&void 0!==i?this.handleDeprecatedConfig(t):void 0===i&&(i=this.handleDeprecationPossibility(t)),i??o}handleDeprecatedConfig(t){const o=this.configDeprecated.get(t);let i=`This config (${t}) is deprecated and will be removed shortly`;o.alternativeKey&&(i+=` You should use this key (${o.alternativeKey}) as an alternate solution`),new Date>=o.mayBeRemoveIn?console.error(i):console.warn(i)}handleDeprecationPossibility(t){const o=eg.get(t);if(o)return this.getConfig(o.deprecatedKey)}load(t){const o=t.default;return t.path?new Promise((i,s)=>{this.httpClient.get(t.path).pipe((0,ce.K)(a=>(console.log(`Configuration file ${t.path} could not be read`),i(!0),(0,cn._)(a.error||"Server error")))).subscribe(a=>{this.config=R.mergeDeep(R.mergeDeep({version:Ss},o),a),i(!0)})}):(this.config=o,!0)}static \u0275fac=function(o){return new(o||n)(e.LFG($.jN))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),rc=new e.OlP("configOptions");function ws(n){return{provide:rc,useValue:n}}function tg(n,r){return()=>n.load(r)}let ir=(()=>{class n{static forRoot(){return{ngModule:n,providers:[ws({}),{provide:e.ip1,useFactory:tg,multi:!0,deps:[N,rc]}]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})();var O=v(5939),Qt=v(74300),I=v(79736);class ig{prefix;suffix;config;httpClient;constructor(r,t,o=".json",i){this.prefix=t,this.suffix=o,this.config=i,this.httpClient=new $.eN(r)}getTranslation(r){const t=this.httpClient.get(`locale/libs_locale/${r}.json`);if(this.config&&!this.prefix){const s=this.config.getConfig("language.prefix");this.prefix=!s||Array.isArray(s)?s:[s]}if(!this.prefix||0===this.prefix.length)return t;const o=this.prefix.map(s=>this.httpClient.get(`${s}${r}${this.suffix}`));return(0,Qt.D)([t,...o]).pipe((0,I.U)(s=>s.reduce((a,l)=>R.mergeDeep(a,l),{})))}}function sc(n,r){return new ig(n,void 0,void 0,r)}function ng(n){return{provide:O.Zw,useFactory:n||sc,deps:[$.jN,N]}}class rg{handle(r){if(!r.translateService.langs.length)throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.");if("igo."===r.key.substr(0,4))throw new Error(`The Key "${r.key}" is missing in locale file.`);return r.key}}let re=(()=>{class n{static forRoot(){return{ngModule:n,providers:[ng()]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[O.aw.forRoot({missingTranslationHandler:{provide:O.gC,useClass:rg}}),O.aw]})}return n})();var ac=v(57548);let Po=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,ac.Rh.forRoot({positionClass:"toast-bottom-right",timeOut:1e4,extendedTimeOut:1e4,titleClass:"mat-subtitle-2",messageClass:"toast-message",closeButton:!0,progressBar:!0,enableHtml:!0,tapToDismiss:!0,maxOpened:4,preventDuplicates:!0,resetTimeoutOnDuplicate:!0,countDuplicates:!1,includeTitleDuplicates:!0})]})}return n})();var ae=v(50655),Lt=v(25267),qo=function(n){return n.ERROR="error",n.ALERT="warning",n.WARNING="warning",n.INFO="info",n.SUCCESS="success",n.SHOW="show",n}(qo||{}),Ye=v(33839);let L=(()=>{class n{translate;language;language$=new y.X(void 0);constructor(t){this.translate=t,this.language=this.translate.getBrowserLang();const o=this.getLanguage();this.translate.setDefaultLang(o),this.language$.next(o)}getLanguage(){return this.language.match(/en|fr/)?this.language:"en"}setLanguage(t){this.language=t.match(/en|fr/)?t:"en",(0,Ye.a)([this.translate.use(this.language),this.translate.reloadLang(this.language)]).subscribe(()=>{this.language$.next(this.language)})}static \u0275fac=function(o){return new(o||n)(e.LFG(O.sK))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),_e=(()=>{class n{injector;configService;languageService;messages$=new y.X([]);options;activeMessageTranslations=[];constructor(t,o,i){this.injector=t,this.configService=o,this.languageService=i,this.options=this.configService.getConfig("message"),this.languageService.language$.pipe((0,ae.b)(500)).subscribe(s=>{0===this.toastr.toasts.length&&(this.activeMessageTranslations=[]),this.toastr.toasts.map(a=>{const l=this.activeMessageTranslations.find(c=>c.id===a.toastId);if(l){const c={...l.textInterpolateParams},u={...l.titleInterpolateParams};l.textInterpolateParams&&Object.keys(l.textInterpolateParams).map(p=>{p&&(c[p]=this.languageService.translate.instant(l.textInterpolateParams[p]))}),l.titleInterpolateParams&&Object.keys(l.titleInterpolateParams).map(p=>{p&&(u[p]=this.languageService.translate.instant(l.titleInterpolateParams[p]))}),(0,Qt.D)([this.languageService.translate.get(l.textKey,c),this.languageService.translate.get(l.titleKey,u)]).pipe((0,Lt.P)()).subscribe(p=>{a.toastRef.componentInstance.message=p[0],a.toastRef.componentInstance.title=p[1]})}})})}get toastr(){return this.injector.get(ac._W)}showError(t){return t.error.caught=!0,this.error(t.error.message,t.error.title)}message(t){const o=t.type;this.toastr.toastrConfig.iconClasses[o]=`toast-${o}`,this.messages$.next(this.messages$.value.concat([t])),t.options=t.options||{};const i=new Date;if(t.options.from=t.options.from?t.options.from:new Date("1 jan 1900"),t.options.to=t.options.to?t.options.to:new Date("1 jan 3000"),"string"==typeof t.options.from&&(t.options.from=new Date(Date.parse(t.options.from.replace(/-/g," ")))),"string"==typeof t.options.to&&(t.options.to=new Date(Date.parse(t.options.to.replace(/-/g," ")))),i>t.options.from&&i<t.options.to&&(!1===t.showIcon&&(this.toastr.toastrConfig.iconClasses[o]=`toast-${o} toast-no-icon`),(t=this.handleTemplate(t)).text)){let s;switch(t.type){case qo.SUCCESS:s=this.success(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case qo.ERROR:s=this.error(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case qo.INFO:s=this.info(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case qo.SHOW:s=this.show(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case qo.ALERT:case qo.WARNING:s=this.alert(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;default:s=this.info(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams)}t.options.id=s.toastId}}success(t,o="igo.core.message.success",i={},s,a){return this.handleNgxToastr("success",t,o,i,s,a)}error(t,o="igo.core.message.error",i={},s,a){return this.handleNgxToastr("error",t,o,i,s,a)}info(t,o="igo.core.message.info",i={},s,a){return this.handleNgxToastr("info",t,o,i,s,a)}alert(t,o="igo.core.message.alert",i={},s,a){return this.handleNgxToastr("alert",t,o,i,s,a)}show(t,o="igo.core.message.info",i={},s,a){return this.handleNgxToastr("show",t,o,i,s,a)}handleNgxToastr(t,o,i,s={},a,l){const c={...a},u={...l};a&&Object.keys(a).map(h=>{const m=a[h];m&&(c[h]="string"==typeof m?this.languageService.translate.instant(m):m)}),l&&Object.keys(l).map(h=>{if(h){const m=l[h];u[h]="string"==typeof m?this.languageService.translate.instant(m):m}});const p=this.languageService.translate.instant(o,c),d=this.languageService.translate.instant(i,u);let g;switch(t){case"success":g=this.toastr.success(p,d,s);break;case"error":g=this.toastr.error(p,d,s);break;case"show":case"info":g=this.toastr.info(p,d,s);break;case"alert":g=this.toastr.warning(p,d,s)}return this.activeMessageTranslations.push({id:g.toastId,titleKey:i,textKey:o,textInterpolateParams:a,titleInterpolateParams:l}),g}remove(t){this.toastr.remove(t)}removeAllAreNotError(){for(const t of this.messages$.value)t.type!==qo.ERROR&&this.remove(t.options.id)}handleTemplate(t){if(!this.options?.template||t.html)return t;let o=this.options?.template;return o=o.replace("${text}",t.text),o=o.replace("${title}",t.title),t.html=void 0,t.text=o,t.title=void 0,t}static \u0275fac=function(o){return new(o||n)(e.LFG(e.zs3),e.LFG(N),e.LFG(L))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),sg=(()=>{class n{messageService;constructor(t){this.messageService=t}intercept(t,o){const i=t.headers.get("interceptError"),s=t.clone({headers:t.headers.delete("interceptError")});if("false"===i)return o.handle(s);const a={httpError:void 0};return o.handle(s).pipe((0,ce.K)(l=>this.handleError(l,a)),(0,tc.x)(()=>{const l=a.httpError;l&&(l.error.toDisplay?this.handleCaughtError(l):l.error.caught||this.handleUncaughtError(l))}))}handleError(t,o){if(t instanceof $.UA){const i="object"===t.error?t.error:{};i.message=t.error?.message||t.statusText,i.caught=!1,t=new $.UA({error:i,headers:t.headers,status:t.status,statusText:t.statusText,url:t.url})}return o.httpError=t,(0,cn._)(t)}handleCaughtError(t){t.error.caught=!0,this.messageService.error(t.error.message,t.error.title,{progressBar:!1})}handleUncaughtError(t){t.error.caught=!0,this.messageService.error("igo.core.errors.uncaught.message","igo.core.errors.uncaught.title",{progressBar:!1})}static \u0275fac=function(o){return new(o||n)(e.LFG(_e))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ts=(()=>{class n{static forRoot(){return{ngModule:n,providers:[{provide:$.TP,useClass:sg,multi:!0}]}}constructor(t){if(t)throw new Error("IgoErrorModule is already loaded. Import it in the AppModule only")}static \u0275fac=function(o){return new(o||n)(e.LFG(n,12))};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})();const ag={name:"igo2DB",version:2,objectStoresMeta:[{store:"geoData",storeConfig:{keyPath:"url",autoIncrement:!1},storeSchema:[{name:"regionID",keypath:"regionID",options:{unique:!1}}]},{store:"layerData",storeConfig:{keyPath:"layerId",autoIncrement:!1},storeSchema:[{name:"layerOptions",keypath:"layerOptions",options:{unique:!1}},{name:"sourceOptions",keypath:"sourceOptions",options:{unique:!1}}]}]};let lg=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}constructor(t,o){t.addSvgIconSet(o.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}static \u0275fac=function(o){return new(o||n)(e.LFG(w.jv),e.LFG($t.H7))};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,$.JF,xs.forRoot(),ir.forRoot(),Ts.forRoot(),re.forRoot(),Po.forRoot(),er.Cz.forRoot(ag),xs,ir,Ts,re,Po]})}return n})();var ee=v(14447);let lc=new e.OlP("routeServiceOptions"),un=(()=>{class n{router;route;options;constructor(t,o,i){this.router=t,this.route=o,this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"},i)}get queryParams(){let t=decodeURIComponent(location.search);if(t.includes("\xa2er=")){t=t.replace("\xa2er","&center");const o=t.slice(1).split("&").map(i=>i.split("=")).reduce((i,s)=>{const[a,l]=s.map(decodeURIComponent);return i[a]=l,i},{});this.router.navigate([],{queryParams:o})}return this.route.queryParams}static \u0275fac=function(o){return new(o||n)(e.LFG(ee.F0),e.LFG(ee.gz),e.LFG(lc,8))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var to=function(n){return n.Mobile="mobile",n.Tablet="tablet",n.Desktop="desktop",n}(to||{}),jo=function(n){return n.Portrait="portrait",n.Landscape="landscape",n}(jo||{}),Qo=v(39743);let ct=(()=>{class n{media$=new y.X(void 0);orientation$=new y.X(void 0);constructor(t){t.observe([Qo.u3.HandsetLandscape]).subscribe(o=>{o.matches&&(this.media$.next(to.Mobile),this.orientation$.next(jo.Landscape))}),t.observe([Qo.u3.HandsetPortrait]).subscribe(o=>{o.matches&&(this.media$.next(to.Mobile),this.orientation$.next(jo.Portrait))}),t.observe([Qo.u3.TabletLandscape]).subscribe(o=>{o.matches&&(this.media$.next(to.Tablet),this.orientation$.next(jo.Landscape))}),t.observe([Qo.u3.TabletPortrait]).subscribe(o=>{o.matches&&(this.media$.next(to.Tablet),this.orientation$.next(jo.Portrait))}),t.observe([Qo.u3.WebLandscape]).subscribe(o=>{o.matches&&(this.media$.next(to.Desktop),this.orientation$.next(jo.Landscape))}),t.observe([Qo.u3.WebPortrait]).subscribe(o=>{o.matches&&(this.media$.next(to.Desktop),this.orientation$.next(jo.Portrait))})}getMedia(){return this.media$.value}getOrientation(){return this.orientation$.value}isTouchScreen(){return"ontouchstart"in document.documentElement}isMobile(){return"mobile"===this.getMedia()}isDesktop(){return"desktop"===this.getMedia()}static \u0275fac=function(o){return new(o||n)(e.LFG(Qo.Yg))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Pe=function(n){return n.SESSION="Session",n.LOCAL="Local",n}(Pe||{}),Yo=function(n){return n.ADDED="Added",n.MODIFIED="Modified",n.REMOVED="Removed",n.CLEARED="Cleared",n}(Yo||{});class cc{options;storageChange$=new y.X(void 0);constructor(r){this.options=r.getConfig("storage")||{key:"igo"}}get(r,t){let o;if((!t||t===Pe.SESSION)&&(o=sessionStorage.getItem(`${this.options.key}.${r}`)),(t===Pe.LOCAL||!o&&!t)&&(o=localStorage.getItem(`${this.options.key}.${r}`)),o)try{o=JSON.parse(o)}catch{}return o}set(r,t,o=Pe.LOCAL){const i=this.get(r,o);o===Pe.SESSION?sessionStorage.setItem(`${this.options.key}.${r}`,JSON.stringify(t)):localStorage.setItem(`${this.options.key}.${r}`,JSON.stringify(t));const s=this.get(r,o);s!==i&&this.storageChange$.next({key:r,scope:o,event:void 0!==i?Yo.MODIFIED:Yo.ADDED,previousValue:i,currentValue:s})}remove(r,t=Pe.LOCAL){const o=this.get(r,t);t===Pe.SESSION?sessionStorage.removeItem(`${this.options.key}.${r}`):localStorage.removeItem(`${this.options.key}.${r}`),this.storageChange$.next({key:r,scope:t,event:Yo.REMOVED,previousValue:o})}clear(r=Pe.LOCAL){r===Pe.SESSION?sessionStorage.clear():localStorage.clear(),this.storageChange$.next({scope:r,event:Yo.CLEARED})}}let oe=(()=>{class n extends cc{config;constructor(t){super(t),this.config=t}static \u0275fac=function(o){return new(o||n)(e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ue=v(12235);function Fs(n,r,t){return n>>r&(1<<t)-1}let cg=(()=>{class n{base64Index=new Map;indexBase64=new Map;constructor(){this.generateBase64Index()}generateBase64Index(){for(let t=0;t<26;t++)this.base64Index.set(String.fromCharCode("A".charCodeAt(0)+t),t),this.indexBase64.set(t,String.fromCharCode("A".charCodeAt(0)+t));for(let t=0;t<26;t++)this.base64Index.set(String.fromCharCode("a".charCodeAt(0)+t),t+26),this.indexBase64.set(t+26,String.fromCharCode("a".charCodeAt(0)+t));for(let t=0;t<10;t++)this.base64Index.set(String.fromCharCode("0".charCodeAt(0)+t),t+52),this.indexBase64.set(t+52,String.fromCharCode("0".charCodeAt(0)+t));this.base64Index.set("+",62),this.base64Index.set("/",63),this.indexBase64.set(62,"+"),this.indexBase64.set(63,"/")}compressBlob(t){return t?new ue.y(i=>{const s=new FileReader;s.readAsDataURL(t),s.onload=()=>{const a=s.result.valueOf(),l=a.substr(a.indexOf(",")+1),c=this.compressStringBase64(l);i.next({length:l.length,type:t.type,object:c})}}):void 0}decompressBlob(t){const s=this.decompressStringBase64(t.object,t.length),a=atob(s),l=new Array(a.length);for(let p=0;p<a.length;p++)l[p]=a.charCodeAt(p);const c=new Uint8Array(l);return new Blob([c],{type:t.type})}compressStringBase64(t){let o="",i=16,s=0,a=0;for(const l of t){const c=this.base64Index.get(l);i>6?(i-=6,s+=c<<i):(a=6-i,s+=c>>a,o+=String.fromCharCode(s),s=c<<16-a,i=16-a)}return t.length%8!=0&&(o+=String.fromCharCode(s)),String.fromCharCode(9731)+o}decompressStringBase64(t,o){if(!t)return;if(9731!==t.charCodeAt(0))return t;let i=0,s=0,a=16,l="",c=1,u=t.charCodeAt(c);for(let p=0;p<o;p++)a>6?(a-=6,i=Fs(u,a,6),l+=this.indexBase64.get(i)):(s=6-a,i=Fs(u,0,a)<<s,u=t.charCodeAt(++c),i+=Fs(u,16-s,s),l+=this.indexBase64.get(i),a=16-s);return l}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var go=v(59016),uc=v(75043);let nr=(()=>{class n{messageService;injector;stateChangeEventEmitter=new e.vpe;onlineSubscription;offlineSubscription;previousMessageId;state={connection:window.navigator.onLine};constructor(t,o){this.messageService=t,this.injector=o,this.checkNetworkState()}checkNetworkState(){this.onlineSubscription=(0,go.R)(window,"online").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const t=this.messageService.info("igo.core.network.online.message","igo.core.network.online.title");this.previousMessageId=t.toastId,this.state.connection=!0,this.emitEvent()}),this.offlineSubscription=(0,go.R)(window,"offline").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const t=this.messageService.info("igo.core.network.offline.message","igo.core.network.offline.title");this.previousMessageId=t.toastId,this.state.connection=!1,this.emitEvent()})}emitEvent(){this.stateChangeEventEmitter.emit(this.state)}ngOnDestroy(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch{}}currentState(t=!0){return t?this.stateChangeEventEmitter.pipe((0,ae.b)(300),(0,uc.O)(this.state)):this.stateChangeEventEmitter.pipe((0,ae.b)(300))}static \u0275fac=function(o){return new(o||n)(e.LFG(_e),e.LFG(e.zs3))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ug=(()=>{class n{config;options;constructor(t){this.config=t,this.options=this.config.getConfig("regex")}getAll(){return this.options}get(t){if(this.options)return this.options[t]}static \u0275fac=function(o){return new(o||n)(e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var oo=v(39877);const pg=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"**",redirectTo:"/home"}];let dg=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[ee.Bz.forRoot(pg,{useHash:!0}),ee.Bz]})}return n})();var pc=v(22775);let gg=(()=>{class n{document;changeDetectorRef;media;router;mobileQuery;title="IGO";version=Ss;_mobileQueryListener;constructor(t,o,i,s){this.document=t,this.changeDetectorRef=o,this.media=i,this.router=s,this.mobileQuery=this.media.matchMedia("(max-width: 600px)"),this._mobileQueryListener=()=>this.changeDetectorRef.detectChanges(),this.mobileQuery.addEventListener("change",this._mobileQueryListener),this.detectOldBrowser()}ngOnInit(){this.handleSplashScreen()}handleSplashScreen(){this.router.events.pipe((0,Lt.P)(t=>t instanceof ee.m2),(0,pc.g)(300)).subscribe(()=>{this._removeSplashScreen()})}_removeSplashScreen(){const t=this.document.getElementById("splash-screen");if(!t)return;t.classList.add("is-destroying");const i=this.document.getElementById("splash-screen-stylesheet");setTimeout(()=>{oc.remove(t),oc.remove(i)},300)}ngOnDestroy(){this.mobileQuery.removeEventListener("change",this._mobileQueryListener)}detectOldBrowser(){mi.satisfies({ie:"<=11",chrome:"<64",firefox:"<60"})&&console.log("Very old browser ! ",mi.getBrowser())}static \u0275fac=function(o){return new(o||n)(e.Y36(f.K0),e.Y36(e.sBO),e.Y36(Qo.vx),e.Y36(ee.F0))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-root"]],decls:91,vars:8,consts:[[1,"example-container"],["color","primary",1,"example-toolbar","mat-elevation-z6"],["mat-icon-button","",3,"click"],["svgIcon","menu"],[1,"mat-subtitle-1","m-b-0"],[1,"example-sidenav-container"],["opened","true","fixedTopGap","56",3,"mode","fixedInViewport"],["snav",""],["mat-list-item","","routerLink","."],["mat-list-item","","routerLink","activity"],["mat-list-item","","routerLink","config"],["mat-list-item","","routerLink","language"],["mat-list-item","","routerLink","media"],["mat-list-item","","routerLink","message"],["mat-list-item","","routerLink","request"],["mat-list-item","","routerLink","auth-form"],["mat-list-item","","routerLink","action"],["mat-list-item","","routerLink","dynamic-component"],["mat-list-item","","routerLink","entity-table"],["mat-list-item","","routerLink","entity-selector"],["mat-list-item","","routerLink","form"],["mat-list-item","","routerLink","table"],["mat-list-item","","routerLink","tool"],["mat-list-item","","routerLink","widget"],["mat-list-item","","routerLink","simple-map"],["mat-list-item","","routerLink","layer"],["mat-list-item","","routerLink","legend"],["mat-list-item","","routerLink","overlay"],["mat-list-item","","routerLink","geometry"],["mat-list-item","","routerLink","feature"],["mat-list-item","","routerLink","hover"],["mat-list-item","","routerLink","measure"],["mat-list-item","","routerLink","draw"],["mat-list-item","","routerLink","query"],["mat-list-item","","routerLink","catalog"],["mat-list-item","","routerLink","search"],["mat-list-item","","routerLink","print"],["mat-list-item","","routerLink","import-export"],["mat-list-item","","routerLink","directions"],["mat-list-item","","routerLink","time-filter"],["mat-list-item","","routerLink","ogc-filter"],["mat-list-item","","routerLink","spatial-filter"],["mat-list-item","","routerLink","workspace"],["mat-list-item","","routerLink","context"]],template:function(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",0)(1,"mat-toolbar",1)(2,"button",2),e.NdJ("click",function(){e.CHM(s);const l=e.MAs(10);return e.KtG(l.toggle())}),e._UZ(3,"mat-icon",3),e.qZA(),e.TgZ(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"h5",4),e._uU(7),e.qZA()(),e.TgZ(8,"mat-sidenav-container",5)(9,"mat-sidenav",6,7)(11,"mat-nav-list")(12,"a",8),e._uU(13,"Home"),e.qZA(),e._UZ(14,"hr"),e.TgZ(15,"a",9),e._uU(16,"Activity"),e.qZA(),e.TgZ(17,"a",10),e._uU(18,"Config"),e.qZA(),e.TgZ(19,"a",11),e._uU(20,"Language"),e.qZA(),e.TgZ(21,"a",12),e._uU(22,"Media"),e.qZA(),e.TgZ(23,"a",13),e._uU(24,"Message"),e.qZA(),e.TgZ(25,"a",14),e._uU(26,"Request"),e.qZA(),e._UZ(27,"hr"),e.TgZ(28,"a",15),e._uU(29,"Authentification"),e.qZA(),e._UZ(30,"hr"),e.TgZ(31,"a",16),e._uU(32,"Action"),e.qZA(),e.TgZ(33,"a",17),e._uU(34,"Dynamic Component"),e.qZA(),e.TgZ(35,"a",18),e._uU(36,"Entity Table"),e.qZA(),e.TgZ(37,"a",19),e._uU(38,"Entity Selector"),e.qZA(),e.TgZ(39,"a",20),e._uU(40,"Form"),e.qZA(),e.TgZ(41,"a",21),e._uU(42,"Table"),e.qZA(),e.TgZ(43,"a",22),e._uU(44,"Tool"),e.qZA(),e.TgZ(45,"a",23),e._uU(46,"Widget"),e.qZA(),e._UZ(47,"hr"),e.TgZ(48,"a",24),e._uU(49,"Simple map"),e.qZA(),e.TgZ(50,"a",25),e._uU(51,"Layer"),e.qZA(),e.TgZ(52,"a",26),e._uU(53,"Legend"),e.qZA(),e.TgZ(54,"a",27),e._uU(55,"Overlay"),e.qZA(),e.TgZ(56,"a",28),e._uU(57,"Geometry"),e.qZA(),e.TgZ(58,"a",29),e._uU(59,"Feature"),e.qZA(),e.TgZ(60,"a",30),e._uU(61,"Hover"),e.qZA(),e.TgZ(62,"a",31),e._uU(63,"Measure"),e.qZA(),e.TgZ(64,"a",32),e._uU(65,"Draw"),e.qZA(),e.TgZ(66,"a",33),e._uU(67,"Query"),e.qZA(),e.TgZ(68,"a",34),e._uU(69,"Catalog"),e.qZA(),e.TgZ(70,"a",35),e._uU(71,"Search"),e.qZA(),e.TgZ(72,"a",36),e._uU(73,"Print"),e.qZA(),e.TgZ(74,"a",37),e._uU(75,"Import/Export"),e.qZA(),e.TgZ(76,"a",38),e._uU(77,"Directions"),e.qZA(),e.TgZ(78,"a",39),e._uU(79,"Time filter"),e.qZA(),e.TgZ(80,"a",40),e._uU(81,"OGC filter"),e.qZA(),e.TgZ(82,"a",41),e._uU(83,"Spatial filter"),e.qZA(),e.TgZ(84,"a",42),e._uU(85,"Workspace"),e.qZA(),e._UZ(86,"hr"),e.TgZ(87,"a",43),e._uU(88,"Context"),e.qZA()()(),e.TgZ(89,"mat-sidenav-content"),e._UZ(90,"router-outlet"),e.qZA()()()}2&o&&(e.ekj("example-is-mobile",i.mobileQuery.matches),e.xp6(5),e.Oqu(i.title),e.xp6(2),e.Oqu(i.version.lib),e.xp6(1),e.Udp("margin-top",i.mobileQuery.matches?56:0,"px"),e.xp6(1),e.Q6J("mode",i.mobileQuery.matches?"over":"side")("fixedInViewport",i.mobileQuery.matches))},dependencies:[ln.JX,ln.TM,ln.Rh,Xl.Ye,S.RK,w.Hw,Z.Hk,Z.Tg,ee.lC,ee.rH],styles:[".example-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;inset:0}.example-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;z-index:2}.example-toolbar[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}.example-is-mobile[_ngcontent-%COMP%]   .example-toolbar[_ngcontent-%COMP%]{position:fixed;z-index:2}.example-sidenav-container[_ngcontent-%COMP%]{flex:1}.example-is-mobile[_ngcontent-%COMP%]   .example-sidenav-container[_ngcontent-%COMP%]{flex:1 0 auto}.example-is-mobile[_ngcontent-%COMP%]   mat-sidenav[_ngcontent-%COMP%]{background-color:#fff}mat-sidenav-content[_ngcontent-%COMP%]{padding:10px;box-sizing:border-box}"]})}return n})();var _i=v(74520),z=v(84980),Bi=v(13738),Mt=v(24267),mg=v(64181),hg=v.n(mg);let Os=(()=>{class n{injector;options;tokenKey;constructor(t){this.injector=t;const o=this.injector.get(N);this.options=o.getConfig("auth"),this.tokenKey=this.options?.tokenKey}set(t){localStorage.setItem(this.tokenKey,t)}remove(){localStorage.removeItem(this.tokenKey)}get(){return localStorage.getItem(this.tokenKey)}decode(){const t=this.get();if(t)return hg()(t)}isExpired(){const t=this.decode(),o=(new Date).getTime()/1e3;return!(t&&o<t.exp)}static \u0275fac=function(o){return new(o||n)(e.LFG(e.zs3))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),He=(()=>{class n{http;tokenService;config;languageService;messageService;router;authenticate$=new y.X(void 0);logged$=new y.X(void 0);redirectUrl;languageForce=!1;anonymous=!1;authOptions;get hasAuthService(){return void 0!==this.authOptions?.url}constructor(t,o,i,s,a,l){this.http=t,this.tokenService=o,this.config=i,this.languageService=s,this.messageService=a,this.router=l,this.authOptions=this.config.getConfig("auth"),this.authenticate$.next(this.authenticated),this.authenticate$.subscribe(c=>{this.logged$.next(c),Mt.h.next()})}login(t,o){const i=new $.WM({"Content-Type":"application/json"}),s={username:t,password:this.encodePassword(o)};return this.loginCall(s,i)}loginWithToken(t,o,i){const s=new $.WM({"Content-Type":"application/json"});return this.loginCall({token:t,typeConnection:o,infosUser:i},s)}loginAnonymous(){return this.anonymous=!0,this.logged$.next(!0),(0,z.of)(!0)}refresh(){return this.http.post(`${this.authOptions?.url}/refresh`,{}).pipe((0,Bi.b)(t=>{this.tokenService.set(t.token)}),(0,ce.K)(t=>{throw t.error.caught=!0,t}))}logout(){return this.anonymous=!1,this.tokenService.remove(),this.authenticate$.next(!1),(0,z.of)(!0)}isAuthenticated(){return!this.tokenService.isExpired()}getToken(){return this.tokenService.get()}decodeToken(){return!!this.isAuthenticated()&&this.tokenService.decode()}goToRedirectUrl(){if(!this.router)return;const t=this.redirectUrl||this.router.url;t===this.authOptions.loginRoute?this.router.navigateByUrl(this.authOptions.homeRoute||"/"):t&&this.router.navigateByUrl(t)}getUserInfo(){return this.http.get(this.authOptions?.url+"/info")}getProfils(){return this.http.get(`${this.authOptions?.url}/profils`)}updateUser(t){return this.http.patch(this.authOptions?.url,t)}encodePassword(t){return zd.encode(t)}get logged(){return this.authenticated||this.isAnonymous}get isAnonymous(){return this.anonymous}get authenticated(){return this.isAuthenticated()}get isAdmin(){const t=this.decodeToken();return!!(t&&t.user&&t.user.isAdmin)}loginCall(t,o){return this.http.post(`${this.authOptions?.url}/login`,t,{headers:o}).pipe((0,Bi.b)(i=>{this.tokenService.set(i.token);const s=this.decodeToken();s&&s.user&&(s.user.locale&&!this.languageForce&&this.languageService.setLanguage(s.user.locale),s.user.isExpired&&this.messageService.alert("igo.auth.error.Password expired")),this.authenticate$.next(!0)}),(0,ce.K)(i=>{throw i.error.caught=!0,i}))}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(Os),e.LFG(N),e.LFG(L),e.LFG(_e),e.LFG(ee.F0,8))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),fg=(()=>{class n{authService;config;languageService;appRef;options;login=new e.vpe;constructor(t,o,i,s){this.authService=t,this.config=o,this.languageService=i,this.appRef=s,this.options=this.config.getConfig("auth.google"),this.options?.apiKey&&this.options?.clientId?(this.loadSDKGoogle(),this.loadPlatform()):console.warn('Google authentification needs "apiKey" and "clientId" options')}handleSignInClick(){window.gapi.auth2.getAuthInstance().signIn()}handleSignOutClick(){window.gapi.auth2.getAuthInstance().signOut()}handleClientLoad(){window.gapi.load("client:auth2",()=>this.initClient())}initClient(){window.gapi.client.init({apiKey:this.options?.apiKey,clientId:this.options?.clientId,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(()=>{this.handleSignOutClick(),this.updateTextButton(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(t=>{this.updateSigninStatus(t)})})}updateSigninStatus(t){this.updateTextButton(),t&&this.loginGoogle(window.gapi.client.getToken().access_token)}updateTextButton(){const t=document.querySelector('span[id^="not_signed_"]');t&&"en"!==this.languageService.getLanguage()&&("Sign in with Google"===t.innerHTML?t.innerHTML=this.languageService.translate.instant("igo.auth.google.login"):"Signed in with Google"===t.innerHTML&&(t.innerHTML=this.languageService.translate.instant("igo.auth.google.logged")))}loginGoogle(t){this.authService.loginWithToken(t,"google").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKGoogle(){const t=document.getElementsByTagName("script")[0],o=document.createElement("script");o.id="google-jssdk",o.src="https://apis.google.com/js/api.js",o.onload=()=>{this.handleClientLoad()},t.parentNode.insertBefore(o,t)}loadPlatform(){const t=document.getElementsByTagName("script")[0],o=document.createElement("script");o.id="google-platform",o.src="https://apis.google.com/js/platform.js",t.parentNode.insertBefore(o,t)}static \u0275fac=function(o){return new(o||n)(e.Y36(He),e.Y36(N),e.Y36(L),e.Y36(e.z2F))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-auth-google"]],outputs:{login:"login"},decls:1,vars:0,consts:[["data-height","40","data-width","265","data-longtitle","true",1,"g-signin2","google-login-button"]],template:function(o,i){1&o&&e._UZ(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block}.google-login-button[_ngcontent-%COMP%]     .abcRioButton{color:#000000de}"],changeDetection:0})}return n})();var _=v(28849),j=v(99674);function _g(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.loginAnonymous())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.loading),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.auth.accessAnonymous")," ")}}function yg(n,r){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"font",8),e._uU(3),e.qZA()()),2&n){const t=e.oxw();e.xp6(3),e.Oqu(t.error)}}let bg=(()=>{class n{auth;languageService;get allowAnonymous(){return this._allowAnonymous}set allowAnonymous(t){this._allowAnonymous=t}_allowAnonymous=!0;error="";form;loading=!1;login=new e.vpe;constructor(t,o,i){this.auth=t,this.languageService=o,this.form=i.group({username:["",_.kI.required],password:["",_.kI.required]})}loginUser(t){return this.loading=!0,this.auth.login(t.username,t.password).subscribe(()=>{this.login.emit(!0),this.loading=!1},o=>{try{this.languageService.translate.get("igo.auth.error."+o.error.message).subscribe(i=>this.error=i)}catch{this.error=o.error.message}this.loading=!1}),!1}loginAnonymous(){this.auth.loginAnonymous().subscribe(()=>{this.login.emit(!0)})}static \u0275fac=function(o){return new(o||n)(e.Y36(He),e.Y36(L),e.Y36(_.QS))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-auth-intern"]],inputs:{allowAnonymous:"allowAnonymous"},outputs:{login:"login"},decls:20,vars:18,consts:[["role","form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","formControlName","username",3,"placeholder"],["matInput","","required","","type","password","formControlName","password",3,"placeholder"],["mat-raised-button","","type","submit"],["mat-raised-button","","class","anonymous","type","button",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["mat-raised-button","","type","button",1,"anonymous",3,"disabled","click"],["size","3","color","red"]],template:function(o,i){1&o&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return i.loginUser(i.form.value)}),e.TgZ(1,"div")(2,"mat-form-field",1)(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"input",2),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"div")(9,"mat-form-field",1)(10,"mat-label"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e._UZ(13,"input",3),e.ALo(14,"translate"),e.qZA()(),e.TgZ(15,"button",4),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.YNc(18,_g,3,4,"button",5),e.YNc(19,yg,4,1,"div",6),e.qZA()),2&o&&(e.Q6J("formGroup",i.form),e.xp6(4),e.Oqu(e.lcZ(5,8,"igo.auth.user")),e.xp6(2),e.s9C("placeholder",e.lcZ(7,10,"igo.auth.user")),e.xp6(5),e.Oqu(e.lcZ(12,12,"igo.auth.password")),e.xp6(2),e.s9C("placeholder",e.lcZ(14,14,"igo.auth.password")),e.xp6(3),e.hij(" ",e.lcZ(17,16,"igo.auth.login")," "),e.xp6(2),e.Q6J("ngIf",i.allowAnonymous),e.xp6(1),e.Q6J("ngIf",i.error))},dependencies:[f.O5,_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.sg,_.u,F.KE,F.hX,j.Nt,S.lW,O.X$],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.anonymous[_ngcontent-%COMP%]{margin-left:10px}"]})}return n})(),vg=(()=>{class n{authService;config;appRef;options;login=new e.vpe;constructor(t,o,i){this.authService=t,this.config=o,this.appRef=i,this.options=this.config.getConfig("auth.facebook"),this.options?.appId?this.loadSDKFacebook():console.warn('Facebook authentification needs "appId" option')}subscribeEvents(){window.FB.Event.subscribe("auth.statusChange",t=>{this.statusChangeCallback(t)})}statusChangeCallback(t){"connected"===t.status&&this.loginFacebook(t.authResponse.accessToken)}loginFacebook(t){this.authService.loginWithToken(t,"facebook").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKFacebook(){if(document.getElementById("facebook-jssdk"))return;const o=document.getElementsByTagName("script")[0],i=document.createElement("script");i.id="facebook-jssdk",i.src=`https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9&appId=${this.options?.appId}`,i.onload=()=>{this.subscribeEvents()},o.parentNode.insertBefore(i,o)}static \u0275fac=function(o){return new(o||n)(e.Y36(He),e.Y36(N),e.Y36(e.z2F))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-auth-facebook"]],outputs:{login:"login"},decls:1,vars:0,consts:[["scope","public_profile,email","data-max-rows","1","data-size","large","data-button-type","login_with","data-show-faces","false","data-auto-logout-link","false","data-use-continue-as","false",1,"fb-login-button"]],template:function(o,i){1&o&&e._UZ(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-3px}"],changeDetection:0})}return n})();var Ne=v(71670),Yt=v(96519),rr=v(78900),Ji=v(44011),dc=v(3963),ko=v(20274);let Cg=(()=>{class n{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new fe.x;login=new e.vpe;broadcastService;constructor(t,o,i,s,a){this.authService=t,this.config=o,this.appRef=i,this.msalService=s,this.msalGuardConfig=a,this.options=this.config.getConfig("auth.microsoft"),this.msalService.instance=new rr.L({auth:this.options,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new Yt.J$(this.msalService.instance,this.msalService),this.options?.clientId?this.broadcastService.inProgress$.pipe((0,_i.h)(l=>l===Ji.$H.None),(0,ko.R)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoft(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(t=>{this.msalService.instance.setActiveAccount(t.account),this.checkAccount()})}checkAccount(){var t=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(o=>{this.authService.loginWithToken(o.accessToken,"microsoft",{tokenId:o.idToken}).subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var o=(0,Ne.Z)(function*(i){if(i instanceof dc.Yo)return t.msalService.acquireTokenPopup(t.getConf().authRequest);console.log(i)});return function(i){return o.apply(this,arguments)}}()).catch(o=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(t=>"add"===t.type)[0]}static \u0275fac=function(o){return new(o||n)(e.Y36(He),e.Y36(N),e.Y36(e.z2F),e.Y36(Yt.W2),e.Y36(Yt.S9))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-auth-microsoft"]],outputs:{login:"login"},decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(o,i){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return i.loginMicrosoft()}),e._UZ(1,"mat-icon",1),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"igo.auth.microsoft.login"),"\n"))},dependencies:[w.Hw,S.lW,O.X$],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return n})();var xg=v(91938),io=v(56231);let As=(()=>{class n{instance;location;redirectHash;logger;name="@azure/msal-angular";version="2.0.0-beta.2";constructor(t,o){this.instance=t,this.location=o;const i=this.location.path(!0).split("#").pop();i&&(this.redirectHash=`#${i}`),this.instance.initializeWrapperLibrary(Ji.lA.Angular,this.version)}initialize(){return(0,io.D)(this.instance.initialize())}acquireTokenPopup(t){return(0,io.D)(this.instance.acquireTokenPopup(t))}acquireTokenRedirect(t){return(0,io.D)(this.instance.acquireTokenRedirect(t))}acquireTokenSilent(t){return(0,io.D)(this.instance.acquireTokenSilent(t))}handleRedirectObservable(t){return(0,io.D)(this.instance.handleRedirectPromise(t||this.redirectHash))}loginPopup(t){return(0,io.D)(this.instance.loginPopup(t))}loginRedirect(t){return(0,io.D)(this.instance.loginRedirect(t))}logout(t){return(0,io.D)(this.instance.logout(t))}logoutRedirect(t){return(0,io.D)(this.instance.logoutRedirect(t))}logoutPopup(t){return(0,io.D)(this.instance.logoutPopup(t))}ssoSilent(t){return(0,io.D)(this.instance.ssoSilent(t))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(this.name,this.version)),this.logger}setLogger(t){this.logger=t.clone(this.name,this.version),this.instance.setLogger(t)}static \u0275fac=function(o){return new(o||n)(e.LFG(Yt.sK),e.LFG(f.Ye))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})(),Sg=(()=>{class n{msalInstance;authService;_msalSubject;msalSubject$;_inProgress;inProgress$;constructor(t,o){this.msalInstance=t,this.authService=o,this._msalSubject=new fe.x,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new y.X(Ji.$H.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(i=>{this._msalSubject.next(i);const s=xg.w.getInteractionStatusFromEvent(i);null!==s&&(this.authService.getLogger().verbose(`BroadcastService - ${i.eventType} results in setting inProgress to ${s}`),this._inProgress.next(s))})}static \u0275fac=function(o){return new(o||n)(e.LFG(Yt.sK),e.LFG(As))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})(),wg=(()=>{class n{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new fe.x;login=new e.vpe;broadcastService;constructor(t,o,i,s,a){this.authService=t,this.config=o,this.appRef=i,this.msalService=s,this.msalGuardConfig=a,this.options=this.config.getConfig("auth.microsoftb2c")||{},this.msalService.instance=new rr.L({auth:this.options.browserAuthOptions,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new Sg(this.msalService.instance,this.msalService),this.options.browserAuthOptions.clientId?this.broadcastService.inProgress$.pipe((0,_i.h)(l=>l===Ji.$H.None),(0,ko.R)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoftb2c(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(t=>{this.msalService.instance.setActiveAccount(t.account),this.checkAccount()})}checkAccount(){var t=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(o=>{this.authService.loginWithToken(o.idToken,"microsoftb2c").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var o=(0,Ne.Z)(function*(i){if(i instanceof dc.Yo)return t.msalService.acquireTokenPopup(t.getConf().authRequest)});return function(i){return o.apply(this,arguments)}}()).catch(o=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(t=>"b2c"===t.type)[0]}static \u0275fac=function(o){return new(o||n)(e.Y36(He),e.Y36(N),e.Y36(e.z2F),e.Y36(As),e.Y36(Yt.S9))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-auth-microsoftb2c"]],outputs:{login:"login"},decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(o,i){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return i.loginMicrosoftb2c()}),e._UZ(1,"mat-icon",1),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"igo.auth.microsoftb2c.login"),"\n"))},dependencies:[w.Hw,S.lW,O.X$],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return n})();function Tg(n,r){1&n&&e._UZ(0,"div",3)}function Fg(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-auth-google",7),e.NdJ("login",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.onLogin())}),e.qZA()}}function Og(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-auth-microsoft",7),e.NdJ("login",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.onLogin())}),e.qZA()}}function Ag(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-auth-microsoftb2c",7),e.NdJ("login",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.onLogin())}),e.qZA()}}function Lg(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-auth-facebook",7),e.NdJ("login",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.onLogin())}),e.qZA()}}function Mg(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-auth-intern",8),e.NdJ("login",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.onLogin())}),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("allowAnonymous",t.options.allowAnonymous)}}function Ig(n,r){if(1&n&&(e.TgZ(0,"div",4)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Fg,1,0,"igo-auth-google",5),e.YNc(5,Og,1,0,"igo-auth-microsoft",5),e.YNc(6,Ag,1,0,"igo-auth-microsoftb2c",5),e.YNc(7,Lg,1,0,"igo-auth-facebook",5),e.YNc(8,Mg,1,1,"igo-auth-intern",6),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,6,"igo.auth.connection")),e.xp6(2),e.Q6J("ngIf",t.options.google&&!1!==t.options.google.enabled),e.xp6(1),e.Q6J("ngIf",t.options.microsoft&&!1!==t.options.microsoft.enabled),e.xp6(1),e.Q6J("ngIf",t.options.microsoftb2c&&!1!==t.options.microsoftb2c.enabled),e.xp6(1),e.Q6J("ngIf",t.options.facebook&&!1!==t.options.facebook.enabled),e.xp6(1),e.Q6J("ngIf",!t.options.intern||!1!==t.options.intern.enabled)}}function Zg(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",4)(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.logout())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Oqu(e.xi3(3,2,"igo.auth.welcome",t.user)),e.xp6(3),e.hij(" ",e.lcZ(6,5,"igo.auth.signOut")," ")}}function Pg(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.home())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.auth.home")," "))}function kg(n,r){if(1&n&&(e.TgZ(0,"div",4)(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Pg,3,3,"button",10),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,"igo.auth.deconnection")),e.xp6(2),e.Q6J("ngIf",t.options.homeRoute)}}function $g(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,Tg,1,0,"div",1),e.YNc(2,Ig,9,8,"div",2),e.YNc(3,Zg,7,7,"div",2),e.YNc(4,kg,5,4,"div",2),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.auth.logged&&t.backgroundDisable),e.xp6(1),e.Q6J("ngIf",!t.auth.logged&&t.showLoginDiv),e.xp6(1),e.Q6J("ngIf",t.auth.logged&&t.showAlreadyConnectedDiv),e.xp6(1),e.Q6J("ngIf",t.showLogoutDiv)}}let Ls=(()=>{class n{auth;config;router;get backgroundDisable(){return!this.isLogoutRoute&&!this.isLogoutRoute&&this._backgroundDisable}set backgroundDisable(t){this._backgroundDisable="true"===t.toString()}_backgroundDisable=!0;get hasAlreadyConnectedDiv(){return this._hasAlreadyConnectedDiv}set hasAlreadyConnectedDiv(t){this._hasAlreadyConnectedDiv="true"===t.toString()}_hasAlreadyConnectedDiv=!0;get hasLogoutDiv(){return this._hasLogoutDiv}set hasLogoutDiv(t){this._hasLogoutDiv="true"===t.toString()}_hasLogoutDiv=!0;get showAlreadyConnectedDiv(){return this.isLogoutRoute?this.hasAlreadyConnectedDiv:this._showAlreadyConnectedDiv}set showAlreadyConnectedDiv(t){this._showAlreadyConnectedDiv="true"===t.toString()}_showAlreadyConnectedDiv=!1;get showLogoutDiv(){return this.isLogoutRoute?this.hasLogoutDiv:this._showLogoutDiv}set showLogoutDiv(t){this._showLogoutDiv="true"===t.toString()}_showLogoutDiv=!1;get showLoginDiv(){if(!this.isLogoutRoute)return!0}login=new e.vpe;options;user;visible=!0;isLoginRoute;isLogoutRoute;constructor(t,o,i){this.auth=t,this.config=o,this.router=i,this.options=this.config.getConfig("auth"),this.visible=0!==Object.getOwnPropertyNames(this.options).length}ngOnInit(){this.analyzeRoute(),this.getName()}onLogin(){this.auth.goToRedirectUrl(),this.getName(),this.login.emit(!0)}logout(){this.auth.logout().subscribe(()=>{this.user=void 0,this.router&&(this.options?.logoutRoute?this.router.navigate([this.options?.logoutRoute]):this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute]))})}home(){this.router&&this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute])}getName(){const t=this.auth.decodeToken();t&&(this.user={name:t.user.firstName||t.user.sourceId})}analyzeRoute(){this.router&&this.router.events.pipe((0,_i.h)(t=>t instanceof ee.OD)).subscribe(t=>{if(t.url){const o=t.url,i=this.options?.logoutRoute,s=this.options?.loginRoute;this.isLogoutRoute=o===i,this.isLoginRoute=o===s,this.isLogoutRoute&&this.auth.logout()}})}static \u0275fac=function(o){return new(o||n)(e.Y36(He),e.Y36(N),e.Y36(ee.F0,8))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-auth-form"]],inputs:{backgroundDisable:"backgroundDisable",hasAlreadyConnectedDiv:"hasAlreadyConnectedDiv",hasLogoutDiv:"hasLogoutDiv",showAlreadyConnectedDiv:"showAlreadyConnectedDiv",showLogoutDiv:"showLogoutDiv"},outputs:{login:"login"},decls:1,vars:1,consts:[[4,"ngIf"],["class","backgroundDisable",4,"ngIf"],["class","login center-block",4,"ngIf"],[1,"backgroundDisable"],[1,"login","center-block"],[3,"login",4,"ngIf"],[3,"allowAnonymous","login",4,"ngIf"],[3,"login"],[3,"allowAnonymous","login"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button",3,"click",4,"ngIf"]],template:function(o,i){1&o&&e.YNc(0,$g,5,4,"div",0),2&o&&e.Q6J("ngIf",i.visible)},dependencies:[f.O5,S.lW,fg,bg,vg,Cg,wg,O.X$],styles:["[_nghost-%COMP%]{z-index:999}div.login[_ngcontent-%COMP%]{z-index:200;width:90%;min-width:360px;max-width:600px;padding:25px 50px;border:1px solid;background-color:#fff;border-color:#888}.center-block[_ngcontent-%COMP%]{position:fixed;top:20%;left:50%;transform:translate(-50%)}.backgroundDisable[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background:#000;opacity:.8;z-index:100;height:100%;width:100%}"]})}return n})();var mo=v(33019);let sr=(()=>{class n{config;tokenService;http;authOptions;refreshInProgress=!1;trustHosts;hostsWithCredentials;hostsWithAuthByKey;constructor(t,o,i){this.config=t,this.tokenService=o,this.http=i,this.authOptions=this.config.getConfig("auth"),this.trustHosts=this.authOptions?.trustHosts||[],this.trustHosts.push(window.location.hostname),this.hostsWithCredentials=this.authOptions?.hostsWithCredentials||[],this.hostsWithAuthByKey=this.authOptions?.hostsByKey||[]}intercept(t,o){const i=this.handleHostsWithCredentials(t.url);let s=t.clone();const a=this.handleHostsAuthByKey(t.url);if(a&&(s=s.clone({params:s.params.set(a.key,a.value)})),i)return s=t.clone({withCredentials:i}),o.handle(s);this.refreshToken();const l=this.tokenService.get(),c=document.createElement("a");if(c.href=s.url,""===c.host&&(c.href=c.href),!l||-1===this.trustHosts.indexOf(c.hostname))return o.handle(s);let p=s.clone({headers:s.headers.set("Authorization",`Bearer ${l}`)});const d=this.tokenService.decode();if("true"===p.params.get("_i")&&d&&d.user&&d.user.sourceId){const g=mo.V8.hashStr(d.user.sourceId);p=p.clone({params:p.params.set("_i",g)})}else"true"===p.params.get("_i")&&(p=p.clone({params:p.params.delete("_i")}));return o.handle(p)}interceptXhr(t,o){const i=this.handleHostsWithCredentials(o);if(i)return t.withCredentials=i,!0;this.refreshToken();const s=document.createElement("a");s.href=o;const a=this.tokenService.get();return!(!a||-1===this.trustHosts.indexOf(s.hostname)||(t.setRequestHeader("Authorization","Bearer "+a),0))}alterUrlWithKeyAuth(t){const o=this.handleHostsAuthByKey(t);if(o){const s=t.split(/[?&]/);let a=s.shift();const l=s.filter(c=>0!==c.length);return l.push(`${o.key}=${o.value}`),l.length&&(a+="?"+l.join("&")),a}}handleHostsWithCredentials(t){let o=!1;for(const i of this.hostsWithCredentials)if(new RegExp(i.domainRegFilters).test(t)){o=void 0!==i.withCredentials?i.withCredentials:void 0;break}return o}handleHostsAuthByKey(t){let o;for(const a of this.hostsWithAuthByKey)if(new RegExp(a.domainRegFilters).test(t)&&!new RegExp(`${a.keyProperty}=${a.keyValue}`,"gm").test(t)){o={key:a.keyProperty,value:a.keyValue};break}return o}refreshToken(){const t=this.tokenService.decode(),o=(new Date).getTime()/1e3;if(!this.refreshInProgress&&t&&o<t.exp&&o>t.exp-1800){this.refreshInProgress=!0;const i=this.authOptions?.url;return this.http.post(`${i}/refresh`,{}).subscribe(s=>{this.tokenService.set(s.token),this.refreshInProgress=!1},s=>(s.error.caught=!0,s))}}static \u0275fac=function(o){return new(o||n)(e.LFG(N),e.LFG(Os),e.LFG($.eN))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Dg(n){const r=n.getConfig("auth.microsoft");return r.redirectUri=r?.redirectUri||window.location.href,r.authority=r?.authority||"https://login.microsoftonline.com/organizations",new rr.L({auth:r,cache:{cacheLocation:"sessionStorage"}})}function Eg(n){const r=n.getConfig("auth.microsoftb2c.browserAuthOptions");return r.redirectUri=r?.redirectUri||window.location.href,r.authority=r?.authority||"https://login.microsoftonline.com/organizations",new rr.L({auth:r,cache:{cacheLocation:"sessionStorage"}})}function Rg(n){return n.getConfig("auth.microsoft"),{interactionType:Ji.s_.Popup,authRequest:{scopes:["user.read"],loginHint:"todo"},type:"add"}}function Ng(n){const r=n.getConfig("auth.microsoftb2c.browserAuthOptions");return{interactionType:Ji.s_.Popup,authRequest:{scopes:[r?.clientId]},type:"b2c"}}function gc(n){return"b2c"===n?[{provide:Yt.sK,useFactory:Eg,deps:[N]},{provide:Yt.S9,useFactory:Ng,deps:[N],multi:!0},As]:[{provide:Yt.sK,useFactory:Dg,deps:[N]},{provide:Yt.S9,useFactory:Rg,deps:[N],multi:!0},Yt.W2]}let Bg=(()=>{class n extends cc{http;authService;tokenService;constructor(t,o,i,s){super(t),this.http=o,this.authService=i,this.tokenService=s,this.authService.authenticate$.subscribe(a=>{a&&this.options.url&&this.http.get(this.options.url).subscribe(l=>{if(l&&l.preference)for(const c of Object.keys(l.preference))super.set(c,l.preference[c])})})}set(t,o,i=Pe.LOCAL){if(i===Pe.LOCAL&&this.authService.authenticated&&this.options.url){const s={};s[t]=o,this.http.patch(this.options.url,{preference:s}).subscribe()}super.set(t,o,i)}remove(t,o=Pe.LOCAL){if(o===Pe.LOCAL&&this.authService.authenticated&&this.options.url){const i={};i[t]=void 0,this.http.patch(this.options.url,{preference:i}).subscribe()}super.remove(t,o)}clear(t=Pe.LOCAL){let o;t===Pe.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.patch(this.options.url,{preference:{}},{params:{mergePreference:"false"}}).subscribe(),t===Pe.LOCAL&&(o=this.tokenService.get()),super.clear(t),o&&this.tokenService.set(o),t===Pe.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.get(this.options.url).subscribe(i=>{if(i&&i.preference)for(const s of Object.keys(i.preference))super.set(s,i.preference[s])})}static \u0275fac=function(o){return new(o||n)(e.LFG(N),e.LFG($.eN),e.LFG(He),e.LFG(Os))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ms=(()=>{class n{static forRoot(){return{ngModule:n,providers:[{provide:$.TP,useClass:sr,multi:!0},{provide:oe,useClass:Bg},...gc("add"),...gc("b2c")]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.UX,F.lN,j.c,w.Ps,S.ot,re,Yt.up]})}return n})();var Et=v(18497),Ct=v(647);let Jg=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Et.QW]})}return n})();var Ve=v(69400);let Ug=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,S.ot,Et.QW,Ve.t,w.Ps,P.AV]})}return n})(),pe=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,f.ez,Ug,Jg,Et.QW,S.ot,Ct.N6,w.Ps,j.c,P.AV]})}return n})();function Gg(n,r){if(1&n&&(e.TgZ(0,"a",6),e._UZ(1,"mat-icon",7),e.qZA()),2&n){const t=e.oxw();e.Q6J("href",t.codeUrl,e.LSH)}}function qg(n,r){if(1&n&&(e.TgZ(0,"a",8),e._UZ(1,"mat-icon",9),e.qZA()),2&n){const t=e.oxw();e.Q6J("href",t.configUrl,e.LSH)}}const jg=["*"],mc="https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src";let me=(()=>{class n{title;codeFolder;configFolder;get codeUrl(){return`${mc}/app/${this.codeFolder}`}get configUrl(){return`${mc}/${this.configFolder}`}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-example-viewer"]],inputs:{title:"title",codeFolder:"codeFolder",configFolder:"configFolder"},ngContentSelectors:jg,decls:10,vars:3,consts:[["appearance","outlined"],[1,"actions"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href",4,"ngIf"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href",4,"ngIf"],[1,"m-b-16"],[1,"mat-body-1"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href"],["svgIcon","code-tags"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href"],["svgIcon","cog"]],template:function(o,i){1&o&&(e.F$t(),e.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-subtitle"),e._uU(3),e.qZA(),e.TgZ(4,"div",1),e.YNc(5,Gg,2,1,"a",2),e.YNc(6,qg,2,1,"a",3),e.qZA()(),e._UZ(7,"mat-divider",4),e.TgZ(8,"mat-card-content",5),e.Hsn(9),e.qZA()()),2&o&&(e.xp6(3),e.hij(" ",i.title," "),e.xp6(2),e.Q6J("ngIf",i.codeFolder),e.xp6(1),e.Q6J("ngIf",i.configFolder))},dependencies:[f.O5,S.o6,Et.a8,Et.dn,Et.dk,Et.$j,Ve.d,w.Hw,P.gM],styles:["[_nghost-%COMP%]{display:block;margin-top:24px}[_nghost-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 8px 0 16px;margin-bottom:0}[_nghost-%COMP%]     .mat-mdc-card-header-text{display:flex;align-items:center}[_nghost-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:16px}"]})}return n})();function Qg(n,r){if(1&n&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.Oqu(t)}}function Yg(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"label",3),e._uU(2,"Dependencies:"),e.qZA(),e.TgZ(3,"ul"),e.YNc(4,Qg,2,1,"li",4),e.qZA(),e.BQk()),2&n){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.dependencies)}}const Hg=["*"];let de=(()=>{class n{title;subtitle;dependencies;static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-doc-viewer"]],inputs:{title:"title",subtitle:"subtitle",dependencies:"dependencies"},ngContentSelectors:Hg,decls:7,vars:3,consts:[[1,"mat-subtitle-2","m-b-0"],[1,"mat-body-1"],[4,"ngIf"],["for",""],[4,"ngFor","ngForOf"]],template:function(o,i){1&o&&(e.F$t(),e.TgZ(0,"h6",0),e._uU(1),e.qZA(),e.TgZ(2,"h2"),e._uU(3),e.qZA(),e.TgZ(4,"div",1),e.YNc(5,Yg,5,1,"ng-container",2),e.Hsn(6),e.qZA()),2&o&&(e.xp6(1),e.Oqu(i.subtitle),e.xp6(2),e.Oqu(i.title),e.xp6(2),e.Q6J("ngIf",null==i.dependencies?null:i.dependencies.length))},dependencies:[f.sg,f.O5],styles:["[_nghost-%COMP%]{display:block;padding:20px 50px}[_nghost-%COMP%]   h6[_ngcontent-%COMP%]{color:#0000008a}"]})}return n})();const Vg=function(){return["ConfigService","LanguageService"]},Kg=ee.Bz.forChild([{path:"auth-form",component:(()=>{class n{languageService;idsActivity=[];constructor(t){this.languageService=t}static \u0275fac=function(o){return new(o||n)(e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-auth-form"]],decls:4,vars:2,consts:[["title","Authentification","subtitle","Auth",3,"dependencies"],["codeFolder","auth/auth-form","configFolder","environments"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1),e._uU(2," The dialog opens automatically if you are not logged in "),e.qZA()(),e._UZ(3,"igo-auth-form")),2&o&&e.Q6J("dependencies",e.DdM(1,Vg))},dependencies:[me,de,Ls],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let Wg=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[Kg,pe,Ms.forRoot()]})}return n})();var ze=v(56658),Be=v(78128);let ar=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,re,S.ot,w.Ps,P.AV,Be.Tx,Z.ie,Et.QW,ze.p9]})}return n})(),Is=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,ar,ar]})}return n})();var ut=v(75392);let lr=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[ut.g,w.Ps,ut.g]})}return n})(),Ui=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[w.Ps,Z.ie]})}return n})();var B=v(66861);let Xg=(()=>{class n{dialogRef;confirmMessage;constructor(t){this.dialogRef=t}static \u0275fac=function(o){return new(o||n)(e.Y36(B.so))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-confirm-dialog"]],decls:12,vars:10,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click"],["mat-button","",3,"click"]],template:function(o,i){1&o&&(e.TgZ(0,"h2",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1),e._uU(4),e.qZA(),e.TgZ(5,"div",2)(6,"button",3),e.NdJ("click",function(){return i.dialogRef.close(!0)}),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"button",4),e.NdJ("click",function(){return i.dialogRef.close(!1)}),e._uU(10),e.ALo(11,"translate"),e.qZA()()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,4,"igo.common.confirmDialog.title"),"\n"),e.xp6(3),e.Oqu(i.confirmMessage),e.xp6(3),e.hij(" ",e.lcZ(8,6,"igo.common.confirmDialog.confirmBtn")," "),e.xp6(3),e.hij(" ",e.lcZ(11,8,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[S.lW,B.uh,B.xY,B.H8,O.X$],styles:["h2[_ngcontent-%COMP%]{margin:5px 0 10px}div[mat-dialog-content][_ngcontent-%COMP%]{max-width:200px}div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}"]})}return n})(),Zs=(()=>{class n{dialog;languageService;constructor(t,o){this.dialog=t,this.languageService=o}open(t){const o=this.dialog.open(Xg,{disableClose:!1});return o.componentInstance.confirmMessage=this.languageService.translate.instant(t),o.afterClosed()}static \u0275fac=function(o){return new(o||n)(e.LFG(B.uw),e.LFG(L))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})(),hc=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[Zs],imports:[S.ot,B.Is,re]})}return n})(),fc=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})(),pn=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,P.AV,j.c,S.ot,re]})}return n})(),cr=(()=>{class n{http;constructor(t){this.http=t}getDom(t){var o=this;return(0,Ne.Z)(function*(){const i=t.url;let s;return yield o.http.get(i).pipe((0,I.U)(a=>(s=a,a)),(0,ce.K)(a=>(0,cn._)(a))).toPromise(),s})()}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),em=(()=>{class n{static forRoot(){return{ngModule:n,providers:[cr]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[cr]})}return n})(),tm=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})(),Ps=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez]})}return n})();class _c{componentFactory;componentRef;subscriptions=[];target;inputs={};inputs$$={};subscribers={};constructor(r){this.componentFactory=r}setTarget(r){this.target=r,this.componentRef=r.createComponent(this.componentFactory),this.updateInputs(this.inputs),this.updateSubscribers(this.subscribers)}destroy(){void 0!==this.target&&this.target.clear(),void 0!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0),this.unobserveAllInputs(),this.unsubscribeAll()}updateInputs(r){if(this.inputs=r,void 0===this.componentRef)return;const t=this.componentRef.instance;this.componentFactory.inputs.forEach(i=>{const s=i.propName;this.unobserveInput(s);const a=r[s];r.hasOwnProperty(s)&&(a instanceof ue.y?this.observeInput(s,a):this.setInputValue(t,s,a))}),"function"==typeof t.onUpdateInputs&&t.onUpdateInputs()}setInputValue(r,t,o){if(o===r[t])return;const s=Object.getPrototypeOf(r),a=Object.getOwnPropertyDescriptor(s,t);void 0!==a&&void 0!==a.set?a.set.call(r,o):r[t]=o}updateSubscribers(r){if(this.subscribers=r,void 0===this.componentRef)return;const t=this.componentRef.instance;this.componentFactory.outputs.forEach(i=>{const s=i.propName;if(r.hasOwnProperty(s)){const a=t[s],l=r[s];Array.isArray(l)?l.forEach(c=>{this.subscriptions.push(a.subscribe(c))}):this.subscriptions.push(a.subscribe(l))}})}observeInput(r,t){this.inputs$$[r]=t.subscribe(o=>{const i=this.componentRef.instance;this.setInputValue(i,r,o),"function"==typeof i.onUpdateInputs&&i.onUpdateInputs()})}unobserveInput(r){void 0!==this.inputs$$[r]&&(this.inputs$$[r].unsubscribe(),this.inputs$$[r]=void 0)}unobserveAllInputs(){Object.values(this.inputs$$).forEach(r=>{void 0!==r&&r.unsubscribe()}),this.inputs$$={}}unsubscribeAll(){this.subscriptions.forEach(r=>r.unsubscribe()),this.subscriptions=[]}}let ks=(()=>{class n{resolver;constructor(t){this.resolver=t}create(t){const o=this.resolver.resolveComponentFactory(t);return new _c(o)}static \u0275fac=function(o){return new(o||n)(e.LFG(e._Vd))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),$s=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[ks],imports:[f.ez,Ps,Ps]})}return n})(),yc=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})();var se=v(96355);let Ds=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,w.Ps,F.lN,j.c,se.LD,re,Ps]})}return n})(),bc=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,F.lN,re,Ds]})}return n})(),om=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,_.u5,_.UX]})}return n})(),Es=(()=>{class n{static fields={};static register(t,o){n.fields[t]=o}constructor(){}getFieldByType(t){return n.fields[t]}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Rs=(()=>{class n{formBuilder;constructor(t){this.formBuilder=t}form(t,o){const i=this.formBuilder.group({});return t.forEach(s=>{i.addControl(s.name,s.control)}),o.forEach(s=>{i.addControl(s.name,s.control)}),{fields:t,groups:o,control:i}}group(t,o){const i=t.options||{},s=this.formBuilder.group({});if(o.forEach(a=>{s.addControl(a.name,a.control)}),i.validator){const a=this.getValidators(i.validator);s.setValidators(a)}return Object.assign({},t,{fields:o,control:s})}field(t){const o=t.options||{},s=this.formBuilder.control({value:"",disabled:o.disabled});if(o.validator){const a=this.getValidators(o.validator);s.setValidators(a)}return Object.assign({type:"text"},t,{control:s})}extendFieldConfig(t,o){const i=Object.assign({},t.options||{},o.options||{}),s=Object.assign({},t.inputs||{},o.inputs||{}),a=Object.assign({},t.subscribers||{},o.subscribers||{});return Object.assign({},t,{options:i,inputs:s,subscribers:a})}getValidators(t){return Array.isArray(t)?t.map(o=>this.getValidator(o)):this.getValidator(t)}getValidator(t){if("string"!=typeof t)return t;const i=t.match(/^([a-zA-Z]{3,15})\((.{0,20})\)$/);return i?_.kI[i[1]](i[2]):_.kI[t]}static \u0275fac=function(o){return new(o||n)(e.LFG(_.QS))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),dn=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[Rs,Es],imports:[f.ez,bc,Ds,om,bc,Ds]})}return n})(),Ns=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,se.LD]})}return n})();var ur=v(39687);let Bs=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[ur.TU]})}return n})();var Je=v(99892),Ho=v(82226),yi=v(87963),ve=v(46798);let Js=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})(),pr=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})(),gn=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,ve.p0,Je.Bb,yi.JX,w.Ps,S.ot,ze.p9,ur.TU,se.LD,pr,pn,Bs,Js,re,_.u5,_.UX,j.c,Ho.FA,P.AV]})}return n})(),vc=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Ns,gn,Bs]})}return n})(),Cc=(()=>{class n{http;configService;jsonURL;allToursOptions;constructor(t,o){this.http=t,this.configService=o,this.jsonURL=this.getPathToConfigFile()}loadConfigTour(){this.getJSON().subscribe(t=>{this.allToursOptions=t},t=>{throw new Error("Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.")})}getPathToConfigFile(){return this.configService.getConfig("interactiveTour.pathToConfigFile")||"./config/interactiveTour.json"}getJSON(){return this.http.get(this.jsonURL).pipe((0,ce.K)(t=>{throw t.error.caught=!0,t}))}getTourOptionData(t){if(void 0===this.allToursOptions)return;let o=t;return o=o.replace(/\s/g,""),this.allToursOptions[o]}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();var xc=v(77605),im=v(80710);let Us=(()=>{class n{configService;mediaService;languageService;interactiveTourLoader;shepherdService;previousStep;nextIndex=1;constructor(t,o,i,s,a){this.configService=t,this.mediaService=o,this.languageService=i,this.interactiveTourLoader=s,this.shepherdService=a,this.isAppHaveTour()&&this.interactiveTourLoader.loadConfigTour()}isAppHaveTour(){const t=this.configService.getConfig("interactiveTour.activateInteractiveTour");return void 0===t||t}isToolHaveTourConfig(t){return void 0!==this.interactiveTourLoader.getTourOptionData(t)}disabledTourButton(t){const o=this.interactiveTourLoader.getTourOptionData(t);if(o?.conditions)for(const i of o?.conditions)if(null===document.querySelector(i))return!0;return!1}isMobile(){return this.mediaService.isMobile()}isTourDisplayInMobile(){const t=this.configService.getConfig("interactiveTour.tourInMobile");return void 0===t||t}getButtons(t){return"noBackButton"===t?[{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"first"===t?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"last"===t?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"}]:[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]}getAction(t){return{click:"click"}[t.toLowerCase()]}addProgress(){const t=this;let o=0;const s=setInterval(()=>{if(t.getCurrentStep()){if(t.getCurrentStep().options.attachTo.element&&!document.querySelector(t.getCurrentStep().options.attachTo.element))return t.cancel(),void clearInterval(s);{const a=t.getCurrentStep().getElement();a&&a.querySelectorAll(".shepherd-content, .shepherd-text").forEach(u=>{u.classList.add("mat-typography")});const l=a?a.querySelector(".shepherd-header"):void 0;if(o++,(l||o>21)&&clearInterval(s),l){const c=t.steps,u=document.createElement("span");u.className="shepherd-progress",u.innerText=`${c.indexOf(t.getCurrentStep())+1}/${c.length}`,l.insertBefore(u,a.querySelector(".shepherd-cancel-icon"))}}}},100)}checkNext(t,o,i){if(o.getCurrentStep()){if(o.getCurrentStep().options.attachTo.element&&document.querySelector(o.getCurrentStep().options.attachTo.element))return void o.complete();if(t.index===o.steps.length-1)return void o.complete();o.steps.splice(t.index,1);const s=o.steps[t.index];s.options.attachTo.element&&!document.querySelector(s.options.attachTo.element)?i.checkNext(t,o,i):(o._setupModal(),o.show(s.id))}}executeAction(t,o){if(!o||o.condition&&("!"===o.condition.charAt(0)&&document.querySelector(o.condition.slice(1))||"!"!==o.condition.charAt(0)&&!document.querySelector(o.condition)))return;const i=document.querySelector(o.element||t.element),s=this.getAction(o.action);i&&s&&i[s]()}executeActionPromise(t,o){return new Promise(i=>{if(this.executeAction(t,o),!o||!o.waitFor)return void i();let s=0;const a=o.maxWait?o.maxWait/100:20,l=setInterval(()=>{s++,(s>a||document.querySelector(o.waitFor))&&(clearInterval(l),i())},100)})}getShepherdSteps(t){const o=[];let i=0;for(const s of t.steps){const a=s.position??t.position;o.push({attachTo:{element:s.element,on:a},floatingUIOptions:{middleware:["auto"===a&&(0,xc.X5)(),(0,xc.cv)({mainAxis:15})].filter(Boolean)},beforeShowPromise:()=>Promise.all([this.executeActionPromise(this.previousStep,this.previousStep?this.previousStep.beforeChange:void 0),this.executeActionPromise(s,s.beforeShow)]),buttons:this.getButtons(0===i?"first":i+1===t.steps.length?"last":t.steps[i].noBackButton?"noBackButton":void 0),classes:s.class,highlightClass:s.highlightClass,scrollTo:s.scrollToElement||t.scrollToElement||!0,canClickTarget:s.disableInteraction?!s.disableInteraction:void 0,title:this.languageService.translate.instant(s.title||t.title),text:[this.languageService.translate.instant(s.text)],when:{show:()=>{this.executeAction(s,s.onShow)},hide:()=>{this.previousStep=s,this.executeAction(s,s.onHide)}}}),i++}return o}startTour(t){const o=this.interactiveTourLoader.getTourOptionData(t);this.shepherdService.defaultStepOptions={classes:o.class,highlightClass:o.highlightClass,canClickTarget:!o.disableInteraction||!o.disableInteraction,cancelIcon:{enabled:!0}};const i=this.getShepherdSteps(o);this.shepherdService.modal=!0,this.shepherdService.confirmCancel=!1,this.shepherdService.addSteps(i),this.shepherdService.tourObject.on("show",this.addProgress),this.shepherdService.tourObject.on("cancel",s=>{this.checkNext(s,this.shepherdService.tourObject,this)}),this.shepherdService.start()}static \u0275fac=function(o){return new(o||n)(e.LFG(N),e.LFG(ct),e.LFG(L),e.LFG(Cc),e.LFG(im.a))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),nm=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[Us,Cc],imports:[f.ez,w.Ps,S.ot,P.AV,re]})}return n})(),mn=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})(),rm=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})(),bi=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,Z.ie,rm]})}return n})(),It=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez]})}return n})();var Sc=v(33910);let Gs=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Sc.Cq]})}return n})();var sm=v(70845);let am=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,sm.HT,w.Ps,S.ot,ve.p0,F.lN,j.c,yi.JX,ze.p9,re]})}return n})();var wt=function(n){return n.Default="Default",n.HTML="HTML",n.UnsanitizedHTML="UnsanitizedHTML",n.Editable="Editable",n.Icon="Icon",n.ButtonGroup="ButtonGroup",n}(wt||{}),dr=function(n){return n.Auto="auto",n.Instant="instant",n.Smooth="smooth",n}(dr||{}),qs=function(n){return n.None="None",n.All="All",n.Some="Some",n}(qs||{}),js=v(11988);function vi(n,r){return(0,js.t)(n,r).safeObject}function gr(n){const r=n.meta||{};return r.id?r.id:vi(n,r.idProperty||"id")}function ho(n){const r=n.meta||{};return r.title?r.title:vi(n,r.titleProperty||"title")}function mr(n){const r=n.meta||{};return r.icon?r.icon:vi(n,r.iconProperty||"icon")}var hn=v(55400);class pm{options;index=new Map;change$=new hn.t(1);getKey;constructor(r={}){this.options=r,this.getKey=r.getKey?r.getKey:gr,this.next()}clear(){this.index.size>0&&(this.index.clear(),this.next())}get(r){return this.index.get(this.getKey(r))||{}}set(r,t){this.setMany([r],t)}setMany(r,t){r.forEach(o=>{this.index.set(this.getKey(o),Object.assign({},t))}),this.next()}setAll(r){Array.from(this.index.keys()).forEach(t=>{this.index.set(t,Object.assign({},r))}),this.next()}update(r,t,o=!1){this.updateMany([r],t,o)}updateMany(r,t,o=!1){if(!0===o)return this.updateManyExclusive(r,t);r.forEach(i=>{const s=Object.assign({},this.get(i),t);this.index.set(this.getKey(i),s)}),this.next()}reverse(r,t){this.reverseMany([r],t)}reverseMany(r,t){r.forEach(o=>{const i=this.get(o),s=t.reduce((c,u)=>(c[u]=i[u]||!1,c),{}),a=this.reverseChanges(s),l=Object.assign({},i,a);this.index.set(this.getKey(o),l)}),this.next()}updateAll(r){const t=this.getAllKeys();Array.from(t).forEach(o=>{const i=Object.assign({},this.index.get(o),r);this.index.set(o,i)}),this.next()}updateManyExclusive(r,t){const o=this.reverseChanges(t),i=r.map(a=>this.getKey(a));new Set(i.concat(Array.from(this.getAllKeys()))).forEach(a=>{const l=this.index.get(a)||{};i.indexOf(a)>=0?this.index.set(a,Object.assign({},l,t)):!0===Object.keys(o).some(u=>void 0!==l[u]&&l[u]!==o[u])&&this.index.set(a,Object.assign({},l,o))}),this.next()}reverseChanges(r){return Object.entries(r).reduce((t,o)=>{const[i,s]=o;return"boolean"==typeof s&&(t[i]=!s),t},{})}getAllKeys(){const r=Array.from(this.options?.index?.keys()??[]);return new Set(Array.from(this.index.keys()).concat(r))}next(){this.change$.next()}}var Ci=v(35357);class wc{source$;values$=new y.X([]);values$$;lifted=!1;joins=[];filter$=new y.X(void 0);filters$=new y.X([]);filterIndex=new Map;sort$=new y.X(void 0);get getKey(){return this.getKey$.value}getKey$=new y.X(void 0);count$=new y.X(0);get count(){return this.count$.value}empty$=new y.X(!0);get empty(){return this.empty$.value}get index(){return this._index}_index;constructor(r){this.source$=r}get(r){if(void 0===this._index)throw new Error("This view has no index, therefore, this method is unavailable.");return this.index.get(r)}all(){return this.values$.value}all$(){return this.values$}firstBy(r){return this.values$.value.find(r)}firstBy$(r){return this.values$.pipe((0,I.U)(t=>t.find(r)))}manyBy(r){return this.values$.value.filter(r)}manyBy$(r){return this.values$.pipe((0,I.U)(t=>t.filter(r)))}clear(){this.filter(void 0),this.sort(void 0)}destroy(){void 0!==this.values$$&&this.values$$.unsubscribe(),this.clear()}createIndex(r){return this._index=new Map,this.getKey$.next(r),this}join(r){if(!0===this.lifted)throw new Error("This view has already been lifted, therefore, no join is allowed.");return this.joins.push(r),this}filter(r){return this.filter$.next(r),this}addFilter(r){const t=Ie();return this.filterIndex.set(t,r),this.filters$.next(Array.from(this.filterIndex.values())),t}removeFilter(r){this.filterIndex.delete(r),this.filters$.next(Array.from(this.filterIndex.values()))}sort(r){return this.sort$.next(r),this}lift(){this.lifted=!0;const t=[this.joins.length>0?this.liftJoinedSource():this.liftSource(),this.filters$,this.filter$,this.sort$,this.getKey$];this.values$$=(0,Ye.a)(t).pipe((0,Ci.T)(1),(0,ae.b)(5)).subscribe(o=>{const[i,s,a,l,c]=o,u=this.processValues(i,s,a,l);this.setValues(u,void 0!==c)})}liftSource(){return this.source$}liftJoinedSource(){const r=[this.source$,(0,Ye.a)(this.joins.map(t=>t.source))];return(0,Ye.a)(r).pipe((0,I.U)(t=>{const[o,i]=t;return o.reduce((s,a)=>{const l=this.computeJoinedValue(a,i);return void 0!==l&&s.push(l),s},[])}))}computeJoinedValue(r,t){let o=r,i=0;for(;void 0!==o&&i<this.joins.length;)o=this.joins[i].reduce(o,t[i]),i+=1;return o}processValues(r,t,o,i){return r=r.slice(0),r=this.filterValues(r,t.concat([o])),this.sortValues(r,i)}filterValues(r,t){return 0===t.length?r:r.filter(o=>t.filter(i=>void 0!==i).every(i=>i(o)))}sortValues(r,t){return void 0===t?r:r.sort((o,i)=>R.naturalCompare(t.valueAccessor(o),t.valueAccessor(i),t.direction,t.nullsFirst))}setValues(r,t){!0===t&&(this._index=this.generateIndex(r)),this.values$.next(r);const o=r.length,i=0===o;this.count$.next(o),this.empty$.next(i)}generateIndex(r){const t=r.map(o=>[this.getKey(o),o]);return new Map(t)}}class xt{entities$=new y.X([]);count$=new y.X(0);get count(){return this.count$.value}empty$=new y.X(!0);get empty(){return this.empty$.value}state;view;stateView;getKey;getProperty;get index(){return this._index}_index;get pristine(){return this._pristine}_pristine=!0;constructor(r,t={}){this.getKey=t.getKey?t.getKey:gr,this.getProperty=t.getProperty?t.getProperty:vi,this.state=this.createStateManager(),this.view=this.createDataView(),this.stateView=this.createStateView(),this.view.lift(),this.stateView.lift(),r.length>0?this.load(r):this._index=this.generateIndex(r)}get(r){return this.index.get(r)}all(){return this.entities$.value}load(r,t=!0){this._index=this.generateIndex(r),this._pristine=t,this.next()}softClear(){this.index&&this.index.size>0?(this.index.clear(),this._pristine=!0,this.next()):this.index&&this.updateCount()}clear(){this.stateView.clear(),this.view.clear(),this.state.clear(),this.softClear()}destroy(){this.stateView.destroy(),this.view.destroy(),this.clear()}insert(r){this.insertMany([r])}insertMany(r){r.forEach(t=>this.index.set(this.getKey(t),t)),this._pristine=!1,this.next()}update(r){this.updateMany([r])}updateMany(r){r.forEach(t=>this.index.set(this.getKey(t),t)),this._pristine=!1,this.next()}delete(r){this.deleteMany([r])}deleteMany(r){r.forEach(t=>this.index.delete(this.getKey(t))),this._pristine=!1,this.next()}generateIndex(r){const t=r.map(o=>[this.getKey(o),o]);return new Map(t)}next(){this.entities$.next(Array.from(this.index.values())),this.updateCount()}updateCount(){const r=this.index.size,t=0===r;this.count$.next(r),this.empty$.next(t)}createStateManager(){return new pm({getKey:this.getKey,index:this.index})}createDataView(){return new wc(this.entities$)}createStateView(){return new wc(this.view.all$()).join({source:this.state.change$,reduce:r=>{const t=this.getKey(r),o=this.state.get(r),i=this.stateView.get(t);if(void 0!==i&&i.entity===r&&this.statesAreTheSame(i.state,o))return i;const s=i?i.revision+1:1;return{entity:r,state:o,revision:s,ref:`${t}-${s}`}}}).createIndex(r=>this.getKey(r.entity))}statesAreTheSame(r,t){if(r===t)return!0;const o=0===Object.keys(r).length,i=0===Object.keys(t).length;return o&&i}}class hr extends xt{strategies=[];constructor(r,t={}){super(r,t)}addStrategy(r,t=!1){if(void 0!==this.strategies.find(i=>r.constructor===i.constructor))throw new Error("A strategy of this type already exists on that EntityStore.");return this.strategies.push(r),r.bindStore(this),!0===t&&r.activate(),this}removeStrategy(r){const t=this.strategies.indexOf(r);return t>=0&&(this.strategies.splice(t,1),r.unbindStore(this)),this}getStrategyOfType(r){return this.strategies.find(t=>t instanceof r)}activateStrategyOfType(r){const t=this.getStrategyOfType(r);void 0!==t&&t.activate()}deactivateStrategyOfType(r){const t=this.getStrategyOfType(r);void 0!==t&&t.deactivate()}}class fn{cdRef;store;innerStateIndex=new Map;entities$$;state$$;constructor(r,t){this.setChangeDetector(t),this.setStore(r)}destroy(){this.setChangeDetector(void 0),this.setStore(void 0)}setStore(r){if(void 0===r)return this.teardownObservers(),this.innerStateIndex.clear(),void(this.store=void 0);this.setStore(void 0),this.store=r,this.setupObservers(),this.detectChanges()}setChangeDetector(r){this.cdRef=r}setupObservers(){this.teardownObservers(),this.entities$$=this.store.entities$.subscribe(r=>this.onEntitiesChange(r)),this.state$$=this.store.state.change$.pipe((0,Ci.T)(1)).subscribe(()=>this.onStateChange())}teardownObservers(){void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.state$$&&this.state$$.unsubscribe(),this.entities$$=void 0,this.state$$=void 0}onEntitiesChange(r){this.detectChanges()}onStateChange(){let r=!1;const t=this.store.state.index,o=this.innerStateIndex;t.size!==o.size&&(r=this.detectChanges());const i=Array.from(t.keys());for(const s of i){const a=t.get(s),l=o.get(s);!1===r&&(void 0===l?r=this.detectChanges():R.objectsAreEquivalent(a,l)||(r=this.detectChanges())),this.innerStateIndex.set(s,Object.assign({},a))}}detectChanges(){return void 0!==this.cdRef&&this.cdRef.detectChanges(),!0}}class $o{options;stores=[];get active(){return this.active$.value}active$=new y.X(!1);constructor(r={}){this.options=r,this.options=r}activate(){!0===this.active&&this.doDeactivate(),this.active$.next(!0),this.doActivate()}deactivate(){this.active$.next(!1),this.doDeactivate()}bindStore(r){this.stores.indexOf(r)<0&&this.stores.push(r)}unbindStore(r){const t=this.stores.indexOf(r);t>=0&&this.stores.splice(t,1)}doActivate(){}doDeactivate(){}}class Vo extends $o{options;constructor(r){super(r),this.options=r}filters=new Map;bindStore(r){super.bindStore(r),!0===this.active&&this.filterStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unfilterStore(r)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(r=>this.filterStore(r))}unfilterAll(){this.stores.forEach(r=>this.unfilterStore(r))}filterStore(r){this.filters.set(r,r.stateView.addFilter(this.options.filterClauseFunc))}unfilterStore(r){const t=this.filters.get(r);void 0!==t&&(r.stateView.removeFilter(t),this.filters.delete(r))}}class xi extends $o{filters=new Map;bindStore(r){super.bindStore(r),!0===this.active&&this.filterStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unfilterStore(r)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(r=>this.filterStore(r))}unfilterAll(){this.stores.forEach(r=>this.unfilterStore(r))}filterStore(r){this.filters.has(r)||this.filters.set(r,r.stateView.addFilter(o=>!0===o.state.selected))}unfilterStore(r){const t=this.filters.get(r);void 0!==t&&(r.stateView.removeFilter(t),this.filters.delete(r))}}var le=v(10257);function dm(n,r){if(1&n&&(e.TgZ(0,"mat-option",4),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.Q6J("value",t.emptyValue),e.xp6(1),e.Oqu(t.emptyText)}}function gm(n,r){if(1&n&&(e.TgZ(0,"mat-option",4),e._uU(1),e.ALo(2,"async"),e.qZA()),2&n){const t=e.oxw();e.Q6J("value",t.multiSelectValue),e.xp6(1),e.Oqu(e.lcZ(2,2,t.multiText$))}}function mm(n,r){if(1&n&&(e.TgZ(0,"mat-option",4),e._uU(1),e.qZA()),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("value",t.entity),e.xp6(1),e.hij(" ",o.titleAccessor(t.entity)," ")}}let Tc=(()=>{class n{cdRef;selected$=new y.X(void 0);multiText$=new y.X(void 0);multiSelectValue={id:"IGO_MULTI_SELECT"};emptyValue={id:"IGO_EMPTY_SELECT"};selected$$;watcher;store;titleAccessor=ho;emptyText=void 0;multi=!1;multiAllText="All";multiNoneText="None";placeholder;disabled=!1;selectedChange=new e.vpe;constructor(t){this.cdRef=t}ngOnInit(){this.watcher=new fn(this.store,this.cdRef),this.selected$$=this.store.stateView.manyBy$(t=>!0===t.state.selected).subscribe(t=>{const o=t.map(i=>i.entity);this.onSelectFromStore(o)})}ngOnDestroy(){this.watcher.destroy(),this.selected$$.unsubscribe()}onSelectionChange(t){const o=t.value instanceof Array?t.value:[t.value],i=o.find(l=>l===this.multiSelectValue);let s=o.filter(l=>l!==this.multiSelectValue);void 0!==i&&(s.length===this.store.count?s=[]:s.length<this.store.count&&(s=this.store.all())),s=s.filter(l=>l!==this.emptyValue),0===s.length?this.store.state.updateAll({selected:!1}):this.store.state.updateMany(s,{selected:!0},!0),this.selectedChange.emit({selected:!0,value:this.multi?s:t.value})}onSelectFromStore(t){this.selected$.next(!0===this.multi?t:t.length>0?t[0]:void 0),this.updateMultiToggleWithEntities(t)}updateMultiToggleWithEntities(t){t.length===this.store.count&&this.multiText$.value!==this.multiNoneText?this.multiText$.next(this.multiNoneText):t.length<this.store.count&&this.multiText$.value!==this.multiAllText&&this.multiText$.next(this.multiAllText)}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-entity-selector"]],inputs:{store:"store",titleAccessor:"titleAccessor",emptyText:"emptyText",multi:"multi",multiAllText:"multiAllText",multiNoneText:"multiNoneText",placeholder:"placeholder",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},decls:7,vars:11,consts:[["subscriptSizing","dynamic",1,"igo-entity-selector"],[3,"disabled","value","multiple","placeholder","selectionChange"],[3,"value",4,"ngIf"],["ngFor","",3,"ngForOf"],[3,"value"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-form-field",0)(1,"mat-select",1),e.NdJ("selectionChange",function(a){return i.onSelectionChange(a)}),e.ALo(2,"async"),e.YNc(3,dm,2,2,"mat-option",2),e.YNc(4,gm,3,4,"mat-option",2),e.YNc(5,mm,2,2,"ng-template",3),e.ALo(6,"async"),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("disabled",i.disabled)("value",e.lcZ(2,7,i.selected$))("multiple",i.multi)("placeholder",i.placeholder),e.xp6(2),e.Q6J("ngIf",void 0!==i.emptyText&&!1===i.multi),e.xp6(1),e.Q6J("ngIf",!0===i.multi),e.xp6(1),e.Q6J("ngForOf",e.lcZ(6,9,i.store.stateView.all$())))},dependencies:[f.sg,f.O5,F.KE,se.gD,le.ey,f.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}return n})();var hm=v(58540),E=v.n(hm),fm=v(93170);let _n=(()=>{class n{onClick(t){t.stopPropagation()}static \u0275fac=function(o){return new(o||n)};static \u0275dir=e.lG2({type:n,selectors:[["","igoStopPropagation",""]],hostBindings:function(o,i){1&o&&e.NdJ("click",function(a){return i.onClick(a)})}})}return n})(),Fc=(()=>{class n{languageService;mediaService;disabled=!1;hidePageSize=!1;pageIndex=0;pageSize=50;pageSizeOptions=[5,10,20,50,100,200];showFirstLastButtons=!0;count$$;entitySortChange$$;paginationLabelTranslation$$=[];entitySortChange$=new y.X(!1);store;paginatorOptions;page;length=0;paginatorChange=new e.vpe;constructor(t,o){this.languageService=t,this.mediaService=o}paginator;ngOnChanges(){this.unsubscribeAll(),this.count$$=this.store.stateView.count$.subscribe(t=>{this.length=t,this.emitPaginator()}),this.entitySortChange$$=this.entitySortChange$.subscribe(()=>{this.paginator&&this.paginator.firstPage()}),this.initPaginatorOptions(),this.translateLabels()}initPaginatorOptions(){this.disabled=this.paginatorOptions?.disabled||this.disabled,this.pageIndex=this.paginatorOptions?.pageIndex||this.pageIndex,this.pageSize=this.paginatorOptions?.pageSize||this.pageSize,this.pageSizeOptions=this.paginatorOptions?.pageSizeOptions||this.pageSizeOptions,this.mediaService.isMobile()?(this.showFirstLastButtons=!1,this.hidePageSize=!0):(this.showFirstLastButtons=this.paginatorOptions?.showFirstLastButtons||this.showFirstLastButtons,this.hidePageSize=this.paginatorOptions?.hidePageSize||this.hidePageSize)}translateLabels(){this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.firstPageLabel").subscribe(t=>{this.paginator._intl.firstPageLabel=t})),this.paginator._intl.getRangeLabel=this.rangeLabel,this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.itemsPerPageLabel").subscribe(t=>{this.paginator._intl.itemsPerPageLabel=t})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.lastPageLabel").subscribe(t=>{this.paginator._intl.lastPageLabel=t})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.nextPageLabel").subscribe(t=>{this.paginator._intl.nextPageLabel=t})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.previousPageLabel").subscribe(t=>{this.paginator._intl.previousPageLabel=t}))}rangeLabel=(t,o,i)=>{const s=new y.X("");if(this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.of").subscribe(c=>{s.next(c)})),0===i||0===o)return`0 ${s.value} ${i}`;const a=t*o;return`${a+1} - ${a<(i=Math.max(i,0))?Math.min(a+o,i):a+o} ${s.value} ${i}`};unsubscribeAll(){this.paginationLabelTranslation$$.map(t=>t.unsubscribe()),this.count$$&&this.count$$.unsubscribe(),this.entitySortChange$$&&this.entitySortChange$$.unsubscribe()}ngOnDestroy(){this.unsubscribeAll()}emitPaginator(){this.paginatorChange.emit(this.paginator)}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-entity-table-paginator"]],viewQuery:function(o,i){if(1&o&&e.Gf(ur.NW,7),2&o){let s;e.iGM(s=e.CRH())&&(i.paginator=s.first)}},inputs:{entitySortChange$:"entitySortChange$",store:"store",paginatorOptions:"paginatorOptions"},outputs:{page:"page",paginatorChange:"paginatorChange"},features:[e.TTD],decls:1,vars:7,consts:[[3,"disabled","hidePageSize","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","page"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-paginator",0),e.NdJ("page",function(){return i.emitPaginator()}),e.qZA()),2&o&&e.Q6J("disabled",i.disabled)("hidePageSize",i.hidePageSize)("length",i.length)("pageIndex",i.pageIndex)("pageSize",i.pageSize)("pageSizeOptions",i.pageSizeOptions)("showFirstLastButtons",i.showFirstLastButtons)},dependencies:[ur.NW],styles:["[_nghost-%COMP%]     .mat-mdc-paginator-container{min-height:unset}"],changeDetection:0})}return n})(),Qs=(()=>{class n{el;errorImageUrl="./assets/igo2/common/images/na.png";hideError=!1;constructor(t){this.el=t}onError(t){this.hideError?this.el.nativeElement.style.display="none":t.target.src=this.errorImageUrl}static \u0275fac=function(o){return new(o||n)(e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","igoImageError",""]],hostBindings:function(o,i){1&o&&e.NdJ("error",function(a){return i.onError(a)})},inputs:{errorImageUrl:"errorImageUrl",hideError:"hideError"}})}return n})();var Ys=v(21);let _m=(()=>{class n{renderer;el;static selectedCls="igo-entity-table-row-selected";static highlightedCls="igo-entity-table-row-highlighted";selection=!1;selectOnClick=!0;highlightSelection=!0;set selected(t){!1!==this.selection&&t!==this._selected&&(this.toggleSelected(t),this.scroll())}get selected(){return this._selected}_selected=!1;scrollBehavior=dr.Auto;select=new e.vpe;onClick(){!1===this.selection||!1===this.selectOnClick||(this.toggleSelected(!0),this.select.emit(this))}constructor(t,o){this.renderer=t,this.el=o}toggleSelected(t){this._selected=t,!0===t?(this.addCls(n.selectedCls),!0===this.highlightSelection&&this.addCls(n.highlightedCls)):(this.removeCls(n.selectedCls),this.removeCls(n.highlightedCls))}scroll(){!0===this._selected&&(0,Ys.Z)(this.el.nativeElement,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})}addCls(t){this.renderer.addClass(this.el.nativeElement,t)}removeCls(t){this.renderer.removeClass(this.el.nativeElement,t)}static \u0275fac=function(o){return new(o||n)(e.Y36(e.Qsj),e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","igoEntityTableRow",""]],hostBindings:function(o,i){1&o&&e.NdJ("click",function(){return i.onClick()})},inputs:{selection:"selection",selectOnClick:"selectOnClick",highlightSelection:"highlightSelection",selected:"selected",scrollBehavior:"scrollBehavior"},outputs:{select:"select"}})}return n})(),fr=(()=>{class n{_sanitizer;constructor(t){this._sanitizer=t}transform(t){return this._sanitizer.bypassSecurityTrustHtml(t)}static \u0275fac=function(o){return new(o||n)(e.Y36($t.H7,16))};static \u0275pipe=e.Yjl({name:"sanitizeHtml",type:n,pure:!0})}return n})();var T=v(42321),Oc=v(81891);class zo{http;configService;constructor(r,t){this.http=r,this.configService=t}transform(r){const t=new $.WM({"Content-Type":"text/plain",activityInterceptor:"false",interceptError:"false"}),o=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');return o.test(r)&&(r=r.match(o)[0]),this.http.get(r,{headers:t,responseType:"blob"}).pipe((0,ce.K)(i=>{throw i.error.caught=!0,i.error.toDisplay=!1,i}),(0,Oc.w)(i=>new ue.y(s=>{const a=new FileReader;a.readAsDataURL(i),a.onloadend=()=>{s.next(a.result),s.complete()}})))}static \u0275fac=function(t){return new(t||zo)(e.Y36($.eN,16),e.Y36(N,16))};static \u0275pipe=e.Yjl({name:"secureImage",type:zo,pure:!0})}function ym(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-checkbox",11),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onToggleRows(i.checked))}),e.qZA(),e.BQk()}if(2&n){const t=r.ngIf,o=e.oxw(3);e.xp6(1),e.Q6J("checked",t===o.entityTableSelectionState.All)("indeterminate",t===o.entityTableSelectionState.Some)}}function bm(n,r){if(1&n&&(e.ynx(0),e.YNc(1,ym,2,2,"ng-container",10),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.selectionState$))}}function vm(n,r){if(1&n&&(e.TgZ(0,"th",9),e.YNc(1,bm,3,3,"ng-container",10),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.selectMany)}}function Cm(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td",12)(1,"mat-checkbox",13),e.NdJ("mousedown",function(i){return i.shiftKey?i.preventDefault():null})("click",function(i){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(i.shiftKey?l.onShiftToggleRow(!l.rowIsSelected(a.record),a.record,i):i.stopPropagation())})("change",function(i){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onToggleRow(i.checked,a.record))}),e.qZA()()}if(2&n){const t=r.$implicit,o=e.oxw();e.xp6(1),e.Q6J("checked",o.rowIsSelected(t.record))}}function xm(n,r){if(1&n&&(e.TgZ(0,"th",16),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.Q6J("matTooltip",t.tooltip?t.tooltip:void 0),e.xp6(1),e.hij(" ",t.title," ")}}function Sm(n,r){1&n&&(e.ynx(0),e.YNc(1,xm,2,2,"th",15),e.BQk())}function wm(n,r){if(1&n&&(e.TgZ(0,"th",18),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.Q6J("matTooltip",t.tooltip?t.tooltip:void 0),e.xp6(1),e.hij(" ",t.title," ")}}function Tm(n,r){1&n&&(e.ynx(0),e.YNc(1,wm,2,2,"th",17),e.BQk())}function Fm(n,r){if(1&n&&(e.TgZ(0,"td",22),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,o=e.oxw(3).$implicit;e.Q6J("ngClass",t.cellData[o.name].class),e.xp6(1),e.hij(" ",t.cellData[o.name].value," ")}}function Om(n,r){if(1&n&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&n){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit;e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,t.cellData[o.name].value)),e.LSH)}}function Am(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.common.entity-table.targetHtmlUrl")," "))}function Lm(n,r){if(1&n&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(2,Om,3,5,"img",24),e.YNc(3,Am,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&n){const t=e.MAs(4),o=e.oxw().$implicit,i=e.oxw(3).$implicit;e.Q6J("ngClass",o.cellData[i.name].class),e.xp6(1),e.s9C("href",o.cellData[i.name].value,e.LSH),e.xp6(1),e.Q6J("ngIf",o.cellData[i.name].isImg)("ngIfElse",t)}}function Mm(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Fm,2,2,"td",20),e.YNc(2,Lm,5,4,"ng-template",null,21,e.W1O),e.BQk()),2&n){const t=r.$implicit,o=e.MAs(3),i=e.oxw(3).$implicit;e.xp6(1),e.Q6J("ngIf",!t.cellData[i.name].isUrl)("ngIfElse",o)}}function Im(n,r){1&n&&(e.ynx(0),e.YNc(1,Mm,4,2,"ng-container",19),e.BQk())}function Zm(n,r){if(1&n&&e._UZ(0,"td",29),2&n){const t=e.oxw().$implicit,o=e.oxw(3).$implicit;e.Q6J("ngClass",t.cellData[o.name].class)("innerHTML",t.cellData[o.name].value,e.oJD)}}function Pm(n,r){if(1&n&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&n){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit;e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,t.cellData[o.name].value)),e.LSH)}}function km(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.targetHtmlUrl")," "))}function $m(n,r){if(1&n&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(2,Pm,3,5,"img",24),e.YNc(3,km,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&n){const t=e.MAs(4),o=e.oxw().$implicit,i=e.oxw(3).$implicit;e.Q6J("ngClass",o.cellData[i.name].class),e.xp6(1),e.s9C("href",o.cellData[i.name].value,e.LSH),e.xp6(1),e.Q6J("ngIf",o.cellData[i.name].isImg)("ngIfElse",t)}}function Dm(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Zm,1,2,"td",27),e.YNc(2,$m,5,4,"ng-template",null,28,e.W1O),e.BQk()),2&n){const t=r.$implicit,o=e.MAs(3),i=e.oxw(3).$implicit;e.xp6(1),e.Q6J("ngIf",!t.cellData[i.name].isUrl)("ngIfElse",o)}}function Em(n,r){1&n&&(e.ynx(0),e.YNc(1,Dm,4,2,"ng-container",19),e.BQk())}function Rm(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",43),e._UZ(1,"mat-datepicker-toggle",44),e.TgZ(2,"input",45),e.NdJ("dateChange",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onDateChange(a.name,s.record,i))}),e.qZA(),e._UZ(3,"mat-datepicker",null,46),e.qZA()}if(2&n){const t=e.MAs(4),o=e.oxw(2).$implicit,i=e.oxw(3).$implicit;e.xp6(1),e.Q6J("for",t),e.xp6(1),e.s9C("value",o.cellData[i.name].value),e.Q6J("matDatepicker",t)("formControlName",i.name)}}function Nm(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"input",47),e.NdJ("focus",function(i){e.CHM(t);const s=e.oxw(5).$implicit;return e.KtG(s.onFocus(i))})("keypress",function(i){e.CHM(t);const s=e.oxw(5).$implicit;return e.KtG(s.onChange(i))})("blur",function(i){e.CHM(t);const s=e.oxw(5).$implicit;return e.KtG(s.onBlur(i))}),e.qZA()}if(2&n){const t=e.oxw(5).$implicit;e.Q6J("formControlName",t.name)}}function Bm(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"input",48),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onValueChange(a.name,s.record,i))}),e.qZA()}if(2&n){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,i=e.oxw();e.s9C("step",o.step),e.s9C("value",t.cellData[o.name].value),e.s9C("readonly",i.getValidationAttributeValue(o,"readonly")),e.s9C("required",i.getValidationAttributeValue(o,"mandatory")),e.s9C("min",i.getValidationAttributeValue(o,"minValue")),e.s9C("max",i.getValidationAttributeValue(o,"maxValue")),e.Q6J("formControlName",o.name)}}function Jm(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"input",49),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onValueChange(a.name,s.record,i))}),e.qZA()}if(2&n){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,i=e.oxw();e.s9C("value",t.cellData[o.name].value),e.s9C("readonly",i.getValidationAttributeValue(o,"readonly")),e.s9C("required",i.getValidationAttributeValue(o,"mandatory")),e.Q6J("formControlName",o.name)}}function Um(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-checkbox",50),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onBooleanValueChange(a.name,s.record,i))}),e.qZA()}if(2&n){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit;e.Q6J("formControlName",o.name)("checked",t.cellData[o.name].value)}}function Gm(n,r){if(1&n&&(e.TgZ(0,"mat-option",53),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.id)("disabled",t.disabled),e.xp6(1),e.hij(" ",t.value," ")}}function qm(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-select",51),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectValueChange(a.name,s.record,i))}),e.YNc(1,Gm,2,3,"mat-option",52),e.qZA()}if(2&n){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,i=e.oxw();e.s9C("required",i.getValidationAttributeValue(o,"mandatory")),e.Q6J("formControlName",o.name)("multiple",o.multiple)("value",t.cellData[o.name].value),e.xp6(1),e.Q6J("ngForOf",o.domainValues)}}function jm(n,r){if(1&n&&e._UZ(0,"input",54),2&n){e.oxw();const t=e.MAs(9),o=e.oxw().$implicit,i=e.oxw(3).$implicit,s=e.oxw();e.s9C("required",s.getValidationAttributeValue(i,"mandatory")),e.s9C("value",o.cellData[i.name].value),e.s9C("readonly",s.getValidationAttributeValue(i,"readonly")),e.Q6J("formControlName",i.name)("matAutocomplete",t)}}function Qm(n,r){if(1&n&&(e.TgZ(0,"mat-option",55),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.value," ")}}function Ym(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td",32),e.YNc(1,Rm,5,4,"div",33),e.YNc(2,Nm,1,1,"input",34),e.YNc(3,Bm,1,7,"input",35),e.YNc(4,Jm,1,4,"input",36),e.YNc(5,Um,1,2,"mat-checkbox",37),e.YNc(6,qm,2,5,"mat-select",38),e.YNc(7,jm,1,5,"input",39),e.TgZ(8,"mat-autocomplete",40,41),e.NdJ("optionSelected",function(i){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onAutocompleteValueChange(a,s.record,i))}),e.YNc(10,Qm,2,2,"mat-option",42),e.ALo(11,"async"),e.qZA()()}if(2&n){const t=e.oxw().$implicit,o=e.oxw(3).$implicit,i=e.oxw();e.Q6J("formGroup",i.formGroup)("ngClass",t.cellData[o.name].class),e.xp6(1),e.Q6J("ngIf","date"===o.type),e.xp6(1),e.Q6J("ngIf","time"===o.type),e.xp6(1),e.Q6J("ngIf","number"===o.type),e.xp6(1),e.Q6J("ngIf",!o.type||"string"===o.type),e.xp6(1),e.Q6J("ngIf","boolean"===o.type),e.xp6(1),e.Q6J("ngIf","list"===o.type),e.xp6(1),e.Q6J("ngIf","autocomplete"===o.type),e.xp6(3),e.Q6J("ngForOf",e.lcZ(11,10,i.filteredOptions[o.name]))}}function Hm(n,r){if(1&n&&(e._UZ(0,"td",29),e.ALo(1,"sanitizeHtml")),2&n){const t=e.oxw(2).$implicit,o=e.oxw(3).$implicit;e.Q6J("ngClass",t.cellData[o.name].class)("innerHTML",e.lcZ(1,2,t.cellData[o.name].value),e.oJD)}}function Vm(n,r){if(1&n&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&n){const t=e.oxw(3).$implicit,o=e.oxw(3).$implicit;e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,t.cellData[o.name].value)),e.LSH)}}function zm(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.targetHtmlUrl")," "))}function Km(n,r){if(1&n&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(2,Vm,3,5,"img",24),e.YNc(3,zm,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&n){const t=e.MAs(4),o=e.oxw(2).$implicit,i=e.oxw(3).$implicit;e.Q6J("ngClass",o.cellData[i.name].class),e.xp6(1),e.s9C("href",o.cellData[i.name].value,e.LSH),e.xp6(1),e.Q6J("ngIf",o.cellData[i.name].isImg)("ngIfElse",t)}}function Wm(n,r){if(1&n&&(e.YNc(0,Hm,2,4,"td",27),e.YNc(1,Km,5,4,"ng-template",null,56,e.W1O)),2&n){const t=e.MAs(2),o=e.oxw().$implicit,i=e.oxw(3).$implicit;e.Q6J("ngIf",!o.cellData[i.name].isUrl)("ngIfElse",t)}}function Xm(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Ym,12,12,"td",30),e.YNc(2,Wm,3,2,"ng-template",null,31,e.W1O),e.BQk()),2&n){const t=r.$implicit,o=e.MAs(3),i=e.oxw(4);e.xp6(1),e.Q6J("ngIf",i.isEdition(t.record))("ngIfElse",o)}}function eh(n,r){1&n&&(e.ynx(0),e.YNc(1,Xm,4,2,"ng-container",19),e.BQk())}function th(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-icon",60),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw(4).$implicit;return e.KtG(s.onClick(i))}),e.qZA()}if(2&n){const t=e.oxw().$implicit,o=e.oxw(3).$implicit;e.s9C("svgIcon",t.cellData[o.name].value||o.icon)}}function oh(n,r){if(1&n&&e._UZ(0,"mat-icon",61),2&n){const t=e.oxw().$implicit,o=e.oxw(3).$implicit;e.s9C("svgIcon",t.cellData[o.name].value||o.icon)}}function ih(n,r){if(1&n&&(e.TgZ(0,"td",22),e.YNc(1,th,1,1,"mat-icon",58),e.YNc(2,oh,1,1,"mat-icon",59),e.qZA()),2&n){const t=r.$implicit,o=e.oxw(3).$implicit;e.Q6J("ngClass",t.cellData[o.name].class),e.xp6(1),e.Q6J("ngIf",o.onClick),e.xp6(1),e.Q6J("ngIf",!o.onClick)}}function nh(n,r){1&n&&(e.ynx(0),e.YNc(1,ih,3,3,"td",57),e.BQk())}function rh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",65),e.NdJ("mousedown",function(){e.CHM(t);const i=e.oxw(2).$implicit,s=e.oxw().$implicit,a=e.oxw(4);return e.KtG(a.onButtonClick(i.click,s.record))}),e._UZ(1,"mat-icon",61),e.qZA()}if(2&n){const t=e.oxw(2).$implicit;e.Q6J("color",t.color)("disabled",t.disabled),e.xp6(1),e.s9C("svgIcon",t.icon)}}function sh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",66),e.NdJ("mousedown",function(){e.CHM(t);const i=e.oxw(2).$implicit,s=e.oxw().$implicit,a=e.oxw(4);return e.KtG(a.onButtonClick(i.click,s.record))}),e._UZ(1,"mat-icon",61),e.qZA()}if(2&n){const t=e.oxw(2).$implicit;e.Q6J("color",t.color)("disabled",t.disabled),e.xp6(1),e.s9C("svgIcon",t.icon)}}function ah(n,r){if(1&n&&(e.ynx(0),e.YNc(1,rh,2,3,"button",63),e.YNc(2,sh,2,3,"button",64),e.BQk()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf","mat-icon-button"===t.style),e.xp6(1),e.Q6J("ngIf","mat-icon-button"!==t.style)}}function lh(n,r){if(1&n&&(e.TgZ(0,"span"),e.YNc(1,ah,3,2,"ng-container",10),e.qZA()),2&n){const t=r.$implicit,o=e.oxw().$implicit,i=e.oxw(4);e.xp6(1),e.Q6J("ngIf",i.isEdition(o.record)===t.editMode||void 0===t.editMode)}}function ch(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"td",22),e.YNc(2,lh,2,1,"span",62),e.qZA(),e.BQk()),2&n){const t=r.$implicit,o=e.oxw(3).$implicit;e.xp6(1),e.Q6J("ngClass",t.cellData[o.name].class),e.xp6(1),e.Q6J("ngForOf",t.cellData[o.name].value)}}function uh(n,r){1&n&&(e.ynx(0),e.YNc(1,ch,3,2,"ng-container",19),e.BQk())}function ph(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Im,2,0,"ng-container",10),e.YNc(2,Em,2,0,"ng-container",10),e.YNc(3,eh,2,0,"ng-container",10),e.YNc(4,nh,2,0,"ng-container",10),e.YNc(5,uh,2,0,"ng-container",10),e.BQk()),2&n){const t=r.ngIf,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.Default),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.HTML),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.UnsanitizedHTML),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.Icon),e.xp6(1),e.Q6J("ngIf",t===o.entityTableColumnRenderer.ButtonGroup)}}function dh(n,r){if(1&n&&(e.ynx(0,14),e.YNc(1,Sm,2,0,"ng-container",10),e.YNc(2,Tm,2,0,"ng-container",10),e.YNc(3,ph,6,5,"ng-container",10),e.BQk()),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("matColumnDef",t.name),e.xp6(1),e.Q6J("ngIf",o.columnIsSortable(t)),e.xp6(1),e.Q6J("ngIf",!o.columnIsSortable(t)),e.xp6(1),e.Q6J("ngIf",o.getColumnRenderer(t))}}function gh(n,r){if(1&n&&e._UZ(0,"tr",67),2&n){const t=e.oxw();e.Q6J("ngClass",t.getHeaderClass())}}function mh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"tr",68),e.NdJ("select",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onRowSelect(s.record))})("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onRowClick(s.record))}),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw();e.Q6J("scrollBehavior",o.scrollBehavior)("ngClass",o.getRowClass(t.record))("selection",o.selection)("selected",o.rowIsSelected(t.record))}}function hh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-entity-table-paginator",69),e.NdJ("paginatorChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.paginatorChange(i))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("store",t.store)("paginatorOptions",t.paginatorOptions)("entitySortChange$",t.entitySortChange$)}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[String]),(0,T.w6)("design:returntype",ue.y)],zo.prototype,"transform",null);const fh=function(n){return{height:n}};let Si=(()=>{class n{cdRef;formBuilder;_focusMonitor;_elementRef;ngControl;_parentForm;_controlName;_defaultErrorStateMatcher;dateAdapter;entitySortChange$=new y.X(!1);formGroup=new _.nJ({});filteredOptions={};entityTableColumnRenderer=wt;entityTableSelectionState=qs;selectionState$=new y.X(void 0);selection$$;dataSource$$;lastRecordCheckedKey;store;set paginator(t){this._paginator=t,this.dataSource.paginator=t}get paginator(){return this._paginator}_paginator;template;scrollBehavior=dr.Auto;sortNullsFirst=!1;withPaginator=!1;paginatorOptions;entityClick=new e.vpe;entitySelectChange=new e.vpe;entitySortChange=new e.vpe(void 0);get headers(){let t=this.template.columns.filter(o=>!1!==o.visible).map(o=>o.name);return!0===this.selectionCheckbox&&(t=["selectionCheckbox"].concat(t)),t}dataSource=new ve.by;get selection(){return this.template.selection||!1}get selectionCheckbox(){return this.template.selectionCheckbox||!1}get selectMany(){return this.template.selectMany||!1}get fixedHeader(){return void 0===this.template.fixedHeader||this.template.fixedHeader}get tableHeight(){return this.template.tableHeight?this.template.tableHeight:"auto"}constructor(t,o,i,s,a,l,c,u,p){this.cdRef=t,this.formBuilder=o,this._focusMonitor=i,this._elementRef=s,this.ngControl=a,this._parentForm=l,this._controlName=c,this._defaultErrorStateMatcher=u,this.dateAdapter=p,this.dateAdapter.setLocale("fr-CA")}ngOnInit(){this.handleDatasource(),this.dataSource.paginator=this.paginator,this.store.state.change$.pipe((0,ae.b)(100)).subscribe(()=>{this.handleDatasource(),this.refresh()})}ngOnChanges(t){const o=t.store;o&&o.currentValue!==o.previousValue&&this.handleDatasource()}onValueChange(t,o,i){const s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=i.target.value}onBooleanValueChange(t,o,i){const s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=i.checked}onSelectValueChange(t,o,i){const s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=i.value}onAutocompleteValueChange(t,o,i){this.formGroup.controls[t.name].setValue(i.option.viewValue);const s=this.getColumnKeyWithoutPropertiesTag(t.name);o.entity.properties[s]=i.option.value}onDateChange(t,o,i){const a=E()(i.value).format("YYYY-MM-DD"),l=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[l]=a}enableEdit(t){const o=t.entity.properties||t.entity;this.template.columns.forEach(i=>{i.title=i.validation?.mandatory&&!i.title.includes("*")?i.title+" *":i.title;const s=this.getColumnKeyWithoutPropertiesTag(i.name);if("boolean"===i.type)o[s]&&null!==o[s]?"string"==typeof o[s]&&(o[s]=JSON.parse(o[s].toLowerCase())):o[s]=!1,this.formGroup.setControl(i.name,this.formBuilder.control(o[s]));else if("list"===i.type)i.multiple?this.formGroup.setControl(i.name,this.formBuilder.control([o[s]])):(this.formGroup.setControl(i.name,this.formBuilder.control(o[s])),this.formGroup.controls[i.name].setValue("string"==typeof o[s]?parseInt(o[s]):o[s]));else if("autocomplete"===i.type){this.formGroup.setControl(i.name,this.formBuilder.control(o[s])),this.filteredOptions[i.name]=new ue.y,this.filteredOptions[i.name]=this.formGroup.controls[i.name].valueChanges.pipe((0,I.U)(l=>{if(l?.length)return i.domainValues?.filter(c=>{const u=l?l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return c.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(u)})}));let a=o[s];if(i.domainValues.forEach(l=>{"string"==typeof a&&Dt.isValidNumber(a)&&!Dt.isOctalNumber(a)&&(a=parseInt(a)),(l.value===a||l.id===a)&&(a=l.value)}),this.formGroup.controls[i.name].setValue(a),this.isEdition(t)&&i.linkColumnForce){const l=t.entity;this.formGroup.controls[i.name].setValue(l?.properties[this.getColumnKeyWithoutPropertiesTag(i.linkColumnForce)])}}else if("date"===i.type){if(!1!==i.visible)if(o[s]){let a=E()(o[s]);o[s]=a.utc().format("YYYY-MM-DD"),this.formGroup.setControl(i.name,this.formBuilder.control(o[s]))}else{const a=this.getColumnKeyWithoutPropertiesTag(i.name);t.entity.properties[a]=null,this.formGroup.setControl(i.name,this.formBuilder.control(null))}}else this.formGroup.setControl(i.name,this.formBuilder.control(o[s]));this.formGroup.controls[i.name]&&this.getValidationAttributeValue(i,"readonly")&&this.formGroup.controls[i.name].disable()})}handleDatasource(){this.unsubscribeStore(),this.selection$$=this.store.stateView.manyBy$(t=>!0===t.state.selected).subscribe(t=>{const o=t[0],i=this.store.stateView.all().indexOf(o),s=this.paginator?this.paginator.pageSize*(this.paginator.pageIndex+1):0;if(this.paginator&&(i<(this.paginator?s-this.paginator.pageSize:0)||i>=s)){const l=Math.floor(i/this.paginator.pageSize);this.dataSource.paginator.pageIndex=l}this.selectionState$.next(this.computeSelectionState(t))}),this.dataSource$$=this.store.stateView.all$().subscribe(t=>{t[0]&&this.enableEdit(t[0]),this.dataSource.data=t.map(o=>({record:o,cellData:this.template.columns.reduce((i,s)=>{const a=this.getValue(o,s);return i[s.name]={class:this.getCellClass(o,s),value:a,isUrl:this.isUrl(a),isImg:this.isImg(a)},i},{})}))})}ngOnDestroy(){this.unsubscribeStore()}unsubscribeStore(){this.selection$$&&this.selection$$.unsubscribe(),this.dataSource$$&&this.dataSource$$.unsubscribe()}getTrackByFunction(){return(t,o)=>o.record.ref}refresh(){this.cdRef.detectChanges()}paginatorChange(t){this.paginator=t}onSort(t){const o=t.direction,i=this.template.columns.find(s=>s.name===t.active);"asc"===o||"desc"===o?(this.store.stateView.sort({valueAccessor:s=>this.getValue(s,i),direction:o,nullsFirst:this.sortNullsFirst}),this.entitySortChange.emit({column:i,direction:o}),this.entitySortChange$.next(!0)):this.store.stateView.sort(void 0)}onRowClick(t){this.lastRecordCheckedKey=this.store.stateView.getKey(t),this.entityClick.emit(t.entity)}onRowSelect(t){if(!1===this.selection)return;const o=t.entity;this.store.state.update(o,{selected:!0},!0),this.entitySelectChange.emit({added:[o]})}onToggleRows(t){if(!1!==this.selection&&(this.store.state.updateAll({selected:t}),!0===t)){const o=this.store.stateView.all().map(i=>i.entity);this.entitySelectChange.emit({added:[o]})}}onToggleRow(t,o){if(!1===this.selection)return;const i=o.entity;this.store.state.update(i,{selected:t},!0===t&&!this.selectMany),!0===t&&this.entitySelectChange.emit({added:[i]}),this.lastRecordCheckedKey=this.store.stateView.getKey(o)}onShiftToggleRow(t,o,i){if(!1===this.selection)return;if(!1===this.selectMany||void 0===this.lastRecordCheckedKey)return void this.onToggleRow(t,o);const s=window.document.createRange();s.selectNode(i.target),window.getSelection().removeAllRanges(),window.getSelection().addRange(s),i.stopImmediatePropagation();const a=this.store.stateView.all(),l=a.indexOf(o),c=this.store.stateView.get(this.lastRecordCheckedKey),p=[l,a.indexOf(c)],g=a.slice(Math.min(...p),Math.max(...p)+1).map(h=>h.entity);this.store.state.updateMany(g,{selected:t}),!0===t&&this.entitySelectChange.emit({added:g}),this.lastRecordCheckedKey=this.store.stateView.getKey(o)}computeSelectionState(t){const i=t.length;return 0===i?qs.None:i===this.store.stateView.count?qs.All:qs.Some}columnIsSortable(t){let o=t.sort;return void 0===o&&(o=void 0!==this.template.sort&&this.template.sort),o}rowIsSelected(t){const o=t.state;return!!o.selected&&o.selected}isImg(t){return!!this.isUrl(t)&&-1!==["jpg","png","gif"].indexOf(t.split(".").pop().toLowerCase())}isUrl(t){return"string"==typeof t&&("https://"===t.slice(0,8)||"http://"===t.slice(0,7))}getValue(t,o){const i=t.entity;let s;if(void 0!==o.valueAccessor)return o.valueAccessor(i,t);if(void 0!==this.template.valueAccessor)return this.template.valueAccessor(i,o.name,t);if(s=this.store.getProperty(i,o.name),"boolean"===o.type)null==s||""===s?s=!1:"boolean"!=typeof s&&void 0!==s&&(s="number"==typeof s?!!s:JSON.parse(s.toLowerCase())),this.isEdition(t)||(s=s?"&#10003;":"");else if("list"===o.type&&s&&o.domainValues){const a=t.entity;if(o.multiple){let l;l="string"==typeof s?s.match(/[\w.-]+/g).map(Number):s;let c=[];o.domainValues.forEach(u=>{l.includes(u.id)&&c.push(t.edition?u.id:u.value)}),s=this.isEdition(t)?l:c}else!this.isEdition(t)&&o.linkColumnForce?s=a?.properties[this.getColumnKeyWithoutPropertiesTag(o.linkColumnForce)]:o.domainValues.forEach(l=>{"string"==typeof s&&Dt.isValidNumber(s)&&!Dt.isOctalNumber(s)&&(s=parseInt(s)),(l.value===s||l.id===s)&&(s=this.isEdition(t)?l.id:l.value)})}else if("autocomplete"===o.type&&s&&o.domainValues){const a=t.entity;!this.isEdition(t)&&o.linkColumnForce?s=a?.properties[this.getColumnKeyWithoutPropertiesTag(o.linkColumnForce)]:o.domainValues.forEach(l=>{"string"==typeof s&&Dt.isValidNumber(s)&&!Dt.isOctalNumber(s)&&(s=parseInt(s)),(l.value===s||l.id===s)&&(s=l.value)})}else"date"===o.type&&(this.isEdition(t)?s&&(s=E()(s).format(),this.formGroup.controls[o.name].setValue(s)):!this.isEdition(t)&&null===s&&(s=""));return void 0===s&&(s=""),s}getValidationAttributeValue(t,o){return void 0!==t.validation&&void 0!==t.validation[o]&&t.validation[o]}isEdition(t){return!!t.entity.edition}getColumnRenderer(t){return void 0!==t.renderer?t.renderer:wt.Default}getTableClass(){return{"igo-entity-table-with-selection":this.selection}}getHeaderClass(){const t=this.template.headerClassFunc;return t instanceof Function?t():{}}getRowClass(t){const i=this.template.rowClassFunc;return i instanceof Function?i(t.entity,t):{}}getCellClass(t,o){const i=t.entity,s={},a=this.template.cellClassFunc;a instanceof Function&&Object.assign(s,a(i,o,t));const l=o.cellClassFunc;return l instanceof Function&&Object.assign(s,l(i,t)),s}onButtonClick(t,o){this.enableEdit(o),"function"==typeof t&&t(o.entity,o)}getColumnKeyWithoutPropertiesTag(t){return t.includes("properties.")?t.split(".")[1]:t}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO),e.Y36(_.QS),e.Y36(fm.tE),e.Y36(e.SBq),e.Y36(_.a5,10),e.Y36(_.F,8),e.Y36(_.u,8),e.Y36(le.rD),e.Y36(le._A))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-entity-table"]],inputs:{store:"store",paginator:"paginator",template:"template",scrollBehavior:"scrollBehavior",sortNullsFirst:"sortNullsFirst",withPaginator:"withPaginator",paginatorOptions:"paginatorOptions"},outputs:{entityClick:"entityClick",entitySelectChange:"entitySelectChange",entitySortChange:"entitySortChange"},features:[e._Bn([{provide:F.Eo,useExisting:n}]),e.TTD],decls:9,vars:11,consts:[[1,"table-container",3,"ngStyle"],["id","currentWorkspaceTable","mat-table","","matSort","",3,"ngClass","dataSource","trackBy","matSortChange"],["matColumnDef","selectionCheckbox",1,"mat-cell-checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"ngClass",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click",4,"matRowDef","matRowDefColumns"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],["mat-header-cell",""],[4,"ngIf"],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","mousedown","click","change"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip"],["mat-header-cell","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","",3,"matTooltip"],[4,"matCellDef"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"ngIf","ngIfElse"],["isAnUrlDefault",""],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","50","heigth","auto",3,"src",4,"ngIf","ngIfElse"],["notImg",""],["igoImageError","","width","50","heigth","auto",3,"src"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"ngIf","ngIfElse"],["isAnUrlHTML",""],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-cell","","class","mat-cell-text edition",3,"formGroup","ngClass",4,"ngIf","ngIfElse"],["isUnsanitizedHTML",""],["mat-cell","",1,"mat-cell-text","edition",3,"formGroup","ngClass"],["class","date-picker",4,"ngIf"],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur",4,"ngIf"],["matInput","","type","number","class","class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input",4,"ngIf"],["matInput","","type","text",3,"formControlName","value","readonly","required","input",4,"ngIf"],[3,"formControlName","checked","change",4,"ngIf"],[3,"required","formControlName","multiple","value","selectionChange",4,"ngIf"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly",4,"ngIf"],["panelWidth","430px",3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"date-picker"],["matSuffix","",3,"for"],["matInput","",3,"matDatepicker","formControlName","value","dateChange"],["picker",""],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur"],["matInput","","type","number",1,"class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input"],["matInput","","type","text",3,"formControlName","value","readonly","required","input"],[3,"formControlName","checked","change"],[3,"required","formControlName","multiple","value","selectionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly"],[3,"value"],["isAnUrlUnsanitizedHTML",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],[3,"svgIcon","click",4,"ngIf"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon","click"],[3,"svgIcon"],[4,"ngFor","ngForOf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown"],["mat-header-row","",3,"ngClass"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"table",1),e.NdJ("matSortChange",function(a){return i.onSort(a)}),e.ynx(2,2),e.YNc(3,vm,2,1,"th",3),e.YNc(4,Cm,2,1,"td",4),e.BQk(),e.YNc(5,dh,4,4,"ng-container",5),e.YNc(6,gh,1,1,"tr",6),e.YNc(7,mh,1,4,"tr",7),e.qZA(),e.YNc(8,hh,1,3,"igo-entity-table-paginator",8),e.qZA()),2&o&&(e.Q6J("ngStyle",e.VKq(9,fh,i.tableHeight)),e.xp6(1),e.Q6J("ngClass",i.getTableClass())("dataSource",i.dataSource)("trackBy",i.getTrackByFunction()),e.xp6(4),e.Q6J("ngForOf",i.template.columns),e.xp6(1),e.Q6J("matHeaderRowDef",i.headers)("matHeaderRowDefSticky",i.fixedHeader),e.xp6(1),e.Q6J("matRowDefColumns",i.headers),e.xp6(1),e.Q6J("ngIf",i.withPaginator))},dependencies:[f.mk,f.sg,f.O5,f.PC,ve.BZ,ve.fO,ve.as,ve.w1,ve.Dz,ve.nj,ve.ge,ve.ev,ve.XQ,ve.Gk,Je.XC,le.ey,Je.ZL,yi.YE,yi.nU,w.Hw,S.RK,S.nh,ze.oG,F.R9,se.gD,_n,Fc,Qs,_.Fj,_.wV,_.JJ,_.JL,_.Q7,_.qQ,_.Fd,_.sg,_.u,j.Nt,Ho.Mq,Ho.hl,Ho.nW,P.gM,_m,f.Ov,fr,zo,O.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-compact[_nghost-%COMP%]   tr.mat-mdc-header-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:36px}.table-compact[_nghost-%COMP%]   tr.mat-mdc-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:28px}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}[_nghost-%COMP%]   .mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}[_nghost-%COMP%]   entity-table[_ngcontent-%COMP%]   table.igo-entity-table-with-selection[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd;cursor:pointer}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:7px}[_nghost-%COMP%]   .class_hidden[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .class_display_none[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .class_boolean[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number[_ngcontent-%COMP%]{text-align:center;padding-right:35px!important}[_nghost-%COMP%]   .class_string[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_text[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number_edition[_ngcontent-%COMP%]{text-align:left}[_nghost-%COMP%]   td.edition[_ngcontent-%COMP%]{background:rgba(166,166,166,.2)}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{border-bottom:1px solid darkgrey}"],changeDetection:0})}return n})();class Ac{options;activeTool$=new y.X(void 0);toolbar$=new y.X([]);activeTool$$;activeToolHistory=[];store=new xt([],{getKey:r=>r.name});get tools$(){return this.store.entities$}constructor(r={}){this.options=r,this.setToolbar(r.toolbar),this.initStore()}destroy(){this.activeTool$$.unsubscribe(),this.store.destroy()}getTool(r){return this.store.get(r)}getTools(){return this.store.all()}setTools(r){this.store.load(r)}getToolbar(){return this.toolbar$.getValue()}setToolbar(r){this.toolbar$.next(r||[])}activateTool(r,t={}){const o=this.getTool(r);void 0!==o&&this.store.state.update(o,{active:!0,options:t},!0)}activatePreviousTool(){if(this.activeToolHistory.length<=1)return void this.deactivateTool();const[r,t]=this.activeToolHistory.splice(-2,2);this.activateTool(r)}deactivateTool(){this.clearActiveToolHistory(),this.store.state.updateAll({active:!1})}initStore(){this.store=new xt([],{getKey:r=>r.name}),this.activeTool$$=this.store.stateView.firstBy$(r=>!0===r.state.active).subscribe(r=>{if(void 0===r)return void this.setActiveTool(void 0);const t=r.entity,o=Object.assign({},t.options||{},r.state.options||{});this.setActiveTool(Object.assign({},t,{options:o}))})}setActiveTool(r){this.activeTool$.next(r),void 0===r?this.clearActiveToolHistory():this.activeToolHistory=this.activeToolHistory.filter(t=>t!==r.name).concat([r.name])}clearActiveToolHistory(){this.activeToolHistory=[]}}let Gi=(()=>{class n{static tools={};toolbox=new Ac;static register(t){n.tools[t.name]=t}constructor(){this.toolbox.setTools(this.getTools())}getTool(t){return n.tools[t]}getTools(){return Object.values(n.tools)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),_h=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Is,$s]})}return n})(),yh=(()=>{class n{static forRoot(){return{ngModule:n,providers:[Gi]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_h]})}return n})(),Hs=(()=>{class n{dynamicComponentService;constructor(t){this.dynamicComponentService=t}create(t){return this.dynamicComponentService.create(t)}static \u0275fac=function(o){return new(o||n)(e.LFG(ks))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Vs=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,$s]})}return n})(),Lc=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[Hs],imports:[f.ez,Vs,Vs]})}return n})(),bh=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Ns]})}return n})(),vh=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Vs]})}return n})(),Ch=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,bh,vh]})}return n})();var qi=v(65635),Mc=v(45789);let xh=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[_.u5,S.ot,F.lN,j.c,_.UX,f.ez,qi.U8,Mc.t8,O.aw]})}return n})();var wi=function(n){return n.Dock="dock",n.Overlay="overlay",n.Context="context",n}(wi||{});class Ko extends xt{}var zs=v(92568);function Sh(n,r){if(1&n&&(e._UZ(0,"mat-icon",7),e.ALo(1,"async")),2&n){const t=e.oxw(3);e.s9C("svgIcon",e.lcZ(1,1,t.icon$))}}function wh(n,r){if(1&n&&(e.TgZ(0,"button",5),e.ALo(1,"async"),e.YNc(2,Sh,2,3,"mat-icon",6),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("color",t.color)("disabled",e.lcZ(1,4,t.disabled$))("disableRipple",!0),e.xp6(2),e.Q6J("ngIf",t.withIcon)}}function Th(n,r){if(1&n&&(e.TgZ(0,"span",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(e.lcZ(2,1,t.title))}}function Fh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item",2),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,wh,3,6,"button",3),e.YNc(5,Th,3,3,"span",4),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",t.withTooltip?e.lcZ(1,4,e.lcZ(2,6,t.tooltip$)||t.title):"")("ngClass",e.lcZ(3,8,t.ngClass$)),e.xp6(4),e.Q6J("ngIf",t.withIcon),e.xp6(1),e.Q6J("ngIf",t.withTitle)}}function Oh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-checkbox",11),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.action.handler())}),e.ALo(1,"async"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("checked",e.lcZ(1,2,t.checkCondition$)),e.xp6(2),e.hij(" ",e.lcZ(3,4,t.title)," ")}}function Ah(n,r){if(1&n&&(e.TgZ(0,"mat-list-item",9),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,Oh,4,6,"mat-checkbox",10),e.qZA()),2&n){const t=e.oxw();e.Q6J("matTooltip",t.withTooltip?e.lcZ(1,3,e.lcZ(2,5,t.tooltip$)||t.title):"")("ngClass",e.lcZ(3,7,t.ngClass$)),e.xp6(4),e.Q6J("ngIf",t.withTitle)}}let Lh=(()=>{class n{disabled$=new y.X(!1);checkCondition$=new y.X(void 0);icon$=new y.X(void 0);tooltip$=new y.X(void 0);noDisplay$=new y.X(!1);ngClass$=new y.X({});ngClass$$;disabled$$;availability$$;icon$$;checkCondition$$;tooltip$$;noDisplay$$;display$$;action;color="default";withTitle=!0;withIcon=!0;withTooltip=!0;set disabled(t){this.disabled$.next(t)}get disabled(){return this.disabled$.value}set noDisplay(t){this.noDisplay$.next(t)}get noDisplay(){return this.noDisplay$.value}trigger=new e.vpe;get title(){return this.action.title}constructor(){}ngOnInit(){const t=this.action.args||[];void 0!==this.action.ngClass&&(this.ngClass$$=this.action.ngClass(...t).subscribe(o=>this.updateNgClass(o))),(0,zs.b)(this.action.icon)?this.icon$$=this.action.icon.subscribe(o=>this.updateIcon(o)):this.updateIcon(this.action.icon),(0,zs.b)(this.action.checkCondition)?this.checkCondition$$=this.action.checkCondition.subscribe(o=>this.updateCheckCondition(o)):this.updateCheckCondition(this.action.checkCondition),(0,zs.b)(this.action.tooltip)?this.tooltip$$=this.action.tooltip.subscribe(o=>this.updateTooltip(o)):this.updateTooltip(this.action.tooltip),void 0!==this.action.availability&&(this.availability$$=this.action.availability(...t).subscribe(o=>this.disabled=!o)),this.disabled$$=this.disabled$.subscribe(o=>this.updateNgClass({"igo-actionbar-item-disabled":o})),void 0!==this.action.display&&(this.display$$=this.action.display(...t).subscribe(o=>this.noDisplay=!o)),this.noDisplay$$=this.noDisplay$.subscribe(o=>this.updateNgClass({"igo-actionbar-item-no-display":o}))}ngOnDestroy(){void 0!==this.ngClass$$&&(this.ngClass$$.unsubscribe(),this.ngClass$$=void 0),void 0!==this.availability$$&&(this.availability$$.unsubscribe(),this.availability$$=void 0),void 0!==this.display$$&&(this.display$$.unsubscribe(),this.display$$=void 0),void 0!==this.checkCondition$$&&(this.checkCondition$$.unsubscribe(),this.checkCondition$$=void 0),void 0!==this.icon$$&&(this.icon$$.unsubscribe(),this.icon$$=void 0),void 0!==this.tooltip$$&&(this.tooltip$$.unsubscribe(),this.tooltip$$=void 0),this.disabled$$.unsubscribe(),this.noDisplay$$.unsubscribe()}onClick(){!0!==this.disabled&&this.trigger.emit(this.action)}updateNgClass(t){this.ngClass$.next(Object.assign({},this.ngClass$.value,t))}updateTooltip(t){this.tooltip$.next(t)}updateCheckCondition(t){this.checkCondition$.next(t)}updateIcon(t){this.icon$.next(t)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-actionbar-item"]],inputs:{action:"action",color:"color",withTitle:"withTitle",withIcon:"withIcon",withTooltip:"withTooltip",disabled:"disabled",noDisplay:"noDisplay"},outputs:{trigger:"trigger"},decls:2,vars:2,consts:[["class","actionbar-item","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click",4,"ngIf"],["class","item-checkbox","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass",4,"ngIf"],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"actionbar-item",3,"matTooltip","ngClass","click"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple",4,"ngIf"],["matLine","",4,"ngIf"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon"],["matLine",""],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"item-checkbox",3,"matTooltip","ngClass"],[3,"checked","change",4,"ngIf"],[3,"checked","change"]],template:function(o,i){1&o&&(e.YNc(0,Fh,6,10,"mat-list-item",0),e.YNc(1,Ah,5,9,"mat-list-item",1)),2&o&&(e.Q6J("ngIf",!i.action.checkbox),e.xp6(1),e.Q6J("ngIf",i.action.checkbox))},dependencies:[f.mk,f.O5,S.RK,w.Hw,P.gM,Z.Tg,Z.D1,ze.oG,f.Ov,O.X$],styles:["[_nghost-%COMP%]     mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-disabled[_ngcontent-%COMP%]{color:#00000042;cursor:default!important}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-no-display[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button[matlistitemavatar]{margin-left:4px}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button .mat-mdc-button-persistent-ripple{display:none}[_nghost-%COMP%]   .item-checkbox[_ngcontent-%COMP%]     mat-checkbox label{margin-left:28px}[_nghost-%COMP%]   .actionbar-item[_ngcontent-%COMP%]   [matline][_ngcontent-%COMP%]{padding-left:16px}"],changeDetection:0})}return n})();function Mh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",7)(1,"button",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.scrollUp())}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",9),e.qZA()()}2&n&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.common.actionbar.scrollUp")))}function Ih(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",10),e.NdJ("trigger",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onTriggerAction(i.toggleCollapseAction))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("withTitle",!1)("withIcon",!0)("color",t.color)("disabled",t.store.view.empty)("action",t.toggleCollapseAction)}}function Zh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",13),e.NdJ("trigger",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.onTriggerAction(s))}),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("withTooltip",o.withTooltip)("color",o.color)("disabled",o.store.state.get(t).disabled)("action",t)}}function Ph(n,r){if(1&n&&(e.YNc(0,Zh,1,6,"ng-template",11,12,e.W1O),e.ALo(2,"async")),2&n){const t=e.oxw(2);e.Q6J("ngForOf",e.lcZ(2,1,t.store.view.all$()))}}function kh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",14)(1,"button",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.scrollDown())}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",15),e.qZA()()}2&n&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.common.actionbar.scrollDown")))}function $h(n,r){if(1&n&&(e.TgZ(0,"mat-list",3),e.YNc(1,Mh,4,3,"div",4),e.YNc(2,Ih,1,5,"igo-actionbar-item",5),e.YNc(3,Ph,3,3,null,1),e.YNc(4,kh,4,3,"div",6),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.heightCondition&&t.positionConditionTop&&t.isDesktop),e.xp6(1),e.Q6J("ngIf",t.withToggleButton),e.xp6(1),e.Q6J("ngIf",!t.collapsed),e.xp6(1),e.Q6J("ngIf",t.heightCondition&&t.positionConditionLow&&t.isDesktop)}}function Dh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",20),e.NdJ("trigger",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onTriggerAction(s))}),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(2);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("color",o.color)("action",t)}}function Eh(n,r){if(1&n&&(e.TgZ(0,"div")(1,"button",16),e.ALo(2,"translate"),e._UZ(3,"mat-icon",17),e.qZA(),e.TgZ(4,"mat-menu",18,19)(6,"mat-list"),e.YNc(7,Dh,1,4,"ng-template",11),e.ALo(8,"async"),e.qZA()()()),2&n){const t=e.MAs(5),o=e.oxw();e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,10,"igo.common.actionbar.icon"))("matMenuTriggerFor",t)("disabled",o.store.view.empty)("color",o.iconColor),e.xp6(2),e.Q6J("svgIcon",o.icon),e.xp6(1),e.Tol(o.overlayClass),e.Q6J("xPosition",o.xPosition)("yPosition",o.yPosition),e.xp6(3),e.Q6J("ngForOf",e.lcZ(8,12,o.store.view.all$()))}}function Rh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-actionbar-item",20),e.NdJ("trigger",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onTriggerAction(s))}),e.qZA(),e._UZ(1,"br")}if(2&n){const t=r.$implicit,o=e.oxw(2);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("color",o.color)("action",t)}}function Nh(n,r){if(1&n&&(e.TgZ(0,"mat-card",21)(1,"mat-list"),e.YNc(2,Rh,2,4,"ng-template",11),e.ALo(3,"async"),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,t.store.view.all$()))}}let yn=(()=>{class n{overlay;elRef;cdRef;mediaService;actionbarMode=wi;collapsed=!1;toggleCollapseAction={id:"actionbar_toggle",icon:"dots-vertical",handler:()=>{this.collapsed=!this.collapsed}};watcher;heightCondition$=new y.X(!1);positionConditionTop$=new y.X(!0);positionConditionLow$=new y.X(!0);store;mode=wi.Dock;withToggleButton=!1;horizontal=!1;color="default";iconColor="default";withTitle=!0;withTooltip=!0;scrollActive=!0;withIcon=!0;icon="dots-horizontal";xPosition="before";yPosition="above";set overlayClass(t){this._overlayClass=t}get overlayClass(){return[this._overlayClass,"igo-actionbar-overlay"].join(" ")}_overlayClass="";isCollapsed=this.collapsed;get withTitleClass(){return this.withTitle}get withIconClass(){return this.withIcon}get horizontalClass(){return this.horizontal}get heightCondition(){const t=this.elRef.nativeElement;return!1===this.scrollActive&&t.clientHeight<t.scrollHeight}get positionConditionTop(){return 0!==this.elRef.nativeElement.scrollTop}get positionConditionLow(){const t=this.elRef.nativeElement;return!(t.scrollTop>=t.scrollHeight-t.clientHeight)}get isDesktop(){return this.mediaService.getMedia()===to.Desktop}constructor(t,o,i,s){this.overlay=t,this.elRef=o,this.cdRef=i,this.mediaService=s}ngOnChanges(t){const o=t.store;o&&o.currentValue!==o.previousValue&&(void 0!==this.watcher&&this.watcher.destroy(),this.watcher=new fn(this.store,this.cdRef))}ngOnDestroy(){this.watcher.destroy()}onTriggerAction(t){t.handler(...t.args||[])}scrollDown(){this.elRef.nativeElement.scrollBy(0,52)}scrollUp(){this.elRef.nativeElement.scrollBy(0,-52)}static \u0275fac=function(o){return new(o||n)(e.Y36(qi.aV),e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-actionbar"]],hostVars:8,hostBindings:function(o,i){2&o&&e.ekj("is-collapsed",i.isCollapsed)("with-title",i.withTitleClass)("with-icon",i.withIconClass)("horizontal",i.horizontalClass)},inputs:{store:"store",mode:"mode",withToggleButton:"withToggleButton",horizontal:"horizontal",color:"color",iconColor:"iconColor",withTitle:"withTitle",withTooltip:"withTooltip",scrollActive:"scrollActive",withIcon:"withIcon",icon:"icon",xPosition:"xPosition",yPosition:"yPosition",overlayClass:"overlayClass"},features:[e.TTD],decls:3,vars:3,consts:[["matListItemIcon","",4,"ngIf"],[4,"ngIf"],["class","context-menu-card mat-elevation-z4",4,"ngIf"],["matListItemIcon",""],["id","topChevron",4,"ngIf"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger",4,"ngIf"],["id","lowChevron",4,"ngIf"],["id","topChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger"],["ngFor","",3,"ngForOf"],["buttonContent",""],["color","accent",3,"withTitle","withIcon","withTooltip","color","disabled","action","trigger"],["id","lowChevron"],["svgIcon","chevron-down"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"buttonOverlay",3,"matTooltip","matMenuTriggerFor","disabled","color"],[3,"svgIcon"],["overlapTrigger","true",1,"igo-compact-menu","igo-no-min-width-menu",3,"xPosition","yPosition"],["actionbarMenu","matMenu"],["color","accent",3,"withTitle","withIcon","color","action","trigger"],[1,"context-menu-card","mat-elevation-z4"]],template:function(o,i){1&o&&(e.YNc(0,$h,5,4,"mat-list",0),e.YNc(1,Eh,9,14,"div",1),e.YNc(2,Nh,4,3,"mat-card",2)),2&o&&(e.Q6J("ngIf",i.mode===i.actionbarMode.Dock),e.xp6(1),e.Q6J("ngIf",i.mode===i.actionbarMode.Overlay),e.xp6(1),e.Q6J("ngIf",i.mode===i.actionbarMode.Context))},dependencies:[f.sg,f.O5,S.RK,w.Hw,P.gM,Be.VK,Be.p6,Z.i$,Z.Yt,Et.a8,Lh,f.Ov,O.X$],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}.horizontal[_nghost-%COMP%]{max-width:100%;overflow:unset}.horizontal[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{width:auto;white-space:nowrap}.horizontal[_nghost-%COMP%]   igo-actionbar-item[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .buttonOverlay[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .context-menu-card[_ngcontent-%COMP%]{padding:8px 3px;margin:10px}[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:3}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}@supports (-ms-accelerator: true){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}[_nghost-%COMP%]   #lowChevron[_ngcontent-%COMP%]{position:fixed;position:sticky;bottom:0;background-color:#fff;z-index:3}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]{min-width:inherit!important;padding-top:0;padding-bottom:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]:not(:empty){padding-top:0;padding-bottom:0}[_nghost-%COMP%]     .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}"],changeDetection:0})}return n})(),Bh=(()=>{class n{touchTimeout;touchDuration=400;onlyIOS=!0;longpress=new e.vpe;constructor(){}touchstart(t){t.touches.length>1?this.touchEnd():this.touchTimeout=setTimeout(()=>{this.onlyIOS?"iOS"===mi.getOSName()&&this.longpress.emit(t):this.longpress.emit(t)},this.touchDuration)}touchend(){this.touchEnd()}touchEnd(){clearTimeout(this.touchTimeout)}static \u0275fac=function(o){return new(o||n)};static \u0275dir=e.lG2({type:n,selectors:[["","igoLongPress",""]],hostBindings:function(o,i){1&o&&e.NdJ("touchstart",function(a){return i.touchstart(a)})("touchmove",function(){return i.touchend()})("touchcancel",function(){return i.touchend()})("touchend",function(){return i.touchend()})},inputs:{touchDuration:"touchDuration",onlyIOS:"onlyIOS"},outputs:{longpress:"longpress"}})}return n})();const Jh=["target"];function Uh(n,r){}let _r=(()=>{class n{dynamicComponentService;cdRef;component;inputs={};subscribers={};dynamicComponent;target;constructor(t,o){this.dynamicComponentService=t,this.cdRef=o}ngOnChanges(t){const o=t.component,i=t.inputs,s=t.subscribers,a=R.objectsAreEquivalent;if(o&&o.currentValue){if(o.currentValue!==o.previousValue)this.createComponent(o.currentValue);else{const l=i&&a(i.currentValue||{},i.previousValue||{}),c=s&&a(s.currentValue||{},s.previousValue||{});!1===l&&this.updateInputs(),!1===c&&this.updateSubscribers()}this.cdRef.detectChanges()}}ngOnDestroy(){this.dynamicComponent&&this.dynamicComponent.destroy()}createComponent(t){void 0!==this.dynamicComponent&&this.dynamicComponent.destroy(),this.dynamicComponent=t instanceof _c?t:this.dynamicComponentService.create(t),this.renderComponent()}renderComponent(){this.updateInputs(),this.updateSubscribers(),this.dynamicComponent.setTarget(this.target)}updateInputs(){this.dynamicComponent.updateInputs(this.inputs)}updateSubscribers(){this.dynamicComponent.updateSubscribers(this.subscribers)}static \u0275fac=function(o){return new(o||n)(e.Y36(ks),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-dynamic-outlet"]],viewQuery:function(o,i){if(1&o&&e.Gf(Jh,7,e.s_b),2&o){let s;e.iGM(s=e.CRH())&&(i.target=s.first)}},inputs:{component:"component",inputs:"inputs",subscribers:"subscribers"},features:[e.TTD],decls:2,vars:0,consts:[["target",""]],template:function(o,i){1&o&&e.YNc(0,Uh,0,0,"ng-template",null,0,e.W1O)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0})}return n})();function yr(n){return r=>{Es.register(n,r)}}function br(n){if(n.validator){const r=n.validator({});if(r&&r.required)return!0}return!!n.controls&&void 0!==Object.keys(n.controls).find(t=>br(n.controls[t]))}function vr(n,r){const i=Object.keys(n.errors||{}).map(s=>r[s]).filter(s=>void 0!==s);return i.length>0?i[0]:""}function qh(n,r){if(1&n&&(e.ynx(0),e._UZ(1,"igo-dynamic-outlet",1),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("component",t.getFieldComponent())("inputs",t.getFieldInputs())("subscribers",t.getFieldSubscribers())}}let jh=(()=>{class n{formFieldService;field;fieldInputs=void 0;fieldSubscribers=void 0;get fieldOptions(){return this.field.options||{}}constructor(t){this.formFieldService=t}getFieldComponent(){return this.formFieldService.getFieldByType(this.field.type||"text")}getFieldInputs(){if(void 0!==this.fieldInputs)return this.fieldInputs;const t=this.fieldOptions.errors||{};return this.fieldInputs=Object.assign({placeholder:this.field.title,disableSwitch:this.fieldOptions.disableSwitch||!1},Object.assign({},this.field.inputs||{}),{formControl:this.field.control,errors:Object.assign({},{required:"igo.common.form.errors.required"},t)}),this.fieldInputs}getFieldSubscribers(){return void 0!==this.fieldSubscribers||(this.fieldSubscribers=Object.assign({},this.field.subscribers||{})),this.fieldSubscribers}static \u0275fac=function(o){return new(o||n)(e.Y36(Es))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-form-field"]],inputs:{field:"field"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(o,i){1&o&&e.YNc(0,qh,2,3,"ng-container",0),2&o&&e.Q6J("ngIf",void 0!==i.field)},dependencies:[f.O5,_r],styles:["mat-form-field{width:100%}  .igo-form-disable-switch{margin-right:8px}"],changeDetection:0})}return n})();function Qh(n,r){if(1&n&&(e.TgZ(0,"div",5),e._UZ(1,"igo-form-field",6),e.qZA()),2&n){const t=r.$implicit,o=e.oxw(2);e.Q6J("ngClass",o.getFieldNgClass(t)),e.xp6(1),e.Q6J("field",t)}}function Yh(n,r){if(1&n&&(e.TgZ(0,"div",3),e.YNc(1,Qh,2,2,"div",4),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.group.fields)}}function Hh(n,r){if(1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.getErrorMessage()))}}const Vh=["*"];let Zc=(()=>{class n{group;errors;get formControl(){return this.group.control}constructor(){}getFieldColSpan(t){let o=2;const i=t.options||{};return i.cols&&i.cols>0&&(o=Math.min(i.cols,2)),o}getFieldNgClass(t){return{[`igo-form-field-colspan-${this.getFieldColSpan(t)}`]:!0}}getErrorMessage(){return vr(this.formControl,(this.group.options||{}).errors||{})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-form-group"]],inputs:{group:"group",errors:"errors"},ngContentSelectors:Vh,decls:4,vars:2,consts:[["class","igo-form-group-fields",4,"ngIf"],[1,"igo-form-group-extra-content"],[4,"ngIf"],[1,"igo-form-group-fields"],["class","igo-form-field-wrapper",3,"ngClass",4,"ngFor","ngForOf"],[1,"igo-form-field-wrapper",3,"ngClass"],[3,"field"]],template:function(o,i){1&o&&(e.F$t(),e.YNc(0,Yh,2,1,"div",0),e.TgZ(1,"div",1),e.Hsn(2),e.qZA(),e.YNc(3,Hh,3,3,"mat-error",2)),2&o&&(e.Q6J("ngIf",i.group&&i.group.fields.length>0),e.xp6(3),e.Q6J("ngIf",i.formControl.errors))},dependencies:[f.mk,f.sg,f.O5,F.TO,jh,O.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:auto;padding:10px 5px;box-sizing:border-box}[_nghost-%COMP%]   .igo-form-field-colspan-2[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-field-colspan-1[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return n})();function zh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-icon",3),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onDisableSwitchClick())}),e.ALo(1,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("svgIcon",!0===e.lcZ(1,1,t.disabled$)?"checkbox-blank-outline":"checkbox-marked-outline")}}function Kh(n,r){if(1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.getErrorMessage()))}}let Pc=class Sl{disabled$=new y.X(!1);formControl;placeholder;errors;disableSwitch=!1;get required(){return br(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return vr(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const r=!this.disabled$.value;!0===r?this.formControl.disable():this.formControl.enable(),this.disabled$.next(r)}static \u0275fac=function(t){return new(t||Sl)};static \u0275cmp=e.Xpm({type:Sl,selectors:[["igo-form-field-text"]],inputs:{formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},decls:4,vars:5,consts:[["matInput","",3,"required","placeholder","formControl"],["class","igo-form-disable-switch","matPrefix","",3,"svgIcon","click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"svgIcon","click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-form-field"),e._UZ(1,"input",0),e.YNc(2,zh,2,3,"mat-icon",1),e.YNc(3,Kh,3,3,"mat-error",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("required",o.required)("placeholder",o.placeholder)("formControl",o.formControl),e.xp6(1),e.Q6J("ngIf",!0===o.disableSwitch),e.xp6(1),e.Q6J("ngIf",o.formControl.errors))},dependencies:[f.O5,_.Fj,_.JJ,_.Q7,_.oH,w.Hw,F.KE,F.TO,F.qo,j.Nt,f.Ov,O.X$],encapsulation:2,changeDetection:0})};function Wh(n,r){if(1&n&&(e.TgZ(0,"mat-option",4),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.title," ")}}function Xh(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-icon",5),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onDisableSwitchClick())}),e.ALo(1,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("svgIcon",!0===e.lcZ(1,1,t.disabled$)?"checkbox-blank-outline":"checkbox-marked-outline")}}function ef(n,r){if(1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.getErrorMessage()))}}Pc=(0,T.gn)([yr("text")],Pc);let kc=class wl{disabled$=new y.X(!1);set choices(r){this.choices$.next(r)}get choices(){return this.choices$.value}choices$=new y.X([]);formControl;placeholder;errors;disableSwitch=!1;get required(){return br(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return vr(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const r=!this.disabled$.value;!0===r?this.formControl.disable():this.formControl.enable(),this.disabled$.next(r)}static \u0275fac=function(t){return new(t||wl)};static \u0275cmp=e.Xpm({type:wl,selectors:[["igo-form-field-select"]],inputs:{choices:"choices",formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},decls:6,vars:8,consts:[[3,"required","placeholder","formControl"],[3,"value",4,"ngFor","ngForOf"],["class","igo-form-disable-switch","matPrefix","",3,"svgIcon","click",4,"ngIf"],[4,"ngIf"],[3,"value"],["matPrefix","",1,"igo-form-disable-switch",3,"svgIcon","click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-form-field")(1,"mat-select",0),e.YNc(2,Wh,2,2,"mat-option",1),e.ALo(3,"async"),e.qZA(),e.YNc(4,Xh,2,3,"mat-icon",2),e.YNc(5,ef,3,3,"mat-error",3),e.qZA()),2&t&&(e.xp6(1),e.Q6J("required",o.required)("placeholder",o.placeholder)("formControl",o.formControl),e.xp6(1),e.Q6J("ngForOf",e.lcZ(3,6,o.choices$)),e.xp6(2),e.Q6J("ngIf",!0===o.disableSwitch),e.xp6(1),e.Q6J("ngIf",o.formControl.errors))},dependencies:[f.sg,f.O5,_.JJ,_.Q7,_.oH,w.Hw,F.KE,F.TO,F.qo,se.gD,le.ey,f.Ov,O.X$],encapsulation:2,changeDetection:0})};function tf(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-icon",3),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onDisableSwitchClick())}),e.ALo(1,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("svgIcon",!0===e.lcZ(1,1,t.disabled$)?"checkbox-blank-outline":"checkbox-marked-outline")}}function nf(n,r){if(1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.getErrorMessage()))}}kc=(0,T.gn)([yr("select")],kc);let $c=class Tl{disabled$=new y.X(!1);formControl;placeholder;errors;disableSwitch=!1;get required(){return br(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return vr(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const r=!this.disabled$.value;!0===r?this.formControl.disable():this.formControl.enable(),this.disabled$.next(r)}static \u0275fac=function(t){return new(t||Tl)};static \u0275cmp=e.Xpm({type:Tl,selectors:[["igo-form-field-textarea"]],inputs:{formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},decls:5,vars:5,consts:[["matInput","",3,"required","placeholder","formControl"],["class","igo-form-disable-switch","matPrefix","",3,"svgIcon","click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"svgIcon","click"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-form-field")(1,"textarea",0),e._uU(2,"  "),e.qZA(),e.YNc(3,tf,2,3,"mat-icon",1),e.YNc(4,nf,3,3,"mat-error",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("required",o.required)("placeholder",o.placeholder)("formControl",o.formControl),e.xp6(2),e.Q6J("ngIf",!0===o.disableSwitch),e.xp6(1),e.Q6J("ngIf",o.formControl.errors))},dependencies:[f.O5,_.Fj,_.JJ,_.Q7,_.oH,w.Hw,F.KE,F.TO,F.qo,j.Nt,f.Ov,O.X$],encapsulation:2,changeDetection:0})};$c=(0,T.gn)([yr("textarea")],$c);const rf=["buttons"],sf=["*",[["","formButtons",""]]],af=function(n){return{"igo-form-body-with-buttons":n}},lf=["*","[formButtons]"];let Dc=(()=>{class n{form;formData;autocomplete="off";submitForm=new e.vpe;buttons;get hasButtons(){return 0!==this.buttons.nativeElement.children.length}constructor(){}ngOnChanges(t){const o=t.formData;o&&o.currentValue!==o.previousValue&&(void 0===o.currentValue?this.clear():this.setData(o.currentValue))}onSubmit(){this.submitForm.emit(this.getData())}getData(){const t={};return function Ic(n){return n.groups.reduce((r,t)=>r.concat(t.fields),[].concat(n.fields))}(this.form).forEach(o=>{this.updateDataWithFormField(t,o)}),t}setData(t){this.form.fields.forEach(o=>{o.control.setValue((0,js.t)(t,o.name).safeObject)}),this.form.groups.forEach(o=>{o.fields.forEach(i=>{i.control.setValue((0,js.t)(t,i.name).safeObject)})})}updateDataWithFormField(t,o){const i=o.control;i.disabled||(t[o.name]=i.value)}clear(){this.form.control.reset()}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-form"]],viewQuery:function(o,i){if(1&o&&e.Gf(rf,7),2&o){let s;e.iGM(s=e.CRH())&&(i.buttons=s.first)}},inputs:{form:"form",formData:"formData",autocomplete:"autocomplete"},outputs:{submitForm:"submitForm"},features:[e.TTD],ngContentSelectors:lf,decls:7,vars:5,consts:[[3,"autocomplete","formGroup","ngSubmit"],[1,"igo-form-body",3,"ngClass"],[1,"igo-form-content"],[1,"igo-form-buttons"],["buttons",""]],template:function(o,i){1&o&&(e.F$t(sf),e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return i.onSubmit()}),e.TgZ(1,"div",1)(2,"div",2),e.Hsn(3),e.qZA(),e.TgZ(4,"div",3,4),e.Hsn(6,1),e.qZA()()()),2&o&&(e.Q6J("autocomplete",i.autocomplete)("formGroup",i.form.control),e.xp6(1),e.Q6J("ngClass",e.VKq(3,af,i.hasButtons)))},dependencies:[f.mk,_._Y,_.JL,_.sg],styles:["[_nghost-%COMP%]{display:block}form[_ngcontent-%COMP%]{width:100%;height:100%}.igo-form-body[_ngcontent-%COMP%], .igo-form-content[_ngcontent-%COMP%]{height:100%}.igo-form-body-with-buttons[_ngcontent-%COMP%]   .igo-form-content[_ngcontent-%COMP%]{height:calc(100% - 56px)}.igo-form-content[_ngcontent-%COMP%]{display:flex}"],changeDetection:0})}return n})();const cf=["flexibleMain"],uf=["*",[["","igoFlexibleFill",""]]],pf=["*","[igoFlexibleFill]"];let Ec=(()=>{class n{el;mediaService;static transitionTime=250;main;get initial(){return this._initial}set initial(t){this._initial=t}_initial="0";get collapsed(){return this._collapsed}set collapsed(t){this._collapsed=t}_collapsed="0";get expanded(){return this._expanded}set expanded(t){this._expanded=t}_expanded="100%";get initialMobile(){return this._initialMobile}set initialMobile(t){this._initialMobile=t}_initialMobile=this.expanded;get collapsedMobile(){return this._collapsedMobile}set collapsedMobile(t){this._collapsedMobile=t}_collapsedMobile=this.collapsed;get expandedMobile(){return this._expandedMobile}set expandedMobile(t){this._expandedMobile=t}_expandedMobile=this.expanded;get direction(){return this._direction}set direction(t){this._direction=t}_direction="column";get state(){return this._state}set state(t){const o={initial:this.initial,collapsed:this.collapsed,expanded:this.expanded};this.mediaService.isMobile()&&Object.assign(o,{initial:this.initialMobile,collapsed:this.collapsedMobile,expanded:this.expandedMobile});const i=o[t];void 0!==i&&(this.setSize(i),setTimeout(()=>{this._state=t},n.transitionTime))}_state="initial";mediaService$$;constructor(t,o){this.el=t,this.mediaService=o}ngOnInit(){this.el.nativeElement.className+=this.direction,this.mediaService$$=this.mediaService.media$.subscribe(t=>this.state=this.state)}ngOnDestroy(){this.mediaService$$&&this.mediaService$$.unsubscribe()}setSize(t){this._state="transition","column"===this.direction?this.main.nativeElement.style.height=t:"row"===this.direction&&(this.main.nativeElement.style.width=t)}static \u0275fac=function(o){return new(o||n)(e.Y36(e.SBq),e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-flexible"]],viewQuery:function(o,i){if(1&o&&e.Gf(cf,7),2&o){let s;e.iGM(s=e.CRH())&&(i.main=s.first)}},inputs:{initial:"initial",collapsed:"collapsed",expanded:"expanded",initialMobile:"initialMobile",collapsedMobile:"collapsedMobile",expandedMobile:"expandedMobile",direction:"direction",state:"state"},ngContentSelectors:pf,decls:8,vars:4,consts:[["flexibleMain",""],[1,"igo-container"],[1,"igo-flexible-fill"]],template:function(o,i){1&o&&(e.F$t(uf),e.TgZ(0,"div",null,0)(2,"div",1),e.Hsn(3),e.qZA()(),e.TgZ(4,"div",2)(5,"div")(6,"div",1),e.Hsn(7,1),e.qZA()()()),2&o&&e.MT6("igo-flexible-main ",i.state," ",i.direction,"")},styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}.column[_nghost-%COMP%]{flex-direction:column}.row[_nghost-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .igo-flexible-main[_ngcontent-%COMP%]{flex:0 0 auto;overflow:hidden}[_nghost-%COMP%]   .igo-flexible-main.column[_ngcontent-%COMP%]{transition:height .25s ease-in}[_nghost-%COMP%]   .igo-flexible-main.row[_ngcontent-%COMP%]{transition:width .25s ease-in}[_nghost-%COMP%]   .igo-flexible-fill[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;inset:0}[_nghost-%COMP%]   .igo-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-flexible-fill{flex:1 1 auto;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-content{height:100%;width:100%;overflow:auto}[_nghost-%COMP%]     igo-panel{height:100%}"]})}return n})();function df(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.startInteractiveTour())}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",4),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",t.getClass())("matTooltip",t.disabledTourButton?e.lcZ(1,3,"igo.common.interactiveTour.disaledTooltipTourToolButton"):e.lcZ(2,5,"igo.common.interactiveTour.tooltipTourToolButton"))("disabled",t.disabledTourButton)}}function gf(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.startInteractiveTour())}),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.ALo(4,"async"),e._UZ(5,"mat-icon",6),e.ALo(6,"translate"),e.ALo(7,"translate"),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",t.getClass())("disabled",t.disabledTourButton),e.xp6(1),e.AsE(" ",e.lcZ(2,5,"igo.common.interactiveTour.buttonTitle")," ",e.lcZ(3,7,e.lcZ(4,9,t.discoverTitleInLocale$))," "),e.xp6(4),e.Q6J("matTooltip",t.disabledTourButton?e.lcZ(6,11,"igo.common.interactiveTour.disaledTooltipTourToolButton"):e.lcZ(7,13,"igo.common.interactiveTour.tooltipTourToolButton"))}}function mf(n,r){if(1&n&&(e.ynx(0),e.YNc(1,df,4,7,"button",1),e.YNc(2,gf,8,15,"ng-template",null,2,e.W1O),e.BQk()),2&n){const t=e.MAs(3),o=e.oxw();e.xp6(1),e.Q6J("ngIf","icon"===o.styleButton)("ngIfElse",t)}}let Rc=(()=>{class n{interactiveTourService;toolService;tourToStart="";styleButton;discoverTitleInLocale$=(0,z.of)("IGO");getClass(){return{"tour-button-tool-icon":"icon"===this.styleButton,"tour-button-tool":"raised"===this.styleButton}}get toolbox(){return this.toolService.toolbox}getTourToStart(){return this.tourToStart?this.tourToStart:this.activeToolName}get activeToolName(){if(this.toolbox)return this.isActiveTool?this.toolbox.activeTool$.getValue().name:"global"}get isActiveTool(){if(this.toolbox)return void 0!==this.toolbox.activeTool$.getValue()}get isToolHaveTour(){return!("about"===this.activeToolName&&!this.tourToStart)&&this.interactiveTourService.isToolHaveTourConfig(this.getTourToStart())}get showTourButton(){let t,o;return t=this.isToolHaveTour,!1!==t&&!(this.interactiveTourService.isMobile()&&(o=this.isTourDisplayInMobile,!1===o))}get isTourDisplayInMobile(){return this.interactiveTourService.isTourDisplayInMobile()}get disabledTourButton(){return this.interactiveTourService.disabledTourButton(this.activeToolName)}constructor(t,o){this.interactiveTourService=t,this.toolService=o}startInteractiveTour(){const t=this.getTourToStart();t&&this.interactiveTourService.startTour(t)}static \u0275fac=function(o){return new(o||n)(e.Y36(Us),e.Y36(Gi))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-interactive-tour"]],inputs:{tourToStart:"tourToStart",styleButton:"styleButton",discoverTitleInLocale$:"discoverTitleInLocale$"},decls:1,vars:1,consts:[[4,"ngIf"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click",4,"ngIf","ngIfElse"],["raisedButton",""],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click"],["iconPositionEnd","","svgIcon","presentation-play"],["color","primary","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click"],["iconPositionEnd","","svgIcon","presentation-play",3,"matTooltip"]],template:function(o,i){1&o&&e.YNc(0,mf,4,2,"ng-container",0),2&o&&e.Q6J("ngIf",i.showTourButton)},dependencies:[f.mk,f.O5,w.Hw,S.lW,S.RK,P.gM,f.Ov,O.X$],styles:["igo-interactive-tour>button.mat-mdc-raised-button.tour-button-tool-icon{box-shadow:none}.shepherd-has-title .shepherd-content .shepherd-header{padding:.5em .75em}.shepherd-title{margin:0!important;font-weight:revert!important}.shepherd-progress{margin-right:15px;color:#737373}.shepherd-text{font-size:14px!important}.shepherd-element{border:1px solid;border-color:#474747;box-shadow:4px 5px #65656599}\n"],encapsulation:2})}return n})();const hf=function(n){return{"igo-spinner-container":!0,"igo-spinner-shown":n}};let Cr=(()=>{class n{shown$=new y.X(!1);set shown(t){this.shown$.next(t)}get shown(){return this.shown$.value}constructor(){}show(){this.shown=!0}hide(){this.shown=!1}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-spinner"]],inputs:{shown:"shown"},decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e._UZ(2,"div",1)(3,"mat-progress-spinner",2),e.qZA()),2&o&&e.Q6J("ngClass",e.VKq(3,hf,e.lcZ(1,1,i.shown$)))},dependencies:[f.mk,Sc.Ou,f.Ov],styles:["[_nghost-%COMP%]   .igo-spinner-container[_ngcontent-%COMP%]{display:none;position:relative;pointer-events:none}[_nghost-%COMP%]   .igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}[_nghost-%COMP%]   .igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}"]})}return n})(),ff=(()=>{class n{spinner;activityService;counter$$;constructor(t,o){this.spinner=t,this.activityService=o}ngOnInit(){this.counter$$=this.activityService.counter$.pipe((0,ae.b)(50)).subscribe(t=>{t>0?this.spinner.show():this.spinner.hide()})}ngOnDestroy(){this.counter$$.unsubscribe()}static \u0275fac=function(o){return new(o||n)(e.Y36(Cr,2),e.Y36(Ni))};static \u0275dir=e.lG2({type:n,selectors:[["","igoSpinnerActivity",""]]})}return n})();var Ks=v(20636),Ws=function(n){return n[n.primary=0]="primary",n[n.accent=1]="accent",n[n.warn=2]="warn",n}(Ws||{}),Xs=v(7835);class Nc extends Ks.o2{_database;_model;_sort;get filter(){return this._filterChange.value}set filter(r){this._filterChange.next(r)}_filterChange=new y.X("");constructor(r,t,o){super(),this._database=r,this._model=t,this._sort=o}connect(){return this._database?(0,Xs.T)(this._database.dataChange,this._filterChange,this._sort.sortChange).pipe((0,I.U)(()=>this.getFilteredData(this._database.data)),(0,I.U)(t=>this.getSortedData(t))):(0,Xs.T)([])}disconnect(){}getFilteredData(r){return this.filter?r.slice().filter(t=>-1!==this._model.columns.filter(i=>i.filterable).map(i=>R.resolve(t,i.name)).join(" ").toLowerCase().indexOf(this.filter.toLowerCase())):r}getSortedData(r){return this._sort.active&&""!==this._sort.direction?r.sort((t,o)=>{const i=R.resolve(t,this._sort.active),s=R.resolve(o,this._sort.active);return R.naturalCompare(s,i,this._sort.direction)}):r}}const _f=["filter"];function yf(n,r){1&n&&(e.TgZ(0,"div",12)(1,"mat-form-field",13),e._UZ(2,"input",14,15),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.Q6J("placeholder",e.lcZ(4,1,"igo.common.table.filter")))}function bf(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"th",16)(1,"mat-checkbox",17),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(i?s.masterToggle():null)}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())}}function vf(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td",18)(1,"mat-checkbox",19),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(i){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(i?l.selection.toggle(a):null)}),e.qZA()()}if(2&n){const t=r.$implicit,o=e.oxw();e.xp6(1),e.Q6J("checked",o.selection.isSelected(t))}}function Cf(n,r){if(1&n&&(e.TgZ(0,"th",25),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function xf(n,r){1&n&&(e.ynx(0),e.YNc(1,Cf,2,1,"th",24),e.BQk())}function Sf(n,r){if(1&n&&(e.TgZ(0,"th",16),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(t.title)}}function wf(n,r){1&n&&(e.ynx(0),e.YNc(1,Sf,2,1,"th",6),e.BQk())}const ea=function(){return{}};function Tf(n,r){if(1&n&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&n){const t=r.$implicit,o=e.oxw(2).$implicit,i=e.oxw();e.Q6J("ngClass",i.model.cellClassFunc?i.model.cellClassFunc(t,o):e.DdM(2,ea)),e.xp6(1),e.hij(" ",i.getValue(t,o.name)," ")}}function Ff(n,r){1&n&&(e.ynx(0),e.YNc(1,Tf,2,3,"td",26),e.BQk())}function Of(n,r){if(1&n&&e._UZ(0,"td",29),2&n){const t=r.$implicit,o=e.oxw(2).$implicit,i=e.oxw();e.Q6J("ngClass",i.model.cellClassFunc?i.model.cellClassFunc(t,o):e.DdM(2,ea))("innerHTML",i.getValue(t,o.name),e.oJD)}}function Af(n,r){1&n&&e.YNc(0,Of,1,3,"td",28)}function Lf(n,r){if(1&n&&(e.ynx(0,20),e.YNc(1,xf,2,0,"ng-container",21),e.YNc(2,wf,2,0,"ng-container",21),e.YNc(3,Ff,2,0,"ng-container",22),e.YNc(4,Af,1,0,"ng-template",null,23,e.W1O),e.BQk()),2&n){const t=r.$implicit,o=e.MAs(5);e.Q6J("matColumnDef",t.name),e.xp6(1),e.Q6J("ngIf",t.sortable),e.xp6(1),e.Q6J("ngIf",!t.sortable),e.xp6(1),e.Q6J("ngIf",!t.html)("ngIfElse",o)}}function Mf(n,r){1&n&&e._UZ(0,"th",16)}function If(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(i){const a=e.CHM(t).$implicit,l=e.oxw().$implicit,c=e.oxw();return e.KtG(c.handleClickAction(i,a,l))}),e._UZ(1,"mat-icon",32),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(2);e.Q6J("color",o.getActionColor(t.color)),e.xp6(1),e.s9C("svgIcon",t.icon)}}function Zf(n,r){if(1&n&&(e.TgZ(0,"td",18),e.YNc(1,If,2,2,"button",30),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.model.actions)}}function Pf(n,r){1&n&&e._UZ(0,"tr",33)}function kf(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"tr",34),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.selection.toggle(s))}),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw();e.Q6J("ngClass",o.model.rowClassFunc?o.model.rowClassFunc(t):e.DdM(1,ea))}}let $f=(()=>{class n{get database(){return this._database}set database(t){this._database=t}_database;get model(){return this._model}set model(t){this._model=t}_model;get hasFilterInput(){return this._hasFIlterInput}set hasFilterInput(t){this._hasFIlterInput=t}_hasFIlterInput=!0;displayedColumns;dataSource;selection=new Ks.Ov(!0,[]);select=new e.vpe;filter;sort;ngOnInit(){this.dataSource=new Nc(this.database,this.model,this.sort),this.model&&(this.displayedColumns=this.model.columns.filter(t=>!1!==t.displayed).map(t=>t.name),this.model.selectionCheckbox&&this.displayedColumns.unshift("selectionCheckbox"),this.model.actions&&this.model.actions.length&&this.displayedColumns.push("action")),this.selection.changed.subscribe(t=>this.select.emit(t))}ngAfterViewInit(){this.filter&&(0,go.R)(this.filter.nativeElement,"keyup").pipe((0,ae.b)(150),(0,fi.x)()).subscribe(()=>{this.dataSource&&(this.dataSource.filter=this.filter.nativeElement.value)})}ngOnChanges(t){t.database&&(this.dataSource=new Nc(this.database,this.model,this.sort),this.selection.clear())}getActionColor(t){return Ws[t]}getValue(t,o){return R.resolve(t,o)}isAllSelected(){return this.selection.selected.length===this.database.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.database.data.forEach(t=>this.selection.select(t))}handleClickAction(t,o,i){t.stopPropagation(),o.click(i)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-table"]],viewQuery:function(o,i){if(1&o&&(e.Gf(_f,5),e.Gf(yi.YE,7)),2&o){let s;e.iGM(s=e.CRH())&&(i.filter=s.first),e.iGM(s=e.CRH())&&(i.sort=s.first)}},inputs:{database:"database",model:"model",hasFilterInput:"hasFilterInput"},outputs:{select:"select"},features:[e.TTD],decls:14,vars:5,consts:[[1,"table-box"],["class","table-header",4,"ngIf"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["table",""],["matColumnDef","selectionCheckbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[1,"table-header"],["floatPlaceholder","never"],["matInput","",3,"placeholder"],["filter",""],["mat-header-cell",""],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","click","change"],[3,"matColumnDef"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["cellHTML",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-mini-fab","",3,"color","click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"color","click"],[3,"svgIcon"],["mat-header-row",""],["mat-row","",3,"ngClass","click"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.YNc(1,yf,5,3,"div",1),e.TgZ(2,"div",2)(3,"table",3,4),e.ynx(5,5),e.YNc(6,bf,2,2,"th",6),e.YNc(7,vf,2,1,"td",7),e.BQk(),e.YNc(8,Lf,6,5,"ng-container",8),e.ynx(9,9),e.YNc(10,Mf,1,0,"th",6),e.YNc(11,Zf,2,1,"td",7),e.BQk(),e.YNc(12,Pf,1,0,"tr",10),e.YNc(13,kf,1,2,"tr",11),e.qZA()()()),2&o&&(e.xp6(1),e.Q6J("ngIf",i.hasFilterInput),e.xp6(2),e.Q6J("dataSource",i.dataSource),e.xp6(5),e.Q6J("ngForOf",i.model.columns),e.xp6(4),e.Q6J("matHeaderRowDef",i.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",i.displayedColumns))},dependencies:[f.mk,f.sg,f.O5,w.Hw,S.nh,ve.BZ,ve.fO,ve.as,ve.w1,ve.Dz,ve.nj,ve.ge,ve.ev,ve.XQ,ve.Gk,F.KE,j.Nt,yi.YE,yi.nU,ze.oG,O.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.table-box[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.table-header[_ngcontent-%COMP%]{min-height:64px;max-width:500px;display:flex;flex:0 1 auto;align-items:baseline;padding:8px 24px 0;font-size:20px;justify-content:space-between}tr[mat-header-row][_ngcontent-%COMP%], tr[mat-row][_ngcontent-%COMP%]{height:60px}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}td[mat-cell][_ngcontent-%COMP%]{padding-right:15px}th.mat-mdc-header-cell[_ngcontent-%COMP%]{padding-right:5px}button[_ngcontent-%COMP%]{margin-right:10px}"]})}return n})();class Df{dataChange=new y.X([]);get data(){return this.dataChange.value}constructor(r){r&&this.dataChange.next(r)}set(r){this.dataChange.next(r)}add(r){const t=this.data.slice();t.push(r),this.set(t)}remove(r){const t=this.data.slice(),o=t.indexOf(r);t.splice(o,1),this.set(t)}}function ke(n){return r=>{Gi.register(Object.assign({},n,{component:r}))}}var xr=function(n){return n.White="white",n.Grey="grey",n.Primary="primary",n}(xr||{}),ye=v(12501);function Ef(n="300ms",r="ease-in-out"){return(0,ye.X$)("toolSlideInOut",[(0,ye.SB)("enter",(0,ye.oB)({transform:"translate3d(0, 0, 0)"})),(0,ye.eR)("void => enter",(0,ye.jt)(n+" "+r))])}function Rf(n,r){if(1&n&&(e._UZ(0,"igo-actionbar",2),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async")),2&n){const t=e.oxw();e.Q6J("store",t.actionStore)("withIcon",!0)("withTitle",e.lcZ(1,6,t.toolbarWithTitle$))("withTooltip",!1===e.lcZ(2,8,t.toolbarWithTitle$))("scrollActive",e.lcZ(3,10,t.toolbarWithTitle$))("horizontal",!1)}}const Nf=function(n,r){return{"igo-tool-container-with-toolbar":n,"igo-tool-container-with-animation":r}};function Bf(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",3),e.NdJ("@toolSlideInOut.start",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onAnimationStart())})("@toolSlideInOut.done",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onAnimationComplete())}),e.ALo(1,"async"),e._UZ(2,"igo-dynamic-outlet",4),e.qZA()}if(2&n){const t=r.ngIf,o=e.oxw();e.Q6J("ngClass",e.WLB(6,Nf,!o.actionStore.empty,o.animate))("@toolSlideInOut",e.lcZ(1,4,o.animation$)),e.xp6(2),e.Q6J("component",t.component)("inputs",o.getToolInputs(t))}}let Jf=(()=>{class n{activeTool$=new y.X(void 0);get isActive(){return!!this.activeTool$.value}actionStore=new Ko([]);animation$=new y.X("none");toolbar$=new y.X([]);toolbarWithTitle$=this.activeTool$.pipe((0,I.U)(t=>void 0===t));activeTool$$;toolbar$$;animating$=new y.X(!1);animating$$;toolbox;animate=!1;color=xr.White;get classColorGrey(){return this.color===xr.Grey}get classColorPrimary(){return this.color===xr.Primary}ngOnInit(){this.toolbar$$=this.toolbox.toolbar$.subscribe(t=>this.onToolbarChange(t)),this.activeTool$$=this.toolbox.activeTool$.subscribe(t=>this.onActiveToolChange(t))}ngOnDestroy(){this.toolbar$$.unsubscribe(),this.activeTool$$.unsubscribe(),this.actionStore.destroy()}onAnimationStart(){this.animating$.next(!0)}onAnimationComplete(){this.animating$.next(!1)}getToolInputs(t){return t.options||{}}onToolbarChange(t){this.setToolbar(t)}onActiveToolChange(t){this.animate?this.onAnimate(()=>this.setActiveTool(t)):this.setActiveTool(t)}setActiveTool(t){if(void 0===t)this.actionStore.state.updateAll({active:!1});else{const o=this.actionStore.get(t.name);void 0!==o&&this.actionStore.state.update(o,{active:!0},!0)}this.activeTool$.next(t),this.animate&&this.animation$.next("enter")}setToolbar(t){const o=t.reduce((i,s)=>{const a=this.toolbox.getTool(s);return void 0===a||i.push({id:a.name,title:a.title,icon:a.icon,tooltip:a.tooltip,args:[a,this.toolbox],handler:(l,c)=>{c.activateTool(l.name)},ngClass:(l,c)=>this.toolbox.activeTool$.pipe((0,I.U)(u=>{let p=!1;void 0!==u&&l.name===u.name&&(p=!0);let d=!1;return void 0!==u&&l.name===u.parent&&(d=!0),{"tool-activated":p,"children-tool-activated":d}}))}),i},[]);this.actionStore.load(o),this.toolbar$.next(t)}onAnimate(t){this.unAnimate(),this.animating$$=this.animating$.subscribe(o=>{o||(t.call(this),this.unAnimate())})}unAnimate(){this.animating$$&&this.animating$$.unsubscribe()}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-toolbox"]],hostVars:4,hostBindings:function(o,i){2&o&&e.ekj("color-grey",i.classColorGrey)("color-primary",i.classColorPrimary)},inputs:{toolbox:"toolbox",animate:"animate",color:"color"},decls:4,vars:6,consts:[[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal",4,"ngIf"],["class","igo-tool-container mat-body-1",3,"ngClass",4,"ngIf"],[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal"],[1,"igo-tool-container","mat-body-1",3,"ngClass"],[3,"component","inputs"]],template:function(o,i){1&o&&(e.YNc(0,Rf,4,12,"igo-actionbar",0),e.ALo(1,"async"),e.YNc(2,Bf,3,9,"div",1),e.ALo(3,"async")),2&o&&(e.Q6J("ngIf",e.lcZ(1,2,i.toolbar$).length>0),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,i.activeTool$)))},dependencies:[f.mk,f.O5,yn,_r,f.Ov],styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden;width:100%;height:100%}[_nghost-%COMP%]     .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin:0}[_nghost-%COMP%]   .igo-tool-container[_ngcontent-%COMP%]{position:absolute;inset:0;margin-bottom:0}[_nghost-%COMP%]   .igo-tool-container-with-animation[_ngcontent-%COMP%]{transform:translate3d(100%,0,0)}[_nghost-%COMP%]   .igo-tool-container-with-toolbar[_ngcontent-%COMP%]{left:50px}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   igo-actionbar.with-title[_ngcontent-%COMP%]{width:100%;overflow:auto}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){width:48px;overflow:hidden;-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){overflow:auto}}[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{overflow:auto}"],data:{animation:[Ef()]},changeDetection:0})}return n})();function Uf(n,r){if(1&n&&e._UZ(0,"igo-dynamic-outlet",1),2&n){const t=e.oxw();e.Q6J("component",t.widget)("inputs",t.inputs)("subscribers",t.getEffectiveSubscribers())}}let Bc=(()=>{class n{baseSubscribers={cancel:t=>this.onCancel(t),complete:t=>this.onComplete(t)};widget;inputs;subscribers={};complete=new e.vpe;cancel=new e.vpe;constructor(){}ngOnDestroy(){this.destroyWidget()}getEffectiveSubscribers(){const t=Object.assign({},this.subscribers);return Object.keys(this.baseSubscribers).forEach(o=>{const i=t[o],s=this.baseSubscribers[o];t[o]=void 0!==i?a=>{i(a),s(a)}:s}),t}onCancel(t){this.cancel.emit(t),this.destroyWidget()}onComplete(t){this.complete.emit(t),this.destroyWidget()}destroyWidget(){void 0!==this.widget&&this.widget.destroy(),this.widget=void 0}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-widget-outlet"]],inputs:{widget:"widget",inputs:"inputs",subscribers:"subscribers"},outputs:{complete:"complete",cancel:"cancel"},decls:1,vars:1,consts:[[3,"component","inputs","subscribers",4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(o,i){1&o&&e.YNc(0,Uf,1,3,"igo-dynamic-outlet",0),2&o&&e.Q6J("ngIf",i.widget)},dependencies:[f.O5,_r],styles:["[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return n})();class Jc extends xt{activeWorkspace$=new y.X(void 0);activateWorkspace(r){const t=this.activeWorkspace$.value;void 0!==t&&t.deactivate(),this.deactivateWorkspace(),void 0!==r&&(this.state.update(r,{active:!0,selected:!0},!0),this.activeWorkspace$.next(r),r.activate())}deactivateWorkspace(){const r=this.activeWorkspace$.value;void 0!==r&&(r.deactivate(),this.activeWorkspace$.next(void 0))}}class ta{options;widget$=new y.X(void 0);widgetInputs$=new y.X({});widgetSubscribers$=new y.X({});entities$$;change=new fe.x;change$;get id(){return this.options.id}get title(){return this.options.title}get meta(){return this.options.meta||{}}get entityStore(){return this.options.entityStore}get actionStore(){return this.options.actionStore}get widget(){return this.widget$.value}get hasWidget(){return void 0!==this.widget}constructor(r){this.options=r}get active(){return this.active$.value}active$=new y.X(!1);activate(){!0===this.active&&this.deactivate(),this.active$.next(!0),void 0!==this.entityStore&&(this.entities$$=this.entityStore.stateView.all$().subscribe(()=>this.onStateChange())),this.change.next()}deactivate(){this.active$.next(!1),this.deactivateWidget(),void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.change$&&this.change$.unsubscribe()}activateWidget(r,t={},o={}){this.widget$.next(r),this.widgetInputs$.next(t),this.widgetSubscribers$.next(o),this.change.next()}deactivateWidget(){this.widget$.next(void 0),this.change.next()}onStateChange(){this.change.next()}}let Uc=(()=>{class n{store;disabled;selectedChange=new e.vpe;getWorkspaceTitle(t){return ho(t)}onSelectedChange(t){const o=t.value;this.store.activateWorkspace(o),this.selectedChange.emit({selected:!0,value:o})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},decls:1,vars:4,consts:[[3,"store","multi","titleAccessor","disabled","selectedChange"]],template:function(o,i){1&o&&(e.TgZ(0,"igo-entity-selector",0),e.NdJ("selectedChange",function(a){return i.onSelectedChange(a)}),e.qZA()),2&o&&e.Q6J("store",i.store)("multi",!1)("titleAccessor",i.getWorkspaceTitle)("disabled",i.disabled)},dependencies:[Tc],styles:["igo-entity-selector[_ngcontent-%COMP%]     mat-form-field .mat-mdc-form-field-infix{padding:0}"],changeDetection:0})}return n})();function Gf(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-widget-outlet",1),e.NdJ("cancel",function(){const s=e.CHM(t).ngIf,a=e.oxw();return e.KtG(a.onWidgetCancel(s))})("complete",function(){const s=e.CHM(t).ngIf,a=e.oxw();return e.KtG(a.onWidgetComplete(s))}),e.ALo(2,"async"),e.ALo(3,"async"),e.qZA(),e.BQk()}if(2&n){const t=r.ngIf,o=e.oxw();e.xp6(1),e.Q6J("widget",t)("inputs",e.lcZ(2,3,o.widgetInputs$))("subscribers",e.lcZ(3,5,o.widgetSubscribers$))}}let qf=(()=>{class n{workspace;deactivateWidget=new e.vpe;get widget$(){return this.workspace.widget$}get widgetInputs$(){return this.workspace.widgetInputs$}get widgetSubscribers$(){return this.workspace.widgetSubscribers$}constructor(){}onWidgetCancel(t){this.workspace.deactivateWidget(),this.deactivateWidget.emit(t)}onWidgetComplete(t){this.workspace.deactivateWidget(),this.deactivateWidget.emit(t)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},decls:2,vars:3,consts:[[4,"ngIf"],[3,"widget","inputs","subscribers","cancel","complete"]],template:function(o,i){1&o&&(e.YNc(0,Gf,4,7,"ng-container",0),e.ALo(1,"async")),2&o&&e.Q6J("ngIf",e.lcZ(1,1,i.widget$))},dependencies:[f.O5,Bc,f.Ov],styles:["igo-widget-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return n})();var Sr=v(39342);function jf(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",4)(1,"color-chrome",5),e.NdJ("onChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.handleChange(i))}),e.qZA(),e.TgZ(2,"div",6)(3,"button",7),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.handleClick(i))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("color",t.colorPicker),e.xp6(3),e.hij(" ",e.lcZ(5,2,"igo.common.confirmDialog.applyBtn")," ")}}let Gc=(()=>{class n{isOpen=!1;set value(t){this._value=this.formatColor(t??"#000"),this.colorPicker=this._value,this.onChange(this.value),this.onTouch(this.value)}get value(){return this._value}_value;outputFormat="rgba";colorPicker;onChange=()=>{};onTouch=()=>{};writeValue(t){this.value=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}handleClick(t){t.preventDefault(),t.stopPropagation(),this.isOpen=!1,this.value=this.colorPicker}handleChange(t){this.colorPicker=this.formatColor(t.color.rgb,"rgba")}formatColor(t,o=this.outputFormat){switch(o){case"hex":t=(0,Sr.Z)(t).toHexString();break;case"rgba":default:t=(0,Sr.Z)(t).toRgbString();break;case"hsla":t=(0,Sr.Z)(t).toHsvString()}return t}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-color-picker-form-field"]],inputs:{outputFormat:"outputFormat"},features:[e._Bn([{provide:_.JU,useExisting:(0,e.Gpc)(()=>n),multi:!0}])],decls:6,vars:7,consts:[["floatLabel","always","tooltip-position","below","matTooltipShowDelay","500","subscriptSizing","dynamic","cdkOverlayOrigin","",1,"fill-field",3,"click"],["trigger","cdkOverlayOrigin"],["type","text","matInput","",3,"readonly"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"picker"],[3,"color","onChange"],[1,"buttons"],["mat-flat-button","","color","primary",3,"click"]],template:function(o,i){if(1&o&&(e.TgZ(0,"mat-form-field",0,1),e.NdJ("click",function(){return i.isOpen=!i.isOpen}),e.TgZ(2,"mat-label"),e._uU(3),e.qZA(),e._UZ(4,"input",2),e.qZA(),e.YNc(5,jf,6,4,"ng-template",3),e.NdJ("backdropClick",function(){return i.isOpen=!1})),2&o){const s=e.MAs(1);e.xp6(3),e.Oqu(i.colorPicker),e.xp6(1),e.Udp("background",i.colorPicker),e.Q6J("readonly",!0),e.xp6(1),e.Q6J("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isOpen)("cdkConnectedOverlayHasBackdrop",!0)}},dependencies:[S.lW,F.KE,F.hX,j.Nt,qi.pI,qi.xu,Mc.KC,O.X$],styles:[".picker[_ngcontent-%COMP%]{left:100%;position:absolute;top:100%;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}.picker[_ngcontent-%COMP%]     .chrome-picker{box-shadow:none}.picker[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{padding:4px 12px 8px;display:flex;justify-content:flex-end}"]})}return n})();const Yf=ee.Bz.forChild([{path:"action",component:(()=>{class n{overlay;mediaService;languageService;store=new Ko([]);added$=new y.X(!1);get actionbarMode(){return this.mediaService.media$.value===to.Desktop&&this.mediaService.orientation$.value===jo.Landscape?wi.Dock:wi.Overlay}constructor(t,o,i){this.overlay=t,this.mediaService=o,this.languageService=i}ngOnInit(){this.store.load([{id:"add",title:"Add",icon:"plus",tooltip:"Add Tooltip",handler:()=>{alert("Add!"),this.added$.next(!0)}},{id:"edit",title:"Edit",icon:"pencil",tooltip:"Edit Tooltip",args:["1"],handler:t=>{alert(`Edit item ${t}!`)},availability:()=>this.added$},{id:"delete",title:"Delete",tooltip:"Delete Tooltip",icon:"delete",handler:()=>{alert("Delete!"),this.added$.next(!1)},availability:()=>this.added$}])}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(o){return new(o||n)(e.Y36(qi.aV),e.Y36(ct),e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-action"]],decls:3,vars:5,consts:[["title","Action","subtitle","Common"],["title","Action Bar","codeFolder","common/action"],[3,"store","withIcon","withTitle","horizontal","mode"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1),e._UZ(2,"igo-actionbar",2),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("store",i.store)("withIcon",!0)("withTitle","overlay"===i.actionbarMode)("horizontal",!0)("mode",i.actionbarMode))},dependencies:[me,de,yn],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let Hf=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,Yf,Is,fc]})}return n})(),oa=(()=>{class n{cdRef;name;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-salutation-component"]],inputs:{name:"name"},decls:2,vars:1,template:function(o,i){1&o&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&o&&(e.xp6(1),e.hij("Hello, my name is ",i.name,"."))},encapsulation:2,changeDetection:0})}return n})(),Vf=(()=>{class n{cdRef;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-explanation-component"]],decls:2,vars:0,template:function(o,i){1&o&&(e.TgZ(0,"p"),e._uU(1,"I am a dynamic component, rendered into an IgoDynamicOutlet."),e.qZA())},encapsulation:2,changeDetection:0})}return n})();const Kf=ee.Bz.forChild([{path:"dynamic-component",component:(()=>{class n{component=oa;inputs={name:"Bob"};toggleComponent(){this.component=this.component===oa?Vf:oa}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-dynamic-component"]],decls:5,vars:2,consts:[["title","Dynamic Component","subtitle","Common"],["codeFolder","common/dynamic-component"],[3,"component","inputs"],["mat-flat-button","","color","primary",3,"click"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1),e._UZ(2,"igo-dynamic-outlet",2),e.TgZ(3,"button",3),e.NdJ("click",function(){return i.toggleComponent()}),e._uU(4," Toggle Component "),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("component",i.component)("inputs",i.inputs))},dependencies:[me,de,S.lW,_r],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let Wf=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,Kf,$s]})}return n})();function Xf(n,r){if(1&n&&(e.TgZ(0,"div")(1,"p"),e._uU(2),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"p"),e._uU(6,"Description: "),e._UZ(7,"span",4),e.qZA()()),2&n){const t=r.ngIf;e.xp6(2),e.hij("ID: ",t.id,""),e.xp6(2),e.hij("Name: ",t.name,""),e.xp6(3),e.Q6J("innerHtml",t.description,e.oJD)}}const t_=ee.Bz.forChild([{path:"entity-selector",component:(()=>{class n{languageService;store=new xt([]);selected$=new y.X(void 0);constructor(t){this.languageService=t}ngOnInit(){this.store.load([{id:"2",name:"Name 2",description:"<b>Description 2</b>"},{id:"1",name:"Name 1",description:"<b>Description 1</b>"},{id:"3",name:"Name 3",description:"<b>Description 3</b>"}])}ngOnDestroy(){this.store.destroy()}getTitle(t){return t.name}onSelectedChange(t){this.selected$.next(t.entity)}static \u0275fac=function(o){return new(o||n)(e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-entity-selector"]],decls:5,vars:7,consts:[["title","Entity Selector","subtitle","Common"],["codeFolder","common/entity-selector"],[3,"store","titleAccessor","emptyText","placeholder","selectedChange"],[4,"ngIf"],[3,"innerHtml"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-selector",2),e.NdJ("selectedChange",function(a){return i.onSelectedChange(a)}),e.qZA(),e.YNc(3,Xf,8,3,"div",3),e.ALo(4,"async"),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("store",i.store)("titleAccessor",i.getTitle)("emptyText","")("placeholder","Select an entity"),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,5,i.selected$)))},dependencies:[f.O5,me,de,Tc,f.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let o_=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,t_,Ns]})}return n})();const n_=ee.Bz.forChild([{path:"entity-table",component:(()=>{class n{languageService;store=new xt([]);paginator;entitySortChange$=new y.X(!1);paginatorOptions={pageSize:10};template={selection:!0,selectionCheckbox:!0,selectMany:!0,sort:!0,valueAccessor:(t,o)=>vi(t,o),columns:[{name:"selected",title:"Selected",valueAccessor:t=>this.store.state.get(t).selected?"radiobox-marked":"radiobox-blank",renderer:wt.Icon},{name:"id",title:"ID"},{name:"name",title:"Name"},{name:"description",title:"Description",renderer:wt.HTML},{name:"url",title:"Hyperlink"},{name:"image",title:"Image"},{name:"action",title:"",valueAccessor:t=>[{icon:"home",color:"warn",click:o=>{console.log(o)}}],renderer:wt.ButtonGroup}]};constructor(t){this.languageService=t}ngOnInit(){const o=[2,1,3,4,5,6,7,8,9,10,11,12,13].map(i=>3===i?{id:i,name:`Name ${i}`,description:`<b>Description ${i}</b>`,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png"}:{id:i,name:`Name ${i}`,description:`<b>Description ${i}</b>`,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/Igo_logoavec.png"});this.store.load(o)}entitySortChange(){this.entitySortChange$.next(!0)}paginatorChange(t){this.paginator=t}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(o){return new(o||n)(e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-entity-table"]],decls:3,vars:4,consts:[["title","Entity Table","subtitle","Common"],["codeFolder","common/entity-table"],[3,"store","withPaginator","paginatorOptions","template","entitySortChange"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-table",2),e.NdJ("entitySortChange",function(){return i.entitySortChange()}),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("store",i.store)("withPaginator",!0)("paginatorOptions",i.paginatorOptions)("template",i.template))},dependencies:[me,de,Si],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let r_=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[n_,pe,gn,Bs]})}return n})();function s_(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-form",3),e.NdJ("submitForm",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onSubmit(i))}),e.ALo(1,"async"),e._UZ(2,"igo-form-group",4),e.TgZ(3,"div",5)(4,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.fillForm())}),e._uU(5," Fill Form "),e.qZA(),e.TgZ(6,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.clearForm())}),e._uU(7," Clear Form "),e.qZA(),e.TgZ(8,"button",7),e._uU(9," Submit "),e.qZA()()()}if(2&n){const t=r.ngIf,o=e.oxw();e.Q6J("form",t)("formData",e.lcZ(1,4,o.data$)),e.xp6(2),e.Q6J("group",t.groups[0]),e.xp6(6),e.Q6J("disabled",o.submitDisabled)}}const l_=ee.Bz.forChild([{path:"form",component:(()=>{class n{formService;languageService;form$=new y.X(void 0);data$=new y.X(void 0);submitDisabled=!0;valueChanges$$;constructor(t,o){this.formService=t,this.languageService=o}ngOnInit(){const o=[{name:"id",title:"ID",options:{cols:1,validator:_.kI.required}},{name:"name",title:"Name",options:{cols:1,validator:_.kI.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}].map(s=>this.formService.field(s)),i=this.formService.form([],[this.formService.group({name:"info"},o)]);this.valueChanges$$=i.control.valueChanges.subscribe(()=>{this.submitDisabled=!i.control.valid}),this.form$.next(i)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({id:1,name:"Bob",status:2})}clearForm(){this.form$.value.control.reset()}onSubmit(t){alert(JSON.stringify(t))}static \u0275fac=function(o){return new(o||n)(e.Y36(Rs),e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-form"]],decls:4,vars:3,consts:[["title","Form","subtitle","Common"],["codeFolder","common/form"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1),e.YNc(2,s_,10,6,"igo-form",2),e.ALo(3,"async"),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("ngIf",e.lcZ(3,1,i.form$)))},dependencies:[f.O5,me,de,S.lW,Dc,Zc,f.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{max-width:500px}"]})}return n})()}]);let c_=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,l_,dn]})}return n})();const p_=ee.Bz.forChild([{path:"table",component:(()=>{class n{languageService;database;model={columns:[{name:"id",title:"ID",sortable:!1,filterable:!0},{name:"name",title:"Name",sortable:!0,filterable:!0},{name:"description",title:"Description",sortable:!0,filterable:!0}],actions:[{icon:"file-document",color:Ws.primary,click:t=>this.showName(t.name)}],selectionCheckbox:!0};constructor(t){this.languageService=t}ngOnInit(){this.database=new Df([{id:"2",name:"Name 2",description:"Hello 2"},{id:"1",name:"Name 1",description:"Bonjour 1"},{id:"3",name:"Name 3",description:"Hola 3"}])}showName(t){alert(t)}handleSelect(t){console.log(t)}static \u0275fac=function(o){return new(o||n)(e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-table"]],decls:3,vars:3,consts:[["title","Table","subtitle","Common"],["codeFolder","common/table"],[3,"database","model","hasFilterInput","select"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-table",2),e.NdJ("select",function(a){return i.handleSelect(a)}),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("database",i.database)("model",i.model)("hasFilterInput",!0))},dependencies:[me,de,$f],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let d_=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,p_,am]})}return n})();const g_=function(n){return{"igo-cursor-pointer":n}};function m_(n,r){if(1&n&&(e.TgZ(0,"div",2)(1,"div",3),e.Hsn(2,1),e.qZA(),e.TgZ(3,"h3",4),e._uU(4),e.Hsn(5,2),e.qZA(),e.TgZ(6,"div",5),e.Hsn(7,3),e.qZA()()),2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(2,g_,!0===t.cursorPointer)),e.xp6(4),e.hij(" ",t.title," ")}}const h_=["*",[["","panelLeftButton",""]],[["","panelHeader",""]],[["","panelRightButton",""]]],f_=["*","[panelLeftButton]","[panelHeader]","[panelRightButton]"];let Ht=(()=>{class n{title;get withHeader(){return this._withHeader}set withHeader(t){this._withHeader=t}_withHeader=!0;cursorPointer=!1;static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-panel"]],hostVars:2,hostBindings:function(o,i){2&o&&e.ekj("igo-panel-with-header",i.withHeader)},inputs:{title:"title",withHeader:"withHeader",cursorPointer:"cursorPointer"},ngContentSelectors:f_,decls:3,vars:1,consts:[["class","igo-panel-header","title","",3,"ngClass",4,"ngIf"],["title","",1,"igo-panel-content"],["title","",1,"igo-panel-header",3,"ngClass"],[1,"panel-left"],[1,"igo-panel-title"],[1,"panel-right"]],template:function(o,i){1&o&&(e.F$t(h_),e.YNc(0,m_,8,4,"div",0),e.TgZ(1,"div",1),e.Hsn(2),e.qZA()),2&o&&e.Q6J("ngIf",i.withHeader)},dependencies:[f.mk,f.O5],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   igo-interactive-tour[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .igo-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:48px;text-align:center}[_nghost-%COMP%]   .igo-panel-title[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin:0;font-weight:600;flex:1}[_nghost-%COMP%]   .igo-panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}[_nghost-%COMP%]   .igo-cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .panel-left[_ngcontent-%COMP%], [_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]{display:flex;min-width:40px}[_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]:not(:empty){padding-right:4px}"],changeDetection:0})}return n})();function __(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toolbox.activatePreviousTool())}),e._UZ(1,"mat-icon",8),e.qZA()}}function y_(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toolbox.deactivateTool())}),e._UZ(1,"mat-icon",10),e.qZA()}}let qc=class Fl{cdRef;name;constructor(r){this.cdRef=r}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(t){return new(t||Fl)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:Fl,selectors:[["app-salutation-tool"]],inputs:{name:"name"},decls:2,vars:1,template:function(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&t&&(e.xp6(1),e.hij("Hello, my name is ",o.name,"."))},encapsulation:2,changeDetection:0})};qc=(0,T.gn)([ke({name:"demo-salutation",title:"Salutation",icon:"account",options:{name:"Jack"}}),(0,T.w6)("design:paramtypes",[e.sBO])],qc);let jc=class Ol{static \u0275fac=function(t){return new(t||Ol)};static \u0275cmp=e.Xpm({type:Ol,selectors:[["app-about-tool"]],decls:2,vars:0,template:function(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"I'm a tool inside a toolbox."),e.qZA())},encapsulation:2,changeDetection:0})};jc=(0,T.gn)([ke({name:"demo-about",title:"About",icon:"information"})],jc);const v_=ee.Bz.forChild([{path:"tool",component:(()=>{class n{toolService;languageService;toolbox=new Ac;get activeTool$(){return this.toolbox.activeTool$}get panelTitle(){return this.activeTool$.value?this.activeTool$.value.title:"Toolbox"}constructor(t,o){this.toolService=t,this.languageService=o}ngOnInit(){this.toolbox.setToolbar(["demo-salutation","demo-about"]),this.toolbox.setTools(this.toolService.getTools())}ngOnDestroy(){this.toolbox.destroy()}activateSalutationTool(){this.toolbox.activateTool("demo-salutation",{name:"Bob"})}static \u0275fac=function(o){return new(o||n)(e.Y36(Gi),e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-tool"]],decls:10,vars:9,consts:[["title","Tool","subtitle","Common"],["codeFolder","common/tool"],[3,"title"],["mat-icon-button","","panelLeftButton","",3,"click",4,"ngIf"],["mat-icon-button","","panelRightButton","",3,"click",4,"ngIf"],["color","primary",3,"toolbox","animate"],["mat-flat-button","","type","button","color","primary",3,"click"],["mat-icon-button","","panelLeftButton","",3,"click"],["svgIcon","arrow-back"],["mat-icon-button","","panelRightButton","",3,"click"],["svgIcon","menu"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-panel",2),e.YNc(3,__,2,0,"button",3),e.ALo(4,"async"),e.YNc(5,y_,2,0,"button",4),e.ALo(6,"async"),e._UZ(7,"igo-toolbox",5),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return i.activateSalutationTool()}),e._uU(9," Activate Salutation Tool "),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("title",i.panelTitle),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,5,i.activeTool$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,7,i.activeTool$)),e.xp6(2),e.Q6J("toolbox",i.toolbox)("animate",!0))},dependencies:[f.O5,me,de,S.lW,S.RK,w.Hw,Ht,Jf,f.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let C_=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,v_,re,It,yh.forRoot()]})}return n})(),x_=(()=>{class n{cdRef;name;complete=new e.vpe;cancel=new e.vpe;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-salutation-widget"]],inputs:{name:"name"},outputs:{complete:"complete",cancel:"cancel"},decls:6,vars:1,consts:[["mat-flat-button","",3,"click"]],template:function(o,i){1&o&&(e.TgZ(0,"p"),e._uU(1),e.qZA(),e.TgZ(2,"button",0),e.NdJ("click",function(){return i.complete.emit(i.name)}),e._uU(3," Nice to meet you "),e.qZA(),e.TgZ(4,"button",0),e.NdJ("click",function(){return i.cancel.emit(i.name)}),e._uU(5,"Dismiss"),e.qZA()),2&o&&(e.xp6(1),e.hij("Hello, my name is ",i.name,"."))},dependencies:[S.lW],encapsulation:2,changeDetection:0})}return n})();const w_=ee.Bz.forChild([{path:"widget",component:(()=>{class n{widgetService;widget;inputs={name:"Bob"};constructor(t){this.widgetService=t,this.widget=this.widgetService.create(x_)}onWidgetComplete(t){alert(`${t} emitted event 'complete' then got automatically destroyed.`)}onWidgetCancel(){alert("Widget emitted event 'cancel' then got automatically destroyed.")}static \u0275fac=function(o){return new(o||n)(e.Y36(Hs))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-widget"]],decls:3,vars:2,consts:[["title","Widget","subtitle","Common"],["codeFolder","common/widget"],[3,"widget","inputs","complete","cancel"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-widget-outlet",2),e.NdJ("complete",function(a){return i.onWidgetComplete(a)})("cancel",function(){return i.onWidgetCancel()}),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("widget",i.widget)("inputs",i.inputs))},dependencies:[me,de,Bc],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return n})()}]);let T_=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,w_,S.ot,Et.QW,Lc]})}return n})();var Ue=v(10727),ht=v(60989);let Qc=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[_.u5,_.UX,f.ez,S.ot,Ue.vV,Ve.t,ht.Nh,se.LD,le.Ng,F.lN,j.c,ze.p9,re,Gs,P.AV]})}return n})();var nt=v(92106),bn=v(16290);let F_=(()=>{class n{http;config;baseUrl;constructor(t,o){this.http=t,this.config=o,this.baseUrl=this.config.getConfig("context.url")}get(){return this.baseUrl?this.http.get(this.baseUrl+"/pois"):bn.E}delete(t){return this.http.delete(this.baseUrl+"/pois/"+t)}create(t){return this.http.post(this.baseUrl+"/pois",t)}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})(),Yc=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[F_],imports:[f.ez,_.u5,Ms,hc,re,pr,S.ot,B.Is,Ve.t,F.lN,w.Ps,j.c,le.Ng,se.LD,P.AV]})}return n})();var tt=v(59293),fo=v(70549),Ze=v(52148),J=v(41832),O_=v(23258),Ti=v(16977),q=v(12089),U=v(9527),St=v(45536),Fi=v(3587),Te=v(56294),A_=v(86154),Q=v(73462);function Hc(n,r,t={}){let o,i,s,a,l,c,u,p,d,g,h,m,b,C,x,A,M,k,H,G;const Oe=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),V="([-+])?([\\d]{1,3})([,.](\\d+))?",he=`${V}[\\s,]+${V}`,et=new RegExp(`^${he}$`,"g"),Re="([0-9]{1,2})[:|\xb0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|\u2033|\u201d]?\\s*",jt=`${Re}([N|S|E|W|O]),?\\s*${Re}([N|S|E|W|O])`,Jo=new RegExp(`^${jt}$`,"gi"),pi="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Xt=new RegExp(`^${pi}`,"gi"),Ot="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",eo=new RegExp(`^${Ot}`,"gi"),kt="([-+])?(\\d{1,3})[,.](\\d+)",uo=`${kt}\\s*[,]?\\s*${kt}`,Io=new RegExp(`^${uo}`,"g"),W="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",_s=`${W}\\s*[,.]?\\s*${W}`,xl=new RegExp(`^${_s}`,"g"),Zo="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",JL=new RegExp(`^${Zo}?`,"gi"),Yd="([-+]?\\d+)[,.]?(\\d+)?",Hd=`${Yd}[\\s,]+${Yd}`,UL=new RegExp(`^${Hd}$`,"g");let ys=!1;if(n=n.toLocaleUpperCase().trim(),Oe.test(n)?[i,G]=n.split(";").map(di=>di.trim()):i=n,et.test(i))[,s,k,,p,d,H,,C]=i.match(he),k=parseFloat((s||"")+k+"."+p),H=parseFloat((d||"")+H+"."+C);else if(Jo.test(i))[,a,l,c,u,g,h,m,b]=i.match(jt),("S"===u||"N"===u)&&(a=[g,g=a][0],l=[h,h=l][0],c=[m,m=c][0],u=[b,b=u][0]),k=Wo(parseFloat(a),parseFloat(l),parseFloat(c),u),H=Wo(parseFloat(g),parseFloat(h),parseFloat(m),b);else if(Xt.test(i)){ys=!0,[,,x,k,H]=i.match(pi);const di=Number(x)<10?`EPSG:3260${x}`:`EPSG:326${x}`;[k,H]=Q.vs([parseFloat(k),parseFloat(H)],di,"EPSG:4326")}else if(eo.test(i)){ys=!0,[,,x,k,H]=i.match(Ot);const di=Number(x)<10?`EPSG:3218${x}`:`EPSG:321${80+Number(x)}`;[k,H]=Q.vs([parseFloat(k),parseFloat(H)],di,"EPSG:4326")}else if(xl.test(i))[,s,a,l,c,p,d,g,h,m,C]=i.match(_s),k=Wo(parseFloat((s||"")+a),parseFloat(l),parseFloat(c),u),H=Wo(parseFloat((d||"")+g),parseFloat(h),parseFloat(m),b);else if(Io.test(i))[,s,a,p,d,g,C]=i.match(uo),k=Wo(parseFloat((s||"")+a),parseFloat(l),parseFloat(c),u),H=Wo(parseFloat((d||"")+g),parseFloat(h),parseFloat(m),b);else if(JL.test(i))[,d,g,h,m,,b,s,a,l,c,,u,A,M]=i.match(Zo),u||(u="W"),k=l&&l.length>2?parseFloat((s||"")+a+"."+l):Wo(parseFloat(a),parseFloat(l),parseFloat(c),u),H=h&&h.length>2?parseFloat((d||"")+g+"."+h):Wo(parseFloat(g),parseFloat(h),parseFloat(m),b);else{if(!UL.test(i))return{lonLat:void 0,message:"",radius:void 0,conf:void 0};ys=!0,[,k,p,H,C]=i.match(Hd),p&&(k=parseFloat(k+"."+p)),C&&(H=parseFloat(H+"."+C))}if(t.forceNA&&!ys&&(k>0&&H>0&&(k>H?k=-k:H=-H),k>H&&(k=[H,H=k][0])),o=[Number(k),Number(H)],void 0!==G&&"4326"!==G||o[0]>180||o[0]<-180||o[1]>90||o[1]<-90){const di=G?"EPSG:"+G:r,GL="EPSG:4326";try{o=Q.vs(o,di,GL)}catch{return{lonLat:void 0,message:"Projection "+di+" not supported",radius:void 0,conf:void 0}}}return Math.abs(o[0])<=180&&Math.abs(o[1])<=90?{lonLat:o,message:"",radius:A?parseInt(A,10):void 0,conf:M?parseInt(M,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function Wo(n,r,t,o){r=r||0,t=t||0;const i=n<0;let s=Math.abs(n)+r/60+t/3600;return(i||"S"===o||"W"===o)&&(s=-s),s}function Vc(n,r=3){const t=[];return n.forEach(o=>{const i=o<0?Math.ceil(o):Math.floor(o),s=o<0?60*(i-o):60*(o-i),a=Math.floor(s),l=(60*(s-a)).toFixed(r);t.push(`${i}\xb0 ${a}' ${l}"`)}),t}function ia(n){return(n=Math.round(n))<1e4?n+"":(n=Math.round(n/1e3))<1e3?n+"K":(n=Math.round(n/1e3))+"M"}function rt(n,r=96){return n/(39.3701*r)}function wr(n){const r=n.originalEvent;return!r.altKey&&(A_.tK?r.metaKey:r.ctrlKey)&&!r.shiftKey}function pt(n,r=3){return[hi.roundToNDecimal(n[0],r),hi.roundToNDecimal(n[1],r)]}function zc(n,r=3){return pt(n,r).map(t=>t.toString())}var _o=v(18492);function Xo({text:n,opacity:r=1,markerColor:t=[0,161,222],markerOutlineColor:o=[255,255,255]}={}){let i,s,a,l;const c=(0,_o._2)(t).slice(0),u=(0,_o._2)(o).slice(0);return 4===c.length&&("string"!=typeof t||/^#[0-9A-F]{8}$/i.test(t))&&(r=c[3]),s=`"rgba(${c[0]},${c[1]},${c[2]},${r})"`,i=t,a=`"rgb(${u[0]},${u[1]},${u[2]})"`,l='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+s+" stroke="+a+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>',new J.ZP({image:new Fi.Z({src:l,opacity:r,anchor:[.5,.92]}),text:new St.Z({text:n,font:"12px Calibri,sans-serif",fill:new q.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0})})}let yo=(()=>{class n{style;createStyle(t,o,i){if(!t)return Xo();if("function"==typeof t||t instanceof J.ZP)return t;const s=this.parseStyle("style",t);if(s.getText()){let a=0,l=1/0;if(t.text){const c=t.text?.minScaleDenom?rt(Number(t.text.minScaleDenom)):void 0,u=t.text?.maxScaleDenom?rt(Number(t.text.maxScaleDenom)):void 0;a=c||(t.text?.minResolution?t.text.minResolution:0),l=u||(t.text?.maxResolution?t.text.maxResolution:1/0)}(t.text?.minScaleDenom||t.text?.maxScaleDenom||t.text?.minResolution||t.text?.maxResolution)&&(o&&i>=a&&i<=l?o&&t.text.attribute&&s.getText().setText(this.getLabel(o,t.text.attribute)):s.setText())}return s}parseStyle(t,o){const i={},s=this.getOlCls(t);return s&&o instanceof Object?(Object.keys(o).forEach(a=>{const l=this.getOlKey(a);i[l]=this.parseStyle(a,o[a])}),new s(i)):o}getOlKey(t){let o;switch(t.toLowerCase()){case"circle":case"regularshape":case"icon":o="image"}return o||t}getOlCls(t){let o=O_[t.charAt(0).toUpperCase()+t.slice(1)];return"regularshape"===t&&(o=Ti.Z),"backgroundFill"===t&&(o=q.Z),"backgroundStroke"===t&&(o=U.Z),o}createStyleByAttribute(t,o,i){let s;const a=o.type?o.type:this.guessTypeFeature(t),l=o.attribute,c=o.data,u=o.stroke,p=o.width,d=o.fill,g=o.anchor,h=o.radius,m=o.icon,b=o.scale,C=c?c.length:0,x=o.label?o.label.attribute:void 0,A=o.label?.minScaleDenom?rt(Number(o.label.minScaleDenom)):void 0,M=o.label?.maxScaleDenom?rt(Number(o.label.maxScaleDenom)):void 0,Me=A||(o.label?.minResolution?o.label.minResolution:0),Fe=M||(o.label?.maxResolution?o.label.maxResolution:1/0);let G=o.label?.style?this.parseStyle("text",o.label.style):void 0;!G&&x&&(G=new St.Z);const Oe=o.baseStyle;if(G&&G.setText(i>=Me&&i<=Fe?this.getLabel(t,x):""),"circle"===a){for(let V=0;V<C;V++){const he=typeof t.get(l)<"u"&&null!==t.get(l)?t.get(l):"";if(he===c[V]||he.toString().match(new RegExp(c[V],"gmi")))return m?(s=[new J.ZP({image:new Fi.Z({color:d?d[V]:void 0,src:m[V],scale:b?b[V]:1,anchor:g?g[V]:[.5,.5]}),text:G instanceof St.Z?G:void 0})],s):(s=[new J.ZP({image:new Te.Z({radius:h?h[V]:4,stroke:new U.Z({color:u?u[V]:"black",width:p?p[V]:1}),fill:new q.Z({color:d?d[V]:"black"})}),text:G instanceof St.Z?G:void 0})],s)}if(!t.getStyle())return Oe?(s=this.createStyle(Oe,t,i),G&&s.setText(G),s):(s=[new J.ZP({image:new Te.Z({radius:4,stroke:new U.Z({color:"black"}),fill:new q.Z({color:"#bbbbf2"})})})],s)}else if("regular"===a){for(let V=0;V<C;V++){const he=typeof t.get(l)<"u"&&null!==t.get(l)?t.get(l):"";if(he===c[V]||he.toString().match(new RegExp(c[V],"gmi")))return s=[new J.ZP({stroke:new U.Z({color:u?u[V]:"black",width:p?p[V]:1}),fill:new q.Z({color:d?d[V]:"rgba(255,255,255,0.4)"}),text:G instanceof St.Z?G:void 0})],s}if(t instanceof Ze.Z&&!t.getStyle())return Oe?(s=this.createStyle(Oe,t,i),G&&s.setText(G),s):(s=[new J.ZP({stroke:new U.Z({color:"black"}),fill:new q.Z({color:"#bbbbf2"})})],s)}}createClusterStyle(t,o,i={},s){let a;const l=t.get("features").length;if(1!==l){if(i.clusterRanges)for(const c of i.clusterRanges)if((!c.minRadius||c.minRadius<=l)&&(!c.maxRadius||c.maxRadius>=l)){if(a=this.createStyle(c.style),c.showRange){const u=new St.Z({text:l.toString(),fill:new q.Z({color:"#fff"})});a.setText(u)}if(c.dynamicRadius){let u;const p=a.getRadius();u=5*Math.log(l),u<p&&(u=p),a.image_.setRadius(u)}break}if(!a){let c;i.radiusCalc?c=i.radiusCalc(l):(c=5*Math.log(l),c<6&&(c=6)),a=[new J.ZP({image:new Te.Z({radius:c,stroke:new U.Z({color:"black"}),fill:new q.Z({color:"rgba(24, 134, 45, 0.5)"})}),text:new St.Z({text:l.toString(),fill:new q.Z({color:"#fff"})})})]}}else a=this.createStyle(s,t,o);return a}getLabel(t,o){let i=o;if(!i)return;const s=Array.from(o.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(a=>{i=i.replace(a[0],t.get(a[1]))}),0===s.length&&i===o&&(i=t.get(o)||o),i}guessTypeFeature(t){switch(t.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function vn(n){return!0===n.dataSource.options.queryable}function $_(n){const r=n.get("_layer");return void 0!==r&&vn(r)&&function k_(n){const r=n.dataSource;return void 0===r.options.queryLayerFeatures||!0===r.options.queryLayerFeatures}(r)}class Tr{options;messageService;authInterceptor;geoDBService;layerDBService;collapsed;dataSource;legend;legendCollapsed=!0;firstLoadComponent=!0;map;ol;olLoadingProblem=!1;status$;hasBeenVisible$=new y.X(void 0);hasBeenVisible$$;resolution$$;get isIgoInternalLayer(){return this.options.isIgoInternalLayer||!1}get id(){return this.options.id||this.dataSource.id}get alias(){return this.options.alias}get title(){return this.options.title}set title(r){this.options.title=r}get zIndex(){return this.ol.getZIndex()}set zIndex(r){this.ol.setZIndex(r)}get baseLayer(){return this.options.baseLayer}set baseLayer(r){this.options.baseLayer=r}get opacity(){return this.ol.get("opacity")}set opacity(r){this.ol.setOpacity(r)}set isInResolutionsRange(r){this.isInResolutionsRange$.next(r)}get isInResolutionsRange(){return this.isInResolutionsRange$.value}isInResolutionsRange$=new y.X(!1);set maxResolution(r){this.ol.setMaxResolution(0===r?0:r||1/0),this.updateInResolutionsRange()}get maxResolution(){return this.ol.getMaxResolution()}set minResolution(r){this.ol.setMinResolution(r||0),this.updateInResolutionsRange()}get minResolution(){return this.ol.getMinResolution()}set visible(r){this.ol.setVisible(r),this.visible$.next(r),!this.hasBeenVisible$.value&&r&&this.hasBeenVisible$.next(r),this.options?.messages&&r&&this.options?.messages.filter(t=>t.options?.showOnEachLayerVisibility).map(t=>this.showMessage(t))}get visible(){return this.visible$.value}visible$=new y.X(void 0);get displayed(){return this.visible&&this.isInResolutionsRange}displayed$=(0,Ye.a)([this.isInResolutionsRange$,this.visible$]).pipe((0,I.U)(r=>r[0]&&r[1]));get showInLayerList(){return!1!==this.options.showInLayerList}constructor(r,t,o,i,s){this.options=r,this.messageService=t,this.authInterceptor=o,this.geoDBService=i,this.layerDBService=s,this.dataSource=r.source,this.ol=this.createOlLayer(),void 0!==r.zIndex&&(this.zIndex=r.zIndex),r.baseLayer&&void 0===r.visible&&(r.visible=!1),this.maxResolution=r.maxResolution||rt(Number(r.maxScaleDenom)),this.minResolution=r.minResolution||rt(Number(r.minScaleDenom)),this.visible=void 0===r.visible||r.visible,this.opacity=void 0===r.opacity?1:r.opacity,r.legendOptions&&(r.legendOptions.url||r.legendOptions.html)&&(this.legend=this.dataSource.setLegend(r.legendOptions)),this.legendCollapsed=!r.legendOptions||!r.legendOptions.collapsed||r.legendOptions.collapsed,this.ol.set("_layer",this,!0)}setMap(r){this.map=r,this.unobserveResolution(),void 0!==r&&(this.observeResolution(),this.hasBeenVisible$$=this.hasBeenVisible$.subscribe(()=>{this.options.messages&&this.visible&&this.options.messages.map(t=>{this.showMessage(t)})}))}showMessage(r){this.messageService&&(r.title=r.title,r.text=r.text,this.messageService.message(r))}observeResolution(){this.resolution$$=this.map.viewController.resolution$.subscribe(()=>this.updateInResolutionsRange())}unobserveResolution(){void 0!==this.resolution$$&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}updateInResolutionsRange(){if(void 0!==this.map){const r=this.map.viewController.getResolution();this.isInResolutionsRange=r>=this.minResolution&&r<=(void 0===this.maxResolution?1/0:this.maxResolution)}else this.isInResolutionsRange=!1}}var Ge=function(n){return n.OPACITY="opacity",n.VISIBLE="visible",n.OGCFILTERS="ogcFilters",n.MINRESOLUTION="minResolution",n.MAXRESOLUTION="maxResolution",n.ZINDEX="zIndex",n.TIMEFILTER="timeFilter",n}(Ge||{}),no=function(n){return n.TITLE="title",n.ABSTRACT="abstract",n.CUSTOM="custom",n}(no||{}),D_=v(63906);class E_ extends or{id;loaded=0;loading=0;source;messageService;constructor(r,t){super(),this.source=r.options.source.ol,this.id=Ie(),this.messageService=t}watch(){this.source.on("imageloadstart",r=>this.handleLoadStart(r)),this.source.on("imageloadend",r=>this.handleLoadEnd(r)),this.source.on("imageloaderror",r=>this.handleLoadEnd(r)),this.source.on("imageloaderror",r=>this.handleLoadError(r))}unwatch(){this.source.un("imageloadstart",r=>this.handleLoadStart(r)),this.source.un("imageloadend",r=>this.handleLoadEnd(r)),this.source.un("imageloaderror",r=>this.handleLoadEnd(r)),this.source.un("imageloaderror",r=>this.handleLoadError(r))}handleLoadStart(r){r.image.__watchers__||(r.image.__watchers__=[]),r.image.__watchers__.push(this.id),this.loading+=1,this.status=ge.Working}handleLoadEnd(r){if(!r.image.__watchers__)return;const t=r.image.__watchers__.indexOf(this.id);if(t<0)return;r.image.__watchers__.splice(t,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=ge.Done,this.loaded=this.loading=0)}handleLoadError(r){r.image.__watchers__&&(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:r.target.params_.LAYERS}),this.loaded=-1,this.loading=0,this.status=ge.Error)}}class Kc extends or{id;loaded=0;loading=0;source;constructor(r){super(),this.source=r.options.source.ol,this.id=Ie()}watch(){this.source.on("tileloadstart",r=>this.handleLoadStart(r)),this.source.on("tileloadend",r=>this.handleLoadEnd(r)),this.source.on("tileloaderror",r=>this.handleLoadEnd(r))}unwatch(){this.source.un("tileloadstart",r=>this.handleLoadStart(r)),this.source.un("tileloadend",r=>this.handleLoadEnd(r)),this.source.un("tileloaderror",r=>this.handleLoadEnd(r))}handleLoadStart(r){r.tile.__watchers__||(r.tile.__watchers__=[]),r.tile.__watchers__.push(this.id),this.loading+=1,this.status=ge.Working}handleLoadEnd(r){if(!r.tile.__watchers__)return;const t=r.tile.__watchers__.indexOf(this.id);if(t<0)return;r.tile.__watchers__.splice(t,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=ge.Done,this.loaded=this.loading=0)}}var Wc=v(69778),Ce=v(18625),Fr=v(40179),Vt=v(35774);function Oi(n){return({wms:R_,wmts:N_,xyz:B_,feature:J_,wfs:U_,arcgisrest:na,imagearcgisrest:na,tilearcgisrest:na,osm:o=>"OSM",tiledebug:o=>"tiledebug"}[n.type]||ra)(n)}function R_(n){const r=n.params.LAYERS,o="wms"+ei(n.url)+r;return mo.V8.hashStr(o)}function N_(n){const r=n.layer,o="wmts"+ei(n.url)+r;return mo.V8.hashStr(o)}function B_(n){const t="xyz"+ei(n.url);return mo.V8.hashStr(t)}function J_(n){if(!n.url)return ra();const t="feature"+ei(n.url);return mo.V8.hashStr(t)}function U_(n){if(!n.url||!n.params)return ra();const t="wfs"+ei(n.url)+n.params.featureTypes;return mo.V8.hashStr(t)}function na(n){const r=n.layer,t=ei(n.url);return mo.V8.hashStr((n.type||"arcgis")+t+r)}function ra(n){return Ie()}function ei(n){const t=("/"===n.charAt(0)?window.location.origin+n:n).split(/[?&]/);let o=t.shift();const i=t.filter(s=>0!==s.length&&"_"!==s.charAt(0));return i.length&&(o+="?"+i.join("&")),o}class zt{options;dataService;id;ol;legend;constructor(r={},t){this.options=r,this.dataService=t,this.options=r,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}generateId(){return Oi(this.options)}getLegend(r,t){return this.legend?this.legend:[]}setLegend(r){return this.legend=r.url?[{url:r.url}]:r.html?[{html:r.html}]:[],this.legend}}class Ae extends zt{createOlSource(){const r={format:this.getSourceFormatFromOptions(this.options)};return new Vt.Z(Object.assign(r,this.options))}getSourceFormatFromOptions(r){if(r.format)return r.format;let t;const o=r.formatType;if(o){if(t=Fr[o],void 0===t)throw new Error("Invalid vector source format ${formatType}.")}else t=Ce.Z;const i=r.formatOptions;let s;return s=i?new t(i):new t,s}onUnwatch(){}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}}class bo extends Ae{createOlSource(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=super.createOlSource(),new Wc.Z(this.options)}generateId(){return Ie()}onUnwatch(){}}class G_ extends or{id;loaded=0;loading=0;layer;constructor(r){super(),this.layer=r,this.id=Ie()}watch(){let r=this.layer.options.source.ol;this.layer.dataSource instanceof bo&&(r=this.layer.options.source.options.source),r.getUrl()&&(r.on("featuresloadstart",t=>this.handleLoadStart(t)),r.on("featuresloadend",t=>this.handleLoadEnd(t)),r.on("featuresloaderror",t=>this.handleLoadEnd(t)))}unwatch(){let r=this.layer.options.source.ol;this.layer.dataSource instanceof bo&&(r=this.layer.options.source.options.source),r.getUrl()&&(r.un("featuresloadstart",t=>this.handleLoadStart(t)),r.un("featuresloadend",t=>this.handleLoadEnd(t)),r.un("featuresloaderror",t=>this.handleLoadEnd(t)))}handleLoadStart(r){this.loading+=1,this.status=ge.Working}handleLoadEnd(r){this.loaded+=1;const t=this.loading;this.loaded>=t&&t===this.loading&&(this.status=ge.Done,this.loaded=this.loading=0)}}class q_ extends Tr{messageService;authInterceptor;watcher;constructor(r,t,o){super(r,t,o),this.messageService=t,this.authInterceptor=o,this.watcher=new E_(this,this.messageService),this.status$=this.watcher.status$,this.status$.subscribe(i=>{0===i&&(this.olLoadingProblem=!0)})}createOlLayer(){const r=Object.assign({},this.options,{source:this.options.source.ol}),t=new D_.Z(r);return this.authInterceptor&&t.getSource().setImageLoadFunction((o,i)=>{this.customLoader(o,i,this.authInterceptor,this.messageService)}),t}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}customLoader(r,t,o,i){const s=new XMLHttpRequest,a=o.alterUrlWithKeyAuth(t);let l=t;if(a&&(l=a),s.open("GET",l),!o.interceptXhr(s,l))return s.abort(),void(r.getImage().src=l);s.responseType="arraybuffer",s.onload=function(){const u=new Uint8Array(this.response);(new TextDecoder).decode(u).includes("ServiceExceptionReport")&&i.error("igo.geo.dataSource.optionsApiUnavailable","igo.geo.dataSource.unavailableTitle");const d=new Blob([u],{type:"image/png"}),h=window.URL.createObjectURL(d);r.getImage().src=h},s.send()}}var j_=v(85148);class Q_ extends Tr{messageService;authInterceptor;watcher;constructor(r,t,o){super(r,t),this.messageService=t,this.authInterceptor=o,this.watcher=new Kc(this),this.status$=this.watcher.status$}createOlLayer(){const r=Object.assign({},this.options,{source:this.options.source.ol}),t=new j_.Z(r);return t.getSource().setTileLoadFunction((i,s)=>{this.customLoader(i,s,this.authInterceptor)}),t}customLoader(r,t,o){const i=o.alterUrlWithKeyAuth(t);let s=t;i&&(s=i),r.getImage().src=s}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}}var Ke=v(22491),Cn=v(39137),ti=v(59880),xn=v(34714),Y_=v(96046),Sn=v(71333),Ai=v(32087),H_=v(66796),Or=v(58284),sa=v(98503),ji=v(27157),aa=v(27446),la=v(50225),Xc=v(80731),V_=v(67047),z_=v(935),dt=v(78366),ot=function(n){return n.BasicNumericOperator="basicnumericoperator",n.Basic="basic",n.BasicAndSpatial="basicandspatial",n.Spatial="spatial",n.All="all",n.Time="time",n}(ot||{}),D=function(n){return n.BBOX="BBox",n.PropertyIsBetween="PropertyIsBetween",n.Contains="Contains",n.During="During",n.PropertyIsEqualTo="PropertyIsEqualTo",n.PropertyIsGreaterThan="PropertyIsGreaterThan",n.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",n.Intersects="Intersects",n.PropertyIsNull="PropertyIsNull",n.PropertyIsLessThan="PropertyIsLessThan",n.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",n.PropertyIsLike="PropertyIsLike",n.PropertyIsNotEqualTo="PropertyIsNotEqualTo",n.Within="Within",n.And="And",n.Or="Or",n.Not="Not",n}(D||{});class Jt{filterSequence=[];operators={[D.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsLike]:{spatial:!1,fieldRestrict:["string"]},[D.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[D.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[D.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[D.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[D.PropertyIsBetween]:{spatial:!1,fieldRestrict:["number"]},[D.During]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsNull]:{spatial:!1,fieldRestrict:[]},[D.Intersects]:{spatial:!0,fieldRestrict:[]},[D.Within]:{spatial:!0,fieldRestrict:[]},[D.Contains]:{spatial:!0,fieldRestrict:[]}};defineOgcFiltersDefaultOptions(r,t,o){let i=!0;return o&&"wms"===o&&(i=!1),(r=r||{}).enabled=void 0===r.enabled?i:r.enabled,r.editable=void 0===r.editable?i:r.editable,r.geometryName=t,r.advancedOgcFilters=!0,r.enabled&&(r.pushButtons||r.checkboxes||r.radioButtons||r.select||r.autocomplete)&&(r.advancedOgcFilters=!1),r}buildFilter(r,t,o,i,s){let a,l,c;if(l=!/intersects|contains|within/gi.test(JSON.stringify(r)),r&&(i=void 0!==r.geometryName?r.geometryName:i),t&&r&&(a=dt.VW(i,t,o.getCode())),!r)return"bbox="+t.join(",")+","+o.getCode();r=this.checkIgoFiltersProperties(r,i,o),c=t&&l?dt.xD(a,this.bundleFilter(r,s)):this.bundleFilter(r,s);const u={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:c,outputFormat:"",geometryName:i},p=(new Ai.Z).writeGetFeature(u);return"filter="+(new XMLSerializer).serializeToString(p).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]}bundleFilter(r,t){if(r instanceof Array){const o=[];return r.forEach(i=>{o.push(this.bundleFilter(i,t))}),o}return r.hasOwnProperty("logical")?this.createFilter({operator:r.logical,logicalArray:this.bundleFilter(r.filters,t)},t):r.hasOwnProperty("operator")?this.createFilter(r,t):void 0}createFilter(r,t){const o=r.operator,i=r.logicalArray,s=r.propertyName,a=r.pattern,l=!r.matchCase||r.matchCase,c=r.wildCard?r.wildCard:"*",u=r.singleChar?r.singleChar:".",p=r.escapeChar?r.escapeChar:"!",d=r.lowerBoundary,g=r.upperBoundary,h=r.geometryName,m=r.extent,b=r.wkt_geometry,C=r.srsName?r.srsName:"EPSG:3857",x=this.parseFilterOptionDate(r.begin,t?t.minDate:void 0),A=this.parseFilterOptionDate(r.end,t?t.maxDate:void 0),M=r.expression;let k;switch(b&&(k=(new ji.Z).readGeometry(b,{dataProjection:C,featureProjection:C||"EPSG:3857"})),o.toLowerCase()){case D.BBOX.toLowerCase():return dt.VW(h,m,C);case D.PropertyIsBetween.toLowerCase():return dt.vX(s,d||-1e40,g||1e40);case D.Contains.toLowerCase():return dt.r3(h,k,C);case D.During.toLowerCase():return dt.Q9(s,x,A);case D.PropertyIsEqualTo.toLowerCase():return dt.EW(s,M,l);case D.PropertyIsGreaterThan.toLowerCase():return dt.tS(s,M);case D.PropertyIsGreaterThanOrEqualTo.toLowerCase():return dt.wZ(s,M);case D.Intersects.toLowerCase():return dt.kK(h,k,C);case D.PropertyIsNull.toLowerCase():return dt.Ft(s);case D.PropertyIsLessThan.toLowerCase():return dt.Qj(s,M);case D.PropertyIsLessThanOrEqualTo.toLowerCase():return dt.MK(s,M);case D.PropertyIsLike.toLowerCase():return dt.vL(s,a?a.replace(/[()_]/gi,u):c,c,u,p,l);case D.PropertyIsNotEqualTo.toLowerCase():return dt.eI(s,M,l);case D.Within.toLowerCase():return dt.uh(h,k,C);case D.And.toLowerCase():return dt.xD.apply(null,i);case D.Or.toLowerCase():return dt.or.apply(null,i);case D.Not.toLowerCase():return dt.ff.apply(null,i);default:return}}defineInterfaceFilterSequence(r,t,o="",i=-1){return r instanceof Array?r.forEach(s=>{this.filterSequence.concat(this.defineInterfaceFilterSequence(s,t,o,i))}):r.hasOwnProperty("logical")?this.filterSequence.concat(this.defineInterfaceFilterSequence(r.filters,t,r.logical,i+=1)):r.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(r,t,i,o)),this.filterSequence}computeAllowedOperators(r,t,o){let s,a,l,i={};if(r&&t){const c=r.find(u=>u.name===t);s=c&&c.allowedOperatorsType?c.allowedOperatorsType:o}switch(r&&r.map(c=>{if(!c.allowedOperatorsType)return;const u=c.allowedOperatorsType.toLowerCase();(u===ot.All.toLowerCase()||u===ot.Spatial.toLowerCase()||u===ot.BasicAndSpatial.toLowerCase())&&(a=!0,u===ot.All.toLowerCase()&&(l=!0))}),s=s||ot.BasicAndSpatial,s.toLowerCase()){case ot.All:i=this.operators;break;case ot.Spatial:i={[D.Intersects]:{spatial:!0,fieldRestrict:[]},[D.Within]:{spatial:!0,fieldRestrict:[]}};break;case ot.BasicAndSpatial:i={[D.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[D.Intersects]:{spatial:!0,fieldRestrict:[]},[D.Within]:{spatial:!0,fieldRestrict:[]}};break;case ot.Basic:i={[D.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]}};break;case ot.Time:i={[D.During]:{spatial:!1,fieldRestrict:[]}};break;case ot.BasicNumericOperator:i={[D.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[D.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[D.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[D.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]}};break;default:i={[D.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[D.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[D.Intersects]:{spatial:!0,fieldRestrict:[]},[D.Within]:{spatial:!0,fieldRestrict:[]}}}return a&&(i.Intersects={spatial:!0,fieldRestrict:[]},i.Within={spatial:!0,fieldRestrict:[]},l&&(i.Contains={spatial:!0,fieldRestrict:[]})),i}addInterfaceFilter(r,t,o=0,i="Or"){r||(r={operator:"PropertyIsEqualTo"});const s={propertyName:"",operator:"",active:"",filterid:Ie(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(s,{parentLogical:i,level:o,geometryName:t},r)}checkIgoFiltersProperties(r,t,o,i=!1){const s=[];return r instanceof Array?(r.forEach(a=>{s.push(this.checkIgoFiltersProperties(a,t,o,i))}),s):r.hasOwnProperty("logical")?Object.assign({},{logical:r.logical,filters:this.checkIgoFiltersProperties(r.filters,t,o,i)}):r.hasOwnProperty("operator")?this.addFilterProperties(r,t,o,i):void 0}addFilterProperties(r,t,o,i=!1){const s=r.hasOwnProperty("filterid")?r.filterid:Ie(),a=r.hasOwnProperty("active")?r.active:i,l=r.hasOwnProperty("srsName")?r.srsName:o?o.getCode():"EPSG:3857";return Object.assign({},{filterid:s,active:a,igoSpatialSelector:"fixedExtent",srsName:l},r,{geometryName:t})}rebuiltIgoOgcFilterObjectFromSequence(r){if(r instanceof Array&&r.length>=1){let o,s,t=r[0].parentLogical,i=[];return r.forEach(a=>{const l=Object.assign({},a),c=r.indexOf(a);o=c>=0&&c<r.length-1?r[c+1]:l,delete l.active,delete l.filterid,delete l.parentLogical,i.push(l),1===r.length?s=l:t!==o.parentLogical&&(1===i.length?console.log("You must set at least two operator in a logical ("+t+")"):(s=Object.assign({},{logical:t,filters:i}),i=[s],t=o.parentLogical))}),s}}computeIgoSelector(r){if(r.groups.every(o=>void 0!==o.computedSelectors))return r;let t;if(r.groups&&r.bundles){if(!r.bundles.every(o=>void 0!==o.id))throw new Error("You must set an id for each of your bundles");t=R.copyDeep(r),t.groups.forEach(o=>{o.title=o.title?o.title:o.name,o.enabled=!!o.enabled&&o.enabled,o.computedSelectors=R.copyDeep(t.bundles.filter(i=>o.ids.includes(i.id)))})}else!r.groups&&r.bundles?(t=R.copyDeep(r),t.groups=[{title:"group1",name:"group1",computedSelectors:R.copyDeep(t.bundles)}]):t={bundles:r,groups:[{title:"group1",name:"group1",computedSelectors:R.copyDeep(r)}],selectorType:t.selectorType};return t.groups.find(o=>o.enabled)||(t.groups[0].enabled=!0),t}handleOgcFiltersAppliedValue(r,t,o,i){const s=r.ogcFilters;if(!s)return;const a=[];let l="",c="";if(s.enabled&&(s.pushButtons||s.checkboxes||s.radioButtons||s.select||s.autocomplete)){let p;if(s.pushButtons){p=s.pushButtons;const d=this.formatGroupAndFilter(s,p);for(const g of d)a.push(g)}if(s.checkboxes){p=s.checkboxes;const d=this.formatGroupAndFilter(s,p);for(const g of d)a.push(g)}if(s.radioButtons){p=s.radioButtons;const d=this.verifyMultipleEnableds(p),g=this.formatGroupAndFilter(s,d);for(const h of g)a.push(h)}if(s.select){p=s.select;const d=this.verifyMultipleEnableds(p),g=this.formatGroupAndFilter(s,d);for(const h of g)a.push(h)}if(s.autocomplete){p=s.autocomplete;const d=this.formatGroupAndFilter(s,p);for(const g of d)a.push(g)}a.length>=1&&(l=this.buildFilter(1===a.length?a[0]:{logical:"And",filters:a},o,i,s.geometryName))}s.enabled&&s.filters&&(s.geometryName=s.geometryName||t,c=this.buildFilter(s.filters,o,i,s.geometryName,r));let u=s.advancedOgcFilters?c:l;return"wms"===r.type&&(u=this.formatProcessedOgcFilter(u,r.params.LAYERS)),"wfs"===r.type&&(u=this.formatProcessedOgcFilter(u,r.params.featureTypes)),u}verifyMultipleEnableds(r){return r.bundles.forEach(t=>{if(!t.multiple&&t.selectors){const o=t.selectors.reduce((i,s,a)=>!0===s.enabled?i.concat(a):i,[]);o.length>1&&(o.splice(0,1),o.forEach(i=>{t.selectors[i].enabled=!1}))}}),r}formatGroupAndFilter(r,t){const o=(t=this.computeIgoSelector(t)).groups.find(s=>s.enabled).computedSelectors,i=[];return o.map(s=>{const a=[],l=s.selectors;l&&(l.filter(c=>!0===c.enabled).forEach(c=>a.push(c.filters)),1===a.length?i.push(a[0]):a.length>1&&i.push({logical:s.logical,filters:a}))}),"pushButton"===t.selectorType?r.pushButtons=t:"checkbox"===t.selectorType?r.checkboxes=t:"radioButton"===t.selectorType?r.radioButtons=t:"select"===t.selectorType?r.select=t:"autocomplete"===t.selectorType&&(r.autocomplete=t),i}formatProcessedOgcFilter(r,t){if(!r)return;let o="";return 0===r.length&&-1===t.indexOf(",")?o=r:t.split(",").forEach(s=>{o=`${o}(${r.replace("filter=","")})`}),o=o.replace(/\(\)/g,""),o.length>0?o.replace("filter=",""):void 0}parseFilterOptionDate(r,t){return r?"today"===r?void 0:E()(r).isValid()?r:void 0:t}}const eu="EPSG:3857",Qi=5e3,ca="geometry",ou=new RegExp(/(.*)?gml(.*)?/gi);function ua(n,r,t,o,i=0,s=!1){const a="2.0.0",l=n.urlWfs,c=n.paramsWFS,u=r||Qi,p=c.version===a?`startIndex=${i}`:"",d=t||eu;let g=c.outputFormat?`outputFormat=${c.outputFormat}`:"",h=c.version?`version=${c.version}`:"version=2.0.0";const b=`${c.version===a?"typenames":"typename"}=${c.featureTypes}`,C=c.version===a?"count":"maxFeatures";let x=r?`${C}=${u}`:c.maxFeatures?`${C}=${c.maxFeatures}`:`${C}=${u}`;s&&(g="",h="version=1.1.0",x=x.replace("count","maxFeatures"));const A=t?`srsname=${d}`:c.srsName?"srsname="+c.srsName:`srsname=${d}`;let M="",k="";o&&(M=`propertyName=${o}`,k=`valueReference=${o}`);const H=n.sourceFields;if(!M&&H&&H.length>0){const V=[];n.sourceFields.forEach(he=>{V.push(he.name)}),M=`propertyName=${V.join(",")},${c.fieldNameGeometry}`}const Me=-1===l.indexOf("?")?"?":"&";let G=`${l}${Me}service=WFS&request=GetFeature&${h}&${b}&`;G+=`${g}&${A}&${x}&${M}&${p}`;let Oe=`${l}?service=WFS&request=GetPropertyValue&version=${a}&${b}&`;return Oe+=`&${x}&${k}`,[{name:"outputformat",value:g},{name:"version",value:h},{name:"typename",value:b},{name:"count",value:x},{name:"srsname",value:A},{name:"propertyname",value:M},{name:"valuereference",value:k},{name:"getcapabilities",value:`${l}${Me}service=WFS&request=GetCapabilities&${h}`.replace(/&&/g,"&")},{name:"getfeature",value:G.replace(/&&/g,"&")},{name:"getpropertyvalue",value:Oe.replace(/&&/g,"&")}]}function iu(n,r){r&&"wfs"===r&&(n.paramsWFS=n.params);const t=n.paramsWFS;let o;return n.urlWfs=n.urlWfs||n.url,t.version=t.version||"2.0.0",t.fieldNameGeometry=t.fieldNameGeometry||ca,t.maxFeatures=t.maxFeatures||Qi,t.outputFormat&&(o=t.outputFormat),(ou.test(o)||!o)&&(t.version="1.1.0"),Object.assign({},n)}function pa(n){const r=n;let t;const o=r.paramsWFS.outputFormat?r.paramsWFS.outputFormat:void 0;return o?Fr[o]?(t=Fr[o],new t(r.formatOptions)):o.toLowerCase().match("gml2")?(t=Ai.Z,new t({...r.formatOptions,gmlFormat:la.Z})):o.toLowerCase().match("gml32")?(t=Ai.Z,new t({...r.formatOptions,gmlFormat:V_.Z})):o.toLowerCase().match("gml3")?(t=Ai.Z,new t({...r.formatOptions,gmlFormat:Xc.Z})):o.toLowerCase().match("topojson")?(t=H_.Z,new t(r.formatOptions)):o.toLowerCase().match("geojson")?(t=Ce.Z,new t(r.formatOptions)):o.toLowerCase().match("esrijson")?(t=Or.Z,new t(r.formatOptions)):o.toLowerCase().match("json")?(t=Ce.Z,new t(r.formatOptions)):o.toLowerCase().match("gpx")?(t=sa.Z,new t(r.formatOptions)):o.toLowerCase().match("WKT")?(t=ji.Z,new t(r.formatOptions)):o.toLowerCase().match("osmxml")?(t=z_.Z,new t(r.formatOptions)):o.toLowerCase().match("kml")?(t=aa.ZP,new t(r.formatOptions)):new t:(t=Ai.Z,new t(r.formatOptions))}var W_=v(16954),X_=v(61266),Ar=v(48766),nu=v(33084),ey=v(86972),ru=v(49057),wn=v(32325),da=v(63322),su=v(99422),Kt=v(46367);const ie="Feature";var Y=function(n){return n[n.None=0]="None",n[n.Move=1]="Move",n[n.Zoom=2]="Zoom",n[n.Default=3]="Default",n}(Y||{}),De=v(73133),ro=v(78789),Ee=v(28746),Rt=v(6646);function ft(n,r,t){t=t||gr;const i=(new Ce.Z).readFeature(n,{dataProjection:n.projection,featureProjection:r});i.setId(t(n));const s=ho(n);void 0!==s&&i.set("_title",s,!0),void 0!==n.extent&&i.set("_extent",n.extent,!0),void 0!==n.projection&&i.set("_projection",n.projection,!0);const a=vi(n,"meta.mapTitle");void 0!==a&&i.set("_mapTitle",a,!0),i.set("_entityRevision",function um(n){return(n.meta||{}).revision||0}(n),!0);const l=mr(n);return void 0!==l&&i.set("_icon",l,!0),n.meta&&n.meta.style&&i.set("_style",n.meta.style,!0),n.sourceId&&i.set("_sourceId",n.sourceId,!0),i}function Li(n,r,t,o="EPSG:4326"){let i,s,a,l;const c=new Ce.Z,p=n.getKeys().filter(b=>!b.startsWith("_")&&"geometry"!==b).reduce((b,C)=>(b[C]=n.get(C),b),{}),d=c.writeGeometryObject(n.getGeometry(),{dataProjection:o,featureProjection:r});if(t){i=t.get("title");const b=t.get("sourceOptions");b&&(s=b.excludeAttribute,a=b.excludeAttributeOffline,l=b.idColumn||("arcgisrest"===b.type||"tilearcgisrest"===b.type?"OBJECTID":void 0))}else i=n.get("_title");const g=n.get("_mapTitle"),h=n.getId()?n.getId():n.get(l)?n.get(l):Ie();return n.get("_newFeature"),{type:ie,projection:o,extent:n.get("_extent"),meta:{id:h,title:i||g||h,mapTitle:g,revision:n.getRevision(),style:n.get("_style"),excludeAttribute:s,excludeAttributeOffline:a},properties:p,geometry:d,ol:n}}function Tn(n,r){const t=De.lJ();return n.forEach(o=>{const i=function oy(n,r){let t=De.lJ();const o=n.get("_extent"),i=n.get("_projection");if(void 0!==o&&void 0!==i)t=Q.$A(o,i,r);else{const s=n.getGeometry();null!==s&&(t=s.getExtent())}return t}(o,r);De.l7(t,i)}),t}function au(n,r){const[t,o]=De.ap(n);return[r[3]?n[0]-t*r[3]:n[0],r[2]?n[1]-o*r[2]:n[1],r[1]?n[2]+t*r[1]:n[2],r[0]?n[3]+o*r[0]:n[3]]}function ga(n,r,t=.05){const o=Array.isArray(t)?t:[t,t,t,t],s=au(n,[-1,-1,-1,-1].map((a,l)=>a*o[l]));return!De.r4(s,r)}function lu(n,r,t){t=t||.004;const o=n.getExtent(),i=De.bg(o),s=De.bg(r);return!(0===s&&n.getZoom()>13)&&s/i<t}function vo(n,r,t=Y.Default,o,i){const s=n.getExtent(),l=Tn(r,n.getOlProjection());let c=l;void 0!==o&&(c=au(c,o)),t===Y.Zoom?n.zoomToExtent(c):t===Y.Move?n.moveToExtent(c):t===Y.Default&&(ga(s,l)||lu(n,l,i))&&n.zoomToExtent(c)}function cu(n){n.setStyle(new J.ZP({}))}var ny=v(25780);class uu extends zt{createOlSource(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new ny.Z(this.options)}onUnwatch(){}}var ry=v(54620);class pu extends zt{createOlSource(){return new ry.Z(this.options)}onUnwatch(){}}var du=v(74281);class Lr extends zt{options;wfsService;authInterceptor;set ogcFilters(r){this.options.ogcFilters=r}get ogcFilters(){return this.options.ogcFilters}constructor(r,t,o){super(iu(r,"wfs")),this.options=r,this.wfsService=t,this.authInterceptor=o;const i=this.options.ogcFilters,s=this.options.paramsWFS.fieldNameGeometry||ca,a=new Jt;this.options.ogcFilters=a.defineOgcFiltersDefaultOptions(i,s),this.options.ogcFilters.enabled&&this.options.ogcFilters.editable&&(r.sourceFields||[]).filter(l=>!l.values).length>0&&this.wfsService.getSourceFieldsFromWFS(this.options),i?.pushButtons&&(i.pushButtons.selectorType="pushButton"),i?.checkboxes&&(i.checkboxes.selectorType="checkbox"),i?.radioButtons&&(i.radioButtons.selectorType="radioButton"),i?.select&&(i.select.selectorType="select"),i?.autocomplete&&(i.autocomplete.selectorType="autocomplete"),this.setOgcFilters(this.options.ogcFilters,!0)}createOlSource(){return new Vt.Z({format:pa(this.options),strategy:du.VW})}setOgcFilters(r,t=!1){this.ogcFilters=r,t&&this.ol.notify("ogcFilters",this.ogcFilters)}onUnwatch(){}}class sy{}let ay=(()=>{class n extends sy{http;constructor(t){super(),this.http=t}getData(){return console.log("This is defining a data service."),"This is defining a data service."}getSourceFieldsFromWFS(t){t.sourceFields&&0!==t.sourceFields.length?this.defineFieldAndValuefromWFS(t).subscribe(o=>{t.sourceFields.forEach(i=>{void 0===i.alias&&(i.alias=i.name),(void 0===i.values||0===i.values.length)&&(i.values=o.find(s=>s.name===i.name).values)})}):(t.sourceFields=[],this.defineFieldAndValuefromWFS(t).subscribe(o=>{t.sourceFields=o}))}wfsGetFeature(t,o=Qi,i=eu,s,a=0,l=!1){const u=ua(t,o,i,s,a,l).find(d=>"getfeature"===d.name).value,p=t.paramsWFS.outputFormat;return l||ou.test(p)||!p?this.http.get(u,{responseType:"text"}):this.http.get(u)}defineFieldAndValuefromWFS(t){return new ue.y(o=>{const i=[];let s,a,l,c,u;c=pa(t);const p=JSON.parse(JSON.stringify(t));delete p.paramsWFS.outputFormat,delete p.formatOptions,u=pa(p);let d=t.sourceFields?.filter(g=>!g.values).map(g=>g.name);this.wfsGetFeature(t,1,void 0,void 0,0,!0).pipe((0,oo.b)(g=>String(g).toLowerCase().includes("exception")?(0,z.of)(!1):(0,z.of)(!0)),(0,oo.b)(g=>this.wfsGetFeature(t,1).pipe((0,oo.b)(h=>{const m=c.readFeatures(h);s=m[0].getKeys(),(t.sourceFields||0===t.sourceFields.length)&&(d=s),a=s.filter(x=>d.includes(x)&&x!==m[0].getGeometryName()&&!x.match(/boundedby/gi)),l=a.join(",");const b=[];let C=0;if(!g&&"2.0.0"===t.paramsWFS.version&&t.paramsWFS.maxFeatures>Qi){for(;C<t.paramsWFS.maxFeatures;)b.push(this.wfsGetFeature(t,1e3,t.paramsWFS.srsName,l,C)),C+=1e3;u=c}else b.push(this.wfsGetFeature(t,t.paramsWFS.maxFeatures||Qi,t.paramsWFS.srsName,l,0,!0));return(0,Ye.a)(b)})))).subscribe(g=>{let h=[];g.map(m=>{const b=u.readFeatures(m);h=h.concat(b)}),this.built_properties_value(h).forEach(m=>{i.push(m)}),o.next(i),o.complete()})})}built_properties_value(t){if(0===t.length)return[];const o=Object.assign({},t[0].getProperties());delete o[t[0].getGeometryName()],delete o.boundedBy;const i=[];for(const s in o)if(o.hasOwnProperty(s)){const a="object"==typeof t[0].get(s)?void 0:typeof t[0].get(s);i.push({name:s,alias:s,type:a,values:[o[s]]})}return t.every(s=>{const a=s.getProperties();for(const l in a)a.hasOwnProperty(l)&&l in o&&i.filter(c=>c.name===l).forEach(c=>{-1===c.values.indexOf(a[l])&&c.values.push(a[l])});return!0}),i}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ly=v(17747),We=function(n){return n.GML2="gml2",n.GML3="gml3",n.JSON="json",n.GEOJSON="geojson",n.GEOJSON2="geojson2",n.ESRIJSON="esrijson",n.TEXT="text",n.HTML="html",n.HTMLGML2="htmlgml2",n}(We||{}),Co=function(n){return n.GML2="application/vnd.ogc.gml",n.GML3="application/vnd.ogc.gml/3.1.1",n.JSON="application/json",n.GEOJSON="application/geojson",n.GEOJSON2="geojson",n.ESRIJSON="application/json",n.TEXT="text/plain",n.HTML="text/html",n.HTMLGML2="text/html",n}(Co||{}),Do=function(n){return n.IFRAME="iframe",n.BLANK="_blank",n}(Do||{});class xo extends zt{options;wfsService;get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Do.BLANK}set ogcFilters(r){this.options.ogcFilters=r}get ogcFilters(){return this.options.ogcFilters}set timeFilter(r){this.options.timeFilter=r}get timeFilter(){return this.options.timeFilter}timeFilter$=new y.X(void 0);constructor(r,t){super(r),this.options=r,this.wfsService=t;const o=r.params,i=o.DPI||96;o.DPI=i,o.MAP_RESOLUTION=i,o.FORMAT_OPTIONS="dpi:"+i,r.refreshIntervalSec&&r.refreshIntervalSec>0&&setInterval(()=>{this.refresh()},1e3*r.refreshIntervalSec);let s=ca;if(r.paramsWFS){const p=iu(r,"wms");R.mergeDeep(r.paramsWFS,p.paramsWFS),s=r.paramsWFS.fieldNameGeometry||s,r.download=Object.assign({},r.download,{dynamicUrl:this.buildDynamicDownloadUrlFromParamsWFS(r)})}r.sourceFields&&0!==r.sourceFields.length?r.sourceFields.forEach(p=>{p.alias=p.alias?p.alias:p.name}):r.sourceFields=[];const a=r.ogcFilters,l=new Jt;a?(a.advancedOgcFilters=!(a.pushButtons||a.checkboxes||a.radioButtons||a.select||a.autocomplete),a.advancedOgcFilters&&a.filters&&a.filters.calendarModeYear&&(a.advancedOgcFilters=!1),a.pushButtons&&(a.pushButtons.selectorType="pushButton"),a.checkboxes&&(a.checkboxes.selectorType="checkbox"),a.radioButtons&&(a.radioButtons.selectorType="radioButton"),a.select&&(a.select.selectorType="select"),a.autocomplete&&(a.autocomplete.selectorType="autocomplete")):r.ogcFilters=l.defineOgcFiltersDefaultOptions(a,s,"wms"),o.LAYERS.split(",").length>1&&a&&a.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+o.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),r.paramsWFS&&a&&a.enabled&&a.editable&&(r.sourceFields||[]).filter(p=>!p.values).length>0&&this.wfsService.getSourceFieldsFromWFS(r);const c=l.handleOgcFiltersAppliedValue(r,s);o.FILTER=c,this.ol.updateParams({FILTER:o.FILTER}),this.setOgcFilters(a,!0);const u=r;u?.timeFilterable&&u?.timeFilter&&this.setTimeFilter(u.timeFilter,!0)}refresh(){this.ol.updateParams({igoRefresh:Math.random()})}buildDynamicDownloadUrlFromParamsWFS(r){return ua(r).find(i=>"getfeature"===i.name).value}createOlSource(){return new ly.Z(Object.assign({ratio:1},this.options))}setOgcFilters(r,t=!1){this.ogcFilters=r,t&&this.ol.notify("ogcFilters",this.ogcFilters)}setTimeFilter(r,t=!1){this.timeFilter=r,t&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}getLegend(r,t){let o=super.getLegend();if(o.length>0&&void 0===r&&!t?.scale)return o;let s,i=!1;t?.size&&t?.extent&&t?.projection&&this.options.contentDependentLegend&&(s="1.3.0"===this.params.VERSION||void 0===this.params.VERSION?"CRS":"SRS",i=!0);const a=this.params;let l=[];void 0!==a.LAYERS&&(l=a.LAYERS.split(","));const c=this.options.url.replace(/\?$/,""),u=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0",`VERSION=${a.VERSION||"1.3.0"}`];return void 0!==r&&u.push(`STYLE=${r}`),void 0!==t?.scale&&u.push(`SCALE=${t.scale}`),i&&(u.push(`WIDTH=${t.size[0]}`),u.push(`HEIGHT=${t.size[1]}`),u.push(`BBOX=${t.extent.join(",")}`),u.push(`${s}=${t.projection}`)),o=l.map(p=>{const d=c.match(/\?/)?"&":"?";return{url:`${c}${d}${u.join("&")}&LAYER=${p}`,title:l.length>1?p:void 0,currentStyle:void 0===r?void 0:r}}),o}onUnwatch(){}}var gu=v(65541),cy=v(23907);function uy(n){const t=Q.U2(n||"EPSG:3857").getExtent(),o=(0,De.dz)(t)/256,i=new Array(20),s=new Array(20);for(let a=0;a<20;++a)i[a]=o/Math.pow(2,a),s[a]=a;return new cy.Z({origin:(0,De.rL)(t),resolutions:i,matrixIds:s})}class ma extends zt{constructor(r){super(r)}createOlSource(){const r=Object.assign({tileGrid:uy(this.options.projection)},this.options);return new gu.Z(r)}onUnwatch(){}}var py=v(45422);class Mr extends zt{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Do.BLANK}createOlSource(){const t=Object.assign({crossOrigin:this.options.crossOrigin?this.options.crossOrigin:"anonymous"},this.options);return new py.Z(t)}getLegend(){const r=super.getLegend();if(r.length>0)return r;let t="<table>";if(null!==this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(o=>{!0===o.visible&&(t+='<tr><td><p><font size="5" color="'+o.value+'"> &#9679</font></p></td><td>'+o.name+"</td></tr>")}),t+="</table>",[{html:t}];{const o=this.options.config.layers[0].options,i=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];for(const s of i)if(o.cartocss.includes(s)){const a=o.cartocss.split(s).pop(),l=a.substr(0,a.indexOf(";"));if(l.includes("ramp")){const c=l.split(", (")[1].split(","),u=l.split(", (")[2].split(",");for(let p=0;p<c.length;p++)c[p]=c[p].replace(/("|\))/g,""),u[p]=u[p].replace(/("|\))/g,""),"="===u[p].replace(/\s+/g,"")&&(u[p]="Autres"),t+='<tr><td><p><font size="5" color="'+c[p]+'"> &#9679</font></p></td><td>'+u[p]+"</td></tr>";break}t+='<tr><td><p><font size="5" color="'+l+'"> &#9679</font></p></td><td>'+(o.layer_name?o.layer_name:"")+"</td></tr>";break}return t+="</table>",[{html:t}]}}onUnwatch(){}}class ha extends zt{createOlSource(){const r=new Or.Z;return new Vt.Z({attributions:this.options.params.attributions,overlaps:!1,format:r,url:function(t,o,i){const s=this.options.url+"/"+this.options.layer+"/query/",l=["f=json",`geometry=${encodeURIComponent('{"xmin":'+t[0]+',"ymin":'+t[1]+',"xmax":'+t[2]+',"ymax":'+t[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];return this.options.params.time&&l.push(`time=${this.options.params.time}`),this.options.params.customParams&&this.options.params.customParams.forEach(c=>{l.push(c)}),`${s}?${l.join("&")}`}.bind(this),strategy:du.VW})}getLegend(){const r=this.options.legendInfo,t=super.getLegend();if(void 0===r||t.length>0)return t;if(!r)return;let i,s,a,o="<table>";if(r.legend)for(const l of r.legend)i=this.htmlImgSrc(l.contentType,l.imageData),s=l.label?l.label.replace("<Null>","Null"):"",o+="<tr><td align='left'><img src=\""+i+'" alt =\'\' /></td><td class="mat-typography">'+s+"</td></tr>";else if("uniqueValue"===r.type)for(const l of r.uniqueValueInfos)s=l.label.replace("<Null>","Null"),"esriPMS"===l.symbol.type?(i=this.htmlImgSrc(l.symbol.contentType,l.symbol.imageData),o+="<tr><td align='left'><img src=\""+i+'" alt =\'\' /></td><td class="mat-typography">'+s+"</td></tr>"):"esriPMS"!==l.symbol.type&&(a=this.createSVG(l.symbol),o+="<tr><td align='left'>"+a+'</td><td class="mat-typography">'+s+"</td></tr>");else"simple"===r.type&&(s=r.label?r.label.replace("<Null>","Null"):"","esriPMS"===r.symbol.type?(i=this.htmlImgSrc(r.symbol.contentType,r.symbol.imageData),o+="<tr><td align='left'><img src=\""+i+'" alt =\'\' /></td><td class="mat-typography">'+s+"</td></tr>"):"esriPMS"!==r.symbol.type&&(a=this.createSVG(r.symbol),o+="<tr><td align='left'>"+a+'</td><td class="mat-typography">'+s+"</td></tr>"));return o+="</table>",[{html:o}]}htmlImgSrc(r,t){return`data:${r};base64,${t}`}createSVG(r){let t="";const o=r.color?r.color:[0,0,0,0];if("esriSLS"===r.type){const s="stroke:rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")",a="stroke-width:"+(r.width?r.width:0);"esriSLSSolid"===r.style?t='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+s+";"+a+'"/></svg>':"esriSLSDash"===r.style&&(t='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+s+";"+a+'" stroke-dasharray="5,5"/></svg>')}else if("esriSMSCircle"===r.style||"esriSFSSolid"===r.style){const i=r.outline.color,l="stroke:rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")",c="stroke-width:"+r.outline.width,u="fill:rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")";t="esriSMSCircle"===r.style?'<svg height="30" width="30"><circle cx="15" cy="15" r="'+r.size/2+'" style="'+l+";"+c+";"+u+'"/></svg>':'<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+l+";"+c+";"+u+'"/></svg>'}return t}onUnwatch(){}}var dy=v(14040);class fa extends zt{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Do.BLANK}createOlSource(){const r=void 0===this.options.layer?this.options.params:Object.assign({LAYERS:`show:${this.options.layer}`},this.options.params);return"object"==typeof r.renderingRule&&(r.renderingRule=JSON.stringify(r.renderingRule)),new dy.Z({ratio:1,params:r,url:this.options.url})}getLegend(){const r=this.options.legendInfo,t=super.getLegend();if(void 0===r||void 0===this.options.layer||t.length>0)return t;if(!r)return;let o="<table>";for(const i of r.legend)o+=`<tr><td align='left'><img src="${this.options.url}/${r.layerId}/images/${i.url}" alt ='' /></td><td class="mat-typography">`+i.label.replace("<Null>","Null")+"</td></tr>";return o+="</table>",[{html:o}]}onUnwatch(){}}var gy=v(132);class Fn extends zt{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Do.BLANK}createOlSource(){return new gy.Z(this.options)}getLegend(){const r=this.options.legendInfo,t=super.getLegend();if(void 0===r||void 0===this.options.layer||t.length>0)return t;if(!r)return;let o="<table>";for(const i of r.legend)o+=`<tr><td align='left'><img src="${this.options.url}/${r.layerId}/images/${i.url}" alt ='' /></td><td class="mat-typography">`+i.label.replace("<Null>","Null")+"</td></tr>";return o+="</table>",[{html:o}]}onUnwatch(){}}var my=v(45199),hy=v(39890);class mu extends zt{createOlSource(){const r=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete r.tileGrid,r.tileGrid=new hy.Z(this.options.tileGrid)),new my.Z(r)}onUnwatch(){}}class hu extends Ae{ws;createOlSource(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),super.createOlSource()}createWebSocket(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}onMessage(r){const t=this.options.format.readFeature(r.data);switch(this.options.onmessage){case"update":const o=this.ol.getFeatureById(t.getId());o&&this.ol.removeFeature(o),this.ol.addFeature(t);break;case"delete":this.ol.clear(!0),this.ol.addFeature(t);break;default:this.ol.addFeature(t)}}onClose(r){}onError(r){}onOpen(r){}onUnwatch(){this.ws.close()}}var fu=v(55977),_u=v(80166);class yu extends zt{createOlSource(){let r;return r="feature"===this.options.featureClass?new fu.Z({featureClass:Ze.Z}):new fu.Z,this.options.format=r,new _u.Z(this.options)}generateId(){return this.options.url?mo.V8.hashStr("mvt"+this.options.url):Ie()}onUnwatch(){}}let On=(()=>{class n{config;constructor(t){this.config=t,(this.config.getConfig("projections")||[]).forEach(i=>{i.alias=i.alias?i.alias:i.code,this.registerProjection(i)});for(let i=1;i<61;i++)this.registerProjection({code:i<10?`EPSG:3260${i}`:`EPSG:326${i}`,def:`+proj=utm +zone=${i} +datum=WGS84 +units=m +no_defs`,extent:void 0});for(let i=1;i<11;i++){const s=i<10?`EPSG:3218${i}`:`EPSG:321${80+i}`;let a;a=Number(i)<=2?-50-3*Number(i):Number(i)>=12?-81-3*(Number(i)-12):-49.5-3*Number(i),this.registerProjection({code:s,def:`+proj=tmerc +lat_0=0 +lon_0=${a} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"`,extent:void 0})}}registerProjection(t){da.Z.defs(t.code,t.def),ru.z2(da.Z),t.extent&&Q.U2(t.code).setExtent(t.extent)}static \u0275fac=function(o){return new(o||n)(e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var fy=v(66962),_y=v(8734),st=function(n){return n.DATE="date",n.TIME="time",n.DATETIME="datetime",n.YEAR="year",n}(st||{}),Ut=function(n){return n.CALENDAR="calendar",n.SLIDER="slider",n}(Ut||{});class qe{_converters;_renderers;constructor(){this._converters={},this._converters.esriPMS=qe._convertEsriPMS,this._converters.esriSFS=qe._convertEsriSFS,this._converters.esriSLS=qe._convertEsriSLS,this._converters.esriSMS=qe._convertEsriSMS,this._converters.esriTS=qe._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}static _convertPointToPixel(r){return r/.75}static _transformColor(r){return[r[0],r[1],r[2],r[3]/255]}static _getResolutionForScale(r,t){const i=Q.Wm[t];return parseFloat(r)/(39.3701*i*96)}static _convertEsriTS(r){const t=qe._transformAngle(r.angle),o=void 0!==r.text?r.text:void 0;return new J.ZP({text:new St.Z({fill:new q.Z({color:qe._transformColor(r.color)}),font:r.font.style+" "+r.font.weight+" "+r.font.size+" px "+r.font.family,textBaseline:r.verticalAlignment,textAlign:r.horizontalAlignment,offsetX:qe._convertPointToPixel(r.xoffset),offsetY:qe._convertPointToPixel(r.yoffset),rotation:t,text:o})})}static _convertEsriPMS(r){const t="data:"+r.contentType+";base64, "+r.imageData,o=qe._transformAngle(r.angle);return new J.ZP({image:new Fi.Z({src:t,rotation:o})})}static _convertEsriSFS(r){const t=new q.Z({color:qe._transformColor(r.color)}),o=r.outline?qe._convertOutline(r.outline):void 0;return new J.ZP({fill:t,stroke:o})}static _convertOutline(r){let t;const o=qe._transformColor(r.color);return"esriSLSDash"===r.style?t=[5]:"esriSLSDashDot"===r.style?t=[5,5,1,2]:"esriSLSDashDotDot"===r.style?t=[5,5,1,2,1,2]:"esriSLSDot"===r.style?t=[1,2]:"esriSLSNull"===r.style&&(o[3]=0),new U.Z({color:o,lineDash:t,width:qe._convertPointToPixel(r.width)})}static _convertEsriSLS(r){return new J.ZP({stroke:qe._convertOutline(r)})}static _transformAngle(r){if(0===r||void 0===r)return;const o=-r*Math.PI/180+Math.PI/2;return o<0?2*Math.PI+o:o}static _convertEsriSMS(r){const t=new q.Z({color:qe._transformColor(r.color)}),o=r.outline?qe._convertOutline(r.outline):void 0,i=qe._convertPointToPixel(r.size)/2,s=qe._transformAngle(r.angle);return"esriSMSCircle"===r.style?new J.ZP({image:new Te.Z({radius:i,fill:t,stroke:o})}):"esriSMSCross"===r.style?new J.ZP({image:new Ti.Z({fill:t,stroke:o,points:4,radius:i,radius2:0,angle:0,rotation:s})}):"esriSMSDiamond"===r.style?new J.ZP({image:new Ti.Z({fill:t,stroke:o,points:4,radius:i,rotation:s})}):"esriSMSSquare"===r.style?new J.ZP({image:new Ti.Z({fill:t,stroke:o,points:4,radius:i,angle:Math.PI/4,rotation:s})}):"esriSMSX"===r.style?new J.ZP({image:new Ti.Z({fill:t,stroke:o,points:4,radius:i,radius2:0,angle:Math.PI/4,rotation:s})}):"esriSMSTriangle"===r.style?new J.ZP({image:new Ti.Z({fill:t,stroke:o,points:3,radius:i,angle:0,rotation:s})}):void 0}_convertLabelingInfo(r,t){const o=[];for(let i=0,s=r.length;i<s;++i){const a=r[i].labelExpression,l=a.substr(a.indexOf("[")+1,a.indexOf("]")-1),c=r[i].symbol,u=r[i].maxScale,p=r[i].minScale;let d=null;0!==u&&(d=qe._getResolutionForScale(u,t));let g=null;0!==p&&(g=qe._getResolutionForScale(p,t));const h=this._converters[c.type].call(this,c);o.push(function(m,b){let C=!0;if(null!==this.minResolution&&null!==this.maxResolution?C=b<this.maxResolution&&b>=this.minResolution:null!==this.minResolution?C=b>=this.minResolution:null!==this.maxResolution&&(C=b<this.maxResolution),C){const x=m.get(this.field);return this.style.getText().setText(x),[this.style]}}.bind({minResolution:d,maxResolution:g,field:l,style:h}))}return o}_renderSimple(r){const t=this._converters[r.symbol.type].call(this,r.symbol);return()=>[t]}_renderClassBreaks(r){const t=r.defaultSymbol,o=this._converters[t.type].call(this,t),i=r.field,s=[];for(let a=0,l=r.classBreakInfos.length;a<l;++a){const c=r.classBreakInfos[a];let u;u=null==c.classMinValue?0===a?r.minValue:r.classBreakInfos[a-1].classMaxValue:c.classMinValue;const p=c.classMaxValue,d=c.symbol,g=this._converters[d.type].call(this,d);s.push({min:u,max:p,style:g})}return a=>{const l=a.get(i);for(let c=0,u=s.length;c<u;++c){let p;if(p=0===c?l>=s[c].min&&l<=s[c].max:l>s[c].min&&l<=s[c].max,p)return[s[c].style]}return[o]}}_renderUniqueValue(r){const t=r.defaultSymbol;let o=[];t&&(o=[this._converters[t.type].call(this,t)]);const i=r.field1,s=r.uniqueValueInfos,a=this;return(()=>{const l={};for(let c=0,u=s.length;c<u;++c){const p=s[c],d=p.symbol;l[p.value]=[a._converters[d.type].call(a,d)]}return c=>l[c.get(i)]||o})()}generateStyle(r,t){const o=r.drawingInfo;let i=[];const s=this._renderers[o.renderer.type].call(this,o.renderer);if(void 0!==s&&i.push(s),r.labelingInfo){const a=this._convertLabelingInfo(r.labelingInfo,t);i=i.concat(a)}return 1===i.length?i[0]:(a,l)=>{let c=[];for(let u=0,p=i.length;u<p;++u){const d=i[u].call(null,a,l);d&&(c=c.concat(d))}return c}}}let Gt=(()=>{class n{map;constructor(){}getMap(){return this.map}setMap(t){this.map=t}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Ir=function(n){return n.wms="wms",n.wmts="wmts",n.arcgisrest="esriJSON",n.imagearcgisrest="esriJSON",n.tilearcgisrest="esriJSON",n}(Ir||{});class Zt{http;mapService;parsers={wms:new fy.Z,wmts:new _y.Z,esriJSON:new Or.Z};constructor(r,t){this.http=r,this.mapService=t}getWMSOptions(r){return this.getCapabilities("wms",r.url,r.params.VERSION).pipe((0,I.U)(i=>i?this.parseWMSOptions(r,i):void 0))}getWMTSOptions(r){return this.getCapabilities("wmts",r.url,r.version).pipe((0,I.U)(s=>s?this.parseWMTSOptions(r,s):void 0))}getCartoOptions(r){return this.http.jsonp("https://"+r.account+".carto.com/api/v2/viz/"+r.mapId+"/viz.json","callback").pipe((0,I.U)(o=>this.parseCartoOptions(r,o)))}getArcgisOptions(r){const t=r.url+"/"+r.layer+"?f=json",o=this.getCapabilities("arcgisrest",r.url),i=this.http.get(t);return(0,Qt.D)([i,o]).pipe((0,I.U)(s=>this.parseArcgisOptions(r,s[0],s[1])))}getImageArcgisOptions(r){const t=r.url+"/"+r.layer+"?f=json",o=r.url+"/legend?f=json",i=this.getCapabilities("imagearcgisrest",r.url),s=this.http.get(t),a=this.http.get(o).pipe((0,I.U)(l=>l),(0,ce.K)(l=>(console.log("No legend associated with this Image Service"),(0,z.of)(l))));return(0,Qt.D)([s,a,i]).pipe((0,I.U)(l=>this.parseTileOrImageArcgisOptions(r,l[0],l[1],l[2])))}getTileArcgisOptions(r){const t=r.url+"/"+r.layer+"?f=json",o=r.url+"/legend?f=json",i=this.getCapabilities("tilearcgisrest",r.url),s=this.http.get(t),a=this.http.get(o).pipe((0,I.U)(l=>l),(0,ce.K)(l=>(console.log("No legend associated with this Tile Service"),(0,z.of)(l))));return(0,Qt.D)([s,a,i]).pipe((0,I.U)(l=>this.parseTileOrImageArcgisOptions(r,l[0],l[1],l[2])))}getCapabilities(r,t,o){const i=new $.LE({fromObject:{request:"GetCapabilities",service:r.toUpperCase(),version:o||"1.3.0",_i:"true"}});let s;return s="esriJSON"===Ir[r]?this.http.get(t+"?f=json"):this.http.get(t,{params:i,responseType:"text"}),s.pipe((0,I.U)(a=>{if("esriJSON"===Ir[r])return a;if(String(a).toLowerCase().includes("serviceexception")&&String(a).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return this.parsers[r].read(a)}),(0,ce.K)(a=>{throw typeof a.error<"u"&&(a.error.caught=!0),a}))}parseWMSOptions(r,t){const i=this.findDataSourceInCapabilities(t.Capability.Layer,r.params.LAYERS);if(!i)throw{error:{message:"Layer not found"}};const s=i.DataURL?i.DataURL[0]:void 0,a=i.Abstract?i.Abstract:void 0,l=i.KeywordList?i.KeywordList:void 0;let c=i.queryable;const u=this.getTimeFilter(i),p=u&&Object.keys(u).length>0,d=i.Style?this.getStyle(i.Style):void 0;let g=!0;i.EX_GeographicBoundingBox?i.EX_GeographicBoundingBox.forEach((x,A)=>{A<2&&(x>180||x<-180)&&(g=!1),A>=2&&(x>90||x<-90)&&(g=!1)}):g=!1;const h=g?Q.$A(i.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0;let m;const b=[Co.GEOJSON,Co.GEOJSON2,Co.GML3,Co.GML2,Co.JSON,Co.HTML];for(const x of b)if(-1!==t.Capability.Request.GetFeatureInfo.Format.indexOf(x)){const A=Object.keys(Co).find(M=>Co[M]===x);m=We[A];break}m||(c=!1);const C=R.removeUndefined({_layerOptionsFromSource:{title:i.Title,maxResolution:rt(i.MaxScaleDenominator),minResolution:rt(i.MinScaleDenominator),extent:h,metadata:{url:s?s.OnlineResource:void 0,extern:!!s||void 0,abstract:a,keywordList:l},legendOptions:d},queryable:c,queryFormat:m,timeFilter:p?u:void 0,timeFilterable:!!p||void 0,minDate:p?u.min:void 0,maxDate:p?u.max:void 0,stepDate:p?u.step:void 0});return R.mergeDeep(C,r)}parseWMTSOptions(r,t){const o=t.Contents.Layer.find(l=>l.Identifier===r.layer),i=(0,gu.B)(t,r),s=Object.assign(i,r),a=R.removeUndefined({_layerOptionsFromSource:{title:o.Title}});return R.mergeDeep(a,s)}parseCartoOptions(r,t){const o=[],i=t.layers[1].options.layer_definition;i.layers.forEach(a=>{o.push({type:a.type.toLowerCase(),options:a.options,legend:a.legend})});const s=R.removeUndefined({config:{version:i.version,layers:o}});return R.mergeDeep(s,r)}parseArcgisOptions(r,t,o){const i=t.name;let s,a;s=t.drawingInfo?.renderer?t.drawingInfo.renderer:void 0,t.drawingInfo&&(a=(new qe).generateStyle(t,"esriMeters"===t.units?"m":"degrees"));const l=new Ar.Z({target:t.copyrightText});let c,u;if(t.timeInfo){const g=t.timeInfo.timeExtent;c=g[0]+","+g[1];const h=new Date;h.setTime(g[0]);const m=new Date;m.setTime(g[1]),u={min:h.toUTCString(),max:m.toUTCString(),range:!0,type:st.DATETIME,style:Ut.CALENDAR}}const p=Object.assign({},{style:a,LAYERS:r.layer?"show:"+r.layer:void 0,time:c}),d=R.removeUndefined({params:p,_layerOptionsFromSource:{title:i,minResolution:rt(t.maxScale),maxResolution:rt(t.minScale),metadata:{extern:!1,abstract:t.description||o.serviceDescription}},legendInfo:s,timeFilter:u,sourceFields:t.fields,queryTitle:t.displayField});return d.attributions=l,R.mergeDeep(d,r)}parseTileOrImageArcgisOptions(r,t,o,i){const s=t.name,a=o.layers?o.layers.find(g=>g.layerName===s):void 0,l=new Ar.Z({target:t.copyrightText});let c,u;if(t.timeInfo){const g=t.timeInfo.timeExtent;c=g[0]+","+g[1];const h=new Date;h.setTime(g[0]);const m=new Date;m.setTime(g[1]),u={min:h.toUTCString(),max:m.toUTCString(),range:!0,type:st.DATETIME,style:Ut.CALENDAR}}const p=Object.assign({},{LAYERS:r.layer?"show:"+r.layer:void 0,time:c}),d=R.removeUndefined({params:p,_layerOptionsFromSource:{title:s,minResolution:rt(t.maxScale),maxResolution:rt(t.minScale),metadata:{extern:!1,abstract:t.description||i.serviceDescription}},legendInfo:a,timeFilter:u,sourceFields:t.fields,queryTitle:t.displayField});return d.attributions=l,R.mergeDeep(d,r)}findDataSourceInCapabilities(r,t){if(Array.isArray(r)){let o;return r.find(i=>(o=this.findDataSourceInCapabilities(i,t),void 0!==o),this),o}return r.Layer?this.findDataSourceInCapabilities(r.Layer,t):r.Name&&r.Name===t?r:void 0}getTimeFilter(r){let t;if(r.Dimension){const o={};if(t=r.Dimension[0],t.values){const i=t.values.split("/");o.min=void 0!==i[0]?i[0]:void 0,o.max=void 0!==i[1]?i[1]:void 0,o.step=void 0!==i[2]?i[2]:void 0}return t.default&&(o.value=t.default),o}}getStyle(r){return{stylesAvailable:r.map(i=>({name:i.Name,title:i.Title})).filter((i,s,a)=>a.findIndex(l=>l.name===i.name)===s)}}static \u0275fac=function(t){return new(t||Zt)(e.LFG($.eN),e.LFG(Gt))};static \u0275prov=e.Yz7({token:Zt,factory:Zt.\u0275fac,providedIn:"root"})}(0,T.gn)([(0,Mt.q)({maxCacheCount:20}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[Object]),(0,T.w6)("design:returntype",ue.y)],Zt.prototype,"getArcgisOptions",null),(0,T.gn)([(0,Mt.q)({maxCacheCount:20}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[Object]),(0,T.w6)("design:returntype",ue.y)],Zt.prototype,"getImageArcgisOptions",null),(0,T.gn)([(0,Mt.q)({maxCacheCount:20}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[Object]),(0,T.w6)("design:returntype",ue.y)],Zt.prototype,"getTileArcgisOptions",null),(0,T.gn)([(0,Mt.q)({maxCacheCount:20}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[String,String,String]),(0,T.w6)("design:returntype",ue.y)],Zt.prototype,"getCapabilities",null);class yy{}let _t=(()=>{class n{capabilitiesService;optionsService;wfsDataSourceService;languageService;messageService;projectionService;authInterceptor;datasources$=new y.X([]);constructor(t,o,i,s,a,l,c){this.capabilitiesService=t,this.optionsService=o,this.wfsDataSourceService=i,this.languageService=s,this.messageService=a,this.projectionService=l,this.authInterceptor=c}createAsyncDataSource(t,o){if(!t.type)throw console.error(t),new Error("Datasource needs a type");let i;switch(t.type.toLowerCase()){case"osm":i=this.createOSMDataSource(t);break;case"vector":i=this.createFeatureDataSource(t);break;case"wfs":i=this.createWFSDataSource(t);break;case"wms":const s=t;R.removeDuplicateCaseInsensitive(s.params),i=this.createWMSDataSource(s,o);break;case"wmts":i=this.createWMTSDataSource(t);break;case"xyz":i=this.createXYZDataSource(t);break;case"tiledebug":i=this.createTileDebugDataSource(t);break;case"carto":i=this.createCartoDataSource(t);break;case"arcgisrest":i=this.createArcGISRestDataSource(t,o);break;case"imagearcgisrest":i=this.createArcGISRestImageDataSource(t,o);break;case"websocket":i=this.createWebSocketDataSource(t);break;case"mvt":i=this.createMVTDataSource(t);break;case"tilearcgisrest":i=this.createTileArcGISRestDataSource(t,o);break;case"cluster":i=this.createClusterDataSource(t);break;default:throw console.error(t),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([i])),i}createOSMDataSource(t){return new ue.y(o=>o.next(new uu(t)))}createFeatureDataSource(t){return new ue.y(o=>o.next(new Ae(t)))}createWebSocketDataSource(t){return new ue.y(o=>o.next(new hu(t)))}createWFSDataSource(t){return new ue.y(o=>o.next(new Lr(t,this.wfsDataSourceService,this.authInterceptor)))}createWMSDataSource(t,o){const i=[];return t.optionsFromCapabilities&&window.navigator.onLine&&i.push(this.capabilitiesService.getWMSOptions(t).pipe((0,ce.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.params.LAYERS}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&i.push(this.optionsService.getWMSOptions(t,o).pipe((0,ce.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,z.of)({}))))),i.push((0,z.of)(t)),(0,Qt.D)(i).pipe((0,I.U)(s=>{const a=s.reduce((l,c)=>R.mergeDeep(l,c));return new xo(a,this.wfsDataSourceService)}),(0,ce.K)(()=>(0,z.of)(void 0)))}createWMTSDataSource(t){return t.optionsFromCapabilities&&window.navigator.onLine?this.capabilitiesService.getWMTSOptions(t).pipe((0,I.U)(o=>o?new ma(o):void 0),(0,ce.K)(()=>(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.layer}),(0,z.of)(void 0)))):new ue.y(o=>o.next(new ma(t)))}createXYZDataSource(t){return new ue.y(o=>o.next(new pu(t)))}createTileDebugDataSource(t){return new ue.y(o=>o.next(new mu(t)))}createCartoDataSource(t){return t.mapId?this.capabilitiesService.getCartoOptions(t).pipe((0,I.U)(o=>new Mr(o))):new ue.y(o=>o.next(new Mr(t)))}createArcGISRestDataSource(t,o){const i=[];return window.navigator.onLine&&i.push(this.capabilitiesService.getArcgisOptions(t).pipe((0,ce.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.layer}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&i.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,ce.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,z.of)({}))))),i.push((0,z.of)(t)),(0,Qt.D)(i).pipe((0,I.U)(s=>{const a=s.reduce((l,c)=>R.mergeDeep(l,c));return new ha(a)}),(0,ce.K)(()=>(0,z.of)(void 0)))}createArcGISRestImageDataSource(t,o){const i=[];return window.navigator.onLine&&i.push(this.capabilitiesService.getImageArcgisOptions(t).pipe((0,ce.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.params.LAYERS}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&i.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,ce.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,z.of)({}))))),i.push((0,z.of)(t)),(0,Qt.D)(i).pipe((0,I.U)(s=>{const a=s.reduce((l,c)=>R.mergeDeep(l,c));return new fa(a)}),(0,ce.K)(()=>(0,z.of)(void 0)))}createTileArcGISRestDataSource(t,o){const i=[];return window.navigator.onLine&&i.push(this.capabilitiesService.getImageArcgisOptions(t).pipe((0,ce.K)(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:t.params.LAYERS}),s}))),this.optionsService&&t.optionsFromApi&&window.navigator.onLine&&i.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,ce.K)(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,z.of)({}))))),i.push((0,z.of)(t)),(0,Qt.D)(i).pipe((0,I.U)(s=>{const a=s.reduce((l,c)=>R.mergeDeep(l,c));return new Fn(a)}),(0,ce.K)(()=>(0,z.of)(void 0)))}createMVTDataSource(t){return new ue.y(o=>o.next(new yu(t)))}createClusterDataSource(t){return new ue.y(o=>o.next(new bo(t)))}static \u0275fac=function(o){return new(o||n)(e.LFG(Zt),e.LFG(yy,8),e.LFG(ay),e.LFG(L),e.LFG(_e),e.LFG(On),e.LFG(sr))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function oi(n,r){void 0===n.layer?(r=r||new xe({source:new Ae}),n.bindLayer(r),void 0===n.layer.map&&n.map.addLayer(n.layer)):void 0===n.layer.map&&n.map.addLayer(n.layer)}class yt extends hr{layer;map;get source(){return this.layer?this.layer.dataSource:void 0}set searchDocument(r){this._searchDocument=r}get searchDocument(){return this._searchDocument}_searchDocument;constructor(r,t){super(r,t),this.map=t.map}bindLayer(r){return this.layer=r,this}setLayerFeatures(r,t=Y.Default,o,i,s){s=s||gr,this.checkLayer();const a=r.map(l=>ft(l,this.map.projection,s));this.setLayerOlFeatures(a,t,o,i)}setStoreOlFeatures(r){this.checkLayer();const t=r.map(o=>(o.set("_featureStore",this,!0),Li(o,this.layer.map.projection)));this.load(t)}clearLayer(){this.checkLayer(),this.source.ol.clear()}checkLayer(){if(void 0===this.layer)throw new Error("This FeatureStore is not bound to a layer.")}setLayerOlFeatures(r,t=Y.Default,o,i){const a=function iy(n,r){const t=new Map;r.forEach(a=>{t.set(a.getId(),a)});const o=[];n.forEach(a=>{const l=t.get(a.getId());void 0===l||l.get("_entityRevision")!==a.get("_entityRevision")?o.push(a):t.delete(l.getId())});const i=Array.from(t.keys());return{add:r.filter(a=>i.indexOf(a.getId())>=0),remove:o}}(this.layer.ol.getSource().getFeatures(),r);a.remove.length>0&&this.removeOlFeaturesFromLayer(a.remove),a.add.length>0&&this.addOlFeaturesToLayer(a.add),a.add.length>0?vo(this.map.viewController,a.add,t,o,i):a.remove.length>0&&vo(this.map.viewController,r,t,o,i)}setLayerExtent(){let r=this.entities$.getValue(),t=De.lJ(),o=[];r.forEach(s=>{o.push(ft(s,this.map.projection))});const i=Tn(o,this.map.viewProjection);De.l7(t,i),this.layer.setExtent(t)}addOlFeaturesToLayer(r){r.forEach(t=>{t.set("_featureStore",this,!0)}),this.source.ol.addFeatures(r)}removeOlFeaturesFromLayer(r){r.forEach(t=>{this.source.ol.removeFeature(t)})}}class An extends $o{options;stores$$=new Map;states$$=[];empty$$;constructor(r){super(r),this.options=r}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r),this.empty$$=r.empty$.pipe((0,Kt.n)(t=>!t)).subscribe(()=>this.updateEntitiesInExtent(r))}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){this.stores$$.has(r)||(this.updateEntitiesInExtent(r),this.states$$.push(r.layer.map.viewController.state$.pipe((0,ae.b)(250)).subscribe(()=>this.updateEntitiesInExtent(r))))}updateEntitiesInExtent(r){if(r?.layer?.map?.viewController){r.state.updateAll({inMapExtent:!1});const t=r.layer.map.viewController.getExtent(),i=this.getFeaturesInExtent(r.entities$.value,t);r.state.updateMany(i,{inMapExtent:!0},!1)}}getFeaturesInExtent(r,t){return r.reduce((o,i)=>{const s=i.ol?.getGeometry();if(s){const a=s.getExtent();De.kK(a,t)&&o.push(i)}else o.push(i);return o},[])}unwatchStore(r){void 0!==this.stores$$.get(r)&&this.stores$$.delete(r)}unwatchAll(){this.stores$$.clear(),this.states$$.map(r=>r.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}class Zr extends $o{options;stores$$=new Map;resolution$$=[];empty$$;constructor(r){super(r),this.options=r}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r),this.empty$$=r.empty$.subscribe(()=>this.updateEntitiesInResolution(r,r.layer.map.viewController.getResolution()))}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){this.stores$$.has(r)||(this.updateEntitiesInResolution(r,r.layer.map.viewController.getResolution()),this.resolution$$.push(r.layer.map.viewController.resolution$.pipe((0,ae.b)(250)).subscribe(t=>{this.updateEntitiesInResolution(r,t)})))}updateEntitiesInResolution(r,t){r.state.updateAll(t>r.layer.minResolution&&t<r.layer.maxResolution?{inMapResolution:!0}:{inMapResolution:!1})}unwatchStore(r){void 0!==this.stores$$.get(r)&&this.stores$$.delete(r)}unwatchAll(){this.stores$$.clear(),this.resolution$$.map(r=>r.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}class _a extends $o{options;propertyTypeDetectorService;capabilitiesService;stores$$=new Map;states$$=[];empty$$;map;constructor(r,t,o){super(r),this.options=r,this.propertyTypeDetectorService=t,this.capabilitiesService=o,this.map=r.map}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){this.stores$$.has(r)||(this.updateEntitiesPropertiesState(r),this.states$$.push(this.map.layers$.pipe((0,ae.b)(250),(0,su.G)()).subscribe(([t,o])=>{let i;t&&(i=t.map(a=>a.id));const s=o.filter(a=>!i.includes(a.id));this.updateEntitiesPropertiesState(r,s)})),this.states$$.push(r.entities$.pipe((0,ae.b)(250)).subscribe(t=>{this.updateEntitiesPropertiesState(r)})))}updateEntitiesPropertiesState(r,t){const o=this.map.layers.map(g=>g.id);let i=[];i=t?r.entities$.value:r.stateView.all().length?r.stateView.all().filter(h=>!h.state.geoService).map(h=>h.entity):r.entities$.value;const a=i.slice(0,i.length>=250?250:i.length);let l=[];a.map(g=>{l=l.concat(Object.keys(g.properties||{}))}),l=[...new Set(l)];const c={};l.map(g=>{c[g]=[...new Set(i.map(h=>h.properties[g]))]});const u={};Object.entries(c).forEach(g=>{const[h,m]=g,b=m.filter(C=>this.propertyTypeDetectorService.isGeoService(C));b?.length&&(u[h]=b)});const p=[];Object.entries(u).forEach(g=>{const[h,m]=g;m.map(b=>{const C=this.propertyTypeDetectorService.getGeoService(b,l);if(C){const x=l.filter(M=>C.propertiesForLayerName.includes(M)),A=x.length?x[0]:void 0;A&&p.push({url:b,urlProperty:h,layerNameProperty:A,geoService:C})}})});const d=[];p.map(g=>{const h=g.url,m=g.geoService.type||"wms";c[g.layerNameProperty].map(b=>{let x,C=b;["arcgisrest","imagearcgisrest","tilearcgisrest"].includes(m)&&(C=void 0,x=b);const M=Oi(R.removeUndefined({sourceOptions:{type:m||"wms",url:h,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:C,LAYER:x}}}).sourceOptions);d.push({geoServiceAssociation:g,state:{added:void 0!==o.find(k=>k===M),haveGeoServiceProperties:!0,type:m,url:h,layerName:b}})})}),d.map(g=>{const h=g.geoServiceAssociation.urlProperty,m=g.geoServiceAssociation.layerNameProperty,b=g.state.url,C=g.state.layerName,x=i.filter(M=>M.properties[h]===b&&M.properties[m]===C);r.state.updateMany(x,{geoService:g.state},!0)})}unwatchStore(r){void 0!==this.stores$$.get(r)&&this.stores$$.delete(r)}unwatchAll(){this.stores$$.clear(),this.states$$.map(r=>r.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}class qt extends $o{options;stores$$=new Map;motion;constructor(r){super(r),this.options=r,this.setMotion(r.motion)}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}setMotion(r){this.motion=r}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){if(this.stores$$.has(r))return;const t=r.view.all$().subscribe(o=>this.onFeaturesChange(o,r));this.stores$$.set(r,t)}unwatchStore(r){const t=this.stores$$.get(r);void 0!==t&&(t.unsubscribe(),this.stores$$.delete(r))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(r=>{r[1].unsubscribe()}),this.stores$$.clear()}onFeaturesChange(r,t){0===r.length?t.clearLayer():t.setLayerFeatures(r,this.selectMotion(t),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}selectMotion(r){return void 0!==this.motion?this.motion:!0===r.pristine||r.count>r.view.count?Y.Default:Y.None}}class Pr extends $o{options;stores$$=new Map;constructor(r){super(r),this.options=r}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}watchStore(r){this.stores$$.has(r)||(this.onSourceChanges(r),r.layer.ol.getSource().on("change",o=>{this.onSourceChanges(r)}))}unwatchStore(r){void 0!==this.stores$$.get(r)&&this.stores$$.delete(r)}unwatchAll(){Array.from(this.stores$$.entries()).forEach(r=>{}),this.stores$$.clear()}onSourceChanges(r){let t=r.layer.ol.getSource().getFeatures();r.layer.dataSource instanceof bo&&(t=t.flatMap(o=>o.get("features"))),0===t.length?r.clear():r.setStoreOlFeatures(t)}}var bu=v(49368);class kr extends bu.Z{constructor(r){super(r)}}class Tt extends $o{options;mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;stores$$;motion;get map(){return this.options.map}get overlayStore(){return this._overlayStore}_overlayStore;constructor(r){super(r),this.options=r,this.setMotion(r.motion),this._overlayStore=this.createOverlayStore()}bindStore(r){super.bindStore(r),!0===this.active&&this.activate()}unbindStore(r){super.unbindStore(r),!0===this.active&&this.activate()}setMotion(r){this.motion=r}unselectAll(){this.stores.forEach(r=>{r.state.updateAll({selected:!1})})}clear(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}deactivateSelection(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}doActivate(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()}doDeactivate(){this.deactivateSelection(),this.removeOverlayLayer()}watchAll(){this.unwatchAll();const r=this.stores.map(t=>t.stateView.manyBy$(o=>!0===o.state.selected).pipe((0,I.U)(o=>o.map(i=>i.entity))));this.stores$$=(0,Ye.a)(r).pipe((0,ae.b)(5),(0,Ci.T)(1),(0,I.U)(t=>t.reduce((o,i)=>o.concat(i)))).subscribe(t=>this.onSelectFromStore(t))}unwatchAll(){void 0!==this.stores$$&&this.stores$$.unsubscribe()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",r=>{this.onMapClick(r)})}unlistenToMapClick(){(0,Ke.B)(this.mapClickListener)}onMapClick(r){const t=!wr(r),o=!t,i=r.map.getFeaturesAtPixel(r.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:s=>void 0!==this.stores.find(l=>l.layer?.ol===s)});this.onSelectFromMap(i,t,o)}addDragBoxInteraction(){let r;const t=this.map.ol.getInteractions().getArray();for(const o of t)if(o instanceof kr){r=o;break}void 0===r&&(r=new kr({condition:wr}),this.map.ol.addInteraction(r),this.olDragSelectInteraction=r),this.olDragSelectInteractionEndKey=r.on("boxend",o=>this.onDragBoxEnd(o))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,Ke.B)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}onDragBoxEnd(r){const t=!wr(r.mapBrowserEvent),i=r.target.getGeometry().getExtent(),s=this.stores.reduce((a,l)=>{const c=l.layer.ol.getSource();return a.push(...c.getFeaturesInExtent(i)),a},[]);this.onSelectFromMap(s,t,!1)}onSelectFromStore(r){const t=this.motion,i=this.overlayStore.layer.ol.getSource().getFeatures().map(l=>l.getId()),s=r.map(this.overlayStore.getKey);let a;a=0!==r.length&&(i.length!==s.length||!i.every(l=>s.indexOf(l)>=0)),this.overlayStore.setLayerFeatures(r,a?t:Y.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}onSelectFromMap(r,t,o){const i=this.groupFeaturesByStore(r);this.stores.forEach(s=>{const a=i.get(s);void 0===a&&!0===t?this.unselectAllFeaturesFromStore(s):void 0===a&&!1===t||this.selectFeaturesFromStore(s,a,t,o)})}selectFeaturesFromStore(r,t,o,i){!0===i?r.state.reverseMany(t,["selected"]):r.state.updateMany(t,{selected:!0},o)}unselectAllFeaturesFromStore(r){r.state.updateAll({selected:!1})}groupFeaturesByStore(r){const t=new Map;return null==r||r.forEach(o=>{const i=o.get("_featureStore");if(void 0===i)return;let s=t.get(i);void 0===s&&(s=[],t.set(i,s));const a=i.get(o.getId());void 0!==a&&s.push(a)}),t}createOverlayStore(){const r=this.options.layer?this.options.layer:this.createOverlayLayer();return new yt([],{map:this.map}).bindLayer(r)}createOverlayLayer(){return new xe({zIndex:300,source:new Ae,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}addOverlayLayer(){void 0===this.overlayStore.layer.map&&this.map.addLayer(this.overlayStore.layer)}removeOverlayLayer(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)}}var vu=v(85524);class vy extends $o{options;stores$$=new Map;constructor(r){super(r),this.options=r}bindStore(r){super.bindStore(r),!0===this.active&&this.watchStore(r)}unbindStore(r){super.unbindStore(r),!0===this.active&&this.unwatchStore(r)}doActivate(){this.stores.forEach(r=>this.watchStore(r))}doDeactivate(){this.unwatchAll()}initStoreSearchIndex(r){r.searchDocument=new vu.Document({tokenize:"full"})}watchStore(r){this.stores$$.has(r)||(this.initStoreSearchIndex(r),r.entities$.pipe((0,Kt.n)(t=>!t.length)).subscribe(()=>this.onEntitiesChanges(r)))}unwatchStore(r){void 0!==this.stores$$.get(r)&&(r.searchDocument=void 0,this.stores$$.delete(r))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(r=>{}),this.stores$$.clear()}onEntitiesChanges(r){const t=this.options.percentDistinctValueRatio||2,o=[];r.index.forEach((l,c)=>{const u=l.properties;u.igoSearchID=c,o.push(u)});const i=[];let s=[],a=[];if(this.options.sourceFields)s=this.options.sourceFields.filter(l=>!l.searchIndex?.enabled),a=this.options.sourceFields.filter(l=>l.searchIndex?.enabled).map(l=>Object.assign({},{field:l.name,tokenize:"full"},l.searchIndex));else if(o.length){const l=Object.keys(o[0]),c=[];s=l.map(p=>{const d=[...new Set(o.map(g=>g[p]))];d.length/o.length*100<=t||d.every(g=>Number(g)===g&&g%1!=0)?s.push(p):c.push(p)}).filter(p=>p),a=c.filter(p=>"igoSearchID"!==p).map(p=>({field:p,tokenize:"full"}))}r.index.forEach((l,c)=>{const u=JSON.parse(JSON.stringify(l.properties));s.map(p=>delete u[p]),Object.keys(u).length&&i.push(u)}),0===i.length?this.initStoreSearchIndex(r):(r.searchDocument=new vu.Document({document:{id:"igoSearchID",index:a}}),i.map(l=>{r.searchDocument.add(l.igoSearchID,l)}))}}function Yi(n,r){void 0===n.getStrategyOfType(qt)?(r=r||new qt({}),n.addStrategy(r),r.activate()):n.activateStrategyOfType(qt)}function ya(n,r){void 0===n.getStrategyOfType(Tt)?(r=r||new Tt({map:n.map}),n.addStrategy(r),r.activate()):n.activateStrategyOfType(Tt)}function Cy(){const n=Cu(),r=Xo();let t;return(o,i)=>{if("bufferFeature"===o.getId())return t=function xy(n=[0,161,222,1],r=2,t=[0,161,222,.15],o){const i=new U.Z({width:r,color:n}),s=new q.Z({color:t});return new J.ZP({stroke:i,fill:s,image:new Te.Z({radius:5,stroke:i,fill:s}),text:new St.Z({font:"12px Calibri,sans-serif",text:o,fill:new q.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0})})}(o.get("bufferStroke"),2,o.get("bufferFill"),o.get("bufferText")),t;{const s=o.get("_style");return s?(new yo).createStyle(s,o,i):(t="Point"===o.getGeometry().getType()?r:n,t.getText().setText(o.get("_mapTitle")),t)}}}function Cu({text:n,strokeWidth:r=2,fillColor:t=[0,161,222,.3],strokeColor:o=[0,161,222,.9]}={}){const i=(0,_o._2)(t).slice(0),s=(0,_o._2)(o).slice(0),a=new U.Z({width:r,color:s}),l=new q.Z({color:i});return new J.ZP({stroke:a,fill:l,image:new Te.Z({radius:5,stroke:a,fill:l}),text:new St.Z({text:n,font:"12px Calibri,sans-serif",fill:new q.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0})})}class $r{map;layer;get dataSource(){return this.layer.dataSource}constructor(r){this.layer=function Sy(){const n=new Ae;return new xe({title:"Overlay",zIndex:300,source:n,style:Cy()})}(),this.setMap(r)}setMap(r){void 0===r?void 0!==this.map&&this.map.ol.removeLayer(this.layer.ol):r.ol.addLayer(this.layer.ol),this.map=r}setFeatures(r,t=Y.Default,o){if(o)for(const i of this.dataSource.ol.getFeatures())i.get("_sourceId")===o&&this.removeOlFeature(i);else this.clear();this.addFeatures(r,t)}addFeature(r,t=Y.Default){this.addFeatures([r],t)}addFeatures(r,t=Y.Default){const o=[];r.forEach(i=>{const s=ft(i,this.map.projection);null!==s.getGeometry()&&o.push(s)}),this.addOlFeatures(o,t)}addOlFeature(r,t=Y.Default){this.addOlFeatures([r],t)}addOlFeatures(r,t=Y.Default){this.dataSource.ol.addFeatures(r),vo(this.map.viewController,r,t)}removeFeature(r){this.removeFeatures([r])}removeFeatures(r){r.forEach(t=>{t.meta&&this.dataSource.ol.getFeatureById(t.meta.id)&&this.removeOlFeature(this.dataSource.ol.getFeatureById(t.meta.id))})}removeOlFeature(r){this.dataSource.ol.removeFeature(r)}clear(){this.dataSource.ol.clear()}}class wy extends or{propertyChange$=new y.X(void 0);loaded=0;loading=0;layers=[];subscriptions=[];constructor(){super()}watch(){}unwatch(){this.layers.forEach(r=>this.unwatchLayer(r),this)}setPropertyChange(r,t){[Ge.TIMEFILTER,Ge.OGCFILTERS,Ge.VISIBLE,Ge.OPACITY,Ge.MINRESOLUTION,Ge.MAXRESOLUTION].includes(r.key)&&this.propertyChange$.next({event:r,layer:t})}watchLayer(r){if(void 0===r.status$)return;r.ol.on("propertychange",o=>this.setPropertyChange(o,r)),r.dataSource.ol.on("propertychange",o=>this.setPropertyChange(o,r)),this.layers.push(r);const t=r.status$.pipe((0,fi.x)()).subscribe(o=>{o===ge.Error&&(this.loading=0,this.loaded=-1),o===ge.Working?this.loading+=1:o===ge.Done&&(this.loaded+=1),this.loaded>=this.loading?(this.loading=this.loaded=0,this.status=ge.Done):this.loading>0&&(this.status=ge.Working)});this.subscriptions.push(t)}unwatchLayer(r){r.ol.un("propertychange",o=>this.setPropertyChange(o,r)),r.dataSource.ol.un("propertychange",o=>this.setPropertyChange(o,r)),r.status$.next(ge.Done);const t=this.layers.indexOf(r);t>=0&&(-1!==[ge.Working,ge.Waiting].indexOf(r.watcher.status)&&(this.loaded+=1),this.subscriptions[t].unsubscribe(),this.subscriptions.splice(t,1),this.layers.splice(t,1),r.watcher.unwatch())}}var Ty=v(99033),ii=v(32796),Hi=v(17900),xu=v(13379);class Su{olMap;observerKeys=[];getOlMap(){return this.olMap}setOlMap(r){if(void 0!==r&&void 0!==this.getOlMap())throw new Error("This controller is already bound to a map.");if(void 0===r)return this.teardownObservers(),void(this.olMap=r);this.olMap=r}teardownObservers(){this.observerKeys.forEach(r=>(0,Ke.B)(r)),this.observerKeys=[]}}var bt=function(n){return n.Position="position",n.PositionDirection="positionDirection",n.Accuracy="accuracy",n.Buffer="buffer",n}(bt||{});class Fy extends Su{map;options;storageService;configService;arrowRotation;subscriptions$$=[];geolocationOverlay;positionFeatureStyle=new J.ZP({image:new Te.Z({radius:6,fill:new q.Z({color:"#3399CC"}),stroke:new U.Z({color:"#fff",width:2})})});accuracyFeatureStyle=new J.ZP({stroke:new U.Z({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new q.Z({color:"rgba(120, 120, 120, 0.4)"})});get bufferStyle(){return new J.ZP({stroke:new U.Z({width:2,color:this.buffer.bufferStroke}),fill:new q.Z({color:this.buffer.bufferFill}),text:new St.Z({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?`${this.buffer.bufferRadius}m`:"",fill:new q.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3})})})}get arrowStyle(){return new J.ZP({image:new Ti.Z({radius:5.5,fill:new q.Z({color:"rgba(0, 132, 202)"}),stroke:new U.Z({color:"#fff",width:1.5}),points:3,displacement:[0,9],rotation:this.arrowRotation,rotateWithView:!0})})}geolocation;emissionIntervalSeconds$=new y.X(5);position$=new y.X(void 0);tracking$=new y.X(void 0);followPosition$=new y.X(void 0);lastPosition;set buffer(r){this._buffer=r,this.handleFeatureCreation(this.position$.value)}get buffer(){return this._buffer}_buffer;set accuracyThreshold(r){this._accuracyThreshold=r,this.handleFeatureCreation(this.position$.value)}get accuracyThreshold(){return this._accuracyThreshold}_accuracyThreshold;get olGeolocation(){return this.geolocation}get tracking(){return this.geolocation.getTracking()}set tracking(r){this.geolocation.setTracking(r||!1),this.tracking$.next(r),this.storageService&&void 0!==r&&this.storageService.set("geolocation.tracking",r),r||this.position$.next(void 0)}set followPosition(r){this._followPosition=r,this.followPosition$.next(r),!1===this.configService?.getConfig("geolocate.followPosition")&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&void 0!==r&&this.storageService.set("geolocation.followPosition",r)}get followPosition(){return this._followPosition}_followPosition;constructor(r,t,o,i){super(),this.map=r,this.options=t,this.storageService=o,this.configService=i,this.geolocationOverlay=new $r(this.map),this._followPosition=!(!this.options||!this.options.followPosition)&&this.options.followPosition,this._buffer=this.options&&this.options.buffer?this.options.buffer:void 0,this._accuracyThreshold=this.options&&this.options.accuracyThreshold?this.options.accuracyThreshold:5e3}setOlMap(r){super.setOlMap(r),this.setupObservers()}deleteGeolocationFeatures(){this.deleteFeatureByType(bt.Position),this.deleteFeatureByType(bt.PositionDirection),this.deleteFeatureByType(bt.Accuracy),this.deleteFeatureByType(bt.Buffer)}setupObservers(){this.tracking$.subscribe(t=>{t?this.onPositionChange(!0,!0):this.deleteGeolocationFeatures()}),this.geolocation=new Ty.Z({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});let r=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe((0,Oc.w)(t=>(0,xu.F)(1e3*t))).subscribe(()=>{r===this.tracking?this.onPositionChange(!0):(r=this.tracking,this.onPositionChange(!0,!0))})),this.geolocation.on("change",t=>{this.onPositionChange(!1,!1)})}updateArrowFeatureOrientation(r){const t=Q.vs(r.position,r.projection,"EPSG:4326");if(!this.lastPosition)return void(this.lastPosition={coordinates:t,dateTime:new Date});const o=this.getFeatureByType(bt.PositionDirection),i=r?.speed>1.25&&this.distanceBetweenPoints(this.lastPosition.coordinates,t)>.003;if(r.accuracy<=this.accuracyThreshold&&i){var l=Math.atan2(t[0]-this.lastPosition.coordinates[0],t[1]-this.lastPosition.coordinates[1]);l<0&&(l=2*Math.PI+l),this.arrowRotation=l,o&&o.setStyle(this.arrowStyle),this.lastPosition={coordinates:t,dateTime:new Date}}else o&&(new Date).getTime()-this.lastPosition.dateTime.getTime()>3e3&&cu(o)}distanceBetweenPoints(r,t){return Hi.Sp(r,t)/1e3}addOnChangedListener(r){let t=()=>{r(this.geolocation)};return this.geolocation.on("change",t),t}deleteChangedListener(r){this.geolocation.un("change",r)}updateGeolocationOptions(r){if(!r)return;let t=r.geolocate,o=r.alwaysTracking;if(this.storageService){const i=this.storageService.get("geolocation.tracking");null!=i&&(t=i);const s=this.storageService.get("geolocation.followPosition");null!=s&&(o=s)}this.tracking=t,this.followPosition=o,this.buffer=r.buffer}teardownObservers(){this.subscriptions$$.length&&this.subscriptions$$.map(r=>r.unsubscribe()),super.teardownObservers()}onPositionChange(r=!1,t=!1){if(!this.tracking)return;const o=this.geolocation.getProperties();if(o.accuracy>this.accuracyThreshold)return console.warn("Poor geolocation accuracy. No position are stored/shown"),void this.position$.next(void 0);const i={position:o.position,projection:this.geolocation.getProjection().getCode(),accuracy:o.accuracy,altitude:o.altitude,altitudeAccuracy:o.altitudeAccuracy,heading:o.heading,speed:o.speed,enableHighAccuracy:!!o.trackingOptions?.enableHighAccuracy,timestamp:new Date};this.handleFeatureCreation(i),this.handleViewFromFeatures(i,t),r&&this.position$.next(i)}getFeatureByType(r){return this.geolocationOverlay.dataSource.ol.getFeatureById(r)}deleteFeatureByType(r){const t=this.geolocationOverlay?.dataSource.ol.getFeatureById(r);t&&this.geolocationOverlay.dataSource.ol.removeFeature(t)}handleFeatureCreation(r){if(!r||!r.position)return;const t=new Ee.Z(r.position),o=(0,Rt.Bb)(new ii.Z(r.position,r.accuracy||0));let i=this.getFeatureByType(bt.Position),s=this.getFeatureByType(bt.PositionDirection),a=this.getFeatureByType(bt.Accuracy);const l=!!i,c=!!s,u=!!a;if(c||(s=new Ze.Z({geometry:t}),s.setId(bt.PositionDirection),cu(s)),l||(i=new Ze.Z({geometry:t}),i.setId(bt.Position),i.setStyle(this.positionFeatureStyle)),u||(a=new Ze.Z({geometry:o}),a.setId(bt.Accuracy),a.setStyle(this.accuracyFeatureStyle)),t&&(l?i.setGeometry(t):this.geolocationOverlay.addOlFeature(i,Y.None),c?s.setGeometry(t):this.geolocationOverlay.addOlFeature(s,Y.None),this.updateArrowFeatureOrientation(r),u?a.setGeometry(o):this.geolocationOverlay.addOlFeature(a,Y.None),this.buffer)){let p=this.getFeatureByType(bt.Buffer);const d=!!p,g=new ii.Z(r.position,this.buffer.bufferRadius);d||(p=new Ze.Z(g),p.setId(bt.Buffer),p.setStyle(this.positionFeatureStyle)),p.setStyle(this.bufferStyle),d?p.setGeometry(g):this.geolocationOverlay.addOlFeature(p,Y.None)}}handleViewFromFeatures(r,t=!1){const l=[this.getFeatureByType(bt.Position),this.getFeatureByType(bt.PositionDirection),this.getFeatureByType(bt.Accuracy),this.getFeatureByType(bt.Buffer)].filter(c=>c);if(l.length>0){const c=Tn(l,this.map.viewProjection),u=r?.speed>12.5?[.25,.25,.25,.25]:[.15,.1,.1,.1],p=ga(this.map.getExtent(),c,u);let d=this.followPosition&&p?Y.Move:Y.None;t&&(d=Y.Zoom),d!==Y.None&&vo(this.map.viewController,l,d)}}}var Dr=function(n){return n[n.Move=0]="Move",n[n.Zoom=1]="Zoom",n}(Dr||{});class Oy extends Su{options;rotation$=new y.X(0);resolution$=new y.X(void 0);state$=new y.X(void 0);padding=[0,0,0,0];maxZoomOnExtent=19;maxLayerZoomExtent;extent$=new fe.x;extent$$;states=[];stateIndex=0;get stateHistory(){return!!this.options&&!0===this.options.stateHistory}get olView(){return this.olMap.getView()}constructor(r){super(),this.options=r}setPadding(r){(r.top||0===r.top)&&(this.padding[0]=r.top),(r.right||0===r.right)&&(this.padding[1]=r.right),(r.bottom||0===r.bottom)&&(this.padding[2]=r.bottom),(r.left||0===r.left)&&(this.padding[3]=r.left)}setOlMap(r){super.setOlMap(r),this.setupObservers()}setupObservers(){!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",r=>this.onMoveEnd(r))),this.extent$$=this.extent$.pipe((0,ae.b)(25)).subscribe(r=>{this.setExtent(r.extent,r.action)})}monitorRotation(){this.observerKeys.push(this.olMap.getView().on("change:rotation",r=>{this.rotation$.next(r.target.getRotation())}))}teardownObservers(){super.teardownObservers(),void 0!==this.extent$$&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}getOlProjection(){return this.olView.getProjection()}getCenter(r){let t=this.olView.getCenter();return r&&t&&(t=Q.vs(t,this.getOlProjection(),r)),t}getExtent(r){let t=this.olView.calculateExtent(this.olMap.getSize());return r&&t&&(t=Q.$A(t,this.getOlProjection(),r)),t}getScale(r=96){return function M_(n,r="m",t=96){return n*Q.Wm[r]*39.3701*t}(this.getResolution(),this.getOlProjection().getUnits(),r)}getResolution(){return this.olView.getResolution()}getZoom(){return Math.round(this.olView.getZoom())}zoomIn(){this.zoomTo(this.olView.getZoom()+1)}zoomOut(){this.zoomTo(this.olView.getZoom()-1)}zoomTo(r){this.olView.cancelAnimations(),this.olView.animate({zoom:r,duration:250,easing:Cn.Vv})}moveToExtent(r){this.extent$.next({extent:r,action:Dr.Move})}zoomToExtent(r){this.extent$.next({extent:r,action:Dr.Zoom})}getRotation(){return this.olView.getRotation()}resetRotation(){this.olView.animate({rotation:0})}hasPreviousState(){return this.states.length>1&&this.stateIndex>0}hasNextState(){return this.states.length>1&&this.stateIndex<this.states.length-1}previousState(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}nextState(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}clearStateHistory(){this.states=[],this.stateIndex=0}setInitialState(){this.states.length>0&&this.setStateIndex(0)}setExtent(r,t,o=!0){const i=this.olView;i.cancelAnimations();const s=o?500:0,a=i.getZoom(),l=i.getCenter(),c=[r[0]+(r[2]-r[0])/2,r[1]+(r[3]-r[1])/2],u=Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)),p=i.calculateExtent(),d=Math.sqrt(Math.pow(p[2]-p[0],2)+Math.pow(p[3]-p[1],2)),m=u/((Math.sqrt(Math.pow(r[2]-r[0],2)+Math.pow(r[3]-r[1],2))+d)/2),b=t===Dr.Move||a>this.maxZoomOnExtent?a:this.maxZoomOnExtent;i.fit(r,{size:this.olMap.getSize(),maxZoom:b,padding:this.padding,duration:m>4?0:s,callback:C=>{C||i.fit(r,{size:this.olMap.getSize(),maxZoom:b,padding:this.padding,duration:m>4?0:s})}})}setStateIndex(r){this.stateIndex=r,this.setState(this.states[r])}setState(r){this.olView.animate({resolution:r.resolution,center:r.center,duration:0})}onMoveEnd(r){const t=this.getResolution();this.resolution$.value!==t&&this.resolution$.next(t);const o={resolution:t,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){const i=this.stateIndex;(function L_(n,r){if(void 0===n||void 0===r)return!1;const t=1e-4;return n.zoom===r.zoom&&Math.trunc(n.center[0]/t)===Math.trunc(r.center[0]/t)&&Math.trunc(n.center[1]/t)===Math.trunc(r.center[1]/t)})(o,0===this.states.length?void 0:this.states[i])||(this.states=this.states.slice(0,i+1).concat([o]),this.stateIndex=this.states.length-1)}this.state$.next(o)}}function Er(n){return n.options.linkedLayers}function wu(n,r){return n.layers.find(t=>t.options.linkedLayers?.linkId===r)}function Rr(n,r,t){let o=r,i=o,s=!0;for(;s;)o=i,i=My(n,o,t),s=!!i;return s||function Ay(n,r){let t=!1;const o=Er(n);return o?.links&&(t=!!o.links.find(s=>s.properties.includes(r))),t}(o,t)||(o=void 0),s?i:o}function My(n,r,t){if(r?.options.linkedLayers?.linkId){const o=r.options.linkedLayers.linkId;let i=n.layers.filter(s=>{const a=s.options.linkedLayers;if(a&&a.links)return a.links.find(c=>c.linkedIds.includes(o)&&c.properties.includes(t))});return i.length>1&&console.warn(`Your layer ${r.title||r.id} must only have 1 parent (${i.map(s=>s.title||s.id)})\n            , The first parent (${i[0].title||i[0].id}) will be use to sync properties`),i[0]}}function Tu(n,r,t){let o=[];return r?.options.linkedLayers?.links&&r.options.linkedLayers.links.filter(i=>i.properties.includes(t)).map(i=>{o=o.concat(i.linkedIds)}),o.map(i=>wu(n,i))}function ba(n,r,t,o){return Tu(n,r,o).map(s=>{t.push(s),Tu(n,s,o)&&ba(n,s,t,o)}),t}function Zy(n,r){if(r.options.linkedLayers?.linkId){const t=r.options.linkedLayers.linkId;let o=n.layers.filter(i=>{const s=i.options.linkedLayers;if(s&&s.links)return s.links.find(l=>l.linkedIds.includes(t)&&l.syncedDelete)});return o.length>1&&console.warn(`Your layer ${r.title||r.id} must only have 1 parent (${o.map(i=>i.title||i.id)})\n          , The first parent (${o[0].title||o[0].id}) will be use to sync properties`),o[0]}}function Fu(n,r){let t=[];return r?.options.linkedLayers?.links&&r.options.linkedLayers.links.filter(o=>o.syncedDelete).map(o=>{t=t.concat(o.linkedIds)}),t.map(o=>wu(n,o))}function Ou(n,r,t){return Fu(n,r).map(i=>{t.push(i),Fu(n,i)&&Ou(n,i,t)}),t}function Py(n,r){const t={},o=Object.keys(Ge);o.map(i=>{t[Ge[i]]=[]}),r.filter(i=>Er(i)).map(i=>{o.map(s=>{const a=Ge[s],l=Rr(n,i,a),u=t[a].map(p=>p.id);l&&!u.includes(l.id)&&t[a].push(l)})}),Object.keys(t).map(i=>{t[i].map(a=>a.ol.notify(i,void 0))})}class Xe{storageService;configService;ol;forcedOffline$=new y.X(!1);layers$=new y.X([]);layersAddedByClick$=new y.X(void 0);status$;propertyChange$;overlay;queryResultsOverlay;searchResultsOverlay;viewController;geolocationController;swipeEnabled$=new y.X(!1);mapCenter$=new y.X(!1);selectedFeatures$=new y.X(null);bufferDataSource;layerWatcher;options;mapViewOptions;defaultOptions={controls:{attribution:!1}};get layers(){return this.layers$.value}get projection(){return this.projectionCode}get viewProjection(){return this.viewController.getOlProjection()}get projectionCode(){return this.viewProjection.getCode()}constructor(r,t,o){this.storageService=t,this.configService=o,this.options=Object.assign({},this.defaultOptions,r),this.layerWatcher=new wy,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,ru.z2(da.Z),this.init()}init(){const r=[];this.options.controls&&(this.options.controls.attribution&&r.push(new Ar.Z(!0===this.options.controls.attribution?{}:this.options.controls.attribution)),this.options.controls.scaleLine&&r.push(new nu.Z(!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine)));let t={};!1===this.options.interactions&&(t={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new W_.Z({interactions:ey.c(t),controls:r}),this.setView(this.options.view||{}),this.viewController=new Oy({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new $r(this),this.queryResultsOverlay=new $r(this),this.searchResultsOverlay=new $r(this),this.ol.once("rendercomplete",()=>{this.geolocationController=new Fy(this,{projection:this.viewController.getOlProjection()},this.storageService,this.configService),this.geolocationController.setOlMap(this.ol),this.geolocationController&&this.geolocationController.updateGeolocationOptions(this.mapViewOptions),this.layers$.pipe((0,su.G)()).subscribe(([o,i])=>{let s;o&&(s=o.map(l=>l.id));const a=i.filter(l=>!s.includes(l.id));for(const l of a)l.options.linkedLayers&&l.ol.once("postrender",()=>{Py(this,a)})}),this.viewController.monitorRotation()}),this.propertyChange$.pipe((0,Kt.n)(o=>!o)).subscribe(o=>function ky(n,r,t){if(!r)return;const o=new Jt;let i=!0,s=!0;const a=r.key;let l;if("ogcFilters"===a?(i=!1,s=!0,l=t.dataSource.options.ogcFilters):"timeFilter"===a?(i=!1,s=!0,l=t.dataSource.options.timeFilter):(i=!0,s=!1,l=t.ol.get(a)),Er(t)){let u=Rr(n,t,a);u||(u=t);const p=[u];ba(n,u,p,a);let d=!1;const g=t.options.source.options.type,h=t.dataSource.options;p.map(m=>{if(t&&m&&(0,wn.sq)(t.ol)!==(0,wn.sq)(m?.ol)){const b=m.options.source.options.type;if(i)m.ol.set(a,l,!0),"visible"===a&&m.visible$.next(l),("minResolution"===a||"maxResolution"===a)&&(d=!0);else if(s)if("ogcFilters"===a){if(m.dataSource.setOgcFilters(l,!1),"wfs"===b&&m.ol.getSource().refresh(),"wms"===b){let C;"wfs"===g?C=o.handleOgcFiltersAppliedValue(h,t.dataSource.options.fieldNameGeometry,void 0,n.viewController.getOlProjection()):"wms"===g&&(C=t.dataSource.ol.getParams().FILTER),m.dataSource.ol.updateParams({FILTER:C})}}else if(m.dataSource instanceof xo&&"timeFilter"===a){m.dataSource.setTimeFilter(l,!1);const C=t.ol.getSource().getParams().TIME;m.dataSource.ol.updateParams({TIME:C})}}}),d&&n.viewController.resolution$.next(n.viewController.resolution$.value)}}(this,o.event,o.layer))}setTarget(r){this.ol.setTarget(r),void 0!==r?this.layerWatcher.subscribe(()=>{},null):this.layerWatcher.unsubscribe()}updateView(r){const o={...this.ol.getView().getProperties(),...r};r.zoom&&null==r.resolution&&(o.resolution=void 0),this.setView(o),r.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=r.maxZoomOnExtent),this.mapViewOptions=r}setView(r){void 0!==this.viewController&&this.viewController.clearStateHistory();const t={constrainResolution:!0,...r};r.center&&(t.center=Q.mi(r.center,r.projection)),this.ol.setView(new X_.ZP(t)),r.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=r.maxLayerZoomExtent)}updateControls(r){if(void 0===r)return;const t=[];r.attribution&&t.push(new Ar.Z(!0===r.attribution?{}:r.attribution)),r.scaleLine&&t.push(new nu.Z(!0===r.scaleLine?{}:r.scaleLine)),Object.assign([],this.ol.getControls().getArray()).forEach(i=>{this.ol.removeControl(i)}),t.forEach(i=>{this.ol.addControl(i)})}getCenter(r){return this.viewController.getCenter(r)}getExtent(r){return this.viewController.getExtent(r)}getZoom(){return this.viewController.getZoom()}changeBaseLayer(r){if(r){for(const t of this.getBaseLayers())t.visible=!1;r.visible=!0,this.viewController.olView.setMinZoom(r.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(r.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}}getBaseLayers(){return this.layers.filter(r=>!0===r.baseLayer)}getLayerById(r){return this.layers.find(t=>t.id&&t.id===r)}getLayerByAlias(r){return this.layers.find(t=>t.alias&&t.alias===r)}getLayerByOlUId(r){return this.layers.find(t=>(0,wn.sq)(t.ol)&&(0,wn.sq)(t.ol)===r)}getLayerByOlLayer(r){const t=(0,wn.sq)(r);return this.getLayerByOlUId(t)}addLayer(r,t=!0){this.addLayers([r])}addLayers(r,t=!0){let o=0,i=0;const s=r.map(a=>{if(!a)return;const l=a.zIndex?0:a.baseLayer?i++:o++;return this.doAddLayer(a,l)}).filter(a=>void 0!==a);this.setLayers([].concat(this.layers,s))}removeLayer(r){this.removeLayers([r])}removeLayers(r){const t=this.layers$.value.slice(0),o=[];r.forEach(i=>{i instanceof xe&&i.removeLayerFromIDB();const s=t.indexOf(i);s>=0&&(o.push(i),t.splice(s,1),this.handleLinkedLayersDeletion(i,o),o.map(a=>{const l=t.indexOf(a);l>=0&&t.splice(l,1)}))}),o.forEach(i=>this.doRemoveLayer(i)),this.setLayers(t)}handleLinkedLayersDeletion(r,t){let o=function Iy(n,r){let t=r,o=t,i=!0;for(;i;)t=o,o=Zy(n,t),i=!!o;return i||function Ly(n){let r=!1;const t=Er(n);return t?.links&&(r=!!t.links.find(i=>i.syncedDelete)),r}(t)||(t=void 0),i?o:t}(this,r);o||(o=r);const i=Ou(this,o,[o]);for(const s of i)t.push(s)}removeAllLayers(){this.layers.forEach(r=>this.doRemoveLayer(r)),this.layers$.next([])}raiseLayer(r){const t=this.getLayerIndex(r);t>1&&this.moveLayer(r,t,t-1)}raiseLayers(r){for(const t of r)this.raiseLayer(t)}lowerLayer(r){const t=this.getLayerIndex(r);t<this.layers.length-1&&this.moveLayer(r,t,t+1)}lowerLayers(r){const t=r.reverse();for(const o of t)this.lowerLayer(o)}moveLayer(r,t,o){const i=this.layers[o],a=r.zIndex;i.baseLayer||r.baseLayer||(r.zIndex=i.zIndex,i.zIndex=a,this.layers[o]=r,this.layers[t]=i,this.layers$.next(this.layers.slice(0)))}doAddLayer(r,t){r.baseLayer&&r.visible&&this.changeBaseLayer(r);const o=this.getLayerById(r.id);if(void 0===o){if(!r.baseLayer&&r.zIndex&&(r.zIndex+=10),void 0===r.zIndex||0===r.zIndex){const i=Math.max(r.baseLayer?0:10,...this.layers.filter(s=>s.baseLayer===r.baseLayer&&s.zIndex<200).map(s=>s.zIndex));r.zIndex=i+1+t}return r.baseLayer&&r.zIndex>9&&(r.zIndex=10),r.setMap(this),this.layerWatcher.watchLayer(r),this.ol.addLayer(r.ol),r}o.visible=!0}doRemoveLayer(r){this.layerWatcher.unwatchLayer(r),this.ol.removeLayer(r.ol),r.setMap(void 0)}setLayers(r){this.layers$.next(this.sortLayersByZIndex(r).slice(0))}sortLayersByZIndex(r){return r.sort((t,o)=>o.zIndex-t.zIndex)}getLayerIndex(r){return this.layers.findIndex(t=>t===r)}}const $y=["*"];let Le=(()=>{class n{activityService;activityId;status$$;map;get view(){return this._view}set view(t){this._view=t,void 0!==this.map&&this.map.updateView(t)}_view;get controls(){return this._controls}set controls(t){this._controls=t,void 0!==this.map&&this.map.updateControls(t)}_controls;id=`igo-map-target-${Ie()}`;constructor(t){this.activityService=t}ngOnInit(){this.status$$=this.map.status$.subscribe(t=>this.handleStatusChange(t))}ngAfterViewInit(){this.map.setTarget(this.id)}ngOnDestroy(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}handleStatusChange(t){t===ge.Working&&void 0===this.activityId?this.activityId=this.activityService.register():t===ge.Done&&void 0!==this.activityId&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}static \u0275fac=function(o){return new(o||n)(e.Y36(Ni))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},ngContentSelectors:$y,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(o,i){1&o&&(e.F$t(),e._UZ(0,"div",0),e.Hsn(1)),2&o&&e.Q6J("id",i.id)},styles:["[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     igo-zoom-button{position:absolute;bottom:50px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-zoom-button{display:none}}[_nghost-%COMP%]     igo-offline-button{position:absolute;bottom:15px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-offline-button{bottom:5px}}[_nghost-%COMP%]     igo-geolocate-button{position:absolute;bottom:5px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-geolocate-button{bottom:5px}}[_nghost-%COMP%]     igo-rotation-button{position:absolute;top:50px;right:5px}[_nghost-%COMP%]     igo-wake-lock-button{position:absolute;top:95px;right:5px}[_nghost-%COMP%]     igo-home-extent-button{position:absolute;bottom:135px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-home-extent-button{bottom:5px;right:95px}}[_nghost-%COMP%]     igo-user-button{position:absolute;bottom:5px;right:55px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-user-button{right:90px}}[_nghost-%COMP%]     igo-baselayers-switcher{position:absolute;bottom:5px;left:5px}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}"]})}return n})(),Dy=(()=>{class n{component;mediaService;lastTimeoutRequest;pointerMoveListener;mapClickListener;pointerPositionDelay=1e3;pointerPositionCoord=new e.vpe;get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(t,o){this.component=t,this.mediaService=o}ngOnInit(){this.listenToMapPointerMove(),this.listenToMapClick()}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",t=>this.onPointerEvent(t,this.pointerPositionDelay))}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",t=>this.onPointerEvent(t,0))}unlistenToMapPointerMove(){(0,Ke.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapClick(){this.mapClickListener=void 0}onPointerEvent(t,o){if(t.dragging||this.mediaService.isTouchScreen())return;typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const i=(0,Q.vs)(t.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(()=>{this.pointerPositionCoord.emit(i)},o)}static \u0275fac=function(o){return new(o||n)(e.Y36(Le,2),e.Y36(ct))};static \u0275dir=e.lG2({type:n,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"}})}return n})();var Nr=v(84528),Au=v(93511);function Lu(){const n=Math.floor(255*Math.random()),r=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),o=new U.Z({color:[n,r,t,1],width:2}),i=new q.Z({color:[n,r,t,.4]});return(s,a)=>{const l=s.get("_style");if(l){if(l.circle&&s.get("rad")&&s.get("longitude")&&s.get("latitude")){const p=[s.get("longitude"),s.get("latitude")],d=s.get("rad")/Math.cos(Math.PI/180*p[1])/a;l.circle.radius=d}return(new yo).createStyle(l,void 0,a)}return new J.ZP({stroke:o,fill:i,image:new Te.Z({radius:5,stroke:o,fill:i}),text:s.get("_mapTitle")?new St.Z({text:s.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new q.Z({color:"#000"}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0}):void 0})}}function Mu(){const n=Math.floor(255*Math.random()),r=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),o=new U.Z({color:[n,r,t,1],width:2}),i=new q.Z({color:[n,r,t,.4]});return new J.ZP({stroke:o,fill:i,image:new Te.Z({radius:5,stroke:o,fill:i})})}function Ey(n,r){const o=[new J.ZP({text:new St.Z({text:n.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new q.Z({color:"#000"}),backgroundFill:new q.Z({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new U.Z({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];return"Point"===n.getGeometry().getType()?o.push(new J.ZP({image:new Te.Z({radius:10,stroke:new U.Z({color:"blue",width:3})})})):(o.push(new J.ZP({stroke:new U.Z({color:"white",width:5})})),o.push(new J.ZP({stroke:new U.Z({color:"blue",width:3})}))),o}function Ry(n,r){return new J.ZP({image:new Fi.Z({src:"./assets/igo2/geo/icons/cross_black_18px.svg"}),text:new St.Z({text:n.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new q.Z({color:"#000"}),backgroundFill:new q.Z({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new U.Z({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new U.Z({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}let Ny=(()=>{class n{component;mediaService;styleService;store;pointerHoverFeatureStore=new xt([]);lastTimeoutRequest;store$$;layers$$;selectionLayer;selectionMVT={};mvtStyleOptions;pointerMoveListener;singleClickMapListener;hoverFeatureId="hoverFeatureId";igoHoverFeatureDelay=1e3;igoHoverFeatureEnabled=!1;mouseout(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(t,o,i){this.component=t,this.mediaService=o,this.styleService=i}ngOnInit(){this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick(),this.map.status$.pipe((0,Lt.P)(t=>t===ge.Done)).subscribe(()=>{this.store=new yt([],{map:this.map}),this.initStore()}),this.layers$$=this.map.layers$.subscribe(t=>{this.store&&!t.find(o=>"hoverFeatureId"===o.id)&&this.initStore()})}initStore(){oi(this.store,new xe({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new Ae,showInLayerList:!1,exportable:!1,browsable:!1,style:Ey})),this.selectionLayer=new Nr.Z({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new _u.Z({projection:this.map.projection}),style:(i,s)=>{if(this.mvtStyleOptions&&i.getId()in this.selectionMVT)return this.createHoverStyle(i,this.mvtStyleOptions,s)}})}createHoverStyle(t,o,i){const s={...o};let a=o.label?o.label.attribute:void 0,l=!!o.label?.style;if(t.get("_isLabel")){const c=s.data?s.data.length:0,u=[],p=[],d=[],g=[];for(let h=0;h<c;h++)u.push(0),p.push("rgba(255, 255, 255, 0)"),d.push(0),g.push("rgba(255, 255, 255, 0)");s.radius=u,s.stroke=p,s.width=d,s.fill=g}else s.label=void 0,l=!1,a=void 0;return!l&&a&&(s.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(t,s,i)}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(t=>{this.addFeatureOverlay(t)})}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",t=>this.onMapEvent(t))}listenToMapClick(){this.singleClickMapListener=this.map.ol.on("singleclick",t=>this.onMapSingleClickEvent(t))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unlistenToMapPointerMove(){(0,Ke.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapSingleClick(){(0,Ke.B)(this.singleClickMapListener),this.singleClickMapListener=void 0}onMapSingleClickEvent(t){this.clearLayer()}onMapEvent(t){if(t.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen())return void this.clearLayer();typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let i,o=-1/0;const s=this.map.ol.getPixelFromCoordinate(t.coordinate);this.lastTimeoutRequest=setTimeout(()=>{if(this.map.ol.forEachFeatureAtPixel(s,(a,l)=>{if(!l)return;const c=this.map.getLayerByOlUId(l.ol_uid);this.canProcessHover(c)&&(c.zIndex<=o||(o=c.zIndex,i=l))},{hitTolerance:10,layerFilter:a=>a instanceof ti.Z||a instanceof Nr.Z}),!i)return this.clearLayer(),void this.pointerHoverFeatureStore.clear();this.map.ol.forEachFeatureAtPixel(s,(a,l)=>{if(void 0===a.get("hoverSummary")&&a.getProperties()!==this.pointerHoverFeatureStore.all()[0]?.getProperties()){let c;if(this.clearLayer(),l instanceof ti.Z){const u=this.map.getLayerByOlUId(l.ol_uid);if(!this.canProcessHover(u))return;let p=this.handleRenderFeature(a);this.setLayerStyleFromOptions(u,p);const d=[p];p.set("_isLabel",!1);const g=new Ze.Z;g.setProperties(p.getProperties());const h="Point"===p.getGeometry().getType()?p.getGeometry():new Ee.Z(t.coordinate);return g.setGeometry(h),g.setId(p.getId()),g.set("_isLabel",!0),this.setLayerStyleFromOptions(u,g),d.push(g),this.pointerHoverFeatureStore.load(d),c=u,!0}if(l instanceof Nr.Z){const u=this.map.getLayerByOlUId(l.ol_uid);if(!this.canProcessHover(u))return;u?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.mvtStyleOptions=u.options.igoStyle.styleByAttribute.hoverStyle:u?.options?.igoStyle?.hoverStyle&&(this.mvtStyleOptions=u.options.igoStyle.hoverStyle),this.selectionLayer.setSource(l.getSource()),l.getFeatures(t.pixel).then(p=>{if(!p.length)return this.selectionMVT={},this.selectionLayer.changed(),void this.clearLayer();const d=p[0];if(!d)return void this.clearLayer();let g=this.handleRenderFeature(d);g.set("_isLabel",!1);const h=new Ze.Z;h.setProperties(g.getProperties());const m="Point"===g.getGeometry().getType()?g.getGeometry():new Ee.Z(t.coordinate);h.setGeometry(m),h.setId(g.getId()),h.set("_isLabel",!0),this.setLayerStyleFromOptions(u,h),this.pointerHoverFeatureStore.load([h]),this.selectionMVT[d.getId()]=g,this.selectionLayer.changed()}),c=u}}},{hitTolerance:10,layerFilter:a=>a===i})},this.igoHoverFeatureDelay)}canProcessHover(t){return!(!t||!t.visible||!t.options||!t.options.igoStyle?.styleByAttribute&&!t.options.igoStyle?.hoverStyle||t.options.igoStyle?.styleByAttribute&&!t.options.igoStyle?.styleByAttribute.hoverStyle&&!t.options.igoStyle?.hoverStyle)}handleRenderFeature(t){let o;return t instanceof Au.ZP?(o=new Ze.Z({geometry:this.getGeometry(t)}),o.setId(t.getId())):t instanceof Ze.Z&&(o=t),o.setProperties(t.getProperties()),o}addFeatureOverlay(t){if(t.length>0){const o=t[0];this.clearLayer();const i=new Ze.Z({geometry:o.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(o.getProperties())});this.store.setLayerOlFeatures([i],Y.None)}}setLayerStyleFromOptions(t,o){const i=this.store.layer.map.viewController.getResolution();t?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.store.layer.ol.setStyle(this.createHoverStyle(o,t.options.igoStyle.styleByAttribute.hoverStyle,i)):t?.options?.igoStyle?.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(o,t.options.igoStyle.hoverStyle,i))}getHoverSummary(t){let o="";for(const[i,s]of Object.entries(t))!i.startsWith("_")&&"geometry"!==i&&(o+=`${i}: ${s}\n`);return o.length>=2?o.slice(0,-2):o}getGeometry(t){let o;if(t.getOrientedFlatCoordinates){const i=t.getOrientedFlatCoordinates(),s=[];switch(i.forEach((a,l)=>{l%2==0&&s.push([parseFloat(i[l]),parseFloat(i[l+1])])}),t.getType()){case"Point":o=new Ee.Z(s);break;case"Polygon":o=new Rt.ZP([s]);break;case"LineString":o=new ro.Z([s])}}else o=t.getGeometry();return o}clearLayer(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}static \u0275fac=function(o){return new(o||n)(e.Y36(Le,2),e.Y36(ct),e.Y36(yo))};static \u0275dir=e.lG2({type:n,selectors:[["","igoHoverFeature",""]],hostBindings:function(o,i){1&o&&e.NdJ("mouseout",function(){return i.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"}})}return n})();function Vi(n){let r=-54;if(n<-81||n>r)return 0;{let i=2;for(;Math.abs(n-r)>3;)r-=3,i++;return i}}function Ln(n){let r=-180,i=1;for(;Math.abs(n-r)>6;)r+=6,i++;return i}function Iu(n){const r=n.mtmZone,t=n.utmZone;return{projFromConfig:!1!==n.projFromConfig,nad83:!1!==n.nad83,wgs84:!1!==n.wgs84,webMercator:!1!==n.webMercator,utm:!1!==n.utm,mtm:!1!==n.mtm,utmZone:{minZone:t&&t.minZone?t.minZone:17,maxZone:t&&t.maxZone?t.maxZone:21},mtmZone:{minZone:r&&r.minZone?r.minZone:2,maxZone:r&&r.maxZone?r.maxZone:10}}}var Zu=function(n){return n.System="system",n.User="user",n}(Zu||{});class xe extends Tr{messageService;authInterceptor;geoNetworkService;geoDBService;layerDBService;previousLoadExtent;previousLoadResolution;previousOgcFilters;xhrAccumulator=[];watcher;trackFeatureListenerId;get browsable(){return!1!==this.options.browsable}get exportable(){return!1!==this.options.exportable}constructor(r,t,o,i,s,a){super(r,t,o,s,a),this.messageService=t,this.authInterceptor=o,this.geoNetworkService=i,this.geoDBService=s,this.layerDBService=a,this.watcher=new G_(this),this.status$=this.watcher.status$}createOlLayer(){const r=this.options.opacity||1,t=!1!==this.options.visible,o=this.options.minResolution||rt(Number(this.options.minScaleDenom)),i=this.options.maxResolution||rt(Number(this.options.maxScaleDenom)),s=this.options.sourceOptions;this.dataSource instanceof Ae&&(s?.preload?.bypassResolution||s?.preload?.bypassVisible)&&(this.options.opacity=0,s.preload.bypassResolution&&(this.options.minResolution||this.options.maxResolution)&&(this.options.minResolution=0,this.options.maxResolution=1/0),s.preload.bypassVisible&&!t&&(this.options.visible=!0));const a=Object.assign({},this.options,{source:this.options.source.ol,sourceOptions:this.options.sourceOptions||this.options.source.options});this.options.animation&&this.dataSource.ol.on("addfeature",function(p){this.flash(p.feature)}.bind(this)),this.options.idbInfo?.storeToIdb&&this.geoDBService&&(this.options.idbInfo.firstLoad&&this.maintainFeaturesInIdb(),this.dataSource.ol.once("featuresloadend",()=>{this.dataSource.ol.on("addfeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("changefeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("clear",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("removefeature",()=>this.maintainFeaturesInIdb())})),this.dataSource instanceof Ae&&(s?.preload?.bypassResolution||s?.preload?.bypassVisible)&&this.dataSource.ol.once("featuresloadend",()=>{r&&(this.opacity=r),s.preload.bypassResolution&&(this.minResolution=o,this.maxResolution=i),s.preload.bypassVisible&&(this.visible=t)}),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);const l=new ti.Z(a),c=l.getSource(),u=c.getUrl();if("function"==typeof u)return l;if(u||"wfs"===a.sourceOptions?.type){let p;const d=a.sourceOptions;p="wfs"===d?.type&&(d.params||d.paramsWFS)?(g,h,m,b,C)=>{this.customWFSLoader(c,d,this.authInterceptor,g,h,m,b,C)}:(g,h,m,b,C)=>{this.customLoader(c,u,this.authInterceptor,g,h,m,b,C)},p&&c.setLoader(p)}else if(this.options.idbInfo?.storeToIdb&&this.geoDBService){const p=(d,g,h,m,b)=>{this.customIDBLoader(c,a.id,d,h,m,b)};p&&c.setLoader(p)}return this.options.idbInfo?.storeToIdb&&this.geoDBService&&l.once("sourceready",()=>{this.options.idbInfo.firstLoad&&this.maintainOptionsInIdb(),(0,go.R)(l,"change").pipe((0,ae.b)(750)).subscribe(()=>this.maintainOptionsInIdb()),l.on("change:zIndex",()=>this.maintainOptionsInIdb())}),l}removeLayerFromIDB(){this.geoDBService&&this.layerDBService&&(0,Sn.$)(this.geoDBService.deleteByKey(this.id),this.layerDBService.deleteByKey(this.id)).subscribe()}maintainOptionsInIdb(){this.options.igoStyle.igoStyleObject=function By(n){const r=n.getStyle();return"function"==typeof r||r instanceof Array?void 0:{fill:{color:r.getFill().getColor()},stroke:{color:r.getStroke().getColor(),width:2},circle:{fill:{color:r.getImage().getFill().getColor()},stroke:{color:r.getImage().getStroke().getColor(),width:2},radius:5}}}(this.ol);const r=R.removeUndefined({layerId:this.id,detailedContextUri:this.options.idbInfo.contextUri,sourceOptions:{id:this.id,type:"vector",queryable:!0},layerOptions:{workspace:this.options.workspace,zIndex:this.ol?this.zIndex:1e6,id:this.id,isIgoInternalLayer:this.isIgoInternalLayer,title:this.title,igoStyle:this.options.igoStyle,idbInfo:Object.assign({},this.options.idbInfo,{firstLoad:!1})},insertEvent:`${this.title}-${this.id}-${new Date}`});this.layerDBService.update(r)}maintainFeaturesInIdb(){const r=this.dataSource.ol.getFeatures(),t=JSON.parse((new Ce.Z).writeFeatures(r,{dataProjection:"EPSG:4326",featureProjection:this.dataSource.ol.getProjection()||"EPSG:3857"}));this.geoDBService.update(this.id,this.id,t,Zu.User,`${this.title}-${this.id}-${new Date}`)}flash(r){const t=(new Date).getTime(),o=this.ol.on("postrender",function i(s){const a=(0,Y_.u3)(s),l=s.frameState,c=r.getGeometry().clone(),u=l.time-t,p=u/this.options.animation.duration,d=(0,Cn.Vv)(1-p),g=(0,_o._2)(this.options.animation.color||"red");g[3]=d;let h=this.ol.getStyleFunction().call(this,r).find(b=>b.getImage());h||(h=this.ol.getStyleFunction().call(this,r)[0]);const m=h.clone();switch(r.getGeometry().getType()){case"Point":if(null!==m.getImage()&&"function"==typeof m.getImage().getRadius){const b=(0,Cn.Vv)(p)*(3*m.getImage().getRadius());m.getImage().setRadius(b),m.getImage().setOpacity(d)}break;case"LineString":m.getImage()&&(m.getImage().getStroke().setColor(g),m.getImage().getStroke().setWidth((0,Cn.Vv)(p)*(3*m.getImage().getStroke().getWidth()))),m.getStroke()&&(m.getStroke().setColor(g),m.getStroke().setWidth((0,Cn.Vv)(p)*(3*m.getStroke().getWidth())));break;case"Polygon":m.getImage()&&m.getImage().getFill().setColor(g),m.getFill()&&m.getFill().setColor(g)}if(m.setText(""),a.setStyle(m),a.drawGeometry(c),u>this.options.animation.duration)return(0,Ke.B)(o),void this.map.ol.render();this.map.ol.render()}.bind(this))}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}setExtent(r){this.options.extent=r}onUnwatch(){this.dataSource.onUnwatch(),this.stopAnimation()}stopAnimation(){this.dataSource.ol.un("addfeature",function(r){this.visible&&this.flash(r.feature)}.bind(this))}enableTrackFeature(r){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,r))}centerMapOnFeature(r){const t=this.dataSource.ol.getFeatureById(r);t&&this.map.ol.getView().setCenter(t.getGeometry().getCoordinates())}trackFeature(r,t){t.feature.getId()===r&&this.visible&&this.centerMapOnFeature(r)}disableTrackFeature(r){(0,Ke.B)(this.trackFeatureListenerId)}customWFSLoader(r,t,o,i,s,a,l,c,u){{const p=t.paramsWFS,d=p.srsName?new xn.Z({code:p.srsName}):a,g=Q.$A(i,a,d),h=t.ogcFilters;if(this.previousLoadExtent&&this.previousLoadExtent!==g||this.previousLoadResolution&&this.previousLoadResolution!==s||this.previousOgcFilters&&this.previousOgcFilters!==h){r.removeLoadedExtent(this.previousLoadExtent);for(let C of this.xhrAccumulator)C.abort()}this.previousLoadExtent=g,this.previousLoadResolution=s,this.previousOgcFilters=h,p.srsName=p.srsName||a.getCode();const m=function K_(n,r,t,o,i){const s=n.paramsWFS,a=ua(n,void 0,n.paramsWFS.srsName);let l;o?.enabled&&(l=o?.filters);const c=new Jt,u=c.buildFilter(l,r,t,o?.geometryName,n);let p=c.handleOgcFiltersAppliedValue(n,o?.geometryName,r,t),d="filter";p||(d="bbox",p=r.join(",")+","+t.getCode()),s.xmlFilter=o?.advancedOgcFilters?u:`${d}=${p}`;let g=a.find(m=>"getfeature"===m.name).value;return g=/(filter|bbox)=.*/gi.test(s.xmlFilter)?`${g}&${s.xmlFilter}`:g,n.download=Object.assign({},n.download,{dynamicUrl:g}),i&&(g+=`$&_t${(new Date).getTime()}`),g.replace(/&&/g,"&")}(t,g,d,h,u);let b=0;if("2.0.0"===p.version&&p.maxFeatures>Qi)for(;b<p.maxFeatures;){let x=m.replace("count="+p.maxFeatures,"count=1000");x=x.replace("startIndex=0","0"),x+="&startIndex="+b,x.replace(/&&/g,"&"),this.getFeatures(r,o,g,d,a,x,l,c),b+=1e3}else this.getFeatures(r,o,g,d,a,m,l,c)}}getFeatures(r,t,o,i,s,a,l,c){const u=new XMLHttpRequest,p=t.alterUrlWithKeyAuth(a);let d=a;p&&(d=p),u.open("GET",d),t&&t.interceptXhr(u,d);const g=()=>{r.removeLoadedExtent(o),c()};u.onerror=g,u.onload=()=>{if(200===u.status&&u.responseText.length>0){const h=r.getFormat().readFeatures(u.responseText,{dataProjection:i,featureProjection:s});h?(r.addFeatures(h),l(h)):l([])}else g()},this.xhrAccumulator.push(u),u.send()}customLoader(r,t,o,i,s,a,l,c){const u=new XMLHttpRequest;let p=t;if("function"!=typeof t){const d=o.alterUrlWithKeyAuth(t);d&&(p=d)}if(this.geoNetworkService&&"function"!=typeof t){let h=r.getFormat().getType();const m=()=>{r.removeLoadedExtent(i),c()},b={responseType:h};this.geoNetworkService.geoDBService.get(t).pipe((0,pc.g)(750)).pipe((0,oo.b)(C=>C?(0,z.of)(C):this.geoNetworkService.get(p,b).pipe((0,Lt.P)(),(0,ce.K)(x=>{throw m(),x})))).subscribe(C=>{if(C){const x=r.getFormat(),A=x.getType();let M;if("json"===A||"text"===A?M=C:"xml"===A?(M=C,M||(M=(new DOMParser).parseFromString(C,"application/xml"))):"arraybuffer"===A&&(M=C),M){const k=x.readFeatures(M,{extent:i,featureProjection:a});r.addFeatures(k),l(k)}else m()}})}else{u.open("GET",p);const d=r.getFormat();"arraybuffer"===d.getType()&&(u.responseType="arraybuffer"),o&&o.interceptXhr(u,p);const g=()=>{r.removeLoadedExtent(i),c()};u.onerror=g,u.onload=()=>{if(!u.status||u.status>=200&&u.status<300){const h=d.getType();let m;if("json"===h||"text"===h?m=u.responseText:"xml"===h?(m=u.responseXML,m||(m=(new DOMParser).parseFromString(u.responseText,"application/xml"))):"arraybuffer"===h&&(m=u.response),m){const b=d.readFeatures(m,{extent:i,featureProjection:a});r.addFeatures(b),l(b)}else g()}else g()},u.send()}}customIDBLoader(r,t,o,i,s,a){if(this.geoNetworkService){const l=()=>{r.removeLoadedExtent(o),a()};this.geoNetworkService.geoDBService.get(t).subscribe(c=>{if(c){const u=r.getFormat(),p=u.getType();let d;if("json"===p||"text"===p?d=c:"xml"===p?(d=c,d||(d=(new DOMParser).parseFromString(c,"application/xml"))):"arraybuffer"===p&&(d=c),d){const g=u.readFeatures(d,{extent:o,featureProjection:i});r.addFeatures(g,u.readProjection(d)),s(g)}else l()}})}}}class Pu extends Tr{messageService;authInterceptor;watcher;constructor(r,t,o){super(r,t,o),this.messageService=t,this.authInterceptor=o,this.watcher=new Kc(this),this.status$=this.watcher.status$}createOlLayer(){const r=Object.assign({},this.options,{source:this.options.source.ol}),t=new Nr.Z(r);return t.getSource().setTileLoadFunction((i,s)=>{const a=this.customLoader(s,i.getFormat(),this.authInterceptor,i.onLoad.bind(i));a&&i.setLoader(a)}),t}customLoader(r,t,o,i,s){return(a,l,c)=>{const u=new XMLHttpRequest;let p=r;if("function"!=typeof r){const d=o.alterUrlWithKeyAuth(r);d&&(p=d)}else p=r(a,l,c);u.open("GET",p),o&&o.interceptXhr(u,p),"arraybuffer"===t.getType()&&(u.responseType="arraybuffer"),u.onload=d=>{if(!u.status||u.status>=200&&u.status<300){const g=t.getType();let h;"json"===g||"text"===g?h=u.responseText:"xml"===g?(h=u.responseXML,h||(h=(new DOMParser).parseFromString(u.responseText,"application/xml"))):"arraybuffer"===g&&(h=u.response),h?i.call(this,t.readFeatures(h,{extent:a,featureProjection:c}),t.readProjection(h)):s.call(this)}else s.call(this)},u.onerror=()=>{s.call(this)},u.send()}}setMap(r){void 0===r?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(r)}}function Jy(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-checkbox",10),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.check())}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("checked",t.layerCheck)}}const ku=function(n){return{disabled:n}};function Uy(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.toggleVisibility(i))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",12),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",e.lcZ(1,5,t.eyeTooltip)),e.xp6(2),e.Q6J("matBadgeHidden",e.lcZ(3,7,t.queryBadgeHidden$))("ngClass",e.VKq(13,ku,!1===e.lcZ(4,9,t.inResolutionRange$)))("svgIcon",e.lcZ(5,11,t.layer.visible$)?"eye":"eye-off")}}function Gy(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.toggleVisibility(i))}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",12),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,5,"igo.geo.layer.hideLayer"):e.lcZ(2,7,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("matBadgeHidden",e.lcZ(4,9,t.queryBadgeHidden$))("ngClass",e.VKq(13,ku,!1===e.lcZ(5,11,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function qy(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleLayerTool())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",15),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.moreOptions"))}function jy(n,r){if(1&n&&e._UZ(0,"igo-layer-legend",16),2&n){const t=e.oxw();e.Q6J("layer",t.layer)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}let $u=(()=>{class n{networkService;renderer;elRef;cdRef;focusedCls="igo-layer-item-focused";get activeLayer(){return this._activeLayer}set activeLayer(t){t&&this.layer&&t.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)}_activeLayer;layerTool$=new y.X(!1);showLegend$=new y.X(!0);inResolutionRange$=new y.X(!0);queryBadgeHidden$=new y.X(!0);tooltipText;state;get selectAll(){return this._selectAll}set selectAll(t){this._selectAll=t,!0===t&&(this.layerCheck=!0)}_selectAll=!1;layerCheck;resolution$$;network$$;layers$$;layers$=new y.X(void 0);get layer(){return this._layer}set layer(t){this._layer=t,this.layers$.next(t)}_layer;toggleLegendOnVisibilityChange=!1;expandLegendIfVisible=!1;updateLegendOnResolutionChange=!1;orderable=!0;lowerDisabled=!1;raiseDisabled=!1;queryBadge=!1;selectionMode;changeDetection;get opacity(){return 100*this.layer.opacity}set opacity(t){this.layer.opacity=t/100}get eyeTooltip(){return!1===this.inResolutionRange$.getValue()?"igo.geo.layer.notInResolution":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}action=new e.vpe(void 0);checkbox=new e.vpe;constructor(t,o,i,s){this.networkService=t,this.renderer=o,this.elRef=i,this.cdRef=s}ngOnInit(){this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge(),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(o=>{this.state=o,this.onResolutionChange()}),this.layers$$=this.layers$.subscribe(()=>{this.layer&&this.layer.options.active&&(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls))}),this.changeDetection&&this.changeDetection.subscribe(()=>this.cdRef.detectChanges())}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe(),this.layers$$.unsubscribe()}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.toggleLegend(this.showLegend$.value)}toggleVisibility(t){t.stopPropagation(),this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const o=t.tooltip,i=t.metadata;switch(t.tooltip.type){case no.TITLE:return this.layer.title;case no.ABSTRACT:return i&&i.abstract?i.abstract:this.layer.title;case no.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){const t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)}updateQueryBadge(){const t=!1===this.queryBadge||!1===this.layer.visible||!vn(this.layer);this.queryBadgeHidden$.next(t)}toggleLayerTool(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)}check(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})}static \u0275fac=function(o){return new(o||n)(e.Y36(nr),e.Y36(e.Qsj),e.Y36(e.SBq),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-layer-item"]],inputs:{activeLayer:"activeLayer",selectAll:"selectAll",layerCheck:"layerCheck",layer:"layer",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendIfVisible:"expandLegendIfVisible",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",orderable:"orderable",lowerDisabled:"lowerDisabled",raiseDisabled:"raiseDisabled",queryBadge:"queryBadge",selectionMode:"selectionMode",changeDetection:"changeDetection"},outputs:{action:"action",checkbox:"checkbox"},decls:12,vars:9,consts:[[1,"igo-layer-list-item"],["class","layerCheck","matListItemIcon","",3,"checked","change",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip","click"],["matListItemMeta",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","selection-eye","mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["matListItemIcon","",1,"layerCheck",3,"checked","change"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["aria-hidden","false","matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","ngClass","svgIcon"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",1,"selection-eye",3,"color","matTooltip","click"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"matTooltip","click"],["svgIcon","dots-horizontal"],[3,"layer","updateLegendOnResolutionChange"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-list-item",0),e.YNc(1,Jy,1,1,"mat-checkbox",1),e.TgZ(2,"span",2),e.NdJ("click",function(){return i.toggleLegendOnClick()}),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.YNc(5,Uy,6,15,"button",4),e.YNc(6,Gy,6,15,"button",5),e.YNc(7,qy,3,3,"button",6),e.qZA()(),e.TgZ(8,"div",7,8),e.YNc(10,jy,1,2,"igo-layer-legend",9),e.ALo(11,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",i.selectionMode),e.xp6(1),e.Q6J("matTooltip",i.tooltipText),e.xp6(1),e.hij(" ",i.layer.title," "),e.xp6(2),e.Q6J("ngIf",!i.selectionMode),e.xp6(1),e.Q6J("ngIf",i.selectionMode),e.xp6(1),e.Q6J("ngIf",!i.selectionMode),e.xp6(3),e.Q6J("ngIf",e.lcZ(11,7,i.showLegend$)))},styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .igo-layer-title{display:block;width:100%;cursor:pointer}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}[_nghost-%COMP%]   .layerCheck[_ngcontent-%COMP%]{align-self:baseline;width:16px;padding-right:0}"],changeDetection:0})}return n})(),Du=(()=>{class n{networkService;inResolutionRange$=new y.X(!0);tooltipText;state;resolution$$;network$$;layer;updateLegendOnResolutionChange=!1;constructor(t){this.networkService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(o=>{this.state=o,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const o=t.tooltip,i=t.metadata;switch(t.tooltip.type){case no.TITLE:return this.layer.title;case no.ABSTRACT:return i&&i.abstract?i.abstract:this.layer.title;case no.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){this.inResolutionRange$.next(this.layer.isInResolutionsRange)}static \u0275fac=function(o){return new(o||n)(e.Y36(nr))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},decls:6,vars:4,consts:[[1,"igo-layer-list-item"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-list-item",0)(1,"span",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2,3),e._UZ(5,"igo-layer-legend",4),e.qZA()),2&o&&(e.xp6(1),e.Q6J("matTooltip",i.tooltipText),e.xp6(1),e.Oqu(i.layer.title),e.xp6(3),e.Q6J("layer",i.layer)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange))},styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-layer-list-item[_ngcontent-%COMP%]{height:48px;clear:both}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}"],changeDetection:0})}return n})();var Mn=v(10530),In=v(19329);function Qy(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",6),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.toggleShowAllLegends(i.checked))}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,4,"igo.geo.layer.legend.showAll"))("checked",t.showAllLegendsValue)("labelPosition","before"),e.xp6(2),e.hij(" ",e.lcZ(3,6,"igo.geo.layer.legend.showAll")," ")}}function Yy(n,r){1&n&&e._UZ(0,"mat-divider")}function Hy(n,r){if(1&n&&e._UZ(0,"igo-layer-legend-item",8),2&n){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("layer",t)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange)}}function Vy(n,r){if(1&n&&e.YNc(0,Hy,1,2,"igo-layer-legend-item",7),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",!(o.excludeBaseLayers&&t.baseLayer))}}function zy(n,r){1&n&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Ky(n,r){1&n&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function Wy(n,r){1&n&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function Xy(n,r){1&n&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}let Zn=(()=>{class n{orderable=!0;hasVisibleOrInRangeLayers$=new y.X(!0);hasVisibleAndNotInRangeLayers$=new y.X(!0);layersInUi$=new y.X([]);layers$=new y.X([]);showAllLegend=!1;change$=new hn.t(1);change$$;set layers(t){this._layers=t,this.next()}get layers(){return this._layers}_layers;excludeBaseLayers=!1;updateLegendOnResolutionChange=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;allLegendsShown=new e.vpe(!1);constructor(){}ngOnInit(){this.change$$=this.change$.pipe((0,In.D)(()=>0===this.layers.length?bn.E:(0,Mn.H)(50))).subscribe(()=>{const t=this.computeShownLayers(this.layers.slice(0));this.layers$.next(t),this.hasVisibleOrInRangeLayers$.next(this.layers.slice(0).filter(o=>!0!==o.baseLayer).filter(o=>o.visible$.value&&o.isInResolutionsRange$.value).length>0),this.hasVisibleAndNotInRangeLayers$.next(this.layers.slice(0).filter(o=>!0!==o.baseLayer).filter(o=>o.visible$.value&&!o.isInResolutionsRange$.value).length>0),this.layersInUi$.next(this.layers.slice(0).filter(o=>!(!1===o.showInLayerList||this.excludeBaseLayers&&o.baseLayer)))})}ngOnDestroy(){this.change$$.unsubscribe()}next(){this.change$.next()}computeShownLayers(t){let o=t.filter(i=>i.visible&&i.isInResolutionsRange);return this.showAllLegendsValue&&(o=t),this.sortLayersByZindex(o)}sortLayersByZindex(t){return t.sort((o,i)=>i.zIndex-o.zIndex)}toggleShowAllLegends(t){this.showAllLegendsValue=t,this.next(),this.allLegendsShown.emit(t)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"matTooltip","checked","labelPosition","change"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Qy,4,8,"mat-slide-toggle",1),e.ALo(2,"async"),e.YNc(3,Yy,1,0,"mat-divider",2),e.ALo(4,"async"),e.TgZ(5,"igo-list",3),e.YNc(6,Vy,1,1,"ng-template",4),e.ALo(7,"async"),e.qZA(),e.YNc(8,zy,3,3,"p",5),e.ALo(9,"async"),e.ALo(10,"async"),e.ALo(11,"async"),e.YNc(12,Ky,3,3,"p",5),e.ALo(13,"async"),e.ALo(14,"async"),e.ALo(15,"async"),e.YNc(16,Wy,3,3,"p",5),e.ALo(17,"async"),e.ALo(18,"async"),e.ALo(19,"async"),e.YNc(20,Xy,3,3,"p",5),e.ALo(21,"async"),e.ALo(22,"async"),e.ALo(23,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,9,i.layersInUi$).length&&i.allowShowAllLegends),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,11,i.layersInUi$).length&&i.allowShowAllLegends),e.xp6(2),e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(7,13,i.layers$)),e.xp6(2),e.Q6J("ngIf",!i.showAllLegendsValue&&e.lcZ(9,15,i.layersInUi$).length&&!1===e.lcZ(10,17,i.hasVisibleOrInRangeLayers$)&&!1===e.lcZ(11,19,i.hasVisibleAndNotInRangeLayers$)&&i.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",!i.showAllLegendsValue&&e.lcZ(13,21,i.layersInUi$).length&&!1===e.lcZ(14,23,i.hasVisibleOrInRangeLayers$)&&e.lcZ(15,25,i.hasVisibleAndNotInRangeLayers$)&&i.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",e.lcZ(17,27,i.layersInUi$).length&&!1===e.lcZ(18,29,i.hasVisibleOrInRangeLayers$)&&!1===e.lcZ(19,31,i.hasVisibleAndNotInRangeLayers$)&&!i.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",e.lcZ(21,33,i.layersInUi$).length&&!1===e.lcZ(22,35,i.hasVisibleOrInRangeLayers$)&&e.lcZ(23,37,i.hasVisibleAndNotInRangeLayers$)&&!i.allowShowAllLegends))},styles:["[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{display:contents}[_nghost-%COMP%]   .layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}[_nghost-%COMP%]   .layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"],changeDetection:0})}return n})(),zi=(()=>{class n{renderer;el;get target(){return this._target}set target(t){this._target=t}_target;get collapsed(){return this._collapsed}set collapsed(t){t?this.collapseTarget():this.expandTarget(),this._collapsed=t,this.toggle.emit(t)}_collapsed=!1;toggle=new e.vpe;click(){this.collapsed=!this.collapsed}constructor(t,o){this.renderer=t,this.el=o}collapseTarget(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}expandTarget(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}static \u0275fac=function(o){return new(o||n)(e.Y36(e.Qsj),e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","igoCollapse",""]],hostBindings:function(o,i){1&o&&e.NdJ("click",function(){return i.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"}})}return n})();const eb=["renderedLegend"];function tb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.NdJ("toggle",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.toggleLegendItem(i,s))}),e.qZA(),e.TgZ(2,"span",8),e._uU(3),e.ALo(4,"async"),e.qZA()()}if(2&n){e.oxw();const t=e.MAs(3),o=e.oxw().$implicit,i=e.oxw(3);e.xp6(1),e.Q6J("target",t)("collapsed",o.collapsed),e.xp6(2),e.hij("",e.lcZ(4,3,i.computeItemTitle(o))," ")}}function ob(n,r){if(1&n&&(e.TgZ(0,"mat-option",11),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.name),e.xp6(1),e.Oqu(t.title)}}function ib(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"mat-form-field")(2,"mat-select",9),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(5);return e.KtG(s.currentStyle=i)})("selectionChange",function(){e.CHM(t);const i=e.oxw(5);return e.KtG(i.onChangeStyle())}),e.ALo(3,"translate"),e.YNc(4,ob,2,2,"mat-option",10),e.qZA()()()}if(2&n){const t=e.oxw(5);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("ngModel",t.currentStyle),e.xp6(2),e.Q6J("ngForOf",t.styles)}}function nb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"img",14,15),e.NdJ("load",function(){e.CHM(t);const i=e.oxw(4).$implicit,s=e.oxw(3);return e.KtG(s.onLoadImage(i.title))}),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw(4).$implicit;e.s9C("id",t.title),e.s9C("alt",e.lcZ(2,3,"igo.geo.layer.legend.loadingLegendText")),e.Q6J("src",t.imgGraphValue,e.LSH)}}function rb(n,r){1&n&&(e.TgZ(0,"small"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function sb(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,nb,3,5,"img",13),e.YNc(2,rb,3,3,"small",0),e.qZA()),2&n){const t=e.oxw(3).$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.imgGraphValue),e.xp6(1),e.Q6J("ngIf",o.imagesHeight[t.title]<16)}}function ab(n,r){if(1&n&&(e._UZ(0,"div",16),e.ALo(1,"sanitizeHtml")),2&n){const t=e.oxw(3).$implicit;e.Q6J("ngStyle",t.style)("innerHTML",e.lcZ(1,2,t.html),e.oJD)}}function lb(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,sb,3,2,"div",0),e.YNc(2,ab,2,4,"div",12),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",t.url),e.xp6(1),e.Q6J("ngIf",t.html)}}const cb=function(n){return{"with-title":n}};function ub(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,tb,5,5,"mat-list-item",0),e.TgZ(2,"div",5,6),e.YNc(4,ib,5,5,"div",0),e.YNc(5,lb,3,2,"div",0),e.qZA()()),2&n){const t=e.oxw().$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.title),e.xp6(1),e.Q6J("ngClass",e.VKq(4,cb,t.title)),e.xp6(2),e.Q6J("ngIf",void 0!==o.currentStyle),e.xp6(1),e.Q6J("ngIf",!t.collapsed)}}function pb(n,r){if(1&n&&(e.ynx(0,null,4),e.YNc(2,ub,6,6,"div",1),e.BQk()),2&n){e.oxw(2);const t=e.MAs(3),o=e.oxw();e.xp6(2),e.Q6J("ngIf",o.getLegend)("ngIfElse",t)}}function db(n,r){if(1&n&&(e.ynx(0),e.YNc(1,pb,3,2,"ng-container",3),e.BQk()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t.slice().reverse())}}function gb(n,r){1&n&&(e.TgZ(0,"small"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLegendText")," "))}function mb(n,r){if(1&n&&(e.ynx(0),e.YNc(1,db,2,1,"ng-container",1),e.YNc(2,gb,3,3,"ng-template",null,2,e.W1O),e.BQk()),2&n){const t=r.ngIf,o=e.MAs(3);e.xp6(1),e.Q6J("ngIf",t.length)("ngIfElse",o)}}let Pn=(()=>{class n{capabilitiesService;languageService;configService;http;cdRef;updateLegendOnResolutionChange=!1;legendItems$=new y.X([]);state$$;styles;currentStyle;scale=void 0;view=void 0;renderedLegends;imagesHeight={};layer;getLegend=!0;constructor(t,o,i,s,a){this.capabilitiesService=t,this.languageService=o,this.configService=i,this.http=s,this.cdRef=a}ngOnInit(){let t=this.layer.legend;this.styles=this.listStyles();const o=this.layer.options.source.options;if(o&&o.params&&o.params.STYLES?this.currentStyle=this.styles.find(i=>i.name===o.params.STYLES).name:t?this.styles&&this.styles.length>1&&(this.currentStyle=t[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),t=typeof this.layer.options.legendOptions<"u"&&!1===this.layer.options.legendOptions.display?[]:this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||o.contentDependentLegend)this.state$$=this.layer.map.viewController.state$.subscribe(()=>this.onViewControllerStateChange());else if(t&&0!==t.length){this.legendItems$.next(t);for(const i of t)this.getLegendGraphic(i)}}ngOnDestroy(){void 0!==this.state$$&&this.state$$.unsubscribe()}getLegendGraphic(t){t.url&&new zo(this.http,this.configService).transform(t.url).pipe((0,ce.K)(i=>{if(i.error)return i.error.caught=!0,this.getLegend=!1,this.cdRef.detectChanges(),i})).subscribe(i=>{const s=this.legendItems$.value.findIndex(l=>l.title===t.title);this.legendItems$.value[s].imgGraphValue=i,this.cdRef.detectChanges()})}toggleLegendItem(t,o){o.collapsed=t}transfertToggleLegendItem(t){const o=t,i=this.layer.legend;for(let s=0;s<i.length;s++)o[s].collapsed=i[s].collapsed;return o}computeItemTitle(t){const o=this.layer.dataSource.options;if("wms"!==o.type)return(0,z.of)(t.title);const i=o.params.LAYERS.split(","),s=JSON.parse(JSON.stringify(o));return s.params.LAYERS=i.find(a=>a===t.title),this.capabilitiesService.getWMSOptions(s).pipe((0,I.U)(a=>a._layerOptionsFromSource.title))}onViewControllerStateChange(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}updateLegend(){let t=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(t=this.transfertToggleLegendItem(t)),this.layer.legend=t,0!==t.length||0!==this.legendItems$.value.length){this.legendItems$.next(t);for(const o of this.legendItems$.value)this.getLegendGraphic(o)}}listStyles(){const t=this.layer.options;if(t&&t.legendOptions){let s=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return t.legendOptions.stylesAvailable&&(s=s.concat(t.legendOptions.stylesAvailable.filter(a=>"default"!==a.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==a.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")))),s.filter(a=>!a.title).map(a=>a.title=a.name),s.map(a=>a.title=a.title.charAt(0).toUpperCase()+a.title.slice(1).replace(/_/g," ")),s}}onChangeStyle(){this.updateLegend();let t="";this.layer.dataSource instanceof xo&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(o=>t+=this.currentStyle+","),t=t.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:t}))}onLoadImage(t){let o;o=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(i=>i.nativeElement.id===t).nativeElement,this.imagesHeight[t]=o.height}static \u0275fac=function(o){return new(o||n)(e.Y36(Zt),e.Y36(L),e.Y36(N),e.Y36($.eN),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-layer-legend"]],viewQuery:function(o,i){if(1&o&&e.Gf(eb,5),2&o){let s;e.iGM(s=e.CRH())&&(i.renderedLegends=s)}},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["noItems",""],[4,"ngFor","ngForOf"],["renderedLegends",""],[1,"igo-layer-legend",3,"ngClass"],["legend",""],["id","legend-toggle","matListItemIcon","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","","hideError","true",3,"id","src","alt","load",4,"ngIf"],["igoImageError","","hideError","true",3,"id","src","alt","load"],["renderedLegend",""],[3,"ngStyle","innerHTML"]],template:function(o,i){1&o&&(e.YNc(0,mb,4,2,"ng-container",0),e.ALo(1,"async")),2&o&&e.Q6J("ngIf",e.lcZ(1,1,i.legendItems$))},dependencies:[F.KE,_.JJ,f.mk,f.sg,f.O5,f.PC,_.On,w.Hw,se.gD,le.ey,P.gM,Z.Tg,Z.Yt,Z.sL,zi,Qs,f.Ov,O.X$,fr],styles:['[_nghost-%COMP%]   .igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;animation:2s linear infinite _ngcontent-%COMP%_spin}@-moz-document url-prefix(){-shadowcsshost-no-combinator img:after{margin-left:19px}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0})}return n})(),va=(()=>{class n{el;matIconRegistry;set igoMatBadgeIcon(t){this.matIconRegistry.getNamedSvgIcon(t).subscribe(o=>{this.svg=o,this.updateSvg()})}svg;set matBadgeHidden(t){this.hidden=t,this.updateHidden()}hidden=!1;set matBadgeDisabled(t){this.disabled=t,this.updateDisabled()}disabled=!1;set igoMatBadgeInverseColor(t){this.inverseColor=t,this.updateColor()}inverseColor=!1;set igoMatBadgeInheritColor(t){this.inheritColor=t,this.updateColor()}inheritColor=!1;set igoMatBadgeColor(t){this.color=t,this.updateColor()}color;set igoMatBadgeBackgroundColor(t){this.backgroundColor=t,this.updateColor()}backgroundColor;get badge(){return this.el.nativeElement.querySelector(".mat-badge-content")}originalColor;constructor(t,o){this.el=t,this.matIconRegistry=o}ngOnInit(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateSvg()}updateSvg(){this.badge&&(this.badge.innerHTML="",this.svg&&this.badge.appendChild(this.svg))}updateColor(){this.badge&&(this.color||this.backgroundColor?(this.badge.style.color=this.color?this.color:"",this.badge.style.background=this.backgroundColor?this.backgroundColor:""):this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inheritColor||(this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="")),this.originalColor=this.badge.style.color,this.updateDisabled())}updateHidden(){this.badge&&(this.badge.style.display=this.hidden?"none":"flex")}updateDisabled(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}static \u0275fac=function(o){return new(o||n)(e.Y36(e.SBq),e.Y36(w.jv))};static \u0275dir=e.lG2({type:n,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor",igoMatBadgeColor:"igoMatBadgeColor",igoMatBadgeBackgroundColor:"igoMatBadgeBackgroundColor"}})}return n})();function hb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.clearTerm())}),e._UZ(1,"mat-icon",10),e.qZA()}}let fb=(()=>{class n{onlyVisible$=new y.X(!1);sortAlpha$=new y.X(!1);term$=new y.X(void 0);onlyVisible$$;sortAlpha$$;term$$;layersAreAllVisible=!0;floatLabel="auto";set onlyVisible(t){this.onlyVisible$.next(t)}get onlyVisible(){return this.onlyVisible$.value}set sortAlpha(t){this.sortAlpha$.next(t)}get sortAlpha(){return this.sortAlpha$.value}set term(t){this.term$.next(t)}get term(){return this.term$.value}selectionMode=!1;appliedFilterAndSort=new e.vpe;selection=new e.vpe;ngOnInit(){this.term$$=this.term$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:t,onlyVisible:this.onlyVisible,sortAlpha:this.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:t,sortAlpha:this.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:this.onlyVisible,sortAlpha:t})})}ngOnDestroy(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()}clearTerm(){this.term=void 0}toggleSortAlpha(){this.sortAlpha=!this.sortAlpha}toggleOnlyVisible(){this.onlyVisible=!this.onlyVisible}toggleSelectionMode(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-layer-list-tool"]],inputs:{layersAreAllVisible:"layersAreAllVisible",floatLabel:"floatLabel",onlyVisible:"onlyVisible",sortAlpha:"sortAlpha",term:"term"},outputs:{appliedFilterAndSort:"appliedFilterAndSort",selection:"selection"},decls:18,vars:30,consts:[[1,"inputFilter",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"placeholder","matTooltip","ngModel","ngModelChange"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"color","matTooltip","click"],[3,"svgIcon"],["mat-icon-button","","matTooltipShowDelay","500",1,"only-visible",3,"disabled","color","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","eye","igoMatBadgeInverseColor","true","igoMatBadgeInheritColor","true",3,"svgIcon"],["mat-icon-button","","color","primary","matTooltipShowDelay","500",1,"selection-mode",3,"matTooltip","click"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"],["svgIcon","close"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-form-field",0)(1,"input",1),e.NdJ("ngModelChange",function(a){return i.term=a}),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA(),e.YNc(4,hb,2,0,"button",2),e.qZA(),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){return i.toggleSortAlpha()}),e.ALo(7,"translate"),e.ALo(8,"translate"),e._UZ(9,"mat-icon",5),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return i.toggleOnlyVisible()}),e.ALo(11,"translate"),e.ALo(12,"translate"),e._UZ(13,"mat-icon",7),e.qZA(),e.TgZ(14,"button",8),e.NdJ("click",function(){return i.toggleSelectionMode()}),e.ALo(15,"translate"),e.ALo(16,"translate"),e._UZ(17,"mat-icon",5),e.qZA()()),2&o&&(e.Q6J("floatLabel",i.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,14,"igo.geo.layer.filterPlaceholder"))("matTooltip",e.lcZ(3,16,"igo.geo.layer.subsetLayersListKeyword"))("ngModel",i.term),e.xp6(3),e.Q6J("ngIf",i.term),e.xp6(2),e.Q6J("color",i.sortAlpha?"warn":"primary")("matTooltip",i.sortAlpha?e.lcZ(7,18,"igo.geo.layer.sortMapOrder"):e.lcZ(8,20,"igo.geo.layer.sortAlphabetically")),e.xp6(3),e.Q6J("svgIcon",i.sortAlpha?"sort-ascending":"sort-alphabetical-ascending"),e.xp6(1),e.Q6J("disabled",i.layersAreAllVisible&&!i.onlyVisible)("color",i.onlyVisible?"warn":"primary")("matTooltip",i.onlyVisible?e.lcZ(11,22,"igo.geo.layer.resetLayersList"):e.lcZ(12,24,"igo.geo.layer.subsetLayersListOnlyVisible")),e.xp6(3),e.Q6J("svgIcon",i.onlyVisible?"filter-remove":"filter"),e.xp6(1),e.Q6J("matTooltip",i.selectionMode?e.lcZ(15,26,"igo.geo.layer.deactivateSelectionMode"):e.lcZ(16,28,"igo.geo.layer.activateSelectionMode")),e.xp6(3),e.Q6J("svgIcon",i.selectionMode?"checkbox-multiple-marked-outline":"checkbox-multiple-blank-outline"))},dependencies:[j.Nt,F.KE,F.R9,_.Fj,_.JJ,f.O5,_.On,w.Hw,S.RK,P.gM,ut.k,va,O.X$],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:50%}}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}return n})(),_b=(()=>{class n{keyword;sortAlpha=!1;onlyVisible=!1;onlyInRange=!1;keywordInitialized=!1;sortedAlphaInitialized=!1;onlyVisibleInitialized=!1;onlyInRangeInitialized=!1;constructor(){}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var gt=function(n){return n.always="always",n.never="never",n.default="default",n}(gt||{}),Ki=function(n){return n.ALL_VISIBLE="ALL_VISIBLE",n.ALL_HIDDEN="ALL_HIDDEN",n.MIXED="MIXED",n.NULL="NULL",n}(Ki||{}),Br=function(n){return n.Raise="raise",n.Lower="lower",n}(Br||{});const yb=["igoLayerItemToolbar"];function bb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-layer-list-tool",6),e.NdJ("appliedFilterAndSort",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onAppliedFilterAndSortChange(i))})("selection",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.toggleSelectionMode(i))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("layersAreAllVisible",t.layersAreAllVisible)("term",t.layerFilterAndSortOptions.keyword)("onlyVisible",t.layerFilterAndSortOptions.onlyVisible)("sortAlpha",t.layerFilterAndSortOptions.sortAlpha)}}function vb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",7)(1,"mat-checkbox",8),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.selectAll())}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("color",!t.selectAllCheck&&t.layersChecked.length>0?"accent":"primary")("checked",t.selectAllCheck)("indeterminate",!t.selectAllCheck&&t.layersChecked.length>0),e.xp6(1),e.hij(" ",t.selectAllCheck?e.lcZ(3,4,"igo.geo.layer.deselectAll"):e.lcZ(4,6,"igo.geo.layer.selectAll")," ")}}function Cb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-layer-item",10),e.NdJ("action",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.toggleLayerTool(i))})("checkbox",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.layersCheck(i))}),e.qZA()}if(2&n){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("layer",t)("activeLayer",o.activeLayer)("orderable",o.orderable&&!t.baseLayer)("lowerDisabled",o.getLowerLayer().id===t.id)("raiseDisabled",o.getUpperLayer().id===t.id)("queryBadge",o.queryBadge)("expandLegendIfVisible",o.expandLegendOfVisibleLayers)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange)("toggleLegendOnVisibilityChange",o.toggleLegendOnVisibilityChange)("selectionMode",o.selection)("selectAll",o.selectAllCheck)("layerCheck",t.options.check)("changeDetection",o.layerItemChangeDetection$)}}function xb(n,r){if(1&n&&e.YNc(0,Cb,1,13,"igo-layer-item",9),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",!(o.excludeBaseLayers&&t.baseLayer))}}function Sb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.removeLayers())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",29),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.removeLayer"))}function wb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.zoomLayerExtents(i.activeLayer))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",31),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.zoomLayer"))}const Tb=function(n){return{layer:n}};function Fb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-panel",11)(1,"div",12),e.YNc(2,Sb,3,3,"button",13),e.TgZ(3,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.moveActiveLayer(i.activeLayer,i.layerListDisplacement.Lower,!0))}),e.ALo(4,"translate"),e.ALo(5,"translate"),e._UZ(6,"mat-icon",15),e.qZA(),e.TgZ(7,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.moveActiveLayer(i.activeLayer,i.layerListDisplacement.Raise,!0))}),e.ALo(8,"translate"),e.ALo(9,"translate"),e._UZ(10,"mat-icon",17),e.qZA(),e.TgZ(11,"button",18),e.ALo(12,"translate"),e._UZ(13,"mat-icon",19),e.qZA(),e.TgZ(14,"mat-menu",20,21)(16,"mat-slider",22,23),e.NdJ("click",function(i){return i.stopPropagation()}),e.ALo(18,"translate"),e.TgZ(19,"input",24,25),e.NdJ("input",function(){e.CHM(t);const i=e.MAs(20),s=e.MAs(17),a=e.oxw();return e.KtG(a.changeOpacity({source:i,parent:s,value:i.value}))}),e.qZA()()(),e.YNc(21,wb,3,3,"button",26),e.GkF(22,27),e.Hsn(23),e.qZA()()}if(2&n){const t=e.MAs(15),o=e.oxw();e.Q6J("title",o.activeLayer.title),e.xp6(2),e.Q6J("ngIf",o.isLayerRemovable(o.activeLayer)),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(4,20,"igo.geo.layer.filterLowerLayer"):e.lcZ(5,22,"igo.geo.layer.lowerLayer"))("disabled",o.lowerDisabled),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.lowerDisabled),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(8,24,"igo.geo.layer.filterRaiseLayer"):e.lcZ(9,26,"igo.geo.layer.raiseLayer"))("disabled",o.raiseDisabled),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.raiseDisabled),e.xp6(1),e.Q6J("matMenuTriggerFor",t)("matTooltip",e.lcZ(12,28,"igo.geo.layer.opacity")),e.xp6(2),e.Q6J("matBadge",o.badgeOpacity),e.xp6(3),e.Q6J("min",0)("max",100)("matTooltip",e.lcZ(18,30,"igo.geo.layer.opacity")),e.xp6(3),e.Q6J("value",o.opacity),e.xp6(2),e.Q6J("ngIf",o.activeLayerExtentIsValid(o.activeLayer)),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateLayerToolbar)("ngTemplateOutletContext",e.VKq(32,Tb,o.activeLayer))}}function Ob(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slider",42),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.checkOpacity=i)})("click",function(i){return i.stopPropagation()}),e.ALo(1,"translate"),e._UZ(2,"input",43),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("min",0)("max",100)("ngModel",t.checkOpacity)("matTooltip",e.lcZ(1,4,"igo.geo.layer.opacity"))}}function Ab(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.zoomLayersExtents(i.layersChecked))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",44),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.zoomLayers"))}function Lb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-panel",11),e.ALo(1,"translate"),e.TgZ(2,"div",32)(3,"button",33),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.removeLayers(i.layersChecked))}),e.ALo(4,"translate"),e.ALo(5,"translate"),e._UZ(6,"mat-icon",34),e.qZA(),e.TgZ(7,"button",35),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleVisibility(i.layersChecked))}),e.ALo(8,"translate"),e.ALo(9,"translate"),e._UZ(10,"mat-icon",36),e.qZA(),e.TgZ(11,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.lowerLayers(i.layersChecked))}),e.ALo(12,"translate"),e.ALo(13,"translate"),e._UZ(14,"mat-icon",15),e.qZA(),e.TgZ(15,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.raiseLayers(i.layersChecked))}),e.ALo(16,"translate"),e.ALo(17,"translate"),e._UZ(18,"mat-icon",17),e.qZA(),e.TgZ(19,"button",37),e.ALo(20,"translate"),e._UZ(21,"mat-icon",38),e.qZA(),e.TgZ(22,"mat-menu",39,21)(24,"div",40),e.YNc(25,Ob,3,6,"mat-slider",41),e.qZA()(),e.YNc(26,Ab,3,3,"button",26),e.qZA()()}if(2&n){const t=e.MAs(23),o=e.oxw();e.Q6J("title",e.lcZ(1,21,"igo.geo.layer.tools")),e.xp6(3),e.Q6J("disabled",0===o.layersChecked.length)("matTooltip",o.isAllLayersRemovable(o.layersChecked)?e.lcZ(4,23,"igo.geo.layer.removeSelectedLayers"):e.lcZ(5,25,"igo.geo.layer.removeSelectedLayersRestriction")),e.xp6(3),e.Q6J("matBadge","!")("matBadgeHidden",o.isAllLayersRemovable(o.layersChecked)),e.xp6(1),e.Q6J("disabled",0===o.layersChecked.length)("matTooltip","ALL_HIDDEN"===o.statusSelectedLayersCheck?e.lcZ(8,27,"igo.geo.layer.showSelectedLayers"):e.lcZ(9,29,"igo.geo.layer.hideSelectedLayers")),e.xp6(3),e.Q6J("svgIcon","ALL_HIDDEN"===o.statusSelectedLayersCheck?"eye-off":"eye"),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(12,31,"igo.geo.layer.filterLowerLayer"):e.lcZ(13,33,"igo.geo.layer.lowerLayer"))("disabled",o.lowerDisabledSelection),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.lowerDisabledSelection),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(16,35,"igo.geo.layer.filterRaiseLayer"):e.lcZ(17,37,"igo.geo.layer.raiseLayer"))("disabled",o.raiseDisabledSelection),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.raiseDisabledSelection),e.xp6(1),e.Q6J("disabled",0===o.layersChecked.length)("matMenuTriggerFor",t)("matTooltip",e.lcZ(20,39,"igo.geo.layer.opacity")),e.xp6(6),e.Q6J("ngIf",o.layersChecked.length),e.xp6(1),e.Q6J("ngIf",0!==o.layersChecked.length&&o.activeLayersExtentAreValid(o.layersChecked))}}const Mb=[[["","igoLayerItemToolbar",""]]],Ib=["[igoLayerItemToolbar]"];let Mi=(()=>{class n{elRef;orderable=!0;thresholdToFilterAndSort=5;layers$=new y.X([]);change$=new hn.t(1);showToolbar$=new y.X(!1);layerTool;hideSelectedLayers=!0;activeLayer$=new y.X(void 0);layersChecked=[];selection;change$$;layers$$;layerItemChangeDetection$=new y.X(void 0);templateLayerToolbar;layersAreAllVisible=!0;ogcButton=!0;timeButton=!0;get map(){return this._map}set map(t){this._map=t}_map;set layers(t){this._layers=this.removeProblemLayerInList(t),this.next()}get layers(){return this._layers}_layers;set activeLayer(t){this._activeLayer=t,this.activeLayer$.next(t)}get activeLayer(){return this._activeLayer}_activeLayer;floatLabel="auto";layerFilterAndSortOptions={};excludeBaseLayers=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;queryBadge=!1;appliedFilterAndSort=new e.vpe;get keyword(){return this._keyword}set keyword(t){this._keyword=t,this.next()}_keyword=void 0;get onlyVisible(){return this._onlyVisible}set onlyVisible(t){this._onlyVisible=t,this.next()}_onlyVisible=!1;get sortAlpha(){return this._sortedAlpha}set sortAlpha(t){this._sortedAlpha=t,this.next()}_sortedAlpha=!1;get opacity(){return Math.round(100*this.activeLayer$.getValue().opacity)}set opacity(t){this.activeLayer$.getValue().opacity=t/100}get badgeOpacity(){if(100!==this.opacity)return this.opacity}get raiseDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))}get lowerDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))}get raiseDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck}get lowerDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck}get checkOpacity(){return 100*this.layersCheckedOpacity()}set checkOpacity(t){for(const o of this.layersChecked)o.opacity=t/100}get layerListDisplacement(){return Br}toggleOpacity=!1;selectAllCheck;selectAllCheck$=new y.X(void 0);selectAllCheck$$;constructor(t){this.elRef=t}ngOnInit(){this.change$$=this.change$.pipe((0,In.D)(()=>0===this.layers.length?bn.E:(0,Mn.H)(50))).subscribe(()=>{this.showToolbar$.next(this.computeShowToolbar()),this.layers$.next(this.computeLayers(this.layers.slice(0))),this.appliedFilterAndSort.emit({keyword:this.keyword,sortAlpha:this.sortAlpha,onlyVisible:this.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(t=>{this.selectAllCheck=t}),this.layers$$=this.layers$.subscribe(()=>{if(this.layers){let t=0;for(const o of this.layers)o.status$.subscribe(i=>{0===i&&this.map.removeLayer(o)}),o.options.active&&(this.activeLayer=o,this.layerTool=!0),o.options.check&&(t+=1);this.selectAllCheck=this.excludeBaseLayers?t===this.layers.filter(o=>!0!==o.baseLayer&&o.showInLayerList).length:t===this.layers.filter(o=>o.showInLayerList).length}})}ngOnDestroy(){this.change$$.unsubscribe(),this.selectAllCheck$$.unsubscribe(),this.layers$$.unsubscribe()}activeLayerExtentIsValid(t){let o=!1;if(!1===t.options.showButtonZoomToExtent)return!1;const i=t.options.extent,s=this.map.viewController.maxLayerZoomExtent;return i&&(o=!s||De.r4(s,i)),o}activeLayersExtentAreValid(t){let o=!1;const i=De.lJ(),s=this.map.viewController.maxLayerZoomExtent;for(const a of t){const l=a.options.extent;l&&!l.includes(1/0)&&De.l7(i,l)}return De.xb(i)||(o=!s||De.r4(s,i)),o}zoomLayerExtents(t){this.map.viewController.zoomToExtent(t.options.extent)}zoomLayersExtents(t){const o=De.lJ();for(const i of t){const s=i.options.extent;s&&De.l7(o,s)}this.map.viewController.zoomToExtent(o)}changeOpacity(t){this.opacity=t.value}clearKeyword(){this.keyword=void 0}getLowerLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,o)=>t.zIndex<o.zIndex?t:o,{zIndex:void 0,id:void 0})}isLowerBaselayer(t){const o=this.layers.findIndex(i=>t.id===i.id);return!(!this.layers||!this.layers[o+1]||!0!==this.layers[o+1].baseLayer)}getUpperLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,o)=>t.zIndex>o.zIndex?t:o,{zIndex:void 0,id:void 0})}isUpperBaselayer(t){const o=this.layers.findIndex(i=>t.id===i.id);return!(!this.layers||!this.layers[o-1]||!0!==this.layers[o-1].baseLayer)}moveActiveLayer(t,o,i=!1){const s=[];Rr(this.map,t,Ge.ZINDEX);let a=Rr(this.map,t,Ge.ZINDEX);a||(a=t);const l=[a];ba(this.map,a,l,Ge.ZINDEX),this.layers.map(c=>{-1!==l.indexOf(c)&&s.push(c)}),o===Br.Raise?this.raiseLayers(s,i):o===Br.Lower&&this.lowerLayers(s,i)}raisableLayers(t){let o=!1,i=0;for(const s of t){const a=this.layers.findIndex(u=>s.id===u.id),l=this.layers[a];l.baseLayer&&(i+=1);const c=this.layers[a-1];c&&!0!==c.baseLayer&&!t.find(u=>c.id===u.id)&&!0!==l.baseLayer&&(o=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||i===this.layersChecked.length)&&(o=!1),o}raisableLayer(t){return!(t<1)&&(!this.layers[t-1].options.check||this.raisableLayer(t-1))}raiseLayers(t,o=!0){const i=[];for(const s of t){const a=this.layers.findIndex(l=>l.id===s.id);this.raisableLayer(a)&&i.push(s)}this.map.raiseLayers(i),o&&setTimeout(()=>{const s=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),a=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let l;s.length&&(l=s[0]),a.length&&(l=a[0]),l&&(0,Ys.Z)(l,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}lowerableLayers(t){let o=!1,i=0;for(const s of t){const a=this.layers.findIndex(u=>s.id===u.id);this.layers[a].baseLayer&&(i+=1);const c=this.layers[a+1];c&&!0!==c.baseLayer&&!t.find(u=>c.id===u.id)&&(o=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||i===this.layersChecked.length)&&(o=!1),o}lowerableLayer(t){return!(t>this.layers.filter(o=>!0!==o.baseLayer).length-2)&&(!this.layers[t+1].options.check||this.lowerableLayer(t+1))}lowerLayers(t,o=!0){const i=[];for(const s of t){const a=this.layers.findIndex(l=>l.id===s.id);this.lowerableLayer(a)&&i.push(s)}this.map.lowerLayers(i),o&&setTimeout(()=>{const s=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),a=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let l;s.length&&(l=s[s.length-1]),a.length&&(l=a[0]),l&&(0,Ys.Z)(l,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}next(){this.change$.next()}computeLayers(t){let o=this.filterLayers(t);return o=this.sortAlpha?this.sortLayersByTitle(o):this.sortLayersByZindex(o),o}onKeywordChange(t){this.keyword=t}onAppliedFilterAndSortChange(t){this.keyword=t.keyword,this.onlyVisible=t.onlyVisible,this.sortAlpha=t.sortAlpha}filterLayers(t){if(this.layerFilterAndSortOptions.showToolbar===gt.never||!this.keyword&&!this.onlyVisible)return t;const o=t.map(i=>i.id);return t.forEach(i=>{const a=i.dataSource.options||{},u=(((i.options||{}).metadata||{}).keywordList||[]).map(p=>p.normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(this.keyword&&i.title){const p=this.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),d=i.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),g=a.type||"",h=new RegExp(p,"gi"),m=void 0!==u.find(b=>h.test(b));if(!h.test(d)&&this.keyword.toLowerCase()!==g.toLowerCase()&&!m){const b=o.indexOf(i.id);b>-1&&o.splice(b,1)}}if(this.onlyVisible&&!1===i.visible){const p=o.indexOf(i.id);p>-1&&o.splice(p,1)}}),t.filter(i=>-1!==o.indexOf(i.id))}sortLayersByZindex(t){return t.sort((o,i)=>i.zIndex-o.zIndex)}sortLayersByTitle(t){return t.sort((o,i)=>this.normalize(o.title)<this.normalize(i.title)?-1:this.normalize(o.title)>this.normalize(i.title)?1:0)}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}computeShowToolbar(){switch(this.layerFilterAndSortOptions.showToolbar){case gt.always:return!0;case gt.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}}toggleLayerTool(t){this.toggleOpacity=!1,this.layerTool=!this.layerTool||t!==this.activeLayer;for(const o of this.layers)o.options.active=!1;t.options.active=!0,this.activeLayer=t}removeLayers(t){if(t&&t.length>0){this.layersChecked=[];for(const o of t)!1!==o.options.removable?o.map.removeLayer(o):this.layersChecked.push(o)}else!t&&!1!==this.activeLayer.options.removable&&(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)}toggleVisibility(t){if(t&&t.length>0)for(const o of t)o.visible=this.hideSelectedLayers;this.layerItemChangeDetection$.next(!0)}isLayerRemovable(t){return!1!==t.options.removable}isAllLayersRemovable(t){return t.every(o=>this.isLayerRemovable(o))}get statusSelectedLayersCheck(){let t=Ki.NULL,o=!1,i=!1;if(0===this.layersChecked.length)t=Ki.NULL;else{t=Ki.MIXED,this.hideSelectedLayers=!1;for(const s of this.layersChecked)!0===s.visible&&(o=!0),!1===s.visible&&(i=!0);!0===o&&!1===i&&(t=Ki.ALL_VISIBLE),!1===o&&!0===i&&(t=Ki.ALL_HIDDEN,this.hideSelectedLayers=!0)}return t}layersCheck(t){if(t.layer.options.check=t.check,!0===t.check){const o=this.layers.findIndex(i=>t.layer.id===i.id);for(const i of this.layersChecked)if(o<this.layers.findIndex(a=>i.id===a.id))return this.layersChecked.splice(this.layersChecked.findIndex(a=>i.id===a.id),0,t.layer),void(this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(a=>!0!==a.baseLayer&&a.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(a=>a.showInLayerList).length));this.layersChecked.push(t.layer)}else{const o=this.layersChecked.findIndex(i=>t.layer.id===i.id);this.layersChecked.splice(o,1)}this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(o=>!0!==o.baseLayer&&o.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(o=>o.showInLayerList).length)}toggleSelectionMode(t){if(this.selection=t,this.activeLayer=void 0,!0===t){this.layerTool=!1;for(const o of this.layers)o.options.check&&this.layersChecked.push(o)}}layersCheckedOpacity(){if(this.layersChecked.length>1)return 1;{const t=[];for(const o of this.layersChecked)t.push(o.opacity);return t}}selectAll(){if(this.selectAllCheck){for(const t of this.layers)t.options.check=!1;this.layersChecked=[],this.selectAllCheck$.next(!1)}else{for(const t of this.layers)(this.excludeBaseLayers&&!0!==t.baseLayer&&t.showInLayerList||!this.excludeBaseLayers&&t.showInLayerList)&&(t.options.check=!0,this.layersChecked.push(t));this.selectAllCheck$.next(!0)}}isScrolledIntoView(t,o){const i=t.scrollTop,a=o.offsetTop;return a+o.clientHeight<=i+t.clientHeight&&a>=i}removeProblemLayerInList(t){for(const o of t)!0===o.olLoadingProblem&&this.map.removeLayer(o);return t}static \u0275fac=function(o){return new(o||n)(e.Y36(e.SBq))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-layer-list"]],contentQueries:function(o,i,s){if(1&o&&e.Suo(s,yb,5),2&o){let a;e.iGM(a=e.CRH())&&(i.templateLayerToolbar=a.first)}},inputs:{layersAreAllVisible:"layersAreAllVisible",ogcButton:"ogcButton",timeButton:"timeButton",map:"map",layers:"layers",floatLabel:"floatLabel",layerFilterAndSortOptions:"layerFilterAndSortOptions",excludeBaseLayers:"excludeBaseLayers",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",queryBadge:"queryBadge"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},ngContentSelectors:Ib,decls:10,vars:11,consts:[["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection",4,"ngIf"],["class","select-all",4,"ngIf"],[3,"navigation","selection"],["igoList",""],["ngFor","",3,"ngForOf"],["class","igo-layer-actions-container",3,"title",4,"ngIf"],["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection"],[1,"select-all"],[1,"select-all-checkbox",3,"color","checked","indeterminate","change"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox",4,"ngIf"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"matTooltip","disabled","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-down",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"matTooltip","disabled","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-up",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["aria-hidden","false","matBadgeColor","primary","matBadgeSize","medium","svgIcon","opacity",3,"matBadge"],[1,"panel-opacity-menu"],["opacityMenu","matMenu"],["id","opacity-slider","color","primary","discrete","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","matTooltip","click"],["ngSlider",""],["matSliderThumb","",3,"value","input"],["ngSliderThumb","matSliderThumb"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoLayerItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"matTooltip","click"],["matBadgeColor","primary","matBadgeSize","medium","svgIcon","magnify-scan"],[1,"actions-buttons-multi"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"disabled","matTooltip","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","delete",3,"matBadge","matBadgeHidden"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"disabled","matTooltip","click"],[3,"svgIcon"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"disabled","matMenuTriggerFor","matTooltip"],["svgIcon","opacity"],[1,"mat-menu-opacity-slider"],["id","opacity-menu"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click",4,"ngIf"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click"],["matSliderThumb",""],["svgIcon","magnify-scan"]],template:function(o,i){1&o&&(e.F$t(Mb),e.YNc(0,bb,1,4,"igo-layer-list-tool",0),e.ALo(1,"async"),e.YNc(2,vb,5,8,"div",1),e._UZ(3,"mat-divider"),e.TgZ(4,"igo-list",2,3),e.YNc(6,xb,1,1,"ng-template",4),e.ALo(7,"async"),e.qZA(),e.YNc(8,Fb,24,34,"igo-panel",5),e.YNc(9,Lb,27,41,"igo-panel",5)),2&o&&(e.Q6J("ngIf",e.lcZ(1,7,i.showToolbar$)),e.xp6(2),e.Q6J("ngIf",i.selection),e.xp6(2),e.Q6J("navigation",!1)("selection",!1),e.xp6(2),e.Q6J("ngForOf",e.lcZ(7,9,i.layers$)),e.xp6(2),e.Q6J("ngIf",!i.selection&&i.layerTool&&i.activeLayer),e.xp6(1),e.Q6J("ngIf",i.selection&&i.layers.length>0))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{flex:1;padding-top:8px}[_nghost-%COMP%]   mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{padding:0 6px 0 4px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__content{margin-bottom:10px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{padding-top:5px}[_nghost-%COMP%]   igo-panel[_ngcontent-%COMP%]{height:unset}[_nghost-%COMP%]   .select-all[_ngcontent-%COMP%]{display:flex;align-items:center;height:48px;padding:0 16px}  .panel-opacity-menu{overflow:visible!important}  .panel-opacity-menu #opacity-slider{margin:0 16px}"],changeDetection:0})}return n})();var Eu=v(85007),mt=v(81527);let Zb=(()=>{class n{ngxIndexedDBService;compression;dbName="geoData";collisionsMap=new Map;_newData=0;constructor(t,o){this.ngxIndexedDBService=t,this.compression=o}update(t,o,i,s,a){if(!i)return;let l=!1;const c=new fe.x;let p,u=(0,z.of)(i);return i instanceof Blob&&(u=this.compression.compressBlob(i),l=!0),u.pipe((0,Lt.P)(),(0,oo.b)(d=>(p={url:t,regionID:o,object:d,compressed:l,insertSource:s,insertEvent:a},this.ngxIndexedDBService.getByID(this.dbName,t))),(0,oo.b)(d=>{if(d){const g=d.regionID;if(g!==o){const h=this.collisionsMap.get(g);void 0!==h?(h.push(d.url),this.collisionsMap.set(g,h)):this.collisionsMap.set(g,[d.url])}return this.customUpdate(p)}return this._newData++,this.ngxIndexedDBService.add(this.dbName,p)})).subscribe(d=>{c.next(d),c.complete()}),c}customUpdate(t){const o=new fe.x;return this.ngxIndexedDBService.deleteByKey(this.dbName,t.url).pipe((0,oo.b)(s=>s?this.ngxIndexedDBService.add(this.dbName,t):(0,z.of)(void 0))).subscribe(s=>{s&&o.next(s),o.complete()}),o}get(t){return this.ngxIndexedDBService.getByID(this.dbName,t).pipe((0,I.U)(o=>{if(o){const i=o.object;return o.compressed?this.compression.decompressBlob(i):i}}))}getByID(t){return this.ngxIndexedDBService.getByID(this.dbName,t)}deleteByKey(t){return this.ngxIndexedDBService.deleteByKey(this.dbName,t)}getRegionCountByID(t){const o=new fe.x;return this.getRegionByID(t).subscribe(s=>{o.next(s.length),o.complete()}),o}getRegionByID(t){if(!t)return;const o=IDBKeyRange.only(t);return this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",o)}deleteByRegionID(t){if(!t)return;const o=IDBKeyRange.only(t),i=this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",o);return i.subscribe(s=>{s.forEach(a=>{this.ngxIndexedDBService.deleteByKey(this.dbName,a.url)})}),i}openCursor(t=IDBKeyRange.lowerBound(0),o=er.TA.readonly){return this.ngxIndexedDBService.openCursorByIndex(this.dbName,"regionID",t,o)}resetCounters(){this.resetCollisionsMap(),this._newData=0}resetCollisionsMap(){this.collisionsMap=new Map}revertCollisions(){for(const[t,o]of this.collisionsMap)for(const i of o)this.ngxIndexedDBService.getByKey(this.dbName,i).pipe((0,mt.q)(1)).subscribe(s=>{s.regionID=t,this.customUpdate(s)})}get newData(){return this._newData}static \u0275fac=function(o){return new(o||n)(e.LFG(er.ys),e.LFG(cg))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),kb=(()=>{class n{http;geoDBService;networkService;networkOnline=!0;constructor(t,o,i){this.http=t,this.geoDBService=o,this.networkService=i,this.networkService.currentState().subscribe(s=>{this.networkOnline=s.connection})}get(t,o){return window.navigator.onLine&&this.networkOnline?this.getOnline(t,o):this.getOffline(t)}getOnline(t,o){let i;switch(o.responseType){case"arraybuffer":i=this.http.get(t,{responseType:"arraybuffer",withCredentials:o.withCredentials});break;case"text":i=this.http.get(t,{responseType:"text",withCredentials:o.withCredentials});break;case"json":i=this.http.get(t,{responseType:"json",withCredentials:o.withCredentials});break;default:i=this.http.get(t,{responseType:"blob",withCredentials:o.withCredentials})}return i}getOffline(t){return this.geoDBService.get(t)}isOnline(){return this.networkOnline&&window.navigator.onLine}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(Zb),e.LFG(nr))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Ru(n){const r=n;return"mvt"===r.sourceOptions?.type&&(r.igoStyle?.styleByAttribute?.hoverStyle||r.igoStyle?.hoverStyle)&&(r.sourceOptions.featureClass=r.sourceOptions.featureClass||"feature"),n}let $b=(()=>{class n{ngxIndexedDBService;dbName="layerData";constructor(t){this.ngxIndexedDBService=t}update(t){const o=new fe.x;return this.ngxIndexedDBService.getByID(this.dbName,t.layerId).pipe((0,Lt.P)(),(0,oo.b)(i=>i?this.customUpdate(t):this.ngxIndexedDBService.add(this.dbName,t))).subscribe(i=>{o.next(i),o.complete()}),o}customUpdate(t){const o=new fe.x;return this.ngxIndexedDBService.deleteByKey(this.dbName,t.layerId).pipe((0,oo.b)(s=>s?this.ngxIndexedDBService.add(this.dbName,t):(0,z.of)(void 0))).subscribe(s=>{s&&o.next(s),o.complete()}),o}getByID(t){return this.ngxIndexedDBService.getByID(this.dbName,t)}deleteByKey(t){return this.ngxIndexedDBService.deleteByKey(this.dbName,t)}getAll(){return this.ngxIndexedDBService.getAll(this.dbName)}static \u0275fac=function(o){return new(o||n)(e.LFG(er.ys))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Se=(()=>{class n{http;styleService;dataSourceService;geoNetworkService;messageService;layerDBService;authInterceptor;constructor(t,o,i,s,a,l,c){this.http=t,this.styleService=o,this.dataSourceService=i,this.geoNetworkService=s,this.messageService=a,this.layerDBService=l,this.authInterceptor=c}createLayer(t){if(!t.source)return;let o;switch(t.source.options&&t.source.options._layerOptionsFromSource&&(t=R.mergeDeep(t.source.options._layerOptionsFromSource,t||{})),t.source.constructor){case uu:case ma:case pu:case mu:case Mr:case Fn:o=this.createTileLayer(t);break;case Ae:case Lr:case ha:case hu:case bo:o=this.createVectorLayer(t);break;case fa:case xo:o=this.createImageLayer(t);break;case yu:const i=Ru(t);o=this.createVectorTileLayer(i)}return o}createAsyncLayer(t,o){const i=Ru(t);return i.source?new ue.y(s=>s.next(this.createLayer(i))):this.dataSourceService.createAsyncDataSource(i.sourceOptions,o).pipe((0,I.U)(s=>{if(void 0!==s)return this.createLayer(Object.assign(i,{source:s}))}))}createImageLayer(t){return new q_(t,this.messageService,this.authInterceptor)}createTileLayer(t){return new Q_(t,this.messageService,this.authInterceptor)}createVectorLayer(t){let i,o=t.style;if(t.igoStyle||(t.igoStyle={}),this.handleLegacyStyles(t,["styleByAttribute","hoverStyle","mapboxStyle","clusterBaseStyle","style"]),t.igoStyle.igoStyleObject&&!t.idbInfo?.storeToIdb?o=(l,c)=>this.styleService.createStyle(t.igoStyle.igoStyleObject,l,c):t.igoStyle.igoStyleObject&&t.idbInfo?.storeToIdb&&(o=this.styleService.parseStyle("style",t.igoStyle.igoStyleObject)),t.source instanceof ha)o=t.source.options.params.style;else if(t.igoStyle?.styleByAttribute){const l=this.styleService;t.style=(c,u)=>l.createStyleByAttribute(c,t.igoStyle.styleByAttribute,u),i=new xe(t,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}if(t.source instanceof bo){const l=this.styleService,c=t.igoStyle.clusterBaseStyle;t.style=(u,p)=>l.createClusterStyle(u,p,t.clusterParam,c),i=new xe(t,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}const a=Object.assign({},t,{style:o});return i||(i=new xe(a,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)),this.applyMapboxStyle(i,a),i}handleLegacyStyles(t,o){o.map(i=>{if(t[i]){let s=i;if("style"===i){if(t[i]instanceof J.ZP)return;if("object"!=typeof t[i])return;s="igoStyleObject"}t.igoStyle[s]=t[i],delete t[i],console.warn(`\n        The location of this style option (${i}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${i}: {...} must be transfered to igoStyle: { ${s}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `)}})}createVectorTileLayer(t){let o,i;if(t.igoStyle||(t.igoStyle={}),this.handleLegacyStyles(t,["styleByAttribute","hoverStyle","mapboxStyle","style"]),t.igoStyle.igoStyleObject&&(o=(l,c)=>this.styleService.createStyle(t.igoStyle.igoStyleObject,l,c)),t.igoStyle.styleByAttribute){const l=this.styleService;t.style=(c,u)=>l.createStyleByAttribute(c,t.igoStyle.styleByAttribute,u),i=new Pu(t,this.messageService,this.authInterceptor)}const a=Object.assign({},t,{style:o});return i||(i=new Pu(a,this.messageService,this.authInterceptor)),this.applyMapboxStyle(i,a),i}applyMapboxStyle(t,o){o.igoStyle?.mapboxStyle&&this.getStuff(o.igoStyle.mapboxStyle.url).subscribe(i=>{if(i.sprite){const s=this.getAbsoluteUrl(o.igoStyle.mapboxStyle.url,i.sprite);this.getStuff(s+".json").subscribe(a=>{(0,Eu.uX)(t.ol,i,o.igoStyle.mapboxStyle.source,void 0,a,s+".png")})}else(0,Eu.uX)(t.ol,i,o.igoStyle.mapboxStyle.source)})}getStuff(t){return this.http.get(t).pipe((0,I.U)(o=>o),(0,ce.K)(o=>(console.log("No style was found"),(0,z.of)(o))))}getAbsoluteUrl(t,o){return new RegExp("^http|//","i").test(o)?o:"/"===t.substr(t.length-1)?t+o:t+"/"+o}createAsyncIdbLayers(t="*"){return this.layerDBService.getAll().pipe((0,oo.b)(o=>{const s=("*"!==t?o.filter(a=>a.detailedContextUri===t):o).map(a=>Object.assign({},a.layerOptions,{sourceOptions:a.sourceOptions}));return(0,Ye.a)(s.map(a=>this.createAsyncLayer(a)))}))}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(yo),e.LFG(_t),e.LFG(kb),e.LFG(_e),e.LFG($b),e.LFG(sr,8))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Nt=(()=>{class n{renderer;el;static focusedCls="igo-list-item-focused";static selectedCls="igo-list-item-selected";static disabledCls="igo-list-item-disabled";get color(){return this._color}set color(t){this._color=t}_color="primary";get focused(){return this._focused}set focused(t){t!==this._focused&&(this.disabled||(t?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=t,!0!==this.selected&&this.toggleFocusedClass(),t?this.focus.emit(this):this.unfocus.emit(this)))}_focused=!1;get selected(){return this._selected}set selected(t){t!==this._selected&&(this.disabled||(t?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=t,this._focused=t,this.toggleSelectedClass(),t?this.select.emit(this):this.unselect.emit(this)))}_selected=!1;get disabled(){return this._disabled}set disabled(t){t!==this._disabled&&(!0===t&&(this.selected=!1),t?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=t,this.toggleDisabledClass(),t?this.disable.emit(this):this.enable.emit(this))}_disabled=!1;beforeSelect=new e.vpe;beforeFocus=new e.vpe;beforeUnselect=new e.vpe;beforeUnfocus=new e.vpe;beforeDisable=new e.vpe;beforeEnable=new e.vpe;focus=new e.vpe;unfocus=new e.vpe;select=new e.vpe;unselect=new e.vpe;disable=new e.vpe;enable=new e.vpe;onClick(){this.selected=!0}constructor(t,o){this.renderer=t,this.el=o}getOffsetTop(){return this.el.nativeElement.offsetTop-5}toggleFocusedClass(){this.focused?this.addCls(n.focusedCls):this.removeCls(n.focusedCls)}toggleSelectedClass(){this.selected?(this.addCls(n.selectedCls),this.removeCls(n.focusedCls)):this.removeCls(n.selectedCls)}toggleDisabledClass(){this.disabled?this.addCls(n.disabledCls):this.removeCls(n.disabledCls)}addCls(t){this.renderer.addClass(this.el.nativeElement,t)}removeCls(t){this.renderer.removeClass(this.el.nativeElement,t)}static \u0275fac=function(o){return new(o||n)(e.Y36(e.Qsj),e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","igoListItem",""]],hostBindings:function(o,i){1&o&&e.NdJ("click",function(){return i.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"}})}return n})(),Db=(()=>{class n{el;clickout=new e.vpe;handleMouseClick(t,o){o&&(this.el.nativeElement.contains(o)||this.clickout.emit(t))}constructor(t){this.el=t}static \u0275fac=function(o){return new(o||n)(e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","igoClickout",""]],hostBindings:function(o,i){1&o&&e.NdJ("click",function(a){return i.handleMouseClick(a,a.target)},!1,e.evT)},outputs:{clickout:"clickout"}})}return n})();const Eb=function(n){return{selectable:n}},Rb=["*"];let So=(()=>{class n{el;get navigation(){return this._navigation}set navigation(t){this._navigation=t}_navigation=!0;get selection(){return this._selection}set selection(t){this._selection=t}_selection=!0;get selectedItem(){return this._selectedItem}set selectedItem(t){this.focusedItem=t,this._selectedItem=t}_selectedItem;get focusedItem(){return this._focusedItem}set focusedItem(t){this._focusedItem=t}_focusedItem;navigationEnabled;listItems$$;subscriptions=[];listItems;handleKeyboardEvent(t){this.navigationEnabled&&("ArrowUp"===t.key||"ArrowDown"===t.key?(t.preventDefault(),this.navigate(t.key)):"Enter"===t.key&&this.select(this.focusedItem))}constructor(t){this.el=t}ngOnInit(){this.enableNavigation()}ngAfterViewInit(){this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(t=>this.init())}ngOnDestroy(){this.listItems$$.unsubscribe()}focus(t){this.selection&&(this.unfocus(),void 0!==t&&(t.focused=!0))}unfocus(){void 0!==this.focusedItem&&(this.focusedItem.focused=!1),this.focusedItem=void 0}focusNext(){const t=this.listItems.toArray();let o;const i=this.el.nativeElement;let s=!0,a=this.getFocusedIndex();for(void 0===a&&(a=-1);s&&a<t.length-1;)a+=1,o=t[a],s=o.disabled;void 0!==o&&this.focus(o),t[a+1]?void 0!==o&&!this.isScrolledIntoView(o.el.nativeElement)&&(i.scrollTop=o.el.nativeElement.offsetTop+o.el.nativeElement.children[0].offsetHeight-i.clientHeight):i.scrollTop=i.scrollHeight-i.clientHeight}focusPrevious(){const t=this.listItems.toArray();let o;const i=this.el.nativeElement;let s=!0,a=this.getFocusedIndex();for(;s&&a>0;)a-=1,o=t[a],s=o.disabled;void 0!==o&&this.focus(o),t[a-1]?void 0!==o&&!this.isScrolledIntoView(o.el.nativeElement)&&(i.scrollTop=o.el.nativeElement.offsetTop-3):i.scrollTop=0}select(t){this.selection&&(this.unselect(),void 0!==t&&(t.selected=!0))}unselect(){this.unfocus(),void 0!==this.selectedItem&&(this.selectedItem.selected=!1),this.selectedItem=void 0}enableNavigation(){this.navigation&&(this.navigationEnabled=!0)}disableNavigation(){this.navigationEnabled=!1}scrollToItem(t){this.el.nativeElement.scrollTop=t.getOffsetTop()}isScrolledIntoView(t){const o=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,s=t.offsetTop;return s+t.children[0].offsetHeight<=o+this.el.nativeElement.clientHeight&&s>=o}init(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}subscribe(){this.unsubscribe(),this.listItems.toArray().forEach(t=>{this.subscriptions.push(t.beforeSelect.subscribe(o=>this.handleItemBeforeSelect(o))),this.subscriptions.push(t.select.subscribe(o=>this.handleItemSelect(o))),this.subscriptions.push(t.beforeFocus.subscribe(o=>this.handleItemBeforeFocus(o))),this.subscriptions.push(t.focus.subscribe(o=>this.handleItemFocus(o)))},this)}unsubscribe(){this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[]}handleItemBeforeFocus(t){t!==this.focusedItem&&this.unfocus()}handleItemFocus(t){this.focusedItem=t}handleItemBeforeSelect(t){t!==this.focusedItem&&this.unselect()}handleItemSelect(t){this.selectedItem=t}findSelectedItem(){return this.listItems.toArray().find(t=>t.selected)}findFocusedItem(){return this.listItems.toArray().find(t=>t.focused)}getFocusedIndex(){return this.listItems.toArray().findIndex(t=>t===this.focusedItem)}navigate(t){switch(t){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext()}}static \u0275fac=function(o){return new(o||n)(e.Y36(e.SBq))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-list"]],contentQueries:function(o,i,s){if(1&o&&e.Suo(s,Nt,5),2&o){let a;e.iGM(a=e.CRH())&&(i.listItems=a)}},hostBindings:function(o,i){1&o&&e.NdJ("keydown",function(a){return i.handleKeyboardEvent(a)},!1,e.evT)("enter",function(a){return i.handleKeyboardEvent(a)},!1,e.evT)},inputs:{navigation:"navigation",selection:"selection"},ngContentSelectors:Rb,decls:2,vars:3,consts:[["igoClickout","",3,"ngClass","clickout","click"]],template:function(o,i){1&o&&(e.F$t(),e.TgZ(0,"mat-list",0),e.NdJ("clickout",function(){return i.disableNavigation()})("click",function(){return i.enableNavigation()}),e.Hsn(1),e.qZA()),2&o&&e.Q6J("ngClass",e.VKq(1,Eb,i.selection))},dependencies:[f.mk,Z.i$,Db],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mdc-list-item--with-leading-icon{height:48px}[_nghost-%COMP%]     .mat-mdc-list   igo-collapsible>.mat-mdc-list-item>.mdc-list-item__primary-text>.mat-mdc-list-item{font-weight:700;opacity:.9}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}"]})}return n})(),kn=(()=>{class n{static forRoot(){return{ngModule:n,providers:[Se,yo,_b]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[j.c,_.UX,F.lN,f.ez,_.u5,Ve.t,Be.Tx,w.Ps,S.ot,tt.rP,se.LD,P.AV,Z.ie,fo.KP,ut.g,ze.p9,re,bi,Ui,Js,It,lr,pn]})}return n})();e.B6R($u,[f.mk,f.O5,w.Hw,S.RK,P.gM,Z.Tg,Z.Yt,Z.sL,Z.ni,ut.k,ze.oG,Pn],[f.Ov,O.X$]),e.B6R(Du,[P.gM,Z.Tg,Z.sL,Pn],[]),e.B6R(Mi,[_.JJ,f.sg,f.O5,f.tP,_.On,Ve.d,Be.VK,Be.p6,w.Hw,S.RK,P.gM,fo.pH,fo.$5,ut.k,ze.oG,Nt,So,Ht,$u,fb],[f.Ov,O.X$]),e.B6R(Zn,[f.sg,f.O5,Ve.d,tt.Rr,P.gM,Nt,So,Du],[f.Ov,O.X$]);let $n=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,S.ot,P.AV,re,B.Is]})}return n})();var Nu=v(90071),Nb=v(58265),Bu=v(50282),Ca=v(89912),Bb=v(42301),Jb=v.n(Bb);let xa=(()=>{class n{http;messageService;languageService;queryEnabled=!0;defaultFeatureCount=20;featureCount=20;previousMessageIds=[];constructor(t,o,i){this.http=t,this.messageService=o,this.languageService=i}query(t,o){this.previousMessageIds.length&&this.previousMessageIds.forEach(a=>{this.messageService.remove(a)});const i=t.filter(a=>a.visible&&a.isInResolutionsRange).map(a=>this.queryLayer(a,o));return[].concat.apply([],i)}queryLayer(t,o){const i=this.getQueryUrl(t.dataSource,o,!1,t.map.viewController.getExtent());if(!i)return(0,z.of)([]);const s=t.map.viewController.getResolution(),a=t.map.viewController.getScale();if(t.dataSource.options.queryFormat===We.HTMLGML2){if("string"==typeof i){const u=this.getQueryUrl(t.dataSource,o,!0);return this.http.get(u,{responseType:"text"}).pipe((0,Ca.z)(p=>{const d=this.mergeGML(p,i,t),g=d[0],h=d[1];return this.http.get(i,{responseType:"text"}).pipe((0,I.U)(m=>this.extractData(m,t,o,i,g,h)))}))}const l=this.getQueryUrl(t.dataSource,o,!0);let c=[];for(let u=0;u<l.length;u++){const p=l[u];this.checkScaleAndResolution(s,a,p)&&c.push(this.requestDataForHTMLGML2(p.url,i[u].url,t,o))}return c}{if("string"==typeof i)return this.http.get(i,{responseType:"text"}).pipe((0,I.U)(u=>this.extractData(u,t,o,i)));let l=[];for(let c=0;c<i.length;c++){const u=i[c];if(this.checkScaleAndResolution(s,a,u)){const p=this.http.get(u.url,{responseType:"text"});l.push(p.pipe((0,I.U)(d=>this.extractData(d,t,o,u.url))))}}return l}}requestDataForHTMLGML2(t,o,i,s){return this.http.get(t,{responseType:"text"}).pipe((0,Ca.z)(a=>{const l=this.mergeGML(a,o,i),c=l[0],u=l[1];return this.http.get(o,{responseType:"text"}).pipe((0,I.U)(p=>this.extractData(p,i,s,o,c,u)))}))}checkScaleAndResolution(t,o,i){let s,a;return!(i.minResolution||i.maxResolution||i.minScale||i.maxScale)||(i.minResolution&&i.maxResolution?t>=i.minResolution&&t<=i.maxResolution&&(a=!0):(i.minResolution&&t>=i.minResolution&&(a=!0),i.maxResolution&&t<=i.maxResolution&&(a=!0)),i.minScale&&i.maxScale?o>i.minScale&&o<i.maxScale&&(s=!0):(i.maxScale&&o<=i.maxScale&&(s=!0),i.minScale&&o>=i.minScale&&(s=!0)),!0===s&&!0===a||!0===a&&!s||!0===s&&!a)}mergeGML(t,o,i){let a=(new la.Z).readFeatures(t);0===a.length&&(a=(new Nu.Z).readFeatures(t));const l=new Nb.Z([]);let c;const u=[];let d,p=new Bu.Z([]);const g=a.length,b=this.getQueryParams(o.toLowerCase()).bbox.split(","),C=De.lJ();let A,M,k,H;if(De.l7(C,b),i.options?.source?.options){const Fe=i.options.source.options;Fe.queryTitle&&(M=Fe.queryTitle)}switch(a.map(Fe=>{if(M){let V=Fe.getProperties()[M];V&&(A=A?`${A},${V}`:V)}const G=Fe.getGeometry().getCoordinates(),Oe=Fe.getGeometry().getType();switch(!d&&(d=Oe),Oe){case"Point":1===g?c=new Ee.Z(G,"XY"):u.push(G);break;case"LineString":l.appendLineString(new ro.Z(G,"XY"));break;case"Polygon":p.appendPolygon(new Rt.ZP(G,"XY"));break;case"MultiPolygon":p=new Bu.Z(G,"XY");break;default:return}}),k=0===u.length&&c?{type:c.getType(),coordinates:c.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(u)]},d){case"LineString":H={type:l.getType(),coordinates:l.getCoordinates()};break;case"Point":H=k;break;case"Polygon":case"MultiPolygon":H={type:p.getType(),coordinates:p.getCoordinates()}}const Me={};return M&&(Me[M]=A),[H,Me]}cross(t,o,i){return(t[0]-i[0])*(o[1]-i[1])-(t[1]-i[1])*(o[0]-i[0])}convexHull(t){t.sort((s,a)=>s[0]===a[0]?s[1]-a[1]:s[0]-a[0]);const o=[];for(const s of t){for(;o.length>=2&&this.cross(o[o.length-2],o[o.length-1],s)<=0;)o.pop();o.push(s)}const i=[];for(let s=t.length-1;s>=0;s--){for(;i.length>=2&&this.cross(i[i.length-2],i[i.length-1],t[s])<=0;)i.pop();i.push(t[s])}return i.pop(),o.pop(),o.concat(i)}extractData(t,o,i,s,a,l){const c=o.dataSource,u=this.getAllowedFieldsAndAlias(o);let p=[];switch(c.options.queryFormat){case We.GML3:p=this.extractGML3Data(t,o.zIndex,u);break;case We.JSON:case We.GEOJSON:case We.GEOJSON2:p=this.extractGeoJSONData(t,o.zIndex,u);break;case We.ESRIJSON:p=this.extractEsriJSONData(t,o.zIndex,u);break;case We.TEXT:p=this.extractTextData(t);break;case We.HTML:p=this.extractHtmlData(t,c.queryHtmlTarget,s);break;case We.HTMLGML2:p=this.extractHtmlData(t,c.queryHtmlTarget,s,a,l);break;default:p=this.extractGML2Data(t,o,u)}if(p.length>0&&(null===p[0].geometry||!p[0].geometry)){const h=this.createGeometryFromUrlClick(s);for(const m of p)m.geometry=h}const d=o.dataSource;if((d.params?.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(s)&&(d.params?.FEATURE_COUNT&&this.featureCount>1&&p.length===this.featureCount||!d.params?.FEATURE_COUNT&&p.length===this.defaultFeatureCount)){const h=this.messageService.info("igo.geo.query.featureCountMax",void 0,void 0,{value:o.title});this.previousMessageIds.push(h.toastId)}return p.map((h,m)=>{const b=h.properties[c.mapLabel];let C;if("wms"===o.options.sourceOptions?.type){const M=o.options.sourceOptions;C=M?M.excludeAttribute:void 0}let x=this.getQueryTitle(h,o);!x&&p.length>1?x=`${o.title} (${m+1})`:x||(x=o.title);const A=Object.assign({},h.meta||{},{id:Ie(),title:x,mapTitle:b,sourceTitle:o.title,order:1e3-o.zIndex,excludeAttribute:C});return Object.assign(h,{meta:A,projection:"carto"===c.options.type?"EPSG:4326":i.projection})})}createGeometryFromUrlClick(t){const o=this.getQueryParams(t.toLowerCase()),i=o.bbox,s=parseInt(o.width,10),a=parseInt(o.height,10),l=parseInt(o.i||o.x,10),c=parseInt(o.j||o.y,10),u=i.split(",");let p=.05*(Math.abs(parseFloat(u[0]))-Math.abs(parseFloat(u[2])));Math.abs(parseFloat(u[0]))<180&&(p=.045);const d=parseFloat(u[0])+Math.abs(parseFloat(u[0])-parseFloat(u[2]))*l/s-p,g=parseFloat(u[1])+Math.abs(parseFloat(u[1])-parseFloat(u[3]))*c/a-p,h=d+2*p,m=g+2*p,b="POLYGON(("+d+" "+g+", "+d+" "+m+", "+h+" "+m+", "+h+" "+g+", "+d+" "+g+"))",A=(new ji.Z).readFeature(b).getGeometry();return{type:A.getType(),coordinates:A.getCoordinates()}}extractGML2Data(t,o,i){let a=(new la.Z).readFeatures(t);if(0===a.length){const l=new Nu.Z;try{a=l.readFeatures(t)}catch{console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return a.map(l=>this.featureToResult(l,o,i))}extractGML3Data(t,o,i){const s=new Xc.Z;let a=[];try{a=s.readFeatures(t)}catch{console.warn("query.service: GML3 is not well supported")}return a.map(l=>this.featureToResult(l,o,i))}extractGeoJSONData(t,o,i){let s=[];try{s=JSON.parse(t.replace(/(\r|\n)/g," ")).features}catch{console.warn("query.service: Unable to parse geojson","\n",t)}return s.map(a=>a.meta={id:Ie(),order:1e3-o,alias:i}),s}extractEsriJSONData(t,o,i){if(t)try{if(JSON.parse(t).error)return[]}catch{}return(new Or.Z).readFeatures(t).map(l=>this.featureToResult(l,o,i))}extractTextData(t){return[]}extractHtmlData(t,o,i,s,a){const l=this.getQueryParams(i.toLowerCase()),c=l.crs||l.srs||"EPSG:3857",u=this.createGeometryFromUrlClick(i);o!==Do.BLANK&&o!==Do.IFRAME&&(o=Do.IFRAME);const p=t.toLowerCase().indexOf("<body>"),d=t.toLowerCase().lastIndexOf("</body>")+7;return""===Jb()(t.slice(p,d).replace(/(\r|\n|\s)/g,""))||""===t?[]:[{type:ie,projection:c,properties:Object.assign({target:o,body:t,url:i},a),geometry:s||u}]}getQueryParams(t){const o=t.split("?");if(!o[1])return;const i=o[1].split("&"),s={};return i.forEach(a=>{a=a.split("="),s[a[0]]=decodeURIComponent(a[1]||"")}),s}featureToResult(t,o,i){const s=t.getGeometry(),a=Object.assign({},t.getProperties());let l;return delete a.geometry,delete a.GEOMETRIE,delete a.boundedBy,delete a.shape,delete a.SHAPE,delete a.SHAPE_S,delete a.SHAPE_L,delete a.SHAPE_P,delete a.the_geom,delete a.geom,delete a.geom32198,s&&(l={type:s.getType(),coordinates:s.getCoordinates()}),{type:ie,projection:void 0,properties:a,geometry:l,meta:{id:Ie(),order:1e3-o,alias:i}}}getQueryUrl(t,o,i=!1,s){let a;if(t.options.queryUrls)return this.getCustomQueryUrl(t,o,s);switch(t.constructor){case xo:const l=t,c={INFO_FORMAT:l.params.INFO_FORMAT||this.getMimeInfoFormat(t.options.queryFormat),QUERY_LAYERS:l.params.LAYERS,FEATURE_COUNT:l.params.FEATURE_COUNT||this.defaultFeatureCount};l.params.FEATURE_COUNT&&(this.featureCount=l.params.FEATURE_COUNT),i&&(c.INFO_FORMAT=this.getMimeInfoFormat(We.GML2)),a=l.ol.getFeatureInfoUrl(o.coordinates,o.resolution,o.projection,c);break;case Mr:a=`${"https://"+t.options.account+".carto.com/api/v2/sql?"}format=GeoJSON${"&q="+t.options.config.layers[0].options.sql} WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(${o.coordinates[0]+","+o.coordinates[1]+"),3857),"+(t.options.queryPrecision?t.options.queryPrecision:"1000")+"))"}`;break;case fa:case Fn:const C=t,x=Math.abs(s[0]-s[2]),A=Math.abs(s[1]-s[3]),H=C.options.queryPrecision?C.options.queryPrecision:.005*(x>A?x:A),Me=De.f3(De.hI([o.coordinates]),H);a=`${C.options.url+"/"+C.options.layer+"/query/"}?${["f=json",`geometry=${encodeURIComponent('{"xmin":'+Me[0]+',"ymin":'+Me[1]+',"xmax":'+Me[2]+',"ymax":'+Me[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}`}return a}getMimeInfoFormat(t){let o="application/vnd.ogc.gml";const i=Object.keys(We).find(s=>We[s]===t);return i&&(o=Co[i]),o}getAllowedFieldsAndAlias(t){let o;return t.options?.source?.options?.sourceFields&&t.options.source.options.sourceFields.length>=1&&(o={},t.options.source.options.sourceFields.forEach(i=>{o[i.name]=i.alias?i.alias:i.name})),o}getQueryTitle(t,o){let i;if(o.options?.source?.options){const s=o.options.source.options;s.queryTitle&&(i=this.getLabelMatch(t,s.queryTitle))}return i}getLabelMatch(t,o){let i=o;const s=Array.from(o.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(a=>{i=i.replace(a[0],t.properties[a[1]])}),0===s.length&&i===o&&(i=t.properties[o]||o),i}getCustomQueryUrl(t,o,i){const s=De.p8(o.coordinates,o.resolution,0,[101,101]);return t.options.queryUrls.map(a=>{let l={url:a.url.replace(/\{bbox\}/g,s.join(",")).replace(/\{x\}/g,o.coordinates[0].toString()).replace(/\{y\}/g,o.coordinates[1].toString()).replace(/\{resolution\}/g,o.resolution.toString()).replace(/\{srid\}/g,o.projection.replace("EPSG:",""))};return i&&l.url.replace(/\{xmin\}/g,i[0].toString()).replace(/\{ymin\}/g,i[1].toString()).replace(/\{xmax\}/g,i[2].toString()).replace(/\{ymax\}/g,i[3].toString()),a.maxResolution&&(l.maxResolution=a.maxResolution),a.minResolution&&(l.minResolution=a.minResolution),a.minScale&&(l.minScale=a.minScale),a.maxScale&&(l.maxScale=a.maxScale),l})}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(_e),e.LFG(L))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ju=(()=>{class n{component;queryService;queries$$=[];mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;queryFeatures=!1;queryFeaturesHitTolerance=0;queryFeaturesCondition;waitForAllQueries=!0;query=new e.vpe;get map(){return this.component.map}constructor(t,o){this.component=t,this.queryService=o}ngAfterViewInit(){this.listenToMapClick(),this.addDragBoxInteraction()}ngOnDestroy(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",t=>this.onMapEvent(t))}unlistenToMapClick(){(0,Ke.B)(this.mapClickListener),this.mapClickListener=void 0}onMapEvent(t){if(this.cancelOngoingQueries(),!this.queryService.queryEnabled)return;const o=[];this.queryFeatures&&o.push(this.doQueryFeatures(t));const i=this.map.ol.getView().getResolution(),s=this.map.layers.filter(vn);o.push(...this.queryService.query(s,{coordinates:t.coordinate,projection:this.map.projection,resolution:i})),0!==o.length&&(this.waitForAllQueries?this.queries$$.push((0,Sn.$)(...o).subscribe(a=>{const l=[].concat(...a);this.query.emit({features:l,event:t})})):this.queries$$=o.map(a=>a.subscribe(l=>{this.query.emit({features:l,event:t})})))}doQueryFeatures(t){const o=[];if("singleclick"===t.type)this.map.ol.forEachFeatureAtPixel(t.pixel,(i,s)=>{const a=this.map.getLayerById(s.values_._layer.id);if(!a.dataSource.options.queryFormatAsWms&&i)if(i.get("features"))for(const l of i.get("features")){const c=Li(l,this.map.projection);c.meta={title:l.values_.nom,id:s.values_._layer.id+"."+l.id_,icon:l.values_._icon,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(a)},o.push(c)}else if(i instanceof Au.ZP){const l=function ty(n,r,t,o="EPSG:4326"){let i,s,a,l;t?(s=t.get("title"),t.get("sourceOptions")&&(a=t.get("sourceOptions").excludeAttribute,l=t.get("sourceOptions").excludeAttributeOffline)):s=n.get("_title");const c=new Ce.Z,u=n.getProperties(),p=n.getType();if("Polygon"===p){const b=n.getEnds();i=new Rt.ZP(n.getFlatCoordinates(),"XY",b)}else"Point"===p?i=new Ee.Z(n.getFlatCoordinates(),"XY"):"LineString"===p&&(i=new ro.Z(n.getFlatCoordinates(),"XY"));const d=c.writeGeometryObject(i,{dataProjection:o,featureProjection:r}),g=n.getId()?n.getId():Ie(),h=n.get("_mapTitle"),m=Q.$A(n.getExtent(),r,o);return{type:ie,projection:o,extent:m,meta:{id:g,title:s||h||g,mapTitle:h,excludeAttribute:a,excludeAttributeOffline:l},properties:u,geometry:d,ol:n}}(i,this.map.projection,s);l.meta={id:s.values_._layer.id+"."+l.meta.id,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(a),title:this.queryService.getQueryTitle(l,a)||l.meta.title},o.push(l)}else{const l=Li(i,this.map.projection,s);l.meta={id:s.values_._layer.id+"."+l.meta.id,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(a),title:this.queryService.getQueryTitle(l,a)||l.meta.title},o.push(l)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:$_});else if("boxend"===t.type){const s=t.target.getGeometry().getExtent();this.map.layers.filter(vn).filter(a=>a instanceof xe&&a.visible).map(a=>{a.dataSource.ol.forEachFeatureIntersectingExtent(s,c=>{const u=Li(c,this.map.projection,a.ol);u.meta={id:a.id+"."+c.getId(),icon:c.values_._icon,sourceTitle:a.title,alias:this.queryService.getAllowedFieldsAndAlias(a),title:this.queryService.getQueryTitle(u,a)||u.meta.title},o.push(u)})})}return(0,z.of)(o)}cancelOngoingQueries(){this.queries$$.forEach(t=>t.unsubscribe()),this.queries$$=[]}addDragBoxInteraction(){let t;const o=this.map.ol.getInteractions().getArray();for(const i of o)if(i instanceof kr){t=i;break}void 0===t&&(t=new kr({condition:wr}),this.map.ol.addInteraction(t),this.olDragSelectInteraction=t),this.olDragSelectInteractionEndKey=t.on("boxend",i=>this.onMapEvent(i))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,Ke.B)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}static \u0275fac=function(o){return new(o||n)(e.Y36(Le,2),e.Y36(xa))};static \u0275dir=e.lG2({type:n,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"}})}return n})(),it=(()=>class n{storageService;static id="";static type="";options;getId(){throw new Error('You have to implement the method "getId".')}getType(){throw new Error('You have to implement the method "getType".')}getDefaultOptions(){throw new Error('You have to implement the method "getDefaultOptions".')}get title(){return this.options.title}get available(){return!1!==this.options.available}set enabled(t){this.options.enabled=t}get enabled(){return this.available&&!1!==this.options.enabled}get showInPointerSummary(){return this.options.showInPointerSummary||!1}get showInSettings(){const t=this.options.showInSettings;return void 0===t||t}get searchUrl(){return this.options.searchUrl}get params(){return this.options.params}get settings(){return void 0===this.options.settings?[]:this.options.settings}set featureStoresWithIndex(t){this._featureStoresWithIndex=t}get featureStoresWithIndex(){return this._featureStoresWithIndex}_featureStoresWithIndex;setWorkspaces(t){this.options.available=t.filter(s=>s.entityStore.searchDocument).length>=1;const o=[];this.featureStoresWithIndex=t.filter(s=>s.entityStore.searchDocument).map(s=>(o.push({title:s.title,value:s.title,enabled:!0}),s.entityStore));const i=this.options.settings.find(s=>"datasets"===s.title);i&&(i.values=o),this.setParamFromSetting(i)}setParamFromSetting(t,o=!0){switch(t.type){case"radiobutton":t.values.forEach(s=>{s.enabled&&(this.options.params=Object.assign(this.options.params||{},{[t.name]:s.value}))});break;case"checkbox":let i="";t.values.filter(s=>!1!==s.available).forEach(s=>{s.enabled&&(i+=s.value+",")}),i=i.slice(0,-1),this.options.params=Object.assign(this.options.params||{},{[t.name]:i})}o&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}get displayOrder(){return void 0===this.options.order?99:this.options.order}constructor(t,o){if(this.storageService=o,this.options=t,this.storageService){const i=this.storageService.get(this.getId()+".options");i&&(this.options=R.mergeDeep(this.options,i))}this.options=R.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(i=>{this.setParamFromSetting(i,!1)})}getHashtagsValid(t,o){const i=t.match(/(#[A-Za-z\xc0-\xff-+]+)/g);if(!i)return;const s=this.getSettingsValues(o),a=[];return i.forEach(l=>{s.values.forEach(c=>{const u=l.substring(1);if("string"==typeof c.value){const p=c.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),d=p.indexOf(u.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==d&&a.push(p[d])}c.hashtags&&-1!==c.hashtags.indexOf(u.toLowerCase())&&a.push(c.value)})}),a.filter((l,c)=>a.indexOf(l)===c)}getSettingsValues(t){return this.getDefaultOptions().settings.find(o=>o.name===t)}})(),Uu=(()=>{class n extends it{static id="map";static type=ie;constructor(t){super(t)}getId(){return n.id}getType(){return n.type}getDefaultOptions(){return{title:"Carte"}}static \u0275fac=function(o){return new(o||n)(e.LFG("options"))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();class Pt{static getGoogleMapsCoordLink(r,t){return`https://www.google.com/maps/search/?api=1&query=${t}%2C${r}`}static getGoogleStreetViewLink(r,t){return`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${t}%2C${r}`}static getGoogleMapsNameLink(r){return`https://www.google.com/maps/search/?api=1&query=${encodeURI(r)}`}}class Ub{static getOpenStreetMapLink(r,t,o=17){return`https://www.openstreetmap.org/?mlat=${t}&mlon=${r}#map=${o}/${t}/${r}`}static getOpenStreetCamLink(r,t,o=17){return`https://openstreetcam.org/map/@${t},${r},${o}z`}}let Sa=(()=>{class n{regexService;geoServiceRegexes=[];constructor(t){this.regexService=t,this.geoServiceRegexes=this.getGeoServiceRegexes()}getPropertyType(t){return typeof t}isUrl(t){return/^https?:\/\//.test(t.toString())}isGeoService(t){let o=!1;if(this.isUrl){for(const i of this.geoServiceRegexes)if(new RegExp(i.url).test(t)){o=!0;break}return o}}getGeoService(t,o){if(!this.isGeoService(t))return;let i;for(const s of this.geoServiceRegexes)if(new RegExp(s.url).test(t)&&(i=o.filter(c=>s.propertiesForLayerName.includes(c))?s:void 0,i))break;return i}getGeoServiceRegexes(){return this.regexService.get("geoservice")||[]}static \u0275fac=function(o){return new(o||n)(e.LFG(ug))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var vt=function(n){return n.Layer="layer",n.Group="group",n}(vt||{}),we=function(n){return n[n.wms=0]="wms",n[n.wmts=1]="wmts",n[n.baselayers=2]="baselayers",n[n.arcgisrest=3]="arcgisrest",n[n.tilearcgisrest=4]="tilearcgisrest",n[n.imagearcgisrest=5]="imagearcgisrest",n[n.composite=6]="composite",n}(we||{});class Wi{id;title;url;removable;externalProvider;abstract;forcedProperties;items;type;version;matrixSet;requestEncoding;regFilters;groupImpose;groupSeparator;timeFilter;queryFormat;queryHtmlTarget;queryParams;sourceOptions;count;tooltipType;sortDirection;setCrossOriginAnonymous;showLegend;profils;constructor(r){Object.assign(this,r)}}class Gb extends Wi{_collectCatlogItems;constructor(r,t){super(r),this._collectCatlogItems=t,this.type=we[we[we.wms]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class qb extends Wi{_collectCatlogItems;constructor(r,t){super(r),this._collectCatlogItems=t,this.type=we[we[we.wmts]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class jb extends Wi{_collectCatlogItems;constructor(r,t){super(r),this._collectCatlogItems=t,this.type=we[we[we.baselayers]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Qb extends Wi{_collectCatlogItems;constructor(r,t){super(r),this._collectCatlogItems=t,this.type=we[we[we.arcgisrest]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Gu extends Wi{_collectCatlogItems;constructor(r,t,o){super(r),this._collectCatlogItems=t,this.type=we[we[o]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Yb extends Wi{_collectCatlogItems;constructor(r,t){super(r),this._collectCatlogItems=t,this.type=we[we[we.composite]],this.url=null}collectCatalogItems(){return this._collectCatlogItems(this)}}let Dn=(()=>{class n{http;config;languageService;messageService;capabilitiesService;constructor(t,o,i,s,a){this.http=t,this.config=o,this.languageService=i,this.messageService=s,this.capabilitiesService=a}loadCatalogs(){const t=this.config.getConfig("context")||{},o=this.config.getConfig("catalog")||{},i=o.url||t.url,s=o.sources||[],a=[];if(i){if(o.baselayers){const p=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:`${i}/baselayers`,type:"baselayers"}];a.push((0,z.of)(p))}const l=this.http.get(`${i}/catalogs`).pipe((0,I.U)(c=>c.map(u=>Object.assign(u,u.options))),(0,ce.K)(c=>bn.E));a.push(l)}return s.length>0&&a.push((0,z.of)(s).pipe((0,I.U)(l=>l.map(c=>(c.id||(c.id=Ie()),c))))),(0,Sn.$)(...a).pipe((0,I.U)(l=>[].concat.apply([],l)))}loadCatalogItems(t){let o;return o=qu.createInstanceCatalog(t,this),o.collectCatalogItems()}loadCatalogBaseLayerItems(t){return this.getCatalogBaseLayersOptions(t).pipe((0,I.U)(o=>{const i=o.map(s=>({id:Oi(s.sourceOptions),title:s.title,type:vt.Layer,externalProvider:t.externalProvider,options:s}));return[{id:"catalog.group.baselayers",type:vt.Group,externalProvider:t.externalProvider,title:t.title,items:i}]}))}getCatalogBaseLayersOptions(t){return this.http.get(t.url)}loadCatalogWMSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,I.U)(o=>{const i=[];if(!o)return i;o.Service&&o.Service.Abstract&&o.Service.Abstract.length&&(t.abstract=o.Service.Abstract);const s=[];this.flattenWmsCapabilities(o.Capability.Layer,0,s,t.groupSeparator);const a=Object.assign({},o.Capability.Layer);return a.Layer=s.filter(l=>0!==l.Layer.length),this.includeRecursiveItems(t,a,i),i}))}flattenWmsCapabilities(t,o=0,i,s=" / "){if(!i.includes(t.Title)){const a=Object.assign({},t);a.Layer=[],i.push(a)}for(const a of t.Layer){const l=Object.assign({},a);o>0&&(l.Title=t.Title+s+a.Title),a.Layer?this.flattenWmsCapabilities(l,o+1,i,s):i.find(c=>c.Title===t.Title).Layer.push(a)}}loadCatalogWMTSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,I.U)(o=>this.getWMTSItems(t,o)))}loadCatalogArcGISRestItems(t){return this.getCatalogCapabilities(t).pipe((0,I.U)(o=>this.getArcGISRESTItems(t,o)))}loadCatalogCompositeLayerItems(t){const o=t.composite,i=[];o.map(g=>{g.sortDirection=t.sortDirection,i.push(qu.createInstanceCatalog(g,this))});const s=[];i.map(g=>s.push(g.collectCatalogItems()));let a=[];function l(g){return g.reduce((h,m)=>h.concat(m.type===vt.Group?l(m.items):m),[])}if(Object.keys(o).find(g=>o[g].groupImpose)){const g=(h,m)=>{const b=i[m],C=Object.assign({},b.groupImpose);C.address=b.id,C.type=vt.Group,C.externalProvider=b.externalProvider,void 0===C.sortDirection&&(C.sortDirection=b.sortDirection),C.items=[];const x=l(h);return x.map(A=>A.address=`${C.address}.${C.id}`),C.items=x,C};a=s.map((h,m)=>h.pipe((0,I.U)(b=>o[m].groupImpose?g(b,m):b)))}else a=s;const c=(0,Sn.$)(...a).pipe((0,I.U)(g=>[].concat(...g))),p=(g,h)=>g.reduce((m,b,C,x)=>{const A=h(b),M=Object.assign({},b);if(b.type===vt.Layer){const k=[],H=[];if(x.filter((G,Oe)=>{let V=!1;return G.title===A&&G.type===vt.Layer&&(Oe!==C&&G.address!==b.address&&(V=!0),k.push(Oe)),V}).length>0){let G=k.findIndex(Oe=>Oe===C)+1;M.title=`${b.title} (${G})`,G=H.findIndex(Oe=>Oe===C)+1,M.newMetadataUrl=`${b.newMetadataUrl} (${G})`}m.find(G=>G.title===M.title&&G.type===vt.Layer)||(m[m.length]=M)}else b.type===vt.Group&&(M.items=p(b.items,k=>k.title),m[m.length]=M);return m},[]);return c.pipe((0,I.U)(g=>((g,h)=>g.reduce((m,b)=>{const C=(h=>h.id)(b),x=m.find(A=>A.id===C);if(x){const A=m.indexOf(x);-1===m[A].address.split("|").indexOf(b.address)&&(m[A].address=`${m[A].address}|${b.address}`),m[A].items.push(...b.items)}else m[m.length]=b;return m},[]))(g)),(0,I.U)(g=>[].concat(...g)),(0,I.U)(g=>p(g,h=>h.title)))}getCatalogCapabilities(t){return this.capabilitiesService.getCapabilities(we[t.type],t.url,t.version).pipe((0,ce.K)(i=>(this.messageService.error(t.title?"igo.geo.catalog.unavailable":"igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle",void 0,t.title?{value:t.title}:void 0),console.error(i),(0,z.of)(void 0))))}computeForcedProperties(t,o){if(!o||0===o.length)return;const i={layerName:t,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},s=o.find(a=>"*"===a.layerName);return s&&(s.metadataAbstractAll&&(i.metadataAbstractAll=s.metadataAbstractAll),s.metadataUrlAll&&(i.metadataUrlAll=s.metadataUrlAll)),o.map(a=>{t===a.layerName&&(a.title&&(i.title=a.title),a.metadataUrl&&(i.metadataUrl=a.metadataUrl),a.metadataAbstract&&(i.metadataAbstract=a.metadataAbstract))}),i}prepareCatalogItemLayer(t,o,i,s){const a=this.retrieveLayerInfoFormat(t.Name,i),l=s.showLegend&&t.Style?this.capabilitiesService.getStyle(t.Style):void 0,c=Object.assign({},s.queryParams,{LAYERS:t.Name,VERSION:s.version}),u={type:"wms",url:s.url,crossOrigin:s.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:a,queryHtmlTarget:a===We.HTML||a===We.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},p=Object.assign({},u,s.sourceOptions,{params:c}),d=this.computeForcedProperties(t.Name,s.forcedProperties);let g,h=!0;t.Abstract?g=t.Abstract:!t.Abstract&&s.abstract&&(g=s.abstract);const m=t?.DataURL&&t?.DataURL.length>0?t?.DataURL[0].OnlineResource:void 0;let b=d?.metadataUrl||d?.metadataUrlAll||m,C=d?.metadataAbstract||d?.metadataAbstractAll||g;!d?.metadataUrl&&!d?.metadataUrlAll&&(d?.metadataAbstract||d?.metadataAbstractAll)&&(h=!1),d?.metadataAbstract&&d?.metadataUrlAll&&(h=!1);const x={id:Oi(p),type:vt.Layer,title:d?.title?d.title:t.Title,address:o,externalProvider:s.externalProvider||!1,options:{maxResolution:rt(t.MaxScaleDenominator),minResolution:rt(t.MinScaleDenominator),metadata:{url:b,extern:h,abstract:C,type:u.type},legendOptions:l,tooltip:{type:s.tooltipType},sourceOptions:p}};return R.removeUndefined(x)}prepareCatalogItemGroup(t,o,i,s,a){return{id:i,type:vt.Group,title:t.Title,address:a.id,externalProvider:a.externalProvider||!1,sortDirection:a.sortDirection,items:t.Layer.reduce((c,u)=>{if(void 0!==u.Layer){const d=this.prepareCatalogItemGroup(u,o,i+`.group.${u.Name||u.Layer[0].Name}`,s,a);c.push(d)}else{if(!1===this.testLayerRegexes(u.Name,o))return c;const p=this.prepareCatalogItemLayer(u,i,s,a);c.push(p)}return c},[])}}includeRecursiveItems(t,o,i,s=0){const a=(t.regFilters||[]).map(l=>new RegExp(l));if(o.Layer)for(const l of o.Layer){if(void 0!==l.Layer){this.includeRecursiveItems(t,l,i,s+1);continue}const c=this.findCatalogInfoFormat(t);if(0!==s){const p=this.prepareCatalogItemGroup(o,a,`catalog.group.${o.Name||l.Name}`,c,t);0!==p.items.length&&i.push(p);break}if(!1!==this.testLayerRegexes(l.Name,a)){const u=this.prepareCatalogItemLayer(l,t.id,c,t);i.push(u)}}}getWMTSItems(t,o){if(!o)return[];const i=o.Contents.Layer,s=(t.regFilters||[]).map(a=>new RegExp(a));return o.ServiceIdentification&&o.ServiceIdentification.Abstract&&o.ServiceIdentification.Abstract.length&&(t.abstract=o.ServiceIdentification.Abstract),i.map(a=>{const l=this.computeForcedProperties(a.Title,t.forcedProperties);let c=!0,u=l?.metadataUrl||l?.metadataUrlAll,p=l?.metadataAbstract||l?.metadataAbstractAll||t.abstract;if(!l?.metadataUrl&&!l?.metadataUrlAll&&(l?.metadataAbstract||l?.metadataAbstractAll)&&(c=!1),l?.metadataAbstract&&l?.metadataUrlAll&&(c=!1),!1===this.testLayerRegexes(a.Identifier,s))return;const d=Object.assign({},t.queryParams,{version:"1.0.0"}),g={type:"wmts",url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:a.Identifier,matrixSet:t.matrixSet,optionsFromCapabilities:!0,requestEncoding:t.requestEncoding||"KVP",style:"default"},h=Object.assign({},g,t.sourceOptions,{params:d});return R.removeUndefined({id:Oi(h),type:vt.Layer,title:l?.title?l.title:a.Title,address:t.id,externalProvider:t.externalProvider,options:{sourceOptions:h,metadata:{url:u,extern:c,abstract:p,type:g.type}}})}).filter(a=>void 0!==a)}getArcGISRESTItems(t,o){if(!o)return[];const i=o.layers?o.layers.filter(l=>!l.type||"Feature Layer"===l.type):[];o.layers||this.messageService.error("igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle");const s=(t.regFilters||[]).map(l=>new RegExp(l));let a;return o.serviceDescription&&o.serviceDescription.length&&(a=o.serviceDescription.replace(/(<([^>]+)>)/gi,"")),i.map(l=>{const c=this.computeForcedProperties(l.name,t.forcedProperties);let u,p=!0;l.Abstract?u=l.Abstract:!l.Abstract&&t.abstract&&(u=t.abstract);let d=c?.metadataUrl||c?.metadataUrlAll,g=c?.metadataAbstract||c?.metadataAbstractAll||u;if(!c?.metadataUrl&&!c?.metadataUrlAll&&(c?.metadataAbstract||c?.metadataAbstractAll)&&(p=!1),c?.metadataAbstract&&c?.metadataUrlAll&&(p=!1),!1===this.testLayerRegexes(l.id,s))return;const h={type:we[t.type],url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:l.id,queryable:!0,queryFormat:"esrijson",matrixSet:t.matrixSet,optionsFromCapabilities:!0,style:"default"},m=Object.assign({},h,t.sourceOptions);return R.removeUndefined({id:Oi(m),type:vt.Layer,title:c?.title?c.title:l.name,externalProvider:t.externalProvider,address:t.id,options:{sourceOptions:m,minResolution:rt(l.maxScale),maxResolution:rt(l.minScale),metadata:{url:d,extern:p,abstract:g,type:h.type}}})}).filter(l=>void 0!==l)}testLayerRegexes(t,o){return 0===o.length||void 0!==o.find(i=>i.test(t))}retrieveLayerInfoFormat(t,o){const i=o.find(l=>l.layer===t),s=o.find(l=>"*"===l.layer);let a;return i?a=i.queryFormat:s&&(a=s.queryFormat),a}findCatalogInfoFormat(t){const o=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(i=>{t.queryFormat[i]instanceof Array?t.queryFormat[i].forEach(s=>{o.find(a=>a.layer===s)||o.push({layer:s,queryFormat:i})}):o.find(s=>s.layer===t.queryFormat[i])||o.push({layer:t.queryFormat[i],queryFormat:i})}),o}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(N),e.LFG(L),e.LFG(_e),e.LFG(Zt))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class qu{static createInstanceCatalog(r,t){let o;return o=r.hasOwnProperty("composite")?new Yb(r,i=>t.loadCatalogCompositeLayerItems(i)):r.type===we[we.baselayers]?new jb(r,i=>t.loadCatalogBaseLayerItems(i)):r.type===we[we.arcgisrest]?new Qb(r,i=>t.loadCatalogArcGISRestItems(i)):r.type===we[we.tilearcgisrest]?new Gu(r,i=>t.loadCatalogArcGISRestItems(i),we.tilearcgisrest):r.type===we[we.imagearcgisrest]?new Gu(r,i=>t.loadCatalogArcGISRestItems(i),we.imagearcgisrest):r.type===we[we.wmts]?new qb(r,i=>t.loadCatalogWMTSLayerItems(i)):new Gb(r,i=>t.loadCatalogWMSLayerItems(i)),o}}let Hb=(()=>{class n{constructor(){}open(t){t.extern&&window.open(t.url,"_blank")}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Vb(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openMetadata(i.options.metadata))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.metadata.show"))("color",t.color)}}function zb(n,r){if(1&n&&(e.TgZ(0,"mat-dialog-content",3)(1,"h3"),e._uU(2),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(t.data.abstract)}}function Kb(n,r){if(1&n&&(e.TgZ(0,"mat-dialog-content",3),e._UZ(1,"h3",4),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("innerHTML",t.data.abstract,e.oJD)}}let Xi=(()=>{class n{metadataService;dialog;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t,o){this.metadataService=t,this.dialog=o}openMetadata(t){t.extern?!t.url&&t.abstract?this.dialog.open(ju,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}}):t.url&&this.metadataService.open(t):!t.extern&&t.abstract&&this.dialog.open(ju,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}})}get options(){if(this.layer)return this.layer.options}static \u0275fac=function(o){return new(o||n)(e.Y36(Hb),e.Y36(B.uw))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","information-outline"]],template:function(o,i){1&o&&e.YNc(0,Vb,3,4,"button",0),2&o&&e.Q6J("ngIf",i.options&&i.options.metadata&&i.options.metadata.url||i.options&&i.options.metadata&&i.options.metadata.abstract)},dependencies:[f.O5,w.Hw,S.RK,P.gM,O.X$],changeDetection:0})}return n})(),ju=(()=>{class n{data;constructor(t){this.data=t}static \u0275fac=function(o){return new(o||n)(e.Y36(B.WI))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-metadata-abstract"]],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(o,i){1&o&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"button",1),e._uU(3,"X"),e.qZA(),e.YNc(4,zb,3,1,"mat-dialog-content",2),e.YNc(5,Kb,2,1,"mat-dialog-content",2)),2&o&&(e.xp6(1),e.Oqu(i.data.layerTitle),e.xp6(3),e.Q6J("ngIf","arcgisrest"!==i.data.type),e.xp6(1),e.Q6J("ngIf","arcgisrest"===i.data.type))},dependencies:[f.O5,S.lW,B.ZT,B.uh,B.xY],styles:[":host{position:relative;display:block}:host .close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}\n"],encapsulation:2})}return n})();function Wb(n,r){1&n&&e._UZ(0,"mat-icon",10)}function Xb(n,r){1&n&&(e.TgZ(0,"button",11)(1,"mat-icon",12),e.NdJ("click",function(o){return o.stopPropagation()}),e.ALo(2,"translate"),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.geo.catalog.externalProvider.layer")))}function ev(n,r){if(1&n&&(e._UZ(0,"igo-layer-legend",4),e.ALo(1,"async")),2&n){const t=e.oxw();e.Q6J("layer",e.lcZ(1,1,t.igoLayer$))}}let Qu=(()=>{class n{layerService;inRange$=new y.X(!0);isPreview$=new y.X(!1);isVisible$=new y.X(!1);isPreview$$;resolution$$;layers$$;lastTimeoutRequest;layerLegendShown$=new y.X(!1);igoLayer$=new y.X(void 0);mouseInsideAdd=!1;resolution;catalogAllowLegend=!1;layer;map;added=!1;addedChange=new e.vpe;addedLayerIsPreview=new e.vpe;get title(){return ho(this.layer)}get icon(){return mr(this.layer)||"layers"}constructor(t){this.layerService=t}ngOnInit(){this.isPreview$$=this.isPreview$.subscribe(t=>this.addedLayerIsPreview.emit(t)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.isPreview$$.unsubscribe(),this.resolution$$.unsubscribe(),this.layers$$.unsubscribe()}computeTitleTooltip(){const t=this.layer.options;if(!t.tooltip)return ho(this.layer);const o=t.tooltip,i=t.metadata;switch(t.tooltip.type){case no.TITLE:return this.layer.title;case no.ABSTRACT:return i&&i.abstract?i.abstract:this.layer.title;case no.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}onMouseEvent(t){this.onToggleClick(t)}askForLegend(t){this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe((0,Lt.P)()).subscribe(o=>this.igoLayer$.next(o))}onToggleClick(t){if(typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove(t):this.add(t)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(t),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(t),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer,event:t}))}remove(t){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer,event:t}))}haveGroup(){return!(!this.layer.address||1===this.layer.address.split(".").length)}isInResolutionsRange(t){const o=!this.layer.options.minResolution||Number.isNaN(this.layer.options.minResolution)?0:this.layer.options.minResolution,i=!this.layer.options.maxResolution||Number.isNaN(this.layer.options.maxResolution)?1/0:this.layer.options.maxResolution;this.inRange$.next(t>=o&&t<=i)}isVisible(){if(this.layer?.id){const t=this.map.getLayerById(this.layer?.id);this.isVisible$.next(!!t&&t.visible)}}getBadgeIcon(){return this.inRange$.getValue()&&this.isVisible$.getValue()?"":"eye-off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}static \u0275fac=function(o){return new(o||n)(e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",map:"map",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},decls:23,vars:35,consts:[["class","catalog-browser-layer-carret","matListItemIcon","","svgIcon","blank",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","igoMatBadgeInverseColor","true","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","matBadgeHidden","matBadgeDisabled","svgIcon"],[1,"igo-cataloglayer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],["matListItemIcon","","svgIcon","blank",1,"catalog-browser-layer-carret"],["disabled","true","mat-icon-button",""],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloglayer-external-icon",3,"matTooltip","click"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-list-item"),e.YNc(1,Wb,1,0,"mat-icon",0),e.TgZ(2,"span",1),e.NdJ("click",function(a){return i.askForLegend(a)}),e._uU(3),e.qZA(),e.TgZ(4,"div",2),e.YNc(5,Xb,3,3,"button",3),e._UZ(6,"igo-metadata-button",4),e.TgZ(7,"button",5),e.NdJ("mouseenter",function(a){return i.onMouseEvent(a)})("mouseleave",function(a){return i.onMouseEvent(a)})("click",function(a){return i.onToggleClick(a)}),e.ALo(8,"translate"),e.ALo(9,"async"),e._UZ(10,"mat-icon",6),e.ALo(11,"async"),e.ALo(12,"async"),e.ALo(13,"async"),e.ALo(14,"async"),e.ALo(15,"async"),e.ALo(16,"async"),e.ALo(17,"async"),e.qZA()()(),e.TgZ(18,"div",7,8),e.YNc(20,ev,2,3,"igo-layer-legend",9),e.ALo(21,"async"),e.ALo(22,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",i.haveGroup()),e.xp6(1),e.Q6J("ngClass",i.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",i.computeTitleTooltip()),e.xp6(1),e.hij(" ",i.title," "),e.xp6(2),e.Q6J("ngIf",i.layer.externalProvider),e.xp6(1),e.Q6J("layer",i.layer),e.xp6(1),e.Q6J("matTooltip",e.lcZ(8,13,i.computeTooltip()))("color",e.lcZ(9,15,i.isPreview$)?"":i.added?"warn":""),e.xp6(3),e.Q6J("igoMatBadgeIcon",i.getBadgeIcon())("matBadgeHidden",e.lcZ(11,17,i.inRange$)&&!0===e.lcZ(12,19,i.isVisible$)||e.lcZ(13,21,i.inRange$)&&!i.added||e.lcZ(14,23,i.inRange$)&&e.lcZ(15,25,i.isPreview$))("matBadgeDisabled",!1===e.lcZ(16,27,i.inRange$))("svgIcon",e.lcZ(17,29,i.isPreview$)?"plus":i.added?"delete":"plus"),e.xp6(10),e.Q6J("ngIf",e.lcZ(21,31,i.layerLegendShown$)&&e.lcZ(22,33,i.igoLayer$)&&i.catalogAllowLegend))},dependencies:[f.mk,f.O5,ut.k,S.RK,w.Hw,Z.Tg,Z.Yt,Z.sL,Z.ni,P.gM,va,Xi,Pn,f.Ov,O.X$],styles:[".igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.catalog-browser-layer-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return n})();function tv(n,r){1&n&&(e.TgZ(0,"mat-icon",10),e.NdJ("click",function(o){return o.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.group"))}function ov(n,r){if(1&n&&(e.TgZ(0,"button",8),e.YNc(1,tv,2,3,"mat-icon",9),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.group.externalProvider)}}function iv(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",11),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleClick(i))}),e.ALo(2,"translate"),e.ALo(3,"async"),e._UZ(4,"mat-icon",12),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",e.lcZ(3,4,t.disabled$))}}function nv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleClick(i))}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",14),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.catalog.group.addToMap"))("disabled",e.lcZ(2,4,t.disabled$))}}function rv(n,r){1&n&&e.GkF(0)}function sv(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-layer",16),e.NdJ("addedLayerIsPreview",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerPreview(i))})("addedChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerAddedChange(i))}),e.qZA(),e.BQk()}if(2&n){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("layer",t)("resolution",o.resolution)("map",o.map)("catalogAllowLegend",o.catalogAllowLegend)("added",o.state.get(t).added)}}function av(n,r){if(1&n&&(e.YNc(0,rv,1,0,"ng-container",15),e.YNc(1,sv,2,5,"ng-container",15)),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",o.isGroup(t)),e.xp6(1),e.Q6J("ngIf",o.isLayer(t))}}let lv=(()=>{class n{store=new xt([]);added$=new y.X(!1);preview$=new y.X(!1);disabled$=new y.X(!1);catalog;group;map;collapsed=!0;resolution;catalogAllowLegend=!1;toggleCollapsed=!0;state;addedChange=new e.vpe;layerAddedChange=new e.vpe;get title(){return this.group.title}ngOnInit(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),void 0!==this.group.sortDirection&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:t=>t.title})}ngOnDestroy(){this.store.destroy()}isGroup(t){return t.type===vt.Group}isLayer(t){return t.type===vt.Layer}onToggleClick(t){this.added$.value?this.remove(t):this.add(t)}onToggleCollapsed(t){this.evaluateDisabled(t)}onLayerAddedChange(t){this.layerAddedChange.emit(t),this.tryToggleGroup(t)}add(t){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group,event:t})}remove(t){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group,event:t})}onLayerPreview(t){this.preview$.next(t)}tryToggleGroup(t){const o=t.added,i=t.layer;this.store.view.all().filter(a=>a.id!==i.id).map(a=>this.state.get(a).added||!1).every(a=>a===o)?o?this.add(t.event):this.remove(t.event):!0===this.added$.value&&this.added$.next(!1)}evaluateAdded(){const t=this.store.all().every(o=>!0===(this.state.get(o).added||!1));this.added$.next(t)}evaluateDisabled(t){let o=!1;!1===this.toggleCollapsed&&(o=t),this.disabled$.next(o)}onTitleClick(){this.collapsed=!this.collapsed}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",map:"map",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},decls:15,vars:14,consts:[["matListItemIcon","","svgIcon","chevron-up","igoCollapse","",1,"igo-chevron","catalog-browser-group-carret",3,"target","collapsed","toggle"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["notadded",""],["items",""],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloggroup-external-icon",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click"],["svgIcon","plus"],[4,"ngIf"],["igoListItem","",3,"layer","resolution","map","catalogAllowLegend","added","addedLayerIsPreview","addedChange"]],template:function(o,i){if(1&o&&(e.TgZ(0,"mat-list-item")(1,"mat-icon",0),e.NdJ("toggle",function(a){return i.onToggleCollapsed(a)}),e.qZA(),e.TgZ(2,"span",1),e.NdJ("click",function(){return i.onTitleClick()}),e._uU(3),e.qZA(),e.TgZ(4,"div",2),e.YNc(5,ov,2,1,"button",3),e.YNc(6,iv,5,6,"ng-container",4),e.ALo(7,"async"),e.ALo(8,"async"),e.YNc(9,nv,4,6,"ng-template",null,5,e.W1O),e.qZA()(),e.TgZ(11,"div",null,6),e.YNc(13,av,2,2,"ng-template",7),e.ALo(14,"async"),e.qZA()),2&o){const s=e.MAs(10),a=e.MAs(12);e.xp6(1),e.Q6J("target",a)("collapsed",i.collapsed),e.xp6(1),e.Q6J("matTooltip",i.title),e.xp6(1),e.Oqu(i.title),e.xp6(2),e.Q6J("ngIf",i.group.externalProvider),e.xp6(1),e.Q6J("ngIf",e.lcZ(7,8,i.added$)&&!1===e.lcZ(8,10,i.preview$))("ngIfElse",s),e.xp6(7),e.Q6J("ngForOf",e.lcZ(14,12,i.store.view.all$()))}},dependencies:[f.sg,f.O5,S.RK,w.Hw,Z.Tg,Z.Yt,Z.sL,Z.ni,P.gM,Nt,zi,Qu,f.Ov,O.X$],styles:[".igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}.catalog-browser-group-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-catalog-group-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return n})();function cv(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-group",3),e.NdJ("addedChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onGroupAddedChange(i))})("layerAddedChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerAddedChange(i))}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&n){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("catalog",o.catalog)("group",t)("map",o.map)("state",o.store.state)("resolution",e.lcZ(2,8,o.resolution$))("catalogAllowLegend",o.catalogAllowLegend)("collapsed",1!==o.store.count)("toggleCollapsed",o.toggleCollapsedGroup)}}function uv(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-layer",4),e.NdJ("addedChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLayerAddedChange(i))}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&n){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("layer",t)("map",o.map)("resolution",e.lcZ(2,5,o.resolution$))("catalogAllowLegend",o.catalogAllowLegend)("added",o.store.state.get(t).added)}}function pv(n,r){if(1&n&&(e.YNc(0,cv,3,10,"ng-container",2),e.YNc(1,uv,3,7,"ng-container",2)),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",o.isGroup(t)),e.xp6(1),e.Q6J("ngIf",o.isLayer(t))}}let wa=(()=>{class n{layerService;cdRef;watcher;get resolution$(){return this.map.viewController.resolution$}catalogAllowLegend=!1;catalog;store;map;toggleCollapsedGroup=!0;constructor(t,o){this.layerService=t,this.cdRef=o}ngOnInit(){const t=this.map.layers.map(i=>({id:i.options.source.id,title:i.title,type:vt.Layer}));this.store.state.updateMany(t,{added:!0},!0),this.catalog&&void 0!==this.catalog.sortDirection&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:i=>i.title}),this.catalogAllowLegend=!!this.catalog&&this.catalog.showLegend||this.catalogAllowLegend,this.watcher=new fn(this.store,this.cdRef)}ngOnDestroy(){this.watcher.destroy()}isGroup(t){return t.type===vt.Group}isLayer(t){return t.type===vt.Layer}onLayerAddedChange(t){const o=t.layer;this.store.state.update(o,{added:t.added},!1),t.added?this.addLayerToMap(o,t):this.removeLayerFromMap(o)}onGroupAddedChange(t){const o=t.group;this.store.state.update(o,{added:t.added},!1),t.added?this.addGroupToMap(o,t):this.removeGroupFromMap(o)}addLayerToMap(t,o){this.addLayersToMap([t],o)}removeLayerFromMap(t){this.removeLayersFromMap([t])}addLayersToMap(t,o){const i=t.map(s=>(s.options.sourceOptions.optionsFromApi||(s.options.sourceOptions.optionsFromApi=!0),this.catalog.profils?.length&&(s.options.security={profils:this.catalog.profils}),this.layerService.createAsyncLayer(s.options)));(0,Sn.$)(...i).subscribe(s=>{"click"===o.event.type&&o.added&&this.map.layersAddedByClick$.next(s),this.store.state.updateMany(s,{added:!0}),this.map.addLayers(s)})}removeLayersFromMap(t){t.forEach(o=>{if(this.store.state.update(o,{added:!1}),!0===o.options.baseLayer){const i=this.map.getLayerById(o.options.id);void 0!==i&&this.map.removeLayer(i)}else{const i=this.map.getLayerById(o.id);void 0!==i&&this.map.removeLayer(i)}})}sortCatalogItemsByTitle(t,o){const i=t.sort((s,a)=>{const l=s.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),c=a.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return l<c?-1:l>c?1:0});switch(o){case"asc":return i;case"desc":return i.reverse();default:return t}}addGroupToMap(t,o){let i=t.items.filter(s=>{const a=this.store.state.get(s).added||!1;return this.isLayer(s)&&!1===a});void 0!==t.sortDirection&&(i=this.sortCatalogItemsByTitle(i,t.sortDirection)),this.addLayersToMap(i.reverse(),o)}removeGroupFromMap(t){const o=t.items.filter(i=>{const s=this.store.state.get(i).added||!1;return this.isLayer(i)&&!0===s});this.removeLayersFromMap(o)}static \u0275fac=function(o){return new(o||n)(e.Y36(Se),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"catalog","group","map","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed","addedChange","layerAddedChange"],["igoListItem","",3,"layer","map","resolution","catalogAllowLegend","added","addedChange"]],template:function(o,i){1&o&&(e.TgZ(0,"igo-list",0),e.YNc(1,pv,2,2,"ng-template",1),e.ALo(2,"async"),e.qZA()),2&o&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,3,i.store.view.all$())))},encapsulation:2,changeDetection:0})}return n})(),dv=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,ut.g,S.ot,w.Ps,Z.ie,P.AV,lr,re,bi,Ui,$n,kn]})}return n})();function gv(n,r){1&n&&(e.TgZ(0,"mat-icon",5),e.NdJ("click",function(o){return o.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.catalog"))}function mv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",6),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.removeCatalogFromLibrary(i))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",7),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.library.remove"))}function hv(n,r){1&n&&(e.TgZ(0,"button",8),e._UZ(1,"mat-icon",9),e.qZA())}e.B6R(wa,[f.sg,f.O5,Nt,So,lv,Qu],[f.Ov]);let fv=(()=>{class n{catalog;map;catalogRemove=new e.vpe;get title(){return ho(this.catalog)}removeCatalogFromLibrary(t){t.stopPropagation(),this.catalogRemove.emit()}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},decls:7,vars:4,consts:[["matListItemTitle",""],["matListItemMeta",""],["matListItemIcon","","class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["matListItemIcon","","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-external-provider",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["disabled","true","mat-icon-button","",1,"igo-blank"],["svgIcon","blank"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-list-item")(1,"span",0),e._uU(2),e.qZA(),e.TgZ(3,"div",1),e.YNc(4,gv,2,3,"mat-icon",2),e.YNc(5,mv,3,3,"button",3),e.YNc(6,hv,2,0,"button",4),e.qZA()()),2&o&&(e.xp6(2),e.hij(" ",i.title," "),e.xp6(2),e.Q6J("ngIf",i.catalog.externalProvider),e.xp6(1),e.Q6J("ngIf",i.catalog.removable),e.xp6(1),e.Q6J("ngIf",!i.catalog.removable))},dependencies:[f.O5,w.Hw,Z.Tg,Z.Yt,Z.sL,Z.ni,P.gM,S.RK,O.X$],styles:[".igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0})}return n})();function _v(n,r){if(1&n&&(e.TgZ(0,"mat-option",17),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("matTooltip",t.title)("value",t),e.xp6(1),e.hij(" ",t.title," ")}}function yv(n,r){if(1&n&&(e.TgZ(0,"mat-option",17),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("matTooltip",t.url)("value",t),e.xp6(1),e.hij(" ",t.url," ")}}function bv(n,r){if(1&n&&(e.TgZ(0,"mat-option",18),e.NdJ("click",function(o){return o.stopPropagation()}),e.TgZ(1,"p",19),e._uU(2),e.qZA()()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(2),e.Oqu(t)}}const vv=function(n,r){return{value:n,email:r}};function Cv(n,r){if(1&n&&(e.TgZ(0,"span")(1,"p",20),e._uU(2),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.hij(" ",t.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",e.WLB(1,vv,t.addedCatalog.url,t.emailAddress))," ")}}const xv=function(n){return{value:n}};function Sv(n,r){if(1&n&&(e.TgZ(0,"span")(1,"p",20),e._uU(2),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.hij(" ",t.languageService.translate.instant("igo.geo.catalog.unavailable",e.VKq(1,xv,t.addedCatalog.url))," ")}}let wv=(()=>{class n{formBuilder;languageService;configService;dialogRef;data;form;defaultAddedCatalogType="wms";addedCatalogType$$;predefinedCatalogsList$=new y.X([]);typeCapabilities;predefinedCatalogs=[];store;error=!1;addedCatalog;emailAddress;storeViewAll$$;constructor(t,o,i,s,a){this.formBuilder=t,this.languageService=o,this.configService=i,this.dialogRef=s,this.data=a,this.store=a.store,this.predefinedCatalogs=a.predefinedCatalogs,this.error=a.error,this.addedCatalog=a.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[_.kI.required]],type:[this.defaultAddedCatalogType,[_.kI.required]]})}ngOnInit(){this.store.state.clear(),this.typeCapabilities=Object.keys(Ir),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(t=>{"wmts"===t?this.form.get("title").setValidators(_.kI.required):this.form.get("title").setValidators([]),this.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(()=>this.computePredefinedCatalogList()),this.emailAddress=this.configService.getConfig("emailAddress")}ngOnDestroy(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}changeUrlOrTitle(t){this.form.patchValue(t),this.error=!1,this.computePredefinedCatalogList()}computePredefinedCatalogList(){this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(t=>!this.store.get(t.id)))}addCatalog(t){this.error=!1,this.dialogRef.close(t)}cancel(){this.error=!1,this.dialogRef.close()}static \u0275fac=function(o){return new(o||n)(e.Y36(_.QS),e.Y36(L),e.Y36(N),e.Y36(B.so),e.Y36(B.WI,8))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-add-catalog-dialog"]],decls:34,vars:25,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto2","matAutocomplete"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["auto","matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"value","click"],["matListItemTitle",""],[1,"error"]],template:function(o,i){if(1&o&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field"),e._UZ(7,"input",4),e.ALo(8,"translate"),e.TgZ(9,"mat-autocomplete",5,6),e.NdJ("optionSelected",function(a){return i.changeUrlOrTitle(a.option.value)}),e.YNc(11,_v,2,3,"mat-option",7),e.ALo(12,"async"),e.qZA()()(),e.TgZ(13,"div",3)(14,"mat-form-field"),e._UZ(15,"input",8),e.TgZ(16,"mat-autocomplete",5,9),e.NdJ("optionSelected",function(a){return i.changeUrlOrTitle(a.option.value)}),e.YNc(18,yv,2,3,"mat-option",7),e.ALo(19,"async"),e.qZA()()(),e.TgZ(20,"div",3)(21,"mat-form-field")(22,"mat-select",10),e.YNc(23,bv,3,2,"mat-option",11),e.qZA()()()(),e.YNc(24,Cv,3,4,"span",12),e.YNc(25,Sv,3,3,"span",12),e.qZA(),e.TgZ(26,"div",13)(27,"div",14)(28,"button",15),e.NdJ("click",function(){return i.cancel()}),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",16),e.NdJ("click",function(){return i.addCatalog(i.form.value)}),e._uU(32),e.ALo(33,"translate"),e.qZA()()()),2&o){const s=e.MAs(10),a=e.MAs(17);e.xp6(1),e.hij(" ",e.lcZ(2,13,"igo.geo.catalog.library.addTitle"),"\n"),e.xp6(3),e.Q6J("formGroup",i.form),e.xp6(3),e.s9C("placeholder",e.lcZ(8,15,"igo.geo.printForm.title")),e.Q6J("matAutocomplete",s),e.xp6(4),e.Q6J("ngForOf",e.lcZ(12,17,i.predefinedCatalogsList$)),e.xp6(4),e.Q6J("matAutocomplete",a),e.xp6(3),e.Q6J("ngForOf",e.lcZ(19,19,i.predefinedCatalogsList$)),e.xp6(5),e.Q6J("ngForOf",i.typeCapabilities),e.xp6(1),e.Q6J("ngIf",i.error&&i.addedCatalog&&i.emailAddress),e.xp6(1),e.Q6J("ngIf",i.error&&i.addedCatalog&&!i.emailAddress),e.xp6(4),e.hij(" ",e.lcZ(30,21,"igo.geo.catalog.library.cancel")," "),e.xp6(2),e.Q6J("disabled",!i.form.valid),e.xp6(1),e.hij(" ",e.lcZ(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[f.sg,f.O5,Z.sL,P.gM,S.lW,F.KE,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,j.Nt,se.gD,le.ey,Je.XC,Je.ZL,B.uh,B.xY,B.H8,f.Ov,O.X$],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]})}return n})();function Tv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-catalog-library-item",3),e.NdJ("catalogRemove",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onCatalogRemove(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onCatalogSelect(s))}),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw();e.Q6J("map",o.map)("catalog",t)}}function Fv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",4)(1,"button",5),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addCatalogDialog())}),e.ALo(2,"translate"),e._uU(3),e.ALo(4,"translate"),e._UZ(5,"mat-icon",6),e.qZA()()}2&n&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.catalog.library.addBtn")),e.xp6(2),e.hij(" ",e.lcZ(4,4,"igo.geo.catalog.library.addBtn")," "))}let Ta=(()=>{class n{capabilitiesService;messageService;storageService;dialog;store;map;addCatalogAllowed=!1;predefinedCatalogs=[];catalogSelectChange=new e.vpe;submitDisabled=!0;addingCatalog$$;get addedCatalogs(){return this.storageService.get("addedCatalogs")||[]}set addedCatalogs(t){this.storageService.set("addedCatalogs",t)}constructor(t,o,i,s){this.capabilitiesService=t,this.messageService=o,this.storageService=i,this.dialog=s}ngOnInit(){this.store.state.clear(),this.predefinedCatalogs=this.predefinedCatalogs.map(t=>(t.id=mo.V8.hashStr((t.type||"wms")+ei(t.url)),t.title=""!==t.title&&t.title?t.title:t.url,t))}getCatalogs(){return this.store.view.all$()}onCatalogSelect(t){this.store.state.update(t,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:t})}unsubscribeAddingCatalog(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}addCatalog(t){if(!t)return;let o=mo.V8.hashStr(t.type+ei(t.url));const i=this.predefinedCatalogs.find(s=>s.id===t.id);i&&(t.version=i.version,t.externalProvider=i.externalProvider,o=i.id),this.store.get(o)?this.messageService.alert("igo.geo.catalog.library.inlist.message","igo.geo.catalog.library.inlist.title"):(this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(t.type,t.url,t.version).pipe((0,ce.K)(s=>{if(s.error)return this.addCatalogDialog(!0,t),s.error.caught=!0,s;throw this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.url}),s})).subscribe(s=>{let a,l;switch(t.type){case"wms":a=t.title||s.Service.Title,l=t.version||s.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":a=t.title||s.mapName;break;case"wmts":a=t.title||s.ServiceIdentification.ServiceType;break;default:a=t.title}const c=R.removeUndefined(Object.assign({},i,R.removeUndefined({id:o,title:a,url:t.url,type:t.type||"wms",externalProvider:t.externalProvider||!1,removable:!0,version:l})));this.store.insert(c);const u=this.addedCatalogs.slice(0);u.push(c),this.addedCatalogs=u,this.unsubscribeAddingCatalog()}))}ngOnDestroy(){this.unsubscribeAddingCatalog()}onCatalogRemove(t){this.store.delete(t),this.addedCatalogs=this.addedCatalogs.slice(0).filter(o=>o.id!==t.id)}addCatalogDialog(t,o){this.dialog.open(wv,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:t,addedCatalog:o}}).afterClosed().subscribe(s=>{this.addCatalog(s)})}static \u0275fac=function(o){return new(o||n)(e.Y36(Zt),e.Y36(_e),e.Y36(oe),e.Y36(B.uw))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"map","catalog","catalogRemove","select"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"matTooltip","click"],["svgIcon","earth-plus"]],template:function(o,i){1&o&&(e.TgZ(0,"igo-list",0),e.YNc(1,Tv,1,2,"ng-template",1),e.ALo(2,"async"),e.qZA(),e.YNc(3,Fv,6,6,"div",2)),2&o&&(e.Q6J("navigation",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,3,i.getCatalogs())),e.xp6(2),e.Q6J("ngIf",i.addCatalogAllowed))},styles:["[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}"],changeDetection:0})}return n})(),Ov=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,ut.g,Z.ie,P.AV,bi,re,S.ot,F.lN,_.UX,j.c,se.LD,Je.Bb,B.Is]})}return n})();e.B6R(Ta,[f.sg,f.O5,w.Hw,P.gM,Nt,So,S.lW,fv],[f.Ov,O.X$]);let Av=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,ut.g,w.Ps,Z.ie,P.AV,lr,bi,Ui,dv,Ov]})}return n})();var En=v(17792);class Fa{}class Oa{sources;constructor(r){this.sources=r}}function Lv(n){return new Oa(n)}function Mv(){return{provide:Oa,useFactory:Lv,deps:[Fa]}}let Iv=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[Mv()],imports:[f.ez,En._t,_.u5,_.UX,w.Ps,S.ot,Z.ie,Ve.t,F.lN,j.c,le.Ng,se.LD,tt.rP,P.AV,Je.Bb,re]})}return n})(),Yu=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,S.ot,P.AV,re]})}return n})(),Zv=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[_.u5,_.UX,f.ez,S.ot,Ue.vV,Ve.t,F.lN,w.Ps,ut.g,P.AV,F.lN,j.c,Z.ie,se.LD,tt.rP,B.Is,re,gn,$t.b2,ec.PW,nt.Fk,ze.p9]})}return n})(),Aa=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,re,mn,Js]})}return n})(),Pv=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,dn,dn]})}return n})(),Ii=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Aa,Pv]})}return n})();var ni=v(17321),Rn=v(9390);let Hu=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,w.Ps,F.lN,j.c,S.ot,Ue.vV,re]})}return n})(),Vu=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Hu,Hu]})}return n})();function kv(n,r){if(1&n&&(e.TgZ(0,"button",2),e.ALo(1,"translate"),e._UZ(2,"mat-icon",3),e.qZA()),2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.xp6(2),e.Q6J("matBadge",t.badge)}}function $v(n,r){if(1&n&&e._UZ(0,"igo-ogc-filterable-item",7),2&n){const t=e.oxw(2);e.Q6J("header",!1)("map",t.layer.map)("layer",t.layer)}}function Dv(n,r){if(1&n&&(e.TgZ(0,"div",4,5),e.YNc(2,$v,1,3,"igo-ogc-filterable-item",6),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.ogcFilterCollapse&&t.options.ogcFilters.enabled)}}let Nn=(()=>{class n{options;get badge(){const t=this.options.ogcFilters;let o=0;if(t&&!t.advancedOgcFilters){if(t.pushButtons){const s=t.pushButtons.groups.find(l=>l.enabled);let a=0;s&&s.computedSelectors?.map(l=>a+=l.selectors?.filter(c=>c.enabled).length),o+=a}if(t.checkboxes){const s=t.checkboxes.groups.find(l=>l.enabled);let a=0;s&&s.computedSelectors?.map(l=>a+=l.selectors?.filter(c=>c.enabled).length),o+=a}if(t.radioButtons){const s=t.radioButtons.groups.find(l=>l.enabled);let a=0;s&&s.computedSelectors?.map(l=>a+=l.selectors?.filter(c=>c.enabled).length),o+=a}if(t.select){const s=t.select.groups.find(l=>l.enabled);let a=0;s&&s.computedSelectors?.map(l=>a+=l.selectors?.filter(c=>c.enabled).length),o+=a}if(t.autocomplete){const s=t.autocomplete.groups.find(l=>l.enabled);let a=0;s&&s.computedSelectors?.map(l=>a+=l.selectors?.filter(c=>c.enabled).length),o+=a}}else{if(t&&t.filters&&!t.filters.filters)return 1;if(t&&t.filters&&t.filters.filters)return t.filters.filters.length}if(t.filters&&"During"===t.filters.operator&&t.filters.active&&t.interfaceOgcFilters&&t.interfaceOgcFilters[0].active){const i=t.interfaceOgcFilters[0];t.filters.calendarModeYear?(i.begin.substring(0,4)!==this.options.minDate.substring(0,4)||i.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(o+=1):(i.begin!==this.options.minDate||i.end!==this.options.maxDate)&&(o+=1)}return o>0?o:void 0}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header;ogcFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","filter",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(o,i){1&o&&(e.YNc(0,kv,3,5,"button",0),e.YNc(1,Dv,3,1,"div",1)),2&o&&(e.Q6J("ngIf",i.header&&i.options.ogcFilters&&i.options.ogcFilters.enabled&&(i.options.ogcFilters.pushButtons||i.options.ogcFilters.checkboxes||i.options.ogcFilters.radioButtons||i.options.ogcFilters.select||i.options.ogcFilters.autocomplete||i.options.ogcFilters.editable)),e.xp6(1),e.Q6J("ngIf",i.options.ogcFilters&&i.options.ogcFilters.enabled&&(i.options.ogcFilters.pushButtons||i.options.ogcFilters.checkboxes||i.options.ogcFilters.radioButtons||i.options.ogcFilters.select||i.options.ogcFilters.autocomplete||i.options.ogcFilters.editable)))},changeDetection:0})}return n})(),Ev=(()=>{class n{constructor(){}wktToFeature(t,o,i){return(new ji.Z).readFeature(t,{dataProjection:o,featureProjection:i})}extentToWkt(t,o,i){let s=Q.$A(o,i,t);return s=this.roundCoordinateArray(s,t,0),{wktPoly:`POLYGON((\n      ${o[0]} ${o[1]},\n      ${o[0]} ${o[3]},\n      ${o[2]} ${o[3]},\n      ${o[2]} ${o[1]},\n      ${o[0]} ${o[1]}))`,wktLine:`LINESTRING(\n      ${o[0]} ${o[1]},\n      ${o[0]} ${o[3]},\n      ${o[2]} ${o[3]},\n      ${o[2]} ${o[1]},\n      ${o[0]} ${o[1]})`,wktMultiPoints:`MULTIPOINT(\n        ${o[0]} ${o[1]},\n        ${o[0]} ${o[3]},\n        ${o[2]} ${o[3]},\n        ${o[2]} ${o[1]})`}}roundCoordinateArray(t,o,i=0){const a=Q.U2(o).getUnits();return-1!==["ft","m","us-ft"].indexOf(a)&&(t=this.roundArray(t,i)),t}roundArray(t,o=0){let i=0;for(;i<t.length;)t[i]=t[i].toFixed(o),i++;return t}snrcToWkt(t,o){let i;t=t.toLowerCase();const s={1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}},a={1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}},l=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],c=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]];let g=!1,h=!1,m=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(t)?m=!0:/\d{2,3}[a-p]/gi.test(t)?h=!0:/\d{2,3}/gi.test(t)&&(g=!0),g?t+="a01":h&&(t+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(t)){const C=t.split(/(?=[a-p])/gi),x=C[0],A=C[1][0],M=C[1].split(A)[1];let k=1;3===x.length&&(k=2);const H=x.substring(0,k),Me=x.substring(k),Fe=8,G=4,Oe=2,V=1,he=.5,et=.25;let Re=0,jt=0,Jo=0,pi=0;l.forEach(Zo=>{-1!==Zo.indexOf(A)&&(jt=l.indexOf(Zo),Re=Zo.indexOf(A))}),c.forEach(Zo=>{-1!==Zo.indexOf(M)&&(pi=c.indexOf(Zo),Jo=Zo.indexOf(M))});let Xt=0,Ot=0,eo=0,kt=0,uo=Fe,Io=G;h?(Xt=Re*Oe,Ot=jt*V,eo=0,kt=0,uo=Oe,Io=V):m&&(Xt=Re*Oe,Ot=jt*V,eo=Jo*he,kt=pi*et,uo=he,Io=et);const W={ul:[s[H].to+Xt+eo,a[Me].to-Ot-kt]};return W.lr=[W.ul[0]+uo,W.ul[1]-Io],W.ur=[W.ul[0],W.ul[1]-Io],W.ll=[W.ul[0]+uo,W.ul[1]],W.ul=Q.vs([W.ul[0],W.ul[1]],"EPSG:4326",o),W.lr=Q.vs([W.lr[0],W.lr[1]],"EPSG:4326",o),W.ur=Q.vs([W.ur[0],W.ur[1]],"EPSG:4326",o),W.ll=Q.vs([W.ll[0],W.ll[1]],"EPSG:4326",o),W.ul=this.roundCoordinateArray(W.ul,o,0),W.lr=this.roundCoordinateArray(W.lr,o,0),W.ur=this.roundCoordinateArray(W.ur,o,0),W.ll=this.roundCoordinateArray(W.ll,o,0),i="POLYGON(("+[W.ul.join(" "),W.ur.join(" "),W.lr.join(" "),W.ll.join(" "),W.ul.join(" ")].join(",")+"))",{wktPoly:i,wktLine:"LINESTRING("+[W.ul.join(" "),W.ur.join(" "),W.lr.join(" "),W.ll.join(" "),W.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[W.ul.join(" "),W.ur.join(" "),W.lr.join(" "),W.ll.join(" ")].join(",")+")"}}}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Rv(n,r){if(1&n&&(e.TgZ(0,"mat-option",24),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.alias)("id",t.name)("matTooltip",t.alias),e.xp6(1),e.hij(" ",t.alias," ")}}function Nv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.clearSelectedField())}),e._UZ(1,"mat-icon",26),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function Bv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",18),e.NdJ("mouseenter",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable="selectField")})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable=void 0)}),e.TgZ(1,"input",19),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.updateFieldsList(i.target.value))}),e.ALo(2,"translate"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"mat-autocomplete",20,21),e.NdJ("optionSelected",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeField(i.option.id))}),e.YNc(10,Rv,2,4,"mat-option",22),e.ALo(11,"async"),e.qZA(),e.YNc(12,Nv,2,1,"button",23),e.qZA()}if(2&n){const t=e.MAs(9),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,8,"igo.geo.sourceFields.selectField"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value",e.lcZ(3,10,o.selectedField$)?e.lcZ(4,12,o.selectedField$).alias:"")("matTooltip",e.lcZ(5,14,o.selectedField$)?e.lcZ(6,16,o.selectedField$).alias:e.lcZ(7,18,"igo.geo.sourceFields.selectField")),e.xp6(9),e.Q6J("ngForOf",e.lcZ(11,20,o.filteredFields$)),e.xp6(2),e.Q6J("ngIf",o.currentFilter.propertyName&&"selectField"===o.inputClearable&&o.currentFilter.active)}}function Jv(n,r){if(1&n&&(e.TgZ(0,"mat-option",4),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key)("matTooltip",e.lcZ(1,3,"igo.geo.operators.tooltip."+t.key)),e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.geo.operators."+t.key)," ")}}function Uv(n,r){if(1&n&&(e.TgZ(0,"mat-option",30),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.type),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialSelector."+t.type)," ")}}function Gv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",27)(1,"mat-select",28),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeSpatialSelector(i.value))}),e.YNc(2,Uv,3,4,"mat-option",29),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("disabled",!t.currentFilter.active)("value",t.currentFilter.igoSpatialSelector),e.xp6(1),e.Q6J("ngForOf",t.igoSpatialSelectors)}}function qv(n,r){if(1&n&&(e.TgZ(0,"mat-option",34),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t),e.xp6(1),e.hij(" ",t," ")}}function jv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.clearProperty())}),e._UZ(1,"mat-icon",26),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function Qv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",31),e.NdJ("mouseenter",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable="selectProperty")})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable=void 0)}),e.TgZ(1,"input",19),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.updateValuesList(i.target.value))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",20,32),e.NdJ("optionSelected",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeProperty(i.option.value))}),e.YNc(5,qv,2,3,"mat-option",33),e.ALo(6,"async"),e.qZA(),e.YNc(7,jv,2,1,"button",23),e.qZA()}if(2&n){const t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,8,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","expression"===o.detectProperty()?o.currentFilter.expression:o.currentFilter.pattern)("matTooltip","expression"===o.detectProperty()?o.currentFilter.expression||"":o.currentFilter.pattern||""),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,10,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable()&&"selectProperty"===o.inputClearable&&o.currentFilter.active)}}function Yv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.currentFilter.igoSNRC="")}),e._UZ(1,"mat-icon",26),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active&&"selectSNRC"===t.inputClearable&&t.currentFilter.active)}}function Hv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",35),e.NdJ("mouseenter",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable="selectSNRC")})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable=void 0)}),e.TgZ(1,"input",36),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeSNRC(i.target.value))}),e.ALo(2,"translate"),e.qZA(),e.YNc(3,Yv,2,1,"button",23),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("floatLabel",t.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,5,"igo.geo.filter.placeholderSnrc"))("value",t.currentFilter.igoSNRC)("matTooltip",t.currentFilter.igoSNRC?t.currentFilter.igoSNRC:""),e.xp6(2),e.Q6J("ngIf",t.currentFilter.igoSNRC)}}function Vv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",38),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.changeMapExtentGeometry())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",39),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)("disabled",!t.currentFilter.active)("matTooltip",e.lcZ(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function zv(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Vv,3,5,"button",37),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf","fixedExtent"===t.currentFilter.igoSpatialSelector)}}function Kv(n,r){if(1&n&&(e.TgZ(0,"mat-option",34),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t),e.xp6(1),e.hij(" ",t," ")}}function Wv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.clearProperty(1))}),e._UZ(1,"mat-icon",26),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function Xv(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",40),e.NdJ("mouseenter",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable="selectProperty1")})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable=void 0)}),e.TgZ(1,"input",41),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.updateValuesList(i.target.value,1))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",20,42),e.NdJ("optionSelected",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeNumericProperty(i.option.value,1))}),e.YNc(5,Kv,2,3,"mat-option",33),e.ALo(6,"async"),e.qZA(),e.YNc(7,Wv,2,1,"button",23),e.qZA()}if(2&n){const t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,7,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","lowerBoundary"===o.detectProperty(1)?o.currentFilter.lowerBoundary:o.currentFilter.begin),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,9,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable(1)&&"selectProperty1"===o.inputClearable&&o.currentFilter.active)}}function e1(n,r){if(1&n&&(e.TgZ(0,"mat-option",34),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t),e.xp6(1),e.hij(" ",t," ")}}function t1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.clearProperty(2))}),e._UZ(1,"mat-icon",26),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function o1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",40),e.NdJ("mouseenter",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable="selectProperty2")})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.inputClearable=void 0)}),e.TgZ(1,"input",41),e.NdJ("input",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.updateValuesList(i.target.value,2))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",20,43),e.NdJ("optionSelected",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeNumericProperty(i.option.value,2))}),e.YNc(5,e1,2,3,"mat-option",33),e.ALo(6,"async"),e.qZA(),e.YNc(7,t1,2,1,"button",23),e.qZA()}if(2&n){const t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,7,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","upperBoundary"===o.detectProperty(2)?o.currentFilter.upperBoundary:o.currentFilter.end),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,9,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable(2)&&"selectProperty2"===o.inputClearable&&o.currentFilter.active)}}function n1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-ogc-filter-time",44),e.NdJ("datasourceChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.datasource=i)})("currentFilterChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.currentFilter=i)})("changeProperty",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeProperty(i.value,i.pos))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("datasource",t.datasource)("currentFilter",t.currentFilter)}}const r1=function(n,r){return{logical:n,logicalHidden:r}},s1=function(n,r){return{operator:n,dualInput:r}},a1=function(){return["expression","pattern"]},l1=function(){return["lowerBoundary","begin"]},c1=function(){return["upperBoundary","end"]};let zu=(()=>{class n{wktService;ogcFilterOperator=D;filteredValues$;filteredFields$;allOgcFilterOperators;ogcFilterOperators$=new y.X(void 0);igoSpatialSelectors;value="";inputOperator;selectedField$=new y.X(void 0);fields$=new y.X([]);color="primary";disabled;currentFilterIsSpatial$=new y.X(!1);defaultStepMillisecond=6e3;inputClearable;refreshFilters;datasource;map;currentFilter;set snrc(t){(/^\d{2}$/gi.test(t)||/^\d{2}[a-p]$/gi.test(t)||/^\d{2}[a-l][0,1][0-9]$/gi.test(t))&&(this._snrc=t,this.currentFilter.igoSNRC=t)}get snrc(){return this._snrc}_snrc="";floatLabel;get activeFilters(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(t=>!0===t.active)}get allowedOperators(){return(new Jt).computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}constructor(t){this.wktService=t,this.allOgcFilterOperators=(new Jt).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}ngOnInit(){if(this.datasource.options.sourceFields){const t=this.datasource.options.sourceFields.filter(o=>void 0===o.excludeFromOgcFilters||!o.excludeFromOgcFilters);t.map(o=>{o.values&&o.values.sort()}),this.fields$.next(t)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(t=>t.name===this.currentFilter.propertyName)),this.updateValuesList(),this.selectedField$.subscribe(t=>{this.ogcFilterOperators$.next(this.allowedOperators),-1===Object.keys(this.allowedOperators).indexOf(this.currentFilter.operator)&&(this.currentFilter.operator=Object.keys(this.allowedOperators)[0],this.currentFilter.operator=Object.keys(this.allowedOperators)[0]),this.updateValuesList()}),this.currentFilterIsSpatial()}updateFieldsList(t){this.filteredFields$=t&&t.length>0?(0,z.of)(this._filterFields(t)):this.fields$,this.fields$.value.find(o=>o.name===t)&&this.changeField(t)}updateValuesList(t,o){this.filteredValues$=(0,z.of)(t&&t.length>0?this._filterValues(t):this.selectedField$.value?this.selectedField$.value.values:[]),t&&t.length>=1&&this.changeProperty(t,o)}_filterFields(t){const o=new RegExp(t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(i=>o.test(i.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}_filterValues(t){const o=new RegExp(t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value.values.filter(i=>i&&o.test(i.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}clearSelectedField(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}isClearable(t){const o=this.detectProperty(t);if(o)return this.currentFilter[o]}clearProperty(t){const o=this.detectProperty(t);if(o)return this.currentFilter[o]=""}toggleFilterState(t){this.datasource.options.ogcFilters.interfaceOgcFilters.find(o=>o.filterid===this.currentFilter.filterid).active=t.checked,this.refreshFilters()}deleteFilter(){const t=this.datasource.options.ogcFilters;t.interfaceOgcFilters=t.interfaceOgcFilters.filter(o=>o.filterid!==this.currentFilter.filterid),this.refreshFilters()}changeLogical(t){this.currentFilter.parentLogical=t,this.refreshFilters()}changeOperator(t){this.currentFilter.operator=t,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&0===this.currentFilter.wkt_geometry.length?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}changeField(t){this.currentFilter.propertyName=t,this.selectedField$.next(this.fields$.value.find(o=>o.name===this.currentFilter.propertyName)),this.refreshFilters()}changeCaseSensitive(t){this.currentFilter.matchCase=t.checked,this.refreshFilters()}changeProperty(t,o,i=!0){const s=this.detectProperty(o);s&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(a=>a.filterid===this.currentFilter.filterid)[s]=t,i&&this.refreshFilters())}changeNumericProperty(t,o){this.changeProperty(parseFloat(t),o)}changeSpatialSelector(t){this.currentFilter.igoSpatialSelector=t,"fixedExtent"===t&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}changeSNRC(t){this.snrc=t,this.changeSNRCGeometry()}changeSNRCGeometry(){this.datasource.options.ogcFilters.interfaceOgcFilters.find(o=>o.filterid===this.currentFilter.filterid)&&(this.snrc&&"snrc"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}changeMapExtentGeometry(t=!0){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid)&&("fixedExtent"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),t&&this.refreshFilters())}detectProperty(t){switch(this.currentFilter.operator){case D.PropertyIsNotEqualTo:case D.PropertyIsEqualTo:case D.PropertyIsGreaterThan:case D.PropertyIsGreaterThanOrEqualTo:case D.PropertyIsLessThan:case D.PropertyIsLessThanOrEqualTo:return"expression";case D.PropertyIsLike:return"pattern";case D.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case D.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}currentFilterIsSpatial(){let t=!1;this.currentFilter&&(t=-1!==[D.Contains,D.Intersects,D.Within].indexOf(this.currentFilter.operator)),this.currentFilterIsSpatial$.next(t)}isTemporalOperator(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}static \u0275fac=function(o){return new(o||n)(e.Y36(Ev))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},decls:43,vars:76,consts:[[1,"ogc-filter-form-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","click","change"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"disabled","value","matTooltip","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","value","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty",4,"ngIf"],[1,"field",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","disabled","matAutocomplete","value","matTooltip","input"],[3,"optionSelected"],["autoCompleteField","matAutocomplete"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click"],["svgIcon","close"],[1,"spatialSelector"],[3,"disabled","value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"floatLabel","mouseenter","mouseleave"],["autoCompleteValues","matAutocomplete"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","value","matTooltip","input"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click"],["svgIcon","arrow-expand-all"],[1,"dualInput",3,"floatLabel","mouseenter","mouseleave"],["matInput","","type","number",3,"placeholder","disabled","matAutocomplete","value","input"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"mat-checkbox",1),e.NdJ("click",function(a){return a.stopPropagation()})("change",function(a){return i.toggleFilterState(a)}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-form-field",2)(4,"mat-select",3),e.NdJ("selectionChange",function(a){return i.changeLogical(a.value)}),e.ALo(5,"translate"),e.TgZ(6,"mat-option",4),e.ALo(7,"translate"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"mat-option",4),e.ALo(11,"translate"),e._uU(12),e.ALo(13,"translate"),e.qZA()()(),e.YNc(14,Bv,13,22,"mat-form-field",5),e.ALo(15,"async"),e.ALo(16,"async"),e.ALo(17,"async"),e.ALo(18,"async"),e.TgZ(19,"mat-form-field",6),e.ALo(20,"async"),e.ALo(21,"async"),e.TgZ(22,"mat-select",7),e.NdJ("selectionChange",function(a){return i.changeOperator(a.value)}),e.ALo(23,"translate"),e.ALo(24,"translate"),e.YNc(25,Jv,4,7,"mat-option",8),e.ALo(26,"keyvalue"),e.ALo(27,"async"),e.qZA()(),e.YNc(28,Gv,3,3,"mat-form-field",9),e.ALo(29,"async"),e.YNc(30,Qv,8,12,"mat-form-field",10),e.TgZ(31,"div",11)(32,"button",12),e.NdJ("click",function(){return i.deleteFilter()}),e.ALo(33,"translate"),e._UZ(34,"mat-icon",13),e.qZA()(),e.YNc(35,Hv,4,7,"mat-form-field",14),e.ALo(36,"async"),e.YNc(37,zv,2,1,"ng-container",15),e.ALo(38,"async"),e.qZA(),e.TgZ(39,"div",0),e.YNc(40,Xv,8,11,"mat-form-field",16),e.YNc(41,o1,8,11,"mat-form-field",16),e.qZA(),e.YNc(42,n1,1,2,"igo-ogc-filter-time",17)),2&o&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,27,"igo.geo.filter.toggleFilterState"))("checked",i.currentFilter.active),e.xp6(2),e.Q6J("ngClass",e.WLB(67,r1,0!==i.activeFilters.indexOf(i.currentFilter)&&!0===i.currentFilter.active,0===i.activeFilters.indexOf(i.currentFilter)||!0!==i.currentFilter.active)),e.xp6(1),e.Q6J("disabled",!i.currentFilter.active)("value",i.currentFilter.parentLogical)("matTooltip",i.currentFilter.parentLogical?e.lcZ(5,29,"igo.geo.operators.tooltip."+i.currentFilter.parentLogical):""),e.xp6(2),e.Q6J("value",i.ogcFilterOperator.And)("matTooltip",e.lcZ(7,31,"igo.geo.operators.tooltip.And")),e.xp6(2),e.hij(" ",e.lcZ(9,33,"igo.geo.operators.And")," "),e.xp6(2),e.Q6J("value",i.ogcFilterOperator.Or)("matTooltip",e.lcZ(11,35,"igo.geo.operators.tooltip.Or")),e.xp6(2),e.hij(" ",e.lcZ(13,37,"igo.geo.operators.Or")," "),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(15,39,i.currentFilterIsSpatial$)&&e.lcZ(16,41,i.fields$)&&e.lcZ(17,43,i.fields$).length>0&&""!==e.lcZ(18,45,i.fields$)[0].name),e.xp6(5),e.Q6J("ngClass",e.WLB(70,s1,!1===e.lcZ(20,47,i.currentFilterIsSpatial$),e.lcZ(21,49,i.currentFilterIsSpatial$)))("floatLabel",i.floatLabel),e.xp6(3),e.Q6J("matTooltip",i.currentFilter.operator?e.lcZ(23,51,"igo.geo.operators.tooltip."+i.currentFilter.operator):e.lcZ(24,53,"igo.geo.filter.selectOperator"))("disabled",!i.currentFilter.active)("value",i.currentFilter.operator),e.xp6(3),e.Q6J("ngForOf",e.lcZ(26,55,e.lcZ(27,57,i.ogcFilterOperators$))),e.xp6(3),e.Q6J("ngIf",e.lcZ(29,59,i.currentFilterIsSpatial$)),e.xp6(2),e.Q6J("ngIf",-1!==e.DdM(73,a1).indexOf(i.detectProperty())),e.xp6(2),e.Q6J("matTooltip",e.lcZ(33,61,"igo.geo.filter.removeFilter")),e.xp6(3),e.Q6J("ngIf",e.lcZ(36,63,i.currentFilterIsSpatial$)&&"snrc"===i.currentFilter.igoSpatialSelector),e.xp6(2),e.Q6J("ngIf",e.lcZ(38,65,i.currentFilterIsSpatial$)&&"fixedExtent"===i.currentFilter.igoSpatialSelector),e.xp6(3),e.Q6J("ngIf",!i.isTemporalOperator()&&-1!==e.DdM(74,l1).indexOf(i.detectProperty(1))),e.xp6(1),e.Q6J("ngIf",!i.isTemporalOperator()&&-1!==e.DdM(75,c1).indexOf(i.detectProperty(2))),e.xp6(1),e.Q6J("ngIf",i.isTemporalOperator()))},styles:["[_nghost-%COMP%]{width:100%;padding:5px 10px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}[_nghost-%COMP%]   .ogc-filter-form-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-select-arrow[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   .logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:100%;max-width:60px;margin-right:5px}[_nghost-%COMP%]   .logicalHidden[_ngcontent-%COMP%]{width:0px;visibility:hidden;max-width:0px}[_nghost-%COMP%]     .logical .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]     .logicalHidden .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .field[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .field .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .operator[_ngcontent-%COMP%]{width:150px;margin-right:5px;text-align:center}[_nghost-%COMP%]     .operator .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .spatialSelector[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .spatialSelector .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:27%}}[_nghost-%COMP%]   .snrc[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .singleInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .dualInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .dualInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{display:flex;padding-top:5px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex}"]})}return n})(),La=(()=>{class n{constructor(){}filterByOgc(t,o){const i=(new Jt).formatProcessedOgcFilter(o,t.options.params.LAYERS);t.ol.updateParams({FILTER:i})}setOgcWFSFiltersOptions(t){const o=t.options,i=new Jt;o.ogcFilters.enabled&&o.ogcFilters.filters&&(o.ogcFilters.filters=i.checkIgoFiltersProperties(o.ogcFilters.filters,o.paramsWFS.fieldNameGeometry,new xn.Z({code:o.paramsWFS.srsName}),!0),o.ogcFilters.interfaceOgcFilters||(o.ogcFilters.interfaceOgcFilters=i.defineInterfaceFilterSequence(o.ogcFilters.filters,o.paramsWFS.fieldNameGeometry)))}setOgcWMSFiltersOptions(t){const o=t.options,i=new Jt;o.ogcFilters.enabled&&o.ogcFilters.filters?(o.ogcFilters.filters=i.checkIgoFiltersProperties(o.ogcFilters.filters,o.fieldNameGeometry,void 0,!0),o.ogcFilters.interfaceOgcFilters||(o.ogcFilters.interfaceOgcFilters=i.defineInterfaceFilterSequence(o.ogcFilters.filters,o.fieldNameGeometry)),this.filterByOgc(t,i.buildFilter(o.ogcFilters.filters,void 0,void 0,void 0,t.options)),o.filtered=!0):(o.ogcFilters.filters=void 0,o.ogcFilters.interfaceOgcFilters=[],o.filtered=!1)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();const u1=["selection"];function p1(n,r){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function d1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",11),e.NdJ("valueChange",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentPushButtonsGroup=i)}),e.ALo(3,"translate"),e.YNc(4,p1,2,2,"mat-option",12),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentPushButtonsGroup),e.xp6(2),e.Q6J("ngForOf",t.getPushButtonsGroups())}}function g1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-button-toggle",16),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectionChange(s,a.selectorType))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("ngStyle",o.getButtonColor(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function m1(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"mat-button-toggle-group",14),e.YNc(4,g1,2,5,"mat-button-toggle",15),e.qZA(),e.BQk()),2&n){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(1),e.s9C("vertical",o.bundleIsVertical(t)),e.xp6(1),e.Q6J("ngForOf",t.selectors)}}function h1(n,r){if(1&n&&(e.TgZ(0,"div",8),e._UZ(1,"mat-divider"),e.YNc(2,d1,5,5,"div",9),e.YNc(3,m1,5,3,"ng-container",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getPushButtonsGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentPushButtonsGroup.computedSelectors)}}function f1(n,r){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function _1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",18),e.NdJ("valueChange",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentCheckboxesGroup=i)}),e.ALo(3,"translate"),e.YNc(4,f1,2,2,"mat-option",12),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentCheckboxesGroup),e.xp6(2),e.Q6J("ngForOf",t.getCheckboxesGroups())}}function y1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-checkbox",21),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectionChange(s,a.selectorType))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function b1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"u",24),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(5);return e.KtG(i.displayLessResults("checkbox"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayLessResults")," "))}function v1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"u",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(5);return e.KtG(i.displayMoreResults("checkbox"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayMoreResults")," "))}function C1(n,r){if(1&n&&(e.TgZ(0,"p"),e.YNc(1,b1,3,3,"u",22),e.YNc(2,v1,3,3,"u",23),e.qZA()),2&n){const t=e.oxw().$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"checkbox")),e.xp6(1),e.Q6J("ngIf",o.isMoreResults(t,"checkbox"))}}function x1(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"div",19),e.YNc(4,y1,2,4,"mat-checkbox",20),e.qZA(),e.YNc(5,C1,3,2,"p",2),e.BQk()),2&n){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngForOf",t.selectors),e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"checkbox")||o.isMoreResults(t,"checkbox"))}}function S1(n,r){if(1&n&&(e.TgZ(0,"div",17),e._UZ(1,"mat-divider"),e.YNc(2,_1,5,5,"div",9),e.YNc(3,x1,6,3,"ng-container",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getCheckboxesGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentCheckboxesGroup.computedSelectors)}}function w1(n,r){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function T1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",27),e.NdJ("valueChange",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentRadioButtonsGroup=i)}),e.ALo(3,"translate"),e.YNc(4,w1,2,2,"mat-option",12),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentRadioButtonsGroup),e.xp6(2),e.Q6J("ngForOf",t.getRadioButtonsGroups())}}function F1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-radio-button",30),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(4);return e.KtG(i.emptyRadioButtons())}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&n&&(e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.filter.resetFilters")),e.xp6(2),e.hij("",e.lcZ(3,4,"igo.geo.filter.resetFilters")," "))}function O1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-radio-button",21),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.oxw(3).$implicit,l=e.oxw();return e.KtG(l.onSelectionChange(s,a.selectorType))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function A1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"u",24),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(5);return e.KtG(i.displayLessResults("radio"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayLessResults")," "))}function L1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"u",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(5);return e.KtG(i.displayMoreResults("radio"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayMoreResults")," "))}function M1(n,r){if(1&n&&(e.TgZ(0,"p"),e.YNc(1,A1,3,3,"u",22),e.YNc(2,L1,3,3,"u",23),e.qZA()),2&n){const t=e.oxw().$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"radio")),e.xp6(1),e.Q6J("ngIf",o.isMoreResults(t,"radio"))}}function I1(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"mat-radio-group",28),e.YNc(4,F1,4,6,"mat-radio-button",29),e.YNc(5,O1,2,4,"mat-radio-button",20),e.YNc(6,M1,3,2,"p",2),e.qZA(),e.BQk()),2&n){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",t.unfiltered),e.xp6(1),e.Q6J("ngForOf",t.selectors),e.xp6(1),e.Q6J("ngIf",o.isLessResults(t,"radio")||o.isMoreResults(t,"radio"))}}function Z1(n,r){if(1&n&&(e.TgZ(0,"div",26),e._UZ(1,"mat-divider"),e.YNc(2,T1,5,5,"div",9),e.YNc(3,I1,7,4,"ng-container",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getRadioButtonsGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentRadioButtonsGroup.computedSelectors)}}function P1(n,r){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function k1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",32),e.NdJ("valueChange",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentSelectGroup=i)}),e.ALo(3,"translate"),e.YNc(4,P1,2,2,"mat-option",12),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentSelectGroup),e.xp6(2),e.Q6J("ngForOf",t.getSelectGroups())}}function $1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-button",36),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(4);return e.KtG(i.emptySelect())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",37),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.filter.resetFilters"))}const D1=function(){return{standalone:!0}};function E1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-checkbox",42),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(5);return e.KtG(s.selectAllSelected=i)})("change",function(){e.CHM(t);const i=e.oxw(5);return e.KtG(i.toggleAllSelection())}),e._uU(1,"Tous "),e.qZA()}if(2&n){const t=e.oxw(5);e.Q6J("ngModel",t.selectAllSelected)("ngModelOptions",e.DdM(2,D1))}}function R1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-option",43),e.NdJ("onSelectionChange",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.selectOptionClick(i.source.value,s,i))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(5);e.Q6J("matTooltip",o.getToolTip(t))("value",t),e.xp6(1),e.hij("",t.title," ")}}function N1(n,r){if(1&n&&(e.TgZ(0,"div")(1,"mat-select",38,39)(3,"div",19),e.YNc(4,E1,2,3,"mat-checkbox",40),e.qZA(),e.YNc(5,R1,2,3,"mat-option",41),e.qZA()()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("multiple",t.multiple)("placeholder",t.title),e.xp6(3),e.Q6J("ngIf",t.multiple),e.xp6(1),e.Q6J("ngForOf",t.selectors)}}function B1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-option",43),e.NdJ("onSelectionChange",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.selectOptionClick(i.source.value,s))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(5);e.Q6J("matTooltip",o.getToolTip(t))("value",t),e.xp6(1),e.hij("",t.title," ")}}function J1(n,r){if(1&n&&(e.TgZ(0,"mat-select",44),e.YNc(1,B1,2,3,"mat-option",41),e.qZA()),2&n){const t=e.oxw().$implicit;e.Q6J("placeholder",t.title),e.xp6(1),e.Q6J("ngForOf",t.selectors)}}function U1(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,$1,3,3,"mat-button",33),e.TgZ(5,"mat-form-field"),e.YNc(6,N1,6,4,"div",34),e.YNc(7,J1,2,2,"ng-template",null,35,e.W1O),e.qZA()(),e.BQk()),2&n){const t=r.$implicit,o=e.MAs(8);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",t.unfiltered&&!t.multiple),e.xp6(1),e.Udp("width",t.width?t.width:void 0,"%"),e.xp6(1),e.Q6J("ngIf",t.multiple)("ngIfElse",o)}}function G1(n,r){if(1&n&&(e.TgZ(0,"div",31),e._UZ(1,"mat-divider"),e.YNc(2,k1,5,5,"div",9),e.YNc(3,U1,9,6,"ng-container",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getSelectGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentSelectGroup.computedSelectors)}}function q1(n,r){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t.title," ")}}function j1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",46),e.NdJ("valueChange",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.currentAutocompleteGroup=i)}),e.ALo(3,"translate"),e.YNc(4,q1,2,2,"mat-option",12),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentAutocompleteGroup),e.xp6(2),e.Q6J("ngForOf",t.getAutocompleteGroups())}}function Q1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-button",36),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(4);return e.KtG(i.emptyAutocomplete())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",37),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.filter.resetFilters"))}function Y1(n,r){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.value," ")}}function H1(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field"),e._UZ(1,"input",48,49),e.TgZ(3,"mat-autocomplete",50,51),e.NdJ("optionSelected",function(i){e.CHM(t);const s=e.oxw(4);return e.KtG(s.autocompleteOptionClick(i.option.value))}),e.YNc(6,Y1,2,2,"mat-option",12),e.ALo(7,"async"),e.qZA()()}if(2&n){const t=e.MAs(4),o=e.oxw().$implicit,i=e.oxw(3);e.Udp("width",o.width?o.width:void 0,"%"),e.xp6(1),e.Q6J("matAutocomplete",t)("placeholder",o.title),e.xp6(2),e.Q6J("displayWith",i.displayFn),e.xp6(3),e.Q6J("ngForOf",e.lcZ(7,6,i.filteredOgcAutocomplete[o.id]))}}function V1(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,Q1,3,3,"mat-button",33),e.YNc(5,H1,8,8,"mat-form-field",47),e.qZA(),e.BQk()),2&n){const t=r.$implicit,o=e.oxw(3);e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",t.unfiltered),e.xp6(1),e.Q6J("ngIf",o.filteredOgcAutocomplete[t.id])}}function z1(n,r){if(1&n&&(e.TgZ(0,"div",45),e._UZ(1,"mat-divider"),e.YNc(2,j1,5,5,"div",9),e.YNc(3,V1,6,3,"ng-container",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.getAutocompleteGroups().length>1),e.xp6(1),e.Q6J("ngForOf",t.currentAutocompleteGroup.computedSelectors)}}function K1(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,h1,4,2,"div",3),e.YNc(2,S1,4,2,"div",4),e.YNc(3,Z1,4,2,"div",5),e.YNc(4,G1,4,2,"div",6),e.YNc(5,z1,4,2,"div",7),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf","pushButton"===t.selectorType),e.xp6(1),e.Q6J("ngIf","checkbox"===t.selectorType),e.xp6(1),e.Q6J("ngIf","radioButton"===t.selectorType),e.xp6(1),e.Q6J("ngIf","select"===t.selectorType),e.xp6(1),e.Q6J("ngIf","autocomplete"===t.selectorType)}}function W1(n,r){1&n&&(e.TgZ(0,"h3"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.filter.reportingDate")," "))}function X1(n,r){if(1&n&&(e.TgZ(0,"h3"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.currentFilter.title)}}function e0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"mat-divider"),e.YNc(2,W1,3,3,"h3",2),e.YNc(3,X1,2,1,"h3",2),e.TgZ(4,"igo-ogc-filter-time",52),e.NdJ("datasourceChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.datasource=i)})("currentFilterChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.currentFilter=i)})("changeProperty",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeProperty(i.value,i.pos))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.currentFilter.title),e.xp6(1),e.Q6J("ngIf",t.currentFilter.title),e.xp6(1),e.Q6J("datasource",t.datasource)("currentFilter",t.currentFilter)}}let Ku=(()=>{class n{ogcFilterService;formBuilder;domService;configService;cdRef;sel;refreshFilters;datasource;map;checkboxesIndex=5;radioButtonsIndex=5;baseIndex=5;get currentFilter(){return this._currentFilter}set currentFilter(t){this._currentFilter=t,this._currentFilter?.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}_currentFilter;ogcFilterOperator=D;form;ogcFilterWriter;color="primary";selectAllSelected=!1;selectEnabled$=new y.X(void 0);selectEnableds$=new y.X([]);autocompleteEnabled$=new y.X(void 0);filteredOgcAutocomplete={};applyFiltersTimeout;get ogcFiltersSelectors(){const t=[];return this.datasource?.options?.ogcFilters?.pushButtons&&t.push(this.datasource?.options?.ogcFilters?.pushButtons),this.datasource?.options?.ogcFilters?.checkboxes&&t.push(this.datasource?.options?.ogcFilters?.checkboxes),this.datasource?.options?.ogcFilters?.radioButtons&&t.push(this.datasource?.options?.ogcFilters?.radioButtons),this.datasource?.options?.ogcFilters?.select&&t.push(this.datasource?.options?.ogcFilters?.select),this.datasource?.options?.ogcFilters?.autocomplete&&t.push(this.datasource?.options?.ogcFilters?.autocomplete),t.sort((o,i)=>o.order<i.order?-1:o.order>i.order?1:0),t}get currentPushButtonsGroup(){return this.form.get("pushButtonsGroup").value}set currentPushButtonsGroup(t){this.form.patchValue({pushButtonsGroup:t})}get currentCheckboxesGroup(){return this.form.get("checkboxesGroup").value}set currentCheckboxesGroup(t){this.form.patchValue({checkboxesGroup:t})}get currentRadioButtonsGroup(){return this.form.get("radioButtonsGroup").value}set currentRadioButtonsGroup(t){this.form.patchValue({radioButtonsGroup:t})}get currentSelectGroup(){return this.form.get("selectGroup").value}set currentSelectGroup(t){this.form.patchValue({selectGroup:t}),this.cdRef.detectChanges()}get currentAutocompleteGroup(){return this.form.get("autocompleteGroup").value}set currentAutocompleteGroup(t){this.form.patchValue({autocompleteGroup:t}),this.cdRef.detectChanges()}get selectEnabled(){return this.selectEnabled$.value}set selectEnabled(t){this.selectEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(o=>{o.selectors?.forEach(i=>{i.enabled=t===i})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get selectEnableds(){return this.selectEnableds$.value}set selectEnableds(t){this.selectEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(o=>{o.selectors?.forEach(i=>{i.enabled=!!t.includes(i)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get autocompleteEnabled(){return this.autocompleteEnabled$.value}set autocompleteEnabled(t){this.autocompleteEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(o=>{o.selectors?.forEach(i=>{i.enabled=t===i.title})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}constructor(t,o,i,s,a){this.ogcFilterService=t,this.formBuilder=o,this.domService=i,this.configService=s,this.cdRef=a,this.ogcFilterWriter=new Jt,this.buildForm()}buildForm(){this.form=this.formBuilder.group({pushButtons:["",[_.kI.required]],radioButtons:["",[_.kI.required]],pushButtonsGroup:["",[_.kI.required]],checkboxesGroup:["",[_.kI.required]],radioButtonsGroup:["",[_.kI.required]],selectGroup:["",[_.kI.required]],select:["",[_.kI.required]],selectMulti:["",[_.kI.required]],autocompleteGroup:["",[_.kI.required]],autocomplete:["",[_.kI.required]]})}getPushButtonsGroups(){if(this.datasource?.options?.ogcFilters?.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}getCheckboxesGroups(){if(this.datasource?.options?.ogcFilters?.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}getRadioButtonsGroups(){if(this.datasource?.options?.ogcFilters?.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}getSelectGroups(){if(this.datasource?.options?.ogcFilters?.select)return this.datasource.options.ogcFilters.select.groups}getAutocompleteGroups(){if(this.datasource?.options?.ogcFilters?.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}ngOnInit(){var t=this;return(0,Ne.Z)(function*(){t.datasource.options.ogcFilters&&(t.datasource.options.ogcFilters.pushButtons&&(t.currentPushButtonsGroup=t.datasource.options.ogcFilters.pushButtons.groups.find(o=>o.enabled)||t.datasource.options.ogcFilters.pushButtons.groups[0]),t.datasource.options.ogcFilters.checkboxes&&(t.currentCheckboxesGroup=t.datasource.options.ogcFilters.checkboxes.groups.find(o=>o.enabled)||t.datasource.options.ogcFilters.checkboxes.groups[0]),t.datasource.options.ogcFilters.radioButtons&&(t.currentRadioButtonsGroup=t.datasource.options.ogcFilters.radioButtons.groups.find(o=>o.enabled)||t.datasource.options.ogcFilters.radioButtons.groups[0]),t.datasource.options.ogcFilters.select&&(t.currentSelectGroup=t.datasource.options.ogcFilters.select.groups.find(o=>o.enabled)||t.datasource.options.ogcFilters.select.groups[0],t.getSelectEnabled(),yield t.getSelectDomValues()),t.datasource.options.ogcFilters.autocomplete&&(t.currentAutocompleteGroup=t.datasource.options.ogcFilters.autocomplete.groups.find(o=>o.enabled)||t.datasource.options.ogcFilters.autocomplete.groups[0],t.getAutocompleteEnabled(),yield t.getAutocompleteDomValues()),t.applyFilters()),t.form.get("pushButtonsGroup").valueChanges.pipe((0,ae.b)(750)).subscribe(()=>{t.onPushButtonsChangeGroup(),t.applyFilters()}),t.form.get("checkboxesGroup").valueChanges.pipe((0,ae.b)(750)).subscribe(()=>{t.onCheckboxesChangeGroup(),t.applyFilters()}),t.form.get("radioButtonsGroup").valueChanges.pipe((0,ae.b)(750)).subscribe(()=>{t.onRadioButtonsChangeGroup(),t.applyFilters()}),t.form.get("selectGroup").valueChanges.pipe((0,ae.b)(750)).subscribe(()=>{t.onSelectChangeGroup(),t.applyFilters()}),t.form.get("autocompleteGroup").valueChanges.pipe((0,ae.b)(750)).subscribe(()=>{t.onAutocompleteChangeGroup(),t.applyFilters()}),t.form.get("pushButtons").valueChanges.pipe((0,ae.b)(750)).subscribe(()=>{t.applyFilters()}),t.form.get("radioButtons").valueChanges.pipe((0,ae.b)(750)).subscribe(()=>{t.applyFilters()})})()}getSelectEnabled(){const t=[];let o;this.currentSelectGroup.computedSelectors.forEach(i=>{i.multiple?(i.selectors?.forEach(s=>{s.enabled&&t.push(s)}),this.selectEnableds=t,this.form.controls.selectMulti.setValue(t)):(i.selectors?.forEach(s=>{s.enabled&&(o=s)}),this.form.controls.select.reset(o),this.selectEnabled$.subscribe(s=>{this.form.controls.select.value!==s&&this.form.controls.select.setValue(s)}),this.selectEnabled=o)})}getAutocompleteEnabled(){let t;this.currentAutocompleteGroup.computedSelectors.forEach(o=>{o.selectors?.forEach(i=>{i.enabled&&(t=i.title,this.form.controls.autocomplete.setValue({id:i.filters.expression,value:i.title}))}),this.autocompleteEnabled=t})}getToolTip(t){let o;return t.tooltip&&(o=Array.isArray(t.tooltip)?t.tooltip.join("\n"):t.tooltip),o||""}getSelectDomValues(){var t=this;return(0,Ne.Z)(function*(){for(const o of t.datasource.options.ogcFilters.select.bundles)if(o.domSelectors){let i;for(const s of o.domSelectors){let a;for(const l of t.configService.getConfig("dom"))(s.id===l.id||s.name===l.name)&&(a={id:l.id,url:l.url,name:l.name,values:l.values});if(i=a.url?yield t.domService.getDom(a):a.values,i){let c,l=o;l.selectors=[];for(const u of i){if(o.multiple){let p;p=!!t.selectEnableds?.find(d=>d.title===u.value),c={title:u.value,enabled:p,filters:{operator:s.operator,propertyName:s.propertyName,expression:u.id}}}else c={title:u.value,enabled:t.selectEnabled?.title===u.value,filters:{operator:s.operator,propertyName:s.propertyName,expression:u.id}};l.selectors.push(c)}t.getSelectGroups().find(u=>u.ids.includes(l.id)).computedSelectors.find(u=>u.title===l.title).selectors=l.selectors}}t.getSelectEnabled()}})()}getAutocompleteDomValues(){var t=this;return(0,Ne.Z)(function*(){for(const o of t.datasource.options.ogcFilters.autocomplete.bundles)if(o.domSelectors){let i;for(const s of o.domSelectors){let a;for(const l of t.configService.getConfig("dom"))(s.id===l.id||s.name===l.name)&&(a={id:l.id,url:l.url,name:l.name,values:l.values});if(i=a.url?yield t.domService.getDom(a):a.values,i){let c,l=o;l.selectors=[];for(const u of i)c={title:u.value,enabled:!(!t.autocompleteEnabled||t.autocompleteEnabled!==u.value),filters:{operator:s.operator,propertyName:s.propertyName,expression:u.id}},l.selectors.push(c);t.getAutocompleteGroups().find(u=>u.ids.includes(l.id)).computedSelectors.find(u=>u.title===l.title).selectors=l.selectors}}t.filteredOgcAutocomplete[o.id]=new ue.y,t.cdRef.detectChanges(),t.filteredOgcAutocomplete[o.id]=t.form.controls.autocomplete.valueChanges.pipe((0,I.U)(s=>{if(s.length)return i?.filter(a=>{const l=s?s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return a.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(l)})}))}})()}getButtonColor(t){let o;return t.color&&t.enabled&&(o={"background-color":`rgba(${t.color})`}),o}bundleIsVertical(t){return!!t.vertical&&t.vertical}onPushButtonsChangeGroup(){this.getPushButtonsGroups().map(t=>t.enabled=!1),this.getPushButtonsGroups().find(t=>t===this.currentPushButtonsGroup).enabled=!0}onCheckboxesChangeGroup(){this.getCheckboxesGroups().map(t=>t.enabled=!1),this.getCheckboxesGroups().find(t=>t===this.currentCheckboxesGroup).enabled=!0}onRadioButtonsChangeGroup(){this.getRadioButtonsGroups().map(t=>t.enabled=!1),this.getRadioButtonsGroups().find(t=>t===this.currentRadioButtonsGroup).enabled=!0}onSelectChangeGroup(){this.getSelectGroups().map(t=>t.enabled=!1),this.getSelectGroups().find(t=>t===this.currentSelectGroup).enabled=!0}onAutocompleteChangeGroup(){this.getAutocompleteGroups().map(t=>t.enabled=!1),this.getAutocompleteGroups().find(t=>t===this.currentAutocompleteGroup).enabled=!0}onSelectionChange(t,o){clearTimeout(this.applyFiltersTimeout),"radioButton"===o&&this.emptyRadioButtons(),t&&(t.enabled=!t.enabled),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}emptyRadioButtons(){this.currentRadioButtonsGroup.computedSelectors.forEach(t=>{t.selectors.map(o=>o.enabled=!1),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)})}emptySelect(){this.selectEnabled=void 0}emptyAutocomplete(){this.autocompleteEnabled=void 0,this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}toggleAllSelection(){if(this.selectAllSelected){const t=[];this.currentSelectGroup.computedSelectors.forEach(o=>{o.selectors?.forEach(i=>{t.push(i)})}),this.sel.options.forEach(o=>o.select()),this.selectEnableds=t}else this.sel.options.forEach(t=>t.deselect()),this.selectEnableds=[]}selectOptionClick(t,o,i){if(o.multiple){const s=this.selectEnableds;let a=!0;if(this.sel.options.forEach(l=>{l.selected||(a=!1)}),this.selectAllSelected=a,i.isUserInput)if(s.length){for(const l of s)if(l.title===t.title){if(l.enabled&&t.enabled){s.splice(s.indexOf(l),1),this.selectEnableds=s;break}}else if(s.indexOf(l)===s.length-1){s.push(t),this.selectEnableds=s;break}}else s.push(t),this.selectEnableds=s}else this.selectEnabled=t}autocompleteOptionClick(t){this.autocompleteEnabled=t.value}displayFn(t){return t?t.value:void 0}applyFilters(){let t="";const o=[],i=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];for(const s of i)s.computedSelectors&&s.computedSelectors.map(a=>{const l=[];a.selectors?.filter(c=>!0===c.enabled).forEach(c=>l.push(c.filters)),l.length>=1&&o.push(1===l.length?l[0]:{logical:a.logical,filters:l})});this.isTemporalOperator()&&this._currentFilter.active&&o.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),o.length>=1&&(t=this.ogcFilterWriter.buildFilter(1===o.length?o[0]:{logical:"And",filters:o})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}isMoreResults(t,o){let i=0;for(const a of t.selectors)i++;return i>("radio"===o?this.radioButtonsIndex:this.checkboxesIndex)}displayMoreResults(t){"radio"===t?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}isLessResults(t,o){let i=0;for(const a of t.selectors)i++;return this.baseIndex!==("radio"===o?this.radioButtonsIndex:this.checkboxesIndex)&&i>this.baseIndex}displayLessResults(t){"radio"===t?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}isTemporalOperator(){return this.currentFilter?.operator?.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}changeProperty(t,o,i=!0){const s=this.detectProperty(o);s&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(a=>a.filterid===this.currentFilter.filterid)[s]=t,i&&this.applyFilters())}detectProperty(t){switch(this.currentFilter.operator){case D.PropertyIsNotEqualTo:case D.PropertyIsEqualTo:case D.PropertyIsGreaterThan:case D.PropertyIsGreaterThanOrEqualTo:case D.PropertyIsLessThan:case D.PropertyIsLessThanOrEqualTo:return"expression";case D.PropertyIsLike:return"pattern";case D.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case D.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}static \u0275fac=function(o){return new(o||n)(e.Y36(La),e.Y36(_.QS),e.Y36(cr),e.Y36(N),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(o,i){if(1&o&&e.Gf(u1,5),2&o){let s;e.iGM(s=e.CRH())&&(i.sel=s.first)}},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},features:[e._Bn([cr])],decls:3,vars:3,consts:[[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["notMulti",""],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click"],["svgIcon","filter-remove"],["formControlName","selectMulti",3,"multiple","placeholder"],["selection",""],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange","change"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"width",4,"ngIf"],["matInput","","type","text","formControlName","autocomplete",1,"autocomplete",3,"matAutocomplete","placeholder"],["autocomplete",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete","autocomplete",""],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty"]],template:function(o,i){1&o&&(e.TgZ(0,"form",0),e.YNc(1,K1,6,5,"div",1),e.qZA(),e.YNc(2,e0,5,4,"div",2)),2&o&&(e.Q6J("formGroup",i.form),e.xp6(1),e.Q6J("ngForOf",i.ogcFiltersSelectors),e.xp6(1),e.Q6J("ngIf",i.isTemporalOperator()))},styles:["[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}[_nghost-%COMP%]   .checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}[_nghost-%COMP%]   .groupsSelector[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:unset;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]     .material-tooltip{white-space:pre-wrap}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%], [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     label, [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin:7px;text-align:left}[_nghost-%COMP%]   u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:unset}"]})}return n})(),Ma=(()=>{class n{defaultStepMillisecond=6e4;constructor(){}step(t,o){return t.options.stepDate?t.options.stepDate:o.step}stepMillisecond(t,o){const i=E().duration(this.step(t,o)).asMilliseconds();return 0===i?this.defaultStepMillisecond:i}stepIsYearDuration(t){const o=E().duration(t);return 0!==o.years()&&0===o.months()&&0===o.weeks()&&0===o.days()&&0===o.hours()&&0===o.minutes()}stepIsMonthDuration(t){const o=E().duration(t);return 0!==o.months()&&0===o.weeks()&&0===o.days()&&0===o.hours()&&0===o.minutes()}stepIsWeekDuration(t){const o=E().duration(t);return 0!==o.weeks()&&7===o.days()&&0===o.hours()&&0===o.minutes()}stepIsDayDuration(t){const o=E().duration(t);return 0!==o.days()&&0===o.hours()&&0===o.minutes()}stepIsHourDuration(t){const o=E().duration(t);return 0!==o.hours()&&0===o.minutes()}stepIsMinuteDuration(t){return 0!==E().duration(t).minutes()}dateToNumber(t){let o=new Date;return t&&(o=new Date(t)),o.getTime()}addStep(t,o){return E()(t).add(o,"milliseconds").toDate()}subtractStep(t,o){return E()(t).subtract(o,"milliseconds").toDate()}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})(),t0=(()=>{class n{ogcFilterTimeService;currentFilter;begin;max;datasource;changeProperty=new e.vpe;slider;interval;sliderValue=1;calculatedStep=0;_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderInterval=2e3;playIcon="play-circle";resetIcon="replay";get sliderInterval(){return void 0===this.currentFilter.sliderInterval?this._defaultSliderInterval:this.currentFilter.sliderInterval}get displayFormat(){return this.currentFilter.sliderOptions?.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}get beginMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.begin)}get maxMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.max)}get stepMillisecond(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}constructor(t){this.ogcFilterTimeService=t,this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}ngOnInit(){this.calculateStep(),this.handleSliderInput({value:1})}sliderDisplayWith(t){let o=new Date(this.beginMillisecond+(t-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=E().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();o=E()(this.beginMillisecond).add((t-1)*i,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=E().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();o=E()(this.beginMillisecond).add((t-1)*i,"month").toDate()}return E()(o).format(this.displayFormat)}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(o=>{if(this.slider.step<this.calculatedStep){const s="_emitInputEvent";this.slider._increment(1),this.slider[s]()}else this.stopFilter()},this.sliderInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}resetFilter(t){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle",this.slider.step=1,this.slider._emitInputEvent()}handleSliderInput(t){if(t)if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const o=E().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),i=E()(this.beginMillisecond).add((t.value-1)*o,"year").toDate(),s=E()(i).add(o,"year").toDate();this.changeProperty.next({value:E()(i).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:E()(s).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const o=E().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),i=E()(this.beginMillisecond).add((t.value-1)*o,"month").toDate(),s=E()(i).add(o,"month").toDate();this.changeProperty.next({value:E()(i).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:E()(s).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const o=new Date(this.beginMillisecond+this.stepMillisecond*(t.value-1));this.changeProperty.next({value:o.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(o.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}calculateStep(){for(let t=1;this.maxMillisecond-(this.beginMillisecond+t*this.stepMillisecond)>=-1;t++)this.calculatedStep=t}static \u0275fac=function(o){return new(o||n)(e.Y36(Ma))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(o,i){if(1&o&&e.Gf(fo.pH,5),2&o){let s;e.iGM(s=e.CRH())&&(i.slider=s.first)}},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},decls:9,vars:7,consts:[[1,"slider-container"],["id","time-slider","thumbLabel","",3,"step","min","max","ngModel","displayWith","ngModelChange"],["ngSlider",""],["matSliderThumb","",3,"input"],["ngSliderThumb","matSliderThumb"],["mat-icon-button","","color","primary",3,"click"],[3,"svgIcon"]],template:function(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",0)(1,"mat-slider",1,2),e.NdJ("ngModelChange",function(l){return i.sliderValue=l}),e.TgZ(3,"input",3,4),e.NdJ("input",function(){e.CHM(s);const l=e.MAs(4),c=e.MAs(2);return e.KtG(i.handleSliderInput({source:l,parent:c,value:l.value}))}),e.qZA()(),e.TgZ(5,"button",5),e.NdJ("click",function(l){return i.playFilter(l)}),e._UZ(6,"mat-icon",6),e.qZA(),e.TgZ(7,"button",5),e.NdJ("click",function(l){return i.resetFilter(l)}),e._UZ(8,"mat-icon",6),e.qZA()()}2&o&&(e.xp6(1),e.Q6J("step",1)("min",1)("max",i.calculatedStep)("ngModel",i.sliderValue)("displayWith",i.sliderDisplayWith),e.xp6(5),e.Q6J("svgIcon",i.playIcon),e.xp6(2),e.s9C("svgIcon",i.resetIcon))},dependencies:[_.JJ,_.On,w.Hw,S.RK,fo.pH,fo.$5],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .datetime-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{margin-left:10px}"]})}return n})();const o0=["endDatepickerTime"],n0=["beginDatepickerTime"],r0=["beginTime"],s0=["endTime"];function a0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",4),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.sliderMode=i)})("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.modeChange(i))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngModel",t.sliderMode),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function l0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"igo-ogc-filter-time-slider",6),e.NdJ("changeProperty",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changePropertyByPass(i))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("begin",t.beginValue)("max",t.restrictedToStep()?t.maxDate:t.endValue)("currentFilter",t.currentFilter)("datasource",t.datasource)}}function c0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"input",11),e.NdJ("change",function(i){e.CHM(t);const s=e.MAs(8),a=e.oxw(2);return e.KtG(a.yearOnlyInputChange(i,s,"begin"))}),e.qZA(),e._UZ(6,"mat-datepicker-toggle",12),e.TgZ(7,"mat-datepicker",13,14),e.NdJ("yearSelected",function(i){e.CHM(t);const s=e.MAs(8),a=e.oxw(2);return e.KtG(a.yearSelected(i,s,"begin"))}),e.qZA(),e._UZ(9,"input",15,16),e.qZA(),e.TgZ(11,"mat-form-field",10)(12,"mat-label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"input",11),e.NdJ("change",function(i){e.CHM(t);const s=e.MAs(18),a=e.oxw(2);return e.KtG(a.yearOnlyInputChange(i,s,"end"))}),e.qZA(),e._UZ(16,"mat-datepicker-toggle",12),e.TgZ(17,"mat-datepicker",13,17),e.NdJ("yearSelected",function(i){e.CHM(t);const s=e.MAs(18),a=e.oxw(2);return e.KtG(a.yearSelected(i,s,"end"))}),e.qZA(),e._UZ(19,"input",15,18),e.qZA(),e.TgZ(21,"div",19)(22,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.resetFilter())}),e.ALo(23,"translate"),e._UZ(24,"mat-icon",21),e.qZA(),e.TgZ(25,"mat-slide-toggle",22),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.toggleFilterState())}),e.ALo(26,"translate"),e.qZA()()()}if(2&n){const t=e.MAs(8),o=e.MAs(18),i=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,27,"igo.geo.timeFilter.startYear")),e.xp6(2),e.s9C("value",i.onlyYearBegin),e.Q6J("disabled",i.filterStateDisable),e.xp6(1),e.Q6J("for",t)("disabled",i.filterStateDisable),e.xp6(1),e.Q6J("startView",i.calendarView())("startAt",i.beginValue),e.xp6(2),e.Q6J("matDatepicker",t)("value",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("min",i.handleDate(i.datasource.options.minDate))("max",i.endValue&&!i.restrictedToStep()?i.endValue:i.handleDate(i.datasource.options.maxDate)),e.xp6(4),e.Oqu(e.lcZ(14,29,"igo.geo.timeFilter.endYear")),e.xp6(2),e.s9C("value",i.onlyYearEnd),e.Q6J("disabled",i.filterStateDisable),e.xp6(1),e.Q6J("for",o)("disabled",i.filterStateDisable),e.xp6(1),e.Q6J("startView",i.calendarView())("startAt",i.endValue),e.xp6(2),e.Q6J("matDatepicker",o)("value",i.endValue?i.endValue:i.handleDate(i.datasource.options.maxDate))("min",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("max",i.handleDate(i.datasource.options.maxDate)),e.xp6(3),e.Q6J("matTooltip",e.lcZ(23,31,"igo.geo.filter.resetFilters"))("disabled",i.filterStateDisable),e.xp6(2),e.s9C("svgIcon",i.resetIcon),e.xp6(1),e.Q6J("matTooltip",e.lcZ(26,33,"igo.geo.filter.toggleFilterState"))("checked",!i.filterStateDisable)}}function u0(n,r){if(1&n&&(e.TgZ(0,"mat-option",37),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function p0(n,r){if(1&n&&(e.TgZ(0,"mat-option",37),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function d0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const i=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(i.value,1))}),e.YNc(6,u0,2,2,"mat-option",35),e.qZA()(),e.TgZ(7,"mat-form-field",36)(8,"mat-label"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const i=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(i.value,1))}),e.YNc(12,p0,2,2,"mat-option",35),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(3),e.Oqu(e.lcZ(4,8,"igo.geo.timeFilter.hour")),e.xp6(2),e.Q6J("formControl",t.beginHourFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.beginHours),e.xp6(3),e.Oqu(e.lcZ(10,10,"igo.geo.timeFilter.minute")),e.xp6(2),e.Q6J("formControl",t.beginMinuteFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.beginMinutes)}}function g0(n,r){if(1&n&&(e.TgZ(0,"mat-option",37),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function m0(n,r){if(1&n&&(e.TgZ(0,"mat-option",37),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function h0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const i=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(i.value,2))}),e.YNc(6,g0,2,2,"mat-option",35),e.qZA()(),e.TgZ(7,"mat-form-field",36)(8,"mat-label"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(t),e.oxw();const i=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(i.value,2))}),e.YNc(12,m0,2,2,"mat-option",35),e.qZA()()()}if(2&n){const t=e.oxw(4);e.xp6(3),e.Oqu(e.lcZ(4,8,"igo.geo.timeFilter.hour")),e.xp6(2),e.Q6J("formControl",t.endHourFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.endHours),e.xp6(3),e.Oqu(e.lcZ(10,10,"igo.geo.timeFilter.minute")),e.xp6(2),e.Q6J("formControl",t.endMinuteFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.endMinutes)}}function f0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",24)(1,"mat-form-field",25),e._UZ(2,"mat-datepicker-toggle",12),e.TgZ(3,"input",26,38),e.NdJ("dateChange",function(){e.CHM(t);const i=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(i.value,2))}),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"span",28),e.TgZ(7,"mat-datepicker",29,17),e.NdJ("yearSelected",function(i){e.CHM(t);const s=e.MAs(8),a=e.oxw(3);return e.KtG(a.yearSelected(i,s,"end"))})("monthSelected",function(i){e.CHM(t);const s=e.MAs(8),a=e.oxw(3);return e.KtG(a.monthSelected(i,s,"end"))}),e.qZA()(),e.YNc(9,h0,13,12,"div",30),e.qZA()}if(2&n){const t=e.MAs(8),o=e.oxw(3);e.xp6(2),e.Q6J("for",t)("disabled",o.filterStateDisable),e.xp6(1),e.Q6J("matDatepicker",t)("placeholder",e.lcZ(5,13,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",o.filterEndFunction)("value",o.endValue?o.endValue:o.handleDate(o.datasource.options.maxDate))("min",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("max",o.handleDate(o.datasource.options.maxDate))("disabled",o.filterStateDisable),e.uIk("disabled",!o.currentFilter.active),e.xp6(4),e.Q6J("startView",o.calendarView())("startAt",o.endValue),e.xp6(2),e.Q6J("ngIf","datetime"===o.calendarType())}}function _0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",23)(1,"div",24)(2,"mat-form-field",25),e._UZ(3,"mat-datepicker-toggle",12),e.TgZ(4,"input",26,27),e.NdJ("dateChange",function(){e.CHM(t);const i=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(i.value,1))}),e.ALo(6,"translate"),e.qZA(),e._UZ(7,"span",28),e.TgZ(8,"mat-datepicker",29,14),e.NdJ("yearSelected",function(i){e.CHM(t);const s=e.MAs(9),a=e.oxw(2);return e.KtG(a.yearSelected(i,s,"begin"))})("monthSelected",function(i){e.CHM(t);const s=e.MAs(9),a=e.oxw(2);return e.KtG(a.monthSelected(i,s,"begin"))}),e.qZA()(),e.YNc(10,d0,13,12,"div",30),e.qZA(),e.YNc(11,f0,10,15,"div",31),e.TgZ(12,"div",19)(13,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.resetFilter())}),e.ALo(14,"translate"),e._UZ(15,"mat-icon",21),e.qZA(),e.TgZ(16,"mat-slide-toggle",22),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.toggleFilterState())}),e.ALo(17,"translate"),e.qZA()()()}if(2&n){const t=e.MAs(9),o=e.oxw(2);e.xp6(3),e.Q6J("for",t)("disabled",o.filterStateDisable),e.xp6(1),e.Q6J("matDatepicker",t)("placeholder",e.lcZ(6,19,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",o.filterBeginFunction)("value",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("min",o.handleDate(o.datasource.options.minDate))("max",o.endValue&&!o.restrictedToStep()?o.endValue:o.handleDate(o.datasource.options.maxDate))("disabled",o.filterStateDisable),e.uIk("disabled",!o.currentFilter.active),e.xp6(4),e.Q6J("startView",o.calendarView())("startAt",o.beginValue),e.xp6(2),e.Q6J("ngIf","datetime"===o.calendarType()),e.xp6(1),e.Q6J("ngIf",!o.restrictedToStep()),e.xp6(2),e.Q6J("matTooltip",e.lcZ(14,21,"igo.geo.filter.resetFilters"))("disabled",o.filterStateDisable),e.xp6(2),e.s9C("svgIcon",o.resetIcon),e.xp6(1),e.Q6J("matTooltip",e.lcZ(17,23,"igo.geo.filter.toggleFilterState"))("checked",!o.filterStateDisable)}}function y0(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,c0,27,35,"div",7),e.YNc(2,_0,18,25,"div",8),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.calendarTypeYear),e.xp6(1),e.Q6J("ngIf","year"!==t.calendarType())}}let Ia=(()=>{class n{ogcFilterTimeService;datasource;currentFilter;changeProperty=new e.vpe;beginHours;endHours;beginMinutes;endMinutes;beginHourFormControl=new _.p4;beginMinuteFormControl=new _.p4;endHourFormControl=new _.p4;endMinuteFormControl=new _.p4;_beginValue;_endValue;_defaultMin="1900-01-01";_defaultMax="2052-01-06";_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderModeEnabled=!0;ogcFilterOperator=D;sliderMode=!1;defaultStepMillisecond=6e4;options;onlyYearBegin;onlyYearEnd;calendarTypeYear=!1;resetIcon="replay";filterStateDisable;endDatepickerTime;beginDatepickerTime;beginTime;endTime;get step(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}get stepMilliseconds(){const t=E().duration(this.step).asMilliseconds();return 0===t?this.defaultStepMillisecond:t}set beginValue(t){this._beginValue=t}get beginValue(){return this._beginValue}set endValue(t){this._endValue=t}get endValue(){return this._endValue}get sliderInterval(){return void 0===this.currentFilter.sliderInterval?2e3:this.currentFilter.sliderInterval}get maxDate(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}get displayFormat(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}filterBeginFunction;filterEndFunction;constructor(t){this.ogcFilterTimeService=t}ngOnInit(){this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=void 0!==this.currentFilter.sliderOptions.enabled?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues(),this.dateFilter(this.filterBeginFunction,"begin"),this.dateFilter(this.filterEndFunction,"end")}parseFilter(t){if(!t)return new Date;if(isNaN(new Date(t).getTime())){if(t.search("now")>=0){const o=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const i=parseInt(t.substring(t.search("+")+1,o.index),10);return E()().add(i,o[0]).toDate()}if(t.match(/\-/)){const i=parseInt(t.substring(t.search("-")+1,o.index),10);return E()().subtract(i,o[0]).toDate()}return new Date}if(t.search("today")>=0){const o=E()().endOf("day").toDate(),i=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const s=parseInt(t.substring(t.search("+")+1,i.index),10);return E()(o).add(s,i[0]).toDate()}if(t.match(/\-/)){const s=parseInt(t.substring(t.search("-")+1,i.index),10);return E()(o).subtract(s,i[0]).toDate()}return o}return new Date}return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):t?new Date(t):new Date}changeTemporalProperty(t,o,i=!0){let s=this.getDateTime(t,o);if(this.isCalendarYearMode()){let a;return 1===o?(this.beginValue=t,this.onlyYearBegin=this.beginValue.getFullYear(),a=`${this.onlyYearBegin}-01-01`):(this.endValue=t,this.onlyYearEnd=this.endValue.getFullYear(),a=`${this.onlyYearEnd}-01-01`),void this.changeProperty.next({value:a,pos:o,refreshFilter:i})}2===o&&"date"===this.calendarType()&&!this.sliderMode&&(s=E()(s).endOf("day").toDate()),1===o?(this.beginValue=s,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(s,this.stepMilliseconds),2,i)):this.endValue=s,this.updateHoursMinutesArray(),this.changeProperty.next({value:s.toISOString(),pos:o,refreshFilter:i})}handleDate(t){if(t&&""!==t)return"string"==typeof t&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):new Date(t)}calendarType(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}isCalendarYearMode(){return"year"===this.calendarType()}yearOnlyInputChange(t,o,i){const a=this.getDateFromStringWithoutTime(t.target.value);this.yearSelected(a,o,i)}yearSelected(t,o,i,s=!0){this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(o&&o.close(),"end"===i?t=E()(t).endOf("year").toDate():"begin"===i&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===i?1:2,s))}monthSelected(t,o,i,s=!0){this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(o&&o.close(),"end"===i?t=E()(t).endOf("month").toDate():"begin"===i&&this.restrictedToStep()&&this.monthSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===i?1:2,s))}calendarView(){const t=this.stepMilliseconds,o=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":t<864e5&&o<864e5?"clock":"month"}dateFilter(t,o){const i=new Date(o),s=i.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){const a=E()(i).diff(E()(this.handleMin()),"years",!0);if("end"===t){const l=E()(i).add(1,"d"),c=E()(l).diff(E()(this.handleMin()),"years",!0);return void(this.filterEndFunction=c%E().duration(this.step).asYears()==0)}if("begin"===t)return void(this.filterBeginFunction=a%E().duration(this.step).asYears()==0)}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){const a=E()(i).diff(E()(this.handleMin()),"months",!0);if("end"===t){const l=E()(i).add(1,"d"),c=E()(l).diff(E()(this.handleMin()),"months",!0);return void(this.filterEndFunction=c%E().duration(this.step).asMonths()==0)}if("begin"===t)return void(this.filterBeginFunction=a%E().duration(this.step).asMonths()==0)}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){const a=E()(i).diff(E()(this.handleMin()),"weeks",!0);if("end"===t){const l=E()(i).add(1,"d"),c=E()(l).diff(E()(this.handleMin()),"weeks",!0);return void(this.filterEndFunction=c%E().duration(this.step).asWeeks()==0)}if("begin"===t)return void(this.filterBeginFunction=a%E().duration(this.step).asWeeks()==0)}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){const a=E()(i).diff(E()(this.handleMin()),"days",!0);if("end"===t){const l=E()(i).add(1,"d"),u=E()(l).diff(E()(this.handleMin()),"days",!0)%E().duration(this.step).asDays();return void(this.filterEndFunction=u<1e-7&&u>-1e-7||0===u)}if("begin"===t){const l=a%E().duration(this.step).asDays()+1;return void(this.filterBeginFunction=l<1e-7&&l>-1e-7&&0!==l||1===l)}}else if(this.ogcFilterTimeService.stepIsHourDuration(this.step)){if("end"===t){const a=E()(i).diff(E()(this.handleMin()),"hours",!0);return void(this.filterEndFunction=a%E().duration(this.step).asHours()==0)}if("begin"===t){const a=E()(i).diff(E()(this.handleMin()),"hours",!0);return void(this.filterBeginFunction=a%E().duration(this.step).asHours()==0)}}else if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step)){if("end"===t)return void(this.filterEndFunction=!0);if("begin"===t)return void(this.filterBeginFunction=!0)}this.filterEndFunction=s%this.stepMilliseconds==0,this.filterBeginFunction=s%this.stepMilliseconds==0}getDateTime(t,o){const i=new Date(t);let s;if(!this.sliderMode)switch(o){case 1:if(this.currentFilter.calendarModeYear){s=i.setHours(0,0);break}s=i.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break;case 2:if(this.currentFilter.calendarModeYear){s=i.setHours(0,0);break}s=i.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value)}return new Date(s||i)}handleMinuteIncrement(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3==60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}handleHourIncrement(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}fullBeginHoursArray(t){this.beginHours=Array.from(t?{length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1}:{length:23/this.handleHourIncrement()+1},(o,i)=>0+i*this.handleHourIncrement()),this.beginHourFormControl.setValue(this.beginValue.getHours())}fullEndHoursArray(t){this.endHours=t?Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},(o,i)=>this.beginHourFormControl.value+i*this.handleHourIncrement()):Array.from({length:23/this.handleHourIncrement()+1},(o,i)=>0+i*this.handleHourIncrement()),this.endHourFormControl.setValue(this.endValue.getHours())}fullBeginMinutesArray(t){this.beginMinutes=Array.from(t?{length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1}:{length:59/this.handleMinuteIncrement()+1},(o,i)=>0+i*this.handleMinuteIncrement()),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}fullEndMinutesArray(t){this.endMinutes=t?Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},(o,i)=>this.beginMinuteFormControl.value+i*this.handleMinuteIncrement()):Array.from({length:59/this.handleMinuteIncrement()+1},(o,i)=>0+i*this.handleMinuteIncrement()),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}updateHoursMinutesArray(){const t=new Date(this.beginValue),o=new Date(this.endValue);t.setHours(0,0)===o.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}updateValues(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}restrictedToStep(){return!!this.currentFilter.restrictToStep&&this.currentFilter.restrictToStep}handleMin(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}handleMax(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}changePropertyByPass(t){this.changeProperty.next(t)}modeChange(t){t.checked||this.updateValues()}setFilterStateDisable(){this.filterStateDisable=!!this.currentFilter&&!this.currentFilter.active,"datetime"===this.calendarType()&&(!0===this.filterStateDisable?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}getDateFromStringWithoutTime(t){let o,i="01",s="01";if(10===t.length){const a=t.split("-");if(3!==a.length)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");o=a[0],i=a[1],s=a[2]}else{if(4!==t.length)return new Date(t);o=t}return new Date(`${o}-${i}-${s} 00:00:00`)}resetFilter(){let o,i,s,a,t=this.datasource.options.ogcFilters.filters;this.calendarTypeYear?(a="today"===t.end?`${(new Date).toLocaleDateString("en-CA").substring(0,4)}-01-01`:`${t.end.substring(0,4)}-01-01`,s=`${t.begin.substring(0,4)}-01-01`,o=this.getDateFromStringWithoutTime(s),i=this.getDateFromStringWithoutTime(a)):(o=this.parseFilter(t.begin),i=this.parseFilter(t.end),s=o.toISOString(),a=i.toISOString()),(this.currentFilter.begin!==s||this.currentFilter.end!==a)&&(this.beginValue=o,this.endValue=i,this.updateValues())}toggleFilterState(){this.currentFilter.active=!0!==this.currentFilter.active,this.setFilterStateDisable(),this.updateValues()}static \u0275fac=function(o){return new(o||n)(e.Y36(Ma))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filter-time"]],viewQuery:function(o,i){if(1&o&&(e.Gf(o0,5),e.Gf(n0,5),e.Gf(r0,5),e.Gf(s0,5)),2&o){let s;e.iGM(s=e.CRH())&&(i.endDatepickerTime=s.first),e.iGM(s=e.CRH())&&(i.beginDatepickerTime=s.first),e.iGM(s=e.CRH())&&(i.beginTime=s.first),e.iGM(s=e.CRH())&&(i.endTime=s.first)}},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},decls:4,vars:3,consts:[[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModel","ngModelChange","change"],[1,"slider-container"],[3,"begin","max","currentFilter","datasource","changeProperty"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],["subscriptSizing","dynamic",1,"year-input"],["matInput","",1,"year-input-only-year",3,"value","disabled","change"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"startView","startAt","yearSelected"],["beginDatepicker",""],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],["beginYear",""],["endDatepicker",""],["endYear",""],[1,"actions-container"],["mat-icon-button","","color","primary",1,"reset-button",3,"matTooltip","disabled","click"],[3,"svgIcon"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"matTooltip","checked","change"],[1,"datetime-input-container"],[1,"datetime-input"],["subscriptSizing","dynamic",1,"date-input"],["matInput","",3,"matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled","dateChange"],["begin",""],[1,"filler"],[3,"startView","startAt","yearSelected","monthSelected"],["class","time-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"time-input"],["subscriptSizing","dynamic",1,"hour-input"],[3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic",1,"minute-input"],[3,"value"],["end",""]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.YNc(1,a0,3,4,"mat-slide-toggle",1),e.YNc(2,l0,2,4,"div",2),e.YNc(3,y0,3,2,"div",3),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",null==i.currentFilter.sliderOptions?null:i.currentFilter.sliderOptions.enabled),e.xp6(1),e.Q6J("ngIf",i.sliderMode),e.xp6(1),e.Q6J("ngIf",!i.sliderMode))},styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:154px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:4px}}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:last-child){margin-right:4px}[_nghost-%COMP%]   .year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}[_nghost-%COMP%]   .year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px;text-align:left!important}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-arrow{display:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-period-button{pointer-events:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}"]})}return n})();function b0(n,r){if(1&n&&e._UZ(0,"igo-ogc-filter-selection",2),2&n){const t=e.oxw();e.Q6J("refreshFilters",t.refreshFunc)("datasource",t.datasource)("map",t.map)("currentFilter",t.currentFilter)}}function v0(n,r){if(1&n&&e._UZ(0,"igo-ogc-filter-form",4),2&n){const t=r.$implicit,o=e.oxw(2);e.Q6J("currentFilter",t)("refreshFilters",o.refreshFunc)("datasource",o.datasource)("map",o.map)}}function C0(n,r){if(1&n&&e.YNc(0,v0,1,4,"ng-template",3),2&n){const t=e.oxw();e.Q6J("ngForOf",t.datasource.options.ogcFilters.interfaceOgcFilters)}}let Wu=(()=>{class n{datasource;map;refreshFilters;get refreshFunc(){return this.refreshFilters}get advancedOgcFilters(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}get currentFilter(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}color="primary";constructor(){}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},features:[e._Bn([{provide:se.PG,useValue:{overlayPanelClass:"igo-overlay-panel-width"}},{provide:Je.j,useValue:{overlayPanelClass:"igo-overlay-panel-width"}}])],decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(o,i){1&o&&(e.YNc(0,b0,1,4,"igo-ogc-filter-selection",0),e.YNc(1,C0,1,1,null,1)),2&o&&(e.Q6J("ngIf",!i.advancedOgcFilters),e.xp6(1),e.Q6J("ngIf",i.advancedOgcFilters&&i.datasource.options.ogcFilters.editable))},styles:[".igo-overlay-panel-width{min-width:-moz-fit-content;min-width:fit-content}\n\n/*# sourceMappingURL=ogc-filterable-form.component.ts-angular-inline--1.css.map*/"]})}return n})();function x0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-icon",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleFiltersCollapsed())}),e.qZA()}if(2&n){const t=e.oxw(),o=e.MAs(8);e.Q6J("target",o)("collapsed",t.filtersCollapsed)}}const S0=function(n){return{cursor:n}};function w0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"span",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleLegendOnClick())}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngStyle",e.VKq(3,S0,t.filtersCollapsed?"default":"pointer"))("matTooltip",t.layer.title),e.xp6(1),e.hij(" ",t.layer.title," ")}}function T0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addFilterToSequence())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",13),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.addFilterDisabled())("matTooltip",e.lcZ(1,3,"igo.geo.filter.addFilter"))("color",t.color)}}const F0=function(n){return{disabled:n}};function O0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.layer.visible=!i.layer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",15),e.ALo(4,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,4,"igo.geo.layer.hideLayer"):e.lcZ(2,6,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("ngClass",e.VKq(10,F0,!1===e.lcZ(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function A0(n,r){if(1&n&&e._UZ(0,"igo-layer-legend",19),2&n){const t=e.oxw(2);e.Q6J("layer",t.layer)}}function L0(n,r){if(1&n&&(e.TgZ(0,"div",16,17),e.YNc(2,A0,1,1,"igo-layer-legend",18),e.ALo(3,"async"),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",e.lcZ(3,1,t.showLegend$))}}function M0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"section",20),e._UZ(1,"mat-divider"),e.TgZ(2,"mat-checkbox",21),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changeOgcFilterType(i))})("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.datasource.options.ogcFilters.advancedOgcFilters=i)}),e._uU(3),e.ALo(4,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.datasource.options.ogcFilters.advancedOgcFilters),e.xp6(1),e.hij(" ",e.lcZ(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}const I0=function(n){return{"separate-item":n}};let Bn=(()=>{class n{ogcFilterService;color="primary";lastRunOgcFilter;defaultLogicalParent=D.And;hasActiveSpatialFilter=!1;filtersAreEditable=!0;filtersCollapsed=!0;hasSelector=!1;showLegend$=new y.X(!1);inResolutionRange$=new y.X(!0);resolution$$;ogcFilterWriter;layer;map;header=!0;get refreshFunc(){return this.refreshFilters.bind(this)}get datasource(){return this.layer.dataSource}constructor(t){this.ogcFilterService=t,this.ogcFilterWriter=new Jt}ngOnInit(){this.layer.visible&&(this.filtersCollapsed=!1);const t=this.datasource.options.ogcFilters;switch((t.pushButtons&&t.pushButtons.bundles.length>0||t.checkboxes&&t.checkboxes.bundles.length>0||t.radioButtons&&t.radioButtons.bundles.length>0||t.select&&t.select.bundles.length>0||t.autocomplete&&t.autocomplete.bundles.length>0)&&(void 0===t.advancedOgcFilters&&(t.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}t&&(t.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(t.interfaceOgcFilters)),t.interfaceOgcFilters.filter(i=>i.wkt_geometry).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!t.editable&&t.editable),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}addFilterToSequence(){this.filtersCollapsed=!1;const o=this.datasource.options.ogcFilters.interfaceOgcFilters||[],i=0===o.length?0:o[o.length-1].level;let s="";const a=this.datasource.options.sourceFields.filter(d=>!d.excludeFromOgcFilters);let l;a.length>0&&(s=void 0===a[0].name?"":a[0].name);const c=this.datasource.options;c.fieldNameGeometry?l=c.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(l=this.datasource.options.paramsWFS.fieldNameGeometry);const u=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,s,this.datasource.options.ogcFilters.allowedOperatorsType),p=Object.keys(u)[0];o.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:s,operator:p,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},l,i,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=o}refreshFilters(t){!0===t&&(this.lastRunOgcFilter=void 0);const o=this.datasource.options.ogcFilters,i=o.interfaceOgcFilters?o.interfaceOgcFilters.filter(s=>!0===s.active):[];if(0===i.length&&(o.filters=void 0,o.filtered=!1),i.length>1&&(i[0].parentLogical=i[1].parentLogical),this.hasActiveSpatialFilter=0!==i.filter(s=>-1!==["Contains","Intersects","Within"].indexOf(s.operator)).length,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(i)){if("wfs"===this.layer.dataSource.options.type)this.layer.dataSource.options.ogcFilters.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(i),this.layer.dataSource.ol.refresh();else if("wms"===this.layer.dataSource.options.type&&o.enabled){let s="";if(i.length>=1){const a=this.layer.dataSource,l=a.options.ogcFilters;l.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(i),s=this.ogcFilterWriter.buildFilter(l.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,a.options)}this.ogcFilterService.filterByOgc(this.datasource,s),this.datasource.options.ogcFilters.filtered=0!==i.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(i))}this.layer.dataSource.setOgcFilters(o,!0)}setVisible(){this.layer.visible=!0}isAdvancedOgcFilters(){return this.datasource.options.ogcFilters.advancedOgcFilters}addFilterDisabled(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length}changeOgcFiltersAdvancedOgcFilters(t){this.datasource.options.ogcFilters.advancedOgcFilters=t}changeOgcFilterType(t){this.changeOgcFiltersAdvancedOgcFilters(t.checked),t.checked&&this.refreshFilters(!0)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(o){return new(o||n)(e.Y36(La))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},decls:12,vars:12,consts:[[3,"ngClass"],["class","igo-chevron","matListItemIcon","","igoCollapse","","svgIcon","chevron-up",3,"target","collapsed","click",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["matListItemMeta",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["ogcFilters",""],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["matListItemIcon","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click"],["svgIcon","plus"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],[3,"ngModel","change","ngModelChange"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"mat-list-item"),e.YNc(2,x0,1,2,"mat-icon",1),e.YNc(3,w0,2,5,"span",2),e.TgZ(4,"div",3),e.YNc(5,T0,3,5,"button",4),e.YNc(6,O0,5,12,"button",5),e.qZA()(),e.TgZ(7,"div",null,6),e.YNc(9,L0,4,3,"div",7),e._UZ(10,"igo-ogc-filterable-form",8),e.YNc(11,M0,5,4,"section",9),e.qZA()()),2&o&&(e.Q6J("ngClass",e.VKq(10,I0,!0===i.header)),e.xp6(2),e.Q6J("ngIf",i.header),e.xp6(1),e.Q6J("ngIf",i.header),e.xp6(2),e.Q6J("ngIf",i.isAdvancedOgcFilters()&&i.filtersAreEditable),e.xp6(1),e.Q6J("ngIf",i.header),e.xp6(3),e.Q6J("ngIf",i.header),e.xp6(1),e.Q6J("datasource",i.datasource)("map",i.map)("refreshFilters",i.refreshFunc),e.xp6(1),e.Q6J("ngIf",i.hasSelector&&i.filtersAreEditable))},styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}[_nghost-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   .separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}[_nghost-%COMP%]     .mdc-list-item__start, [_nghost-%COMP%]     .mdc-list-item__end, [_nghost-%COMP%]     .mdc-list-item__content{pointer-events:auto}"]})}return n})();function Z0(n,r){1&n&&(e.TgZ(0,"div",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.filter.noFilterableLayer")," "))}function P0(n,r){if(1&n&&e._UZ(0,"igo-ogc-filterable-item",4),2&n){const t=r.$implicit;e.Q6J("header",!0)("layer",t)("map",t.map)}}let Jr=(()=>{class n{layers;map;constructor(){}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(o,i){1&o&&(e.TgZ(0,"igo-list",0),e.YNc(1,Z0,3,3,"div",1),e.ALo(2,"filterableDataSource"),e.YNc(3,P0,1,3,"ng-template",2),e.ALo(4,"filterableDataSource"),e.qZA()),2&o&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngIf",0===e.xi3(2,4,i.layers,"ogc").length),e.xp6(2),e.Q6J("ngForOf",e.xi3(4,7,i.layers,"ogc")))},styles:["#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}"],changeDetection:0})}return n})(),Xu=(()=>{class n{transform(t,o){let i;return"time"===o&&(i=t.filter(s=>{const a=s.dataSource;return this.isTimeFilterable(a)&&void 0!==a.options.timeFilter&&Object.keys(a.options.timeFilter).length})),"ogc"===o&&(i=t.filter(s=>this.isOgcFilterable(s.dataSource))),i}isTimeFilterable(t){return"wms"===t.options.type&&t.options.timeFilterable}isOgcFilterable(t){let o=!1;return t.options.ogcFilters&&t.options.ogcFilters.enabled&&t.options.ogcFilters.editable&&(o=!0),t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete)&&(o=!0),o}static \u0275fac=function(o){return new(o||n)};static \u0275pipe=e.Yjl({name:"filterableDataSource",type:n,pure:!0})}return n})();var be=function(n){return n.Predefined="Predefined",n.Polygon="Polygon",n.Point="Point",n}(be||{}),Ft=function(n){return n.Address="Address",n.Thematics="Thematics",n}(Ft||{});let en=(()=>{class n{http;languageService;configService;baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/";urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"};constructor(t,o,i){this.http=t,this.languageService=o,this.configService=i,this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}getKeyByValue(t,o){return Object.keys(t).find(i=>t[i]===o)}loadFilterList(t){if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe((0,I.U)(i=>i.features.map(s=>(s.meta={id:s.properties.code},s))))}loadThematicsList(){const o=[];return this.http.get(this.baseUrl+"types").pipe((0,I.U)(i=>(i.forEach(s=>{if(s.startsWith("lieux")){const a={name:void 0,source:s};let l=s.substring(6,s.length),c=l;if(l.includes(".")){const u=l.indexOf(".");c=l.substring(u+1,l.length),l=l.substring(0,u)}try{a.name=this.languageService.translate.instant("igo.geo.terrapi."+c)}catch{a.name=c.substring(0,1).toUpperCase()+c.substring(1,c.length-1)}try{a.group=this.languageService.translate.instant("igo.geo.spatialFilter.group."+l)}catch{a.group=l.substring(0,1).toUpperCase()+l.substring(1,c.length-1)}o.push(a)}else if(this.getKeyByValue(this.urlFilterList,s)){const a={name:void 0,source:s},l=this.getKeyByValue(this.urlFilterList,s);try{a.name=this.languageService.translate.instant("igo.geo.terrapi."+l)}catch{a.name=l.substring(0,1).toUpperCase()+l.substring(1,l.length-1)}a.source=s,o.push(a)}}),o)))}loadFilterItem(t,o,i,s,a){if(i){const c=this.baseUrl+this.urlFilterList[i];let u="";return o===Ft.Address?(u="adresses",this.http.get(c+"/"+t.properties.code+"/"+u,{params:{geometry:"true",icon:"true",bufferInput:a.toString(),simplified:"100"}}).pipe((0,I.U)(p=>p.features.map(d=>(d.meta={id:d.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:d.icon},d))))):(u=s.source,this.http.get(c+"/"+t.properties.code+"/"+u,{params:{geometry:"true",icon:"true",bufferInput:a.toString(),simplified:"100"}}).pipe((0,I.U)(p=>p.features.map(d=>(d.meta={id:d.properties.code,title:s.name,icon:d.icon},d)))))}{const l=this.baseUrl+"locate";return o===Ft.Address?this.http.post(l+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:a.toString(),simplified:"100"}).pipe((0,I.U)(u=>u.features.map(p=>(p.meta={id:p.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:p.icon},p)))):this.http.post(l+"?type="+s.source,{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:a.toString(),simplified:"100"}).pipe((0,I.U)(u=>u.features.map(p=>(p.meta={id:p.properties.code,title:s.name,icon:p.icon},p))))}}loadItemById(t,o){const i=this.urlFilterList[o],s="/"+t.properties.code;if(i&&s)return this.http.get(this.baseUrl+i+s,{params:{geometry:"true"}}).pipe((0,I.U)(a=>(a.meta={id:a.properties.code,alias:a.properties.nom,title:a.properties.nom},a)))}loadBufferGeometry(t,o,i,s){if(o!==be.Predefined)return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:i,loc:JSON.stringify(t)}).pipe((0,I.U)(a=>a));{const a=this.urlFilterList[s],l="/"+t.properties.code;if(a&&l)return this.http.get(this.baseUrl+a+l,{params:{geometry:"100",bufferOutput:i.toString()}}).pipe((0,I.U)(c=>(c.meta={id:c.properties.code,alias:c.properties.nom,title:c.properties.nom},c)))}}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(L),e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ep=(()=>{class n{constructor(){}filterByDate(t,o){let i,s,a,l;if(Array.isArray(o)){const u=[];o[0]&&(a=this.reformatDateTime(o[0]),u.push(o[0])),o[1]&&(l=this.reformatDateTime(o[1]),u.push(o[1])),2===u.length&&a!==l&&(i=t instanceof Fn?a+","+l:a+"/"+l),a===l&&(i=a)}else o&&(s=this.reformatDateTime(o),i=s);t.ol.updateParams({TIME:i}),t instanceof xo&&t.setTimeFilter(t.timeFilter,!0)}filterByYear(t,o){let i,s,a;if(Array.isArray(o)){const c=[];o[0]&&(s=o[0],c.push(o[0])),o[1]&&(a=o[1],c.push(o[1])),2===c.length&&s!==a&&(i=t instanceof Fn?s+","+a:s+"/"+a),s===a&&(i=s)}else i=o;t.ol.updateParams({TIME:i}),t instanceof xo&&t.setTimeFilter(t.timeFilter,!0)}reformatDateTime(t){const o=t.getFullYear();let i=t.getMonth()+1,s=t.getUTCDate(),a=t.getUTCHours(),l=t.getUTCMinutes();return Number(i)<10&&(i="0"+i),Number(s)<10&&(s="0"+s),Number(a)<10&&(a="0"+a),Number(l)<10&&(l="0"+l),o+"-"+i+"-"+s+"T"+a+":"+l+":00Z"}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();var $0=v(86747);let tn=(()=>{class n{transform(t,o){const i=[];return Object.getOwnPropertyNames(t).forEach(s=>i.push({key:s,value:t[s]})),i}static \u0275fac=function(o){return new(o||n)};static \u0275pipe=e.Yjl({name:"keyvalue",type:n,pure:!0})}return n})();function D0(n,r){if(1&n&&(e.TgZ(0,"td"),e._UZ(1,"mat-icon",7),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.s9C("svgIcon",t.icon)}}function E0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td")(1,"a",8),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.copyTextToClipboard(i.value))}),e._UZ(5,"mat-icon",10),e.qZA()()}if(2&n){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.s9C("href",t.value,e.LSH),e.xp6(1),e.AsE(" ",e.lcZ(3,3,"igo.geo.targetHtmlUrl")," ",o.title,"")}}function R0(n,r){if(1&n&&(e.TgZ(0,"td",11),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.key," ")}}function N0(n,r){if(1&n&&e._UZ(0,"td",12),2&n){const t=e.oxw().$implicit;e.Q6J("innerHTML",t.value,e.oJD)}}const tp=function(){return{cursor:"pointer",color:"blue"}};function B0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td")(1,"u",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openSecureUrl(i.value))}),e._uU(2),e.qZA()()}if(2&n){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngStyle",e.DdM(2,tp)),e.xp6(1),e.Oqu(o.getEmbeddedLinkText(t.value))}}function J0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td")(1,"u",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openSecureUrl(i.value))}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.copyTextToClipboard(i.value))}),e._UZ(5,"mat-icon",10),e.qZA()()}2&n&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,tp)),e.xp6(1),e.Oqu(e.lcZ(3,2,"igo.geo.targetHtmlUrl")))}function U0(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td")(1,"a",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openSecureUrl(i.value))}),e._UZ(2,"img",15),e.ALo(3,"async"),e.ALo(4,"secureImage"),e.qZA()()}if(2&n){const t=e.oxw().$implicit;e.xp6(1),e.s9C("href",t.value,e.LSH),e.xp6(1),e.s9C("src",e.lcZ(3,2,e.lcZ(4,4,t.value)),e.LSH)}}function G0(n,r){if(1&n&&(e._UZ(0,"td",12),e.ALo(1,"json")),2&n){const t=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,t.value),e.oJD)}}function q0(n,r){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,D0,2,1,"td",4),e.YNc(2,E0,6,5,"td",4),e.YNc(3,R0,2,1,"td",5),e.YNc(4,N0,1,1,"td",6),e.YNc(5,B0,3,3,"td",4),e.YNc(6,J0,6,5,"td",4),e.YNc(7,U0,5,6,"td",4),e.YNc(8,G0,2,3,"td",6),e.qZA()),2&n){const t=r.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf","_blank"===o.feature.properties.target&&"url"===t.key),e.xp6(1),e.Q6J("ngIf","_blank"===o.feature.properties.target&&"url"===t.key),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&!o.isObject(t.value)&&!o.isUrl(t.value)&&!o.isEmbeddedLink(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&o.isEmbeddedLink(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&!o.isObject(t.value)&&(o.isDoc(t.value)||o.isUrl(t.value))&&!o.isImg(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&!o.isObject(t.value)&&o.isUrl(t.value)&&o.isImg(t.value)),e.xp6(1),e.Q6J("ngIf",void 0===o.feature.properties.target&&o.isObject(t.value))}}function j0(n,r){if(1&n&&(e.TgZ(0,"table",2)(1,"tbody"),e.YNc(2,q0,9,8,"tr",3),e.ALo(3,"keyvalue"),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,t.filterFeatureProperties(t.feature)))}}function Q0(n,r){if(1&n&&e._UZ(0,"iframe",16),2&n){const t=e.oxw();e.Q6J("srcdoc",t.htmlSanitizer(t.feature.properties),e.oJD)("src",t.urlSanitizer(t.feature.properties.url),e.uOi)}}let Jn=(()=>{class n{http;cdRef;sanitizer;networkService;messageService;configService;state;unsubscribe$=new fe.x;ready=!1;get source(){return this._source}set source(t){this._source=t,this.cdRef.detectChanges()}map;toolbox;get feature(){return this._feature}set feature(t){this._feature=t,this.cdRef.detectChanges(),this.selectFeature.emit()}_feature;_source;routeEvent=new e.vpe;selectFeature=new e.vpe;htmlDisplayEvent=new e.vpe;get title(){return ho(this.feature)}get icon(){return mr(this.feature)||"link"}constructor(t,o,i,s,a,l){this.http=t,this.cdRef=o,this.sanitizer=i,this.networkService=s,this.messageService=a,this.configService=l,this.networkService.currentState().pipe((0,ko.R)(this.unsubscribe$)).subscribe(c=>{this.state=c})}ngOnInit(){this.ready=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}urlSanitizer(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}isHtmlDisplay(){return this.feature&&this.isObject(this.feature.properties)&&"iframe"===this.feature.properties.target?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}htmlSanitizer(t){if(t.body){if(!/<base href="[\w:\/\.]+">/.test(t.body)){const i=new URL(t.url,window.location.origin);t.body=t.body.replace("<head>",`<head><base href="${i.origin}">`)}return this.sanitizer.bypassSecurityTrustHtml(t.body)}}isObject(t){return"object"==typeof t}openSecureUrl(t){let o;const i=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');if(i.test(t))o=t.match(i)[0],this.http.get(o,{responseType:"blob"}).subscribe(a=>{const l=URL.createObjectURL(a);window.open(l,"_blank"),this.cdRef.detectChanges()},a=>{this.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{let a=t;if(this.isEmbeddedLink(t)){var s=document.createElement("div");s.innerHTML=t,a=s.children[0].getAttribute("href")}window.open(a,"_blank")}}isUrl(t){if("string"==typeof t)return/^https?:\/\//.test(t)}isDoc(t){if("string"==typeof t)return!!this.isUrl(t)&&/(pdf|docx?|xlsx?)$/.test(t.toLowerCase())}isImg(t){if("string"==typeof t)return!!this.isUrl(t)&&/(jpe?g|png|gif)$/.test(t.toLowerCase())}isEmbeddedLink(t){return"string"==typeof t&&1===(t.match(/<a/g)||[]).length}getEmbeddedLinkText(t){let i=t.match(/(?:>).*?(?=<|$)/)[0];return i=i.replace(/>/g,""),i}filterFeatureProperties(t){const o=t.meta?t.meta.alias:void 0,i={};let s;return this.map&&this.map.forcedOffline$.pipe((0,ko.R)(this.unsubscribe$)).subscribe(a=>{s=a}),t.properties&&t.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete t.properties.Route,o?(Object.keys(o).forEach(a=>{i[o[a]]=t.properties[a]}),i):(void 0!==s&&s?t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(l=>{delete t.properties[l]}):this.state.connection&&t.meta&&t.meta.excludeAttribute?t.meta.excludeAttribute.forEach(l=>{delete t.properties[l]}):!this.state.connection&&t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(l=>{delete t.properties[l]}),t.properties)}copyTextToClipboard(t){At.copy(t)&&this.messageService.success("igo.geo.query.link.message")}static \u0275fac=function(o){return new(o||n)(e.Y36($.eN),e.Y36(e.sBO),e.Y36($t.H7),e.Y36(nr),e.Y36(_e),e.Y36(N))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["matListItemIcon","",3,"svgIcon"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["svgIcon","content-copy"],["id","keyValue"],[3,"innerHTML"],[3,"ngStyle","click"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(o,i){1&o&&(e.YNc(0,j0,4,3,"table",0),e.YNc(1,Q0,1,2,"iframe",1)),2&o&&(e.Q6J("ngIf",i.ready&&i.feature&&i.isObject(i.feature.properties)&&"iframe"!==i.feature.properties.target),e.xp6(1),e.Q6J("ngIf",i.isHtmlDisplay()))},dependencies:[f.sg,f.O5,f.PC,w.Hw,Qs,f.Ov,f.Ts,O.X$,tn,zo],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}"],changeDetection:0})}return n})();const Un="Layer";var so=function(n){return n.Length="length",n.Area="area",n}(so||{}),K=function(n){return n.Meters="meters",n.Kilometers="kilometers",n.Miles="miles",n.Feet="feet",n}(K||{});const wo={[K.Meters]:"m",[K.Kilometers]:"km",[K.Miles]:"mi",[K.Feet]:"ft"};var je=function(n){return n.SquareMeters="squareMeters",n.SquareKilometers="squareKilometers",n.SquareMiles="squareMiles",n.SquareFeet="squareFeet",n.Hectares="hectares",n.Acres="acres",n}(je||{});const ri={[je.SquareMeters]:"m\xb2",[je.SquareKilometers]:"km\xb2",[je.SquareMiles]:"mi\xb2",[je.SquareFeet]:"ft\xb2",[je.Hectares]:"ha",[je.Acres]:"ac"};var op=v(17553);function Y0(n){return.001*n}function H0(n){return 3.2808*n}function V0(n){return 621e-6*n}function z0(n){return 1e-6*n}function K0(n){return 3.861e-7*n}function W0(n){return 10.764*n}function X0(n){return 1e-4*n}function eC(n){return 24711e-8*n}function si(n,r){const o=new Map([[K.Meters,i=>i],[K.Kilometers,Y0],[K.Miles,V0],[K.Feet,H0]]).get(r);return o?o(n):void 0}function Zi(n,r){const o=new Map([[je.SquareMeters,i=>i],[je.SquareKilometers,z0],[je.SquareMiles,K0],[je.SquareFeet,W0],[je.Hectares,X0],[je.Acres,eC]]).get(r);return o?o(n):void 0}function Gn(n,r,t){let o=r.decimal;(void 0===o||o<0)&&(o=1);const i=[];return i.push(void 0!==r.locale?n.toLocaleString(r.locale,{minimumFractionDigits:o,maximumFractionDigits:o}):n.toFixed(o).toString()),void 0!==r.unit&&!0===r.unitAbbr&&i.push(t?t.translate.instant(wo[r.unit]?"igo.geo.measure."+wo[r.unit]:"igo.geo.measure."+ri[r.unit]):wo[r.unit]||ri[r.unit]),i.filter(s=>void 0!==s).join(" ")}function Za(){return new J.ZP({stroke:new U.Z({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new q.Z({color:"rgba(255, 255, 255, 0.2)"}),image:new Te.Z({radius:5,stroke:new U.Z({color:"#ffcc33"}),fill:new q.Z({color:"rgba(255, 255, 255, 0.2)"})})})}function on(n,r){if(!(n instanceof Ee.Z)&&0!==n.getFlatCoordinates().length)return(0,Hi.xA)(n,{projection:r})}function qn(n,r){if(!(n instanceof Ee.Z||n instanceof ro.Z)&&0!==n.getFlatCoordinates().length)return(0,Hi.bg)(n,{projection:r})}function Pa(n,r){const t=on(n,r),o=qn(n,r),i=[],s=n.getFlatCoordinates(),a=s.length;for(let l=0;l<=a-4;l+=2){const c=new ro.Z([[s[l],s[l+1]],[s[l+2],s[l+3]]]);i.push(on(c,r))}return{area:o,length:t,lengths:i}}function ip(n){let r;if(n instanceof Ee.Z){const t=new Ee.Z(n.getFlatCoordinates());r=new Array(1),r[0]=t}else{r=np(n);const t=n.getFlatCoordinates(),o=r.length;for(let i=0;i<o;i++){const s=2*i,l=new ro.Z([[t[s],t[s+1]],[t[s+2],t[s+3]]]).getCoordinateAt(.5),c=r[i];void 0!==c?c.setCoordinates(l):r[i]=new Ee.Z(l)}}return r}function np(n){let r;r=n instanceof ii.Z?0:Math.max(n.getFlatCoordinates().length/2-1,0);let t=n.get("_midpoints");if(void 0===t)return t=new Array(n instanceof Ee.Z?1:r),n.set("_midpoints",t,!0),t;if(0===r||r===t.length)return t;if(r>t.length)return t.push(...new Array(r-t.length)),t;for(let o=r;o<t.length;o++){const i=t[r];void 0!==i&&rp(i)}return t.splice(r),t}function rp(n){const r=n.get("_tooltip");if(void 0!==r){const t=r.getMap();void 0!==t&&t.removeOverlay(r)}}function Ur(n){const r=[].concat(function rC(n){return np(n).map(t=>t?t.get("_tooltip"):void 0)}(n)||[]),t=function lC(n){const r=n.get("_center");return r?r.get("_tooltip"):void 0}(n);return void 0!==t&&r.push(t),r}function sp(n,r=!1,t=""){const o=new op.Z({element:document.createElement("div"),offset:[-30,-10],className:(r?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure",`igo-map-tooltip-measure-${t}segments`]).join(" "),stopEvent:!1});return o.setPosition(n.getFlatCoordinates()),n.set("_tooltip",o),o}var cC=v(8306);function ap(n){return new Te.Z({stroke:new U.Z({color:(n=n||[0,153,255]).concat([1]),width:2}),fill:new q.Z({color:n.concat([.2])}),radius:8})}function lp(){return new J.ZP({stroke:new U.Z({color:[0,153,255,1],width:2})})}function ka(n){const r=n.target;return r instanceof Rt.ZP?r.getFlatCoordinates().slice(-4,-2):r.getFlatCoordinates().slice(-2)}v(91007);var cp=v(52845),jn=v(98934),$a=v(31338),Da=v(56934);class Qn{options;start$=new fe.x;end$=new fe.x;changes$=new fe.x;modify$=new fe.x;select$=new fe.x;abort$=new fe.x;freehand$=new y.X(!1);ispredefinedRadius$=new y.X(!1);predefinedRadius$=new y.X(void 0);radiusDrawEnd$=new y.X(void 0);keyDown$$;olGeometryType;olInteractionStyle;olMap;olDrawingLayer;olDrawInteraction;olSelectInteraction;olModifyInteraction;onDrawStartKey;onDrawEndKey;onDrawAbortKey;onDrawKey;radius;mousePosition;get radiusVal(){return this.predefinedRadius$.getValue()}set radiusValData(r){this.predefinedRadius$.next(r)}get active(){return void 0!==this.olMap}get olDrawingLayerSource(){return this.olDrawingLayer.getSource()}constructor(r){this.options=r,this.olDrawingLayer=r.drawingLayer?r.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType,this.olInteractionStyle=this.options.interactionStyle}setOlMap(r,t){if(!r)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),void(this.olMap=r);this.olMap=r,this.addOlInnerOverlayLayer(),this.addOlInteractions(t)}getSource(){return this.olDrawingLayerSource}setOlInteractionStyle(r){this.olInteractionStyle=r}setGeometryType(r){this.olGeometryType=r}getGeometryType(){return this.olGeometryType}createOlInnerOverlayLayer(){return new ti.Z({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new Vt.Z,style:this.options.drawingLayerStyle,zIndex:500})}removeOlInnerOverlayLayer(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}addOlInnerOverlayLayer(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}clearOlInnerOverlaySource(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}addOlInteractions(r){let t;if(t=this.freehand$.getValue()?new jn.ZP("Point"===this.olGeometryType?{type:"Circle",source:this.getSource(),style:"function"==typeof this.olInteractionStyle?void 0:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}:{type:this.olGeometryType,source:this.getSource(),style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):this.ispredefinedRadius$.getValue()?new jn.ZP({type:"Point",source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}):new jn.ZP({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}),this.olMap.addInteraction(t),this.olDrawInteraction=t,this.onDrawStartKey=t.on("drawstart",o=>this.onDrawStart(o)),this.onDrawEndKey=t.on("drawend",o=>this.onDrawEnd(o)),this.onDrawAbortKey=t.on("drawabort",o=>this.abort$.next(o.feature.getGeometry())),r){const o=new $a.Z({source:this.getSource()});if(this.olMap.addInteraction(o),this.olModifyInteraction=o,!this.olSelectInteraction){const i=new Da.Z({condition:cp.OK,style:void 0});this.olMap.addInteraction(i),this.olSelectInteraction=i,this.olSelectInteraction.on("select",s=>this.onSelect(s))}}}removeOlInteractions(){this.unsubscribeKeyDown(),(0,Ke.B)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}onDrawStart(r){const t=r.feature.getGeometry();this.start$.next(t),this.clearOlInnerOverlaySource(),this.onDrawKey=t.on("change",o=>{this.mousePosition=ka(o),this.changes$.next(o.target)}),this.subscribeKeyDown()}onDrawEnd(r){"Point"===r.feature.getGeometry().getType()&&this.radiusDrawEnd$.next(this.predefinedRadius$.getValue()),this.unsubscribeKeyDown(),(0,Ke.B)(this.onDrawKey);const t=r.feature.getGeometry();t.on("change",()=>{this.modify$.next(t)}),this.end$.next(t)}onSelect(r){1===r.selected.length&&this.select$.next(r.selected[0])}subscribeKeyDown(){this.unsubscribeKeyDown(),this.keyDown$$=(0,go.R)(document,"keydown").subscribe(r=>{"Escape"!==r.key?("Backspace"===r.key&&this.olDrawInteraction.removeLastPoint(),"Enter"===r.key&&this.olDrawInteraction.finishDrawing()," "!==r.key||this.olMap.getView().animate({center:this.mousePosition,duration:100})):this.olDrawInteraction.abortDrawing()})}unsubscribeKeyDown(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}}var gC=v(5456),up=v(20510);class pp{options;start$=new fe.x;end$=new fe.x;changes$=new fe.x;olMap;olOverlayLayer;olModifyInteraction;onModifyStartKey;onModifyEndKey;onModifyKey;olModifyInteractionIsActive=!1;olTranslateInteraction;onTranslateStartKey;onTranslateEndKey;onTranslateKey;olTranslateInteractionIsActive=!1;olDrawInteraction;onDrawStartKey;onDrawEndKey;onDrawKey;olDrawInteractionIsActive=!1;mousePosition;keyDown$$;drawKeyUp$$;drawKeyDown$$;removedOlInteractions=[];olLinearRingsLayer;olOuterGeometry;get active(){return void 0!==this.olMap}get olOverlaySource(){return this.olOverlayLayer.getSource()}get olLinearRingsSource(){return this.olLinearRingsLayer.getSource()}modify=!0;translate=!0;constructor(r){this.options=r,void 0!==r.modify&&(this.modify=r.modify),void 0!==r.translate&&(this.translate=r.translate),this.olOverlayLayer=void 0!==r.layer?r.layer:this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}setOlMap(r){if(void 0===r)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=r);this.olMap=r,this.addOlInnerOverlayLayer(),!0===this.modify&&this.addOlDrawInteraction(),!0===this.translate&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),!0===this.modify&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}getSource(){return this.olOverlaySource}setOlGeometry(r){const t=new Ze.Z({geometry:r});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)}createOlInnerOverlayLayer(){return new ti.Z({source:this.options.source?this.options.source:new Vt.Z,style:this.options.layerStyle,zIndex:500})}addOlInnerOverlayLayer(){void 0===this.options.layer&&this.olMap.addLayer(this.olOverlayLayer)}removeOlInnerOverlayLayer(){void 0===this.options.layer&&void 0!==this.olMap&&this.olMap.removeLayer(this.olOverlayLayer)}clearOlInnerOverlaySource(){void 0===this.options.layer&&void 0===this.options.source&&this.olOverlaySource.clear(!0)}createOlLinearRingsLayer(){return new ti.Z({source:new Vt.Z,style:lp(),zIndex:500})}addOlLinearRingsLayer(){this.olMap.addLayer(this.olLinearRingsLayer)}removeOlLinearRingsLayer(){this.olMap.removeLayer(this.olLinearRingsLayer)}clearOlLinearRingsSource(){this.olLinearRingsSource.clear(!0)}addOlModifyInteraction(){const r=new $a.Z({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=r}removeOlModifyInteraction(){void 0!==this.olModifyInteraction&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}activateModifyInteraction(){!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",r=>this.onModifyStart(r)),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",r=>this.onModifyEnd(r)),this.olMap.addInteraction(this.olModifyInteraction))}deactivateModifyInteraction(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,(0,Ke.B)([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olModifyInteraction))}onModifyStart(r){const t=r.features.item(0).getGeometry();this.start$.next(t),this.onModifyKey=t.on("change",o=>{this.mousePosition=ka(o),this.changes$.next(o.target)}),this.subscribeToKeyDown()}onModifyEnd(r){(0,Ke.B)(this.onModifyKey),this.end$.next(r.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}subscribeToKeyDown(){this.keyDown$$=(0,go.R)(document,"keydown").subscribe(r=>{" "!==r.key||this.olMap.getView().animate({center:this.mousePosition,duration:0})})}unsubscribeToKeyDown(){void 0!==this.keyDown$$&&this.keyDown$$.unsubscribe()}addOlTranslateInteraction(){const r=new up.Z({layers:[this.olOverlayLayer]});this.olTranslateInteraction=r}removeOlTranslateInteraction(){void 0!==this.olTranslateInteraction&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}activateTranslateInteraction(){!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",r=>this.onTranslateStart(r)),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",r=>this.onTranslateEnd(r)),this.olMap.addInteraction(this.olTranslateInteraction))}deactivateTranslateInteraction(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,(0,Ke.B)([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olTranslateInteraction))}onTranslateStart(r){const t=r.features.item(0).getGeometry();this.start$.next(t),this.onTranslateKey=t.on("change",o=>{})}onTranslateEnd(r){(0,Ke.B)(this.onTranslateKey),this.end$.next(r.features.item(0).getGeometry())}addOlDrawInteraction(){const r=new jn.ZP({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:lp(),condition:t=>(this.olOuterGeometry||this.getOlGeometry()).intersectsCoordinate(t.coordinate)});this.olDrawInteraction=r,this.subscribeToDrawKeyDown()}subscribeToDrawKeyDown(){this.drawKeyDown$$=(0,go.R)(document,"keydown").subscribe(r=>{if("Control"!==r.key)return;this.unsubscribeToDrawKeyDown();const t=this.getOlGeometry();!t||!(t instanceof Rt.ZP)||(this.subscribeToDrawKeyUp(),this.deactivateModifyInteraction(),this.deactivateTranslateInteraction(),this.activateDrawInteraction())})}subscribeToDrawKeyUp(){this.drawKeyUp$$=(0,go.R)(document,"keyup").subscribe(r=>{"Control"===r.key&&(this.unsubscribeToDrawKeyUp(),this.unsubscribeToKeyDown(),this.deactivateDrawInteraction(),this.activateModifyInteraction(),!0===this.translate&&this.activateTranslateInteraction(),this.subscribeToDrawKeyDown(),this.olOuterGeometry=void 0,this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()))})}unsubscribeToDrawKeyDown(){void 0!==this.drawKeyDown$$&&this.drawKeyDown$$.unsubscribe()}unsubscribeToDrawKeyUp(){void 0!==this.drawKeyUp$$&&this.drawKeyUp$$.unsubscribe()}removeOlDrawInteraction(){void 0!==this.olDrawInteraction&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}activateDrawInteraction(){!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(r=>{r instanceof bu.Z&&(this.olMap.removeInteraction(r),this.removedOlInteractions.push(r))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",r=>this.onDrawStart(r)),this.onDrawEndKey=this.olDrawInteraction.on("drawend",r=>this.onDrawEnd(r)),this.olMap.addInteraction(this.olDrawInteraction))}deactivateDrawInteraction(){!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(r=>{this.olMap.addInteraction(r)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,(0,Ke.B)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olDrawInteraction))}onDrawStart(r){const t=r.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();const o=t.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(o),this.start$.next(this.getOlGeometry()),this.onDrawKey=t.on("change",i=>{this.mousePosition=ka(i);const a=i.target.getLinearRing(0).getCoordinates();this.updateLinearRingOfOlGeometry(a),this.changes$.next(this.getOlGeometry())}),this.subscribeToKeyDown()}onDrawEnd(r){(0,Ke.B)(this.onDrawKey),this.olOuterGeometry=void 0;const t=r.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(t),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}addLinearRingToOlGeometry(r){!function dC(n,r){n.appendLinearRing(r)}(this.getOlGeometry(),new gC.Z(r))}updateLinearRingOfOlGeometry(r){const t=this.getOlGeometry(),i=t.getLinearRings().slice(0,-1).map(s=>s.getCoordinates());i.push(r),t.setCoordinates(i)}getOlGeometry(){const r=this.olOverlaySource.getFeatures();return r.length>0?r[0].getGeometry():void 0}}function mC(n,r){if(1&n&&(e.TgZ(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),e._uU(4),e.ALo(5,"translate"),e.qZA()()(),e.TgZ(6,"tbody")(7,"tr")(8,"td"),e._uU(9),e.ALo(10,"measureFormat"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"tr")(15,"td"),e._uU(16),e.ALo(17,"measureFormat"),e.qZA(),e.TgZ(18,"td"),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"tr")(22,"td"),e._uU(23),e.ALo(24,"measureFormat"),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"tr")(29,"td"),e._uU(30),e.ALo(31,"measureFormat"),e.qZA(),e.TgZ(32,"td"),e._uU(33),e.ALo(34,"translate"),e.qZA()()()()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,9,"igo.geo.measure.dialog.length.title")," "),e.xp6(5),e.Oqu(e.xi3(10,11,t.data.length,t.measureLengthUnit.Meters)),e.xp6(3),e.Oqu(e.lcZ(13,14,"igo.geo.measure.dialog.lengthInMeters")),e.xp6(4),e.hij(" ",e.xi3(17,16,t.data.length,t.measureLengthUnit.Kilometers)," "),e.xp6(3),e.Oqu(e.lcZ(20,19,"igo.geo.measure.dialog.lengthInKilometers")),e.xp6(4),e.Oqu(e.xi3(24,21,t.data.length,t.measureLengthUnit.Miles)),e.xp6(3),e.Oqu(e.lcZ(27,24,"igo.geo.measure.dialog.lengthInMiles")),e.xp6(4),e.Oqu(e.xi3(31,26,t.data.length,t.measureLengthUnit.Feet)),e.xp6(3),e.Oqu(e.lcZ(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function hC(n,r){if(1&n&&(e.TgZ(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),e._uU(4),e.ALo(5,"translate"),e.qZA()()(),e.TgZ(6,"tbody")(7,"tr")(8,"td"),e._uU(9),e.ALo(10,"measureFormat"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"tr")(15,"td"),e._uU(16),e.ALo(17,"measureFormat"),e.qZA(),e.TgZ(18,"td"),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"tr")(22,"td"),e._uU(23),e.ALo(24,"measureFormat"),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"tr")(29,"td"),e._uU(30),e.ALo(31,"measureFormat"),e.qZA(),e.TgZ(32,"td"),e._uU(33),e.ALo(34,"translate"),e.qZA()(),e.TgZ(35,"tr")(36,"td"),e._uU(37),e.ALo(38,"measureFormat"),e.qZA(),e.TgZ(39,"td"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"tr")(43,"td"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"td"),e._uU(47),e.ALo(48,"measureFormat"),e.qZA()()()()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,13,"igo.geo.measure.dialog.area.title")," "),e.xp6(5),e.Oqu(e.xi3(10,15,t.data.area,t.measureAreaUnit.SquareMeters)),e.xp6(3),e.Oqu(e.lcZ(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),e.xp6(4),e.hij(" ",e.xi3(17,20,t.data.area,t.measureAreaUnit.SquareKilometers)," "),e.xp6(3),e.hij(" ",e.lcZ(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")," "),e.xp6(4),e.Oqu(e.xi3(24,25,t.data.area,t.measureAreaUnit.SquareMiles)),e.xp6(3),e.Oqu(e.lcZ(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),e.xp6(4),e.Oqu(e.xi3(31,30,t.data.area,t.measureAreaUnit.Acres)),e.xp6(3),e.Oqu(e.lcZ(34,33,"igo.geo.measure.dialog.areaInAcres")),e.xp6(4),e.Oqu(e.xi3(38,35,t.data.area,t.measureAreaUnit.Hectares)),e.xp6(3),e.Oqu(e.lcZ(41,38,"igo.geo.measure.dialog.areaInHectares")),e.xp6(4),e.Oqu(e.lcZ(45,40,"igo.geo.measure.dialog.perimeterInMeters")),e.xp6(3),e.Oqu(e.xi3(48,42,t.data.perimeter,t.measureLengthUnit.Meters))}}let dp=(()=>{class n{dialogRef;data;measureAreaUnit=je;measureLengthUnit=K;constructor(t,o){this.dialogRef=t,this.data=o}onNoClick(){this.dialogRef.close()}static \u0275fac=function(o){return new(o||n)(e.Y36(B.so),e.Y36(B.WI))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-measurer-dialog"]],decls:6,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function(o,i){1&o&&(e.TgZ(0,"h3",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1),e.YNc(4,mC,35,31,"table",2),e.YNc(5,hC,49,45,"table",2),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,3,"igo.geo.measure.dialog.title")),e.xp6(3),e.Q6J("ngIf",i.data.length>0),e.xp6(1),e.Q6J("ngIf",i.data.area>0))},styles:["[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}"]})}return n})();const fC=["table"];function _C(n,r){1&n&&e._UZ(0,"mat-divider")}function yC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleDisplayLines(i.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("checked",t.displayLines)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function bC(n,r){1&n&&e._UZ(0,"mat-divider")}function vC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleDisplayDistance(i.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("checked",t.displayDistance)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function CC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleDisplayAreas(i.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("checked",t.displayAreas)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function xC(n,r){1&n&&e._UZ(0,"mat-divider")}function SC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-measurer-item",14),e.NdJ("measureUnitChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onLengthUnitChange(i))}),e.ALo(1,"translate"),e.qZA()}if(2&n){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("measureType",o.measureType.Length)("measureUnit",o.measureLengthUnit.Meters)("measure",t.length)("auto",o.measureUnitsAuto)("placeholder",e.lcZ(1,5,o.activeMeasureType===o.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function wC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-measurer-item",14),e.NdJ("measureUnitChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onAreaUnitChange(i))}),e.ALo(1,"translate"),e.qZA()}if(2&n){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("measureType",o.measureType.Area)("measureUnit",o.measureAreaUnit.SquareMeters)("measure",t.area)("auto",o.measureUnitsAuto)("placeholder",e.lcZ(1,5,"igo.geo.measure.area"))}}function TC(n,r){if(1&n&&(e.ynx(0),e.YNc(1,SC,2,7,"igo-measurer-item",13),e.YNc(2,wC,2,7,"igo-measurer-item",13),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.activeMeasureType===t.measureType.Length||t.activeMeasureType===t.measureType.Area),e.xp6(1),e.Q6J("ngIf",t.activeMeasureType===t.measureType.Area)}}function FC(n,r){1&n&&e._UZ(0,"mat-divider")}function OC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onCalculateClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",16),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}function AC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onDeleteClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",18),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}let Ea=(()=>{class n{languageService;dialog;storageService;tableTemplate;subscriptions$$=[];measureType=so;measureAreaUnit=je;measureLengthUnit=K;measureUnitsAuto=!1;displayDistance=!0;displayLines=!0;displayAreas=!0;hasLine$=new y.X(!1);hasArea$=new y.X(!1);measure$=new y.X({});selectedFeatures$=new y.X([]);showTooltips=!0;drawControlIsDisabled=!0;drawLineControl;drawPolygonControl;modifyControl;activeOlGeometry;activeLengthUnit=K.Meters;activeAreaUnit=je.SquareMeters;onFeatureAddedKey;onFeatureRemovedKey;activeDrawControl;drawStart$$;drawEnd$$;drawChanges$$;modifyStart$$;modifyEnd$$;modifyChanges$$;selectedFeatures$$;olDrawSource=new Vt.Z;map;store;set activeMeasureType(t){this.setActiveMeasureType(t)}get activeMeasureType(){return this._activeMeasureType}_activeMeasureType;minSegmentLength=10;table;get drawControlIsActive(){return void 0!==this.activeDrawControl}get projection(){return this.map.ol.getView().getProjection().getCode()}constructor(t,o,i){this.languageService=t,this.dialog=o,this.storageService=i,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:s=>{const a=this.activeLengthUnit;return Gn(si(s.properties.measure.length,a),{decimal:1,unit:a,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:s=>{const a=this.activeAreaUnit,l=Zi(s.properties.measure.area,a);return l?Gn(l,{decimal:1,unit:a,unitAbbr:!1,locale:"fr"}):""}}]}}ngOnInit(){this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(so.Length)}ngOnDestroy(){this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(t=>t.unsubscribe())}onMeasureTypeChange(t){this.activeMeasureType=t}onToggleDrawControl(t){!0===t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleMeasureUnitsAuto(t){this.measureUnitsAuto=t}onToggleDisplayDistance(t){this.displayDistance=t,this.onDisplayDistance(),this.storageService.set("distanceToggle",!!t,Pe.SESSION)}onToggleDisplayLines(t){this.displayLines=t,this.onDisplayLines(),this.storageService.set("linesToggle",!!t,Pe.SESSION)}onToggleDisplayAreas(t){this.displayAreas=t,this.onDisplayAreas(),this.storageService.set("areasToggle",!!t,Pe.SESSION)}checkDistanceAreaToggle(){!1===this.storageService.get("distanceToggle")&&(this.displayDistance=!1),!1===this.storageService.get("linesToggle")&&(this.displayLines=!1),!1===this.storageService.get("areasToggle")&&(this.displayAreas=!1)}onDisplayDistance(){this.displayDistance?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments")).map(t=>t.classList.remove("igo-map-tooltip-hidden")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments")).map(t=>t.classList.add("igo-map-tooltip-hidden"))}onDisplayLines(){this.displayLines?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-line-segments")).map(t=>t.classList.remove("igo-map-tooltip-hidden")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-line-segments")).map(t=>t.classList.add("igo-map-tooltip-hidden"))}onDisplayAreas(){this.displayAreas?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-area")).map(t=>t.classList.remove("igo-map-tooltip-hidden")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-area")).map(t=>t.classList.add("igo-map-tooltip-hidden"))}onLengthUnitChange(t){this.activeLengthUnit=t,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onAreaUnitChange(t){this.activeAreaUnit=t,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onCalculateClick(){const t=this.selectedFeatures$.value,o=t.reduce((a,l)=>a+l.properties.measure.area||0,0),i=t.reduce((a,l)=>"Polygon"===l.geometry.type?a:a+l.properties.measure.length||0,0),s=t.reduce((a,l)=>"LineString"===l.geometry.type?a:a+l.properties.measure.length||0,0);this.openDialog({area:o,length:i,perimeter:s})}onDeleteClick(){this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.olDrawSource.getFeatures().forEach(o=>{const i=o.getGeometry();t.properties.id===i.ol_uid&&this.olDrawSource.removeFeature(o)})})}onModifyClick(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{const t=this.selectedFeatures$.value[0],i=this.store.layer.ol.getSource().getFeatures().find(s=>s.get("id")===t.properties.id);if(void 0!==i){this.deactivateDrawControl(),this.activateModifyControl();const s=i.getGeometry();this.clearTooltipsOfOlGeometry(s),this.modifyControl.setOlGeometry(s)}}}openDialog(t){this.dialog.open(dp,{data:t})}initStore(){const t=this.store,o=new xe({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:`igo-measures-${Ie()}`,zIndex:200,source:new Ae,style:new J.ZP({stroke:new U.Z({color:"#ffcc33",width:2}),fill:new q.Z({color:"rgba(255, 255, 255, 0.2)"})}),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}});oi(t,o),t.layer.visible=!0,o.visible$.subscribe(i=>{i?Array.from(document.getElementsByClassName("igo-map-tooltip-measure")).map(s=>s.classList.remove("igo-map-tooltip-measure-by-display")):Array.from(document.getElementsByClassName("igo-map-tooltip-measure")).map(s=>s.classList.add("igo-map-tooltip-measure-by-display"))}),Yi(t),ya(t,new Tt({map:this.map,many:!0})),this.onFeatureAddedKey=t.source.ol.on("addfeature",i=>{const s=i.feature,a=s.getGeometry();this.updateMeasureOfOlGeometry(a,s.get("measure")),this.onDisplayDistance()}),this.onFeatureRemovedKey=t.source.ol.on("removefeature",i=>{const s=i.feature.getGeometry();this.clearTooltipsOfOlGeometry(s)}),this.selectedFeatures$$=t.stateView.manyBy$(i=>!0===i.state.selected).pipe((0,Ci.T)(1)).subscribe(i=>{!0===this.modifyControl.active&&this.deactivateModifyControl(),this.selectedFeatures$.next(i.map(s=>s.entity))}),this.subscriptions$$.push(this.store.entities$.subscribe(i=>{i.find(s=>"Polygon"===s.geometry.type)?this.hasArea$.next(!0):this.hasArea$.next(!1),i.find(s=>"LineString"===s.geometry.type)?this.hasLine$.next(!0):this.hasLine$.next(!1)})),this.subscriptions$$.push(this.store.count$.subscribe(i=>{this.store.layer.options.showInLayerList=i>=1}))}freezeStore(){const t=this.store;this.selectedFeatures$$.unsubscribe(),(0,Ke.B)(this.onFeatureAddedKey),(0,Ke.B)(this.onFeatureRemovedKey),t.deactivateStrategyOfType(qt),t.deactivateStrategyOfType(Tt)}createDrawLineControl(){this.drawLineControl=new Qn({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:Za(),drawingLayerStyle:new J.ZP({})})}createDrawPolygonControl(){this.drawPolygonControl=new Qn({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:Za(),drawingLayerStyle:new J.ZP({})})}createModifyControl(){this.modifyControl=new pp({source:this.olDrawSource,drawStyle:Za(),layerStyle:new J.ZP({})})}toggleDrawControl(){this.deactivateDrawControl(),this.activeMeasureType===so.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===so.Area&&this.activateDrawControl(this.drawPolygonControl)}activateDrawControl(t){this.drawControlIsDisabled=!1,this.activeDrawControl=t,this.drawStart$$=t.start$.subscribe(o=>this.onDrawStart(o)),this.drawEnd$$=t.end$.subscribe(o=>this.onDrawEnd(o)),this.drawChanges$$=t.changes$.subscribe(o=>this.onDrawChanges(o)),this.drawChanges$$=t.abort$.subscribe(o=>{this.clearTooltipsOfOlGeometry(o),this.clearMeasures()}),t.setOlMap(this.map.ol,!1)}deactivateDrawControl(){void 0!==this.activeDrawControl&&(this.olDrawSource.clear(),void 0!==this.drawStart$$&&this.drawStart$$.unsubscribe(),void 0!==this.drawEnd$$&&this.drawEnd$$.unsubscribe(),void 0!==this.drawChanges$$&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),void 0!==this.activeOlGeometry&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}setActiveMeasureType(t){this._activeMeasureType=t,this.clearMeasures(),this.toggleDrawControl()}onDrawStart(t){this.activeOlGeometry=t}onDrawEnd(t){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(t),this.addFeatureToStore(t),this.clearTooltipsOfOlGeometry(t),this.olDrawSource.clear(!0)}onDrawChanges(t){const o=Pa(t,this.projection);this.updateMeasureOfOlGeometry(t,Object.assign({},o,{area:void 0})),this.measure$.next(o)}activateModifyControl(){const t=this.store.getStrategyOfType(Tt);t.deactivate(),t.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(o=>this.onModifyStart(o)),this.modifyEnd$$=this.modifyControl.end$.subscribe(o=>this.onModifyEnd(o)),this.modifyChanges$$=this.modifyControl.changes$.subscribe(o=>this.onModifyChanges(o)),this.modifyControl.setOlMap(this.map.ol)}deactivateModifyControl(){void 0!==this.modifyStart$$&&this.modifyStart$$.unsubscribe(),void 0!==this.modifyEnd$$&&this.modifyEnd$$.unsubscribe(),void 0!==this.modifyChanges$$&&this.modifyChanges$$.unsubscribe(),void 0!==this.activeOlGeometry&&(1===this.selectedFeatures$.value.length&&this.addFeatureToStore(this.activeOlGeometry,this.selectedFeatures$.value[0]),this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)),this.olDrawSource.clear(),this.store.activateStrategyOfType(Tt),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}onModifyStart(t){this.onDrawStart(t)}onModifyChanges(t){this.onDrawChanges(t)}onModifyEnd(t){this.finalizeMeasureOfOlGeometry(t)}finalizeMeasureOfOlGeometry(t){const o=Pa(t,this.projection);this.updateMeasureOfOlGeometry(t,o)}updateMeasureOfOlGeometry(t,o){t.setProperties({_measure:o},!0),this.updateTooltipsOfOlGeometry(t)}clearMeasures(){this.measure$.next({})}addFeatureToStore(t,o){const i=o?o.properties.id:t.ol_uid,s=this.map.ol.getView().getProjection(),a=(new Ce.Z).writeGeometryObject(t,{featureProjection:s,dataProjection:s});this.store.update({type:ie,geometry:a,projection:s.getCode(),properties:{id:i,measure:t.get("_measure")},meta:{id:i}})}updateTooltipsOfOlGeometry(t){const o=t.get("_measure"),i=o.lengths,s=o.area,a=function nC(n){const r=ip(n);let t="";return n instanceof ro.Z?t="line-":n instanceof Rt.ZP&&(t="polygone-"),r.map(i=>{let s=i.get("_tooltip");return void 0===s?s=sp(i,!1,t):s.setPosition(i.getFlatCoordinates()),s})}(t);if(i.length===a.length)for(let l=0;l<a.length;l++){const c=i[l];void 0!==c&&this.updateOlTooltip(a[l],si(c,this.activeLengthUnit),this.activeLengthUnit,so.Length)}void 0!==s&&this.updateOlTooltip(function aC(n){const r=function sC(n){let r=n.get("_center");const t=(0,De.qg)(n.getExtent());return void 0!==r?r.setCoordinates(t):(r=new Ee.Z(t),n.set("_center",r)),r}(n);let t=r.get("_tooltip");return void 0===t?t=sp(r,!0):t.setPosition(r.getFlatCoordinates()),t}(t),Zi(s,this.activeAreaUnit),this.activeAreaUnit,so.Area)}showTooltipsOfOlGeometry(t){Ur(t).forEach(o=>{this.shouldShowTooltip(o)&&this.map.ol.addOverlay(o)})}clearTooltipsOfOlGeometry(t){Ur(t).forEach(o=>{void 0!==o&&void 0!==o.getMap()&&this.map.ol.removeOverlay(o)})}updateTooltipsOfOlSource(t){t.forEachFeature(o=>{this.updateTooltipsOfOlGeometry(o.getGeometry())})}showTooltipsOfOlSource(t){t.forEachFeature(o=>{this.showTooltipsOfOlGeometry(o.getGeometry())})}clearTooltipsOfOlSource(t){t.forEachFeature(o=>{void 0!==o.getGeometry()&&this.clearTooltipsOfOlGeometry(o.getGeometry())})}updateOlTooltip(t,o,i,s){t.setProperties({_measure:o,_unit:i,_type:s},!0),t.getElement().innerHTML=this.computeTooltipInnerHTML(t),this.shouldShowTooltip(t)&&this.map.ol.addOverlay(t)}computeTooltipInnerHTML(t){const o=t.getProperties();return Gn(o._measure,{decimal:1,unit:o._unit,unitAbbr:!0,locale:"fr"},this.languageService)}shouldShowTooltip(t){if(!1===this.showTooltips)return!1;const o=t.getProperties(),i=o._measure;if(void 0===i)return!1;if(o._unit===so.Length){const s=si(this.minSegmentLength,o._unit)||0;return i>Math.max(s,0)}return!0}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(B.uw),e.Y36(oe))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-measurer"]],viewQuery:function(o,i){if(1&o&&e.Gf(fC,7),2&o){let s;e.iGM(s=e.CRH())&&(i.table=s.first)}},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},decls:43,vars:60,consts:[[1,"measure-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"measure-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click"],["svgIcon","calculator"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"]],template:function(o,i){1&o&&(e.TgZ(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.NdJ("change",function(a){return i.onMeasureTypeChange(a.value)}),e.TgZ(3,"mat-button-toggle",2),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-button-toggle",2),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"div",3)(10,"mat-slide-toggle",4),e.NdJ("change",function(a){return i.onToggleDrawControl(a.checked)}),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.YNc(13,_C,1,0,"mat-divider",5),e.ALo(14,"async"),e.YNc(15,yC,3,5,"mat-slide-toggle",6),e.ALo(16,"async"),e.YNc(17,bC,1,0,"mat-divider",5),e.ALo(18,"async"),e.ALo(19,"async"),e.YNc(20,vC,3,5,"mat-slide-toggle",6),e.ALo(21,"async"),e.YNc(22,CC,3,5,"mat-slide-toggle",6),e.ALo(23,"async"),e.YNc(24,xC,1,0,"mat-divider",5),e.ALo(25,"async"),e.TgZ(26,"mat-slide-toggle",7),e.NdJ("change",function(a){return i.onToggleMeasureUnitsAuto(a.checked)}),e._uU(27),e.ALo(28,"translate"),e.qZA()(),e.YNc(29,TC,3,2,"ng-container",5),e.ALo(30,"async"),e.YNc(31,FC,1,0,"mat-divider",5),e.ALo(32,"async"),e.ALo(33,"async"),e.TgZ(34,"div",8),e.YNc(35,OC,4,6,"button",9),e.ALo(36,"async"),e.ALo(37,"async"),e.YNc(38,AC,4,6,"button",10),e.ALo(39,"async"),e.ALo(40,"async"),e.qZA(),e._UZ(41,"igo-entity-table",11,12),e.qZA()),2&o&&(e.xp6(2),e.Q6J("value",i.activeMeasureType),e.xp6(1),e.Q6J("value",i.measureType.Length),e.xp6(1),e.hij(" ",e.lcZ(5,24,"igo.geo.measure."+i.measureType.Length)," "),e.xp6(2),e.Q6J("value",i.measureType.Area),e.xp6(1),e.hij(" ",e.lcZ(8,26,"igo.geo.measure."+i.measureType.Area)," "),e.xp6(3),e.Q6J("disabled",i.drawControlIsDisabled)("checked",i.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(12,28,"igo.geo.measure.toggleActive")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(14,30,i.hasLine$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(16,32,i.hasLine$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(18,34,i.hasLine$)||e.lcZ(19,36,i.hasArea$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(21,38,i.hasArea$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(23,40,i.hasArea$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(25,42,i.hasArea$)),e.xp6(2),e.Q6J("checked",i.measureUnitsAuto)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(28,44,"igo.geo.measure.toggleAutoUnits")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(30,46,i.measure$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(32,48,i.hasLine$)||e.lcZ(33,50,i.hasArea$)),e.xp6(4),e.Q6J("ngIf",e.lcZ(36,52,i.hasLine$)||e.lcZ(37,54,i.hasArea$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(39,56,i.hasLine$)||e.lcZ(40,58,i.hasArea$)),e.xp6(3),e.Q6J("store",i.store)("template",i.tableTemplate))},styles:["[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   .igo-map-tooltip[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:4px 8px;white-space:nowrap}[_nghost-%COMP%]   .igo-map-tooltip-hidden[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .igo-map-tooltip-measure-by-display[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}return n})(),gp=(()=>{class n{transform(t,o,i=!1,s=1){let a;return Object.values(je).indexOf(o)>=0?a=Zi(t,o):Object.values(K).indexOf(o)>=0&&(a=si(t,o)),a&&Gn(a,{decimal:1,unit:o,unitAbbr:i,locale:"fr"})}static \u0275fac=function(o){return new(o||n)};static \u0275pipe=e.Yjl({name:"measureFormat",type:n,pure:!0})}return n})();function LC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",17),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onDrawControlChange())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("checked",t.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function MC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",17),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onfreehandControlChange())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("checked",t.freehandDrawIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function IC(n,r){if(1&n&&(e.TgZ(0,"mat-option",6),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}function ZC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",18)(1,"form",19)(2,"mat-form-field",20),e._UZ(3,"input",21),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"mat-form-field",22)(6,"mat-select",23),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onMeasureUnitChange(i.value))}),e.YNc(7,IC,3,4,"mat-option",24),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.spatialFilter.buffer")),e.Q6J("formControl",t.bufferFormControl)("value",0)("readonly",null===t.formControl.value),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function PC(n,r){if(1&n&&(e.TgZ(0,"mat-option",6),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}function kC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",25)(1,"form",26)(2,"mat-form-field",27)(3,"input",28),e.NdJ("input",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.getRadius())}),e.ALo(4,"translate"),e.qZA()()(),e.TgZ(5,"mat-form-field",22)(6,"mat-select",23),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onMeasureUnitChange(i.value))}),e.YNc(7,PC,3,4,"mat-option",24),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.spatialFilter.radius")),e.Q6J("formControl",t.radiusFormControl)("value",1e3)("readonly",t.freehandDrawIsActive&&null===t.formControl.value),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function $C(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-radio-button",29),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onItemTypeChange(i))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter."+t)," ")}}function DC(n,r){1&n&&(e.TgZ(0,"mat-header-cell",40),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.geo.spatialFilter.Thematics")))}function EC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-header-cell",41)(1,"mat-checkbox",42),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(i?s.masterToggle():null)}),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("checked",t.isAllSelected())("indeterminate",t.selectedThematics.hasValue()&&!t.isAllSelected())}}function RC(n,r){1&n&&e._UZ(0,"mat-header-row")}function NC(n,r){1&n&&e._UZ(0,"mat-row")}function BC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-tree-node",43)(1,"li",44),e._UZ(2,"button",45),e._uU(3),e.TgZ(4,"mat-checkbox",46),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(i){const a=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(i?l.onToggleChange(a):null)}),e.qZA()()()}if(2&n){const t=r.$implicit,o=e.oxw(2);e.xp6(3),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("checked",o.selectedThematics.isSelected(t))}}function JC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-nested-tree-node")(1,"div",44)(2,"button",47),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onToggleClick(s))}),e._UZ(3,"mat-icon",48),e.qZA(),e._uU(4),e.TgZ(5,"mat-checkbox",49),e.NdJ("change",function(i){const a=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(i?l.childrensToggle(a):null)}),e.qZA()(),e.TgZ(6,"ul",50),e.GkF(7,51),e.qZA()()}if(2&n){const t=r.$implicit,o=e.oxw(2);e.xp6(3),e.Q6J("svgIcon",o.treeControl.isExpanded(t)?"chevron-down":"chevron-right"),e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("checked",o.isAllSelected(t))("indeterminate",o.hasChildrenSelected(t)&&!o.isAllSelected(t)),e.xp6(1),e.ekj("example-tree-invisible",!o.treeControl.isExpanded(t))}}function UC(n,r){if(1&n&&(e.TgZ(0,"div",30)(1,"mat-table"),e.ynx(2,31),e.YNc(3,DC,3,3,"mat-header-cell",32),e.BQk(),e.ynx(4,33),e.YNc(5,EC,2,2,"mat-header-cell",34),e.BQk(),e.YNc(6,RC,1,0,"mat-header-row",35),e.YNc(7,NC,1,0,"mat-row",36),e.qZA(),e.TgZ(8,"mat-tree",37),e.YNc(9,BC,5,2,"mat-tree-node",38),e.YNc(10,JC,8,6,"mat-nested-tree-node",39),e.qZA()()),2&n){const t=e.oxw();e.xp6(6),e.Q6J("matHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("dataSource",t.dataSource)("treeControl",t.treeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",t.hasChild)}}function GC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",52),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.clearSearch())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.disabledClearSearch()),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function qC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.clearDrawZone())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",null===t.formControl.value),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function jC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",54),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleVisibleList())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",55),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.spatialFilter.showSearchResults"))}function QC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",59),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.toggleVisibleList())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",60),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function YC(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",56),e.YNc(1,QC,3,3,"button",57),e.TgZ(2,"igo-entity-table",58),e.NdJ("entitySelectChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.entityChange.emit(i))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.listIsVisible),e.xp6(1),e.Q6J("template",t.tableTemplate)("store",t.store)}}let Ra=(()=>{class n{cdRef;spatialFilterService;messageService;languageService;map;get type(){return this._type}set type(t){this._type=t;const o=this.geometryTypes.findIndex(i=>i===this.type);if(this.geometryType=this.geometryTypes[o],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===be.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===be.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=(i,s)=>{const a=i.getGeometry(),l=Q.vs(a.getCoordinates(),this.map.projection,"EPSG:4326");return new J.ZP({image:new Te.Z({radius:this.radius/Math.cos(Math.PI/180*l[1])/s,stroke:new U.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new q.Z({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=()=>new J.ZP({stroke:new U.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new q.Z({color:"rgba(0, 153, 255, 0.2)"})});const i=[0,153,255],s=()=>new J.ZP({image:new Te.Z({radius:8,stroke:new U.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new q.Z({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new U.Z({color:i.concat([1]),width:2}),fill:new q.Z({color:i.concat([.2])})});this.overlayStyle=this.PolyStyle,this.drawStyle$.next(s)}this.overlayStyle$.next(this.overlayStyle)}_type;queryType;zone;loading;get store(){return this._store}set store(t){this._store=t,this._store.entities$.subscribe(()=>{this.cdRef.detectChanges()})}_store;get measureUnits(){return[K.Meters,K.Kilometers]}layers=[];allLayers=[];get thematicLength(){return this._thematicLength}set thematicLength(t){this._thematicLength=t}_thematicLength;toggleSearch=new e.vpe;itemTypeChange=new e.vpe;thematicChange=new e.vpe;drawZoneEvent=new e.vpe;bufferEvent=new e.vpe;zoneWithBufferChange=new e.vpe;measureUnitChange=new e.vpe;radiusEvent=new e.vpe;freehandControl=new e.vpe;predefinedRadius=new e.vpe;clearButtonEvent=new e.vpe;clearSearchEvent=new e.vpe;export=new e.vpe;openWorkspace=new e.vpe;entityChange=new e.vpe;itemType=[Ft.Address,Ft.Thematics];selectedItemType=Ft.Address;selectedSourceAddress;treeControl=new $0.VY(t=>t.children);displayedColumns=["name","select"];childrens=[];groups=[];thematics=[];dataSource=new ni.WX;selectedThematics=new Ks.Ov(!0,[]);value$=new y.X(void 0);drawGuide$=new y.X(null);overlayStyle$=new y.X(void 0);drawStyle$=new y.X(void 0);value$$;radiusChanges$$;bufferChanges$$;formControl=new _.p4;geometryType;geometryTypeField=!1;geometryTypes=["Point","Polygon"];drawGuideField=!1;drawGuide=null;drawGuidePlaceholder="";measure=!1;drawControlIsActive=!0;freehandDrawIsActive=!1;drawStyle;drawZone;overlayStyle;PointStyle;PolyStyle;radius;buffer=0;radiusFormControl=new _.p4;bufferFormControl=new _.p4;measureUnit=K.Meters;zoneWithBuffer;listIsVisible=!0;tableTemplate;constructor(t,o,i,s){this.cdRef=t,this.spatialFilterService=o,this.messageService=i,this.languageService=s}ngOnInit(){this.spatialFilterService.loadThematicsList().subscribe(i=>{for(const a of i)this.childrens.push(a),this.childrens.sort((l,c)=>l.name.localeCompare(c.name));this.groups.push(this.languageService.translate.instant("igo.geo.terrapi.limites"));const s={name:this.groups[0],children:[]};this.thematics.push(s),this.childrens.forEach(a=>{a.group&&-1===this.groups.indexOf(a.group)&&(this.groups.push(a.group),this.thematics.push({name:a.group,children:[]})),a.group||(a.name===this.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||a.name===this.languageService.translate.instant("igo.geo.terrapi.Mun")||a.name===this.languageService.translate.instant("igo.geo.terrapi.Arrond")||a.name===this.languageService.translate.instant("igo.geo.terrapi.CircFed")||a.name===this.languageService.translate.instant("igo.geo.terrapi.CircProv")||a.name===this.languageService.translate.instant("igo.geo.terrapi.DirReg")||a.name===this.languageService.translate.instant("igo.geo.terrapi.MRC")||a.name===this.languageService.translate.instant("igo.geo.terrapi.RegTour")?a.group=s.name:a.name===this.languageService.translate.instant("igo.geo.terrapi.routes")?a.group=this.languageService.translate.instant("igo.geo.spatialFilter.group.transport"):this.thematics.push({name:a.name,children:[],source:a.source})),this.thematics.sort((l,c)=>l.name.localeCompare(c.name))}),this.thematics.forEach(a=>{for(const l of this.childrens)l.group===a.name&&a.children.push(l)})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(i=>{i?(this.value$.next(i),this.drawZone=this.formControl.value,0!==this.buffer&&(this.drawZoneEvent.emit(this.drawZone),this.bufferFormControl.setValue(this.buffer))):(this.value$.next(void 0),this.drawZone=void 0)}),this.value$.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe((0,ae.b)(500)).subscribe(i=>{this.measureUnit===K.Meters&&i>0&&i<=1e5?(this.buffer=i,this.bufferEvent.emit(i),this.spatialFilterService.loadBufferGeometry(this.drawZone,be.Polygon,i).subscribe(s=>{this.zoneWithBuffer=s,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===K.Kilometers&&i>0&&i<=100?(this.buffer=i,this.bufferEvent.emit(i),this.spatialFilterService.loadBufferGeometry(this.drawZone,be.Polygon,1e3*i).subscribe(s=>{this.zoneWithBuffer=s,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===i?(this.buffer=i,this.bufferEvent.emit(i),this.drawZoneEvent.emit(this.drawZone)):(i<0||this.measureUnit===K.Meters&&i>1e5||this.measureUnit===K.Kilometers&&i>100)&&(this.bufferFormControl.setValue(0),this.buffer=0,this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))});const t=new xi({}),o=new Tt({layer:new xe({zIndex:300,source:new Ae,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:Y.Default,many:!0,dragBox:!0});this.store.addStrategy(o,!0),this.store.addStrategy(t,!1)}ngOnDestroy(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}onItemTypeChange(t){this.selectedItemType=t.value,this.itemTypeChange.emit(this.selectedItemType)}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.bufferFormControl.setValue(this.measureUnit===K.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3):this.isPoint()&&this.radiusFormControl.setValue(this.measureUnit===K.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}isPredefined(){return this.type===be.Predefined}isPolygon(){return this.type===be.Polygon}isPoint(){return this.type===be.Point}hasChild(t,o){return!!o.children&&o.children.length}onToggleClick(t){this.treeControl.isExpanded(t)?this.treeControl.collapse(t):this.treeControl.expand(t)}isAllSelected(t){let o,i=0;return t?(o=t.children.length,t.children.forEach(s=>{this.selectedThematics.selected.find(a=>a===s)&&i++})):(o=this.selectedThematics.selected.length,this.thematics.forEach(s=>{-1===this.groups.indexOf(s.name)&&i++}),this.childrens.forEach(s=>{this.thematics.find(a=>a.source===s.source)||i++})),i>=1&&o===i}hasChildrenSelected(t){let o=!1;return t.children.forEach(i=>{this.selectedThematics.selected.find(s=>s.source===i.source)&&(o=!0)}),o}masterToggle(){this.isAllSelected()?this.selectedThematics.clear():this.selectAll();const t=[];for(const o of this.selectedThematics.selected)t.push(o);this.isAllSelected()?this.thematics.forEach(o=>{this.hasChild(0,o)&&this.treeControl.expand(o)}):this.thematics.forEach(o=>{this.hasChild(0,o)&&this.treeControl.collapse(o)}),this.thematicChange.emit(t)}selectAll(t){t?this.hasChild(0,t)&&t.children.forEach(o=>this.selectedThematics.select(o)):(this.thematics.forEach(o=>{-1===this.groups.indexOf(o.name)&&this.selectedThematics.select(o)}),this.childrens.forEach(o=>{this.selectedThematics.selected.find(i=>i.source===o.source)||this.selectedThematics.select(o)}))}childrensToggle(t){this.isAllSelected(t)?t.children.forEach(i=>this.selectedThematics.deselect(i)):this.selectAll(t);const o=[];for(const i of this.selectedThematics.selected)o.push(i);this.treeControl.expand(t),this.thematicChange.emit(o)}onToggleChange(t){let o=!1;void 0!==this.selectedThematics.selected.find(s=>s.source===t.source)&&(o=!0),this.childrens.forEach(s=>{s===t&&!1===o&&this.selectedThematics.select(s),s===t&&!0===o&&this.selectedThematics.deselect(s)}),this.thematics.forEach(s=>{s===t&&!1===o&&this.selectedThematics.select(s),s===t&&!0===o&&this.selectedThematics.deselect(s)});const i=[];for(const s of this.selectedThematics.selected)i.push(s);this.thematicChange.emit(i)}onDrawControlChange(){this.drawControlIsActive=!this.drawControlIsActive}onfreehandControlChange(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive),this.isPoint()?(this.predefinedRadius.emit(!this.freehandDrawIsActive),this.freehandDrawIsActive&&(this.overlayStyle$.next(void 0),this.drawStyle$.next(void 0))):this.predefinedRadius.emit(!1)}toggleSearchButton(){this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe((0,ae.b)(500)).subscribe(t=>{t.length&&this.layers.length===this.thematicLength+1&&(this.openWorkspace.emit(),this.createTableTemplate())})}clearButton(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}clearDrawZone(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}clearSearch(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}disableSearchButton(){if(this.type===be.Predefined){if(this.selectedItemType===Ft.Address&&void 0!==this.queryType&&void 0!==this.zone)return this.loading;if(this.selectedItemType===Ft.Thematics&&void 0!==this.queryType&&void 0!==this.zone&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===be.Polygon||this.type===be.Point){if(this.selectedItemType===Ft.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===Ft.Thematics&&this.selectedThematics.selected.length>0&&null!==this.formControl.value)return this.loading}return!0}disabledClearSearch(){let t=!0;return t=this.selectedItemType===Ft.Address?void 0===this.queryType:void 0===this.queryType&&0===this.selectedThematics.selected.length,t}getRadius(){let t;if(t=null!==this.formControl.value?this.measureUnit===K.Meters?this.formControl.value.radius:this.formControl.value.radius/1e3:void 0,this.type===be.Point){if(this.freehandDrawIsActive){if(t){if(t>=1e5)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),void this.formControl.reset();if(t!==this.radiusFormControl.value)return void this.radiusFormControl.setValue(t)}}else if(this.radiusFormControl.value<0||this.measureUnit===K.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===K.Kilometers&&this.radiusFormControl.value>=100)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.radius=1e3,this.radiusFormControl.setValue(this.measureUnit===K.Meters?this.radius:this.radius/1e3),void this.drawGuide$.next(this.radius);this.measureUnit===K.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=1e3*this.radiusFormControl.value,this.drawGuide$.next(1e3*this.radius)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}toggleVisibleList(){this.listIsVisible=!this.listIsVisible}createTableTemplate(){const t={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:wt.UnsanitizedHTML},o={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:wt.UnsanitizedHTML};this.tableTemplate={selection:!0,sort:!0,columns:[t,o]}}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO),e.Y36(en),e.Y36(_e),e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",predefinedRadius:"predefinedRadius",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},decls:29,vars:43,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius","predefinedRadius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"disabled","click"],["mat-raised-button","",1,"remove-button",3,"disabled","click"],["mat-raised-button","",1,"export-button",3,"disabled","click"],["class","chevron-down","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"buffer-unit"],[1,"buffer-form"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius-form"],[1,"radius"],["type","number","matInput","",3,"placeholder","formControl","value","readonly","input"],[3,"value","change"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"checked","indeterminate","change"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"checked","click","change"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"tree-check-2",3,"checked","indeterminate","change"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"disabled","click"],["mat-raised-button","",1,"clear-form-button",3,"disabled","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"chevron-down",3,"matTooltip","click"],["svgIcon","chevron-down"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"template","store","entitySelectChange"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"]],template:function(o,i){1&o&&(e._UZ(0,"igo-geometry-form-field-input",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.TgZ(4,"div",1),e.YNc(5,LC,3,5,"mat-slide-toggle",2),e.YNc(6,MC,3,5,"mat-slide-toggle",2),e.qZA(),e.YNc(7,ZC,8,8,"div",3),e.YNc(8,kC,8,8,"div",4),e.TgZ(9,"mat-label",5),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-radio-group",6),e.YNc(13,$C,3,4,"mat-radio-button",7),e.qZA(),e.YNc(14,UC,11,5,"div",8),e.TgZ(15,"div",9),e.YNc(16,GC,3,4,"button",10),e.YNc(17,qC,3,4,"button",11),e.TgZ(18,"button",12),e.NdJ("click",function(){return i.toggleSearchButton()}),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"button",13),e.NdJ("click",function(){return i.clearButton()}),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"button",14),e.NdJ("click",function(){return i.export.emit()}),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e.YNc(27,jC,3,3,"button",15),e.YNc(28,YC,3,3,"div",16)),2&o&&(e.Q6J("formControl",i.formControl)("map",i.map)("geometryType",i.geometryType)("drawGuide",e.lcZ(1,29,i.drawGuide$))("measure",i.measure)("drawControlIsActive",i.drawControlIsActive)("freehandDrawIsActive",i.freehandDrawIsActive)("drawStyle",e.lcZ(2,31,i.drawStyle$))("overlayStyle",e.lcZ(3,33,i.overlayStyle$))("radius",i.radius)("predefinedRadius",i.predefinedRadius),e.xp6(5),e.Q6J("ngIf",!i.isPredefined()),e.xp6(1),e.Q6J("ngIf",!i.isPredefined()),e.xp6(1),e.Q6J("ngIf",i.isPolygon()),e.xp6(1),e.Q6J("ngIf",i.isPoint()),e.xp6(2),e.hij("",e.lcZ(11,35,"igo.geo.spatialFilter.search")," :\n"),e.xp6(2),e.Q6J("value",i.selectedItemType),e.xp6(1),e.Q6J("ngForOf",i.itemType),e.xp6(1),e.Q6J("ngIf","Thematics"===i.selectedItemType&&!i.tableTemplate||"Thematics"===i.selectedItemType&&i.tableTemplate&&!i.listIsVisible),e.xp6(2),e.Q6J("ngIf",i.isPredefined()),e.xp6(1),e.Q6J("ngIf",i.isPolygon()||i.isPoint()),e.xp6(1),e.Q6J("disabled",i.disableSearchButton()),e.xp6(1),e.hij(" ",e.lcZ(20,37,"igo.geo.spatialFilter.goSearch")," "),e.xp6(2),e.Q6J("disabled",0===i.allLayers.length),e.xp6(1),e.hij(" ",e.lcZ(23,39,"igo.geo.spatialFilter.removeLayer")," "),e.xp6(2),e.Q6J("disabled",!i.store.entities$.getValue().length),e.xp6(1),e.hij(" ",e.lcZ(26,41,"igo.geo.spatialFilter.exportLayer")," "),e.xp6(2),e.Q6J("ngIf",i.store.all().length&&i.tableTemplate&&!i.listIsVisible),e.xp6(1),e.Q6J("ngIf",i.store.all().length&&i.tableTemplate&&i.listIsVisible))},styles:["[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{margin-top:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-top:5px}[_nghost-%COMP%]   .mat-column-select[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin:16px 0}[_nghost-%COMP%]   .thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}[_nghost-%COMP%]   .mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}[_nghost-%COMP%]   .buffer-unit[_ngcontent-%COMP%], [_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:5px;box-sizing:border-box}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%], [_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{width:110px;margin-left:30px}[_nghost-%COMP%]   .example-tree-invisible[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}[_nghost-%COMP%]   .tree-check[_ngcontent-%COMP%], [_nghost-%COMP%]   .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}[_nghost-%COMP%]   .thematics-header[_ngcontent-%COMP%]{max-width:250px}[_nghost-%COMP%]   .checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}[_nghost-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{padding:5px}[_nghost-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}[_nghost-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{height:56px}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{max-height:45%;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:unset}"],changeDetection:0})}return n})();function HC(n,r){if(1&n&&(e.TgZ(0,"mat-option",12),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.properties.nom," ")}}function VC(n,r){if(1&n&&(e.TgZ(0,"mat-option",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}let zC=(()=>{class n{spatialFilterService;messageService;get store(){return this._store}set store(t){this._store=t}_store;get queryType(){return this._queryType}set queryType(t){this.formControl.setValue(""),this._queryType=t}_queryType;get zone(){return this._zone}set zone(t){this._zone=t,t||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}_zone;layers=[];zoneWithBuffer;selectedZone;measureUnit=K.Meters;formControl=new _.p4;bufferFormControl=new _.p4;get measureUnits(){return[K.Meters,K.Kilometers]}zoneChange=new e.vpe;zoneWithBufferChange=new e.vpe;bufferChange=new e.vpe;measureUnitChange=new e.vpe;formValueChanges$$;bufferValueChanges$$;constructor(t,o){this.spatialFilterService=t,this.messageService=o}ngOnInit(){this.formValueChanges$$=this.formControl.valueChanges.subscribe(t=>{t.length&&this.store.view.filter(o=>{const i=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return o.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe((0,ae.b)(500),(0,fi.x)()).subscribe(t=>{this.measureUnit===K.Meters&&t>0&&t<=1e5?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,be.Predefined,t,this.queryType).subscribe(o=>{this.zoneWithBuffer=o,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===K.Kilometers&&t>0&&t<=100?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,be.Predefined,1e3*t,this.queryType).subscribe(o=>{this.zoneWithBuffer=o,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===t&&this.layers.length>0?(this.bufferChange.emit(t),this.zoneWithBufferChange.emit(this.selectedZone)):(t<0||this.measureUnit===K.Meters&&t>1e5||this.measureUnit===K.Kilometers&&t>100)&&(this.bufferFormControl.setValue(0),this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))})}ngOnDestroy(){this.formValueChanges$$.unsubscribe()}displayFn(t){return t?t.properties.nom:void 0}onZoneChange(t){t&&this.queryType&&this.spatialFilterService.loadItemById(t,this.queryType).subscribe(o=>{this.selectedZone=o,this.zoneChange.emit(o)})}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.bufferFormControl.setValue(this.measureUnit===K.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3))}static \u0275fac=function(o){return new(o||n)(e.Y36(en),e.Y36(_e))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},decls:23,vars:23,consts:[[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],["input",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value"]],template:function(o,i){if(1&o&&(e.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"input",2,3),e.ALo(7,"translate"),e.TgZ(8,"mat-autocomplete",4,5),e.NdJ("optionSelected",function(a){return i.onZoneChange(a.option.value)}),e.YNc(10,HC,2,2,"mat-option",6),e.ALo(11,"async"),e.qZA()(),e.TgZ(12,"div")(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),e._uU(16),e.ALo(17,"translate"),e.qZA(),e._UZ(18,"input",9),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"mat-form-field",10)(21,"mat-select",11),e.NdJ("selectionChange",function(a){return i.onMeasureUnitChange(a.value)}),e.YNc(22,VC,3,4,"mat-option",6),e.qZA()()()()()),2&o){const s=e.MAs(9);e.xp6(3),e.Oqu(e.lcZ(4,13,"igo.geo.spatialFilter.listLabel")),e.xp6(2),e.s9C("placeholder",e.lcZ(7,15,"igo.geo.spatialFilter.listLabel")),e.Q6J("formControl",i.formControl)("matAutocomplete",s),e.xp6(3),e.Q6J("displayWith",i.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(11,17,i.store.view.all$())),e.xp6(6),e.Oqu(e.lcZ(17,19,"igo.geo.spatialFilter.buffer")),e.xp6(2),e.s9C("placeholder",e.lcZ(19,21,"igo.geo.spatialFilter.buffer")),e.Q6J("formControl",i.bufferFormControl)("value",0)("readonly",!i.zone),e.xp6(3),e.Q6J("value",i.measureUnit),e.xp6(1),e.Q6J("ngForOf",i.measureUnits)}},dependencies:[f.sg,_.Fj,_.wV,_.JJ,_.oH,Je.XC,le.ey,Je.ZL,F.KE,F.hX,j.Nt,se.gD,f.Ov,O.X$],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .buffer-div[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .zone-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{width:110px;margin-left:16px}"],changeDetection:0})}return n})();function KC(n,r){if(1&n&&(e.TgZ(0,"mat-option",10),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.terrapi."+t)," ")}}let Na=(()=>{class n{get store(){return this._store}set store(t){this._store=t}_store;queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"];selectedTypeIndex=new _.p4(0);spatialType=be;activeDrawType=this.spatialType.Polygon;selectedQueryType;zone;layers=[];type;eventType=new e.vpe;eventQueryType=new e.vpe;zoneChange=new e.vpe;zoneWithBufferChange=new e.vpe;bufferChange=new e.vpe;measureUnitChange=new e.vpe;constructor(){}ngOnInit(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onTypeChange(t){0===this.selectedTypeIndex.value&&(this.type=be.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onDrawTypeChange(t){this.activeDrawType=t,this.eventType.emit(this.activeDrawType)}onSelectionChange(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},decls:20,vars:25,consts:[[3,"selectedIndex","selectedIndexChange","selectedTabChange"],[3,"label"],[3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"store","queryType","zone","layers","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[1,"spatial-type-toggle"],[3,"value","change"],[3,"value","matTooltip"],["svgIcon","pentagon-outline"],["svgIcon","record-circle-outline"],[3,"value"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-tab-group",0),e.NdJ("selectedIndexChange",function(a){return i.selectedTypeIndex.setValue(a)})("selectedTabChange",function(a){return i.onTypeChange(a)}),e.TgZ(1,"mat-tab",1),e.ALo(2,"translate"),e.TgZ(3,"mat-form-field")(4,"mat-label"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-select",2),e.NdJ("selectionChange",function(){return i.onSelectionChange()})("valueChange",function(a){return i.selectedQueryType=a}),e.YNc(8,KC,3,4,"mat-option",3),e.qZA()(),e.TgZ(9,"igo-spatial-filter-list",4),e.NdJ("zoneChange",function(a){return i.zoneChange.emit(a)})("zoneWithBufferChange",function(a){return i.zoneWithBufferChange.emit(a)})("bufferChange",function(a){return i.bufferChange.emit(a)})("measureUnitChange",function(a){return i.measureUnitChange.emit(a)}),e.qZA()(),e.TgZ(10,"mat-tab",1),e.ALo(11,"translate"),e.TgZ(12,"div",5)(13,"mat-button-toggle-group",6),e.NdJ("change",function(a){return i.onDrawTypeChange(a.value)}),e.TgZ(14,"mat-button-toggle",7),e.ALo(15,"translate"),e._UZ(16,"mat-icon",8),e.qZA(),e.TgZ(17,"mat-button-toggle",7),e.ALo(18,"translate"),e._UZ(19,"mat-icon",9),e.qZA()()()()()),2&o&&(e.Q6J("selectedIndex",i.selectedTypeIndex.value),e.xp6(1),e.Q6J("label",e.lcZ(2,15,"igo.geo.spatialFilter.predefined")),e.xp6(4),e.Oqu(e.lcZ(6,17,"igo.geo.spatialFilter.searchLabel")),e.xp6(2),e.Q6J("value",i.selectedQueryType),e.xp6(1),e.Q6J("ngForOf",i.queryType),e.xp6(1),e.Q6J("store",i.store)("queryType",i.selectedQueryType)("zone",i.zone)("layers",i.layers),e.xp6(1),e.Q6J("label",e.lcZ(11,19,"igo.geo.spatialFilter.draw")),e.xp6(3),e.Q6J("value",i.activeDrawType),e.xp6(1),e.Q6J("value",i.spatialType.Polygon)("matTooltip",e.lcZ(15,21,"igo.geo.spatialFilter.drawPolygon")),e.xp6(3),e.Q6J("value",i.spatialType.Point)("matTooltip",e.lcZ(18,23,"igo.geo.spatialFilter.drawCircle")))},styles:["[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-label{padding:10px}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:5px}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return n})();function WC(n,r){if(1&n&&(e.TgZ(0,"button",2),e.ALo(1,"translate"),e._UZ(2,"mat-icon",3),e.qZA()),2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.xp6(2),e.Q6J("matBadge",t.badge)}}function XC(n,r){if(1&n&&e._UZ(0,"igo-time-filter-item",7),2&n){const t=e.oxw(2);e.Q6J("header",!1)("layer",t.layer)}}function ex(n,r){if(1&n&&(e.TgZ(0,"div",4,5),e.YNc(2,XC,1,2,"igo-time-filter-item",6),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.timeFilterCollapse&&t.options.timeFilter)}}let Yn=(()=>{class n{options;get badge(){const t=this.options.timeFilter;if(t&&t.enabled)return 1}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header=!0;timeFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","history",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(o,i){1&o&&(e.YNc(0,WC,3,5,"button",0),e.YNc(1,ex,3,1,"div",1)),2&o&&(e.Q6J("ngIf",i.header&&i.options.timeFilterable&&i.options.timeFilter),e.xp6(1),e.Q6J("ngIf",i.header&&i.options.timeFilterable&&i.options.timeFilter))},changeDetection:0})}return n})();function tx(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-form-field"),e._UZ(2,"mat-datetimepicker-toggle",4)(3,"mat-datetimepicker",5,6),e.TgZ(5,"input",7),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.date=i)})("dateChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleDateChange(i))}),e.ALo(6,"translate"),e.qZA()()()}if(2&n){const t=e.MAs(4),o=e.oxw(2);e.xp6(2),e.Q6J("for",t),e.xp6(1),e.s9C("type",o.type),e.xp6(2),e.s9C("placeholder",e.lcZ(6,7,"igo.geo.timeFilter.date")),e.Q6J("matDatetimepicker",t)("ngModel",o.date)("min",o.min)("max",o.max)}}function ox(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",8)(2,"mat-form-field"),e._UZ(3,"mat-datetimepicker-toggle",4)(4,"mat-datetimepicker",5,9),e.TgZ(6,"input",10),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.startDate=i)})("input",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.startDate)})("dateChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleDateChange(i))}),e.ALo(7,"translate"),e.qZA()()(),e.TgZ(8,"div",8)(9,"mat-form-field"),e._UZ(10,"mat-datetimepicker-toggle",4)(11,"mat-datetimepicker",5,11),e.TgZ(13,"input",7),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.endDate=i)})("dateChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleDateChange(i))}),e.ALo(14,"translate"),e.qZA()()()()}if(2&n){const t=e.MAs(5),o=e.MAs(12),i=e.oxw(2);e.xp6(3),e.Q6J("for",t),e.xp6(1),e.s9C("type",i.type),e.xp6(2),e.s9C("placeholder",e.lcZ(7,14,"igo.geo.timeFilter.startDate")),e.Q6J("matDatetimepicker",t)("ngModel",i.startDate)("min",i.min)("max",i.getRangeMaxDate()),e.xp6(4),e.Q6J("for",o),e.xp6(1),e.s9C("type",i.type),e.xp6(2),e.s9C("placeholder",e.lcZ(14,16,"igo.geo.timeFilter.endDate")),e.Q6J("matDatetimepicker",o)("ngModel",i.endDate)("min",i.getRangeMinDate())("max",i.max)}}function ix(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,tx,7,9,"div",2),e.YNc(2,ox,15,18,"div",0),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isRange),e.xp6(1),e.Q6J("ngIf",t.isRange)}}function nx(n,r){if(1&n&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function rx(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-form-field")(2,"mat-select",12),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.year=i)})("selectionChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleYearChange(i))}),e.ALo(3,"translate"),e.YNc(4,nx,2,2,"mat-option",13),e.qZA()()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.s9C("placeholder",e.lcZ(3,3,"igo.geo.timeFilter.date")),e.Q6J("ngModel",t.year),e.xp6(2),e.Q6J("ngForOf",t.listYears)}}function sx(n,r){if(1&n&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function ax(n,r){if(1&n&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function lx(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",8)(2,"mat-form-field")(3,"mat-select",12),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.startYear=i)})("selectionChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleYearChange(i))}),e.ALo(4,"translate"),e.YNc(5,sx,2,2,"mat-option",13),e.qZA()()(),e.TgZ(6,"div",8)(7,"mat-form-field")(8,"mat-select",12),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.endYear=i)})("selectionChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handleYearChange(i))}),e.ALo(9,"translate"),e.YNc(10,ax,2,2,"mat-option",13),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.timeFilter.startDate")),e.Q6J("ngModel",t.startYear),e.xp6(2),e.Q6J("ngForOf",t.startListYears),e.xp6(3),e.s9C("placeholder",e.lcZ(9,8,"igo.geo.timeFilter.endDate")),e.Q6J("ngModel",t.endYear),e.xp6(2),e.Q6J("ngForOf",t.endListYears)}}function cx(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,rx,5,5,"div",2),e.YNc(2,lx,11,10,"div",0),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isRange),e.xp6(1),e.Q6J("ngIf",t.isRange)}}function ux(n,r){if(1&n&&(e.TgZ(0,"p",26),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.year)}}function px(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"mat-slider",16,17)(5,"input",18,19),e.NdJ("input",function(){e.CHM(t);const i=e.MAs(6),s=e.MAs(4),a=e.oxw();return e.KtG(a.handleSliderYearChange({source:i,parent:s,value:i.value}))})("change",function(){e.CHM(t);const i=e.MAs(6),s=e.MAs(4),a=e.oxw();return e.KtG(a.handleSliderYearChange({source:i,parent:s,value:i.value}))}),e.qZA()(),e.TgZ(7,"span"),e._uU(8),e.qZA(),e.YNc(9,ux,2,1,"p",20),e.TgZ(10,"div",21,22)(12,"mat-slide-toggle",23),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleFilterState())}),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"button",24),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.playYear(i))}),e._UZ(15,"mat-icon",25),e.qZA(),e.TgZ(16,"button",24),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.resetFilter(i))}),e._UZ(17,"mat-icon",25),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(2),e.Oqu(t.startYear),e.xp6(1),e.s9C("step",t.step),e.Q6J("min",t.startYear)("max",t.endYear)("color",t.color)("disabled",!t.options.enabled||!t.layer.visible),e.xp6(2),e.Q6J("value",t.handleSliderValue()),e.xp6(3),e.Oqu(t.endYear),e.xp6(1),e.Q6J("ngIf",t.options.enabled),e.xp6(3),e.Q6J("matTooltip",e.lcZ(13,17,"igo.geo.filter.toggleFilterState"))("color",t.color)("checked",t.options.enabled)("disabled",!t.layer.visible),e.xp6(2),e.Q6J("disabled",!t.options.enabled||!t.layer.visible),e.xp6(1),e.s9C("svgIcon",t.playIcon),e.xp6(1),e.Q6J("disabled",!t.options.enabled||!t.layer.visible),e.xp6(1),e.s9C("svgIcon",t.resetIcon)}}function dx(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-slider",27,17),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.handleSliderDateChange(i))}),e.TgZ(3,"input",28,19),e.NdJ("input",function(){e.CHM(t);const i=e.MAs(4),s=e.MAs(2),a=e.oxw();return e.KtG(a.handleSliderDateChange({source:i,parent:s,value:i.value}))}),e.qZA()(),e.TgZ(5,"p",26),e._uU(6),e.qZA(),e.TgZ(7,"button",29),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.playFilter(i))}),e._UZ(8,"mat-icon",25),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.s9C("step",t.step),e.Q6J("min",t.dateToNumber(t.min))("max",t.dateToNumber(t.max)),e.xp6(2),e.Q6J("value",t.handleSliderValue()),e.xp6(3),e.Oqu(t.handleSliderTooltip()),e.xp6(2),e.s9C("svgIcon",t.playIcon)}}let gx=(()=>{class n{dateAdapter;layer;options;color="primary";date;startDate;endDate;year;startYear;endYear;initStartYear;initEndYear;listYears=[];startListYears=[];endListYears=[];set currentValue(t){if(t&&this.type!==st.YEAR){const o=t.split("/");if(o.length>0){const i=new Date(o[0]),s=new Date(o[1]);isNaN(i.valueOf())||(this.startDate=i),isNaN(s.valueOf())||(this.endDate=s)}}}interval;playIcon="play-circle";resetIcon="replay";change=new e.vpe;yearChange=new e.vpe;mySlider;get type(){return void 0===this.options.type?st.DATE:this.options.type}get isRange(){return void 0!==this.options.range&&this.options.style!==Ut.SLIDER&&this.options.range}get style(){return void 0===this.options.style?Ut.SLIDER:this.options.style}get step(){let t=108e5;if(void 0===this.options.step)switch(this.type){case st.DATE:case st.DATETIME:t=108e5;break;case st.TIME:t=36e5;break;case st.YEAR:t=31536e6;break;default:t=108e5}else t=this.getStepDefinition(this.options.step);return t}get timeInterval(){return void 0===this.options.timeInterval?2e3:this.options.timeInterval}get min(){if(this.options.min){const t=new Date(this.options.min);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get max(){if(this.options.max){const t=new Date(this.options.max);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get is(){return void 0!==this.options.range&&this.options.range}constructor(t){this.dateAdapter=t,this.dateAdapter.setLocale("fr")}ngOnInit(){if(void 0===this.startDate&&(this.startDate=new Date(this.min)),void 0===this.endDate&&(this.endDate=new Date(this.max)),void 0===this.startYear&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),void 0===this.endYear&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(let t=this.startYear;t<this.endYear;t++)this.startListYears.push(t);for(let t=this.startYear+1;t<=this.endYear;t++)this.endListYears.push(t)}else for(let t=this.startYear;t<=this.endYear+1;t++)this.listYears.push(t);this.options.enabled=void 0===this.options.enabled||this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&"slider"===this.style&&"year"===this.type&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}storeCurrentFilterValue(){!this.isRange&&this.style===Ut.SLIDER&&this.type===st.YEAR&&(this.options.value=this.year.toString())}checkFilterValue(){const o=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==Ut.SLIDER||this.type!==st.YEAR){if(this.isRange&&this.style===Ut.CALENDAR&&this.type===st.YEAR&&o){this.startYear=parseInt(o.substr(0,4),10),this.endYear=parseInt(o.substr(5,4),10);const i=[],s=[];for(let a=this.initStartYear;a<this.endYear;a++)i.push(a);for(let a=this.startYear+1;a<=this.initEndYear;a++)s.push(a);this.startListYears=i,this.endListYears=s}}else this.year=o?new Date(o.toString()).getFullYear()+1:this.options.value?new Date(this.options.value.toString()).getFullYear()+1:new Date(this.min).getFullYear()+1}handleDateChange(t){this.setupDateOutput(),this.applyTypeChange(),this.change.emit(this.isRange?[this.startDate,this.endDate]:this.startDate)}handleYearChange(t){if(this.isRange){this.endListYears=[];for(let o=this.startYear+1;o<=this.initEndYear;o++)this.endListYears.push(o);this.startListYears=[];for(let o=this.initStartYear+1;o<this.endYear;o++)this.startListYears.push(o);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}handleListYearChange(t){this.handleYearChange([this.startYear,this.endYear])}handleListYearStartChange(t){this.change.emit([this.startDate,this.endDate])}dateToNumber(t){let o;return o=t?new Date(t):new Date(this.min),o.getTime()}setSliderThumbLabel(t){const o=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);o&&(o.textContent=t)}findThumbLabel(t){let o;return t.forEach(i=>{"mat-slider-thumb-label-text"===i.className&&(o=i),i.children.length>0&&!o&&(o=this.findThumbLabel(i.childNodes))},this),o}toggleFilterState(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&Ut.SLIDER&&this.type===st.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}resetFilter(t){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&Ut.SLIDER&&this.type===st.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(o=>{let i;const s=new Date(o.max);i=void 0===o.date?o.min.getTime():o.date.getTime(),i+=o.mySlider.step,o.date=new Date(i),i>s.getTime()&&o.stopFilter(),o.handleDateChange({value:o.date,date:o.date})},this.timeInterval,this))}playYear(t){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(t)),this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(()=>{this.year+this.mySlider.step>this.max.getFullYear()?this.stopFilter():this.year=this.year+this.mySlider.step,this.yearChange.emit(this.year)},this.timeInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}handleSliderDateChange(t){this.date=new Date(t.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(t)}handleSliderYearChange(t){this.year=t.value,this.yearChange.emit(this.year)}handleSliderValue(){return!0!==this.options.current&&this.min||(this.date=this.getRoundedDate(new Date)),this.type===st.YEAR?this.year:void 0===this.date?this.min.getTime():this.date.getTime()}handleSliderTooltip(){let t;switch(this.type){case st.DATE:t=void 0===this.date?this.min.toDateString():this.date.toDateString();break;case st.TIME:t=void 0===this.date?this.min.toTimeString():this.date.toTimeString();break;default:t=void 0===this.date?this.min.toUTCString():this.date.toUTCString()}return t}setupDateOutput(){this.style===Ut.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=void 0===this.startDate?new Date(this.min):this.startDate,this.endDate=void 0===this.endDate?new Date(this.max):this.endDate)}applyTypeChange(){switch(this.type){case st.DATE:(void 0!==this.startDate||void 0!==this.endDate)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case st.TIME:if(this.style===Ut.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){const t=this.startDate.getHours(),o=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(t),this.startDate.setMinutes(o)}if(this.endDate.getDay()!==this.min.getDay()){const t=this.endDate.getHours(),o=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(t),this.endDate.setMinutes(o)}}!this.isRange&&this.step>36e5&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}}getRangeMinDate(){return void 0===this.startDate?this.min:this.startDate}getRangeMaxDate(){return void 0===this.endDate?this.max:this.endDate}getRoundedDate(t,o=10){const i=6e4*o;return new Date(Math.round(t.getTime()/i)*i)}getStepDefinition(t){return E().duration(t).asMilliseconds()}static \u0275fac=function(o){return new(o||n)(e.Y36(le._A))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-time-filter-form"]],viewQuery:function(o,i){if(1&o&&e.Gf(fo.pH,5),2&o){let s;e.iGM(s=e.CRH())&&(i.mySlider=s.first)}},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},decls:5,vars:4,consts:[[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],["openOnFocus","true","timeInterval","5",3,"type"],["datetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","dateChange"],[1,"igo-col","igo-col-100"],["minDatetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","input","dateChange"],["maxDatetimePicker",""],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","thumbLabel","",3,"step","min","max","color","disabled"],["ngSlider",""],["matSliderThumb","",3,"value","input","change"],["ngSliderThumb","matSliderThumb"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["actions",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","checked","disabled","change"],["mat-icon-button","","color","primary",3,"disabled","click"],[3,"svgIcon"],[1,"date-below"],["id","time-slider","thumbLabel","",3,"step","min","max","selectionChange"],["matSliderThumb","",3,"value","input"],["mat-icon-button","","color","primary",3,"click"]],template:function(o,i){1&o&&(e.YNc(0,ix,3,2,"div",0),e.YNc(1,cx,3,2,"div",0),e._UZ(2,"br"),e.YNc(3,px,18,19,"div",1),e.YNc(4,dx,9,6,"div",2)),2&o&&(e.Q6J("ngIf","calendar"===i.style&&"year"!==i.type),e.xp6(1),e.Q6J("ngIf","calendar"===i.style&&"year"===i.type),e.xp6(2),e.Q6J("ngIf",!i.isRange&&"slider"===i.style&&"year"===i.type),e.xp6(1),e.Q6J("ngIf","slider"===i.style&&"year"!==i.type))},dependencies:[f.sg,f.O5,_.Fj,_.JJ,_.On,le.ey,w.Hw,S.RK,fo.pH,fo.$5,tt.Rr,F.KE,F.R9,j.Nt,se.gD,P.gM,Rn._R,Rn.C,Rn.RZ,O.X$],styles:["[_nghost-%COMP%]   .igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:70%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .date-below[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]})}return n})();const mx=function(n){return{disabled:n}};function hx(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.layer.visible=!i.layer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",11),e.ALo(4,"async"),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,4,"igo.geo.layer.hideLayer"):e.lcZ(2,6,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("ngClass",e.VKq(10,mx,!1===e.lcZ(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}const fx=function(n){return{cursor:n}};function _x(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleFiltersCollapsed())}),e.qZA(),e.TgZ(2,"span",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleLegendOnClick())}),e._uU(3),e.qZA(),e.YNc(4,hx,5,12,"button",9),e.qZA()}if(2&n){const t=e.oxw(),o=e.MAs(2);e.xp6(1),e.Q6J("target",o)("collapsed",t.filtersCollapsed),e.xp6(1),e.Q6J("ngStyle",e.VKq(5,fx,t.filtersCollapsed?"default":"pointer")),e.xp6(1),e.Oqu(t.layer.title),e.xp6(1),e.Q6J("ngIf",t.header)}}function yx(n,r){if(1&n&&e._UZ(0,"igo-layer-legend",12),2&n){const t=e.oxw();e.Q6J("layer",t.layer)}}let Gr=(()=>{class n{timeFilterService;color="primary";showLegend$=new y.X(!1);inResolutionRange$=new y.X(!0);resolution$$;filtersCollapsed=!1;header=!0;layer;get datasource(){return this.layer.dataSource}constructor(t){this.timeFilterService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}handleYearChange(t){this.timeFilterService.filterByYear(this.datasource,t)}handleDateChange(t){this.timeFilterService.filterByDate(this.datasource,t)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}setVisible(){this.layer.visible=!0}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(o){return new(o||n)(e.Y36(ep))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},decls:8,vars:7,consts:[[4,"ngIf"],[1,"igo-datasource-filters-container"],["filters",""],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer","options","currentValue","change","yearChange"],["matListItemIcon","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","",3,"ngStyle","click"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[3,"layer"]],template:function(o,i){1&o&&(e.YNc(0,_x,5,7,"mat-list-item",0),e.TgZ(1,"div",1,2)(3,"div",3,4),e.YNc(5,yx,1,1,"igo-layer-legend",5),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"igo-time-filter-form",6),e.NdJ("change",function(a){return i.handleDateChange(a)})("yearChange",function(a){return i.handleYearChange(a)}),e.qZA()()),2&o&&(e.Q6J("ngIf",i.header),e.xp6(5),e.Q6J("ngIf",e.lcZ(6,5,i.showLegend$)),e.xp6(2),e.Q6J("layer",i.layer)("options",i.datasource.options.timeFilter)("currentValue",i.datasource.options.params.TIME))},styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}"]})}return n})();function bx(n,r){if(1&n&&e._UZ(0,"igo-time-filter-item",2),2&n){const t=r.$implicit;e.Q6J("header",!0)("layer",t)}}let qr=(()=>{class n{cdRef;get layers(){return this._layers}set layers(t){this._layers=t,this.cdRef.detectChanges()}_layers=[];constructor(t){this.cdRef=t}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(o,i){1&o&&(e.TgZ(0,"igo-list",0),e.YNc(1,bx,1,2,"ng-template",1),e.ALo(2,"filterableDataSource"),e.qZA()),2&o&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.xi3(2,3,i.layers,"time")))},encapsulation:2,changeDetection:0})}return n})();function vx(n,r){}let mp=(()=>{class n{cdRef;ngControl;olOverlayLayer;olGeoJSON=new Ce.Z;ready=!1;drawControl;modifyControl;defaultDrawStyleRadius;olGeometryEnds$$;olGeometryChanges$$;olTooltip=this.createMeasureTooltip();activeControl;map;set geometryType(t){this._geometryType=t,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get geometryType(){return this._geometryType}_geometryType;drawGuide=null;measure=!1;get drawControlIsActive(){return this._drawControlIsActive}set drawControlIsActive(t){if(this._drawControlIsActive=t,!1!==this.ready){if(this.deactivateControl(),!this._drawControlIsActive)return;this.toggleControl()}}_drawControlIsActive=!0;get freehandDrawIsActive(){return this._freehandDrawIsActive}set freehandDrawIsActive(t){this._freehandDrawIsActive=t,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&this.drawControlIsActive&&this.toggleControl()}_freehandDrawIsActive;get predefinedRadius(){return this._predefinedRadius}set predefinedRadius(t){this._predefinedRadius=t,this.drawControl.ispredefinedRadius$.next(t)}_predefinedRadius;controlOptions={};set drawStyle(t){void 0===t&&(t=ap()),this._drawStyle=t;const o=this.getGuideStyleFromDrawStyle(t);this.defaultDrawStyleRadius=void 0!==o?o.getRadius():null,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get drawStyle(){return this._drawStyle}_drawStyle;set overlayStyle(t){this._overlayStyle=t}get overlayStyle(){return this._overlayStyle}_overlayStyle;set value(t){this._value=t,!1!==this.ready&&(t?this.addGeoJSONToOverlay(t):this.olOverlaySource.clear(!0),this.onChange(t),this.toggleControl(),this.cdRef.detectChanges())}get value(){return this._value}_value;get olOverlaySource(){return this.olOverlayLayer.getSource()}set radius(t){if(!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)){let o;setTimeout(()=>{o=this.modifyControl.olModifyInteraction,o&&o.features_&&(o.features_.clear(),this.addGeoJSONToOverlay(this.value))},0)}}constructor(t,o){this.cdRef=t,this.ngControl=o,void 0!==this.ngControl&&(this.ngControl.valueAccessor=this)}ngOnInit(){void 0===this.drawStyle&&(this.drawStyle=ap()),void 0===this.overlayStyle&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}ngOnDestroy(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}registerOnChange(t){this.onChange=t}onChange=()=>{};registerOnTouched(t){this.onTouched=t}onTouched=()=>{};writeValue(t){this.value=t}addOlOverlayLayer(){this.olOverlayLayer=new ti.Z({source:new Vt.Z,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}createDrawControl(){const t=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:"function"==typeof this.drawStyle?this.drawStyle:(o,i)=>{const s=this.drawStyle;return this.updateDrawStyleWithDrawGuide(s,i),s}});this.drawControl=new Qn(t)}createModifyControl(){const t=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:(o,i)=>{const s=this.drawStyle;return this.updateDrawStyleWithDrawGuide(s,i),s}});this.modifyControl=new pp(t)}toggleControl(){let t;t=!this.value&&this.geometryType?this.drawControl:this.modifyControl,t!==this.activeControl&&(this.deactivateControl(),this.activateControl(t))}activateControl(t){this.activeControl=t,this.olGeometryEnds$$=t.end$.subscribe(o=>this.onOlGeometryEnds(o)),!0===this.measure&&t===this.drawControl&&(this.olGeometryChanges$$=t.changes$.subscribe(o=>this.onOlGeometryChanges(o))),t.setOlMap(this.map.ol,!1)}deactivateControl(){this.removeMeasureTooltip(),void 0!==this.activeControl&&this.activeControl.setOlMap(void 0),void 0!==this.olGeometryEnds$$&&this.olGeometryEnds$$.unsubscribe(),void 0!==this.olGeometryChanges$$&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}onOlGeometryEnds(t){this.removeMeasureTooltip(),this.setOlGeometry(t)}onOlGeometryChanges(t){"Point"!==t.getType()&&this.updateMeasureTooltip(t)}setOlGeometry(t){let o;void 0!==t&&("Circle"===t.getType()&&(t=this.circleToPoint(t)),o=this.olGeoJSON.writeGeometryObject(t,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),t.get("radius")&&(o.radius=t.get("radius"),t.set("radius",o.radius)),this.writeValue(o))}circleToPoint(t){const o=t.getCenter(),i=Q.vs(o,this.map.projection,"EPSG:4326"),s=Math.round(t.getRadius()*Math.cos(Math.PI/180*i[1]));return(t=new Ee.Z(o)).set("radius",s,!0),t}addGeoJSONToOverlay(t){const o=this.olGeoJSON.readGeometry(t,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),i=new Ze.Z({geometry:o});i.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(i)}createMeasureTooltip(){return new op.Z({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}updateMeasureTooltip(t){const i=Pa(t,this.map.projection).lengths,s="Polygon"===t.getType()?i.length-2:i.length-1,a=i[s],l=ip(t),c=l[s];if(0===l.length||void 0===c)return void this.removeMeasureTooltip();this.olTooltip.setPosition(c.getFlatCoordinates());const u=Gn(a,{decimal:1,unit:K.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=u,void 0===this.olTooltip.getMap()&&this.map.ol.addOverlay(this.olTooltip)}removeMeasureTooltip(){this.olTooltip.getMap&&void 0!==this.olTooltip.getMap()&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}updateDrawStyleWithDrawGuide(t,o){const i=this.getGuideStyleFromDrawStyle(t);if(void 0===i)return;const s=this.drawGuide;let a;a=!s||s<0?this.defaultDrawStyleRadius:s>0?s/o:s,i.setRadius(a)}getGuideStyleFromDrawStyle(t){let o,i;return o=Array.isArray(t)?t[0]:t,"function"==typeof o.getImage&&(o=o.getImage()),"function"==typeof o.setRadius&&(i=o),i}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO),e.Y36(_.a5,10))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",predefinedRadius:"predefinedRadius",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},decls:1,vars:0,template:function(o,i){1&o&&e.YNc(0,vx,0,0,"ng-template")},encapsulation:2,changeDetection:0})}return n})(),nn=(()=>{class n{static forRoot(){return{ngModule:n,providers:[{provide:le.Ad,useValue:"fr-FR"}]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[ep,La,Ma,en],imports:[f.ez,_.u5,_.UX,Je.Bb,w.Ps,S.ot,ht.Nh,nt.Fk,Be.Tx,ve.p0,ni.dp,Ue.vV,ze.p9,fo.KP,tt.rP,F.lN,j.c,le.Ng,se.LD,Z.ie,P.AV,Ho.FA,le.XK,Rn.ni,Rn.IZ,re,kn,Ui,bi,vc,em,mn,Vu,ut.g]})}return n})();e.B6R(Yn,[f.O5,w.Hw,S.RK,P.gM,Nt,ut.k,Gr],[O.X$]),e.B6R(Gr,[f.mk,f.O5,f.PC,w.Hw,S.RK,Z.Tg,Z.Yt,Z.sL,Z.ni,P.gM,Pn,zi,gx],[f.Ov,O.X$]),e.B6R(qr,[f.sg,Nt,So,Gr],[Xu]),e.B6R(zu,[f.mk,f.sg,f.O5,Je.XC,le.ey,Je.ZL,w.Hw,S.RK,ze.oG,F.KE,F.R9,j.Nt,se.gD,P.gM,Ia],[f.Ov,O.X$,tn]),e.B6R(Nn,[f.O5,w.Hw,S.RK,P.gM,Nt,ut.k,Bn],[O.X$]),e.B6R(Ku,[f.sg,f.O5,f.PC,_._Y,_.Fj,_.JJ,_.JL,_.On,_.sg,_.u,Je.XC,le.ey,Je.ZL,w.Hw,nt.VQ,nt.U0,Ue.A9,Ue.Yi,ze.oG,F.KE,j.Nt,se.gD,Ve.d,P.gM,Ia],[f.Ov,O.X$]),e.B6R(Wu,[f.sg,f.O5,Nt,zu,Ku],[]),e.B6R(Bn,[f.mk,f.O5,f.PC,_.JJ,_.On,w.Hw,S.RK,ze.oG,Z.Tg,Z.Yt,Ve.d,Z.sL,Z.ni,P.gM,Pn,zi,Wu],[f.Ov,O.X$]),e.B6R(Jr,[f.sg,f.O5,Nt,So,Bn],[O.X$,Xu]),e.B6R(Na,[f.sg,le.ey,w.Hw,ht.uX,ht.SP,Ue.A9,Ue.Yi,F.KE,F.hX,se.gD,P.gM,zC],[O.X$]),e.B6R(Ra,[f.sg,f.O5,_._Y,_.Fj,_.wV,_.JJ,_.JL,_.F,_.oH,le.ey,w.Hw,S.lW,S.RK,nt.VQ,nt.U0,ve.BZ,ve.fO,ve.as,ve.w1,ve.nj,ve.ge,ve.XQ,ve.Gk,ni.GZ,ni.fQ,ni.eu,ni.gi,ni.uo,ni.Ar,ze.oG,tt.Rr,F.KE,F.hX,j.Nt,se.gD,P.gM,Si,mp],[f.Ov,O.X$]),e.B6R(Ia,[f.sg,f.O5,_.JJ,_.On,_.oH,le.ey,w.Hw,S.RK,tt.Rr,F.KE,F.hX,F.R9,j.Nt,se.gD,P.gM,Ho.Mq,Ho.hl,Ho.nW,t0],[O.X$]);let Cx=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[w.Ps,P.AV,_.u5,_.UX,f.ez,S.ot,Ue.vV,ht.Nh,se.LD,le.Ng,F.lN,j.c,tt.rP,re,Gs,mn,tm,pn]})}return n})();function xx(){return(0,ye.X$)("baseLayerSwitcherState",[(0,ye.SB)("collapseIcon",(0,ye.oB)({height:"40px",width:"40px",overflow:"hidden"})),(0,ye.SB)("expand",(0,ye.oB)({overflow:"hidden"})),(0,ye.eR)("collapse => expand",(0,ye.jt)("200ms")),(0,ye.eR)("expand => collapse",(0,ye.jt)("200ms"))])}function Sx(n,r){1&n&&(e.TgZ(0,"div",6)(1,"button",7),e.ALo(2,"translate"),e._UZ(3,"mat-icon",8),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function wx(n,r){if(1&n&&(e._UZ(0,"igo-mini-basemap",9),e.ALo(1,"translate")),2&n){const t=r.$implicit,o=r.index,i=e.oxw(2);e.Q6J("map",i.map)("baseLayer",t)("title",i.baseLayers.length>2&&!i.expand?e.lcZ(1,5,"igo.geo.baselayersSwitcher.title"):t.title)("display",i.expand||0===o&&!i.useStaticIcon)("disabled",!i.expand&&i.baseLayers.length>1)}}function Tx(n,r){1&n&&(e.TgZ(0,"div",10),e._UZ(1,"mat-icon",11),e.qZA())}const Fx=function(n){return{"container-expand":n}};function Ox(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",1),e.NdJ("@baseLayerSwitcherState.start",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.showButton=!1)})("@baseLayerSwitcherState.done",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.showButton=!0)})("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.collapseOrExpand())}),e.YNc(1,Sx,4,3,"div",2),e.TgZ(2,"div",3),e.YNc(3,wx,2,7,"igo-mini-basemap",4),e.qZA(),e.YNc(4,Tx,2,0,"div",5),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(5,Fx,t.expand))("@baseLayerSwitcherState",t.expand?"expand":t.useStaticIcon?"collapseIcon":""),e.xp6(1),e.Q6J("ngIf",t.useStaticIcon&&!t.expand&&t.showButton),e.xp6(2),e.Q6J("ngForOf",t.baseLayers),e.xp6(1),e.Q6J("ngIf",t.hasMoreThanTwo)}}let Ax=(()=>{class n{mediaService;map;useStaticIcon;_baseLayers=[];expand=!1;showButton=!0;layers$$;get hasMoreThanTwo(){return this.baseLayers.length>1}constructor(t){this.mediaService=t,this.mediaService.media$.value===to.Mobile&&void 0===this.useStaticIcon&&(this.useStaticIcon=!0)}ngAfterViewInit(){this.layers$$=this.map.layers$.subscribe(t=>{this._baseLayers=t.filter(o=>o.baseLayer)})}ngOnDestroy(){this.layers$$.unsubscribe()}collapseOrExpand(){this.expand=!(!this.hasMoreThanTwo&&!this.useStaticIcon||this.expand)}get baseLayers(){const t=this.map.viewController.getResolution(),o=this.map.viewController.getZoom(),i=this._baseLayers.filter(a=>(!a.options.maxResolution||t<=a.options.maxResolution)&&(!a.options.minResolution||t>=a.options.minResolution)&&(!a.options.source.options.maxZoom||o<=a.options.source.options.maxZoom)&&(!a.options.source.options.minZoom||o>=a.options.source.options.minZoom)),s=i.filter(a=>!a.visible);return s.length+1===i.length?s:i}static \u0275fac=function(o){return new(o||n)(e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"ngClass","click"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],[1,"basemap-list"],[3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],["class","more-baselayers",4,"ngIf"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],["svgIcon","image-multiple"],[3,"map","baseLayer","title","display","disabled"],[1,"more-baselayers"],["color","primary","svgIcon","menu-down",1,"material-icons","mat-icon"]],template:function(o,i){1&o&&e.YNc(0,Ox,5,7,"div",0),2&o&&e.Q6J("ngIf",i.baseLayers.length>0)},styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]{display:block}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]:not(:first-child){margin-top:4px}.igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"],data:{animation:[xx()]}})}return n})();function Lx(n,r){if(1&n&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.title)}}function Mx(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.changeBaseLayer(i.baseLayer))}),e._UZ(1,"igo-map-browser",3),e.YNc(2,Lx,2,1,"div",4),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("map",t.basemap),e.xp6(1),e.Q6J("ngIf",t.title)}}let hp=(()=>{class n{layerService;appRef;map;disabled;title;get display(){return this._display}set display(t){this._display=t,this.basemap.ol.getView().changed()}_display;get baseLayer(){return this._baseLayer}set baseLayer(t){this._baseLayer=t,this.handleBaseLayerChanged(t)}_baseLayer;basemap=new Xe({controls:{},interactions:!1});constructor(t,o){this.layerService=t,this.appRef=o}ngAfterViewInit(){this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",t=>{this.handleMainMapViewChange(t.target)}),this.map.ol.on("pointerdrag",t=>{this.handleMainMapViewChange(t.target.getView())})}ngOnDestroy(){this.map.viewController.olView.un("change",t=>{this.handleMainMapViewChange(t.target)}),this.map.ol.un("pointerdrag",t=>{this.handleMainMapViewChange(t.target.getView())})}changeBaseLayer(t){this.disabled||(this.map.changeBaseLayer(t),this.appRef.tick())}handleMainMapViewChange(t){const o=t.getProperties();this.basemap.viewController.olView.setResolution(o.resolution),this.basemap.viewController.olView.setRotation(o.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}handleBaseLayerChanged(t){this.basemap.removeAllLayers();const o=Object.assign(Object.create(t.options),t.options,{visible:!0,baseLayer:!1}),i=this.layerService.createLayer(o);this.basemap.addLayer(i),this.handleLinkedBaseLayer(i)}handleLinkedBaseLayer(t){const o=t.options.linkedLayers;if(!o)return;const s=o.links;s&&o.linkId===t.options.linkedLayers.linkId&&s.map(l=>{l.linkedIds.map(c=>{const u=this.map.layers.find(p=>p.options.linkedLayers?.linkId===c);if(u){const p=Object.assign(Object.create(u.options),u.options,{zIndex:9e3,visible:!0,baseLayer:!1});this.basemap.addLayer(this.layerService.createLayer(p))}})})}static \u0275fac=function(o){return new(o||n)(e.Y36(Se),e.Y36(e.z2F))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",title:"title",display:"display",baseLayer:"baseLayer"},decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Mx,3,2,"div",1),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",i.display))},styles:[".igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"],changeDetection:0})}return n})(),at=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,re,hc,w.Ps,S.ot,P.AV]})}return n})();function Ix(n,r){if(1&n&&(e.TgZ(0,"mat-option",5),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}e.B6R(Ax,[f.mk,f.sg,f.O5,w.Hw,S.RK,P.gM,hp],[O.X$]),e.B6R(hp,[f.O5,Le],[]);let Zx=(()=>{class n{measure$=new y.X(void 0);measure$$;measureType;measureUnit;set measure(t){this.measure$.next(t)}get measure(){return this.measure$.value}set auto(t){this.toggleAutoUnit(t)}get auto(){return this._auto}_auto=!1;placeholder;measureUnitChange=new e.vpe;get measureUnits(){return Object.values(this.measureType===so.Area?je:K)}constructor(){}ngOnDestroy(){this.toggleAutoUnit(!1)}onMeasureUnitChange(t){this.measureUnit=t,this.measureUnitChange.emit(t)}toggleAutoUnit(t){void 0!==this.measure$$&&this.measure$$.unsubscribe(),!0===t&&(this.measure$$=this.measure$.subscribe(o=>{this.computeBestMeasureUnit(o)})),this._auto=t}computeBestMeasureUnit(t){let o=this.measureUnit;this.measureType===so.Area?o=function oC(n){let r=je.SquareMeters,t=n;const o=[je.SquareKilometers];for(;t>1e6&&o.length>0;)r=o.pop(),t=Zi(n,r);return r}(t):this.measureType===so.Length&&(o=function tC(n){let r=K.Meters,t=n;const o=[K.Kilometers];for(;t>1e3&&o.length>0;)r=o.pop(),t=si(n,r);return r}(t)),o!==this.measureUnit&&this.onMeasureUnitChange(o)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},decls:9,vars:12,consts:[["floatLabel","always",1,"measure-field"],["matInput","",3,"disabled","readonly","value"],[1,"unit-field"],[3,"value","disabled","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-form-field",0)(1,"mat-label"),e._uU(2),e.qZA(),e._UZ(3,"input",1),e.ALo(4,"measureFormat"),e.ALo(5,"async"),e.qZA(),e.TgZ(6,"mat-form-field",2)(7,"mat-select",3),e.NdJ("selectionChange",function(a){return i.onMeasureUnitChange(a.value)}),e.YNc(8,Ix,3,4,"mat-option",4),e.qZA()()),2&o&&(e.xp6(2),e.Oqu(i.placeholder),e.xp6(1),e.Q6J("disabled",!0)("readonly",!0)("value",e.xi3(4,7,e.lcZ(5,10,i.measure$)||0,i.measureUnit)),e.xp6(4),e.Q6J("value",i.measureUnit)("disabled",i.auto),e.xp6(1),e.Q6J("ngForOf",i.measureUnits))},dependencies:[f.sg,F.KE,F.hX,j.Nt,se.gD,le.ey,f.Ov,O.X$,gp],styles:["[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}[_nghost-%COMP%]   .measure-field[_ngcontent-%COMP%]{pointer-events:none}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:-moz-fit-content;width:fit-content}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-select-min-line{padding-right:8px}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}return n})(),Px=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,S.ot,Ue.vV,B.Is,w.Ps,P.AV,F.lN,j.c,se.LD,tt.rP,Ve.t,re,gn]})}return n})();e.B6R(Ea,[f.O5,S.RK,Ue.A9,Ue.Yi,w.Hw,P.gM,tt.Rr,Ve.d,Si,Zx],[f.Ov,O.X$]),e.B6R(dp,[f.O5,B.uh,B.xY],[O.X$,gp]);let kx=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[Px]})}return n})(),$x=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,w.Ps,S.ot,se.LD,le.Ng,j.c,F.lN,tt.rP,re,mn]})}return n})();function Dx(n){return new Uu(n.getConfig(`searchSources.${Uu.id}`)||{})}let Ba=(()=>{class n{static forRoot(){return{ngModule:n,providers:[{provide:it,useFactory:Dx,multi:!0,deps:[N]}]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[xa],imports:[f.ez,re,Po]})}return n})(),Ja=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,P.AV,w.Ps,S.ot,Be.Tx,nt.Fk,ht.Nh,ze.p9,re]})}return n})(),Ua=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,P.AV,w.Ps,S.ot,Be.Tx,nt.Fk,ze.p9,Ve.t,tt.rP,re]})}return n})(),fp=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,P.AV,w.Ps,S.ot,Ve.t,Be.Tx,nt.Fk,F.lN,j.c,re,Ja,Ua]})}return n})(),_p=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,Ui,re,bi,lr,$n,pr,Je.Bb,ut.g,S.ot,B.Is,F.lN,w.Ps,j.c,Z.ie,se.LD,ht.Nh,P.AV,_.UX]})}return n})();class Bt{sources;constructor(r){this.sources=r}getSources(){return this.sources}getEnabledSources(){return this.getSources().filter(r=>!0===r.enabled)}enableSourcesByType(r){this.getSources().forEach(t=>{t.enabled=t.constructor.type===r})}setParamFromSetting(r,t){r.setParamFromSetting(t)}setWorkspaces(r,t){r.setWorkspaces(t)}}function Rx(n){return new Bt(n)}function Hn(n){return void 0!==n.search}function yp(n){return void 0!==n.reverseSearch}function Ga(n){return void 0!==n.reverseSearch&&!0===n.showInPointerSummary}function bp(n,r){let t="";return r.split("").forEach((o,i)=>{o!==n.charAt(i)&&(t+=o)}),t}function Pi(n,r,t=!1){if(!n||!r)return 0;const o=t?n:n.toString().toLowerCase(),i=t?r:r.toString().toLowerCase(),l=bp(o,i)+bp(i,o);let c=0;return l.length&&(c=l.length/o.length*100),100-Math.floor(c)}let Vn=(()=>{class n{searchSourceService;mapService;storageService;constructor(t,o,i){this.searchSourceService=t,this.mapService=o,this.storageService=i}search(t,o={}){if(!this.termIsValid(t))return[];const s=Hc(t,this.mapService.getMap()?.projection||"EPSG:3857",{forceNA:o.forceNA});if(s.lonLat)return this.reverseSearch(s.lonLat,{distance:s.radius,conf:s.conf});let a;return s.message&&console.log(s.message),o.extent=this.mapService.getMap()?.viewController.getExtent("EPSG:4326"),a=o.getEnabledOnly||void 0===o.getEnabledOnly?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),o.sourceId?a=a.filter(l=>l.getId()===o.sourceId):o.searchType&&(a=a.filter(l=>l.getType()===o.searchType)),a=a.filter(Hn),this.searchSources(a,t,o)}reverseSearch(t,o,i=!1){const s=i?Ga:yp,a=this.searchSourceService.getEnabledSources().filter(s),l=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1;return this.reverseSearchSources(a,t,o||{},l)}searchSources(t,o,i){return t.map(s=>({request:s.search(o,i),reverse:!1,source:s}))}reverseSearchSources(t,o,i,s){return t.map(a=>({request:a.reverseSearch(o,i,s),reverse:!0,source:a}))}termIsValid(t){return"string"==typeof t&&""!==t}static \u0275fac=function(o){return new(o||n)(e.LFG(Bt),e.LFG(Gt),e.LFG(oe))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),vp=(()=>{class n{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(o){return new(o||n)(e.LFG(L))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();class Eo extends it{languageService;static id="coordinatesreverse";static type=ie;projections;title$=new y.X("");get title(){return this.title$.getValue()}constructor(r,t,o,i){super(r,o),this.languageService=t,this.projections=i,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return Eo.id}getType(){return Eo.type}getDefaultOptions(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}reverseSearch(r,t,o){return(0,z.of)([this.dataToResult(r,t,o)])}dataToResult(r,t,o){const i=Vc(r),a=function I_(n,r){const t=Q.vs(n,"EPSG:4326","EPSG:3857"),o=[{code:"EPSG:3857",alias:"Web Mercator",coord:t,igo2CoordFormat:`${pt(t).join(", ")} ; 3857`}],i=function Z_(n){return Math.ceil((n[0]+180)/6)}(n),s=i<10?`EPSG:3260${i}`:`EPSG:326${i}`,a=`UTM-${i}`,l=Q.vs(n,"EPSG:4326",s);o.push({code:s,alias:"UTM",coord:l,igo2CoordFormat:`${a} ${pt(l).join(", ")}`});const c=function P_(n){const r=n[0];let t;return r<-51&&r>-54&&(t=1),r<-54&&r>-57&&(t=2),r<-57&&r>-60&&(t=3),r<-60&&r>-63&&(t=4),r<-63&&r>-66&&(t=5),r<-66&&r>-69&&(t=6),r<-69&&r>-72&&(t=7),r<-72&&r>-75&&(t=8),r<-75&&r>-78&&(t=9),r<-78&&r>-81&&(t=10),t}(n);if(c){const u=c<10?`EPSG:3218${c}`:`EPSG:321${80+c}`,p=`MTM-${c}`,d=Q.vs(n,"EPSG:4326",u);o.push({code:u,alias:"MTM",coord:d,igo2CoordFormat:`${p} ${pt(d).join(", ")}`})}return r.forEach(u=>{const p=Q.vs(n,"EPSG:4326",u.code),d=u.code.split(":")[1];o.push({code:u.code,alias:u.alias||u.code,coord:p,igo2CoordFormat:`${pt(p).join(", ")} ; ${d}`})}),o}(r,this.projections).reduce((m,b)=>(m[b.alias]=b.igo2CoordFormat,m),{}),l=o?pt(r,6).reverse().join(", "):pt(r,6).join(", "),c=o?i.reverse().join(", "):i.join(", ");let u={type:"Point",coordinates:[r[0],r[1]]};const p={};let d="";if(t.distance){p[this.languageService.translate.instant("igo.geo.search.coordinates.radius")]=t.distance,d="<br><small>Rayon: "+t.distance+" m</small>";const b=Q.vs([r[0],r[1]],"EPSG:4326","EPSG:3857"),C=new ii.Z(b,t.distance),x=(0,Rt.Bb)(C),A=new Ce.Z;u=JSON.parse(A.writeGeometry(x.transform("EPSG:3857","EPSG:4326")))}return t.conf&&(p[this.languageService.translate.instant("igo.geo.search.coordinates.conf")]=t.conf,d+=""===d?"<br>":"<small> - </small>",d+="<small>Confiance: "+t.conf+"%</small>"),p[this.languageService.translate.instant(o?"igo.geo.search.coordinates.reversedCoord":"igo.geo.search.coordinates.coord")]=l,p[this.languageService.translate.instant(o?"igo.geo.search.coordinates.reversedCoordDMS":"igo.geo.search.coordinates.coordDMS")]=c,{source:this,data:{type:ie,projection:"EPSG:4326",geometry:u,extent:void 0,properties:Object.assign(p,a,{GoogleMaps:Pt.getGoogleMapsCoordLink(r[0],r[1]),GoogleStreetView:Pt.getGoogleStreetViewLink(r[0],r[1]),OpenStreetMap:Ub.getOpenStreetMapLink(r[0],r[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:r[0].toString()+","+r[1].toString(),title:l}},meta:{dataType:ie,id:r[0].toString()+","+r[1].toString(),title:l,titleHtml:l+d,icon:"map-marker",score:100}}}static \u0275fac=function(t){return new(t||Eo)(e.LFG("options"),e.LFG(L),e.LFG(oe),e.LFG("projections"))};static \u0275prov=e.Yz7({token:Eo,factory:Eo.\u0275fac})}function Bx(n){return new vp(n)}function Ux(n,r,t,o){return new Eo(n.getConfig(`searchSources.${Eo.id}`),r,t,n.getConfig("projections")||[])}function Gx(){return{provide:it,useFactory:Ux,multi:!0,deps:[N,L,oe,On]}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[Array,Object,Boolean]),(0,T.w6)("design:returntype",ue.y)],Eo.prototype,"reverseSearch",null);var jr=v(70679);let Qr=(()=>{class n{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(o){return new(o||n)(e.LFG(L))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();class qx{encodeKey(r){return encodeURIComponent(r)}encodeValue(r){return encodeURIComponent(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}}class To extends it{http;languageService;formatter;static id="icherche";static type=ie;static propertiesBlacklist=[];title$=new y.X("");hashtagsLieuxToKeep=[];get title(){return this.title$.getValue()}constructor(r,t,o,i,s,a){super(i,o),this.http=r,this.languageService=t,this.formatter=s;const l=a.get(He);this.settings.length&&(l?l.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes()),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return To.id}getType(){return To.type}getDefaultOptions(){const r=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,o=this.options.params?.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"],i=this.options.showAdvancedSettings;return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==o.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==o.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==o.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:-1!==o.indexOf("bornes-cn"),hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==o.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:-1!==o.indexOf("cadastre"),hashtags:["cadastre"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==o.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==o.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.cycleStop",value:"haltes_cyclables",enabled:-1!==o.indexOf("haltes_cyclables"),hashtags:["haltevelo","haltes_cyclables"]},{title:"igo.geo.search.icherche.type.restArea",value:"haltes_routieres",enabled:-1!==o.indexOf("haltes_routieres"),hashtags:["halteroute","haltes_routieres"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:-1!==o.indexOf("hq"),hashtags:["hq"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:-1!==o.indexOf("intersections"),hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==o.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==o.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==o.indexOf("municipalites"),hashtags:["municipalit\xe9","mun"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==o.indexOf("regadmin"),hashtags:["r\xe9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:-1!==o.indexOf("bornes-gcc"),hashtags:["borne","bornes","rep\xe8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:-1!==o.indexOf("bornes-km"),hashtags:["borne","bornes","rep\xe8re","km"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==o.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:-1!==o.indexOf("sorties-autoroute"),hashtags:["sortie","sorties","exit"]},{title:"igo.geo.search.icherche.type.cultpatri",value:"culture",enabled:-1!==o.indexOf("culture"),hashtags:["grille","culture"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===r},{title:"5",value:5,enabled:5===r||!r},{title:"10",value:10,enabled:10===r},{title:"25",value:25,enabled:25===r},{title:"50",value:50,enabled:50===r}]},i&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t||!t},{title:"50 %",value:50,enabled:50===t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}].filter(Boolean)}}search(r,t){const o=this.computeRequestParams(r,t||{});return o.get("type").length?(this.options.params.page=o.get("page")||"1",this.getSearch(r,o)):(0,z.of)([])}getSearch(r,t){return this.http.get(`${this.searchUrl}/geocode`,{params:t}).pipe((0,I.U)(o=>this.extractResults(o,r)),(0,ce.K)(o=>{throw o.error.toDisplay=!0,o.error.title=this.languageService.translate.instant(this.getDefaultOptions().title),o}))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(r=>{const t=this.settings.find(o=>"type"===o.name);t.values.forEach(o=>{const i=new RegExp(`^${o.value}(\\.|$)`),s=r.filter(a=>i.test(a));o.available=s.length>0,"lieux"===o.value&&(this.hashtagsLieuxToKeep=[...new Set(s.map(a=>a.split(".")).reduce((a,l)=>a.concat(l)).filter(a=>"lieux"!==a))])}),this.setParamFromSetting(t,!1)})}computeRequestParams(r,t){const o=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(r,t||{}).params,{q:this.computeTerm(r),page:t.page});if("true"===o.loc){const[i,s,a,l]=t.extent;o.loc=`${i},${s};${a},${s};${a},${l};${i},${l};${i},${s}`}else"false"===o.loc&&delete o.loc;return/#[A-Za-z]+/.test(o.q)&&(o.type="lieux"),new $.LE({fromObject:R.removeUndefined(o),encoder:new qx})}extractResults(r,t){return r.features.map(o=>this.formatter.formatResult(this.dataToResult(o,t,r)))}dataToResult(r,t,o){const i=this.computeProperties(r),s=[this.getId(),i.type,i.code].join(".");return{source:this,data:{type:ie,projection:"EPSG:4326",geometry:r.geometry,extent:r.bbox,properties:i,meta:{id:s,title:r.properties.nom}},meta:{dataType:ie,id:s,title:r.properties.nom,titleHtml:(r.highlight.title||r.properties.nom)+(r.highlight.title2?" <small> "+r.highlight.title2+"</small>":"")+(r.highlight.title3?"<br><small> "+r.highlight.title3+"</small>":""),icon:r.icon||"map-marker",score:r.score||Pi(t.trim(),r.properties.nom),nextPage:o.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}}computeProperties(r){const t=R.removeKeys(r.properties,To.propertiesBlacklist);if(!r.geometry)return Object.assign({type:r.index},t);const o={GoogleMaps:""};let i,s;if("Point"===r.geometry.type)i=Pt.getGoogleMapsCoordLink(r.geometry.coordinates[0],r.geometry.coordinates[1]);else{const l=(0,jr.Z)(r.geometry);i=Pt.getGoogleMapsCoordLink(l.geometry.coordinates[0],l.geometry.coordinates[1])}s=Pt.getGoogleMapsNameLink("routes"===r.index?r.properties.nom+", "+r.properties.municipalite:"municipalites"===r.index?r.properties.nom+", ville":"mrc"===r.index?"mrc+"+r.properties.nom:"regadmin"===r.index?r.properties.nom+",+QC":r.properties.nom||r.highlight.title),o.GoogleMaps="<a href="+i+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+s+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===r.geometry.type&&(o.GoogleStreetView=Pt.getGoogleStreetViewLink(r.geometry.coordinates[0],r.geometry.coordinates[1]));const a={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:r.index},t,o,a)}computeTerm(r){let o=!1;return o=(r.match(/(#[A-Za-z]+)/g)||[]).some(i=>{const s=i.substring(1);return this.hashtagsLieuxToKeep.some(a=>a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),o||(r=r.replace(/(#[A-Za-z]+)/g,"")),r.replace(/[^\w\xc0-\xff !\-\+\(\)\.\/\xbd\xbc\xbe,'#]+/g,"")}computeOptionsParam(r,t){const o=super.getHashtagsValid(r,"type");return o&&(t.params=Object.assign(t.params||{},{type:o.join(",")})),t}static \u0275fac=function(t){return new(t||To)(e.LFG($.eN),e.LFG(L),e.LFG(oe),e.LFG("options"),e.LFG(Qr),e.LFG(e.zs3))};static \u0275prov=e.Yz7({token:To,factory:To.\u0275fac})}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[String,$.LE]),(0,T.w6)("design:returntype",ue.y)],To.prototype,"getSearch",null);class Fo extends it{http;languageService;static id="icherchereverse";static type=ie;static propertiesBlacklist=[];title$=new y.X("");get title(){return this.title$.getValue()}constructor(r,t,o,i,s){super(i,o),this.http=r,this.languageService=t,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))});const a=s.get(He);this.settings.length&&(a?a.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes())}getId(){return Fo.id}getType(){return Fo.type}getDefaultOptions(){const r=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==r.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==r.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==r.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==r.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==r.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==r.indexOf("regadmin")}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}}reverseSearch(r,t){const o=this.computeRequestParams(r,t||{});return o.get("type").length?this.getReverseSearch(o):(0,z.of)([])}getReverseSearch(r){return this.http.get(`${this.searchUrl}/locate`,{params:r}).pipe((0,I.U)(t=>this.extractResults(t)))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(r=>{const t=this.settings.find(o=>"type"===o.name);t.values.forEach(o=>{o.available=r.indexOf(o.value)>-1}),this.setParamFromSetting(t,!1)})}computeRequestParams(r,t){return(t.distance||this.options.distance)&&(t.params=Object.assign(t.params||{},{bufferInput:t.distance||this.options.distance})),new $.LE({fromObject:Object.assign({loc:r.join(","),sort:"distance",geometry:!0,icon:!0},t.params||{},this.params)})}extractResults(r){return r.features.map(t=>this.dataToResult(t))}getSubtitle(r){if(!this.settings.length)return"";let t="";if("arrondissements"===r.properties.type)t=r.properties.municipalite+" (Arrondissement)";else{const i=this.settings.find(s=>"type"===s.name).values.find(s=>s.value===r.properties.type);i&&(t=this.languageService.translate.instant(i.title))}return t}dataToResult(r){const t=this.computeProperties(r),o=this.computeExtent(r),i=[this.getId(),t.type,t.code].join("."),s=r.properties.nom,a=" <small> "+this.getSubtitle(r)+"</small>";return{source:this,data:{type:ie,projection:"EPSG:4326",geometry:r.geometry,extent:o,properties:t,meta:{id:i,title:r.properties.nom}},meta:{dataType:ie,id:i,title:r.properties.nom,titleHtml:s+a,icon:r.icon||"map-marker",pointerSummaryTitle:this.getSubtitle(r)+": "+r.properties.nom}}}computeProperties(r){const t=R.removeKeys(r.properties,Fo.propertiesBlacklist),o={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,o)}computeExtent(r){return r.bbox?[r.bbox[0],r.bbox[2],r.bbox[1],r.bbox[3]]:void 0}static \u0275fac=function(t){return new(t||Fo)(e.LFG($.eN),e.LFG(L),e.LFG(oe),e.LFG("options"),e.LFG(e.zs3))};static \u0275prov=e.Yz7({token:Fo,factory:Fo.\u0275fac})}function jx(n){return new Qr(n)}function Yx(n,r,t,o,i,s){return new To(n,r,t,o.getConfig(`searchSources.${To.id}`),i,s)}function Hx(){return{provide:it,useFactory:Yx,multi:!0,deps:[$.eN,L,oe,N,Qr,e.zs3]}}function Vx(n,r,t,o,i){return new Fo(n,r,t,o.getConfig(`searchSources.${Fo.id}`),i)}function zx(){return{provide:it,useFactory:Vx,multi:!0,deps:[$.eN,L,oe,N,e.zs3]}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[$.LE]),(0,T.w6)("design:returntype",ue.y)],Fo.prototype,"getReverseSearch",null);let Yr=(()=>{class n{mapService;route;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,o,i){this.mapService=o,this.route=i,this.component=t}ngOnInit(){this.layersOrResolutionChange$$=(0,Ye.a)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,ae.b)(10)).subscribe(t=>{const o=t[0].filter(i=>!0===i.showInLayerList);this.component.layers=o,this.setLayersVisibilityStatus(o,this.component.excludeBaseLayers)})}setLayersVisibilityStatus(t,o){void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0),this.layersVisibility$$=(0,Ye.a)(t.filter(i=>i.baseLayer!==o).map(i=>i.visible$)).pipe((0,I.U)(i=>i.every(Boolean))).subscribe(i=>this.component.layersAreAllVisible=i)}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(o){return new(o||n)(e.Y36(Mi,2),e.Y36(Gt),e.Y36(un,8))};static \u0275dir=e.lG2({type:n,selectors:[["","igoLayerListBinding",""]]})}return n})();function Wx(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleTrackFeature())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.layer.trackFeature"))("color",t.color)}}let Hr=(()=>{class n{layer;trackFeature=!1;get options(){if(this.layer)return this.layer.options}color="primary";constructor(){}ngOnInit(){this.color=this.trackFeature?"primary":"basic"}toggleTrackFeature(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","crosshairs-gps"]],template:function(o,i){1&o&&e.YNc(0,Wx,3,4,"button",0),2&o&&e.Q6J("ngIf",i.options.trackFeature)},dependencies:[f.O5,w.Hw,S.RK,P.gM,O.X$],changeDetection:0})}return n})(),Vr=(()=>{class n{languageService;constructor(t){this.languageService=t}formatResult(t){const o=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],i=Object.entries(t.properties).filter(([a])=>-1!==o.indexOf(a)).reduce((a,l)=>{const[c,u]=l;let p;try{p=this.languageService.translate.instant("igo.geo.search.ilayer.properties."+c)}catch{p=c}return a[p]=u||"",a},{}),s=Object.assign({},t);return s.properties=i,s}static \u0275fac=function(o){return new(o||n)(e.LFG(L))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();class Ro extends it{http;languageService;formatter;static id="ilayer";static type=Un;title$=new y.X("");get title(){return this.title$.getValue()}constructor(r,t,o,i,s){super(i,o),this.http=r,this.languageService=t,this.formatter=s,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return Ro.id}getType(){return Ro.type}getDefaultOptions(){const r=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===r},{title:"5",value:5,enabled:5===r||!r},{title:"10",value:10,enabled:10===r},{title:"25",value:25,enabled:25===r},{title:"50",value:50,enabled:50===r}]},this.options.showAdvancedSettings&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t},{title:"50 %",value:50,enabled:50===t||!t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]}].filter(Boolean)}}search(r,t){const o=this.computeSearchRequestParams(r,t||{});return o.get("q")&&o.get("type")?(this.options.params.page=o.get("page")||"1",this.getSearch(r,o)):(0,z.of)([])}getSearch(r,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,I.U)(o=>this.extractResults(o,r)))}computeSearchRequestParams(r,t){return new $.LE({fromObject:R.removeUndefined(Object.assign({q:this.computeTerm(r)},this.params,this.computeOptionsParam(r,t||{}).params,{page:t.page}))})}computeTerm(r){return r.replace(/(#[^\s]*)/g,"").replace(/[^\w\xc0-\xff !\-\(\),'#]+/g,"")}computeOptionsParam(r,t){const o=super.getHashtagsValid(r,"type");return o&&(t.params=Object.assign(t.params||{},{type:o.join(",")})),t}extractResults(r,t){return r.items.map(o=>this.dataToResult(o,t,r))}dataToResult(r,t,o){const i=this.computeLayerOptions(r),s=r.highlight.title||r.properties.title,a=r.highlight.groupTitle||r.properties.groupTitle,l=a?' <small style="color: #6f6969"> '+a+"</small>":"";return{source:this,meta:{dataType:Un,id:[this.getId(),r.properties.id].join("."),title:r.properties.title,titleHtml:s+l,icon:"Layer"===r.properties.type?"layers":"map",score:r.score||Pi(t.trim(),r.properties.name),nextPage:o.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:i}}computeLayerOptions(r){const t=r.properties.url,o=this.extractQueryParamsFromSourceUrl(t);return R.removeUndefined({sourceOptions:{id:r.properties.id,type:r.properties.format,url:t,queryFormat:o.queryFormat,queryHtmlTarget:o.queryHtmlTarget,params:"wms"===r.properties.format?{LAYERS:r.properties.name}:void 0,layer:"wms"===r.properties.format?void 0:r.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:r.properties.title,maxResolution:rt(Number(r.properties.maxScaleDenom)),minResolution:rt(Number(r.properties.minScaleDenom)),metadata:{url:r.properties.metadataUrl,extern:!!r.properties.metadataUrl||void 0,abstract:r.properties.abstract||void 0},properties:this.formatter.formatResult(r).properties})}extractQueryParamsFromSourceUrl(r){let t,o;const i=this.options.queryFormat;if(i){for(const s of Object.keys(i)){const a=i[s];if("*"===a){t=We[s.toUpperCase()];break}const l=a.urls;if(Array.isArray(l)){l.forEach(c=>{-1!==r.indexOf(c)&&(t=We[s.toUpperCase()])});break}}(t===We.HTML||t===We.HTMLGML2)&&(o="iframe")}return{queryFormat:t,queryHtmlTarget:o}}static \u0275fac=function(t){return new(t||Ro)(e.LFG($.eN),e.LFG(L),e.LFG(oe),e.LFG("options"),e.LFG(Vr))};static \u0275prov=e.Yz7({token:Ro,factory:Ro.\u0275fac})}function Xx(n){return new Vr(n)}function tS(n,r,t,o,i){return new Ro(n,r,t,o.getConfig(`searchSources.${Ro.id}`),i)}function oS(){return{provide:it,useFactory:tS,multi:!0,deps:[$.eN,L,oe,N,Vr]}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[String,$.LE]),(0,T.w6)("design:returntype",ue.y)],Ro.prototype,"getSearch",null);let qa=(()=>{class n{static forRoot(){return{ngModule:n,providers:[Vn,{provide:Bt,useFactory:Rx,deps:[it]},{provide:Qr,useFactory:jx,deps:[L]},{provide:vp,useFactory:Bx,deps:[L]},{provide:Vr,useFactory:Xx,deps:[L]}]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,fp,Ja,_p,Ua,fp,Ja,_p,Ua]})}return n})(),ja=(()=>{class n{styleList={};httpClient;constructor(t){this.httpClient=new $.eN(t)}getStyleList(t){return R.resolve(this.styleList,t)}load(t){const o=t.default||{};return t.path?new Promise((i,s)=>{this.httpClient.get(t.path).pipe((0,ce.K)(a=>(console.log(`StyleList file ${t.path} could not be read`),i(!0),(0,cn._)(a.error||"Server error")))).subscribe(a=>{this.styleList=R.mergeDeep(o,a),i(!0)})}):(this.styleList=o,!0)}static \u0275fac=function(o){return new(o||n)(e.LFG($.jN))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Cp=new e.OlP("styleListOptions");function xp(n){return{provide:Cp,useValue:n}}function iS(n,r){return()=>n.load(r)}let Sp=(()=>{class n{static forRoot(){return{ngModule:n,providers:[xp({}),{provide:e.ip1,useFactory:iS,multi:!0,deps:[ja,Cp]}]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})();var ai=function(n){return n.Arial="Arial",n.ArialBlack="Arial Black",n.Verdana="Verdana",n.Tahoma="Tahoma",n.TrebuchetMS="Trebuchet MS",n.Impact="Impact",n.TimesNewRoman="Times New Roman",n.Georgia="Georgia",n.AmericanTypewriter="American Typewriter",n.Courier="Courier",n.LucidaConsole="Lucida Console",n.BrushScriptMT="Brush Script MT",n.ComicSansMS="Comic Sans MS",n}(ai||{});let Qa=(()=>{class n{fillColor="rgba(255,255,255,0.4)";strokeColor="rgba(143,7,7,1)";strokeWidth=1;labelsAreShown=!0;icon;fontSize="15";fontStyle=ai.Arial.toString();offsetX=0;offsetY=0;constructor(){}getFillColor(){return this.fillColor}setFillColor(t){this.fillColor=t}getStrokeColor(){return this.strokeColor}setStrokeColor(t){this.strokeColor=t}getStrokeWidth(){return this.strokeWidth}getLabelsAreShown(){return this.labelsAreShown}toggleLabelsAreShown(){this.labelsAreShown=!this.labelsAreShown}setIcon(t){this.icon=t}getIcon(){return this.icon}getFontSize(){return this.fontSize}setFontSize(t){this.fontSize=t}getFontStyle(){return this.fontStyle}setFontStyle(t){this.fontStyle=t}getOffsetX(){return this.offsetX}setOffsetX(t){this.offsetX=t}getOffsetY(){return this.offsetY}setOffsetY(t){this.offsetY=t}createIndividualElementStyle(t,o,i,s,a,l,c,u,p,d){let g,h=!1;t.getGeometry()instanceof Ee.Z&&(h=!h);const b=i?t.get("draw"):"";t.set("_mapTitle",b);const C={text:b,stroke:{color:"white",width:.75},fill:{color:"black"},font:s,overflow:!0,offsetX:c,offsetY:u};let x;if(t.get("rad")){const A=(0,Q.vs)(t.getGeometry().flatCoordinates,p,"EPSG:4326"),M=t.get("rad")/Math.cos(Math.PI/180*A[1])/o;return x={text:C,circle:{radius:M,stroke:{color:l||this.strokeColor,width:this.strokeWidth},fill:{color:a}}},t.set("_style",x),g=new J.ZP({text:new St.Z({text:b,stroke:new U.Z({color:"white",width:.75}),fill:new q.Z({color:"black"}),font:s,overflow:!0,offsetX:c,offsetY:u}),image:new Te.Z({radius:M,stroke:new U.Z({color:l||this.strokeColor,width:this.strokeWidth}),fill:new q.Z({color:a})})}),g}return d?(this.offsetY=-26,C.offsetY=this.offsetY,t.set("_style",{text:C,stroke:{color:l,width:this.strokeWidth},fill:{color:a},icon:{src:d}}),g=new J.ZP({text:new St.Z({text:i?t.get("draw"):"",stroke:new U.Z({color:"white",width:.75}),fill:new q.Z({color:"black"}),font:s,overflow:!0,offsetX:c,offsetY:u}),stroke:new U.Z({color:l,width:this.strokeWidth}),fill:new q.Z({color:a}),image:new Fi.Z({src:d})}),g):(this.offsetY=h?-15:0,C.offsetY=this.offsetY,t.set("_style",{text:C,stroke:{color:l,width:this.strokeWidth},fill:{color:a},circle:{radius:5,stroke:{color:l,width:this.strokeWidth},fill:{color:a}}}),g=new J.ZP({text:new St.Z({text:i?t.get("draw"):"",stroke:new U.Z({color:"white",width:.75}),fill:new q.Z({color:"black"}),font:s,overflow:!0,offsetX:c,offsetY:u}),stroke:new U.Z({color:l,width:this.strokeWidth}),fill:new q.Z({color:a}),image:new Te.Z({radius:5,stroke:new U.Z({color:l,width:this.strokeWidth}),fill:new q.Z({color:a})})}),g)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),rS=(()=>{class n{static forRoot(){return{ngModule:n,providers:[yo,Qa]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,re,F.lN,w.Ps,S.ot,B.Is,j.c,se.LD,P.AV,_.UX,xh,Sp.forRoot(),Sp]})}return n})(),sS=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,S.ot,B.Is,Ue.vV]})}return n})(),wp=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,S.ot,re,nn]})}return n})(),aS=(()=>{class n{cdRef;layer;map;complete=new e.vpe;cancel=new e.vpe;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}onClose(){this.cancel.emit()}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(o,i){1&o&&e._UZ(0,"igo-ogc-filterable-item",0),2&o&&e.Q6J("layer",i.layer)("header",!1)("map",i.map)},dependencies:[Bn],changeDetection:0})}return n})();const Ya=new e.OlP("OgcFilterWidget");function lS(n){return n.create(aS)}function cS(){return{provide:Ya,useFactory:lS,deps:[Hs]}}let Tp=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez]})}return n})(),Fp=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez]})}return n})(),uS=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[cS()],imports:[f.ez,re,Lc,Tp,Fp,wp,B.Is,Tp,Fp,wp,sS]})}return n})(),pS=(()=>{class n{el;component;get feature(){return this.component.feature}feature$=new y.X(void 0);routingEvent=new e.vpe;setFeature(){this.feature$.next(this.feature)}constructor(t,o){this.el=o,this.component=t}ngOnInit(){this.feature$.subscribe(()=>{this.feature.geometry&&this.bindClicking()})}bindClicking(){setTimeout(()=>{const t=this.el.nativeElement.querySelector("span.routing");t&&t.addEventListener("click",()=>{this.routingEvent.emit()})},1)}static \u0275fac=function(o){return new(o||n)(e.Y36(Jn,2),e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","igoFeatureDetailsDirective",""]],hostBindings:function(o,i){1&o&&e.NdJ("selectFeature",function(){return i.setFeature()})},outputs:{routingEvent:"routingEvent"}})}return n})(),Ha=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({})}return n})(),Op=(()=>{class n{messageService;constructor(t){this.messageService=t}open(t){this.messageService.success("igo.geo.download.start","igo.geo.download.title");const o=t.dataSource.options;if(Object.keys(o.download).length>0)if(o.download.dynamicUrl&&void 0===o.download.url){let i,s=new xn.Z({code:t.map.projection});const a=t.dataSource.options.paramsWFS;a&&Object.keys(a).length>0?(s=a.srsName?new xn.Z({code:a.srsName}):s,i=t.dataSource.options.paramsWFS):i=t.dataSource.options.params;const l=Q.$A(t.map.viewController.getExtent(),new xn.Z({code:t.map.projection}),s),c=void 0===i.outputFormatDownload?void 0===i.outputFormat?"":"outputformat="+i.outputFormat:"outputformat="+i.outputFormatDownload,u=o.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),p=t.dataSource.options.ogcFilters;let d;d=(new Jt).handleOgcFiltersAppliedValue(t.dataSource.options,p.geometryName,l,s),d=d?"filter="+encodeURIComponent(d):(new Jt).buildFilter(void 0,l,s,p.geometryName),window.open(`${u}&${d}&${c}`,"_blank")}else o.download&&window.open(o.download.url,"_blank")}static \u0275fac=function(o){return new(o||n)(e.LFG(_e))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function dS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openDownload(i.layer))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.download.action"))("color",t.color)}}let gS=(()=>{class n{downloadService;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t){this.downloadService=t}openDownload(t){this.downloadService.open(t)}get options(){if(this.layer)return this.layer.dataSource.options}static \u0275fac=function(o){return new(o||n)(e.Y36(Op))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","download"]],template:function(o,i){1&o&&e.YNc(0,dS,3,4,"button",0),2&o&&e.Q6J("ngIf",i.options&&i.options.download&&(i.options.download.dynamicUrl||i.options.download.url))},dependencies:[f.O5,w.Hw,S.RK,P.gM,O.X$],changeDetection:0})}return n})();var $e=function(n){return n.Point="Point",n.LineString="LineString",n.Polygon="Polygon",n.Circle="Circle",n}($e||{}),X=function(n){return n.Coordinates="Coordinates",n.Length="Length",n.Area="Area",n.Predefined="Predefined",n.Custom="Custom",n}(X||{}),rn=function(n){return n.DecimalDegree="DD",n.DegreesMinutesSeconds="DMS",n}(rn||{});let mS=(()=>{class n{config;icons;constructor(t){this.config=t,this.getIconsList()}getIcons(){return this.icons}getPath(){return this.config.getConfig("drawingTool.icons")||[]}getIconsList(){this.icons=this.getPath()}static \u0275fac=function(o){return new(o||n)(e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Va(n,r,t,o){return new J.ZP({stroke:new U.Z({color:r||"rgba(143,7,7,1)",width:t||1}),fill:new q.Z({color:n||"rgba(255,255,255,0.4)"}),image:new Te.Z({radius:5,stroke:new U.Z({color:r||"rgba(143,7,7,1)",width:t||1}),fill:new q.Z({color:n||"rgba(255,255,255,0.4)"})})})}function Lp(n,r){let o=new Map([[rn.DecimalDegree,i=>zc("number"==typeof i[0]?i:[Number(i[0]),Number(i[1])],5)],[rn.DegreesMinutesSeconds,i=>Vc(i,2)]]).get(r);return o?o(n):void 0}var hS=v(6482);function fS(n,r){1&n&&(e.ynx(0),e.TgZ(1,"span"),e._UZ(2,"mat-icon",21),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"igo-color-picker-form-field",22),e.BQk()),2&n&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"igo.geo.style.fill")," "))}function _S(n,r){if(1&n&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}let yS=(()=>{class n{dialogRef;formBuilder;drawStyleService;data;confirmFlag=!1;form;styleModalData;linestringOnly;constructor(t,o,i,s){this.dialogRef=t,this.formBuilder=o,this.drawStyleService=i,this.data=s}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.features)"LineString"!==t.geometry.type&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getFeatureFillColor()],stroke:[this.getFeatureStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):ai.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}get allFontStyles(){return Object.values(ai)}getFeatureFontSize(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}getFeatureFontStyle(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):ai.Arial}getFeatureFillColor(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}cancelDrawing(){this.dialogRef.close()}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(o){return new(o||n)(e.Y36(B.so),e.Y36(_.QS),e.Y36(Qa),e.Y36(B.WI))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-style-modal-drawing"]],inputs:{confirmFlag:"confirmFlag"},decls:46,vars:29,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"edition-drawing",3,"hidden"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],["svgIcon","square-outline",1,"stroke-palette-icon"],["formControlName","stroke"],[1,"igo-input-container"],["subscriptSizing","dynamic",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"value","input"],["testFontSize",""],["matTextSuffix",""],[3,"value","selectionChange"],["testFontStyle",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"value","input"],["offsetXInput",""],["offsetYInput",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["svgIcon","square",1,"stroke-palette-icon"],["formControlName","fill"],[3,"value"]],template:function(o,i){1&o&&(e.TgZ(0,"h2",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"form",2)(5,"div",3),e.YNc(6,fS,6,3,"ng-container",4),e.TgZ(7,"span"),e._UZ(8,"mat-icon",5),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._UZ(11,"igo-color-picker-form-field",6),e.qZA(),e.TgZ(12,"div",7)(13,"mat-form-field",8)(14,"mat-label"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"input",9,10),e.NdJ("input",function(a){return i.styleModalData.fontSize=a.target.value}),e.qZA(),e.TgZ(19,"span",11),e._uU(20,"px"),e.qZA()(),e.TgZ(21,"mat-form-field",8)(22,"mat-label"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"mat-select",12,13),e.NdJ("selectionChange",function(a){return i.styleModalData.fontStyle=a.value}),e.YNc(27,_S,2,2,"mat-option",14),e.qZA()(),e.TgZ(28,"mat-form-field",8)(29,"mat-label"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"input",15,16),e.NdJ("input",function(a){return i.styleModalData.offsetX=a.target.value}),e.qZA()(),e.TgZ(34,"mat-form-field",8)(35,"mat-label"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.TgZ(38,"input",15,17),e.NdJ("input",function(a){return i.styleModalData.offsetY=a.target.value}),e.qZA()()()()(),e.TgZ(40,"div",18)(41,"button",19),e.NdJ("click",function(){return i.cancelDrawing()}),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"button",20),e.NdJ("click",function(){return i.confirm()}),e._uU(45,"OK"),e.qZA()()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,15,"igo.geo.style.styleModal"),"\n"),e.xp6(2),e.Q6J("hidden",0===i.data.features.length),e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(2),e.Q6J("ngIf",!0!==i.linestringOnly),e.xp6(3),e.hij(" ",e.lcZ(10,17,"igo.geo.style.stroke")," "),e.xp6(6),e.Oqu(e.lcZ(16,19,"igo.geo.style.fontSize")),e.xp6(2),e.Q6J("value",i.getFeatureFontSize()),e.xp6(6),e.Oqu(e.lcZ(24,21,"igo.geo.style.fontStyle")),e.xp6(2),e.Q6J("value",i.getFeatureFontStyle()),e.xp6(2),e.Q6J("ngForOf",i.allFontStyles),e.xp6(3),e.Oqu(e.lcZ(31,23,"igo.geo.style.offsetX")),e.xp6(2),e.Q6J("value",i.getFeatureOffsetX()),e.xp6(4),e.Oqu(e.lcZ(37,25,"igo.geo.style.offsetY")),e.xp6(2),e.Q6J("value",i.getFeatureOffsetY()),e.xp6(4),e.hij(" ",e.lcZ(43,27,"igo.geo.style.cancel")," "))},dependencies:[f.sg,f.O5,_._Y,_.JJ,_.JL,F.KE,F.hX,F.R9,w.Hw,S.lW,B.uh,B.xY,B.H8,j.Nt,se.gD,le.ey,_.sg,_.u,Gc,O.X$],styles:["[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{padding-top:16px}[_nghost-%COMP%]   .fill-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .stroke-field[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{width:25px;height:25px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}[_nghost-%COMP%]   .igo-form-input-box[_ngcontent-%COMP%]{width:150px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}"]})}return n})(),bS=(()=>{class n{dialogRef;confirmFlag=!1;constructor(t){this.dialogRef=t}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.dialogRef.close(t)}static \u0275fac=function(o){return new(o||n)(e.Y36(B.so))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},decls:14,vars:9,consts:[["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["input",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-form-field",2),e._UZ(5,"input",3,4),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"div",5)(9,"button",6),e.NdJ("click",function(){return i.cancelDrawing()}),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"button",7),e.NdJ("click",function(){e.CHM(s);const l=e.MAs(6);return e.KtG(i.confirm(l.value))}),e._uU(13," OK "),e.qZA()()}2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),e.xp6(3),e.s9C("placeholder",e.lcZ(7,5,"igo.geo.draw.layer.title")),e.xp6(5),e.hij(" ",e.lcZ(11,7,"igo.geo.draw.cancel")," "))},dependencies:[S.lW,F.KE,j.Nt,B.xY,B.H8,O.X$],styles:["[_nghost-%COMP%]   .fields-container[_ngcontent-%COMP%]{display:flex}"]})}return n})();function vS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-radio-button",11),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onLabelTypeChange(i.value))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t.value)("disabled",o.optionAvailable(t.value))("checked",t.checked),e.xp6(1),e.hij(" ",o.getProperLengthLabel(t.value)," ")}}function CS(n,r){if(1&n&&(e.TgZ(0,"mat-radio-group"),e.YNc(1,vS,2,4,"mat-radio-button",10),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.arrayBuiltInType)}}function xS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-checkbox",13),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onLabelTypeChange(i.source.value,i.checked))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t.value)("disabled",o.optionAvailable(t.value))("checked",t.checked),e.xp6(1),e.hij(" ",o.getProperLengthLabel(t.value)," ")}}function SS(n,r){if(1&n&&(e.ynx(0),e.YNc(1,xS,2,4,"mat-checkbox",12),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.arrayBuiltInType)}}function wS(n,r){if(1&n&&(e.TgZ(0,"mat-option",5),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function TS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e._uU(3,"(Latitude, Longitude)"),e.qZA(),e._UZ(4,"input",16,17),e.qZA(),e.TgZ(6,"mat-form-field",18)(7,"mat-select",19),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onChangeCoordinateUnit(i.value))}),e.YNc(8,wS,2,2,"mat-option",20),e.qZA()()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.s9C("value",t.currentCoordinates),e.xp6(3),e.Q6J("value",t.coordinatesMeasureUnit),e.xp6(1),e.Q6J("ngForOf",t.allCoordinatesUnits)}}function FS(n,r){if(1&n&&(e.TgZ(0,"mat-option",5),e._uU(1),e.qZA()),2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t),e.xp6(1),e.hij(" ",o.getLengthUnitEnum(t)," ")}}function OS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e._uU(3),e.qZA(),e._UZ(4,"input",21,17),e.qZA(),e.TgZ(6,"mat-form-field",18)(7,"mat-select",19),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onChangeLengthUnit(i.value))}),e.YNc(8,FS,2,2,"mat-option",20),e.qZA()()()}if(2&n){const t=e.oxw(2);e.xp6(3),e.Oqu(t.lengthLabelT),e.xp6(1),e.s9C("placeholder",t.lengthLabelT),e.s9C("value",t.currentLength),e.xp6(3),e.Q6J("value",t.lengthMeasureUnit),e.xp6(1),e.Q6J("ngForOf",t.allLengthUnits)}}function AS(n,r){if(1&n&&(e.TgZ(0,"mat-option",5),e._uU(1),e.qZA()),2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("value",t),e.xp6(1),e.hij(" ",o.getAreaUnitEnum(t)," ")}}function LS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"input",21,17),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"mat-form-field",18)(9,"mat-select",19),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onChangeAreaUnit(i.value))}),e.YNc(10,AS,2,2,"mat-option",20),e.qZA()()()}if(2&n){const t=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,5,"igo.geo.draw.labelType.Area")),e.xp6(2),e.s9C("placeholder",e.lcZ(7,7,"igo.geo.draw.labelType.Area")),e.s9C("value",t.currentArea),e.xp6(4),e.Q6J("value",t.areaMeasureUnit),e.xp6(1),e.Q6J("ngForOf",t.allAreaUnits)}}function MS(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onLabelTypeChange(i.value))}),e.TgZ(4,"mat-button-toggle",5),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-button-toggle",5),e._uU(8),e.ALo(9,"translate"),e.qZA()()(),e.TgZ(10,"div")(11,"p"),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.YNc(14,CS,2,1,"mat-radio-group",1),e.YNc(15,SS,2,1,"ng-container",1),e.YNc(16,TS,9,3,"div",6),e.YNc(17,OS,9,5,"div",6),e.YNc(18,LS,11,9,"div",6),e.qZA()(),e.TgZ(19,"div",7)(20,"button",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancelDrawing())}),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.confirm())}),e._uU(24),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("value",t.customOrPredefined),e.xp6(1),e.Q6J("value",t.labelType.Custom),e.xp6(1),e.hij(" ",e.lcZ(6,13,"igo.geo.draw.labelType.custom")," "),e.xp6(2),e.Q6J("value",t.labelType.Predefined),e.xp6(1),e.hij(" ",e.lcZ(9,15,"igo.geo.draw.labelType.predefined")," "),e.xp6(4),e.hij(" ",e.lcZ(13,17,"igo.geo.draw.builtInInstructions")," "),e.xp6(2),e.Q6J("ngIf","Polygon"!==t.olGeometryType),e.xp6(1),e.Q6J("ngIf","Polygon"===t.olGeometryType),e.xp6(1),e.Q6J("ngIf",t.labelFlag===t.labelType.Coordinates),e.xp6(1),e.Q6J("ngIf",t.labelFlag===t.labelType.Length||2===t.polygonCheck),e.xp6(1),e.Q6J("ngIf",t.labelFlag===t.labelType.Area||2===t.polygonCheck),e.xp6(3),e.hij(" ",e.lcZ(22,19,"igo.geo.draw.cancel")," "),e.xp6(3),e.hij(" ",t.noLabelButton()," ")}}function IS(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onLabelTypeChange(i.value))}),e.TgZ(4,"mat-button-toggle",5),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-button-toggle",5),e._uU(8),e.ALo(9,"translate"),e.qZA()()(),e.TgZ(10,"p"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"mat-form-field",22)(14,"mat-label"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"input",23,17),e.NdJ("select",function(){return!0})("input",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.getLabelLength(i.target.value))}),e.ALo(19,"translate"),e.qZA()()(),e.TgZ(20,"div",7)(21,"button",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancelDrawing())}),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(18),s=e.oxw();return e.KtG(s.confirm(i.value))}),e._uU(25),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("value",t.customOrPredefined),e.xp6(1),e.Q6J("value",t.labelType.Custom),e.xp6(1),e.hij(" ",e.lcZ(6,11,"igo.geo.draw.labelType.custom")," "),e.xp6(2),e.Q6J("value",t.labelType.Predefined),e.xp6(1),e.hij(" ",e.lcZ(9,13,"igo.geo.draw.labelType.predefined")," "),e.xp6(3),e.hij(" ",e.lcZ(12,15,"igo.geo.draw.dialogInstruction")," "),e.xp6(4),e.Oqu(e.lcZ(16,17,"igo.geo.draw.dialogTitle")),e.xp6(2),e.s9C("placeholder",e.lcZ(19,19,"igo.geo.draw.dialogTitle")),e.s9C("value",t.currentLabel),e.xp6(5),e.hij(" ",e.lcZ(23,21,"igo.geo.draw.cancel")," "),e.xp6(3),e.hij(" ",t.noLabelButton()," ")}}let ZS=(()=>{class n{languageService;dialogRef;data;confirmFlag=!1;labelFlag=X.Custom;coordinatesMeasureUnit;lengthMeasureUnit;areaMeasureUnit;geometryType=$e;labelType=X;arrayBuiltInType=[];currentLabel;currentCoordinates;currentArea;currentLength;olGeometryType=void 0;lengthInMeters;areaInMetersSquare;coordinatesInDD;currentCoordinatesUnit;longlatDD;labelLength;polygonCheck=0;constructor(t,o,i){let s;this.languageService=t,this.dialogRef=o,this.data=i,this.currentLabel=this.data.olGeometry.get("draw"),this.labelLength=this.currentLabel?this.currentLabel.length:0;const a=this.data.map.ol.getView().getProjection();if(this.data.olGeometry instanceof Ze.Z)if(this.data.olGeometry.get("rad")){const l=[this.data.olGeometry.get("longitude"),this.data.olGeometry.get("latitude")];this.olGeometryType=$e.Circle,s=new ii.Z(l,this.data.olGeometry.get("rad"))}else this.olGeometryType=this.data.olGeometry.getGeometry().getType(),s=this.data.olGeometry.get("geometry");else this.olGeometryType=this.data.olGeometry.getType(),s=this.data.olGeometry;if(this.olGeometryType===$e.Point||this.olGeometryType===$e.Circle){if(this.data.olGeometry instanceof Ze.Z){let l=this.data.olGeometry.get("longitude"),c=this.data.olGeometry.get("latitude");this.longlatDD=pt([l,c],5),this.coordinatesInDD="("+c+", "+l+")"}else{let l=(0,Q.vs)(this.data.olGeometry.getFlatCoordinates(),a,"EPSG:4326");this.longlatDD=pt([l[0],l[1]],5),this.coordinatesInDD="("+this.longlatDD[1]+", "+this.longlatDD[0]+")"}this.currentCoordinates=this.coordinatesInDD}if(this.olGeometryType===$e.LineString)this.lengthInMeters=on(s,a.getCode()).toFixed(2),this.currentLength=this.lengthInMeters;else if(this.olGeometryType===$e.Polygon)this.lengthInMeters=on(s,a.getCode()).toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=qn(s,a.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare;else if(this.olGeometryType===$e.Circle){let l=(0,Rt.Bb)(s,1e4);const c=this.getRadius(l);this.lengthInMeters=c.toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=qn(l,a.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare}i.olGeometry.get("labelType")===X.Coordinates?(this.onLabelTypeChange(X.Predefined),this.onLabelTypeChange(X.Coordinates,!0),this.coordinatesMeasureUnit=i.olGeometry.get("measureUnit")):i.olGeometry.get("labelType")===X.Length?(this.onLabelTypeChange(X.Predefined),this.onLabelTypeChange(X.Length,!0),this.lengthMeasureUnit=i.olGeometry.get("measureUnit")):i.olGeometry.get("labelType")===X.Area?(this.onLabelTypeChange(X.Predefined),this.onLabelTypeChange(X.Area,!0),this.areaMeasureUnit=i.olGeometry.get("measureUnit")):2===i.olGeometry.get("labelType")?.length&&(this.onLabelTypeChange(X.Predefined),this.onLabelTypeChange(X.Length,!0),this.onLabelTypeChange(X.Area,!0),this.lengthMeasureUnit=i.olGeometry.get("measureUnit")[0],this.areaMeasureUnit=i.olGeometry.get("measureUnit")[1]),this.buildArrayType()}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.labelFlag===X.Predefined?this.dialogRef.close():this.labelFlag===X.Custom?this.dialogRef.close({label:t}):this.labelFlag===X.Coordinates?this.dialogRef.close({label:this.currentCoordinates,measureUnit:this.coordinatesMeasureUnit}):this.olGeometryType===$e.Polygon?2===this.polygonCheck?(this.labelFlag=[X.Length,X.Area],this.dialogRef.close({label:"P: "+this.currentLength+" "+wo[K.Meters]+"\n"+this.languageService.translate.instant("igo.geo.draw.labelType.A")+this.currentArea+" "+ri[je.SquareMeters],measureUnit:[this.lengthMeasureUnit,this.areaMeasureUnit]})):this.dialogRef.close(this.labelFlag===X.Length?{label:"P: "+this.currentLength+" "+wo[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}:{label:this.currentArea+" "+ri[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit}):this.labelFlag===X.Length?this.olGeometryType===$e.Circle?this.dialogRef.close({label:"R: "+this.currentLength+" "+wo[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.olGeometryType===$e.LineString&&this.dialogRef.close({label:this.currentLength+" "+wo[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.labelFlag===X.Area&&this.dialogRef.close({label:this.currentArea+" "+ri[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit})}onLabelTypeChange(t,o){t!==X.Predefined&&t!==X.Custom&&this.olGeometryType===$e.Polygon?(this.arrayBuiltInType.find(s=>s.value===t)?this.arrayBuiltInType.find(s=>s.value===t).checked=o:this.labelFlag=void 0,this.labelFlag=o?t:this.arrayBuiltInType.find(s=>s.checked)?.value):this.labelFlag=t,t===X.Predefined?this.olGeometryType===$e.Point?(this.labelFlag=X.Coordinates,this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=rn.DecimalDegree):this.olGeometryType===$e.LineString&&(this.labelFlag=X.Length,this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=K.Meters):t===X.Area?(this.currentArea=this.areaInMetersSquare,this.areaMeasureUnit=je.SquareMeters):t===X.Length?(this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=K.Meters):this.labelFlag===X.Coordinates&&(this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=rn.DecimalDegree),this.olGeometryType===$e.Polygon&&[this.labelType.Length,this.labelType.Area].includes(t)?o?this.polygonCheck+=1:this.polygonCheck-=1:this.polygonCheck=0}onChangeLengthUnit(t){this.lengthMeasureUnit=t,this.currentLength=si(Number(this.lengthInMeters),t).toFixed(2)}onChangeAreaUnit(t){this.areaMeasureUnit=t,this.currentArea=Zi(Number(this.areaInMetersSquare),t).toFixed(2)}onChangeCoordinateUnit(t){this.coordinatesMeasureUnit=t;let o=Lp(this.longlatDD,t);this.currentCoordinates="("+o[1]+", "+o[0]+")"}buildArrayType(){for(const t of Object.values(X))t!==X.Custom&&t!==X.Predefined&&this.arrayBuiltInType.push({value:t,checked:this.selectOptions(t)||this.labelFlag===t||2===this.polygonCheck&&t!==X.Coordinates})}noLabelButton(){return this.labelFlag===X.Predefined||this.labelFlag===X.Custom&&0===this.labelLength?this.languageService.translate.instant("igo.geo.draw.noLabel"):"OK"}get customOrPredefined(){return this.labelFlag===X.Custom?X.Custom:X.Predefined}optionAvailable(t){switch(this.olGeometryType){case $e.Point:return t!==X.Coordinates;case $e.LineString:return t!==X.Length;case $e.Polygon:return t===X.Coordinates;default:return!1}}get allLengthUnits(){return Object.values(K)}getLengthUnitEnum(t){return wo[t]}get allAreaUnits(){return Object.values(je)}get allCoordinatesUnits(){return Object.values(rn)}getAreaUnitEnum(t){return ri[t]}getRadius(t){const o=(0,Hi.xA)(t);return Number(o/(2*Math.PI))}get lengthLabelT(){return this.languageService.translate.instant(this.olGeometryType===$e.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===$e.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length")}getLabelLength(t){this.labelLength=t.length}selectOptions(t){return this.olGeometryType===$e.Point?t===X.Coordinates:this.olGeometryType===$e.LineString?t===X.Length:void 0}getProperLengthLabel(t){return this.languageService.translate.instant(t===X.Length?this.olGeometryType===$e.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===$e.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length":"igo.geo.draw.labelType."+t)}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(B.so),e.Y36(B.WI))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag",labelFlag:"labelFlag",coordinatesMeasureUnit:"coordinatesMeasureUnit",lengthMeasureUnit:"lengthMeasureUnit",areaMeasureUnit:"areaMeasureUnit"},decls:5,vars:5,consts:[["mat-dialog-title",""],[4,"ngIf"],["mat-dialog-content","",1,"geometry-type-toggle"],[1,"button-toggle-container"],[3,"value","change"],[3,"value"],["class","fields-container",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[3,"value","disabled","checked","change"],["class","mat-typography",3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","disabled","checked","change"],[1,"fields-container"],[1,"readOnly-Input"],["matInput","","placeholder","(Latitude, Longitude)","readonly","",3,"value"],["input",""],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"placeholder","value"],[1,"input"],["matInput","","cdkFocusInitial","",3,"placeholder","value","select","input"]],template:function(o,i){1&o&&(e.TgZ(0,"h2",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.YNc(3,MS,25,21,"ng-container",1),e.YNc(4,IS,26,23,"ng-container",1)),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.draw.popupTitle"),"\n"),e.xp6(2),e.Q6J("ngIf",i.labelFlag!==i.labelType.Custom),e.xp6(1),e.Q6J("ngIf",i.labelFlag===i.labelType.Custom))},dependencies:[f.sg,f.O5,S.lW,Ue.A9,Ue.Yi,F.KE,F.hX,j.Nt,se.gD,le.ey,B.uh,B.xY,B.H8,nt.VQ,nt.U0,ze.oG,O.X$],styles:["[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .readOnly-Input[_ngcontent-%COMP%]{width:200px!important}[_nghost-%COMP%]   .button-toggle-container[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:-moz-fit-content;width:fit-content}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-select-min-line{padding-right:24px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{position:sticky!important}[_nghost-%COMP%]   .coordinatesInputView[_ngcontent-%COMP%]{top:5em!important}[_nghost-%COMP%]   .mat-mdc-dialog-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-end}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{width:auto!important}[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"]})}return n})(),PS=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-draw-shorcuts"]],decls:24,vars:12,consts:[[1,"shortcut","mat-typography"],["svgIcon","keyboard-return",1,"shortcut-icon"],["svgIcon","backspace-outline",1,"shortcut-icon"],["svgIcon","keyboard-esc",1,"shortcut-icon"],["svgIcon","keyboard-space",1,"shortcut-icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-dialog-content")(1,"div")(2,"span",0),e._UZ(3,"mat-icon",1),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"div")(7,"span",0),e._UZ(8,"mat-icon",2),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.TgZ(11,"div")(12,"span",0),e._UZ(13,"mat-icon",3),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e.TgZ(16,"div")(17,"span",0),e._UZ(18,"mat-icon",4),e._uU(19),e.ALo(20,"translate"),e.qZA()()(),e.TgZ(21,"mat-dialog-actions",5)(22,"button",6),e._uU(23,"OK"),e.qZA()()),2&o&&(e.xp6(4),e.Oqu(e.lcZ(5,4,"igo.geo.draw.finish")),e.xp6(5),e.Oqu(e.lcZ(10,6,"igo.geo.draw.undo")),e.xp6(5),e.Oqu(e.lcZ(15,8,"igo.geo.draw.abort")),e.xp6(5),e.Oqu(e.lcZ(20,10,"igo.geo.draw.move")))},dependencies:[S.lW,w.Hw,B.ZT,B.xY,B.H8,O.X$],styles:[".shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}"]})}return n})();const kS=["selectedLayer"];function $S(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",5),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleFreehandMode(i))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("checked",t.freehandMode)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.draw.freehandMode")," ")}}function DS(n,r){if(1&n&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+t)," ")}}function ES(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",24)(1,"form",25)(2,"mat-form-field",26),e._UZ(3,"input",27),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"mat-form-field",28)(6,"mat-select",10),e.NdJ("selectionChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onMeasureUnitChange(i.value))}),e.YNc(7,DS,3,4,"mat-option",12),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,5,"igo.geo.spatialFilter.radius")),e.Q6J("formControl",t.radiusFormControl)("readonly",t.freehandMode),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function RS(n,r){if(1&n&&(e.TgZ(0,"mat-option",2),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.title," ")}}function NS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.activeDrawingLayer.visible=!i.activeDrawingLayer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",30),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("color",t.activeDrawingLayer.visible?"primary":"default")("matTooltip",t.activeDrawingLayer.visible?e.lcZ(1,3,"igo.geo.layer.hideLayer"):e.lcZ(2,5,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("svgIcon",t.activeDrawingLayer.visible?"eye":"eye-off")}}function BS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.deleteDrawings())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",32),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.draw.delete"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}function JS(n,r){if(1&n&&(e.TgZ(0,"div",36),e._UZ(1,"img",37),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.s9C("src",t.icon,e.LSH)}}function US(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-option",38),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onIconChange(s))}),e.TgZ(1,"div",36),e._UZ(2,"img",37),e.qZA()()}if(2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(2),e.s9C("src",t,e.LSH)}}function GS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select")(5,"mat-select-trigger"),e.YNc(6,JS,2,1,"div",33),e.qZA(),e.TgZ(7,"mat-option",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onIconChange())}),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.YNc(10,US,3,2,"mat-option",35),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.draw.icon")),e.xp6(4),e.Q6J("ngIf",t.icon),e.xp6(2),e.Oqu(e.lcZ(9,6,"igo.geo.draw.noIcon")),e.xp6(2),e.Q6J("ngForOf",t.icons)}}function qS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openStyleModalDialog())}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e._UZ(4,"mat-icon",40),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.style.styleModalTooltipSelected")),e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.geo.style.styleModal")," "),e.xp6(2),e.Q6J("matBadge",t.selectedFeatures$.value.length)}}let Mp=(()=>{class n{languageService;formBuilder;drawStyleService;dialog;drawIconService;tableTemplate;geometryType=$e;map;get stores(){return this._stores}set stores(t){this._stores=t}_stores=[];get drawControls(){return this._drawControls}set drawControls(t){this._drawControls=t}_drawControls=[];get activeDrawingLayer(){return this._activeDrawingLayer}set activeDrawingLayer(t){this._activeDrawingLayer=t}_activeDrawingLayer;activeLayerChange=new e.vpe;drawControlsEvent=new e.vpe;layersIDEvent=new e.vpe;fillColor;strokeColor;strokeWidth;fontSize;fontStyle;activeStore;layerCounterID=0;draw$=new y.X({});activeDrawingLayerSource=new Vt.Z;activeDrawControl;drawEnd$$;drawSelect$$;selectedFeatures$=new y.X([]);fillForm;strokeForm;drawControlIsDisabled=!0;drawControlIsActive=!1;labelsAreShown;freehandMode=!1;subscriptions$$=[];position="bottom";form;icons;icon;radiusFormControl=new _.p4(1e3);measureUnit=K.Meters;radiusFormControlChange$$=new hS.w0;predefinedRadius$=new y.X(void 0);radiusDrawEnd$=new y.X(void 0);get measureUnits(){return[K.Meters,K.Kilometers]}numberOfDrawings;isCreatingNewLayer=!1;currGeometryType=this.geometryType.Point;select;constructor(t,o,i,s,a){this.languageService=t,this.formBuilder=o,this.drawStyleService=i,this.dialog=s,this.drawIconService=a,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),valueAccessor:l=>l.properties.draw},{name:"Edition",title:"",sort:!1,valueAccessor:l=>[{editMode:!1,icon:"pencil",color:"primary",click:()=>{this.editLabelDrawing(l)},style:"mat-icon-button"}],renderer:wt.ButtonGroup}]},this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}ngOnInit(){this.stores.length?(this.activeStore=this.stores.find(t=>t.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(t=>t[0]===this.activeDrawingLayer.id)[1],this.deactivateDrawControl(),this.allLayers.forEach(t=>{t.id!==this.activeDrawingLayer.id&&(t.opacity=0);let o=this.stores.find(i=>i.layer.id===t.id);this.subscriptions$$.push(o.stateView.manyBy$(i=>!0===i.state.selected).pipe((0,Lt.P)()).subscribe(i=>{i.forEach(s=>{s.state.selected=!1})})),this.subscriptions$$.push(o.stateView.manyBy$(i=>!0===i.state.selected).pipe((0,Ci.T)(1)).subscribe(i=>{this.selectedFeatures$.next(i.map(s=>s.entity))})),this.subscriptions$$.push(o.count$.subscribe(i=>{this.activeStore.layer.options.showInLayerList=i>=1}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new yt([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer)),this.radiusFormControlChange$$=this.radiusFormControl.valueChanges.subscribe(t=>{this.activeDrawControl.ispredefinedRadius$.getValue()&&this.changeRadius(t)})}ngOnDestroy(){this.allLayers.forEach(t=>t.opacity=1),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(t=>t.unsubscribe()),this.radiusFormControlChange$$.unsubscribe()}createDrawControl(t,o,i){return new Qn({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new J.ZP({}),interactionStyle:Va(t,o,i)})}initStore(t,o){this.createLayer(t,o),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(i=>!0===i.state.selected).pipe((0,Ci.T)(1)).subscribe(i=>{this.selectedFeatures$.next(i.map(s=>s.entity))})),this.subscriptions$$.push(this.activeStore.count$.subscribe(i=>{this.activeStore.layer.options.showInLayerList=i>=1}))}openStyleModalDialog(){setTimeout(()=>{const t=this.dialog.open(yS,{disableClose:!1,data:{features:this.selectedFeatures$.getValue(),icons:this.icons,icon:this.icon},autoFocus:!1});t.afterClosed().subscribe(o=>{t.componentInstance.confirmFlag&&(this.onFontChange(this.labelsAreShown,o.fontSize,o.fontStyle),this.onColorChange(this.labelsAreShown,!!this.icon,o.fillColor,o.strokeColor),this.onOffsetLabelChange(this.labelsAreShown,o.offsetX,o.offsetY))})},250)}openDrawDialog(t,o){setTimeout(()=>{const i=this.dialog.open(ZS,{disableClose:!1,data:{olGeometry:t,map:this.map}});i.afterClosed().subscribe(s=>{i.componentInstance.confirmFlag?(this.updateLabelOfOlGeometry(t,s.label),this.updateLabelType(t,i.componentInstance.labelFlag),this.updateMeasureUnit(t,s.measureUnit),t instanceof Ze.Z||(this.updateFontSizeAndStyle(t,"15",ai.Arial),this.updateFillAndStrokeColor(t,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),this.updateOffset(t,0,t instanceof Ee.Z?-15:0)),o?this.onDrawEnd(t):this.onSelectDraw(t,s.label,[i.componentInstance.labelFlag,s.measureUnit]),this.updateHeightTable()):this.activeDrawingLayerSource.getFeatures().forEach(a=>{const l=a.getGeometry();t===l&&this.activeDrawingLayerSource.removeFeature(a)})})},250)}onDrawEnd(t,o){this.addFeatureToStore(t,o),this.clearLabelsOfOlGeometry(t),this.activeStore.layer.ol.getSource().refresh()}onModifyDraw(t){this.activeStore.all().forEach(i=>{if(i.properties.id===t.ol_uid){if(i.properties.labelType===X.Coordinates){let l=Lp([i.properties.longitude,i.properties.latitude],i.properties.measureUnit);this.updateLabelOfOlGeometry(t,"("+l[1]+", "+l[0]+")")}else if(i.properties.labelType===X.Length)if(t instanceof ii.Z){let l=(0,Rt.Bb)(t,1e4);const c=si(this.getRadius(l),i.properties.measureUnit),u=wo[i.properties.measureUnit],p="R: "+c.toFixed(2).toString()+" "+u;this.updateLabelOfOlGeometry(t,p)}else{let c,l=on(t,this.map.ol.getView().getProjection().getCode());c=wo[i.properties.measureUnit],l=si(l,i.properties.measureUnit);let p=t instanceof Rt.ZP?"P: "+l.toFixed(2).toString()+" "+c:l.toFixed(2).toString()+" "+c;this.updateLabelOfOlGeometry(t,p)}else if(i.properties.labelType===X.Area)if(t instanceof ii.Z){let c=qn((0,Rt.Bb)(t,1e4),this.map.ol.getView().getProjection().getCode());const u=ri[i.properties.measureUnit];c=Zi(c,i.properties.measureUnit);const d=c.toFixed(2).toString()+" "+u;this.updateLabelOfOlGeometry(t,d)}else{let c,l=qn(t,this.map.ol.getView().getProjection().getCode());c=ri[i.properties.measureUnit],l=Zi(l,i.properties.measureUnit);const p=l.toFixed(2).toString()+" "+c;this.updateLabelOfOlGeometry(t,p)}else this.updateLabelOfOlGeometry(t,i.properties.draw);this.updateLabelType(t,i.properties.labelType),this.updateMeasureUnit(t,i.properties.measureUnit),this.updateFontSizeAndStyle(t,i.properties.fontStyle.split(" ")[0].replace("px",""),i.properties.fontStyle.substring(i.properties.fontStyle.indexOf(" ")+1)),this.updateFillAndStrokeColor(t,i.properties.drawingStyle.fill,i.properties.drawingStyle.stroke),this.updateOffset(t,i.properties.offsetX,i.properties.offsetY),this.replaceFeatureInStore(i,t)}})}onSelectDraw(t,o,i){const s=this.activeStore.all(),a=t.getGeometry();a.ol_uid=t.get("id");const l=JSON.stringify(a.getCoordinates()[0]);s.forEach(c=>{const u=JSON.stringify(c.geometry.coordinates[0]);if(l===u){const p=t.get("fontStyle").split(" ")[0].replace("px",""),d=t.get("fontStyle").substring(t.get("fontStyle").indexOf(" ")+1),g=t.get("drawingStyle").fill,h=t.get("drawingStyle").stroke,m=t.get("offsetX"),b=t.get("offsetY"),C=c.properties.rad?c.properties.rad:void 0;this.updateLabelOfOlGeometry(a,o),this.updateFontSizeAndStyle(a,p,d),this.updateFillAndStrokeColor(a,g,h),this.updateOffset(a,m,b),this.updateLabelType(a,i[0]),this.updateMeasureUnit(a,i[1]),this.replaceFeatureInStore(c,a,C)}})}addFeatureToStore(t,o,i){let s,a,l,c,u;const p=i?i.properties.id:t.ol_uid,d=this.map.ol.getView().getProjection(),g=(new Ce.Z).writeGeometryObject(t,{featureProjection:d,dataProjection:d});if(t instanceof ii.Z||o)if(o)s=o;else{g.type="Point",g.coordinates=t.getCenter();const h=(0,Q.vs)([t.getFlatCoordinates()[2],t.getFlatCoordinates()[3]],d,"EPSG:4326");a=(0,Q.vs)([t.getFlatCoordinates()[0],t.getFlatCoordinates()[1]],d,"EPSG:4326"),c=a[0],u=a[1],s=(0,Hi.Sp)(a,h),this.radiusFormControl.setValue(Math.round(s))}this.activeDrawControl.radiusDrawEnd$.getValue()&&(s=this.activeDrawControl.radiusDrawEnd$.getValue()),t instanceof Ee.Z&&(l=(0,Q.vs)(t.getFlatCoordinates(),d,"EPSG:4326"),c=l[0],u=l[1]),this.activeStore.update({type:ie,geometry:g,projection:d.getCode(),properties:{id:p,draw:t.get("_label"),longitude:c||null,latitude:u||null,rad:s||null,fontStyle:t.get("fontStyle_"),drawingStyle:{fill:t.get("fillColor_"),stroke:t.get("strokeColor_")},offsetX:t.get("offsetX_"),offsetY:t.get("offsetY_"),labelType:t.get("labelType_"),measureUnit:t.get("measureUnit_")},meta:{id:p}}),this.activeStore.setLayerExtent(),this.activeDrawControl.predefinedRadius$.next(void 0),this.activeDrawControl.radiusDrawEnd$.next(void 0)}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}setupLayer(t){setTimeout(()=>{const o=this.dialog.open(bS,{disableClose:!1});o.afterClosed().subscribe(i=>{o.componentInstance.confirmFlag?(this.activeStore.state.updateAll({selected:!1}),this.activeStore=new yt([],{map:this.map}),this.activeDrawingLayerSource=new Vt.Z,this.activeDrawingLayer.opacity=0,this.deactivateDrawControl(),this.initStore(i,t),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.isCreatingNewLayer=!1,this.labelsAreShown||this.onToggleLabels(),this.activeLayerChange.emit(this.activeDrawingLayer)):(this.select.value=this.activeDrawingLayer,this.select.selectionChange.emit(this.activeDrawingLayer))})},250)}editLabelDrawing(t){const o=ft(t,this.map.ol.getView().getProjection().getCode());this.openDrawDialog(o,!1)}openShorcutsDialog(){this.dialog.open(PS)}deleteDrawings(){this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.activeDrawingLayerSource.getFeatures().forEach(o=>{const i=o.getGeometry();t.properties.id===i.ol_uid&&this.activeDrawingLayerSource.removeFeature(o)})}),this.updateHeightTable(),this.activeStore.setLayerExtent()}onToggleLabels(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.elementStyle(this.labelsAreShown,!!this.icon),this.createDrawControl()}onToggleDrawControl(t){t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleFreehandMode(t){this.isCircle()&&!t.checked?(this.activeDrawControl.ispredefinedRadius$.next(!0),this.changeRadius(this.radiusFormControl.value)):(this.activeDrawControl.setOlInteractionStyle(Va(this.fillColor,this.strokeColor,this.strokeWidth)),this.activeDrawControl.ispredefinedRadius$.next(!1)),this.freehandMode=t.checked,this.activeDrawControl.freehand$.next(t.checked),this.toggleDrawControl()}onLayerChange(t){t?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=t,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(o=>o.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(o=>o[0]===this.activeDrawingLayer.id)[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}createLayer(t,o){for(const i of this.allLayers){let s=Number(i.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(s,this.layerCounterID)}this.activeDrawingLayer=new xe({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:o?t:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new Ae,style:(i,s)=>this.drawStyleService.createIndividualElementStyle(i,s,this.labelsAreShown,i.get("fontStyle"),i.get("drawingStyle").fill,i.get("drawingStyle").stroke,i.get("offsetX"),i.get("offsetY"),this.map.projection,this.icon),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),oi(this.activeStore,this.activeDrawingLayer),Yi(this.activeStore,new qt({motion:Y.None})),ya(this.activeStore,new Tt({map:this.map,motion:Y.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",i=>{const s=i.feature.getGeometry();this.clearLabelsOfOlGeometry(s)})}onColorChange(t,o,i,s){this.selectedFeatures$.value.length>0&&!o&&this.selectedFeatures$.value.forEach(a=>{let l=ft(a,this.map.ol.getView().getProjection().getCode());this.updateFillAndStrokeColor(l,i,s);const c=this.activeStore.all().find(u=>u.meta.id===l.getId());c.properties.drawingStyle.fill=l.get("fillColor_"),c.properties.drawingStyle.stroke=l.get("strokeColor_"),this.activeStore.update(c)}),this.elementStyle(t,o),this.createDrawControl()}onFontChange(t,o,i){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(s=>{let a=ft(s,this.map.ol.getView().getProjection().getCode());this.updateFontSizeAndStyle(a,o,i);const l=this.activeStore.all().find(c=>c.meta.id===a.getId());l.properties.fontStyle=a.get("fontStyle_"),this.activeStore.update(l),a=this.activeStore.layer.ol.getSource().getFeatures().find(c=>c.getId()===l.meta.id),a.setProperties({fontStyle:l.properties.fontStyle}),a.changed()}),this.fontSize=o,this.fontStyle=i,this.drawStyleService.setFontSize(o),this.drawStyleService.setFontStyle(i),this.elementStyle(t))}onOffsetLabelChange(t,o,i){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(s=>{let a=ft(s,this.map.ol.getView().getProjection().getCode());this.updateOffset(a,o,i);const l=this.activeStore.all().find(c=>c.meta.id===a.getId());l.properties.offsetX=a.get("offsetX_"),l.properties.offsetY=a.get("offsetY_"),this.activeStore.update(l),a=this.activeStore.layer.ol.getSource().getFeatures().find(c=>c.getId()===l.meta.id),a.setProperties({offsetX:l.properties.offsetX,offsetY:l.properties.offsetY}),a.changed()}),this.elementStyle(t))}onIconChange(t){this.icon=t,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}onGeometryTypeChange(t){this.currGeometryType=t,this.activeDrawControl.setGeometryType(t),this.onToggleFreehandMode(this.freehandMode?{checked:!0}:{checked:!1}),this.toggleDrawControl()}updateLabelOfOlGeometry(t,o){t.setProperties({_label:o},!0)}updateFontSizeAndStyle(t,o,i){t.setProperties({fontStyle_:`${o}px ${i}`},!0)}updateFillAndStrokeColor(t,o,i){t.setProperties({fillColor_:o,strokeColor_:i},!0)}updateOffset(t,o,i){t.setProperties({offsetX_:o,offsetY_:i},!0)}updateLabelType(t,o){t.setProperties({labelType_:o},!0)}updateMeasureUnit(t,o){t.setProperties({measureUnit_:o},!0)}getFeatureFontSize(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"15"}getFeatureFontStyle(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):ai.Arial}getFeatureFillColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}get allFontStyles(){return Object.values(ai)}get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-draw-layer"))}updateHeightTable(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.tableTemplate.tableHeight=this.numberOfDrawings>10?"35vh":"auto"}updateActiveLayer(){return this.allLayers.find(o=>o.title===this.activeDrawingLayer.title)||this.allLayers[0]}toggleDrawControl(){this.deactivateDrawControl(),this.activateDrawControl()}clearLabelsOfOlGeometry(t){Ur(t).forEach(o=>{o&&o.getMap()&&this.map.ol.removeOverlay(o)})}replaceFeatureInStore(t,o,i){this.activeStore.delete(t),this.onDrawEnd(o,i)}deactivateDrawControl(){this.activeDrawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}activateDrawControl(){this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(t=>{this.openDrawDialog(t,!0)}),this.activeDrawControl.modify$.subscribe(t=>{this.onModifyDraw(t)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(t=>{this.openDrawDialog(t,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}isPoint(){return this.activeDrawControl.getGeometryType()===this.geometryType.Point}isLineString(){return this.activeDrawControl.getGeometryType()===this.geometryType.LineString}isPolygon(){return this.activeDrawControl.getGeometryType()===this.geometryType.Polygon}isCircle(){return this.activeDrawControl.getGeometryType()===this.geometryType.Circle}changeRadius(t){let o;o=t?this.measureUnit===K.Meters?t:1e3*t:void 0,this.activeDrawControl.setOlInteractionStyle((s,a)=>{const l=s.getGeometry(),c=Q.vs(l.getCoordinates(),this.map.projection,"EPSG:4326"),u=o/Math.cos(Math.PI/180*c[1])/a;return this.activeDrawControl.predefinedRadius$.next(o),new J.ZP({image:new Te.Z({radius:u,stroke:new U.Z({width:1,color:"rgba(143,7,7,1)"}),fill:new q.Z({color:"rgba(255,255,255,0.4)"})})})}),this.toggleDrawControl()}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.radiusFormControl.setValue(this.measureUnit===K.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}elementStyle(t,o){this.activeStore.layer.ol.setStyle(o?(i,s)=>this.drawStyleService.createIndividualElementStyle(i,s,t,i.get("fontStyle"),i.get("drawingStyle").fill,i.get("drawingStyle").stroke,i.get("offsetX"),i.get("offsetY"),this.map.projection,this.icon):(i,s)=>this.drawStyleService.createIndividualElementStyle(i,s,t,i.get("fontStyle"),i.get("drawingStyle").fill,i.get("drawingStyle").stroke,i.get("offsetX"),i.get("offsetY"),this.map.projection))}getRadius(t){const o=(0,Hi.xA)(t);return Number(o/(2*Math.PI))}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_.QS),e.Y36(Qa),e.Y36(B.uw),e.Y36(mS))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-draw"]],viewQuery:function(o,i){if(1&o&&e.Gf(kS,5),2&o){let s;e.iGM(s=e.CRH())&&(i.select=s.first)}},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},decls:50,vars:47,consts:[[1,"geometry-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"draw-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[3,"checked","labelPosition","change"],[3,"checked","labelPosition","change",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"layer-select-container"],["subscriptSizing","dynamic",1,"layer-select"],[3,"value","selectionChange"],["selectedLayer",""],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[1,"icon-options"],[4,"ngIf"],[1,"actions-container"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["svgIcon","keyboard-outline","tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"radius-unit"],[1,"radius-form"],[1,"radius"],["matInput","","type","number","min","0",3,"placeholder","formControl","readonly"],[1,"unit-field"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"svgIcon"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"value","click"],["mat-raised-button","","color","primary",3,"matTooltip","click"],["aria-hidden","false","iconPositionEnd","","svgIcon","palette","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.NdJ("change",function(l){return i.onGeometryTypeChange(l.value)}),e.TgZ(3,"mat-button-toggle",2),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-button-toggle",2),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-button-toggle",2),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-button-toggle",2),e._uU(13),e.ALo(14,"translate"),e.qZA()()(),e.TgZ(15,"div",3)(16,"mat-slide-toggle",4),e.NdJ("change",function(l){return i.onToggleDrawControl(l.checked)}),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"mat-slide-toggle",5),e.NdJ("change",function(){return i.onToggleLabels()}),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.YNc(22,$S,3,5,"mat-slide-toggle",6),e.YNc(23,ES,8,7,"div",7),e.qZA(),e._UZ(24,"mat-divider"),e.TgZ(25,"div",8)(26,"mat-form-field",9)(27,"mat-label"),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"mat-select",10,11),e.NdJ("selectionChange",function(){e.CHM(s);const l=e.MAs(31);return e.KtG(i.onLayerChange(l.value))}),e.YNc(32,RS,2,2,"mat-option",12),e.TgZ(33,"mat-option",13),e._uU(34),e.ALo(35,"translate"),e.qZA()()(),e.YNc(36,NS,4,7,"button",14),e.qZA(),e._UZ(37,"mat-divider"),e.TgZ(38,"div"),e.YNc(39,BS,4,6,"button",15),e.TgZ(40,"div"),e._UZ(41,"igo-entity-table",16,17),e.qZA()(),e.TgZ(43,"div",18),e.YNc(44,GS,11,8,"mat-form-field",19),e.qZA(),e.TgZ(45,"div",20)(46,"button",21),e.NdJ("click",function(){return i.openShorcutsDialog()}),e._UZ(47,"mat-icon",22),e.ALo(48,"translate"),e.qZA(),e.YNc(49,qS,5,7,"button",23),e.qZA()()}2&o&&(e.xp6(2),e.Q6J("value",i.geometryType.Point),e.xp6(1),e.Q6J("value",i.geometryType.Point),e.xp6(1),e.hij(" ",e.lcZ(5,29,"igo.geo.draw."+i.geometryType.Point)," "),e.xp6(2),e.Q6J("value",i.geometryType.LineString),e.xp6(1),e.hij(" ",e.lcZ(8,31,"igo.geo.draw."+i.geometryType.LineString)," "),e.xp6(2),e.Q6J("value",i.geometryType.Polygon),e.xp6(1),e.hij(" ",e.lcZ(11,33,"igo.geo.draw."+i.geometryType.Polygon)," "),e.xp6(2),e.Q6J("value",i.geometryType.Circle),e.xp6(1),e.hij(" ",e.lcZ(14,35,"igo.geo.draw."+i.geometryType.Circle)," "),e.xp6(3),e.Q6J("disabled",i.drawControlIsDisabled)("checked",i.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(18,37,"igo.geo.draw.drawControl")," "),e.xp6(2),e.Q6J("checked",i.labelsAreShown)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(21,39,"igo.geo.draw.toggleMapTooltips")," "),e.xp6(2),e.Q6J("ngIf",!i.isPoint()),e.xp6(1),e.Q6J("ngIf",i.isCircle()),e.xp6(5),e.Oqu(e.lcZ(29,41,"igo.geo.draw.layer.title")),e.xp6(2),e.Q6J("value",i.updateActiveLayer()),e.xp6(2),e.Q6J("ngForOf",i.allLayers),e.xp6(2),e.hij(" ",e.lcZ(35,43,"igo.geo.draw.layer.createNewLayer")," "),e.xp6(2),e.Q6J("ngIf",i.activeDrawingLayer),e.xp6(3),e.Q6J("ngIf",i.activeStore.count$.getValue()>0),e.xp6(2),e.Q6J("store",i.activeStore)("template",i.tableTemplate),e.xp6(3),e.Q6J("ngIf",i.icons.length>=1),e.xp6(3),e.Q6J("matTooltip",e.lcZ(48,45,"igo.geo.draw.shortcuts")),e.xp6(2),e.Q6J("ngIf",i.selectedFeatures$.value.length))},dependencies:[_._Y,_.Fj,_.wV,_.JJ,_.JL,_.qQ,_.F,_.oH,f.sg,f.O5,S.lW,S.RK,Ue.A9,Ue.Yi,Ve.d,F.KE,F.hX,w.Hw,ut.k,P.gM,j.Nt,se.gD,se.$L,le.ey,tt.Rr,Si,f.Ov,O.X$],styles:["[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:16px}[_nghost-%COMP%]   .edition-drawing[_ngcontent-%COMP%]{padding:10px 0}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .storeTable[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   .layer-select[_ngcontent-%COMP%]{flex:1;margin-right:8px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{width:110px;margin-left:30px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:4px 8px}[_nghost-%COMP%]     igo-entity-table td:last-child{text-align:right!important}[_nghost-%COMP%]     igo-entity-table td:last-child button{margin:0%!important}[_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{margin:16px 8px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{display:flex;align-items:center}"],data:{animation:[(0,ye.X$)("openClose",[(0,ye.SB)("open",(0,ye.oB)({opacity:1})),(0,ye.SB)("closed",(0,ye.oB)({opacity:0})),(0,ye.eR)("open => closed",[(0,ye.jt)("600ms ease")]),(0,ye.eR)("closed => open",[(0,ye.jt)("800ms ease")])])]},changeDetection:0})}return n})(),jS=(()=>{class n{mapService;component;layers$$;constructor(t,o){this.mapService=o,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t.filter(o=>o.showInLayerList)})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(o){return new(o||n)(e.Y36(Jr,2),e.Y36(Gt))};static \u0275dir=e.lG2({type:n,selectors:[["","igoOgcFilterableListBinding",""]]})}return n})();function QS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-button-toggle-group",4),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.geometryType=i)}),e.ALo(2,"async"),e.TgZ(3,"mat-button-toggle",5),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-button-toggle",6),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-button-toggle",7),e._uU(10),e.ALo(11,"translate"),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("disabled",void 0!==e.lcZ(2,8,t.value$))("ngModel",t.geometryType),e.xp6(2),e.Q6J("disabled",t.geometryTypes.indexOf("Point")<0),e.xp6(1),e.hij(" ",e.lcZ(5,10,"igo.geo.geometry.point")," "),e.xp6(2),e.Q6J("disabled",t.geometryTypes.indexOf("LineString")<0),e.xp6(1),e.hij(" ",e.lcZ(8,12,"igo.geo.geometry.line")," "),e.xp6(2),e.Q6J("disabled",t.geometryTypes.indexOf("Polygon")<0),e.xp6(1),e.hij(" ",e.lcZ(11,14,"igo.geo.geometry.polygon")," ")}}function YS(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",8)(1,"input",9),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.drawGuide=i)}),e.qZA(),e._UZ(2,"mat-icon",10),e.TgZ(3,"span",11),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("placeholder",t.drawGuidePlaceholder)("ngModel",t.drawGuide),e.xp6(1),e.Q6J("color","primary"),e.xp6(2),e.Oqu(e.lcZ(5,4,"igo.geo.measure.meters"))}}let Ip=class Al{cdRef;value$=new y.X(void 0);value$$;set drawControlIsActive(r){this._drawControlIsActive=r,this.cdRef.detectChanges()}get drawControlIsActive(){return this._drawControlIsActive}_drawControlIsActive=!0;set freehandDrawIsActive(r){this._freehandDrawIsActive=r,this.cdRef.detectChanges()}get freehandDrawIsActive(){return this._freehandDrawIsActive}_freehandDrawIsActive=!1;formControl;map;set geometryType(r){this.geometryType$.next(r)}get geometryType(){return this.geometryType$.value}geometryType$=new y.X(void 0);geometryTypeField=!1;geometryTypes=["Point","LineString","Polygon"];drawGuideField=!1;set drawGuide(r){this.drawGuide$.next(r)}get drawGuide(){return this.drawGuide$.value}drawGuide$=new y.X(0);drawGuidePlaceholder="";measure=!1;controlOptions={};drawStyle;overlayStyle;constructor(r){this.cdRef=r}ngOnInit(){this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(r=>{this.value$.next(r||void 0)})}ngOnDestroy(){this.value$$.unsubscribe()}static \u0275fac=function(t){return new(t||Al)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:Al,selectors:[["igo-geometry-form-field"]],inputs:{formControl:"formControl",map:"map",geometryType:"geometryType",geometryTypeField:"geometryTypeField",geometryTypes:"geometryTypes",drawGuideField:"drawGuideField",drawGuide:"drawGuide",drawGuidePlaceholder:"drawGuidePlaceholder",measure:"measure",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle"},decls:5,vars:16,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","controlOptions","drawStyle","overlayStyle"],["class","geometry-type-toggle",4,"ngIf"],["class","draw-guide-field",4,"ngIf"],[1,"geometry-type-toggle"],[3,"disabled","ngModel","ngModelChange"],["value","Point",3,"disabled"],["value","LineString",3,"disabled"],["value","Polygon",3,"disabled"],[1,"draw-guide-field"],["matInput","","type","number",3,"placeholder","ngModel","ngModelChange"],["matPrefix","","svgIcon","adjust",3,"color"],["matSuffix","",1,"draw-guide-units"]],template:function(t,o){1&t&&(e._UZ(0,"igo-geometry-form-field-input",0),e.ALo(1,"async"),e.ALo(2,"async"),e.YNc(3,QS,12,16,"div",1),e.YNc(4,YS,6,6,"mat-form-field",2)),2&t&&(e.Q6J("formControl",o.formControl)("map",o.map)("geometryType",e.lcZ(1,12,o.geometryType$))("drawGuide",e.lcZ(2,14,o.drawGuide$))("measure",o.measure)("drawControlIsActive",o.drawControlIsActive)("freehandDrawIsActive",o.freehandDrawIsActive)("controlOptions",o.controlOptions)("drawStyle",o.drawStyle)("overlayStyle",o.overlayStyle),e.xp6(3),e.Q6J("ngIf",o.geometryTypeField),e.xp6(1),e.Q6J("ngIf",o.drawGuideField))},dependencies:[f.O5,_.Fj,_.wV,_.JJ,_.On,_.oH,w.Hw,F.KE,F.qo,F.R9,j.Nt,Ue.A9,Ue.Yi,mp,f.Ov,O.X$],styles:["[_nghost-%COMP%]{display:block;width:100%}.geometry-type-toggle[_ngcontent-%COMP%], .draw-guide-field[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.draw-guide-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0 10px}.draw-guide-units[_ngcontent-%COMP%]{padding:10px}"],changeDetection:0})};function zr(n){return n.toString().padStart(2,"0")}function Zp(n,r,t,o,i,s,a,l,c){if(0===r.length)return void function ew(n,r){r.error("igo.geo.dropGeoFile.empty.text","igo.geo.dropGeoFile.empty.title",void 0,{value:n.name,mimeType:n.type})}(n,i);let u=za(n);(a?a.open("igo.geo.import.promptStoreToIdb"):(0,z.of)(!1)).pipe((0,Lt.P)()).subscribe(d=>{const g=new Date,h=[g.getFullYear(),zr(g.getMonth()+1),zr(g.getDate())].join("/")+" "+[zr(g.getHours()),zr(g.getMinutes())].join(":");u=d?`${u} (${h})`:u,l?function VS(n,r,t,o,i,s,a,l,c=!0){const u=n.map(m=>ft(m,r.projection));let p,d,g;if(o.getStyleList(t.toString()+".styleByAttribute")){const m=o.getStyleList(t.toString()+".styleByAttribute");p=(b,C)=>i.createStyleByAttribute(b,m,C)}else if(o.getStyleList(t.toString()+".clusterStyle")){const m=o.getStyleList(t.toString()+".clusterParam");d=o.getStyleList(t.toString()+".distance"),p=(b,C)=>{const x=i.createStyle(o.getStyleList(t.toString()+".clusterStyle"),b,C);return i.createClusterStyle(b,C,m,x)}}else if(o.getStyleList(t.toString()+".style"))p=(m,b)=>i.createStyle(o.getStyleList(t.toString()+".style"),m,b);else if(o.getStyleList("default.clusterStyle")&&"Point"===n[0].geometry.type){const m=o.getStyleList("default.clusterParam");d=o.getStyleList("default.distance"),p=(b,C)=>{const x=i.createStyle(o.getStyleList("default.clusterStyle"),b,C);return i.createClusterStyle(b,C,m,x)}}else p=(m,b)=>i.createStyle(o.getStyleList("default.style"),m,b);o.getStyleList(t.toString()+".clusterStyle")?(g=new bo(Object.assign({distance:d,type:"cluster",queryable:!0},a)),g.ol.source.addFeatures(u)):o.getStyleList(t.toString())?(g=new Ae(Object.assign({type:"vector",queryable:!0},a)),g.ol.addFeatures(u)):o.getStyleList("default.clusterStyle")&&"Point"===n[0].geometry.type?(g=new bo(Object.assign({distance:d,type:"cluster",queryable:!0},a)),g.ol.source.addFeatures(u)):(g=new Ae(Object.assign({type:"vector",queryable:!0},a)),g.ol.addFeatures(u));const h=new xe(Object.assign({title:t,id:s||Ie(),isIgoInternalLayer:!0,source:g,style:p},l));r.addLayer(h),c&&vo(r.viewController,u)}(r,t,u,l,c):function HS(n,r,t,o,i,s=!1){const a=n.map(h=>ft(h,r.projection)),l=Ie(),u=new Ae({id:l,type:"vector",queryable:!0});u.ol.addFeatures(a);let p,d=!1;a[0].getKeys().includes("_style")||a[0].getKeys().includes("_mapTitle")?p=Lu():(p=Mu(),d=!0);const g=i.createLayer({id:l,title:o,workspace:{enabled:!0,searchIndexEnabled:!0},isIgoInternalLayer:!0,source:u,igoStyle:{editable:d},idbInfo:{firstLoad:!0,storeToIdb:s,contextUri:t||"*"},style:p});g.setExtent(Tn(a,r.viewProjection)),r.addLayer(g),vo(r.viewController,a)}(r,t,o,u,s,d),i.success("igo.geo.dropGeoFile.success.text","igo.geo.dropGeoFile.success.title",void 0,{value:u})})}function KS(n,r,t){t.error("igo.geo.dropGeoFile.invalid.text","igo.geo.dropGeoFile.invalid.title",void 0,{value:n.name,mimeType:n.type})}function WS(n,r,t){t.error("igo.geo.dropGeoFile.unreadable.text","igo.geo.dropGeoFile.unreadable.title",void 0,{value:n.name})}function XS(n,r,t,o){t.error("igo.geo.dropGeoFile.tooLarge.text","igo.geo.dropGeoFile.tooLarge.title",void 0,{value:n.name,size:o})}function tw(n,r){r.error("igo.geo.dropGeoFile.invalidSRS.text","igo.geo.dropGeoFile.invalidSRS.title",void 0,{value:n.name,mimeType:n.type})}function ow(n,r,t){t.error("igo.geo.dropGeoFile.ogreServer.text","igo.geo.dropGeoFile.ogreServer.title")}function Pp(n){return n.name.split(".").pop().toLowerCase()}function za(n){return n.name.substr(0,n.name.lastIndexOf("."))}Ip=(0,T.gn)([yr("geometry"),(0,T.w6)("design:paramtypes",[e.sBO])],Ip);var kp=v(55019);class sn extends Error{}class Kr extends sn{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Kr.prototype)}}class ki extends sn{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,ki.prototype)}}class Wr extends sn{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Wr.prototype)}}class iw extends sn{constructor(){super("File is too large"),Object.setPrototypeOf(this,Wr.prototype)}}class nw extends sn{constructor(){super("Invalid SRS definition"),Object.setPrototypeOf(this,Wr.prototype)}}class Ka extends sn{constructor(){super("Error 500 with OGRE"),Object.setPrototypeOf(this,Ka.prototype)}}let rw=(()=>{class n{http;config;static formatExtensionAssociation={GeoJSON:"geojson",GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"zip"};static allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"];static allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"];static allowedExtensions=["geojson","kml","gpx","json","gml","zip"];ogreUrl;clientSideFileSizeMax;constructor(t,o){this.http=t,this.config=o;const i=this.config.getConfig("importExport");this.ogreUrl=i.url,this.clientSideFileSizeMax=(i.clientSideFileSizeMaxMb||30)*Math.pow(1024,2),i.formats&&(n.allowedExtensions=i.formats.map(a=>n.formatExtensionAssociation[a]).filter(a=>a),n.allowedExtensions.includes("geojson")&&n.allowedExtensions.push("json"))}import(t,o="EPSG:4326",i="EPSG:4326"){return this.importAsync(t,o,i)}getFileImporter(t){const o=Pp(t),i=n.allowedExtensions;let s=[];i.includes("zip")&&(s=n.allowedZipMimeTypes);const a=t.type;if(!([...n.allowedMimeTypes,...s].indexOf(a)<0&&i.indexOf(o)<0)){if("application/json"===a||["json","geojson","kml","gpx"].indexOf(o)>=0)return this.importFile;if(void 0!==this.ogreUrl)return this.importFileWithOgre}}importAsync(t,o,i){return new ue.y(a=>{if(t.size>=this.clientSideFileSizeMax)return void a.error(new iw);const l=this.getFileImporter(t);void 0!==l?l.call(this,t,a,o,i):a.error(new Kr)})}importFile(t,o,i,s){const a=new FileReader;a.onload=l=>{try{const c=this.parseFeaturesFromFile(t,l.target.result,i,s);o.next(c)}catch{o.error(new ki)}o.complete()},a.onerror=l=>{o.error(new ki)},a.readAsText(t,"UTF-8")}importFileWithOgre(t,o,i,s){const a=`${this.ogreUrl}/convert`,l=new FormData;l.append("upload",t),l.append("sourceSrs",i),l.append("targetSrs",s),l.append("formatOutput","GEOJSON"),l.append("skipFailures",""),this.http.post(a,l,{headers:new $.WM}).subscribe(c=>{if(null!==c)if((c.errors||[]).length>0)o.error(new ki);else{const p=this.parseFeaturesFromGeoJSON(t,c,s);o.next(p),o.complete()}else o.error(new ki)},c=>{c.error.caught=!0;const u=c.error.msg||"";"No valid files found"===u?o.error(new Kr):u&&u.startWith("ERROR 1: Failed to process SRS definition")?o.error(new nw):o.error(500===c.status?new Ka:new ki)})}parseFeaturesFromFile(t,o,i,s){const a=Pp(t),l=t.type,c=new Ce.Z;let u;if("application/vnd.google-earth.kml+xml"===l)u=new aa.ZP;else if("application/gml+xml"===l)u=new kp.Z;else if("application/gpx+xml"===l)u=new sa.Z;else switch(a){case"kml":u=new aa.ZP;break;case"gpx":u=new sa.Z;break;case"gml":u=new kp.Z;break;default:u=c}return u.readFeatures(o,{dataProjection:i,featureProjection:s}).map(g=>Object.assign(c.writeFeatureObject(g),{projection:s,meta:{id:Ie(),title:za(t)}}))}parseFeaturesFromGeoJSON(t,o,i){const s=new Ce.Z;return s.readFeatures(o).map(c=>Object.assign(s.writeFeatureObject(c),{projection:i,meta:{id:Ie(),title:za(t)}}))}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var sw=v(47005);class $p extends Error{}class Wa extends $p{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Wa.prototype)}}class Xr extends $p{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,Xr.prototype)}}const te=po(["URL","GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon"]),ao=po(["UTF8","LATIN1"]);let es=(()=>{class n{config;static ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"};static noOgreFallbacks=["GML","GPX","KML"];ogreUrl;aggregateInComment=!0;constructor(t){this.config=t,this.ogreUrl=this.config.getConfig("importExport.url");const o=this.config.getConfig("importExport.gpxAggregateInComment");void 0!==o&&(this.aggregateInComment=o)}export(t,o,i,s,a="EPSG:4326",l="EPSG:4326"){const c=this.generateFeature(t,o,"_featureStore");return this.exportAsync(c,o,i,s,a,l)}generateFeature(t,o,i="_"){return o===te.GPX&&this.aggregateInComment?this.generateAggregatedFeature(t):t.map(s=>{const l=s.getKeys().filter(c=>!c.startsWith(i)).reduce((c,u)=>(c[u]=s.get(u),c),{geometry:s.getGeometry()});return new Ze.Z(l)})}generateAggregatedFeature(t){return t.map(o=>{const i=o.getKeys().filter(c=>!c.startsWith("_"));let s="";const a=i.reduce((c,u)=>(u&&"geometry"!==u&&("id"===u&&o.get("draw")?s+=u+":"+o.get("draw")+"   \r\n":s+=u+":"+o.get(u)+"   \r\n"),c[u]=o.get(u),c),{geometry:o.getGeometry()}),l=new Ze.Z(a);return l.set("name",o.getId()),l.set("cmt",s),l})}exportAsync(t,o,i,s,a,l){return new ue.y(u=>{if(this.nothingToExport(t,o))u.error(new Xr);else if(Object.keys(n.ogreFormats).indexOf(o)>=0){if(!this.ogreUrl)return void(n.noOgreFallbacks.indexOf(o)>=0?this.exportToFile(t,u,o,i,a,l):u.error(new Wa));this.exportWithOgre(t,u,o,i,s,a,l)}else this.exportToFile(t,u,o,i,a,l)})}exportToFile(t,o,i,s,a,l){ic((new Fr[i]).writeFeatures(t,{dataProjection:l,featureProjection:a,featureType:"feature",featureNS:"http://example.com/feature"}),"text/plain;charset=utf-8",`${s}.${i.toLowerCase()}`),o.complete()}exportWithOgre(t,o,i,s,a,l,c){let u=(new Ce.Z).writeFeatures(t,{dataProjection:c,featureProjection:l});const p=`${this.ogreUrl}/convertJson`,d=document.createElement("form");if(d.style.display="none",document.body.appendChild(d),d.setAttribute("method","post"),d.setAttribute("target","_blank"),d.setAttribute("action",p),a===ao.UTF8)d.acceptCharset="UTF-8",d.enctype="application/x-www-form-urlencoded; charset=utf-8;";else if(a===ao.LATIN1){const x="ISO-8859-1",A=JSON.parse(u);A.features.map(k=>{const H=String.fromCharCode.apply(null,(0,sw.cv)(JSON.stringify(k.properties),{mode:"replacement"}));k.properties=JSON.parse(H)}),u=JSON.stringify(A);const M=document.createElement("input");M.setAttribute("type","hidden"),M.setAttribute("name","encoding"),M.setAttribute("value",x),d.appendChild(M)}if("CSVsemicolon"===i){const x=document.createElement("input");x.setAttribute("type","hidden"),x.setAttribute("name","lco"),x.setAttribute("value","SEPARATOR=SEMICOLON"),d.appendChild(x)}const g=document.createElement("input");g.setAttribute("type","hidden"),g.setAttribute("name","json"),g.setAttribute("value",u),d.appendChild(g);const h=document.createElement("input");let m="Shapefile"===i?`${s}.zip`:`${s}.${i.toLowerCase()}`;("CSVcomma"===i||"CSVsemicolon"===i)&&(m=`${s}.csv`),m=m.replace(" ","_"),m=m.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\u2019/g,"'"),h.setAttribute("type","hidden"),h.setAttribute("name","outputName"),h.setAttribute("value",m),d.appendChild(h);let b=n.ogreFormats[i];("CSVcomma"===i||"CSVsemicolon"===i)&&(b="CSV");const C=document.createElement("input");C.setAttribute("type","hidden"),C.setAttribute("name","format"),C.setAttribute("value",b),d.appendChild(C),d.submit(),document.body.removeChild(d),o.complete()}nothingToExport(t,o){return 0===t.length||"GPX"===o&&void 0===t.find(s=>["Point","LineString","MultiLineString"].indexOf(s.getGeometry().getType())>=0)}static \u0275fac=function(o){return new(o||n)(e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Xa=(()=>{class n{get html(){return this._html}set html(t){this._html=t}_html="";constructor(){}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-custom-html"]],inputs:{html:"html"},decls:2,vars:3,consts:[[1,"custom-html",3,"innerHTML"]],template:function(o,i){1&o&&(e._UZ(0,"div",0),e.ALo(1,"sanitizeHtml")),2&o&&e.Q6J("innerHTML",e.lcZ(1,1,i.html),e.oJD)},dependencies:[fr],styles:["[_nghost-%COMP%]   .custom-html[_ngcontent-%COMP%]{padding:20px}"]})}return n})();function uw(n,r){if(1&n&&(e.TgZ(0,"p",16),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"igo.geo.importExportForm.projections."+t.translateKey,t)," ")}}function pw(n,r){if(1&n&&(e.TgZ(0,"p",16),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.alias," ")}}function dw(n,r){if(1&n&&(e.TgZ(0,"mat-option",14),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(1,uw,3,4,"p",15),e.YNc(2,pw,2,1,"p",15),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Q6J("ngIf",t.translateKey),e.xp6(1),e.Q6J("ngIf",!t.translateKey)}}function gw(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",7),e.NdJ("valueChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.inputProj=i)}),e.YNc(7,dw,3,3,"mat-option",8),e.ALo(8,"async"),e.qZA()()(),e.TgZ(9,"div",9),e.ALo(10,"translate"),e.ALo(11,"translate"),e.TgZ(12,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(19);return e.KtG(i.click())}),e.ALo(13,"async"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"igo-spinner",11),e.ALo(17,"async"),e.TgZ(18,"input",12,13),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(19);return e.KtG(i.value=null)})("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.importFiles(i.target.files))}),e.qZA()()()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.importForm),e.xp6(4),e.Oqu(e.lcZ(5,10,"igo.geo.importExportForm.importProjPlaceholder")),e.xp6(2),e.Q6J("value",t.inputProj),e.xp6(1),e.Q6J("ngForOf",e.lcZ(8,12,t.projections$)),e.xp6(2),e.Q6J("matTooltip",t.importForm.invalid?e.lcZ(10,14,"igo.geo.importExportForm.projections.choose"):e.lcZ(11,16,"igo.geo.importExportForm.importButton")),e.xp6(3),e.Q6J("disabled",t.importForm.invalid||e.lcZ(13,18,t.loading$)),e.xp6(2),e.hij(" ",e.lcZ(15,20,"igo.geo.importExportForm.importButton")," "),e.xp6(2),e.Q6J("shown",e.lcZ(17,22,t.loading$)),e.xp6(2),e.Udp("display","none")}}const mw=function(n){return{size:n}};function hw(n,r){if(1&n&&(e.TgZ(0,"div")(1,"h4"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ul")(5,"li"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"li"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"li"),e._uU(12),e.ALo(13,"translate"),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.importExportForm.importClarifications")),e.xp6(4),e.hij(" ",e.xi3(7,6,"igo.geo.importExportForm.importSizeMax",e.VKq(13,mw,t.fileSizeMb))," "),e.xp6(3),e.hij(" ",e.lcZ(10,9,"igo.geo.importExportForm.importFormatAuthorized")," "),e.xp6(3),e.Oqu(e.lcZ(13,11,"igo.geo.importExportForm.importShpZip"))}}function fw(n,r){if(1&n&&e._UZ(0,"igo-custom-html",20),2&n){const t=e.oxw(2);e.Q6J("html",t.importHtmlClarifications)}}function _w(n,r){if(1&n&&(e.TgZ(0,"section",17),e.YNc(1,hw,14,15,"div",18),e.YNc(2,fw,1,1,"igo-custom-html",19),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",""===t.importHtmlClarifications),e.xp6(1),e.Q6J("ngIf",""!==t.importHtmlClarifications)}}function yw(n,r){1&n&&(e.TgZ(0,"section",17)(1,"h4"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function bw(n,r){if(1&n&&(e.TgZ(0,"span",31),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.AsE(" (+",t.layers.length-1," ",e.lcZ(2,2,2===(null==t.layers?null:t.layers.length)?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function vw(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",34),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.onlySelectedClick(i,s.id))})("checked",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.inLayersIdToExportSelectionOnly(i))})("change",function(i){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.onlySelected(i,s.id))}),e.TgZ(1,"small"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.importExportForm.exportSelectedFeature")))}const Cw=function(n){return{"igo-export-layer-mat-option":n}};function xw(n,r){if(1&n&&(e.TgZ(0,"mat-option",32),e.NdJ("click",function(o){return o.stopPropagation()}),e.TgZ(1,"p",16),e._uU(2),e.qZA(),e.TgZ(3,"p",16),e.YNc(4,vw,4,3,"mat-slide-toggle",33),e.qZA()()),2&n){const t=r.$implicit,o=e.oxw(2);e.Q6J("ngClass",e.VKq(4,Cw,o.layerHasSelectedFeatures(t)))("value",t.id),e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf",o.layerHasSelectedFeatures(t))}}function Sw(n,r){if(1&n&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.export.format."+t.value)," ")}}function ww(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Sw,3,4,"mat-option",35),e.ALo(2,"keyvalue"),e.ALo(3,"async"),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,e.lcZ(3,3,t.formats$)))}}function Tw(n,r){1&n&&(e.TgZ(0,"mat-option",36),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.export.noFormat.title")," "))}function Fw(n,r){1&n&&(e.TgZ(0,"div",6)(1,"mat-form-field"),e._UZ(2,"input",37),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.s9C("placeholder",e.lcZ(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function Ow(n,r){if(1&n&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.export.encoding."+t.value)," ")}}function Aw(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Ow,3,4,"mat-option",35),e.ALo(2,"keyvalue"),e.ALo(3,"async"),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,e.lcZ(3,3,t.encodings$)))}}function Lw(n,r){if(1&n&&(e.TgZ(0,"div",6)(1,"mat-form-field")(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-select",38),e.YNc(6,Aw,4,5,"ng-container",18),e.ALo(7,"async"),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,2,"igo.geo.importExportForm.encodingPlaceholder")),e.xp6(3),e.Q6J("ngIf",0!==e.lcZ(7,4,t.encodings$).length)}}function Mw(n,r){1&n&&(e.TgZ(0,"div",39)(1,"mat-slide-toggle",40),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function Iw(n,r){1&n&&(e.TgZ(0,"div",41)(1,"mat-slide-toggle",42),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function Zw(n,r){1&n&&(e.TgZ(0,"div",43)(1,"mat-slide-toggle",44),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function Pw(n,r){if(1&n&&e._UZ(0,"igo-custom-html",20),2&n){const t=e.oxw(2);e.Q6J("html",t.exportHtmlClarifications)}}function kw(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",21),e.NdJ("valueChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.layers=i)}),e.TgZ(7,"mat-select-trigger"),e._uU(8),e.YNc(9,bw,3,4,"span",22),e.qZA(),e.YNc(10,xw,5,6,"mat-option",23),e.ALo(11,"async"),e.qZA()()(),e.TgZ(12,"div",6)(13,"mat-form-field")(14,"mat-label"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"mat-select",24),e.YNc(18,ww,4,5,"ng-container",18),e.ALo(19,"async"),e.YNc(20,Tw,3,3,"mat-option",25),e.ALo(21,"async"),e.qZA()()(),e.YNc(22,Fw,4,3,"div",26),e.YNc(23,Lw,8,6,"div",26),e.YNc(24,Mw,4,4,"div",27),e.YNc(25,Iw,4,4,"div",28),e.YNc(26,Zw,4,4,"div",29),e.TgZ(27,"div",30)(28,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.handleExportFormSubmit(i.form.value))}),e.ALo(29,"async"),e._uU(30),e.ALo(31,"translate"),e.ALo(32,"translate"),e.ALo(33,"translate"),e.qZA(),e._UZ(34,"igo-spinner",11),e.ALo(35,"async"),e.qZA(),e.YNc(36,Pw,1,1,"igo-custom-html",19),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(4),e.Oqu(e.lcZ(5,18,"igo.geo.importExportForm.exportLayerPlaceholder")),e.xp6(2),e.Q6J("value",t.layers),e.xp6(2),e.hij(" ",t.layers.length?t.getLayerTitleById(t.layers[0]):""," "),e.xp6(1),e.Q6J("ngIf",t.layers.length>1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(11,20,t.exportableLayers$)),e.xp6(5),e.Oqu(e.lcZ(16,22,"igo.geo.importExportForm.exportFormatPlaceholder")),e.xp6(3),e.Q6J("ngIf",0!==e.lcZ(19,24,t.formats$).length),e.xp6(2),e.Q6J("ngIf",0===e.lcZ(21,26,t.formats$).length),e.xp6(2),e.Q6J("ngIf",t.forceNaming&&"URL"!==t.form.value.format),e.xp6(1),e.Q6J("ngIf","CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format),e.xp6(1),e.Q6J("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)),e.xp6(1),e.Q6J("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)&&t.form.value.combineLayers),e.xp6(1),e.Q6J("ngIf","URL"!==t.form.value.format),e.xp6(2),e.Q6J("disabled",!t.form.valid||e.lcZ(29,28,t.loading$)),e.xp6(2),e.hij(" ","URL"!==t.form.value.format?e.lcZ(31,30,"igo.geo.importExportForm.exportButton"):t.form.value.layers.length>1?e.lcZ(32,32,"igo.geo.importExportForm.exportButtonLinks"):e.lcZ(33,34,"igo.geo.importExportForm.exportButtonLink")," "),e.xp6(4),e.Q6J("shown",e.lcZ(35,36,t.loading$)),e.xp6(2),e.Q6J("ngIf",""!==t.exportHtmlClarifications)}}let Dp=(()=>{class n{importService;exportService;languageService;messageService;styleListService;styleService;formBuilder;config;cdRef;storageService;downloadService;layerService;confirmDialogService;form;importForm;formats$=new y.X(void 0);encodings$=new y.X(void 0);exportableLayers$=new y.X([]);loading$=new y.X(!1);forceNaming=!1;controlFormat="format";layers$$;exportableLayers$$;formats$$;encodings$$;formLayer$$;exportOptions$$;importHtmlClarifications;exportHtmlClarifications;espgCodeRegex=new RegExp("^\\d{4,6}");clientSideFileSizeMax;fileSizeMb;projections$=new y.X([]);projectionsConstraints;popupChecked=!1;previousLayerSpecs$=new y.X(void 0);selectFirstProj=!1;map;contextUri;_projectionsLimitations={};set projectionsLimitations(t){this._projectionsLimitations=t,this.computeProjections()}get projectionsLimitations(){return this._projectionsLimitations||{}}store;selectedMode="import";selectMode=new e.vpe;exportOptions$=new y.X(void 0);exportOptionsChange=new e.vpe;get layers(){return this.form.get("layers").value}set layers(t){this.form.patchValue({layers:t})}get inputProj(){return this.importForm.get("inputProj").value}set inputProj(t){this.importForm.patchValue({inputProj:t})}get popupAllowed(){return this.storageService.get("importExportPopupAllowed")||!1}set popupAllowed(t){this.storageService.set("importExportPopupAllowed",t)}constructor(t,o,i,s,a,l,c,u,p,d,g,h,m){this.importService=t,this.exportService=o,this.languageService=i,this.messageService=s,this.styleListService=a,this.styleService=l,this.formBuilder=c,this.config=u,this.cdRef=p,this.storageService=d,this.downloadService=g,this.layerService=h,this.confirmDialogService=m,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}ngOnInit(){this.layers$$=this.map.layers$.subscribe(o=>{this.exportableLayers$.next(o.filter(i=>i instanceof xe&&!0===i.exportable||i.dataSource.options.download&&i.dataSource.options.download.url))});const t=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(t||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe((0,Kt.n)(o=>!o)).subscribe(o=>{this.form.patchValue(o,{emitEvent:!0}),o.layers&&this.computeFormats(o.layers.map(i=>this.map.getLayerById(i)))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(o=>{const i=Object.keys(es.ogreFormats);!this.popupChecked&&this.form.get("layers").value?.length>1&&(i.indexOf(o)>=0||o===te.URL)&&(this.handlePopup(!0)||this.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(o=>{this.handlePreviousLayerSpecs();const i=o instanceof Array?o:[o];this.form.patchValue({layers:i},{emitEvent:!1});const s=i.map(l=>this.map.getLayerById(l));this.computeFormats(s),-1===Object.keys(this.formats$.value).indexOf(this.form.value.format)&&this.form.patchValue({format:void 0}),this.loading$.next(!0);const a=[];s.forEach(l=>{l instanceof xe&&0===l.dataSource.ol.getFeatures().length&&(a.push({id:l.id,visible:l.visible,opacity:l.opacity,queryable:l.queryable}),l.opacity=0,l.visible=!0)}),this.previousLayerSpecs$.next(a),setTimeout(()=>{this.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe((0,Kt.n)(o=>!o)).subscribe(o=>{1===Object.keys(o).length&&this.form.patchValue({format:o[Object.keys(o)[0]]})}),this.encodings$$=this.encodings$.pipe((0,Kt.n)(o=>!o)).subscribe(o=>{1===Object.keys(o).length&&this.form.patchValue({encoding:o[Object.keys(o)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe((0,Kt.n)(o=>!o)).subscribe(o=>{1===o.length&&this.form.patchValue({layers:o[0].id})}),this.form.controls[this.controlFormat].valueChanges.subscribe(o=>{this.form.patchValue(o===te.CSVcomma||o===te.CSVsemicolon?{encoding:ao.LATIN1}:{encoding:ao.UTF8}),this.cdRef.detectChanges()}),this.importForm.patchValue(this.selectFirstProj?0===this.projections$.value.length?{inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}:{inputProj:this.projections$.value[0]}:{inputProj:void 0})}computeProjections(){this.projectionsConstraints=Iu(this.projectionsLimitations);const t=[];if(this.projectionsConstraints.nad83&&t.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.wgs84&&t.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.webMercator&&t.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.mtm){const s=this.projectionsConstraints.mtmZone.maxZone;for(let a=this.projectionsConstraints.mtmZone.minZone;a<=s;a++)t.push({translateKey:"mtm",alias:`MTM ${a}`,code:a<10?`EPSG:3218${a}`:`EPSG:321${80+a}`,zone:`${a}`,extent:void 0,def:void 0})}if(this.projectionsConstraints.utm){const s=this.projectionsConstraints.utmZone.maxZone;for(let a=this.projectionsConstraints.utmZone.minZone;a<=s;a++)t.push({translateKey:"utm",alias:`UTM ${a}`,code:a<10?`EPSG:3260${a}`:`EPSG:326${a}`,zone:`${a}`,extent:void 0,def:void 0})}let o=[];this.projectionsConstraints.projFromConfig&&(o=this.config.getConfig("projections")||[]),this.projections$.next(o.concat(t))}getWorkspaceByLayerId(t){const o=this.store.all().find(i=>i.layer.id===t);if(o)return o}getLayerTitleById(t){return this.map.getLayerById(t)?.title}layerHasSelectedFeatures(t){const o=this.getWorkspaceByLayerId(t.id);if(o)return!!o.entityStore.stateView.firstBy(s=>!0===s.state.selected)}onlySelected(t,o){let i=this.form.value.layersWithSelection;t.checked?i.push(o):i=i.filter(s=>s!==o),this.form.patchValue({layersWithSelection:i})}onlySelectedClick(t,o){this.form.value.layers.find(i=>i===o)&&t.stopPropagation()}inLayersIdToExportSelectionOnly(t){return!!this.form.value.layersWithSelection.find(o=>o===t.id)}ngOnDestroy(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.encodings$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}handlePreviousLayerSpecs(){const t=this.previousLayerSpecs$.value;t&&t.length&&t.forEach(o=>{const i=this.map.getLayerById(o.id);i.visible=o.visible,i.opacity=o.opacity,i.queryable=o.queryable}),this.previousLayerSpecs$.next(void 0)}importFiles(t){let o=this.inputProj.code;this.espgCodeRegex.test(o)&&(o=`EPSG:${o}`),this.loading$.next(!0);for(const i of t)this.importService.import(i,o).subscribe(s=>this.onFileImportSuccess(i,s),s=>this.onFileImportError(i,s),()=>{this.loading$.next(!1)})}handlePopup(t=!0){window.open("","popup","width=1, height=1").close();const i=window.open("","popup","width=1, height=1");return!i||i.closed||typeof i.closed>"u"||null===i?(this.onPopupBlockedError(t),this.popupAllowed=!1):(i.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}handleExportFormSubmit(t){this.loading$.next(!0);const o=Object.keys(es.ogreFormats);!this.popupChecked&&t.layers.length>1&&(o.indexOf(t.format)>=0||t.format===te.URL)&&!this.popupAllowed&&this.handlePopup();let i=[],s=[],a="";for(const[l,c]of t.layers.entries()){const u=this.map.getLayerById(c);t.format!==te.CSVsemicolon&&t.format!==te.CSVcomma||!t.combineLayers||1===t.layers.length?(a=u.title,t.name&&(a=t.name)):a=this.languageService.translate.instant("igo.geo.export.combinedLayers");const p=u.dataSource.options;if(t.format===te.URL&&p.download&&(p.download.url||p.download.dynamicUrl))return void setTimeout(()=>{const m=p.download.url||p.download.dynamicUrl;m.match(/service=wfs/gi)?this.downloadService.open(u):window.open(m,"_blank"),this.loading$.next(!1)},500);const d=this.getWorkspaceByLayerId(c);let g;if(d&&d.entityStore&&d.entityStore.stateView.all().length)g=-1!==t.layersWithSelection.indexOf(c)&&t.featureInMapExtent?d.entityStore.stateView.all().filter(m=>m.state.inMapExtent&&m.state.selected).map(m=>m.entity.ol):-1===t.layersWithSelection.indexOf(c)||t.featureInMapExtent?t.featureInMapExtent?d.entityStore.stateView.all().filter(m=>m.state.inMapExtent).map(m=>m.entity.ol):d.entityStore.stateView.all().map(m=>m.entity.ol):d.entityStore.stateView.all().filter(m=>m.state.selected).map(m=>m.entity.ol);else{const m=u.dataSource.ol;g=t.featureInMapExtent?m.getFeaturesInExtent(u.map.viewController.getExtent()):m.getFeatures(),u.dataSource instanceof bo&&(g=g.flatMap(b=>b.get("features")))}let h=[];if(t.format===te.Shapefile||t.format===te.GPX?g.forEach(m=>{const b=m.getGeometry().getType(),C=h.find(x=>x.geometryType===b);C?C.features.push(m):h.push({geometryType:b,features:[m]})}):h=[{geometryType:"",features:g}],h.forEach(m=>{m.features.forEach(b=>{const C=b.get("rad");if(C){const x=[b.get("longitude"),b.get("latitude")],A=(0,Rt.iu)(x,C,500);A.transform("EPSG:4326",b.get("_projection")),b.setGeometry(A)}})}),t.format===te.GPX){const m=h.length;h=h.filter(C=>["LineString","Point"].includes(C.geometryType)),m>h.length&&this.messageService.error("igo.geo.export.gpx.error.poly.text","igo.geo.export.gpx.error.poly.title",{timeOut:2e4})}else if((t.format===te.CSVsemicolon||t.format===te.CSVcomma)&&t.combineLayers){if(h.forEach(m=>i.push(m)),l!==t.layers.length-1)continue;{let m;i.forEach(b=>{b.features.forEach(C=>{if(t.separator)if(m){if(C.get("_featureStore").layer.options.title!==m.get("_featureStore").layer.options.title){const x=this.createTitleEmptyRows(m,C);s.push(x[2]),s.push(x[0]),s.push(x[1])}}else{const x=this.createTitleEmptyRows(C,C);s.push(x[0])}s.push(C),m=C})})}}0===h.length?(this.loading$.next(!1),this.messageService.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title",{timeOut:2e4})):(t.format!==te.CSVsemicolon&&t.format!==te.CSVcomma||!t.combineLayers)&&h.map(m=>this.exportService.export(m.features,t.format,a+m.geometryType,t.encoding,this.map.projection).subscribe(()=>{},b=>this.onFileExportError(b),()=>{this.onFileExportSuccess(),m.features.forEach(b=>{this.circleToPoint(b)}),this.loading$.next(!1)}))}(t.format===te.CSVsemicolon||t.format===te.CSVcomma)&&t.combineLayers&&this.exportService.export(s,t.format,a,t.encoding,this.map.projection).subscribe(()=>{},l=>this.onFileExportError(l),()=>{this.onFileExportSuccess(),s.forEach(l=>{this.circleToPoint(l)}),this.loading$.next(!1)})}createTitleEmptyRows(t,o){const i=o.clone(),s=o.clone(),a=o.clone(),l=t.getKeys();let c="";for(const m in l)if("geometry"!==l[m]){c=l[m];break}const u=o.getKeys();let p="";for(const m in u)if("geometry"!==u[m]){p=u[m];break}const d=o.getKeys();l.forEach(m=>{d.includes(m)&&m!==c&&d.push(m)}),d.unshift(c);let g="";for(const m in d)if("geometry"!==d[m]){g=d[m];break}return d.forEach(m=>{const b=l.length===u.length&&l.every((C,x)=>C===u[x]);m!==g||b?m===g&&b||m===p?(i.set(m,o.get("_featureStore").layer.options.title,!0),s.set(m,m,!0),a.unset(m,!0)):"geometry"!==m?(i.unset(m,!0),s.set(m,m,!0),a.unset(m,!0)):(i.unset(m,!0),a.unset(m,!0)):(i.set(m,o.get("_featureStore").layer.options.title+" ===============>",!0),s.set(m,m,!0),a.unset(m,!0)),u.includes(m)||s.unset(m,!0)}),[i,s,a]}circleToPoint(t){if(t.get("rad")){const i=new Ee.Z([t.get("longitude"),t.get("latitude")]);i.transform("EPSG:4326",t.get("_projection")),t.setGeometry(i)}}buildForm(){this.importForm=this.formBuilder.group({inputProj:["",[_.kI.required]]}),this.form=this.formBuilder.group(this.forceNaming?{format:["",[_.kI.required]],layers:[[],[_.kI.required]],layersWithSelection:[[]],encoding:[ao.UTF8,[_.kI.required]],combineLayers:[!0,[_.kI.required]],separator:[!1,[_.kI.required]],featureInMapExtent:[!1,[_.kI.required]],name:["",[_.kI.required]]}:{format:["",[_.kI.required]],layers:[[],[_.kI.required]],layersWithSelection:[[]],encoding:[ao.UTF8,[_.kI.required]],combineLayers:[!0,[_.kI.required]],separator:[!1,[_.kI.required]],featureInMapExtent:[!1,[_.kI.required]]})}onFileImportSuccess(t,o){const i=this.config.getConfig("importExport"),s=i?.allowToStoreLayer?this.confirmDialogService:void 0;i?.importWithStyle?Zp(t,o,this.map,this.contextUri,this.messageService,this.layerService,s,this.styleListService,this.styleService):Zp(t,o,this.map,this.contextUri,this.messageService,this.layerService,s)}onFileImportError(t,o){this.loading$.next(!1),function zS(n,r,t,o){({"Invalid file":KS,"File is too large":XS,"Failed to read file":WS,"Invalid SRS definition":tw,"Error 500 with OGRE":ow})[r.message](n,r,t,o=o||30)}(t,o,this.messageService,this.fileSizeMb)}onPopupBlockedError(t=!0){this.loading$.next(!1),this.messageService.error("igo.geo.export.popupBlocked.text","igo.geo.export.popupBlocked.title",{timeOut:2e4},{extraMessage:t?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry"})}onFileExportError(t){this.loading$.next(!1),function aw(n,r){n instanceof Xr?function cw(n){n.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title")}(r):r.error("igo.geo.export.failed.text","igo.geo.export.failed.title")}(t,this.messageService)}loadConfig(){const t=this.config.getConfig("importExport.forceNaming");this.forceNaming=void 0!==t&&t,this.computeFormats(),this.loadEncodings()}encodingDefaultValue(t){return t===te.CSVcomma||t===te.CSVsemicolon?(this.form.patchValue({encoding:ao.LATIN1}),ao.LATIN1):(this.form.patchValue({encoding:ao.UTF8}),ao.UTF8)}loadEncodings(){this.encodings$.next(ao)}computeFormats(t){let o=Object.keys(te);const i={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},s=[];if(t&&t.length)if(t.forEach(l=>{l&&(l.dataSource.options.download?.allowedFormats?(i.customList=!0,s.push({layer:l.title,formats:this.validateListFormat(l.dataSource.options.download.allowedFormats)})):l instanceof xe||!l.dataSource.options.download||!l.dataSource.options.download.url?l.dataSource.options.download&&(l.dataSource.options.download.url||l.dataSource.options.download.dynamicUrl)?i.vectorAndUrl=!0:l instanceof xe&&(i.onlyVector=!0):i.onlyUrl=!0)}),!0===i.onlyUrl&&!1===i.onlyVector)o=["URL"];else if(!0===i.onlyVector&&!1===i.onlyUrl)this.computeFormats(),te.URL in this.formats$.value&&(o=Object.keys(this.formats$.value).filter(c=>"URL"!==c));else if(!0===i.vectorAndUrl&&!1===i.onlyUrl&&!1===i.onlyVector&&(this.computeFormats(),!(te.URL in this.formats$.value))){const l=Object.keys(this.formats$.value);l.push("URL"),o=l}const a=this.config.getConfig("importExport.formats");if(a){const l=this.validateListFormat(a);o=o.filter(c=>l.includes(c))}if(i.customList){let l;const c=[];let u=s[0].formats;s.map(d=>{c.push(d.layer),l=d.formats.filter(g=>u.includes(g)),u=d.formats});const p=l.filter(d=>o.includes(d));p.length>0?(this.formats$.next(po(p)),t&&t.length&&t.length>1&&this.messageService.alert("igo.geo.export.customList.text","igo.geo.export.customList.title",void 0,{value:c.join()})):(this.formats$.next([]),this.messageService.alert("igo.geo.export.noFormat.text","igo.geo.export.noFormat.title"))}else this.formats$.next(po(o))}validateListFormat(t){return t.filter(o=>{if(o.toUpperCase()===te.CSVcomma.toUpperCase()||o.toUpperCase()===te.CSVsemicolon.toUpperCase()||o.toUpperCase()===te.GML.toUpperCase()||o.toUpperCase()===te.GPX.toUpperCase()||o.toUpperCase()===te.GeoJSON.toUpperCase()||o.toUpperCase()===te.KML.toUpperCase()||o.toUpperCase()===te.Shapefile.toUpperCase()||o.toUpperCase()===te.URL.toUpperCase())return o}).map(o=>o.toUpperCase()===te.CSVcomma.toUpperCase()?o=te.CSVcomma:o.toUpperCase()===te.CSVsemicolon.toUpperCase()?o=te.CSVsemicolon:o.toUpperCase()===te.GML.toUpperCase()?o=te.GML:o.toUpperCase()===te.GPX.toUpperCase()?o=te.GPX:o.toUpperCase()===te.GeoJSON.toUpperCase()?o=te.GeoJSON:o.toUpperCase()===te.KML.toUpperCase()?o=te.KML:o.toUpperCase()===te.Shapefile.toUpperCase()?o=te.Shapefile:o.toUpperCase()===te.URL.toUpperCase()?o=te.URL:void 0)}modeChanged(t){this.selectMode.emit(t)}onFileExportSuccess(){!function lw(n){n.success("igo.geo.export.success.text","igo.geo.export.success.title")}(this.messageService)}onImportExportChange(t){this.selectedMode=t.value}static \u0275fac=function(o){return new(o||n)(e.Y36(rw),e.Y36(es),e.Y36(L),e.Y36(_e),e.Y36(ja),e.Y36(yo),e.Y36(_.QS),e.Y36(N),e.Y36(e.sBO),e.Y36(oe),e.Y36(Op),e.Y36(Se),e.Y36(Zs))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",contextUri:"contextUri",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},decls:14,vars:17,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],["class","mat-typography",4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"value","valueChange"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["hidden","","type","file",3,"click","change"],["fileInput",""],[3,"value","click"],["matListItemTitle","",4,"ngIf"],["matListItemTitle",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["multiple","",3,"value","valueChange"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-combine-layers mat-typography",4,"ngIf"],["class","export-separator mat-typography",4,"ngIf"],["class","export-options mat-typography",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"ngClass","value","click"],[3,"click","checked","change",4,"ngIf"],[3,"click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","encoding"],[1,"export-combine-layers","mat-typography"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator","mat-typography"],["formControlName","separator",3,"labelPosition"],[1,"export-options","mat-typography"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"mat-button-toggle-group",1),e.NdJ("change",function(a){return i.onImportExportChange(a)}),e.TgZ(2,"mat-button-toggle",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-button-toggle",2),e._uU(6),e.ALo(7,"translate"),e.qZA()()(),e.YNc(8,gw,20,24,"form",3),e.YNc(9,_w,3,2,"section",4),e.YNc(10,yw,4,3,"section",4),e.ALo(11,"async"),e.YNc(12,kw,37,38,"form",3),e.ALo(13,"async")),2&o&&(e.xp6(1),e.Q6J("value",i.selectedMode),e.xp6(1),e.Q6J("value","import"),e.xp6(1),e.hij(" ",e.lcZ(4,9,"igo.geo.importExportForm.importTabTitle")," "),e.xp6(2),e.Q6J("value","export"),e.xp6(1),e.hij(" ",e.lcZ(7,11,"igo.geo.importExportForm.exportTabTitle")," "),e.xp6(2),e.Q6J("ngIf","import"===i.selectedMode),e.xp6(1),e.Q6J("ngIf","import"===i.selectedMode),e.xp6(1),e.Q6J("ngIf",0===e.lcZ(11,13,i.exportableLayers$).length&&"export"===i.selectedMode),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,15,i.exportableLayers$).length>0&&"export"===i.selectedMode))},dependencies:[P.gM,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,f.mk,f.sg,f.O5,S.lW,Ue.A9,Ue.Yi,F.KE,F.hX,se.gD,se.$L,le.ey,j.Nt,tt.Rr,Cr,Xa,f.Ov,O.X$,tn],styles:["[_nghost-%COMP%]   mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:15px 5px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}[_nghost-%COMP%]   igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}"]})}return n})();function $w(n,r){if(1&n&&(e.TgZ(0,"button",1),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()),2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.download.action"))("color",t.color)}}let el=(()=>{class n{get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(){}get options(){if(this.layer)return this.layer.dataSource.options}layerIsExportable(){return!!(this.layer instanceof xe&&!0===this.layer.exportable||this.layer.dataSource.options.download&&this.layer.dataSource.options.download.url||this.layer.options.workspace?.enabled&&this.layer.options.workspace?.workspaceId!==this.layer.id)}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-export-button"]],inputs:{layer:"layer",color:"color"},decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["svgIcon","file-export"]],template:function(o,i){1&o&&e.YNc(0,$w,3,4,"button",0),2&o&&e.Q6J("ngIf",i.layerIsExportable())},dependencies:[w.Hw,P.gM,f.O5,S.RK,O.X$],changeDetection:0})}return n})();const Ep=function(n){return{zoom:n}};let lt=(()=>{class n{map;color;get zoom(){return this.map.viewController.getZoom()}get minZoom(){return this.map.viewController.olView.getMinZoom()||1}get maxZoom(){return this.map.viewController.olView.getMaxZoom()}constructor(){}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},decls:7,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","disabled","click"],["svgIcon","plus"],["svgIcon","minus"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return i.map.viewController.zoomIn()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"button",1),e.NdJ("click",function(){return i.map.viewController.zoomOut()}),e.ALo(5,"translate"),e._UZ(6,"mat-icon",3),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("matTooltip",e.xi3(2,6,"igo.geo.mapButtons.zoomIn",e.VKq(12,Ep,i.zoom+1)))("color",i.color)("disabled",i.zoom>=i.maxZoom),e.xp6(3),e.Q6J("matTooltip",e.xi3(5,9,"igo.geo.mapButtons.zoomOut",e.VKq(14,Ep,i.zoom-1)))("color",i.color)("disabled",i.zoom<=i.minZoom))},dependencies:[w.Hw,S.RK,P.gM,O.X$],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}"]})}return n})();function Dw(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",1)(1,"button",2),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onGeolocationClick())}),e.ALo(2,"translate"),e.ALo(3,"translate"),e._UZ(4,"mat-icon",3),e.ALo(5,"async"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("matTooltip",t.map.geolocationController.tracking?e.lcZ(2,3,"igo.geo.mapButtons.geolocateInactive"):e.lcZ(3,5,"igo.geo.mapButtons.geolocate"))("color",t.color),e.xp6(3),e.s9C("svgIcon",e.lcZ(5,7,t.icon$))}}let zn=(()=>{class n{configService;tracking$$;icon$=new y.X("crosshairs-gps");get map(){return this._map}set map(t){this._map=t}_map;get color(){return this._color}set color(t){this._color=t}_color;constructor(t){this.configService=t}ngAfterContentInit(){this.map.ol.once("rendercomplete",()=>{this.tracking$$=this.map.geolocationController.tracking$.subscribe(t=>{t||this.configService.getConfig("geolocate.basic")?this.icon$.next("crosshairs-gps"):this.icon$.next("crosshairs")})})}ngOnDestroy(){this.tracking$$&&this.tracking$$.unsubscribe()}onGeolocationClick(){this.map.geolocationController.tracking=!this.map.geolocationController.tracking}static \u0275fac=function(o){return new(o||n)(e.Y36(N))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],[3,"svgIcon"]],template:function(o,i){1&o&&e.YNc(0,Dw,6,9,"div",0),2&o&&e.Q6J("ngIf",i.map.geolocationController)},dependencies:[f.O5,w.Hw,S.RK,P.gM,f.Ov,O.X$],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return n})(),Kn=(()=>{class n{configService;map;color;extentOverride;centerOverride;zoomOverride;homeExtentButtonExtent;homeExtentButtonCenter;homeExtentButtonZoom;constructor(t){this.configService=t,this.computeHomeExtent()}computeHomeExtent(){const t=this.configService.getConfig("homeExtentButton");this.homeExtentButtonExtent=this.extentOverride||t?.homeExtButtonExtent,this.homeExtentButtonCenter=this.centerOverride||t?.homeExtButtonCenter,this.homeExtentButtonZoom=this.zoomOverride||t?.homeExtButtonZoom,this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}onToggleClick(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){const t=Q.mi(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(t),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}static \u0275fac=function(o){return new(o||n)(e.Y36(N))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},decls:4,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],["svgIcon","home-map-marker"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return i.onToggleClick()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.mapButtons.home-extent"))("color",i.color))},dependencies:[w.Hw,S.RK,P.gM,O.X$],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return n})();var Ew=v(37932),Rw=v.n(Ew);let Nw=(()=>{class n{storageService;color="primary";get enabled(){return this.storageService.get("wakeLockEnabled")}set enabled(t){this.storageService.set("wakeLockEnabled",t)}noSleep;icon$=new y.X("sleep");visible=!1;constructor(t){this.storageService=t,this.noSleep=new(Rw()),mi.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.addEventListener("blur",()=>{this.disableWakeLock(),this.enabled=!1})),this.enabled?this.enableWakeLock():this.disableWakeLock()}enableWakeLock(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("sleep-off")}disableWakeLock(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("sleep")}toggleWakeLock(){this.enabled?this.disableWakeLock():this.enableWakeLock()}static \u0275fac=function(o){return new(o||n)(e.Y36(oe))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",enabled:"enabled"},decls:6,vars:9,consts:[[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"color","matTooltip","click"],[3,"svgIcon"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return i.toggleWakeLock()}),e.ALo(2,"translate"),e.ALo(3,"translate"),e._UZ(4,"mat-icon",2),e.ALo(5,"async"),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("color",i.color)("matTooltip",i.enabled?e.lcZ(2,3,"igo.geo.mapButtons.preventScreenLock"):e.lcZ(3,5,"igo.geo.mapButtons.letScreenLock")),e.xp6(3),e.s9C("svgIcon",e.lcZ(5,7,i.icon$)))},dependencies:[w.Hw,S.RK,P.gM,f.Ov,O.X$],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return n})();const Bw=function(n,r){return{azimuth:n,rotation:r}};function Jw(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",1),e.ALo(1,"async"),e.ALo(2,"translate"),e.ALo(3,"translate"),e.TgZ(4,"button",2),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.map.viewController.resetRotation())}),e.ALo(5,"async"),e._UZ(6,"mat-icon",3),e.ALo(7,"async"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,4,t.rotated$)?e.xi3(2,6,"igo.geo.mapButtons.resetRotation",e.WLB(15,Bw,t.azimuthRounded,t.rotationRounded)):e.lcZ(3,9,"igo.geo.mapButtons.tipRotation")),e.xp6(4),e.Q6J("color",t.color)("disabled",!1===e.lcZ(5,11,t.rotated$)),e.xp6(2),e.Q6J("ngStyle",e.lcZ(7,13,t.currentStyle$))}}let Wn=(()=>{class n{rotated$=new y.X(!1);azimuthRounded=0;rotationRounded=0;currentStyle$=new y.X({transform:"rotate(0rad)"});map;showIfNoRotation;color;constructor(){}ngAfterContentInit(){this.map.viewController.rotation$.subscribe(t=>{const o=t||0,i=180*o/Math.PI;this.rotationRounded=Math.round(i),this.azimuthRounded=Math.round((0,cC.Fh)(-1*i)),this.currentStyle$.next({transform:"rotate("+o+"rad)"}),this.rotated$.next(0!==o)})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"color","disabled","click"],["svgIcon","navigation",3,"ngStyle"]],template:function(o,i){1&o&&(e.YNc(0,Jw,8,18,"div",0),e.ALo(1,"async")),2&o&&e.Q6J("ngIf",e.lcZ(1,1,i.rotated$)&&!i.showIfNoRotation||i.showIfNoRotation)},dependencies:[f.O5,f.PC,w.Hw,S.RK,P.gM,f.Ov,O.X$],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return n})();var tl=function(n){return n[n.None=0]="None",n[n.Move=1]="Move",n[n.Zoom=2]="Zoom",n[n.ZoomIfOutMapExtent=3]="ZoomIfOutMapExtent",n}(tl||{});let Uw=(()=>{class n{features$=new y.X([[],void 0]);constructor(){}setFeatures(t,o=tl.None){this.features$.next([t,o])}clear(){this.features$.next([[],tl.None])}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Gw=(()=>{class n{component;overlayService;features$$;format=new Ce.Z;get map(){return this.component.map}constructor(t,o){this.component=t,this.overlayService=o}ngOnInit(){this.features$$=this.overlayService.features$.subscribe(t=>this.handleFeatures(t[0],t[1]))}ngOnDestroy(){this.features$$.unsubscribe()}handleFeatures(t,o){}static \u0275fac=function(o){return new(o||n)(e.Y36(Le,2),e.Y36(Uw))};static \u0275dir=e.lG2({type:n,selectors:[["","igoOverlay",""]]})}return n})();var ol=v(46778),qw=v(46308),$i=v.n(qw),ts=v(37459),jw=v(83793),Qw=v.n(jw);function Hw(n){const r=function(t,o){const i=t.join(" "),s=o[0],a=o[2],l=o[1],c=o[3],u=[c,s,l,s,l,a,c,a].join(" "),p=this.internal.newAdditionalObject(),d=this.internal.newAdditionalObject(),g=this.internal.newAdditionalObject();g.content='<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.017453292519943295]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",0.0],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]) >>',d.content="<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS "+g.objId+" 0 R /GPTS [ "+u+" ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>",p.content="<< /BBox [ "+i+" ] /Measure "+d.objId+" 0 R /Name (Layer) /Type /Viewport >>";const h=this.internal.newAdditionalObject(),m=(new Date).toLocaleDateString("en-CA");return h.content="<< /Name IGO2 /Type /OCG /Date "+m+" >>",p.objId};n.setGeoArea=function(t,o){this.internal.events.subscribe("putPage",function(){const i=r.call(this,t,o);this.internal.write("/VP [ "+i+" 0 R ]")})}}const Rp=po(["Pdf","Image"]),lo=po(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),Oo=po(["landscape","portrait"]),Np=po(["72","96","150"]),Bp=po(["Bmp","Gif","Jpeg","Png","Tiff"]),il=po(["none","topright","topleft","bottomleft","bottomright","newpage"]);let Jp=(()=>{class n{http;messageService;activityService;languageService;configService;zipFile;nbFileToProcess;activityId;imgSizeAdded;TEXTPDFFONT={titleFont:"Times",titleFontStyle:"bold",subtitleFont:"Times",subtitleFontStyle:"bold",commentFont:"courier",commentFontStyle:"normal",commentFontSize:12};constructor(t,o,i,s,a){this.http=t,this.messageService=o,this.activityService=i,this.languageService=s,this.configService=a}print(t,o){var i=this;const s=new fe.x,a=o.paperFormat,l=+o.resolution,c=o.orientation,u=o.legendPosition;this.activityId=this.activityService.register(),Hw(ts.default.API);const p=new ts.default({orientation:c,format:a.toLowerCase(),unit:"mm"}),d=[p.internal.pageSize.width,p.internal.pageSize.height],g=[10,10,10,10],m=d[1]-g[0]-g[2],b=[d[0]-g[3]-g[1],m];let C,x;(""!==o.title||""!==o.subtitle)&&(a===lo.A1||a===lo.A0)&&(g[0]+=10);const A=Math.round(2*(m+145)*.05)/2;return void 0!==o.title&&""!==o.title&&(C=this.getTextPdfObjectSizeAndMarg(o.title,g,this.TEXTPDFFONT.titleFont,A,this.TEXTPDFFONT.titleFontStyle,p),this.addTextInPdfDoc(p,o.title,this.TEXTPDFFONT.titleFont,this.TEXTPDFFONT.titleFontStyle,C.fontSize,C.marginLeft+g[3],g[0]),g[0]=C.height+g[0]),void 0!==o.subtitle&&""!==o.subtitle&&(x=this.getTextPdfObjectSizeAndMarg(o.subtitle,g,this.TEXTPDFFONT.subtitleFont,""!==o.title?.7*C.fontSize:.7*A,this.TEXTPDFFONT.subtitleFontStyle,p),this.addTextInPdfDoc(p,o.subtitle,this.TEXTPDFFONT.subtitleFont,this.TEXTPDFFONT.subtitleFontStyle,x.fontSize,x.marginLeft+g[3],g[0]),g[0]+=5),(!0===o.showProjection||!0===o.showScale)&&this.addProjScale(p,t,l,o.showProjection,o.showScale),void 0!==o.comment&&""!==o.comment&&this.addComment(p,o.comment),this.addMap(p,t,l,b,g,u).subscribe(function(){var M=(0,Ne.Z)(function*(k){k===ge.Done&&(yield i.handleMeasureLayer(p,t,g),i.addGeoRef(p,t,i.imgSizeAdded[0],i.imgSizeAdded[1],1,g),"none"!==o.legendPosition?["topleft","topright","bottomleft","bottomright"].indexOf(o.legendPosition)>-1?yield i.addLegendSamePage(p,t,g,l,o.legendPosition):"newpage"===o.legendPosition&&(yield i.addLegend(p,t,g,l)):yield i.saveDoc(p)),(k===ge.Done||k===ge.Error)&&(i.activityService.unregister(i.activityId),s.next(ge.Done))});return function(k){return M.apply(this,arguments)}}()),s}addGeoRef(t,o,i,s,a,l){const u=t.internal.pageSize.getHeight(),p=l[3],d=u-l[0]-s;let g=[p,d,p+i,d+s];for(let m=0;m<g.length;m++)g[m]=this.pdf_units2points(g[m],"mm");const h=o.viewController.getExtent("EPSG:3857");t.setGeoArea(g,h)}handleMeasureLayer(t,o,i){var s=this;return(0,Ne.Z)(function*(){if(o.layers.find(a=>a.visible&&a.id.startsWith("igo-measures-"))){let a;const l=o.ol.getOverlayContainer();yield $i()(l,{scale:1,backgroundColor:null}).then(c=>{a=c}),s.addCanvas(t,a,i)}})()}getLayersLegendHtml(t,o,i){return new ue.y(s=>{let a="";const l=function Yw(n,r){const t=[];for(const o of n){const i=o.options.legendOptions;if(!1===o.visible)continue;const s=o.dataSource.getLegend(void 0,r)||[];for(const a of s)void 0!==a.url&&t.push({title:o.title||"",url:a.url,display:void 0===i?.display||i.display,isInResolutionsRange:o.isInResolutionsRange})}return t}(t.layers,{resolution:t.viewController.getResolution(),extent:t.viewController.getExtent(),projection:t.viewController.getOlProjection().getCode(),size:t.ol.getSize()});if(0===l.filter(u=>!0===u.display).length)return s.next(a),void s.complete();a+='<style media="screen" type="text/css">',a+=".html2canvas-container { width: "+o+"mm !important; height: 2000px !important; }",a+="table.tableLegend {table-layout: auto;}",a+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",a+="</style>",a+='<font size="3" face="Times" >',a+='<div class="styleLegend">',a+='<table class="tableLegend" >';const c=l.filter(u=>u.display&&!0===u.isInResolutionsRange).map(u=>this.getDataImage(u.url).pipe((0,I.U)(p=>{let d="<tr><td>"+u.title.toUpperCase()+"</td></tr>";return d+='<tr><td><img src="'+p+'"></td></tr>',d})));(0,Qt.D)(c).subscribe(u=>{a=u.reduce((p,d)=>p+d,a),a+="</table>",a+="</div>",s.next(a),s.complete()})})}getDataImage(t){return new zo(this.http,this.configService).transform(t)}getLayersLegendImage(t,o="png",i,s){var a=this;return(0,Ne.Z)(function*(){const l=new fe.x;let u=yield a.getLayersLegendHtml(t,200,s).toPromise();o=o.toLowerCase(),0===u.length&&(u='<font size="12" face="Courier New" >',u+='<div align="center"><b>NO LEGEND</b></div>');const p=window.document.createElement("div");p.style.position="absolute",p.style.top="0",p.style.zIndex="-1",window.document.body.appendChild(p),p.innerHTML=u,yield a.timeout(1);const d=yield $i()(p,{useCORS:!0}).catch(g=>{console.log(g)});if(a.removeHtmlElement(p),d){let g=ge.Done;try{i?a.generateCanvaFileToZip(d,"legendImage."+o):a.saveCanvasImageAsFile(d,"legendImage",o)}catch{g=ge.Error}l.next(g)}return l})()}removeHtmlElement(t){t.parentNode.removeChild(t)}getTextPdfObjectSizeAndMarg(t,o,i,s,a,l){const p=l.internal.pageSize.getWidth()-o[1]-o[3];l.setFont(i,a),l.setFontSize(s);let g,d=l.getTextDimensions(t);return d.w>p?(g=0,l.setFontSize(s*=.7),d=l.getTextDimensions(t)):g=(p-d.w)/2,{fontSize:s,marginLeft:g,height:d.h}}addComment(t,o){this.addTextInPdfDoc(t,o,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,10,t.internal.pageSize.height-10,!0)}addTextInPdfDoc(t,o,i,s,a,l,c,u=!1){t.setFont(i,s),t.setFontSize(a),u&&(o=t.splitTextToSize(o,t.internal.pageSize.getWidth()-3*l)),t.text(o,l,c)}addProjScale(t,o,i,s,a){const l=this.languageService.translate,d=t.internal.pageSize.height-15;let g="";!0===s&&(g+=l.instant("igo.geo.printForm.projection")+": "+o.projection),!0===a&&(!0===s&&(g+="   "),g+=l.instant("igo.geo.printForm.scale")+": ~ 1 / "+ia(o.viewController.getScale(i))),t.setFont("courier"),t.setFontSize(12),t.text(g,10,d)}addLegend(t,o,i,s){var a=this;return(0,Ne.Z)(function*(){const l=t.internal.pageSize.width,c=yield a.getLayersLegendHtml(o,l,s).toPromise();if(""===c)return yield a.saveDoc(t),!0;const u=window.document.createElement("div");u.style.position="absolute",u.style.top="0",u.style.zIndex="-1",window.document.body.appendChild(u),u.innerHTML=c,yield a.timeout(1);const p=yield $i()(u,{useCORS:!0}).catch(d=>{console.log(d)});if(a.removeHtmlElement(u),p){const g=[25.4*p.width*.85/s,25.4*p.height*.85/s];let h;t.addPage(),h=p.toDataURL("image/png"),t.addImage(h,"PNG",10,10,g[0],g[1])}yield a.saveDoc(t)})()}addLegendSamePage(t,o,i,s,a){var l=this;return(0,Ne.Z)(function*(){const c=t.internal.pageSize.width,u=yield l.getLayersLegendHtml(o,c,s).toPromise();if(""===u)return yield l.saveDoc(t),!0;const p=window.document.createElement("div");p.style.position="absolute",p.style.top="0",p.style.zIndex="-1",window.document.body.appendChild(p),p.innerHTML=u,yield l.timeout(1);const d=yield $i()(p,{useCORS:!0}).catch(h=>{console.log(h)});let g;if(l.removeHtmlElement(p),d){const m=[25.4*d.width*.85/s,25.4*d.height*.85/s];"bottomright"===a?g=[t.internal.pageSize.height-i[2]-m[1],i[1],i[2],t.internal.pageSize.width-i[1]-m[0]]:"topright"===a?g=[i[0],i[1],t.internal.pageSize.height-i[0]-m[1],t.internal.pageSize.width-i[1]-m[0]]:"bottomleft"===a?g=[t.internal.pageSize.height-i[2]-m[1]-15,t.internal.pageSize.width-i[3]-m[0],i[2]+15,i[3]]:"topleft"===a&&(g=[i[0],t.internal.pageSize.width-i[3]-m[0],t.internal.pageSize.height-i[0]-m[1],i[3]]),l.addCanvas(t,d,g),yield l.saveDoc(t)}})()}defineNbFileToProcess(t){this.nbFileToProcess=t}timeout(t){return new Promise(o=>setTimeout(o,t))}addCanvas(t,o,i){let s;if(o&&(s=o.toDataURL("image/png")),void 0!==s){if(s.length<20)return void console.log("Warning: An image cannot be print in pdf file");const a=this.getImageSizeToFitPdf(t,o,i);t.addImage(s,"PNG",i[3],i[0],a[0],a[1]),t.rect(i[3],i[0],a[0],a[1]),this.imgSizeAdded=a}}addMap(t,o,i,s,a,l){var c=this;const u=o.ol.getSize(),p=o.ol.getView().getResolution(),d=this.setMapResolution(o,s,i,p),g=new fe.x;let h;return o.ol.once("rendercomplete",function(){var m=(0,Ne.Z)(function*(b){const C=b.target.getViewport().getElementsByTagName("canvas"),x=yield c.drawMap(d,C);c.resetOriginalMapSize(o,u,p),yield c.drawMapControls(o,x,l);const A=o.status$.subscribe(M=>{if(clearTimeout(h),M!==ge.Done)return;A.unsubscribe();let k=ge.Done;try{0!==x.width&&c.addCanvas(t,x,a)}catch{k=ge.Error,c.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}g.next(k)});h=window.setTimeout(()=>{A.unsubscribe();let M=ge.Done;try{0!==x.width&&c.addCanvas(t,x,a)}catch{M=ge.Error,c.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}c.resetOriginalMapSize(o,u,p),g.next(M)},200)});return function(b){return m.apply(this,arguments)}}()),g}setMapResolution(t,o,i,s){const a=t.ol.getSize(),l=Math.round(o[0]*i/25.4),c=Math.round(o[1]*i/25.4);t.ol.setSize([l,c]);const p=Math.min(l/a[0],c/a[1]);return t.ol.getView().setResolution(s/p),[l,c]}resetOriginalMapSize(t,o,i){t.ol.setSize(o),t.ol.getView().setResolution(i),t.ol.updateSize(),t.ol.renderSync()}drawMap(t,o){var i=this;return(0,Ne.Z)(function*(){const s=document.createElement("canvas");s.width=t[0],s.height=t[1];for(let a=0;a<o.length;a++){const l=o[a];l.width>0&&i.handleCanvas(l,s)}return s})()}handleCanvas(t,o){const i=o.getContext("2d"),s=t.parentElement.style.opacity||t.style.opacity;i.globalAlpha=""===s?1:Number(s);const a=t.style.transform;let l;l=a?a.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number):[parseFloat(t.style.width)/t.width,0,0,parseFloat(t.style.height)/t.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(i,l);const c=t.parentElement.style.backgroundColor;c&&(i.fillStyle=c,i.fillRect(0,0,t.width,t.height)),i.drawImage(t,0,0),i.globalAlpha=1,i.setTransform(1,0,0,1,0,0)}drawMapControls(t,o,i){var s=this;return(0,Ne.Z)(function*(){const a=o.getContext("2d"),l=t.ol.getOverlayContainerStopEvent().cloneNode(!0);yield s.addNorthDirection(l,i),yield s.addAttribution(l),l.style.width=o.width+"px",l.style.height=o.height+"px",l.style.zIndex="-1",document.getElementsByClassName("ol-viewport")[0].appendChild(l);const c=yield $i()(l,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0});0!==c.width&&0!==c.height&&a.drawImage(c,0,0),l.remove()})()}addNorthDirection(t,o){return(0,Ne.Z)(function*(){const i=document.getElementsByTagName("igo-rotation-button")[0].cloneNode(!0),s=i.getElementsByTagName("button")[0];if(!s)return null;"topright"===o&&(i.style.width="inherit",i.style.left="10px"),s.parentElement.style.background="transparent",s.style.color="#000",t.appendChild(i)})()}addAttribution(t){return(0,Ne.Z)(function*(){const o=t.getElementsByClassName("ol-attribution")[0],i=o.getElementsByTagName("button")[0];if(!i)return null;i.setAttribute("data-html2canvas-ignore","true"),o.classList.contains("ol-collapsed")&&o.classList.remove("ol-collapsed")})()}downloadMapImage(t,o,i="png",s=!1,a=!1,l="",c="",u="",p=!0,d){var g=this;const h=new fe.x;this.activityId=this.activityService.register();const m=this.languageService.translate;i=i.toLowerCase();const b=+o,C=t.ol.getSize(),x=t.ol.getView().getResolution();return t.ol.once("rendercomplete",function(){var A=(0,Ne.Z)(function*(M){const k=t.ol.getSize(),H=M.target.getViewport().getElementsByTagName("canvas"),Me=yield g.drawMap(k,H);g.resetOriginalMapSize(t,C,x),yield g.drawMapControls(t,Me,d),"none"!==d&&(["topleft","topright","bottomleft","bottomright"].indexOf(d)>-1?yield g.addLegendToImage(Me,t,b,d,i):"newpage"===d&&(yield g.getLayersLegendImage(t,i,p,b)));const Fe=document.createElement("canvas"),G=Fe.getContext("2d");let Oe=0;const V=Me.width;let he=Me.height;G.font="20px Calibri";const et=G.measureText(u).width;he=""!==l?he+30:he,he=""!==c?he+30:he,he=!1!==s||!1!==a?he+30:he;const Re=he-10,jt=Math.ceil(et/V);he=""!==u?he+30*jt:he;let Jo=he-20*jt+5;if(Fe.width=V,Fe.height=he,["bmp","gif","jpeg","png","tiff"].indexOf(i)>-1&&("jpeg"===i||""!==l||""!==c||""!==u||!1!==s||!1!==a)&&(G.fillStyle="#ffffff",G.fillRect(0,0,V,he),G.fillStyle="#000000"),""!==l&&(G.font="26px Calibri",Oe=30,G.textAlign="center",G.fillText(l,V/2,20,.9*V)),""!==c&&(G.font="26px Calibri",Oe=60,G.textAlign="center",G.fillText(c,V/2,50,.9*V)),G.font="20px Calibri",!1!==s||!1!==a){let Ot="";!1!==s&&(Ot=m.instant("igo.geo.printForm.projection")+": "+t.projection+"         "),!1!==a&&(Ot+=m.instant("igo.geo.printForm.scale")+": ~ 1 / "+ia(t.viewController.getScale(b))),G.textAlign="center",G.fillText(Ot,V/2,Re,.9*V)}if(""!==u)if(G.textAlign="center",1===jt)G.fillText(u,V/2,Jo);else{const eo=Math.floor(u.length/jt);let Io,kt="",uo=0;for(let W=0;W<jt;W++)jt-1>W?(kt=u.substr(uo,eo),Io=kt.lastIndexOf(" "),G.fillText(kt.substr(0,Io),V/2,Jo),uo+=Io,Jo+=20):G.fillText(u.substr(uo),V/2,Jo)}G.drawImage(Me,0,Oe);let pi=ge.Done,Xt="map."+i;"tiff"===i.toLowerCase()&&(Xt="map"+t.projection.replace(":","_")+"."+i);try{p?(i.toLowerCase(),g.generateCanvaFileToZip(Fe,Xt)):g.saveCanvasImageAsFile(Fe,Xt,i)}catch{pi=ge.Error}if(h.next(pi),"tiff"===i.toLowerCase()){const Ot=Xt.substring(0,Xt.toLowerCase().indexOf(".tiff"))+".tfw",eo=g.getWorldFileInformation(t),kt=new Blob([eo],{type:"text/plain;charset=utf-8"});p?g.addFileToZip(Ot,kt):((0,ol.saveAs)(kt,Ot),g.saveFileProcessing())}});return function(M){return A.apply(this,arguments)}}()),this.setMapImageResolution(t,C,b,x),h}setMapImageResolution(t,o,i,s){const a=i/96,l=[Math.round(o[0]*a),Math.round(o[1]*a)];t.ol.setSize(l);const c=Math.min(l[0]/o[0],l[1]/o[1]);t.ol.getView().setResolution(s/c),t.ol.renderSync()}addLegendToImage(t,o,i,s,a){var l=this;return(0,Ne.Z)(function*(){const c="map."+a,u=t.getContext("2d"),p=yield l.getLayersLegendHtml(o,t.width,i).toPromise();if(""===p)return yield l.saveCanvasImageAsFile(t,c,a),!0;const d=window.document.createElement("div");d.style.position="absolute",d.style.top="0",d.style.zIndex="-1",window.document.body.appendChild(d),d.innerHTML=p,yield l.timeout(1);const g=yield $i()(d,{useCORS:!0}).catch(h=>{console.log(h)});if(g){const h=t.height,m=t.width,b=g.height,C=g.width,x=.01*h;let A,M;return"bottomright"===s?(A=m-C-x,M=h-b-x):"topright"===s?(A=m-C-x,M=x):"bottomleft"===s?(A=x,M=h-b-x-15):"topleft"===s&&(A=x,M=x),u.drawImage(g,A,M,C,b),u.strokeRect(A,M,C,b),l.removeHtmlElement(d),!0}})()}renderMap(t,o,i){t.ol.updateSize(),t.ol.renderSync()}saveDoc(t){return(0,Ne.Z)(function*(){yield t.save("map_georef.pdf",{returnPromise:!0})})()}getImageSizeToFitPdf(t,o,i){const s=t.internal.pageSize.getHeight()-(i[0]+i[2]+10),a=t.internal.pageSize.getWidth()-(i[1]+i[3]),l=this.pdf_units2points(o.height,"mm"),c=this.pdf_units2points(o.width,"mm"),u=l/s,p=c/a,d=u>p?u:p;return[d>1?c/d:c,d>1?l/d:l]}getWorldFileInformation(t){const o=t.viewController.getResolution(),i=t.viewController.getExtent();return[o,0,0,-o,i[0]+o/.5,i[3]-o/.5].join("\n")}saveCanvasImageAsFile(t,o,i){const s="image/"+i,a=this;try{t.toDataURL(),t.toBlob(l=>{(0,ol.saveAs)(l,o),a.saveFileProcessing()},s)}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}generateCanvaFileToZip(t,o){const s=this;(!this.hasOwnProperty("zipFile")||typeof this.zipFile>"u")&&(this.zipFile=new(Qw()));try{t.toDataURL(),navigator.msSaveBlob?this.addFileToZip(o,t.msToBlob()):t.toBlob(a=>{s.addFileToZip(o,a)},"image/jpeg")}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}addFileToZip(t,o){this.zipFile.file(t,o),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))}saveFileProcessing(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)}getZipFile(){const t=this;this.zipFile.generateAsync({type:"blob"}).then(o=>{(0,ol.saveAs)(o,"map.zip"),delete t.zipFile})}pdf_units2points(t,o){let i=1;switch(o){case"pt":i=1;break;case"mm":i=72/25.4;break;case"cm":i=72/2.54;break;case"in":i=72;break;case"px":i=96/72;break;case"pc":case"em":i=12;break;case"ex":i=6;break;default:throw new Error("Invalid unit: "+o)}return t*i}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(_e),e.LFG(Ni),e.LFG(L),e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Vw=function(n){return{column:n,value:130}};function zw(n,r){1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.formValidation.maxLength",e.VKq(6,Vw,e.lcZ(3,4,"igo.geo.printForm.title")))))}const Kw=function(n){return{column:n,value:120}};function Ww(n,r){1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.formValidation.maxLength",e.VKq(6,Kw,e.lcZ(3,4,"igo.geo.printForm.subtitle")))))}const Xw=function(n,r){return{column:n,value:r}};function eT(n,r){if(1&n&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.formValidation.maxLength",e.WLB(6,Xw,e.lcZ(3,4,"igo.geo.printForm.comment"),t.maxLength)))}}function tT(n,r){if(1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.printForm.legendPositions."+t.value)," ")}}function oT(n,r){if(1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.lcZ(2,1,"Pdf"===t.outputFormat?"igo.geo.printForm.legendPositions.newpage":"igo.geo.printForm.legendPositions.newimage")," ")}}const Up=function(){return["newpage","newimage"]};function iT(n,r){if(1&n&&(e.TgZ(0,"mat-option",20),e.YNc(1,tT,3,3,"ng-container",3),e.YNc(2,oT,3,3,"ng-container",3),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.Q6J("ngIf",!e.DdM(3,Up).includes(t.value)),e.xp6(1),e.Q6J("ngIf",e.DdM(4,Up).includes(t.value))}}function nT(n,r){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",t.value," ")}}function rT(n,r){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.printForm.paperFormats."+t.value)," ")}}function sT(n,r){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",t.value," ")}}function aT(n,r){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",t.value," ")}}function lT(n,r){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.printForm."+t.value)," ")}}let cT=(()=>{class n{formBuilder;form;outputFormats=Rp;paperFormats=lo;orientations=Oo;resolutions=Np;imageFormats=Bp;legendPositions=il;isPrintService=!0;disabled$;get imageFormat(){return this.imageFormatField.value}set imageFormat(t){this.imageFormatField.setValue(t||Bp.Jpeg,{onlySelf:!0})}get outputFormat(){return this.outputFormatField.value}set outputFormat(t){this.outputFormatField.setValue(t||Rp.Pdf,{onlySelf:!0})}get paperFormat(){return this.paperFormatField.value}set paperFormat(t){this.paperFormatField.setValue(t||lo.Letter,{onlySelf:!0})}get orientation(){return this.orientationField.value}set orientation(t){this.orientationField.setValue(t||Oo.landscape,{onlySelf:!0})}get resolution(){return this.resolutionField.value}set resolution(t){this.resolutionField.setValue(t||Np[96],{onlySelf:!0})}get legendPosition(){return this.legendPositionField.value}set legendPosition(t){this.legendPositionField.setValue(t||il.none,{onlySelf:!0})}get title(){return this.titleField.value}set title(t){this.titleField.setValue(t,{onlySelf:!0})}get subtitle(){return this.subtitleField.value}set subtitle(t){this.subtitleField.setValue(t,{onlySelf:!0})}get comment(){return this.commentField.value}set comment(t){this.commentField.setValue(t,{onlySelf:!0})}get showProjection(){return this.showProjectionField.value}set showProjection(t){this.showProjectionField.setValue(t,{onlySelf:!0})}get showScale(){return this.showScaleField.value}set showScale(t){this.showScaleField.setValue(t,{onlySelf:!0})}get showLegend(){return this.showLegendField.value}set showLegend(t){this.showLegendField.setValue(t,{onlySelf:!0})}get doZipFile(){return this.doZipFileField.value}set doZipFile(t){this.doZipFileField.setValue(t,{onlySelf:!0})}get outputFormatField(){return this.form.controls.outputFormat}get paperFormatField(){return this.form.controls.paperFormat}get imageFormatField(){return this.form.controls.imageFormat}get orientationField(){return this.form.controls.orientation}get resolutionField(){return this.form.controls.resolution}get commentField(){return this.form.controls.comment}get showProjectionField(){return this.form.controls.showProjection}get showScaleField(){return this.form.controls.showScale}get showLegendField(){return this.form.controls.showLegend}get doZipFileField(){return this.form.controls.doZipFile}get titleField(){return this.form.controls.title}get subtitleField(){return this.form.controls.subtitle}get legendPositionField(){return this.form.controls.legendPosition}submit=new e.vpe;maxLength=180;constructor(t){this.formBuilder=t,this.form=this.formBuilder.group({title:["",[_.kI.minLength(0),_.kI.maxLength(130)]],subtitle:["",[_.kI.minLength(0),_.kI.maxLength(120)]],comment:["",[_.kI.minLength(0),_.kI.maxLength(this.maxLength)]],outputFormat:["",[_.kI.required]],paperFormat:["",[_.kI.required]],imageFormat:["",[_.kI.required]],resolution:["",[_.kI.required]],orientation:["",[_.kI.required]],legendPosition:["",[_.kI.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}ngOnInit(){this.doZipFileField.setValue(!1)}handleFormSubmit(t,o){t.isPrintService=this.isPrintService,o&&this.submit.emit(t)}toggleImageSaveProp(){"Image"===this.outputFormatField.value?(this.isPrintService=!1,this.commentField.clearValidators(),this.commentField.updateValueAndValidity()):this.isPrintService=!0}changeCommentLength(){switch(this.paperFormat){case lo.A0:this.maxLength=this.orientation===Oo.landscape?900:600;break;case lo.A1:this.maxLength=this.orientation===Oo.landscape?600:400;break;case lo.A2:this.maxLength=this.orientation===Oo.landscape?400:300;break;case lo.A3:this.maxLength=this.orientation===Oo.landscape?300:200;break;case lo.A4:this.maxLength=this.orientation===Oo.landscape?200:100;break;case lo.A5:this.maxLength=this.orientation===Oo.landscape?120:80;break;case lo.Letter:this.maxLength=this.orientation===Oo.landscape?180:140;break;default:this.maxLength=this.orientation===Oo.landscape?200:140}this.commentField.setValidators([_.kI.maxLength(this.maxLength)]),this.commentField.updateValueAndValidity()}static \u0275fac=function(o){return new(o||n)(e.Y36(_.QS))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile"},outputs:{submit:"submit"},decls:96,vars:105,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"igo-input-container","slide-toggle-container"],[1,"print-slide-toggle-container"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"placeholder","selectionChange"],["formControlName","paperFormat",3,"placeholder","selectionChange"],["formControlName","imageFormat",3,"placeholder"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"placeholder","selectionChange"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"value"]],template:function(o,i){1&o&&(e.TgZ(0,"form",0)(1,"div",1)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"input",2),e.ALo(7,"translate"),e.YNc(8,zw,4,8,"mat-error",3),e.qZA()(),e.TgZ(9,"div",1)(10,"mat-form-field")(11,"mat-label"),e._uU(12),e.ALo(13,"translate"),e.qZA(),e._UZ(14,"input",4),e.ALo(15,"translate"),e.YNc(16,Ww,4,8,"mat-error",3),e.qZA()(),e.TgZ(17,"div",1)(18,"mat-form-field")(19,"mat-label"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e._UZ(22,"input",5),e.ALo(23,"translate"),e.YNc(24,eT,4,9,"mat-error",3),e.qZA()(),e.TgZ(25,"div",6)(26,"div",7)(27,"mat-slide-toggle",8),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"mat-slide-toggle",9),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"mat-slide-toggle",10),e._uU(34),e.ALo(35,"translate"),e.qZA()()(),e.TgZ(36,"div",1)(37,"mat-form-field")(38,"mat-label"),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.TgZ(41,"mat-select",11),e.ALo(42,"translate"),e.YNc(43,iT,3,5,"mat-option",12),e.ALo(44,"keyvalue"),e.qZA()()(),e.TgZ(45,"div",1)(46,"mat-form-field")(47,"mat-label"),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"mat-select",13),e.NdJ("selectionChange",function(){return i.toggleImageSaveProp()}),e.ALo(51,"translate"),e.YNc(52,nT,2,2,"mat-option",12),e.ALo(53,"keyvalue"),e.qZA()()(),e.TgZ(54,"div",1)(55,"mat-form-field")(56,"mat-label"),e._uU(57),e.ALo(58,"translate"),e.qZA(),e.TgZ(59,"mat-select",14),e.NdJ("selectionChange",function(){return i.changeCommentLength()}),e.ALo(60,"translate"),e.YNc(61,rT,3,4,"mat-option",12),e.ALo(62,"keyvalue"),e.qZA()()(),e.TgZ(63,"div",1)(64,"mat-form-field")(65,"mat-label"),e._uU(66),e.ALo(67,"translate"),e.qZA(),e.TgZ(68,"mat-select",15),e.ALo(69,"translate"),e.YNc(70,sT,2,2,"mat-option",12),e.ALo(71,"keyvalue"),e.qZA()()(),e.TgZ(72,"div",1)(73,"mat-form-field")(74,"mat-label"),e._uU(75),e.ALo(76,"translate"),e.ALo(77,"translate"),e.qZA(),e.TgZ(78,"mat-select",16),e.ALo(79,"translate"),e.YNc(80,aT,2,2,"mat-option",12),e.ALo(81,"keyvalue"),e.qZA()()(),e.TgZ(82,"div",1)(83,"mat-form-field")(84,"mat-label"),e._uU(85),e.ALo(86,"translate"),e.qZA(),e.TgZ(87,"mat-select",17),e.NdJ("selectionChange",function(){return i.changeCommentLength()}),e.ALo(88,"translate"),e.YNc(89,lT,3,4,"mat-option",12),e.ALo(90,"keyvalue"),e.qZA()()(),e.TgZ(91,"div",18)(92,"button",19),e.NdJ("click",function(){return i.handleFormSubmit(i.form.value,i.form.valid)}),e.ALo(93,"async"),e._uU(94),e.ALo(95,"translate"),e.qZA()()()),2&o&&(e.Q6J("formGroup",i.form),e.xp6(4),e.Oqu(e.lcZ(5,45,"igo.geo.printForm.title")),e.xp6(2),e.s9C("placeholder",e.lcZ(7,47,"igo.geo.printForm.title")),e.xp6(2),e.Q6J("ngIf",null==i.titleField.errors?null:i.titleField.errors.maxlength),e.xp6(4),e.Oqu(e.lcZ(13,49,"igo.geo.printForm.subtitle")),e.xp6(2),e.s9C("placeholder",e.lcZ(15,51,"igo.geo.printForm.subtitle")),e.xp6(2),e.Q6J("ngIf",null==i.subtitleField.errors?null:i.subtitleField.errors.maxlength),e.xp6(4),e.Oqu(e.lcZ(21,53,"igo.geo.printForm.comment")),e.xp6(2),e.s9C("placeholder",e.lcZ(23,55,"igo.geo.printForm.comment")),e.xp6(2),e.Q6J("ngIf",null==i.commentField.errors?null:i.commentField.errors.maxlength),e.xp6(3),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(29,57,"igo.geo.printForm.showProjection")," "),e.xp6(2),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(32,59,"igo.geo.printForm.showScale")," "),e.xp6(2),e.Udp("display",i.isPrintService?"none":""),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(35,61,"igo.geo.printForm.doZipFile")," "),e.xp6(5),e.Oqu(e.lcZ(40,63,"igo.geo.printForm.legendPosition")),e.xp6(2),e.s9C("placeholder",e.lcZ(42,65,"igo.geo.printForm.legendPosition")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(44,67,i.legendPositions)),e.xp6(5),e.Oqu(e.lcZ(49,69,"igo.geo.printForm.outputFormat")),e.xp6(2),e.s9C("placeholder",e.lcZ(51,71,"igo.geo.printForm.outputFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(53,73,i.outputFormats)),e.xp6(2),e.Udp("display",i.isPrintService?"block":"none"),e.xp6(3),e.Oqu(e.lcZ(58,75,"igo.geo.printForm.paperFormat")),e.xp6(2),e.s9C("placeholder",e.lcZ(60,77,"igo.geo.printForm.paperFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(62,79,i.paperFormats)),e.xp6(2),e.Udp("display",i.isPrintService?"none":"block"),e.xp6(3),e.Oqu(e.lcZ(67,81,"igo.geo.printForm.imageFormat")),e.xp6(2),e.s9C("placeholder",e.lcZ(69,83,"igo.geo.printForm.imageFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(71,85,i.imageFormats)),e.xp6(5),e.AsE("",e.lcZ(76,87,"igo.geo.printForm.resolution")," (",e.lcZ(77,89,"igo.geo.printForm.resolutionUnit"),")"),e.xp6(3),e.s9C("placeholder",e.lcZ(79,91,"igo.geo.printForm.resolution")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(81,93,i.resolutions)),e.xp6(2),e.Udp("display",i.isPrintService?"block":"none"),e.xp6(3),e.Oqu(e.lcZ(86,95,"igo.geo.printForm.orientation")),e.xp6(2),e.s9C("placeholder",e.lcZ(88,97,"igo.geo.printForm.orientation")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(90,99,i.orientations)),e.xp6(3),e.Q6J("disabled",!i.form.valid||e.lcZ(93,101,i.disabled$)),e.xp6(2),e.hij(" ",e.lcZ(95,103,"igo.geo.printForm.saveBtn")," "))},dependencies:[f.sg,f.O5,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,S.lW,F.KE,F.hX,F.TO,se.gD,le.ey,j.Nt,tt.Rr,f.Ov,O.X$,tn],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .slide-toggle-container[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .print-option[_ngcontent-%COMP%]{display:block;margin-bottom:12px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}"]})}return n})(),Gp=(()=>{class n{printService;disabled$=new y.X(!1);get map(){return this._map}set map(t){this._map=t}_map;get outputFormat(){return this._outputFormat}set outputFormat(t){this._outputFormat=t}_outputFormat;get paperFormat(){return this._paperFormat}set paperFormat(t){this._paperFormat=t}_paperFormat;get orientation(){return this._orientation}set orientation(t){this._orientation=t}_orientation;get imageFormat(){return this._imageFormat}set imageFormat(t){this._imageFormat=t}_imageFormat;get legendPosition(){return this._legendPosition}set legendPosition(t){this._legendPosition=t}_legendPosition;get resolution(){return this._resolution}set resolution(t){this._resolution=t}_resolution;constructor(t){this.printService=t}handleFormSubmit(t){if(this.disabled$.next(!0),!0===t.isPrintService)this.printService.print(this.map,t).pipe((0,mt.q)(1)).subscribe(()=>{this.disabled$.next(!1)});else{let o=1;t.showLegend&&o++,"tiff"===t.imageFormat.toLowerCase()&&o++,"newpage"===t.legendPosition&&o++,this.printService.defineNbFileToProcess(o),this.printService.downloadMapImage(this.map,t.resolution,t.imageFormat,t.showProjection,t.showScale,t.title,t.subtitle,t.comment,t.doZipFile,t.legendPosition).pipe((0,mt.q)(1)).subscribe(()=>{this.disabled$.next(!1)})}}static \u0275fac=function(o){return new(o||n)(e.Y36(Jp))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},decls:1,vars:7,consts:[[3,"outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$","submit"]],template:function(o,i){1&o&&(e.TgZ(0,"igo-print-form",0),e.NdJ("submit",function(a){return i.handleFormSubmit(a)}),e.qZA()),2&o&&e.Q6J("outputFormat",i.outputFormat)("paperFormat",i.paperFormat)("orientation",i.orientation)("imageFormat",i.imageFormat)("resolution",i.resolution)("legendPosition",i.legendPosition)("disabled$",i.disabled$)},dependencies:[cT],encapsulation:2})}return n})();v(36950);var qp=function(n){return n[n.GeoJSON=0]="GeoJSON",n[n.JSON=1]="JSON",n}(qp||{}),jp=function(n){return n.Route="route",n.Trip="trip",n}(jp||{}),Xn=function(n){return n.Coord="coord",n.Text="text",n}(Xn||{}),Di=function(n){return n.Stop="stop",n.Route="route",n.Vertex="vertex",n}(Di||{}),Ei=function(n){return n.Start="start",n.Intermediate="intermediate",n.End="end",n}(Ei||{});function nl(n,r="asc",t="position"){n.view.sort({direction:r,valueAccessor:o=>o[t]})}function os(n,r){let t=Ei.Intermediate;return 0===n?t=Ei.Start:n===r-1&&(t=Ei.End),t}function rl(n){const r=Ie(),t=n.all();let o;o=0===n.count?[0]:t.map(c=>c.position);const i=Math.max(...o),s=i,a=i+1,l=n.all().find(c=>c.position===i);return l&&(l.position=a,l.relativePosition=os(a,n.count+1)),n.insert({id:r,position:s,relativePosition:os(s,n.count+1)}),nl(n),n.get(r)}function sl(n,r){const t=[new J.ZP({geometry:n.getGeometry(),image:new Te.Z({radius:7,stroke:new U.Z({color:"#FF0000",width:3})})})],o=Xo({text:n.get("stopText"),opacity:n.get("stopOpacity"),markerColor:n.get("stopColor"),markerOutlineColor:[255,255,255]}),i=[new J.ZP({stroke:new U.Z({color:`rgba(106, 121, 130, ${n.get("active")?.75:0})`,width:10})}),new J.ZP({stroke:new U.Z({color:`rgba(79, 169, 221, ${n.get("active")?.75:0})`,width:6})})];return n.get("type")===Di.Stop?o:"vertex"===n.get("type")?t:n.get("type")===Di.Route?i:void 0}function an(n){if(0!==n)return n>=1e5?hi.roundToNDecimal(Math.round(n)/1e3,1)+" km":n>=1e4||n>=1e3?hi.roundToNDecimal(Math.round(n)/100/10,1)+" km":hi.roundToNDecimal(n,0)+" m"}function al(n){if(n>=3600){const r=Math.floor(n/3600),t=Math.round(60*(n/3600-r));return 60===t?r+1+" h":r+" h "+t+" min"}return n>=60?Math.round(n/60)+" min":n+" s"}function ll(n,r,t,o,i,s,a,l=!1){const c=a.translate;let u,p="forward",d="rotate-270";const g=function yT(n,r){const t=r.translate;return n>=337||n<23?t.instant("igo.geo.cardinalPoints.n"):n<67?t.instant("igo.geo.cardinalPoints.ne"):n<113?t.instant("igo.geo.cardinalPoints.e"):n<157?t.instant("igo.geo.cardinalPoints.se"):n<203?t.instant("igo.geo.cardinalPoints.s"):n<247?t.instant("igo.geo.cardinalPoints.sw"):n<293?t.instant("igo.geo.cardinalPoints.w"):n<337?t.instant("igo.geo.cardinalPoints.nw"):void 0}(o,a),h=function _T(n,r){const t=r.translate;return"uturn"===n?t.instant("igo.geo.directions.uturn"):"sharp right"===n?t.instant("igo.geo.directions.sharp right"):"right"===n?t.instant("igo.geo.directions.right"):"slight right"===n?t.instant("igo.geo.directions.slight right"):"sharp left"===n?r.translate.instant("igo.geo.directions.sharp left"):"left"===n?r.translate.instant("igo.geo.directions.left"):"slight left"===n?r.translate.instant("igo.geo.directions.slight left"):"straight"===n?r.translate.instant("igo.geo.directions.straight"):n}(r,a);let b=("straight"===r?"":c.instant("igo.geo.directions.modifier.prefix"))+h;if(r?.search("slight")>=0&&(b=h),"uturn"===r?(p="forward",d="rotate-90"):"sharp right"===r||"right"===r?(p="subdirectory-arrow-right",d="icon-flipped"):"slight right"===r?(p="forward",d="rotate-290"):"straight"===r?p="forward":"slight left"===r?(p="forward",d="rotate-250"):("left"===r||"sharp left"===r)&&(p="subdirectory-arrow-left",d="icon-flipped"),"turn"===n)u="straight"===r?c.instant("igo.geo.directions.turn.straight",{route:t}):"uturn"===r?c.instant("igo.geo.directions.turn.uturn",{route:t}):c.instant("igo.geo.directions.turn.else",{route:t,aggregatedDirection:b,translatedModifier:h});else if("new name"===n)u=c.instant("igo.geo.directions.new name",{route:t,translatedDirection:g}),p="compass",d="";else if("depart"===n)u=c.instant("igo.geo.directions.depart",{route:t,translatedDirection:g}),p="compass",d="";else if("arrive"===n)l?(b=h?b:"",u=c.instant("igo.geo.directions.arrive.lastStep",{coma:h?", ":"",aggregatedDirection:b})):(u=c.instant("igo.geo.directions.arrive.intermediate",{route:t}),p="map-marker",d="");else if("merge"===n)u=c.instant("igo.geo.directions.merge",{route:t}),p="forward",d="rotate-270";else if("on ramp"===n)u=c.instant("igo.geo.directions.on ramp",{aggregatedDirection:b});else if("off ramp"===n)u=c.instant("igo.geo.directions.off ramp",{aggregatedDirection:b});else if("fork"===n)u=r.search("left")>=0?c.instant("igo.geo.directions.fork.left",{route:t}):r.search("right")>=0?c.instant("igo.geo.directions.fork.right",{route:t}):c.instant("igo.geo.directions.fork.else",{route:t});else if("end of road"===n)u=c.instant("igo.geo.directions.end of road",{translatedModifier:h,route:t});else if("use lane"===n)u=c.instant("igo.geo.directions.use lane");else if("continue"===n&&"uturn"!==r)u=c.instant("igo.geo.directions.continue.notUturn",{route:t}),p="forward",d="rotate-270";else if("roundabout"===n){const C=c.instant(1===s?"igo.geo.directions.cntSuffix.first":"igo.geo.directions.cntSuffix.secondAndMore");u=c.instant("igo.geo.directions.roundabout",{exit:s,cntSuffix:C,route:t}),p="chart-donut",d=""}else"rotary"===n?(u=c.instant("igo.geo.directions.rotary"),p="chart-donut",d=""):"roundabout turn"===n?(u=c.instant("igo.geo.directions.roundabout turn"),p="chart-donut",d=""):"exit roundabout"===n?(u=c.instant("igo.geo.directions.exit roundabout",{route:t}),p="forward",d="rotate-270"):u="notification"===n?c.instant("igo.geo.directions.notification"):"uturn"===r?c.instant("igo.geo.directions.uturnText",{translatedDirection:g,route:t}):c.instant("igo.geo.directions.unknown");return p=l?"flag-variant":p,d=l?"":d,p=0===i?"compass":p,d=0===i?"":d,{instruction:u,image:p,cssClass:d}}let Qp=(()=>{class n{directionsSourceService;configService;languageService;printService;document;activityService;constructor(t,o,i,s,a,l){this.directionsSourceService=t,this.configService=o,this.languageService=i,this.printService=s,this.document=a,this.activityService=l}route(t,o={}){if(0!==t.length)return this.directionsSourceService.sources.filter(i=>i.enabled).map(i=>this.routeSource(i,t,o))}routeSource(t,o,i={}){return t.route(o,i)}downloadDirection(t,o){var i=this;const s=this.activityService.register(),a=new fe.x,l=new ts.default({orientation:"p",format:"Letter",unit:"mm"}),c=[l.internal.pageSize.width,l.internal.pageSize.height],u=[10,10,10,10],g=[c[0],c[1]-u[0]-u[2]],h=`${o.title} (${an(o.distance)}, ${al(o.duration)})`;return l.text(h,l.internal.pageSize.width/2,25,{align:"center"}),u[0]+=20,this.printService.addMap(l,t,96,g,u,il.none).subscribe(function(){var C=(0,Ne.Z)(function*(x){x===ge.Done&&(yield i.addInstructions(l,o,h),i.setPageHeaderFooter(l),yield l.save(`${h}.pdf`,{returnPromise:!0})),i.activityService.unregister(s),a.next(x)});return function(x){return C.apply(this,arguments)}}()),a}setHTMLTableContent(t){var o=this;return(0,Ne.Z)(function*(){const i=yield o.directionsInstruction(t),s=document.createElement("table"),a=document.createElement("tbody");for(let p=0;p<i.length;p++){const d=i[p];var l=document.createElement("tr"),c=document.createElement("td"),u=document.createElement("td");const g=document.createElement("img");g.src=d.icon;const h=document.createElement("span");if(h.innerHTML=d.instruction,c.appendChild(g),u.appendChild(h),d.distance){const m=document.createElement("span");m.style.verticalAlign="middle",m.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+d.distance,u.appendChild(m)}l.append(c),l.append(u),a.appendChild(l)}return s.appendChild(a),s})()}directionsInstruction(t){var o=this;return(0,Ne.Z)(function*(){const s=o.document.getElementsByTagName("igo-directions-results")[0].getElementsByTagName("mat-list")[0].getElementsByTagName("mat-list-item");let a=[];for(let c=0;c<s.length;c++){const p=s[c].getElementsByTagName("mat-icon")[0],d=p.getAttribute("data-mat-icon-name");if(!a.some(h=>h.name===d)){const h=yield $i()(p,{scale:3});a.push({name:d,icon:h.toDataURL()})}}let l=[];for(let c=0;c<t.steps.length;c++){const u=t.steps[c],p=ll(u.maneuver.type,u.maneuver.modifier,u.name,u.maneuver.bearing_after,c,u.maneuver.exit,o.languageService,c===t.steps.length-1),d=an(u.distance);l.push({instruction:c+1+". "+p.instruction,icon:a.find(g=>g.name===p.image).icon,distance:d?"("+d+")":void 0})}return l})()}addInstructions(t,o,i){var s=this;return(0,Ne.Z)(function*(){t.addPage(),t.text(i,t.internal.pageSize.width/2,25,{align:"center"});const l=yield s.setHTMLTableContent(o);t.autoTable({html:l,startY:30,margin:{top:20,bottom:20},columnStyles:{0:{cellWidth:10}},theme:"plain",styles:{fontSize:12},didDrawCell:function(u){if(0===u.column.index&&"body"===u.cell.section){u.row.height=10;const d=u.cell.raw.getElementsByTagName("img")[0];t.addImage(d.src,u.cell.x,u.cell.y,8,8)}}})})()}setPageHeaderFooter(t){const o=t.getNumberOfPages(),i=E()(Date.now()).format("DD/MM/YYYY hh:mm").toString(),a=this.configService.getConfig("directionsSources.logo")||"assets/logo.png";for(let l=0;l<o;l++){t.setPage(l),t.setFontSize(8);const c=t.internal.pageSize,u=c.height?c.height:c.getHeight(),p=c.width?c.width:c.getWidth();t.text(i,10,10,{baseline:"top"}),t.addImage(a,"PNG",p-20,5,10,10),t.text(i,10,u-10),t.text("Page "+t.getCurrentPageInfo().pageNumber+" / "+o,p-20,u-10)}}static \u0275fac=function(o){return new(o||n)(e.LFG(Oa),e.LFG(N),e.LFG(L),e.LFG(Jp),e.LFG(f.K0),e.LFG(Ni))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class Yp extends xt{storeInitialized$=new y.X(!1);clearStops(){this.storeInitialized$.next(!1),this.clear()}}class Hp extends yt{}class Vp extends yt{}class zp extends yt{}function bT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.clearStop(i))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",12),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.clearStop"))}function vT(n,r){if(1&n&&(e.TgZ(0,"mat-option",15),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t)("matTooltip",t.meta?t.meta.title:""),e.xp6(1),e.hij(" ",t.meta?t.meta.title:""," ")}}function CT(n,r){if(1&n&&(e.TgZ(0,"mat-optgroup",13),e.YNc(1,vT,2,3,"mat-option",14),e.qZA()),2&n){const t=r.$implicit;e.Q6J("label",t.source.title)("disabled",!1===t.source.enabled),e.xp6(1),e.Q6J("ngForOf",t.results)}}function xT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,s=e.oxw();return e.KtG(s.removeStop(i))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",21),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.removeStop"))}function ST(n,r){if(1&n&&(e.TgZ(0,"div",16)(1,"button",17),e.ALo(2,"translate"),e._UZ(3,"mat-icon",18),e.qZA(),e.YNc(4,xT,3,3,"button",19),e.ALo(5,"async"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.directionsForm.moveStop")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,4,t.stopsStore.count$)>2)}}function wT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e.NdJ("touchenter",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onStopEnter(s))})("touchleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onStopLeave())})("mouseover",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onStopEnter(s))})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onStopLeave())})("cdkDragStarted",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.stopIsDragged=!0)})("cdkDragEnded",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.stopIsDragged=!1)}),e.TgZ(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),e._uU(4),e.qZA(),e.TgZ(5,"input",5),e.NdJ("focus",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.onInputFocus(s))})("ngModelChange",function(i){const a=e.CHM(t).$implicit;return e.KtG(a.text=i)})("keyup",function(i){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.setStopText(i,a))})("keydown.enter",function(i){return i.preventDefault()}),e.qZA(),e.YNc(6,bT,3,3,"button",6),e.TgZ(7,"mat-autocomplete",7,8),e.NdJ("optionSelected",function(i){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.chooseProposal(i,a))}),e.YNc(9,CT,2,3,"mat-optgroup",9),e.qZA()()(),e.YNc(10,ST,6,6,"div",10),e.qZA()}if(2&n){const t=r.$implicit,o=e.MAs(8),i=e.oxw();e.xp6(1),e.Q6J("ngClass",i.getNgClass(t)),e.xp6(3),e.Oqu(i.getPlaceholder(t)),e.xp6(1),e.s9C("id",t.id),e.Q6J("placeholder",i.getPlaceholder(t))("matTooltip",t.text)("ngModel",t.text)("matAutocomplete",o),e.xp6(1),e.Q6J("ngIf",(t.text||t.coordinates)&&i.stopWithHover&&t.id===i.stopWithHover.id),e.xp6(1),e.Q6J("displayWith",i.getOptionText),e.xp6(2),e.Q6J("ngForOf",t.searchProposals),e.xp6(1),e.Q6J("ngIf",!i.stopIsDragged&&i.stopWithHover&&t.id===i.stopWithHover.id)}}let TT=(()=>{class n{languageService;invalidKeys=["Control","Shift","Alt"];onMapClickEventKeys=[];stopWithHover;stopIsDragged=!1;stopsStore;stopsFeatureStore;projection;coordRoundedDecimals=6;debounce=200;length=2;stopInputHasFocus=new e.vpe(!1);constructor(t){this.languageService=t}ngOnDestroy(){this.unlistenMapSingleClick()}onStopEnter(t){this.stopWithHover=t}onStopLeave(){this.stopWithHover=void 0}getOptionText(t){return t instanceof Object?t?.meta?t.meta.title:"":t}chooseProposal(t,o){const i=t.option.value;if(i){let s;const a=i.geometry;if("Point"===a.type)s=a.coordinates;else{const l=(0,jr.Z)(i.geometry);s=[l.geometry.coordinates[0],l.geometry.coordinates[1]]}s&&(o.coordinates=s,o.text=i.meta.title,this.stopsStore.update(o))}}setStopText(t,o){this.unlistenMapSingleClick();const i=t.target.value;0===i.length?this.clearStop(o):this.validateTerm(i)&&(o.text=i,this.stopsStore.update(o))}validateTerm(t){return!(!this.keyIsValid(t)||!(t.length>=this.length||0===t.length))}keyIsValid(t){return void 0===this.invalidKeys.find(o=>o===t)}getNgClass(t){return this.stopWithHover&&t.id===this.stopWithHover.id?"igo-input-container reduce":"igo-input-container"}getPlaceholder(t){let o="";return t.relativePosition?(t.relativePosition===Ei.Intermediate&&(o=" #"+t.position),this.languageService.translate.instant("igo.geo.directionsForm."+t.relativePosition)+o):""}removeStop(t){!function pT(n,r){n.delete(r),function uT(n){const r=[...n.all()];r.sort((t,o)=>t.position-o.position),r.map((t,o)=>{t.position=o,t.relativePosition=os(t.position,r.length)}),r&&n.updateMany(r)}(n)}(this.stopsStore,t)}clearStop(t){this.stopsStore.update({id:t.id,relativePosition:t.relativePosition,position:t.position})}drop(t){this.moveStops(t.previousIndex,t.currentIndex)}moveStops(t,o){if(t!==o){const i=[...this.stopsStore.view.all()];(0,En.bA)(i,t,o),i.map((s,a)=>{s.relativePosition=os(a,i.length),s.position=a}),this.stopsStore.updateMany(i),nl(this.stopsStore)}}onInputFocus(t){(!t.text||0===t.text?.length)&&(this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(t))}listenMapSingleClick(t){const o=this.stopsFeatureStore.layer.map.ol.once("singleclick",i=>{const a=pt(Q.vs(i.coordinate,this.stopsFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals);t.text=a.join(","),t.coordinates=a,this.stopsStore.update(t),setTimeout(()=>{this.stopInputHasFocus.emit(!1)},500)});this.onMapClickEventKeys.push(o)}unlistenMapSingleClick(){this.onMapClickEventKeys.map(t=>{Ke.B(t)}),this.onMapClickEventKeys=[]}static \u0275fac=function(o){return new(o||n)(e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},decls:3,vars:3,consts:[["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["touchleave","","cdkDragLockAxis","y","class","stop-box","cdkDrag","",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded",4,"ngFor","ngForOf"],["touchleave","","cdkDragLockAxis","y","cdkDrag","",1,"stop-box",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],[3,"ngClass"],["subscriptSizing","dynamic"],["type","text","matTooltipShowDelay","500","aria-label","Number","matInput","",3,"id","placeholder","matTooltip","ngModel","matAutocomplete","focus","ngModelChange","keyup","keydown.enter"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click",4,"ngIf"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","igo-form-button-group",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click"],["svgIcon","close"],[3,"label","disabled"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"igo-form-button-group"],["cdkDragHandle","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"swipe-vertical",3,"matTooltip"],["svgIcon","gesture-swipe-vertical"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.NdJ("cdkDropListDropped",function(a){return i.drop(a)}),e.YNc(1,wT,11,11,"div",1),e.ALo(2,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,i.stopsStore.view.all$())))},dependencies:[f.mk,f.sg,f.O5,En.Wj,En.Zt,En.Bh,_.Fj,_.JJ,_.On,w.Hw,S.RK,F.KE,F.hX,F.R9,j.Nt,le.ey,le.Nv,P.gM,Je.XC,Je.ZL,f.Ov,O.X$],styles:["[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{display:flex;align-items:center;padding-left:12px}[_nghost-%COMP%]   .stops-list[_ngcontent-%COMP%]{max-width:100%;min-height:60px;display:block;background:white;border-radius:4px;overflow:hidden;padding:20px 10px}[_nghost-%COMP%]   .swipe-vertical[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]{color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:white}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}[_nghost-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}[_nghost-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]   .stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return n})();function FT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.resetStops())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",7),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.resetDirectionsBtn"))}function OT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.zoomRoute())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",8),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.zoomRoute"))}function AT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.copyDirectionsToClipboard())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",9),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.copy"))}function LT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.copyLinkToClipboard())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",10),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.link"))}function MT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.printDirections())}),e.ALo(1,"async"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",12),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",e.lcZ(1,2,t.disabled$))("matTooltip",e.lcZ(2,4,"igo.geo.directionsForm.print"))}}let IT=(()=>{class n{languageService;messageService;route;directionsService;get activeRoute(){return this.routesFeatureStore.all().find(t=>t.properties.active)}contextUri;zoomToActiveRoute$=new fe.x;stopsStore;routesFeatureStore;stepFeatureStore;disabled$=new y.X(!1);constructor(t,o,i,s){this.languageService=t,this.messageService=o,this.route=i,this.directionsService=s}resetStops(){this.stopsStore.clearStops()}addStop(){rl(this.stopsStore)}copyLinkToClipboard(){At.copy(this.getUrl())&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsgLink","igo.geo.directionsForm.dialog.copyTitle")}zoomRoute(){this.zoomToActiveRoute$.next()}copyDirectionsToClipboard(){const t=this.directionsToText();At.copy(t)&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsg","igo.geo.directionsForm.dialog.copyTitle")}directionsToText(){const t="\t";let o=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",i="";const s=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n"+t+this.activeRoute.properties.direction.title+"\n"+t+an(this.activeRoute.properties.direction.distance)+"\n"+t+al(this.activeRoute.properties.direction.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",a=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n"+t+this.getUrl();let l=1;this.stopsStore.view.all().forEach(p=>{let d="",g="";p.text!==pt(p.coordinates).join(",")?(g=p.text,d=` ( ${pt(p.coordinates).join(",")} )`):g=pt(p.coordinates).join(","),i=i+t+l.toLocaleString()+". "+g+d+"\n",l++});let c=0;return this.activeRoute.properties.direction.steps.forEach(p=>{const d=this.formatStep(p,c).instruction,g=void 0===an(p.distance)?"":" ("+an(p.distance)+")";o=o+t+(c+1).toLocaleString()+". "+d+g+"\n",c++}),s+i+"\n"+a+"\n\n"+o}formatStep(t,o){return ll(t.maneuver.type,t.maneuver.modifier,t.name,t.maneuver.bearing_after,o,t.maneuver.exit,this.languageService,o===this.activeRoute.properties.direction.steps.length-1)}getUrl(){if(!this.route)return;let t="";this.contextUri&&(t=`context=${this.contextUri}&`);const o=this.routesFeatureStore.all().map(c=>c.properties.id).indexOf(this.activeRoute.properties.id);let i="";0!==o&&(i=`&${this.route.options.directionsOptionsKey}=result:${o}`);const s=this.route.options.directionsCoordKey,a=this.stopsStore.view.all().map(c=>pt(c.coordinates,6));let l="";return a.length>=2?(l=`${s}=${a.join(";")}`,`${location.origin}${location.pathname}?${t}tool=directions&sidenav=1&${l}${i}`):void 0}printDirections(){this.stepFeatureStore.clear(),this.disabled$.next(!0),this.directionsService.downloadDirection(this.routesFeatureStore.map,this.activeRoute.properties.direction).subscribe(()=>{this.disabled$.next(!1)})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_e),e.Y36(un,8),e.Y36(Qp))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomToActiveRoute$:"zoomToActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},decls:15,vars:20,consts:[[1,"igo-form-button-group"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","map-marker-plus"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","file-restore"],["svgIcon","magnify-plus-outline"],["svgIcon","content-copy"],["svgIcon","link"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click"],["svgIcon","printer"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return i.addStop()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.YNc(4,FT,3,3,"button",3),e.ALo(5,"async"),e.ALo(6,"async"),e.YNc(7,OT,3,3,"button",4),e.ALo(8,"async"),e.YNc(9,AT,3,3,"button",4),e.ALo(10,"async"),e.YNc(11,LT,3,3,"button",4),e.ALo(12,"async"),e.YNc(13,MT,4,6,"button",5),e.ALo(14,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,6,"igo.geo.directionsForm.addStop")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,8,i.routesFeatureStore.count$)>=1||e.lcZ(6,10,i.stopsStore.count$)>=1),e.xp6(3),e.Q6J("ngIf",e.lcZ(8,12,i.routesFeatureStore.count$)>=1),e.xp6(2),e.Q6J("ngIf",e.lcZ(10,14,i.routesFeatureStore.count$)>=1),e.xp6(2),e.Q6J("ngIf",e.lcZ(12,16,i.routesFeatureStore.count$)>=1),e.xp6(2),e.Q6J("ngIf",e.lcZ(14,18,i.routesFeatureStore.count$)>=1))},dependencies:[f.O5,w.Hw,S.RK,P.gM,f.Ov,O.X$]})}return n})();function ZT(n,r){if(1&n&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&n){const t=r.$implicit,o=r.index,i=e.oxw(3);e.Q6J("value",t),e.xp6(1),e.lnq(" Option ",o+1," : ",i.formatDistance(t.distance)," (",i.formatDuration(t.duration),") ")}}function PT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",7),e.NdJ("selectionChange",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.changeRoute())})("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeDirection=i)}),e.ALo(5,"translate"),e.YNc(6,ZT,2,4,"mat-option",8),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.directionsForm.drivingOptions")),e.xp6(2),e.s9C("placeholder",e.lcZ(5,6,"igo.geo.directionsForm.drivingOptions")),e.Q6J("ngModel",t.activeDirection),e.xp6(2),e.Q6J("ngForOf",t.directions)}}function kT(n,r){1&n&&e._UZ(0,"mat-divider")}function $T(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item",10),e.NdJ("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.showSegment(s))})("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.showSegment(s,!0))}),e._UZ(1,"mat-icon",11),e.TgZ(2,"span",12),e._uU(3),e.qZA(),e.TgZ(4,"span",13),e._uU(5),e.qZA()()}if(2&n){const t=r.$implicit,o=r.index,i=e.oxw(2);e.xp6(1),e.s9C("svgIcon",i.formatStep(t,o).image),e.Q6J("ngClass",i.formatStep(t,o).cssClass),e.xp6(2),e.AsE(" ",o+1,". ",i.formatStep(t,o).instruction," "),e.xp6(2),e.hij(" ",i.formatDistance(t.distance)," ")}}function DT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",1),e.YNc(1,PT,7,8,"mat-form-field",2),e.YNc(2,kT,1,0,"mat-divider",2),e.TgZ(3,"mat-list",3),e.NdJ("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onStepsListBlur())}),e.TgZ(4,"h2",4),e._uU(5),e.qZA(),e.TgZ(6,"span",5),e._uU(7),e.qZA(),e.YNc(8,$T,6,5,"mat-list-item",6),e._UZ(9,"mat-divider"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.directions&&t.directions.length>1),e.xp6(1),e.Q6J("ngIf",t.directions&&0===t.directions.length),e.xp6(3),e.Oqu(t.activeDirection.title),e.xp6(2),e.AsE(" ",t.formatDistance(t.activeDirection.distance),", ",t.formatDuration(t.activeDirection.duration)," "),e.xp6(1),e.Q6J("ngForOf",t.activeDirection.steps)}}let ET=(()=>{class n{languageService;cdRef;activeDirection;directions;entities$$;routesFeatureStore;stepFeatureStore;constructor(t,o){this.languageService=t,this.cdRef=o}ngOnInit(){this.entities$$=this.routesFeatureStore.entities$.pipe((0,ae.b)(200)).subscribe(t=>{const o=t.find(i=>i.properties.active);this.directions=t.map(i=>i.properties.direction),this.activeDirection=o?o.properties.direction:void 0,this.cdRef.detectChanges()})}ngOnDestroy(){this.entities$$.unsubscribe()}changeRoute(){this.routesFeatureStore.entities$.value.map(t=>t.properties.active=!t.properties.active),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(t=>t.set("active",!t.get("active")))}formatDistance(t){return an(t)}formatDuration(t){return al(t)}formatStep(t,o){return ll(t.maneuver.type,t.maneuver.modifier,t.name,t.maneuver.bearing_after,o,t.maneuver.exit,this.languageService,o===this.activeDirection.steps.length-1)}onStepsListBlur(){this.stepFeatureStore.clear()}showSegment(t,o=!1){this.showRouteSegmentGeometry(t,o)}showRouteSegmentGeometry(t,o=!1){const s="vertex",u=new ro.Z(t.geometry.coordinates).transform("EPSG:4326",this.stepFeatureStore.layer.map.projection).getCoordinates()[0],p=new Ee.Z(u),d=new Ze.Z({geometry:p}),g=(new Ce.Z).writeGeometryObject(p,{featureProjection:this.stepFeatureStore.layer.map.projection,dataProjection:this.stepFeatureStore.layer.map.projection}),h=this.stepFeatureStore.get(s);this.stepFeatureStore.update({type:ie,geometry:g,projection:this.stepFeatureStore.layer.map.projection,properties:{id:s,step:t,type:Di.Vertex},meta:{id:s,revision:(h?h.meta.revision:0)+1},ol:d}),o&&this.stepFeatureStore.layer.map.viewController.zoomToExtent(d.getGeometry().getExtent())}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[4,"ngIf"],[3,"mouseleave"],["mat-header","",1,"igo-route-title"],[1,"mat-caption"],["class","igo-steps","igoListItem","",3,"mouseenter","click",4,"ngFor","ngForOf"],[3,"placeholder","ngModel","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["igoListItem","",1,"igo-steps",3,"mouseenter","click"],["matListItemIcon","",3,"ngClass","svgIcon"],[1,"igo-step-text"],["matListItemMeta",""]],template:function(o,i){1&o&&e.YNc(0,DT,10,6,"div",0),2&o&&e.Q6J("ngIf",i.directions&&i.activeDirection)},dependencies:[f.mk,f.sg,f.O5,_.JJ,_.On,w.Hw,Z.i$,Z.Tg,Z.Yt,Ve.d,Z.ni,F.KE,F.hX,le.ey,se.gD,O.X$],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px;box-sizing:border-box}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:70%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700}.igo-steps[_ngcontent-%COMP%]{cursor:pointer;padding:35px 0}.igo-steps[_ngcontent-%COMP%]   .igo-step-text[_ngcontent-%COMP%]{overflow-wrap:break-word;word-wrap:break-word;white-space:pre-wrap}.mat-mdc-list-item[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:pre-wrap!important}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg)}.rotate-45[_ngcontent-%COMP%]{transform:rotate(45deg)}.rotate-270[_ngcontent-%COMP%]{transform:rotate(270deg)}.rotate-250[_ngcontent-%COMP%]{transform:rotate(250deg)}.rotate-290[_ngcontent-%COMP%]{transform:rotate(290deg)}.icon-flipped[_ngcontent-%COMP%]{transform:scaleY(-1)}"]})}return n})(),Kp=(()=>{class n{cdRef;languageService;directionsService;searchService;queryService;watcher;projection="EPSG:4326";zoomRoute$$;storeEmpty$$;storeChange$$;routesQueries$$=[];selectStopInteraction;translateStop;selectedRoute;focusOnStop=!1;isTranslating=!1;previousStops=[];searchs$$=[];contextUri;stopsStore;stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounce=200;length=2;coordRoundedDecimals=6;zoomToActiveRoute$=new fe.x;get directionControlIsActive(){return!this.queryService.queryEnabled}get interactions(){return[this.selectStopInteraction,this.translateStop,this.selectedRoute]}constructor(t,o,i,s,a){this.cdRef=t,this.languageService=o,this.directionsService=i,this.searchService=s,this.queryService=a}ngOnInit(){this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(()=>{(function dT(n,r){const t=new qt({motion:Y.None});oi(n,new xe({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:r.translate.instant("igo.geo.directionsForm.stopLayer"),zIndex:911,source:new Ae,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:sl})),n.layer.visible=!0,Yi(n,t)})(this.stopsFeatureStore,this.languageService),function gT(n,r){const t=new qt({motion:Y.None});oi(n,new xe({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:r.translate.instant("igo.geo.directionsForm.routeLayer"),zIndex:910,source:new Ae,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:sl})),n.layer.visible=!0,Yi(n,t)}(this.routesFeatureStore,this.languageService),function mT(n){const r=new qt({motion:Y.None});oi(n,new xe({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new Ae,showInLayerList:!1,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:sl})),n.layer.visible=!0,Yi(n,r)}(this.stepFeatureStore),this.initOlInteraction()},1)}ngOnDestroy(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(t=>t.unsubscribe()),this.zoomRoute$$.unsubscribe(),this.freezeStores()}freezeStores(){this.interactions.map(t=>this.routesFeatureStore.layer.map.ol.removeInteraction(t)),this.stopsFeatureStore.deactivateStrategyOfType(qt),this.routesFeatureStore.deactivateStrategyOfType(qt),this.stepFeatureStore.deactivateStrategyOfType(qt)}initEntityStores(){this.watcher=new fn(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}monitorActiveRouteZoom(){this.zoomRoute$$=this.zoomToActiveRoute$.subscribe(()=>{if(this.routesFeatureStore.count>=1){const t=this.routesFeatureStore.all().find(o=>o.properties.active);if(t){t.ol.getGeometry();const o=t.ol.getGeometry().getExtent();this.routesFeatureStore.layer.map.viewController.zoomToExtent(o)}}})}initOlInteraction(){this.selectStopInteraction=new Da.Z({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:t=>"pointermove"===t.type&&!t.dragging}),this.translateStop=new up.Z({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",t=>{this.isTranslating=!0,this.executeStopTranslation(t.features)}),this.translateStop.on("translateend",t=>{this.isTranslating=!1,this.executeStopTranslation(t.features)}),this.selectedRoute=new Da.Z({layers:[this.routesFeatureStore.layer.ol],condition:cp.V4,hitTolerance:7,filter:t=>t.get("type")===Di.Route&&t.get("active")&&!this.isTranslating}),this.selectedRoute.on("select",t=>{if(!1===this.focusOnStop){const o=pt(Q.vs(t.mapBrowserEvent.coordinate,this.routesFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals),i=rl(this.stopsStore);i.text=o.join(","),i.coordinates=[o[0],o[1]]}}),this.interactions.map(t=>this.routesFeatureStore.layer.map.ol.addInteraction(t))}onStopInputHasFocusChange(t){t?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}executeStopTranslation(t){if(0===t.getLength())return;const o=t.getArray()[0],i=o.getId(),s=Q.vs(o.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),a=this.stopsStore.get(i),l=pt(s,this.coordRoundedDecimals);a.coordinates=l,a.text=l.join(","),this.stopsStore.update(a)}monitorEmptyEntityStore(){this.storeEmpty$$=this.stopsStore.count$.pipe((0,fi.x)()).subscribe(t=>{if(t<2){if(rl(this.stopsStore),2===this.stopsStore.count)return void this.stopsStore.storeInitialized$.next(!0);this.stopsStore.storeInitialized$.next(!1)}this.routesQueries$$.map(o=>o.unsubscribe())})}monitorEntityStoreChange(){this.storeChange$$=this.stopsStore.entities$.pipe((0,ae.b)(this.debounce)).subscribe(t=>{this.handleStopDiff(t),nl(this.stopsStore),this.handleStopsFeature(),this.getRoutes(this.isTranslating)})}cancelSearch(){this.searchs$$.map(t=>t.unsubscribe())}handleStopDiff(t){const o=t.map(a=>R.removeUndefined({id:a.id,text:a.text,coordinates:a.coordinates})),i=Cs.findChanges(this.previousStops,o,["coordinates"]),s=i.added.concat(i.modified);s&&s.map(a=>{const l=a.newValue;if(l){const c=this.stopsStore.get(l.id),u=c.text;if(!u||0===u.length)return;const p=Hc(u,this.stopsFeatureStore.layer.map.projection);let d,g=!1;p.lonLat&&(g=!0),d=this.searchService.search(u,{searchType:"Feature"}),this.cancelSearch();const h=d.map(m=>m.request.pipe((0,I.U)(b=>b.filter(C=>g?"Point"===C.data.geometry.type&&C.data.geometry:C.data.geometry))));this.searchs$$=h.map(m=>m.pipe((0,I.U)(b=>b.filter(C=>g?"Point"===C.data.geometry.type&&C.data.geometry:C.data.geometry))).subscribe(b=>{if(b.length>0){const C=b[0].source,x=b[0].meta,A=b.map(k=>k.data);c.searchProposals||(c.searchProposals=[]),c.searchProposals=c.searchProposals.filter(k=>k.type===(g?Xn.Coord:Xn.Text));let M=c.searchProposals.find(k=>k.source===C);M?M.results=A:c.searchProposals.push({type:g?Xn.Coord:Xn.Text,source:C,meta:x,results:A})}this.cdRef.detectChanges()}))}}),this.previousStops=o}handleStopsFeature(){const t=this.stopsStore.all();t.filter(s=>s.coordinates).map(s=>this.addStopOverlay(s)),this.stopsFeatureStore.all().map(s=>{this.stopsStore.get(s.properties.id)||this.stopsFeatureStore.delete(s)}),t.filter(s=>!s.coordinates).map(s=>{const a=this.stopsFeatureStore.get(s.id);a&&this.stopsFeatureStore.delete(a)})}getRoutes(t=!1){const o=this.stopsStore.view.all().filter(l=>l.coordinates);if(o.length<2)return void this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());const i=o.map(l=>pt(l.coordinates,this.coordRoundedDecimals));this.routesQueries$$.map(l=>l.unsubscribe());const a=this.directionsService.route(i,t?{overview:!0,steps:!1,alternatives:!1,continue_straight:!1}:void 0);a&&a.map(l=>this.routesQueries$$.push(l.subscribe(c=>{this.routesFeatureStore.deleteMany(this.routesFeatureStore.all()),c.map(u=>function fT(n,r,t,o=!1,i=!1){const l=new ro.Z(r.geometry.coordinates).transform(t,n.map.projection),c=(new Ce.Z).writeGeometryObject(l,{featureProjection:n.map.projection,dataProjection:n.map.projection}),u=n.get(r.id),d={type:ie,geometry:c,projection:n.map.projection,properties:{id:r.id,type:Di.Route,active:o,direction:r},meta:{id:r.id,revision:(u?u.meta.revision:0)+1},ol:new Ze.Z({geometry:l})};n.update(d)}(this.routesFeatureStore,u,this.projection,u===c[0]))})))}addStopOverlay(t){!function hT(n,r,t,o,i){let s,a;switch(n.relativePosition){case Ei.Start:s="#008000",a=i.translate.instant("igo.geo.directionsForm.start");break;case Ei.End:s="#f64139",a=i.translate.instant("igo.geo.directionsForm.end");break;default:s="#ffd700",a=i.translate.instant("igo.geo.directionsForm.intermediate")+" #"+n.position}const l=new Ee.Z(Q.vs(n.coordinates,o,t.map.projection)),c=(new Ce.Z).writeGeometryObject(l,{featureProjection:t.map.projection,dataProjection:t.map.projection}),u=t.get(n.id),d={type:ie,geometry:c,projection:t.map.projection,properties:{id:n.id,type:Di.Stop,stopText:a,stopColor:s,stopOpacity:1,stop:n},meta:{id:n.id,revision:(u?u.meta.revision:0)+1},ol:new Ze.Z({geometry:l})};t.update(d)}(t,0,this.stopsFeatureStore,this.projection,this.languageService)}onToggleDirectionsControl(t){this.queryService.queryEnabled=!t;const o=this.routesFeatureStore.layer.map.ol;this.interactions.map(i=>t?o.addInteraction(i):o.removeInteraction(i))}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO),e.Y36(L),e.Y36(Qp),e.Y36(Vn),e.Y36(xa))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomToActiveRoute$:"zoomToActiveRoute$"},decls:7,vars:18,consts:[[1,"directions-options"],[3,"checked","labelPosition","change"],[3,"stepFeatureStore","contextUri","zoomToActiveRoute$","routesFeatureStore","stopsStore"],[3,"coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length","stopInputHasFocus"],[3,"stepFeatureStore","routesFeatureStore"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"mat-slide-toggle",1),e.NdJ("change",function(a){return i.onToggleDirectionsControl(a.checked)}),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e._UZ(4,"igo-directions-buttons",2),e.TgZ(5,"igo-directions-inputs",3),e.NdJ("stopInputHasFocus",function(a){return i.onStopInputHasFocusChange(a)}),e.qZA(),e._UZ(6,"igo-directions-results",4)),2&o&&(e.xp6(1),e.Q6J("checked",i.directionControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,16,"igo.geo.directionsForm.toggleActive")," "),e.xp6(2),e.Q6J("stepFeatureStore",i.stepFeatureStore)("contextUri",i.contextUri)("zoomToActiveRoute$",i.zoomToActiveRoute$)("routesFeatureStore",i.routesFeatureStore)("stopsStore",i.stopsStore),e.xp6(1),e.Q6J("coordRoundedDecimals",i.coordRoundedDecimals)("projection",i.projection)("stopsFeatureStore",i.stopsFeatureStore)("stopsStore",i.stopsStore)("debounce",i.debounce)("length",i.length),e.xp6(1),e.Q6J("stepFeatureStore",i.stepFeatureStore)("routesFeatureStore",i.routesFeatureStore))},dependencies:[tt.Rr,TT,IT,ET,O.X$],styles:[".directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}"]})}return n})();class li extends Fa{http;config;get enabled(){return!1!==this.options.enabled}set enabled(r){this.options.enabled=r}static _name="OSRM Qu\xe9bec";directionsUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/";options;constructor(r,t){super(),this.http=r,this.config=t,this.options=this.config.getConfig("directionsSources.osrm")||{},this.directionsUrl=this.options.url||this.directionsUrl}getName(){return li._name}route(r,t={}){const o=this.getRouteParams(t);return this.getRoute(r,o)}getRoute(r,t){return this.http.get(this.directionsUrl+r.join(";"),{params:t}).pipe((0,I.U)(o=>this.extractRoutesData(o)))}extractRoutesData(r){const t=[];return r.routes.forEach(o=>{t.push(this.formatRoute(o,r.waypoints))}),t}getRouteParams(r={}){return r.alternatives=void 0===r.alternatives||r.alternatives,r.steps=void 0===r.steps||r.steps,r.geometries=void 0!==r.geometries?r.geometries:"geojson",r.overview=void 0!==r.overview&&r.overview,r.continue_straight=void 0!==r.continue_straight&&r.continue_straight,new $.LE({fromObject:{alternatives:r.alternatives?"true":"false",overview:r.overview?"simplified":"full",steps:r.steps?"true":"false",geometries:r.geometries?r.geometries:"geojson",continue_straight:r.continue_straight?"true":"false"}})}formatRoute(r,t){const o=[];return r.legs.forEach(i=>{i.steps.forEach(s=>{o.push(s)})}),{id:Ie(),title:r.legs[0].summary,source:li._name,sourceType:jp.Route,order:1,format:qp.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:t,distance:r.distance,duration:r.duration,geometry:r.geometry,legs:r.legs,steps:o,weight:r.weight,weight_name:r.weight_name}}static \u0275fac=function(t){return new(t||li)(e.LFG($.eN),e.LFG(N))};static \u0275prov=e.Yz7({token:li,factory:li.\u0275fac})}function RT(n,r){return new li(n,r)}function NT(){return{provide:Fa,useFactory:RT,multi:!0,deps:[$.eN,N]}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[Array,$.LE]),(0,T.w6)("design:returntype",ue.y)],li.prototype,"getRoute",null);const Wp=[ie,Un];let BT=(()=>{class n{component;searchService;searchSourceService;mediaService;store;lonLat;pointerSearchStore=new xt([]);lastTimeoutRequest;store$$;layers$$;reverseSearch$$=[];hasPointerReverseSearchSource=!1;pointerMoveListener;searchPointerSummaryFeatureId="searchPointerSummaryFeatureId";igoSearchPointerSummaryDelay=1e3;igoSearchPointerSummaryEnabled=!1;mouseleave(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(t,o,i,s){this.component=t,this.searchService=o,this.searchSourceService=i,this.mediaService=s}ngOnInit(){this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.map.status$.pipe((0,Lt.P)(t=>t===ge.Done)).subscribe(()=>{this.store=new yt([],{map:this.map}),this.initStore()}),this.layers$$=this.map.layers$.subscribe(t=>{this.store&&!t.find(o=>"searchPointerSummaryId"===o.id)&&this.initStore()})}initStore(){oi(this.store,new xe({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new Ae,showInLayerList:!1,exportable:!1,browsable:!1,style:Ry}))}ngAfterContentChecked(){this.hasPointerReverseSearchSource=!!this.searchSourceService.getEnabledSources().filter(Ga).length}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerSearchStore.entities$.subscribe(t=>{this.entitiesToPointerOverlay(t)})}computeSummaryClosestFeature(t){const o={};return t.map(i=>{i.data.properties.type&&i.data.properties.distance>=0&&(o.hasOwnProperty(i.data.properties.type)?i.data.properties.distance<o[i.data.properties.type].distance&&(o[i.data.properties.type]={distance:i.data.properties.distance,title:i.meta.pointerSummaryTitle||i.meta.title}):o[i.data.properties.type]={distance:i.data.properties.distance,title:i.meta.pointerSummaryTitle||i.meta.title})}),o}entitiesToPointerOverlay(t){const o=this.computeSummaryClosestFeature(t),i=Object.keys(o),s=[],a=[];t.map(l=>{const c=i.indexOf(l.data.properties.type);-1!==c?(a.push(o[l.data.properties.type].title),i.splice(c,1),s.push(l.data.properties.type)):-1===s.indexOf(l.data.properties.type)&&a.push(l.meta.pointerSummaryTitle||l.meta.title)}),a.length&&this.addPointerOverlay(a.join("\n"))}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",t=>this.onMapEvent(t))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unsubscribeReverseSearch(){this.reverseSearch$$.map(t=>t.unsubscribe()),this.reverseSearch$$=[]}unlistenToMapPointerMove(){(0,Ke.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}onMapEvent(t){!t.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?(typeof this.lastTimeoutRequest<"u"&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=(0,Q.vs)(t.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(()=>{this.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()}sortByOrder(t,o){return t.source.displayOrder-o.source.displayOrder}onSearchCoordinate(){this.pointerSearchStore.clear();const t=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0);for(const o in t)t.length>0&&this.reverseSearch$$.push(t[o].request.subscribe(i=>{this.onSearch({research:t[o],results:i})}))}onSearch(t){const o=t.results,i=this.pointerSearchStore.all().filter(s=>s.source!==t.research.source).concat(o);this.pointerSearchStore.load(i.sort(this.sortByOrder))}addPointerOverlay(t){this.clearLayer();const o=new Ee.Z((0,Q.vs)(this.lonLat,"EPSG:4326",this.mapProjection)),i=new Ze.Z({geometry:o}),s=(new Ce.Z).writeGeometryObject(o,{featureProjection:this.mapProjection,dataProjection:this.mapProjection});this.store.setLayerFeatures([{type:ie,geometry:s,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:t},meta:{id:this.searchPointerSummaryFeatureId},ol:i}],Y.None)}clearLayer(){this.store&&this.store.clearLayer()}static \u0275fac=function(o){return new(o||n)(e.Y36(Le,2),e.Y36(Vn),e.Y36(Bt),e.Y36(ct))};static \u0275dir=e.lG2({type:n,selectors:[["","igoSearchPointerSummary",""]],hostBindings:function(o,i){1&o&&e.NdJ("mouseleave",function(){return i.mouseleave()})},inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"}})}return n})();class No extends it{http;languageService;static id="cadastre";static type=ie;constructor(r,t,o,i){super(i,o),this.http=r,this.languageService=t}getId(){return No.id}getType(){return No.type}getDefaultOptions(){return{title:"Cadastre (Qu\xe9bec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}}search(r,t){r=(r=(r=r.endsWith(",")?r.slice(0,-1):r).startsWith(",")?r.substr(1):r).replace(/ /g,"");const o=this.computeSearchRequestParams(r,t||{});return o.get("numero")&&o.get("numero").match(/^[0-9,]+$/g)?this.getCadastre(r,o):(0,z.of)([])}getCadastre(r,t){return this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,I.U)(o=>this.extractResults(o,r)))}computeSearchRequestParams(r,t){return new $.LE({fromObject:Object.assign({numero:r,epsg:"4326"},this.params,t.params||{})})}extractResults(r,t){return r.split("<br />").filter(o=>o.length>0).map(o=>this.dataToResult(o,t))}dataToResult(r,t){const o=r.split(";"),i=o[0],a=this.computeGeometry(o[7]),l={NoLot:i,Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"},c=[this.getId(),"cadastre",i].join(".");return{source:this,meta:{dataType:ie,id:c,title:i,score:Pi(t.trim(),i),icon:"map-marker"},data:{type:ie,projection:"EPSG:4326",geometry:a,properties:l,meta:{id:c,title:i}}}}computeGeometry(r){const t=(new ji.Z).readFeature(r,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:t.getGeometry().getType(),coordinates:t.getGeometry().getCoordinates()}}static \u0275fac=function(t){return new(t||No)(e.LFG($.eN),e.LFG(L),e.LFG(oe),e.LFG("options"))};static \u0275prov=e.Yz7({token:No,factory:No.\u0275fac})}function JT(n,r,t,o){return new No(n,r,t,o.getConfig(`searchSources.${No.id}`))}function UT(){return{provide:it,useFactory:JT,multi:!0,deps:[$.eN,L,oe,N]}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[String,$.LE]),(0,T.w6)("design:returntype",ue.y)],No.prototype,"getCadastre",null);class Bo extends it{http;static id="nominatim";static type=ie;constructor(r,t,o){super(t,o),this.http=r}getId(){return Bo.id}getType(){return Bo.type}getDefaultOptions(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}search(r,t){const o=this.computeSearchRequestParams(r,t||{});return o.get("q")?this.getSearch(r,o):(0,z.of)([])}getSearch(r,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,I.U)(o=>this.extractResults(o,r)))}computeSearchRequestParams(r,t){return new $.LE({fromObject:Object.assign({q:this.computeTerm(r),format:"json"},this.params,t.params||{})})}extractResults(r,t){return r.map(o=>this.dataToResult(o,t))}dataToResult(r,t){const o=this.computeProperties(r),i=this.computeGeometry(r),s=this.computeExtent(r),a=[this.getId(),"place",r.place_id].join(".");return{source:this,meta:{dataType:ie,id:a,title:r.display_name,icon:"map-marker",score:Pi(t.trim(),r.display_name)},data:{type:ie,projection:"EPSG:4326",geometry:i,extent:s,properties:o,meta:{id:a,title:r.display_name}}}}computeProperties(r){return{display_name:r.display_name,place_id:r.place_id,osm_type:r.osm_type,class:r.class,type:r.type}}computeGeometry(r){return{type:"Point",coordinates:[parseFloat(r.lon),parseFloat(r.lat)]}}computeExtent(r){return[parseFloat(r.boundingbox[2]),parseFloat(r.boundingbox[0]),parseFloat(r.boundingbox[3]),parseFloat(r.boundingbox[1])]}computeTerm(r){return this.computeTermTags(r)}computeTermTags(r){const t=super.getHashtagsValid(r,"amenity");return t?t.length?(r=r.replace(/(#[^\s]*)/g,""),t.forEach(o=>{r+="+["+o+"]"}),r):null:this.computeTermSettings(r)}computeTermSettings(r){return this.options.settings.forEach(t=>{"amenity"===t.name&&t.values.forEach(o=>{o.enabled&&"string"==typeof o.value&&o.value.split(",").forEach(s=>{r+="+["+s+"]"})})}),r}static \u0275fac=function(t){return new(t||Bo)(e.LFG($.eN),e.LFG("options"),e.LFG(oe))};static \u0275prov=e.Yz7({token:Bo,factory:Bo.\u0275fac})}function GT(n,r,t){return new Bo(n,r.getConfig(`searchSources.${Bo.id}`),t)}function qT(){return{provide:it,useFactory:GT,multi:!0,deps:[$.eN,N,oe]}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[String,$.LE]),(0,T.w6)("design:returntype",ue.y)],Bo.prototype,"getSearch",null);class Ao extends it{http;languageService;static id="storedqueries";static type=ie;static propertiesBlacklist=["boundedBy","id","coord_x","coord_y"];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(r,t,o,i){if(super(i,o),this.http=r,this.languageService=t,this.storedQueriesOptions=i,this.storedQueriesOptions&&!this.storedQueriesOptions.available)return;const u="title";if(this.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),this.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:u},this.resultTitle=u,console.log("Default values",this.storedQueriesOptions)),!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&this.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){let d="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw d+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(d)}this.storedQueriesOptions.fields instanceof Array||(this.storedQueriesOptions.fields=[this.storedQueriesOptions.fields]),this.multipleFieldsQuery=this.storedQueriesOptions.fields.length>1,this.storedQueriesOptions.fields.forEach((d,g)=>{if(this.multipleFieldsQuery&&!d.splitPrefix&&0!==g)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!d.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}getId(){return Ao.id}getType(){return Ao.type}getDefaultOptions(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}search(r,t){const o=this.termSplitter(r,this.storedQueriesOptions.fields),i=this.computeRequestParams(t||{},o);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=t.page?String(t.page):"1",this.getSearch(r,i)}getSearch(r,t){return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,I.U)(o=>{let i=this.extractResults(this.extractWFSData(o),r);if(i.sort((s,a)=>s.meta.score>a.meta.score||s.meta.score===a.meta.score&&s.meta.titleHtml<a.meta.titleHtml?1:-1),i.reverse(),i.length>Number(this.options.params.limit)){const s=Number(this.options.params.limit)*Number(this.options.params.page),a=i.length;i=i.slice(0,s),i[i.length-1].meta.nextPage=s<a}return i})):this.http.get(this.searchUrl,{params:t}).pipe((0,I.U)(o=>this.extractResults(this.extractWFSData(o),r)))}getFormatFromOptions(){let r;const t=this.storedQueriesOptions.outputformat,o=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(r=Ce.Z),o.test(t)&&(r=Ai.Z),new r}extractWFSData(r){const t=this.getFormatFromOptions(),o=Ce.Z,i=t.readFeatures(r);return JSON.parse((new o).writeFeatures(i))}termSplitter(r,t){const o={};let i=r,s=0;return t.forEach(l=>{o[l.name]=l.defaultValue;const c=new RegExp(l.splitPrefix+"(.+)","i");c.test(i)&&(s=l.splitPrefix?s+=1:s,i=i.split(c)[1])}),0===s?(o[t[0].name]=r,o):(i=r,[...t].reverse().forEach(l=>{const c=new RegExp(l.splitPrefix||"(.+)","i");if(i||""!==i){const u=i.split(c);i=u[0],u[1]&&(o[l.name]=u[1].trim())}}),o)}computeRequestParams(r,t){const o=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new $.LE({fromObject:Object.assign({service:"wfs",version:o,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,r.params||{})})}extractResults(r,t){return r.features.map(o=>this.dataToResult(o,t))}dataToResult(r,t){const o=this.computeProperties(r),i=[this.getId(),o.type,r.id].join("."),s=r.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:ie,projection:"EPSG:4326",geometry:r.geometry,properties:o,meta:{id:i,title:r.properties[s]}},meta:{dataType:ie,id:i,title:r.properties.title,titleHtml:r.properties[s],icon:"map-marker",score:Pi(t.trim(),r.properties.title?r.properties.title:r.properties[s])}}}computeProperties(r){return Object.assign({},R.removeKeys(r.properties,Ao.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}static \u0275fac=function(t){return new(t||Ao)(e.LFG($.eN),e.LFG(L),e.LFG(oe),e.LFG("options"))};static \u0275prov=e.Yz7({token:Ao,factory:Ao.\u0275fac})}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[String,$.LE]),(0,T.w6)("design:returntype",ue.y)],Ao.prototype,"getSearch",null);class Lo extends it{http;languageService;static id="storedqueriesreverse";static type=ie;static propertiesBlacklist=[];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(r,t,o,i){if(super(i,o),this.http=r,this.languageService=t,this.storedQueriesOptions=i,this.storedQueriesOptions&&(!this.storedQueriesOptions||this.storedQueriesOptions.available)){if(!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!this.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return Lo.id}getType(){return Lo.type}getDefaultOptions(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}reverseSearch(r,t){const o=this.computeRequestParams(r,t||{});return this.getReverseSearch(o)}getReverseSearch(r){return(new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:r,responseType:"text"}):this.http.get(this.searchUrl,{params:r})).pipe((0,I.U)(i=>this.extractResults(this.extractWFSData(i))))}getFormatFromOptions(){let r;const t=this.storedQueriesOptions.outputformat,o=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(r=Ce.Z),o.test(t)&&(r=Ai.Z),new r}extractWFSData(r){const t=this.getFormatFromOptions(),o=Ce.Z,i=t.readFeatures(r);return JSON.parse((new o).writeFeatures(i))}computeRequestParams(r,t){const o={};return o[this.storedQueriesOptions.longField]=r[0],o[this.storedQueriesOptions.latField]=r[1],new $.LE({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},o,this.params,t.params||{})})}extractResults(r){return r.features.map(t=>this.dataToResult(t))}dataToResult(r){const t=this.computeProperties(r),o=[this.getId(),t.type,r.id].join("."),i=r.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:ie,projection:"EPSG:4326",geometry:r.geometry,properties:t,meta:{id:o,title:r.properties[i]}},meta:{dataType:ie,id:o,title:r.properties[i],icon:"map-marker"}}}computeProperties(r){const t=R.removeKeys(r.properties,Lo.propertiesBlacklist),o={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,{type:r.properties.doc_type},o)}static \u0275fac=function(t){return new(t||Lo)(e.LFG($.eN),e.LFG(L),e.LFG(oe),e.LFG("options"))};static \u0275prov=e.Yz7({token:Lo,factory:Lo.\u0275fac})}function jT(n,r,t,o){return new Ao(n,r,t,o.getConfig(`searchSources.${Ao.id}`))}function QT(){return{provide:it,useFactory:jT,multi:!0,deps:[$.eN,L,oe,N]}}function YT(n,r,t,o){return new Lo(n,r,t,o.getConfig(`searchSources.${Lo.id}`))}function HT(){return{provide:it,useFactory:YT,multi:!0,deps:[$.eN,L,oe,N]}}(0,T.gn)([(0,Mt.q)({maxCacheCount:20,cacheHasher:Uo}),(0,T.w6)("design:type",Function),(0,T.w6)("design:paramtypes",[$.LE]),(0,T.w6)("design:returntype",ue.y)],Lo.prototype,"getReverseSearch",null);let Xp=(()=>{class n extends it{languageService;static id="workspace";static type=ie;title$=new y.X("");get title(){return this.title$.getValue()}constructor(t,o,i){super(i,o),this.languageService=t,this.languageService.translate.get(this.options.title).subscribe(s=>this.title$.next(s))}getId(){return n.id}getType(){return n.type}getDefaultOptions(){return{title:"igo.geo.search.workspace.name",searchUrl:void 0,settings:[{type:"checkbox",title:"datasets",name:"datasets",values:[]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]}]}}search(t,o){const s=this.settings.find(d=>"limit"===d.name).values.find(d=>d.enabled).value||5;this.options.params.limit=s.toLocaleString();const a=[];this.options.params.page=(o.page||1).toLocaleString();const l=o.page||1,c=this.options.params.datasets.split(",");this.featureStoresWithIndex.filter(d=>d.searchDocument&&c.includes(d.layer.title)).map(d=>{const g=t;d.searchDocument.search(g,{limit:l*s}).map(h=>{const b=h.field;h.result.map(C=>{const x=d.index.get(C),A=Pi(g.trim(),x.properties[b]);a.push({index:C,feature:x,layer:d.layer,field:b,score:A})})})}),a.sort((d,g)=>d.score>g.score?-1:1);const u=[],p=[];return a.map(d=>{u.includes(d.index)||(u.push(d.index),p.push(d))}),(0,z.of)(this.extractResults(p.sort((d,g)=>d.score>g.score?-1:1).slice(0,l*s)))}extractResults(t){return t.map(o=>this.dataToResult(o,t.length))}dataToResult(t,o){const i=this.computeProperties(t),s=[this.getId(),i.type,t.index].join("."),a=t.feature.properties[t.field],l="<br><small> "+t.layer.title+"</small>";return{source:this,data:{type:ie,projection:"EPSG:4326",geometry:t.feature.geometry,extent:t.feature.extent,properties:i,meta:{id:s,title:t.feature.properties[t.field],alias:this.getAllowedFieldsAndAlias(t.layer)}},meta:{dataType:ie,id:s,title:t.feature.meta.title,titleHtml:a+l,icon:"map-marker",score:t.score,nextPage:o%+this.options.params.limit==0&&+this.options.params.page<10}}}getAllowedFieldsAndAlias(t){let o;return t.options?.source?.options?.sourceFields&&t.options.source.options.sourceFields.length>=1&&(o={},t.options.source.options.sourceFields.forEach(i=>{o[i.name]=i.alias?i.alias:i.name})),o}computeProperties(t){if(!t.feature.geometry)return Object.assign({type:t.layer.title+"."+t.field},t.feature.properties);const o={GoogleMaps:""};let i;if("Point"===t.feature.geometry.type)i=Pt.getGoogleMapsCoordLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]);else{const a=(0,jr.Z)(t.feature.geometry);i=Pt.getGoogleMapsCoordLink(a.geometry.coordinates[0],a.geometry.coordinates[1])}o.GoogleMaps="<a href="+i+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a>","Point"===t.feature.geometry.type&&(o.GoogleStreetView=Pt.getGoogleStreetViewLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]));const s={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:t.feature.sourceId},t.feature.properties,o,s)}static \u0275fac=function(o){return new(o||n)(e.LFG(L),e.LFG(oe),e.LFG("options"))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();function VT(n,r,t){return new Xp(n,r,t.getConfig(`searchSources.${Xp.id}`))}function zT(){return{provide:it,useFactory:VT,multi:!0,deps:[L,oe,N]}}function KT(n,r){if(1&n&&(e.TgZ(0,"mat-radio-button",7),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,o.getSearchTypeTitle(t))," ")}}let WT=(()=>{class n{searchSourceService;searchType$=new y.X(void 0);searchType$$;searchTypes=Wp;set searchType(t){this.setSearchType(t)}get searchType(){return this.searchType$.value}searchTypeChange=new e.vpe;constructor(t){this.searchSourceService=t}ngOnInit(){this.searchType$$=this.searchType$.pipe((0,fi.x)()).subscribe(t=>this.onSetSearchType(t))}ngOnDestroy(){this.searchType$$.unsubscribe()}onSearchTypeChange(t){this.setSearchType(t)}getSearchTypeTitle(t){return`igo.geo.search.${t.toLowerCase()}.title`}setSearchType(t){this.searchType$.next(t)}onSetSearchType(t){null!=t&&(this.searchSourceService.enableSourcesByType(t),this.searchTypeChange.emit(t))}static \u0275fac=function(o){return new(o||n)(e.Y36(Bt))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},decls:9,vars:8,consts:[[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","menu-down"],["xPosition","before","yPosition","above",1,"no-border-radius"],["searchSelectorMenu","matMenu"],[1,"igo-search-selector-radio-group",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(o,i){if(1&o&&(e.TgZ(0,"div",0)(1,"button",1),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"mat-menu",3,4)(6,"mat-radio-group",5),e.NdJ("change",function(a){return i.onSearchTypeChange(a.value)}),e.ALo(7,"async"),e.YNc(8,KT,3,4,"mat-radio-button",6),e.qZA()()()),2&o){const s=e.MAs(5);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",s),e.xp6(5),e.Q6J("value",e.lcZ(7,6,i.searchType$)),e.xp6(2),e.Q6J("ngForOf",i.searchTypes)}},dependencies:[f.sg,P.gM,w.Hw,S.RK,Be.VK,Be.p6,nt.VQ,nt.U0,f.Ov,O.X$],styles:["[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]{border-radius:0}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}"],changeDetection:0})}return n})();function XT(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",11)(1,"button",12),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.checkUncheckAllSources(i))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.hij(" ",t.searchSourcesAllEnabled?e.lcZ(4,3,"igo.geo.search.searchSources.selectAll"):e.lcZ(3,1,"igo.geo.search.searchSources.unselectAll")," ")}}function e2(n,r){if(1&n&&(e.TgZ(0,"button",18),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,o=e.MAs(6);e.Q6J("matMenuTriggerFor",o),e.xp6(1),e.hij(" ",t.title," ")}}function t2(n,r){if(1&n&&(e.TgZ(0,"button",8),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function o2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-radio-button",24),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(i){const a=e.CHM(t).$implicit,l=e.oxw(2).$implicit,c=e.oxw().$implicit,u=e.oxw();return e.KtG(u.settingsValueCheckedRadioButton(i,c,l,a))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(4);e.Q6J("value",t)("matTooltip",o.getAvailableHashtagsValues(t))("checked",t.enabled),e.xp6(1),e.hij(" ",e.lcZ(2,4,t.title)," ")}}function n2(n,r){if(1&n&&(e.TgZ(0,"span")(1,"mat-radio-group",22),e.YNc(2,o2,3,6,"mat-radio-button",23),e.qZA()()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.Q6J("ngForOf",t.values)}}function r2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",11)(1,"button",12),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw(2).$implicit,a=e.oxw().$implicit,l=e.oxw();return e.KtG(l.checkUncheckAll(i,a,s))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&n){const t=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",t.allEnabled||void 0===t.allEnabled?e.lcZ(3,1,"igo.geo.search.searchSources.settings.unselectAll"):e.lcZ(4,3,"igo.geo.search.searchSources.settings.selectAll")," ")}}function s2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",26)(1,"mat-checkbox",27),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(i){const a=e.CHM(t).$implicit,l=e.oxw(2).$implicit,c=e.oxw().$implicit,u=e.oxw();return e.KtG(u.settingsValueCheckedCheckbox(i,c,l,a))}),e._uU(2),e.ALo(3,"translate"),e.qZA()()}if(2&n){const t=r.$implicit,o=e.oxw(2).$implicit,i=e.oxw(2);e.xp6(1),e.Udp("display",i.displayBlock),e.Q6J("checked",t.enabled)("value",o)("matTooltip",i.getAvailableHashtagsValues(t)),e.xp6(1),e.hij(" ",e.lcZ(3,6,t.title)," ")}}function a2(n,r){if(1&n&&(e.TgZ(0,"span"),e.YNc(1,r2,5,5,"div",5),e.YNc(2,s2,4,8,"div",25),e.qZA()),2&n){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.values.length>3),e.xp6(1),e.Q6J("ngForOf",o.getAvailableValues(t))}}function l2(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"button",18),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-menu",19,20),e.YNc(6,n2,3,2,"span",21),e.YNc(7,a2,3,2,"span",21),e.qZA(),e.BQk()),2&n){const t=r.$implicit,o=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",o),e.xp6(1),e.hij(" ",e.lcZ(3,5,"igo.geo.search.searchSources.settings."+t.title)," "),e.xp6(2),e.Q6J("ngSwitch",t.type),e.xp6(2),e.Q6J("ngSwitchCase","radiobutton"),e.xp6(1),e.Q6J("ngSwitchCase","checkbox")}}function c2(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"span",13)(2,"mat-checkbox",14),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(i){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onCheckSearchSource(i,a))}),e.qZA(),e.YNc(3,e2,2,2,"button",15),e.YNc(4,t2,2,1,"button",16),e.qZA(),e.TgZ(5,"mat-menu",null,17),e.YNc(7,l2,8,7,"ng-container",6),e.qZA(),e.BQk()}if(2&n){const t=r.$implicit;e.xp6(2),e.Q6J("checked",t.enabled)("value",t),e.xp6(1),e.Q6J("ngIf",t.settings.length>0),e.xp6(1),e.Q6J("ngIf",0===t.settings.length),e.xp6(3),e.Q6J("ngForOf",t.settings)}}function u2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-slide-toggle",10),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.changePointerReverseSearch(i))})("click",function(i){return i.stopPropagation()}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",t.pointerSummaryEnabled),e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.geo.search.pointerSearchSummary.title")," ")}}let p2=(()=>{class n{searchSourceService;mediaService;storageService;hasPointerReverseSearchSource=!1;searchSourcesAllEnabled=!1;buffer=[];lastKeyTime=Date.now();displayBlock="block";get isTouchScreen(){return this.mediaService.isTouchScreen()}pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;reverseSearchCoordsFormatEnabled=!1;searchSourceChange=new e.vpe;pointerSummaryStatus=new e.vpe;searchResultsGeometryStatus=new e.vpe;reverseSearchCoordsFormatStatus=new e.vpe;handleKeyboardEvent(t){"F2"===t.key&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}constructor(t,o,i){this.searchSourceService=t,this.mediaService=o,this.storageService=i}ngOnInit(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}getSearchSources(){const t=this.searchSourceService.getSources().filter(Hn).filter(s=>s.available&&"map"!==s.getId()&&s.showInSettings),o=this.searchSourceService.getSources().filter(yp).filter(s=>s.available&&"map"!==s.getId()&&s.showInSettings),i=t.concat(o);return this.computeSourcesCheckAllBehavior(i),i}hasReverseSearchSourcesForPointerSummary(){return!!this.searchSourceService.getEnabledSources().filter(Ga).length}settingsValueCheckedCheckbox(t,o,i,s){s.enabled=t.checked,o.setParamFromSetting(i),this.searchSourceChange.emit(o)}computeSettingCheckAllBehavior(t){t.allEnabled=void 0===t.allEnabled?!t.values.find(o=>o.enabled):!t.allEnabled}computeSourcesCheckAllBehavior(t){const o=t.filter(s=>s.enabled).length,i=t.filter(s=>!s.enabled).length;this.searchSourcesAllEnabled=!(o>=i)}checkUncheckAll(t,o,i){t.stopPropagation(),this.computeSettingCheckAllBehavior(i),i.values.forEach(s=>{s.enabled=i.allEnabled}),o.setParamFromSetting(i),this.searchSourceChange.emit(o)}checkUncheckAllSources(t){t.stopPropagation(),this.getSearchSources().map(o=>{o.enabled=this.searchSourcesAllEnabled,this.searchSourceChange.emit(o)})}settingsValueCheckedRadioButton(t,o,i,s){i.values.forEach(a=>{a.enabled=a.value!==s.value?!t.source.checked:t.source.checked}),o.setParamFromSetting(i),this.searchSourceChange.emit(o)}onCheckSearchSource(t,o){o.enabled=t.checked;const i=this.storageService.get(o.getId()+".options")||{};i.enabled=o.enabled,this.storageService.set(o.getId()+".options",i),this.searchSourceChange.emit(o)}getAvailableValues(t){return t.values.filter(o=>!1!==o.available)}getAvailableHashtagsValues(t){if(t.hashtags)return t.hashtags.map(o=>"#"+o).join(", ")}stopPropagation(t){t.stopPropagation()}changePointerReverseSearch(t){this.pointerSummaryEnabled=t.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}changeSearchResultsGeometry(t){this.searchResultsGeometryEnabled=t.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}reverseSearchCoordsFormat(t){this.reverseSearchCoordsFormatEnabled=t.checked,this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled)}static \u0275fac=function(o){return new(o||n)(e.Y36(Bt),e.Y36(ct),e.Y36(oe))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-search-settings"]],hostBindings:function(o,i){1&o&&e.NdJ("keydown",function(a){return i.handleKeyboardEvent(a)},!1,e.evT)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus"},decls:23,vars:23,consts:[[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","chevron-down"],[1,"no-border-radius"],["searchSettingsMenu","matMenu"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"pointer-summary-slide-toggle-container"],["mat-menu-item",""],["class","search-option","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","change","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500",1,"search-option",3,"matTooltip","checked","change","click"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"checked","value","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["sub_menu","matMenu"],["mat-menu-item","",3,"matMenuTriggerFor"],["yPosition","above",3,"ngSwitch"],["test_sub_menu","matMenu"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","matTooltip","checked","click","change"],["class","igo-search-settings-sub-menu","mat-menu-item","",4,"ngFor","ngForOf"],["mat-menu-item","",1,"igo-search-settings-sub-menu"],[3,"checked","value","matTooltip","click","change"]],template:function(o,i){if(1&o&&(e.TgZ(0,"div",0)(1,"button",1),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"mat-menu",3,4),e.YNc(6,XT,5,5,"div",5),e.YNc(7,c2,8,5,"ng-container",6),e._UZ(8,"mat-divider"),e.TgZ(9,"span",7)(10,"div",8),e.YNc(11,u2,4,7,"mat-slide-toggle",9),e.qZA(),e.TgZ(12,"div",8)(13,"mat-slide-toggle",10),e.NdJ("change",function(a){return i.changeSearchResultsGeometry(a)})("click",function(a){return a.stopPropagation()}),e.ALo(14,"translate"),e._uU(15),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"div",8)(18,"mat-slide-toggle",10),e.NdJ("change",function(a){return i.reverseSearchCoordsFormat(a)})("click",function(a){return a.stopPropagation()}),e.ALo(19,"translate"),e.ALo(20,"translate"),e._uU(21),e.ALo(22,"translate"),e.qZA()()()()()),2&o){const s=e.MAs(5);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,11,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",s),e.xp6(5),e.Q6J("ngIf",i.getSearchSources().length>4),e.xp6(1),e.Q6J("ngForOf",i.getSearchSources()),e.xp6(4),e.Q6J("ngIf",i.hasPointerReverseSearchSource&&!i.isTouchScreen),e.xp6(2),e.Q6J("matTooltip",e.lcZ(14,13,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",i.searchResultsGeometryEnabled),e.xp6(2),e.hij(" ",e.lcZ(16,15,"igo.geo.search.searchResultsGeometry.title")," "),e.xp6(3),e.Q6J("matTooltip",i.reverseSearchCoordsFormatEnabled?e.lcZ(19,17,"igo.geo.search.reverseCoordFormat.tooltipLatLon"):e.lcZ(20,19,"igo.geo.search.reverseCoordFormat.tooltipLonLat"))("checked",i.reverseSearchCoordsFormatEnabled),e.xp6(3),e.hij(" ",e.lcZ(22,21,"igo.geo.search.reverseCoordFormat.title")," ")}},dependencies:[f.sg,f.O5,f.RF,f.n9,P.gM,w.Hw,S.lW,S.RK,Be.VK,Be.OP,Be.p6,nt.VQ,nt.U0,ze.oG,Ve.d,tt.Rr,O.X$],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-right:16px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.search-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px 0}.igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.igo-search-settings-sub-menu[_ngcontent-%COMP%]{min-height:34px}"],changeDetection:0})}return n})();const d2=["input"];function g2(n,r){if(1&n&&(e.TgZ(0,"mat-label"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.label)}}function m2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onClearButtonClick())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",12),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.geo.search.clearSearch"))}}function h2(n,r){1&n&&e._UZ(0,"mat-divider",13),2&n&&e.Q6J("vertical",!0)}function f2(n,r){if(1&n&&(e.TgZ(0,"button",14),e._UZ(1,"mat-icon",15),e.qZA()),2&n){const t=e.oxw();e.Q6J("color",t.color)}}function _2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-search-selector",16),e.NdJ("searchTypeChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onSearchTypeChange(i))}),e.ALo(1,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("searchTypes",t.searchTypes)("searchType",e.lcZ(1,2,t.searchType$))}}function y2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-search-settings",17),e.NdJ("pointerSummaryStatus",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.pointerSummaryStatus.emit(i))})("searchResultsGeometryStatus",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.searchResultsGeometryStatus.emit(i))})("reverseSearchCoordsFormatStatus",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.reverseSearchCoordsFormatStatus.emit(i))})("searchSourceChange",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onSearchSettingsChange())}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("pointerSummaryEnabled",t.pointerSummaryEnabled)("searchResultsGeometryEnabled",t.searchResultsGeometryEnabled)("reverseSearchCoordsFormatEnabled",t.reverseSearchCoordsFormatEnabled)}}const b2=function(n){return{empty:n}},v2=function(n){return{hasSearchIcon:n}};let C2=(()=>{class n{configService;searchService;searchSourceService;static invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"];placeholder$=new y.X("igo.geo.search.placeholder");empty$=new y.X(!0);term$$;stream$=new y.X("");stream$$;searchType$$;researches$$;showSearchButton=!1;searchTypes=Wp;withDivider;set searchType(t){this.setSearchType(t)}get searchType(){return this.searchType$.value}searchType$=new y.X(void 0);pointerSummaryStatus=new e.vpe;searchResultsGeometryStatus=new e.vpe;reverseSearchCoordsFormatStatus=new e.vpe;set term(t){this.setTerm(t)}get term(){return this.term$.value}term$=new y.X("");set disabled(t){this.disabled$.next(t)}get disabled(){return this.disabled$.value}disabled$=new y.X(!1);pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;get reverseSearchCoordsFormatEnabled(){return this._reverseSearchCoordsFormatEnabled}set reverseSearchCoordsFormatEnabled(t){this._reverseSearchCoordsFormatEnabled=t,this.setTerm(this.term,!0)}_reverseSearchCoordsFormatEnabled=!1;floatLabel="auto";appearance="fill";placeholder;label;color="primary";termSplitter="|";debounce=200;minLength=2;searchSelector=!1;searchSettings=!1;forceNA=!1;store;searchTermChange=new e.vpe;search=new e.vpe;searchTypeChange=new e.vpe;clearFeature=new e.vpe;searchSettingsChange=new e.vpe;input;get empty(){return 0===this.term.length}constructor(t,o,i){this.configService=t,this.searchService=o,this.searchSourceService=i}ngOnInit(){this.term$$=this.term$.subscribe(o=>{this.empty$.next(void 0===o||0===o.length)}),this.stream$$=this.stream$.pipe((0,In.D)(()=>(0,Mn.H)(this.debounce))).subscribe(o=>this.onSetTerm(o)),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe((0,fi.x)()).subscribe(o=>this.onSetSearchType(o));const t=this.configService.getConfig("searchBar.showSearchButton");this.showSearchButton=void 0!==t&&t}ngOnDestroy(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}onKeyup(t){this.keyIsValid(t.key)&&this.setTerm(t.target.value)}onClearButtonClick(){this.clear(),this.clearFeature.emit()}onSearchTypeChange(t){this.setSearchType(t)}setSearchType(t){this.searchType$.next(t)}onSearchSettingsChange(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}setTerm(t,o){if(this.disabled)return;(t=t||"")!==this.term&&!o&&this.term$.next(t);const i=t.replace(/(#[^\s]*)/g,"").trim();(i.length>=this.minLength||0===i.length)&&this.stream$.next(t)}clear(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}keyIsValid(t){return-1===n.invalidKeys.indexOf(t)}onSetTerm(t){this.searchTermChange.emit(t),this.doSearch(t)}handlePlaceholder(){const t=[...new Set(this.searchSourceService.getEnabledSources().filter(i=>!["map","coordinatesreverse"].includes(i.getId())).map(i=>i.getType()))];let o="igo.geo.search.placeholder";1===t.length?o=`igo.geo.search.${t[0].toLowerCase()}.placeholder`:0===t.length&&(o="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(o)}onSetSearchType(t){if(null==t)return;this.searchTypeChange.emit(t);const o=`igo.geo.search.${t.toLowerCase()}.placeholder`;this.placeholder$.next(o),this.setTerm(this.term)}doSearch(t){let o;this.researches$$&&(this.researches$$.map(s=>s.unsubscribe()),this.researches$$=void 0),this.termSplitter&&t.match(new RegExp(this.termSplitter,"g"))?(o=t.split(this.termSplitter).filter(s=>s.length>=this.minLength),this.store&&this.store.clear()):o=[t];let i=[];o.map(s=>{""!==(s?s.replace(/(#[^\s]*)/g,"").trim():"")?i=i.concat(this.searchService.search(s,{forceNA:this.forceNA})):void 0!==this.store&&this.store.clear()}),this.researches$$=i.map(s=>s.request.subscribe(a=>{this.onResearchCompleted(s,a)}))}onResearchCompleted(t,o){if(this.search.emit({research:t,results:o}),void 0!==this.store){const i=this.store.all().filter(s=>s.source!==t.source).concat(o);this.store.updateMany(i)}}static \u0275fac=function(o){return new(o||n)(e.Y36(N),e.Y36(Vn),e.Y36(Bt))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-search-bar"]],viewQuery:function(o,i){if(1&o&&e.Gf(d2,7),2&o){let s;e.iGM(s=e.CRH())&&(i.input=s.first)}},inputs:{searchTypes:"searchTypes",withDivider:"withDivider",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},decls:17,vars:29,consts:[[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"ngClass","disabled","placeholder","value","keyup","touchend"],["input",""],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click",4,"ngIf"],[3,"vertical",4,"ngIf"],[1,"search-bar-buttons"],["mat-icon-button","",3,"color",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click"],["svgIcon","close"],[3,"vertical"],["mat-icon-button","",3,"color"],["svgIcon","magnify"],[3,"searchTypes","searchType","searchTypeChange"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e.TgZ(2,"mat-form-field",1),e.YNc(3,g2,2,1,"mat-label",2),e.TgZ(4,"input",3,4),e.NdJ("keyup",function(a){return i.onKeyup(a)})("touchend",function(a){return i.onKeyup(a)}),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"translate"),e.ALo(9,"async"),e.qZA(),e.YNc(10,m2,3,4,"button",5),e.ALo(11,"async"),e.qZA(),e.YNc(12,h2,1,1,"mat-divider",6),e.TgZ(13,"div",7),e.YNc(14,f2,2,1,"button",8),e.YNc(15,_2,2,4,"igo-search-selector",9),e.YNc(16,y2,1,3,"igo-search-settings",10),e.qZA()()),2&o&&(e.Q6J("ngClass",e.VKq(25,b2,e.lcZ(1,13,i.empty$))),e.xp6(2),e.Q6J("floatLabel",i.floatLabel)("appearance",i.appearance),e.xp6(1),e.Q6J("ngIf",i.label),e.xp6(1),e.Q6J("ngClass",e.VKq(27,v2,i.showSearchButton))("disabled",e.lcZ(6,15,i.disabled$))("placeholder",i.placeholder?i.placeholder:e.lcZ(7,17,i.placeholder$)?e.lcZ(8,19,i.placeholder$.value):void 0)("value",e.lcZ(9,21,i.term$)),e.xp6(6),e.Q6J("ngIf",!1===e.lcZ(11,23,i.empty$)),e.xp6(2),e.Q6J("ngIf",i.withDivider),e.xp6(2),e.Q6J("ngIf",i.showSearchButton),e.xp6(1),e.Q6J("ngIf",i.searchSelector),e.xp6(1),e.Q6J("ngIf",i.searchSettings))},dependencies:[f.mk,f.O5,P.gM,w.Hw,S.RK,Ve.d,F.KE,F.hX,F.R9,j.Nt,WT,p2,f.Ov,O.X$],styles:['[_nghost-%COMP%]   .igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:flex}[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   mat-divider[_ngcontent-%COMP%]{margin:8px 0}[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{align-items:center;padding-right:0}[_nghost-%COMP%]     .mat-mdc-form-field-infix{align-self:center}[_nghost-%COMP%]     mat-form-field input{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}[_nghost-%COMP%]   .search-bar-buttons[_ngcontent-%COMP%]{position:relative;display:inline-flex}[_nghost-%COMP%]   .search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";border-right:1px solid #ddd;height:28px}[_nghost-%COMP%]   igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}[_nghost-%COMP%]   igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}[_nghost-%COMP%]     mat-form-field .mdc-line-ripple{display:none}'],changeDetection:0})}return n})();function x2(n,r){if(1&n&&e._UZ(0,"mat-icon",6),2&n){const t=e.oxw();e.Q6J("svgIcon",t.showIcons?t.icon:"blank")}}function S2(n,r){if(1&n&&e._UZ(0,"div",7),2&n){const t=e.oxw();e.Q6J("innerHtml",t.titleHtml,e.oJD)("matTooltip",t.tooltipHtml)}}function w2(n,r){if(1&n&&(e.TgZ(0,"span",9),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("matTooltip",t.title),e.xp6(1),e.Oqu(t.title)}}function T2(n,r){if(1&n&&e.YNc(0,w2,2,2,"span",8),2&n){const t=e.oxw();e.Q6J("ngIf",!t.titleHtml)}}function F2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onZoomHandler())}),e._UZ(1,"mat-icon",11),e.qZA()}}const O2=[[["","igoSearchItemToolbar",""]]],A2=["[igoSearchItemToolbar]"];let ed=(()=>{class n{result;map;showIcons;withZoomButton=!1;zoomEvent=new e.vpe;format=new Ce.Z;get title(){return ho(this.result)}get titleHtml(){return function cm(n){const r=n.meta||{};return r.titleHtml?r.titleHtml:vi(n,r.titleHtmlProperty||"titleHtml")}(this.result)}get tooltipHtml(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")}get icon(){return mr(this.result)}onZoomHandler(){const t=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});vo(this.map.viewController,[t],Y.Default)}onMouseEvent(t){const o=t.target;switch(t.type){case"mouseenter":const s=o.querySelector("#hide-save-search-result-btn");s&&s.setAttribute("id","show-save-search-result-btn");break;case"mouseleave":const a=o.querySelector("#show-save-search-result-btn");a&&a.setAttribute("id","hide-save-search-result-btn")}}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},ngContentSelectors:A2,decls:8,vars:4,consts:[[3,"mouseenter","mouseleave"],["matListItemIcon","",3,"svgIcon",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf","ngIfElse"],["normalTitle",""],["matListItemMeta",""],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["matListItemIcon","",3,"svgIcon"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"],["svgIcon","magnify"]],template:function(o,i){if(1&o&&(e.F$t(O2),e.TgZ(0,"mat-list-item",0),e.NdJ("mouseenter",function(a){return i.onMouseEvent(a)})("mouseleave",function(a){return i.onMouseEvent(a)}),e.YNc(1,x2,1,1,"mat-icon",1),e.YNc(2,S2,1,2,"div",2),e.YNc(3,T2,1,1,"ng-template",null,3,e.W1O),e.TgZ(5,"div",4),e.YNc(6,F2,2,0,"button",5),e.Hsn(7),e.qZA()()),2&o){const s=e.MAs(4);e.xp6(1),e.Q6J("ngIf",i.icon),e.xp6(1),e.Q6J("ngIf",i.titleHtml)("ngIfElse",s),e.xp6(4),e.Q6J("ngIf",i.withZoomButton)}},dependencies:[f.O5,_n,S.RK,w.Hw,Z.Tg,Z.Yt,Z.sL,Z.ni,P.gM],styles:["[_nghost-%COMP%]     small{color:#8c8c8c}[_nghost-%COMP%]   div[matlistitemmeta][_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]     .search-result-tooltip{white-space:pre-line}"],changeDetection:0})}return n})();function L2(n,r){if(1&n&&(e.TgZ(0,"mat-option",14)(1,"p",15),e._uU(2),e.qZA()()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(2),e.Oqu(t.title)}}let M2=(()=>{class n{formBuilder;languageService;dialogRef;data;form;feature;layers=[];filteredLayers$;constructor(t,o,i,s){this.formBuilder=t,this.languageService=o,this.dialogRef=i,this.data=s,this.form=this.formBuilder.group({layerName:["",[_.kI.required]]})}ngOnInit(){this.feature=this.data.feature,this.layers=this.data.layers,this.filteredLayers$=this.form.controls.layerName.valueChanges.pipe((0,uc.O)(""),(0,I.U)(t=>this.filter(t)))}filter(t){if("string"==typeof t)return this.layers.map(o=>o).filter(o=>o?.title?.toLowerCase().includes(t.toLowerCase()))}displayFn(t){return t&&t.title?t.title:""}save(){this.dialogRef.close({layer:this.form.value.layerName,feature:this.feature})}cancel(){this.dialogRef.close()}static \u0275fac=function(o){return new(o||n)(e.Y36(_.QS),e.Y36(L),e.Y36(B.so),e.Y36(B.WI,8))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-save-feature-dialog"]],decls:23,vars:21,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[3,"navigation","selection"],["igoListItem","","color","accent","showIcons","true",3,"result"],[1,"igo-input-container"],["type","text","matInput","","formControlName","layerName",3,"placeholder","matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","create-layer-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","createLayerBtnDialog","mat-raised-button","","type","button","color","primary",3,"click"],[3,"value"],["matListItemTitle",""]],template:function(o,i){if(1&o&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"form",2)(5,"igo-list",3),e._UZ(6,"igo-search-results-item",4),e.qZA(),e.TgZ(7,"div",5)(8,"mat-form-field"),e._UZ(9,"input",6),e.ALo(10,"translate"),e.TgZ(11,"mat-autocomplete",7,8),e.YNc(13,L2,3,2,"mat-option",9),e.ALo(14,"async"),e.qZA()()()()(),e.TgZ(15,"div",10)(16,"div",11)(17,"button",12),e.NdJ("click",function(){return i.cancel()}),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"button",13),e.NdJ("click",function(){return i.save()}),e._uU(21),e.ALo(22,"translate"),e.qZA()()()),2&o){const s=e.MAs(12);e.xp6(1),e.hij(" ",e.lcZ(2,11,"igo.geo.layer.saveFeatureInLayer"),"\n"),e.xp6(3),e.Q6J("formGroup",i.form),e.xp6(1),e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("result",i.feature),e.xp6(3),e.s9C("placeholder",e.lcZ(10,13,"igo.geo.layer.chooseOrSet")),e.Q6J("matAutocomplete",s),e.xp6(2),e.Q6J("displayWith",i.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(14,15,i.filteredLayers$)),e.xp6(5),e.hij(" ",e.lcZ(19,17,"igo.geo.layer.cancelBtn")," "),e.xp6(3),e.hij(" ",e.lcZ(22,19,"igo.geo.layer.saveBtn")," ")}},dependencies:[f.sg,Nt,So,Je.XC,le.ey,Je.ZL,S.lW,B.uh,B.xY,B.H8,F.KE,j.Nt,Z.sL,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,ed,f.Ov,O.X$],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .create-layer-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   button#createLayerBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:red}"]})}return n})();function I2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",2),e.NdJ("mouseenter",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onMouseEvent(i))})("mouseleave",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onMouseEvent(i))})("click",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onToggleClick(i))}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",3),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"async"),e.ALo(9,"async"),e.ALo(10,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,6,t.computeTooltip()))("color",e.lcZ(2,8,t.isPreview$)?"":t.added?"warn":""),e.xp6(3),e.Q6J("igoMatBadgeIcon",t.getBadgeIcon())("matBadgeHidden",e.lcZ(4,10,t.inRange$)&&!0===e.lcZ(5,12,t.isVisible$)||e.lcZ(6,14,t.inRange$)&&!t.added||e.lcZ(7,16,t.inRange$)&&e.lcZ(8,18,t.isPreview$))("matBadgeDisabled",!1===e.lcZ(9,20,t.inRange$))("svgIcon",e.lcZ(10,22,t.isPreview$)?"plus":t.added?"delete":"plus")}}function Z2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addFeatureToLayer())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",5),e.ALo(4,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("id",t.isMobile?"":"hide-save-search-result-btn")("matTooltip",e.lcZ(1,3,e.lcZ(2,5,t.addFeatureToLayerTooltip$))),e.xp6(3),e.Q6J("matBadgeHidden",e.lcZ(4,7,t.inRange$))}}let td=(()=>{class n{layerService;dialog;dataSourceService;mediaService;tooltip$=new y.X("igo.geo.catalog.layer.addToMap");addFeatureToLayerTooltip$=new y.X("igo.geo.search.addToLayer");resolution$$;layers$$;inRange$=new y.X(!0);isVisible$=new y.X(!1);isPreview$=new y.X(!1);layersSubcriptions=[];lastTimeoutRequest;mouseInsideAdd=!1;layer;store;added;map;saveSearchResultInLayer=!1;get color(){return this._color}set color(t){this._color=t}_color="primary";stores=[];get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-search-layer"))}mediaService$$;isMobile=!1;constructor(t,o,i,s){this.layerService=t,this.dialog=o,this.dataSourceService=i,this.mediaService=s}ngOnInit(){this.mediaService$$=this.mediaService.media$.subscribe(t=>{t===to.Mobile&&(this.isMobile=!0)}),"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(t=>t.id===this.layer.data.sourceOptions.id)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.layers$$.unsubscribe(),this.mediaService$$&&this.mediaService$$.unsubscribe()}onMouseEvent(t){this.onToggleClick(t)}onToggleClick(t){typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const o=t||{};if("mouseenter"!==o.type||!this.mouseInsideAdd)switch(o.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add(o)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(o),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addLayerToMap(t))}remove(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(t=>t.unsubscribe()),this.layersSubcriptions=[])}addLayerToMap(t){if(void 0===this.map||this.layer.meta.dataType!==Un)return;const o=this.layer.data;void 0===o.sourceOptions.optionsFromApi&&(o.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(o).subscribe(i=>{"click"===t.type&&this.map.layersAddedByClick$.next([i]),this.map.addLayer(i)}))}removeLayerFromMap(){if(void 0===this.map||this.layer.meta.dataType!==Un)return;const t=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(t)}isInResolutionsRange(t){this.inRange$.next(t>=(this.layer.data.minResolution||0)&&t<=(this.layer.data.maxResolution||1/0))}isVisible(){if(this.layer?.data?.sourceOptions?.id){const t=this.map.getLayerById(this.layer.data.sourceOptions.id);this.isVisible$.next(!!t&&t.visible)}}getBadgeIcon(){return this.inRange$.value&&this.isVisible$.value?"":"eye-off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}addFeatureToLayer(){"Feature"===this.layer.meta.dataType&&this.dialog.open(M2,{width:"700px",data:{feature:this.layer,layers:this.allLayers}}).afterClosed().subscribe(i=>{if(i)if(this.stores.length>0&&this.stores.map(s=>(s.state.updateAll({selected:!1}),s?.layer&&(s.layer.visible=!1),s)),"string"==typeof i.layer)this.createLayer(i.layer,i.feature);else{const s=this.stores.find(a=>a.layer.id===i.layer.id);s.layer.visible=!0,s.layer.opacity=1,this.addFeature(i.feature,s)}})}createLayer(t,o){const i=new yt([],{map:this.map}),s=[new J.ZP({image:new Te.Z({radius:5,stroke:new U.Z({width:1,color:"rgba(143,7,7,1)"}),fill:new q.Z({color:"rgba(143,7,7,1)"})})}),new J.ZP({stroke:new U.Z({width:1,color:"rgba(143,7,7,1)"}),fill:new q.Z({color:"rgba(0, 0, 255, 0.1)"})})];let a=0;for(const l of this.allLayers){let c=Number(l.id.replace("igo-search-layer",""));a=Math.max(c,a)}this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,mt.q)(1)).subscribe(l=>{let c=new xe({isIgoInternalLayer:!0,id:"igo-search-layer"+ ++a,title:t,source:l,igoStyle:{editable:!1,igoStyleObject:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},circle:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},radius:5}}},style:s,showInLayerList:!0,exportable:!0,workspace:{enabled:!0}});oi(i,c),Yi(i,new qt({motion:Y.None})),ya(i,new Tt({map:this.map,motion:Y.None,many:!0})),i.layer.visible=!0,i.source.ol.on("removefeature",u=>{const p=u.feature.getGeometry();this.clearLabelsOfOlGeometry(p)}),this.addFeature(o,i),this.stores.push(i)})}addFeature(t,o){const i={type:t.data.type,geometry:{coordinates:t.data.geometry.coordinates,type:t.data.geometry.type},projection:t.data.projection,properties:t.data.properties,meta:{id:t.meta.id}};delete i.properties.Route,o.update(i),o.setLayerExtent(),o.layer.ol.getSource().refresh()}clearLabelsOfOlGeometry(t){Ur(t).forEach(o=>{o&&o.getMap()&&this.map.ol.removeOverlay(o)})}static \u0275fac=function(o){return new(o||n)(e.Y36(Se),e.Y36(B.uw),e.Y36(_t),e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",store:"store",added:"added",map:"map",saveSearchResultInLayer:"saveSearchResultInLayer",color:"color",stores:"stores"},decls:2,vars:2,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","igoMatBadgeInverseColor","true","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","matBadgeHidden","matBadgeDisabled","svgIcon"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","eye-off","igoMatBadgeInverseColor","true","matBadgeDisabled","true","matBadgeSize","small","matBadgePosition","after","svgIcon","file-plus-outline",3,"matBadgeHidden"]],template:function(o,i){1&o&&(e.YNc(0,I2,11,24,"button",0),e.YNc(1,Z2,5,9,"button",1)),2&o&&(e.Q6J("ngIf","Layer"===i.layer.meta.dataType),e.xp6(1),e.Q6J("ngIf","Feature"===i.layer.meta.dataType&&i.saveSearchResultInLayer))},dependencies:[f.O5,ut.k,va,_n,S.RK,w.Hw,P.gM,f.Ov,O.X$],styles:["[_nghost-%COMP%]   #hide-save-search-result-btn[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   #show-save-search-result-btn[_ngcontent-%COMP%]{display:block}"],changeDetection:0})}return n})();const P2=["*"];let cl=(()=>{class n{get title(){return this._title}set title(t){this._title=t}_title="";get collapsed(){return this._collapsed}set collapsed(t){this._collapsed=t,this.toggle.emit(t)}_collapsed=!1;toggle=new e.vpe;static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},ngContentSelectors:P2,decls:7,vars:3,consts:[["svgIcon","chevron-up","matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["content",""]],template:function(o,i){if(1&o&&(e.F$t(),e.TgZ(0,"mat-list-item")(1,"mat-icon",0),e.NdJ("toggle",function(a){return i.collapsed=a}),e.qZA(),e.TgZ(2,"span",1),e._uU(3),e.qZA()(),e.TgZ(4,"div",null,2),e.Hsn(6),e.qZA()),2&o){const s=e.MAs(5);e.xp6(1),e.Q6J("target",s)("collapsed",i.collapsed),e.xp6(2),e.Oqu(i.title)}},dependencies:[w.Hw,Z.Tg,Z.Yt,Z.sL,zi],styles:["[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mat-mdc-list-item-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}"]})}return n})();const k2=["igoSearchItemToolbar"];function $2(n,r){1&n&&e.GkF(0)}const od=function(n){return{results:n}};function D2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-collapsible",7),e.NdJ("toggle",function(i){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.collapsed[s.source.title]=i)}),e.YNc(1,$2,1,0,"ng-container",8),e.qZA()}if(2&n){const t=e.oxw().$implicit,o=e.MAs(4),i=e.oxw(2);e.Tol(t.source.getId()),e.Q6J("title",i.computeGroupTitle(t))("collapsed",i.collapsed[t.source.title]),e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(6,od,t.results))}}function E2(n,r){1&n&&e.GkF(0)}function R2(n,r){if(1&n&&e.YNc(0,E2,1,0,"ng-container",8),2&n){const t=e.oxw().$implicit,o=e.MAs(4);e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,od,t.results))}}const id=function(n){return{result:n}};function N2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-search-results-item",10),e.NdJ("focus",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultFocus.emit(s))})("unfocus",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultUnfocus.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.onResultSelect(s))})("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultFocus.emit(s))})("mouseleave",function(){const s=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.resultUnfocus.emit(s))}),e.GkF(1,11),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(4);e.Q6J("map",o.map)("result",t)("showIcons",o.showIcons)("withZoomButton",o.withZoomButton)("focused",o.store.state.get(t).focused)("selected",o.store.state.get(t).selected),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateSearchToolbar)("ngTemplateOutletContext",e.VKq(8,id,t))}}function B2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"span",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,s=e.oxw(2);return e.KtG(s.displayMoreResults(i))}),e.TgZ(1,"u"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.search.displayMoreResults")))}function J2(n,r){if(1&n&&(e.YNc(0,N2,2,10,"ng-template",2),e.YNc(1,B2,4,3,"span",9)),2&n){const t=r.results,o=e.oxw().$implicit,i=e.oxw(2);e.Q6J("ngForOf",t),e.xp6(1),e.Q6J("ngIf",i.isMoreResults(o))}}function U2(n,r){if(1&n&&(e.YNc(0,D2,2,8,"igo-collapsible",4),e.YNc(1,R2,1,4,"ng-template",null,5,e.W1O),e.YNc(3,J2,2,2,"ng-template",null,6,e.W1O)),2&n){const t=e.MAs(2),o=e.oxw(2);e.Q6J("ngIf",o.mode===o.searchResultMode.Grouped)("ngIfElse",t)}}function G2(n,r){if(1&n&&(e.TgZ(0,"igo-list",1),e.YNc(1,U2,5,2,"ng-template",2,3,e.W1O),e.ALo(3,"async"),e.qZA()),2&n){const t=e.oxw();e.Q6J("navigation",!0),e.xp6(1),e.Q6J("ngForOf",e.lcZ(3,2,t.results$))}}function q2(n,r){1&n&&e.GkF(0)}function j2(n,r){1&n&&e.GkF(0)}const nd=function(n){return{group:n}};function Q2(n,r){if(1&n&&(e.TgZ(0,"mat-tab",17),e.YNc(1,j2,1,0,"ng-container",8),e.qZA()),2&n){const t=r.$implicit;e.oxw(2);const o=e.MAs(7),i=e.oxw();e.Q6J("label",i.computeGroupTitle(t)),e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(3,nd,t))}}function Y2(n,r){if(1&n&&(e.TgZ(0,"mat-tab-group",15),e.YNc(1,Q2,2,5,"mat-tab",16),e.ALo(2,"async"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,t.results$))}}function H2(n,r){1&n&&e.GkF(0)}function V2(n,r){if(1&n&&e.YNc(0,H2,1,0,"ng-container",8),2&n){const t=r.$implicit;e.oxw(2);const o=e.MAs(7);e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,nd,t))}}function z2(n,r){if(1&n&&(e.YNc(0,V2,1,4,"ng-template",2),e.ALo(1,"async")),2&n){const t=e.oxw(2);e.Q6J("ngForOf",e.lcZ(1,1,t.results$))}}function K2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-search-results-item",10),e.NdJ("focus",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultFocus.emit(s))})("unfocus",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultUnfocus.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.onResultSelect(s))})("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultFocus.emit(s))})("mouseleave",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.resultUnfocus.emit(s))}),e.GkF(1,11),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("map",o.map)("result",t)("showIcons",o.showIcons)("withZoomButton",o.withZoomButton)("focused",o.store.state.get(t).focused)("selected",o.store.state.get(t).selected),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateSearchToolbar)("ngTemplateOutletContext",e.VKq(8,id,t))}}function W2(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"span",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().group,s=e.oxw(2);return e.KtG(s.displayMoreResults(i))}),e.TgZ(1,"u"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.search.displayMoreResults")))}function X2(n,r){if(1&n&&(e.YNc(0,K2,2,10,"ng-template",2),e.YNc(1,W2,4,3,"span",9)),2&n){const t=r.group,o=e.oxw(2);e.Q6J("ngForOf",t.results),e.xp6(1),e.Q6J("ngIf",o.isMoreResults(t))}}function eF(n,r){if(1&n&&(e.TgZ(0,"igo-list",1),e.YNc(1,q2,1,0,"ng-container",13),e.YNc(2,Y2,3,3,"ng-template",null,14,e.W1O),e.YNc(4,z2,2,3,"ng-template",null,5,e.W1O),e.YNc(6,X2,2,2,"ng-template",null,6,e.W1O),e.qZA()),2&n){const t=e.MAs(3),o=e.MAs(5),i=e.oxw();e.Q6J("navigation",!0),e.xp6(1),e.Q6J("ngIf",i.mode===i.searchResultMode.Grouped)("ngIfThen",t)("ngIfElse",o)}}var ul=function(n){return n.Grouped="grouped",n.Flat="flat",n}(ul||{});let rd=(()=>{class n{cdRef;searchService;configService;showResultsCount=!0;searchResultMode=ul;watcher;settingsChange$$;pageIterator=[];collapsed=[];map;store;showIcons;mode=ul.Grouped;withZoomButton=!1;tabsMode=!1;get term(){return this._term}set term(t){this._term=t,this.pageIterator=[]}_term;settingsChange$=new y.X(void 0);termSplitter="|";resultFocus=new e.vpe;resultUnfocus=new e.vpe;resultSelect=new e.vpe;moreResults=new e.vpe;resultMouseenter=new e.vpe;resultMouseleave=new e.vpe;templateSearchToolbar;get results$(){return void 0===this._results$&&(this._results$=this.liftResults()),this._results$}_results$;constructor(t,o,i){this.cdRef=t,this.searchService=o,this.configService=i}ngOnInit(){this.watcher=new fn(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(()=>{this.pageIterator=[]}),!1===this.configService.getConfig("searchSources.showResultsCount")&&(this.showResultsCount=!1)}ngOnDestroy(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}computeGroupTitle(t){const o=[t.source.title],i=t.results.length;return i>1&&this.showResultsCount&&o.push(`(${i})`),o.join(" ")}onResultSelect(t){this.store.state.get(t)&&!0===this.store.state.get(t).selected||(this.store.state.update(t,{focused:!0,selected:!0},!0),this.resultSelect.emit(t))}liftResults(){return this.store.stateView.all$().pipe((0,In.D)(t=>0===t.length?bn.E:(0,Mn.H)(200)),(0,I.U)(t=>this.groupResults(t.map(o=>o.entity).sort(this.sortByOrder))))}sortByOrder(t,o){return t.source.displayOrder-o.source.displayOrder}groupResults(t){const o=new Map;return t.forEach(i=>{const s=i.source;let a=o.get(s);void 0===a&&(a=[],o.set(s,a)),a.push(i)}),Array.from(o.keys()).map(i=>(void 0===this.pageIterator[i.getId()]&&(this.pageIterator[i.getId()]=1),{source:i,results:o.get(i)}))}isMoreResults(t){return this.store.getStrategyOfType(Vo)?.active?t.results?.length%+t.source.params.limit==0&&+t.source.params.page<30:t.results&&!0===t.results[t.results.length-1].meta.nextPage}displayMoreResults(t){const o={sourceId:t.source.getId(),page:++this.pageIterator[t.source.getId()]};let i;i=this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?this.term.split(this.termSplitter):[this.term];let s=[];i.map(a=>{s=s.concat(this.searchService.search(a,o))}),s.map(a=>{a.request.subscribe(l=>{const c=t.results.concat(l);l.length||(c[c.length-1].meta.nextPage=!1),this.moreResults.emit({research:a,results:c})})})}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO),e.Y36(Vn),e.Y36(N))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-search-results"]],contentQueries:function(o,i,s){if(1&o&&e.Suo(s,k2,5),2&o){let a;e.iGM(a=e.CRH())&&(i.templateSearchToolbar=a.first)}},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",tabsMode:"tabsMode",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},decls:2,vars:2,consts:[[3,"navigation",4,"ngIf"],[3,"navigation"],["ngFor","",3,"ngForOf"],["groupTemplate",""],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],["flatTemplate",""],["storeItemTemplate",""],[3,"title","collapsed","toggle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"map","result","showIcons","withZoomButton","focused","selected","focus","unfocus","select","mouseenter","mouseleave"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["tabsTemplate",""],["dynamicHeight","",1,"custom-tabs-view"],[3,"label",4,"ngFor","ngForOf"],[3,"label"]],template:function(o,i){1&o&&(e.YNc(0,G2,4,4,"igo-list",0),e.YNc(1,eF,8,4,"igo-list",0)),2&o&&(e.Q6J("ngIf",!1===i.tabsMode),e.xp6(1),e.Q6J("ngIf",i.tabsMode))},dependencies:[f.sg,f.O5,f.tP,cl,Nt,So,ht.uX,ht.SP,ed,f.Ov,O.X$],styles:["[_nghost-%COMP%]   .moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list{height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list .custom-tabs-view .mat-mdc-tab-header-pagination{min-width:20px}"],changeDetection:0})}return n})();class pl extends ta{options;inResolutionRange$=new y.X(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(r){super(r),this.options=r,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}function ci({feature:n,markerColor:r=[0,161,222],markerOpacity:t=1,markerOutlineColor:o=[0,255,255],fillColor:i,fillOpacity:s=.15,strokeColor:a=[0,255,255],strokeOpacity:l=.5,strokeWidth:c=4}){return dl({feature:n,markerColor:r,markerOpacity:t,markerOutlineColor:o,fillColor:i,fillOpacity:s,strokeColor:a,strokeOpacity:l,strokeWidth:c})}function dl({feature:n,markerColor:r=[0,161,222],markerOpacity:t=.5,markerOutlineColor:o,fillColor:i=[0,161,222],fillOpacity:s=.15,strokeColor:a=[0,161,222],strokeOpacity:l=.5,strokeWidth:c=2}){const u=n instanceof Ze.Z;let p,d;u?p=n.getGeometry():(p=n.geometry,d=n.meta.mapTitle);const g=u?p.getType():p.type;if(p&&"Point"!==g){const h=(0,_o._2)(i).slice(0),m=(0,_o._2)(a).slice(0);return 4===h.length&&("string"!=typeof i||/^#[0-9A-F]{8}$/i.test(i))||(h[3]=s),4===m.length&&("string"!=typeof a||/^#[0-9A-F]{8}$/i.test(a))||(m[3]=l),Cu({text:d,strokeWidth:c,strokeColor:m,fillColor:h})}{const h=(0,_o._2)(r).slice(0),m=h.slice(0,3);return 4===h.length&&("string"!=typeof r||/^#[0-9A-F]{8}$/i.test(r))&&(t=h[3]),Xo({text:d,opacity:t,markerOutlineColor:o,markerColor:m})}}function tF(n){return n.entityStore.getStrategyOfType(Vo).active$.pipe((0,I.U)(r=>r?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"))}function sd(n,r,t,o,i,s){const a=R.removeUndefined({sourceOptions:{type:o,url:t,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:"wms"===o?i:void 0,LAYER:"wms"===o?void 0:i}}});if("add"===n)s.createAsyncLayer(a).subscribe(l=>{r.layersAddedByClick$.next([l]),r.addLayer(l)});else if("remove"===n){const l=Oi(a.sourceOptions);r.removeLayer(r.layers.find(c=>c.id===l))}}function gl(n,r,t,o){const i=function iF(n,r){return[{name:"geoServiceAction",title:void 0,tooltip:"",renderer:wt.ButtonGroup,valueAccessor:(o,i)=>{let s=i.state.geoService;return s&&s.haveGeoServiceProperties&&s.url&&s.layerName?s.added?[{icon:"delete",color:"warn",click:(a,l)=>{sd("remove",n.map,l.state.geoService.url,l.state.geoService.type,l.state.geoService.layerName,r),s.added=!1}}]:[{icon:"plus",color:"primary",click:(a,l)=>{sd("add",n.map,l.state.geoService.url,l.state.geoService.type,l.state.geoService.layerName,r),s.added=!0}}]:[]}}]}(n,t),s=r.dataSource.options.sourceFields||[],a=r.dataSource.options.relations||[];if(0===s.length)return void n.entityStore.entities$.pipe((0,Kt.n)(u=>0===u.length),(0,mt.q)(1)).subscribe(u=>{const p=u[0].ol,d=p.getKeys().filter(g=>!g.startsWith("_")&&"geometry"!==g&&g!==p.getGeometryName()&&!g.match(/boundedby/gi)).map(g=>({name:`properties.${g}`,title:g,renderer:wt.UnsanitizedHTML}));d.unshift(...i),n.meta.tableTemplate={selection:!0,sort:!0,columns:d,tableHeight:"100%"}});const l=s.map(u=>({name:`properties.${u.name}`,title:u.alias?u.alias:u.name,renderer:wt.UnsanitizedHTML,tooltip:u.tooltip,cellClassFunc:()=>{const p={};if(u.type)return p[`class_${u.type}`]=!0,p}})),c=a.map(u=>({name:`properties.${u.name}`,title:u.alias?u.alias:u.name,renderer:wt.Icon,icon:u.icon,parent:u.parent,type:"relation",tooltip:u.tooltip,onClick:()=>{o.next(u.title)},cellClassFunc:()=>({class_icon:!0})}));l.push(...c),l.unshift(...i),n.meta.tableTemplate={selection:!0,sort:!0,columns:l,tableHeight:"100%"}}function is(){return new Vo({filterClauseFunc:r=>!0===r.state.inMapExtent&&!0===r.state.inMapResolution})}let nF=(()=>{class n{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new y.X(void 0);constructor(t,o,i,s,a){this.storageService=t,this.configService=o,this.layerService=i,this.propertyTypeDetectorService=s,this.capabilitiesService=a}createWorkspace(t,o){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const i=new pl({id:t.id,title:t.title,layer:t,map:o,entityStore:this.createFeatureStore(t,o),actionStore:new Ko([]),meta:{tableTemplate:void 0}});return gl(i,t,this.layerService,this.ws$),i}createFeatureStore(t,o){const i=new yt([],{map:o});i.bindLayer(t);const s=new Pr({}),a=new An({}),l=new _a({map:o},this.propertyTypeDetectorService,this.capabilitiesService),c=new Zr({}),u=new xi({}),p=this.configService.getConfig("queryOverlayStyle"),d=new Tt({layer:new xe({zIndex:300,source:new Ae,style:g=>ci(Object.assign({},{feature:g},p?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return i.addStrategy(s,!0),i.addStrategy(a,!0),i.addStrategy(l,!0),i.addStrategy(c,!0),i.addStrategy(d,!0),i.addStrategy(u,!1),i.addStrategy(is(),!0),i}static \u0275fac=function(o){return new(o||n)(e.LFG(oe),e.LFG(N),e.LFG(Se),e.LFG(Sa),e.LFG(Zt))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class ml extends ta{options;inResolutionRange$=new y.X(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(r){super(r),this.options=r,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}let rF=(()=>{class n{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new y.X(void 0);constructor(t,o,i,s,a){this.storageService=t,this.configService=o,this.layerService=i,this.propertyTypeDetectorService=s,this.capabilitiesService=a}createWorkspace(t,o){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const i=new ml({id:t.id,title:t.title,layer:t,map:o,entityStore:this.createFeatureStore(t,o),actionStore:new Ko([]),meta:{tableTemplate:void 0}});return gl(i,t,this.layerService,this.ws$),i}createFeatureStore(t,o){const i=new yt([],{map:o});i.bindLayer(t);const s=new Pr({}),a=new vy({percentDistinctValueRatio:2,sourceFields:t.dataSource.options.sourceFields}),l=new An({}),c=new _a({map:o},this.propertyTypeDetectorService,this.capabilitiesService),u=new Zr({}),p=new xi({}),d=this.configService.getConfig("queryOverlayStyle"),g=new Tt({layer:new xe({zIndex:300,source:new Ae,style:h=>ci(Object.assign({},{feature:h},d?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return t.options.workspace?.searchIndexEnabled&&i.addStrategy(a,!0),i.addStrategy(s,!0),i.addStrategy(l,!0),i.addStrategy(c,!0),i.addStrategy(u,!0),i.addStrategy(g,!0),i.addStrategy(p,!1),i.addStrategy(is(),!0),i}static \u0275fac=function(o){return new(o||n)(e.LFG(oe),e.LFG(N),e.LFG(Se),e.LFG(Sa),e.LFG(Zt))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var sF=v(30789);let aF=(()=>{class n{dialogRef;languageService;data;constructor(t,o,i){this.dialogRef=t,this.languageService=o,this.data=i}cancelAction(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}confirmedAction(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}static \u0275fac=function(o){return new(o||n)(e.Y36(B.so),e.Y36(L),e.Y36(B.WI))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-confirmation-popup-component"]],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2)(4,"button",3),e.NdJ("click",function(){return i.confirmedAction()}),e._uU(5," Ok "),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return i.cancelAction()}),e._uU(7),e.qZA()()),2&o&&(e.xp6(2),e.hij(" ",i.languageService.translate.instant("add"===i.data.type?"igo.geo.workspace.addConfirmation":"igo.geo.workspace.deleteConfirmation")," "),e.xp6(5),e.hij(" ",i.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[S.lW,B.xY,B.H8],styles:["div.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:center}"]})}return n})();class ad extends ta{dialog;configService;adding$;getDomainValues;options;inResolutionRange$=new y.X(!0);get layer(){return this.options.layer}get map(){return this.options.map}drawControl;drawEnd$$;olDrawingLayerSource=new Vt.Z;olDrawingLayer;geometryType=$e;modify;modifyStyle=new J.ZP({stroke:new U.Z({color:"rgba(255,255,255,1)",width:1}),fill:new q.Z({color:"rgba(0,161,222,1)"}),image:new Te.Z({radius:7,stroke:new U.Z({color:"rgba(255,255,255,1)",width:1}),fill:new q.Z({color:"rgba(0,161,222,1)"})})});newFeaturefilterClauseFunc=r=>!0===r.state.newFeature;editFeaturefilterClauseFunc=r=>!0===r.state.edit;fillColor;strokeColor;strokeWidth;constructor(r,t,o,i,s){super(s),this.dialog=r,this.configService=t,this.adding$=o,this.getDomainValues=i,this.options=s,this.map.viewController.resolution$.subscribe(a=>{this.inResolutionRange$.next(a>this.layer.minResolution&&a<this.layer.maxResolution)}),this.drawControl=this.createDrawControl(),this.drawControl.setGeometryType(this.geometryType.Point),this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayer=new xe({id:"igo-draw-layer",title:"edition",zIndex:300,source:new Ae,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}})}deleteFeature(r,t){setTimeout(()=>{this.dialog.open(aF,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(i=>{if(!1===i){let s,a;const l=t.layer.dataSource.options.edition.baseUrl,c=t.layer.dataSource.options.edition.deleteUrl;a=l.length?this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+l+"?"+c:l+"?"+c:this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+c:c;for(const u of t.meta.tableTemplate.columns)for(const p in r.properties){let d=u.name;d.includes("properties.")&&(d=d.split(".")[1]),d===p&&!0===u.primary&&(s=r.properties[p])}a&&(a+=s,this.deleteFeature(t,a))}})},250)}editFeature(r,t){r.edition=!0;let o,i=!1;const s=t.layer.dataSource.options.edition;for(const a of t.meta.tableTemplate.columns)if(("list"===a.type||"autocomplete"===a.type)&&this.getDomainValues(a.relation).subscribe(l=>{a.domainValues=l}),!1===i)for(const l in r.properties){let c=a.name;if(c.includes("properties.")&&(c=c.split(".")[1]),c===l&&!0===a.primary){o=r.properties[l],i=!0;break}}o?(r.original_properties=JSON.parse(JSON.stringify(r.properties)),r.original_geometry=r.geometry,r.idkey=o,t.entityStore.state.updateAll({edit:!1}),t.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(r,t)):!r.newFeature&&s.geomType&&(r.newFeature=!0,this.adding$.next(!0),t.entityStore.state.updateAll({newFeature:!1}),t.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),s.addWithDraw?this.onGeometryTypeChange(s.geomType,r,t):(t.entityStore.insert(r),t.entityStore.state.update(r,{newFeature:!0},!0)))}createDrawControl(r,t,o){return new Qn({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new J.ZP({}),interactionStyle:Va(r,t,o)})}onGeometryTypeChange(r,t,o){this.drawControl.setGeometryType(r),this.toggleDrawControl(t,o)}toggleDrawControl(r,t){this.deactivateDrawControl(),this.activateDrawControl(r,t)}deactivateDrawControl(){this.drawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}activateDrawControl(r,t){this.drawEnd$$=this.drawControl.end$.subscribe(o=>{this.addFeatureToStore(r,t,o)}),this.drawControl.setOlMap(this.map.ol,!0)}addFeatureToStore(r,t,o){const i=this.map.ol.getView().getProjection();let s=r.geometry;o?(t.entityStore.insert(r),t.entityStore.state.update(r,{newFeature:!0},!0),s=(new Ce.Z).writeGeometryObject(o,{featureProjection:i,dataProjection:"EPSG:4326"}),r.geometry=s):t.entityStore.state.update(r,{edit:!0},!0),r.projection="EPSG:4326";const a=ft(r,i.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(a),this.map.addLayer(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(a,r,t)}deleteDrawings(){this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}createModifyInteraction(r,t,o){this.map.ol.removeInteraction(this.modify);const i=new sF.Z([r],{unique:!0});this.modify=new $a.Z({features:i}),this.map.ol.addInteraction(this.modify),i.forEach(s=>{s.setStyle(this.modifyStyle)}),this.modify.on("modifyend",s=>{const a=s.features.getArray()[0]?.getGeometry();a&&this.addFeatureToStore(t,o,a)})}}let lF=(()=>{class n{layerService;storageService;configService;messageService;http;dialog;styleService;authInterceptor;ws$=new y.X(void 0);adding$=new y.X(!1);relationLayers$=new y.X(void 0);rowsInMapExtentCheckCondition$=new y.X(!0);loading=!1;wktFormat=new ji.Z;geoJsonFormat=new Ce.Z;get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,o,i,s,a,l,c,u){this.layerService=t,this.storageService=o,this.configService=i,this.messageService=s,this.http=a,this.dialog=l,this.styleService=c,this.authInterceptor=u}createWorkspace(t,o){if(!0!==t.options.workspace?.enabled||!0!==t.dataSource.options.edition.enabled)return;let i;i=t.options.workspace?t.options.workspace:{},i.srcId=t.id,i.workspaceId=t.id,i.enabled=!0,i.pageSize=t.options.workspace?.pageSize,i.pageSizeOptions=t.options.workspace?.pageSizeOptions;const s=t.dataSource,a=t.id+".WmsWorkspaceTableSrc",l=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:a,links:[]});const c={syncedDelete:!0,linkedIds:[l],properties:[Ge.ZINDEX,Ge.VISIBLE]};t.options.workspace?.minResolution||c.properties.push(Ge.MINRESOLUTION);let u=!1;s.options.ogcFilters?.enabled&&(c.properties.push(Ge.OGCFILTERS),u=!0),t.options.workspace?.maxResolution||c.properties.push(Ge.MAXRESOLUTION);let d,p=[];return t.options.linkedLayers.links&&(p=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),p.push(c),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:a,t.options.linkedLayers.links=p,this.layerService.createAsyncLayer({id:l,linkedLayers:{linkId:l},workspace:{srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:!1},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:s.options.download,type:"wfs",url:s.options.urlWfs||s.options.url,queryable:!0,relations:s.options.relations,queryTitle:s.options.queryTitle,params:s.options.paramsWFS,ogcFilters:Object.assign({},s.ogcFilters,{enabled:u}),sourceFields:s.options.sourceFields||void 0,edition:s.options.edition}}).subscribe(g=>(o.addLayer(g),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:p}},!1),g.dataSource.ol.refresh(),d=new ad(this.dialog,this.configService,this.adding$,h=>this.getDomainValues(h),{id:t.id,title:t.title,layer:g,map:o,entityStore:this.createFeatureStore(g,o),actionStore:new Ko([]),meta:{tableTemplate:void 0}}),this.createTableTemplate(d,g),g.options.workspace.workspaceId=g.id,t.options.workspace=Object.assign({},t.options.workspace,{wksConfig:i}),delete s.options.download,d)),d}createFeatureStore(t,o){const i=new yt([],{map:o});i.bindLayer(t);const s=new Pr({}),a=new An({}),l=new Zr({}),c=new xi({}),u=new Tt({layer:new xe({zIndex:300,source:new Ae,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return i.addStrategy(s,!0),i.addStrategy(a,!0),i.addStrategy(l,!0),i.addStrategy(u,!0),i.addStrategy(c,!1),i.addStrategy(is(),!0),i}createTableTemplate(t,o){const i=o.dataSource.options.sourceFields||[],s=o.dataSource.options.relations||[];let a=wt.UnsanitizedHTML,l=[],c=[],u=[];l=[{name:"edition",title:void 0,renderer:wt.ButtonGroup,primary:!1,valueAccessor:()=>[{editMode:!1,icon:"pencil",color:"primary",disabled:!1===o.dataSource.options.edition.modifyButton,click:p=>{t.editFeature(p,t)}},{editMode:!1,icon:"delete",color:"warn",disabled:!1===o.dataSource.options.edition.deleteButton,click:p=>{t.deleteFeature(p,t)}},{editMode:!0,icon:"check",color:"primary",disabled:this.loading,click:p=>{this.saveFeature(p,t)}},{editMode:!0,icon:"alpha-x",color:"primary",disabled:this.loading,click:p=>{this.cancelEdit(t,p)}}]}],0!==i.length?(c=i.map(p=>{let d={name:`properties.${p.name}`,title:p.alias?p.alias:p.name,renderer:a,valueAccessor:void 0,cellClassFunc:()=>{const g={};if(p.type)return g[`class_${p.type}`]=!0,g},primary:!0===p.primary,visible:p.visible,validation:p.validation,linkColumnForce:p.linkColumnForce,type:p.type,domainValues:void 0,relation:void 0,multiple:p.multiple,step:p.step,tooltip:p.tooltip};return("list"===p.type||"autocomplete"===p.type)&&this.getDomainValues(p.relation).subscribe(g=>{d.domainValues=g,d.relation=p.relation}),d}),u=s.map(p=>({name:`properties.${p.name}`,title:p.alias?p.alias:p.name,renderer:wt.Icon,icon:p.icon,parent:p.parent,type:"relation",tooltip:p.tooltip,onClick:()=>{!1===this.adding$.getValue()&&this.ws$.next(p.title)},cellClassFunc:()=>({class_icon:!0})})),c.push(...u),c.push(...l),t.meta.tableTemplate={selection:!1,sort:!0,columns:c}):t.entityStore.entities$.pipe((0,Kt.n)(p=>0===p.length),(0,mt.q)(1)).subscribe(p=>{const d=p[0].ol,g=d.getKeys().filter(h=>!h.startsWith("_")&&"geometry"!==h&&h!==d.getGeometryName()&&!h.match(/boundedby/gi)).map(h=>({name:`properties.${h}`,title:h,renderer:a}));t.meta.tableTemplate={selection:!1,sort:!0,columns:g}})}saveFeature(t,o){if(!this.validateFeature(t,o))return!1;this.sanitizeParameter(t,o);const i=o.layer.dataSource.options.edition.baseUrl;let s=this.configService.getConfig("edition.url");if(s?s+=i||"":s=i,t.newFeature){s+=o.layer.dataSource.options.edition.addUrl;const l=new $.WM(o.layer.dataSource.options.edition.addHeaders);this.addFeature(t,o,s,l)}else{s+="post"!==o.layer.dataSource.options.edition.modifyProtocol?"?"+o.layer.dataSource.options.edition.modifyUrl+t.idkey:o.layer.dataSource.options.edition.modifyUrl;const a=o.layer.dataSource.options.edition.modifyProtocol,c=new $.WM(o.layer.dataSource.options.edition.modifyHeaders);this.modifyFeature(t,o,s,c,a)}}addFeature(t,o,i,s){if(o.layer.dataSource.options.edition.hasGeometry){const a=o.layer.options.sourceOptions.edition.geomDatabaseProj;t.properties[o.layer.dataSource.options.params.fieldNameGeometry]="SRID="+a.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",a),{dataProjection:a})}for(const a in t.properties)for(const l of o.layer.dataSource.options.sourceFields)(l.name===a&&l.validation?.readonly||l.name===a&&!1===l.validation?.send)&&delete t.properties[a];this.loading=!0,this.http.post(`${i}`,t.properties,{headers:s}).subscribe(()=>{this.loading=!1,o.entityStore.stateView.clear(),o.deleteDrawings(),o.entityStore.delete(t),this.messageService.success("igo.geo.workspace.addSuccess"),this.refreshMap(o.layer,o.layer.map),this.adding$.next(!1),this.rowsInMapExtentCheckCondition$.next(!0)},a=>{this.loading=!1,a.error.caught=!0;const l=o.layer.dataSource.options.edition.messages;if(l){let c;l.forEach(u=>{const p=Object.keys(u)[0];a.error.message.includes(p)&&(c=u[p],this.messageService.error(c))}),c||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}deleteFeature(t,o){this.loading=!0,this.http.delete(`${o}`,{}).subscribe(()=>{this.loading=!1,this.messageService.success("igo.geo.workspace.deleteSuccess"),this.refreshMap(t.layer,t.layer.map);for(const i of t.layer.options.sourceOptions.relations)t.map.layers.forEach(s=>{s.title===i.title&&s.dataSource.ol.refresh()})},i=>{this.loading=!1,i.error.caught=!0;const s=t.layer.dataSource.options.edition.messages;if(s){let a;s.forEach(l=>{const c=Object.keys(l)[0];i.error.message.includes(c)&&(a=l[c],this.messageService.error(a))}),a||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}modifyFeature(t,o,i,s,a="patch"){if(o.layer.dataSource.options.edition.hasGeometry){const l=o.layer.options.sourceOptions.edition.geomDatabaseProj;t.geometry.coordinates=ld(t.geometry.coordinates),t.properties[o.layer.dataSource.options.params.fieldNameGeometry]="SRID="+l.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",l),{dataProjection:l})}for(const l in t.properties)for(const c of o.layer.dataSource.options.sourceFields)(c.name===l&&c.validation?.readonly||c.name===l&&!1===c.validation?.send||"boundedBy"===l)&&delete t.properties[l];this.loading=!0,this.http[a](`${i}`,t.properties,{headers:s}).subscribe(()=>{this.loading=!1,this.cancelEdit(o,t,!0),this.messageService.success("igo.geo.workspace.modifySuccess"),this.refreshMap(o.layer,o.layer.map);let l=[];for(const c of o.layer.options.sourceOptions.relations)o.map.layers.forEach(u=>{u.title===c.title&&(l.push(u),u.dataSource.ol.refresh())});this.relationLayers$.next(l)},l=>{this.loading=!1,l.error.caught=!0;const c=o.layer.dataSource.options.edition.messages;if(c){let u;c.forEach(p=>{const d=Object.keys(p)[0];l.error.message.includes(d)&&(u=p[d],this.messageService.error(u))}),u||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}cancelEdit(t,o,i=!1){o.edition=!1,this.adding$.next(!1),t.deleteDrawings(),t.entityStore.stateView.clear(),o.newFeature?(t.entityStore.delete(o),t.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(i||(o.properties=o.original_properties,o.geometry=o.original_geometry),delete o.original_properties,delete o.original_geometry)}getDomainValues(t){let o=t.url;return o||(o=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+t.table:t.table),this.http.get(o).pipe((0,I.U)(i=>i),(0,ce.K)(i=>(i.error.caught=!0,(0,cn._)(i))))}refreshMap(t,o){const i=t.dataSource.ol;i.setLoader((a,l,c,u,p)=>{t.customWFSLoader(t.ol.getSource(),t.options.sourceOptions,this.authInterceptor,a,l,c,u,p,!0)}),i.refresh();for(const a of o.layers)if(a.id!==t.id&&a.options.linkedLayers?.linkId.includes(t.id.substr(0,t.id.indexOf(".")-1))&&a.options.linkedLayers?.linkId.includes("WmsWorkspaceTableSrc")){const l=a.dataSource.ol;let c=l.getParams();c._t=(new Date).getTime(),l.updateParams(c)}}validateFeature(t,o){let s,a=!0;return o.meta.tableTemplate.columns.forEach(l=>{l.hasOwnProperty("validation")&&l.validation&&(s=ns(l.name),Object.keys(l.validation).forEach(c=>{switch(c){case"mandatory":l.validation[c]&&(!t.properties.hasOwnProperty(s)||!t.properties[s])&&(a=!1,this.messageService.error("igo.geo.formValidation.mandatory",void 0,void 0,{column:l.title}));break;case"minValue":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s]<l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.minValue",void 0,void 0,{column:l.title,value:l.validation[c]}));break;case"maxValue":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s]>l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.maxValue",void 0,void 0,{column:l.title,value:l.validation[c]}));break;case"minLength":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s].length<l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.minLength",void 0,void 0,{column:l.title,value:l.validation[c]}));break;case"maxLength":t.properties.hasOwnProperty(s)&&t.properties[s]&&t.properties[s].length>l.validation[c]&&(a=!1,this.messageService.error("igo.geo.formValidation.maxLength",void 0,void 0,{column:l.title,value:l.validation[c]}))}}))}),a}sanitizeParameter(t,o){o.meta.tableTemplate.columns.forEach(i=>{"list"===i.type&&t.properties[ns(i.name)]&&(t.properties[ns(i.name)]=t.properties[ns(i.name)].toString())})}static \u0275fac=function(o){return new(o||n)(e.LFG(Se),e.LFG(oe),e.LFG(N),e.LFG(_e),e.LFG($.eN),e.LFG(B.uw),e.LFG(yo),e.LFG(sr))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ns(n){return n.includes("properties.")?n.split(".")[1]:n}function ld(n){return 0===n.length?n:"number"==typeof n[0]?n.slice(0,2):n.map(ld)}let cF=(()=>{class n{layerService;storageService;capabilitiesService;styleService;configService;propertyTypeDetectorService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new y.X(void 0);constructor(t,o,i,s,a,l){this.layerService=t,this.storageService=o,this.capabilitiesService=i,this.styleService=s,this.configService=a,this.propertyTypeDetectorService=l}createWorkspace(t,o){if(!t.options.workspace||o.layers.find(g=>g.id===t.id+".WfsWorkspaceTableDest")||t.dataSource.options.edition)return;const i=t.dataSource,s=t.id+".WmsWorkspaceTableSrc",a=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:s,links:[]});const l={syncedDelete:!0,linkedIds:[a],properties:[Ge.ZINDEX,Ge.VISIBLE]};t.options.workspace?.minResolution||l.properties.push(Ge.MINRESOLUTION);let c=!1;i.options.ogcFilters?.enabled&&(l.properties.push(Ge.OGCFILTERS),c=!0),t.options.workspace?.maxResolution||l.properties.push(Ge.MAXRESOLUTION);let p,u=[];return t.options.linkedLayers.links&&(u=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),u.push(l),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:s,t.options.linkedLayers.links=u,this.layerService.createAsyncLayer({isIgoInternalLayer:!0,id:a,linkedLayers:{linkId:a},workspace:{printable:t.options.workspace?.printable,srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:i.options.download,type:"wfs",url:i.options.urlWfs||i.options.url,queryable:!0,relations:i.options.relations,queryTitle:i.options.queryTitle,queryFormatAsWms:!t.options.workspace?.enabled||i.options.queryFormatAsWms,params:i.options.paramsWFS,ogcFilters:Object.assign({},i.ogcFilters,{enabled:c}),sourceFields:i.options.sourceFields||void 0}}).subscribe(g=>{if(o.addLayer(g),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:u}},!1),g.dataSource.ol.refresh(),t.options.workspace?.enabled)return p=new pl({id:t.id,title:t.title,layer:g,map:o,entityStore:this.createFeatureStore(g,o),actionStore:new Ko([]),meta:{tableTemplate:void 0}}),gl(p,g,this.layerService,this.ws$),g.options.workspace.workspaceId=g.id,t.options.workspace=Object.assign({},t.options.workspace,{enabled:!0,srcId:t.id,workspaceId:g.id,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions}),delete i.options.download,p}),p}createFeatureStore(t,o){const i=new yt([],{map:o});i.bindLayer(t);const s=new Pr({}),a=new An({}),l=new _a({map:o},this.propertyTypeDetectorService,this.capabilitiesService),c=new Zr({}),u=new xi({}),p=this.configService.getConfig("queryOverlayStyle"),d=new Tt({layer:new xe({zIndex:300,source:new Ae,style:g=>ci(Object.assign({},{feature:g},p?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?Y.Default:Y.None,many:!0,dragBox:!0});return i.addStrategy(s,!0),i.addStrategy(a,!0),i.addStrategy(l,!0),i.addStrategy(c,!0),i.addStrategy(d,!0),i.addStrategy(u,!1),i.addStrategy(is(),!0),i}static \u0275fac=function(o){return new(o||n)(e.LFG(Se),e.LFG(oe),e.LFG(Zt),e.LFG(yo),e.LFG(N),e.LFG(Sa))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),uF=(()=>{class n{component;wfsWorkspaceService;wmsWorkspaceService;editionWorkspaceService;featureWorkspaceService;layers$$;entities$$=[];map;changeWorkspace=new e.vpe;disableSwitch=new e.vpe;relationLayers=new e.vpe;rowsInMapExtentCheckCondition=new e.vpe;get workspaceStore(){return this.component.store}constructor(t,o,i,s,a){this.component=t,this.wfsWorkspaceService=o,this.wmsWorkspaceService=i,this.editionWorkspaceService=s,this.featureWorkspaceService=a}ngOnInit(){this.layers$$=this.map.layers$.pipe((0,ae.b)(50)).subscribe(t=>this.onLayersChange(t)),this.featureWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wmsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wfsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.adding$.subscribe(t=>{this.disableSwitch.emit(t)}),this.editionWorkspaceService.relationLayers$.subscribe(t=>{this.relationLayers.emit(t)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(t=>{this.rowsInMapExtentCheckCondition.emit(t)})}ngOnDestroy(){this.layers$$.unsubscribe(),this.entities$$.map(t=>t.unsubscribe())}onLayersChange(t){const o=t.filter(l=>this.layerIsEditable(l)),i=o.map(l=>l.id),s=o.map(l=>this.getOrCreateWorkspace(l)).filter(l=>void 0!==l),a=this.workspaceStore.all().filter(l=>i.indexOf(l.id)<0);a.length>0&&(a.forEach(l=>{l.entityStore.deactivateStrategyOfType(An),l.deactivate()}),this.workspaceStore.state.updateMany(a,{active:!1,selected:!1}),this.workspaceStore.deleteMany(a)),s.length>0&&this.workspaceStore.insertMany(s)}getOrCreateWorkspace(t){if(void 0===this.workspaceStore.get(t.id)){if(t.dataSource instanceof Lr&&!0!==t.dataSource.options.edition?.enabled)return this.wfsWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof xo&&!0!==t.dataSource.options.edition?.enabled){if(!t.dataSource.options.paramsWFS)return;const i=this.wmsWorkspaceService.createWorkspace(t,this.map);return i?.inResolutionRange$.subscribe(s=>{t.dataSource.options.queryable=!s,i.layer.dataSource.options.queryable=s}),i}if(t.dataSource instanceof Ae&&!0===t.exportable&&!0!==t.dataSource.options.edition?.enabled)return this.featureWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof xo&&!0===t.dataSource.options.edition?.enabled)return this.editionWorkspaceService.createWorkspace(t,this.map)}}layerIsEditable(t){const o=t.dataSource;return o instanceof Lr||o instanceof Ae||o instanceof xo&&((o.options||{}).ogcFilters?.enabled||void 0!==o.options.paramsWFS?.featureTypes)}static \u0275fac=function(o){return new(o||n)(e.Y36(Uc),e.Y36(nF),e.Y36(cF),e.Y36(lF),e.Y36(rF))};static \u0275dir=e.lG2({type:n,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"}})}return n})();function pF(n,r){1&n&&(e.TgZ(0,"div",11)(1,"span"),e._UZ(2,"mat-icon",12),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"igo-color-picker-form-field",13),e.qZA()),2&n&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"igo.geo.style.fill")," "))}let dF=(()=>{class n{dialogRef;formBuilder;data;confirmFlag=!1;form;styleModalData;linestringOnly;initialValues;defaultValues={fillColor:"rgba(255,255,255,0.4)",strokeColor:"rgba(143,7,7,1)"};get layerOlStyle(){const t=this.data.layer.ol.getStyle();return t instanceof Function?void 0:t.clone()}constructor(t,o,i){this.dialogRef=t,this.formBuilder=o,this.data=i}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.layer.ol.getSource().getFeatures())"LineString"!==t.getGeometry().getType()&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getLayerFillColor()],stroke:[this.getLayerStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()},this.initialValues={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()}}getLayerFillColor(){let t=this.defaultValues.fillColor;const o=this.layerOlStyle;if(o?.getFill()?.getColor()){const i=o.getFill().getColor();t=`rgba(${i[0]},${i[1]},${i[2]},${i[3]||.4})`}return t}getLayerStrokeColor(){let t=this.defaultValues.strokeColor;const o=this.layerOlStyle;if(o?.getStroke()?.getColor()){const i=o.getStroke().getColor();t=`rgba(${i[0]},${i[1]},${i[2]},${i[3]||1})`}return t}setLayerFillColor(t){const o=(0,_o._2)(t),i=this.layerOlStyle.clone();i.getImage().getFill().setColor(o),i.getFill().setColor(o),this.data.layer.ol.setStyle(i),this.styleModalData.fillColor=t}setLayerStrokeColor(t){const o=(0,_o._2)(t),i=this.layerOlStyle.clone();i.getImage().getStroke().setColor(o),i.getStroke().setColor(o),this.data.layer.ol.setStyle(i),this.styleModalData.strokeColor=t}cancel(){this.dialogRef.close(),this.setLayerFillColor(this.initialValues.fillColor),this.setLayerStrokeColor(this.initialValues.strokeColor)}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(o){return new(o||n)(e.Y36(B.so),e.Y36(_.QS),e.Y36(B.WI))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-style-modal-layer"]],inputs:{confirmFlag:"confirmFlag"},decls:19,vars:11,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content",""],[1,"edition-drawing","mat-typography"],[1,"igo-form",3,"formGroup"],["class","fill-color-picker mat-typography",4,"ngIf"],[1,"stroke-color-picker","mat-typography"],["svgIcon","square-outline",1,"stroke-palette-icon"],["formControlName","stroke"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"fill-color-picker","mat-typography"],["svgIcon","square",1,"stroke-palette-icon"],["formControlName","fill"]],template:function(o,i){1&o&&(e.TgZ(0,"h2",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"div",2)(5,"form",3),e.YNc(6,pF,6,3,"div",4),e.TgZ(7,"div",5)(8,"span"),e._UZ(9,"mat-icon",6),e._uU(10),e.ALo(11,"translate"),e.qZA(),e._UZ(12,"igo-color-picker-form-field",7),e.qZA()()()(),e.TgZ(13,"div",8)(14,"button",9),e.NdJ("click",function(){return i.cancel()}),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"button",10),e.NdJ("click",function(){return i.confirm()}),e._uU(18,"OK"),e.qZA()()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,5,"igo.geo.style.styleModal"),"\n"),e.xp6(4),e.Q6J("formGroup",i.form),e.xp6(1),e.Q6J("ngIf",!0!==i.linestringOnly),e.xp6(4),e.hij(" ",e.lcZ(11,7,"igo.geo.style.stroke")," "),e.xp6(5),e.hij(" ",e.lcZ(16,9,"igo.geo.style.cancel")," "))},dependencies:[f.O5,_._Y,_.JJ,_.JL,w.Hw,S.lW,B.uh,B.xY,B.H8,_.sg,_.u,Gc,O.X$],styles:["h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.fill-field[_ngcontent-%COMP%], .stroke-field[_ngcontent-%COMP%]{width:130px}.fill-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.fill-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:8px}.stroke-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.stroke-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:35px}.box[_ngcontent-%COMP%]{width:25px;height:25px}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}.igo-input-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.igo-form-input-box[_ngcontent-%COMP%]{width:150px}button[_ngcontent-%COMP%]{margin-right:5px}"]})}return n})(),gF=(()=>{class n{dialog;layer;constructor(t){this.dialog=t}openStyleModalDialog(){setTimeout(()=>{this.dialog.open(dF,{disableClose:!1,data:{layer:this.layer},autoFocus:!1})},250)}static \u0275fac=function(o){return new(o||n)(e.Y36(B.uw))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-style-modal-layer-button"]],inputs:{layer:"layer"},decls:3,vars:3,consts:[["mat-icon-button","","color","primary",3,"matTooltip","click"],["svgIcon","palette",1,"style-icon"]],template:function(o,i){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return i.openStyleModalDialog()}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",1),e.qZA()),2&o&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.style.styleModalTooltipLayer"))},dependencies:[w.Hw,S.RK,P.gM,O.X$],changeDetection:0})}return n})();var mF=v(97766);function _F(n,r,t){t.error("igo.context.contextImportExport.import.invalid.text","igo.context.contextImportExport.import.invalid.title",void 0,{value:n.name,mimeType:n.type})}function yF(n,r,t,o){t.error("igo.context.contextImportExport.import.tooLarge.text","igo.context.contextImportExport.import.tooLarge.title",void 0,{value:n.name,size:o})}function bF(n,r,t){t.error("igo.context.contextImportExport.import.unreadable.text","igo.context.contextImportExport.import.unreadable.title",void 0,{value:n.name})}function cd(n){return(new Ce.Z).readFeatures(n,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}var Wt=function(n){return n[n.null=0]="null",n[n.read=1]="read",n[n.write=2]="write",n}(Wt||{});let Mo=(()=>{class n{http;authService;languageService;config;messageService;storageService;exportService;route;context$=new y.X(void 0);contexts$=new y.X({ours:[]});defaultContextId$=new y.X(void 0);editedContext$=new y.X(void 0);importedContext=[];toolsChanged$=new fe.x;mapViewFromRoute={};options;baseUrl;tools;toolbar;get defaultContextUri(){return this.storageService.get("favorite.context.uri")||this._defaultContextUri||this.options.defaultContextUri}set defaultContextUri(t){this._defaultContextUri=t}_defaultContextUri;constructor(t,o,i,s,a,l,c,u){this.http=t,this.authService=o,this.languageService=i,this.config=s,this.messageService=a,this.storageService=l,this.exportService=c,this.route=u,this.options=Object.assign({basePath:"contexts",contextListFile:"_contexts.json",defaultContextUri:"_default"},this.config.getConfig("context")),this.baseUrl=this.options.url??"",this.readParamsFromRoute(),this.authService.hasAuthService?this.authService.logged$.subscribe(p=>{p&&(this.contexts$.pipe((0,Ci.T)(1),(0,Lt.P)()).subscribe(d=>{this.handleContextsChange()}),this.loadContexts())}):(this.loadContexts(),this.handleContextsChange(!1))}get(t,o){let i=this.baseUrl+"/contexts";return t&&this.authService.authenticated&&(i+="?permission="+t.join(),o&&(i+="&hidden=true")),this.http.get(i)}getById(t){return this.http.get(this.baseUrl+"/contexts/"+t)}getDetails(t){return this.http.get(`${this.baseUrl}/contexts/${t}/details`).pipe((0,ce.K)(i=>{throw this.handleError(i,t),i}))}getDefault(){if(this.authService.authenticated)return this.http.get(this.baseUrl+"/contexts/default").pipe((0,Bi.b)(o=>{this.defaultContextId$.next(o.id)}));{const t=this.storageService.get("favorite.context.uri");return this.defaultContextId$.next(t),this.getContextByUri(t)}}getProfilByUser(){return this.baseUrl?this.http.get(this.baseUrl+"/profils?"):(0,z.of)([])}setDefault(t){return this.authService.authenticated?this.http.post(this.baseUrl+"/contexts/default",{defaultContextId:t}):(this.storageService.set("favorite.context.uri",t),(0,z.of)(void 0))}hideContext(t){return this.http.post(this.baseUrl+"/contexts/"+t+"/hide",{})}showContext(t){return this.http.post(this.baseUrl+"/contexts/"+t+"/show",{})}delete(t,o=!1){const i={ours:[]};return Object.keys(this.contexts$.value).forEach(a=>i[a]=this.contexts$.value[a].filter(l=>l.id!==t)),o?(this.importedContext=this.importedContext.filter(a=>a.id!==t),(0,z.of)(this.contexts$.next(i))):this.http.delete(this.baseUrl+"/contexts/"+t).pipe((0,Bi.b)(a=>{this.contexts$.next(i)}))}create(t){return this.http.post(this.baseUrl+"/contexts",t).pipe((0,I.U)(i=>(i.permission=this.authService.authenticated?Wt[Wt.write]:Wt[Wt.read],this.contexts$.value.ours.unshift(i),this.contexts$.next(this.contexts$.value),i)))}clone(t,o={}){return this.http.post(this.baseUrl+"/contexts/"+t+"/clone",o).pipe((0,I.U)(s=>(s.permission=Wt[Wt.write],this.contexts$.value.ours.unshift(s),this.contexts$.next(this.contexts$.value),s)))}update(t,o){return this.http.patch(this.baseUrl+"/contexts/"+t,o)}addToolAssociation(t,o){return this.http.post(`${this.baseUrl}/contexts/${t}/tools`,{toolId:o})}deleteToolAssociation(t,o){return this.http.delete(`${this.baseUrl}/contexts/${t}/tools/${o}`)}getPermissions(t){return this.http.get(this.baseUrl+"/contexts/"+t+"/permissions")}addPermissionAssociation(t,o,i){return this.http.post(`${this.baseUrl}/contexts/${t}/permissions`,{profil:o,typePermission:i}).pipe((0,ce.K)(l=>{throw this.handleError(l,void 0,!0),[l]}))}deletePermissionAssociation(t,o){return this.http.delete(`${this.baseUrl}/contexts/${t}/permissions/${o}`)}getLocalContexts(){const t=this.getPath(this.options.contextListFile);return this.http.get(t).pipe((0,I.U)(o=>({ours:o})))}getLocalContext(t){const o=this.getPath(`${t}.json`);return this.http.get(o).pipe((0,Ca.z)(i=>{if(!i.base)return(0,z.of)(i);const s=this.getPath(`${i.base}.json`);return this.http.get(s).pipe((0,I.U)(a=>{const l=i;return l.map=R.mergeDeep(a.map,i.map),l.layers=(a.layers||[]).concat(i.layers||[]).reverse().filter((c,u,p)=>!c.id||p.findIndex(d=>d.id===c.id)===u).reverse(),l.toolbar=i.toolbar||a.toolbar,l.message=i.message||a.message,l.messages=i.messages||a.messages,l.tools=(i.tools||[]).concat(a.tools||[]).filter((c,u,p)=>p.findIndex(d=>d.name===c.name)===u),l}),(0,ce.K)(a=>{throw this.handleError(a,t),a}))}),(0,ce.K)(i=>{throw this.handleError(i,t),i}))}loadContexts(t,o){let i;i=this.baseUrl?this.get(t,o):this.getLocalContexts(),i.subscribe(s=>{s.ours=this.importedContext.concat(s.ours),this.contexts$.next(s)})}loadDefaultContext(){const t=(o=!1)=>{!o&&this.baseUrl&&this.authService.authenticated?this.getDefault().subscribe(i=>{this.defaultContextUri=i.uri,this.addContextToList(i),this.setContext(i)},()=>{this.defaultContextId$.next(void 0),this.loadContext(this.defaultContextUri)}):this.loadContext(this.defaultContextUri)};this.route&&this.route.options.contextKey?this.route.queryParams.pipe((0,ae.b)(100)).subscribe(o=>{const i=o[this.route.options.contextKey];let s=!1;i&&(this.defaultContextUri=i,s=!0),t(s)}):t()}loadContext(t){const o=this.context$.value;o&&o.uri===t||this.getContextByUri(t).pipe((0,Lt.P)()).subscribe(i=>{this.addContextToList(i),this.setContext(i)},i=>{t!==this.options.defaultContextUri&&this.loadContext(this.options.defaultContextUri)})}setContext(t){this.handleContextMessage(t);const o=this.context$.value;if(o&&t&&t.id===o.id)return void 0===t.map.view.keepCurrentView&&(t.map.view.keepCurrentView=!0),void this.context$.next(t);t.map||(t.map={view:{}}),Object.assign(t.map.view,this.mapViewFromRoute),this.context$.next(t)}loadEditedContext(t){this.getContextByUri(t).subscribe(o=>{this.setEditedContext(o)})}setEditedContext(t){this.editedContext$.next(t)}getContextFromMap(t,o){const i=t.ol.getView(),s=i.getProjection().getCode(),a=new Ee.Z(i.getCenter()).transform(s,"EPSG:4326"),l={uri:Ie(),title:"",scope:"private",map:{view:{center:a.getCoordinates(),zoom:i.getZoom(),projection:s,maxZoomOnExtent:t.viewController.maxZoomOnExtent}},layers:[],tools:[]};let c=[];c=!0===o?t.layers$.getValue().filter(p=>!0===p.baseLayer||"searchPointerSummaryId"===p.options.id).sort((p,d)=>p.zIndex-d.zIndex):t.layers$.getValue().filter(p=>!p.id.includes("WfsWorkspaceTableDest")).sort((p,d)=>p.zIndex-d.zIndex);let u=0;for(const p of c){const d={title:p.options.title,zIndex:++u,visible:p.visible,security:p.options.security,opacity:p.opacity},g={id:p.options.id?String(p.options.id):void 0,layerOptions:d,sourceOptions:{type:p.dataSource.options.type,params:p.dataSource.options.params,url:p.dataSource.options.url,queryable:p.queryable}};g.sourceOptions.type&&l.layers.push(g)}return l.tools=this.tools.map(p=>({id:String(p.id),global:p.global})),l}getContextFromLayers(t,o,i,s){const a=this.context$.getValue(),l=t.ol.getView(),c=l.getProjection().getCode(),p={uri:i,title:i,map:{view:{center:new Ee.Z(l.getCenter()).transform(c,"EPSG:4326").getCoordinates(),zoom:l.getZoom(),projection:c,keepCurrentView:s}},layers:[],toolbar:[],tools:[],extraFeatures:[]},d=t.layers$.getValue();return p.layers=d.filter(g=>g.baseLayer).map(g=>({baseLayer:!0,sourceOptions:g.options.sourceOptions,title:g.options.title,visible:g.visible})),o.forEach(g=>{const h=a.layers.find(m=>{const b=m.source;return b&&g.id===b.id&&!m.baseLayer});if(h){let m=h,b=m.style;m.igoStyle?.styleByAttribute?b=void 0:m.igoStyle?.clusterBaseStyle&&(b=void 0,delete h.sourceOptions.source,delete h.sourceOptions.format),p.layers.push({baseLayer:h.baseLayer,title:g.options.title,zIndex:g.zIndex,igoStyle:{styleByAttribute:m.igoStyle?.styleByAttribute,clusterBaseStyle:m.igoStyle?.clusterBaseStyle},style:b,clusterParam:h.clusterParam,visible:g.visible,opacity:g.opacity,sourceOptions:h.sourceOptions})}else if(g.ol.getSource()instanceof Vt.Z){const m=this.getExtraFeatures(g);m.name=g.options.title,m.opacity=g.opacity,m.visible=g.visible,p.extraFeatures.push(m)}else{const m=g.options;m.zIndex=g.zIndex,m.visible=g.visible,m.opacity=g.opacity,delete m.source,p.layers.push(m)}}),p.toolbar=this.toolbar,p.tools=this.tools,p}getExtraFeatures(t){const o=new Ce.Z;let i;t.ol.getSource()instanceof Wc.Z?(i=t.ol.getSource().getFeatures(),i=i.flatMap(c=>c.get("features"))):i=t.ol.getSource().getFeatures();const s=this.exportService.generateFeature(i,"GeoJSON","_featureStore"),a=o.writeFeatures(s,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return JSON.parse(a)}setTools(t){this.tools=t}setToolbar(t){this.toolbar=t}handleContextMessage(t){this.context$.value&&t.uri&&this.context$.value.uri!==t.uri&&this.messageService.removeAllAreNotError(),t.messages=t.messages?t.messages:[],t.messages.push(t.message),t.messages.map(o=>{o&&this.messageService.message(o)})}getContextByUri(t){if(this.baseUrl){let i;for(const a of Object.keys(this.contexts$.value))if(i=this.contexts$.value[a].find(l=>l.uri===t),i)break;return i&&i.imported?(0,z.of)(i):this.getDetails(i?i.id:t)}const o=this.contexts$.value.ours.find(i=>i.uri===t&&!0===i.imported);return o?(0,z.of)(o):this.getLocalContext(t)}getContextLayers(t){const o=[];return t.layers$.getValue().forEach(s=>{!s.baseLayer&&"searchPointerSummaryId"!==s.options.id&&o.push(s)}),o}readParamsFromRoute(){this.route&&this.route.queryParams.subscribe(t=>{const o=this.route.options.centerKey;o&&t[o]&&(this.mapViewFromRoute.center=t[o].split(",").map(Number));const i=this.route.options.projectionKey;i&&t[i]&&(this.mapViewFromRoute.projection=t[i]);const s=this.route.options.zoomKey;s&&t[s]&&(this.mapViewFromRoute.zoom=Number(t[s]))})}getPath(t){return`${this.options.basePath.replace(/\/$/,"")}/${t}`}handleError(t,o,i){const s=this.contexts$.value.ours.find(l=>l.uri===o),a=s?s.title:o;t.error.title=this.languageService.translate.instant("igo.context.contextManager.invalid.title"),t.error.message=this.languageService.translate.instant("igo.context.contextManager.invalid.text",{value:a}),t.error.toDisplay=!0,i&&(t.error.title=this.languageService.translate.instant("igo.context.contextManager.errors.addPermissionTitle"),t.error.message=this.languageService.translate.instant("igo.context.contextManager.errors.addPermission")),this.messageService.error("igo.context.contextManager.errors.addPermission","igo.context.contextManager.errors.addPermissionTitle")}handleContextsChange(t=!0){const o=this.context$.value,i=this.editedContext$.value;(!o||o.uri===this.options.defaultContextUri)&&(t=!1),t&&this.findContext(o)?(this.getContextByUri(o.uri).pipe((0,Lt.P)()).subscribe(a=>{this.toolsChanged$.next(a)}),this.baseUrl&&this.authService.authenticated&&this.getDefault().subscribe()):(this.defaultContextUri=void 0,this.loadDefaultContext());const s=this.findContext(i);(!s||"write"!==s.permission)&&this.setEditedContext(void 0)}addContextToList(t){this.findContext(t)||this.contexts$.value&&this.contexts$.value.public&&(this.contexts$.value.public.push({id:t.id,uri:t.uri,title:t.title,scope:t.scope,permission:Wt[Wt.read]}),this.contexts$.next(this.contexts$.value))}findContext(t){if(!t)return!1;const o=this.contexts$.value;let i;for(const s of Object.keys(o))if(i=o[s].find(l=>t.id&&l.id===t.id||t.uri&&l.uri===t.uri),i)break;return i}static \u0275fac=function(o){return new(o||n)(e.LFG($.eN),e.LFG(He),e.LFG(L),e.LFG(N),e.LFG(_e),e.LFG(oe),e.LFG(es),e.LFG(un,8))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ud=(()=>{class n{component;contextService;layerService;configService;styleListService;styleService;route;context$$;queryParams;contextLayers=[];removeLayersOnContextChange=!0;get map(){return this.component.map}constructor(t,o,i,s,a,l,c){this.component=t,this.contextService=o,this.layerService=i,this.configService=s,this.styleListService=a,this.styleService=l,this.route=c}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,_i.h)(t=>void 0!==t)).subscribe(t=>this.handleContextChange(t)),this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&this.route.options.contextKey&&this.route.queryParams.pipe((0,Lt.P)(t=>!R.isEmpty(t))).subscribe(t=>{this.queryParams=t})}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(t){if(void 0===t.layers)return;!0===this.removeLayersOnContextChange?this.map.removeAllLayers():this.map.removeLayers(this.contextLayers),this.contextLayers=[];const o=(0,Xs.T)(...t.layers.map((i,s)=>this.layerService.createAsyncLayer(i,t.uri)));o.pipe((0,mF.f)(o.pipe((0,ae.b)(500)))).subscribe(i=>{this.handleAddLayers(i),t.extraFeatures&&t.extraFeatures.forEach(s=>{this.configService.getConfig("importExport")?.importWithStyle?function TF(n,r,t,o){let i,s,a;if(t.getStyleList(n.name+".styleByAttribute")){const u=t.getStyleList(n.name+".styleByAttribute");i=(p,d)=>o.createStyleByAttribute(p,u,d)}else if(t.getStyleList(n.name+".clusterStyle")){const u=t.getStyleList(n.name+".clusterParam");s=t.getStyleList(n.name+".distance"),i=(p,d)=>{const g=o.createStyle(t.getStyleList(n.name+".clusterStyle"),p,d);return o.createClusterStyle(p,d,u,g)}}else i=t.getStyleList(n.name+".style")?(u,p)=>o.createStyle(t.getStyleList(n.name+".style"),u,p):(u,p)=>o.createStyle(t.getStyleList("default.style"),u,p);const l=cd(n);t.getStyleList(n.name+".clusterStyle")?(a=new bo({distance:s,type:"cluster",queryable:!0}),a.ol.source.addFeatures(l)):(a=new Ae({type:"vector",queryable:!0}),a.ol.addFeatures(l));const c=new xe({title:n.name,isIgoInternalLayer:!0,source:a,style:i,opacity:n.opacity,visible:n.visible});r.addLayer(c)}(s,this.map,this.styleListService,this.styleService):function wF(n,r){const o=cd(n),i=new Ae({type:"vector",queryable:!0});i.ol.addFeatures(o);let s,a=!1;const l=o[0]?.getKeys()??[];l.includes("_style")||l.includes("_mapTitle")?s=Lu():(s=Mu(),a=!0);const c=new xe({title:n.name,isIgoInternalLayer:!0,source:i,igoStyle:{editable:a},style:s,visible:n.visible,opacity:n.opacity});r.addLayer(c)}(s,this.map)})}),this.layerService.createAsyncIdbLayers(t.uri).pipe((0,ae.b)(500)).subscribe(i=>this.handleAddLayers(i))}handleAddLayers(t){t=t.filter(o=>void 0!==o).map(o=>(o.visible=this.computeLayerVisibilityFromUrl(o),o.zIndex=o.zIndex,o)),this.contextLayers.concat(t),this.map.addLayers(t)}computeLayerVisibilityFromUrl(t){const o=this.queryParams,s=t.id;let a=t.visible;if(!o||!s)return a;const l=o[this.route.options.contextKey];if(l===this.contextService.context$.value.uri||!l){let c="",u="",p=[],d=[];this.route.options.visibleOnLayersKey&&o[this.route.options.visibleOnLayersKey]&&(c=o[this.route.options.visibleOnLayersKey]),this.route.options.visibleOffLayersKey&&o[this.route.options.visibleOffLayersKey]&&(u=o[this.route.options.visibleOffLayersKey]),"*"===c&&(a=!0),"*"===u&&(a=!1),p=c.split(","),d=u.split(","),(p.indexOf(s)>-1||p.indexOf(s.toString())>-1)&&(a=!0),(d.indexOf(s)>-1||d.indexOf(s.toString())>-1)&&(a=!1)}return a}static \u0275fac=function(o){return new(o||n)(e.Y36(Le),e.Y36(Mo),e.Y36(Se),e.Y36(N),e.Y36(ja),e.Y36(yo),e.Y36(un,8))};static \u0275dir=e.lG2({type:n,selectors:[["","igoLayerContext",""]],inputs:{removeLayersOnContextChange:"removeLayersOnContextChange"}})}return n})(),pd=(()=>{class n{contextService;mediaService;component;context$$;get map(){return this.component.map}constructor(t,o,i){this.contextService=o,this.mediaService=i,this.component=t}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,_i.h)(t=>void 0!==t)).subscribe(t=>this.handleContextChange(t))}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(t){if(void 0===t.map)return;const o=t.map.view;(!this.component.view||!0!==o.keepCurrentView||t.map.view.projection!==this.map.projection)&&(this.component.view=o),this.component.map.geolocationController&&this.component.map.geolocationController.updateGeolocationOptions(o);const i=t.map.controls;if(!this.component.controls&&i){if(this.mediaService.isMobile()&&"boolean"!=typeof i.scaleLine){const s=i.scaleLine;s.minWidth||(s.minWidth=Math.min(64,s.minWidth),i.scaleLine=s)}this.component.controls=i}}static \u0275fac=function(o){return new(o||n)(e.Y36(Le),e.Y36(Mo),e.Y36(ct))};static \u0275dir=e.lG2({type:n,selectors:[["","igoMapContext",""]]})}return n})(),dd=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,F.lN,j.c,w.Ps,S.ot,P.AV,Z.ie,ze.p9,nt.Fk,B.Is,Be.Tx,le.Ng,Je.Bb,Ms,bi,mn,Ui,pr,re,Qc,Yc,ar]})}return n})(),OF=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,_.u5,_.UX,w.Ps,P.AV,ht.Nh,F.lN,j.c,S.ot,re,pn]})}return n})(),AF=(()=>{class n{static forRoot(){return{ngModule:n}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,S.ot,ln.SJ,P.AV,re,It,yc,Ii,dd]})}return n})(),LF=(()=>{class n{static forRoot(){return{ngModule:n,providers:[]}}static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[j.c,F.lN,Be.Tx,Qc,dd,Yc,OF,AF]})}return n})();class MF extends Error{}class rs extends MF{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,rs.prototype)}}let IF=(()=>{class n{export(t){return this.exportAsync(t)}exportAsync(t){return new ue.y(i=>{!0!==this.nothingToExport(t)?(ic(JSON.stringify(t),"text/json;charset=utf-8",`${t.uri}.json`),i.complete()):i.error(new rs)})}nothingToExport(t){return void 0===t.map}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class ss extends Error{}class hl extends ss{constructor(){super("Invalid file"),Object.setPrototypeOf(this,hl.prototype)}}class as extends ss{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,as.prototype)}}class ls extends ss{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,ls.prototype)}}class ZF extends ss{constructor(){super("File is too large"),Object.setPrototypeOf(this,ls.prototype)}}let PF=(()=>{class n{config;static allowedMimeTypes=["application/json"];static allowedExtensions="json";clientSideFileSizeMax;constructor(t){this.config=t;const o=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(o||30)*Math.pow(1024,2)}import(t){return this.importAsync(t)}getFileImporter(t){const o=function xF(n){return n.name.split(".").pop().toLowerCase()}(t),i=t.type,s=[...n.allowedMimeTypes],a=n.allowedExtensions;if(!(s.indexOf(i)<0&&a.indexOf(o)<0||"application/json"!==i&&o!==n.allowedExtensions))return this.importFile}importAsync(t){return new ue.y(i=>{if(t.size>=this.clientSideFileSizeMax)return void i.error(new ZF);const s=this.getFileImporter(t);void 0!==s?s.call(this,t,i):i.error(new hl)})}importFile(t,o){const i=new FileReader;i.onload=s=>{try{const a=this.parseContextFromFile(t,s.target.result);o.next(a)}catch{o.error(new as)}o.complete()},i.onerror=s=>{o.error(new as)},i.readAsText(t,"UTF-8")}parseContextFromFile(t,o){return JSON.parse(o)}static \u0275fac=function(o){return new(o||n)(e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const DF=function(n){return{size:n}};function EF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"form",5)(2,"div",6)(3,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(10);return e.KtG(i.click())}),e.ALo(4,"async"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e._UZ(7,"igo-spinner",8),e.ALo(8,"async"),e.TgZ(9,"input",9,10),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(10);return e.KtG(i.value=null)})("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.importFiles(i.target.files))}),e.qZA()()(),e.TgZ(11,"section",11)(12,"h4"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"ul")(16,"li"),e._uU(17),e.ALo(18,"translate"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("disabled",e.lcZ(4,7,t.loading$)),e.xp6(2),e.hij(" ",e.lcZ(6,9,"igo.geo.importExportForm.importButton")," "),e.xp6(2),e.Q6J("shown",e.lcZ(8,11,t.loading$)),e.xp6(2),e.Udp("display","none"),e.xp6(4),e.Oqu(e.lcZ(14,13,"igo.geo.importExportForm.importClarifications")),e.xp6(4),e.hij(" ",e.xi3(18,15,"igo.geo.importExportForm.importSizeMax",e.VKq(18,DF,t.fileSizeMb))," ")}}function RF(n,r){if(1&n&&(e.TgZ(0,"mat-option",2),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t.title)}}function NF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"form",12)(1,"div",13)(2,"mat-form-field",14)(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"input",15),e.qZA()(),e.TgZ(7,"div",13)(8,"mat-form-field")(9,"mat-label"),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-select",16)(13,"mat-option",17,18),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(14),s=e.oxw();return e.KtG(s.selectAll(i))}),e._uU(15),e.ALo(16,"translate"),e.qZA(),e._UZ(17,"mat-divider"),e.YNc(18,RF,2,2,"mat-option",19),e.qZA()()(),e.TgZ(19,"div",6)(20,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.handleExportFormSubmit(i.form.value))}),e.ALo(21,"async"),e._uU(22),e.ALo(23,"translate"),e.qZA(),e._UZ(24,"igo-spinner",8),e.ALo(25,"async"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(4),e.Oqu(e.lcZ(5,9,"igo.context.contextImportExport.export.exportContextName")),e.xp6(6),e.Oqu(e.lcZ(11,11,"igo.context.contextImportExport.export.exportPlaceHolder")),e.xp6(3),e.Q6J("value",1),e.xp6(2),e.hij(" ",e.lcZ(16,13,"igo.context.contextImportExport.export.exportSelectAll")," "),e.xp6(3),e.Q6J("ngForOf",t.userControlledLayerList),e.xp6(2),e.Q6J("disabled",!t.form.valid||e.lcZ(21,15,t.loading$)),e.xp6(2),e.hij(" ",e.lcZ(23,17,"igo.geo.importExportForm.exportButton")," "),e.xp6(2),e.Q6J("shown",e.lcZ(25,19,t.loading$))}}let md=(()=>{class n{contextImportService;contextExportService;messageService;formBuilder;config;contextService;form;layers;inputProj="EPSG:4326";loading$=new y.X(!1);forceNaming=!1;layerList;userControlledLayerList;res;clientSideFileSizeMax;fileSizeMb;activeImportExport="import";layers$$;map;constructor(t,o,i,s,a,l){this.contextImportService=t,this.contextExportService=o,this.messageService=i,this.formBuilder=s,this.config=a,this.contextService=l,this.buildForm()}ngOnInit(){const t=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(t||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.layers$$=this.map.layers$.subscribe(()=>{this.layerList=this.contextService.getContextLayers(this.map),this.userControlledLayerList=this.layerList.filter(o=>o.showInLayerList)})}importFiles(t){this.loading$.next(!0);for(const o of t)this.contextImportService.import(o).pipe((0,mt.q)(1)).subscribe(i=>this.onFileImportSuccess(o,i),i=>this.onFileImportError(o,i),()=>{this.loading$.next(!1)})}handleExportFormSubmit(t){this.loading$.next(!0),this.res=this.contextService.getContextFromLayers(this.map,t.layers,t.name,!1),this.res.imported=!0,this.contextExportService.export(this.res).pipe((0,mt.q)(1)).subscribe(()=>{},o=>this.onFileExportError(o),()=>{this.onFileExportSuccess(),this.loading$.next(!1)})}buildForm(){this.form=this.formBuilder.group({layers:["",[_.kI.required]],name:["",[_.kI.required]]})}onFileImportSuccess(t,o){!function hF(n,r,t,o){if(Object.keys(r).length<=0)return void function vF(n,r){r.error("igo.context.contextImportExport.import.empty.text","igo.context.contextImportExport.import.empty.title",void 0,{value:n.name})}(n,t);const i=function SF(n){return n.name.substr(0,n.name.lastIndexOf("."))}(n);(function CF(n,r,t){n.title=r,n.imported=!0,t.contexts$.value.ours.unshift(n),t.contexts$.next(t.contexts$.value),t.importedContext.unshift(n),t.loadContext(n.uri)})(r,i,o),t.success("igo.context.contextImportExport.import.success.text","igo.context.contextImportExport.import.success.title",void 0,{value:i})}(t,o,this.messageService,this.contextService)}onFileImportError(t,o){this.loading$.next(!1),function fF(n,r,t,o){({"Invalid file":_F,"File is too large":yF,"Failed to read file":bF})[r.message](n,r,t,o=o||30)}(t,o,this.messageService,this.fileSizeMb)}onFileExportError(t){this.loading$.next(!1),function kF(n,r){n instanceof rs?this.handleNothingToExportError(r):r.error("igo.context.contextImportExport.export.failed.text","igo.context.contextImportExport.export.failed.title")}(t,this.messageService)}onFileExportSuccess(){!function $F(n){n.success("igo.context.contextImportExport.export.success.text","igo.context.contextImportExport.export.success.title")}(this.messageService)}selectAll(t){t._selected&&(this.form.controls.layers.setValue(this.userControlledLayerList),t._selected=!0),!1===t._selected&&this.form.controls.layers.setValue([])}onImportExportChange(t){this.activeImportExport=t.value}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(o){return new(o||n)(e.Y36(PF),e.Y36(IF),e.Y36(_e),e.Y36(_.QS),e.Y36(N),e.Y36(Mo))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-context-import-export"]],inputs:{map:"map"},decls:10,vars:11,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],[4,"ngIf"],["class","igo-form",3,"formGroup",4,"ngIf"],[1,"igo-form"],[1,"igo-form-button-group"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["type","file",3,"click","change"],["fileInput",""],[1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[1,"example-full-width"],["formControlName","name","matInput","",3,"value"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value",4,"ngFor","ngForOf"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"mat-button-toggle-group",1),e.NdJ("change",function(a){return i.onImportExportChange(a)}),e.TgZ(2,"mat-button-toggle",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-button-toggle",2),e._uU(6),e.ALo(7,"translate"),e.qZA()()(),e.YNc(8,EF,19,20,"div",3),e.YNc(9,NF,26,21,"form",4)),2&o&&(e.xp6(1),e.Q6J("value",i.activeImportExport),e.xp6(1),e.Q6J("value","import"),e.xp6(1),e.hij(" ",e.lcZ(4,7,"igo.geo.importExportForm.importTabTitle")," "),e.xp6(2),e.Q6J("value","export"),e.xp6(1),e.hij(" ",e.lcZ(7,9,"igo.geo.importExportForm.exportTabTitle")," "),e.xp6(2),e.Q6J("ngIf","import"===i.activeImportExport),e.xp6(1),e.Q6J("ngIf","export"===i.activeImportExport))},dependencies:[_._Y,_.Fj,_.JJ,_.JL,_.F,_.sg,_.u,f.sg,f.O5,S.lW,Ue.A9,Ue.Yi,Ve.d,F.KE,F.hX,se.gD,le.ey,j.Nt,Cr,f.Ov,O.X$],styles:[".import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}.igo-input-container[_ngcontent-%COMP%]{padding:10px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{padding:0 5px}.igo-form[_ngcontent-%COMP%]{padding:15px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}"]})}return n})(),BF=(()=>{class n{dialogRef;title;constructor(t){this.dialogRef=t}static \u0275fac=function(o){return new(o||n)(e.Y36(B.so))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-bookmark-dialog"]],decls:14,vars:14,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["matInput","","required","","autocomplete","off","maxlength","128",3,"placeholder","ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"]],template:function(o,i){1&o&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"mat-form-field")(5,"input",2),e.NdJ("ngModelChange",function(a){return i.title=a}),e.ALo(6,"translate"),e.qZA()()(),e.TgZ(7,"div",3)(8,"button",4),e.NdJ("click",function(){return i.dialogRef.close(i.title)}),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"button",5),e.NdJ("click",function(){return i.dialogRef.close(!1)}),e._uU(12),e.ALo(13,"translate"),e.qZA()()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,6,"igo.context.bookmarkButton.dialog.title"),"\n"),e.xp6(4),e.Q6J("placeholder",e.lcZ(6,8,"igo.context.bookmarkButton.dialog.placeholder"))("ngModel",i.title),e.xp6(3),e.Q6J("disabled",!i.title),e.xp6(1),e.hij(" ",e.lcZ(10,10,"igo.common.confirmDialog.confirmBtn")," "),e.xp6(3),e.hij(" ",e.lcZ(13,12,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[_.Fj,_.JJ,_.Q7,_.nD,_.On,S.lW,B.uh,B.xY,B.H8,F.KE,j.Nt,O.X$],encapsulation:2})}return n})();var cs=function(n){return n.always="always",n.never="never",n.default="default",n}(cs||{});function JF(n,r){if(1&n&&e._UZ(0,"mat-icon",7),2&n){const t=e.oxw(2);e.s9C("svgIcon",t.context.icon?t.context.icon:"public"===t.context.scope?"earth":"star")}}function UF(n,r){if(1&n&&e._UZ(0,"img",8),2&n){const t=e.oxw(2);e.Q6J("src",t.context.iconImage,e.LSH)}}function GF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.favoriteClick(i.context))}),e.ALo(1,"translate"),e.YNc(2,JF,1,1,"mat-icon",5),e.YNc(3,UF,1,1,"img",6),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",t.auth.authenticated?e.lcZ(1,4,"igo.context.contextManager.favorite"):"")("color",t.default?"primary":"default"),e.xp6(2),e.Q6J("ngIf",!t.context.iconImage),e.xp6(1),e.Q6J("ngIf",t.context.iconImage)}}function qF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.favoriteClick(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",9),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.favorite"))("color",t.default?"primary":"default")}}function jF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.save.emit(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",22),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.save"))("color",t.color)}}function QF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.managePermissions.emit(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",24),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.managePermissions"))("color",t.color)}}function YF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.clone.emit(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",26),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.clone"))("color",t.color)}}function HF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.edit.emit(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",28),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.edit"))}}function VF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.hide.emit(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",30),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.hide"))}}function zF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.show.emit(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",31),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.show"))}}function KF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.delete.emit(i.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",33),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.delete"))}function WF(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",10),e.YNc(1,jF,3,4,"button",11),e.TgZ(2,"div",12,13),e.YNc(4,QF,3,4,"button",14),e.YNc(5,YF,3,4,"button",15),e.YNc(6,HF,3,4,"button",16),e.YNc(7,VF,3,4,"button",17),e.YNc(8,zF,3,4,"button",17),e.YNc(9,KF,3,3,"button",18),e.qZA(),e.TgZ(10,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.collapsed=!i.collapsed)}),e._UZ(11,"mat-icon",20),e.qZA()()}if(2&n){const t=e.MAs(3),o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.collapsed&&o.selected&&(o.context.permission===o.typePermission[o.typePermission.write]||o.context.imported)),e.xp6(3),e.Q6J("ngIf",o.canShare&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.permission===o.typePermission[o.typePermission.write]&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",!o.context.hidden&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.hidden&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.permission===o.typePermission[o.typePermission.write]||o.context.imported),e.xp6(1),e.Q6J("color",o.color)("target",t)("collapsed",o.collapsed)}}const XF=function(n){return{"mat-list-item-light":n}};let e6=(()=>{class n{auth;storageService;typePermission=Wt;color="primary";collapsed=!0;showFavorite=!0;context;default;selected;edit=new e.vpe;delete=new e.vpe;save=new e.vpe;clone=new e.vpe;hide=new e.vpe;show=new e.vpe;favorite=new e.vpe;managePermissions=new e.vpe;manageTools=new e.vpe;get hidden(){return this.context.hidden}get canShare(){return!0===this.storageService.get("canShare")}constructor(t,o){this.auth=t,this.storageService=o}favoriteClick(t){this.favorite.emit(t)}static \u0275fac=function(o){return new(o||n)(e.Y36(He),e.Y36(oe))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-context-item"]],inputs:{showFavorite:"showFavorite",context:"context",default:"default",selected:"selected"},outputs:{edit:"edit",delete:"delete",save:"save",clone:"clone",hide:"hide",show:"show",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools"},decls:6,vars:7,consts:[[1,"mat-list-item",3,"ngClass"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","","class","igo-actions-container",4,"ngIf"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click"],[3,"svgIcon",4,"ngIf"],[3,"src",4,"ngIf"],[3,"svgIcon"],[3,"src"],["svgIcon","star"],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["class","save-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],[1,"igo-actions-expand-container"],["actions",""],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","clone-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","edit-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","hide-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","delete-button","mat-icon-button","","color","warn","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","igoCollapse","",1,"actions-button",3,"color","target","collapsed","click"],["svgIcon","dots-horizontal"],["mat-icon-button","","matTooltipShowDelay","500",1,"save-button",3,"matTooltip","color","click"],["svgIcon","content-save"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","account-arrow-right"],["mat-icon-button","","matTooltipShowDelay","500",1,"clone-button",3,"matTooltip","color","click"],["svgIcon","content-copy"],["mat-icon-button","","matTooltipShowDelay","500",1,"edit-button",3,"color","matTooltip","click"],["svgIcon","pencil"],["mat-icon-button","","matTooltipShowDelay","500",1,"hide-button",3,"color","matTooltip","click"],["svgIcon","eye"],["svgIcon","eye-off"],["mat-icon-button","","color","warn","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"]],template:function(o,i){1&o&&(e.TgZ(0,"mat-list-item",0),e.YNc(1,GF,4,6,"button",1),e.YNc(2,qF,3,4,"button",1),e.TgZ(3,"span",2),e._uU(4),e.qZA(),e.YNc(5,WF,12,10,"div",3),e.qZA()),2&o&&(e.Q6J("ngClass",e.VKq(5,XF,i.hidden)),e.xp6(1),e.Q6J("ngIf",i.auth.authenticated),e.xp6(1),e.Q6J("ngIf",!i.auth.authenticated&&i.showFavorite),e.xp6(2),e.Oqu(i.context.title),e.xp6(1),e.Q6J("ngIf",i.auth.authenticated))},dependencies:[f.mk,f.O5,w.Hw,S.RK,P.gM,Z.Tg,Z.D1,Z.sL,Z.ni,zi,_n,O.X$],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-actions-container[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   .igo-actions-expand-container[_ngcontent-%COMP%]{display:inline-flex}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   button[matlistitemavatar][_ngcontent-%COMP%]{margin-right:8px}"],changeDetection:0})}return n})();function t6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.clearFilter())}),e._UZ(1,"mat-icon",17),e.qZA()}}function o6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",13)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"input",14),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.term=i)}),e.ALo(5,"translate"),e.qZA(),e.YNc(6,t6,2,0,"button",15),e.qZA()}if(2&n){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.context.contextManager.filterPlaceHolder")),e.xp6(2),e.Q6J("placeholder",e.lcZ(5,6,"igo.context.contextManager.filterPlaceHolder"))("ngModel",t.term),e.xp6(2),e.Q6J("ngIf",t.term.length)}}function n6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleSort(!0))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",19),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.sortAlphabetically"))}function r6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleSort(!1))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",20),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.sortContextOrder"))}function s6(n,r){if(1&n&&e._UZ(0,"igo-actionbar",21),2&n){const t=e.oxw();e.Q6J("iconColor",t.color)("store",t.actionStore)("withIcon",!0)("withTitle","overlay"===t.actionbarMode)("horizontal",!1)("mode",t.actionbarMode)}}function a6(n,r){if(1&n&&(e.TgZ(0,"button",22),e.ALo(1,"translate"),e._UZ(2,"mat-icon",23),e.qZA()),2&n){e.oxw();const t=e.MAs(9);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.filterUser"))("matMenuTriggerFor",t)}}function l6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",9)(1,"mat-checkbox",26),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.handleToggleCategory(i))}),e.qZA(),e.TgZ(2,"span"),e._uU(3),e.qZA()()}if(2&n){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("checked",o.getPermission(t).checked)("indeterminate",o.getPermission(t).indeterminate),e.xp6(2),e.Oqu(t.title)}}function c6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",9)(1,"mat-checkbox",10),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(){const s=e.CHM(t).$implicit,a=e.oxw(2).$implicit,l=e.oxw();return e.KtG(l.handleToggleCategory(s,a))}),e._uU(2),e.qZA()()}if(2&n){const t=r.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("checked",o.getPermission(t).checked),e.xp6(1),e.hij(" ",t.title," ")}}function u6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",27)(1,"mat-checkbox",26),e.NdJ("click",function(i){return i.stopPropagation()})("change",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(s.handleToggleCategory(i))}),e.qZA(),e.TgZ(2,"span"),e._uU(3),e.qZA()(),e.TgZ(4,"mat-menu",null,28),e.YNc(6,c6,3,2,"button",29),e.qZA()}if(2&n){const t=e.MAs(5),o=e.oxw().$implicit,i=e.oxw();e.Q6J("matMenuTriggerFor",t),e.xp6(1),e.Q6J("checked",i.getPermission(o).checked)("indeterminate",i.getPermission(o).indeterminate),e.xp6(2),e.Oqu(o.title),e.xp6(3),e.Q6J("ngForOf",o.childs)}}function p6(n,r){if(1&n&&(e.ynx(0),e.YNc(1,l6,4,3,"button",24),e.YNc(2,u6,7,5,"ng-template",null,25,e.W1O),e.BQk()),2&n){const t=r.$implicit,o=e.MAs(3);e.xp6(1),e.Q6J("ngIf",!t.childs)("ngIfElse",o)}}function d6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-context-item",33),e.NdJ("edit",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.edit.emit(s))})("delete",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.delete.emit(s))})("clone",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.clone.emit(s))})("save",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.save.emit(s))})("hide",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.hideContext(s))})("show",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.showContext(s))})("favorite",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.favorite.emit(s))})("manageTools",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.manageTools.emit(s))})("managePermissions",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.managePermissions.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.select.emit(s))})("unselect",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.unselect.emit(s))}),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("selected",o.selectedContext&&o.selectedContext.uri===t.uri)("context",t)("default",t.id&&o.defaultContextId&&o.defaultContextId===t.id)}}function g6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-collapsible",32),e.NdJ("toggle",function(i){e.CHM(t);const s=e.oxw().$implicit,a=e.oxw();return e.KtG(a.collapsed[a.titleMapping[s.key]]=i)}),e.ALo(1,"translate"),e.YNc(2,d6,1,3,"ng-template",11),e.qZA()}if(2&n){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("title",e.lcZ(1,3,o.titleMapping[t.key]))("collapsed",o.collapsed[o.titleMapping[t.key]]),e.xp6(2),e.Q6J("ngForOf",t.value)}}function m6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-context-item",34),e.NdJ("favorite",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.favorite.emit(s))})("select",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.select.emit(s))})("unselect",function(){const s=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.unselect.emit(s))}),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw(3);e.Q6J("showFavorite",o.configService.getConfig("favoriteContext4NonAuthenticated"))("selected",o.selectedContext&&o.selectedContext.uri===t.uri)("context",t)("default",o.contextConfigs?o.defaultContextId===t.id:o.defaultContextId===t.uri)}}function h6(n,r){if(1&n&&e.YNc(0,m6,1,4,"ng-template",11),2&n){const t=e.oxw().$implicit;e.Q6J("ngForOf",t.value)}}function f6(n,r){if(1&n&&(e.YNc(0,g6,3,5,"igo-collapsible",30),e.YNc(1,h6,1,1,null,31)),2&n){const t=r.$implicit,o=e.oxw();e.Q6J("ngIf",t.value.length&&o.auth.authenticated),e.xp6(1),e.Q6J("ngIf",t.value.length&&!o.auth.authenticated)}}function _6(n,r){1&n&&(e.TgZ(0,"div",35),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.contextManager.noResult")," "))}let us=(()=>{class n{cdRef;configService;auth;dialog;languageService;storageService;contextConfigs;contextsInitial={ours:[]};contexts$=new y.X(this.contextsInitial);change$=new hn.t(1);change$$;get contexts(){return this._contexts}set contexts(t){this._contexts=t,this.next()}_contexts={ours:[]};get selectedContext(){return this._selectedContext}set selectedContext(t){this._selectedContext=t,this.cdRef.detectChanges()}_selectedContext;get map(){return this._map}set map(t){this._map=t}_map;get defaultContextId(){return this.contextConfigs?this._defaultContextId:this.storageService.get("favorite.context.uri")||this._defaultContextId}set defaultContextId(t){this._defaultContextId=t}_defaultContextId;collapsed=[];select=new e.vpe;unselect=new e.vpe;edit=new e.vpe;delete=new e.vpe;save=new e.vpe;clone=new e.vpe;create=new e.vpe;hide=new e.vpe;show=new e.vpe;showHiddenContexts=new e.vpe;favorite=new e.vpe;managePermissions=new e.vpe;manageTools=new e.vpe;filterPermissionsChanged=new e.vpe;titleMapping={ours:"igo.context.contextManager.ourContexts",shared:"igo.context.contextManager.sharedContexts",public:"igo.context.contextManager.publicContexts"};users;permissions=[];actionStore=new Ko([]);actionbarMode=wi.Overlay;color="primary";showHidden=!1;set term(t){this._term=t,this.next()}get term(){return this._term}_term="";get sortedAlpha(){return this._sortedAlpha}set sortedAlpha(t){this._sortedAlpha=t,this.next()}_sortedAlpha=void 0;showContextFilter=cs.always;thresholdToFilter=5;get isEmpty(){return!this.contexts.ours.length&&!this.contexts.public?.length&&!this.contexts.shared?.length}constructor(t,o,i,s,a,l){this.cdRef=t,this.configService=o,this.auth=i,this.dialog=s,this.languageService=a,this.storageService=l,this.contextConfigs=this.configService.getConfig("context")}ngOnInit(){this.change$$=this.change$.pipe((0,In.D)(()=>(0,Mn.H)(50))).subscribe(()=>{this.contexts$.next(this.filterContextsList(this.contexts))}),this.actionStore.load([{id:"emptyContext",title:this.languageService.translate.instant("igo.context.contextManager.emptyContext"),icon:"map-outline",tooltip:this.languageService.translate.instant("igo.context.contextManager.emptyContextTooltip"),handler:()=>{this.createContext(!0)}},{id:"contextFromMap",title:this.languageService.translate.instant("igo.context.contextManager.contextMap"),icon:"map-check",tooltip:this.languageService.translate.instant("igo.context.contextManager.contextMapTooltip"),handler:()=>{this.createContext(!1)}}])}next(){this.change$.next()}filterContextsList(t){if(""===this.term)return this.sortedAlpha&&(t=this.sortContextsList(t)),t;{let i={ours:t.ours.filter(s=>{const a=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return s.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(a)})};if(this.contexts.public){const s=t.public.filter(a=>{const l=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(l)});i.public=s}if(this.contexts.shared){const s=t.shared.filter(a=>{const l=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(l)});i.shared=s}return this.sortedAlpha&&(i=this.sortContextsList(i)),i}}ngOnDestroy(){this.change$$.unsubscribe()}showFilter(){switch(this.showContextFilter){case cs.always:return!0;case cs.never:return!1;default:let t=this.contexts.ours.length;return t+=this.contexts.public?this.contexts.public.length:0,t+=this.contexts.shared?this.contexts.shared.length:0,t>=this.thresholdToFilter}}sortContextsList(t){if(t){const o=JSON.parse(JSON.stringify(t));return o.ours.sort((i,s)=>this.normalize(i.title)<this.normalize(s.title)?-1:this.normalize(i.title)>this.normalize(s.title)?1:0),o.shared?o.shared.sort((i,s)=>this.normalize(i.title)<this.normalize(s.title)?-1:this.normalize(i.title)>this.normalize(s.title)?1:0):o.public&&o.public.sort((i,s)=>this.normalize(i.title)<this.normalize(s.title)?-1:this.normalize(i.title)>this.normalize(s.title)?1:0),o}}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}toggleSort(t){this.sortedAlpha=t}clearFilter(){this.term=""}createContext(t){this.dialog.open(BF,{disableClose:!1}).afterClosed().pipe((0,mt.q)(1)).subscribe(o=>{o&&this.create.emit({title:o,empty:t})})}getPermission(t){if(t)return this.permissions.find(i=>i.name===t.name)}handleToggleCategory(t,o){const i=this.getPermission(t);if(i&&(i.checked=!i.checked,this.storageService.set("contexts.permissions."+i.name,i.checked),i.indeterminate=!1),o){let s=!1;for(const l of o.childs)if(this.getPermission(l).checked!==i.checked){s=!0;break}const a=this.getPermission(o);a&&(a.checked=i.checked,this.storageService.set("contexts.permissions."+a.name,i.checked),a.indeterminate=s)}if(t.childs)for(const s of t.childs){const a=this.getPermission(s);a&&a.checked!==i.checked&&(a.checked=i.checked,this.storageService.set("contexts.permissions."+a.name,i.checked))}this.filterPermissionsChanged.emit(this.permissions)}hideContext(t){if(t.hidden=!0,!this.showHidden){const o={ours:[],shared:[],public:[]};o.ours=this.contexts.ours.filter(i=>i.id!==t.id),o.shared=this.contexts.shared.filter(i=>i.id!==t.id),o.public=this.contexts.public.filter(i=>i.id!==t.id),this.contexts=o}this.hide.emit(t)}showContext(t){t.hidden=!1,this.show.emit(t)}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO),e.Y36(N),e.Y36(He),e.Y36(B.uw),e.Y36(L),e.Y36(oe))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-context-list"]],inputs:{contexts:"contexts",selectedContext:"selectedContext",map:"map",defaultContextId:"defaultContextId",term:"term"},outputs:{select:"select",unselect:"unselect",edit:"edit",delete:"delete",save:"save",clone:"clone",create:"create",hide:"hide",show:"show",showHiddenContexts:"showHiddenContexts",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools",filterPermissionsChanged:"filterPermissionsChanged"},decls:20,vars:17,consts:[[3,"navigation"],[1,"context-filter-container"],["floatLabel","always",4,"ngIf"],[1,"actions-container"],["class","sort-alpha","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","add-context-button","icon","plus",3,"iconColor","store","withIcon","withTitle","horizontal","mode",4,"ngIf"],["class","users-filter","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["accountMenu","matMenu"],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"profil-menu"],[3,"checked","click","change"],["ngFor","",3,"ngForOf"],["class","no-result",4,"ngIf"],["floatLabel","always"],["matInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["mat-icon-button","","matSuffix","","class","clear-button","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","","aria-label","Clear","color","warn",1,"clear-button",3,"click"],["svgIcon","close"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"matTooltip","click"],["color","primary","svgIcon","sort-alphabetical-variant"],["color","warn","svgIcon","sort-variant-remove"],["icon","plus",1,"add-context-button",3,"iconColor","store","withIcon","withTitle","horizontal","mode"],["mat-icon-button","","matTooltipShowDelay","500",1,"users-filter",3,"matTooltip","matMenuTriggerFor"],["color","primary","svgIcon","filter-menu"],["mat-menu-item","","class","profil-menu",4,"ngIf","ngIfElse"],["withSubMenu",""],[3,"checked","indeterminate","click","change"],["mat-menu-item","",1,"profil-menu",3,"matMenuTriggerFor"],["subAccountMenu","matMenu"],["mat-menu-item","","class","profil-menu",4,"ngFor","ngForOf"],[3,"title","collapsed","toggle",4,"ngIf"],[4,"ngIf"],[3,"title","collapsed","toggle"],["igoListItem","","color","accent",3,"selected","context","default","edit","delete","clone","save","hide","show","favorite","manageTools","managePermissions","select","unselect"],["igoListItem","","color","accent",3,"showFavorite","selected","context","default","favorite","select","unselect"],[1,"no-result"]],template:function(o,i){1&o&&(e.TgZ(0,"igo-list",0)(1,"div",1),e.YNc(2,o6,7,8,"mat-form-field",2),e.TgZ(3,"div",3),e.YNc(4,n6,3,3,"button",4),e.YNc(5,r6,3,3,"button",4),e.YNc(6,s6,1,6,"igo-actionbar",5),e.YNc(7,a6,3,4,"button",6),e.TgZ(8,"mat-menu",null,7),e.YNc(10,p6,4,2,"ng-container",8),e.TgZ(11,"button",9)(12,"mat-checkbox",10),e.NdJ("click",function(a){return a.stopPropagation()})("change",function(){return i.showHiddenContexts.emit()}),e.qZA(),e.TgZ(13,"span"),e._uU(14),e.ALo(15,"translate"),e.qZA()()()()(),e.YNc(16,f6,2,2,"ng-template",11),e.ALo(17,"keyvalue"),e.ALo(18,"async"),e.YNc(19,_6,3,3,"div",12),e.qZA()),2&o&&(e.Q6J("navigation",!0),e.xp6(2),e.Q6J("ngIf",i.showFilter()),e.xp6(2),e.Q6J("ngIf",!i.sortedAlpha),e.xp6(1),e.Q6J("ngIf",i.sortedAlpha),e.xp6(1),e.Q6J("ngIf",i.auth.authenticated&&i.contextConfigs),e.xp6(1),e.Q6J("ngIf",i.auth.authenticated&&i.contextConfigs),e.xp6(3),e.Q6J("ngForOf",i.users),e.xp6(2),e.Q6J("checked",i.showHidden),e.xp6(2),e.hij(" ",e.lcZ(15,11,"igo.context.contextManager.showHidden")," "),e.xp6(2),e.Q6J("ngForOf",e.lcZ(17,13,e.lcZ(18,15,i.contexts$))),e.xp6(3),e.Q6J("ngIf",i.isEmpty))},dependencies:[f.sg,f.O5,_.Fj,_.JJ,_.On,F.KE,F.hX,F.R9,j.Nt,w.Hw,S.RK,P.gM,ze.oG,Be.VK,Be.OP,Be.p6,Nt,So,cl,yn,e6,f.Ov,tn,O.X$],styles:["[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.context-filter-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 4px}.context-filter-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.context-filter-min-width[_ngcontent-%COMP%]{width:calc(100% - 135px);margin:5px;padding-left:6px}.profil-menu[_ngcontent-%COMP%]{padding-left:8px}.profil-menu[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:8px}.add-context-button[_ngcontent-%COMP%]{margin:0;width:40px;display:inline-flex;overflow:hidden}.actions-container[_ngcontent-%COMP%]{margin-left:4px}.no-result[_ngcontent-%COMP%]{padding:16px}"],changeDetection:0})}return n})(),fl=(()=>{class n{contextService;mapService;languageService;confirmDialogService;messageService;auth;storageService;cdRef;component;contexts$$;selectedContext$$;defaultContextId$$;previousMessageId;onSelect(t){this.contextService.loadContext(t.uri)}onEdit(t){this.contextService.loadEditedContext(t.uri)}onSave(t){const o=this.mapService.getMap(),i=this.contextService.getContextFromMap(o),s=()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:t.title})};if(t.imported)return i.title=t.title,this.contextService.delete(t.id,!0),void this.contextService.create(i).subscribe(l=>{this.contextService.loadContext(l.uri),s()});this.contextService.update(t.id,{layers:i.layers,map:{view:i.map.view}}).subscribe(()=>{s()})}onFavorite(t){t.id||(t.id=t.uri),this.contextService.setDefault(t.id).subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId),this.contextService.defaultContextId$.next(t.id);const o=this.messageService.success("igo.context.contextManager.dialog.favoriteMsg","igo.context.contextManager.dialog.favoriteTitle",void 0,{value:t.title});this.previousMessageId=o.toastId,this.cdRef.detectChanges()})}onManageTools(t){this.contextService.loadEditedContext(t.uri)}onManagePermissions(t){this.contextService.loadEditedContext(t.uri)}onDelete(t){this.confirmDialogService.open(this.languageService.translate.instant("igo.context.contextManager.dialog.confirmDelete")).subscribe(i=>{i&&this.contextService.delete(t.id,t.imported).subscribe(()=>{this.messageService.info("igo.context.contextManager.dialog.deleteMsg","igo.context.contextManager.dialog.deleteTitle",void 0,{value:t.title})})})}onClone(t){this.contextService.clone(t.id,{title:t.title+"-copy",uri:t.uri+"-copy"}).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.cloneMsg","igo.context.contextManager.dialog.cloneTitle",void 0,{value:t.title})})}onCreate(t){const{title:o,empty:i}=t,s=this.contextService.getContextFromMap(this.component.map,i);s.title=o,this.contextService.create(s).subscribe(()=>{this.messageService.success("igo.context.bookmarkButton.dialog.createMsg","igo.context.bookmarkButton.dialog.createTitle",void 0,{value:s.title}),this.contextService.loadContext(s.uri)})}loadContexts(){const t=["none"];for(const o of this.component.permissions)(!0===o.checked||!0===o.indeterminate)&&t.push(o.name);this.contextService.loadContexts(t,!!this.component.showHidden)}showHiddenContexts(){this.component.showHidden=!this.component.showHidden,this.storageService.set("contexts.showHidden",this.component.showHidden),this.loadContexts()}onShowContext(t){this.contextService.showContext(t.id).subscribe()}onHideContext(t){this.contextService.hideContext(t.id).subscribe()}constructor(t,o,i,s,a,l,c,u,p){this.contextService=o,this.mapService=i,this.languageService=s,this.confirmDialogService=a,this.messageService=l,this.auth=c,this.storageService=u,this.cdRef=p,this.component=t}ngOnInit(){this.component.contexts={ours:[]},this.component.showHidden=this.storageService.get("contexts.showHidden"),this.contexts$$=this.contextService.contexts$.subscribe(o=>this.handleContextsChange(o)),this.defaultContextId$$=this.contextService.defaultContextId$.subscribe(o=>{this.component.defaultContextId=o});const t=this.storageService.get("favorite.context.uri");t&&!this.auth.authenticated&&this.contextService.defaultContextId$.next(t),this.selectedContext$$=this.contextService.context$.pipe((0,ae.b)(100)).subscribe(o=>this.component.selectedContext=o),this.auth.authenticate$.subscribe(o=>{o&&this.contextService.getProfilByUser().subscribe(i=>{this.component.users=i,this.component.permissions=[];const s=this.component.users.reduce((l,c)=>(l=l.concat(c),c.childs?l.concat(c.childs):l),[]);for(const l of s){const c={name:l.name,checked:this.storageService.get("contexts.permissions."+l.name)};null===c.checked&&(c.checked=!0),this.component.permissions.push(c)}const a=["none"];for(const l of this.component.permissions)(!0===l.checked||!0===l.indeterminate)&&a.push(l.name);this.contextService.loadContexts(a,!!this.component.showHidden)})})}ngOnDestroy(){this.contexts$$.unsubscribe(),this.selectedContext$$.unsubscribe(),this.defaultContextId$$.unsubscribe()}handleContextsChange(t){this.component.contexts=t}static \u0275fac=function(o){return new(o||n)(e.Y36(us,2),e.Y36(Mo),e.Y36(Gt),e.Y36(L),e.Y36(Zs),e.Y36(_e),e.Y36(He),e.Y36(oe),e.Y36(e.sBO))};static \u0275dir=e.lG2({type:n,selectors:[["","igoContextListBinding",""]],hostBindings:function(o,i){1&o&&e.NdJ("select",function(a){return i.onSelect(a)})("edit",function(a){return i.onEdit(a)})("save",function(a){return i.onSave(a)})("favorite",function(a){return i.onFavorite(a)})("manageTools",function(a){return i.onManageTools(a)})("managePermissions",function(a){return i.onManagePermissions(a)})("delete",function(a){return i.onDelete(a)})("clone",function(a){return i.onClone(a)})("create",function(a){return i.onCreate(a)})("filterPermissionsChanged",function(){return i.loadContexts()})("showHiddenContexts",function(){return i.showHiddenContexts()})("show",function(a){return i.onShowContext(a)})("hide",function(a){return i.onHideContext(a)})}})}return n})();function y6(n,r){if(1&n&&(e.TgZ(0,"span",11),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij("",t.prefix,"-")}}let b6=(()=>{class n{formBuilder;messageService;form;prefix;get btnSubmitText(){return this._btnSubmitText}set btnSubmitText(t){this._btnSubmitText=t}_btnSubmitText;get context(){return this._context}set context(t){this._context=t,this.buildForm()}_context;get disabled(){return this._disabled}set disabled(t){this._disabled=t}_disabled=!1;submitForm=new e.vpe;clone=new e.vpe;delete=new e.vpe;constructor(t,o){this.formBuilder=t,this.messageService=o}ngOnInit(){this.buildForm()}handleFormSubmit(t){let o=Object.assign({},t);o=R.removeNull(o),o.uri=o.uri.replace(" ",""),o.uri=o.uri?this.prefix+"-"+o.uri:this.prefix,this.submitForm.emit(o)}copyTextToClipboard(){const t=this.prefix+"-"+this.form.value.uri.replace(" ","");At.copy(t)&&this.messageService.success("igo.context.contextManager.dialog.copyMsg","igo.context.contextManager.dialog.copyTitle")}buildForm(){const t=this.context||{},o=t.uri.split("-");this.prefix=o.shift();const i=o.join("-");this.form=this.formBuilder.group({title:[t.title],uri:[i||" "]})}static \u0275fac=function(o){return new(o||n)(e.Y36(_.QS),e.Y36(_e))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-context-form"]],inputs:{btnSubmitText:"btnSubmitText",context:"context",disabled:"disabled"},outputs:{submitForm:"submitForm",clone:"clone",delete:"delete"},decls:19,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","maxlength","128","formControlName","title",3,"placeholder"],["id","uriInput",1,"full-width"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","maxlength","64","floatLabel","always","formControlName","uri",3,"placeholder"],["id","copyButton","type","button","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","content-copy"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[1,"prefix"]],template:function(o,i){1&o&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return i.handleFormSubmit(i.form.value)}),e.TgZ(1,"mat-form-field",1),e._UZ(2,"input",2),e.ALo(3,"translate"),e.TgZ(4,"mat-error"),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"mat-form-field",3),e.YNc(8,y6,2,1,"span",4),e.TgZ(9,"span",5),e._UZ(10,"input",6),e.ALo(11,"translate"),e.qZA()(),e.TgZ(12,"button",7),e.NdJ("click",function(){return i.copyTextToClipboard()}),e.ALo(13,"translate"),e._UZ(14,"mat-icon",8),e.qZA(),e.TgZ(15,"div",9)(16,"button",10),e._uU(17),e.ALo(18,"translate"),e.qZA()()()),2&o&&(e.Q6J("formGroup",i.form),e.xp6(2),e.Q6J("placeholder",e.lcZ(3,8,"igo.context.contextManager.form.title")),e.xp6(3),e.hij(" ",e.lcZ(6,10,"igo.context.contextManager.form.titleRequired")," "),e.xp6(3),e.Q6J("ngIf",i.prefix),e.xp6(2),e.Q6J("placeholder",e.lcZ(11,12,"igo.context.contextManager.form.uri")),e.xp6(2),e.Q6J("matTooltip",e.lcZ(13,14,"igo.context.contextManager.form.copy")),e.xp6(4),e.Q6J("disabled",!i.form.valid||i.disabled),e.xp6(1),e.hij(" ",e.lcZ(18,16,"igo.context.contextManager.form.edit")," "))},dependencies:[f.O5,_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.nD,_.sg,_.u,F.KE,F.TO,j.Nt,w.Hw,S.lW,S.RK,P.gM,O.X$],styles:["form[_ngcontent-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}#copyButton[_ngcontent-%COMP%]{width:24px;float:right;position:relative;top:-58px;left:5px}"]})}return n})();function v6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-context-form",1),e.NdJ("submitForm",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.submitForm.emit(i))}),e.ALo(1,"translate"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("btnSubmitText",e.lcZ(1,2,"igo.context.contextManager.save"))("context",t.context)}}let hd=(()=>{class n{cd;get context(){return this._context}set context(t){this._context=t,this.refresh()}_context;submitForm=new e.vpe;constructor(t){this.cd=t}refresh(){this.cd.detectChanges()}static \u0275fac=function(o){return new(o||n)(e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-context-edit"]],inputs:{context:"context"},outputs:{submitForm:"submitForm"},decls:1,vars:1,consts:[[3,"btnSubmitText","context","submitForm",4,"ngIf"],[3,"btnSubmitText","context","submitForm"]],template:function(o,i){1&o&&e.YNc(0,v6,2,4,"igo-context-form",0),2&o&&e.Q6J("ngIf",i.context)},dependencies:[f.O5,b6,O.X$],encapsulation:2})}return n})(),C6=(()=>{class n{contextService;messageService;component;editedContext$$;submitSuccessed=new e.vpe;onEdit(t){this.contextService.update(this.component.context.id,t).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:t.title||this.component.context.title}),this.contextService.setEditedContext(void 0),this.submitSuccessed.emit(t)})}constructor(t,o,i){this.contextService=o,this.messageService=i,this.component=t}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(t=>this.handleEditedContextChange(t))}ngOnDestroy(){this.editedContext$$.unsubscribe()}handleEditedContextChange(t){this.component.context=t}static \u0275fac=function(o){return new(o||n)(e.Y36(hd,2),e.Y36(Mo),e.Y36(_e))};static \u0275dir=e.lG2({type:n,selectors:[["","igoContextEditBinding",""]],hostBindings:function(o,i){1&o&&e.NdJ("submitForm",function(a){return i.onEdit(a)})},outputs:{submitSuccessed:"submitSuccessed"}})}return n})();function x6(n,r){1&n&&(e.TgZ(0,"div",3)(1,"h4"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,2,"igo.context.permission.readOnlyTitle")),e.xp6(3),e.Oqu(e.lcZ(6,4,"igo.context.permission.readOnlyMsg")))}function S6(n,r){1&n&&(e.TgZ(0,"mat-radio-button",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.permission.scope.public")," "))}function w6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"mat-radio-group",4),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.context.scope=i)})("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.scopeChanged.emit(i.context))}),e.TgZ(2,"mat-radio-button",5),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-radio-button",6),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.YNc(8,S6,3,3,"mat-radio-button",7),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t.context.scope),e.xp6(2),e.hij(" ",e.lcZ(4,4,"igo.context.permission.scope.private")," "),e.xp6(3),e.hij(" ",e.lcZ(7,6,"igo.context.permission.scope.shared")," "),e.xp6(2),e.Q6J("ngIf",t.authService.isAdmin)}}function T6(n,r){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e._UZ(2,"br"),e.TgZ(3,"small",21),e._uU(4),e.qZA()()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.title,""),e.xp6(3),e.Oqu(t.name)}}function F6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"form",9),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.handleFormSubmit(i.form.value))}),e.TgZ(1,"mat-form-field",10),e._UZ(2,"input",11),e.ALo(3,"translate"),e.TgZ(4,"mat-autocomplete",12,13),e.NdJ("optionSelected",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.onProfilSelected(i.option.value))}),e.YNc(6,T6,5,3,"mat-option",14),e.qZA(),e.TgZ(7,"mat-error"),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e.TgZ(10,"mat-radio-group",15)(11,"mat-radio-button",16),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"mat-radio-button",17),e._uU(15),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"div",18)(18,"button",19),e._uU(19),e.ALo(20,"translate"),e.qZA()()()}if(2&n){const t=e.MAs(5),o=e.oxw(2);e.Q6J("formGroup",o.form),e.xp6(2),e.Q6J("placeholder",e.lcZ(3,11,"igo.context.permission.user"))("formControl",o.formControl)("matAutocomplete",t),e.xp6(2),e.Q6J("displayWith",o.displayFn),e.xp6(2),e.Q6J("ngForOf",o.profils),e.xp6(2),e.hij(" ",e.lcZ(9,13,"igo.context.permission.profilRequired")," "),e.xp6(4),e.hij(" ",e.lcZ(13,15,"igo.context.permission.read")," "),e.xp6(3),e.hij(" ",e.lcZ(16,17,"igo.context.permission.write")," "),e.xp6(3),e.Q6J("disabled",!o.form.valid),e.xp6(1),e.hij(" ",e.lcZ(20,19,"igo.context.permission.addBtn")," ")}}function O6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(5);return e.KtG(s.removePermission.emit(i))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",30),e.qZA()}2&n&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.permission.delete"))}function A6(n,r){if(1&n&&(e.TgZ(0,"mat-list-item"),e._UZ(1,"mat-icon",25),e.TgZ(2,"h4",26),e._uU(3),e.TgZ(4,"small",21),e._uU(5),e.qZA()(),e.TgZ(6,"div",27),e.YNc(7,O6,3,3,"button",28),e.qZA()()),2&n){const t=r.$implicit,o=e.oxw(5);e.xp6(3),e.hij(" ",t.profilTitle," "),e.xp6(2),e.Oqu(t.profil),e.xp6(2),e.Q6J("ngIf",o.canWrite||t.profil===o.authService.decodeToken().user.sourceId)}}function L6(n,r){if(1&n&&(e.TgZ(0,"igo-collapsible",24),e.ALo(1,"translate"),e.YNc(2,A6,8,3,"ng-template",22),e.qZA()),2&n){const t=e.oxw().$implicit;e.Q6J("title",e.lcZ(1,2,"igo.context.permission."+t.key)),e.xp6(2),e.Q6J("ngForOf",t.value)}}function M6(n,r){1&n&&e.YNc(0,L6,3,4,"igo-collapsible",23),2&n&&e.Q6J("ngIf",r.$implicit.value.length)}function I6(n,r){if(1&n&&(e.TgZ(0,"igo-list"),e.YNc(1,M6,1,1,"ng-template",22),e.ALo(2,"keyvalue"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,t.permissions))}}function Z6(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,x6,7,6,"div",1),e.YNc(2,w6,9,8,"div",1),e.YNc(3,F6,21,21,"form",2),e.YNc(4,I6,3,3,"igo-list",0),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.canWrite),e.xp6(1),e.Q6J("ngIf",t.canWrite),e.xp6(1),e.Q6J("ngIf","private"!==t.context.scope&&t.canWrite),e.xp6(1),e.Q6J("ngIf",t.permissions&&"private"!==t.context.scope)}}let fd=(()=>{class n{formBuilder;cd;http;authService;config;form;get context(){return this._context}set context(t){this._context=t,this.cd.detectChanges()}_context;get permissions(){return this._permissions}set permissions(t){this._permissions=t,this.cd.detectChanges()}_permissions;get profils(){return this._profils}set profils(t){this._profils=t,this.cd.detectChanges()}_profils=[];get canWrite(){return this.context.permission===Wt[Wt.write]}baseUrlProfils;formControl=new _.p4;formValueChanges$$;addPermission=new e.vpe;removePermission=new e.vpe;scopeChanged=new e.vpe;constructor(t,o,i,s,a){this.formBuilder=t,this.cd=o,this.http=i,this.authService=s,this.config=a}ngOnInit(){this.buildForm(),this.baseUrlProfils=this.config.getConfig("context.url")+"/profils-users?",this.formValueChanges$$=this.formControl.valueChanges.subscribe(t=>{t.length?(this.http.get(this.baseUrlProfils+"q="+t).subscribe(o=>{this.profils=o}),this.profils.filter(o=>{const i=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=o.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return(o.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")+s).includes(i)})):this.profils=[]})}displayFn(t){return t?t.title:void 0}handleFormSubmit(t){this.addPermission.emit(t)}buildForm(){this.form=this.formBuilder.group({profil:[],typePermission:["read"]})}onProfilSelected(t){this.form.setValue({profil:t.name,typePermission:this.form.value.typePermission})}static \u0275fac=function(o){return new(o||n)(e.Y36(_.QS),e.Y36(e.sBO),e.Y36($.eN),e.Y36(He),e.Y36(N))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-context-permissions"]],inputs:{context:"context",permissions:"permissions"},outputs:{addPermission:"addPermission",removePermission:"removePermission",scopeChanged:"scopeChanged"},decls:1,vars:1,consts:[[4,"ngIf"],["class","scopeForm",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"scopeForm"],[3,"ngModel","ngModelChange","change"],["value","private"],["value","protected"],["value","public",4,"ngIf"],["value","public"],[3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","",3,"placeholder","formControl","matAutocomplete"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formControlName","typePermission"],["value","read"],["value","write"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[3,"value"],[1,"mat-typography"],["ngFor","",3,"ngForOf"],[3,"title",4,"ngIf"],[3,"title"],["matListItemIcon","","svgIcon","account-outline"],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"]],template:function(o,i){1&o&&e.YNc(0,Z6,5,4,"div",0),2&o&&e.Q6J("ngIf",i.context)},dependencies:[f.sg,f.O5,_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.On,_.oH,_.sg,_.u,F.KE,F.TO,j.Nt,w.Hw,S.lW,S.RK,P.gM,Z.Tg,Z.Yt,Z.sL,Z.ni,nt.VQ,nt.U0,le.ey,Je.XC,Je.ZL,So,cl,_n,tn,O.X$],styles:["[_nghost-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}mat-radio-button[_ngcontent-%COMP%]{padding:14px 14px 14px 0}.scopeForm[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{padding:5px}"]})}return n})(),P6=(()=>{class n{contextService;languageService;messageService;cd;component;editedContext$$;onAddPermission(t){t.profil?this.contextService.addPermissionAssociation(this.component.context.id,t.profil,t.typePermission).subscribe(i=>{for(const a of i)this.component.permissions[t.typePermission].push(a);this.messageService.success("igo.context.permission.dialog.addMsg","igo.context.permission.dialog.addTitle",void 0,{value:t.profil}),this.cd.detectChanges()}):this.messageService.error("igo.context.contextManager.errors.addPermissionEmpty","igo.context.contextManager.errors.addPermissionTitle")}onRemovePermission(t){this.contextService.deletePermissionAssociation(this.component.context.id,t.id).subscribe(()=>{const i=this.component.permissions[t.typePermission].findIndex(a=>a.id===t.id);this.component.permissions[t.typePermission].splice(i,1),this.messageService.success("igo.context.permission.dialog.deleteMsg","igo.context.permission.dialog.deleteTitle",void 0,{value:t.profil}),this.cd.detectChanges()})}onScopeChanged(t){const o=t.scope;this.contextService.update(t.id,{scope:o}).subscribe(()=>{this.messageService.success("igo.context.permission.dialog.scopeChangedMsg","igo.context.permission.dialog.scopeChangedTitle",void 0,{value:"igo.context.permission.scope."+o})})}constructor(t,o,i,s,a){this.contextService=o,this.languageService=i,this.messageService=s,this.cd=a,this.component=t}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(t=>this.handleEditedContextChange(t))}ngOnDestroy(){this.editedContext$$.unsubscribe(),this.contextService.editedContext$.next(void 0)}handleEditedContextChange(t){this.component.context=t,t&&this.contextService.getPermissions(t.id).subscribe(o=>{const i={read:(o=o||[]).filter(s=>"read"===s.typePermission.toString()),write:o.filter(s=>"write"===s.typePermission.toString())};return this.component.permissions=i})}static \u0275fac=function(o){return new(o||n)(e.Y36(fd,2),e.Y36(Mo),e.Y36(L),e.Y36(_e),e.Y36(e.sBO))};static \u0275dir=e.lG2({type:n,selectors:[["","igoContextPermissionsBinding",""]],hostBindings:function(o,i){1&o&&e.NdJ("addPermission",function(a){return i.onAddPermission(a)})("removePermission",function(a){return i.onRemovePermission(a)})("scopeChanged",function(a){return i.onScopeChanged(a)})}})}return n})(),_d=(()=>{class n{contextService;route;language="";constructor(t,o){this.contextService=t,this.route=o,this.route.queryParams.subscribe(i=>{i.lang&&(this.language=i.lang)})}getUrlWithApi(t){return this.language?`${location.origin+location.pathname}?context=${t.uri}&lang=${this.language}`:`${location.origin+location.pathname}?context=${t.uri}`}createContextShared(t,o){const i=this.contextService.getContextFromMap(t);return i.scope="public",i.title=o.title,i.uri=o.uri,this.contextService.create(i)}updateContextShared(t,o,i){const s=this.contextService.getContextFromMap(t);return this.contextService.update(i,{title:o.title,map:s.map})}getUrlWithoutApi(t,o){if(!(this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&t.viewController.getZoom()))return;const i=o.layerlistControls.querystring;let s=this.route.options.visibleOnLayersKey,a=this.route.options.visibleOffLayersKey;const l=t.layers,c=l.filter(Re=>Re.visible&&!Re.isIgoInternalLayer),u=l.filter(Re=>!Re.visible&&!Re.isIgoInternalLayer);0===c.length&&(s=""),0===u.length&&(a="");let p="",d=[];c.length>u.length?(p=`${s}=*&${a}=`,d=u):(p=`${a}=*&${s}=`,d=c);for(const Re of d)Re.id&&(p+=Re.id+",");const g=[],h=this.contextService.context$.value.layers;for(const Re of h)(typeof Re.id<"u"||typeof Re.source<"u")&&g.push(Re.id||Re.source.id);const m=this.makeLayersByService(l,g,"wms"),b=this.makeLayersByService(l,g,"wmts"),C=this.makeLayersByService(l,g,"arcgisrest"),x=this.makeLayersByService(l,g,"imagearcgisrest"),A=this.makeLayersByService(l,g,"tilearcgisrest");p=p.substr(0,p.length-1);const k=this.route.options.centerKey,H=this.route.options.contextKey,Me=`${this.route.options.zoomKey}=${t.viewController.getZoom()}`,Fe=t.viewController.getCenter("EPSG:4326")||[],V=`${k}=${Fe[0].toFixed(5).replace(/\.([^0]+)0+$/,".$1")},${Fe[1].toFixed(5).replace(/\.([^0]+)0+$/,".$1")}`.replace(/.00000/g,"");let he="";this.contextService.context$.value&&(he=`${H}=${this.contextService.context$.value.uri}`);let et=this.language?`${location.origin}${location.pathname}?${he}&${Me}&${V}&${p}&${i}&${m}&${i}&${b}&${C}&${x}&${A}&lang=${this.language}`:`${location.origin}${location.pathname}?${he}&${Me}&${V}&${p}&${i}&${m}&${i}&${b}&${C}&${x}&${A}`;for(let Re=0;Re<5;Re++)et=et.replace(/&&/g,"&"),et=et.endsWith("&")?et.slice(0,-1):et;return et=et.endsWith("&")?et.slice(0,-1):et,et=et.replace("?&wm","&wm"),et=et.replace("?&","?"),et}makeLayersByService(t,o,i){const s=[];for(const l of t.filter(c=>c.dataSource.options?.type===i))if(-1===o.indexOf(l.id)){let p,c=encodeURIComponent(l.dataSource.options.url),u="";switch(l.dataSource.options.type.toLowerCase()){case"wms":const h=l.dataSource.options;u=encodeURIComponent(h.params.LAYERS),p="1.3.0"===h.params.VERSION?p:h.params.VERSION;break;case"wmts":case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":u=encodeURIComponent(l.dataSource.options.layer)}const d=`${u}:igoz${l.zIndex}`;let g="";if(p){const h=-1===l.dataSource.options.url.indexOf("?")?"?":"&";g=encodeURIComponent(`${h}VERSION=${p}`)}c=`${c}${g}`,s.find(h=>h.url===c)?s.forEach(h=>{h.url===c&&h.layers.push(d)}):s.push({url:c,layers:[d]})}let a="";if(s.length>=1){let l,c;switch(i.toLowerCase()){case"wms":l=this.route.options.wmsUrlKey,c=this.route.options.wmsLayersKey;break;case"wmts":l=this.route.options.wmtsUrlKey,c=this.route.options.wmtsLayersKey;break;case"arcgisrest":l=this.route.options.arcgisUrlKey,c=this.route.options.arcgisLayersKey;break;case"imagearcgisrest":l=this.route.options.iarcgisUrlKey,c=this.route.options.iarcgisLayersKey;break;case"tilearcgisrest":l=this.route.options.tarcgisUrlKey,c=this.route.options.tarcgisLayersKey;break;default:l="",c=""}let u="",p="";s.forEach(d=>{u+=`${d.url},`,p+=`(${d.layers.join(",")}),`}),u=u.endsWith(",")?u.slice(0,-1):u,p=p.endsWith(",")?p.slice(0,-1):p,a=`${l}=${u}&${c}=${p}`}return a}static \u0275fac=function(o){return new(o||n)(e.LFG(Mo),e.LFG(un,8))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function $6(n,r){1&n&&(e.TgZ(0,"h4"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.included")," "))}function D6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.context")," "))}function E6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.center")," "))}function R6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.zoom")," "))}function N6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.addedLayers")," "))}function B6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.visibleInvisible")," "))}function J6(n,r){1&n&&(e.TgZ(0,"h4"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.excluded")," "))}function U6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.order")," "))}function G6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.opacity")," "))}function q6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.filterOgc")," "))}function j6(n,r){1&n&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.filterTime")," "))}function Q6(n,r){1&n&&(e.TgZ(0,"div"),e.YNc(1,$6,3,3,"h4",7),e.ALo(2,"translate"),e.TgZ(3,"ul"),e.YNc(4,D6,3,3,"li",7),e.ALo(5,"translate"),e.YNc(6,E6,3,3,"li",7),e.ALo(7,"translate"),e.YNc(8,R6,3,3,"li",7),e.ALo(9,"translate"),e.YNc(10,N6,3,3,"li",7),e.ALo(11,"translate"),e.YNc(12,B6,3,3,"li",7),e.ALo(13,"translate"),e.qZA(),e.YNc(14,J6,3,3,"h4",7),e.ALo(15,"translate"),e.TgZ(16,"ul"),e.YNc(17,U6,3,3,"li",7),e.ALo(18,"translate"),e.YNc(19,G6,3,3,"li",7),e.ALo(20,"translate"),e.YNc(21,q6,3,3,"li",7),e.ALo(22,"translate"),e.YNc(23,j6,3,3,"li",7),e.ALo(24,"translate"),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("ngIf",""!==e.lcZ(2,11,"igo.context.shareMap.included")),e.xp6(3),e.Q6J("ngIf",""!==e.lcZ(5,13,"igo.context.shareMap.context")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(7,15,"igo.context.shareMap.center")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(9,17,"igo.context.shareMap.zoom")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(11,19,"igo.context.shareMap.addedLayers")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(13,21,"igo.context.shareMap.visibleInvisible")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(15,23,"igo.context.shareMap.excluded")),e.xp6(3),e.Q6J("ngIf",""!==e.lcZ(18,25,"igo.context.shareMap.order")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(20,27,"igo.context.shareMap.opacity")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(22,29,"igo.context.shareMap.filterOgc")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(24,31,"igo.context.shareMap.filterTime")))}function Y6(n,r){1&n&&(e._UZ(0,"igo-custom-html",9),e.ALo(1,"translate")),2&n&&e.Q6J("html",e.lcZ(1,1,"igo.context.shareMap.htmlClarifications"))}let H6=(()=>{class n{messageService;shareMapService;cdRef;mapState$$;map;url;publicShareOption={layerlistControls:{querystring:""}};constructor(t,o,i){this.messageService=t,this.shareMapService=o,this.cdRef=i}ngOnInit(){this.resetUrl(),this.mapState$$=(0,Ye.a)([this.map.viewController.state$,this.map.status$]).subscribe(t=>{this.resetUrl(),this.cdRef.detectChanges()})}ngAfterViewInit(){this.resetUrl()}ngOnDestroy(){this.mapState$$.unsubscribe()}resetUrl(t={}){this.url=this.shareMapService.getUrlWithoutApi(this.map,this.publicShareOption)}copyTextToClipboard(t){At.copy(t)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}static \u0275fac=function(o){return new(o||n)(e.Y36(_e),e.Y36(_d),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-share-map-url"]],inputs:{map:"map"},decls:17,vars:13,consts:[[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",3,"placeholder","value"],["textArea",""],[1,"igo-form-button-group"],["mat-raised-button","",3,"click"],["svgIcon","content-copy"],[1,"mat-typography"],[4,"ngIf"],["class","shareCustomPadding","class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"]],template:function(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",0)(1,"mat-form-field"),e._UZ(2,"textarea",1,2),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){e.CHM(s);const l=e.MAs(3);return e.KtG(i.copyTextToClipboard(l))}),e._UZ(7,"mat-icon",5),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e.TgZ(10,"div"),e._UZ(11,"br"),e.TgZ(12,"section",6),e.YNc(13,Q6,25,33,"div",7),e.ALo(14,"translate"),e.YNc(15,Y6,2,3,"igo-custom-html",8),e.ALo(16,"translate"),e.qZA()()()}2&o&&(e.xp6(2),e.Q6J("placeholder",e.lcZ(4,5,"igo.context.shareMap.placeholderLink"))("value",i.url),e.xp6(6),e.hij(" ",e.lcZ(9,7,"igo.context.shareMap.copy")," "),e.xp6(5),e.Q6J("ngIf",""===e.lcZ(14,9,"igo.context.shareMap.htmlClarifications")),e.xp6(2),e.Q6J("ngIf",""!==e.lcZ(16,11,"igo.context.shareMap.htmlClarifications")))},dependencies:[f.O5,w.Hw,F.KE,j.Nt,S.lW,Xa,O.X$],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-custom-html.shareCustomPadding[_ngcontent-%COMP%]{padding:0}']})}return n})();function V6(n,r){if(1&n&&(e.TgZ(0,"span",11),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij("",t.userId,"-")}}function z6(n,r){if(1&n&&(e.TgZ(0,"button",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw();e.Q6J("disabled",!t.form.valid),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.context.shareMap.button")," ")}}function K6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.updateContextShared(i.form.value))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.context.shareMap.refreshBtn")," "))}function W6(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",14)(1,"mat-form-field"),e._UZ(2,"textarea",15,16),e.ALo(4,"translate"),e.TgZ(5,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(3),s=e.oxw();return e.KtG(s.copyTextToClipboard(i))}),e.ALo(6,"translate"),e._UZ(7,"mat-icon",18),e.qZA()(),e._UZ(8,"div"),e.qZA()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("placeholder",e.lcZ(4,3,"igo.context.shareMap.placeholderLink"))("value",t.url),e.xp6(3),e.Q6J("matTooltip",e.lcZ(6,5,"igo.context.shareMap.copy"))}}let X6=(()=>{class n{languageService;messageService;auth;shareMapService;formBuilder;form;map;url;userId;idContextShared;constructor(t,o,i,s,a){this.languageService=t,this.messageService=o,this.auth=i,this.shareMapService=s,this.formBuilder=a}ngOnInit(){this.auth.authenticate$.subscribe(t=>{const o=this.auth.decodeToken();this.userId=o.user?o.user.id:void 0,this.buildForm()})}createUrl(t={}){const o=Object.assign({},t);o.uri=this.userId?`${this.userId}-${t.uri}`:t.uri,this.url=this.shareMapService.getUrlWithApi(o),this.shareMapService.createContextShared(this.map,o).subscribe(i=>{this.idContextShared=i.id,this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:o.title})},i=>{i.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(i)})}updateContextShared(t={}){const o=Object.assign({},t);o.uri=this.userId?`${this.userId}-${t.uri}`:t.uri,this.shareMapService.updateContextShared(this.map,o,this.idContextShared).subscribe(i=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:o.title})},i=>{i.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(i)})}copyTextToClipboard(t){At.copy(t)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}buildForm(){this.url=void 0;const t=Ie();let o="Partage ";o+=this.userId?`(${this.userId}-${t})`:`(${t})`,this.form=this.formBuilder.group({title:[o],uri:[t]})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_e),e.Y36(He),e.Y36(_d),e.Y36(_.QS))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-share-map-api"]],inputs:{map:"map"},decls:21,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"igo-input-container"],["matInput","","required","","formControlName","title",3,"placeholder"],["id","uriInput",1,"igo-input-container"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","required","","formControlName","uri",3,"readonly","placeholder"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled",4,"ngIf"],["mat-raised-button","","type","button",3,"click",4,"ngIf"],["class","igo-input-container linkToShare",4,"ngIf"],[1,"prefix"],["mat-raised-button","","type","submit",3,"disabled"],["mat-raised-button","","type","button",3,"click"],[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",1,"textAreaWithButton",3,"placeholder","value"],["textArea",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","content-copy"]],template:function(o,i){1&o&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return i.createUrl(i.form.value)}),e.TgZ(1,"div",1)(2,"mat-form-field"),e._UZ(3,"input",2),e.ALo(4,"translate"),e.TgZ(5,"mat-error"),e._uU(6),e.ALo(7,"translate"),e.qZA()()(),e.TgZ(8,"div",3)(9,"mat-form-field"),e.YNc(10,V6,2,1,"span",4),e.TgZ(11,"span",5),e._UZ(12,"input",6),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"mat-error"),e._uU(15),e.ALo(16,"translate"),e.qZA()()(),e.TgZ(17,"div",7),e.YNc(18,z6,3,4,"button",8),e.YNc(19,K6,3,3,"button",9),e.qZA()(),e.YNc(20,W6,9,7,"div",10)),2&o&&(e.Q6J("formGroup",i.form),e.xp6(3),e.Q6J("placeholder",e.lcZ(4,10,"igo.context.contextManager.form.title")),e.xp6(3),e.hij(" ",e.lcZ(7,12,"igo.context.contextManager.form.titleRequired")," "),e.xp6(4),e.Q6J("ngIf",i.userId),e.xp6(2),e.Q6J("readonly",!i.userId)("placeholder",e.lcZ(13,14,"igo.context.contextManager.form.uri")),e.xp6(3),e.hij(" ",e.lcZ(16,16,"igo.context.contextManager.form.uriRequired")," "),e.xp6(3),e.Q6J("ngIf",!i.url),e.xp6(1),e.Q6J("ngIf",i.url),e.xp6(1),e.Q6J("ngIf",i.url))},dependencies:[f.O5,_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.sg,_.u,w.Hw,P.gM,F.KE,F.TO,j.Nt,S.lW,S.RK,O.X$],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form[_ngcontent-%COMP%]{padding:20px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}']})}return n})();function e3(n,r){if(1&n&&(e.TgZ(0,"mat-tab-group")(1,"mat-tab",2),e.ALo(2,"translate"),e._UZ(3,"igo-share-map-api",3),e.qZA(),e.TgZ(4,"mat-tab",2),e.ALo(5,"translate"),e._UZ(6,"igo-share-map-url",3),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("label",e.lcZ(2,4,"igo.context.shareMap.shareWithApi")),e.xp6(2),e.Q6J("map",t.map),e.xp6(1),e.Q6J("label",e.lcZ(5,6,"igo.context.shareMap.shareWithUrl")),e.xp6(2),e.Q6J("map",t.map)}}function t3(n,r){if(1&n&&e._UZ(0,"igo-share-map-url",3),2&n){const t=e.oxw();e.Q6J("map",t.map)}}let o3=(()=>{class n{config;map;hasApi=!1;constructor(t){this.config=t,this.hasApi=!!this.config.getConfig("context.url")}static \u0275fac=function(o){return new(o||n)(e.Y36(N))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-share-map"]],inputs:{map:"map"},decls:2,vars:2,consts:[[4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"map"]],template:function(o,i){1&o&&(e.YNc(0,e3,7,8,"mat-tab-group",0),e.YNc(1,t3,1,1,"igo-share-map-url",1)),2&o&&(e.Q6J("ngIf",i.hasApi),e.xp6(1),e.Q6J("ngIf",!i.hasApi))},dependencies:[f.O5,ht.uX,ht.SP,H6,X6,O.X$]})}return n})();function s3(n,r){1&n&&e._UZ(0,"igo-metadata-button",14),2&n&&e.Q6J("layer",r.layer)}const a3=function(){return["LanguageService","mapService"]},c3=ee.Bz.forChild([{path:"context",component:(()=>{class n{languageService;mapService;contextService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(t,o,i){this.languageService=t,this.mapService=o,this.contextService=i,this.mapService.setMap(this.map),this.contextService.loadDefaultContext(),this.contextService.loadContexts()}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(Gt),e.Y36(Mo))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-context"]],decls:19,vars:12,consts:[["title","Context","subtitle","Context",3,"dependencies"],["codeFolder","context/context","configFolder","contexts"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoMapContext","","igoLayerContext","",3,"map","view"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[1,"flex","flex-col","align-start","h-100","w-100"],["title","Contexts list",1,"h-100","w-100"],["igoContextListBinding","",3,"map"],["title","Layers",1,"h-100","w-100"],["igoLayerListBinding","",3,"map"],["igoLayerItemToolbar",""],["title","Import/Export context","codeFolder","context/context","configFolder","contexts"],[3,"map"],[3,"layer"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4)(6,"igo-geolocate-button",4)(7,"igo-home-extent-button",4)(8,"igo-rotation-button",5),e.qZA()(),e.TgZ(9,"mat-grid-tile")(10,"div",6)(11,"igo-panel",7),e._UZ(12,"igo-context-list",8),e.qZA(),e.TgZ(13,"igo-panel",9)(14,"igo-layer-list",10),e.YNc(15,s3,1,1,"ng-template",null,11,e.W1O),e.qZA()()()()()(),e.TgZ(17,"app-example-viewer",12),e._UZ(18,"igo-context-import-export",13),e.qZA()()),2&o&&(e.Q6J("dependencies",e.DdM(11,a3)),e.xp6(4),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map)("showIfNoRotation",!0),e.xp6(4),e.Q6J("map",i.map),e.xp6(2),e.Q6J("map",i.map),e.xp6(4),e.Q6J("map",i.map))},dependencies:[me,de,Ct.Il,Ct.DX,Ht,Le,lt,zn,Kn,Wn,Mi,Yr,Xi,md,us,fl,pd,ud]})}return n})()}]);let u3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[$.Ed,c3,pe,It,at,kn,$n,Ha,Ba,Ii,LF]})}return n})();const d3=ee.Bz.forChild([{path:"activity",component:(()=>{class n{activityService;idsActivity=[];constructor(t){this.activityService=t}register(){this.idsActivity.push(this.activityService.register())}unregister(){this.activityService.unregister(this.idsActivity.pop())}get counter(){return this.activityService.counter$.value}static \u0275fac=function(o){return new(o||n)(e.Y36(Ni))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-activity"]],decls:23,vars:1,consts:[["title","Activity","subtitle","Core"],["codeFolder","core/activity"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"mat-body-1","sub-content"],["igoSpinnerActivity",""]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"p"),e._uU(2,"Register activities in service. Use to display a loading icon"),e.qZA(),e.TgZ(3,"li"),e._uU(4," Import "),e.TgZ(5,"code"),e._uU(6,"IgoActivityModule"),e.qZA(),e._uU(7," only if you want register http calls "),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoActivityModule"),e.qZA(),e._uU(12," only once"),e.qZA(),e.TgZ(13,"app-example-viewer",1)(14,"div",2)(15,"button",3),e.NdJ("click",function(){return i.register()}),e._uU(16,"Register"),e.qZA(),e.TgZ(17,"button",3),e.NdJ("click",function(){return i.unregister()}),e._uU(18,"Unregister"),e.qZA()(),e.TgZ(19,"div",4)(20,"p"),e._uU(21),e.qZA(),e._UZ(22,"igo-spinner",5),e.qZA()()()),2&o&&(e.xp6(21),e.hij("Counter: ",i.counter,""))},dependencies:[me,de,S.lW,ff,Cr],styles:["[_nghost-%COMP%]   .sub-content[_ngcontent-%COMP%]{margin-top:12px}"]})}return n})()}]);let g3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[d3,pe,xs.forRoot(),Gs]})}return n})();const _l={production:!0,igo:{projections:[{code:"EPSG:32198",alias:"Quebec Lambert",def:"+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",extent:[-886251.0296,180252.9126,897177.3418,2106143.8139]}],auth:{tokenKey:"testIgo2Lib",intern:{enabled:!0},allowAnonymous:!0},interactiveTour:{tourInMobile:!0,activateInteractiveTour:!0},importExport:{url:"https://geoegl.msp.gouv.qc.ca/apis/ogre"},language:{prefix:"./locale/"},catalog:{sources:[{id:"Gououvert",title:"Gouvouvert",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi"},{id:"DefiningInfoFormat",title:"Defining info_format",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryFormat:{html:"*",json:["stations_meteoroutieres","histo_stations_meteoroutieres"]},queryHtmlTarget:"iframe",count:30},{id:"catalogwithregex",title:"Filtered catalog by regex",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",regFilters:["zpegt"]},{id:"catalogwithtooltipcontrol",title:"Controling tooltip format",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",tooltipType:no.ABSTRACT}]},searchSources:{storedqueriesreverse:{enabled:!1},nominatim:{enabled:!1},icherche:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",order:2,enabled:!0,params:{limit:"8"},showAdvancedSettings:!0},coordinatesreverse:{showInPointerSummary:!0},icherchereverse:{showInPointerSummary:!0,searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",order:3,enabled:!0},ilayer:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",order:4,enabled:!0,params:{limit:"5"}}}}},h3=ee.Bz.forChild([{path:"config",component:(()=>{class n{configService;configLanguage;constructor(t){this.configService=t,this.configLanguage=this.configService.getConfig("language")}static \u0275fac=function(o){return new(o||n)(e.Y36(N))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-config"]],decls:12,vars:3,consts:[["title","Config","subtitle","Core"],["title","Simple config","codeFolder","core/config","configFolder","environments"],[1,"mat-body-1"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"p"),e._uU(2,"Load config in your angular application"),e.qZA(),e.TgZ(3,"li"),e._uU(4,"Import "),e.TgZ(5,"code"),e._uU(6,"IgoConfigModule"),e.qZA(),e._uU(7," only once"),e.qZA(),e.TgZ(8,"app-example-viewer",1)(9,"p",2),e._uU(10),e.ALo(11,"json"),e.qZA()()()),2&o&&(e.xp6(10),e.hij("Config language: ",e.lcZ(11,1,i.configLanguage),""))},dependencies:[me,de,f.Ts]})}return n})()}]);let f3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[ws({default:_l.igo})],imports:[h3,pe,ir.forRoot()]})}return n})();const y3=ee.Bz.forChild([{path:"home",component:(()=>{class n{interactiveTourService;constructor(t){this.interactiveTourService=t}startTour(){this.interactiveTourService.startTour("global")}static \u0275fac=function(o){return new(o||n)(e.Y36(Us))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-home"]],decls:58,vars:0,consts:[[2,"text-align","center"],["id","igo-title"],["width","180","src","assets/igo2/core/logo.png",1,"igo-logo"],["tourToStart","global","menuIsOpen","true","styleButton","raised"],[1,"mat-body-1"],["target","_blank","rel","noopener","href","https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation"],["target","_blank","rel","noopener","href","https://angular.io/docs"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer")(1,"div",0)(2,"h1",1),e._uU(3,"Welcome to IGO"),e.qZA(),e._UZ(4,"img",2),e.qZA(),e.TgZ(5,"p"),e._UZ(6,"igo-interactive-tour",3),e.qZA(),e.TgZ(7,"p",4),e._uU(8," IGO2 library contains many components and services that may benefit any web application. "),e._UZ(9,"br"),e._uU(10," IGO2 library is open source project using Angular, Angular Material and OpenLayers. "),e.qZA(),e.TgZ(11,"h3"),e._uU(12,"IGO2 library is divided into several elements:"),e.qZA(),e.TgZ(13,"ul",4)(14,"li")(15,"b"),e._uU(16,"@igo2/utils"),e.qZA(),e._uU(17," : Basic utilies without dependency (ex: base64, clipboard, uuid) "),e.qZA(),e.TgZ(18,"li")(19,"b"),e._uU(20,"@igo2/core"),e.qZA(),e._uU(21," : Element affecting the core of the application (ex: config, language, message, media, request) "),e.qZA(),e.TgZ(22,"li")(23,"b"),e._uU(24,"@igo2/common"),e.qZA(),e._uU(25," : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table) "),e.qZA(),e.TgZ(26,"li")(27,"b"),e._uU(28,"@igo2/auth"),e.qZA(),e._uU(29," : Library grouping the authentication and security module "),e.qZA(),e.TgZ(30,"li")(31,"b"),e._uU(32,"@igo2/geo"),e.qZA(),e._uU(33," : Library containing the geomatic components. Depends on Openlayers. "),e.qZA(),e.TgZ(34,"li")(35,"b"),e._uU(36,"@igo2/context"),e.qZA(),e._uU(37," : Library of components uniting @igo2/geo and @igo2/auth "),e.qZA(),e.TgZ(38,"li")(39,"b"),e._uU(40,"@igo2/integration"),e.qZA(),e._uU(41," : Library integrate basic components"),e.qZA()(),e.TgZ(42,"h2"),e._uU(43,"Here are some links to help you start:"),e.qZA(),e.TgZ(44,"ul")(45,"li")(46,"h2")(47,"a",5),e._uU(48,"Installation"),e.qZA()()(),e.TgZ(49,"li")(50,"h2")(51,"a",6),e._uU(52,"Angular Documentation"),e.qZA()()()(),e.TgZ(53,"span",4),e._uU(54,"*** Modules in "),e.TgZ(55,"code"),e._uU(56,"@igo2/core"),e.qZA(),e._uU(57," must be imported only once"),e.qZA()())},dependencies:[Rc,de]})}return n})()}]);let b3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[y3,nm,pe]})}return n})();const C3=ee.Bz.forChild([{path:"language",component:(()=>{class n{languageService;app={title:"IGO"};constructor(t){this.languageService=t}changeLanguage(t){this.languageService.setLanguage(t),console.log(this.languageService)}static \u0275fac=function(o){return new(o||n)(e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-language"]],decls:21,vars:4,consts:[["title","Language","subtitle","Core"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale"],["codeFolder","core/language"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"m-t-12"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"p"),e._uU(2,"Translate your angular application"),e.qZA(),e.TgZ(3,"li"),e._uU(4,"Import "),e.TgZ(5,"code"),e._uU(6,"IgoLanguageModule"),e.qZA(),e._uU(7," only once"),e.qZA(),e.TgZ(8,"li"),e._uU(9," Configure the "),e.TgZ(10,"a",1),e._uU(11,"locale files"),e.qZA()(),e.TgZ(12,"app-example-viewer",2)(13,"div",3)(14,"button",4),e.NdJ("click",function(){return i.changeLanguage("en")}),e._uU(15,"English"),e.qZA(),e.TgZ(16,"button",4),e.NdJ("click",function(){return i.changeLanguage("fr")}),e._uU(17,"Fran\xe7ais"),e.qZA()(),e.TgZ(18,"div",5),e._uU(19),e.ALo(20,"translate"),e.qZA()()()),2&o&&(e.xp6(19),e.hij(" ",e.xi3(20,1,"welcome",i.app)," "))},dependencies:[me,de,S.lW,O.X$]})}return n})()}]);let x3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[C3,pe,re.forRoot()]})}return n})();const w3=ee.Bz.forChild([{path:"media",component:(()=>{class n{mediaService;constructor(t){this.mediaService=t}get media(){return this.mediaService.getMedia()}get orientation(){return this.mediaService.getOrientation()}get isTouchScreen(){return this.mediaService.isTouchScreen()}static \u0275fac=function(o){return new(o||n)(e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-media"]],decls:10,vars:3,consts:[["title","Media","subtitle","Core"],["codeFolder","core/media"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"p"),e._uU(2,"Detect type of media (mobile, tablet, desktop)"),e.qZA(),e.TgZ(3,"app-example-viewer",1)(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.qZA(),e.TgZ(8,"p"),e._uU(9),e.qZA()()()),2&o&&(e.xp6(5),e.hij("Current media: ",i.media,""),e.xp6(2),e.hij("Current orientation: ",i.orientation,""),e.xp6(2),e.hij(" Device mode: ",i.isTouchScreen?"Touch device":"Not a touch device "," "))},dependencies:[me,de]})}return n})()}]);let T3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[w3,pe]})}return n})();const O3=ee.Bz.forChild([{path:"message",component:(()=>{class n{messageService;constructor(t){this.messageService=t}success(){this.messageService.success("Congratulations","Success")}info(){this.messageService.info("Welcome to IGO","Info")}alert(){this.messageService.alert("Warning","Alert")}error(){this.messageService.error("There is a bug","Error")}static \u0275fac=function(o){return new(o||n)(e.Y36(_e))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-message"]],decls:20,vars:0,consts:[["title","Message","subtitle","Core"],["codeFolder","core/message"],[1,"d-flex","m-t-16","actions-container"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"p"),e._uU(2,"Show message to user."),e.qZA(),e.TgZ(3,"li"),e._uU(4,"Import "),e.TgZ(5,"code"),e._uU(6,"IgoMessageModule"),e.qZA(),e._uU(7," only once"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Dependencies: BrowserAnimationsModule"),e.qZA(),e.TgZ(10,"app-example-viewer",1)(11,"div",2)(12,"button",3),e.NdJ("click",function(){return i.success()}),e._uU(13,"Success message"),e.qZA(),e.TgZ(14,"button",4),e.NdJ("click",function(){return i.info()}),e._uU(15," Info message "),e.qZA(),e.TgZ(16,"button",5),e.NdJ("click",function(){return i.alert()}),e._uU(17," Alert message "),e.qZA(),e.TgZ(18,"button",6),e.NdJ("click",function(){return i.error()}),e._uU(19," Error message "),e.qZA()()()())},dependencies:[me,de,S.lW]})}return n})()}]);let A3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[O3,pe,Po.forRoot()]})}return n})();const M3=ee.Bz.forChild([{path:"request",component:(()=>{class n{http;languageService;constructor(t,o){this.http=t,this.languageService=o}callHttp(){this.http.get("https://geoegl.msp.gouv.qc.ca/apis/icherche/info").subscribe(o=>{console.log(o)})}callHttpError(){this.http.get("404").subscribe(o=>{console.log(o)})}static \u0275fac=function(o){return new(o||n)(e.Y36($.eN),e.Y36(L))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-request"]],decls:21,vars:0,consts:[["title","Request","subtitle","Core"],["codeFolder","core/core"],[1,"actions-container"],["mat-raised-button","",3,"click"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"p"),e._uU(2,"Register http calls in console"),e.qZA(),e.TgZ(3,"li"),e._uU(4," Import "),e.TgZ(5,"code"),e._uU(6,"IgoLoggingModule"),e.qZA(),e._uU(7," only if you want register http calls in console "),e.qZA(),e.TgZ(8,"li"),e._uU(9," Import "),e.TgZ(10,"code"),e._uU(11,"IgoErrorModule"),e.qZA(),e._uU(12," only if you want register errors from http call in console "),e.qZA(),e.TgZ(13,"li"),e._uU(14,"Import modules only once"),e.qZA(),e.TgZ(15,"app-example-viewer",1)(16,"div",2)(17,"button",3),e.NdJ("click",function(){return i.callHttp()}),e._uU(18,"Log"),e.qZA(),e.TgZ(19,"button",3),e.NdJ("click",function(){return i.callHttpError()}),e._uU(20,"Error"),e.qZA()()()())},dependencies:[me,de,S.lW]})}return n})()}]);let I3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[M3,pe,$.JF,re.forRoot(),Ts.forRoot()]})}return n})();const Z3=function(){return["ConfigService","LanguageService"]},k3=ee.Bz.forChild([{path:"catalog",component:(()=>{class n{configService;languageService;layerService;catalogService;storageService;mapService;catalog;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};catalogStore=new xt([]);catalogItemStore=new xt([]);constructor(t,o,i,s,a,l){this.configService=t,this.languageService=o,this.layerService=i,this.catalogService=s,this.storageService=a,this.mapService=l}ngOnInit(){this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(t=>this.map.addLayer(t)),this.loadCatalogs(),this.mapService.setMap(this.map),this.catalogStore.stateView.firstBy$(t=>!0===t.state.selected).subscribe(t=>{t&&t.entity&&(this.catalog=t.entity)})}onCatalogSelectChange(t){this.loadCatalogItems(t.catalog)}loadCatalogs(){this.catalogService.loadCatalogs().subscribe(t=>{this.catalogStore.clear(),this.catalogStore.load(t.concat(this.storageService.get("addedCatalogs")||[]))})}loadCatalogItems(t){this.catalogService.loadCatalogItems(t).subscribe(o=>{this.catalogItemStore.clear(),this.catalogItemStore.load(o)})}static \u0275fac=function(o){return new(o||n)(e.Y36(N),e.Y36(L),e.Y36(Se),e.Y36(Dn),e.Y36(oe),e.Y36(Gt))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-catalog"]],decls:8,vars:9,consts:[["title","Catalog","subtitle","Geo",3,"dependencies"],["codeFolder","geo/catalog"],[3,"map","view"],["color","primary",3,"map"],["title","Catalog Library"],[3,"store","catalogSelectChange"],["title","Catalog Browser"],[3,"catalog","store","map"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3),e.qZA(),e.TgZ(4,"igo-panel",4)(5,"igo-catalog-library",5),e.NdJ("catalogSelectChange",function(a){return i.onCatalogSelectChange(a)}),e.qZA()(),e.TgZ(6,"igo-panel",6),e._UZ(7,"igo-catalog-browser",7),e.qZA()()()),2&o&&(e.Q6J("dependencies",e.DdM(8,Z3)),e.xp6(2),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(2),e.Q6J("store",i.catalogStore),e.xp6(2),e.Q6J("catalog",i.catalog)("store",i.catalogItemStore)("map",i.map))},dependencies:[me,de,Ht,Le,lt,wa,Ta],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return n})()}]);let $3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[ws({default:_l.igo})],imports:[pe,k3,ir,It,at,Av]})}return n})();const D3=function(){return["LanguageService"]},R3=ee.Bz.forChild([{path:"directions",component:(()=>{class n{projectionService;languageService;layerService;mapService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9,geolocate:!1};stopsStore=new Yp([]);stopsFeatureStore=new Hp([],{map:this.map});stepFeatureStore=new zp([],{map:this.map});routesFeatureStore=new Vp([],{map:this.map});zoomToActiveRoute$=new fe.x;constructor(t,o,i,s){this.projectionService=t,this.languageService=o,this.layerService=i,this.mapService=s,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(a=>this.map.addLayer(a))}static \u0275fac=function(o){return new(o||n)(e.Y36(On),e.Y36(L),e.Y36(Se),e.Y36(Gt))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-directions"]],decls:12,vars:14,consts:[["title","Directions","subtitle","Geo",3,"dependencies"],["codeFolder","geo/directions"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100",3,"stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4)(6,"igo-geolocate-button",4)(7,"igo-home-extent-button",4)(8,"igo-rotation-button",5),e.qZA()(),e.TgZ(9,"mat-grid-tile")(10,"div",6),e._UZ(11,"igo-directions",7),e.qZA()()()()()),2&o&&(e.Q6J("dependencies",e.DdM(13,D3)),e.xp6(4),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map)("showIfNoRotation",!1),e.xp6(3),e.Q6J("stopsStore",i.stopsStore)("stopsFeatureStore",i.stopsFeatureStore)("stepFeatureStore",i.stepFeatureStore)("routesFeatureStore",i.routesFeatureStore)("zoomToActiveRoute$",i.zoomToActiveRoute$))},dependencies:[me,de,Ct.Il,Ct.DX,Le,lt,zn,Kn,Wn,Kp]})}return n})()}]);let N3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[NT()],imports:[R3,pe,Po,at,Iv]})}return n})();const B3=function(){return["LanguageService"]},U3=ee.Bz.forChild([{path:"draw",component:(()=>{class n{languageService;dataSourceService;layerService;mapService;map=new Xe({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};stores=[];constructor(t,o,i,s){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.mapService=s,this.mapService.setMap(this.map),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:a}))})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se),e.Y36(Gt))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-draw"]],decls:5,vars:7,consts:[["title","Draw","subtitle","Geo",3,"dependencies"],["codeFolder","geo/draw"],[3,"map","view"],["color","primary",3,"map"],[3,"stores","map"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3),e.qZA(),e._UZ(4,"igo-draw",4),e.qZA()()),2&o&&(e.Q6J("dependencies",e.DdM(6,B3)),e.xp6(2),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("stores",i.stores)("map",i.map))},dependencies:[me,de,Le,lt,Mp],styles:["[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return n})()}]);let G3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[U3,pe,at,Zv]})}return n})();const j3=ee.Bz.forChild([{path:"feature",component:(()=>{class n{languageService;dataSourceService;layerService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};tableTemplate={selection:!0,selectMany:!0,sort:!0,columns:[{name:"properties.id",title:"ID"},{name:"properties.name",title:"Name"},{name:"properties.description",title:"Description"}]};store=new yt([],{map:this.map});constructor(t,o,i){this.languageService=t,this.dataSourceService=o,this.layerService=i}ngOnInit(){const t=new qt({});this.store.addStrategy(t);const o=new Tt({map:this.map,motion:Y.Default});this.store.addStrategy(o),this.store.load([{meta:{id:1},type:"Feature",geometry:{type:"Point",coordinates:[-72,47.8]},projection:"EPSG:4326",properties:{id:1,name:"Name 1",description:"Description 1"}},{meta:{id:4},type:"Feature",geometry:{type:"Point",coordinates:[-71,46.8]},projection:"EPSG:4326",properties:{id:4,name:"Name 4",description:"Description 4"}},{meta:{id:5},type:"Feature",geometry:{type:"Point",coordinates:[-73,45.8]},projection:"EPSG:4326",properties:{id:5,name:"Name 5",description:"Description 5"}},{meta:{id:2},type:"Feature",geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]},projection:"EPSG:4326",properties:{id:2,name:"Name 2",description:"Description 2"}},{meta:{id:3},type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]},projection:"EPSG:4326",properties:{id:3,name:"Name 3",description:"Description 3"}}]),this.layerService.createAsyncLayer({title:"MVT test",visible:!0,sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}}).subscribe(i=>this.map.addLayer(i)),this.dataSourceService.createAsyncDataSource({type:"vector"}).subscribe(i=>{const s=this.layerService.createLayer({title:"Vector Layer",source:i,animation:{duration:2e3},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-feature.json",source:"source_nameX"}}});this.map.addLayer(s),this.store.bindLayer(s),t.activate(),o.activate()})}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-feature"]],decls:5,vars:5,consts:[["title","Overlay","subtitle","Feature"],["codeFolder","geo/feature"],[3,"map","view"],["color","primary",3,"map"],[3,"store","template"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3),e.qZA(),e._UZ(4,"igo-entity-table",4),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("store",i.store)("template",i.tableTemplate))},dependencies:[me,de,Si,Le,lt],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return n})()}]);let Q3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,j3,It,gn,at,Ii]})}return n})();function Y3(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-form",6),e.NdJ("submitForm",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onSubmit(i))}),e.ALo(1,"async"),e._UZ(2,"igo-form-group",7),e.TgZ(3,"div",8)(4,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.fillForm())}),e._uU(5," Fill Form "),e.qZA(),e.TgZ(6,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.clearForm())}),e._uU(7," Clear Form "),e.qZA(),e.TgZ(8,"button",10),e._uU(9," Submit "),e.qZA()()()}if(2&n){const t=r.ngIf,o=e.oxw();e.Q6J("form",t)("formData",e.lcZ(1,4,o.data$)),e.xp6(2),e.Q6J("group",t.groups[0]),e.xp6(6),e.Q6J("disabled",o.submitDisabled)}}const V3=ee.Bz.forChild([{path:"geometry",component:(()=>{class n{languageService;formService;dataSourceService;layerService;map=new Xe({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:15};form$=new y.X(void 0);data$=new y.X(void 0);submitDisabled=!0;valueChanges$$;constructor(t,o,i,s){this.languageService=t,this.formService=o,this.dataSourceService=i,this.layerService=s}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))});const o=[{name:"geometry",title:"Geometry",options:{validator:_.kI.required},type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!0,drawGuide:50,drawGuidePlaceholder:"Draw Guide",drawStyle:new J.ZP({stroke:new U.Z({color:[255,0,0,1],width:2}),fill:new q.Z({color:[255,0,0,.2]}),image:new Te.Z({radius:8,stroke:new U.Z({color:[255,0,0,1]}),fill:new q.Z({color:[255,0,0,.2]})})})}},{name:"name",title:"Name",options:{validator:_.kI.required}}].map(s=>this.formService.field(s)),i=this.formService.form([],[this.formService.group({name:"info"},o)]);this.valueChanges$$=i.control.valueChanges.subscribe(()=>{this.submitDisabled=!i.control.valid}),this.form$.next(i)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({name:"Place",geometry:JSON.stringify({type:"Polygon",coordinates:[[[-106,42],[-107,31],[-81,32],[-82,42],[-106,42]]]})})}clearForm(){this.form$.value.control.reset()}onSubmit(t){alert(JSON.stringify(t))}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(Rs),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-geometry"]],decls:7,vars:6,consts:[["title","Geometry Form","subtitle","Geo"],["codeFolder","geo/geometry"],[1,"container"],[3,"map","view"],["color","primary",3,"map"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"div",2)(3,"igo-map-browser",3),e._UZ(4,"igo-zoom-button",4),e.qZA(),e.YNc(5,Y3,10,6,"igo-form",5),e.ALo(6,"async"),e.qZA()()()),2&o&&(e.xp6(3),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,4,i.form$)))},dependencies:[f.O5,me,de,S.lW,Dc,Zc,Le,lt,f.Ov],styles:["[_nghost-%COMP%]   pre[_ngcontent-%COMP%], [_nghost-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace,monospace}[_nghost-%COMP%]   pre[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{flex:1;height:500px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;gap:16px}"]})}return n})()}]);let z3=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,V3,dn,Vu,at]})}return n})();const K3=function(){return["LanguageService"]},X3=ee.Bz.forChild([{path:"hover",component:(()=>{class n{languageService;dataSourceService;layerService;mediaService;selected;pointerCoord;pointerCoordDelay=0;pointerHoverFeatureDelay=0;map=new Xe({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:8,projection:"EPSG:3857"};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(t,o,i,s){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.mediaService=s,this.dataSourceService.createAsyncDataSource({type:"wmts",url:"https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts",layer:"carte_gouv_qc_public",matrixSet:"EPSG_3857",version:"1.3.0"}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"Quebec",visible:!0,baseLayer:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"adn_bassin_n1_public_v",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"3.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (polygon)",visible:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{featureTypes:"MSP_CASERNE_PUBLIC",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (point)",visible:!0,source:c,igoStyle:{styleByAttribute:{attribute:"en_caserne",data:["true","false"],stroke:["red","blue"],fill:["#ffffff","#ffffff"],radius:[7,7],width:[2,2]},hoverStyle:{label:{attribute:"Caserne: ${no_caserne}\xa0\n Mun: ${nom_ssi}",style:{textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:20,offsetY:10,padding:[2.5,2.5,2.5,2.5]}},baseStyle:{circle:{stroke:{color:"orange",width:5},width:[5],radius:15}}}}}))})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se),e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-hover"]],decls:7,vars:11,consts:[["title","Hover","subtitle","Geo",3,"dependencies"],["codeFolder","geo/hover"],["igoHoverFeature","",3,"map","view","igoHoverFeatureDelay","igoHoverFeatureEnabled"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3)(4,"igo-geolocate-button",3)(5,"igo-home-extent-button",3)(6,"igo-rotation-button",4),e.qZA()()()),2&o&&(e.Q6J("dependencies",e.DdM(10,K3)),e.xp6(2),e.Q6J("map",i.map)("view",i.view)("igoHoverFeatureDelay",i.pointerHoverFeatureDelay)("igoHoverFeatureEnabled",!0),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map)("showIfNoRotation",!0))},dependencies:[me,de,Le,lt,zn,Kn,Wn,Ny],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:500px}"]})}return n})()}]);let eO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,X3,at]})}return n})();const tO=function(){return["LanguageService"]},iO=ee.Bz.forChild([{path:"import-export",component:(()=>{class n{languageService;layerService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9};store=new Jc([]);constructor(t,o){this.languageService=t,this.layerService=o,this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(i=>this.map.addLayer(i))}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-import-export"]],decls:9,vars:7,consts:[["title","Import / Export","subtitle","Geo",3,"dependencies"],["codeFolder","geo/import-export"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],[1,"w-100",3,"store","map"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4),e.qZA()(),e.TgZ(6,"mat-grid-tile")(7,"div",5),e._UZ(8,"igo-import-export",6),e.qZA()()()()()),2&o&&(e.Q6J("dependencies",e.DdM(6,tO)),e.xp6(4),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(3),e.Q6J("store",i.store)("map",i.map))},dependencies:[me,de,Ct.Il,Ct.DX,Le,lt,Dp]})}return n})()}]);let nO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[xp({path:"./assets/import-style.json"})],imports:[iO,pe,Po,at,rS,Cx]})}return n})();function rO(n,r){if(1&n&&e._UZ(0,"igo-metadata-button",9)(1,"igo-download-button",9)(2,"igo-ogc-filter-button",10)(3,"igo-time-filter-button",10)(4,"igo-track-feature-button",11),2&n){const t=r.layer;e.Q6J("layer",t),e.xp6(1),e.Q6J("layer",t),e.xp6(1),e.Q6J("header",!0)("layer",t),e.xp6(1),e.Q6J("header",!0)("layer",t),e.xp6(1),e.Q6J("layer",t)("trackFeature",!0)}}const sO=function(){return["LanguageService"]},lO=ee.Bz.forChild([{path:"layer",component:(()=>{class n{languageService;dataSourceService;layerService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],maxLayerZoomExtent:[-11e6,45e5,-45e5,1e7],zoom:7};constructor(t,o,i){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!1,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"}}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS ",visible:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson_utf8",srsName:"EPSG:32198",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!1,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"12072"}},formatOptions:{dataProjection:"EPSG:32198"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (Custom EPSG)",visible:!0,source:c,removable:!1}))}),this.layerService.createAsyncLayer({sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"parc_routier",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"lieu habit\xe9",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"sh_dis_eco",visible:!1,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"nurc:Arc_Sample_Parent",visible:!1,legendOptions:{display:!0,stylesAvailable:[{name:"rain",title:"Pluie"},{name:"raster",title:"D\xe9faut"}]},sourceOptions:{type:"wms",url:"https://demo.geo-solutions.it/geoserver/ows",optionsFromCapabilities:!0,params:{LAYERS:"nurc:Arc_Sample",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"Avertissements routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle",source:c,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-layer"]],decls:12,vars:9,consts:[["title","Layer","subtitle","Geo",3,"dependencies"],["codeFolder","geo/layer"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],["floatLabel","never",3,"map","layers","expandLegendOfVisibleLayers","queryBadge"],["igoLayerItemToolbar",""],[3,"layer"],[3,"header","layer"],[3,"layer","trackFeature"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4),e.qZA()(),e.TgZ(6,"mat-grid-tile")(7,"div",5)(8,"igo-panel",6)(9,"igo-layer-list",7),e.YNc(10,rO,5,8,"ng-template",null,8,e.W1O),e.qZA()()()()()()()),2&o&&(e.Q6J("dependencies",e.DdM(8,sO)),e.xp6(4),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(4),e.Q6J("map",i.map)("layers",i.map.layers)("expandLegendOfVisibleLayers",!1)("queryBadge",!0))},dependencies:[me,de,Ct.Il,Ct.DX,Ht,Le,lt,Mi,Hr,Yn,Nn,Xi,gS]})}return n})()}]);let cO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,lO,Et.QW,S.ot,w.Ps,It,at,kn,nn,$n,Yu]})}return n})();const uO=function(){return["LanguageService"]},dO=ee.Bz.forChild([{path:"legend",component:(()=>{class n{languageService;dataSourceService;layerService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(t,o,i){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:l}))}),this.layerService.createAsyncLayer({title:"legend with display:false",visible:!0,legendOptions:{display:!1,html:"test html"},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"legend in html",visible:!0,legendOptions:{display:!0,html:'<h2 style="background-color: blue;">HTML l\xe9gende</h2>'},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!1,params:{LAYERS:"sh_sreg_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"legend with url param",visible:!0,legendOptions:{url:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEhUQEBISFRUVFRAQFRUQFRUVFRAPFRUWFhUVFRUYHSggGBolGxUVITEiJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGy0dHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAACAQMEBQYAB//EADwQAAIBAwEGAwYFAgUEAwAAAAECAAMEESEFEjFBUWETInEGFDKBkaFCscHR8FJyFSNTYoIzQ5LxFqLh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJREBAQACAgEFAAEFAAAAAAAAAAECERIhAwQTMUFRYRQiI3Gh/9oADAMBAAIRAxEAPwB0QhAEMTFQhCEEQhACEIQRFEYEIQgiEIAU6IIsAWLEnQAp0KmBqSdFBY+g5D1OBGD4nxYBHQafQzLPzTDLVbYeHLObh2LARwwyD+4PQiFNJZZuMrLLqlnRJ0ZFiTp0A6KEOM4OITuF8q4L8ydVp9sc2+0atrlw/hVGLBw2MnO66gsMdBpjHeYZeoxmXGOjH0+Vx5UsSLEm7ndEM6IYAhgmEYJgCGCYRgmIBMEwjAJgAmAYRgkwAGjTxxjGniBipGo5UjcAthCEAGEIwMQhAEIGAHFEERcxgYiiBmEDADzFgAxcwA50HMXMANh5H/tA+rrJhXy8JDXJDAcSpx6jB/SE18u6uuhGnqeU4vPP8m7+PR9N34tT9V20FZD4ifMcmHSSra5V1DKdD9Qeh7yLd1d4HAOJm7W9q27NlWKE55cOozzleLLTPz4b7bPM7MrbXbC1AFRQGb4d84OemP17Rk7YYsUREJUn8XxhfjI7gzp5xyXGrjMj3l5uYVfjYeX/AGrzb15D5mRau0N0Bt3e3uAVhoO56ympms1Z6lTtgaaDHAdgBiZZ+Tc1G3i8fe60FsN0AZ1iLUzXpDTRifqpHGVh2ioGMP8AIQtm3G9WUdmbX+04nNw3Y7+Wsb/peRJ0Qz0HkOMQzokQcTBM4xCYBxgGKTBJgCEwTFJgEwBCYBMUmCTABaMvHGMacxGZeNw3jUCWwMIGNAwgYwdBhAxoGEDAHAYQMbBigwBzMIGNAwgYA4DFzGwYWYwPMXMbzCBgD1PjxxylRUuEpv4J0PDXPx9BLNDrI17bMtd2PmVgrNngHwNdZzeeTqur02dm4RquAWK4A111yOxme2tXZicaAcuZGf3/ADl7UrFtRwA68x69jM/eVGffZcBkyxA0bdAGZHjna/Jl0pKdJmuFUN8A3ufyA+UGz3jVABIOWBOez5z05fWSrxs0qV2g1DbrY/pJAx35H6yMoxWDjhq2Ou8Dp/5GdDmBYsy7yF87rnGpx/NZfWd4yrg65JGeJHM6SjpjcthUK+apUI7glifyMnUKhV9zPH4vpjT7yMpteF0tL6qwAK6j0zr6x72YY1HLlQNwNnHMnQfrIyVAujHThx0lt7MhQKqjj5W/46iRjO42zyvG6XGYhMSJmdLjdmITOJgkwBSYJMQmITAOJgkziYJMA4mATOJgEwDiYBM4mATAOYxpzCJjTGIG3MbzFcwMwCzBhAxpQekPdPSPVLcOAwgYzgxd6GjPAwsxkNFDQB7MUNGhnpDCGPVLcOAxQY3unpFzA9nQYoMaBhAxBO2bS3qijvk+g1kXbFVqlY0qWAB56jHn0EnbPfw1ZzngeExu3L2qRu0iVNVtWGclQPyyZz+T+7LTfx9Y7XdfaNvRQh2ydFAXBJY6AADhrjjMlW2jRSqCyVFLb2vlO8uobKjQj9oT2lMUmpHILbp8TGSHU6b2OIzIVwtVt1moFmUEK9IhlI7a9esMJB5Ll9L1dnqLUCk29TJJ05KSfuAT9BK/w/PpodBwGdOGny9NInsrfstSpQq+UMDuqdd0jj+hkg4Fbf5Zzj7Qm5bKq9yWHLq1QUEeqd1UffAxx5LpzPDSU9G/pl2dKTnd0YlgCfly4R72huHqV6dKjhgi4wdBvEfY6SOthUGfFZKYbG8KZLVHA5Y5SsZNdoz3vpate0agXdyuQG3X4gH85P8AZ2p4dfdfmCgP+08P0lNcW3jDK090IMIc6jHAd47sWuxanv8AEFR8wZOuul7beoMEiBmFVyTnrGjmdHbmKTBJiZnYgCExCYpWAYg4mAWiEwC0AItAJiFoBaAKTAJiFoJMA5jGnMJjG2gDTmDmKwMHBhomsFsI4trLJLaP07aepxjjtqmNn2jbWA6TRi1gNbCK4Y0TLJnvch0hrZdpc+COkcShJ4YnyyVVOzjwtO0tVoiOCkJWoXalNnANl2l74U4UIaxPtRe59oq2faXvgTnTAJ0+gkZSKm2M9pK2F8NSQeOnT9pQJbFqbVq9ZRpujGm4O2ect/amoynLZ3dfh00PUzMW9AK2uMH4S3mHbAPOeLbvderJrUO+IHXcRqjqOBekx9QGUg4+RjKW1VGyhK9cAjP/ABM0lihGFqPT64Ua/wD1kza9gXVGViMHOFpv59eBMmZ96O4xjaNBxVNTdw7ndXPEA8TIj3JBPE68wdZtKeyvGTB31ZSSrqGTB5EZOT85namyqu97rk+Lx8TAx4e98Weu7p1zNMcti46VtrSZnFRR5hkH04D6ayStlU1YAknJydSPU/WaB9jigoCbxYnLMys28Txzidsy2KKcsxzyKFQO2WzFzK4M8XXIR9/e0KsWA83TdXQQrOo6VlBXy7+8OfHiJZ7QsS2rboA1UhRnI4a6SHswO9dd4g6jkVOnYiPG7icpp6LTtwVB7RDajpBt78DRvvH/AH1ZvPPYxvilR/dlne7iSPGUwHdYf1U/C9j+TDWwgGzzHGrATkuR1mmPqML8xN8GU+Ki1LDtGv8ADzLujWUyQKAM6Zhhe3PblOmaNlBNjNT7oOkZqW4j9vEuVZr3CC1oJoDbxipZw4Q+VULUBGzb9polsIZsBF7cHJmPdD0ie5zTe4RPcu0qeKJudaJbacaMaW9ne9TH3m3tnRTMUWxMKjWllQIMfvUe3FctnFNsZdLTE40BF7lPhFL7tE92ls9CR3oGL3aOEREoR8W8NaZEdEPdo4REa2kPaFLdQky33pA2yM0mHaTl5bqqmE2yF8ErJgg4xxI4ntnjMc9N0yppgINTUYjyjkWc8PQYlvR2luVGSrndUgZ6k8FH3k7aNrTqqoqaLxWmuSSepxr+vpPPn8uxmLFwrb9Niyg6u5O4D0A+Jzrw9Jq7C/p1BuFjjucHeHHOD3GnLnrpMnteg4ICEBVyCyjSmnMKvXlnnnAwDqxb3wUhcYxhDg5wF1K/fB6lm7StS9lu/bf+5Mo8gU548vrxMpG2NW8fxd8cMbpXQjP1kKx2zcAZVsjjg8DrJr+0tXnTXPDOsXU+D+Vi1uxH+YFUDnnOR+kp9pbVpou4nDUZ46+n8/SQ7zaNWpjeY45gcBKa+vV1GBk/U6/nz/8AcJjunbqHql+w1NUlTwHEHtrofQiFb3qrh38nJQOHqU5fKV1FN3LvjH9J4N0P84QqVJqzg/g7jgOhmmmdu2pvr1t1cZ1Gc/hP04SGu2WQ7rR2nWVk3AVwowN7OCZn9s13yKemBqMYixm+itaVdtA8DJ9ttANznm4uWXnLSy2lgZzDLx/gmbZ3lbTIMrqN6d7GZWU9rqeJkb3vLgrFMP1VybaxdidJorJmHGUGwwzAEiX7XAAwY/H5ssPhOfjmS0R1Mbq0hK1nIGQY5bXe8NTOvH1Eyc98OkoUYnu8RLgR9amZtM2dxAtvOahJIEBjK5xPFEqUwJBeprJt3UAEzdzdeY6zPLzaOePbcps9e0L/AA4dJW09o1BxWSKe1+oM5OUdXE89liAodYX+KrOF6hj5wcTyXhHGODaYkZipgG3Uw5jinC/U84a3APOVhsl6wDa9GMXKjiuBVWGMGUPgVOTSXRFQcY5kNLTwRIm0LfyH0MEXbDiI1dbSBUiPotMNtawR8OOKZO7nAL/zny5a6jF3l/cU3L587ZHDRKY00HLJ4dh3mr2lvhjVpkFMtvr1A79ZE8ajcDBAD8xzHQZ+k5rdNpNswdsOiDxBlm1HLGuhx24/MSDUuVxvU9NBkdcgZ/naX+1dj7zDGCNEHYAfw/OUd7sKoDoDz4fQSsbiLMg0L9eRZTofLwJ5nEsVvSQMEHn007zPvs6qOXI4wOcdt7e4A3TqOGvDMu4xPKrK8r1GGE0zrK0lE1Ygtr9ZEqUq+8QoYZ5dPST9mbHz56p0HIx6khbtqRs62asByAz5Tkj+cZZ3VZKaGjTxvt9usgXF+f8Ap0RjGBnkO8C2UJlmbLccnv0zJ190966iws3VFwQGxqe31lZcMu8TjGekds7nVmYZz5cc4l5bEciM8MjEufKag3FvkZWQDvLLClX3TumSXtlaVtOlNTZidJodhW53gWjFCgqydZVSGzIzvS8Me29s75KaY5yBd7Wzw+0qQ5PGMuxBnJa6pjFqu1anDlJFLaeBrKRq2kAVsysUZRa0/aDdfBOk0uydso/AzynajkHIh7P2g9MhgSJ1Y7nbmuq9sN0McZWXe1FHEiZq22m1ZNG+kS22O1U5ZjD3h7azvdrKRoZlbi5JYnM1dD2YTmWPzjh2BRGm4PpJ7vdPUnw0NGgx+IYhtbCW7UpFqWy88iGhtULa68ZKS1XtHfcFJyHM6tZNyePUG3NZ9DGXsao+FozVsq/4XEVLW6/1F+kWv4Dmo3A6GMV2uRwUH5yZv3K8d0wm2qy/HSPy1ho0K2vao+ND8pY09rrzBHqIFLbFBtOB7x2rbpUGVIilB9b6mw4iQ7w02U4xwMYr7PbGglXWsXXJ1Eq5CRQ1qLGk3hnO4xGP9szW6lQgklH+IngSM66GW3+IFC6qMgtu4P4uWgme2xc+bygZGpI7Hh9dJGrs9xOb3mm3HfGOXEAc+8JNsgndIKnkCMcOEpBt5kwTjQa4568B9oR21Tc+dRoQo7aZOvpF7d+4rnPqr1LpSQB3PXGRgfpGGZs4ABGn01IP86SppIh1QkajTPLOknWTMjEE59f6c4+uknjpUy2kJqx0Hy5aZlZtO6GoB04a8AeklOzZYKJQ3jK2jNjtLwxRlkb97J8qDA4EnnOe4Pwrr8v3nF6IGCfl1hU95x/lKFX+o8Zqz2KgAmrnXiB0mh9/NWhlk0XTMzFeg40G8x68pK2O1Viafhs2RoADmFn2UokUE4IkqpSKiC9AqcEFSDqDxEnOuV1itVIrLepvHEuLeljUyBQoYOZNNWZZ1rhE4NOqtI9N51SpMuDbloDVI2z44Rlt5jhQT/aM/lJFLZF2w0oVPmMfnNJGWWSDdJvSFd6LiXjez17/AKLfMr+8hXexrofFRf5YP5TWVjew+z+0igmq2f7UAYXHGU+xvZhviqndHTnLC62Va6qr+YDkRmZZZY29LmOWu24ttpBlGCIFVWJ4mZT2c2dVQ5Z/T0mqLGLnvo+Om4DwWAPKMLCDTfbLTmtUPLEaOzRyJj2/6wg8Ogrq+yHPwuZCqbGuR8NQ/OX+8YYc9fyhqBl22Rd/6sae0vV/Eh9QZqKtZxwUn+3EHxcjJRvprFYcrJVEqf8AdoBu6a/Yxmnof8moyH+ipn9ZsPBzqAV9RKu+2dVbiiOv0Mjirki2ntCVIS4XHLe5H5y2uHpumQRqJm721qoMeE7pzUgkj+085SJfvRPlLGm3JshkPTBi3Z8nqX4RtpWtKmlR6jYPiNu4x5RMlV2Z4qnwgxUebI54zgA8M/vNPV2OtxVFWuc0qYyFzoWJzrJVrWp1AapA8FDu00XgzD8Rx3hy0VxYil7NVCm8FJAIAAGdSAePPlIdXZaqPMCOJJweWh/Oenrf1ar+HTUIAN9ieRI8oA689eEZuEWoDSuAjZ47vlA7b2fN8oTy/o4fjzZaCqcjTHCPVr8annqPUHj+8l7Z2HUouSgLodQVGcfIcJR1mA0PPryM11Kjek6zqkNkNnXnKe8phqrdznEstnWdWq2KSlsfTHrNLsj2URH8W4IJ4hAeJ7mFymI1az+yNg75B0A5F8y7q0UoEK64HBWOCra6AGLta7u97IUIg0AQ4wO3IwrfaAqLuVNQ2hBBAJ7f0kdpF3e1TU6NeDSqkKh3W6/hbtkcD2jaq1u281XXBwFVgQegbGD9Yxf7JqU8VKJ38fhPxYGvz/PSS6hS5okjRlBOD8SkcQecc/4VDWvKdUZyS3VskyOwPIymt3K1N09cazTWNMtooLHoNZVx0UyRKNJzyku12RVqHyAn0ms2T7Lu2GqkAdBrNTQtqNEYAGn84CRdLlrIbO9i3YDxHx2XUy+tfY61p6shc/7tf/yWr7RxooP/AIn8sSK+0UY+YVVPZTg/XSLo7s74NOmMU6aL6LGffQ3lzg+kYN1RByXYf8WB9eOPtHqN5bVPxjPDJGDJCsudpVkbcYadeokG6vqg83FTx04TV07ZOJdHXln9JL8OnjAVT2wBCSj4YY12chcZzoMSds72NtUqeNVyznXU6D5cJqVorn/poMcMYMSuBzXP7R446K3Y1taOBhRpwkKvbrn4BCNUE+Rs9uYjqk8xH0O04Oen3hmQaVxHQ8pKauOs7HeRd4wlJ6wCSSP/AFBL9MxsRcmAPo/Uzt8dzGgIYWMONbtAas3yhPpIdZzHsaSTV7/eMXNJXGHVWHRgD+cbWqOAEcCdY52FTfbCouhRVZAcE+G3T1z9pSXexqlNadOnh0Vt473kxrkZHMCbMiRquDpJuMPahegtOmFGMsxZyPxdsyjvL2lTfKrvMRrnXHp0mpvLEOMA4lDtL2WqMd5GGnUcfpMbhdtJlNKOl7TVN4gBR2lXdWdC8rA1PIx0O7oGMXbOzqlFt90I5EjUGVlglZ6quadUIuSCqnX7TTDH7ic7GztLBLVXRMKgAJJ1Zmmd2rdMy75JGuF5GOUPfXfd3SygkgucEjlkTrzYl61QOyAqOQPOTwvLsTKadTu2NMipwA4HnGNneEy7yjUHjnOnTEtP/itzVQhmCZ+ZxFs/YitSXcVxgnU45RzHorlNoV9cimA3MlcfvHqQtCQ7O9NyDnChlIP9XD85p7T2ctwAKi75HNjmHfez1vU0A3ca+XT6yuPSeW2HX2cUtvU7iiykg+clGHyOn3m02PbW9BQDUTqSGBLH5cpW3fskRqnm7DQ/aV52Qy6MHHqTC205I2F17UUlG7SBbvwEz9z7Q12/Hx5KMYjVts4D8DH6mFb7IqbxCocciREfR+32rWHmZyf1k239oXPHQyPU2DXOuAOgzGDs9wQCsCae020rDDYj1SiG1plfRgCJkLi2qLjcU9TLjZVZ9CYocy0sjQdf+zSz/tHGLb+Lzor8s/vJi3MJLnJ0jvRy7O0Cw/CAPU/vHDUx3iUzn4sQXccBHpBqqik7w0PUfr1jxRzqpGO/WNEQPFxwMVitomHzHkqHrEnQkI5TrmOi4nTpRDW5jouDOnRmIV2jq3ESdFQJ68YJJnToASkLqZFr7S1wonTobBErMRrG3M6dEAKxkynV0nTowi3Qpt8QBi0FpcAonToEbr2VPO9gQhTUjAnTpROWniGyTp0ZK+uwBgb/AEE6dIqofpEwy4X4hn1nToqccbxQMhRH7a7zyAnToYlXVq0ZVA3ETp0mnB1LVcaxilQXOAIk6HxSSjSAEra+8moiTppZuJnRy3vAeJklWXOQZ06R8KO+IesBlnTo7Q//2Q=="},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_reg_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!0,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"}}}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"WFS ",visible:!0,source:l}))}),this.layerService.createAsyncLayer({title:"Commission scolaire anglophone",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{LAYERS:"WMS_MEQ_CS_ANGLO",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"lieu habit\xe9",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"Avertissements routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle",visible:!0,source:l,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-legend"]],decls:6,vars:10,consts:[["title","Simple Map with a legend list","subtitle","Geo",3,"dependencies"],["codeFolder","geo/legend"],[3,"map","view"],["color","primary",3,"map"],["title","Legends"],[3,"layers","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3),e.qZA(),e.TgZ(4,"igo-panel",4),e._UZ(5,"igo-layer-legend-list",5),e.qZA()()()),2&o&&(e.Q6J("dependencies",e.DdM(9,uO)),e.xp6(2),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(2),e.Q6J("layers",i.map.layers)("excludeBaseLayers",!0)("allowShowAllLegends",!0)("updateLegendOnResolutionChange",!1)("showAllLegendsValue",!1))},dependencies:[me,de,Ht,Le,lt,Zn],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return n})()}]);let gO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,dO,Et.QW,S.ot,w.Ps,It,at,kn,nn,$n,Yu]})}return n})();const mO=function(){return["LanguageService"]},fO=ee.Bz.forChild([{path:"measure",component:(()=>{class n{languageService;dataSourceService;layerService;map=new Xe({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};store=new yt([],{map:this.map});constructor(t,o,i){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-measure"]],decls:5,vars:7,consts:[["title","Measure","subtitle","Geo",3,"dependencies"],["codeFolder","geo/measure"],[3,"map","view"],["color","primary",3,"map"],[3,"store","map"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3),e.qZA(),e._UZ(4,"igo-measurer",4),e.qZA()()),2&o&&(e.Q6J("dependencies",e.DdM(6,mO)),e.xp6(2),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("store",i.store)("map",i.map))},dependencies:[me,de,Le,lt,Ea],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-measurer[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]})}return n})()}]);let _O=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[fO,pe,at,kx]})}return n})();const yO=function(){return["LanguageService"]},vO=ee.Bz.forChild([{path:"ogc-filter",component:(()=>{class n{languageService;dataSourceService;layerService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(t,o,i){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:m}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"code_municipalite",alias:"# de la municipalit\xe9e"},{name:"date_observation",excludeFromOgcFilters:!0},{name:"urgence",values:["imm\xe9diate","inconnue"]}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:ot.All,filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"},{operator:"Intersects",geometryName:"the_geom",wkt_geometry:"MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))"}]}}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (PropertyIsEqualTo OR Intersects)",source:m,style:new J.ZP({image:new Te.Z({radius:5,fill:new q.Z({color:"white"}),stroke:new U.Z({color:"orange",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:ot.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-21T00:00:00-05:00",end:"2016-01-26T00:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-10T00:00:00-05:00",stepDate:"P2D"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P2D)",id:"1",source:m,style:new J.ZP({image:new Te.Z({radius:5,fill:new q.Z({color:"white"}),stroke:new U.Z({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:ot.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T04:00:00-05:00",end:"2016-01-12T16:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-14T20:00:00-05:00",stepDate:"PT4H"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: PT4H)",id:"2",source:m,style:new J.ZP({image:new Te.Z({radius:5,fill:new q.Z({color:"white"}),stroke:new U.Z({color:"blue",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:ot.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T00:00:00-05:00",end:"2016-03-31T00:00:00-05:00",displayFormat:"MMMM"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2018-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P1M)",id:"3",source:m,style:new J.ZP({image:new Te.Z({radius:5,fill:new q.Z({color:"white"}),stroke:new U.Z({color:"yellow",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:ot.All,filters:{operator:"During",propertyName:"date_observation",begin:"2014-01-01T00:00:00-05:00",end:"2019-12-31T00:00:00-05:00",sliderOptions:{interval:2e3,displayFormat:"YY"},displayFormat:"YYYY"}},minDate:"2014-01-01T00:00:00-05:00",maxDate:"2019-12-31T00:00:00-05:00",stepDate:"P1Y"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P1Y)",id:"4",source:m,style:new J.ZP({image:new Te.Z({radius:5,fill:new q.Z({color:"white"}),stroke:new U.Z({color:"green",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:ot.All,filters:{operator:"During",propertyName:"date_observation",begin:"today - 2 days",end:"today"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1D"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Interval from Now, Step: P1D)",id:"5",source:m,style:new J.ZP({image:new Te.Z({radius:5,fill:new q.Z({color:"white"}),stroke:new U.Z({color:"black",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:ot.All,filters:{operator:"During",propertyName:"date_observation",begin:"2019-01-01 00:00:00",restrictToStep:!0}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, RestrictToStep, Step: P1M)",id:"6",source:m,style:new J.ZP({image:new Te.Z({radius:5,fill:new q.Z({color:"black"}),stroke:new U.Z({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"vg_observation_v_inondation23avril2017_wmst",VERSION:"1.3.0"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,filters:{operator:"During",propertyName:"date_observation"},allowedOperatorsType:ot.Time}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Inondation (During, optionsFromCapabilities)",source:m}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",urlWfs:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"radars_photos",VERSION:"1.3.0"},ogcFilters:{enabled:!0,editable:!0,pushButtons:{selectorType:"pushButton",order:2,groups:[{title:"Nom du group1 - push",name:"1 - push",ids:["id1"]}],bundles:[{id:"id1",title:"R\xe9gions",logical:"Or",vertical:!0,selectors:[{title:"Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Laval"}]}},{title:"Outside Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{logical:"And",filters:[{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Laval"}]}}]}]},checkboxes:{selectorType:"checkbox",order:1,groups:[{title:"Nom du group1 - checkbox",name:"1 - checkbox",ids:["id1"]}],bundles:[{id:"id1",title:"Type de radar photo",logical:"Or",selectors:[{title:"Radar photo fixe",enabled:!0,tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe"}},{title:"Radar photo mobile",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo mobile"}},{title:"Radar photo fixe + feu rouge",enabled:!1,color:"0,200,0",tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe et surveillance au feu rouge"}},{title:"Radar feu rouge",enabled:!1,color:"255,0,0",tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Appareil de surveillance au feu rouge"}}]}]},allowedOperatorsType:ot.Basic},paramsWFS:{featureTypes:"radars_photos",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"1.1.0",outputFormat:"geojson",outputFormatDownload:"shp"}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Filterable WMS layers with predefined filters (push buttons)",source:m}))})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-ogc-filter"]],decls:10,vars:7,consts:[["title","Ogc filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/ogc-filter"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],["title","Layers"],[3,"map","layers"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4),e.qZA()(),e.TgZ(6,"mat-grid-tile")(7,"div",5)(8,"igo-panel",6),e._UZ(9,"igo-ogc-filterable-list",7),e.qZA()()()()()()),2&o&&(e.Q6J("dependencies",e.DdM(6,yO)),e.xp6(4),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(4),e.Q6J("map",i.map)("layers",i.map.layers))},dependencies:[me,de,Ct.Il,Ct.DX,Ht,Le,lt,Jr]})}return n})()}]);let CO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[vO,pe,It,at,nn]})}return n})();const SO=ee.Bz.forChild([{path:"overlay",component:(()=>{class n{languageService;dataSourceService;layerService;map=new Xe({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(t,o,i){this.languageService=t,this.dataSourceService=o,this.layerService=i}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(t=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:t}))})}ngAfterViewInit(){this.map.overlay.setFeatures([{type:ie,projection:"EPSG:4326",meta:{id:1},properties:{},geometry:{type:"Point",coordinates:[-73,46.6]}},{type:ie,projection:"EPSG:4326",meta:{id:2},properties:{},geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]}},{type:ie,projection:"EPSG:4326",meta:{id:3},properties:{},geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]}}],Y.None)}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-overlay"]],decls:4,vars:3,consts:[["title","Overlay","subtitle","Geo"],["codeFolder","geo/overlay"],[3,"map","view"],["color","primary",3,"map"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3),e.qZA()()()),2&o&&(e.xp6(2),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map))},dependencies:[me,de,Le,lt],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return n})()}]);let wO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,SO,at,Ha]})}return n})();const TO=function(){return["LanguageService"]},OO=ee.Bz.forChild([{path:"print",component:(()=>{class n{languageService;layerService;map=new Xe({controls:{attribution:{collapsed:!1}}});view={center:[-73,47.2],zoom:9};constructor(t,o){this.languageService=t,this.layerService=o,this.layerService.createAsyncLayer({title:"Quebec Base Map",sourceOptions:{type:"wmts",url:"https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts",layer:"carte_gouv_qc_ro",matrixSet:"EPSG_3857",version:"1.3.0",crossOrigin:"anonymous",attributions:"\xa9 <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qu\xe9bec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>"}}).subscribe(i=>this.map.addLayer(i)),this.layerService.createAsyncLayer({title:"School board",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{LAYERS:"MELS_CS_ANGLO_S",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(i=>this.map.addLayer(i)),this.layerService.createAsyncLayer({title:"Embacle",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(i=>this.map.addLayer(i))}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-print"]],decls:11,vars:10,consts:[["title","Print","subtitle","Geo",3,"dependencies"],["codeFolder","geo/print"],["cols","2","rowHeight","800px","gutterSize","16px"],[3,"map","view"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[3,"map"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4)(6,"igo-geolocate-button",4)(7,"igo-home-extent-button",4)(8,"igo-rotation-button",5),e.qZA()(),e.TgZ(9,"mat-grid-tile"),e._UZ(10,"igo-print",6),e.qZA()()()()),2&o&&(e.Q6J("dependencies",e.DdM(9,TO)),e.xp6(4),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map)("showIfNoRotation",!1),e.xp6(2),e.Q6J("map",i.map))},dependencies:[me,de,Ct.Il,Ct.DX,Le,lt,zn,Kn,Wn,Gp],styles:["[_nghost-%COMP%]   igo-print[_ngcontent-%COMP%]{overflow-y:auto;width:100%;height:100%}"]})}return n})()}]);let AO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,OO,Po,at,$x]})}return n})();function LO(n,r){if(1&n&&(e.TgZ(0,"div")(1,"h1"),e._uU(2," Query Title : "),e.TgZ(3,"span",7),e._uU(4),e.qZA()(),e._UZ(5,"igo-feature-details",8),e.qZA()),2&n){const t=r.$implicit,o=e.oxw(2);e.xp6(4),e.Oqu(o.getTitle(t)),e.xp6(1),e.Q6J("feature",t)}}function MO(n,r){if(1&n&&(e.ynx(0),e.YNc(1,LO,6,2,"div",6),e.BQk()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("ngForOf",t)}}const IO=function(){return[]},PO=ee.Bz.forChild([{path:"query",component:(()=>{class n{dataSourceService;layerService;features$=new y.X([]);map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(t,o){this.dataSourceService=t,this.layerService=o,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(i=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:i}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryTitle:"num_rts",params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe(i=>{this.map.addLayer(this.layerService.createLayer({title:"WMS",source:i,sourceOptions:i.options}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryFormat:We.HTMLGML2,queryHtmlTarget:Do.IFRAME,params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe(i=>{this.map.addLayer(this.layerService.createLayer({title:"WMS html with a pre call in GML",source:i,sourceOptions:i.options}))}),this.layerService.createAsyncLayer({title:"Query url test",visible:!0,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",queryable:!0,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application/geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}"}],queryLayerFeatures:!1,queryFormat:"geojson",params:{layers:"SDA_MUNIC_S_20K",version:"1.3.0"}}}).subscribe(i=>this.map.addLayer(i)),this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0,queryTitle:"So beautiful ${name}",sourceFields:[{name:"name",alias:"Alias name"},{name:"description",alias:"Alias description"}]}).subscribe(i=>{this.map.addLayer(this.layerService.createLayer({title:"Vector Layer",source:i,sourceOptions:i.options})),this.addFeatures(i)})}addFeatures(t){const o=new Ze.Z({name:"feature1",geometry:new ro.Z([Q.vs([-72,47.8],"EPSG:4326","EPSG:3857"),Q.vs([-73.5,47.4],"EPSG:4326","EPSG:3857"),Q.vs([-72.4,48.6],"EPSG:4326","EPSG:3857")])}),i=new Ze.Z({name:"feature2",geometry:new Ee.Z(Q.vs([-73,46.6],"EPSG:4326","EPSG:3857"))}),s=new Ze.Z({name:"feature3",geometry:new Rt.ZP([[Q.vs([-71,46.8],"EPSG:4326","EPSG:3857"),Q.vs([-73,47],"EPSG:4326","EPSG:3857"),Q.vs([-71.2,46.6],"EPSG:4326","EPSG:3857")]])});t.ol.addFeatures([o,i,s]),this.layerService.createAsyncLayer({title:"Vector tile with custom getfeatureinfo url",visible:!0,sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application%2Fgeojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}"}],queryLayerFeatures:!1},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe(a=>this.map.addLayer(a)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi",queryable:!0,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&INFO_FORMAT=geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}",minResolution:0,maxResolution:400}],queryFormat:"geojson",params:{version:"1.3.0",layers:"MSP_CASERNE_PUBLIC"}}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"WMS with custom getfeatureinfo url",source:a,sourceOptions:a.options}))})}handleQueryResults(t){const o=t.features;o.length&&o[0]&&(this.features$.next(o),this.map.queryResultsOverlay.setFeatures(o,Y.None))}getTitle(t){return ho(t)}static \u0275fac=function(o){return new(o||n)(e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-query"]],decls:7,vars:9,consts:[["title","Query","subtitle","Geo",3,"dependencies"],["codeFolder","geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures","query"],["color","primary",3,"map"],["title","Details"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"background-color","#e0e0e0"],[3,"feature"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e.NdJ("query",function(a){return i.handleQueryResults(a)}),e._UZ(3,"igo-zoom-button",3),e.qZA(),e.TgZ(4,"igo-panel",4),e.YNc(5,MO,2,1,"ng-container",5),e.ALo(6,"async"),e.qZA()()()),2&o&&(e.Q6J("dependencies",e.DdM(8,IO)),e.xp6(2),e.Q6J("map",i.map)("view",i.view)("queryFeatures",!0),e.xp6(1),e.Q6J("map",i.map),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,6,i.features$)))},dependencies:[f.sg,f.O5,me,de,Ht,Le,lt,Gw,Ju,Jn,f.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return n})()}]);let kO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[PO,pe,It,at,Ha,Ba,Ii]})}return n})(),$O=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[qa]})}return n})(),DO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[f.ez,w.Ps,ut.g,P.AV,S.ot,re,Ii,qa,yc,It,Aa,pn]})}return n})(),EO=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[$O,DO]})}return n})();function RO(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openGuide())}),e.ALo(1,"translate"),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"mat-icon",8),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.loading)("matTooltip",e.lcZ(1,3,"igo.integration.aboutTool.trainingGuideTooltip")),e.xp6(3),e.Oqu(e.lcZ(4,5,"igo.integration.aboutTool.trainingGuide"))}}function NO(n,r){if(1&n&&(e.TgZ(0,"button",9),e.ALo(1,"translate"),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"mat-icon",8),e.qZA()),2&n){const t=e.oxw(),o=e.MAs(5);e.Q6J("disabled",t.loading)("matTooltip",e.lcZ(1,4,"igo.integration.aboutTool.trainingGuideTooltip"))("matMenuTriggerFor",o),e.xp6(3),e.Oqu(e.lcZ(4,6,"igo.integration.aboutTool.trainingGuide"))}}function BO(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.openGuide(s))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit,o=e.oxw();e.xp6(1),e.hij(" ",o.formatFileName(t)," ")}}function JO(n,r){if(1&n&&(e._UZ(0,"igo-custom-html",6),e.ALo(1,"translate")),2&n){const t=e.oxw();e.Q6J("html",e.lcZ(1,1,t.headerHtml))}}const UO=function(n){return{version:n}};let bd=class Ll{configService;auth;http;cdRef;languageService;configOptions;get headerHtml(){return this._headerHtml}set headerHtml(r){this._headerHtml=Array.isArray(r)?r.join("\n"):r}get html(){return this._html}set html(r){this._html=Array.isArray(r)?r.join("\n"):r}_discoverTitleInLocale="IGO";discoverTitleInLocale$=(0,z.of)(this._discoverTitleInLocale);get discoverTitleInLocale(){return this._discoverTitleInLocale}set discoverTitleInLocale(r){this._discoverTitleInLocale=r,this.discoverTitleInLocale$=(0,z.of)(r)}trainingGuideURLs;effectiveVersion;_html="igo.integration.aboutTool.html";_headerHtml;baseUrlProfil;baseUrlGuide;loading=!1;constructor(r,t,o,i,s){this.configService=r,this.auth=t,this.http=o,this.cdRef=i,this.languageService=s,this.headerHtml=this.languageService.translate.instant("igo.integration.aboutTool.headerHtml"),this.configOptions=this.configService.getConfigs();const a=this.configOptions.version;this.effectiveVersion=a?.app||a?.lib||Ss.lib,this.baseUrlProfil=this.configOptions.storage?.url,this.baseUrlGuide=this.configOptions.depot?.url+this.configOptions.depot?.guideUrl}ngOnInit(){this.auth.authenticated&&this.configOptions.context?.url?this.http.get(this.baseUrlProfil).subscribe(r=>{this.trainingGuideURLs=r.guides,this.cdRef.detectChanges()}):this.auth.authenticated&&!this.configOptions.context?.url&&this.configOptions.depot?.trainingGuides&&(this.trainingGuideURLs=this.configOptions.depot?.trainingGuides)}openGuide(r){this.loading=!0;const t=r?this.baseUrlGuide+r+"?":this.baseUrlGuide+this.trainingGuideURLs[0]+"?";this.http.get(t,{responseType:"blob"}).subscribe(()=>{this.loading=!1,window.open(t,"_blank"),this.cdRef.detectChanges()})}formatFileName(r){const t=(r=r.split("_").join(" ")).indexOf(".");return r.slice(0,t)}static \u0275fac=function(t){return new(t||Ll)(e.Y36(N),e.Y36(He),e.Y36($.eN),e.Y36(e.sBO),e.Y36(L))};static \u0275cmp=e.Xpm({type:Ll,selectors:[["igo-about-tool"]],inputs:{headerHtml:"headerHtml",html:"html",discoverTitleInLocale:"discoverTitleInLocale",trainingGuideURLs:"trainingGuideURLs"},decls:10,vars:11,consts:[["mat-raised-button","","tourToStart","global","menuIsOpen","true","styleButton","raised",3,"discoverTitleInLocale$"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","click"],["svgIcon","file-document"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","matMenuTriggerFor"],["mat-menu-item","",3,"click"]],template:function(t,o){1&t&&(e._UZ(0,"p")(1,"igo-interactive-tour",0),e.YNc(2,RO,6,7,"button",1),e.YNc(3,NO,6,8,"button",2),e.TgZ(4,"mat-menu",null,3),e.YNc(6,BO,2,1,"button",4),e.qZA(),e.YNc(7,JO,2,3,"igo-custom-html",5),e._UZ(8,"igo-custom-html",6),e.ALo(9,"translate")),2&t&&(e.xp6(1),e.Q6J("discoverTitleInLocale$",o.discoverTitleInLocale$),e.xp6(1),e.Q6J("ngIf",o.auth.authenticated&&o.trainingGuideURLs&&1===o.trainingGuideURLs.length),e.xp6(1),e.Q6J("ngIf",o.auth.authenticated&&o.trainingGuideURLs&&o.trainingGuideURLs.length>1),e.xp6(3),e.Q6J("ngForOf",o.trainingGuideURLs),e.xp6(1),e.Q6J("ngIf",""!==o.headerHtml),e.xp6(1),e.Q6J("html",e.xi3(9,6,o.html,e.VKq(9,UO,o.effectiveVersion))))},dependencies:[Xa,S.lW,P.gM,w.Hw,Be.VK,Be.OP,Be.p6,Rc,f.sg,f.O5,O.X$],styles:["igo-interactive-tour[_ngcontent-%COMP%]{margin-left:20px}.training-guide-button[_ngcontent-%COMP%]{margin-left:5px;background-color:#1976d2;color:#fff;padding:0 12px}"]})};bd=(0,T.gn)([ke({name:"about",title:"igo.integration.tools.about",icon:"help-circle"}),(0,T.w6)("design:paramtypes",[N,He,$.eN,e.sBO,L])],bd);var ps=function(n){return n.layer="layer",n.context="context",n}(ps||{}),ui=function(n){return n.import="import",n.export="export",n}(ui||{});let co=(()=>{class n{importExportType$=new y.X(ps.layer);selectedMode$=new y.X(ui.import);exportOptions$=new y.X(void 0);setImportExportType(t){this.importExportType$.next(t)}setMode(t){this.selectedMode$.next(t)}setsExportOptions(t){this.exportOptions$.next(t)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Qe=(()=>{class n{toolService;importExportState;get toolbox(){return this.toolService.toolbox}openSidenav$=new y.X(void 0);constructor(t,o){this.toolService=t,this.importExportState=o}toolToActivateFromOptions(t){if(t){if("importExport"===t.tool){let o=this.importExportState.exportOptions$.value;o?(o.layers=t.options.layers,o.featureInMapExtent=t.options.featureInMapExtent):o={layers:t.options.layers,featureInMapExtent:t.options.featureInMapExtent},this.importExportState.setsExportOptions(o),this.importExportState.setMode(ui.export)}this.toolbox.getTool(t.tool)&&(this.toolbox.activateTool(t.tool),this.openSidenav$.next(!0))}}static \u0275fac=function(o){return new(o||n)(e.LFG(Gi),e.LFG(co))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ds=(()=>{class n{contextService;toolService;toolState;languageService;context$=new y.X(void 0);constructor(t,o,i,s){this.contextService=t,this.toolService=o,this.toolState=i,this.languageService=s,this.contextService.context$.subscribe(a=>{this.onContextChange(a)}),this.contextService.toolsChanged$.subscribe(a=>{this.updateTools(a)})}setContext(t){this.updateTools(t),this.context$.next(t)}updateTools(t){const o=this.toolState.toolbox,i=[];(t.tools||[]).forEach(a=>{const l=this.toolService.getTool(a.name);if(void 0===l)return;const c=Object.assign({},l.options||{},a.options||{}),u=Object.assign({},l,a,{options:c});i.push(u)}),i.forEach(a=>{if(a.parent){const l=i.findIndex(c=>c.name===a.parent);-1!==l&&(i[l].children=[],i[l].children.push(a.name))}}),o.setTools(i),o.setToolbar(t.toolbar||[]),this.contextService.setTools([].concat(i)),this.contextService.setToolbar(t.toolbar||[])}onContextChange(t){void 0!==t&&this.setContext(t)}static \u0275fac=function(o){return new(o||n)(e.LFG(Mo),e.LFG(Gi),e.LFG(Qe),e.LFG(L))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ne=(()=>{class n{mapService;projectionService;storageService;configService;get showAllLegendsValue(){return this._legendToolShowAll}set showAllLegendsValue(t){this._legendToolShowAll=t}_legendToolShowAll;get map(){return this._map}_map;constructor(t,o,i,s){this.mapService=t,this.projectionService=o,this.storageService=i,this.configService=s,this._map=new Xe({controls:{scaleLine:!0,attribution:{collapsed:!0}}},this.storageService,this.configService),this.mapService.setMap(this.map)}static \u0275fac=function(o){return new(o||n)(e.LFG(Gt),e.LFG(On),e.LFG(oe),e.LFG(N))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function GO(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-option",5),e.NdJ("click",function(){e.CHM(t),e.oxw();const i=e.MAs(8),s=e.oxw();return e.KtG(s.applyNewLayers(i))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t.title)}}function qO(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",2)(1,"form",3)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",4)(7,"mat-option",5,6),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(8),s=e.oxw();return e.KtG(s.selectAll(i))}),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._UZ(11,"mat-divider"),e.YNc(12,GO,2,2,"mat-option",7),e.qZA()()(),e.TgZ(13,"mat-slide-toggle",8),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.startSwipe(i.checked))}),e._uU(14),e.ALo(15,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(3),e.Oqu(e.lcZ(5,8,"igo.integration.advanced-map-tool.advanced-swipe.swipe-select")),e.xp6(3),e.Q6J("value",1),e.xp6(2),e.hij(" ",e.lcZ(10,10,"igo.integration.advanced-map-tool.advanced-swipe.selectAll")," "),e.xp6(3),e.Q6J("ngForOf",t.userControlledLayerList),e.xp6(1),e.Q6J("checked",t.swipe)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(15,12,"igo.integration.advanced-map-tool.advanced-swipe.swipe")," ")}}function jO(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list")(1,"p",9),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"p",9),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-list-item"),e._UZ(8,"mat-icon",10),e.TgZ(9,"span",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.searchEmit())}),e._uU(10),e.ALo(11,"translate"),e.qZA()(),e.TgZ(12,"mat-list-item"),e._UZ(13,"mat-icon",12),e.TgZ(14,"span",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.catalogEmit())}),e._uU(15),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"mat-list-item"),e._UZ(18,"mat-icon",14),e.TgZ(19,"span",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.contextEmit())}),e._uU(20),e.ALo(21,"translate"),e.qZA()()()}2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.integration.advanced-map-tool.advanced-swipe.empty")," "),e.xp6(3),e.hij(" ",e.lcZ(6,7,"igo.integration.advanced-map-tool.advanced-swipe.customize")," "),e.xp6(5),e.hij(" ",e.lcZ(11,9,"igo.integration.advanced-map-tool.advanced-swipe.search-tool")," "),e.xp6(5),e.hij(" ",e.lcZ(16,11,"igo.integration.advanced-map-tool.advanced-swipe.catalog-tool")," "),e.xp6(5),e.hij(" ",e.lcZ(21,13,"igo.integration.advanced-map-tool.advanced-swipe.context-tool")," "))}let QO=(()=>{class n{mapState;contextService;formBuilder;toolState;swipe=!1;layerList;userControlledLayerList;form;layers;res;listForSwipe;get map(){return this.mapState.map}constructor(t,o,i,s){this.mapState=t,this.contextService=o,this.formBuilder=i,this.toolState=s,this.buildForm()}ngOnInit(){this.map.layers$.subscribe(t=>this.userControlledLayerList=t.filter(o=>!o.baseLayer&&o.showInLayerList&&o.displayed))}ngOnDestroy(){this.swipe=!1,this.map.swipeEnabled$.next(this.swipe)}buildForm(){this.form=this.formBuilder.group({layers:["",[_.kI.required]]})}startSwipe(t){this.swipe=t,this.map.swipeEnabled$.next(t),this.listForSwipe=[];for(const o of this.form.value.layers)this.listForSwipe.push(o);this.map.selectedFeatures$.next(this.listForSwipe)}applyNewLayers(t){this.startSwipe(!1),this.startSwipe(!0),t._selected&&(t._selected=!1),this.form.controls.layers.value.length===this.userControlledLayerList.length&&(t._selected=!0)}selectAll(t){t._selected?(this.form.controls.layers.setValue(this.userControlledLayerList),t._selected=!0):this.form.controls.layers.setValue([]),this.startSwipe(!1),this.startSwipe(!0)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(o){return new(o||n)(e.Y36(ne),e.Y36(Mo),e.Y36(_.QS),e.Y36(Qe))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-advanced-swipe"]],decls:3,vars:2,consts:[["class","igo-swipe-select-container",4,"ngIf","ngIfElse"],["noLayersBlock",""],[1,"igo-swipe-select-container"],[1,"igo-form",3,"formGroup"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value","click",4,"ngFor","ngForOf"],[1,"swipe-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"map-empty","mat-typography"],["matListItemIcon","","svgIcon","magnify"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemIcon","","svgIcon","layers-plus"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemIcon","","svgIcon","star"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(o,i){if(1&o&&(e.YNc(0,qO,16,14,"div",0),e.YNc(1,jO,22,15,"ng-template",null,1,e.W1O)),2&o){const s=e.MAs(2);e.Q6J("ngIf",i.userControlledLayerList.length)("ngIfElse",s)}},dependencies:[_._Y,_.JJ,_.JL,_.sg,_.u,Ve.d,F.KE,F.hX,se.gD,le.ey,f.sg,f.O5,Z.i$,Z.Tg,Z.Yt,Z.sL,w.Hw,tt.Rr,O.X$],styles:["[_nghost-%COMP%]   .nameOfTool[_ngcontent-%COMP%]{text-align:center;font-weight:700;font-size:small;margin:15px 10px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:1px 5px;width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:5px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{padding:10px;text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:15px}[_nghost-%COMP%]   .advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}"]})}return n})();function YO(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",14)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"textarea",15,16),e.ALo(6,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lon")),e.xp6(2),e.Q6J("placeholder",e.lcZ(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lon"))("value",t.coordinates[0])}}function HO(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",14),e._UZ(1,"textarea",15,16),e.ALo(3,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("placeholder",e.lcZ(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.est"))("value",t.coordinates[0])}}function VO(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",17)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"textarea",15,16),e.ALo(6,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lat")),e.xp6(2),e.Q6J("placeholder",e.lcZ(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lat"))("value",t.coordinates[1])}}function zO(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",17),e._UZ(1,"textarea",15,16),e.ALo(3,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("placeholder",e.lcZ(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.nord"))("value",t.coordinates[1])}}function KO(n,r){if(1&n&&(e.TgZ(0,"mat-option",18),e.NdJ("click",function(o){return o.stopPropagation()}),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.translatedValue||t.alias," ")}}let WO=(()=>{class n{mapState;languageService;messageService;cdRef;storageService;config;formBuilder;formattedScale$=new y.X("");projections$=new y.X([]);form;coordinates;currentCenterDefaultProj;center;inMtmZone=!0;inLambert2={32198:!0,3798:!0};mapState$$;_projectionsLimitations={};projectionsConstraints;defaultProj;currentZones={utm:void 0,mtm:void 0};units=!0;get map(){return this.mapState.map}get inputProj(){return this.form.get("inputProj").value}set inputProj(t){this.form.patchValue({inputProj:t})}get projectionsLimitations(){return this._projectionsLimitations||{}}set projectionsLimitations(t){this._projectionsLimitations=t}constructor(t,o,i,s,a,l,c){this.mapState=t,this.languageService=o,this.messageService=i,this.cdRef=s,this.storageService=a,this.config=l,this.formBuilder=c,this.defaultProj={translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0},this.center=this.storageService.get("centerToggle"),this.computeProjections(),this.buildForm()}ngOnInit(){this.mapState$$=(0,Ye.a)([this.map.viewController.state$.pipe((0,ae.b)(50)),this.form.valueChanges]).subscribe(()=>{this.setScaleValue(this.map),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code);const o=Vi(this.currentCenterDefaultProj[0]),i=Ln(this.currentCenterDefaultProj[0]);!this.inMtmZone&&o!==this.currentZones.mtm&&this.back2quebec();let s=!1;o!==this.currentZones.mtm&&(this.currentZones.mtm=o,s=!0),i!==this.currentZones.utm&&(this.currentZones.utm=i,s=!0),s&&this.updateProjectionsZoneChange(),this.checkLambert(this.currentCenterDefaultProj),this.coordinates=this.getCoordinates(),this.cdRef.detectChanges(),this.storageService.set("currentProjection",this.inputProj,Pe.SESSION)});const t=this.storageService.get("currentProjection");if(this.inputProj=this.projections$.value[0],null!==t){const o=this.positionInList(t);this.inputProj=this.projections$.value[o],this.updateZoneMtmUtm()}this.map.mapCenter$.next(this.center),this.coordinates=this.getCoordinates(),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code)}ngOnDestroy(){this.map.mapCenter$.next(!1),this.mapState$$.unsubscribe()}setScaleValue(t){this.formattedScale$.next(": ~ 1 / "+ia(t.viewController.getScale()))}getCoordinates(){let t;this.currentZones.mtm=Vi(this.currentCenterDefaultProj[0]),this.currentZones.utm=Ln(this.currentCenterDefaultProj[0]);const o=this.inputProj.code;let i=2;return(o.includes("EPSG:4326")||o.includes("EPSG:4269"))&&(i=5),this.units="EPSG:4326"===o||"EPSG:4269"===o,t=this.map.viewController.getCenter(o).map(s=>s.toFixed(i)),t}copyTextToClipboard(){At.copy(this.coordinates.toString())&&this.messageService.success("igo.integration.advanced-map-tool.advanced-coordinates.copyMsg","igo.integration.advanced-map-tool.advanced-coordinates.copyTitle")}displayCenter(t){this.center=t,this.map.mapCenter$.next(t),this.storageService.set("centerToggle",t,Pe.SESSION)}buildForm(){this.form=this.formBuilder.group({inputProj:["",[_.kI.required]]})}updateProjectionsZoneChange(){let t=this.projections$.value;const o=this.languageService.translate;t.map(i=>{if("mtm"===i.translateKey){const s=Vi(this.currentCenterDefaultProj[0]);if(s){const a=s<10?`EPSG:3218${s}`:`EPSG:321${80+s}`;i.alias=`MTM ${s}`,i.code=a,i.zone=`${s}`,i.translatedValue=o.instant("igo.geo.importExportForm.projections.mtm",i)}else i.alias="",this.inMtmZone=!1,"mtm"===this.inputProj.translateKey&&(this.inputProj=this.projections$.value[0])}if("utm"===i.translateKey){const s=Ln(this.currentCenterDefaultProj[0]),a=`EPSG:326${s}`;i.alias=`UTM ${s}`,i.code=a,i.zone=`${s}`,i.translatedValue=o.instant("igo.geo.importExportForm.projections.utm",i)}}),t=t.filter(i=>""!==i.alias),this.projections$.next(t)}computeProjections(){this.projectionsConstraints=Iu(this.projectionsLimitations);const t=[];this.currentCenterDefaultProj||(this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code));const o=this.languageService.translate;if(this.projectionsConstraints.wgs84&&t.push({translatedValue:o.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.nad83&&t.push({translatedValue:o.instant("igo.geo.importExportForm.projections.nad83",{code:"EPSG:4269"}),translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.webMercator&&t.push({translatedValue:o.instant("igo.geo.importExportForm.projections.webMercator",{code:"EPSG:3857"}),translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.mtm){const s=Vi(this.currentCenterDefaultProj[0]);if(s){this.inMtmZone=!0;const a=s<10?`EPSG:3218${s}`:`EPSG:321${80+s}`;t.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:a,zone:s}),translateKey:"mtm",alias:`MTM ${s}`,code:a,zone:`${s}`,def:void 0,extent:void 0})}else this.inMtmZone=!1}if(this.projectionsConstraints.utm){const s=this.inMtmZone?4:3,a=Ln(this.currentCenterDefaultProj[0]),l=a<10?`EPSG:3260${a}`:`EPSG:326${a}`;t.splice(s,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:l,zone:a}),translateKey:"utm",alias:`UTM ${a}`,code:l,zone:`${a}`,def:void 0,extent:void 0})}let i=[];this.projectionsConstraints.projFromConfig&&(i=this.config.getConfig("projections")||[]),this.projections$.next(i.concat(t))}pushMtm(t){if(this.projectionsConstraints.mtm){const o=Vi(this.currentCenterDefaultProj[0]),i=o<10?`EPSG:3218${o}`:`EPSG:321${80+o}`;t.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:i,zone:o}),translateKey:"mtm",alias:`MTM ${o}`,code:i,zone:`${o}`,def:void 0,extent:void 0})}}back2quebec(){this.pushMtm(this.projections$.value),this.inMtmZone=!0}updateZoneMtmUtm(){if("mtm"===this.inputProj.translateKey){const t=Vi(this.currentCenterDefaultProj[0]);this.inputProj.alias=`MTM ${t}`;const o=t<10?`EPSG:3218${t}`:`EPSG:321${80+t}`;this.inputProj.code=o,this.inputProj.zone=`${t}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:o,zone:t})}if("utm"===this.inputProj.translateKey){const t=Ln(this.currentCenterDefaultProj[0]);this.inputProj.alias=`UTM ${t}`;const o=t<10?`EPSG:3260${t}`:`EPSG:326${t}`;this.inputProj.code=o,this.inputProj.zone=`${t}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:o,zone:t})}}positionInList(t){const o=t.translateKey,i=t.alias;let s,a=0;return this.projections$.value.map(l=>{o?o===l.translateKey&&(s=a):i===l.alias&&(s=a),a++}),s=s||0,s}checkLambert(t){(this.config.getConfig("projections")||[]).forEach(i=>{let s=this.projections$.value;const a=i.extent,l=i.code.match(/\d+/),c=Q.$A(a,i.code,this.defaultProj.code);t[0]<c[0]||t[0]>c[2]||t[1]<c[1]||t[1]>c[3]?(this.inLambert2[l]=!1,this.inputProj.alias===i.alias&&(this.inputProj=this.projections$.value[0]),s=s.filter(u=>u.alias!==i.alias),this.projections$.next(s)):this.inLambert2[l]||(this.projections$.next(s.concat(i)),this.inLambert2[l]=!0)})}static \u0275fac=function(o){return new(o||n)(e.Y36(ne),e.Y36(L),e.Y36(_e),e.Y36(e.sBO),e.Y36(oe),e.Y36(N),e.Y36(_.QS))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-advanced-coordinates"]],inputs:{projectionsLimitations:"projectionsLimitations"},decls:33,vars:37,consts:[[1,"advanced-coordinates__coordinates-container"],[1,"advanced-coordinates__coordinates-container__inner"],["class","coordinates",4,"ngIf","ngIfElse"],["elseBlock",""],["class","coordinates2",4,"ngIf","ngIfElse"],["elseBlock2",""],["mat-icon-button","",1,"igo-form-button-group","advanced-coordinates__copy-coordinates",3,"click"],["svgIcon","content-copy"],[1,"igo-form","advanced-coordinates__form",3,"formGroup"],[1,"igo-input-container"],[3,"value","valueChange"],["matTooltipShowDelay","500",3,"value","click",4,"ngFor","ngForOf"],[1,"center-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"igo-zoom","mat-typography"],[1,"coordinates"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],[1,"coordinates2"],["matTooltipShowDelay","500",3,"value","click"]],template:function(o,i){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,YO,7,7,"mat-form-field",2),e.YNc(3,HO,4,4,"ng-template",null,3,e.W1O),e.YNc(5,VO,7,7,"mat-form-field",4),e.YNc(6,zO,4,4,"ng-template",null,5,e.W1O),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return i.copyTextToClipboard()}),e.ALo(9,"translate"),e._UZ(10,"mat-icon",7),e.qZA()(),e.TgZ(11,"form",8)(12,"mat-form-field",9)(13,"mat-label"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"mat-select",10),e.NdJ("valueChange",function(a){return i.inputProj=a}),e.YNc(17,KO,2,2,"mat-option",11),e.ALo(18,"async"),e.qZA()(),e.TgZ(19,"mat-slide-toggle",12),e.NdJ("change",function(a){return i.displayCenter(a.checked)}),e._uU(20),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"p",13),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"p",13),e._uU(26),e.ALo(27,"translate"),e.ALo(28,"async"),e.qZA(),e.TgZ(29,"p",13),e._uU(30),e.ALo(31,"translate"),e.ALo(32,"number"),e.qZA()),2&o){const s=e.MAs(4),a=e.MAs(7);e.xp6(2),e.Q6J("ngIf",i.units)("ngIfElse",s),e.xp6(3),e.Q6J("ngIf",i.units)("ngIfElse",a),e.xp6(3),e.uIk("aria-label",e.lcZ(9,18,"igo.integration.advanced-map-tool.advanced-coordinates.copy")),e.xp6(3),e.Q6J("formGroup",i.form),e.xp6(3),e.Oqu(e.lcZ(15,20,"igo.integration.advanced-map-tool.advanced-coordinates.coordSystem")),e.xp6(2),e.Q6J("value",i.inputProj),e.xp6(1),e.Q6J("ngForOf",e.lcZ(18,22,i.projections$)),e.xp6(2),e.Q6J("checked",i.center)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(21,24,"igo.integration.advanced-map-tool.advanced-coordinates.center")," "),e.xp6(3),e.AsE(" ",e.lcZ(24,26,"igo.integration.advanced-map-tool.advanced-coordinates.zoom")," ",i.map.viewController.getZoom(),"\n"),e.xp6(3),e.AsE(" ",e.lcZ(27,28,"igo.integration.advanced-map-tool.advanced-coordinates.scale")," ",e.lcZ(28,30,i.formattedScale$),"\n"),e.xp6(4),e.AsE(" ",e.lcZ(31,32,"igo.integration.advanced-map-tool.advanced-coordinates.resolution")," ",e.xi3(32,34,i.map.viewController.getResolution(),"1.0-0"),"\n")}},dependencies:[_._Y,_.JL,_.sg,F.KE,F.hX,se.gD,le.ey,j.Nt,f.sg,f.O5,w.Hw,tt.Rr,S.RK,f.Ov,f.JJ,O.X$],styles:["textarea[_ngcontent-%COMP%]{resize:none}mat-form-field[_ngcontent-%COMP%]{padding:10px 15px}mat-form-field.coordinates2[_ngcontent-%COMP%]{padding:0 10px 0 3px}mat-form-field.igo-input-container[_ngcontent-%COMP%]{width:100%;padding:0 15px}.igo-form-button-group[_ngcontent-%COMP%]{padding:0 10px;margin:0 10px}.igo-zoom[_ngcontent-%COMP%]{padding:0 15px}.advanced-coordinates__coordinates-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]{flex:1 1 0}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:50%}.advanced-coordinates__form[_ngcontent-%COMP%]     .mat-mdc-slide-toggle{padding:10px 15px 35px;width:100%}mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}"]})}return n})(),vd=class Ml{mapState;get tracking$(){return this.mapState.map.geolocationController.tracking$}get followPosition$(){return this.mapState.map.geolocationController.followPosition$}constructor(r){this.mapState=r}toggleTracking(r){this.mapState.map.geolocationController.tracking=r}toggleFollow(r){this.mapState.map.geolocationController.followPosition=r}static \u0275fac=function(t){return new(t||Ml)(e.Y36(ne))};static \u0275cmp=e.Xpm({type:Ml,selectors:[["igo-advanced-map-tool"]],decls:24,vars:26,consts:[[1,"nameOfTool"],[1,"advanced-tool-line"],[1,"igo-input-container"],[1,"geolocation-slide-toggle-container","mat-typography"],[1,"geolocation-option","mat-typography",3,"checked","labelPosition","change"],[1,"geolocation-option","mat-typography",3,"disabled","labelPosition","checked","change"]],template:function(t,o){1&t&&(e.TgZ(0,"h4",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e._UZ(3,"igo-advanced-swipe")(4,"mat-divider",1),e.TgZ(5,"h4",0),e._uU(6),e.ALo(7,"translate"),e.qZA(),e._UZ(8,"igo-advanced-coordinates")(9,"mat-divider",1),e.TgZ(10,"h4",0),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"div",2)(14,"div",3)(15,"mat-slide-toggle",4),e.NdJ("change",function(s){return o.toggleTracking(s.checked)}),e.ALo(16,"async"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"mat-slide-toggle",5),e.NdJ("change",function(s){return o.toggleFollow(s.checked)}),e.ALo(20,"async"),e.ALo(21,"async"),e._uU(22),e.ALo(23,"translate"),e.qZA()()()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,10,"igo.integration.advanced-map-tool.advanced-swipe.swipe-tool"),"\n"),e.xp6(5),e.hij(" ",e.lcZ(7,12,"igo.integration.advanced-map-tool.advanced-coordinates.coordinates"),"\n"),e.xp6(5),e.hij(" ",e.lcZ(12,14,"igo.integration.advanced-map-tool.geolocation.title"),"\n"),e.xp6(4),e.Q6J("checked",e.lcZ(16,16,o.tracking$))("labelPosition","before"),e.xp6(2),e.hij(" ",e.lcZ(18,18,"igo.integration.advanced-map-tool.geolocation.tracking")," "),e.xp6(2),e.Q6J("disabled",!0!==e.lcZ(20,20,o.tracking$))("labelPosition","before")("checked",e.lcZ(21,22,o.followPosition$)),e.xp6(3),e.hij(" ",e.lcZ(23,24,"igo.integration.advanced-map-tool.geolocation.follow")," "))},dependencies:[Ve.d,tt.Rr,QO,WO,f.Ov,O.X$],styles:[".nameOfTool[_ngcontent-%COMP%]{text-align:center;font-weight:700;font-size:small;margin:15px 10px 0}.advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}.geolocation-slide-toggle-container[_ngcontent-%COMP%]{margin-top:8px}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}.geolocation-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}"]})};vd=(0,T.gn)([ke({name:"advancedMap",title:"igo.integration.tools.advancedMap",icon:"toolbox"}),(0,T.w6)("design:paramtypes",[ne])],vd);let Cd=(()=>{class n{mapState;storageService;defaultProximityRadiusValue=30;enabled$=new y.X(!1);proximityRadiusValue$;proximitylocationType$=new y.X("geolocation");proximityFeatureStore;subs$$=[];currentPositionCoordinate$=new y.X(void 0);get map(){return this.mapState.map}constructor(t,o){this.mapState=t,this.storageService=o,this.proximityFeatureStore=new yt([],{map:this.mapState.map}),this.proximityRadiusValue$=new y.X(this.storageService.get("mapProximityRadius")||this.defaultProximityRadiusValue),this.mapState.map.ol.once("rendercomplete",()=>{this.subscribeProximityMonitor()})}subscribeProximityMonitor(){this.subs$$.push((0,Ye.a)([this.enabled$,this.proximitylocationType$,this.proximityRadiusValue$,(0,xu.F)(5e3),this.map.geolocationController.position$]).pipe((0,ae.b)(750)).subscribe(t=>{this.proximityFeatureStore.clear();const o=t[0],i=this.map.layers,s=this.map.geolocationController.position$.value,a=t[1],l=t[2];if(this.storageService.set("mapProximityRadius",l||this.defaultProximityRadiusValue),!o)return;let c;if("geolocation"===a){if(!s||!s.position)return;c=Q.vs(s.position,s.projection,this.map.projection),this.map.mapCenter$.next(!1)}else c=this.map.viewController.getCenter(),this.map.mapCenter$.next(!0);const p=pt(Q.vs(c,this.map.projection,"EPSG:4269"),6);this.currentPositionCoordinate$.next(p),i.filter(g=>g.ol instanceof ti.Z&&g.dataSource.options.queryable&&g.visible&&g.isInResolutionsRange).map(g=>{const h=g.ol.getSource(),m=h.getFeaturesAtCoordinate(c);if(m&&m.length)m.map(b=>{const C=Li(b,this.map.projection);let x=this.getQueryTitle(C,g);this.addFeatureToStore(g,c,C,x,0)});else{const b=h.getClosestFeatureToCoordinate(c);if(b){const C=b.getGeometry(),x=Li(b,this.map.projection),A=C.getClosestPoint(c),k=on(new ro.Z([c,A]),"EPSG:3857");if(k<=l){let H=this.getQueryTitle(x,g);this.addFeatureToStore(g,c,x,H,k)}}}})}))}addFeatureToStore(t,o,i,s,a){const l=Ie(),c=this.map.ol.getView().getProjection(),u=i.ol.getGeometry(),p=(new Ce.Z).writeGeometryObject(u,{featureProjection:c,dataProjection:c});this.proximityFeatureStore.update({type:ie,geometry:p,projection:c.getCode(),properties:{...i.properties,id:l,element:s,distance:a,coordFromCalculatedDistance:o,layerSrcId:t.id,layerSrcTitle:t.title},meta:{id:l}})}getQueryTitle(t,o){let i;if(o.options?.source?.options){const s=o.options.source.options;s.queryTitle&&(i=this.getLabelMatch(t,s.queryTitle))}return i}getLabelMatch(t,o){let i=o;const s=Array.from(o.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(a=>{i=i.replace(a[0],t.properties[a[1]])}),0===s.length&&i===o&&(i=t.properties[o]||o),i}static \u0275fac=function(o){return new(o||n)(e.LFG(ne),e.LFG(oe))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const XO=["table"];function eA(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",14),e._UZ(1,"textarea",15,16),e.ALo(3,"translate"),e.qZA()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("placeholder",e.lcZ(3,2,"igo.integration.map-proximity-tool.lon"))("value",t[0])}}function tA(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",17),e._UZ(1,"textarea",15,16),e.ALo(3,"translate"),e.qZA()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("placeholder",e.lcZ(3,2,"igo.integration.map-proximity-tool.lat"))("value",t[1])}}function oA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.copyTextToClipboard())}),e._UZ(1,"mat-icon",19),e.qZA()}}let xd=class Il{mapState;mapProximityState;languageService;messageService;subs$$=[];table;get maxDistance(){return this.mapProximityState.proximityRadiusValue$.value}set maxDistance(r){this.mapProximityState.proximityRadiusValue$.next(r)}get map(){return this.mapState.map}userDefinedMapCenter;userDefinedFollowPosition;tableTemplate;constructor(r,t,o,i){this.mapState=r,this.mapProximityState=t,this.languageService=o,this.messageService=i,this.tableTemplate={selection:!0,selectMany:!1,selectionCheckbox:!1,sort:!0,columns:[{name:"element",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.feature"),valueAccessor:s=>s.properties.element},{name:"distance",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.distance"),valueAccessor:s=>`${hi.roundToNDecimal(s.properties.distance,1)}m`}]}}ngOnInit(){this.mapProximityState.enabled$.next(!0),this.userDefinedFollowPosition=!0===this.map.geolocationController.followPosition,this.userDefinedMapCenter=!0===this.map.mapCenter$.value,this.subs$$.push(this.mapProximityState.proximitylocationType$.subscribe(r=>{this.map.mapCenter$.next("geolocation"!==r),this.map.geolocationController.followPosition="geolocation"===r}))}ngOnDestroy(){this.mapProximityState.enabled$.next(!1),this.map.mapCenter$.next(this.userDefinedMapCenter),this.subs$$.map(r=>r.unsubscribe()),this.map.geolocationController.followPosition=this.userDefinedFollowPosition}onLocationTypeChange(r){this.mapProximityState.proximitylocationType$.next(r.value)}copyTextToClipboard(){At.copy(this.mapProximityState.currentPositionCoordinate$?.value.toString())&&this.messageService.success("igo.integration.map-proximity-tool.copyMsg","igo.integration.map-proximity-tool.copyTitle")}static \u0275fac=function(t){return new(t||Il)(e.Y36(ne),e.Y36(Cd),e.Y36(L),e.Y36(_e))};static \u0275cmp=e.Xpm({type:Il,selectors:[["igo-map-proximity-tool"]],viewQuery:function(t,o){if(1&t&&e.Gf(XO,7),2&t){let i;e.iGM(i=e.CRH())&&(o.table=i.first)}},decls:31,vars:35,consts:[[1,"table-compact",3,"store","template"],["table",""],["class","coordinates",4,"ngIf"],["class","coordinates2",4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"title-container"],[1,"title","mat-typography"],[1,"igo-input-container","mat-typography"],[3,"change"],["value","geolocation",3,"checked"],["value","mapCenter",3,"checked"],[1,"radius-unit"],["floatLabel","always",1,"radius-field"],["type","number","pattern","[0-9]*","matInput","",3,"ngModel","placeholder","ngModelChange"],[1,"coordinates"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],[1,"coordinates2"],["mat-icon-button","",3,"click"],["svgIcon","content-copy"]],template:function(t,o){1&t&&(e._UZ(0,"igo-entity-table",0,1)(2,"br"),e.YNc(3,eA,4,4,"mat-form-field",2),e.ALo(4,"async"),e.YNc(5,tA,4,4,"mat-form-field",3),e.ALo(6,"async"),e.YNc(7,oA,2,0,"button",4),e.ALo(8,"async"),e.ALo(9,"async"),e.TgZ(10,"div",5)(11,"mat-label",6),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"div",7)(15,"mat-radio-group",8),e.NdJ("change",function(s){return o.onLocationTypeChange(s)}),e.TgZ(16,"mat-radio-button",9),e.ALo(17,"async"),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"mat-radio-button",10),e.ALo(21,"async"),e._uU(22),e.ALo(23,"translate"),e.qZA()()(),e.TgZ(24,"div",11)(25,"mat-form-field",12)(26,"mat-label"),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"input",13),e.NdJ("ngModelChange",function(s){return o.maxDistance=s}),e.ALo(30,"translate"),e.qZA()()()),2&t&&(e.Q6J("store",o.mapProximityState.proximityFeatureStore)("template",o.tableTemplate),e.xp6(3),e.Q6J("ngIf",e.lcZ(4,13,o.mapProximityState.currentPositionCoordinate$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,15,o.mapProximityState.currentPositionCoordinate$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(8,17,o.mapProximityState.currentPositionCoordinate$)&&e.lcZ(9,19,o.mapProximityState.currentPositionCoordinate$).length),e.xp6(5),e.Oqu(e.lcZ(13,21,"igo.integration.map-proximity-tool.method")),e.xp6(4),e.Q6J("checked","geolocation"===e.lcZ(17,23,o.mapProximityState.proximitylocationType$)),e.xp6(2),e.Oqu(e.lcZ(19,25,"igo.integration.map-proximity-tool.geolocation")),e.xp6(2),e.Q6J("checked","mapCenter"===e.lcZ(21,27,o.mapProximityState.proximitylocationType$)),e.xp6(2),e.Oqu(e.lcZ(23,29,"igo.integration.map-proximity-tool.mapCenter")),e.xp6(5),e.Oqu(e.lcZ(28,31,"igo.integration.map-proximity-tool.radiusM")),e.xp6(2),e.s9C("placeholder",e.lcZ(30,33,"igo.integration.map-proximity-tool.radiusM")),e.Q6J("ngModel",o.maxDistance))},dependencies:[_.Fj,_.wV,_.JJ,_.c5,_.On,F.KE,F.hX,j.Nt,f.O5,w.Hw,nt.VQ,nt.U0,S.RK,Si,f.Ov,O.X$],styles:["[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none}[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{padding:10px 15px}[_nghost-%COMP%]   mat-form-field.coordinates[_ngcontent-%COMP%]{width:110px}[_nghost-%COMP%]   mat-form-field.coordinates2[_ngcontent-%COMP%]{width:100px;padding:0 10px 0 3px}[_nghost-%COMP%]   mat-form-field.igo-input-container[_ngcontent-%COMP%]{width:60%;padding:0 15px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:90%;margin-left:2px;padding:5px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]   mat-form-field.radius-field[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:100%}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}"]})};xd=(0,T.gn)([ke({name:"map-proximity",title:"igo.integration.tools.closestFeature",icon:"radius"}),(0,T.w6)("design:paramtypes",[ne,Cd,L,_e])],xd);let yl=(()=>{class n{igoStorageService;get storageService(){return this.igoStorageService}constructor(t){this.igoStorageService=t}static \u0275fac=function(o){return new(o||n)(e.LFG(oe))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function gs(n,r){n.entityStore.getStrategyOfType(Tt).setMotion(r.get("zoomAuto")?Y.Default:Y.None)}function bl(n,r,t,o,i,s,a,l,c,u,p){const d=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:i,handler:()=>{gs(n,a),a.set("zoomAuto",!a.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:tF(n),checkCondition:r,handler:()=>r.next(!r.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.tooltip",checkCondition:t,handler:()=>t.next(!t.value)},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:h=>{h.entityStore.state.updateMany(h.entityStore.view.all(),{selected:!1})},args:[n],availability:h=>function oF(n){return n.entityStore.stateView.manyBy$(r=>!0===r.state.selected).pipe((0,I.U)(r=>r.length>=1))}(h)},{id:"featureDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:h=>{const m=h.entityStore.getStrategyOfType(Vo),C=h.entityStore.getStrategyOfType(xi).active?[h.layer.id]:[];u.toolToActivateFromOptions({tool:"importExport",options:{layers:[h.layer.id],featureInMapExtent:m.active,layersWithSelection:C}})},args:[n]},{id:"ogcFilter",icon:"filter",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:(h,m)=>{m.activateWidget(h,{map:m.map,layer:m.layer})},args:[o,n]},{id:"maximize",title:l.translate.instant("igo.integration.workspace.maximize"),tooltip:l.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>s.pipe((0,I.U)(h=>!h&&!c.isMobile())),handler:()=>{c.isMobile()||s.next(!0)}},{id:"standardExtent",title:l.translate.instant("igo.integration.workspace.standardExtent"),tooltip:l.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>s.pipe((0,I.U)(h=>h&&!c.isMobile())),handler:()=>{s.next(!1)}},{id:"print",icon:"printer",title:"igo.integration.workspace.print.title",tooltip:"igo.integration.workspace.print.tooltip",handler:h=>{const m=`${h.layer.title} (${p.transform(Date.now(),"YYYY-MM-dd-H_mm")})`,b=new ts.default("landscape"),C="{total_pages_count_string}";b.text(m,14,20),b.autoTable({startY:25,tableWidth:"wrap",html:"#currentWorkspaceTable",horizontalPageBreak:!0,styles:{cellPadding:.5,minCellWidth:20,fontSize:6},didDrawPage:x=>{let A="Page "+b.internal.getNumberOfPages();"function"==typeof b.putTotalPages&&(A=A+" / "+C),b.setFontSize(6);const M=b.internal.pageSize,k=M.height?M.height:M.getHeight();b.text(A,x.settings.margin.left,k-10)}}),"function"==typeof b.putTotalPages&&b.putTotalPages(C),b.save(`${m}.pdf`)},args:[n]}];let g=n.layer.dataSource.options.ogcFilters?.enabled?d:d.filter(h=>"ogcFilter"!==h.id);return g=!1!==n.layer.options.workspace.printable?d:d.filter(h=>"print"!==h.id),g}let iA=(()=>{class n{ogcFilterWidget;storageState;languageService;mediaService;toolState;datePipe;maximize$;zoomAuto$=new y.X(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,o,i,s,a,l){this.ogcFilterWidget=t,this.storageState=o,this.languageService=i,this.mediaService=s,this.toolState=a,this.datePipe=l,this.maximize$=new y.X(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(t,o,i){const s=this.buildActions(t,o,i);t.actionStore.load(s)}buildActions(t,o,i){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Kt.n)(s=>"zoomAuto"!==s?.key||s?.event===Yo.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),gs(t,this.storageService)}),bl(t,o,i,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState,this.datePipe)}static \u0275fac=function(o){return new(o||n)(e.LFG(Ya),e.LFG(yl),e.LFG(L),e.LFG(ct),e.LFG(Qe),e.LFG(f.uU))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),nA=(()=>{class n{storageState;languageService;toolState;mediaService;datePipe;maximize$;zoomAuto$=new y.X(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,o,i,s,a){this.storageState=t,this.languageService=o,this.toolState=i,this.mediaService=s,this.datePipe=a,this.maximize$=new y.X(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(t,o,i){const s=this.buildActions(t,o,i);t.actionStore.load(s)}buildActions(t,o,i){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Kt.n)(s=>"zoomAuto"!==s?.key||s?.event===Yo.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),gs(t,this.storageService)}),bl(t,o,i,void 0,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState,this.datePipe)}static \u0275fac=function(o){return new(o||n)(e.LFG(yl),e.LFG(L),e.LFG(Qe),e.LFG(ct),e.LFG(f.uU))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),rA=(()=>{class n{ogcFilterWidget;storageState;languageService;mediaService;toolState;datePipe;maximize$;selectOnlyCheckCondition$=new y.X(!1);zoomAuto$=new y.X(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,o,i,s,a,l){this.ogcFilterWidget=t,this.storageState=o,this.languageService=i,this.mediaService=s,this.toolState=a,this.datePipe=l,this.maximize$=new y.X(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(t,o,i){const s=this.buildActions(t,o,i);t.actionStore.load(s)}buildActions(t,o,i){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Kt.n)(s=>"zoomAuto"!==s?.key||s?.event===Yo.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),gs(t,this.storageService)}),bl(t,o,i,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState,this.datePipe)}static \u0275fac=function(o){return new(o||n)(e.LFG(Ya),e.LFG(yl),e.LFG(L),e.LFG(ct),e.LFG(Qe),e.LFG(f.uU))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ri=(()=>{class n{featureActionsService;wfsActionsService;editionActionsService;storageService;workspacePanelExpanded=!1;workspaceEnabled$=new y.X(!1);rowsInMapExtentCheckCondition$=new y.X(!0);selectOnlyCheckCondition$=new y.X(!1);workspaceMaximize$;actionMaximize$$=[];rowsInMapExtentCheckCondition$$;selectOnlyCheckCondition$$;activeWorkspace$$;activeWorkspaceWidget$$;activeWorkspaceWidget$=new y.X(void 0);workspace$=new y.X(void 0);get store(){return this._store}_store;get workspaceSelection(){return this.workspace$.value?this.workspace$.value?.entityStore.stateView.manyBy(t=>!0===t.state.selected):[]}get workspaceSelection$(){return this.workspace$.value?this.workspace$.value?.entityStore?.stateView.manyBy$(t=>!0===t.state.selected):(0,z.of)([])}constructor(t,o,i,s){this.featureActionsService=t,this.wfsActionsService=o,this.editionActionsService=i,this.storageService=s,this.workspaceMaximize$=new y.X(this.storageService.get("workspaceMaximize")),this.initWorkspaces()}initWorkspaces(){this._store=new Jc([]),this._store.stateView.firstBy$(t=>!0===t.state.active).subscribe(t=>{this.workspace$.next(t?t.entity:void 0)}),this._store.stateView.all$().subscribe(t=>{t.map(o=>{o.entity.actionStore.empty&&(o.entity instanceof pl?this.wfsActionsService.loadActions(o.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):o.entity instanceof ml?this.featureActionsService.loadActions(o.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):o.entity instanceof ad&&this.editionActionsService.loadActions(o.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$))})}),this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(t=>{this.setWorkspaceIsMaximized(t)})),this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(t=>{this.setWorkspaceIsMaximized(t)})),this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(t=>{this.setWorkspaceIsMaximized(t)})),this.activeWorkspace$$=this.workspace$.subscribe(t=>{void 0!==this.activeWorkspaceWidget$$&&(this.activeWorkspaceWidget$$.unsubscribe(),this.activeWorkspaceWidget$$=void 0),void 0!==t&&(this.activeWorkspaceWidget$$=t.widget$.subscribe(o=>this.activeWorkspaceWidget$.next(o)))}),this.rowsInMapExtentCheckCondition$$=this.rowsInMapExtentCheckCondition$.subscribe(t=>{this._store.stateView.all().map(o=>{if(!o.entity.actionStore.empty){const i=o.entity.entityStore.getStrategyOfType(Vo);i&&(t?i.activate():i.deactivate())}})}),this.selectOnlyCheckCondition$$=this.selectOnlyCheckCondition$.subscribe(t=>{this._store.stateView.all().map(o=>{if(!o.entity.actionStore.empty){const i=o.entity.entityStore.getStrategyOfType(xi);i&&(t?i.activate():i.deactivate())}})})}setWorkspaceIsMaximized(t){this.storageService.set("workspaceMaximize",t),this.workspaceMaximize$.next(t)}setActiveWorkspaceById(t){const o=this.store.all().find(i=>i.id===t);o&&this.store.activateWorkspace(o)}setActiveWorkspaceByTitle(t){const o=this.store.all().find(i=>i.title===t);o&&this.store.activateWorkspace(o)}ngOnDestroy(){this.teardownWorkspaces(),this.actionMaximize$$.map(t=>t.unsubscribe()),this.rowsInMapExtentCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe(),this.selectOnlyCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe()}teardownWorkspaces(){this.store.clear(),void 0!==this.activeWorkspaceWidget$$&&this.activeWorkspaceWidget$$.unsubscribe(),void 0!==this.activeWorkspace$$&&this.activeWorkspace$$.unsubscribe()}static \u0275fac=function(o){return new(o||n)(e.LFG(nA),e.LFG(rA),e.LFG(iA),e.LFG(oe))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function sA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.activateWorkspace())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.integration.workspace.toggleWorkspace"))("color",t.color)}}let vl=(()=>{class n{workspaceState;hasWorkspace$=new y.X(!1);hasWorkspace$$;_layer;layer$=new y.X(void 0);set layer(t){this._layer=t,this.layer$.next(this._layer)}get layer(){return this._layer}color="primary";constructor(t){this.workspaceState=t}ngOnInit(){this.hasWorkspace$$=(0,Ye.a)([this.workspaceState.workspaceEnabled$,this.layer$]).subscribe(t=>this.hasWorkspace$.next(t[0]&&t[1]?.options.workspace?.enabled))}ngOnDestroy(){this.hasWorkspace$$.unsubscribe()}activateWorkspace(){this.workspaceState.workspace$.value&&this.workspaceState.workspace$.value.layer.id===this.layer.id&&this.workspaceState.workspacePanelExpanded?this.workspaceState.workspacePanelExpanded=!1:(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(this.layer.id))}static \u0275fac=function(o){return new(o||n)(e.Y36(Ri))};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-workspace-button"]],inputs:{layer:"layer",color:"color"},decls:2,vars:3,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","table"]],template:function(o,i){1&o&&(e.YNc(0,sA,3,4,"button",0),e.ALo(1,"async")),2&o&&e.Q6J("ngIf",e.lcZ(1,1,i.hasWorkspace$))},dependencies:[f.O5,w.Hw,S.RK,P.gM,f.Ov,O.X$],changeDetection:0})}return n})();function aA(n,r){if(1&n){const t=e.EpF();e._UZ(0,"igo-workspace-button",4),e.TgZ(1,"igo-export-button",5),e.NdJ("click",function(){const s=e.CHM(t).layer,a=e.oxw(2);return e.KtG(a.activateExport(s))}),e.qZA(),e._UZ(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&n){const t=r.layer,o=e.oxw(2);e.Q6J("layer",t),e.xp6(1),e.Q6J("layer",t),e.xp6(1),e.Q6J("header",o.ogcButton)("layer",t),e.xp6(1),e.Q6J("header",o.timeButton)("layer",t),e.xp6(1),e.Q6J("trackFeature",!0)("layer",t),e.xp6(1),e.Q6J("layer",t)}}function lA(n,r){if(1&n&&(e.TgZ(0,"igo-layer-list",2),e.YNc(1,aA,6,9,"ng-template",null,3,e.W1O),e.qZA()),2&n){const t=e.oxw();e.Q6J("map",t.map)("excludeBaseLayers",t.excludeBaseLayers)("layerFilterAndSortOptions",t.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",t.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",t.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)("queryBadge",t.queryBadge)}}function cA(n,r){1&n&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.integration.mapTool.customize")," "))}function uA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",11),e.O4$(),e.TgZ(2,"svg",12),e._UZ(3,"path",13),e.qZA()(),e.kcU(),e.TgZ(4,"span",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.searchEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.search-tool")," "))}function pA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",11),e.O4$(),e.TgZ(2,"svg",12),e._UZ(3,"path",15),e.qZA()(),e.kcU(),e.TgZ(4,"span",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.catalogEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.catalog-tool")," "))}function dA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",11),e.O4$(),e.TgZ(2,"svg",12),e._UZ(3,"path",17),e.qZA()(),e.kcU(),e.TgZ(4,"span",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.contextEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.context-tool")," "))}function gA(n,r){if(1&n&&(e.TgZ(0,"mat-list")(1,"p",9),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,cA,3,3,"p",10),e.YNc(5,uA,7,3,"mat-list-item",8),e.YNc(6,pA,7,3,"mat-list-item",8),e.YNc(7,dA,7,3,"mat-list-item",8),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.integration.mapTool.empty")," "),e.xp6(2),e.Q6J("ngIf",t.layerAdditionAllowed&&(t.searchToolInToolbar||t.catalogToolInToolbar||t.contextToolInToolbar)),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.searchToolInToolbar),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.catalogToolInToolbar),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.contextToolInToolbar)}}function mA(n,r){if(1&n&&e.YNc(0,gA,8,7,"mat-list",8),2&n){const t=e.oxw();e.Q6J("ngIf",t.delayedShowEmptyMapContent)}}let Sd=class Zl{mapState;toolState;searchSourceService;cdRef;importExportState;delayedShowEmptyMapContent=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;layerAdditionAllowed=!0;get map(){return this.mapState.map}get layers$(){return this.map.layers$.pipe((0,I.U)(r=>r.filter(t=>!(!1===t.showInLayerList||this.excludeBaseLayers&&t.baseLayer))))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const r=Object.assign({showToolbar:gt.default},this.layerListControls);switch(this.layerListControls.showToolbar){case gt.always:r.showToolbar=gt.always;break;case gt.never:r.showToolbar=gt.never}return r}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(Hn).filter(r=>r.available&&"Layer"===r.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(r,t,o,i,s){this.mapState=r,this.toolState=t,this.searchSourceService=o,this.cdRef=i,this.importExportState=s}ngOnInit(){setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}activateExport(r){let t=r.id;r.options.workspace?.workspaceId&&(t=r.options.workspace.workspaceId!==r.id?r.options.workspace.workspaceId:r.id),this.importExportState.setsExportOptions({layers:[t]}),this.importExportState.setMode(ui.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(t){return new(t||Zl)(e.Y36(ne),e.Y36(Qe),e.Y36(Bt),e.Y36(e.sBO),e.Y36(co))};static \u0275cmp=e.Xpm({type:Zl,selectors:[["igo-map-details-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge",layerAdditionAllowed:"layerAdditionAllowed"},decls:4,vars:4,consts:[["class","mapDetailsList","igoLayerListBinding","","floatLabel","never",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge",4,"ngIf","ngIfElse"],["empty",""],["igoLayerListBinding","","floatLabel","never",1,"mapDetailsList",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoLayerItemToolbar",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"],[4,"ngIf"],[1,"map-empty","mat-typography"],["class","map-empty mat-typography",4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(t,o){if(1&t&&(e.YNc(0,lA,3,7,"igo-layer-list",0),e.ALo(1,"async"),e.YNc(2,mA,1,1,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(3);e.Q6J("ngIf",e.lcZ(1,2,o.layers$).length)("ngIfElse",i)}},dependencies:[f.O5,Z.i$,Z.Tg,Z.Yt,Z.sL,w.Hw,Mi,Yr,Hr,Xi,el,Yn,Nn,vl,f.Ov,O.X$],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}[_nghost-%COMP%]   .mapDetailsList[_ngcontent-%COMP%]{overflow:hidden}"]})};Sd=(0,T.gn)([ke({name:"mapDetails",title:"igo.integration.tools.map",icon:"map"}),(0,T.w6)("design:paramtypes",[ne,Qe,Bt,e.sBO,co])],Sd);let wd=(()=>{class n{mapService;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,o){this.mapService=o,this.component=t}ngOnInit(){this.component.layers=[],this.layersOrResolutionChange$$=(0,Ye.a)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,ae.b)(10)).subscribe(t=>{const o=t[0].filter(i=>!0===i.showInLayerList);this.component.layers=o,this.layersVisibility$$=(0,Ye.a)(o.map(i=>i.visible$)).subscribe(i=>{this.component.change$.next()})})}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(o){return new(o||n)(e.Y36(Zn,2),e.Y36(Gt))};static \u0275dir=e.lG2({type:n,selectors:[["","igoLayerLegendListBinding",""]]})}return n})();function hA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-layer-legend-list",4),e.NdJ("allLegendsShown",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowAllLegends(i))}),e.ALo(1,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("excludeBaseLayers",t.excludeBaseLayers)("allowShowAllLegends",t.allowShowAllLegends)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)("showAllLegendsValue",e.lcZ(1,4,t.showAllLegendsValue$))}}function fA(n,r){}function _A(n,r){1&n&&e.YNc(0,fA,0,0,"ng-template")}function yA(n,r){if(1&n&&(e.TgZ(0,"p",5),e._uU(1),e.ALo(2,"async"),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,t.visibleLayers$).length?e.lcZ(3,3,"igo.integration.mapTool.noLayersInRange"):e.lcZ(4,5,"igo.integration.mapTool.noLayersVisible"),"\n")}}function bA(n,r){1&n&&(e.TgZ(0,"p",5),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.integration.mapTool.customize")," "))}function vA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.O4$(),e.TgZ(2,"svg",8),e._UZ(3,"path",9),e.qZA()(),e.kcU(),e.TgZ(4,"span",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.searchEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.search-tool")," "))}function CA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.O4$(),e.TgZ(2,"svg",8),e._UZ(3,"path",11),e.qZA()(),e.kcU(),e.TgZ(4,"span",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.catalogEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.catalog-tool")," "))}function xA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.O4$(),e.TgZ(2,"svg",8),e._UZ(3,"path",13),e.qZA()(),e.kcU(),e.TgZ(4,"span",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.contextEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.context-tool")," "))}function SA(n,r){if(1&n&&(e.TgZ(0,"mat-list")(1,"p",5),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,bA,3,3,"p",2),e.YNc(5,vA,7,3,"mat-list-item",6),e.YNc(6,CA,7,3,"mat-list-item",6),e.YNc(7,xA,7,3,"mat-list-item",6),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.integration.mapTool.empty")," "),e.xp6(2),e.Q6J("ngIf",t.layerAdditionAllowed&&(t.searchToolInToolbar||t.catalogToolInToolbar||t.contextToolInToolbar)),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.searchToolInToolbar),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.catalogToolInToolbar),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.contextToolInToolbar)}}function wA(n,r){if(1&n&&e.YNc(0,SA,8,7,"mat-list",6),2&n){const t=e.oxw();e.Q6J("ngIf",t.delayedShowEmptyMapContent)}}let Td=class Pl{mapState;toolState;searchSourceService;cdRef;delayedShowEmptyMapContent=!1;layers$=new y.X([]);showAllLegendsValue$=new y.X(!1);change$=new hn.t(1);resolution$$;visibleOrInRangeLayers$$;updateLegendOnResolutionChange=!1;layerAdditionAllowed=!0;allowShowAllLegends=!1;showAllLegendsValue=!1;layerListControls={};get map(){return this.mapState.map}get visibleOrInRangeLayers$(){return this.layers$.pipe((0,I.U)(r=>r.filter(t=>t.visible$.value&&t.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,I.U)(r=>r.filter(t=>t.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(Hn).filter(r=>r.available&&"Layer"===r.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(r,t,o,i){this.mapState=r,this.toolState=t,this.searchSourceService=o,this.cdRef=i}ngOnInit(){this.resolution$$=(0,Ye.a)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,ae.b)(10)).subscribe(r=>{this.layers$.next(r[0].filter(t=>!(!1===t.showInLayerList||this.excludeBaseLayers&&t.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}onShowAllLegends(r){this.mapState.showAllLegendsValue=r,this.showAllLegendsValue$.next(r)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let r;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(t=>{r=0!==t.length}),!1===r)return!1}return!0}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(t){return new(t||Pl)(e.Y36(ne),e.Y36(Qe),e.Y36(Bt),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:Pl,selectors:[["igo-map-legend-tool"]],inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layerAdditionAllowed:"layerAdditionAllowed",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",layerListControls:"layerListControls"},decls:8,vars:10,consts:[["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(t,o){if(1&t&&(e.YNc(0,hA,2,6,"igo-layer-legend-list",0),e.YNc(1,_A,1,0,null,1),e.ALo(2,"async"),e.YNc(3,yA,5,7,"p",2),e.ALo(4,"async"),e.ALo(5,"async"),e.YNc(6,wA,1,1,"ng-template",null,3,e.W1O)),2&t){const i=e.MAs(7);e.Q6J("ngIf",o.showAllLegend()),e.xp6(1),e.Q6J("ngIf",0!==e.lcZ(2,4,o.layers$).length)("ngIfElse",i),e.xp6(2),e.Q6J("ngIf",!o.allowShowAllLegends&&0!==e.lcZ(4,6,o.layers$).length&&0===e.lcZ(5,8,o.visibleOrInRangeLayers$).length)}},dependencies:[f.O5,Z.i$,Z.Tg,Z.Yt,Z.sL,w.Hw,Zn,wd,f.Ov,O.X$],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"]})};function TA(n,r){if(1&n){const t=e.EpF();e._UZ(0,"igo-workspace-button",4),e.TgZ(1,"igo-export-button",5),e.NdJ("click",function(){const s=e.CHM(t).layer,a=e.oxw();return e.KtG(a.activateExport(s))}),e.qZA(),e._UZ(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&n){const t=r.layer,o=e.oxw();e.Q6J("layer",t),e.xp6(1),e.Q6J("layer",t),e.xp6(1),e.Q6J("header",o.ogcButton)("layer",t),e.xp6(1),e.Q6J("header",o.timeButton)("layer",t),e.xp6(1),e.Q6J("trackFeature",!0)("layer",t),e.xp6(1),e.Q6J("layer",t)}}Td=(0,T.gn)([ke({name:"mapLegend",title:"igo.integration.tools.legend",icon:"format-list-bulleted-type"}),(0,T.w6)("design:paramtypes",[ne,Qe,Bt,e.sBO])],Td);let Fd=class kl{mapState;toolState;importExportState;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;get map(){return this.mapState.map}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const r=Object.assign({showToolbar:gt.default},this.layerListControls);switch(this.layerListControls.showToolbar){case gt.always:r.showToolbar=gt.always;break;case gt.never:r.showToolbar=gt.never}return r}constructor(r,t,o){this.mapState=r,this.toolState=t,this.importExportState=o}activateExport(r){let t=r.id;r.options.workspace?.workspaceId&&(t=r.options.workspace.workspaceId!==r.id?r.options.workspace.workspaceId:r.id),this.importExportState.setsExportOptions({layers:[t]}),this.importExportState.setMode(ui.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(t){return new(t||kl)(e.Y36(ne),e.Y36(Qe),e.Y36(co))};static \u0275cmp=e.Xpm({type:kl,selectors:[["igo-map-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge"},decls:9,vars:14,consts:[[3,"label"],["igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","floatLabel","queryBadge"],["igoLayerItemToolbar",""],["igoContextListBinding",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-tab-group")(1,"mat-tab",0),e.ALo(2,"translate"),e.TgZ(3,"igo-layer-list",1),e.YNc(4,TA,6,9,"ng-template",null,2,e.W1O),e.qZA()(),e.TgZ(6,"mat-tab",0),e.ALo(7,"translate"),e._UZ(8,"igo-context-list",3),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("label",e.lcZ(2,10,"igo.integration.tools.map")),e.xp6(2),e.Q6J("map",o.map)("excludeBaseLayers",o.excludeBaseLayers)("layerFilterAndSortOptions",o.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",o.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",o.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange)("floatLabel",!1)("queryBadge",o.queryBadge),e.xp6(3),e.Q6J("label",e.lcZ(7,12,"igo.integration.tools.contexts")))},dependencies:[ht.uX,ht.SP,Mi,Yr,Hr,Xi,el,Yn,Nn,us,fl,vl,O.X$],styles:["[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}"],changeDetection:0})};Fd=(0,T.gn)([ke({name:"map",title:"igo.integration.tools.map",icon:"map"}),(0,T.w6)("design:paramtypes",[ne,Qe,co])],Fd);let ms=(()=>{class n{keyword$=new y.X("");sortAlpha$=new y.X(void 0);onlyVisible$=new y.X(void 0);selectedTab$=new y.X(void 0);setKeyword(t){this.keyword$.next(t)}setSortAlpha(t){this.sortAlpha$.next(t)}setOnlyVisible(t){this.onlyVisible$.next(t)}setSelectedTab(t){this.selectedTab$.next(t)}getLayerListControls(){return{keyword:this.keyword$.value,onlyVisible:this.onlyVisible$.value,sortAlpha:this.sortAlpha$.value}}static \u0275fac=function(o){return new(o||n)};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const FA=["tabGroup"];function OA(n,r){if(1&n&&e._UZ(0,"igo-style-modal-layer-button",11),2&n){const t=e.oxw().layer;e.Q6J("layer",t)}}function AA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-time-filter-button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.activateTimeFilter())}),e.qZA()}if(2&n){const t=e.oxw().layer,o=e.oxw(2);e.Q6J("header",o.timeButton)("layer",t)}}function LA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-ogc-filter-button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.activateOgcFilter())}),e.qZA()}if(2&n){const t=e.oxw().layer,o=e.oxw(2);e.Q6J("header",o.ogcButton)("layer",t)}}function MA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-export-button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().layer,s=e.oxw(2);return e.KtG(s.activateExport(i))}),e.qZA()}if(2&n){const t=e.oxw().layer;e.Q6J("layer",t)}}function IA(n,r){if(1&n&&(e.YNc(0,OA,1,1,"igo-style-modal-layer-button",10),e._UZ(1,"igo-metadata-button",11)(2,"igo-track-feature-button",12),e.YNc(3,AA,1,2,"igo-time-filter-button",13),e.YNc(4,LA,1,2,"igo-ogc-filter-button",13),e.YNc(5,MA,1,1,"igo-export-button",14),e._UZ(6,"igo-workspace-button",11)),2&n){const t=r.layer,o=e.oxw(2);e.Q6J("ngIf",o.isStyleEditButton(t)),e.xp6(1),e.Q6J("layer",t),e.xp6(1),e.Q6J("trackFeature",!0)("layer",t),e.xp6(1),e.Q6J("ngIf",o.isTimeFilterButton(t)),e.xp6(1),e.Q6J("ngIf",o.isOGCFilterButton(t)),e.xp6(1),e.Q6J("ngIf",o.isExportButton(t)),e.xp6(1),e.Q6J("layer",t)}}function ZA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-layer-list",8),e.NdJ("appliedFilterAndSort",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onLayerListChange(i))}),e.YNc(1,IA,7,8,"ng-template",null,9,e.W1O),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("excludeBaseLayers",t.excludeBaseLayers)("layerFilterAndSortOptions",t.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",t.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",t.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)("floatLabel",!1)("queryBadge",t.queryBadge)("map",t.map)}}function PA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-layer-legend-list",17),e.NdJ("allLegendsShown",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowAllLegends(i))}),e.ALo(1,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("allowShowAllLegends",t.allowShowAllLegends)("showAllLegendsValue",e.lcZ(1,4,t.showAllLegendsValue$))("excludeBaseLayers",t.excludeBaseLayers)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}function kA(n,r){}function $A(n,r){1&n&&e.YNc(0,kA,0,0,"ng-template")}function DA(n,r){if(1&n&&(e.TgZ(0,"p",18),e._uU(1),e.ALo(2,"async"),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,t.visibleLayers$).length?e.lcZ(3,3,"igo.integration.mapTool.noLayersInRange"):e.lcZ(4,5,"igo.integration.mapTool.noLayersVisible")," ")}}function EA(n,r){1&n&&(e.TgZ(0,"p",18),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.integration.mapTool.customize")," "))}function RA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",20),e.O4$(),e.TgZ(2,"svg",21),e._UZ(3,"path",22),e.qZA()(),e.kcU(),e.TgZ(4,"span",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.searchEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.search-tool")," "))}function NA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",20),e.O4$(),e.TgZ(2,"svg",21),e._UZ(3,"path",24),e.qZA()(),e.kcU(),e.TgZ(4,"span",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.catalogEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.catalog-tool")," "))}function BA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",20),e.O4$(),e.TgZ(2,"svg",21),e._UZ(3,"path",26),e.qZA()(),e.kcU(),e.TgZ(4,"span",27),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.contextEmit())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,1,"igo.integration.mapTool.context-tool")," "))}function JA(n,r){if(1&n&&(e.TgZ(0,"mat-list")(1,"p",18),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,EA,3,3,"p",6),e.YNc(5,RA,7,3,"mat-list-item",19),e.YNc(6,NA,7,3,"mat-list-item",19),e.YNc(7,BA,7,3,"mat-list-item",19),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.integration.mapTool.empty")," "),e.xp6(2),e.Q6J("ngIf",t.layerAdditionAllowed&&(t.searchToolInToolbar||t.catalogToolInToolbar||t.contextToolInToolbar)),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.searchToolInToolbar),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.catalogToolInToolbar),e.xp6(1),e.Q6J("ngIf",t.layerAdditionAllowed&&t.contextToolInToolbar)}}function UA(n,r){if(1&n&&e.YNc(0,JA,8,7,"mat-list",19),2&n){const t=e.oxw();e.Q6J("ngIf",t.delayedShowEmptyMapContent)}}let Od=class $l{layerListToolState;toolState;mapState;searchSourceService;importExportState;layers$=new y.X([]);showAllLegendsValue$=new y.X(!1);resolution$$;visibleOrInRangeLayers$$;delayedShowEmptyMapContent=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;selectedTabAtOpening;ogcButton=!0;timeButton=!0;layerAdditionAllowed=!0;get layerListControls(){return this._layerListControls}set layerListControls(r){const t=this.layerListToolState.getLayerListControls(),o=t.keyword,i=t.onlyVisible,s=t.sortAlpha;r.keyword=""!==o?o:r.keyword,r.onlyVisible=void 0!==i?i:r.onlyVisible,r.sortAlpha=void 0!==s?s:r.sortAlpha,r.onlyVisible=void 0!==r.onlyVisible&&r.onlyVisible,r.sortAlpha=void 0!==r.sortAlpha&&r.sortAlpha,this._layerListControls=r}_layerListControls={};get map(){return this.mapState.map}queryBadge=!1;get visibleOrInRangeLayers$(){return this.layers$.pipe((0,I.U)(r=>r.filter(t=>t.visible$.value&&t.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,I.U)(r=>r.filter(t=>t.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const r=Object.assign({showToolbar:gt.default},this.layerListControls);switch(this.layerListControls.showToolbar){case gt.always:r.showToolbar=gt.always;break;case gt.never:r.showToolbar=gt.never}return r}tabGroup;get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(Hn).filter(r=>r.available&&"Layer"===r.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(r,t,o,i,s){this.layerListToolState=r,this.toolState=t,this.mapState=o,this.searchSourceService=i,this.importExportState=s}ngOnInit(){this.selectedTab(),this.resolution$$=(0,Ye.a)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,ae.b)(10)).subscribe(r=>{this.layers$.next(r[0].filter(t=>!(!1===t.showInLayerList||this.excludeBaseLayers&&t.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>this.delayedShowEmptyMapContent=!0,250)}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}onShowAllLegends(r){this.mapState.showAllLegendsValue=r,this.showAllLegendsValue$.next(r)}selectedTab(){const r=this.layerListToolState.selectedTab$.value;this.layerListToolState.setSelectedTab(void 0!==r?r:"legend"===this.selectedTabAtOpening?1:0)}tabChanged(r){this.layerListToolState.setSelectedTab(r.index),this.layers$.next(this.map.layers.filter(t=>!(!1===t.showInLayerList||this.excludeBaseLayers&&t.baseLayer)))}onLayerListChange(r){this.layerListToolState.setKeyword(r.keyword),this.layerListToolState.setSortAlpha(r.sortAlpha),this.layerListToolState.setOnlyVisible(r.onlyVisible)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let r;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(t=>{r=0!==t.length}),!1===r)return!1}return!0}activateExport(r){let t=r.id;r.options.workspace?.workspaceId&&(t=r.options.workspace.workspaceId!==r.id?r.options.workspace.workspaceId:r.id),this.importExportState.setsExportOptions({layers:[t]}),this.importExportState.setMode(ui.export),this.toolState.toolbox.activateTool("importExport")}activateTimeFilter(){this.toolState.toolbox.activateTool("activeTimeFilter")}activateOgcFilter(){this.toolState.toolbox.activateTool("activeOgcFilter")}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}isTimeFilterButton(r){const t=r.dataSource.options;return this.timeButton&&t.timeFilterable&&t.timeFilter}isOGCFilterButton(r){const t=r.dataSource.options;return this.ogcButton&&t.ogcFilters&&t.ogcFilters.enabled&&(t.ogcFilters.pushButtons||t.ogcFilters.checkboxes||t.ogcFilters.radioButtons||t.ogcFilters.select||t.ogcFilters.autocomplete||t.ogcFilters.editable)}isExportButton(r){return!!(r instanceof xe&&!0===r.exportable||r.dataSource.options.download&&r.dataSource.options.download.url||r.options.workspace?.enabled&&r.options.workspace?.workspaceId!==r.id)}isStyleEditButton(r){return!!(r instanceof xe&&r.options?.igoStyle?.editable)}static \u0275fac=function(t){return new(t||$l)(e.Y36(ms),e.Y36(Qe),e.Y36(ne),e.Y36(Bt),e.Y36(co))};static \u0275cmp=e.Xpm({type:$l,selectors:[["igo-map-tools"]],viewQuery:function(t,o){if(1&t&&e.Gf(FA,7),2&t){let i;e.iGM(i=e.CRH())&&(o.tabGroup=i.first)}},inputs:{allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",selectedTabAtOpening:"selectedTabAtOpening",ogcButton:"ogcButton",timeButton:"timeButton",layerAdditionAllowed:"layerAdditionAllowed",layerListControls:"layerListControls",queryBadge:"queryBadge"},decls:17,vars:23,consts:[[3,"selectedIndex","selectedTabChange"],["tabGroup",""],[3,"label"],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","floatLabel","queryBadge","map","appliedFilterAndSort",4,"ngIf","ngIfElse"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","floatLabel","queryBadge","map","appliedFilterAndSort"],["igoLayerItemToolbar",""],[3,"layer",4,"ngIf"],[3,"layer"],[3,"trackFeature","layer"],[3,"header","layer","click",4,"ngIf"],[3,"layer","click",4,"ngIf"],[3,"header","layer","click"],[3,"layer","click"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(t,o){if(1&t&&(e.TgZ(0,"mat-tab-group",0,1),e.NdJ("selectedTabChange",function(s){return o.tabChanged(s)}),e.ALo(2,"async"),e.TgZ(3,"mat-tab",2),e.ALo(4,"translate"),e.YNc(5,ZA,3,8,"igo-layer-list",3),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"mat-tab",2),e.ALo(8,"translate"),e.YNc(9,PA,2,6,"igo-layer-legend-list",4),e.YNc(10,$A,1,0,null,5),e.ALo(11,"async"),e.YNc(12,DA,5,7,"p",6),e.ALo(13,"async"),e.ALo(14,"async"),e.qZA(),e.YNc(15,UA,1,1,"ng-template",null,7,e.W1O),e.qZA()),2&t){const i=e.MAs(16);e.Q6J("selectedIndex",e.lcZ(2,9,o.layerListToolState.selectedTab$)),e.xp6(3),e.Q6J("label",e.lcZ(4,11,"igo.integration.tools.layers")),e.xp6(2),e.Q6J("ngIf",0!==e.lcZ(6,13,o.layers$).length)("ngIfElse",i),e.xp6(2),e.Q6J("label",e.lcZ(8,15,"igo.integration.tools.legend")),e.xp6(2),e.Q6J("ngIf",o.showAllLegend()),e.xp6(1),e.Q6J("ngIf",0!==e.lcZ(11,17,o.layers$).length)("ngIfElse",i),e.xp6(2),e.Q6J("ngIf",!o.allowShowAllLegends&&0!==e.lcZ(13,19,o.layers$).length&&0===e.lcZ(14,21,o.visibleOrInRangeLayers$).length)}},dependencies:[f.O5,ht.uX,ht.SP,Z.i$,Z.Tg,Z.Yt,Z.sL,w.Hw,Mi,Zn,Yr,wd,Hr,Xi,el,gF,Yn,Nn,vl,f.Ov,O.X$],styles:["[_nghost-%COMP%]   mat-tab-group[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{flex:1}[_nghost-%COMP%]     .mat-tab-body{margin-top:8px}[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"],changeDetection:0})};Od=(0,T.gn)([ke({name:"mapTools",title:"igo.integration.tools.map",icon:"map"}),(0,T.w6)("design:paramtypes",[ms,Qe,ne,Bt,co])],Od);let Cl=(()=>{class n{searchSourceService;storageService;workspaceState;configService;mapState;searchLayerStores=[];searchOverlayStyle={};searchOverlayStyleSelection={};searchOverlayStyleFocus={};focusedOrResolution$$;selectedOrResolution$$;searchTermSplitter$=new y.X("|");searchTerm$=new y.X(void 0);searchType$=new y.X(void 0);searchDisabled$=new y.X(!1);searchResultsGeometryEnabled$=new y.X(!1);searchSettingsChange$=new y.X(void 0);selectedResult$=new y.X(void 0);store=new hr([]);get searchTypes(){return this.searchSourceService.getEnabledSources().map(t=>t.constructor.type)}constructor(t,o,i,s,a){this.searchSourceService=t,this.storageService=o,this.workspaceState=i,this.configService=s,this.mapState=a;const l=this.configService.getConfig("searchOverlayStyle");l&&(this.searchOverlayStyle=l.base,this.searchOverlayStyleSelection=l.selection,this.searchOverlayStyleFocus=l.focus);const c=this.storageService.get("searchResultsGeometryEnabled");c&&this.searchResultsGeometryEnabled$.next(c),this.store.addStrategy(this.createCustomFilterTermStrategy(),!1);const u=this.searchSourceService.getSources().find(p=>"workspace"===p.getId());this.workspaceState.store.entities$.subscribe(p=>{const d=p.filter(g=>g instanceof ml&&g.layer.options.workspace.searchIndexEnabled);this.searchSourceService.setWorkspaces(u,d)}),this.monitorLayerDeletion()}monitorLayerDeletion(){this.mapState.map.layers$.subscribe(t=>{this.searchLayerStores.forEach(o=>{if(!t.find(s=>s.id===o.layer.id)){const s=this.searchLayerStores.indexOf(o);this.searchLayerStores.splice(s,1)}})})}createCustomFilterTermStrategy(){return new Vo({filterClauseFunc:o=>100===o.entity.meta.score})}activateCustomFilterTermStrategy(){const t=this.store.getStrategyOfType(Vo);void 0!==t&&t.activate()}deactivateCustomFilterTermStrategy(){const t=this.store.getStrategyOfType(Vo);void 0!==t&&t.deactivate()}enableSearch(){this.searchDisabled$.next(!1)}disableSearch(){this.searchDisabled$.next(!0)}setSearchTerm(t){this.searchTerm$.next(t)}setSearchType(t){this.searchSourceService.enableSourcesByType(t),this.searchType$.next(t)}setSearchSettingsChange(){this.searchSettingsChange$.next(!0)}setSelectedResult(t){this.selectedResult$.next(t)}setSearchResultsGeometryStatus(t){this.storageService.set("searchResultsGeometryEnabled",t),this.searchResultsGeometryEnabled$.next(t)}static \u0275fac=function(o){return new(o||n)(e.LFG(Bt),e.LFG(oe),e.LFG(Ri),e.LFG(N),e.LFG(ne))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ad=class Dl{toolState;mapState;toolToOpenOnContextChange="mapTools";get map(){return this.mapState.map}constructor(r,t){this.toolState=r,this.mapState=t}editContext(){this.toolState.toolbox.activateTool("contextEditor")}managePermissions(){this.toolState.toolbox.activateTool("contextPermissionManager")}static \u0275fac=function(t){return new(t||Dl)(e.Y36(Qe),e.Y36(ne))};static \u0275cmp=e.Xpm({type:Dl,selectors:[["igo-context-manager-tool"]],inputs:{toolToOpenOnContextChange:"toolToOpenOnContextChange"},decls:1,vars:1,consts:[["igoContextListBinding","",3,"map","edit","managePermissions"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-context-list",0),e.NdJ("edit",function(){return o.editContext()})("managePermissions",function(){return o.managePermissions()}),e.qZA()),2&t&&e.Q6J("map",o.map)},dependencies:[us,fl],encapsulation:2})};Ad=(0,T.gn)([ke({name:"contextManager",title:"igo.integration.tools.contexts",icon:"star"}),(0,T.w6)("design:paramtypes",[Qe,ne])],Ad);let Ld=class El{toolState;constructor(r){this.toolState=r}submitSuccessed(){this.toolState.toolbox.activatePreviousTool()}static \u0275fac=function(t){return new(t||El)(e.Y36(Qe))};static \u0275cmp=e.Xpm({type:El,selectors:[["igo-context-editor-tool"]],decls:1,vars:0,consts:[["igoContextEditBinding","",3,"submitSuccessed"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-context-edit",0),e.NdJ("submitSuccessed",function(){return o.submitSuccessed()}),e.qZA())},dependencies:[hd,C6],encapsulation:2})};Ld=(0,T.gn)([ke({name:"contextEditor",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"}),(0,T.w6)("design:paramtypes",[Qe])],Ld);let Md=class Rl{static \u0275fac=function(t){return new(t||Rl)};static \u0275cmp=e.Xpm({type:Rl,selectors:[["igo-context-permission-manager-tool"]],decls:1,vars:0,consts:[["igoContextPermissionsBinding",""]],template:function(t,o){1&t&&e._UZ(0,"igo-context-permissions",0)},dependencies:[fd,P6],encapsulation:2})};Md=(0,T.gn)([ke({name:"contextPermissionManager",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"})],Md);let Id=class Nl{mapState;layerListToolState;get map(){return this.mapState.map}get layerListControls(){return this.layerListToolState.getLayerListControls()}constructor(r,t){this.mapState=r,this.layerListToolState=t}static \u0275fac=function(t){return new(t||Nl)(e.Y36(ne),e.Y36(ms))};static \u0275cmp=e.Xpm({type:Nl,selectors:[["igo-context-share-tool"]],decls:1,vars:1,consts:[[3,"map"]],template:function(t,o){1&t&&e._UZ(0,"igo-share-map",0),2&t&&e.Q6J("map",o.map)},dependencies:[o3],encapsulation:2})};Id=(0,T.gn)([ke({name:"shareMap",title:"igo.integration.tools.shareMap",icon:"share-variant"}),(0,T.w6)("design:paramtypes",[ne,ms])],Id);let hs=(()=>{class n{get catalogStore(){return this._catalogStore}_catalogStore;catalogItemsStores=new Map;constructor(t){this._catalogStore=new xt([]),t.authenticate$.subscribe(()=>{this.clearCatalogItemsStores()})}getCatalogItemsStore(t){return this.catalogItemsStores.get(t.id)}setCatalogItemsStore(t,o){this.catalogItemsStores.set(t.id,o)}clearCatalogItemsStores(){this.catalogItemsStores.clear()}static \u0275fac=function(o){return new(o||n)(e.LFG(He))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function GA(n,r){if(1&n&&e._UZ(0,"igo-catalog-browser",1),2&n){const t=r.ngIf,o=e.oxw();e.Q6J("catalog",o.catalog)("store",t)("map",o.map)("toggleCollapsedGroup",o.toggleCollapsedGroup)}}let Zd=class Bl{catalogService;catalogState;mapState;authService;catalog;store$=new y.X(void 0);catalog$$;authenticate$$;toggleCollapsedGroup=!0;get map(){return this.mapState.map}constructor(r,t,o,i){this.catalogService=r,this.catalogState=t,this.mapState=o,this.authService=i}ngOnInit(){this.catalog$$=this.catalogState.catalogStore.stateView.firstBy$(t=>!0===t.state.selected).subscribe(t=>{t&&t.entity&&(this.catalog=t.entity)}),this.authenticate$$=this.authService.authenticate$.subscribe(()=>{this.loadCatalogItems(this.catalog)})}ngOnDestroy(){this.catalog$$.unsubscribe(),this.authenticate$$.unsubscribe()}loadCatalogItems(r){let t=this.catalogState.getCatalogItemsStore(r);void 0===t?(t=new xt([]),this.catalogState.setCatalogItemsStore(r,t),this.catalogService.loadCatalogItems(r).pipe((0,mt.q)(1)).subscribe(o=>{t.load(o),this.store$.next(t)})):this.store$.next(t)}static \u0275fac=function(t){return new(t||Bl)(e.Y36(Dn),e.Y36(hs),e.Y36(ne),e.Y36(He))};static \u0275cmp=e.Xpm({type:Bl,selectors:[["igo-catalog-browser-tool"]],inputs:{toggleCollapsedGroup:"toggleCollapsedGroup"},decls:2,vars:3,consts:[[3,"catalog","store","map","toggleCollapsedGroup",4,"ngIf"],[3,"catalog","store","map","toggleCollapsedGroup"]],template:function(t,o){1&t&&(e.YNc(0,GA,1,4,"igo-catalog-browser",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.store$))},dependencies:[f.O5,wa,f.Ov],encapsulation:2,changeDetection:0})};Zd=(0,T.gn)([ke({name:"catalogBrowser",title:"igo.integration.tools.catalog",icon:"photo-browser",parent:"catalog"}),(0,T.w6)("design:paramtypes",[Dn,hs,ne,He])],Zd);let Pd=class Jl{catalogService;catalogState;toolState;storageService;get store(){return this.catalogState.catalogStore}addCatalogAllowed=!1;predefinedCatalogs=[];constructor(r,t,o,i){this.catalogService=r,this.catalogState=t,this.toolState=o,this.storageService=i}ngOnInit(){0===this.store.count&&this.loadCatalogs()}onCatalogSelectChange(r){!1!==r.selected&&this.toolState.toolbox.activateTool("catalogBrowser")}loadCatalogs(){this.catalogService.loadCatalogs().pipe((0,mt.q)(1)).subscribe(r=>{this.store.clear(),this.store.load(r.concat(this.storageService.get("addedCatalogs")||[]))})}static \u0275fac=function(t){return new(t||Jl)(e.Y36(Dn),e.Y36(hs),e.Y36(Qe),e.Y36(oe))};static \u0275cmp=e.Xpm({type:Jl,selectors:[["igo-catalog-library-tool"]],inputs:{addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},decls:1,vars:3,consts:[[3,"predefinedCatalogs","addCatalogAllowed","store","catalogSelectChange"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-catalog-library",0),e.NdJ("catalogSelectChange",function(s){return o.onCatalogSelectChange(s)}),e.qZA()),2&t&&e.Q6J("predefinedCatalogs",o.predefinedCatalogs)("addCatalogAllowed",o.addCatalogAllowed)("store",o.store)},dependencies:[Ta],encapsulation:2,changeDetection:0})};Pd=(0,T.gn)([ke({name:"catalog",title:"igo.integration.tools.catalog",icon:"layers-plus"}),(0,T.w6)("design:paramtypes",[Dn,hs,Qe,oe])],Pd);let fs=(()=>{class n{mapState;zoomToActiveRoute$=new fe.x;stopsStore=new Yp([]);stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounceTime=200;constructor(t){this.mapState=t,this.stopsFeatureStore=new Hp([],{map:this.mapState.map}),this.routesFeatureStore=new Vp([],{map:this.mapState.map}),this.stepFeatureStore=new zp([],{map:this.mapState.map}),this.mapState.map.ol.once("rendercomplete",()=>{this.stopsFeatureStore.empty$.subscribe(o=>{this.stopsFeatureStore.layer?.options&&(this.stopsFeatureStore.layer.options.showInLayerList=!o)}),this.routesFeatureStore.empty$.subscribe(o=>{this.routesFeatureStore.layer?.options&&(this.routesFeatureStore.layer.options.showInLayerList=!o)})}),this.mapState.map.layers$.subscribe(()=>{this.mapState.map.getLayerById("igo-direction-stops-layer")||(this.stopsStore.deleteMany(this.stopsStore.all()),this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all())),this.mapState.map.getLayerById("igo-direction-route-layer")||this.routesFeatureStore.deleteMany(this.routesFeatureStore.all())})}static \u0275fac=function(o){return new(o||n)(e.LFG(ne))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),kd=class Ul{directionState;mapState;languageService;messageService;storageService;contextState;authService;currentContextUri;get stopsStore(){return this.directionState.stopsStore}get debounceTime(){return this.directionState.debounceTime}get stopsFeatureStore(){return this.directionState.stopsFeatureStore}get routesFeatureStore(){return this.directionState.routesFeatureStore}get stepFeatureStore(){return this.directionState.stepFeatureStore}get zoomToActiveRoute$(){return this.directionState.zoomToActiveRoute$}get map(){return this.mapState.map}constructor(r,t,o,i,s,a,l){this.directionState=r,this.mapState=t,this.languageService=o,this.messageService=i,this.storageService=s,this.contextState=a,this.authService=l}ngOnInit(){this.storageService.get("direction.warning.shown")||(this.messageService.info("igo.integration.directions.warning.message","igo.integration.directions.warning.title",{timeOut:2e4}),this.storageService.set("direction.warning.shown",!0,Pe.SESSION)),this.contextState.context$.subscribe(t=>{this.authService.authenticated||(this.currentContextUri=t.uri)})}static \u0275fac=function(t){return new(t||Ul)(e.Y36(fs),e.Y36(ne),e.Y36(L),e.Y36(_e),e.Y36(oe),e.Y36(ds),e.Y36(He))};static \u0275cmp=e.Xpm({type:Ul,selectors:[["igo-directions-tool"]],decls:1,vars:7,consts:[[3,"contextUri","debounceTime","stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(t,o){1&t&&e._UZ(0,"igo-directions",0),2&t&&e.Q6J("contextUri",o.currentContextUri)("debounceTime",o.debounceTime)("stopsStore",o.stopsStore)("stopsFeatureStore",o.stopsFeatureStore)("stepFeatureStore",o.stepFeatureStore)("routesFeatureStore",o.routesFeatureStore)("zoomToActiveRoute$",o.zoomToActiveRoute$)},dependencies:[Kp],encapsulation:2})};kd=(0,T.gn)([ke({name:"directions",title:"igo.integration.tools.directions",icon:"directions"}),(0,T.w6)("design:paramtypes",[fs,ne,L,_e,oe,ds,He])],kd);let $d=(()=>{class n{mapState;stores=[];layersID=[];drawControls=[];activeDrawingLayer;constructor(t){this.mapState=t,this.mapState.map.layers$.subscribe(()=>{this.layersID.forEach(o=>{if(!this.mapState.map.getLayerById(o)){let i=this.stores.find(a=>a.layer.id===o);i.deleteMany(i.all()),this.stores.splice(this.stores.indexOf(i,0),1),this.layersID.splice(this.layersID.indexOf(o,0),1);let s=this.drawControls.findIndex(a=>a[0]===o);this.drawControls.splice(s,1)}})});for(let o of this.stores)o=new yt([],{map:this.mapState.map})}static \u0275fac=function(o){return new(o||n)(e.LFG(ne))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Dd=class Gl{drawState;mapState;get stores(){return this.drawState.stores}get map(){return this.mapState.map}get layersID(){return this.drawState.layersID}get drawControls(){return this.drawState.drawControls}set drawControls(r){this.drawState.drawControls=r}get activeDrawingLayer(){return this.drawState.activeDrawingLayer}set activeDrawingLayer(r){this.drawState.activeDrawingLayer=r}addLayersID(r){this.layersID.push(r)}addDrawControls(r){this.drawControls=r}constructor(r,t){this.drawState=r,this.mapState=t}static \u0275fac=function(t){return new(t||Gl)(e.Y36($d),e.Y36(ne))};static \u0275cmp=e.Xpm({type:Gl,selectors:[["igo-drawing-tool"]],decls:1,vars:4,consts:[[3,"stores","map","activeDrawingLayer","drawControls","layersIDEvent","drawControlsEvent","activeLayerChange"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-draw",0),e.NdJ("layersIDEvent",function(s){return o.addLayersID(s)})("drawControlsEvent",function(s){return o.addDrawControls(s)})("activeLayerChange",function(s){return o.activeDrawingLayer=s}),e.qZA()),2&t&&e.Q6J("stores",o.stores)("map",o.map)("activeDrawingLayer",o.activeDrawingLayer)("drawControls",o.drawControls)},dependencies:[Mp],encapsulation:2,changeDetection:0})};Dd=(0,T.gn)([ke({name:"draw",title:"igo.integration.tools.draw",icon:"draw"}),(0,T.w6)("design:paramtypes",[$d,ne])],Dd);let Ed=class ql{constructor(){}static \u0275fac=function(t){return new(t||ql)};static \u0275cmp=e.Xpm({type:ql,selectors:[["igo-ogc-filter-tool"]],decls:1,vars:0,consts:[["igoOgcFilterableListBinding",""]],template:function(t,o){1&t&&e._UZ(0,"igo-ogc-filterable-list",0)},dependencies:[Jr,jS],encapsulation:2})};function qA(n="300ms",r="ease-in-out"){return(0,ye.X$)("toolSlideInOut",[(0,ye.SB)("enter",(0,ye.oB)({transform:"translateX(100%)"})),(0,ye.eR)("void => enter",(0,ye.jt)(n+" "+r))])}Ed=(0,T.gn)([ke({name:"ogcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter"}),(0,T.w6)("design:paramtypes",[])],Ed);let Rd=class jl{mapState;get map(){return this.mapState.map}get layer(){for(const r of this.map.layers)if(!0===r.options.active)return r}animate="enter";constructor(r){this.mapState=r}static \u0275fac=function(t){return new(t||jl)(e.Y36(ne))};static \u0275cmp=e.Xpm({type:jl,selectors:[["igo-active-ogc-filter-tool"]],decls:1,vars:4,consts:[[3,"map","layer","header"]],template:function(t,o){1&t&&e._UZ(0,"igo-ogc-filterable-item",0),2&t&&e.Q6J("map",o.map)("layer",o.layer)("header",!1)("@toolSlideInOut",o.animate)},dependencies:[Bn],encapsulation:2,data:{animation:[qA()]}})};function jA(n,r){if(1&n&&(e.ynx(0),e._UZ(1,"igo-feature-details",3),e.BQk()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("feature",t)}}Rd=(0,T.gn)([ke({name:"activeOgcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter",parent:"mapTools"}),(0,T.w6)("design:paramtypes",[ne])],Rd);let Nd=class Ql{matIconRegistry;spatialFilterService;dataSourceService;layerService;mapState;messageService;languageService;importExportState;toolState;workspaceState;cdRef;get map(){return this.mapState.map}type;itemType=Ft.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new y.X(void 0);format=new Ce.Z;store=new hr([]);spatialListStore=new xt([]);loading=!1;thematicLength=0;measureUnit=K.Meters;unsubscribe$=new fe.x;moveendKey;defaultStyle;constructor(r,t,o,i,s,a,l,c,u,p,d){this.matIconRegistry=r,this.spatialFilterService=t,this.dataSourceService=o,this.layerService=i,this.mapState=s,this.messageService=a,this.languageService=l,this.importExportState=c,this.toolState=u,this.workspaceState=p,this.cdRef=d}ngOnInit(){for(const r of this.map.layers)r.title&&r.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(r)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(r){this.type=r,this.queryType=void 0}getOutputQueryType(r){this.queryType=r,this.queryType&&this.loadFilterList()}activateExportTool(){const r=[],t=new RegExp("^Zone \\d+");for(const o of this.layers)o.title.match(t)||r.push(o.id);this.importExportState.setMode(ui.export),this.importExportState.setsExportOptions({layers:r}),this.toolState.toolbox.activateTool("importExport")}activateWorkspace(r){let t;this.workspaceState.store.entities$.pipe((0,ko.R)(this.unsubscribe$)).subscribe(()=>{if(!r&&this.activeLayers.length&&this.workspaceState.store.all().length>1){if(this.itemType===Ft.Thematics){for(const o of this.thematics)if(!o.zeroResults){t=this.activeLayers.find(i=>i.title.includes(o.name+" "+this.iterator.toString()));break}}else{const o="Adresses "+this.iterator.toString();this.activeLayers.forEach(i=>{i.title.includes(o)&&(t=i)})}t&&(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(t.id))}else r&&this.activeLayers.length&&this.workspaceState.store.all().length>1&&(this.selectWorkspaceEntity(r),this.moveendKey=this.map.ol.on("moveend",()=>{this.selectWorkspaceEntity(r)}))})}selectWorkspaceEntity(r){this.workspaceState.store.all().forEach(t=>{t.entityStore.state.updateAll({selected:!1}),t.title.includes(r.added[0].meta.title)&&(this.workspaceState.setActiveWorkspaceById(t.id),t.entityStore.state.updateMany(r.added,{selected:!0}))})}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,ko.R)(this.unsubscribe$)).subscribe(r=>{r.sort((t,o)=>t.properties.nom<o.properties.nom?-1:t.properties.nom>o.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(r)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===be.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let t,r=!0;(0===this.buffer||this.type===be.Point)&&this.tryAddFeaturesToMap([this.zone]),t=this.itemType!==Ft.Thematics?[{name:""}]:this.thematics,this.measureUnit===K.Kilometers&&this.type!==be.Point&&(this.buffer=1e3*this.buffer),this.type===be.Polygon&&(this.buffer=0);const o=[];t.forEach(i=>{o.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,i,this.buffer).pipe((0,Bi.b)(s=>{this.store.insertMany(s);const a=[],l=[];let c,u;s.forEach(p=>{"Point"===p.geometry.type?(p.properties.longitude=p.geometry.coordinates[0],p.properties.latitude=p.geometry.coordinates[1],a.push(p),c=p.meta.id):(l.push(p),u=p.meta.id)}),this.tryAddPointToMap(a,c),this.tryAddLayerToMap(l,u),s.length?(r=!1,this.thematicLength+=1,i.zeroResults=!1,this.cdRef.detectChanges()):i.zeroResults=!0,s.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,Qt.D)(o).pipe((0,ko.R)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,r&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(r,t){this.zone=r,r&&(t?this.tryAddFeaturesToMap([r],!0):this.tryAddFeaturesToMap([r]),this.zoomToFeatureExtent(r))}tryAddFeaturesToMap(r,t){let o=1;for(const i of r){if(this.type===be.Predefined)for(const s of this.layers){if(s.options._internal&&s.options._internal.code===i.properties.code&&!t){if(!s.title?.startsWith("Zone")){const a=this.layers.indexOf(s);this.layers.splice(a,1)}return}if(s.title?.startsWith("Zone")){this.activeLayers=[];const a=this.layers.indexOf(s);this.layers.splice(a,1),this.map.removeLayer(s)}}else{if(t)for(const s of this.activeLayers)if(1===this.activeLayers.length&&s.title?.startsWith("Zone")){const a=this.layers.indexOf(s);this.layers.splice(a,1),this.map.removeLayer(s)}this.activeLayers=[]}for(const s of this.layers)s.title?.startsWith("Zone")&&o++;this.defaultStyle=(s,a)=>{const l=r[0].coordinates;return new J.ZP({image:new Te.Z({radius:l?this.buffer/Math.cos(Math.PI/180*l[1])/a:void 0,fill:new q.Z({color:"rgba(200, 200, 20, 0.2)"}),stroke:new U.Z({width:1,color:"orange"})}),stroke:new U.Z({width:1,color:"orange"}),fill:new q.Z({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,mt.q)(1)).subscribe(s=>{const a=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+o+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===be.Predefined?i.properties.code:void 0},source:s,visible:!0}),l=r.map(u=>ft(u,this.map.projection));if(this.type!==be.Predefined){const u=this.type===be.Point?"Cercle":"Polygone";l[0].set("nom","Zone",!0),l[0].set("type",u,!0)}s.ol.addFeatures(l),a.ol.setStyle(this.defaultStyle),this.map.addLayer(a),this.layers.push(a),this.activeLayers.push(a),this.cdRef.detectChanges()})}}tryAddPointToMap(r,t){let o=1;if(r.length){if(void 0===this.map)return;for(const i of this.layers)i.title?.startsWith(r[0].meta.title)&&o++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:t,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,mt.q)(1)).subscribe(i=>{const s=r[0].meta.icon;let a;a=s&&this.createSvgIcon(s)||Xo();const l=this.layerService.createLayer({isIgoInternalLayer:!0,title:r[0].meta.title+" "+o+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:i,visible:!0,style:a}),c=r.map(p=>ft(p,this.map.projection));i.ol.getSource().addFeatures(c),this.layers.find(p=>p.id===l.id)&&(this.map.removeLayer(this.layers.find(p=>p.id===l.id)),o-=1,l.title=r[0].meta.title+" "+o+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),l.options.title=l.title),this.iterator=o,this.map.addLayer(l),this.layers.push(l),this.pushLayer(l),this.cdRef.detectChanges()})}}createSvgIcon(r){let t;return this.matIconRegistry.getNamedSvgIcon(r).subscribe(o=>{const i=new XMLSerializer;o.setAttribute("width","30"),o.setAttribute("height","30"),o.setAttribute("fill","rgba(0, 128, 255)"),o.setAttribute("stroke","white");const s=i.serializeToString(o);t=new J.ZP({image:new Fi.Z({src:"data:image/svg+xml;utf8,"+s})})}),t}tryAddLayerToMap(r,t){let o=1;if(r.length){if(void 0===this.map)return;for(const i of this.layers)i.title?.startsWith(r[0].meta.title)&&o++;this.dataSourceService.createAsyncDataSource({type:"vector",id:t,queryable:!0}).pipe((0,mt.q)(1)).subscribe(i=>{const s=this.layerService.createLayer({isIgoInternalLayer:!0,title:r[0].meta.title+" "+o+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:i,visible:!0}),a=r.map(c=>ft(c,this.map.projection));i.ol.addFeatures(a),this.layers.find(c=>c.id===s.id)&&(this.map.removeLayer(this.layers.find(c=>c.id===s.id)),o-=1,s.title=r[0].meta.title+" "+o+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),s.options.title=s.title),this.map.addLayer(s),this.layers.push(s),this.pushLayer(s),this.cdRef.detectChanges()})}}zoomToFeatureExtent(r){if(r){const t=this.format.readFeature(r,{dataProjection:r.projection,featureProjection:this.map.projection});vo(this.map.viewController,[t],Y.Zoom)}}pushLayer(r){for(const t of this.activeLayers)if(t.id===r.id)return;this.activeLayers.push(r)}static \u0275fac=function(t){return new(t||Ql)(e.Y36(w.jv),e.Y36(en),e.Y36(_t),e.Y36(Se),e.Y36(ne),e.Y36(_e),e.Y36(L),e.Y36(co),e.Y36(Qe),e.Y36(Ri),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:Ql,selectors:[["igo-spatial-filter-tool"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},decls:6,vars:16,consts:[[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent","export","openWorkspace","entityChange"],[4,"ngIf"],[3,"feature"]],template:function(t,o){1&t&&(e.TgZ(0,"igo-panel")(1,"igo-spatial-filter-type",0),e.NdJ("eventType",function(s){return o.getOutputType(s)})("eventQueryType",function(s){return o.getOutputQueryType(s)})("zoneChange",function(s){return o.onZoneChange(s)})("zoneWithBufferChange",function(s){return o.onZoneChange(s,!0)})("bufferChange",function(s){return o.buffer=s})("measureUnitChange",function(s){return o.measureUnit=s}),e.qZA(),e.TgZ(2,"igo-spatial-filter-item",1),e.NdJ("radiusEvent",function(s){return o.buffer=s})("bufferEvent",function(s){return o.buffer=s})("measureUnitChange",function(s){return o.measureUnit=s})("freehandControl",function(s){return o.freehandDrawIsActive=s})("drawZoneEvent",function(s){return o.zone=s})("zoneWithBufferChange",function(s){return o.onZoneChange(s,!0)})("itemTypeChange",function(s){return o.itemType=s})("thematicChange",function(s){return o.thematics=s})("toggleSearch",function(){return o.getOutputToggleSearch()})("clearButtonEvent",function(){return o.clearMap()})("clearSearchEvent",function(){return o.getOutputClearSearch()})("export",function(){return o.activateExportTool()})("openWorkspace",function(){return o.activateWorkspace()})("entityChange",function(s){return o.activateWorkspace(s)}),e.qZA()(),e.TgZ(3,"igo-panel"),e.YNc(4,jA,2,1,"ng-container",2),e.ALo(5,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("store",o.spatialListStore)("selectedQueryType",o.queryType)("zone",o.zone)("layers",o.activeLayers),e.xp6(1),e.Q6J("type",o.type)("queryType",o.queryType)("map",o.map)("zone",o.zone)("loading",o.loading)("store",o.store)("layers",o.activeLayers)("allLayers",o.layers)("thematicLength",o.thematicLength),e.xp6(2),e.Q6J("ngIf",e.lcZ(5,14,o.selectedFeature$)))},dependencies:[Na,Ra,f.O5,f.Ov],styles:["[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]{display:block;padding:0 12px}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:12px;padding:0 12px}"],changeDetection:0})};Nd=(0,T.gn)([ke({name:"spatialFilter",title:"igo.integration.tools.spatialFilter",icon:"selection-marker"}),(0,T.w6)("design:paramtypes",[w.jv,en,_t,Se,ne,_e,L,co,Qe,Ri,e.sBO])],Nd);let QA=(()=>{class n{mapService;component;layers$$;constructor(t,o){this.mapService=o,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(o){return new(o||n)(e.Y36(qr,2),e.Y36(Gt))};static \u0275dir=e.lG2({type:n,selectors:[["","igoTimeFilterListBinding",""]]})}return n})(),Bd=class Yl{constructor(){}static \u0275fac=function(t){return new(t||Yl)};static \u0275cmp=e.Xpm({type:Yl,selectors:[["igo-time-filter-tool"]],decls:1,vars:0,consts:[["igoTimeFilterListBinding",""]],template:function(t,o){1&t&&e._UZ(0,"igo-time-filter-list",0)},dependencies:[qr,QA],encapsulation:2})};function YA(n="300ms",r="ease-in-out"){return(0,ye.X$)("toolSlideInOut",[(0,ye.SB)("enter",(0,ye.oB)({transform:"translateX(100%)"})),(0,ye.eR)("void => enter",(0,ye.jt)(n+" "+r))])}Bd=(0,T.gn)([ke({name:"timeFilter",title:"igo.integration.tools.timeFilter",icon:"history"}),(0,T.w6)("design:paramtypes",[])],Bd);let Jd=class Hl{mapState;get map(){return this.mapState.map}get layer(){for(const r of this.map.layers)if(!0===r.options.active)return r}animate="enter";constructor(r){this.mapState=r}static \u0275fac=function(t){return new(t||Hl)(e.Y36(ne))};static \u0275cmp=e.Xpm({type:Hl,selectors:[["igo-active-time-filter-tool"]],decls:1,vars:4,consts:[[3,"map","layer","header"]],template:function(t,o){1&t&&e._UZ(0,"igo-time-filter-item",0),2&t&&e.Q6J("map",o.map)("layer",o.layer)("header",!1)("@toolSlideInOut",o.animate)},dependencies:[Gr],encapsulation:2,data:{animation:[YA()]}})};function HA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-tab-group")(1,"mat-tab",3),e.ALo(2,"translate"),e.TgZ(3,"igo-import-export",4),e.NdJ("selectMode",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.modeChanged(i))})("exportOptionsChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.exportOptionsChange(i))}),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()(),e.TgZ(6,"mat-tab",3),e.ALo(7,"translate"),e._UZ(8,"igo-context-import-export",5),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("label",e.lcZ(2,10,"igo.integration.importExportTool.importExportData")),e.xp6(2),e.Q6J("contextUri",e.lcZ(4,12,t.contextState.context$).uri)("map",t.map)("selectFirstProj",t.selectFirstProj)("projectionsLimitations",t.projectionsLimitations)("store",t.workspaceStore)("selectedMode",e.lcZ(5,14,t.importExportState.selectedMode$))("exportOptions$",t.importExportState.exportOptions$),e.xp6(3),e.Q6J("label",e.lcZ(7,16,"igo.integration.importExportTool.importExportContext")),e.xp6(2),e.Q6J("map",t.map)}}function VA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-import-export",6),e.NdJ("selectMode",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.modeChanged(i))})("exportOptionsChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.exportOptionsChange(i))}),e.ALo(1,"async"),e.ALo(2,"async"),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("contextUri",e.lcZ(1,5,t.contextState.context$).uri)("map",t.map)("store",t.workspaceStore)("selectedMode",e.lcZ(2,7,t.importExportState.selectedMode$))("exportOptions$",t.importExportState.exportOptions$)}}function zA(n,r){if(1&n&&e._UZ(0,"igo-context-import-export",5),2&n){const t=e.oxw();e.Q6J("map",t.map)}}Jd=(0,T.gn)([ke({name:"activeTimeFilter",title:"igo.integration.tools.timeFilter",icon:"history",parent:"mapTools"}),(0,T.w6)("design:paramtypes",[ne])],Jd);let Ud=class Vl{mapState;importExportState;workspaceState;contextState;projectionsLimitations;selectFirstProj=!1;get map(){return this.mapState.map}get workspaceStore(){return this.workspaceState.store}importExportType=ps.layer;importExportShowBothType=!0;constructor(r,t,o,i){this.mapState=r,this.importExportState=t,this.workspaceState=o,this.contextState=i}ngOnInit(){this.selectType(),this.selectMode()}selectType(){this.importExportType&&this.importExportState.importExportType$.next(this.importExportType);const r=this.importExportState.importExportType$.value;this.importExportState.setImportExportType(void 0!==r?r:ps.layer)}selectMode(){const r=this.importExportState.selectedMode$.value;this.importExportState.setMode(void 0!==r?r:ui.import)}modeChanged(r){this.importExportState.setMode(r)}exportOptionsChange(r){this.importExportState.setsExportOptions(r)}importExportTypeChange(r){this.importExportType=r.value}static \u0275fac=function(t){return new(t||Vl)(e.Y36(ne),e.Y36(co),e.Y36(Ri),e.Y36(ds))};static \u0275cmp=e.Xpm({type:Vl,selectors:[["igo-import-export-tool"]],inputs:{projectionsLimitations:"projectionsLimitations",selectFirstProj:"selectFirstProj",importExportType:"importExportType",importExportShowBothType:"importExportShowBothType"},decls:3,vars:3,consts:[[4,"ngIf"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange",4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"contextUri","map","selectFirstProj","projectionsLimitations","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"],[3,"map"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"]],template:function(t,o){1&t&&(e.YNc(0,HA,9,18,"mat-tab-group",0),e.YNc(1,VA,3,9,"igo-import-export",1),e.YNc(2,zA,1,1,"igo-context-import-export",2)),2&t&&(e.Q6J("ngIf",o.importExportShowBothType),e.xp6(1),e.Q6J("ngIf",!o.importExportShowBothType&&"layer"===o.importExportType),e.xp6(1),e.Q6J("ngIf",!o.importExportShowBothType&&"context"===o.importExportType))},dependencies:[Dp,md,f.O5,ht.uX,ht.SP,f.Ov,O.X$],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})};Ud=(0,T.gn)([ke({name:"importExport",title:"igo.integration.tools.importExport",icon:"file-move"}),(0,T.w6)("design:paramtypes",[ne,co,Ri,ds])],Ud);let Gd=(()=>{class n{mapState;store;constructor(t){this.mapState=t,this.store=new yt([],{map:this.mapState.map}),this.mapState.map.layers$.subscribe(o=>{0===o.filter(i=>i.id?.startsWith("igo-measures-")).length&&(this.store.deleteMany(this.store.all()),this.mapState.map.ol.getOverlays().getArray().filter(i=>i.options.className.includes("igo-map-tooltip")).map(i=>this.mapState.map.ol.removeOverlay(i)))})}static \u0275fac=function(o){return new(o||n)(e.LFG(ne))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),qd=class zl{measureState;mapState;get store(){return this.measureState.store}get map(){return this.mapState.map}constructor(r,t){this.measureState=r,this.mapState=t}static \u0275fac=function(t){return new(t||zl)(e.Y36(Gd),e.Y36(ne))};static \u0275cmp=e.Xpm({type:zl,selectors:[["igo-measurer-tool"]],decls:1,vars:2,consts:[[3,"store","map"]],template:function(t,o){1&t&&e._UZ(0,"igo-measurer",0),2&t&&e.Q6J("store",o.store)("map",o.map)},dependencies:[Ea],encapsulation:2,changeDetection:0})};qd=(0,T.gn)([ke({name:"measurer",title:"igo.integration.tools.measurer",icon:"ruler"}),(0,T.w6)("design:paramtypes",[Gd,ne])],qd);let jd=class Kl{mapState;get map(){return this.mapState.map}constructor(r){this.mapState=r}static \u0275fac=function(t){return new(t||Kl)(e.Y36(ne))};static \u0275cmp=e.Xpm({type:Kl,selectors:[["igo-print-tool"]],decls:1,vars:1,consts:[[3,"map"]],template:function(t,o){1&t&&e._UZ(0,"igo-print",0),2&t&&e.Q6J("map",o.map)},dependencies:[Gp],encapsulation:2})};function KA(n,r){1&n&&(e.TgZ(0,"div",2)(1,"section",3)(2,"h4")(3,"strong"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"p")(7,"strong"),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e._UZ(10,"div",4),e.ALo(11,"sanitizeHtml"),e.ALo(12,"translate"),e.qZA()()),2&n&&(e.xp6(4),e.Oqu(e.lcZ(5,3,"igo.integration.searchResultsTool.noResults")),e.xp6(4),e.Oqu(e.lcZ(9,5,"igo.integration.searchResultsTool.doSearch")),e.xp6(2),e.Q6J("innerHTML",e.lcZ(11,7,e.lcZ(12,9,"igo.integration.searchResultsTool.examples")),e.oJD))}function WA(n,r){if(1&n&&e._UZ(0,"igo-search-add-button",12),2&n){const t=r.result,o=e.oxw(2);e.Q6J("map",o.map)("store",o.store)("stores",o.stores)("layer",t)("saveSearchResultInLayer",o.saveSearchResultInLayer)}}function XA(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.zoomToFeatureExtent())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",19),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("matTooltip",e.lcZ(1,3,e.lcZ(2,5,t.isSelectedResultOutOfView$)?"igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView":"igo.integration.searchResultsTool.zoomOnFeatureTooltip")),e.xp6(3),e.Q6J("matBadge",e.lcZ(4,7,t.isSelectedResultOutOfView$)?"!":"")("matBadgeHidden",!1===e.lcZ(5,9,t.isSelectedResultOutOfView$))}}function eL(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-panel",13),e.NdJ("click",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.toggleTopPanel(i))}),e.TgZ(1,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.toggleTopPanel())}),e._UZ(2,"mat-icon",15),e.ALo(3,"async"),e.qZA(),e.YNc(4,XA,6,11,"button",16),e.TgZ(5,"igo-feature-details",17),e.NdJ("routingEvent",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.getRoute())}),e.ALo(6,"async"),e.qZA()()}if(2&n){const t=e.oxw(2);e.Q6J("title",t.featureTitle)("cursorPointer",!0),e.xp6(2),e.Q6J("svgIcon","collapsed"===e.lcZ(3,7,t.topPanelState$)?"arrow-up":"arrow-down"),e.xp6(2),e.Q6J("ngIf",t.feature.geometry),e.xp6(1),e.Q6J("feature",e.lcZ(6,9,t.feature$))("map",t.map)("toolbox",t.toolState.toolbox)}}function tL(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-flexible",5,6),e.ALo(2,"async"),e.TgZ(3,"div",7)(4,"igo-search-results",8),e.NdJ("resultFocus",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onResultFocus(i))})("resultSelect",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onResultSelect(i))})("resultUnfocus",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onResultUnfocus(i))})("resultMouseenter",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onResultFocus(i))})("resultMouseleave",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onResultUnfocus(i))})("moreResults",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.onSearch(i))}),e.YNc(5,WA,1,5,"ng-template",null,9,e.W1O),e.qZA()(),e.TgZ(7,"div",10),e.YNc(8,eL,7,11,"igo-panel",11),e.ALo(9,"async"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("state",e.lcZ(2,8,t.feature$)?t.topPanelState:"initial"),e.xp6(4),e.Q6J("store",t.store)("showIcons",t.showIcons)("term",t.term)("termSplitter",t.termSplitter)("settingsChange$",t.settingsChange$)("map",t.map),e.xp6(4),e.Q6J("ngIf",e.lcZ(9,10,t.feature$))}}jd=(0,T.gn)([ke({name:"print",title:"igo.integration.tools.print",icon:"printer"}),(0,T.w6)("design:paramtypes",[ne])],jd);let Qd=class Wl{mapState;searchState;elRef;toolState;directionState;showIcons=!0;topPanelStateDefault="expanded";hasFeatureEmphasisOnSelection=!1;saveSearchResultInLayer=!1;showResultsGeometries$$;getRoute$$;shownResultsGeometries=[];shownResultsEmphasisGeometries=[];focusedResult$=new y.X(void 0);isSelectedResultOutOfView$=new y.X(!1);isSelectedResultOutOfView$$;abstractFocusedResult;abstractSelectedResult;debouncedEmpty$=new y.X(!0);debouncedEmpty$$;get store(){return this.searchState.store}get map(){return this.mapState.map}get featureTitle(){return this.feature?ho(this.feature):void 0}get feature$(){return this.store.stateView.firstBy$(r=>r.state.focused).pipe((0,I.U)(r=>this.feature=r?r.entity.data:void 0))}feature;term="";searchTerm$$;settingsChange$=new y.X(void 0);topPanelState$=new y.X("initial");topPanelState$$;set topPanelState(r){this.topPanelState$.next(r)}get topPanelState(){return this.topPanelState$.value}get termSplitter(){return this.searchState.searchTermSplitter$.value}format=new Ce.Z;get stores(){return this.searchState.searchLayerStores}constructor(r,t,o,i,s,a){this.mapState=r,this.searchState=t,this.elRef=o,this.toolState=i,this.directionState=s,this.hasFeatureEmphasisOnSelection=a.getConfig("hasFeatureEmphasisOnSelection"),this.saveSearchResultInLayer=a.getConfig("saveSearchResultInLayer")}ngOnInit(){this.searchTerm$$=this.searchState.searchTerm$.subscribe(r=>{null!=r&&""!==r?(this.term=r,this.debouncedEmpty$.next(!1)):""===r&&this.debouncedEmpty$.next(!0)});for(const r of this.store.stateView.all$().value)!0===this.store.state.get(r.entity).selected&&(this.topPanelState="expanded");this.searchState.searchSettingsChange$.subscribe(()=>{this.settingsChange$.next(!0)}),this.topPanelState$$=this.topPanelState$.subscribe(()=>{const r=this.computeElementRef()[0],t=this.computeElementRef()[1];t&&setTimeout(()=>{this.isScrolledIntoView(r,t)||this.adjustTopPanel(r,t)},Ec.transitionTime+50)}),this.hasFeatureEmphasisOnSelection&&(this.searchState.focusedOrResolution$$||(this.searchState.focusedOrResolution$$=(0,Ye.a)([this.focusedResult$,this.map.viewController.resolution$]).subscribe(r=>this.buildResultEmphasis(r[0],"focused"))),this.searchState.selectedOrResolution$$||(this.searchState.selectedOrResolution$$=(0,Ye.a)([this.searchState.selectedResult$,this.map.viewController.resolution$]).subscribe(r=>this.buildResultEmphasis(r[0],"selected")))),this.monitorResultOutOfView(),this.showResultsGeometries$$=(0,Ye.a)([this.searchState.searchResultsGeometryEnabled$,this.store.stateView.all$(),this.focusedResult$,this.searchState.selectedResult$,this.searchState.searchTerm$,this.map.viewController.resolution$]).subscribe(r=>{const t=r[0],o=r[1];this.hasFeatureEmphasisOnSelection&&this.clearFeatureEmphasis("shown"),this.shownResultsGeometries.map(s=>this.map.queryResultsOverlay.removeFeature(s)),o.filter(s=>s.entity.meta.dataType===ie&&s.entity.data.geometry&&!s.state.selected&&!s.state.focused).map(s=>{t&&(s.entity.data.meta.style=dl(Object.assign({},{feature:s.entity.data},this.searchState.searchOverlayStyle,s.entity.style?.base?s.entity.style.base:{})),this.shownResultsGeometries.push(s.entity.data),this.map.queryResultsOverlay.addFeature(s.entity.data,Y.None),this.hasFeatureEmphasisOnSelection&&this.buildResultEmphasis(s.entity,"shown"))})}),this.debouncedEmpty$$=this.store.stateView.empty$.pipe((0,ae.b)(1500)).subscribe(r=>this.debouncedEmpty$.next(r))}monitorResultOutOfView(){this.isSelectedResultOutOfView$$=(0,Ye.a)([this.map.viewController.state$,this.searchState.selectedResult$]).pipe((0,ae.b)(100)).subscribe(r=>{const t=r[1];if(t){if(t.data.geometry){const i=Tn([ft(t.data,this.map.projection)],this.map.viewController.getOlProjection());this.isSelectedResultOutOfView$.next(ga(this.map.getExtent(),i))}}else this.isSelectedResultOutOfView$.next(!1)})}buildResultEmphasis(r,t){if("shown"!==t&&this.clearFeatureEmphasis(t),!r||!r.data.geometry)return;const i=ft(r.data,this.map.projection).getGeometry();if(lu(this.map.viewController,i.getExtent(),.0025)){const s=i.getExtent(),u=Li(new Ze.Z({name:`${t}AbstractResult'`,geometry:new Ee.Z([s[0]+(s[2]-s[0])/2,s[1]+(s[3]-s[1])/2])}),this.map.projection);let p,d=0;switch(t){case"focused":p=ci(Object.assign({},{feature:u},this.searchState.searchOverlayStyleFocus,r.style?.focus?r.style.focus:{})),d=2;break;case"shown":p=dl(Object.assign({},{feature:u},this.searchState.searchOverlayStyle,r.style?.base?r.style.base:{}));break;case"selected":p=ci(Object.assign({},{feature:u},this.searchState.searchOverlayStyleSelection,r.style?.selection?r.style.selection:{})),d=1}u.meta.style=p,u.meta.style.setZIndex(2e3+d),this.map.searchResultsOverlay.addFeature(u,Y.None),"focused"===t&&(this.abstractFocusedResult=u),"selected"===t&&(this.abstractSelectedResult=u),"shown"===t&&this.shownResultsEmphasisGeometries.push(u)}else this.clearFeatureEmphasis(t)}clearFeatureEmphasis(r){"focused"===r&&this.abstractFocusedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult),this.abstractFocusedResult=void 0),"selected"===r&&this.abstractSelectedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult),this.abstractSelectedResult=void 0),"shown"===r&&(this.shownResultsEmphasisGeometries.map(t=>this.map.searchResultsOverlay.removeFeature(t)),this.shownResultsEmphasisGeometries=[])}ngOnDestroy(){this.topPanelState$$.unsubscribe(),this.searchTerm$$.unsubscribe(),this.isSelectedResultOutOfView$$&&this.isSelectedResultOutOfView$$.unsubscribe(),this.showResultsGeometries$$&&this.showResultsGeometries$$.unsubscribe(),this.getRoute$$&&this.getRoute$$.unsubscribe(),this.debouncedEmpty$$&&this.debouncedEmpty$$.unsubscribe()}onResultFocus(r){if(this.focusedResult$.next(r),r.meta.dataType===ie&&r.data.geometry){r.data.meta.style=ci(Object.assign({},{feature:r.data},this.searchState.searchOverlayStyleFocus,r.style?.focus?r.style.focus:{}));const t=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(r.meta.id);if(t)return void t.setStyle(r.data.meta.style);this.map.searchResultsOverlay.addFeature(r.data,Y.None)}}onResultUnfocus(r){if(this.focusedResult$.next(void 0),r.meta.dataType===ie){if(!0===this.store.state.get(r).selected){const t=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(r.meta.id);if(t){const o=ci(Object.assign({},{feature:r.data},this.searchState.searchOverlayStyleFocus,r.style?.focus?r.style.focus:{}));t.setStyle(o)}return}this.map.searchResultsOverlay.removeFeature(r.data)}}onResultSelect(r){if(this.map.searchResultsOverlay.dataSource.ol.clear(),this.tryAddFeatureToMap(r),this.searchState.setSelectedResult(r),"initial"===this.topPanelState&&(this.topPanelState="collapsed"!==this.topPanelStateDefault?"expanded":"collapsed"),"expanded"===this.topPanelState){const t=this.computeElementRef()[0],o=this.computeElementRef()[1];this.isScrolledIntoView(t,o)||this.adjustTopPanel(t,o)}}onSearch(r){const t=r.results,o=this.store.entities$.value.filter(i=>i.source!==r.research.source).concat(t);this.store.load(o);for(const i of this.store.all())!0===this.store.state.get(i).focused&&!0!==this.store.state.get(i).selected&&this.store.state.update(i,{focused:!1},!0);setTimeout(()=>{const i=this.elRef.nativeElement.querySelector("igo-list");let s;r.research.request.subscribe(a=>{s=a[0]&&a[0].source?"icherche"===a[0].source.getId()?i.querySelector(".icherche .moreResults"):"ilayer"===a[0].source.getId()?i.querySelector(".ilayer .moreResults"):"nominatim"===a[0].source.getId()?i.querySelector(".nominatim .moreResults"):i.querySelector("."+a[0].source.getId()+" .moreResults"):null,null!==s&&!this.isScrolledIntoView(i,s)&&(i.scrollTop=s.offsetTop+s.offsetHeight-i.clientHeight)})},250)}computeElementRef(){const r=document.getElementsByTagName("igo-search-results-item"),t=this.elRef.nativeElement.getElementsByTagName("igo-list")[0];let o;for(let i=0;i<r.length;i++)r[i].className.includes("igo-list-item-selected")&&(o=r[i]);return[t,o]}adjustTopPanel(r,t){this.isScrolledIntoView(r,t)||(r.scrollTop=t.offsetTop+t.children[0].offsetHeight-r.clientHeight)}toggleTopPanel(r){r&&"igo-panel-title"!==r.target?.className||(this.topPanelState="expanded"===this.topPanelState?"collapsed":"expanded")}zoomToFeatureExtent(){if(this.feature.geometry){const r=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projectionCode});vo(this.map.viewController,[r],Y.Zoom)}}tryAddFeatureToMap(r){if(r.meta.dataType!==ie)return;const t=r.data;t.geometry&&(t.meta.style=ci(Object.assign({},{feature:t},this.searchState.searchOverlayStyleSelection,r.style?.selection?r.style.selection:{})),this.map.searchResultsOverlay.addFeature(t))}isScrolledIntoView(r,t){const i=r.scrollTop,a=t.offsetTop;return a+t.clientHeight+6<=i+r.clientHeight&&a>=i}getRoute(){this.toolState.toolbox.activateTool("directions"),this.directionState.stopsStore.clearStops(),setTimeout(()=>{let r=!1;this.getRoute$$&&this.getRoute$$.unsubscribe(),this.getRoute$$=this.directionState.stopsStore.storeInitialized$.subscribe(t=>{if(this.directionState.stopsStore.storeInitialized$.value&&!r){r=!0;const o=this.directionState.stopsStore.all().find(s=>1===s.position);let i;if(this.feature.geometry)if("Point"===this.feature.geometry.type)i=[this.feature.geometry.coordinates[0],this.feature.geometry.coordinates[1]];else{const s=(0,jr.Z)(this.feature.geometry);i=[s.geometry.coordinates[0],s.geometry.coordinates[1]]}if(o.text=this.featureTitle,o.coordinates=i,this.directionState.stopsStore.update(o),this.map.geolocationController.position$.value){const s=this.map.geolocationController.position$.value,a=this.directionState.stopsStore.all().find(u=>0===u.position),l=Q.vs(s.position,s.projection,"EPSG:4326"),c=pt([l[0],l[1]],6);a.text=c.join(","),a.coordinates=c,this.directionState.stopsStore.update(a)}}})},250)}static \u0275fac=function(t){return new(t||Wl)(e.Y36(ne),e.Y36(Cl),e.Y36(e.SBq),e.Y36(Qe),e.Y36(fs),e.Y36(N))};static \u0275cmp=e.Xpm({type:Wl,selectors:[["igo-search-results-tool"]],inputs:{showIcons:"showIcons",topPanelStateDefault:"topPanelStateDefault",topPanelState:"topPanelState"},decls:4,vars:6,consts:[["style","margin: 10px",4,"ngIf"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state",4,"ngIf"],[2,"margin","10px"],[1,"mat-typography"],[3,"innerHTML"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state"],["topPanel",""],[1,"igo-content"],["placeholder","false",3,"store","showIcons","term","termSplitter","settingsChange$","map","resultFocus","resultSelect","resultUnfocus","resultMouseenter","resultMouseleave","moreResults"],["igoSearchItemToolbar",""],["igoFlexibleFill","",1,"igo-content"],[3,"title","cursorPointer","click",4,"ngIf"],[3,"map","store","stores","layer","saveSearchResultInLayer"],[3,"title","cursorPointer","click"],["mat-icon-button","","panelLeftButton","",1,"igo-icon-button",3,"click"],[3,"svgIcon"],["mat-icon-button","","panelRightButton","","class","igo-icon-button","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoFeatureDetailsDirective","",3,"feature","map","toolbox","routingEvent"],["mat-icon-button","","panelRightButton","","matTooltipShowDelay","500",1,"igo-icon-button",3,"matTooltip","click"],["aria-hidden","false","matBadgeColor","accent","matBadgeSize","small","svgIcon","magnify-plus-outline",3,"matBadge","matBadgeHidden"]],template:function(t,o){1&t&&(e.YNc(0,KA,13,11,"div",0),e.ALo(1,"async"),e.YNc(2,tL,10,12,"igo-flexible",1),e.ALo(3,"async")),2&t&&(e.Q6J("ngIf",(!o.store||o.store.stateView.empty)&&e.lcZ(1,2,o.debouncedEmpty$)),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(3,4,o.debouncedEmpty$)))},dependencies:[f.O5,w.Hw,ut.k,P.gM,S.RK,Jn,pS,rd,td,Ec,Ht,f.Ov,O.X$,fr],encapsulation:2,changeDetection:0})};Qd=(0,T.gn)([ke({name:"searchResults",title:"igo.integration.tools.searchResults",icon:"magnify"}),(0,T.w6)("design:paramtypes",[ne,Cl,e.SBq,Qe,fs,N])],Qd);var oL=v(83517);let iL=(()=>{class n{overlay;viewContainerRef;elementRef;overlayRef;sub;menuContext;menuPosition=new e.vpe;constructor(t,o,i){this.overlay=t,this.viewContainerRef=o,this.elementRef=i}onContextMenu(t){let o,i;if(t instanceof TouchEvent?(o=t.touches[0].pageX,i=t.touches[0].pageY):t instanceof MouseEvent&&(o=t.x,i=t.y),!o||!i)return;this.close(),t.preventDefault(),this.menuPosition.emit({x:o,y:i}),this.overlayRef=null;const s=this.overlay.position().flexibleConnectedTo({x:o,y:i}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}]);this.overlayRef=this.overlay.create({positionStrategy:s,scrollStrategy:this.overlay.scrollStrategies.close()}),this.overlayRef.attach(new oL.UE(this.menuContext,this.viewContainerRef,{$implicit:void 0})),this.sub=(0,go.R)(document,"click").pipe((0,_i.h)(a=>{const l=a.target;return this.close(),!!this.overlayRef&&!this.overlayRef.overlayElement.contains(l)}),(0,mt.q)(1)).subscribe(()=>this.close()),this.sub=(0,go.R)(document,"contextmenu").pipe((0,_i.h)(a=>{const l=a.target;if(l&&!this.elementRef.nativeElement.contains(l)&&!this.overlayRef.overlayElement.contains(l))return!0;a.preventDefault()}),(0,mt.q)(1)).subscribe(()=>this.close())}close(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null),this.sub&&this.sub.unsubscribe()}static \u0275fac=function(o){return new(o||n)(e.Y36(qi.aV),e.Y36(e.s_b),e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","igoContextMenu",""]],hostBindings:function(o,i){1&o&&e.NdJ("longpress",function(a){return i.onContextMenu(a)})("contextmenu",function(a){return i.onContextMenu(a)})},inputs:{menuContext:["igoContextMenu","menuContext"]},outputs:{menuPosition:"menuPosition"}})}return n})();const nL=["mapBrowser"];function rL(n,r){1&n&&(e.TgZ(0,"span",11),e._uU(1," F2 activate/deactivate the pointer location. "),e.qZA())}function sL(n,r){if(1&n&&e._UZ(0,"igo-search-add-button",12),2&n){const t=r.result,o=e.oxw();e.Q6J("map",o.map)("layer",t)}}function aL(n,r){if(1&n&&(e.TgZ(0,"igo-panel",11),e._UZ(1,"igo-feature-details",13),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("feature",t.selectedFeature)}}function lL(n,r){if(1&n&&e._UZ(0,"igo-actionbar",14),2&n){const t=e.oxw();e.Q6J("store",t.store)("withIcon",!1)("horizontal",!0)("mode","context")}}const cL=function(){return["ConfigService","LanguageService"]},pL=ee.Bz.forChild([{path:"search",component:(()=>{class n{languageService;projectionService;mapService;layerService;searchState;mediaService;storageService;store=new Ko([]);igoSearchPointerSummaryEnabled=!1;termSplitter="|";map=new Xe({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};osmLayer;mapBrowser;lonlat;mapProjection;term;settingsChange$=new y.X(void 0);get searchStore(){return this.searchState.store}get isTouchScreen(){return this.mediaService.isTouchScreen()}selectedFeature;igoReverseSearchCoordsFormatEnabled;constructor(t,o,i,s,a,l,c){this.languageService=t,this.projectionService=o,this.mapService=i,this.layerService=s,this.searchState=a,this.mediaService=l,this.storageService=c,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(u=>{this.osmLayer=u,this.map.addLayer(u)}),this.igoReverseSearchCoordsFormatEnabled=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1}onPointerSummaryStatusChange(t){this.igoSearchPointerSummaryEnabled=t}onSearchTermChange(t){this.term=t,this.searchState.setSearchTerm(t),t.replace(/(#[^\s]*)/g,"").trim().length<2&&(this.searchStore.clear(),this.selectedFeature=void 0)}onSearch(t){const o=t.results;this.searchStore.state.updateAll({focused:!1,selected:!1});const i=this.searchStore.entities$.value.filter(s=>s.source!==t.research.source).concat(o);this.searchStore.updateMany(i)}onReverseCoordsFormatStatusChange(t){this.storageService.set("reverseSearchCoordsFormatEnabled",t),this.igoReverseSearchCoordsFormatEnabled=t}onSearchSettingsChange(){this.settingsChange$.next(!0)}onResultFocus(t){this.tryAddFeatureToMap(t),this.selectedFeature=t.data}tryAddFeatureToMap(t){t.meta.dataType===ie&&void 0!==t.data.geometry&&this.map.searchResultsOverlay.setFeatures([t.data],Y.Default)}ngOnInit(){this.store.load([{id:"coordinates",title:"coordinates",handler:()=>this.searchCoordinate(this.lonlat)},{id:"googleMaps",title:"googleMap",handler:()=>this.openGoogleMaps(this.lonlat)},{id:"googleStreetView",title:"googleStreetView",handler:()=>this.openGoogleStreetView(this.lonlat)}])}ngOnDestroy(){this.store.destroy()}removeFeatureFromMap(){this.map.searchResultsOverlay.clear()}onContextMenuOpen(t){const o=this.mapPosition(t),i=this.mapService.getMap().ol.getCoordinateFromPixel(o);this.mapProjection=this.mapService.getMap().projection,this.lonlat=Q.vs(i,this.mapProjection,"EPSG:4326")}mapPosition(t){const o=t;return o.y=o.y-this.mapBrowser.nativeElement.getBoundingClientRect().top+window.scrollY,o.x=o.x-this.mapBrowser.nativeElement.getBoundingClientRect().left+window.scrollX,[o.x,o.y]}searchCoordinate(t){this.searchStore.clear(),this.term=this.igoReverseSearchCoordsFormatEnabled?t.reverse().map(o=>o.toFixed(6)).join(", "):t.map(o=>o.toFixed(6)).join(", ")}openGoogleMaps(t){window.open(Pt.getGoogleMapsCoordLink(t[0],t[1]))}openGoogleStreetView(t){window.open(Pt.getGoogleStreetViewLink(t[0],t[1]))}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(On),e.Y36(Gt),e.Y36(Se),e.Y36(Cl),e.Y36(ct),e.Y36(oe))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-search"]],viewQuery:function(o,i){if(1&o&&e.Gf(nL,7,e.SBq),2&o){let s;e.iGM(s=e.CRH())&&(i.mapBrowser=s.first)}},decls:14,vars:19,consts:[["title","Search","subtitle","Geo",3,"dependencies"],["codeFolder","geo/search","configFolder","environments"],["title","Details",4,"ngIf"],["igoOverlay","","igoLongPress","","igoSearchPointerSummary","",3,"map","view","igoContextMenu","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","menuPosition"],["mapBrowser",""],["color","primary",3,"map"],["title","Search"],[3,"term","searchSettings","store","termSplitter","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchTermChange","search","clearFeature","searchSettingsChange","reverseSearchCoordsFormatStatus"],["placeholder","false",3,"store","term","termSplitter","settingsChange$","resultFocus","resultSelect","moreResults"],["igoSearchItemToolbar",""],["actionbarMenu",""],["title","Details"],[3,"map","layer"],[3,"feature"],[3,"store","withIcon","horizontal","mode"]],template:function(o,i){if(1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1),e.YNc(2,rL,2,0,"span",2),e.TgZ(3,"igo-map-browser",3,4),e.NdJ("menuPosition",function(a){return i.onContextMenuOpen(a)}),e._UZ(5,"igo-zoom-button",5),e.qZA(),e.TgZ(6,"igo-panel",6)(7,"igo-search-bar",7),e.NdJ("pointerSummaryStatus",function(a){return i.onPointerSummaryStatusChange(a)})("searchTermChange",function(a){return i.onSearchTermChange(a)})("search",function(a){return i.onSearch(a)})("clearFeature",function(){return i.removeFeatureFromMap()})("searchSettingsChange",function(){return i.onSearchSettingsChange()})("reverseSearchCoordsFormatStatus",function(a){return i.onReverseCoordsFormatStatusChange(a)}),e.qZA(),e.TgZ(8,"igo-search-results",8),e.NdJ("resultFocus",function(a){return i.onResultFocus(a)})("resultSelect",function(a){return i.onResultFocus(a)})("moreResults",function(a){return i.onSearch(a)}),e.YNc(9,sL,1,2,"ng-template",null,9,e.W1O),e.qZA()(),e.YNc(11,aL,2,1,"igo-panel",2),e.YNc(12,lL,1,4,"ng-template",null,10,e.W1O),e.qZA()()),2&o){const s=e.MAs(13);e.Q6J("dependencies",e.DdM(18,cL)),e.xp6(2),e.Q6J("ngIf",!i.isTouchScreen),e.xp6(1),e.Q6J("map",i.map)("view",i.view)("igoContextMenu",s)("igoSearchPointerSummaryDelay",500)("igoSearchPointerSummaryEnabled",i.igoSearchPointerSummaryEnabled),e.xp6(2),e.Q6J("map",i.map),e.xp6(2),e.Q6J("term",i.term)("searchSettings",!0)("store",i.searchStore)("termSplitter",i.termSplitter)("reverseSearchCoordsFormatEnabled",i.igoReverseSearchCoordsFormatEnabled),e.xp6(1),e.Q6J("store",i.searchStore)("term",i.term)("termSplitter",i.termSplitter)("settingsChange$",i.settingsChange$),e.xp6(3),e.Q6J("ngIf",i.selectedFeature)}},dependencies:[f.O5,me,de,Ht,Le,lt,C2,rd,td,BT,yn,iL,Bh,Jn],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{height:100%;width:100%;padding-top:10px}"]})}return n})()}]);let dL=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[Gx(),UT(),Hx(),zT(),oS(),qT(),zx(),QT(),HT()],imports:[pe,pL,Po.forRoot(),It,at,qa.forRoot(),EO,ar,fc,Ii]})}return n})();function gL(n,r){if(1&n&&(e.TgZ(0,"div",1)(1,"pre"),e._uU(2),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(t.infoContent)}}let mL=(()=>{class n{infoContent="";constructor(){}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(o,i){1&o&&e.YNc(0,gL,3,1,"div",0),2&o&&e.Q6J("ngIf",i.infoContent&&i.infoContent.length)},dependencies:[f.O5],styles:[".infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}"]})}return n})();function hL(n,r){if(1&n&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.pointerCoord)}}const fL=function(){return["LanguageService"]},yL=ee.Bz.forChild([{path:"simple-map",component:(()=>{class n{languageService;dataSourceService;layerService;mediaService;pointerCoord;pointerCoordDelay=0;map=new Xe({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,rotation:.75};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(t,o,i,s){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.mediaService=s,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:a}))})}onPointerMove(t){this.pointerCoord=t}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se),e.Y36(ct))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-simple-map"]],decls:10,vars:12,consts:[["title","Simple Map","subtitle","Geo",3,"dependencies"],["codeFolder","geo/simple-map"],["igoPointerPosition","",3,"map","view","pointerPositionDelay","pointerPositionCoord"],[3,"infoContent"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[4,"ngIf"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e.NdJ("pointerPositionCoord",function(a){return i.onPointerMove(a)}),e._UZ(3,"igo-info-section",3)(4,"igo-zoom-button",4)(5,"igo-geolocate-button",4)(6,"igo-home-extent-button",4)(7,"igo-rotation-button",5)(8,"igo-wake-lock-button"),e.qZA(),e.YNc(9,hL,2,1,"p",6),e.qZA()()),2&o&&(e.Q6J("dependencies",e.DdM(11,fL)),e.xp6(2),e.Q6J("map",i.map)("view",i.view)("pointerPositionDelay",i.pointerCoordDelay),e.xp6(1),e.Q6J("infoContent",i.pointerCoord),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("map",i.map)("showIfNoRotation",!0),e.xp6(2),e.Q6J("ngIf",!i.isTouchScreen))},dependencies:[f.O5,me,de,Le,lt,zn,Kn,Wn,mL,Nw,Dy],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:350px}"]})}return n})()}]);let bL=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,yL,Et.QW,S.ot,at]})}return n})();function vL(n,r){if(1&n&&(e.ynx(0),e._UZ(1,"igo-feature-details",10),e.BQk()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("feature",t)}}const CL=function(){return["LanguageService"]},SL=ee.Bz.forChild([{path:"spatial-filter",component:(()=>{class n{matIconRegistry;spatialFilterService;dataSourceService;layerService;messageService;languageService;cdRef;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};type;itemType=Ft.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new y.X(void 0);format=new Ce.Z;store=new hr([]);spatialListStore=new xt([]);loading=!1;thematicLength=0;measureUnit=K.Meters;unsubscribe$=new fe.x;defaultStyle;constructor(t,o,i,s,a,l,c){this.matIconRegistry=t,this.spatialFilterService=o,this.dataSourceService=i,this.layerService=s,this.messageService=a,this.languageService=l,this.cdRef=c,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(u=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:u}))})}ngOnInit(){for(const t of this.map.layers)t.title&&t.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(t)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(t){this.type=t,this.queryType=void 0}getOutputQueryType(t){this.queryType=t,this.queryType&&this.loadFilterList()}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,ko.R)(this.unsubscribe$)).subscribe(t=>{t.sort((o,i)=>o.properties.nom<i.properties.nom?-1:o.properties.nom>i.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(t)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===be.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let o,t=!0;(0===this.buffer||this.type===be.Point)&&this.tryAddFeaturesToMap([this.zone]),o=this.itemType!==Ft.Thematics?[{name:""}]:this.thematics,this.measureUnit===K.Kilometers&&this.type!==be.Point&&(this.buffer=1e3*this.buffer),this.type===be.Polygon&&(this.buffer=0);const i=[];o.forEach(s=>{i.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,s,this.buffer).pipe((0,Bi.b)(a=>{this.store.insertMany(a);const l=[],c=[];let u,p;a.forEach(d=>{"Point"===d.geometry.type?(d.properties.longitude=d.geometry.coordinates[0],d.properties.latitude=d.geometry.coordinates[1],l.push(d),u=d.meta.id):(c.push(d),p=d.meta.id)}),this.tryAddPointToMap(l,u),this.tryAddLayerToMap(c,p),a.length?(t=!1,this.thematicLength+=1,s.zeroResults=!1,this.cdRef.detectChanges()):s.zeroResults=!0,a.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,Qt.D)(i).pipe((0,ko.R)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,t&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(t,o){this.zone=t,t&&(o?this.tryAddFeaturesToMap([t],!0):this.tryAddFeaturesToMap([t]),this.zoomToFeatureExtent(t))}tryAddFeaturesToMap(t,o){let i=1;for(const s of t){if(this.type===be.Predefined)for(const a of this.layers){if(a.options._internal&&a.options._internal.code===s.properties.code&&!o){if(!a.title?.startsWith("Zone")){const l=this.layers.indexOf(a);this.layers.splice(l,1)}return}if(a.title?.startsWith("Zone")){this.activeLayers=[];const l=this.layers.indexOf(a);this.layers.splice(l,1),this.map.removeLayer(a)}}else{if(o)for(const a of this.activeLayers)if(1===this.activeLayers.length&&a.title?.startsWith("Zone")){const l=this.layers.indexOf(a);this.layers.splice(l,1),this.map.removeLayer(a)}this.activeLayers=[]}for(const a of this.layers)a.title?.startsWith("Zone")&&i++;this.defaultStyle=(a,l)=>{const c=t[0].coordinates;return new J.ZP({image:new Te.Z({radius:c?this.buffer/Math.cos(Math.PI/180*c[1])/l:void 0,fill:new q.Z({color:"rgba(200, 200, 20, 0.2)"}),stroke:new U.Z({width:1,color:"orange"})}),stroke:new U.Z({width:1,color:"orange"}),fill:new q.Z({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,mt.q)(1)).subscribe(a=>{const l=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+i+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===be.Predefined?s.properties.code:void 0},source:a,visible:!0}),c=t.map(p=>ft(p,this.map.projection));if(this.type!==be.Predefined){const p=this.type===be.Point?"Cercle":"Polygone";c[0].set("nom","Zone",!0),c[0].set("type",p,!0)}a.ol.addFeatures(c),l.ol.setStyle(this.defaultStyle),this.map.addLayer(l),this.layers.push(l),this.activeLayers.push(l),this.cdRef.detectChanges()})}}tryAddPointToMap(t,o){let i=1;if(t.length){if(void 0===this.map)return;for(const s of this.layers)s.title?.startsWith(t[0].meta.title)&&i++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:o,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,mt.q)(1)).subscribe(s=>{const a=t[0].meta.icon;let l;l=a&&this.createSvgIcon(a)||Xo();const c=this.layerService.createLayer({isIgoInternalLayer:!0,title:t[0].meta.title+" "+i+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:s,visible:!0,style:l}),u=t.map(d=>ft(d,this.map.projection));s.ol.getSource().addFeatures(u),this.layers.find(d=>d.id===c.id)&&(this.map.removeLayer(this.layers.find(d=>d.id===c.id)),i-=1,c.title=t[0].meta.title+" "+i+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),c.options.title=c.title),this.iterator=i,this.map.addLayer(c),this.layers.push(c),this.pushLayer(c),this.cdRef.detectChanges()})}}createSvgIcon(t){let o;return this.matIconRegistry.getNamedSvgIcon(t).subscribe(i=>{const s=new XMLSerializer;i.setAttribute("width","30"),i.setAttribute("height","30"),i.setAttribute("fill","rgba(0, 128, 255)"),i.setAttribute("stroke","white");const a=s.serializeToString(i);o=new J.ZP({image:new Fi.Z({src:"data:image/svg+xml;utf8,"+a})})}),o}tryAddLayerToMap(t,o){let i=1;if(t.length){if(void 0===this.map)return;for(const s of this.layers)s.title?.startsWith(t[0].meta.title)&&i++;this.dataSourceService.createAsyncDataSource({type:"vector",id:o,queryable:!0}).pipe((0,mt.q)(1)).subscribe(s=>{const a=this.layerService.createLayer({isIgoInternalLayer:!0,title:t[0].meta.title+" "+i+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:s,visible:!0}),l=t.map(u=>ft(u,this.map.projection));s.ol.addFeatures(l),this.layers.find(u=>u.id===a.id)&&(this.map.removeLayer(this.layers.find(u=>u.id===a.id)),i-=1,a.title=t[0].meta.title+" "+i+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),a.options.title=a.title),this.map.addLayer(a),this.layers.push(a),this.pushLayer(a),this.cdRef.detectChanges()})}}zoomToFeatureExtent(t){if(t){const o=this.format.readFeature(t,{dataProjection:t.projection,featureProjection:this.map.projection});vo(this.map.viewController,[o],Y.Zoom)}}pushLayer(t){for(const o of this.activeLayers)if(o.id===t.id)return;this.activeLayers.push(t)}static \u0275fac=function(o){return new(o||n)(e.Y36(w.jv),e.Y36(en),e.Y36(_t),e.Y36(Se),e.Y36(_e),e.Y36(L),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-spatial-filter"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},decls:14,vars:22,consts:[["title","Spatial Filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/spatial-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100"],[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent"],[4,"ngIf"],[3,"feature"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4),e.qZA()(),e.TgZ(6,"mat-grid-tile")(7,"div",5)(8,"igo-panel",6)(9,"igo-spatial-filter-type",7),e.NdJ("eventType",function(a){return i.getOutputType(a)})("eventQueryType",function(a){return i.getOutputQueryType(a)})("zoneChange",function(a){return i.onZoneChange(a)})("zoneWithBufferChange",function(a){return i.onZoneChange(a,!0)})("bufferChange",function(a){return i.buffer=a})("measureUnitChange",function(a){return i.measureUnit=a}),e.qZA(),e.TgZ(10,"igo-spatial-filter-item",8),e.NdJ("radiusEvent",function(a){return i.buffer=a})("bufferEvent",function(a){return i.buffer=a})("measureUnitChange",function(a){return i.measureUnit=a})("freehandControl",function(a){return i.freehandDrawIsActive=a})("drawZoneEvent",function(a){return i.zone=a})("zoneWithBufferChange",function(a){return i.onZoneChange(a,!0)})("itemTypeChange",function(a){return i.itemType=a})("thematicChange",function(a){return i.thematics=a})("toggleSearch",function(){return i.getOutputToggleSearch()})("clearButtonEvent",function(){return i.clearMap()})("clearSearchEvent",function(){return i.getOutputClearSearch()}),e.qZA()(),e.TgZ(11,"igo-panel",6),e.YNc(12,vL,2,1,"ng-container",9),e.ALo(13,"async"),e.qZA()()()()()()),2&o&&(e.Q6J("dependencies",e.DdM(21,CL)),e.xp6(4),e.Q6J("map",i.map)("view",i.view)("queryFeatures",!0),e.xp6(1),e.Q6J("map",i.map),e.xp6(4),e.Q6J("store",i.spatialListStore)("selectedQueryType",i.queryType)("zone",i.zone)("layers",i.activeLayers),e.xp6(1),e.Q6J("type",i.type)("queryType",i.queryType)("map",i.map)("zone",i.zone)("loading",i.loading)("store",i.store)("layers",i.activeLayers)("allLayers",i.layers)("thematicLength",i.thematicLength),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,19,i.selectedFeature$)))},dependencies:[f.O5,me,de,Ct.Il,Ct.DX,Ht,Le,lt,Ju,Jn,Na,Ra,f.Ov],styles:["[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]     .thematics-header{max-width:225px}"],changeDetection:0})}return n})()}]);let wL=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[SL,pe,It,at,Po,Ba,Ii,Aa,nn,dn]})}return n})();const TL=function(){return["LanguageService"]},OL=ee.Bz.forChild([{path:"time-filter",component:(()=>{class n{languageService;dataSourceService;layerService;map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(t,o,i){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:a}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},timeFilterable:!0,timeFilter:{min:"2013",max:"2019",range:!1,type:st.YEAR,style:Ut.SLIDER,step:1,timeInterval:2e3}}).subscribe(a=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle YEAR",visible:!0,source:a}))})}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-time-filter"]],decls:10,vars:6,consts:[["title","Time filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/time-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"layers"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3),e._UZ(5,"igo-zoom-button",4),e.qZA()(),e.TgZ(6,"mat-grid-tile")(7,"div",5)(8,"igo-panel",6),e._UZ(9,"igo-time-filter-list",7),e.qZA()()()()()()),2&o&&(e.Q6J("dependencies",e.DdM(5,TL)),e.xp6(4),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(4),e.Q6J("layers",i.map.layers))},dependencies:[me,de,Ct.Il,Ct.DX,Ht,Le,lt,qr]})}return n})()}]);let AL=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[OL,pe,It,at,nn]})}return n})();function LL(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"igo-entity-table-paginator",7),e.NdJ("paginatorChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.paginatorChange(i))}),e.qZA()}if(2&n){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("store",t.entityStore)("paginatorOptions",o.paginatorOptions)("entitySortChange$",o.entitySortChange$)}}function ML(n,r){if(1&n&&(e.ynx(0),e.YNc(1,LL,1,3,"igo-entity-table-paginator",6),e.ALo(2,"async"),e.BQk()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.inResolutionRange$))}}function IL(n,r){if(1&n&&e._UZ(0,"igo-actionbar",11),2&n){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("store",t.actionStore)("horizontal",!0)("withToggleButton",!0)("withTitle",!0)("mode",o.actionbarMode)}}function ZL(n,r){if(1&n&&e._UZ(0,"igo-entity-table",12),2&n){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("paginator",o.workspacePaginator)("scrollBehavior",o.scrollBehavior)("store",t.entityStore)("template",t.meta.tableTemplate)}}function PL(n,r){1&n&&(e.TgZ(0,"mat-card-content"),e._uU(1," No data available at this scale. Please zoom in. "),e.qZA())}function kL(n,r){if(1&n&&(e.ynx(0),e.YNc(1,IL,1,5,"igo-actionbar",8),e.YNc(2,ZL,1,4,"igo-entity-table",9),e.ALo(3,"async"),e.YNc(4,PL,2,0,"mat-card-content",5),e.ALo(5,"async"),e._UZ(6,"igo-workspace-widget-outlet",10),e.BQk()),2&n){const t=r.ngIf;e.xp6(1),e.Q6J("ngIf",t.actionStore),e.xp6(1),e.Q6J("ngIf",t.entityStore&&t.meta&&t.meta.tableTemplate&&e.lcZ(3,4,t.inResolutionRange$)),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(5,6,t.inResolutionRange$)),e.xp6(2),e.Q6J("workspace",t)}}const DL=ee.Bz.forChild([{path:"workspace",component:(()=>{class n{languageService;dataSourceService;layerService;workspaceState;workspacePaginator;entitySortChange$=new y.X(!1);paginatorOptions={pageSize:5,pageSizeOptions:[1,5,10,15,30,50,100],showFirstLastButtons:!0};map=new Xe({controls:{attribution:{collapsed:!0}}});view={center:[-72,47.2],zoom:5};get workspaceStore(){return this.workspaceState.store}selectedWorkspace$;actionbarMode=wi.Overlay;scrollBehavior=dr.Instant;constructor(t,o,i,s){this.languageService=t,this.dataSourceService=o,this.layerService=i,this.workspaceState=s}ngOnInit(){this.selectedWorkspace$=this.workspaceStore.stateView.firstBy$(o=>!0===o.state.selected).pipe((0,I.U)(o=>{const i=void 0===o?void 0:o.entity;return i&&i.actionStore.view.filter(s=>"wfsDownload"!==s.id),i})),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(o=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:o}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{featureTypes:"etablissement_mtq",fieldNameGeometry:"geometry",version:"2.0.0",outputFormat:"geojson"},sourceFields:[{name:"idetablis",alias:"ID"},{name:"nometablis",alias:"Name"},{name:"typetablis",alias:"Type"}]}).subscribe(o=>{this.map.addLayer(this.layerService.createLayer({title:"Simple WFS ",maxResolution:3e3,visible:!0,source:o}))})}paginatorChange(t){this.workspacePaginator=t}static \u0275fac=function(o){return new(o||n)(e.Y36(L),e.Y36(_t),e.Y36(Se),e.Y36(Ri))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-workspace"]],decls:9,vars:11,consts:[["title","Workspace","subtitle","Geo"],["codeFolder","geo/workspace"],[1,"m-b-16",3,"map","view"],["color","primary",3,"map"],["igoWorkspaceSelector","",3,"store","map"],[4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"],[3,"store","horizontal","withToggleButton","withTitle","mode",4,"ngIf"],["class","table-compact table-centered",3,"paginator","scrollBehavior","store","template",4,"ngIf"],[3,"workspace"],[3,"store","horizontal","withToggleButton","withTitle","mode"],[1,"table-compact","table-centered",3,"paginator","scrollBehavior","store","template"]],template:function(o,i){1&o&&(e.TgZ(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),e._UZ(3,"igo-zoom-button",3),e.qZA(),e._UZ(4,"igo-workspace-selector",4),e.YNc(5,ML,3,3,"ng-container",5),e.ALo(6,"async"),e.YNc(7,kL,7,8,"ng-container",5),e.ALo(8,"async"),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("map",i.map)("view",i.view),e.xp6(1),e.Q6J("map",i.map),e.xp6(1),e.Q6J("store",i.workspaceStore)("map",i.map),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,7,i.selectedWorkspace$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(8,9,i.selectedWorkspace$)))},dependencies:[f.O5,me,de,Et.dn,yn,Si,Fc,Uc,qf,Le,lt,uF,f.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-entity-table[_ngcontent-%COMP%]{height:400px}igo-actionbar[_ngcontent-%COMP%]{height:48px}"]})}return n})()}]);let EL=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[pe,DL,Is,vc,Ch,It,at,uS]})}return n})();const RL={showDelay:500,hideDelay:0,touchendHideDelay:0,disableTooltipInteractivity:!0};let NL=(()=>{class n{constructor(t,o){t.addSvgIconSet(o.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}static \u0275fac=function(o){return new(o||n)(e.LFG(w.jv),e.LFG($t.H7))};static \u0275mod=e.oAB({type:n,bootstrap:[gg]});static \u0275inj=e.cJS({providers:[{provide:F.o2,useValue:{appearance:"outline"}},{provide:e.ip1,useFactory:BL,deps:[e.zs3,e.z2F],multi:!0},{provide:P.Jm,useValue:RL},f.uU],imports:[lg,$t.b2,ec.PW,ln.SJ,Xl.g0,S.ot,w.Ps,Z.ie,b3,g3,f3,x3,T3,A3,I3,Hf,Wf,r_,o_,c_,d_,C_,T_,Wg,bL,cO,gO,wO,z3,Q3,eO,_O,G3,kO,$3,dL,AO,nO,N3,AL,CO,wL,EL,u3,dg,$t.t6]})}return n})();function BL(n,r){return()=>new Promise(t=>{r.isStable.pipe((0,Lt.P)(o=>!0===o),(0,oo.b)(()=>{const o=n.get(L),i=o.getLanguage();return o.translate.getTranslation(i)})).subscribe(o=>{const i=n.get(L),s=i.getLanguage();i.translate.setTranslation(s,o),t()})})}_l.production&&(0,e.G48)(),$t.q6().bootstrapModule(NL).catch(n=>console.log(n))},46700:(gi,bs,v)=>{var $t={"./af":35528,"./af.js":35528,"./ar":1036,"./ar-dz":17579,"./ar-dz.js":17579,"./ar-kw":69588,"./ar-kw.js":69588,"./ar-ly":11650,"./ar-ly.js":11650,"./ar-ma":93258,"./ar-ma.js":93258,"./ar-sa":54085,"./ar-sa.js":54085,"./ar-tn":90287,"./ar-tn.js":90287,"./ar.js":1036,"./az":89757,"./az.js":89757,"./be":59620,"./be.js":59620,"./bg":31139,"./bg.js":31139,"./bm":4042,"./bm.js":4042,"./bn":19641,"./bn-bd":19126,"./bn-bd.js":19126,"./bn.js":19641,"./bo":494,"./bo.js":494,"./br":20934,"./br.js":20934,"./bs":26274,"./bs.js":26274,"./ca":45831,"./ca.js":45831,"./cs":92354,"./cs.js":92354,"./cv":79692,"./cv.js":79692,"./cy":58774,"./cy.js":58774,"./da":38955,"./da.js":38955,"./de":21557,"./de-at":24954,"./de-at.js":24954,"./de-ch":81881,"./de-ch.js":81881,"./de.js":21557,"./dv":16475,"./dv.js":16475,"./el":38877,"./el.js":38877,"./en-au":70454,"./en-au.js":70454,"./en-ca":67356,"./en-ca.js":67356,"./en-gb":10456,"./en-gb.js":10456,"./en-ie":28789,"./en-ie.js":28789,"./en-il":85471,"./en-il.js":85471,"./en-in":39664,"./en-in.js":39664,"./en-nz":97672,"./en-nz.js":97672,"./en-sg":80805,"./en-sg.js":80805,"./eo":87390,"./eo.js":87390,"./es":1564,"./es-do":51473,"./es-do.js":51473,"./es-mx":92089,"./es-mx.js":92089,"./es-us":84156,"./es-us.js":84156,"./es.js":1564,"./et":6513,"./et.js":6513,"./eu":7856,"./eu.js":7856,"./fa":2378,"./fa.js":2378,"./fi":22687,"./fi.js":22687,"./fil":80032,"./fil.js":80032,"./fo":46845,"./fo.js":46845,"./fr":8875,"./fr-ca":56425,"./fr-ca.js":56425,"./fr-ch":41746,"./fr-ch.js":41746,"./fr.js":8875,"./fy":67037,"./fy.js":67037,"./ga":11217,"./ga.js":11217,"./gd":37010,"./gd.js":37010,"./gl":51931,"./gl.js":51931,"./gom-deva":64488,"./gom-deva.js":64488,"./gom-latn":8032,"./gom-latn.js":8032,"./gu":34984,"./gu.js":34984,"./he":69090,"./he.js":69090,"./hi":42085,"./hi.js":42085,"./hr":38787,"./hr.js":38787,"./hu":2901,"./hu.js":2901,"./hy-am":59819,"./hy-am.js":59819,"./id":44074,"./id.js":44074,"./is":70715,"./is.js":70715,"./it":31746,"./it-ch":77040,"./it-ch.js":77040,"./it.js":31746,"./ja":3180,"./ja.js":3180,"./jv":34346,"./jv.js":34346,"./ka":65538,"./ka.js":65538,"./kk":79772,"./kk.js":79772,"./km":87905,"./km.js":87905,"./kn":79125,"./kn.js":79125,"./ko":69140,"./ko.js":69140,"./ku":2354,"./ku.js":2354,"./ky":63768,"./ky.js":63768,"./lb":14016,"./lb.js":14016,"./lo":83169,"./lo.js":83169,"./lt":62353,"./lt.js":62353,"./lv":83243,"./lv.js":83243,"./me":52338,"./me.js":52338,"./mi":35555,"./mi.js":35555,"./mk":85794,"./mk.js":85794,"./ml":53151,"./ml.js":53151,"./mn":46458,"./mn.js":46458,"./mr":69165,"./mr.js":69165,"./ms":8680,"./ms-my":87477,"./ms-my.js":87477,"./ms.js":8680,"./mt":79684,"./mt.js":79684,"./my":40285,"./my.js":40285,"./nb":45922,"./nb.js":45922,"./ne":29040,"./ne.js":29040,"./nl":5066,"./nl-be":74460,"./nl-be.js":74460,"./nl.js":5066,"./nn":53693,"./nn.js":53693,"./oc-lnc":88676,"./oc-lnc.js":88676,"./pa-in":92341,"./pa-in.js":92341,"./pl":57416,"./pl.js":57416,"./pt":84344,"./pt-br":30113,"./pt-br.js":30113,"./pt.js":84344,"./ro":72643,"./ro.js":72643,"./ru":61305,"./ru.js":61305,"./sd":96095,"./sd.js":96095,"./se":74486,"./se.js":74486,"./si":58742,"./si.js":58742,"./sk":96722,"./sk.js":96722,"./sl":3345,"./sl.js":3345,"./sq":52416,"./sq.js":52416,"./sr":39450,"./sr-cyrl":50501,"./sr-cyrl.js":50501,"./sr.js":39450,"./ss":32222,"./ss.js":32222,"./sv":9454,"./sv.js":9454,"./sw":19638,"./sw.js":19638,"./ta":96494,"./ta.js":96494,"./te":94435,"./te.js":94435,"./tet":25003,"./tet.js":25003,"./tg":13706,"./tg.js":13706,"./th":16025,"./th.js":16025,"./tk":59780,"./tk.js":59780,"./tl-ph":22068,"./tl-ph.js":22068,"./tlh":39167,"./tlh.js":39167,"./tr":32494,"./tr.js":32494,"./tzl":58707,"./tzl.js":58707,"./tzm":91296,"./tzm-latn":34532,"./tzm-latn.js":34532,"./tzm.js":91296,"./ug-cn":12086,"./ug-cn.js":12086,"./uk":85069,"./uk.js":85069,"./ur":29304,"./ur.js":29304,"./uz":95115,"./uz-latn":97609,"./uz-latn.js":97609,"./uz.js":95115,"./vi":34802,"./vi.js":34802,"./x-pseudo":65605,"./x-pseudo.js":65605,"./yo":88456,"./yo.js":88456,"./zh-cn":23272,"./zh-cn.js":23272,"./zh-hk":9402,"./zh-hk.js":9402,"./zh-mo":48101,"./zh-mo.js":48101,"./zh-tw":40262,"./zh-tw.js":40262};function e(f){var S=vs(f);return v(S)}function vs(f){if(!v.o($t,f)){var S=new Error("Cannot find module '"+f+"'");throw S.code="MODULE_NOT_FOUND",S}return $t[f]}e.keys=function(){return Object.keys($t)},e.resolve=vs,gi.exports=e,e.id=46700}},gi=>{gi.O(0,[736],()=>gi(gi.s=86257)),gi.O()}]);
//# sourceMappingURL=main.2a7969843ecc501d.js.map