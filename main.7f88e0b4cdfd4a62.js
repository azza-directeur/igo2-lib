(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[792],{30699:(De,le,r)=>{"use strict";r.d(le,{_L:()=>ee,uR:()=>h,rY:()=>W});var M=r(46443),a=r(68559),F=r(81681),p=r(67143),e=r(34751);let c=(()=>{class A{injector;options;tokenKey;constructor(u){this.injector=u;const O=this.injector.get(p.we);this.options=O.getConfig("auth"),this.tokenKey=this.options?.tokenKey}set(u){localStorage.setItem(this.tokenKey,u)}remove(){localStorage.removeItem(this.tokenKey)}get(){return localStorage.getItem(this.tokenKey)}decode(){const u=this.get();if(u)return(0,e.s)(u)}isExpired(){const u=this.decode(),O=(new Date).getTime()/1e3;return!(u&&O<u.exp)}static \u0275fac=function(O){return new(O||A)(a.KVO(a.zZn))};static \u0275prov=a.jDH({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})();var o=r(21701),L=r(1455),R=r(68671),v=r(75797),y=r(59452),b=r(98764),k=r(61318),_=r(9530),D=r(58610);let h=(()=>{class A{http;tokenService;config;languageService;messageService;router;authenticate$=new v.t(void 0);logged$=new v.t(void 0);redirectUrl;languageForce=!1;anonymous=!1;authOptions;get hasAuthService(){return void 0!==this.authOptions?.url}get user(){const u=this.decodeToken();return u?.user?u.user:null}constructor(u,O,j,P,Y,w){this.http=u,this.tokenService=O,this.config=j,this.languageService=P,this.messageService=Y,this.router=w,this.authOptions=this.config.getConfig("auth"),this.authenticate$.next(this.authenticated),this.authenticate$.subscribe(I=>{this.logged$.next(I),_.r.next()})}login(u,O){const j=new M.Lr({"Content-Type":"application/json"}),P={username:u,password:this.encodePassword(O)};return this.loginCall(P,j)}loginWithToken(u,O,j){const P=new M.Lr({"Content-Type":"application/json"});return this.loginCall({token:u,typeConnection:O,infosUser:j},P)}loginAnonymous(){return this.anonymous=!0,this.logged$.next(!0),(0,y.of)(!0)}refresh(){return this.http.post(`${this.authOptions?.url}/refresh`,{}).pipe((0,b.M)(u=>{this.tokenService.set(u.token)}),(0,k.W)(u=>{throw u.error.caught=!0,u}))}logout(){return this.anonymous=!1,this.tokenService.remove(),this.authenticate$.next(!1),(0,y.of)(!0)}isAuthenticated(){return!this.tokenService.isExpired()}getToken(){return this.tokenService.get()}decodeToken(){if(this.isAuthenticated())return this.tokenService.decode()}goToRedirectUrl(){if(!this.router)return;const u=this.redirectUrl||this.router.url;u===this.authOptions.loginRoute?this.router.navigateByUrl(this.authOptions.homeRoute||"/"):u&&this.router.navigateByUrl(u)}getUserInfo(){return this.http.get(this.authOptions?.url+"/info")}getProfils(){return this.http.get(`${this.authOptions?.url}/profils`)}updateUser(u){return this.http.patch(this.authOptions?.url,u)}encodePassword(u){return R.o4.encode(u)}get logged(){return this.authenticated||this.isAnonymous}get isAnonymous(){return this.anonymous}get authenticated(){return this.isAuthenticated()}get isAdmin(){return!!this.decodeToken()?.user?.isAdmin}loginCall(u,O){return this.http.post(`${this.authOptions?.url}/login`,u,{headers:O}).pipe((0,b.M)(j=>{this.tokenService.set(j.token);const P=this.decodeToken();P?.user&&(P.user.locale&&!this.languageForce&&this.languageService.setLanguage(P.user.locale),P.user.isExpired&&this.messageService.alert("igo.auth.error.Password expired")),this.authenticate$.next(!0)}),(0,k.W)(j=>{throw j.error.caught=!0,j}))}static \u0275fac=function(O){return new(O||A)(a.KVO(M.Qq),a.KVO(c),a.KVO(p.we),a.KVO(o.gw),a.KVO(L.bg),a.KVO(D.Ix,8))};static \u0275prov=a.jDH({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})(),X=(()=>{class A extends F.Xh{http;authService;tokenService;constructor(u,O,j,P){super(u),this.http=O,this.authService=j,this.tokenService=P,this.authService.authenticate$.subscribe(Y=>{Y&&this.options.url&&this.http.get(this.options.url).subscribe(w=>{if(w&&w.preference)for(const I of Object.keys(w.preference))super.set(I,w.preference[I])})})}set(u,O,j=F.YM.LOCAL){if(j===F.YM.LOCAL&&this.authService.authenticated&&this.options.url){const P={};P[u]=O,this.http.patch(this.options.url,{preference:P}).subscribe()}super.set(u,O,j)}remove(u,O=F.YM.LOCAL){if(O===F.YM.LOCAL&&this.authService.authenticated&&this.options.url){const j={};j[u]=void 0,this.http.patch(this.options.url,{preference:j}).subscribe()}super.remove(u,O)}clear(u=F.YM.LOCAL){let O;u===F.YM.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.patch(this.options.url,{preference:{}},{params:{mergePreference:"false"}}).subscribe(),u===F.YM.LOCAL&&(O=this.tokenService.get()),super.clear(u),O&&this.tokenService.set(O),u===F.YM.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.get(this.options.url).subscribe(j=>{if(j&&j.preference)for(const P of Object.keys(j.preference))super.set(P,j.preference[P])})}static \u0275fac=function(O){return new(O||A)(a.KVO(p.we),a.KVO(M.Qq),a.KVO(h),a.KVO(c))};static \u0275prov=a.jDH({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})();var x=r(31191);let ee=(()=>{class A{config;tokenService;http;authOptions;refreshInProgress=!1;trustHosts;hostsWithCredentials;hostsWithAuthByKey;constructor(u,O,j){this.config=u,this.tokenService=O,this.http=j,this.authOptions=this.config.getConfig("auth"),this.trustHosts=this.authOptions?.trustHosts||[],this.trustHosts.push(window.location.hostname),this.hostsWithCredentials=this.authOptions?.hostsWithCredentials||[],this.hostsWithAuthByKey=this.authOptions?.hostsByKey||[]}intercept(u,O){const j=this.handleHostsWithCredentials(u.url);let P=u.clone();const Y=this.handleHostsAuthByKey(u.url);if(Y&&(P=P.clone({params:P.params.set(Y.key,Y.value)})),j)return P=u.clone({withCredentials:j}),O.handle(P);this.refreshToken();const w=this.tokenService.get(),I=document.createElement("a");if(I.href=P.url,""===I.host&&(I.href=I.href),!w||-1===this.trustHosts.indexOf(I.hostname))return O.handle(P);let s=P.clone({headers:P.headers.set("Authorization",`Bearer ${w}`)});const z=this.tokenService.decode();if("true"===s.params.get("_i")&&z?.user?.sourceId){const Q=x.VV.hashStr(z.user.sourceId);s=s.clone({params:s.params.set("_i",Q)})}else"true"===s.params.get("_i")&&(s=s.clone({params:s.params.delete("_i")}));return O.handle(s)}interceptXhr(u,O){const j=this.handleHostsWithCredentials(O);if(j)return u.withCredentials=j,!0;this.refreshToken();const P=document.createElement("a");P.href=O;const Y=this.tokenService.get();return!(!Y||-1===this.trustHosts.indexOf(P.hostname)||(u.setRequestHeader("Authorization","Bearer "+Y),0))}alterUrlWithKeyAuth(u){const O=this.handleHostsAuthByKey(u);if(O){const P=u.split(/[?&]/);let Y=P.shift();const w=P.filter(I=>0!==I.length);return w.push(`${O.key}=${O.value}`),w.length&&(Y+="?"+w.join("&")),Y}}handleHostsWithCredentials(u){let O=!1;for(const j of this.hostsWithCredentials)if(new RegExp(j.domainRegFilters).test(u)){O=void 0!==j.withCredentials?j.withCredentials:void 0;break}return O}handleHostsAuthByKey(u){let O;for(const Y of this.hostsWithAuthByKey)if(new RegExp(Y.domainRegFilters).test(u)&&!new RegExp(`${Y.keyProperty}=${Y.keyValue}`,"gm").test(u)){O={key:Y.keyProperty,value:Y.keyValue};break}return O}refreshToken(){const u=this.tokenService.decode(),O=(new Date).getTime()/1e3;if(!this.refreshInProgress&&u&&O<u.exp&&O>u.exp-1800){this.refreshInProgress=!0;const j=this.authOptions?.url;return this.http.post(`${j}/refresh`,{}).subscribe(P=>{this.tokenService.set(P.token),this.refreshInProgress=!1},P=>(P.error.caught=!0,P))}}static \u0275fac=function(O){return new(O||A)(a.KVO(p.we),a.KVO(c),a.KVO(M.Qq))};static \u0275prov=a.jDH({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})();function W(...A){const g=[{provide:M.a7,useClass:ee,multi:!0},{provide:F.n$,useClass:X}];for(const u of A)g.push(...u.providers);return(0,a.EmA)(g)}},44038:(De,le,r)=>{"use strict";r.d(le,{uw:()=>F,Vn:()=>s,rS:()=>M});var M=function(ae){return ae.Dock="dock",ae.Overlay="overlay",ae.Context="context",ae}(M||{}),a=r(75300);class F extends a.D_{}var p=r(60316),e=r(84175),c=r(53777),o=r(93840),L=r(20943),R=r(31034),v=r(80640),y=r(21701),b=r(55050),k=r(75797),_=r(68559),D=r(97024),h=r(36991),X=r(72551),H=r(90852);function x(ae,ye){if(1&ae&&(_.j41(0,"button",5),_.nI1(1,"async"),_.nrm(2,"igo-icon",6),_.nI1(3,"async"),_.k0s()),2&ae){const de=_.XpG(2);_.Y8G("color",de.color)("disabled",_.bMT(1,4,de.disabled$))("disableRipple",!0),_.R7$(2),_.Y8G("icon",de.isObservable(de.action.icon)?_.bMT(3,6,de.action.icon):de.action.icon)}}function ee(ae,ye){if(1&ae&&(_.j41(0,"span",7),_.EFF(1),_.nI1(2,"translate"),_.k0s()),2&ae){const de=_.XpG(2);_.R7$(),_.JRh(_.bMT(2,1,de.title))}}function Z(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"mat-list-item",2),_.nI1(1,"async"),_.nI1(2,"translate"),_.nI1(3,"async"),_.bIt("click",function(){_.eBV(de);const ce=_.XpG();return _.Njj(ce.onClick())}),_.DNE(4,x,4,8,"button",3)(5,ee,3,3,"span",4),_.k0s()}if(2&ae){const de=_.XpG();_.Y8G("matTooltip",de.withTooltip?_.bMT(2,6,_.bMT(1,4,de.tooltip$)||de.title):"")("ngClass",_.bMT(3,8,de.ngClass$)),_.R7$(4),_.Y8G("ngIf",de.withIcon),_.R7$(),_.Y8G("ngIf",de.withTitle)}}function G(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"mat-checkbox",10),_.nI1(1,"async"),_.bIt("change",function(){_.eBV(de);const ce=_.XpG(2);return _.Njj(ce.action.handler())}),_.EFF(2),_.nI1(3,"translate"),_.k0s()}if(2&ae){const de=_.XpG(2);_.Y8G("checked",_.bMT(1,2,de.checkCondition$)),_.R7$(2),_.SpI(" ",_.bMT(3,4,de.title)," ")}}function U(ae,ye){if(1&ae&&(_.j41(0,"mat-list-item",8),_.nI1(1,"async"),_.nI1(2,"translate"),_.nI1(3,"async"),_.DNE(4,G,4,6,"mat-checkbox",9),_.k0s()),2&ae){const de=_.XpG();_.Y8G("matTooltip",de.withTooltip?_.bMT(2,5,_.bMT(1,3,de.tooltip$)||de.title):"")("ngClass",_.bMT(3,7,de.ngClass$)),_.R7$(4),_.Y8G("ngIf",de.withTitle)}}let N=(()=>{class ae{disabled$=new k.t(!1);checkCondition$=new k.t(void 0);tooltip$=new k.t(void 0);noDisplay$=new k.t(!1);ngClass$=new k.t({});ngClass$$;disabled$$;availability$$;checkCondition$$;tooltip$$;noDisplay$$;display$$;isObservable=X.A;action;color="default";withTitle=!0;withIcon=!0;withTooltip=!0;set disabled(de){this.disabled$.next(de)}get disabled(){return this.disabled$.value}set noDisplay(de){this.noDisplay$.next(de)}get noDisplay(){return this.noDisplay$.value}trigger=new _.bkB;get title(){return this.action.title}ngOnInit(){const de=this.action.args||[];void 0!==this.action.ngClass&&(this.ngClass$$=this.action.ngClass(...de).subscribe(ue=>this.updateNgClass(ue))),(0,X.A)(this.action.checkCondition)?this.checkCondition$$=this.action.checkCondition.subscribe(ue=>this.updateCheckCondition(ue)):this.updateCheckCondition(this.action.checkCondition),(0,X.A)(this.action.tooltip)?this.tooltip$$=this.action.tooltip.subscribe(ue=>this.updateTooltip(ue)):this.updateTooltip(this.action.tooltip),void 0!==this.action.availability&&(this.availability$$=this.action.availability(...de).subscribe(ue=>this.disabled=!ue)),this.disabled$$=this.disabled$.subscribe(ue=>this.updateNgClass({"igo-actionbar-item-disabled":ue})),void 0!==this.action.display&&(this.display$$=this.action.display(...de).subscribe(ue=>this.noDisplay=!ue)),this.noDisplay$$=this.noDisplay$.subscribe(ue=>this.updateNgClass({"igo-actionbar-item-no-display":ue}))}ngOnDestroy(){void 0!==this.ngClass$$&&(this.ngClass$$.unsubscribe(),this.ngClass$$=void 0),void 0!==this.availability$$&&(this.availability$$.unsubscribe(),this.availability$$=void 0),void 0!==this.display$$&&(this.display$$.unsubscribe(),this.display$$=void 0),void 0!==this.checkCondition$$&&(this.checkCondition$$.unsubscribe(),this.checkCondition$$=void 0),void 0!==this.tooltip$$&&(this.tooltip$$.unsubscribe(),this.tooltip$$=void 0),this.disabled$$.unsubscribe(),this.noDisplay$$.unsubscribe()}onClick(){!0!==this.disabled&&this.trigger.emit(this.action)}updateNgClass(de){this.ngClass$.next(Object.assign({},this.ngClass$.value,de))}updateTooltip(de){this.tooltip$.next(de)}updateCheckCondition(de){this.checkCondition$.next(de)}static \u0275fac=function(ue){return new(ue||ae)};static \u0275cmp=_.VBU({type:ae,selectors:[["igo-actionbar-item"]],inputs:{action:"action",color:"color",withTitle:"withTitle",withIcon:"withIcon",withTooltip:"withTooltip",disabled:"disabled",noDisplay:"noDisplay"},outputs:{trigger:"trigger"},standalone:!0,features:[_.aNF],decls:2,vars:2,consts:[["class","actionbar-item","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click",4,"ngIf"],["class","item-checkbox","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass",4,"ngIf"],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"actionbar-item",3,"click","matTooltip","ngClass"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple",4,"ngIf"],["matLine","",4,"ngIf"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple"],[3,"icon"],["matLine",""],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"item-checkbox",3,"matTooltip","ngClass"],[3,"checked","change",4,"ngIf"],[3,"change","checked"]],template:function(ue,ce){1&ue&&_.DNE(0,Z,6,10,"mat-list-item",0)(1,U,5,9,"mat-list-item",1),2&ue&&(_.Y8G("ngIf",!ce.action.checkbox),_.R7$(),_.Y8G("ngIf",ce.action.checkbox))},dependencies:[p.bT,L.Fg,L.YE,L.zi,v.uc,v.oV,p.YU,e.Hl,e.iY,o.m_,D.g7,D.So,p.Jj,y.Ck,H.D9,h.cc],styles:["[_nghost-%COMP%]     mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-disabled[_ngcontent-%COMP%]{color:#00000042;cursor:default!important}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-no-display[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button[matlistitemavatar]{margin-left:4px}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button .mat-mdc-button-persistent-ripple{display:none}[_nghost-%COMP%]   .item-checkbox[_ngcontent-%COMP%]     mat-checkbox label{margin-left:28px}[_nghost-%COMP%]   .actionbar-item[_ngcontent-%COMP%]   [matline][_ngcontent-%COMP%]{padding-left:16px}"],changeDetection:0})}return ae})();var W=r(8004);function A(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"div",7)(1,"button",8),_.nI1(2,"translate"),_.bIt("click",function(){_.eBV(de);const ce=_.XpG();return _.Njj(ce.scrollUp())}),_.j41(3,"mat-icon"),_.EFF(4,"expand_less"),_.k0s()()()}2&ae&&(_.R7$(),_.Y8G("matTooltip",_.bMT(2,1,"igo.common.actionbar.scrollUp")))}function g(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"igo-actionbar-item",11),_.bIt("trigger",function(){_.eBV(de);const ce=_.XpG(2);return _.Njj(ce.onTriggerAction(ce.toggleCollapseAction))}),_.k0s()}if(2&ae){const de=_.XpG(2);_.Y8G("withTitle",!1)("withIcon",!0)("color",de.color)("disabled",de.store.view.empty)("action",de.toggleCollapseAction)}}function u(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"igo-actionbar-item",13),_.bIt("trigger",function(){const ce=_.eBV(de).$implicit,re=_.XpG(3);return _.Njj(re.onTriggerAction(ce))}),_.k0s()}if(2&ae){const de=ye.$implicit,ue=_.XpG(3);_.Y8G("withTitle",ue.withTitle)("withIcon",ue.withIcon)("withTooltip",ue.withTooltip)("color",ue.color)("disabled",ue.store.state.get(de).disabled)("action",de)}}function O(ae,ye){if(1&ae&&(_.DNE(0,u,1,6,"ng-template",12,0,_.C5r),_.nI1(2,"async")),2&ae){const de=_.XpG(2);_.Y8G("ngForOf",_.bMT(2,1,de.store.view.all$()))}}function j(ae,ye){if(1&ae&&(_.j41(0,"mat-list",9),_.DNE(1,g,1,5,"igo-actionbar-item",10)(2,O,3,3,null,5),_.k0s()),2&ae){const de=_.XpG();_.R7$(),_.Y8G("ngIf",de.withToggleButton),_.R7$(),_.Y8G("ngIf",!de.collapsed)}}function P(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"div",14)(1,"button",8),_.nI1(2,"translate"),_.bIt("click",function(){_.eBV(de);const ce=_.XpG();return _.Njj(ce.scrollDown())}),_.j41(3,"mat-icon"),_.EFF(4,"expand_more"),_.k0s()()()}2&ae&&(_.R7$(),_.Y8G("matTooltip",_.bMT(2,1,"igo.common.actionbar.scrollDown")))}function Y(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"igo-actionbar-item",17),_.bIt("trigger",function(){const ce=_.eBV(de).$implicit,re=_.XpG(2);return _.Njj(re.onTriggerAction(ce))}),_.k0s()}if(2&ae){const de=ye.$implicit,ue=_.XpG(2);_.Y8G("withTitle",ue.withTitle)("withIcon",ue.withIcon)("color",ue.color)("action",de)}}function w(ae,ye){if(1&ae&&(_.j41(0,"div")(1,"button",15),_.nI1(2,"translate"),_.j41(3,"mat-icon"),_.EFF(4),_.k0s()(),_.j41(5,"mat-menu",16,1)(7,"mat-list"),_.DNE(8,Y,1,4,"ng-template",12),_.nI1(9,"async"),_.k0s()()()),2&ae){const de=_.sdS(6),ue=_.XpG();_.R7$(),_.Y8G("matTooltip",_.bMT(2,10,"igo.common.actionbar.icon"))("matMenuTriggerFor",de)("disabled",ue.store.view.empty)("color",ue.iconColor),_.R7$(3),_.JRh(ue.icon),_.R7$(),_.HbH(ue.overlayClass),_.Y8G("xPosition",ue.xPosition)("yPosition",ue.yPosition),_.R7$(3),_.Y8G("ngForOf",_.bMT(9,12,ue.store.view.all$()))}}function I(ae,ye){if(1&ae){const de=_.RV6();_.j41(0,"igo-actionbar-item",17),_.bIt("trigger",function(){const ce=_.eBV(de).$implicit,re=_.XpG(2);return _.Njj(re.onTriggerAction(ce))}),_.k0s(),_.nrm(1,"br")}if(2&ae){const de=ye.$implicit,ue=_.XpG(2);_.Y8G("withTitle",ue.withTitle)("withIcon",ue.withIcon)("color",ue.color)("action",de)}}function E(ae,ye){if(1&ae&&(_.j41(0,"mat-card",18)(1,"mat-list"),_.DNE(2,I,2,4,"ng-template",12),_.nI1(3,"async"),_.k0s()()),2&ae){const de=_.XpG();_.R7$(2),_.Y8G("ngForOf",_.bMT(3,1,de.store.view.all$()))}}let s=(()=>{class ae{overlay;elRef;cdRef;mediaService;actionbarMode=M;collapsed=!1;toggleCollapseAction={id:"actionbar_toggle",icon:"more_vert",handler:()=>{this.collapsed=!this.collapsed}};watcher;heightCondition$=new k.t(!1);positionConditionTop$=new k.t(!0);positionConditionLow$=new k.t(!0);store;mode=M.Dock;withToggleButton=!1;horizontal=!1;color="default";iconColor="default";withTitle=!0;withTooltip=!0;scrollActive=!0;withIcon=!0;icon="more_horiz";xPosition="before";yPosition="above";set overlayClass(de){this._overlayClass=de}get overlayClass(){return[this._overlayClass,"igo-actionbar-overlay"].join(" ")}_overlayClass="";isCollapsed=this.collapsed;get withTitleClass(){return this.withTitle}get withIconClass(){return this.withIcon}get horizontalClass(){return this.horizontal}get heightCondition(){const de=this.elRef.nativeElement;return!1===this.scrollActive&&de.clientHeight<de.scrollHeight}get positionConditionTop(){return 0!==this.elRef.nativeElement.scrollTop}get positionConditionLow(){const de=this.elRef.nativeElement;return!(de.scrollTop>=de.scrollHeight-de.clientHeight)}get isDesktop(){return this.mediaService.getMedia()===b.$U.Desktop}constructor(de,ue,ce,re){this.overlay=de,this.elRef=ue,this.cdRef=ce,this.mediaService=re}ngOnChanges(de){const ue=de.store;ue&&ue.currentValue!==ue.previousValue&&(void 0!==this.watcher&&this.watcher.destroy(),this.watcher=new a.bz(this.store,this.cdRef))}ngOnDestroy(){this.watcher.destroy()}onTriggerAction(de){de.handler(...de.args||[])}scrollDown(){this.elRef.nativeElement.scrollBy(0,52)}scrollUp(){this.elRef.nativeElement.scrollBy(0,-52)}static \u0275fac=function(ue){return new(ue||ae)(_.rXU(W.hJ),_.rXU(_.aKT),_.rXU(_.gRc),_.rXU(b.u1))};static \u0275cmp=_.VBU({type:ae,selectors:[["igo-actionbar"]],hostVars:8,hostBindings:function(ue,ce){2&ue&&_.AVh("is-collapsed",ce.isCollapsed)("with-title",ce.withTitleClass)("with-icon",ce.withIconClass)("horizontal",ce.horizontalClass)},inputs:{store:"store",mode:"mode",withToggleButton:"withToggleButton",horizontal:"horizontal",color:"color",iconColor:"iconColor",withTitle:"withTitle",withTooltip:"withTooltip",scrollActive:"scrollActive",withIcon:"withIcon",icon:"icon",xPosition:"xPosition",yPosition:"yPosition",overlayClass:"overlayClass"},standalone:!0,features:[_.OA$,_.aNF],decls:5,vars:5,consts:[["buttonContent",""],["actionbarMenu","matMenu"],["id","topChevron",4,"ngIf"],["matListItemIcon","",4,"ngIf"],["id","lowChevron",4,"ngIf"],[4,"ngIf"],["class","context-menu-card mat-elevation-z4",4,"ngIf"],["id","topChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip"],["matListItemIcon",""],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger",4,"ngIf"],["color","accent",3,"trigger","withTitle","withIcon","color","disabled","action"],["ngFor","",3,"ngForOf"],["color","accent",3,"trigger","withTitle","withIcon","withTooltip","color","disabled","action"],["id","lowChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"buttonOverlay",3,"matTooltip","matMenuTriggerFor","disabled","color"],["overlapTrigger","true",1,"igo-compact-menu","igo-no-min-width-menu",3,"xPosition","yPosition"],["color","accent",3,"trigger","withTitle","withIcon","color","action"],[1,"context-menu-card","mat-elevation-z4"]],template:function(ue,ce){1&ue&&_.DNE(0,A,5,3,"div",2)(1,j,3,2,"mat-list",3)(2,P,5,3,"div",4)(3,w,10,14,"div",5)(4,E,4,3,"mat-card",6),2&ue&&(_.Y8G("ngIf",ce.heightCondition&&ce.positionConditionTop&&ce.isDesktop),_.R7$(),_.Y8G("ngIf",ce.mode===ce.actionbarMode.Dock),_.R7$(),_.Y8G("ngIf",ce.heightCondition&&ce.positionConditionLow&&ce.isDesktop),_.R7$(),_.Y8G("ngIf",ce.mode===ce.actionbarMode.Overlay),_.R7$(),_.Y8G("ngIf",ce.mode===ce.actionbarMode.Context))},dependencies:[p.bT,e.Hl,e.iY,v.uc,v.oV,o.m_,o.An,L.Fg,L.jt,L.ZV,N,p.pM,R.Cn,R.kk,R.Cp,c.Hu,c.RN,p.Jj,y.Ck,H.D9],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}.horizontal[_nghost-%COMP%]{max-width:100%;overflow:unset}.horizontal[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{width:auto;white-space:nowrap}.horizontal[_nghost-%COMP%]   igo-actionbar-item[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .buttonOverlay[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .context-menu-card[_ngcontent-%COMP%]{padding:8px 3px;margin:10px}[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:3;display:flex;justify-content:center}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}@supports (-ms-accelerator: true){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}[_nghost-%COMP%]   #lowChevron[_ngcontent-%COMP%]{position:sticky;bottom:0;background-color:#fff;z-index:3;display:flex;justify-content:center}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]{min-width:inherit!important;padding-top:0;padding-bottom:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]:not(:empty){padding-top:0;padding-bottom:0}[_nghost-%COMP%]     .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}"],changeDetection:0})}return ae})()},16684:(De,le,r)=>{"use strict";r.d(le,{V:()=>F});var M=r(93840),a=r(68559);let F=(()=>{class p{el;set igoMatBadgeIcon(c){this.html=`\n      <mat-icon class="mat-icon material-symbols-outlined" style="height: 16px; width: 16px; font-size: 16px;">${c}</mat-icon>\n    `,this.updateHtml()}html;set matBadgeHidden(c){this.hidden=c,this.updateHidden()}hidden=!1;set matBadgeDisabled(c){this.disabled=c,this.updateDisabled()}disabled=!1;set igoMatBadgeInverseColor(c){this.inverseColor=c,this.updateColor()}inverseColor=!1;set igoMatBadgeInheritColor(c){this.inheritColor=c,this.updateColor()}inheritColor=!1;set igoMatBadgeColor(c){this.color=c,this.updateColor()}color;set igoMatBadgeBackgroundColor(c){this.backgroundColor=c,this.updateColor()}backgroundColor;get badge(){return this.el.nativeElement.querySelector(".mat-badge-content")}originalColor;constructor(c){this.el=c}ngOnInit(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateHtml()}updateHtml(){this.badge&&(this.badge.innerHTML="",this.html&&(this.badge.innerHTML=this.html))}updateColor(){this.badge&&(this.color||this.backgroundColor?(this.badge.style.color=this.color?this.color:"",this.badge.style.background=this.backgroundColor?this.backgroundColor:""):this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inheritColor||(this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="")),this.originalColor=this.badge.style.color,this.updateDisabled())}updateHidden(){this.badge&&(this.badge.style.display=this.hidden?"none":"flex")}updateDisabled(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}static \u0275fac=function(o){return new(o||p)(a.rXU(a.aKT))};static \u0275dir=a.FsC({type:p,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor",igoMatBadgeColor:"igoMatBadgeColor",igoMatBadgeBackgroundColor:"igoMatBadgeBackgroundColor"},standalone:!0,features:[a.Jv_([M.m_])]})}return p})()},63220:(De,le,r)=>{"use strict";r.d(le,{Dc:()=>a,g2:()=>c});var M=r(68559);let a=(()=>{class L{renderer;el;get target(){return this._target}set target(v){this._target=v}_target;get collapsed(){return this._collapsed}set collapsed(v){v?this.collapseTarget():this.expandTarget(),this._collapsed=v,this.toggle.emit(v)}_collapsed=!1;toggle=new M.bkB;click(){this.collapsed=!this.collapsed}constructor(v,y){this.renderer=v,this.el=y}collapseTarget(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}expandTarget(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}static \u0275fac=function(y){return new(y||L)(M.rXU(M.sFG),M.rXU(M.aKT))};static \u0275dir=M.FsC({type:L,selectors:[["","igoCollapse",""]],hostBindings:function(y,b){1&y&&M.bIt("click",function(){return b.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0})}return L})();var F=r(93840),p=r(20943);const e=["*"];let c=(()=>{class L{get title(){return this._title}set title(v){this._title=v}_title="";get collapsed(){return this._collapsed}set collapsed(v){this._collapsed=v,this.toggle.emit(v)}_collapsed=!1;toggle=new M.bkB;static \u0275fac=function(y){return new(y||L)};static \u0275cmp=M.VBU({type:L,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0,features:[M.aNF],ngContentSelectors:e,decls:8,vars:3,consts:[["content",""],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"toggle","target","collapsed"],["matListItemTitle",""]],template:function(y,b){if(1&y){const k=M.RV6();M.NAR(),M.j41(0,"mat-list-item")(1,"mat-icon",1),M.bIt("toggle",function(D){return M.eBV(k),M.Njj(b.collapsed=D)}),M.EFF(2," expand_less "),M.k0s(),M.j41(3,"span",2),M.EFF(4),M.k0s()(),M.j41(5,"div",null,0),M.SdG(7),M.k0s()}if(2&y){const k=M.sdS(6);M.R7$(),M.Y8G("target",k)("collapsed",b.collapsed),M.R7$(3),M.JRh(b.title)}},dependencies:[p.Fg,p.YE,p.ZV,p.yE,F.m_,F.An,a],styles:["[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mat-mdc-list-item-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}"]})}return L})()},28793:(De,le,r)=>{"use strict";r.d(le,{gw:()=>o,KD:()=>L});var M=r(84175),a=r(87941),F=r(21701),p=r(68559),e=r(90852);let c=(()=>{class R{dialogRef;confirmMessage;titleKey="igo.common.confirmDialog.title";proccessKey="igo.common.confirmDialog.confirmBtn";cancelKey="igo.common.confirmDialog.cancelBtn";constructor(y){this.dialogRef=y}static \u0275fac=function(b){return new(b||R)(p.rXU(a.CP))};static \u0275cmp=p.VBU({type:R,selectors:[["igo-confirm-dialog"]],standalone:!0,features:[p.aNF],decls:13,vars:12,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-flat-button","",3,"click"]],template:function(b,k){1&b&&(p.j41(0,"h2",0),p.EFF(1),p.nI1(2,"translate"),p.k0s(),p.j41(3,"div",1),p.EFF(4),p.nI1(5,"translate"),p.k0s(),p.j41(6,"div",2)(7,"button",3),p.bIt("click",function(){return k.dialogRef.close(!0)}),p.EFF(8),p.nI1(9,"translate"),p.k0s(),p.j41(10,"button",4),p.bIt("click",function(){return k.dialogRef.close(!1)}),p.EFF(11),p.nI1(12,"translate"),p.k0s()()),2&b&&(p.R7$(),p.SpI(" ",p.bMT(2,4,k.titleKey),"\n"),p.R7$(3),p.SpI(" ",p.bMT(5,6,k.confirmMessage),"\n"),p.R7$(4),p.SpI(" ",p.bMT(9,8,k.proccessKey)," "),p.R7$(3),p.SpI(" ",p.bMT(12,10,k.cancelKey)," "))},dependencies:[a.BI,a.Yi,a.E7,M.Hl,M.$z,F.Ck,e.D9],styles:["h2[_ngcontent-%COMP%]{margin:5px 0 10px}div[mat-dialog-content][_ngcontent-%COMP%]{max-width:200px}div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}"]})}return R})(),o=(()=>{class R{dialog;constructor(y){this.dialog=y}open(y,b){const k={title:"igo.common.confirmDialog.title",modeYesNo:!1,...b},_=this.dialog.open(c,{disableClose:!1});return _.componentInstance.confirmMessage=y,_.componentInstance.titleKey=k.title,k.modeYesNo&&(_.componentInstance.proccessKey="igo.common.confirmDialog.yes",_.componentInstance.cancelKey="igo.common.confirmDialog.no"),_.afterClosed()}static \u0275fac=function(b){return new(b||R)(p.KVO(a.bZ))};static \u0275prov=p.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})(),L=(()=>{class R{static forRoot(){return{ngModule:R,providers:[]}}static \u0275fac=function(b){return new(b||R)};static \u0275mod=p.$C({type:R});static \u0275inj=p.G2t({providers:[o],imports:[c]})}return R})()},19816:(De,le,r)=>{"use strict";r.d(le,{gE:()=>p,b8:()=>F});var M=r(68559),a=r(80436);let F=(()=>{class c{_sanitizer;constructor(L){this._sanitizer=L}transform(L){return this._sanitizer.bypassSecurityTrustHtml(L)}static \u0275fac=function(R){return new(R||c)(M.rXU(a.up,16))};static \u0275pipe=M.EJ8({name:"sanitizeHtml",type:c,pure:!0,standalone:!0})}return c})(),p=(()=>{class c{get html(){return this._html}set html(L){this._html=L}_html="";constructor(){}static \u0275fac=function(R){return new(R||c)};static \u0275cmp=M.VBU({type:c,selectors:[["igo-custom-html"]],inputs:{html:"html"},standalone:!0,features:[M.aNF],decls:2,vars:3,consts:[[1,"custom-html",3,"innerHTML"]],template:function(R,v){1&R&&(M.nrm(0,"div",0),M.nI1(1,"sanitizeHtml")),2&R&&M.Y8G("innerHTML",M.bMT(1,1,v.html),M.npT)},dependencies:[F],styles:["[_nghost-%COMP%]   .custom-html[_ngcontent-%COMP%]{padding:20px}"]})}return c})()},74104:(De,le,r)=>{"use strict";r.d(le,{_i:()=>p,Yq:()=>L});var M=r(43942);class a{componentFactory;componentRef;subscriptions=[];target;inputs={};inputs$$={};subscribers={};constructor(v){this.componentFactory=v}setTarget(v){this.target=v,this.componentRef=v.createComponent(this.componentFactory),this.updateInputs(this.inputs),this.updateSubscribers(this.subscribers)}destroy(){void 0!==this.target&&this.target.clear(),void 0!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0),this.unobserveAllInputs(),this.unsubscribeAll()}updateInputs(v){if(this.inputs=v,void 0===this.componentRef)return;const y=this.componentRef.instance;this.componentFactory.inputs.forEach(k=>{const _=k.propName;this.unobserveInput(_);const D=v[_];v.hasOwnProperty(_)&&(D instanceof M.c?this.observeInput(_,D):this.setInputValue(y,_,D))}),"function"==typeof y.onUpdateInputs&&y.onUpdateInputs()}setInputValue(v,y,b){if(b===v[y])return;const _=Object.getPrototypeOf(v),D=Object.getOwnPropertyDescriptor(_,y);void 0!==D&&void 0!==D.set?D.set.call(v,b):v[y]=b}updateSubscribers(v){if(this.subscribers=v,void 0===this.componentRef)return;const y=this.componentRef.instance;this.componentFactory.outputs.forEach(k=>{const _=k.propName;if(v.hasOwnProperty(_)){const D=y[_],h=v[_];Array.isArray(h)?h.forEach(X=>{this.subscriptions.push(D.subscribe(X))}):this.subscriptions.push(D.subscribe(h))}})}observeInput(v,y){this.inputs$$[v]=y.subscribe(b=>{const k=this.componentRef.instance;this.setInputValue(k,v,b),"function"==typeof k.onUpdateInputs&&k.onUpdateInputs()})}unobserveInput(v){void 0!==this.inputs$$[v]&&(this.inputs$$[v].unsubscribe(),this.inputs$$[v]=void 0)}unobserveAllInputs(){Object.values(this.inputs$$).forEach(v=>{void 0!==v&&v.unsubscribe()}),this.inputs$$={}}unsubscribeAll(){this.subscriptions.forEach(v=>v.unsubscribe()),this.subscriptions=[]}}var F=r(68559);let p=(()=>{class R{resolver;constructor(y){this.resolver=y}create(y){const b=this.resolver.resolveComponentFactory(y);return new a(b)}static \u0275fac=function(b){return new(b||R)(F.KVO(F.OM3))};static \u0275prov=F.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})();var e=r(68671);const c=["target"];function o(R,v){}let L=(()=>{class R{dynamicComponentService;cdRef;component;inputs={};subscribers={};dynamicComponent;target;constructor(y,b){this.dynamicComponentService=y,this.cdRef=b}ngOnChanges(y){const b=y.component,k=y.inputs,_=y.subscribers,D=e.BF.objectsAreEquivalent;if(b&&b.currentValue){if(b.currentValue!==b.previousValue)this.createComponent(b.currentValue);else{const h=k&&D(k.currentValue||{},k.previousValue||{}),X=_&&D(_.currentValue||{},_.previousValue||{});!1===h&&this.updateInputs(),!1===X&&this.updateSubscribers()}this.cdRef.detectChanges()}}ngOnDestroy(){this.dynamicComponent&&this.dynamicComponent.destroy()}createComponent(y){void 0!==this.dynamicComponent&&this.dynamicComponent.destroy(),this.dynamicComponent=y instanceof a?y:this.dynamicComponentService.create(y),this.renderComponent()}renderComponent(){this.updateInputs(),this.updateSubscribers(),this.dynamicComponent.setTarget(this.target)}updateInputs(){this.dynamicComponent.updateInputs(this.inputs)}updateSubscribers(){this.dynamicComponent.updateSubscribers(this.subscribers)}static \u0275fac=function(b){return new(b||R)(F.rXU(p),F.rXU(F.gRc))};static \u0275cmp=F.VBU({type:R,selectors:[["igo-dynamic-outlet"]],viewQuery:function(b,k){if(1&b&&F.GBs(c,7,F.c1b),2&b){let _;F.mGM(_=F.lsd())&&(k.target=_.first)}},inputs:{component:"component",inputs:"inputs",subscribers:"subscribers"},standalone:!0,features:[F.OA$,F.aNF],decls:2,vars:0,consts:[["target",""]],template:function(b,k){1&b&&F.DNE(0,o,0,0,"ng-template",null,0,F.C5r)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0})}return R})()},75300:(De,le,r)=>{"use strict";r.d(le,{iX:()=>E,D_:()=>Z,fR:()=>W,qA:()=>A,Mo:()=>N,bz:()=>G,pp:()=>a,f7:()=>go,CA:()=>Ae,Tf:()=>F,Zq:()=>v,t_:()=>o,jZ:()=>c,nd:()=>y,k0:()=>L,J1:()=>R});var a=function(Te){return Te.Default="Default",Te.HTML="HTML",Te.UnsanitizedHTML="UnsanitizedHTML",Te.Editable="Editable",Te.Icon="Icon",Te.ButtonGroup="ButtonGroup",Te}(a||{}),F=function(Te){return Te.Auto="auto",Te.Instant="instant",Te.Smooth="smooth",Te}(F||{}),p=function(Te){return Te.None="None",Te.All="All",Te.Some="Some",Te}(p||{}),e=r(61541);function c(Te,pe){return(0,e.t)(Te,pe).safeObject}function o(Te){const pe=Te.meta||{};return pe.id?pe.id:c(Te,pe.idProperty||"id")}function L(Te){const pe=Te.meta||{};return pe.title?pe.title:c(Te,pe.titleProperty||"title")}function R(Te){const pe=Te.meta||{};return pe.titleHtml?pe.titleHtml:c(Te,pe.titleHtmlProperty||"titleHtml")}function v(Te){const pe=Te.meta||{};return pe.icon?pe.icon:c(Te,pe.iconProperty||"icon")}function y(Te){return(Te.meta||{}).revision||0}var b=r(75797),k=r(56042);class _{options;index=new Map;change$=new k.m(1);getKey;constructor(pe={}){this.options=pe,this.getKey=pe.getKey?pe.getKey:o,this.next()}clear(){this.index.size>0&&(this.index.clear(),this.next())}get(pe){return this.index.get(this.getKey(pe))||{}}set(pe,te){this.setMany([pe],te)}setMany(pe,te){pe.forEach(se=>{this.index.set(this.getKey(se),Object.assign({},te))}),this.next()}setAll(pe){Array.from(this.index.keys()).forEach(te=>{this.index.set(te,Object.assign({},pe))}),this.next()}update(pe,te,se=!1){this.updateMany([pe],te,se)}updateMany(pe,te,se=!1){if(!0===se)return this.updateManyExclusive(pe,te);pe.forEach(ge=>{const xe=Object.assign({},this.get(ge),te);this.index.set(this.getKey(ge),xe)}),this.next()}reverse(pe,te){this.reverseMany([pe],te)}reverseMany(pe,te){pe.forEach(se=>{const ge=this.get(se),xe=te.reduce((Gt,Rt)=>(Gt[Rt]=ge[Rt]||!1,Gt),{}),He=this.reverseChanges(xe),ot=Object.assign({},ge,He);this.index.set(this.getKey(se),ot)}),this.next()}updateAll(pe){const te=this.getAllKeys();Array.from(te).forEach(se=>{const ge=Object.assign({},this.index.get(se),pe);this.index.set(se,ge)}),this.next()}updateManyExclusive(pe,te){const se=this.reverseChanges(te),ge=pe.map(He=>this.getKey(He));new Set(ge.concat(Array.from(this.getAllKeys()))).forEach(He=>{const ot=this.index.get(He)||{};ge.indexOf(He)>=0?this.index.set(He,Object.assign({},ot,te)):!0===Object.keys(se).some(Rt=>void 0!==ot[Rt]&&ot[Rt]!==se[Rt])&&this.index.set(He,Object.assign({},ot,se))}),this.next()}reverseChanges(pe){return Object.entries(pe).reduce((te,se)=>{const[ge,xe]=se;return"boolean"==typeof xe&&(te[ge]=!xe),te},{})}getAllKeys(){const pe=Array.from(this.options?.index?.keys()??[]);return new Set(Array.from(this.index.keys()).concat(pe))}next(){this.change$.next()}}var D=r(68671),h=r(19999),X=r(70271),H=r(47470),x=r(52575);class ee{source$;values$=new b.t([]);values$$;lifted=!1;joins=[];filter$=new b.t(void 0);filters$=new b.t([]);filterIndex=new Map;sort$=new b.t(void 0);get getKey(){return this.getKey$.value}getKey$=new b.t(void 0);count$=new b.t(0);get count(){return this.count$.value}empty$=new b.t(!0);get empty(){return this.empty$.value}get index(){return this._index}_index;constructor(pe){this.source$=pe}get(pe){if(void 0===this._index)throw new Error("This view has no index, therefore, this method is unavailable.");return this.index.get(pe)}all(){return this.values$.value}all$(){return this.values$}firstBy(pe){return this.values$.value.find(pe)}firstBy$(pe){return this.values$.pipe((0,X.T)(te=>te.find(pe)))}manyBy(pe){return this.values$.value.filter(pe)}manyBy$(pe){return this.values$.pipe((0,X.T)(te=>te.filter(pe)))}clear(){this.filter(void 0),this.sort(void 0)}destroy(){void 0!==this.values$$&&this.values$$.unsubscribe(),this.clear()}createIndex(pe){return this._index=new Map,this.getKey$.next(pe),this}join(pe){if(!0===this.lifted)throw new Error("This view has already been lifted, therefore, no join is allowed.");return this.joins.push(pe),this}filter(pe){return this.filter$.next(pe),this}addFilter(pe){const te=(0,D.uR)();return this.filterIndex.set(te,pe),this.filters$.next(Array.from(this.filterIndex.values())),te}removeFilter(pe){this.filterIndex.delete(pe),this.filters$.next(Array.from(this.filterIndex.values()))}sort(pe){return this.sort$.next(pe),this}lift(){this.lifted=!0;const te=[this.joins.length>0?this.liftJoinedSource():this.liftSource(),this.filters$,this.filter$,this.sort$,this.getKey$];this.values$$=(0,h.z)(te).pipe((0,H.i)(1),(0,x.B)(5)).subscribe(se=>{const[ge,xe,He,ot,Gt]=se,Rt=this.processValues(ge,xe,He,ot);this.setValues(Rt,void 0!==Gt)})}liftSource(){return this.source$}liftJoinedSource(){const pe=[this.source$,(0,h.z)(this.joins.map(te=>te.source))];return(0,h.z)(pe).pipe((0,X.T)(te=>{const[se,ge]=te;return se.reduce((xe,He)=>{const ot=this.computeJoinedValue(He,ge);return void 0!==ot&&xe.push(ot),xe},[])}))}computeJoinedValue(pe,te){let se=pe,ge=0;for(;void 0!==se&&ge<this.joins.length;)se=this.joins[ge].reduce(se,te[ge]),ge+=1;return se}processValues(pe,te,se,ge){return pe=pe.slice(0),pe=this.filterValues(pe,te.concat([se])),this.sortValues(pe,ge)}filterValues(pe,te){return 0===te.length?pe:pe.filter(se=>te.filter(ge=>void 0!==ge).every(ge=>ge(se)))}sortValues(pe,te){return void 0===te?pe:pe.sort((se,ge)=>D.BF.naturalCompare(te.valueAccessor(se),te.valueAccessor(ge),te.direction,te.nullsFirst))}setValues(pe,te){!0===te&&(this._index=this.generateIndex(pe)),this.values$.next(pe);const se=pe.length,ge=0===se;this.count$.next(se),this.empty$.next(ge)}generateIndex(pe){const te=pe.map(se=>[this.getKey(se),se]);return new Map(te)}}class Z{entities$=new b.t([]);count$=new b.t(0);get count(){return this.count$.value}empty$=new b.t(!0);get empty(){return this.empty$.value}state;view;stateView;getKey;getProperty;get index(){return this._index}_index;get pristine(){return this._pristine}_pristine=!0;strategies=[];constructor(pe,te={}){this.getKey=te.getKey?te.getKey:o,this.getProperty=te.getProperty?te.getProperty:c,this.state=this.createStateManager(),this.view=this.createDataView(),this.stateView=this.createStateView(),this.view.lift(),this.stateView.lift(),pe.length>0?this.load(pe):this._index=this.generateIndex(pe)}get(pe){return this.index.get(pe)}all(){return this.entities$.value}load(pe,te=!0){this._index=this.generateIndex(pe),this._pristine=te,this.next()}softClear(){this.index&&this.index.size>0?(this.index.clear(),this._pristine=!0,this.next()):this.index&&this.updateCount()}clear(){this.stateView.clear(),this.view.clear(),this.state.clear(),this.softClear()}destroy(){this.stateView.destroy(),this.view.destroy(),this.clear()}insert(pe){this.insertMany([pe])}insertMany(pe){pe.forEach(te=>this.index.set(this.getKey(te),te)),this._pristine=!1,this.next()}update(pe){this.updateMany([pe])}updateMany(pe){pe.forEach(te=>this.index.set(this.getKey(te),te)),this._pristine=!1,this.next()}addStrategy(pe,te=!1){if(void 0!==this.strategies.find(ge=>pe.constructor===ge.constructor))throw new Error("A strategy of this type already exists on that EntityStore.");return this.strategies.push(pe),pe.bindStore(this),!0===te&&pe.activate(),this}removeStrategy(pe){const te=this.strategies.indexOf(pe);return te>=0&&(this.strategies.splice(te,1),pe.unbindStore(this)),this}getStrategyOfType(pe){return this.strategies.find(te=>te instanceof pe)}activateStrategyOfType(pe){const te=this.getStrategyOfType(pe);void 0!==te&&te.activate()}deactivateStrategyOfType(pe){const te=this.getStrategyOfType(pe);void 0!==te&&te.deactivate()}delete(pe){this.deleteMany([pe])}deleteMany(pe){pe.forEach(te=>this.index.delete(this.getKey(te))),this._pristine=!1,this.next()}generateIndex(pe){const te=pe.map(se=>[this.getKey(se),se]);return new Map(te)}next(){this.entities$.next(Array.from(this.index.values())),this.updateCount()}updateCount(){const pe=this.index.size,te=0===pe;this.count$.next(pe),this.empty$.next(te)}createStateManager(){return new _({getKey:this.getKey,index:this.index})}createDataView(){return new ee(this.entities$)}createStateView(){return new ee(this.view.all$()).join({source:this.state.change$,reduce:pe=>{const te=this.getKey(pe),se=this.state.get(pe),ge=this.stateView.get(te);if(void 0!==ge&&ge.entity===pe&&this.statesAreTheSame(ge.state,se))return ge;const xe=ge?ge.revision+1:1;return{entity:pe,state:se,revision:xe,ref:`${te}-${xe}`}}}).createIndex(pe=>this.getKey(pe.entity))}statesAreTheSame(pe,te){if(pe===te)return!0;const se=0===Object.keys(pe).length,ge=0===Object.keys(te).length;return se&&ge}}class G{cdRef;store;innerStateIndex=new Map;entities$$;state$$;constructor(pe,te){this.setChangeDetector(te),this.setStore(pe)}destroy(){this.setChangeDetector(void 0),this.setStore(void 0)}setStore(pe){if(void 0===pe)return this.teardownObservers(),this.innerStateIndex.clear(),void(this.store=void 0);this.setStore(void 0),this.store=pe,this.setupObservers(),this.detectChanges()}setChangeDetector(pe){this.cdRef=pe}setupObservers(){this.teardownObservers(),this.entities$$=this.store.entities$.subscribe(pe=>this.onEntitiesChange(pe)),this.state$$=this.store.state.change$.pipe((0,H.i)(1)).subscribe(()=>this.onStateChange())}teardownObservers(){void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.state$$&&this.state$$.unsubscribe(),this.entities$$=void 0,this.state$$=void 0}onEntitiesChange(pe){this.detectChanges()}onStateChange(){let pe=!1;const te=this.store.state.index,se=this.innerStateIndex;te.size!==se.size&&(pe=this.detectChanges());const ge=Array.from(te.keys());for(const xe of ge){const He=te.get(xe),ot=se.get(xe);!1===pe&&(void 0===ot?pe=this.detectChanges():D.BF.objectsAreEquivalent(He,ot)||(pe=this.detectChanges())),this.innerStateIndex.set(xe,Object.assign({},He))}}detectChanges(){return void 0!==this.cdRef&&this.cdRef.detectChanges(),!0}}class N{options;stores=[];get active(){return this.active$.value}active$=new b.t(!1);constructor(pe={}){this.options=pe,this.options=pe}activate(){!0===this.active&&this.doDeactivate(),this.active$.next(!0),this.doActivate()}deactivate(){this.active$.next(!1),this.doDeactivate()}bindStore(pe){this.stores.indexOf(pe)<0&&this.stores.push(pe)}unbindStore(pe){const te=this.stores.indexOf(pe);te>=0&&this.stores.splice(te,1)}doActivate(){}doDeactivate(){}}class W extends N{options;constructor(pe){super(pe),this.options=pe}filters=new Map;bindStore(pe){super.bindStore(pe),!0===this.active&&this.filterStore(pe)}unbindStore(pe){super.unbindStore(pe),!0===this.active&&this.unfilterStore(pe)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(pe=>this.filterStore(pe))}unfilterAll(){this.stores.forEach(pe=>this.unfilterStore(pe))}filterStore(pe){this.filters.set(pe,pe.stateView.addFilter(this.options.filterClauseFunc))}unfilterStore(pe){const te=this.filters.get(pe);void 0!==te&&(pe.stateView.removeFilter(te),this.filters.delete(pe))}}class A extends N{filters=new Map;bindStore(pe){super.bindStore(pe),!0===this.active&&this.filterStore(pe)}unbindStore(pe){super.unbindStore(pe),!0===this.active&&this.unfilterStore(pe)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(pe=>this.filterStore(pe))}unfilterAll(){this.stores.forEach(pe=>this.unfilterStore(pe))}filterStore(pe){this.filters.has(pe)||this.filters.set(pe,pe.stateView.addFilter(se=>!0===se.state.selected))}unfilterStore(pe){const te=this.filters.get(pe);void 0!==te&&(pe.stateView.removeFilter(te),this.filters.delete(pe))}}var g=r(60316),u=r(68559),O=r(85060),j=r(15944),P=r(25175);function Y(Te,pe){if(1&Te&&(u.j41(0,"mat-option",4),u.EFF(1),u.k0s()),2&Te){const te=u.XpG();u.Y8G("value",te.emptyValue),u.R7$(),u.JRh(te.emptyText)}}function w(Te,pe){if(1&Te&&(u.j41(0,"mat-option",4),u.EFF(1),u.nI1(2,"async"),u.k0s()),2&Te){const te=u.XpG();u.Y8G("value",te.multiSelectValue),u.R7$(),u.JRh(u.bMT(2,2,te.multiText$))}}function I(Te,pe){if(1&Te&&(u.j41(0,"mat-option",4),u.EFF(1),u.k0s()),2&Te){const te=pe.$implicit,se=u.XpG();u.Y8G("value",te.entity),u.R7$(),u.SpI(" ",se.titleAccessor(te.entity)," ")}}let E=(()=>{class Te{cdRef;selected$=new b.t(void 0);multiText$=new b.t(void 0);multiSelectValue={id:"IGO_MULTI_SELECT"};emptyValue={id:"IGO_EMPTY_SELECT"};selected$$;watcher;store;titleAccessor=L;emptyText=void 0;multi=!1;multiAllText="All";multiNoneText="None";placeholder;disabled=!1;selectedChange=new u.bkB;constructor(te){this.cdRef=te}ngOnInit(){this.watcher=new G(this.store,this.cdRef),this.selected$$=this.store.stateView.manyBy$(te=>!0===te.state.selected).subscribe(te=>{const se=te.map(ge=>ge.entity);this.onSelectFromStore(se)})}ngOnDestroy(){this.watcher.destroy(),this.selected$$.unsubscribe()}onSelectionChange(te){const se=te.value instanceof Array?te.value:[te.value],ge=se.find(ot=>ot===this.multiSelectValue);let xe=se.filter(ot=>ot!==this.multiSelectValue);void 0!==ge&&(xe.length===this.store.count?xe=[]:xe.length<this.store.count&&(xe=this.store.all())),xe=xe.filter(ot=>ot!==this.emptyValue),0===xe.length?this.store.state.updateAll({selected:!1}):this.store.state.updateMany(xe,{selected:!0},!0),this.selectedChange.emit({selected:!0,value:this.multi?xe:te.value})}onSelectFromStore(te){this.selected$.next(!0===this.multi?te:te.length>0?te[0]:void 0),this.updateMultiToggleWithEntities(te)}updateMultiToggleWithEntities(te){te.length===this.store.count&&this.multiText$.value!==this.multiNoneText?this.multiText$.next(this.multiNoneText):te.length<this.store.count&&this.multiText$.value!==this.multiAllText&&this.multiText$.next(this.multiAllText)}static \u0275fac=function(se){return new(se||Te)(u.rXU(u.gRc))};static \u0275cmp=u.VBU({type:Te,selectors:[["igo-entity-selector"]],inputs:{store:"store",titleAccessor:"titleAccessor",emptyText:"emptyText",multi:"multi",multiAllText:"multiAllText",multiNoneText:"multiNoneText",placeholder:"placeholder",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[u.aNF],decls:7,vars:11,consts:[["subscriptSizing","dynamic",1,"igo-entity-selector"],[3,"selectionChange","disabled","value","multiple","placeholder"],[3,"value",4,"ngIf"],["ngFor","",3,"ngForOf"],[3,"value"]],template:function(se,ge){1&se&&(u.j41(0,"mat-form-field",0)(1,"mat-select",1),u.nI1(2,"async"),u.bIt("selectionChange",function(He){return ge.onSelectionChange(He)}),u.DNE(3,Y,2,2,"mat-option",2)(4,w,3,4,"mat-option",2)(5,I,2,2,"ng-template",3),u.nI1(6,"async"),u.k0s()()),2&se&&(u.R7$(),u.Y8G("disabled",ge.disabled)("value",u.bMT(2,7,ge.selected$))("multiple",ge.multi)("placeholder",ge.placeholder),u.R7$(2),u.Y8G("ngIf",void 0!==ge.emptyText&&!1===ge.multi),u.R7$(),u.Y8G("ngIf",!0===ge.multi),u.R7$(),u.Y8G("ngForOf",u.bMT(6,9,ge.store.stateView.all$())))},dependencies:[j.RG,j.rl,P.Ve,P.VO,O.wT,g.bT,O.Sy,g.pM,g.Jj],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}return Te})();var z=r(34456),Q=r(56114),ae=r(79771),ye=r(84175),de=r(97024),ue=r(61977),ce=r(93840),re=r(87984),be=r(22047),_e=r(10906),Le=r(80640),We=r(19816),Xe=r(59912),Be=r(36222),rt=r(21701),Ie=r(39545),Ve=r.n(Ie),ie=r(43942),he=r(24624),$e=r(55050);let Ae=(()=>{class Te{languageService;mediaService;disabled=!1;hidePageSize=!1;pageIndex=0;pageSize=50;pageSizeOptions=[5,10,20,50,100,200];showFirstLastButtons=!0;count$$;entitySortChange$$;paginationLabelTranslation$$=[];entitySortChange$=new b.t(!1);store;paginatorOptions;page;length=0;paginatorChange=new u.bkB;constructor(te,se){this.languageService=te,this.mediaService=se}paginator;ngOnChanges(){this.unsubscribeAll(),this.count$$=this.store.stateView.count$.subscribe(te=>{this.length=te,this.emitPaginator()}),this.entitySortChange$$=this.entitySortChange$.subscribe(()=>{this.paginator&&this.paginator.firstPage()}),this.initPaginatorOptions(),this.translateLabels()}initPaginatorOptions(){this.disabled=this.paginatorOptions?.disabled||this.disabled,this.pageIndex=this.paginatorOptions?.pageIndex||this.pageIndex,this.pageSize=this.paginatorOptions?.pageSize||this.pageSize,this.pageSizeOptions=this.paginatorOptions?.pageSizeOptions||this.pageSizeOptions,this.mediaService.isMobile()?(this.showFirstLastButtons=!1,this.hidePageSize=!0):(this.showFirstLastButtons=this.paginatorOptions?.showFirstLastButtons||this.showFirstLastButtons,this.hidePageSize=this.paginatorOptions?.hidePageSize||this.hidePageSize)}translateLabels(){this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.firstPageLabel").subscribe(te=>{this.paginator._intl.firstPageLabel=te})),this.paginator._intl.getRangeLabel=this.rangeLabel,this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.itemsPerPageLabel").subscribe(te=>{this.paginator._intl.itemsPerPageLabel=te})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.lastPageLabel").subscribe(te=>{this.paginator._intl.lastPageLabel=te})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.nextPageLabel").subscribe(te=>{this.paginator._intl.nextPageLabel=te})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.previousPageLabel").subscribe(te=>{this.paginator._intl.previousPageLabel=te}))}rangeLabel=(te,se,ge)=>{const xe=new b.t("");if(this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.of").subscribe(Gt=>{xe.next(Gt)})),0===ge||0===se)return`0 ${xe.value} ${ge}`;const He=te*se;return`${He+1} - ${He<(ge=Math.max(ge,0))?Math.min(He+se,ge):He+se} ${xe.value} ${ge}`};unsubscribeAll(){this.paginationLabelTranslation$$.map(te=>te.unsubscribe()),this.count$$&&this.count$$.unsubscribe(),this.entitySortChange$$&&this.entitySortChange$$.unsubscribe()}ngOnDestroy(){this.unsubscribeAll()}emitPaginator(){this.paginatorChange.emit(this.paginator)}static \u0275fac=function(se){return new(se||Te)(u.rXU(rt.gw),u.rXU($e.u1))};static \u0275cmp=u.VBU({type:Te,selectors:[["igo-entity-table-paginator"]],viewQuery:function(se,ge){if(1&se&&u.GBs(he.iy,7),2&se){let xe;u.mGM(xe=u.lsd())&&(ge.paginator=xe.first)}},inputs:{entitySortChange$:"entitySortChange$",store:"store",paginatorOptions:"paginatorOptions"},outputs:{page:"page",paginatorChange:"paginatorChange"},standalone:!0,features:[u.OA$,u.aNF],decls:1,vars:7,consts:[[3,"page","disabled","hidePageSize","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"]],template:function(se,ge){1&se&&(u.j41(0,"mat-paginator",0),u.bIt("page",function(){return ge.emitPaginator()}),u.k0s()),2&se&&u.Y8G("disabled",ge.disabled)("hidePageSize",ge.hidePageSize)("length",ge.length)("pageIndex",ge.pageIndex)("pageSize",ge.pageSize)("pageSizeOptions",ge.pageSizeOptions)("showFirstLastButtons",ge.showFirstLastButtons)},dependencies:[he.Ou,he.iy],styles:["[_nghost-%COMP%]     .mat-mdc-paginator-container{min-height:unset}"],changeDetection:0})}return Te})();var Qe=r(7177);let Ge=(()=>{class Te{renderer;el;static selectedCls="igo-entity-table-row-selected";static highlightedCls="igo-entity-table-row-highlighted";selection=!1;selectOnClick=!0;highlightSelection=!0;set selected(te){!1!==this.selection&&te!==this._selected&&(this.toggleSelected(te),this.scroll())}get selected(){return this._selected}_selected=!1;scrollBehavior=F.Auto;select=new u.bkB;onClick(){!1===this.selection||!1===this.selectOnClick||(this.toggleSelected(!0),this.select.emit(this))}constructor(te,se){this.renderer=te,this.el=se}toggleSelected(te){this._selected=te,!0===te?(this.addCls(Te.selectedCls),!0===this.highlightSelection&&this.addCls(Te.highlightedCls)):(this.removeCls(Te.selectedCls),this.removeCls(Te.highlightedCls))}scroll(){!0===this._selected&&(0,Qe.A)(this.el.nativeElement,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})}addCls(te){this.renderer.addClass(this.el.nativeElement,te)}removeCls(te){this.renderer.removeClass(this.el.nativeElement,te)}static \u0275fac=function(se){return new(se||Te)(u.rXU(u.sFG),u.rXU(u.aKT))};static \u0275dir=u.FsC({type:Te,selectors:[["","igoEntityTableRow",""]],hostBindings:function(se,ge){1&se&&u.bIt("click",function(){return ge.onClick()})},inputs:{selection:"selection",selectOnClick:"selectOnClick",highlightSelection:"highlightSelection",selected:"selected",scrollBehavior:"scrollBehavior"},outputs:{select:"select"},standalone:!0})}return Te})();var at=r(72102),Oe=r(90852);const Ye=Te=>({height:Te});function ze(Te,pe){if(1&Te){const te=u.RV6();u.qex(0),u.j41(1,"mat-checkbox",18),u.bIt("change",function(ge){u.eBV(te);const xe=u.XpG(3);return u.Njj(xe.onToggleRows(ge.checked))}),u.k0s(),u.bVm()}if(2&Te){const te=pe.ngIf,se=u.XpG(3);u.R7$(),u.Y8G("checked",te===se.entityTableSelectionState.All)("indeterminate",te===se.entityTableSelectionState.Some)}}function et(Te,pe){if(1&Te&&(u.qex(0),u.DNE(1,ze,2,2,"ng-container",17),u.nI1(2,"async"),u.bVm()),2&Te){const te=u.XpG(2);u.R7$(),u.Y8G("ngIf",u.bMT(2,1,te.selectionState$))}}function jt(Te,pe){if(1&Te&&(u.j41(0,"th",16),u.DNE(1,et,3,3,"ng-container",17),u.k0s()),2&Te){const te=u.XpG();u.R7$(),u.Y8G("ngIf",te.selectMany)}}function dt(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"td",19)(1,"mat-checkbox",20),u.bIt("mousedown",function(ge){return u.eBV(te),u.Njj(ge.shiftKey?ge.preventDefault():null)})("click",function(ge){const xe=u.eBV(te).$implicit,He=u.XpG();return u.Njj(ge.shiftKey?He.onShiftToggleRow(!He.rowIsSelected(xe.record),xe.record,ge):ge.stopPropagation())})("change",function(ge){const xe=u.eBV(te).$implicit,He=u.XpG();return u.Njj(He.onToggleRow(ge.checked,xe.record))}),u.k0s()()}if(2&Te){const te=pe.$implicit,se=u.XpG();u.R7$(),u.Y8G("checked",se.rowIsSelected(te.record))}}function to(Te,pe){if(1&Te&&(u.j41(0,"th",23),u.EFF(1),u.k0s()),2&Te){const te=u.XpG(2).$implicit;u.Y8G("matTooltip",te.tooltip?te.tooltip:void 0),u.R7$(),u.SpI(" ",te.title," ")}}function Bt(Te,pe){1&Te&&(u.qex(0),u.DNE(1,to,2,2,"th",22),u.bVm())}function Tt(Te,pe){if(1&Te&&(u.j41(0,"th",25),u.EFF(1),u.k0s()),2&Te){const te=u.XpG(2).$implicit;u.Y8G("matTooltip",te.tooltip?te.tooltip:void 0),u.R7$(),u.SpI(" ",te.title," ")}}function wo(Te,pe){1&Te&&(u.qex(0),u.DNE(1,Tt,2,2,"th",24),u.bVm())}function Mt(Te,pe){if(1&Te&&(u.j41(0,"td",28),u.EFF(1),u.k0s()),2&Te){const te=u.XpG().$implicit,se=u.XpG(3).$implicit;u.Y8G("ngClass",te.cellData[se.name].class),u.R7$(),u.SpI(" ",te.cellData[se.name].value," ")}}function mo(Te,pe){if(1&Te&&(u.nrm(0,"img",31),u.nI1(1,"secureImage"),u.nI1(2,"async")),2&Te){const te=u.XpG(2).$implicit,se=u.XpG(3).$implicit;u.FS9("src",u.bMT(2,3,u.bMT(1,1,te.cellData[se.name].value)),u.B4B)}}function ut(Te,pe){1&Te&&(u.j41(0,"span"),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&Te&&(u.R7$(),u.SpI("",u.bMT(2,1,"igo.common.entity-table.targetHtmlUrl")," "))}function Ft(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"td",28)(1,"a",29),u.bIt("click",function(ge){return u.eBV(te),u.Njj(ge.stopPropagation())}),u.DNE(2,mo,3,5,"img",30)(3,ut,3,3,"ng-template",null,1,u.C5r),u.k0s()()}if(2&Te){const te=u.sdS(4),se=u.XpG().$implicit,ge=u.XpG(3).$implicit;u.Y8G("ngClass",se.cellData[ge.name].class),u.R7$(),u.FS9("href",se.cellData[ge.name].value,u.B4B),u.R7$(),u.Y8G("ngIf",se.cellData[ge.name].isImg)("ngIfElse",te)}}function Qt(Te,pe){if(1&Te&&(u.qex(0),u.DNE(1,Mt,2,2,"td",27)(2,Ft,5,4,"ng-template",null,0,u.C5r),u.bVm()),2&Te){const te=pe.$implicit,se=u.sdS(3),ge=u.XpG(3).$implicit;u.R7$(),u.Y8G("ngIf",!te.cellData[ge.name].isUrl)("ngIfElse",se)}}function nt(Te,pe){1&Te&&(u.qex(0),u.DNE(1,Qt,4,2,"ng-container",26),u.bVm())}function Eo(Te,pe){if(1&Te&&u.nrm(0,"td",33),2&Te){const te=u.XpG().$implicit,se=u.XpG(3).$implicit;u.Y8G("ngClass",te.cellData[se.name].class)("innerHTML",te.cellData[se.name].value,u.npT)}}function qt(Te,pe){if(1&Te&&(u.nrm(0,"img",31),u.nI1(1,"secureImage"),u.nI1(2,"async")),2&Te){const te=u.XpG(2).$implicit,se=u.XpG(3).$implicit;u.FS9("src",u.bMT(2,3,u.bMT(1,1,te.cellData[se.name].value)),u.B4B)}}function ro(Te,pe){1&Te&&(u.j41(0,"span"),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&Te&&(u.R7$(),u.SpI("",u.bMT(2,1,"igo.geo.targetHtmlUrl")," "))}function Uo(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"td",28)(1,"a",29),u.bIt("click",function(ge){return u.eBV(te),u.Njj(ge.stopPropagation())}),u.DNE(2,qt,3,5,"img",30)(3,ro,3,3,"ng-template",null,1,u.C5r),u.k0s()()}if(2&Te){const te=u.sdS(4),se=u.XpG().$implicit,ge=u.XpG(3).$implicit;u.Y8G("ngClass",se.cellData[ge.name].class),u.R7$(),u.FS9("href",se.cellData[ge.name].value,u.B4B),u.R7$(),u.Y8G("ngIf",se.cellData[ge.name].isImg)("ngIfElse",te)}}function Do(Te,pe){if(1&Te&&(u.qex(0),u.DNE(1,Eo,1,2,"td",32)(2,Uo,5,4,"ng-template",null,2,u.C5r),u.bVm()),2&Te){const te=pe.$implicit,se=u.sdS(3),ge=u.XpG(3).$implicit;u.R7$(),u.Y8G("ngIf",!te.cellData[ge.name].isUrl)("ngIfElse",se)}}function dn(Te,pe){1&Te&&(u.qex(0),u.DNE(1,Do,4,2,"ng-container",26),u.bVm())}function lo(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"div",45),u.nrm(1,"mat-datepicker-toggle",46),u.j41(2,"input",47),u.bIt("dateChange",function(ge){u.eBV(te);const xe=u.XpG(2).$implicit,He=u.XpG(3).$implicit,ot=u.XpG();return u.Njj(ot.onDateChange(He.name,xe.record,ge))}),u.k0s(),u.nrm(3,"mat-datepicker",null,5),u.k0s()}if(2&Te){const te=u.sdS(4),se=u.XpG(2).$implicit,ge=u.XpG(3).$implicit;u.R7$(),u.Y8G("for",te),u.R7$(),u.FS9("value",se.cellData[ge.name].value),u.Y8G("matDatepicker",te)("formControlName",ge.name)}}function co(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"input",48),u.bIt("focus",function(ge){u.eBV(te);const xe=u.XpG(5).$implicit;return u.Njj(xe.onFocus(ge))})("keypress",function(ge){u.eBV(te);const xe=u.XpG(5).$implicit;return u.Njj(xe.onChange(ge))})("blur",function(ge){u.eBV(te);const xe=u.XpG(5).$implicit;return u.Njj(xe.onBlur(ge))}),u.k0s()}if(2&Te){const te=u.XpG(5).$implicit;u.Y8G("formControlName",te.name)}}function mt(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"input",49),u.bIt("input",function(ge){u.eBV(te);const xe=u.XpG(2).$implicit,He=u.XpG(3).$implicit,ot=u.XpG();return u.Njj(ot.onValueChange(He.name,xe.record,ge))}),u.k0s()}if(2&Te){const te=u.XpG(2).$implicit,se=u.XpG(3).$implicit,ge=u.XpG();u.FS9("step",se.step),u.FS9("value",te.cellData[se.name].value),u.FS9("readonly",ge.getValidationAttributeValue(se,"readonly")),u.FS9("required",ge.getValidationAttributeValue(se,"mandatory")),u.FS9("min",ge.getValidationAttributeValue(se,"minValue")),u.FS9("max",ge.getValidationAttributeValue(se,"maxValue")),u.Y8G("formControlName",se.name)}}function Ro(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"input",50),u.bIt("input",function(ge){u.eBV(te);const xe=u.XpG(2).$implicit,He=u.XpG(3).$implicit,ot=u.XpG();return u.Njj(ot.onValueChange(He.name,xe.record,ge))}),u.k0s()}if(2&Te){const te=u.XpG(2).$implicit,se=u.XpG(3).$implicit,ge=u.XpG();u.FS9("value",te.cellData[se.name].value),u.FS9("readonly",ge.getValidationAttributeValue(se,"readonly")),u.FS9("required",ge.getValidationAttributeValue(se,"mandatory")),u.Y8G("formControlName",se.name)}}function tn(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"mat-checkbox",51),u.bIt("change",function(ge){u.eBV(te);const xe=u.XpG(2).$implicit,He=u.XpG(3).$implicit,ot=u.XpG();return u.Njj(ot.onBooleanValueChange(He.name,xe.record,ge))}),u.k0s()}if(2&Te){const te=u.XpG(2).$implicit,se=u.XpG(3).$implicit;u.Y8G("formControlName",se.name)("checked",te.cellData[se.name].value)}}function Xo(Te,pe){if(1&Te&&(u.j41(0,"mat-option",54),u.EFF(1),u.k0s()),2&Te){const te=pe.$implicit;u.Y8G("value",te.id)("disabled",te.disabled),u.R7$(),u.SpI(" ",te.value," ")}}function mn(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"mat-select",52),u.bIt("selectionChange",function(ge){u.eBV(te);const xe=u.XpG(2).$implicit,He=u.XpG(3).$implicit,ot=u.XpG();return u.Njj(ot.onSelectValueChange(He.name,xe.record,ge))}),u.DNE(1,Xo,2,3,"mat-option",53),u.k0s()}if(2&Te){const te=u.XpG(2).$implicit,se=u.XpG(3).$implicit,ge=u.XpG();u.FS9("required",ge.getValidationAttributeValue(se,"mandatory")),u.Y8G("formControlName",se.name)("multiple",se.multiple)("value",te.cellData[se.name].value),u.R7$(),u.Y8G("ngForOf",se.domainValues)}}function Po(Te,pe){if(1&Te&&u.nrm(0,"input",55),2&Te){u.XpG();const te=u.sdS(9),se=u.XpG().$implicit,ge=u.XpG(3).$implicit,xe=u.XpG();u.FS9("required",xe.getValidationAttributeValue(ge,"mandatory")),u.FS9("value",se.cellData[ge.name].value),u.FS9("readonly",xe.getValidationAttributeValue(ge,"readonly")),u.Y8G("formControlName",ge.name)("matAutocomplete",te)}}function yo(Te,pe){if(1&Te&&(u.j41(0,"mat-option",56),u.EFF(1),u.k0s()),2&Te){const te=pe.$implicit;u.Y8G("value",te.id),u.R7$(),u.SpI(" ",te.value," ")}}function so(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"td",35),u.DNE(1,lo,5,4,"div",36)(2,co,1,1,"input",37)(3,mt,1,7,"input",38)(4,Ro,1,4,"input",39)(5,tn,1,2,"mat-checkbox",40)(6,mn,2,5,"mat-select",41)(7,Po,1,5,"input",42),u.j41(8,"mat-autocomplete",43,4),u.bIt("optionSelected",function(ge){u.eBV(te);const xe=u.XpG().$implicit,He=u.XpG(3).$implicit,ot=u.XpG();return u.Njj(ot.onAutocompleteValueChange(He,xe.record,ge))}),u.DNE(10,yo,2,2,"mat-option",44),u.nI1(11,"async"),u.k0s()()}if(2&Te){const te=u.XpG().$implicit,se=u.XpG(3).$implicit,ge=u.XpG();u.Y8G("formGroup",ge.formGroup)("ngClass",te.cellData[se.name].class),u.R7$(),u.Y8G("ngIf","date"===se.type),u.R7$(),u.Y8G("ngIf","time"===se.type),u.R7$(),u.Y8G("ngIf","number"===se.type),u.R7$(),u.Y8G("ngIf",!se.type||"string"===se.type),u.R7$(),u.Y8G("ngIf","boolean"===se.type),u.R7$(),u.Y8G("ngIf","list"===se.type),u.R7$(),u.Y8G("ngIf","autocomplete"===se.type),u.R7$(3),u.Y8G("ngForOf",u.bMT(11,10,ge.filteredOptions[se.name]))}}function At(Te,pe){if(1&Te&&(u.nrm(0,"td",33),u.nI1(1,"sanitizeHtml")),2&Te){const te=u.XpG(2).$implicit,se=u.XpG(3).$implicit;u.Y8G("ngClass",te.cellData[se.name].class)("innerHTML",u.bMT(1,2,te.cellData[se.name].value),u.npT)}}function $o(Te,pe){if(1&Te&&(u.nrm(0,"img",31),u.nI1(1,"secureImage"),u.nI1(2,"async")),2&Te){const te=u.XpG(3).$implicit,se=u.XpG(3).$implicit;u.FS9("src",u.bMT(2,3,u.bMT(1,1,te.cellData[se.name].value)),u.B4B)}}function on(Te,pe){1&Te&&(u.j41(0,"span"),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&Te&&(u.R7$(),u.SpI("",u.bMT(2,1,"igo.geo.targetHtmlUrl")," "))}function vo(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"td",28)(1,"a",29),u.bIt("click",function(ge){return u.eBV(te),u.Njj(ge.stopPropagation())}),u.DNE(2,$o,3,5,"img",30)(3,on,3,3,"ng-template",null,1,u.C5r),u.k0s()()}if(2&Te){const te=u.sdS(4),se=u.XpG(2).$implicit,ge=u.XpG(3).$implicit;u.Y8G("ngClass",se.cellData[ge.name].class),u.R7$(),u.FS9("href",se.cellData[ge.name].value,u.B4B),u.R7$(),u.Y8G("ngIf",se.cellData[ge.name].isImg)("ngIfElse",te)}}function Ht(Te,pe){if(1&Te&&u.DNE(0,At,2,4,"td",32)(1,vo,5,4,"ng-template",null,6,u.C5r),2&Te){const te=u.sdS(2),se=u.XpG().$implicit,ge=u.XpG(3).$implicit;u.Y8G("ngIf",!se.cellData[ge.name].isUrl)("ngIfElse",te)}}function Io(Te,pe){if(1&Te&&(u.qex(0),u.DNE(1,so,12,12,"td",34)(2,Ht,3,2,"ng-template",null,3,u.C5r),u.bVm()),2&Te){const te=pe.$implicit,se=u.sdS(3),ge=u.XpG(4);u.R7$(),u.Y8G("ngIf",ge.isEdition(te.record))("ngIfElse",se)}}function Co(Te,pe){1&Te&&(u.qex(0),u.DNE(1,Io,4,2,"ng-container",26),u.bVm())}function Lo(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"mat-icon",59),u.bIt("click",function(ge){u.eBV(te);const xe=u.XpG(4).$implicit;return u.Njj(xe.onClick(ge))}),u.EFF(1),u.k0s()}if(2&Te){const te=u.XpG().$implicit,se=u.XpG(3).$implicit;u.R7$(),u.JRh(te.cellData[se.name].value||se.icon)}}function Ao(Te,pe){if(1&Te&&(u.j41(0,"mat-icon"),u.EFF(1),u.k0s()),2&Te){const te=u.XpG().$implicit,se=u.XpG(3).$implicit;u.R7$(),u.JRh(te.cellData[se.name].value||se.icon)}}function ko(Te,pe){if(1&Te&&(u.j41(0,"td",28),u.DNE(1,Lo,2,1,"mat-icon",58)(2,Ao,2,1,"mat-icon",17),u.k0s()),2&Te){const te=pe.$implicit,se=u.XpG(3).$implicit;u.Y8G("ngClass",te.cellData[se.name].class),u.R7$(),u.Y8G("ngIf",se.onClick),u.R7$(),u.Y8G("ngIf",!se.onClick)}}function zt(Te,pe){1&Te&&(u.qex(0),u.DNE(1,ko,3,3,"td",57),u.bVm())}function Ko(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"button",63),u.bIt("mousedown",function(){u.eBV(te);const ge=u.XpG(2).$implicit,xe=u.XpG().$implicit,He=u.XpG(4);return u.Njj(He.onButtonClick(ge.click,xe.record))}),u.j41(1,"mat-icon"),u.EFF(2),u.k0s()()}if(2&Te){const te=u.XpG(2).$implicit;u.Y8G("color",te.color)("disabled",te.disabled),u.R7$(2),u.JRh(te.icon)}}function oo(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"button",64),u.bIt("mousedown",function(){u.eBV(te);const ge=u.XpG(2).$implicit,xe=u.XpG().$implicit,He=u.XpG(4);return u.Njj(He.onButtonClick(ge.click,xe.record))}),u.j41(1,"mat-icon"),u.EFF(2),u.k0s()()}if(2&Te){const te=u.XpG(2).$implicit;u.Y8G("color",te.color)("disabled",te.disabled),u.R7$(2),u.JRh(te.icon)}}function jo(Te,pe){if(1&Te&&(u.qex(0),u.DNE(1,Ko,3,3,"button",61)(2,oo,3,3,"button",62),u.bVm()),2&Te){const te=u.XpG().$implicit;u.R7$(),u.Y8G("ngIf","mat-icon-button"===te.style),u.R7$(),u.Y8G("ngIf","mat-icon-button"!==te.style)}}function Fe(Te,pe){if(1&Te&&(u.j41(0,"span"),u.DNE(1,jo,3,2,"ng-container",17),u.k0s()),2&Te){const te=pe.$implicit,se=u.XpG().$implicit,ge=u.XpG(4);u.R7$(),u.Y8G("ngIf",ge.isEdition(se.record)===te.editMode||void 0===te.editMode)}}function tt(Te,pe){if(1&Te&&(u.qex(0),u.j41(1,"td",28),u.DNE(2,Fe,2,1,"span",60),u.k0s(),u.bVm()),2&Te){const te=pe.$implicit,se=u.XpG(3).$implicit;u.R7$(),u.Y8G("ngClass",te.cellData[se.name].class),u.R7$(),u.Y8G("ngForOf",te.cellData[se.name].value)}}function Ce(Te,pe){1&Te&&(u.qex(0),u.DNE(1,tt,3,2,"ng-container",26),u.bVm())}function Ee(Te,pe){if(1&Te&&(u.qex(0),u.DNE(1,nt,2,0,"ng-container",17)(2,dn,2,0,"ng-container",17)(3,Co,2,0,"ng-container",17)(4,zt,2,0,"ng-container",17)(5,Ce,2,0,"ng-container",17),u.bVm()),2&Te){const te=pe.ngIf,se=u.XpG(2);u.R7$(),u.Y8G("ngIf",te===se.entityTableColumnRenderer.Default),u.R7$(),u.Y8G("ngIf",te===se.entityTableColumnRenderer.HTML),u.R7$(),u.Y8G("ngIf",te===se.entityTableColumnRenderer.UnsanitizedHTML),u.R7$(),u.Y8G("ngIf",te===se.entityTableColumnRenderer.Icon),u.R7$(),u.Y8G("ngIf",te===se.entityTableColumnRenderer.ButtonGroup)}}function Re(Te,pe){if(1&Te&&(u.qex(0,21),u.DNE(1,Bt,2,0,"ng-container",17)(2,wo,2,0,"ng-container",17)(3,Ee,6,5,"ng-container",17),u.bVm()),2&Te){const te=pe.$implicit,se=u.XpG();u.Y8G("matColumnDef",te.name),u.R7$(),u.Y8G("ngIf",se.columnIsSortable(te)),u.R7$(),u.Y8G("ngIf",!se.columnIsSortable(te)),u.R7$(),u.Y8G("ngIf",se.getColumnRenderer(te))}}function ct(Te,pe){if(1&Te&&u.nrm(0,"tr",65),2&Te){const te=u.XpG();u.Y8G("ngClass",te.getHeaderClass())}}function no(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"tr",66),u.bIt("select",function(){const ge=u.eBV(te).$implicit,xe=u.XpG();return u.Njj(xe.onRowSelect(ge.record))})("click",function(){const ge=u.eBV(te).$implicit,xe=u.XpG();return u.Njj(xe.onRowClick(ge.record))}),u.k0s()}if(2&Te){const te=pe.$implicit,se=u.XpG();u.Y8G("scrollBehavior",se.scrollBehavior)("ngClass",se.getRowClass(te.record))("selection",se.selection)("selected",se.rowIsSelected(te.record))}}function gn(Te,pe){if(1&Te){const te=u.RV6();u.j41(0,"igo-entity-table-paginator",67),u.bIt("paginatorChange",function(ge){u.eBV(te);const xe=u.XpG();return u.Njj(xe.paginatorChange(ge))}),u.k0s()}if(2&Te){const te=u.XpG();u.Y8G("store",te.store)("paginatorOptions",te.paginatorOptions)("entitySortChange$",te.entitySortChange$)}}let go=(()=>{class Te{cdRef;formBuilder;_focusMonitor;_elementRef;ngControl;_parentForm;_controlName;_defaultErrorStateMatcher;dateAdapter;entitySortChange$=new b.t(!1);formGroup=new z.J3({});filteredOptions={};entityTableColumnRenderer=a;entityTableSelectionState=p;selectionState$=new b.t(void 0);selection$$;dataSource$$;lastRecordCheckedKey;store;set paginator(te){this._paginator=te,this.dataSource.paginator=te}get paginator(){return this._paginator}_paginator;template;scrollBehavior=F.Auto;sortNullsFirst=!1;withPaginator=!1;paginatorOptions;entityClick=new u.bkB;entitySelectChange=new u.bkB;entitySortChange=new u.bkB(void 0);get headers(){let te=this.template.columns.filter(se=>!1!==se.visible).map(se=>se.name);return!0===this.selectionCheckbox&&(te=["selectionCheckbox"].concat(te)),te}dataSource=new _e.I6;get selection(){return this.template.selection||!1}get selectionCheckbox(){return this.template.selectionCheckbox||!1}get selectMany(){return this.template.selectMany||!1}get fixedHeader(){return void 0===this.template.fixedHeader||this.template.fixedHeader}get tableHeight(){return this.template.tableHeight?this.template.tableHeight:"auto"}constructor(te,se,ge,xe,He,ot,Gt,Rt,Jt){this.cdRef=te,this.formBuilder=se,this._focusMonitor=ge,this._elementRef=xe,this.ngControl=He,this._parentForm=ot,this._controlName=Gt,this._defaultErrorStateMatcher=Rt,this.dateAdapter=Jt,this.dateAdapter.setLocale("fr-CA")}ngOnInit(){this.handleDatasource(),this.dataSource.paginator=this.paginator,this.store.state.change$.pipe((0,x.B)(100)).subscribe(()=>{this.handleDatasource(),this.refresh()})}ngOnChanges(te){const se=te.store;se&&se.currentValue!==se.previousValue&&this.handleDatasource()}onValueChange(te,se,ge){const xe=this.getColumnKeyWithoutPropertiesTag(te);se.entity.properties[xe]=ge.target.value}onBooleanValueChange(te,se,ge){const xe=this.getColumnKeyWithoutPropertiesTag(te);se.entity.properties[xe]=ge.checked}onSelectValueChange(te,se,ge){const xe=this.getColumnKeyWithoutPropertiesTag(te);se.entity.properties[xe]=ge.value}onAutocompleteValueChange(te,se,ge){this.formGroup.controls[te.name].setValue(ge.option.viewValue);const xe=this.getColumnKeyWithoutPropertiesTag(te.name);se.entity.properties[xe]=ge.option.value}onDateChange(te,se,ge){const He=Ve()(ge.value).format("YYYY-MM-DD"),ot=this.getColumnKeyWithoutPropertiesTag(te);se.entity.properties[ot]=He}enableEdit(te){const se=te.entity.properties||te.entity;this.template.columns.forEach(ge=>{ge.title=ge.validation?.mandatory&&!ge.title.includes("*")?ge.title+" *":ge.title;const xe=this.getColumnKeyWithoutPropertiesTag(ge.name);if("boolean"===ge.type)se[xe]&&null!==se[xe]?"string"==typeof se[xe]&&(se[xe]=JSON.parse(se[xe].toLowerCase())):se[xe]=!1,this.formGroup.setControl(ge.name,this.formBuilder.control(se[xe]));else if("list"===ge.type)ge.multiple?this.formGroup.setControl(ge.name,this.formBuilder.control([se[xe]])):(this.formGroup.setControl(ge.name,this.formBuilder.control(se[xe])),this.formGroup.controls[ge.name].setValue("string"==typeof se[xe]?parseInt(se[xe]):se[xe]));else if("autocomplete"===ge.type){this.formGroup.setControl(ge.name,this.formBuilder.control(se[xe])),this.filteredOptions[ge.name]=new ie.c,this.filteredOptions[ge.name]=this.formGroup.controls[ge.name].valueChanges.pipe((0,X.T)(ot=>{if(ot?.length)return ge.domainValues?.filter(Gt=>{const Rt=ot?ot.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return Gt.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Rt)})}));let He=se[xe];if(ge.domainValues.forEach(ot=>{"string"==typeof He&&D.$x.isValidNumber(He)&&!D.$x.isOctalNumber(He)&&(He=parseInt(He)),(ot.value===He||ot.id===He)&&(He=ot.value)}),this.formGroup.controls[ge.name].setValue(He),this.isEdition(te)&&ge.linkColumnForce){const ot=te.entity;this.formGroup.controls[ge.name].setValue(ot?.properties[this.getColumnKeyWithoutPropertiesTag(ge.linkColumnForce)])}}else if("date"===ge.type){if(!1!==ge.visible)if(se[xe]){let He=Ve()(se[xe]);se[xe]=He.utc().format("YYYY-MM-DD"),this.formGroup.setControl(ge.name,this.formBuilder.control(se[xe]))}else{const He=this.getColumnKeyWithoutPropertiesTag(ge.name);te.entity.properties[He]=null,this.formGroup.setControl(ge.name,this.formBuilder.control(null))}}else this.formGroup.setControl(ge.name,this.formBuilder.control(se[xe]));this.formGroup.controls[ge.name]&&this.getValidationAttributeValue(ge,"readonly")&&this.formGroup.controls[ge.name].disable()})}handleDatasource(){this.unsubscribeStore(),this.selection$$=this.store.stateView.manyBy$(te=>!0===te.state.selected).subscribe(te=>{const se=te[0],ge=this.store.stateView.all().indexOf(se),xe=this.paginator?this.paginator.pageSize*(this.paginator.pageIndex+1):0;if(this.paginator&&(ge<(this.paginator?xe-this.paginator.pageSize:0)||ge>=xe)){const ot=Math.floor(ge/this.paginator.pageSize);this.dataSource.paginator.pageIndex=ot}this.selectionState$.next(this.computeSelectionState(te))}),this.dataSource$$=this.store.stateView.all$().subscribe(te=>{te[0]&&this.enableEdit(te[0]),this.dataSource.data=te.map(se=>({record:se,cellData:this.template.columns.reduce((ge,xe)=>{const He=this.getValue(se,xe);return ge[xe.name]={class:this.getCellClass(se,xe),value:He,isUrl:this.isUrl(He),isImg:this.isImg(He)},ge},{})}))})}ngOnDestroy(){this.unsubscribeStore()}unsubscribeStore(){this.selection$$&&this.selection$$.unsubscribe(),this.dataSource$$&&this.dataSource$$.unsubscribe()}getTrackByFunction(){return(te,se)=>se.record.ref}refresh(){this.cdRef.detectChanges()}paginatorChange(te){this.paginator=te}onSort(te){const se=te.direction,ge=this.template.columns.find(xe=>xe.name===te.active);"asc"===se||"desc"===se?(this.store.stateView.sort({valueAccessor:xe=>this.getValue(xe,ge),direction:se,nullsFirst:this.sortNullsFirst}),this.entitySortChange.emit({column:ge,direction:se}),this.entitySortChange$.next(!0)):this.store.stateView.sort(void 0)}onRowClick(te){this.lastRecordCheckedKey=this.store.stateView.getKey(te),this.entityClick.emit(te.entity)}onRowSelect(te){if(!1===this.selection)return;const se=te.entity;this.store.state.update(se,{selected:!0},!0),this.entitySelectChange.emit({added:[se]})}onToggleRows(te){if(!1===this.selection)return;const se=this.store.view.all();this.entitySelectChange.emit({added:[se]}),this.store.state.updateMany(se,{selected:te})}onToggleRow(te,se){if(!1===this.selection)return;const ge=se.entity;this.store.state.update(ge,{selected:te},!0===te&&!this.selectMany),!0===te&&this.entitySelectChange.emit({added:[ge]}),this.lastRecordCheckedKey=this.store.stateView.getKey(se)}onShiftToggleRow(te,se,ge){if(!1===this.selection)return;if(!1===this.selectMany||void 0===this.lastRecordCheckedKey)return void this.onToggleRow(te,se);const xe=window.document.createRange();xe.selectNode(ge.target),window.getSelection().removeAllRanges(),window.getSelection().addRange(xe),ge.stopImmediatePropagation();const He=this.store.stateView.all(),ot=He.indexOf(se),Gt=this.store.stateView.get(this.lastRecordCheckedKey),Jt=[ot,He.indexOf(Gt)],_n=He.slice(Math.min(...Jt),Math.max(...Jt)+1).map(Rn=>Rn.entity);this.store.state.updateMany(_n,{selected:te}),!0===te&&this.entitySelectChange.emit({added:_n}),this.lastRecordCheckedKey=this.store.stateView.getKey(se)}computeSelectionState(te){const ge=te.length;return 0===ge?p.None:ge===this.store.stateView.count?p.All:p.Some}columnIsSortable(te){let se=te.sort;return void 0===se&&(se=void 0!==this.template.sort&&this.template.sort),se}rowIsSelected(te){const se=te.state;return!!se.selected&&se.selected}isImg(te){return!!this.isUrl(te)&&-1!==["jpg","png","gif"].indexOf(te.split(".").pop().toLowerCase())}isUrl(te){return"string"==typeof te&&("https://"===te.slice(0,8)||"http://"===te.slice(0,7))}getValue(te,se){const ge=te.entity;let xe;if(void 0!==se.valueAccessor)return se.valueAccessor(ge,te);if(void 0!==this.template.valueAccessor)return this.template.valueAccessor(ge,se.name,te);if(xe=this.store.getProperty(ge,se.name),"boolean"===se.type)null==xe||""===xe?xe=!1:"boolean"!=typeof xe&&void 0!==xe&&(xe="number"==typeof xe?!!xe:JSON.parse(xe.toLowerCase())),this.isEdition(te)||(xe=xe?"&#10003;":"");else if("list"===se.type&&xe&&se.domainValues){const He=te.entity;if(se.multiple){let ot;ot="string"==typeof xe?xe.match(/[\w.-]+/g).map(Number):xe;let Gt=[];se.domainValues.forEach(Rt=>{ot.includes(Rt.id)&&Gt.push(te.edition?Rt.id:Rt.value)}),xe=this.isEdition(te)?ot:Gt}else!this.isEdition(te)&&se.linkColumnForce?xe=He?.properties[this.getColumnKeyWithoutPropertiesTag(se.linkColumnForce)]:se.domainValues.forEach(ot=>{"string"==typeof xe&&D.$x.isValidNumber(xe)&&!D.$x.isOctalNumber(xe)&&(xe=parseInt(xe)),(ot.value===xe||ot.id===xe)&&(xe=this.isEdition(te)?ot.id:ot.value)})}else if("autocomplete"===se.type&&xe&&se.domainValues){const He=te.entity;!this.isEdition(te)&&se.linkColumnForce?xe=He?.properties[this.getColumnKeyWithoutPropertiesTag(se.linkColumnForce)]:se.domainValues.forEach(ot=>{"string"==typeof xe&&D.$x.isValidNumber(xe)&&!D.$x.isOctalNumber(xe)&&(xe=parseInt(xe)),(ot.value===xe||ot.id===xe)&&(xe=ot.value)})}else"date"===se.type&&(this.isEdition(te)?xe&&(xe=Ve()(xe).format(),this.formGroup.controls[se.name].setValue(xe)):!this.isEdition(te)&&null===xe&&(xe=""));return void 0===xe&&(xe=""),xe}getValidationAttributeValue(te,se){return void 0!==te.validation&&void 0!==te.validation[se]&&te.validation[se]}isEdition(te){return!!te.entity.edition}getColumnRenderer(te){return void 0!==te.renderer?te.renderer:a.Default}getTableClass(){return{"igo-entity-table-with-selection":this.selection}}getHeaderClass(){const te=this.template.headerClassFunc;return te instanceof Function?te():{}}getRowClass(te){const ge=this.template.rowClassFunc;return ge instanceof Function?ge(te.entity,te):{}}getCellClass(te,se){const ge=te.entity,xe={},He=this.template.cellClassFunc;He instanceof Function&&Object.assign(xe,He(ge,se,te));const ot=se.cellClassFunc;return ot instanceof Function&&Object.assign(xe,ot(ge,te)),xe}onButtonClick(te,se){this.enableEdit(se),"function"==typeof te&&te(se.entity,se)}getColumnKeyWithoutPropertiesTag(te){return te.includes("properties.")?te.split(".")[1]:te}static \u0275fac=function(se){return new(se||Te)(u.rXU(u.gRc),u.rXU(z.ze),u.rXU(at.FN),u.rXU(u.aKT),u.rXU(z.vO,10),u.rXU(z.cV,8),u.rXU(z.JD,8),u.rXU(O.es),u.rXU(O.MJ))};static \u0275cmp=u.VBU({type:Te,selectors:[["igo-entity-table"]],inputs:{store:"store",paginator:"paginator",template:"template",scrollBehavior:"scrollBehavior",sortNullsFirst:"sortNullsFirst",withPaginator:"withPaginator",paginatorOptions:"paginatorOptions"},outputs:{entityClick:"entityClick",entitySelectChange:"entitySelectChange",entitySortChange:"entitySortChange"},standalone:!0,features:[u.Jv_([{provide:j.qT,useExisting:Te},(0,Q.Jo)()]),u.OA$,u.aNF],decls:9,vars:11,consts:[["isAnUrlDefault",""],["notImg",""],["isAnUrlHTML",""],["isUnsanitizedHTML",""],["auto","matAutocomplete"],["picker",""],["isAnUrlUnsanitizedHTML",""],[1,"table-container",3,"ngStyle"],["id","currentWorkspaceTable","mat-table","","matSort","",3,"matSortChange","ngClass","dataSource","trackBy"],["matColumnDef","selectionCheckbox",1,"mat-cell-checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"ngClass",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click",4,"matRowDef","matRowDefColumns"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],["mat-header-cell",""],[4,"ngIf"],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"mousedown","click","change","checked"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip"],["mat-header-cell","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","",3,"matTooltip"],[4,"matCellDef"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"ngIf","ngIfElse"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["target","_blank","rel","noopener noreferrer",3,"click","href"],["igoImageError","","width","50","heigth","auto",3,"src",4,"ngIf","ngIfElse"],["igoImageError","","width","50","heigth","auto",3,"src"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"ngIf","ngIfElse"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-cell","","class","mat-cell-text edition",3,"formGroup","ngClass",4,"ngIf","ngIfElse"],["mat-cell","",1,"mat-cell-text","edition",3,"formGroup","ngClass"],["class","date-picker",4,"ngIf"],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur",4,"ngIf"],["matInput","","type","number","class","class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input",4,"ngIf"],["matInput","","type","text",3,"formControlName","value","readonly","required","input",4,"ngIf"],[3,"formControlName","checked","change",4,"ngIf"],[3,"required","formControlName","multiple","value","selectionChange",4,"ngIf"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly",4,"ngIf"],["panelWidth","430px",3,"optionSelected"],[3,"value",4,"ngFor","ngForOf"],[1,"date-picker"],["matSuffix","",3,"for"],["matInput","",3,"dateChange","matDatepicker","formControlName","value"],["matInput","","type","time","step","900",3,"focus","keypress","blur","formControlName"],["matInput","","type","number",1,"class_number_edition",3,"input","formControlName","step","value","readonly","required","min","max"],["matInput","","type","text",3,"input","formControlName","value","readonly","required"],[3,"change","formControlName","checked"],[3,"selectionChange","required","formControlName","multiple","value"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly"],[3,"value"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],[3,"click",4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"mousedown","color","disabled"],["igoStopPropagation","","mat-mini-fab","",3,"mousedown","color","disabled"],["mat-header-row","",3,"ngClass"],["mat-row","","igoEntityTableRow","",3,"select","click","scrollBehavior","ngClass","selection","selected"],[3,"paginatorChange","store","paginatorOptions","entitySortChange$"]],template:function(se,ge){1&se&&(u.j41(0,"div",7)(1,"table",8),u.bIt("matSortChange",function(He){return ge.onSort(He)}),u.qex(2,9),u.DNE(3,jt,2,1,"th",10)(4,dt,2,1,"td",11),u.bVm(),u.DNE(5,Re,4,4,"ng-container",12)(6,ct,1,1,"tr",13)(7,no,1,4,"tr",14),u.k0s(),u.DNE(8,gn,1,3,"igo-entity-table-paginator",15),u.k0s()),2&se&&(u.Y8G("ngStyle",u.eq3(9,Ye,ge.tableHeight)),u.R7$(),u.Y8G("ngClass",ge.getTableClass())("dataSource",ge.dataSource)("trackBy",ge.getTrackByFunction()),u.R7$(4),u.Y8G("ngForOf",ge.template.columns),u.R7$(),u.Y8G("matHeaderRowDef",ge.headers)("matHeaderRowDefSticky",ge.fixedHeader),u.R7$(),u.Y8G("matRowDefColumns",ge.headers),u.R7$(),u.Y8G("ngIf",ge.withPaginator))},dependencies:[g.Jj,Ae,Ge,z.YN,z.me,z.Q0,z.BC,z.cb,z.YS,z.VZ,z.zX,Xe.Ju,ae.jL,ae.$3,O.wT,ae.pN,ye.Hl,ye.iY,ye.$0,de.g7,de.So,ue.X6,ue.Vh,ue.bZ,ue.bU,j.RG,j.yw,ce.m_,ce.An,re.fS,re.fg,O.WX,O.Sy,P.Ve,P.VO,be.NQ,be.B4,be.aE,_e.tP,_e.Zl,_e.tL,_e.ji,_e.cC,_e.YV,_e.iL,_e.KS,_e.$R,_e.YZ,_e.NB,Le.uc,Le.oV,g.YU,g.pM,g.bT,g.B3,z.X1,z.j4,z.JD,We.b8,Xe.V2,Be.WZ,rt.Ck,Oe.D9],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-compact[_nghost-%COMP%]   tr.mat-mdc-header-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:36px}.table-compact[_nghost-%COMP%]   tr.mat-mdc-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:28px}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}[_nghost-%COMP%]   .mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}[_nghost-%COMP%]   entity-table[_ngcontent-%COMP%]   table.igo-entity-table-with-selection[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd;cursor:pointer}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:7px}[_nghost-%COMP%]   .class_hidden[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .class_display_none[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .class_boolean[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number[_ngcontent-%COMP%]{text-align:center;padding-right:35px!important}[_nghost-%COMP%]   .class_string[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_text[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number_edition[_ngcontent-%COMP%]{text-align:left}[_nghost-%COMP%]   td.edition[_ngcontent-%COMP%]{background:#a6a6a633}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{border-bottom:1px solid darkgrey}"],changeDetection:0})}return Te})()},84133:(De,le,r)=>{"use strict";r.d(le,{D:()=>c});var M=r(55050),a=r(68559);const F=["flexibleMain"],p=["*",[["","igoFlexibleFill",""]]],e=["*","[igoFlexibleFill]"];let c=(()=>{class o{el;mediaService;static transitionTime=250;main;get initial(){return this._initial}set initial(R){this._initial=R}_initial="0";get collapsed(){return this._collapsed}set collapsed(R){this._collapsed=R}_collapsed="0";get expanded(){return this._expanded}set expanded(R){this._expanded=R}_expanded="100%";get initialMobile(){return this._initialMobile}set initialMobile(R){this._initialMobile=R}_initialMobile=this.expanded;get collapsedMobile(){return this._collapsedMobile}set collapsedMobile(R){this._collapsedMobile=R}_collapsedMobile=this.collapsed;get expandedMobile(){return this._expandedMobile}set expandedMobile(R){this._expandedMobile=R}_expandedMobile=this.expanded;get direction(){return this._direction}set direction(R){this._direction=R}_direction="column";get state(){return this._state}set state(R){const v={initial:this.initial,collapsed:this.collapsed,expanded:this.expanded};this.mediaService.isMobile()&&Object.assign(v,{initial:this.initialMobile,collapsed:this.collapsedMobile,expanded:this.expandedMobile});const y=v[R];void 0!==y&&(this.setSize(y),setTimeout(()=>{this._state=R},o.transitionTime))}_state="initial";mediaService$$;constructor(R,v){this.el=R,this.mediaService=v}ngOnInit(){this.el.nativeElement.className+=this.direction,this.mediaService$$=this.mediaService.media$.subscribe(R=>this.state=this.state)}ngOnDestroy(){this.mediaService$$&&this.mediaService$$.unsubscribe()}setSize(R){this._state="transition","column"===this.direction?this.main.nativeElement.style.height=R:"row"===this.direction&&(this.main.nativeElement.style.width=R)}static \u0275fac=function(v){return new(v||o)(a.rXU(a.aKT),a.rXU(M.u1))};static \u0275cmp=a.VBU({type:o,selectors:[["igo-flexible"]],viewQuery:function(v,y){if(1&v&&a.GBs(F,7),2&v){let b;a.mGM(b=a.lsd())&&(y.main=b.first)}},inputs:{initial:"initial",collapsed:"collapsed",expanded:"expanded",initialMobile:"initialMobile",collapsedMobile:"collapsedMobile",expandedMobile:"expandedMobile",direction:"direction",state:"state"},standalone:!0,features:[a.aNF],ngContentSelectors:e,decls:8,vars:4,consts:[["flexibleMain",""],[1,"igo-container"],[1,"igo-flexible-fill"]],template:function(v,y){1&v&&(a.NAR(p),a.j41(0,"div",null,0)(2,"div",1),a.SdG(3),a.k0s()(),a.j41(4,"div",2)(5,"div")(6,"div",1),a.SdG(7,1),a.k0s()()()),2&v&&a.STu("igo-flexible-main ",y.state," ",y.direction,"")},styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}.column[_nghost-%COMP%]{flex-direction:column}.row[_nghost-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .igo-flexible-main[_ngcontent-%COMP%]{flex:0 0 auto;overflow:hidden}[_nghost-%COMP%]   .igo-flexible-main.column[_ngcontent-%COMP%]{transition:height .25s ease-in}[_nghost-%COMP%]   .igo-flexible-main.row[_ngcontent-%COMP%]{transition:width .25s ease-in}[_nghost-%COMP%]   .igo-flexible-fill[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;inset:0}[_nghost-%COMP%]   .igo-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-flexible-fill{flex:1 1 auto;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-content{height:100%;width:100%;overflow:auto}[_nghost-%COMP%]     igo-panel{height:100%}"]})}return o})()},1181:(De,le,r)=>{"use strict";r.d(le,{K:()=>o});var M=r(60316),a=r(74104),F=r(76752),p=r(68559),e=r(98903);function c(L,R){if(1&L&&(p.qex(0),p.nrm(1,"igo-dynamic-outlet",1),p.bVm()),2&L){const v=p.XpG();p.R7$(),p.Y8G("component",v.getFieldComponent())("inputs",v.getFieldInputs())("subscribers",v.getFieldSubscribers())}}let o=(()=>{class L{formFieldService;field;fieldInputs=void 0;fieldSubscribers=void 0;get fieldOptions(){return this.field.options||{}}constructor(v){this.formFieldService=v}getFieldComponent(){return this.formFieldService.getFieldByType(this.field.type||"text")}getFieldInputs(){if(void 0!==this.fieldInputs)return this.fieldInputs;const v=this.fieldOptions.errors||{};return this.fieldInputs=Object.assign({placeholder:this.field.title,disableSwitch:this.fieldOptions.disableSwitch||!1},Object.assign({},this.field.inputs||{}),{formControl:this.field.control,errors:Object.assign({},(0,F.O1)(),v)}),this.fieldInputs}getFieldSubscribers(){return void 0!==this.fieldSubscribers||(this.fieldSubscribers=Object.assign({},this.field.subscribers||{})),this.fieldSubscribers}static \u0275fac=function(y){return new(y||L)(p.rXU(e.o))};static \u0275cmp=p.VBU({type:L,selectors:[["igo-form-field"]],inputs:{field:"field"},standalone:!0,features:[p.aNF],decls:1,vars:1,consts:[[4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(y,b){1&y&&p.DNE(0,c,2,3,"ng-container",0),2&y&&p.Y8G("ngIf",void 0!==b.field)},dependencies:[M.bT,a.Yq],styles:["mat-form-field{width:100%}  .igo-form-disable-switch{margin-right:8px}"],changeDetection:0})}return L})()},92055:(De,le,r)=>{"use strict";r.d(le,{s:()=>v});var M=r(60316),a=r(68559),F=r(34456),p=r(61541),e=r(76752);const c=["buttons"],o=["*",[["","formButtons",""]]],L=["*","[formButtons]"],R=y=>({"igo-form-body-with-buttons":y});let v=(()=>{class y{form;formData;autocomplete="off";submitForm=new a.bkB;buttons;get hasButtons(){return 0!==this.buttons.nativeElement.children.length}constructor(){}ngOnChanges(k){const _=k.formData;_&&_.currentValue!==_.previousValue&&(void 0===_.currentValue?this.clear():this.setData(_.currentValue))}onSubmit(){this.submitForm.emit(this.getData())}getData(){const k={};return(0,e.xk)(this.form).forEach(_=>{this.updateDataWithFormField(k,_)}),k}setData(k){this.form.fields.forEach(_=>{_.control.setValue((0,p.t)(k,_.name).safeObject)}),this.form.groups.forEach(_=>{_.fields.forEach(D=>{D.control.setValue((0,p.t)(k,D.name).safeObject)})})}updateDataWithFormField(k,_){const D=_.control;D.disabled||(k[_.name]=D.value)}clear(){this.form.control.reset()}static \u0275fac=function(_){return new(_||y)};static \u0275cmp=a.VBU({type:y,selectors:[["igo-form"]],viewQuery:function(_,D){if(1&_&&a.GBs(c,7),2&_){let h;a.mGM(h=a.lsd())&&(D.buttons=h.first)}},inputs:{form:"form",formData:"formData",autocomplete:"autocomplete"},outputs:{submitForm:"submitForm"},standalone:!0,features:[a.OA$,a.aNF],ngContentSelectors:L,decls:7,vars:5,consts:[["buttons",""],[3,"ngSubmit","autocomplete","formGroup"],[1,"igo-form-body",3,"ngClass"],[1,"igo-form-content"],[1,"igo-form-buttons"]],template:function(_,D){if(1&_){const h=a.RV6();a.NAR(o),a.j41(0,"form",1),a.bIt("ngSubmit",function(){return a.eBV(h),a.Njj(D.onSubmit())}),a.j41(1,"div",2)(2,"div",3),a.SdG(3),a.k0s(),a.j41(4,"div",4,0),a.SdG(6,1),a.k0s()()()}2&_&&(a.Y8G("autocomplete",D.autocomplete)("formGroup",D.form.control),a.R7$(),a.Y8G("ngClass",a.eq3(3,R,D.hasButtons)))},dependencies:[F.YN,F.qT,F.cb,F.X1,F.j4,M.YU],styles:["[_nghost-%COMP%]{display:block}form[_ngcontent-%COMP%]{width:100%;height:100%}.igo-form-body[_ngcontent-%COMP%], .igo-form-content[_ngcontent-%COMP%]{height:100%}.igo-form-body-with-buttons[_ngcontent-%COMP%]   .igo-form-content[_ngcontent-%COMP%]{height:calc(100% - 56px)}.igo-form-content[_ngcontent-%COMP%]{display:flex}"],changeDetection:0})}return y})()},36250:(De,le,r)=>{"use strict";r.d(le,{s2:()=>M.s,Eg:()=>Be,h4:()=>z,ux:()=>de,SS:()=>rt,lx:()=>_});var M=r(92055),F=r(1181),p=r(24398),e=r(60316),c=r(34456),o=r(85060),L=r(15944),R=r(93840),v=r(25175),y=r(21701),b=r(75797),k=r(98903);function _(Ie){return Ve=>{k.o.register(Ie,Ve)}}var D=r(76752),h=r(68559),X=r(90852);function H(Ie,Ve){if(1&Ie&&(h.j41(0,"mat-option",4),h.EFF(1),h.k0s()),2&Ie){const ie=Ve.$implicit;h.Y8G("value",ie.value),h.R7$(),h.SpI(" ",ie.title," ")}}function x(Ie,Ve){if(1&Ie){const ie=h.RV6();h.j41(0,"mat-icon",5),h.bIt("click",function(){h.eBV(ie);const $e=h.XpG();return h.Njj($e.onDisableSwitchClick())}),h.EFF(1),h.nI1(2,"async"),h.k0s()}if(2&Ie){const ie=h.XpG();h.R7$(),h.SpI("",!0===h.bMT(2,1,ie.disabled$)?"check_box_outline_blank":"check_box"," ")}}function ee(Ie,Ve){if(1&Ie&&(h.j41(0,"mat-error"),h.EFF(1),h.nI1(2,"translate"),h.k0s()),2&Ie){const ie=h.XpG();h.R7$(),h.JRh(h.bMT(2,1,ie.getErrorMessage()))}}let Z=class ta{disabled$=new b.t(!1);set choices(Ve){this.choices$.next(Ve)}get choices(){return this.choices$.value}choices$=new b.t([]);multiple=!1;formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,D.Vs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,D.vd)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Ve=!this.disabled$.value;!0===Ve?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Ve)}static \u0275fac=function(ie){return new(ie||ta)};static \u0275cmp=h.VBU({type:ta,selectors:[["igo-form-field-select"]],inputs:{choices:"choices",multiple:"multiple",formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[h.aNF],decls:6,vars:9,consts:[[3,"multiple","required","placeholder","formControl"],[3,"value",4,"ngFor","ngForOf"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],[4,"ngIf"],[3,"value"],["matPrefix","",1,"igo-form-disable-switch",3,"click"]],template:function(ie,he){1&ie&&(h.j41(0,"mat-form-field")(1,"mat-select",0),h.DNE(2,H,2,2,"mat-option",1),h.nI1(3,"async"),h.k0s(),h.DNE(4,x,3,3,"mat-icon",2)(5,ee,3,3,"mat-error",3),h.k0s()),2&ie&&(h.R7$(),h.Y8G("multiple",he.multiple)("required",he.required)("placeholder",he.placeholder)("formControl",he.formControl),h.R7$(),h.Y8G("ngForOf",h.bMT(3,7,he.choices$)),h.R7$(2),h.Y8G("ngIf",!0===he.disableSwitch),h.R7$(),h.Y8G("ngIf",he.formControl.errors))},dependencies:[L.RG,L.rl,L.TL,L.JW,v.Ve,v.VO,o.wT,c.YN,c.BC,c.YS,c.X1,c.l_,e.pM,o.Sy,e.bT,R.m_,R.An,e.Jj,y.Ck,X.D9],encapsulation:2,changeDetection:0})};Z=(0,p.Cg)([_("select")],Z);var G=r(84175),U=r(87984);function N(Ie,Ve){if(1&Ie){const ie=h.RV6();h.j41(0,"mat-icon",4),h.bIt("click",function(){h.eBV(ie);const $e=h.XpG();return h.Njj($e.onDisableSwitchClick())}),h.EFF(1),h.nI1(2,"async"),h.k0s()}if(2&Ie){const ie=h.XpG();h.R7$(),h.SpI("",!0===h.bMT(2,1,ie.disabled$)?"check_box_outline_blank":"check_box"," ")}}function W(Ie,Ve){if(1&Ie){const ie=h.RV6();h.j41(0,"button",5),h.bIt("click",function(){h.eBV(ie);const $e=h.XpG();return h.Njj($e.togglePassword())}),h.j41(1,"mat-icon",6),h.EFF(2),h.k0s()()}if(2&Ie){const ie=h.XpG();h.R7$(2),h.JRh(ie.hide?"visibility_off":"visibility")}}function A(Ie,Ve){if(1&Ie&&(h.j41(0,"mat-error"),h.EFF(1),h.nI1(2,"translate"),h.k0s()),2&Ie){const ie=h.XpG();h.R7$(),h.JRh(h.bMT(2,1,ie.getErrorMessage()))}}let g=class oa{cdRef;disabled$=new b.t(!1);hide=!0;lastTimeoutRequest;formControl;placeholder;isPassword;errors;disableSwitch=!1;get required(){return(0,D.Vs)(this.formControl)}constructor(Ve){this.cdRef=Ve}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,D.vd)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Ve=!this.disabled$.value;!0===Ve?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Ve)}togglePassword(){this.hide=!this.hide,this.delayedHide()}delayedHide(Ve=1e4){this.isPassword&&!this.hide&&(this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.lastTimeoutRequest=setTimeout(()=>{this.hide=!0,this.cdRef.detectChanges()},Ve))}static \u0275fac=function(ie){return new(ie||oa)(h.rXU(h.gRc))};static \u0275cmp=h.VBU({type:oa,selectors:[["igo-form-field-text"]],inputs:{formControl:"formControl",placeholder:"placeholder",isPassword:"isPassword",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[h.aNF],decls:5,vars:7,consts:[["matInput","",3,"blur","change","type","required","placeholder","formControl"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"click"],["type","button","matSuffix","","mat-icon-button","",3,"click"],["color","primary"]],template:function(ie,he){1&ie&&(h.j41(0,"mat-form-field")(1,"input",0),h.bIt("blur",function(){return he.delayedHide(0)})("change",function(){return he.delayedHide()}),h.k0s(),h.DNE(2,N,3,3,"mat-icon",1)(3,W,3,1,"button",2)(4,A,3,3,"mat-error",3),h.k0s()),2&ie&&(h.R7$(),h.Y8G("type",he.isPassword&&he.hide?"password":"text")("required",he.isPassword?"true":he.required)("placeholder",he.placeholder)("formControl",he.formControl),h.R7$(),h.Y8G("ngIf",!0===he.disableSwitch),h.R7$(),h.Y8G("ngIf",he.isPassword),h.R7$(),h.Y8G("ngIf",he.formControl.errors))},dependencies:[L.RG,L.rl,L.TL,L.JW,L.yw,U.fS,U.fg,c.YN,c.me,c.BC,c.YS,c.X1,c.l_,e.bT,R.m_,R.An,G.Hl,G.iY,e.Jj,y.Ck,X.D9],encapsulation:2,changeDetection:0})};function u(Ie,Ve){if(1&Ie){const ie=h.RV6();h.j41(0,"mat-icon",3),h.bIt("click",function(){h.eBV(ie);const $e=h.XpG();return h.Njj($e.onDisableSwitchClick())}),h.EFF(1),h.nI1(2,"async"),h.k0s()}if(2&Ie){const ie=h.XpG();h.R7$(),h.SpI("",!0===h.bMT(2,1,ie.disabled$)?"check_box_outline_blank":"check_box"," ")}}function O(Ie,Ve){if(1&Ie&&(h.j41(0,"mat-error"),h.EFF(1),h.nI1(2,"translate"),h.k0s()),2&Ie){const ie=h.XpG();h.R7$(),h.JRh(h.bMT(2,1,ie.getErrorMessage()))}}g=(0,p.Cg)([_("text"),(0,p.Sn)("design:paramtypes",[h.gRc])],g);let j=class na{disabled$=new b.t(!1);formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,D.Vs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,D.vd)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Ve=!this.disabled$.value;!0===Ve?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Ve)}static \u0275fac=function(ie){return new(ie||na)};static \u0275cmp=h.VBU({type:na,selectors:[["igo-form-field-textarea"]],inputs:{formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[h.aNF],decls:5,vars:5,consts:[["matInput","",3,"required","placeholder","formControl"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"click"]],template:function(ie,he){1&ie&&(h.j41(0,"mat-form-field")(1,"textarea",0),h.EFF(2,"  "),h.k0s(),h.DNE(3,u,3,3,"mat-icon",1)(4,O,3,3,"mat-error",2),h.k0s()),2&ie&&(h.R7$(),h.Y8G("required",he.required)("placeholder",he.placeholder)("formControl",he.formControl),h.R7$(2),h.Y8G("ngIf",!0===he.disableSwitch),h.R7$(),h.Y8G("ngIf",he.formControl.errors))},dependencies:[L.RG,L.rl,L.TL,L.JW,U.fS,U.fg,c.YN,c.me,c.BC,c.YS,c.X1,c.l_,e.bT,R.m_,R.An,e.Jj,y.Ck,X.D9],encapsulation:2,changeDetection:0})};j=(0,p.Cg)([_("textarea")],j);const w=["*"];function I(Ie,Ve){if(1&Ie&&(h.j41(0,"div",5),h.nrm(1,"igo-form-field",6),h.k0s()),2&Ie){const ie=Ve.$implicit,he=h.XpG(2);h.Y8G("ngClass",he.getFieldNgClass(ie)),h.R7$(),h.Y8G("field",ie)}}function E(Ie,Ve){if(1&Ie&&(h.j41(0,"div",3),h.DNE(1,I,2,2,"div",4),h.k0s()),2&Ie){const ie=h.XpG();h.R7$(),h.Y8G("ngForOf",ie.group.fields)}}function s(Ie,Ve){if(1&Ie&&(h.j41(0,"mat-error"),h.EFF(1),h.nI1(2,"translate"),h.k0s()),2&Ie){const ie=h.XpG();h.R7$(),h.JRh(h.bMT(2,1,ie.getErrorMessage()))}}let z=(()=>{class Ie{group;errors;get formControl(){return this.group.control}constructor(){}getFieldColSpan(ie){let he=2;const $e=ie.options||{};return $e.cols&&$e.cols>0&&(he=Math.min($e.cols,2)),he}getFieldNgClass(ie){return{[`igo-form-field-colspan-${this.getFieldColSpan(ie)}`]:!0}}getErrorMessage(){return(0,D.vd)(this.formControl,(this.group.options||{}).errors||{})}static \u0275fac=function(he){return new(he||Ie)};static \u0275cmp=h.VBU({type:Ie,selectors:[["igo-form-group"]],inputs:{group:"group",errors:"errors"},standalone:!0,features:[h.aNF],ngContentSelectors:w,decls:4,vars:2,consts:[["class","igo-form-group-fields",4,"ngIf"],[1,"igo-form-group-extra-content"],[4,"ngIf"],[1,"igo-form-group-fields"],["class","igo-form-field-wrapper",3,"ngClass",4,"ngFor","ngForOf"],[1,"igo-form-field-wrapper",3,"ngClass"],[3,"field"]],template:function(he,$e){1&he&&(h.NAR(),h.DNE(0,E,2,1,"div",0),h.j41(1,"div",1),h.SdG(2),h.k0s(),h.DNE(3,s,3,3,"mat-error",2)),2&he&&(h.Y8G("ngIf",$e.group&&$e.group.fields.length>0),h.R7$(3),h.Y8G("ngIf",$e.formControl.errors))},dependencies:[e.bT,e.pM,e.YU,F.K,L.RG,L.TL,y.Ck,X.D9],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:auto;padding:10px 5px;box-sizing:border-box}[_nghost-%COMP%]   .igo-form-field-colspan-2[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-field-colspan-1[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return Ie})(),de=(()=>{class Ie{formBuilder;constructor(ie){this.formBuilder=ie}form(ie,he){const $e=this.formBuilder.group({});return ie.forEach(Ae=>{$e.addControl(Ae.name,Ae.control)}),he.forEach(Ae=>{$e.addControl(Ae.name,Ae.control)}),{fields:ie,groups:he,control:$e}}group(ie,he){const $e=ie.options||{},Ae=this.formBuilder.group({});if(he.forEach(Qe=>{Ae.addControl(Qe.name,Qe.control)}),$e.validator){const Qe=this.getValidators($e.validator);Ae.setValidators(Qe)}return Object.assign({},ie,{fields:he,control:Ae})}field(ie){const he=ie.options||{},Ae=this.formBuilder.control({value:"",disabled:he.disabled});if(he.validator){const Qe=this.getValidators(he.validator);Ae.setValidators(Qe)}return Object.assign({type:"text"},ie,{control:Ae})}extendFieldConfig(ie,he){const $e=Object.assign({},ie.options||{},he.options||{}),Ae=Object.assign({},ie.inputs||{},he.inputs||{}),Qe=Object.assign({},ie.subscribers||{},he.subscribers||{});return Object.assign({},ie,{options:$e,inputs:Ae,subscribers:Qe})}getValidators(ie){return Array.isArray(ie)?ie.map(he=>this.getValidator(he)):this.getValidator(ie)}getValidator(ie){if("string"!=typeof ie)return ie;const $e=ie.match(/^([a-zA-Z]{3,15})\((.{0,20})\)$/);return $e?c.k0[$e[1]]($e[2]):c.k0[ie]}static \u0275fac=function(he){return new(he||Ie)(h.KVO(c.ze))};static \u0275prov=h.jDH({token:Ie,factory:Ie.\u0275fac,providedIn:"root"})}return Ie})();var ue=r(87941),ce=r(19816);function re(Ie,Ve){1&Ie&&h.nrm(0,"igo-form-field",11),2&Ie&&h.Y8G("field",Ve.$implicit)}function be(Ie,Ve){1&Ie&&h.nrm(0,"igo-form-group",12),2&Ie&&h.Y8G("group",Ve.$implicit)}function _e(Ie,Ve){if(1&Ie&&(h.j41(0,"div",8),h.DNE(1,re,1,1,"igo-form-field",9)(2,be,1,1,"igo-form-group",10),h.k0s()),2&Ie){const ie=h.XpG().ngIf;h.R7$(),h.Y8G("ngForOf",ie.fields),h.R7$(),h.Y8G("ngForOf",ie.groups)}}function Le(Ie,Ve){if(1&Ie){const ie=h.RV6();h.j41(0,"igo-form",3),h.nI1(1,"async"),h.bIt("submitForm",function($e){h.eBV(ie);const Ae=h.XpG();return h.Njj(Ae.onSubmit($e))}),h.DNE(2,_e,3,2,"div",4),h.j41(3,"div",5)(4,"button",6),h.bIt("click",function(){h.eBV(ie);const $e=h.XpG();return h.Njj($e.cancel())}),h.EFF(5),h.nI1(6,"translate"),h.k0s(),h.j41(7,"button",7),h.EFF(8),h.nI1(9,"translate"),h.k0s()()()}if(2&Ie){const ie=Ve.ngIf,he=h.XpG();h.Y8G("form",ie)("formData",h.bMT(1,5,he.data$)),h.R7$(2),h.Y8G("ngIf",ie.fields.length),h.R7$(3),h.SpI(" ",h.bMT(6,7,he.data.cancelButtonText)," "),h.R7$(3),h.SpI(" ",h.bMT(9,9,he.data.processButtonText)," ")}}function We(Ie,Ve){if(1&Ie&&h.nrm(0,"igo-custom-html",13),2&Ie){const ie=h.XpG();h.Y8G("html",ie.data.notice)}}let Xe=(()=>{class Ie{languageService;dialogRef;formService;data;form$=new b.t(void 0);data$=new b.t(void 0);constructor(ie,he,$e,Ae){this.languageService=ie,this.dialogRef=he,this.formService=$e,this.data=Ae,this.data.processButtonText=this.data.processButtonText??"igo.common.formDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.formDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.formDialog.title",this.data$=this.data.data$;let Qe=[],Ge=[];this.data.formFieldConfigs?.map(Oe=>Qe.push(this.formService.field(Oe))),this.data.formGroupsConfigs?.map(Oe=>{const Ye=Oe.formFieldConfigs?.map(ze=>this.formService.field(ze));Ge.push(this.formService.group({name:Oe.name},Ye))});const at=this.formService.form(Qe,Ge);this.form$.next(at)}onSubmit(ie){const he=this.form$.getValue();he.control.valid?this.dialogRef.close(ie):he.groups?.length?he.groups.map($e=>{Object.keys($e.control.controls).map(Ae=>{$e.control.controls[Ae].markAsTouched(),$e.control.controls[Ae].updateValueAndValidity()})}):he.fields.map($e=>{$e.control.markAsTouched(),$e.control.updateValueAndValidity()})}cancel(){this.dialogRef.close()}static \u0275fac=function(he){return new(he||Ie)(h.rXU(y.gw),h.rXU(ue.CP),h.rXU(de),h.rXU(ue.Vh))};static \u0275cmp=h.VBU({type:Ie,selectors:[["igo-form-dialog"]],standalone:!0,features:[h.aNF],decls:7,vars:7,consts:[["mat-dialog-title",""],[3,"form","formData","submitForm",4,"ngIf"],[3,"html",4,"ngIf"],[3,"submitForm","form","formData"],["class","form-dialog-container",4,"ngIf"],["formButtons","","mat-dialog-actions",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary"],[1,"form-dialog-container"],[3,"field",4,"ngFor","ngForOf"],[3,"group",4,"ngFor","ngForOf"],[3,"field"],[3,"group"],[3,"html"]],template:function(he,$e){1&he&&(h.j41(0,"h1",0),h.EFF(1),h.nI1(2,"translate"),h.k0s(),h.DNE(3,Le,10,11,"igo-form",1),h.nI1(4,"async"),h.j41(5,"div"),h.DNE(6,We,1,1,"igo-custom-html",2),h.k0s()),2&he&&(h.R7$(),h.JRh(h.bMT(2,3,$e.data.title)),h.R7$(2),h.Y8G("ngIf",h.bMT(4,5,$e.form$)),h.R7$(3),h.Y8G("ngIf",$e.data.notice&&""!==$e.data.notice))},dependencies:[ue.BI,e.bT,M.s,e.pM,F.K,z,ue.E7,G.Hl,G.$z,ce.gE,e.Jj,y.Ck,X.D9],styles:["[_nghost-%COMP%]   div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-group[_ngcontent-%COMP%]{display:block;height:auto}"]})}return Ie})(),Be=(()=>{class Ie{dialog;constructor(ie){this.dialog=ie}open(ie,he){const $e={formFieldConfigs:ie.formFieldConfigs,formGroupsConfigs:ie.formGroupsConfigs,...he};return this.dialog.open(Xe,{disableClose:!1,data:$e,...he}).afterClosed()}static \u0275fac=function(he){return new(he||Ie)(h.KVO(ue.bZ))};static \u0275prov=h.jDH({token:Ie,factory:Ie.\u0275fac})}return Ie})(),rt=(()=>{class Ie{static forRoot(){return{ngModule:Ie,providers:[]}}static \u0275fac=function(he){return new(he||Ie)};static \u0275mod=h.$C({type:Ie});static \u0275inj=h.G2t({providers:[Be],imports:[ue.hM,Xe]})}return Ie})()},98903:(De,le,r)=>{"use strict";r.d(le,{o:()=>a});var M=r(68559);let a=(()=>{class F{static fields={};static register(e,c){F.fields[e]=c}constructor(){}getFieldByType(e){return F.fields[e]}static \u0275fac=function(c){return new(c||F)};static \u0275prov=M.jDH({token:F,factory:F.\u0275fac,providedIn:"root"})}return F})()},76752:(De,le,r)=>{"use strict";function M(c){if(c.validator){const o=c.validator({});if(o&&o.required)return!0}return!!c.controls&&void 0!==Object.keys(c.controls).find(L=>M(c.controls[L]))}function a(){return{required:"igo.common.form.errors.required",email:"igo.common.form.errors.email"}}function F(c,o){const v=Object.keys(c.errors||{}).map(y=>o[y]).filter(y=>void 0!==y);return v.length>0?v[0]:""}function p(c){return c.groups.reduce((o,L)=>o.concat(L.fields),[].concat(c.fields))}r.d(le,{O1:()=>a,Vs:()=>M,vd:()=>F,xk:()=>p})},36991:(De,le,r)=>{"use strict";r.d(le,{fB:()=>F,fM:()=>R,cc:()=>k,cu:()=>a,bV:()=>M,Og:()=>e,_:()=>p,BD:()=>v});const M={name:"microsoft",svg:'\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>microsoft</title><path d="M2,3H11V12H2V3M11,22H2V13H11V22M21,3V12H12V3H21M21,22H12V13H21V22Z" /></svg>\n'},a={name:"keyboard-esc",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>keyboard-esc</title><path d="M1 7H7V9H3V11H7V13H3V15H7V17H1V7M11 7H15V9H11V11H13C14.11 11 15 11.9 15 13V15C15 16.11 14.11 17 13 17H9V15H13V13H11C9.9 13 9 12.11 9 11V9C9 7.9 9.9 7 11 7M19 7H21C22.11 7 23 7.9 23 9V10H21V9H19V15H21V14H23V15C23 16.11 22.11 17 21 17H19C17.9 17 17 16.11 17 15V9C17 7.9 17.9 7 19 7Z" /></svg>\n'},F={name:"engine",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>engine</title><path d="M7,4V6H10V8H7L5,10V13H3V10H1V18H3V15H5V18H8L10,20H18V16H20V19H23V9H20V12H18V8H12V6H15V4H7Z" /></svg>\n'},p={name:"selection-marker",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>selection-marker</title><path d="M2 4C2 2.89 2.9 2 4 2H7V4H4V7H2V4M22 4V7H20V4H17V2H20C21.1 2 22 2.89 22 4M2 20V17H4V20H7V22H4C2.9 22 2 21.11 2 20M10 2H14V4H10V2M10 20H14V22H10V20M2 10H4V14H2V10M18.5 13C20.4 13 22 14.6 22 16.5C22 19.1 18.5 23 18.5 23C18.5 23 15 19.1 15 16.5C15 14.6 16.6 13 18.5 13M18.5 17.8C19.2 17.8 19.8 17.2 19.7 16.6C19.7 16 19.1 15.4 18.5 15.4C17.9 15.4 17.3 15.9 17.3 16.6C17.3 17.2 17.8 17.8 18.5 17.8M20 10H22V12.34C21.42 11.84 20.74 11.45 20 11.23V10Z" /></svg>\n'},e={name:"presentation-play",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>presentation-play</title><path d="M2,3H10A2,2 0 0,1 12,1A2,2 0 0,1 14,3H22V5H21V16H15.25L17,22H15L13.25,16H10.75L9,22H7L8.75,16H3V5H2V3M5,5V14H19V5H5M11.85,11.85C11.76,11.94 11.64,12 11.5,12A0.5,0.5 0 0,1 11,11.5V7.5A0.5,0.5 0 0,1 11.5,7C11.64,7 11.76,7.06 11.85,7.15L13.25,8.54C13.57,8.86 13.89,9.18 13.89,9.5C13.89,9.82 13.57,10.14 13.25,10.46L11.85,11.85Z" /></svg>'};var c=r(68559),o=r(93840),L=r(80436);let R=(()=>{class _{iconRegistry;sanitizer;constructor(h,X){this.iconRegistry=h,this.sanitizer=X}registerSvg(h){this.iconRegistry.addSvgIconLiteral(h.name,this.sanitizer.bypassSecurityTrustHtml(h.svg))}static \u0275fac=function(X){return new(X||_)(c.KVO(o.tp),c.KVO(L.up))};static \u0275prov=c.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})();function v(_="outlined"){return(0,c.EmA)([o.m_,{provide:c.hnV,useFactory:D=>()=>D.setDefaultFontSetClass(`material-symbols-${_}`),deps:[o.tp],multi:!0}])}function y(_,D){if(1&_&&c.nrm(0,"mat-icon",0),2&_){const h=c.XpG();c.Y8G("svgIcon",h.icon.name)}}function b(_,D){if(1&_&&(c.j41(0,"mat-icon"),c.EFF(1),c.k0s()),2&_){const h=c.XpG();c.R7$(),c.JRh(h.icon)}}let k=(()=>{class _{iconService;set icon(h){this.isSvg(h)&&this.registerSvg(h),this._icon=h}get icon(){return this._icon}_icon;constructor(h){this.iconService=h}registerSvg(h){this.iconService.registerSvg(h)}isSvg(h){return"string"!=typeof h}static \u0275fac=function(X){return new(X||_)(c.rXU(R))};static \u0275cmp=c.VBU({type:_,selectors:[["igo-icon"]],inputs:{icon:"icon"},standalone:!0,features:[c.aNF],decls:2,vars:1,consts:[[3,"svgIcon"]],template:function(X,H){1&X&&c.DNE(0,y,1,1,"mat-icon",0)(1,b,2,1),2&X&&c.vxM(0,H.isSvg(H.icon)?0:1)},dependencies:[o.m_,o.An],encapsulation:2})}return _})()},59912:(De,le,r)=>{"use strict";r.d(le,{Ju:()=>a,V2:()=>v});var M=r(68559);let a=(()=>{class b{el;errorImageUrl="./assets/igo2/common/images/na.png";hideError=!1;constructor(_){this.el=_}onError(_){this.hideError?this.el.nativeElement.style.display="none":_.target.src=this.errorImageUrl}static \u0275fac=function(D){return new(D||b)(M.rXU(M.aKT))};static \u0275dir=M.FsC({type:b,selectors:[["","igoImageError",""]],hostBindings:function(D,h){1&D&&M.bIt("error",function(H){return h.onError(H)})},inputs:{errorImageUrl:"errorImageUrl",hideError:"hideError"},standalone:!0})}return b})();var F=r(24398),p=r(46443),e=r(67143),c=r(43942),o=r(61318),L=r(36647),R=r(9530);class v{http;configService;constructor(k,_){this.http=k,this.configService=_}transform(k){const _=new p.Lr({"Content-Type":"text/plain",activityInterceptor:"false",interceptError:"false"}),D=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');return D.test(k)&&(k=k.match(D)[0]),this.http.get(k,{headers:_,responseType:"blob"}).pipe((0,o.W)(h=>{throw h.error.caught=!0,h.error.toDisplay=!1,h}),(0,L.n)(h=>new c.c(X=>{const H=new FileReader;H.readAsDataURL(h),H.onloadend=()=>{X.next(H.result),X.complete()}})))}static \u0275fac=function(_){return new(_||v)(M.rXU(p.Qq,16),M.rXU(e.we,16))};static \u0275pipe=M.EJ8({name:"secureImage",type:v,pure:!0,standalone:!0})}(0,F.Cg)([(0,R.R)({maxCacheCount:20}),(0,F.Sn)("design:type",Function),(0,F.Sn)("design:paramtypes",[String]),(0,F.Sn)("design:returntype",c.c)],v.prototype,"transform",null)},84398:(De,le,r)=>{"use strict";r.d(le,{I:()=>D});var M=r(60316),a=r(84175),F=r(93840),p=r(80640),e=r(36991),c=r(12545),o=r(21701),L=r(59452),R=r(45522),v=r(68559),y=r(90852);function b(h,X){if(1&h){const H=v.RV6();v.j41(0,"button",3),v.nI1(1,"translate"),v.nI1(2,"translate"),v.bIt("click",function(){v.eBV(H);const ee=v.XpG(2);return v.Njj(ee.startInteractiveTour())}),v.nrm(3,"igo-icon",4),v.k0s()}if(2&h){const H=v.XpG(2);v.Y8G("ngClass",H.getClass())("matTooltip",H.disabledTourButton?v.bMT(1,4,"igo.common.interactiveTour.disaledTooltipTourToolButton"):v.bMT(2,6,"igo.common.interactiveTour.tooltipTourToolButton"))("disabled",H.disabledTourButton),v.R7$(3),v.Y8G("icon",H.presentationIcon)}}function k(h,X){if(1&h){const H=v.RV6();v.j41(0,"button",5),v.bIt("click",function(){v.eBV(H);const ee=v.XpG(2);return v.Njj(ee.startInteractiveTour())}),v.EFF(1),v.nI1(2,"translate"),v.nI1(3,"async"),v.nI1(4,"translate"),v.nrm(5,"mat-icon",6),v.nI1(6,"translate"),v.nI1(7,"translate"),v.k0s()}if(2&h){const H=v.XpG(2);v.Y8G("ngClass",H.getClass())("disabled",H.disabledTourButton),v.R7$(),v.Lme(" ",v.bMT(2,6,"igo.common.interactiveTour.buttonTitle")," ",v.bMT(4,10,v.bMT(3,8,H.discoverTitleInLocale$))," "),v.R7$(4),v.Y8G("svgIcon",H.presentationIcon.name)("matTooltip",H.disabledTourButton?v.bMT(6,12,"igo.common.interactiveTour.disaledTooltipTourToolButton"):v.bMT(7,14,"igo.common.interactiveTour.tooltipTourToolButton"))}}function _(h,X){if(1&h&&(v.qex(0),v.DNE(1,b,4,8,"button",2)(2,k,8,16,"ng-template",null,0,v.C5r),v.bVm()),2&h){const H=v.sdS(3),x=v.XpG();v.R7$(),v.Y8G("ngIf","icon"===x.styleButton)("ngIfElse",H)}}let D=(()=>{class h{interactiveTourService;toolService;iconService;presentationIcon=e.Og;tourToStart="";styleButton;discoverTitleInLocale$=(0,L.of)("IGO");getClass(){return{"tour-button-tool-icon":"icon"===this.styleButton,"tour-button-tool":"raised"===this.styleButton}}get toolbox(){return this.toolService.toolbox}getTourToStart(){return this.tourToStart?this.tourToStart:this.activeToolName}get activeToolName(){if(this.toolbox)return this.isActiveTool?this.toolbox.activeTool$.getValue().name:"global"}get isActiveTool(){if(this.toolbox)return void 0!==this.toolbox.activeTool$.getValue()}get isToolHaveTour(){return!("about"===this.activeToolName&&!this.tourToStart)&&this.interactiveTourService.isToolHaveTourConfig(this.getTourToStart())}get showTourButton(){let H,x;return H=this.isToolHaveTour,!1!==H&&!(this.interactiveTourService.isMobile()&&(x=this.isTourDisplayInMobile,!1===x))}get isTourDisplayInMobile(){return this.interactiveTourService.isTourDisplayInMobile()}get disabledTourButton(){return this.interactiveTourService.disabledTourButton(this.activeToolName)}constructor(H,x,ee){this.interactiveTourService=H,this.toolService=x,this.iconService=ee,this.iconService.registerSvg(this.presentationIcon)}startInteractiveTour(){const H=this.getTourToStart();H&&this.interactiveTourService.startTour(H)}static \u0275fac=function(x){return new(x||h)(v.rXU(R.G),v.rXU(c.mJ),v.rXU(e.fM))};static \u0275cmp=v.VBU({type:h,selectors:[["igo-interactive-tour"]],inputs:{tourToStart:"tourToStart",styleButton:"styleButton",discoverTitleInLocale$:"discoverTitleInLocale$"},standalone:!0,features:[v.aNF],decls:1,vars:1,consts:[["raisedButton",""],[4,"ngIf"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click",4,"ngIf","ngIfElse"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","ngClass","matTooltip","disabled"],["iconPositionEnd","",3,"icon"],["color","primary","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","ngClass","disabled"],["iconPositionEnd","",3,"svgIcon","matTooltip"]],template:function(x,ee){1&x&&v.DNE(0,_,4,2,"ng-container",1),2&x&&v.Y8G("ngIf",ee.showTourButton)},dependencies:[M.bT,a.Hl,a.$z,a.iY,M.YU,p.uc,p.oV,F.m_,F.An,M.Jj,o.Ck,y.D9,e.cc],styles:["igo-interactive-tour>button.mat-mdc-raised-button.tour-button-tool-icon{box-shadow:none}.shepherd-has-title .shepherd-content .shepherd-header{padding:.5em .75em}.shepherd-title{margin:0!important;font-weight:revert!important}.shepherd-progress{margin-right:15px;color:#737373}.shepherd-text{font-size:14px!important}.shepherd-element{border:1px solid;border-color:#474747;box-shadow:4px 5px #65656599}\n"],encapsulation:2})}return h})()},38618:(De,le,r)=>{"use strict";r.d(le,{E:()=>e});var M=r(67143),a=r(61318),F=r(68559),p=r(46443);let e=(()=>{class c{http;configService;jsonURL;allToursOptions;constructor(L,R){this.http=L,this.configService=R,this.jsonURL=this.getPathToConfigFile()}loadConfigTour(){this.getJSON().subscribe(L=>{this.allToursOptions=L},L=>{throw new Error("Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.")})}getPathToConfigFile(){return this.configService.getConfig("interactiveTour.pathToConfigFile")||"./config/interactiveTour.json"}getJSON(){return this.http.get(this.jsonURL).pipe((0,a.W)(L=>{throw L.error.caught=!0,L}))}getTourOptionData(L){if(void 0===this.allToursOptions)return;let R=L;return R=R.replace(/\s/g,""),this.allToursOptions[R]}static \u0275fac=function(R){return new(R||c)(F.KVO(p.Qq),F.KVO(M.we))};static \u0275prov=F.jDH({token:c,factory:c.\u0275fac})}return c})()},45522:(De,le,r)=>{"use strict";r.d(le,{G:()=>L});var M=r(67143),a=r(21701),F=r(55050),p=r(95687),e=r(38618),c=r(68559),o=r(7485);let L=(()=>{class R{configService;mediaService;languageService;interactiveTourLoader;shepherdService;previousStep;nextIndex=1;constructor(y,b,k,_,D){this.configService=y,this.mediaService=b,this.languageService=k,this.interactiveTourLoader=_,this.shepherdService=D,this.isAppHaveTour()&&this.interactiveTourLoader.loadConfigTour()}isAppHaveTour(){const y=this.configService.getConfig("interactiveTour.activateInteractiveTour");return void 0===y||y}isToolHaveTourConfig(y){return void 0!==this.interactiveTourLoader.getTourOptionData(y)}disabledTourButton(y){const b=this.interactiveTourLoader.getTourOptionData(y);if(b?.conditions)for(const k of b?.conditions)if(null===document.querySelector(k))return!0;return!1}isMobile(){return this.mediaService.isMobile()}isTourDisplayInMobile(){const y=this.configService.getConfig("interactiveTour.tourInMobile");return void 0===y||y}getButtons(y){return"noBackButton"===y?[{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"first"===y?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"last"===y?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"}]:[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]}getAction(y){return{click:"click"}[y.toLowerCase()]}addProgress(){const y=this;let b=0;const _=setInterval(()=>{if(y.getCurrentStep()){if(y.getCurrentStep().options.attachTo.element&&!document.querySelector(y.getCurrentStep().options.attachTo.element))return y.cancel(),void clearInterval(_);{const D=y.getCurrentStep().getElement();D&&D.querySelectorAll(".shepherd-content, .shepherd-text").forEach(H=>{H.classList.add("mat-typography")});const h=D?D.querySelector(".shepherd-header"):void 0;if(b++,(h||b>21)&&clearInterval(_),h){const X=y.steps,H=document.createElement("span");H.className="shepherd-progress",H.innerText=`${X.indexOf(y.getCurrentStep())+1}/${X.length}`,h.insertBefore(H,D.querySelector(".shepherd-cancel-icon"))}}}},100)}checkNext(y,b,k){if(b.getCurrentStep()){if(b.getCurrentStep().options.attachTo.element&&document.querySelector(b.getCurrentStep().options.attachTo.element))return void b.complete();if(y.index===b.steps.length-1)return void b.complete();b.steps.splice(y.index,1);const _=b.steps[y.index];_.options.attachTo.element&&!document.querySelector(_.options.attachTo.element)?k.checkNext(y,b,k):(b._setupModal(),b.show(_.id))}}executeAction(y,b){if(!b||b.condition&&("!"===b.condition.charAt(0)&&document.querySelector(b.condition.slice(1))||"!"!==b.condition.charAt(0)&&!document.querySelector(b.condition)))return;const k=document.querySelector(b.element||y.element),_=this.getAction(b.action);k&&_&&k[_]()}executeActionPromise(y,b){return new Promise(k=>{if(this.executeAction(y,b),!b||!b.waitFor)return void k();let _=0;const D=b.maxWait?b.maxWait/100:20,h=setInterval(()=>{_++,(_>D||document.querySelector(b.waitFor))&&(clearInterval(h),k())},100)})}getShepherdSteps(y){const b=[];let k=0;for(const _ of y.steps){const D=_.position??y.position;b.push({attachTo:{element:_.element,on:D},floatingUIOptions:{middleware:["auto"===D&&(0,p.RK)(),(0,p.cY)({mainAxis:15})].filter(Boolean)},beforeShowPromise:()=>Promise.all([this.executeActionPromise(this.previousStep,this.previousStep?this.previousStep.beforeChange:void 0),this.executeActionPromise(_,_.beforeShow)]),buttons:this.getButtons(0===k?"first":k+1===y.steps.length?"last":y.steps[k].noBackButton?"noBackButton":void 0),classes:_.class,highlightClass:_.highlightClass,scrollTo:_.scrollToElement||y.scrollToElement||!0,canClickTarget:_.disableInteraction?!_.disableInteraction:void 0,title:this.languageService.translate.instant(_.title||y.title),text:[this.languageService.translate.instant(_.text)],when:{show:()=>{this.executeAction(_,_.onShow)},hide:()=>{this.previousStep=_,this.executeAction(_,_.onHide)}}}),k++}return b}startTour(y){const b=this.interactiveTourLoader.getTourOptionData(y);this.shepherdService.defaultStepOptions={classes:b.class,highlightClass:b.highlightClass,canClickTarget:!b.disableInteraction||!b.disableInteraction,cancelIcon:{enabled:!0}};const k=this.getShepherdSteps(b);this.shepherdService.modal=!0,this.shepherdService.confirmCancel=!1,this.shepherdService.addSteps(k),this.shepherdService.tourObject.on("show",this.addProgress),this.shepherdService.tourObject.on("cancel",_=>{this.checkNext(_,this.shepherdService.tourObject,this)}),this.shepherdService.start()}static \u0275fac=function(b){return new(b||R)(c.KVO(M.we),c.KVO(F.u1),c.KVO(a.gw),c.KVO(e.E),c.KVO(o.b))};static \u0275prov=c.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})()},417:(De,le,r)=>{"use strict";r.d(le,{io:()=>e,IJ:()=>M.I,Gq:()=>F.G});var M=r(84398),a=r(38618),F=r(45522),p=r(68559);let e=(()=>{class c{static \u0275fac=function(R){return new(R||c)};static \u0275mod=p.$C({type:c});static \u0275inj=p.G2t({providers:[F.G,a.E],imports:[M.I]})}return c})()},28176:(De,le,r)=>{"use strict";r.d(le,{sB:()=>L,dF:()=>a});var M=r(68559);let a=(()=>{class v{renderer;el;static focusedCls="igo-list-item-focused";static selectedCls="igo-list-item-selected";static disabledCls="igo-list-item-disabled";get color(){return this._color}set color(b){this._color=b}_color="primary";get focused(){return this._focused}set focused(b){b!==this._focused&&(this.disabled||(b?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=b,!0!==this.selected&&this.toggleFocusedClass(),b?this.focus.emit(this):this.unfocus.emit(this)))}_focused=!1;get selected(){return this._selected}set selected(b){b!==this._selected&&(this.disabled||(b?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=b,this._focused=b,this.toggleSelectedClass(),b?this.select.emit(this):this.unselect.emit(this)))}_selected=!1;get disabled(){return this._disabled}set disabled(b){b!==this._disabled&&(!0===b&&(this.selected=!1),b?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=b,this.toggleDisabledClass(),b?this.disable.emit(this):this.enable.emit(this))}_disabled=!1;beforeSelect=new M.bkB;beforeFocus=new M.bkB;beforeUnselect=new M.bkB;beforeUnfocus=new M.bkB;beforeDisable=new M.bkB;beforeEnable=new M.bkB;focus=new M.bkB;unfocus=new M.bkB;select=new M.bkB;unselect=new M.bkB;disable=new M.bkB;enable=new M.bkB;onClick(){this.selected=!0}constructor(b,k){this.renderer=b,this.el=k}getOffsetTop(){return this.el.nativeElement.offsetTop-5}toggleFocusedClass(){this.focused?this.addCls(v.focusedCls):this.removeCls(v.focusedCls)}toggleSelectedClass(){this.selected?(this.addCls(v.selectedCls),this.removeCls(v.focusedCls)):this.removeCls(v.selectedCls)}toggleDisabledClass(){this.disabled?this.addCls(v.disabledCls):this.removeCls(v.disabledCls)}addCls(b){this.renderer.addClass(this.el.nativeElement,b)}removeCls(b){this.renderer.removeClass(this.el.nativeElement,b)}static \u0275fac=function(k){return new(k||v)(M.rXU(M.sFG),M.rXU(M.aKT))};static \u0275dir=M.FsC({type:v,selectors:[["","igoListItem",""]],hostBindings:function(k,_){1&k&&M.bIt("click",function(){return _.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"},standalone:!0})}return v})();var F=r(60316),p=r(20943);let e=(()=>{class v{el;clickout=new M.bkB;handleMouseClick(b,k){k&&(this.el.nativeElement.contains(k)||this.clickout.emit(b))}constructor(b){this.el=b}static \u0275fac=function(k){return new(k||v)(M.rXU(M.aKT))};static \u0275dir=M.FsC({type:v,selectors:[["","igoClickout",""]],hostBindings:function(k,_){1&k&&M.bIt("click",function(h){return _.handleMouseClick(h,h.target)},!1,M.EBC)},outputs:{clickout:"clickout"},standalone:!0})}return v})();const c=["*"],o=v=>({selectable:v});let L=(()=>{class v{el;get navigation(){return this._navigation}set navigation(b){this._navigation=b}_navigation=!0;get selection(){return this._selection}set selection(b){this._selection=b}_selection=!0;get selectedItem(){return this._selectedItem}set selectedItem(b){this.focusedItem=b,this._selectedItem=b}_selectedItem;get focusedItem(){return this._focusedItem}set focusedItem(b){this._focusedItem=b}_focusedItem;navigationEnabled;listItems$$;subscriptions=[];listItems;handleKeyboardEvent(b){this.navigationEnabled&&("ArrowUp"===b.key||"ArrowDown"===b.key?(b.preventDefault(),this.navigate(b.key)):"Enter"===b.key&&this.select(this.focusedItem))}constructor(b){this.el=b}ngOnInit(){this.enableNavigation()}ngAfterViewInit(){this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(b=>this.init())}ngOnDestroy(){this.listItems$$.unsubscribe()}focus(b){this.selection&&(this.unfocus(),void 0!==b&&(b.focused=!0))}unfocus(){void 0!==this.focusedItem&&(this.focusedItem.focused=!1),this.focusedItem=void 0}focusNext(){const b=this.listItems.toArray();let k;const _=this.el.nativeElement;let D=!0,h=this.getFocusedIndex();for(void 0===h&&(h=-1);D&&h<b.length-1;)h+=1,k=b[h],D=k.disabled;void 0!==k&&this.focus(k),b[h+1]?void 0!==k&&!this.isScrolledIntoView(k.el.nativeElement)&&(_.scrollTop=k.el.nativeElement.offsetTop+k.el.nativeElement.children[0].offsetHeight-_.clientHeight):_.scrollTop=_.scrollHeight-_.clientHeight}focusPrevious(){const b=this.listItems.toArray();let k;const _=this.el.nativeElement;let D=!0,h=this.getFocusedIndex();for(;D&&h>0;)h-=1,k=b[h],D=k.disabled;void 0!==k&&this.focus(k),b[h-1]?void 0!==k&&!this.isScrolledIntoView(k.el.nativeElement)&&(_.scrollTop=k.el.nativeElement.offsetTop-3):_.scrollTop=0}select(b){this.selection&&(this.unselect(),void 0!==b&&(b.selected=!0))}unselect(){this.unfocus(),void 0!==this.selectedItem&&(this.selectedItem.selected=!1),this.selectedItem=void 0}enableNavigation(){this.navigation&&(this.navigationEnabled=!0)}disableNavigation(){this.navigationEnabled=!1}scrollToItem(b){this.el.nativeElement.scrollTop=b.getOffsetTop()}isScrolledIntoView(b){const k=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,D=b.offsetTop;return D+b.children[0].offsetHeight<=k+this.el.nativeElement.clientHeight&&D>=k}init(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}subscribe(){this.unsubscribe(),this.listItems.toArray().forEach(b=>{this.subscriptions.push(b.beforeSelect.subscribe(k=>this.handleItemBeforeSelect(k))),this.subscriptions.push(b.select.subscribe(k=>this.handleItemSelect(k))),this.subscriptions.push(b.beforeFocus.subscribe(k=>this.handleItemBeforeFocus(k))),this.subscriptions.push(b.focus.subscribe(k=>this.handleItemFocus(k)))},this)}unsubscribe(){this.subscriptions.forEach(b=>b.unsubscribe()),this.subscriptions=[]}handleItemBeforeFocus(b){b!==this.focusedItem&&this.unfocus()}handleItemFocus(b){this.focusedItem=b}handleItemBeforeSelect(b){b!==this.focusedItem&&this.unselect()}handleItemSelect(b){this.selectedItem=b}findSelectedItem(){return this.listItems.toArray().find(b=>b.selected)}findFocusedItem(){return this.listItems.toArray().find(b=>b.focused)}getFocusedIndex(){return this.listItems.toArray().findIndex(b=>b===this.focusedItem)}navigate(b){switch(b){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext()}}static \u0275fac=function(k){return new(k||v)(M.rXU(M.aKT))};static \u0275cmp=M.VBU({type:v,selectors:[["igo-list"]],contentQueries:function(k,_,D){if(1&k&&M.wni(D,a,5),2&k){let h;M.mGM(h=M.lsd())&&(_.listItems=h)}},hostBindings:function(k,_){1&k&&M.bIt("keydown",function(h){return _.handleKeyboardEvent(h)},!1,M.EBC)("enter",function(h){return _.handleKeyboardEvent(h)},!1,M.EBC)},inputs:{navigation:"navigation",selection:"selection"},standalone:!0,features:[M.aNF],ngContentSelectors:c,decls:2,vars:3,consts:[["igoClickout","",3,"clickout","click","ngClass"]],template:function(k,_){1&k&&(M.NAR(),M.j41(0,"mat-list",0),M.bIt("clickout",function(){return _.disableNavigation()})("click",function(){return _.enableNavigation()}),M.SdG(1),M.k0s()),2&k&&M.Y8G("ngClass",M.eq3(1,o,_.selection))},dependencies:[p.Fg,p.jt,e,F.YU],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mdc-list-item--with-leading-icon{height:48px}[_nghost-%COMP%]     .mat-mdc-list   igo-collapsible>.mat-mdc-list-item>.mdc-list-item__primary-text>.mat-mdc-list-item{font-weight:700;opacity:.9}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}"]})}return v})()},62152:(De,le,r)=>{"use strict";r.d(le,{g:()=>o});var M=r(60316),a=r(68559);const F=["*",[["","panelLeftButton",""]],[["","panelHeader",""]],[["","panelRightButton",""]]],p=["*","[panelLeftButton]","[panelHeader]","[panelRightButton]"],e=L=>({"igo-cursor-pointer":L});function c(L,R){if(1&L&&(a.j41(0,"div",2)(1,"div",3),a.SdG(2,1),a.k0s(),a.j41(3,"h3",4),a.EFF(4),a.SdG(5,2),a.k0s(),a.j41(6,"div",5),a.SdG(7,3),a.k0s()()),2&L){const v=a.XpG();a.Y8G("ngClass",a.eq3(2,e,!0===v.cursorPointer)),a.R7$(4),a.SpI(" ",v.title," ")}}let o=(()=>{class L{title;get withHeader(){return this._withHeader}set withHeader(v){this._withHeader=v}_withHeader=!0;cursorPointer=!1;static \u0275fac=function(y){return new(y||L)};static \u0275cmp=a.VBU({type:L,selectors:[["igo-panel"]],hostVars:2,hostBindings:function(y,b){2&y&&a.AVh("igo-panel-with-header",b.withHeader)},inputs:{title:"title",withHeader:"withHeader",cursorPointer:"cursorPointer"},standalone:!0,features:[a.aNF],ngContentSelectors:p,decls:3,vars:1,consts:[["class","igo-panel-header","title","",3,"ngClass",4,"ngIf"],["title","",1,"igo-panel-content"],["title","",1,"igo-panel-header",3,"ngClass"],[1,"panel-left"],[1,"igo-panel-title"],[1,"panel-right"]],template:function(y,b){1&y&&(a.NAR(F),a.DNE(0,c,8,4,"div",0),a.j41(1,"div",1),a.SdG(2),a.k0s()),2&y&&a.Y8G("ngIf",b.withHeader)},dependencies:[M.bT,M.YU],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   igo-interactive-tour[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .igo-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:48px;text-align:center}[_nghost-%COMP%]   .igo-panel-title[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin:0;font-weight:600;flex:1}[_nghost-%COMP%]   .igo-panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}[_nghost-%COMP%]   .igo-cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .panel-left[_ngcontent-%COMP%], [_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]{display:flex;min-width:40px}[_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]:not(:empty){padding-right:4px}"],changeDetection:0})}return L})()},73314:(De,le,r)=>{"use strict";r.d(le,{tI:()=>L}),r(67778),r(52575);var F=r(68559),p=r(60316),e=r(41134),c=r(75797);const o=b=>({"igo-spinner-container":!0,"igo-spinner-shown":b});let L=(()=>{class b{shown$=new c.t(!1);set shown(_){this.shown$.next(_)}get shown(){return this.shown$.value}constructor(){}show(){this.shown=!0}hide(){this.shown=!1}static \u0275fac=function(D){return new(D||b)};static \u0275cmp=F.VBU({type:b,selectors:[["igo-spinner"]],inputs:{shown:"shown"},standalone:!0,features:[F.aNF],decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(D,h){1&D&&(F.j41(0,"div",0),F.nI1(1,"async"),F.nrm(2,"div",1)(3,"mat-progress-spinner",2),F.k0s()),2&D&&F.Y8G("ngClass",F.eq3(3,o,F.bMT(1,1,h.shown$)))},dependencies:[p.YU,e.LG,p.Jj],styles:["[_nghost-%COMP%]   .igo-spinner-container[_ngcontent-%COMP%]{display:none;position:relative;pointer-events:none}[_nghost-%COMP%]   .igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}[_nghost-%COMP%]   .igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}"]})}return b})()},36222:(De,le,r)=>{"use strict";r.d(le,{WZ:()=>F});var M=r(68559);let F=(()=>{class e{onClick(o){o.stopPropagation()}static \u0275fac=function(L){return new(L||e)};static \u0275dir=M.FsC({type:e,selectors:[["","igoStopPropagation",""]],hostBindings:function(L,R){1&L&&M.bIt("click",function(y){return R.onClick(y)})},standalone:!0})}return e})()},12545:(De,le,r)=>{"use strict";r.d(le,{S$:()=>c,mJ:()=>e,OO:()=>F,PY:()=>h});var M=r(75300),a=r(75797);class F{options;activeTool$=new a.t(void 0);toolbar$=new a.t([]);activeTool$$;activeToolHistory=[];previousToolName;currentToolName;store=new M.D_([],{getKey:ee=>ee.name});get tools$(){return this.store.entities$}constructor(ee={}){this.options=ee,this.setToolbar(ee.toolbar),this.initStore()}destroy(){this.activeTool$$.unsubscribe(),this.store.destroy()}getTool(ee){return this.store.get(ee)}getTools(){return this.store.all()}setTools(ee){this.store.load(ee)}getToolbar(){return this.toolbar$.getValue()}setToolbar(ee){this.toolbar$.next(ee||[])}activateTool(ee,Z={}){const G=this.getTool(ee);void 0!==G&&this.store.state.update(G,{active:!0,options:Z},!0)}activatePreviousTool(){if(this.activeToolHistory.length<=1)return void this.deactivateTool();const[ee,Z]=this.activeToolHistory.splice(-2,2);this.activateTool(ee)}getCurrentPreviousToolName(){return[this.previousToolName,this.currentToolName]}deactivateTool(){this.clearActiveToolHistory(),this.store.state.updateAll({active:!1})}initStore(){this.store=new M.D_([],{getKey:ee=>ee.name}),this.activeTool$$=this.store.stateView.firstBy$(ee=>!0===ee.state.active).subscribe(ee=>{if(void 0===ee)return void this.setActiveTool(void 0);const Z=ee.entity,G=Object.assign({},Z.options||{},ee.state.options||{});this.setActiveTool(Object.assign({},Z,{options:G}))})}setActiveTool(ee){this.activeTool$.next(ee),void 0===ee?this.clearActiveToolHistory():(this.activeToolHistory=this.activeToolHistory.filter(Z=>Z!==ee.name).concat([ee.name]),this.previousToolName=this.currentToolName,this.currentToolName=this.activeToolHistory[this.activeToolHistory.length-1])}clearActiveToolHistory(){this.activeToolHistory=[]}}var p=r(68559);let e=(()=>{class x{static tools={};toolbox=new F;static register(Z){x.tools[Z.name]=Z}constructor(){this.toolbox.setTools(this.getTools())}getTool(Z){return x.tools[Z]}getTools(){return Object.values(x.tools)}static \u0275fac=function(G){return new(G||x)};static \u0275prov=p.jDH({token:x,factory:x.\u0275fac,providedIn:"root"})}return x})();function c(x){return ee=>{e.register(Object.assign({},x,{component:ee}))}}var o=r(60316),L=r(44038),R=r(74104),v=r(70271),y=r(47172);function b(x="300ms",ee="ease-in-out"){return(0,y.hZ)("toolSlideInOut",[(0,y.wk)("enter",(0,y.iF)({transform:"translate3d(0, 0, 0)"})),(0,y.kY)("void => enter",(0,y.i0)(x+" "+ee))])}const k=(x,ee)=>({"igo-tool-container-with-toolbar":x,"igo-tool-container-with-animation":ee});function _(x,ee){if(1&x&&(p.nrm(0,"igo-actionbar",2),p.nI1(1,"async"),p.nI1(2,"async"),p.nI1(3,"async")),2&x){const Z=p.XpG();p.Y8G("store",Z.actionStore)("withIcon",!0)("withTitle",p.bMT(1,6,Z.toolbarWithTitle$))("withTooltip",!1===p.bMT(2,8,Z.toolbarWithTitle$))("scrollActive",p.bMT(3,10,Z.toolbarWithTitle$))("horizontal",!1)}}function D(x,ee){if(1&x){const Z=p.RV6();p.j41(0,"div",3),p.nI1(1,"async"),p.bIt("@toolSlideInOut.start",function(){p.eBV(Z);const U=p.XpG();return p.Njj(U.onAnimationStart())})("@toolSlideInOut.done",function(){p.eBV(Z);const U=p.XpG();return p.Njj(U.onAnimationComplete())}),p.nrm(2,"igo-dynamic-outlet",4),p.k0s()}if(2&x){const Z=ee.ngIf,G=p.XpG();p.Y8G("ngClass",p.l_i(6,k,!G.actionStore.empty,G.animate))("@toolSlideInOut",p.bMT(1,4,G.animation$)),p.R7$(2),p.Y8G("component",Z.component)("inputs",G.getToolInputs(Z))}}let h=(()=>{class x{activeTool$=new a.t(void 0);get isActive(){return!!this.activeTool$.value}actionStore=new L.uw([]);animation$=new a.t("none");toolbar$=new a.t([]);toolbarWithTitle$=this.activeTool$.pipe((0,v.T)(Z=>void 0===Z));activeTool$$;toolbar$$;animating$=new a.t(!1);animating$$;toolbox;animate=!1;color="white";get classColorGrey(){return"grey"===this.color}get classColorPrimary(){return"primary"===this.color}ngOnInit(){this.toolbar$$=this.toolbox.toolbar$.subscribe(Z=>this.onToolbarChange(Z)),this.activeTool$$=this.toolbox.activeTool$.subscribe(Z=>this.onActiveToolChange(Z))}ngOnDestroy(){this.toolbar$$.unsubscribe(),this.activeTool$$.unsubscribe(),this.actionStore.destroy()}onAnimationStart(){this.animating$.next(!0)}onAnimationComplete(){this.animating$.next(!1)}getToolInputs(Z){return Z.options||{}}onToolbarChange(Z){this.setToolbar(Z)}onActiveToolChange(Z){this.animate?this.onAnimate(()=>this.setActiveTool(Z)):this.setActiveTool(Z)}setActiveTool(Z){if(void 0===Z)this.actionStore.state.updateAll({active:!1});else{const G=this.actionStore.get(Z.name);void 0!==G&&this.actionStore.state.update(G,{active:!0},!0)}this.activeTool$.next(Z),this.animate&&this.animation$.next("enter")}setToolbar(Z){const G=Z.reduce((U,N)=>{const W=this.toolbox.getTool(N);return void 0===W||U.push({id:W.name,title:W.title,icon:W.icon,tooltip:W.tooltip,args:[W,this.toolbox],handler:(A,g)=>{g.activateTool(A.name)},ngClass:(A,g)=>this.toolbox.activeTool$.pipe((0,v.T)(u=>{let O=!1;void 0!==u&&A.name===u.name&&(O=!0);let j=!1;return void 0!==u&&A.name===u.parent&&(j=!0),{"tool-activated":O,"children-tool-activated":j}}))}),U},[]);this.actionStore.load(G),this.toolbar$.next(Z)}onAnimate(Z){this.unAnimate(),this.animating$$=this.animating$.subscribe(G=>{G||(Z.call(this),this.unAnimate())})}unAnimate(){this.animating$$&&this.animating$$.unsubscribe()}static \u0275fac=function(G){return new(G||x)};static \u0275cmp=p.VBU({type:x,selectors:[["igo-toolbox"]],hostVars:4,hostBindings:function(G,U){2&G&&p.AVh("color-grey",U.classColorGrey)("color-primary",U.classColorPrimary)},inputs:{toolbox:"toolbox",animate:"animate",color:"color"},standalone:!0,features:[p.aNF],decls:4,vars:6,consts:[[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal",4,"ngIf"],["class","igo-tool-container mat-body-1",3,"ngClass",4,"ngIf"],[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal"],[1,"igo-tool-container","mat-body-1",3,"ngClass"],[3,"component","inputs"]],template:function(G,U){1&G&&(p.DNE(0,_,4,12,"igo-actionbar",0),p.nI1(1,"async"),p.DNE(2,D,3,9,"div",1),p.nI1(3,"async")),2&G&&(p.Y8G("ngIf",p.bMT(1,2,U.toolbar$).length>0),p.R7$(2),p.Y8G("ngIf",p.bMT(3,4,U.activeTool$)))},dependencies:[o.bT,L.Vn,o.YU,R.Yq,o.Jj],styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden;width:100%;height:100%}[_nghost-%COMP%]     .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin:0}[_nghost-%COMP%]   .igo-tool-container[_ngcontent-%COMP%]{position:absolute;inset:0;margin-bottom:0}[_nghost-%COMP%]   .igo-tool-container-with-animation[_ngcontent-%COMP%]{transform:translate3d(100%,0,0)}[_nghost-%COMP%]   .igo-tool-container-with-toolbar[_ngcontent-%COMP%]{left:50px}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   igo-actionbar.with-title[_ngcontent-%COMP%]{width:100%;overflow:auto}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){width:48px;overflow:hidden;-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){overflow:auto}}[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{overflow:auto}"],data:{animation:[b()]},changeDetection:0})}return x})()},84374:(De,le,r)=>{"use strict";r.d(le,{sQ:()=>o,bM:()=>e,b6:()=>c.b,Cq:()=>p});var M=r(74104),F=r(68559);let p=(()=>{class L{dynamicComponentService;constructor(v){this.dynamicComponentService=v}create(v){return this.dynamicComponentService.create(v)}static \u0275fac=function(y){return new(y||L)(F.KVO(M._i))};static \u0275prov=F.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})(),e=(()=>{class L{static \u0275fac=function(y){return new(y||L)};static \u0275mod=F.$C({type:L});static \u0275inj=F.G2t({})}return L})();var c=r(49827);let o=(()=>{class L{static \u0275fac=function(y){return new(y||L)};static \u0275mod=F.$C({type:L});static \u0275inj=F.G2t({providers:[p],imports:[e,e]})}return L})()},49827:(De,le,r)=>{"use strict";r.d(le,{b:()=>e});var M=r(60316),a=r(68559),F=r(74104);function p(c,o){if(1&c&&a.nrm(0,"igo-dynamic-outlet",1),2&c){const L=a.XpG();a.Y8G("component",L.widget)("inputs",L.inputs)("subscribers",L.getEffectiveSubscribers())}}let e=(()=>{class c{baseSubscribers={cancel:L=>this.onCancel(L),complete:L=>this.onComplete(L)};widget;inputs;subscribers={};complete=new a.bkB;cancel=new a.bkB;constructor(){}ngOnDestroy(){this.destroyWidget()}getEffectiveSubscribers(){const L=Object.assign({},this.subscribers);return Object.keys(this.baseSubscribers).forEach(R=>{const v=L[R],y=this.baseSubscribers[R];L[R]=void 0!==v?b=>{v(b),y(b)}:y}),L}onCancel(L){this.cancel.emit(L),this.destroyWidget()}onComplete(L){this.complete.emit(L),this.destroyWidget()}destroyWidget(){void 0!==this.widget&&this.widget.destroy(),this.widget=void 0}static \u0275fac=function(R){return new(R||c)};static \u0275cmp=a.VBU({type:c,selectors:[["igo-widget-outlet"]],inputs:{widget:"widget",inputs:"inputs",subscribers:"subscribers"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[a.aNF],decls:1,vars:1,consts:[[3,"component","inputs","subscribers",4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(R,v){1&R&&a.DNE(0,p,1,3,"igo-dynamic-outlet",0),2&R&&a.Y8G("ngIf",v.widget)},dependencies:[M.bT,F.Yq],styles:["[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return c})()},53994:(De,le,r)=>{"use strict";r.d(le,{aR:()=>e,go:()=>o,Du:()=>F,qP:()=>b});var M=r(75300),a=r(75797);class F extends M.D_{activeWorkspace$=new a.t(void 0);activateWorkspace(h){const X=this.activeWorkspace$.value;void 0!==X&&X.deactivate(),this.deactivateWorkspace(),void 0!==h&&(this.state.update(h,{active:!0,selected:!0},!0),this.activeWorkspace$.next(h),h.activate())}deactivateWorkspace(){const h=this.activeWorkspace$.value;void 0!==h&&(h.deactivate(),this.activeWorkspace$.next(void 0))}}var p=r(84205);class e{options;widget$=new a.t(void 0);widgetInputs$=new a.t({});widgetSubscribers$=new a.t({});entities$$;change=new p.B;change$;get id(){return this.options.id}get title(){return this.options.title}get meta(){return this.options.meta||{}}get entityStore(){return this.options.entityStore}get actionStore(){return this.options.actionStore}get widget(){return this.widget$.value}get hasWidget(){return void 0!==this.widget}constructor(h){this.options=h}get active(){return this.active$.value}active$=new a.t(!1);activate(){!0===this.active&&this.deactivate(),this.active$.next(!0),void 0!==this.entityStore&&(this.entities$$=this.entityStore.stateView.all$().subscribe(()=>this.onStateChange())),this.change.next()}deactivate(){this.active$.next(!1),this.deactivateWidget(),void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.change$&&this.change$.unsubscribe()}activateWidget(h,X={},H={}){this.widget$.next(h),this.widgetInputs$.next(X),this.widgetSubscribers$.next(H),this.change.next()}deactivateWidget(){this.widget$.next(void 0),this.change.next()}onStateChange(){this.change.next()}}var c=r(68559);let o=(()=>{class D{store;disabled;selectedChange=new c.bkB;getWorkspaceTitle(X){return(0,M.k0)(X)}onSelectedChange(X){const H=X.value;this.store.activateWorkspace(H),this.selectedChange.emit({selected:!0,value:H})}static \u0275fac=function(H){return new(H||D)};static \u0275cmp=c.VBU({type:D,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[c.aNF],decls:1,vars:4,consts:[[3,"selectedChange","store","multi","titleAccessor","disabled"]],template:function(H,x){1&H&&(c.j41(0,"igo-entity-selector",0),c.bIt("selectedChange",function(Z){return x.onSelectedChange(Z)}),c.k0s()),2&H&&c.Y8G("store",x.store)("multi",!1)("titleAccessor",x.getWorkspaceTitle)("disabled",x.disabled)},dependencies:[M.iX],changeDetection:0})}return D})();var R=r(60316),v=r(84374);function y(D,h){if(1&D){const X=c.RV6();c.qex(0),c.j41(1,"igo-widget-outlet",1),c.nI1(2,"async"),c.nI1(3,"async"),c.bIt("cancel",function(){const x=c.eBV(X).ngIf,ee=c.XpG();return c.Njj(ee.onWidgetCancel(x))})("complete",function(){const x=c.eBV(X).ngIf,ee=c.XpG();return c.Njj(ee.onWidgetComplete(x))}),c.k0s(),c.bVm()}if(2&D){const X=h.ngIf,H=c.XpG();c.R7$(),c.Y8G("widget",X)("inputs",c.bMT(2,3,H.widgetInputs$))("subscribers",c.bMT(3,5,H.widgetSubscribers$))}}let b=(()=>{class D{workspace;deactivateWidget=new c.bkB;get widget$(){return this.workspace.widget$}get widgetInputs$(){return this.workspace.widgetInputs$}get widgetSubscribers$(){return this.workspace.widgetSubscribers$}constructor(){}onWidgetCancel(X){this.workspace.deactivateWidget(),this.deactivateWidget.emit(X)}onWidgetComplete(X){this.workspace.deactivateWidget(),this.deactivateWidget.emit(X)}static \u0275fac=function(H){return new(H||D)};static \u0275cmp=c.VBU({type:D,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},standalone:!0,features:[c.aNF],decls:2,vars:3,consts:[[4,"ngIf"],[3,"cancel","complete","widget","inputs","subscribers"]],template:function(H,x){1&H&&(c.DNE(0,y,4,7,"ng-container",0),c.nI1(1,"async")),2&H&&c.Y8G("ngIf",c.bMT(1,1,x.widget$))},dependencies:[R.bT,v.b6,R.Jj],styles:["igo-widget-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return D})()},57132:(De,le,r)=>{"use strict";r.d(le,{MM:()=>Gn,vi:()=>qt,g4:()=>Mt,kc:()=>ci,RT:()=>Te,yV:()=>an,BJ:()=>bo,VT:()=>Q,QC:()=>Jo,V:()=>Sn,T$:()=>si});var M=r(60316),a=r(34456),F=r(84175),p=r(59864),e=r(85060),c=r(14102),o=r(15944),L=r(87984),R=r(25175),v=r(73314),y=r(67143),b=r(21701),k=r(1455),_=r(75797),D=r(64334),h=r(30699),X=r(71424),H=r(81681),x=r(19032),ee=r(68671),Z=r(66586),G=r(49964),U=r(75181),N=r(65836),W=r(84205),A=r(59452),g=r(47470),u=r(2435),O=r(61318),j=r(98764),P=r(70271),Y=r(1365),w=r(52575),I=function(ne){return ne[ne.null=0]="null",ne[ne.read=1]="read",ne[ne.write=2]="write",ne}(I||{}),s=r(68559),z=r(46443);let Q=(()=>{class ne{http;authService;languageService;config;messageService;storageService;exportService;route;context$=new _.t(void 0);contexts$=new _.t({ours:[]});defaultContextId$=new _.t(void 0);editedContext$=new _.t(void 0);importedContext=[];toolsChanged$=new W.B;mapViewFromRoute={};options;baseUrl;tools;toolbar;get defaultContextUri(){return this.storageService.get("favorite.context.uri")||this._defaultContextUri||this.options.defaultContextUri}set defaultContextUri(C){this._defaultContextUri=C}_defaultContextUri;constructor(C,K,q,ve,Pe,Ne,st,ht){this.http=C,this.authService=K,this.languageService=q,this.config=ve,this.messageService=Pe,this.storageService=Ne,this.exportService=st,this.route=ht,this.options=Object.assign({basePath:"contexts",contextListFile:"_contexts.json",defaultContextUri:"_default"},this.config.getConfig("context")),this.baseUrl=this.options.url??"",this.readParamsFromRoute(),this.authService.hasAuthService?this.authService.logged$.subscribe(Ze=>{Ze&&(this.contexts$.pipe((0,g.i)(1),(0,u.$)()).subscribe(_t=>{this.handleContextsChange()}),this.loadContexts())}):(this.loadContexts(),this.handleContextsChange(!1))}get(C,K){let q=this.baseUrl+"/contexts";return C&&this.authService.authenticated&&(q+="?permission="+C.join(),K&&(q+="&hidden=true")),this.http.get(q)}getById(C){return this.http.get(this.baseUrl+"/contexts/"+C)}getDetails(C){return this.http.get(`${this.baseUrl}/contexts/${C}/details`).pipe((0,O.W)(q=>{throw this.handleError(q,C),q}))}getDefault(){if(this.authService.authenticated)return this.http.get(this.baseUrl+"/contexts/default").pipe((0,j.M)(K=>{this.defaultContextId$.next(K.id)}));{const C=this.storageService.get("favorite.context.uri");return this.defaultContextId$.next(C),this.getContextByUri(C)}}getProfilByUser(){return this.baseUrl?this.http.get(this.baseUrl+"/profils?"):(0,A.of)([])}setDefault(C){return this.authService.authenticated?this.http.post(this.baseUrl+"/contexts/default",{defaultContextId:C}):(this.storageService.set("favorite.context.uri",C),(0,A.of)(void 0))}hideContext(C){return this.http.post(this.baseUrl+"/contexts/"+C+"/hide",{})}showContext(C){return this.http.post(this.baseUrl+"/contexts/"+C+"/show",{})}delete(C,K=!1){const q={ours:[]};return Object.keys(this.contexts$.value).forEach(Pe=>q[Pe]=this.contexts$.value[Pe].filter(Ne=>Ne.id!==C)),K?(this.importedContext=this.importedContext.filter(Pe=>Pe.id!==C),(0,A.of)(this.contexts$.next(q))):this.http.delete(this.baseUrl+"/contexts/"+C).pipe((0,j.M)(Pe=>{this.contexts$.next(q)}))}create(C){return this.http.post(this.baseUrl+"/contexts",C).pipe((0,P.T)(q=>(q.permission=this.authService.authenticated?I[I.write]:I[I.read],this.contexts$.value.ours.unshift(q),this.contexts$.next(this.contexts$.value),q)))}clone(C,K={}){return this.http.post(this.baseUrl+"/contexts/"+C+"/clone",K).pipe((0,P.T)(ve=>(ve.permission=I[I.write],this.contexts$.value.ours.unshift(ve),this.contexts$.next(this.contexts$.value),ve)))}update(C,K){return this.http.patch(this.baseUrl+"/contexts/"+C,K)}addToolAssociation(C,K){return this.http.post(`${this.baseUrl}/contexts/${C}/tools`,{toolId:K})}deleteToolAssociation(C,K){return this.http.delete(`${this.baseUrl}/contexts/${C}/tools/${K}`)}getPermissions(C){return this.http.get(this.baseUrl+"/contexts/"+C+"/permissions")}addPermissionAssociation(C,K,q){return this.http.post(`${this.baseUrl}/contexts/${C}/permissions`,{profil:K,typePermission:q}).pipe((0,O.W)(Ne=>{throw this.handleError(Ne,void 0,!0),[Ne]}))}deletePermissionAssociation(C,K){return this.http.delete(`${this.baseUrl}/contexts/${C}/permissions/${K}`)}getLocalContexts(){const C=this.getPath(this.options.contextListFile);return this.http.get(C).pipe((0,P.T)(K=>({ours:K})))}getLocalContext(C){const K=this.getPath(`${C}.json`);return this.http.get(K).pipe((0,Y.Z)(q=>{if(!q.base)return(0,A.of)(q);const ve=this.getPath(`${q.base}.json`);return this.http.get(ve).pipe((0,P.T)(Pe=>{const Ne=q;return Ne.map=ee.BF.mergeDeep(Pe.map,q.map),Ne.layers=(Pe.layers||[]).concat(q.layers||[]).reverse().filter((st,ht,Ze)=>!st.id||Ze.findIndex(_t=>_t.id===st.id)===ht).reverse(),Ne.toolbar=q.toolbar||Pe.toolbar,Ne.message=q.message||Pe.message,Ne.messages=q.messages||Pe.messages,Ne.tools=(q.tools||[]).concat(Pe.tools||[]).filter((st,ht,Ze)=>Ze.findIndex(_t=>_t.name===st.name)===ht),Ne}),(0,O.W)(Pe=>{throw this.handleError(Pe,C),Pe}))}),(0,O.W)(q=>{throw this.handleError(q,C),q}))}loadContexts(C,K){let q;q=this.baseUrl?this.get(C,K):this.getLocalContexts(),q.subscribe(ve=>{ve.ours=this.importedContext.concat(ve.ours),this.contexts$.next(ve)})}loadDefaultContext(){const C=(K=!1)=>{!K&&this.baseUrl&&this.authService.authenticated?this.getDefault().subscribe(q=>{this.defaultContextUri=q.uri,this.addContextToList(q),this.setContext(q)},()=>{this.defaultContextId$.next(void 0),this.loadContext(this.defaultContextUri)}):this.loadContext(this.defaultContextUri)};this.route&&this.route.options.contextKey?this.route.queryParams.pipe((0,w.B)(100)).subscribe(K=>{const q=K[this.route.options.contextKey];let ve=!1;q&&(this.defaultContextUri=q,ve=!0),C(ve)}):C()}loadContext(C){const K=this.context$.value;K&&K.uri===C||this.getContextByUri(C).pipe((0,u.$)()).subscribe(q=>{this.addContextToList(q),this.setContext(q)},q=>{C!==this.options.defaultContextUri&&this.loadContext(this.options.defaultContextUri)})}setContext(C){this.handleContextMessage(C);const K=this.context$.value;if(K&&C&&C.id===K.id)return void 0===C.map.view.keepCurrentView&&(C.map.view.keepCurrentView=!0),void this.context$.next(C);C.map||(C.map={view:{}}),Object.assign(C.map.view,this.mapViewFromRoute),this.context$.next(C)}loadEditedContext(C){this.getContextByUri(C).subscribe(K=>{this.setEditedContext(K)})}setEditedContext(C){this.editedContext$.next(C)}getContextFromMap(C,K){const q=C.ol.getView(),ve=q.getProjection().getCode(),Pe=new G.A(q.getCenter()).transform(ve,"EPSG:4326"),Ne={uri:(0,ee.uR)(),title:"",scope:"private",map:{view:{center:Pe.getCoordinates(),zoom:q.getZoom(),projection:ve,maxZoomOnExtent:C.viewController.maxZoomOnExtent}},layers:[],tools:[]};let st=[];st=!0===K?C.layers$.getValue().filter(Ze=>!0===Ze.baseLayer||"searchPointerSummaryId"===Ze.options.id).sort((Ze,_t)=>Ze.zIndex-_t.zIndex):C.layers$.getValue().filter(Ze=>!Ze.id.includes("WfsWorkspaceTableDest")).sort((Ze,_t)=>Ze.zIndex-_t.zIndex);let ht=0;for(const Ze of st){const _t={title:Ze.options.title,zIndex:++ht,visible:Ze.visible,security:Ze.options.security,opacity:Ze.opacity},ft={id:Ze.options.id?String(Ze.options.id):void 0,layerOptions:_t,sourceOptions:{type:Ze.dataSource.options.type,params:Ze.dataSource.options.params,url:Ze.dataSource.options.url,queryable:Ze.queryable}};ft.sourceOptions.type&&Ne.layers.push(ft)}return Ne.tools=this.tools.map(Ze=>({id:String(Ze.id),global:Ze.global})),Ne}getContextFromLayers(C,K,q,ve){const Pe=this.context$.getValue(),Ne=C.ol.getView(),st=Ne.getProjection().getCode(),Ze={uri:q,title:q,map:{view:{center:new G.A(Ne.getCenter()).transform(st,"EPSG:4326").getCoordinates(),zoom:Ne.getZoom(),projection:st,keepCurrentView:ve}},layers:[],toolbar:[],tools:[],extraFeatures:[]},_t=C.layers$.getValue();return Ze.layers=_t.filter(ft=>ft.baseLayer).map(ft=>({baseLayer:!0,sourceOptions:ft.options.sourceOptions,title:ft.options.title,visible:ft.visible})),K.forEach(ft=>{const Zt=Pe.layers.find(Nt=>{const xo=Nt.source;return xo&&ft.id===xo.id&&!Nt.baseLayer});if(Zt){let Nt=Zt,xo=Nt.style;Nt.igoStyle?.styleByAttribute?xo=void 0:Nt.igoStyle?.clusterBaseStyle&&(xo=void 0,delete Zt.sourceOptions.source,delete Zt.sourceOptions.format),delete Zt.source;const Vn={...Zt,title:ft.options.title,zIndex:ft.zIndex,style:xo,visible:ft.visible,opacity:ft.opacity};Ze.layers.push(Vn)}else if(ft.ol.getSource()instanceof N.A){const Nt=this.getExtraFeatures(ft);Nt.name=ft.options.title,Nt.opacity=ft.opacity,Nt.visible=ft.visible,Ze.extraFeatures.push(Nt)}else{const Nt=ft.options;Nt.zIndex=ft.zIndex,Nt.visible=ft.visible,Nt.opacity=ft.opacity,delete Nt.source,Ze.layers.push(Nt)}}),Ze.toolbar=this.toolbar,Ze.tools=this.tools,Ze}getExtraFeatures(C){const K=new Z.A;let q;C.ol.getSource()instanceof U.A?(q=C.ol.getSource().getFeatures(),q=q.flatMap(st=>st.get("features"))):q=C.ol.getSource().getFeatures();const ve=this.exportService.generateFeature(q,"GeoJSON","_featureStore"),Pe=K.writeFeatures(ve,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return JSON.parse(Pe)}setTools(C){this.tools=C}setToolbar(C){this.toolbar=C}handleContextMessage(C){this.context$.value&&C.uri&&this.context$.value.uri!==C.uri&&this.messageService.removeAllAreNotError(),C.messages=C.messages?C.messages:[],C.messages.push(C.message),C.messages.map(K=>{K&&this.messageService.message(K)})}getContextByUri(C){if(this.baseUrl){let q;for(const Pe of Object.keys(this.contexts$.value))if(q=this.contexts$.value[Pe].find(Ne=>Ne.uri===C),q)break;return q&&q.imported?(0,A.of)(q):this.getDetails(q?q.id:C)}const K=this.contexts$.value.ours.find(q=>q.uri===C&&!0===q.imported);return K?(0,A.of)(K):this.getLocalContext(C)}getContextLayers(C){const K=[];return C.layers$.getValue().forEach(ve=>{!ve.baseLayer&&"searchPointerSummaryId"!==ve.options.id&&K.push(ve)}),K}readParamsFromRoute(){this.route&&this.route.queryParams.subscribe(C=>{const K=this.route.options.centerKey;K&&C[K]&&(this.mapViewFromRoute.center=C[K].split(",").map(Number));const q=this.route.options.projectionKey;q&&C[q]&&(this.mapViewFromRoute.projection=C[q]);const ve=this.route.options.zoomKey;ve&&C[ve]&&(this.mapViewFromRoute.zoom=Number(C[ve]))})}getPath(C){return`${this.options.basePath.replace(/\/$/,"")}/${C}`}handleError(C,K,q){const ve=this.contexts$.value.ours.find(Ne=>Ne.uri===K),Pe=ve?ve.title:K;C.error.title=this.languageService.translate.instant("igo.context.contextManager.invalid.title"),C.error.message=this.languageService.translate.instant("igo.context.contextManager.invalid.text",{value:Pe}),C.error.toDisplay=!0,q&&(C.error.title=this.languageService.translate.instant("igo.context.contextManager.errors.addPermissionTitle"),C.error.message=this.languageService.translate.instant("igo.context.contextManager.errors.addPermission")),this.messageService.error("igo.context.contextManager.errors.addPermission","igo.context.contextManager.errors.addPermissionTitle")}handleContextsChange(C=!0){const K=this.context$.value,q=this.editedContext$.value;(!K||K.uri===this.options.defaultContextUri)&&(C=!1),C&&this.findContext(K)?(this.getContextByUri(K.uri).pipe((0,u.$)()).subscribe(Pe=>{this.toolsChanged$.next(Pe)}),this.baseUrl&&this.authService.authenticated&&this.getDefault().subscribe()):(this.defaultContextUri=void 0,this.loadDefaultContext());const ve=this.findContext(q);(!ve||"write"!==ve.permission)&&this.setEditedContext(void 0)}addContextToList(C){this.findContext(C)||this.contexts$.value&&this.contexts$.value.public&&(this.contexts$.value.public.push({id:C.id,uri:C.uri,title:C.title,scope:C.scope,permission:I[I.read]}),this.contexts$.next(this.contexts$.value))}findContext(C){if(!C)return!1;const K=this.contexts$.value;let q;for(const ve of Object.keys(K))if(q=K[ve].find(Ne=>C.id&&Ne.id===C.id||C.uri&&Ne.uri===C.uri),q)break;return q}static \u0275fac=function(K){return new(K||ne)(s.KVO(z.Qq),s.KVO(h.uR),s.KVO(b.gw),s.KVO(y.we),s.KVO(k.bg),s.KVO(H.n$),s.KVO(x._Th),s.KVO(X.v$,8))};static \u0275prov=s.jDH({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();var ae=r(43942);class ye extends Error{}class ue extends ye{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,ue.prototype)}}let ce=(()=>{class ne{export(C){return this.exportAsync(C)}exportAsync(C){return new ae.c(q=>{if(!0===this.nothingToExport(C))return void q.error(new ue);const Pe=JSON.stringify(C);(0,ee.e5)(Pe,"text/json;charset=utf-8",`${C.uri}.json`),q.complete()})}nothingToExport(C){return void 0===C.map}static \u0275fac=function(K){return new(K||ne)};static \u0275prov=s.jDH({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();class Le extends Error{}class We extends Le{constructor(){super("Invalid file"),Object.setPrototypeOf(this,We.prototype)}}class Xe extends Le{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,Xe.prototype)}}class Be extends Le{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Be.prototype)}}class rt extends Le{constructor(){super("File is too large"),Object.setPrototypeOf(this,Be.prototype)}}function he(ne,Ke,C){C.error("igo.context.contextImportExport.import.invalid.text","igo.context.contextImportExport.import.invalid.title",void 0,{value:ne.name,mimeType:ne.type})}function $e(ne,Ke,C,K){C.error("igo.context.contextImportExport.import.tooLarge.text","igo.context.contextImportExport.import.tooLarge.title",void 0,{value:ne.name,size:K})}function Ae(ne,Ke,C){C.error("igo.context.contextImportExport.import.unreadable.text","igo.context.contextImportExport.import.unreadable.title",void 0,{value:ne.name})}function et(ne){return(new Z.A).readFeatures(ne,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}let jt=(()=>{class ne{config;static allowedMimeTypes=["application/json"];static allowedExtensions="json";clientSideFileSizeMax;constructor(C){this.config=C;const K=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(K||30)*Math.pow(1024,2)}import(C){return this.importAsync(C)}getFileImporter(C){const K=function at(ne){return ne.name.split(".").pop().toLowerCase()}(C),q=C.type,ve=[...ne.allowedMimeTypes],Pe=ne.allowedExtensions;if(!(ve.indexOf(q)<0&&Pe.indexOf(K)<0||"application/json"!==q&&K!==ne.allowedExtensions))return this.importFile}importAsync(C){return new ae.c(q=>{if(C.size>=this.clientSideFileSizeMax)return void q.error(new rt);const ve=this.getFileImporter(C);void 0!==ve?ve.call(this,C,q):q.error(new We)})}importFile(C,K){const q=new FileReader;q.onload=ve=>{try{const Pe=this.parseContextFromFile(C,ve.target.result);K.next(Pe)}catch{K.error(new Xe)}K.complete()},q.onerror=ve=>{K.error(new Xe)},q.readAsText(C,"UTF-8")}parseContextFromFile(C,K){return JSON.parse(K)}static \u0275fac=function(K){return new(K||ne)(s.KVO(y.we))};static \u0275prov=s.jDH({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();var dt=r(90852);const to=ne=>({size:ne});function Bt(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"div")(1,"form",7)(2,"div",8)(3,"button",9),s.nI1(4,"async"),s.bIt("click",function(){s.eBV(C);const q=s.sdS(10);return s.Njj(q.click())}),s.EFF(5),s.nI1(6,"translate"),s.k0s(),s.nrm(7,"igo-spinner",10),s.nI1(8,"async"),s.j41(9,"input",11,0),s.bIt("click",function(){s.eBV(C);const q=s.sdS(10);return s.Njj(q.value=null)})("change",function(q){s.eBV(C);const ve=s.XpG();return s.Njj(ve.importFiles(q.target.files))}),s.k0s()()(),s.j41(11,"section",12)(12,"h4"),s.EFF(13),s.nI1(14,"translate"),s.k0s(),s.j41(15,"ul")(16,"li"),s.EFF(17),s.nI1(18,"translate"),s.k0s()()()()}if(2&ne){const C=s.XpG();s.R7$(3),s.Y8G("disabled",s.bMT(4,7,C.loading$)),s.R7$(2),s.SpI(" ",s.bMT(6,9,"igo.geo.importExportForm.importButton")," "),s.R7$(2),s.Y8G("shown",s.bMT(8,11,C.loading$)),s.R7$(2),s.xc7("display","none"),s.R7$(4),s.JRh(s.bMT(14,13,"igo.geo.importExportForm.importClarifications")),s.R7$(4),s.SpI(" ",s.i5U(18,15,"igo.geo.importExportForm.importSizeMax",s.eq3(18,to,C.fileSizeMb))," ")}}function Tt(ne,Ke){if(1&ne&&(s.j41(0,"mat-option",4),s.EFF(1),s.k0s()),2&ne){const C=Ke.$implicit;s.Y8G("value",C),s.R7$(),s.JRh(C.title)}}function wo(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"form",13)(1,"div",14)(2,"mat-form-field",15)(3,"mat-label"),s.EFF(4),s.nI1(5,"translate"),s.k0s(),s.nrm(6,"input",16),s.k0s()(),s.j41(7,"div",14)(8,"mat-form-field")(9,"mat-label"),s.EFF(10),s.nI1(11,"translate"),s.k0s(),s.j41(12,"mat-select",17)(13,"mat-option",18,1),s.bIt("click",function(){s.eBV(C);const q=s.sdS(14),ve=s.XpG();return s.Njj(ve.selectAll(q))}),s.EFF(15),s.nI1(16,"translate"),s.k0s(),s.nrm(17,"mat-divider"),s.DNE(18,Tt,2,2,"mat-option",19),s.k0s()()(),s.j41(19,"div",8)(20,"button",9),s.nI1(21,"async"),s.bIt("click",function(){s.eBV(C);const q=s.XpG();return s.Njj(q.handleExportFormSubmit(q.form.value))}),s.EFF(22),s.nI1(23,"translate"),s.k0s(),s.nrm(24,"igo-spinner",10),s.nI1(25,"async"),s.k0s()()}if(2&ne){const C=s.XpG();s.Y8G("formGroup",C.form),s.R7$(4),s.JRh(s.bMT(5,9,"igo.context.contextImportExport.export.exportContextName")),s.R7$(6),s.JRh(s.bMT(11,11,"igo.context.contextImportExport.export.exportPlaceHolder")),s.R7$(3),s.Y8G("value",1),s.R7$(2),s.SpI(" ",s.bMT(16,13,"igo.context.contextImportExport.export.exportSelectAll")," "),s.R7$(3),s.Y8G("ngForOf",C.userControlledLayerList),s.R7$(2),s.Y8G("disabled",!C.form.valid||s.bMT(21,15,C.loading$)),s.R7$(2),s.SpI(" ",s.bMT(23,17,"igo.geo.importExportForm.exportButton")," "),s.R7$(2),s.Y8G("shown",s.bMT(25,19,C.loading$))}}let Mt=(()=>{class ne{contextImportService;contextExportService;messageService;formBuilder;config;contextService;form;layers;inputProj="EPSG:4326";loading$=new _.t(!1);forceNaming=!1;layerList;userControlledLayerList;res;clientSideFileSizeMax;fileSizeMb;activeImportExport="import";layers$$;map;constructor(C,K,q,ve,Pe,Ne){this.contextImportService=C,this.contextExportService=K,this.messageService=q,this.formBuilder=ve,this.config=Pe,this.contextService=Ne,this.buildForm()}ngOnInit(){const C=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(C||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.layers$$=this.map.layers$.subscribe(()=>{this.layerList=this.contextService.getContextLayers(this.map),this.userControlledLayerList=this.layerList.filter(K=>K.showInLayerList)})}importFiles(C){this.loading$.next(!0);for(const K of C)this.contextImportService.import(K).pipe((0,D.s)(1)).subscribe(q=>this.onFileImportSuccess(K,q),q=>this.onFileImportError(K,q),()=>{this.loading$.next(!1)})}handleExportFormSubmit(C){this.loading$.next(!0),this.res=this.contextService.getContextFromLayers(this.map,C.layers,C.name,!1),this.res.imported=!0,this.contextExportService.export(this.res).pipe((0,D.s)(1)).subscribe(()=>{},K=>this.onFileExportError(K),()=>{this.onFileExportSuccess(),this.loading$.next(!1)})}buildForm(){this.form=this.formBuilder.group({layers:["",[a.k0.required]],name:["",[a.k0.required]]})}onFileImportSuccess(C,K){!function Ve(ne,Ke,C,K){if(Object.keys(Ke).length<=0)return void function Qe(ne,Ke){Ke.error("igo.context.contextImportExport.import.empty.text","igo.context.contextImportExport.import.empty.title",void 0,{value:ne.name})}(ne,C);const q=function Oe(ne){return ne.name.substr(0,ne.name.lastIndexOf("."))}(ne);(function Ge(ne,Ke,C){ne.title=Ke,ne.imported=!0,C.contexts$.value.ours.unshift(ne),C.contexts$.next(C.contexts$.value),C.importedContext.unshift(ne),C.loadContext(ne.uri)})(Ke,q,K),C.success("igo.context.contextImportExport.import.success.text","igo.context.contextImportExport.import.success.title",void 0,{value:q})}(C,K,this.messageService,this.contextService)}onFileImportError(C,K){this.loading$.next(!1),function ie(ne,Ke,C,K){({"Invalid file":he,"File is too large":$e,"Failed to read file":Ae})[Ke.message](ne,Ke,C,K=K||30)}(C,K,this.messageService,this.fileSizeMb)}onFileExportError(C){this.loading$.next(!1),function re(ne,Ke){ne instanceof ue?this.handleNothingToExportError(Ke):Ke.error("igo.context.contextImportExport.export.failed.text","igo.context.contextImportExport.export.failed.title")}(C,this.messageService)}onFileExportSuccess(){!function be(ne){ne.success("igo.context.contextImportExport.export.success.text","igo.context.contextImportExport.export.success.title")}(this.messageService)}selectAll(C){C._selected&&(this.form.controls.layers.setValue(this.userControlledLayerList),C._selected=!0),!1===C._selected&&this.form.controls.layers.setValue([])}onImportExportChange(C){this.activeImportExport=C.value}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(K){return new(K||ne)(s.rXU(jt),s.rXU(ce),s.rXU(k.bg),s.rXU(a.ze),s.rXU(y.we),s.rXU(Q))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-context-import-export"]],inputs:{map:"map"},standalone:!0,features:[s.aNF],decls:10,vars:11,consts:[["fileInput",""],["e",""],[1,"import-export-toggle","mat-typography"],[3,"change","value"],[3,"value"],[4,"ngIf"],["class","igo-form",3,"formGroup",4,"ngIf"],[1,"igo-form"],[1,"igo-form-button-group"],["mat-raised-button","","type","button",3,"click","disabled"],[3,"shown"],["type","file",3,"click","change"],[1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[1,"example-full-width"],["formControlName","name","matInput","",3,"value"],["formControlName","layers","multiple",""],[3,"click","value"],[3,"value",4,"ngFor","ngForOf"]],template:function(K,q){1&K&&(s.j41(0,"div",2)(1,"mat-button-toggle-group",3),s.bIt("change",function(Pe){return q.onImportExportChange(Pe)}),s.j41(2,"mat-button-toggle",4),s.EFF(3),s.nI1(4,"translate"),s.k0s(),s.j41(5,"mat-button-toggle",4),s.EFF(6),s.nI1(7,"translate"),s.k0s()()(),s.DNE(8,Bt,19,20,"div",5)(9,wo,26,21,"form",6)),2&K&&(s.R7$(),s.Y8G("value",q.activeImportExport),s.R7$(),s.Y8G("value","import"),s.R7$(),s.SpI(" ",s.bMT(4,7,"igo.geo.importExportForm.importTabTitle")," "),s.R7$(2),s.Y8G("value","export"),s.R7$(),s.SpI(" ",s.bMT(7,9,"igo.geo.importExportForm.exportTabTitle")," "),s.R7$(2),s.Y8G("ngIf","import"===q.activeImportExport),s.R7$(),s.Y8G("ngIf","export"===q.activeImportExport))},dependencies:[p.Vg,p.ec,p.pc,M.bT,a.YN,a.qT,a.me,a.BC,a.cb,a.cV,F.Hl,F.$z,v.tI,a.X1,a.j4,a.JD,o.RG,o.rl,o.nJ,L.fS,L.fg,R.Ve,R.VO,e.wT,e.Sy,c.w,c.q,M.pM,M.Jj,b.Ck,dt.D9],styles:[".import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}.igo-input-container[_ngcontent-%COMP%]{padding:10px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{padding:0 5px}.igo-form[_ngcontent-%COMP%]{padding:15px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}"]})}return ne})();var ut=r(93840),Ft=r(80640);function Qt(ne,Ke){if(1&ne&&(s.j41(0,"span",10),s.EFF(1),s.k0s()),2&ne){const C=s.XpG();s.R7$(),s.SpI("",C.prefix,"-")}}let nt=(()=>{class ne{formBuilder;messageService;form;prefix;get btnSubmitText(){return this._btnSubmitText}set btnSubmitText(C){this._btnSubmitText=C}_btnSubmitText;get context(){return this._context}set context(C){this._context=C,this.buildForm()}_context;get disabled(){return this._disabled}set disabled(C){this._disabled=C}_disabled=!1;submitForm=new s.bkB;clone=new s.bkB;delete=new s.bkB;constructor(C,K){this.formBuilder=C,this.messageService=K}ngOnInit(){this.buildForm()}handleFormSubmit(C){let K=Object.assign({},C);K=ee.BF.removeNull(K),K.uri=K.uri.replace(" ",""),K.uri=K.uri?this.prefix+"-"+K.uri:this.prefix,this.submitForm.emit(K)}copyTextToClipboard(){const C=this.prefix+"-"+this.form.value.uri.replace(" ","");ee.B0.copy(C)&&this.messageService.success("igo.context.contextManager.dialog.copyMsg","igo.context.contextManager.dialog.copyTitle")}buildForm(){const C=this.context||{},K=C.uri.split("-");this.prefix=K.shift();const q=K.join("-");this.form=this.formBuilder.group({title:[C.title],uri:[q||" "]})}static \u0275fac=function(K){return new(K||ne)(s.rXU(a.ze),s.rXU(k.bg))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-context-form"]],inputs:{btnSubmitText:"btnSubmitText",context:"context",disabled:"disabled"},outputs:{submitForm:"submitForm",clone:"clone",delete:"delete"},standalone:!0,features:[s.aNF],decls:20,vars:18,consts:[[1,"igo-form",3,"ngSubmit","formGroup"],[1,"full-width"],["matInput","","required","","maxlength","128","formControlName","title",3,"placeholder"],["id","uriInput",1,"full-width"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","maxlength","64","floatLabel","always","formControlName","uri",3,"placeholder"],["id","copyButton","type","button","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"click","matTooltip"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[1,"prefix"]],template:function(K,q){1&K&&(s.j41(0,"form",0),s.bIt("ngSubmit",function(){return q.handleFormSubmit(q.form.value)}),s.j41(1,"mat-form-field",1),s.nrm(2,"input",2),s.nI1(3,"translate"),s.j41(4,"mat-error"),s.EFF(5),s.nI1(6,"translate"),s.k0s()(),s.j41(7,"mat-form-field",3),s.DNE(8,Qt,2,1,"span",4),s.j41(9,"span",5),s.nrm(10,"input",6),s.nI1(11,"translate"),s.k0s()(),s.j41(12,"button",7),s.nI1(13,"translate"),s.bIt("click",function(){return q.copyTextToClipboard()}),s.j41(14,"mat-icon"),s.EFF(15,"content_copy"),s.k0s()(),s.j41(16,"div",8)(17,"button",9),s.EFF(18),s.nI1(19,"translate"),s.k0s()()()),2&K&&(s.Y8G("formGroup",q.form),s.R7$(2),s.Y8G("placeholder",s.bMT(3,8,"igo.context.contextManager.form.title")),s.R7$(3),s.SpI(" ",s.bMT(6,10,"igo.context.contextManager.form.titleRequired")," "),s.R7$(3),s.Y8G("ngIf",q.prefix),s.R7$(2),s.Y8G("placeholder",s.bMT(11,12,"igo.context.contextManager.form.uri")),s.R7$(2),s.Y8G("matTooltip",s.bMT(13,14,"igo.context.contextManager.form.copy")),s.R7$(5),s.Y8G("disabled",!q.form.valid||q.disabled),s.R7$(),s.SpI(" ",s.bMT(19,16,"igo.context.contextManager.form.edit")," "))},dependencies:[a.YN,a.qT,a.me,a.BC,a.cb,a.YS,a.tU,a.X1,a.j4,a.JD,o.RG,o.rl,o.TL,L.fS,L.fg,M.bT,F.Hl,F.$z,F.iY,Ft.uc,Ft.oV,ut.m_,ut.An,b.Ck,dt.D9],styles:["form[_ngcontent-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}#copyButton[_ngcontent-%COMP%]{width:24px;float:right;position:relative;top:-58px;left:5px}"]})}return ne})();function Eo(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"igo-context-form",1),s.nI1(1,"translate"),s.bIt("submitForm",function(q){s.eBV(C);const ve=s.XpG();return s.Njj(ve.submitForm.emit(q))}),s.k0s()}if(2&ne){const C=s.XpG();s.Y8G("btnSubmitText",s.bMT(1,2,"igo.context.contextManager.save"))("context",C.context)}}let qt=(()=>{class ne{cd;get context(){return this._context}set context(C){this._context=C,this.refresh()}_context;submitForm=new s.bkB;constructor(C){this.cd=C}refresh(){this.cd.detectChanges()}static \u0275fac=function(K){return new(K||ne)(s.rXU(s.gRc))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-context-edit"]],inputs:{context:"context"},outputs:{submitForm:"submitForm"},standalone:!0,features:[s.aNF],decls:1,vars:1,consts:[[3,"btnSubmitText","context","submitForm",4,"ngIf"],[3,"submitForm","btnSubmitText","context"]],template:function(K,q){1&K&&s.DNE(0,Eo,2,4,"igo-context-form",0),2&K&&s.Y8G("ngIf",q.context)},dependencies:[M.bT,nt,b.Ck,dt.D9],encapsulation:2})}return ne})();var ro=r(20943),Uo=r(63220),Do=r(36222);const dn=ne=>({"mat-list-item-light":ne});function lo(ne,Ke){if(1&ne&&(s.j41(0,"mat-icon"),s.EFF(1),s.k0s()),2&ne){const C=s.XpG(2);s.R7$(),s.JRh(C.context.icon?C.context.icon:"public"===C.context.scope?"public":"star")}}function co(ne,Ke){if(1&ne&&s.nrm(0,"img",8),2&ne){const C=s.XpG(2);s.Y8G("src",C.context.iconImage,s.B4B)}}function mt(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",5),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG();return s.Njj(q.favoriteClick(q.context))}),s.DNE(2,lo,2,1,"mat-icon",6)(3,co,1,1,"img",7),s.k0s()}if(2&ne){const C=s.XpG();s.Y8G("matTooltip",C.auth.authenticated?s.bMT(1,4,"igo.context.contextManager.favorite"):"")("color",C.default?"primary":"default"),s.R7$(2),s.Y8G("ngIf",!C.context.iconImage),s.R7$(),s.Y8G("ngIf",C.context.iconImage)}}function Ro(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",5),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG();return s.Njj(q.favoriteClick(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"star"),s.k0s()()}if(2&ne){const C=s.XpG();s.Y8G("matTooltip",s.bMT(1,2,"igo.context.contextManager.favorite"))("color",C.default?"primary":"default")}}function tn(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",18),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.save.emit(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"save"),s.k0s()()}if(2&ne){const C=s.XpG(2);s.Y8G("matTooltip",s.bMT(1,2,"igo.context.contextManager.save"))("color",C.color)}}function Xo(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",19),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.managePermissions.emit(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"manage_accounts"),s.k0s()()}if(2&ne){const C=s.XpG(2);s.Y8G("matTooltip",s.bMT(1,2,"igo.context.contextManager.managePermissions"))("color",C.color)}}function mn(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",20),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.clone.emit(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"content_copy"),s.k0s()()}if(2&ne){const C=s.XpG(2);s.Y8G("matTooltip",s.bMT(1,2,"igo.context.contextManager.clone"))("color",C.color)}}function Po(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",21),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.edit.emit(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"edit"),s.k0s()()}if(2&ne){const C=s.XpG(2);s.Y8G("color",C.color)("matTooltip",s.bMT(1,2,"igo.context.contextManager.edit"))}}function yo(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",22),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.hide.emit(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"visibility"),s.k0s()()}if(2&ne){const C=s.XpG(2);s.Y8G("color",C.color)("matTooltip",s.bMT(1,2,"igo.context.contextManager.hide"))}}function so(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",22),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.show.emit(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"visibility_off"),s.k0s()()}if(2&ne){const C=s.XpG(2);s.Y8G("color",C.color)("matTooltip",s.bMT(1,2,"igo.context.contextManager.show"))}}function At(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",23),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.delete.emit(q.context))}),s.j41(2,"mat-icon"),s.EFF(3,"delete"),s.k0s()()}2&ne&&s.Y8G("matTooltip",s.bMT(1,1,"igo.context.contextManager.delete"))}function $o(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"div",9),s.DNE(1,tn,4,4,"button",10),s.j41(2,"div",11,0),s.DNE(4,Xo,4,4,"button",12)(5,mn,4,4,"button",13)(6,Po,4,4,"button",14)(7,yo,4,4,"button",15)(8,so,4,4,"button",15)(9,At,4,3,"button",16),s.k0s(),s.j41(10,"button",17),s.bIt("click",function(){s.eBV(C);const q=s.XpG();return s.Njj(q.collapsed=!q.collapsed)}),s.j41(11,"mat-icon"),s.EFF(12,"more_horiz"),s.k0s()()()}if(2&ne){const C=s.sdS(3),K=s.XpG();s.R7$(),s.Y8G("ngIf",K.collapsed&&K.selected&&(K.context.permission===K.typePermission[K.typePermission.write]||K.context.imported)),s.R7$(3),s.Y8G("ngIf",K.canShare&&!K.context.imported),s.R7$(),s.Y8G("ngIf",!K.context.imported),s.R7$(),s.Y8G("ngIf",K.context.permission===K.typePermission[K.typePermission.write]&&!K.context.imported),s.R7$(),s.Y8G("ngIf",!K.context.hidden&&!K.context.imported),s.R7$(),s.Y8G("ngIf",K.context.hidden&&!K.context.imported),s.R7$(),s.Y8G("ngIf",K.context.permission===K.typePermission[K.typePermission.write]||K.context.imported),s.R7$(),s.Y8G("color",K.color)("target",C)("collapsed",K.collapsed)}}let on=(()=>{class ne{auth;storageService;typePermission=I;color="primary";collapsed=!0;showFavorite=!0;context;default;selected;edit=new s.bkB;delete=new s.bkB;save=new s.bkB;clone=new s.bkB;hide=new s.bkB;show=new s.bkB;favorite=new s.bkB;managePermissions=new s.bkB;manageTools=new s.bkB;get hidden(){return this.context.hidden}get canShare(){return!0===this.storageService.get("canShare")}constructor(C,K){this.auth=C,this.storageService=K}favoriteClick(C){this.favorite.emit(C)}static \u0275fac=function(K){return new(K||ne)(s.rXU(h.uR),s.rXU(H.n$))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-context-item"]],inputs:{showFavorite:"showFavorite",context:"context",default:"default",selected:"selected"},outputs:{edit:"edit",delete:"delete",save:"save",clone:"clone",hide:"hide",show:"show",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools"},standalone:!0,features:[s.aNF],decls:6,vars:7,consts:[["actions",""],[1,"mat-list-item",3,"ngClass"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","","class","igo-actions-container",4,"ngIf"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"click","matTooltip","color"],[4,"ngIf"],[3,"src",4,"ngIf"],[3,"src"],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["class","save-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],[1,"igo-actions-expand-container"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","clone-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","edit-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","hide-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","delete-button","mat-icon-button","","color","warn","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","igoCollapse","",1,"actions-button",3,"click","color","target","collapsed"],["mat-icon-button","","matTooltipShowDelay","500",1,"save-button",3,"click","matTooltip","color"],["mat-icon-button","","matTooltipShowDelay","500",3,"click","matTooltip","color"],["mat-icon-button","","matTooltipShowDelay","500",1,"clone-button",3,"click","matTooltip","color"],["mat-icon-button","","matTooltipShowDelay","500",1,"edit-button",3,"click","color","matTooltip"],["mat-icon-button","","matTooltipShowDelay","500",1,"hide-button",3,"click","color","matTooltip"],["mat-icon-button","","color","warn","matTooltipShowDelay","500",1,"delete-button",3,"click","matTooltip"]],template:function(K,q){1&K&&(s.j41(0,"mat-list-item",1),s.DNE(1,mt,4,6,"button",2)(2,Ro,4,4,"button",2),s.j41(3,"span",3),s.EFF(4),s.k0s(),s.DNE(5,$o,13,10,"div",4),s.k0s()),2&K&&(s.Y8G("ngClass",s.eq3(5,dn,q.hidden)),s.R7$(),s.Y8G("ngIf",q.auth.authenticated),s.R7$(),s.Y8G("ngIf",!q.auth.authenticated&&q.showFavorite),s.R7$(2),s.JRh(q.context.title),s.R7$(),s.Y8G("ngIf",q.auth.authenticated))},dependencies:[ro.Fg,ro.YE,ro.zi,ro.yE,ro.BJ,M.YU,M.bT,F.Hl,F.iY,Do.WZ,Ft.uc,Ft.oV,ut.m_,ut.An,Uo.Dc,b.Ck,dt.D9],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-actions-container[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   .igo-actions-expand-container[_ngcontent-%COMP%]{display:inline-flex}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   button[matlistitemavatar][_ngcontent-%COMP%]{margin-right:8px}"],changeDetection:0})}return ne})();var vo=r(97024),Ht=r(31034),Io=r(44038),Co=r(28176),Lo=r(56042),Ao=r(14876),ko=r(9114),zt=r(87941);let Ko=(()=>{class ne{dialogRef;title;constructor(C){this.dialogRef=C}static \u0275fac=function(K){return new(K||ne)(s.rXU(zt.CP))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-bookmark-dialog"]],standalone:!0,features:[s.aNF],decls:14,vars:14,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["matInput","","required","","autocomplete","off","maxlength","128",3,"ngModelChange","placeholder","ngModel"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click","disabled"],["mat-button","",3,"click"]],template:function(K,q){1&K&&(s.j41(0,"h1",0),s.EFF(1),s.nI1(2,"translate"),s.k0s(),s.j41(3,"div",1)(4,"mat-form-field")(5,"input",2),s.nI1(6,"translate"),s.mxI("ngModelChange",function(Pe){return s.DH7(q.title,Pe)||(q.title=Pe),Pe}),s.k0s()()(),s.j41(7,"div",3)(8,"button",4),s.bIt("click",function(){return q.dialogRef.close(q.title)}),s.EFF(9),s.nI1(10,"translate"),s.k0s(),s.j41(11,"button",5),s.bIt("click",function(){return q.dialogRef.close(!1)}),s.EFF(12),s.nI1(13,"translate"),s.k0s()()),2&K&&(s.R7$(),s.SpI(" ",s.bMT(2,6,"igo.context.bookmarkButton.dialog.title"),"\n"),s.R7$(4),s.Y8G("placeholder",s.bMT(6,8,"igo.context.bookmarkButton.dialog.placeholder")),s.R50("ngModel",q.title),s.R7$(3),s.Y8G("disabled",!q.title),s.R7$(),s.SpI(" ",s.bMT(10,10,"igo.common.confirmDialog.confirmBtn")," "),s.R7$(3),s.SpI(" ",s.bMT(13,12,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[zt.BI,zt.Yi,o.RG,o.rl,L.fS,L.fg,a.YN,a.me,a.BC,a.YS,a.tU,a.vS,zt.E7,F.Hl,F.$z,b.Ck,dt.D9],encapsulation:2})}return ne})();var oo=function(ne){return ne.always="always",ne.never="never",ne.default="default",ne}(oo||{});function jo(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",19),s.bIt("click",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.clearFilter())}),s.j41(1,"mat-icon"),s.EFF(2,"close"),s.k0s()()}}function Fe(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"mat-form-field",16)(1,"mat-label"),s.EFF(2),s.nI1(3,"translate"),s.k0s(),s.j41(4,"input",17),s.nI1(5,"translate"),s.mxI("ngModelChange",function(q){s.eBV(C);const ve=s.XpG();return s.DH7(ve.term,q)||(ve.term=q),s.Njj(q)}),s.k0s(),s.DNE(6,jo,3,0,"button",18),s.k0s()}if(2&ne){const C=s.XpG();s.R7$(2),s.JRh(s.bMT(3,4,"igo.context.contextManager.filterPlaceHolder")),s.R7$(2),s.Y8G("placeholder",s.bMT(5,6,"igo.context.contextManager.filterPlaceHolder")),s.R50("ngModel",C.term),s.R7$(2),s.Y8G("ngIf",C.term.length)}}function tt(ne,Ke){if(1&ne&&s.nrm(0,"igo-actionbar",20),2&ne){const C=s.XpG();s.Y8G("iconColor",C.color)("store",C.actionStore)("withIcon",!0)("withTitle","overlay"===C.actionbarMode)("horizontal",!1)("mode",C.actionbarMode)}}function Ce(ne,Ke){if(1&ne&&(s.j41(0,"button",21),s.nI1(1,"translate"),s.j41(2,"mat-icon",8),s.EFF(3,"fitler_alt"),s.k0s()()),2&ne){s.XpG();const C=s.sdS(11);s.Y8G("matTooltip",s.bMT(1,2,"igo.context.contextManager.filterUser"))("matMenuTriggerFor",C)}}function Ee(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",12)(1,"mat-checkbox",23),s.bIt("click",function(q){return s.eBV(C),s.Njj(q.stopPropagation())})("change",function(){s.eBV(C);const q=s.XpG().$implicit,ve=s.XpG();return s.Njj(ve.handleToggleCategory(q))}),s.k0s(),s.j41(2,"span"),s.EFF(3),s.k0s()()}if(2&ne){const C=s.XpG().$implicit,K=s.XpG();s.R7$(),s.Y8G("checked",K.getPermission(C).checked)("indeterminate",K.getPermission(C).indeterminate),s.R7$(2),s.JRh(C.title)}}function Re(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",12)(1,"mat-checkbox",13),s.bIt("click",function(q){return s.eBV(C),s.Njj(q.stopPropagation())})("change",function(){const q=s.eBV(C).$implicit,ve=s.XpG(2).$implicit,Pe=s.XpG();return s.Njj(Pe.handleToggleCategory(q,ve))}),s.EFF(2),s.k0s()()}if(2&ne){const C=Ke.$implicit,K=s.XpG(3);s.R7$(),s.Y8G("checked",K.getPermission(C).checked),s.R7$(),s.SpI(" ",C.title," ")}}function ct(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",24)(1,"mat-checkbox",23),s.bIt("click",function(q){return s.eBV(C),s.Njj(q.stopPropagation())})("change",function(){s.eBV(C);const q=s.XpG().$implicit,ve=s.XpG();return s.Njj(ve.handleToggleCategory(q))}),s.k0s(),s.j41(2,"span"),s.EFF(3),s.k0s()(),s.j41(4,"mat-menu",null,2),s.DNE(6,Re,3,2,"button",25),s.k0s()}if(2&ne){const C=s.sdS(5),K=s.XpG().$implicit,q=s.XpG();s.Y8G("matMenuTriggerFor",C),s.R7$(),s.Y8G("checked",q.getPermission(K).checked)("indeterminate",q.getPermission(K).indeterminate),s.R7$(2),s.JRh(K.title),s.R7$(3),s.Y8G("ngForOf",K.childs)}}function no(ne,Ke){if(1&ne&&(s.qex(0),s.DNE(1,Ee,4,3,"button",22)(2,ct,7,5,"ng-template",null,1,s.C5r),s.bVm()),2&ne){const C=Ke.$implicit,K=s.sdS(3);s.R7$(),s.Y8G("ngIf",!C.childs)("ngIfElse",K)}}function gn(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"igo-context-item",29),s.bIt("edit",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.edit.emit(q))})("delete",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.delete.emit(q))})("clone",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.clone.emit(q))})("save",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.save.emit(q))})("hide",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.hideContext(q))})("show",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.showContext(q))})("favorite",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.favorite.emit(q))})("manageTools",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.manageTools.emit(q))})("managePermissions",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.managePermissions.emit(q))})("select",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.select.emit(q))})("unselect",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.unselect.emit(q))}),s.k0s()}if(2&ne){const C=Ke.$implicit,K=s.XpG(3);s.Y8G("selected",K.selectedContext&&K.selectedContext.uri===C.uri)("context",C)("default",C.id&&K.defaultContextId&&K.defaultContextId===C.id)}}function go(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"igo-collapsible",28),s.nI1(1,"translate"),s.bIt("toggle",function(q){s.eBV(C);const ve=s.XpG().$implicit,Pe=s.XpG();return s.Njj(Pe.collapsed[Pe.titleMapping[ve.key]]=q)}),s.DNE(2,gn,1,3,"ng-template",14),s.k0s()}if(2&ne){const C=s.XpG().$implicit,K=s.XpG();s.Y8G("title",s.bMT(1,3,K.titleMapping[C.key]))("collapsed",K.collapsed[K.titleMapping[C.key]]),s.R7$(2),s.Y8G("ngForOf",C.value)}}function oi(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"igo-context-item",30),s.bIt("favorite",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.favorite.emit(q))})("select",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.select.emit(q))})("unselect",function(){const q=s.eBV(C).$implicit,ve=s.XpG(3);return s.Njj(ve.unselect.emit(q))}),s.k0s()}if(2&ne){const C=Ke.$implicit,K=s.XpG(3);s.Y8G("showFavorite",K.configService.getConfig("favoriteContext4NonAuthenticated"))("selected",K.selectedContext&&K.selectedContext.uri===C.uri)("context",C)("default",K.contextConfigs?K.defaultContextId===C.id:K.defaultContextId===C.uri)}}function hn(ne,Ke){if(1&ne&&s.DNE(0,oi,1,4,"ng-template",14),2&ne){const C=s.XpG().$implicit;s.Y8G("ngForOf",C.value)}}function ni(ne,Ke){if(1&ne&&s.DNE(0,go,3,5,"igo-collapsible",26)(1,hn,1,1,null,27),2&ne){const C=Ke.$implicit,K=s.XpG();s.Y8G("ngIf",C.value.length&&K.auth.authenticated),s.R7$(),s.Y8G("ngIf",C.value.length&&!K.auth.authenticated)}}function fn(ne,Ke){1&ne&&(s.j41(0,"div",31),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.contextManager.noResult")," "))}let Te=(()=>{class ne{cdRef;configService;auth;dialog;languageService;storageService;contextConfigs;contextsInitial={ours:[]};contexts$=new _.t(this.contextsInitial);change$=new Lo.m(1);change$$;get contexts(){return this._contexts}set contexts(C){this._contexts=C,this.next()}_contexts={ours:[]};selectedContext;map;get defaultContextId(){return this.contextConfigs?this._defaultContextId:this.storageService.get("favorite.context.uri")||this._defaultContextId}set defaultContextId(C){this._defaultContextId=C}_defaultContextId;collapsed=[];select=new s.bkB;unselect=new s.bkB;edit=new s.bkB;delete=new s.bkB;save=new s.bkB;clone=new s.bkB;create=new s.bkB;hide=new s.bkB;show=new s.bkB;showHiddenContexts=new s.bkB;favorite=new s.bkB;managePermissions=new s.bkB;manageTools=new s.bkB;filterPermissionsChanged=new s.bkB;titleMapping={ours:"igo.context.contextManager.ourContexts",shared:"igo.context.contextManager.sharedContexts",public:"igo.context.contextManager.publicContexts"};users;permissions=[];actionStore=new Io.uw([]);actionbarMode=Io.rS.Overlay;color="primary";showHidden=!1;set term(C){this._term=C,this.next()}get term(){return this._term}_term="";get sortedAlpha(){return this._sortedAlpha}set sortedAlpha(C){this._sortedAlpha=C,this.next()}_sortedAlpha=void 0;showContextFilter=oo.always;thresholdToFilter=5;get isEmpty(){return!this.contexts.ours.length&&!this.contexts.public?.length&&!this.contexts.shared?.length}constructor(C,K,q,ve,Pe,Ne){this.cdRef=C,this.configService=K,this.auth=q,this.dialog=ve,this.languageService=Pe,this.storageService=Ne,this.contextConfigs=this.configService.getConfig("context")}ngOnInit(){this.change$$=this.change$.pipe((0,ko.s)(()=>(0,Ao.O)(50))).subscribe(()=>{this.contexts$.next(this.filterContextsList(this.contexts))}),this.actionStore.load([{id:"emptyContext",title:this.languageService.translate.instant("igo.context.contextManager.emptyContext"),icon:"star",tooltip:this.languageService.translate.instant("igo.context.contextManager.emptyContextTooltip"),handler:()=>{this.createContext(!0)}},{id:"contextFromMap",title:this.languageService.translate.instant("igo.context.contextManager.contextMap"),icon:"map",tooltip:this.languageService.translate.instant("igo.context.contextManager.contextMapTooltip"),handler:()=>{this.createContext(!1)}}])}next(){this.change$.next()}filterContextsList(C){if(""===this.term)return this.sortedAlpha&&(C=this.sortContextsList(C)),C;{let q={ours:C.ours.filter(ve=>{const Pe=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return ve.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Pe)})};if(this.contexts.public){const ve=C.public.filter(Pe=>{const Ne=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Pe.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Ne)});q.public=ve}if(this.contexts.shared){const ve=C.shared.filter(Pe=>{const Ne=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Pe.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Ne)});q.shared=ve}return this.sortedAlpha&&(q=this.sortContextsList(q)),q}}ngOnDestroy(){this.change$$.unsubscribe()}showFilter(){switch(this.showContextFilter){case oo.always:return!0;case oo.never:return!1;default:let C=this.contexts.ours.length;return C+=this.contexts.public?this.contexts.public.length:0,C+=this.contexts.shared?this.contexts.shared.length:0,C>=this.thresholdToFilter}}sortContextsList(C){if(C){const K=JSON.parse(JSON.stringify(C));return K.ours.sort((q,ve)=>this.normalize(q.title)<this.normalize(ve.title)?-1:this.normalize(q.title)>this.normalize(ve.title)?1:0),K.shared?K.shared.sort((q,ve)=>this.normalize(q.title)<this.normalize(ve.title)?-1:this.normalize(q.title)>this.normalize(ve.title)?1:0):K.public&&K.public.sort((q,ve)=>this.normalize(q.title)<this.normalize(ve.title)?-1:this.normalize(q.title)>this.normalize(ve.title)?1:0),K}}normalize(C){return C.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}toggleSort(){this.sortedAlpha=!this.sortedAlpha}clearFilter(){this.term=""}createContext(C){this.dialog.open(Ko,{disableClose:!1}).afterClosed().pipe((0,D.s)(1)).subscribe(K=>{K&&this.create.emit({title:K,empty:C})})}getPermission(C){if(C)return this.permissions.find(q=>q.name===C.name)}handleToggleCategory(C,K){const q=this.getPermission(C);if(q&&(q.checked=!q.checked,this.storageService.set("contexts.permissions."+q.name,q.checked),q.indeterminate=!1),K){let ve=!1;for(const Ne of K.childs)if(this.getPermission(Ne).checked!==q.checked){ve=!0;break}const Pe=this.getPermission(K);Pe&&(Pe.checked=q.checked,this.storageService.set("contexts.permissions."+Pe.name,q.checked),Pe.indeterminate=ve)}if(C.childs)for(const ve of C.childs){const Pe=this.getPermission(ve);Pe&&Pe.checked!==q.checked&&(Pe.checked=q.checked,this.storageService.set("contexts.permissions."+Pe.name,q.checked))}this.filterPermissionsChanged.emit(this.permissions)}hideContext(C){if(C.hidden=!0,!this.showHidden){const K={ours:[],shared:[],public:[]};K.ours=this.contexts.ours.filter(q=>q.id!==C.id),K.shared=this.contexts.shared.filter(q=>q.id!==C.id),K.public=this.contexts.public.filter(q=>q.id!==C.id),this.contexts=K}this.hide.emit(C)}showContext(C){C.hidden=!1,this.show.emit(C)}static \u0275fac=function(K){return new(K||ne)(s.rXU(s.gRc),s.rXU(y.we),s.rXU(h.uR),s.rXU(zt.bZ),s.rXU(b.gw),s.rXU(H.n$))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-context-list"]],inputs:{contexts:"contexts",selectedContext:"selectedContext",map:"map",defaultContextId:"defaultContextId",term:"term"},outputs:{select:"select",unselect:"unselect",edit:"edit",delete:"delete",save:"save",clone:"clone",create:"create",hide:"hide",show:"show",showHiddenContexts:"showHiddenContexts",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools",filterPermissionsChanged:"filterPermissionsChanged"},standalone:!0,features:[s.aNF],decls:22,vars:20,consts:[["accountMenu","matMenu"],["withSubMenu",""],["subAccountMenu","matMenu"],[3,"navigation"],[1,"context-filter-container"],["floatLabel","always",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"click","matTooltip"],["color","primary"],["class","add-context-button","icon","add",3,"iconColor","store","withIcon","withTitle","horizontal","mode",4,"ngIf"],["class","users-filter","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"profil-menu"],[3,"click","change","checked"],["ngFor","",3,"ngForOf"],["class","no-result",4,"ngIf"],["floatLabel","always"],["matInput","","type","text",3,"ngModelChange","placeholder","ngModel"],["mat-icon-button","","matSuffix","","class","clear-button","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","","aria-label","Clear","color","warn",1,"clear-button",3,"click"],["icon","add",1,"add-context-button",3,"iconColor","store","withIcon","withTitle","horizontal","mode"],["mat-icon-button","","matTooltipShowDelay","500",1,"users-filter",3,"matTooltip","matMenuTriggerFor"],["mat-menu-item","","class","profil-menu",4,"ngIf","ngIfElse"],[3,"click","change","checked","indeterminate"],["mat-menu-item","",1,"profil-menu",3,"matMenuTriggerFor"],["mat-menu-item","","class","profil-menu",4,"ngFor","ngForOf"],[3,"title","collapsed","toggle",4,"ngIf"],[4,"ngIf"],[3,"toggle","title","collapsed"],["igoListItem","","color","accent",3,"edit","delete","clone","save","hide","show","favorite","manageTools","managePermissions","select","unselect","selected","context","default"],["igoListItem","","color","accent",3,"favorite","select","unselect","showFavorite","selected","context","default"],[1,"no-result"]],template:function(K,q){if(1&K){const ve=s.RV6();s.j41(0,"igo-list",3)(1,"div",4),s.DNE(2,Fe,7,8,"mat-form-field",5),s.j41(3,"div",6)(4,"button",7),s.nI1(5,"translate"),s.bIt("click",function(){return s.eBV(ve),s.Njj(q.toggleSort())}),s.j41(6,"mat-icon",8),s.EFF(7,"sort_by_alpha"),s.k0s()(),s.DNE(8,tt,1,6,"igo-actionbar",9)(9,Ce,4,4,"button",10),s.j41(10,"mat-menu",null,0),s.DNE(12,no,4,2,"ng-container",11),s.j41(13,"button",12)(14,"mat-checkbox",13),s.bIt("click",function(Ne){return s.eBV(ve),s.Njj(Ne.stopPropagation())})("change",function(){return s.eBV(ve),s.Njj(q.showHiddenContexts.emit())}),s.k0s(),s.j41(15,"span"),s.EFF(16),s.nI1(17,"translate"),s.k0s()()()()(),s.DNE(18,ni,2,2,"ng-template",14),s.nI1(19,"async"),s.nI1(20,"keyvalue"),s.DNE(21,fn,3,3,"div",15),s.k0s()}2&K&&(s.Y8G("navigation",!0),s.R7$(2),s.Y8G("ngIf",q.showFilter()),s.R7$(2),s.AVh("--active",q.sortedAlpha),s.Y8G("matTooltip",s.bMT(5,12,"igo.context.contextManager.sortAlphabetically")),s.R7$(4),s.Y8G("ngIf",q.auth.authenticated&&q.contextConfigs),s.R7$(),s.Y8G("ngIf",q.auth.authenticated&&q.contextConfigs),s.R7$(3),s.Y8G("ngForOf",q.users),s.R7$(2),s.Y8G("checked",q.showHidden),s.R7$(2),s.SpI(" ",s.bMT(17,14,"igo.context.contextManager.showHidden")," "),s.R7$(2),s.Y8G("ngForOf",s.bMT(20,18,s.bMT(19,16,q.contexts$))),s.R7$(3),s.Y8G("ngIf",q.isEmpty))},dependencies:[Co.sB,M.bT,o.RG,o.rl,o.nJ,o.yw,L.fS,L.fg,a.YN,a.me,a.BC,a.vS,F.Hl,F.iY,ut.m_,ut.An,Ft.uc,Ft.oV,Io.Vn,Ht.Cn,Ht.kk,Ht.fb,Ht.Cp,M.pM,vo.g7,vo.So,Uo.g2,on,Co.dF,M.Jj,M.lG,b.Ck,dt.D9],styles:["[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.context-filter-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 4px}.context-filter-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.sort-alpha.--active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:red}.context-filter-min-width[_ngcontent-%COMP%]{width:calc(100% - 135px);margin:5px;padding-left:6px}.profil-menu[_ngcontent-%COMP%]{padding-left:8px}.profil-menu[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:8px}.add-context-button[_ngcontent-%COMP%]{margin:0;width:40px;display:inline-flex;overflow:hidden}.actions-container[_ngcontent-%COMP%]{margin-left:4px}.no-result[_ngcontent-%COMP%]{padding:16px}"],changeDetection:0})}return ne})();var pe=r(79771),te=r(53804);function se(ne,Ke){1&ne&&(s.j41(0,"div",4)(1,"h4"),s.EFF(2),s.nI1(3,"translate"),s.k0s(),s.j41(4,"p"),s.EFF(5),s.nI1(6,"translate"),s.k0s()()),2&ne&&(s.R7$(2),s.JRh(s.bMT(3,2,"igo.context.permission.readOnlyTitle")),s.R7$(3),s.JRh(s.bMT(6,4,"igo.context.permission.readOnlyMsg")))}function ge(ne,Ke){1&ne&&(s.j41(0,"mat-radio-button",9),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.permission.scope.public")," "))}function xe(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"div",4)(1,"mat-radio-group",5),s.mxI("ngModelChange",function(q){s.eBV(C);const ve=s.XpG(2);return s.DH7(ve.context.scope,q)||(ve.context.scope=q),s.Njj(q)}),s.bIt("change",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.scopeChanged.emit(q.context))}),s.j41(2,"mat-radio-button",6),s.EFF(3),s.nI1(4,"translate"),s.k0s(),s.j41(5,"mat-radio-button",7),s.EFF(6),s.nI1(7,"translate"),s.k0s(),s.DNE(8,ge,3,3,"mat-radio-button",8),s.k0s()()}if(2&ne){const C=s.XpG(2);s.R7$(),s.R50("ngModel",C.context.scope),s.R7$(2),s.SpI(" ",s.bMT(4,4,"igo.context.permission.scope.private")," "),s.R7$(3),s.SpI(" ",s.bMT(7,6,"igo.context.permission.scope.shared")," "),s.R7$(2),s.Y8G("ngIf",C.authService.isAdmin)}}function He(ne,Ke){if(1&ne&&(s.j41(0,"mat-option",20),s.EFF(1),s.nrm(2,"br"),s.j41(3,"small",21),s.EFF(4),s.k0s()()),2&ne){const C=Ke.$implicit;s.Y8G("value",C),s.R7$(),s.SpI(" ",C.title,""),s.R7$(3),s.JRh(C.name)}}function ot(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"form",10),s.bIt("ngSubmit",function(){s.eBV(C);const q=s.XpG(2);return s.Njj(q.handleFormSubmit(q.form.value))}),s.j41(1,"mat-form-field",11),s.nrm(2,"input",12),s.nI1(3,"translate"),s.j41(4,"mat-autocomplete",13,0),s.bIt("optionSelected",function(q){s.eBV(C);const ve=s.XpG(2);return s.Njj(ve.onProfilSelected(q.option.value))}),s.DNE(6,He,5,3,"mat-option",14),s.k0s(),s.j41(7,"mat-error"),s.EFF(8),s.nI1(9,"translate"),s.k0s()(),s.j41(10,"mat-radio-group",15)(11,"mat-radio-button",16),s.EFF(12),s.nI1(13,"translate"),s.k0s(),s.j41(14,"mat-radio-button",17),s.EFF(15),s.nI1(16,"translate"),s.k0s()(),s.j41(17,"div",18)(18,"button",19),s.EFF(19),s.nI1(20,"translate"),s.k0s()()()}if(2&ne){const C=s.sdS(5),K=s.XpG(2);s.Y8G("formGroup",K.form),s.R7$(2),s.Y8G("placeholder",s.bMT(3,11,"igo.context.permission.user"))("formControl",K.formControl)("matAutocomplete",C),s.R7$(2),s.Y8G("displayWith",K.displayFn),s.R7$(2),s.Y8G("ngForOf",K.profils),s.R7$(2),s.SpI(" ",s.bMT(9,13,"igo.context.permission.profilRequired")," "),s.R7$(4),s.SpI(" ",s.bMT(13,15,"igo.context.permission.read")," "),s.R7$(3),s.SpI(" ",s.bMT(16,17,"igo.context.permission.write")," "),s.R7$(3),s.Y8G("disabled",!K.form.valid),s.R7$(),s.SpI(" ",s.bMT(20,19,"igo.context.permission.addBtn")," ")}}function Gt(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",29),s.nI1(1,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.XpG().$implicit,ve=s.XpG(5);return s.Njj(ve.removePermission.emit(q))}),s.j41(2,"mat-icon"),s.EFF(3,"delete"),s.k0s()()}2&ne&&s.Y8G("matTooltip",s.bMT(1,1,"igo.context.permission.delete"))}function Rt(ne,Ke){if(1&ne&&(s.j41(0,"mat-list-item")(1,"mat-icon",25),s.EFF(2,"person"),s.k0s(),s.j41(3,"h4",26),s.EFF(4),s.j41(5,"small",21),s.EFF(6),s.k0s()(),s.j41(7,"div",27),s.DNE(8,Gt,4,3,"button",28),s.k0s()()),2&ne){const C=Ke.$implicit,K=s.XpG(5);s.R7$(4),s.SpI(" ",C.profilTitle," "),s.R7$(2),s.JRh(C.profil),s.R7$(2),s.Y8G("ngIf",K.canWrite||C.profil===K.authService.decodeToken().user.sourceId)}}function Jt(ne,Ke){if(1&ne&&(s.j41(0,"igo-collapsible",24),s.nI1(1,"translate"),s.DNE(2,Rt,9,3,"ng-template",22),s.k0s()),2&ne){const C=s.XpG().$implicit;s.Y8G("title",s.bMT(1,2,"igo.context.permission."+C.key)),s.R7$(2),s.Y8G("ngForOf",C.value)}}function ho(ne,Ke){1&ne&&s.DNE(0,Jt,3,4,"igo-collapsible",23),2&ne&&s.Y8G("ngIf",Ke.$implicit.value.length)}function _n(ne,Ke){if(1&ne&&(s.j41(0,"igo-list"),s.DNE(1,ho,1,1,"ng-template",22),s.nI1(2,"keyvalue"),s.k0s()),2&ne){const C=s.XpG(2);s.R7$(),s.Y8G("ngForOf",s.bMT(2,1,C.permissions))}}function Rn(ne,Ke){if(1&ne&&(s.j41(0,"div"),s.DNE(1,se,7,6,"div",2)(2,xe,9,8,"div",2)(3,ot,21,21,"form",3)(4,_n,3,3,"igo-list",1),s.k0s()),2&ne){const C=s.XpG();s.R7$(),s.Y8G("ngIf",!C.canWrite),s.R7$(),s.Y8G("ngIf",C.canWrite),s.R7$(),s.Y8G("ngIf","private"!==C.context.scope&&C.canWrite),s.R7$(),s.Y8G("ngIf",C.permissions&&"private"!==C.context.scope)}}let bo=(()=>{class ne{formBuilder;cd;http;authService;config;form;get context(){return this._context}set context(C){this._context=C,this.cd.detectChanges()}_context;get permissions(){return this._permissions}set permissions(C){this._permissions=C,this.cd.detectChanges()}_permissions;get profils(){return this._profils}set profils(C){this._profils=C,this.cd.detectChanges()}_profils=[];get canWrite(){return this.context.permission===I[I.write]}baseUrlProfils;formControl=new a.hs;formValueChanges$$;addPermission=new s.bkB;removePermission=new s.bkB;scopeChanged=new s.bkB;constructor(C,K,q,ve,Pe){this.formBuilder=C,this.cd=K,this.http=q,this.authService=ve,this.config=Pe}ngOnInit(){this.buildForm(),this.baseUrlProfils=this.config.getConfig("context.url")+"/profils-users?",this.formValueChanges$$=this.formControl.valueChanges.subscribe(C=>{C.length?(this.http.get(this.baseUrlProfils+"q="+C).subscribe(K=>{this.profils=K}),this.profils.filter(K=>{const q=C.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),ve=K.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return(K.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")+ve).includes(q)})):this.profils=[]})}displayFn(C){return C?C.title:void 0}handleFormSubmit(C){this.addPermission.emit(C)}buildForm(){this.form=this.formBuilder.group({profil:[],typePermission:["read"]})}onProfilSelected(C){this.form.setValue({profil:C.name,typePermission:this.form.value.typePermission})}static \u0275fac=function(K){return new(K||ne)(s.rXU(a.ze),s.rXU(s.gRc),s.rXU(z.Qq),s.rXU(h.uR),s.rXU(y.we))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-context-permissions"]],inputs:{context:"context",permissions:"permissions"},outputs:{addPermission:"addPermission",removePermission:"removePermission",scopeChanged:"scopeChanged"},standalone:!0,features:[s.aNF],decls:1,vars:1,consts:[["auto","matAutocomplete"],[4,"ngIf"],["class","scopeForm",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"scopeForm"],[3,"ngModelChange","change","ngModel"],["value","private"],["value","protected"],["value","public",4,"ngIf"],["value","public"],[3,"ngSubmit","formGroup"],[1,"full-width"],["matInput","","required","",3,"placeholder","formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["formControlName","typePermission"],["value","read"],["value","write"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[3,"value"],[1,"mat-typography"],["ngFor","",3,"ngForOf"],[3,"title",4,"ngIf"],[3,"title"],["matListItemIcon",""],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"click","matTooltip"]],template:function(K,q){1&K&&s.DNE(0,Rn,5,4,"div",1),2&K&&s.Y8G("ngIf",q.context)},dependencies:[M.bT,te.Wk,te.VT,te._g,a.YN,a.qT,a.me,a.BC,a.cb,a.YS,a.vS,a.X1,a.l_,a.j4,a.JD,o.RG,o.rl,o.TL,L.fS,L.fg,pe.jL,pe.$3,e.wT,pe.pN,M.pM,e.Sy,F.Hl,F.$z,F.iY,Co.sB,Uo.g2,ro.Fg,ro.YE,ro.ZV,ro.yE,ro.BJ,ut.m_,ut.An,Do.WZ,Ft.uc,Ft.oV,M.lG,b.Ck,dt.D9],styles:["[_nghost-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}mat-radio-button[_ngcontent-%COMP%]{padding:14px 14px 14px 0}.scopeForm[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{padding:5px}"]})}return ne})();var Ln=r(28793);r(75736),r(63886),r(59400),r(47172);let xi=(()=>{class ne{contextService;route;language="";constructor(C,K){this.contextService=C,this.route=K,this.route.queryParams.subscribe(q=>{q.lang&&(this.language=q.lang)})}getUrlWithApi(C){return this.language?`${location.origin+location.pathname}?context=${C.uri}&lang=${this.language}`:`${location.origin+location.pathname}?context=${C.uri}`}createContextShared(C,K){const q=this.contextService.getContextFromMap(C);return q.scope="public",q.title=K.title,q.uri=K.uri,this.contextService.create(q)}updateContextShared(C,K,q){const ve=this.contextService.getContextFromMap(C);return this.contextService.update(q,{title:K.title,map:ve.map})}getUrlWithoutApi(C,K){if(!(this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&C.viewController.getZoom()))return;const q=K.layerlistControls.querystring;let ve=this.route.options.visibleOnLayersKey,Pe=this.route.options.visibleOffLayersKey;const Ne=C.layers,st=Ne.filter(Wt=>Wt.visible&&!Wt.isIgoInternalLayer),ht=Ne.filter(Wt=>!Wt.visible&&!Wt.isIgoInternalLayer);0===st.length&&(ve=""),0===ht.length&&(Pe="");let Ze="",_t=[];st.length>ht.length?(Ze=`${ve}=*&${Pe}=`,_t=ht):(Ze=`${Pe}=*&${ve}=`,_t=st);for(const Wt of _t)Wt.id&&(Ze+=Wt.id+",");const ft=[],Zt=this.contextService.context$.value.layers;for(const Wt of Zt)(typeof Wt.id<"u"||typeof Wt.source<"u")&&ft.push(Wt.id||Wt.source.id);const Nt=this.makeLayersByService(Ne,ft,"wms"),xo=this.makeLayersByService(Ne,ft,"wmts"),Vn=this.makeLayersByService(Ne,ft,"arcgisrest"),wt=this.makeLayersByService(Ne,ft,"imagearcgisrest"),pt=this.makeLayersByService(Ne,ft,"tilearcgisrest");Ze=Ze.substr(0,Ze.length-1);const Wi=this.route.options.centerKey,fo=this.route.options.contextKey,eo=`${this.route.options.zoomKey}=${C.viewController.getZoom()}`,Un=C.viewController.getCenter("EPSG:4326")||[],ui=`${Wi}=${Un[0].toFixed(5).replace(/\.([^0]+)0+$/,".$1")},${Un[1].toFixed(5).replace(/\.([^0]+)0+$/,".$1")}`.replace(/.00000/g,"");let Nn="";this.contextService.context$.value&&(Nn=`${fo}=${this.contextService.context$.value.uri}`);let Vt=this.language?`${location.origin}${location.pathname}?${Nn}&${eo}&${ui}&${Ze}&${q}&${Nt}&${q}&${xo}&${Vn}&${wt}&${pt}&lang=${this.language}`:`${location.origin}${location.pathname}?${Nn}&${eo}&${ui}&${Ze}&${q}&${Nt}&${q}&${xo}&${Vn}&${wt}&${pt}`;for(let Wt=0;Wt<5;Wt++)Vt=Vt.replace(/&&/g,"&"),Vt=Vt.endsWith("&")?Vt.slice(0,-1):Vt;return Vt=Vt.endsWith("&")?Vt.slice(0,-1):Vt,Vt=Vt.replace("?&wm","&wm"),Vt=Vt.replace("?&","?"),Vt}makeLayersByService(C,K,q){const ve=[];for(const Ne of C.filter(st=>st.dataSource.options?.type===q))if(-1===K.indexOf(Ne.id)){let Ze,st=encodeURIComponent(Ne.dataSource.options.url),ht="";switch(Ne.dataSource.options.type.toLowerCase()){case"wms":const Zt=Ne.dataSource.options;ht=encodeURIComponent(Zt.params.LAYERS),Ze="1.3.0"===Zt.params.VERSION?Ze:Zt.params.VERSION;break;case"wmts":case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":ht=encodeURIComponent(Ne.dataSource.options.layer)}const _t=`${ht}:igoz${Ne.zIndex}`;let ft="";if(Ze){const Zt=-1===Ne.dataSource.options.url.indexOf("?")?"?":"&";ft=encodeURIComponent(`${Zt}VERSION=${Ze}`)}st=`${st}${ft}`,ve.find(Zt=>Zt.url===st)?ve.forEach(Zt=>{Zt.url===st&&Zt.layers.push(_t)}):ve.push({url:st,layers:[_t]})}let Pe="";if(ve.length>=1){let Ne,st;switch(q.toLowerCase()){case"wms":Ne=this.route.options.wmsUrlKey,st=this.route.options.wmsLayersKey;break;case"wmts":Ne=this.route.options.wmtsUrlKey,st=this.route.options.wmtsLayersKey;break;case"arcgisrest":Ne=this.route.options.arcgisUrlKey,st=this.route.options.arcgisLayersKey;break;case"imagearcgisrest":Ne=this.route.options.iarcgisUrlKey,st=this.route.options.iarcgisLayersKey;break;case"tilearcgisrest":Ne=this.route.options.tarcgisUrlKey,st=this.route.options.tarcgisLayersKey;break;default:Ne="",st=""}let ht="",Ze="";ve.forEach(_t=>{ht+=`${_t.url},`,Ze+=`(${_t.layers.join(",")}),`}),ht=ht.endsWith(",")?ht.slice(0,-1):ht,Ze=Ze.endsWith(",")?Ze.slice(0,-1):Ze,Pe=`${Ne}=${ht}&${st}=${Ze}`}return Pe}static \u0275fac=function(K){return new(K||ne)(s.KVO(Q),s.KVO(X.v$,8))};static \u0275prov=s.jDH({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();function vn(ne,Ke){if(1&ne&&(s.j41(0,"span",12),s.EFF(1),s.k0s()),2&ne){const C=s.XpG();s.R7$(),s.SpI("",C.userId,"-")}}function Ho(ne,Ke){if(1&ne&&(s.j41(0,"button",13),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne){const C=s.XpG();s.Y8G("disabled",!C.form.valid),s.R7$(),s.SpI(" ",s.bMT(2,2,"igo.context.shareMap.button")," ")}}function bn(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"button",14),s.bIt("click",function(){s.eBV(C);const q=s.XpG();return s.Njj(q.updateContextShared(q.form.value))}),s.EFF(1),s.nI1(2,"translate"),s.k0s()}2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.refreshBtn")," "))}function Mo(ne,Ke){if(1&ne){const C=s.RV6();s.j41(0,"div",15)(1,"mat-form-field"),s.nrm(2,"textarea",16,0),s.nI1(4,"translate"),s.j41(5,"button",17),s.nI1(6,"translate"),s.bIt("click",function(){s.eBV(C);const q=s.sdS(3),ve=s.XpG();return s.Njj(ve.copyTextToClipboard(q))}),s.j41(7,"mat-icon"),s.EFF(8,"content_copy"),s.k0s()()(),s.nrm(9,"div"),s.k0s()}if(2&ne){const C=s.XpG();s.R7$(2),s.Y8G("placeholder",s.bMT(4,3,"igo.context.shareMap.placeholderLink"))("value",C.url),s.R7$(3),s.Y8G("matTooltip",s.bMT(6,5,"igo.context.shareMap.copy"))}}let nn=(()=>{class ne{languageService;messageService;auth;shareMapService;formBuilder;form;map;url;userId;idContextShared;constructor(C,K,q,ve,Pe){this.languageService=C,this.messageService=K,this.auth=q,this.shareMapService=ve,this.formBuilder=Pe}ngOnInit(){this.auth.authenticate$.subscribe(C=>{const K=this.auth.decodeToken();this.userId=K?.user?.id.toString(),this.buildForm()})}createUrl(C={}){const K=Object.assign({},C);K.uri=this.userId?`${this.userId}-${C.uri}`:C.uri,this.url=this.shareMapService.getUrlWithApi(K),this.shareMapService.createContextShared(this.map,K).subscribe(q=>{this.idContextShared=q.id,this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:K.title})},q=>{q.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(q)})}updateContextShared(C={}){const K=Object.assign({},C);K.uri=this.userId?`${this.userId}-${C.uri}`:C.uri,this.shareMapService.updateContextShared(this.map,K,this.idContextShared).subscribe(q=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:K.title})},q=>{q.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(q)})}copyTextToClipboard(C){ee.B0.copy(C)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}buildForm(){this.url=void 0;const C=(0,ee.uR)();let K="Partage ";K+=this.userId?`(${this.userId}-${C})`:`(${C})`,this.form=this.formBuilder.group({title:[K],uri:[C]})}static \u0275fac=function(K){return new(K||ne)(s.rXU(b.gw),s.rXU(k.bg),s.rXU(h.uR),s.rXU(xi),s.rXU(a.ze))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-share-map-api"]],inputs:{map:"map"},standalone:!0,features:[s.aNF],decls:21,vars:18,consts:[["textArea",""],[1,"igo-form",3,"ngSubmit","formGroup"],[1,"igo-input-container"],["matInput","","required","","formControlName","title",3,"placeholder"],["id","uriInput",1,"igo-input-container"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","required","","formControlName","uri",3,"readonly","placeholder"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled",4,"ngIf"],["mat-raised-button","","type","button",3,"click",4,"ngIf"],["class","igo-input-container linkToShare",4,"ngIf"],[1,"prefix"],["mat-raised-button","","type","submit",3,"disabled"],["mat-raised-button","","type","button",3,"click"],[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",1,"textAreaWithButton",3,"placeholder","value"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"click","matTooltip"]],template:function(K,q){1&K&&(s.j41(0,"form",1),s.bIt("ngSubmit",function(){return q.createUrl(q.form.value)}),s.j41(1,"div",2)(2,"mat-form-field"),s.nrm(3,"input",3),s.nI1(4,"translate"),s.j41(5,"mat-error"),s.EFF(6),s.nI1(7,"translate"),s.k0s()()(),s.j41(8,"div",4)(9,"mat-form-field"),s.DNE(10,vn,2,1,"span",5),s.j41(11,"span",6),s.nrm(12,"input",7),s.nI1(13,"translate"),s.k0s(),s.j41(14,"mat-error"),s.EFF(15),s.nI1(16,"translate"),s.k0s()()(),s.j41(17,"div",8),s.DNE(18,Ho,3,4,"button",9)(19,bn,3,3,"button",10),s.k0s()(),s.DNE(20,Mo,10,7,"div",11)),2&K&&(s.Y8G("formGroup",q.form),s.R7$(3),s.Y8G("placeholder",s.bMT(4,10,"igo.context.contextManager.form.title")),s.R7$(3),s.SpI(" ",s.bMT(7,12,"igo.context.contextManager.form.titleRequired")," "),s.R7$(4),s.Y8G("ngIf",q.userId),s.R7$(2),s.Y8G("readonly",!q.userId)("placeholder",s.bMT(13,14,"igo.context.contextManager.form.uri")),s.R7$(3),s.SpI(" ",s.bMT(16,16,"igo.context.contextManager.form.uriRequired")," "),s.R7$(3),s.Y8G("ngIf",!q.url),s.R7$(),s.Y8G("ngIf",q.url),s.R7$(),s.Y8G("ngIf",q.url))},dependencies:[a.YN,a.qT,a.me,a.BC,a.cb,a.YS,a.X1,a.j4,a.JD,o.RG,o.rl,o.TL,L.fS,L.fg,M.bT,F.Hl,F.$z,F.iY,Ft.uc,Ft.oV,ut.m_,ut.An,b.Ck,dt.D9],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form[_ngcontent-%COMP%]{padding:20px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}']})}return ne})();var Cn=r(19816),rn=r(19999);function zo(ne,Ke){1&ne&&(s.j41(0,"h4"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.included")," "))}function Oi(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.context")," "))}function wi(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.center")," "))}function Ei(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.zoom")," "))}function Di(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.addedLayers")," "))}function Ri(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.visibleInvisible")," "))}function Pi(ne,Ke){1&ne&&(s.j41(0,"h4"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.excluded")," "))}function Kt(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.order")," "))}function $i(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.opacity")," "))}function Li(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.filterOgc")," "))}function Ai(ne,Ke){1&ne&&(s.j41(0,"li"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&ne&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"igo.context.shareMap.filterTime")," "))}function ki(ne,Ke){1&ne&&(s.j41(0,"div"),s.DNE(1,zo,3,3,"h4",6),s.nI1(2,"translate"),s.j41(3,"ul"),s.DNE(4,Oi,3,3,"li",6),s.nI1(5,"translate"),s.DNE(6,wi,3,3,"li",6),s.nI1(7,"translate"),s.DNE(8,Ei,3,3,"li",6),s.nI1(9,"translate"),s.DNE(10,Di,3,3,"li",6),s.nI1(11,"translate"),s.DNE(12,Ri,3,3,"li",6),s.nI1(13,"translate"),s.k0s(),s.DNE(14,Pi,3,3,"h4",6),s.nI1(15,"translate"),s.j41(16,"ul"),s.DNE(17,Kt,3,3,"li",6),s.nI1(18,"translate"),s.DNE(19,$i,3,3,"li",6),s.nI1(20,"translate"),s.DNE(21,Li,3,3,"li",6),s.nI1(22,"translate"),s.DNE(23,Ai,3,3,"li",6),s.nI1(24,"translate"),s.k0s()()),2&ne&&(s.R7$(),s.Y8G("ngIf",""!==s.bMT(2,11,"igo.context.shareMap.included")),s.R7$(3),s.Y8G("ngIf",""!==s.bMT(5,13,"igo.context.shareMap.context")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(7,15,"igo.context.shareMap.center")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(9,17,"igo.context.shareMap.zoom")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(11,19,"igo.context.shareMap.addedLayers")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(13,21,"igo.context.shareMap.visibleInvisible")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(15,23,"igo.context.shareMap.excluded")),s.R7$(3),s.Y8G("ngIf",""!==s.bMT(18,25,"igo.context.shareMap.order")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(20,27,"igo.context.shareMap.opacity")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(22,29,"igo.context.shareMap.filterOgc")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(24,31,"igo.context.shareMap.filterTime")))}function kn(ne,Ke){1&ne&&(s.nrm(0,"igo-custom-html",8),s.nI1(1,"translate")),2&ne&&s.Y8G("html",s.bMT(1,1,"igo.context.shareMap.htmlClarifications"))}let ri=(()=>{class ne{messageService;shareMapService;cdRef;mapState$$;map;url;publicShareOption={layerlistControls:{querystring:""}};constructor(C,K,q){this.messageService=C,this.shareMapService=K,this.cdRef=q}ngOnInit(){this.resetUrl(),this.mapState$$=(0,rn.z)([this.map.viewController.state$,this.map.status$]).subscribe(C=>{this.resetUrl(),this.cdRef.detectChanges()})}ngAfterViewInit(){this.resetUrl()}ngOnDestroy(){this.mapState$$.unsubscribe()}resetUrl(C={}){this.url=this.shareMapService.getUrlWithoutApi(this.map,this.publicShareOption)}copyTextToClipboard(C){ee.B0.copy(C)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}static \u0275fac=function(K){return new(K||ne)(s.rXU(k.bg),s.rXU(xi),s.rXU(s.gRc))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-share-map-url"]],inputs:{map:"map"},standalone:!0,features:[s.aNF],decls:18,vars:13,consts:[["textArea",""],[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",3,"placeholder","value"],[1,"igo-form-button-group"],["mat-raised-button","",3,"click"],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"]],template:function(K,q){if(1&K){const ve=s.RV6();s.j41(0,"div",1)(1,"mat-form-field"),s.nrm(2,"textarea",2,0),s.nI1(4,"translate"),s.k0s(),s.j41(5,"div",3)(6,"button",4),s.bIt("click",function(){s.eBV(ve);const Ne=s.sdS(3);return s.Njj(q.copyTextToClipboard(Ne))}),s.j41(7,"mat-icon"),s.EFF(8,"content_copy"),s.k0s(),s.EFF(9),s.nI1(10,"translate"),s.k0s()(),s.j41(11,"div"),s.nrm(12,"br"),s.j41(13,"section",5),s.DNE(14,ki,25,33,"div",6),s.nI1(15,"translate"),s.DNE(16,kn,2,3,"igo-custom-html",7),s.nI1(17,"translate"),s.k0s()()()}2&K&&(s.R7$(2),s.Y8G("placeholder",s.bMT(4,5,"igo.context.shareMap.placeholderLink"))("value",q.url),s.R7$(7),s.SpI(" ",s.bMT(10,7,"igo.context.shareMap.copy")," "),s.R7$(5),s.Y8G("ngIf",""===s.bMT(15,9,"igo.context.shareMap.htmlClarifications")),s.R7$(2),s.Y8G("ngIf",""!==s.bMT(17,11,"igo.context.shareMap.htmlClarifications")))},dependencies:[o.RG,o.rl,L.fS,L.fg,F.Hl,F.$z,ut.m_,ut.An,M.bT,Cn.gE,b.Ck,dt.D9],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-custom-html.shareCustomPadding[_ngcontent-%COMP%]{padding:0}']})}return ne})();var sn=r(38223);function ji(ne,Ke){if(1&ne&&(s.j41(0,"mat-tab-group")(1,"mat-tab",2),s.nI1(2,"translate"),s.nrm(3,"igo-share-map-api",3),s.k0s(),s.j41(4,"mat-tab",2),s.nI1(5,"translate"),s.nrm(6,"igo-share-map-url",3),s.k0s()()),2&ne){const C=s.XpG();s.R7$(),s.Y8G("label",s.bMT(2,4,"igo.context.shareMap.shareWithApi")),s.R7$(2),s.Y8G("map",C.map),s.R7$(),s.Y8G("label",s.bMT(5,6,"igo.context.shareMap.shareWithUrl")),s.R7$(2),s.Y8G("map",C.map)}}function Bi(ne,Ke){if(1&ne&&s.nrm(0,"igo-share-map-url",3),2&ne){const C=s.XpG();s.Y8G("map",C.map)}}let si=(()=>{class ne{config;map;hasApi=!1;constructor(C){this.config=C,this.hasApi=!!this.config.getConfig("context.url")}static \u0275fac=function(K){return new(K||ne)(s.rXU(y.we))};static \u0275cmp=s.VBU({type:ne,selectors:[["igo-share-map"]],inputs:{map:"map"},standalone:!0,features:[s.aNF],decls:2,vars:2,consts:[[4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"map"]],template:function(K,q){1&K&&s.DNE(0,ji,7,8,"mat-tab-group",0)(1,Bi,1,1,"igo-share-map-url",1),2&K&&(s.Y8G("ngIf",q.hasApi),s.R7$(),s.Y8G("ngIf",!q.hasApi))},dependencies:[M.bT,sn.RI,sn.mq,sn.T8,nn,ri,b.Ck,dt.D9]})}return ne})();r(75300),r(84133);var Ni=r(63617),li=r(51567),Yi=r(68799);let Jo=(()=>{class ne{component;contextService;layerService;configService;styleListService;styleService;route;context$$;queryParams;contextLayers=[];removeLayersOnContextChange=!0;get map(){return this.component.map}constructor(C,K,q,ve,Pe,Ne,st){this.component=C,this.contextService=K,this.layerService=q,this.configService=ve,this.styleListService=Pe,this.styleService=Ne,this.route=st}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,li.p)(C=>void 0!==C)).subscribe(C=>this.handleContextChange(C)),this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&this.route.options.contextKey&&this.route.queryParams.pipe((0,u.$)(C=>!ee.BF.isEmpty(C))).subscribe(C=>{this.queryParams=C})}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(C){if(void 0===C.layers)return;!0===this.removeLayersOnContextChange?this.map.removeAllLayers():this.map.removeLayers(this.contextLayers),this.contextLayers=[];const K=(0,Ni.h)(...C.layers.map((q,ve)=>this.layerService.createAsyncLayer(q,C.uri)));K.pipe((0,Yi.r)(K.pipe((0,w.B)(500)))).subscribe(q=>{this.handleAddLayers(q),C.extraFeatures&&C.extraFeatures.forEach(ve=>{this.configService.getConfig("importExport")?.importWithStyle?function ze(ne,Ke,C,K){let q,ve,Pe;if(C.getStyleList(ne.name+".styleByAttribute")){const ht=C.getStyleList(ne.name+".styleByAttribute");q=(Ze,_t)=>K.createStyleByAttribute(Ze,ht,_t)}else if(C.getStyleList(ne.name+".clusterStyle")){const ht=C.getStyleList(ne.name+".clusterParam");ve=C.getStyleList(ne.name+".distance"),q=(Ze,_t)=>{const ft=K.createStyle(C.getStyleList(ne.name+".clusterStyle"),Ze,_t);return K.createClusterStyle(Ze,_t,ht,ft)}}else q=C.getStyleList(ne.name+".style")?(ht,Ze)=>K.createStyle(C.getStyleList(ne.name+".style"),ht,Ze):(ht,Ze)=>K.createStyle(C.getStyleList("default.style"),ht,Ze);const Ne=et(ne);C.getStyleList(ne.name+".clusterStyle")?(Pe=new x.U7x({distance:ve,type:"cluster",queryable:!0}),Pe.ol.source.addFeatures(Ne)):(Pe=new x._kc({type:"vector",queryable:!0}),Pe.ol.addFeatures(Ne));const st=new x.vK2({title:ne.name,isIgoInternalLayer:!0,source:Pe,style:q,opacity:ne.opacity,visible:ne.visible});Ke.addLayer(st)}(ve,this.map,this.styleListService,this.styleService):function Ye(ne,Ke){const K=et(ne),q=new x._kc({type:"vector",queryable:!0});q.ol.addFeatures(K);let ve,Pe=!1;const Ne=K[0]?.getKeys()??[];Ne.includes("_style")||Ne.includes("_mapTitle")?ve=(0,x.tpu)():(ve=(0,x.l7K)(),Pe=!0);const st=new x.vK2({title:ne.name,isIgoInternalLayer:!0,source:q,igoStyle:{editable:Pe},style:ve,visible:ne.visible,opacity:ne.opacity});Ke.addLayer(st)}(ve,this.map)})}),this.layerService.createAsyncIdbLayers(C.uri).pipe((0,w.B)(500)).subscribe(q=>this.handleAddLayers(q))}handleAddLayers(C){C=C.filter(K=>void 0!==K).map(K=>(K.visible=this.computeLayerVisibilityFromUrl(K),K.zIndex=K.zIndex,K)),this.contextLayers.concat(C),this.map.addLayers(C)}computeLayerVisibilityFromUrl(C){const K=this.queryParams,ve=C.id;let Pe=C.visible;if(!K||!ve)return Pe;const Ne=K[this.route.options.contextKey];if(Ne===this.contextService.context$.value.uri||!Ne){let st="",ht="",Ze=[],_t=[];this.route.options.visibleOnLayersKey&&K[this.route.options.visibleOnLayersKey]&&(st=K[this.route.options.visibleOnLayersKey]),this.route.options.visibleOffLayersKey&&K[this.route.options.visibleOffLayersKey]&&(ht=K[this.route.options.visibleOffLayersKey]),"*"===st&&(Pe=!0),"*"===ht&&(Pe=!1),Ze=st.split(","),_t=ht.split(","),(Ze.indexOf(ve)>-1||Ze.indexOf(ve.toString())>-1)&&(Pe=!0),(_t.indexOf(ve)>-1||_t.indexOf(ve.toString())>-1)&&(Pe=!1)}return Pe}static \u0275fac=function(K){return new(K||ne)(s.rXU(x.KnQ),s.rXU(Q),s.rXU(x.BY8),s.rXU(y.we),s.rXU(x.bhg),s.rXU(x.JwY),s.rXU(X.v$,8))};static \u0275dir=s.FsC({type:ne,selectors:[["","igoLayerContext",""]],inputs:{removeLayersOnContextChange:"removeLayersOnContextChange"},standalone:!0,features:[s.Jv_([z.q1])]})}return ne})();var Bn=r(55050);let Sn=(()=>{class ne{contextService;mediaService;component;context$$;get map(){return this.component.map}constructor(C,K,q){this.contextService=K,this.mediaService=q,this.component=C}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,li.p)(C=>void 0!==C)).subscribe(C=>this.handleContextChange(C))}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(C){if(void 0===C.map)return;const K=C.map.view;(!this.component.view||!0!==K.keepCurrentView||C.map.view.projection!==this.map.projection)&&(this.component.view=K),this.component.map.geolocationController&&this.component.map.geolocationController.updateGeolocationOptions(K);const q=C.map.controls;if(!this.component.controls&&q){if(this.mediaService.isMobile()&&"boolean"!=typeof q.scaleLine){const ve=q.scaleLine;ve.minWidth||(ve.minWidth=Math.min(64,ve.minWidth),q.scaleLine=ve)}this.component.controls=q}}static \u0275fac=function(K){return new(K||ne)(s.rXU(x.KnQ),s.rXU(Q),s.rXU(Bn.u1))};static \u0275dir=s.FsC({type:ne,selectors:[["","igoMapContext",""]],standalone:!0})}return ne})(),ci=(()=>{class ne{contextService;mapService;languageService;confirmDialogService;messageService;auth;storageService;cdRef;component;contexts$$;selectedContext$$;defaultContextId$$;previousMessageId;onSelect(C){this.contextService.loadContext(C.uri)}onEdit(C){this.contextService.loadEditedContext(C.uri)}onSave(C){const K=this.mapService.getMap(),q=this.contextService.getContextFromMap(K),ve=()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:C.title})};if(C.imported)return q.title=C.title,this.contextService.delete(C.id,!0),void this.contextService.create(q).subscribe(Ne=>{this.contextService.loadContext(Ne.uri),ve()});this.contextService.update(C.id,{layers:q.layers,map:{view:q.map.view}}).subscribe(()=>{ve()})}onFavorite(C){C.id||(C.id=C.uri),this.contextService.setDefault(C.id).subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId),this.contextService.defaultContextId$.next(C.id);const K=this.messageService.success("igo.context.contextManager.dialog.favoriteMsg","igo.context.contextManager.dialog.favoriteTitle",void 0,{value:C.title});this.previousMessageId=K.toastId,this.cdRef.detectChanges()})}onManageTools(C){this.contextService.loadEditedContext(C.uri)}onManagePermissions(C){this.contextService.loadEditedContext(C.uri)}onDelete(C){this.confirmDialogService.open(this.languageService.translate.instant("igo.context.contextManager.dialog.confirmDelete")).subscribe(q=>{q&&this.contextService.delete(C.id,C.imported).subscribe(()=>{this.messageService.info("igo.context.contextManager.dialog.deleteMsg","igo.context.contextManager.dialog.deleteTitle",void 0,{value:C.title})})})}onClone(C){this.contextService.clone(C.id,{title:C.title+"-copy",uri:C.uri+"-copy"}).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.cloneMsg","igo.context.contextManager.dialog.cloneTitle",void 0,{value:C.title})})}onCreate(C){const{title:K,empty:q}=C,ve=this.contextService.getContextFromMap(this.component.map,q);ve.title=K,this.contextService.create(ve).subscribe(()=>{this.messageService.success("igo.context.bookmarkButton.dialog.createMsg","igo.context.bookmarkButton.dialog.createTitle",void 0,{value:ve.title}),this.contextService.loadContext(ve.uri)})}loadContexts(){const C=["none"];for(const K of this.component.permissions)(!0===K.checked||!0===K.indeterminate)&&C.push(K.name);this.contextService.loadContexts(C,!!this.component.showHidden)}showHiddenContexts(){this.component.showHidden=!this.component.showHidden,this.storageService.set("contexts.showHidden",this.component.showHidden),this.loadContexts()}onShowContext(C){this.contextService.showContext(C.id).subscribe()}onHideContext(C){this.contextService.hideContext(C.id).subscribe()}constructor(C,K,q,ve,Pe,Ne,st,ht,Ze){this.contextService=K,this.mapService=q,this.languageService=ve,this.confirmDialogService=Pe,this.messageService=Ne,this.auth=st,this.storageService=ht,this.cdRef=Ze,this.component=C}ngOnInit(){this.component.contexts={ours:[]},this.component.showHidden=this.storageService.get("contexts.showHidden"),this.contexts$$=this.contextService.contexts$.subscribe(K=>this.handleContextsChange(K)),this.defaultContextId$$=this.contextService.defaultContextId$.subscribe(K=>{this.component.defaultContextId=K});const C=this.storageService.get("favorite.context.uri");C&&!this.auth.authenticated&&this.contextService.defaultContextId$.next(C),this.selectedContext$$=this.contextService.context$.pipe((0,w.B)(100)).subscribe(K=>this.component.selectedContext=K),this.auth.authenticate$.subscribe(K=>{K&&this.contextService.getProfilByUser().subscribe(q=>{this.component.users=q,this.component.permissions=[];const ve=this.component.users.reduce((Ne,st)=>(Ne=Ne.concat(st),st.childs?Ne.concat(st.childs):Ne),[]);for(const Ne of ve){const st={name:Ne.name,checked:this.storageService.get("contexts.permissions."+Ne.name)};null===st.checked&&(st.checked=!0),this.component.permissions.push(st)}const Pe=["none"];for(const Ne of this.component.permissions)(!0===Ne.checked||!0===Ne.indeterminate)&&Pe.push(Ne.name);this.contextService.loadContexts(Pe,!!this.component.showHidden)})})}ngOnDestroy(){this.contexts$$.unsubscribe(),this.selectedContext$$.unsubscribe(),this.defaultContextId$$.unsubscribe()}handleContextsChange(C){this.component.contexts=C}static \u0275fac=function(K){return new(K||ne)(s.rXU(Te,2),s.rXU(Q),s.rXU(x.uk7),s.rXU(b.gw),s.rXU(Ln.gw),s.rXU(k.bg),s.rXU(h.uR),s.rXU(H.n$),s.rXU(s.gRc))};static \u0275dir=s.FsC({type:ne,selectors:[["","igoContextListBinding",""]],hostBindings:function(K,q){1&K&&s.bIt("select",function(Pe){return q.onSelect(Pe)})("edit",function(Pe){return q.onEdit(Pe)})("save",function(Pe){return q.onSave(Pe)})("favorite",function(Pe){return q.onFavorite(Pe)})("manageTools",function(Pe){return q.onManageTools(Pe)})("managePermissions",function(Pe){return q.onManagePermissions(Pe)})("delete",function(Pe){return q.onDelete(Pe)})("clone",function(Pe){return q.onClone(Pe)})("create",function(Pe){return q.onCreate(Pe)})("filterPermissionsChanged",function(){return q.loadContexts()})("showHiddenContexts",function(){return q.showHiddenContexts()})("show",function(Pe){return q.onShowContext(Pe)})("hide",function(Pe){return q.onHideContext(Pe)})},standalone:!0,features:[s.Jv_([Ln.gw])]})}return ne})(),Gn=(()=>{class ne{contextService;messageService;component;editedContext$$;submitSuccessed=new s.bkB;onEdit(C){this.contextService.update(this.component.context.id,C).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:C.title||this.component.context.title}),this.contextService.setEditedContext(void 0),this.submitSuccessed.emit(C)})}constructor(C,K,q){this.contextService=K,this.messageService=q,this.component=C}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(C=>this.handleEditedContextChange(C))}ngOnDestroy(){this.editedContext$$.unsubscribe()}handleEditedContextChange(C){this.component.context=C}static \u0275fac=function(K){return new(K||ne)(s.rXU(qt,2),s.rXU(Q),s.rXU(k.bg))};static \u0275dir=s.FsC({type:ne,selectors:[["","igoContextEditBinding",""]],hostBindings:function(K,q){1&K&&s.bIt("submitForm",function(Pe){return q.onEdit(Pe)})},outputs:{submitSuccessed:"submitSuccessed"},standalone:!0})}return ne})(),an=(()=>{class ne{contextService;languageService;messageService;cd;component;editedContext$$;onAddPermission(C){C.profil?this.contextService.addPermissionAssociation(this.component.context.id,C.profil,C.typePermission).subscribe(q=>{for(const Pe of q)this.component.permissions[C.typePermission].push(Pe);this.messageService.success("igo.context.permission.dialog.addMsg","igo.context.permission.dialog.addTitle",void 0,{value:C.profil}),this.cd.detectChanges()}):this.messageService.error("igo.context.contextManager.errors.addPermissionEmpty","igo.context.contextManager.errors.addPermissionTitle")}onRemovePermission(C){this.contextService.deletePermissionAssociation(this.component.context.id,C.id).subscribe(()=>{const q=this.component.permissions[C.typePermission].findIndex(Pe=>Pe.id===C.id);this.component.permissions[C.typePermission].splice(q,1),this.messageService.success("igo.context.permission.dialog.deleteMsg","igo.context.permission.dialog.deleteTitle",void 0,{value:C.profil}),this.cd.detectChanges()})}onScopeChanged(C){const K=C.scope;this.contextService.update(C.id,{scope:K}).subscribe(()=>{this.messageService.success("igo.context.permission.dialog.scopeChangedMsg","igo.context.permission.dialog.scopeChangedTitle",void 0,{value:"igo.context.permission.scope."+K})})}constructor(C,K,q,ve,Pe){this.contextService=K,this.languageService=q,this.messageService=ve,this.cd=Pe,this.component=C}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(C=>this.handleEditedContextChange(C))}ngOnDestroy(){this.editedContext$$.unsubscribe(),this.contextService.editedContext$.next(void 0)}handleEditedContextChange(C){this.component.context=C,C&&this.contextService.getPermissions(C.id).subscribe(K=>{const q={read:(K=K||[]).filter(ve=>"read"===ve.typePermission.toString()),write:K.filter(ve=>"write"===ve.typePermission.toString())};return this.component.permissions=q})}static \u0275fac=function(K){return new(K||ne)(s.rXU(bo,2),s.rXU(Q),s.rXU(b.gw),s.rXU(k.bg),s.rXU(s.gRc))};static \u0275dir=s.FsC({type:ne,selectors:[["","igoContextPermissionsBinding",""]],hostBindings:function(K,q){1&K&&s.bIt("addPermission",function(Pe){return q.onAddPermission(Pe)})("removePermission",function(Pe){return q.onRemovePermission(Pe)})("scopeChanged",function(Pe){return q.onScopeChanged(Pe)})},standalone:!0})}return ne})()},80660:(De,le,r)=>{"use strict";r.d(le,{Z:()=>p});var M=r(89475),a=r(60560),F=r(68559);let p=(()=>{class e{activityService;constructor(o){this.activityService=o}intercept(o,L){const R=o.headers.get("activityInterceptor");if(R){const y=o.clone({headers:o.headers.delete("activityInterceptor")});if("false"===R)return L.handle(y)}const v=this.activityService.register();return L.handle(o).pipe((0,M.j)(()=>{this.activityService.unregister(v)}))}static \u0275fac=function(L){return new(L||e)(F.KVO(a.T))};static \u0275prov=F.jDH({token:e,factory:e.\u0275fac})}return e})()},20279:(De,le,r)=>{"use strict";r.d(le,{V:()=>p});var M=r(46443),a=r(80660),F=r(68559);let p=(()=>{class e{static forRoot(){return{ngModule:e,providers:[{provide:M.a7,useClass:a.Z,multi:!0}]}}static \u0275fac=function(L){return new(L||e)};static \u0275mod=F.$C({type:e});static \u0275inj=F.G2t({})}return e})()},60560:(De,le,r)=>{"use strict";r.d(le,{T:()=>p});var M=r(68671),a=r(75797),F=r(68559);let p=(()=>{class e{counter$=new a.t(0);ids=[];constructor(){}register(){const o=(0,M.uR)();return this.ids.push(o),this.counter$.next(this.ids.length),o}unregister(o){const L=this.ids.indexOf(o);-1!==L&&(this.ids.splice(L,1),this.counter$.next(this.ids.length))}static \u0275fac=function(L){return new(L||e)};static \u0275prov=F.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()},67778:(De,le,r)=>{"use strict";r.d(le,{Ti:()=>a.T,Vl:()=>M.V});var M=r(20279),a=r(60560);r(80660)},95374:(De,le,r)=>{"use strict";r.d(le,{c:()=>F});var M=r(67143),a=r(68559);let F=(()=>{class p{config;options;get paq(){return window._paq=window._paq||[]}constructor(c){this.config=c,this.options=this.config.getConfig("analytics")||{},"matomo"===this.options.provider&&this.initMatomo()}initMatomo(){if(!this.options.url||!this.options.id)return;const c="/"===this.options.url.substr(-1)?this.options.url+"matomo":this.options.url;(()=>{this.paq.push(["setTrackerUrl",c+".php"]),this.paq.push(["setSiteId",this.options.id]);const o=document.createElement("script"),L=document.getElementsByTagName("script")[0];o.type="text/javascript",o.async=!0,o.defer=!0,o.src=c+".js",L.parentNode.insertBefore(o,L)})()}setUser(c,o){if("matomo"===this.options.provider){if(c){this.paq.push(["setUserId",c.id]);const L=`${c.firstName} ${c.lastName}`;this.paq.push(["setCustomVariable",1,"user",c.sourceId,"visit"]),this.paq.push(["setCustomVariable",2,"name",L,"visit"]),this.paq.push(["setCustomVariable",3,"profils",o,"visit"])}else this.paq.push(["resetUserId"]),this.paq.push(["deleteCustomVariable",1,"user"]),this.paq.push(["deleteCustomVariable",2,"name"]),this.paq.push(["deleteCustomVariable",3,"profils"]);this.paq.push(["trackPageView"]),this.paq.push(["enableLinkTracking"])}}trackSearch(c,o){"matomo"===this.options.provider&&this.paq.push(["trackSiteSearch",c,!1,o])}trackEvent(c,o,L){"matomo"===this.options.provider&&this.paq.push(["trackEvent",c,o,L])}trackLayer(c,o,L){"matomo"===this.options.provider&&this.paq.push(["trackEvent",c,o,L])}static \u0275fac=function(o){return new(o||p)(a.KVO(M.we))};static \u0275prov=a.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},67143:(De,le,r)=>{"use strict";r.d(le,{we:()=>v,ec:()=>b,rE:()=>R});var M=r(68559),a=r(46443),F=r(68671),p=r(75797),e=r(77919),c=r(61318);const o={showMenuButton:{alternativeKey:"menu.button.visible",mayBeRemoveIn:new Date("2024-06-06")},menuButtonReverseColor:{alternativeKey:"menu.button.useThemeColor",mayBeRemoveIn:new Date("2024-06-06")},importWithStyle:{alternativeKey:"importExport.importWithStyle",mayBeRemoveIn:new Date("2024-06-06")},hasGeolocateButton:{alternativeKey:"geolocate.button.visible",mayBeRemoveIn:new Date("2024-06-06")}},L=new Map(Object.entries(o).filter(([D,h])=>h.alternativeKey).map(([D,h])=>[h.alternativeKey,{deprecatedKey:D}])),R={lib:"17.0.0",releaseDate:1724343367841};let v=(()=>{class D{config;httpClient;configDeprecated=new Map(Object.entries(o));_isLoaded$=new p.t(null);isLoaded$=this._isLoaded$.asObservable();constructor(X){this.httpClient=new a.Qq(X)}getConfigs(){return Array.from(this.configDeprecated.keys()).map(X=>{void 0!==F.BF.resolve(this.config,X)&&this.handleDeprecatedConfig(X)}),this.config}getConfig(X,H){let x=F.BF.resolve(this.config,X);return this.configDeprecated.get(X)&&void 0!==x?this.handleDeprecatedConfig(X):void 0===x&&(x=this.handleDeprecationPossibility(X)),x??H}handleDeprecatedConfig(X){const H=this.configDeprecated.get(X);let x=`This config (${X}) is deprecated and will be removed shortly`;H.alternativeKey&&(x+=` You should use this key (${H.alternativeKey}) as an alternate solution`),new Date>=H.mayBeRemoveIn?console.error(x):console.warn(x)}handleDeprecationPossibility(X){const H=L.get(X);if(H)return this.getConfig(H.deprecatedKey)}load(X){const H=X.default;return X.path?new Promise((x,ee)=>{this.httpClient.get(X.path).pipe((0,c.W)(Z=>(console.log(`Configuration file ${X.path} could not be read`),this._isLoaded$.next(!1),x(!0),(0,e.$)(Z.error||"Server error")))).subscribe(Z=>{this.config=F.BF.mergeDeep(F.BF.mergeDeep({version:R},H),Z),this._isLoaded$.next(!0),x(!0)})}):(this.config=H,this._isLoaded$.next(!0),!0)}static \u0275fac=function(H){return new(H||D)(M.KVO(a.JV))};static \u0275prov=M.jDH({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})(),y=new M.nKC("configOptions");function b(D){return(0,M.EmA)([{provide:y,useValue:D},{provide:M.hnV,useFactory:k,multi:!0,deps:[v,y]}])}function k(D,h){return()=>D.load(h)}},21701:(De,le,r)=>{"use strict";r.d(le,{Ck:()=>F,gw:()=>X,X$:()=>ee});var M=r(90852),a=r(68559);let F=(()=>{class N{static \u0275fac=function(g){return new(g||N)};static \u0275mod=a.$C({type:N});static \u0275inj=a.G2t({imports:[M.h]})}return N})();var p=r(46443),e=r(68671),c=r(75797),o=r(2435),L=r(36647),R=r(61873),v=r(70271),y=r(98764);class b{configService;prefix;suffix;httpClient;_isLoaded$=new c.t(null);isLoaded$=this._isLoaded$.asObservable();constructor(W,A,g,u=".json"){this.configService=A,this.prefix=g,this.suffix=u,this.httpClient=new p.Qq(W)}getTranslation(W){const A=this.httpClient.get(`locale/libs_locale/${W}.json`);return this.configService.isLoaded$.pipe((0,o.$)(g=>g),(0,L.n)(()=>{if(this.configService&&!this.prefix){const O=this.configService.getConfig("language.prefix");this.prefix=!O||Array.isArray(O)?O:[O]}if(!this.prefix||0===this.prefix.length)return this._isLoaded$.next(!0),A;const g=this.prefix.map(O=>this.httpClient.get(`${O}${W}${this.suffix}`));return(0,R.p)([A,...g]).pipe((0,v.T)(O=>O.reduce((j,P)=>e.BF.mergeDeep(j,P),{})),(0,y.M)(()=>{this._isLoaded$.next(!0)}))}))}}var k=r(67143),_=r(72354),D=r(61318),h=r(19999);let X=(()=>{class N{translate;language;language$=new c.t(void 0);constructor(A){this.translate=A,this.language=this.translate.getBrowserLang();const g=this.getLanguage();this.translate.setDefaultLang(g),this.language$.next(g)}getLanguage(){return this.language.match(/en|fr/)?this.language:"en"}setLanguage(A){this.language=A.match(/en|fr/)?A:"en",(0,h.z)([this.translate.use(this.language),this.translate.reloadLang(this.language)]).subscribe(()=>{this.language$.next(this.language)})}static \u0275fac=function(g){return new(g||N)(a.KVO(M.c$))};static \u0275prov=a.jDH({token:N,factory:N.\u0275fac,providedIn:"root"})}return N})();class H{handle(W){if(!W.translateService.langs.length)throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.");if("igo."===W.key.substr(0,4))throw new Error(`The Key "${W.key}" is missing in locale file.`);return W.key}}const x=5e3;function ee(N){return(0,a.EmA)([(0,a.oKB)(M.h.forRoot(Z(N))),{provide:a.hnV,useFactory:W=>()=>W.translate.currentLoader.isLoaded$?.pipe((0,_.w)(x),(0,o.$)(A=>!0===A),(0,D.W)(A=>{throw A.message+=` - Request timed out for language loader after: ${x}`,A})),deps:[X],multi:!0}])}const Z=N=>({defaultLanguage:"fr",loader:N??G,missingTranslationHandler:{provide:M.er,useClass:H}}),G={provide:M.Wr,useFactory:function U(N,W){return new b(N,W,void 0,void 0)},deps:[p.JV,k.we]}},55050:(De,le,r)=>{"use strict";r.d(le,{$U:()=>M,rU:()=>a,u1:()=>c});var M=function(o){return o.Mobile="mobile",o.Tablet="tablet",o.Desktop="desktop",o}(M||{}),a=function(o){return o.Portrait="portrait",o.Landscape="landscape",o}(a||{}),F=r(87912),p=r(75797),e=r(68559);let c=(()=>{class o{media$=new p.t(void 0);orientation$=new p.t(void 0);constructor(R){R.observe([F.Rp.HandsetLandscape]).subscribe(v=>{v.matches&&(this.media$.next(M.Mobile),this.orientation$.next(a.Landscape))}),R.observe([F.Rp.HandsetPortrait]).subscribe(v=>{v.matches&&(this.media$.next(M.Mobile),this.orientation$.next(a.Portrait))}),R.observe([F.Rp.TabletLandscape]).subscribe(v=>{v.matches&&(this.media$.next(M.Tablet),this.orientation$.next(a.Landscape))}),R.observe([F.Rp.TabletPortrait]).subscribe(v=>{v.matches&&(this.media$.next(M.Tablet),this.orientation$.next(a.Portrait))}),R.observe([F.Rp.WebLandscape]).subscribe(v=>{v.matches&&(this.media$.next(M.Desktop),this.orientation$.next(a.Landscape))}),R.observe([F.Rp.WebPortrait]).subscribe(v=>{v.matches&&(this.media$.next(M.Desktop),this.orientation$.next(a.Portrait))})}getMedia(){return this.media$.value}getOrientation(){return this.orientation$.value}isTouchScreen(){return"ontouchstart"in document.documentElement}isMobile(){return"mobile"===this.getMedia()}isDesktop(){return"desktop"===this.getMedia()}static \u0275fac=function(v){return new(v||o)(e.KVO(F.QP))};static \u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},1455:(De,le,r)=>{"use strict";r.d(le,{tG:()=>e,bg:()=>k,Fi:()=>p});var M=r(68559),a=r(54285);const F={positionClass:"toast-bottom-right",timeOut:1e4,extendedTimeOut:1e4,titleClass:"mat-subtitle-2",messageClass:"toast-message",closeButton:!0,progressBar:!0,enableHtml:!0,tapToDismiss:!0,maxOpened:4,preventDuplicates:!0,resetTimeoutOnDuplicate:!0,countDuplicates:!1,includeTitleDuplicates:!0};function p(){return(0,M.EmA)([(0,a.DP)(F)])}let e=(()=>{class _{static forRoot(){return{ngModule:_,providers:[]}}static \u0275fac=function(X){return new(X||_)};static \u0275mod=M.$C({type:_});static \u0275inj=M.G2t({providers:[p()]})}return _})();var c=function(_){return _.ERROR="error",_.ALERT="warning",_.WARNING="warning",_.INFO="info",_.SUCCESS="success",_.SHOW="show",_}(c||{}),o=r(67143),L=r(21701),R=r(75797),v=r(61873),y=r(52575),b=r(2435);let k=(()=>{class _{injector;configService;languageService;messages$=new R.t([]);options;activeMessageTranslations=[];constructor(h,X,H){this.injector=h,this.configService=X,this.languageService=H,this.options=this.configService.getConfig("message"),this.languageService.language$.pipe((0,y.B)(500)).subscribe(x=>{0===this.toastr.toasts.length&&(this.activeMessageTranslations=[]),this.toastr.toasts.map(ee=>{const Z=this.activeMessageTranslations.find(G=>G.id===ee.toastId);if(Z){const G={...Z.textInterpolateParams},U={...Z.titleInterpolateParams};Z.textInterpolateParams&&Object.keys(Z.textInterpolateParams).map(N=>{N&&(G[N]=this.languageService.translate.instant(Z.textInterpolateParams[N]))}),Z.titleInterpolateParams&&Object.keys(Z.titleInterpolateParams).map(N=>{N&&(U[N]=this.languageService.translate.instant(Z.titleInterpolateParams[N]))}),(0,v.p)([this.languageService.translate.get(Z.textKey,G),this.languageService.translate.get(Z.titleKey,U)]).pipe((0,b.$)()).subscribe(N=>{ee.toastRef.componentInstance.message=N[0],ee.toastRef.componentInstance.title=N[1]})}})})}get toastr(){return this.injector.get(a.tw)}showError(h){return h.error.caught=!0,this.error(h.error.message,h.error.title)}message(h){const X=h.type;this.toastr.toastrConfig.iconClasses[X]=`toast-${X}`,this.messages$.next(this.messages$.value.concat([h])),h.options=h.options||{};const H=new Date;if(h.options.from=h.options.from?h.options.from:new Date("1 jan 1900"),h.options.to=h.options.to?h.options.to:new Date("1 jan 3000"),"string"==typeof h.options.from&&(h.options.from=new Date(Date.parse(h.options.from.replace(/-/g," ")))),"string"==typeof h.options.to&&(h.options.to=new Date(Date.parse(h.options.to.replace(/-/g," ")))),H>h.options.from&&H<h.options.to&&(!1===h.showIcon&&(this.toastr.toastrConfig.iconClasses[X]=`toast-${X} toast-no-icon`),(h=this.handleTemplate(h)).text)){let x;switch(h.type){case c.SUCCESS:x=this.success(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.ERROR:x=this.error(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.INFO:x=this.info(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.SHOW:x=this.show(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;case c.ALERT:case c.WARNING:x=this.alert(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams);break;default:x=this.info(h.text,h.title,h.options,h.textInterpolateParams,h.titleInterpolateParams)}h.options.id=x.toastId}}success(h,X="igo.core.message.success",H={},x,ee){return this.handleNgxToastr("success",h,X,H,x,ee)}error(h,X="igo.core.message.error",H={},x,ee){return this.handleNgxToastr("error",h,X,H,x,ee)}info(h,X="igo.core.message.info",H={},x,ee){return this.handleNgxToastr("info",h,X,H,x,ee)}alert(h,X="igo.core.message.alert",H={},x,ee){return this.handleNgxToastr("alert",h,X,H,x,ee)}show(h,X="igo.core.message.info",H={},x,ee){return this.handleNgxToastr("show",h,X,H,x,ee)}handleNgxToastr(h,X,H,x={},ee,Z){const G={...ee},U={...Z};ee&&Object.keys(ee).map(g=>{const u=ee[g];u&&(G[g]="string"==typeof u?this.languageService.translate.instant(u):u)}),Z&&Object.keys(Z).map(g=>{if(g){const u=Z[g];U[g]="string"==typeof u?this.languageService.translate.instant(u):u}});const N=this.languageService.translate.instant(X,G),W=this.languageService.translate.instant(H,U);let A;switch(h){case"success":A=this.toastr.success(N,W,x);break;case"error":A=this.toastr.error(N,W,x);break;case"show":case"info":A=this.toastr.info(N,W,x);break;case"alert":A=this.toastr.warning(N,W,x)}return this.activeMessageTranslations.push({id:A.toastId,titleKey:H,textKey:X,textInterpolateParams:ee,titleInterpolateParams:Z}),A}remove(h){this.toastr.remove(h)}removeAllAreNotError(){for(const h of this.messages$.value)h.type!==c.ERROR&&this.remove(h.options.id)}handleTemplate(h){if(!this.options?.template||h.html)return h;let X=this.options?.template;return X=X.replace("${text}",h.text),X=X.replace("${title}",h.title),h.html=void 0,h.text=X,h.title=void 0,h}static \u0275fac=function(X){return new(X||_)(M.KVO(M.zZn),M.KVO(o.we),M.KVO(L.gw))};static \u0275prov=M.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},69576:(De,le,r)=>{"use strict";r.d(le,{A:()=>c});var M=r(68559),a=r(1455),F=r(18537),p=r(52575),e=r(63037);let c=(()=>{class o{messageService;injector;stateChangeEventEmitter=new M.bkB;onlineSubscription;offlineSubscription;previousMessageId;state={connection:window.navigator.onLine};constructor(R,v){this.messageService=R,this.injector=v,this.checkNetworkState()}checkNetworkState(){this.onlineSubscription=(0,F.R)(window,"online").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const R=this.messageService.info("igo.core.network.online.message","igo.core.network.online.title");this.previousMessageId=R.toastId,this.state.connection=!0,this.emitEvent()}),this.offlineSubscription=(0,F.R)(window,"offline").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const R=this.messageService.info("igo.core.network.offline.message","igo.core.network.offline.title");this.previousMessageId=R.toastId,this.state.connection=!1,this.emitEvent()})}emitEvent(){this.stateChangeEventEmitter.emit(this.state)}ngOnDestroy(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch{}}currentState(R=!0){return R?this.stateChangeEventEmitter.pipe((0,p.B)(300),(0,e.Z)(this.state)):this.stateChangeEventEmitter.pipe((0,p.B)(300))}static \u0275fac=function(v){return new(v||o)(M.KVO(a.bg),M.KVO(M.zZn))};static \u0275prov=M.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},71424:(De,le,r)=>{"use strict";r.d(le,{v$:()=>e});var M=r(68559),a=r(58610);let F=new M.nKC("routeServiceOptions"),e=(()=>{class c{router;route;options;constructor(L,R,v){this.router=L,this.route=R,this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"},v)}get queryParams(){let L=decodeURIComponent(location.search);if(L.includes("\xa2er=")){L=L.replace("\xa2er","&center");const R=L.slice(1).split("&").map(v=>v.split("=")).reduce((v,y)=>{const[b,k]=y.map(decodeURIComponent);return v[b]=k,v},{});this.router.navigate([],{queryParams:R})}return this.route.queryParams}static \u0275fac=function(R){return new(R||c)(M.KVO(a.Ix),M.KVO(a.nX),M.KVO(F,8))};static \u0275prov=M.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},81681:(De,le,r)=>{"use strict";r.d(le,{Xh:()=>p,YM:()=>a,n$:()=>o,yl:()=>F});var M=r(75797),a=function(L){return L.SESSION="Session",L.LOCAL="Local",L}(a||{}),F=function(L){return L.ADDED="Added",L.MODIFIED="Modified",L.REMOVED="Removed",L.CLEARED="Cleared",L}(F||{});class p{options;storageChange$=new M.t(void 0);constructor(R){this.options=R.getConfig("storage")||{key:"igo"}}get(R,v){let y;if((!v||v===a.SESSION)&&(y=sessionStorage.getItem(`${this.options.key}.${R}`)),(v===a.LOCAL||!y&&!v)&&(y=localStorage.getItem(`${this.options.key}.${R}`)),y)try{y=JSON.parse(y)}catch{}return y}set(R,v,y=a.LOCAL){const b=this.get(R,y);y===a.SESSION?sessionStorage.setItem(`${this.options.key}.${R}`,JSON.stringify(v)):localStorage.setItem(`${this.options.key}.${R}`,JSON.stringify(v));const k=this.get(R,y);k!==b&&this.storageChange$.next({key:R,scope:y,event:void 0!==b?F.MODIFIED:F.ADDED,previousValue:b,currentValue:k})}remove(R,v=a.LOCAL){const y=this.get(R,v);v===a.SESSION?sessionStorage.removeItem(`${this.options.key}.${R}`):localStorage.removeItem(`${this.options.key}.${R}`),this.storageChange$.next({key:R,scope:v,event:F.REMOVED,previousValue:y})}clear(R=a.LOCAL){R===a.SESSION?sessionStorage.clear():localStorage.clear(),this.storageChange$.next({scope:R,event:F.CLEARED})}}var e=r(67143),c=r(68559);let o=(()=>{class L extends p{config;constructor(v){super(v),this.config=v}static \u0275fac=function(y){return new(y||L)(c.KVO(e.we))};static \u0275prov=c.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})()},88231:(De,le,r)=>{"use strict";r.d(le,{K:()=>a,T:()=>M});var M=function(F){return F.wms="wms",F.wmts="wmts",F.arcgisrest="esriJSON",F.imagearcgisrest="esriJSON",F.tilearcgisrest="esriJSON",F}(M||{}),a=function(F){return F.FeatureLayer="Feature Layer",F.RasterLayer="Raster Layer",F.GroupLayer="Group Layer",F}(a||{})},13483:(De,le,r)=>{"use strict";r.d(le,{w:()=>U});var M=r(24398),a=r(46443),F=r(68671),p=r(54710),e=r(5750),c=r(48118),o=r(1706),L=r(63886),R=r(66606),v=r(61873),y=r(59452),b=r(43942),k=r(70271),_=r(61318),D=r(9530),h=r(14114),X=r(64004),H=r(84547),x=r(25583),ee=r(88231),Z=r(68559),G=r(52314);class U{http;mapService;parsers={wms:new e.A,wmts:new c.A,esriJSON:new o.A};constructor(W,A){this.http=W,this.mapService=A}getWMSOptions(W){return this.getCapabilities("wms",W.url,W.params.VERSION).pipe((0,k.T)(u=>u?this.parseWMSOptions(W,u):void 0))}getWMTSOptions(W){return this.getCapabilities("wmts",W.url,W.version).pipe((0,k.T)(O=>O?this.parseWMTSOptions(W,O):void 0))}getCartoOptions(W){return this.http.jsonp("https://"+W.account+".carto.com/api/v2/viz/"+W.mapId+"/viz.json","callback").pipe((0,k.T)(g=>this.parseCartoOptions(W,g)))}getArcgisOptions(W){const A=W.url+"/"+W.layer+"?f=json",g=this.getCapabilities("arcgisrest",W.url),u=this.http.get(A);return(0,v.p)([u,g]).pipe((0,k.T)(O=>this.parseArcgisOptions(W,O[0],O[1])))}getImageArcgisOptions(W){const A=W.url+"/"+W.layer+"?f=json",g=W.url+"/legend?f=json",u=this.getCapabilities("imagearcgisrest",W.url),O=this.http.get(A),j=this.http.get(g).pipe((0,k.T)(P=>P),(0,_.W)(P=>(console.log("No legend associated with this Image Service"),(0,y.of)(P))));return(0,v.p)([O,j,u]).pipe((0,k.T)(P=>this.parseTileOrImageArcgisOptions(W,P[0],P[1],P[2])))}getTileArcgisOptions(W){const A=W.url+"/"+W.layer+"?f=json",g=W.url+"/legend?f=json",u=this.getCapabilities("tilearcgisrest",W.url),O=this.http.get(A),j=this.http.get(g).pipe((0,k.T)(P=>P),(0,_.W)(P=>(console.log("No legend associated with this Tile Service"),(0,y.of)(P))));return(0,v.p)([O,j,u]).pipe((0,k.T)(P=>this.parseTileOrImageArcgisOptions(W,P[0],P[1],P[2])))}getCapabilities(W,A,g){const u=new a.Nl({fromObject:{request:"GetCapabilities",service:W.toUpperCase(),version:g||"1.3.0",_i:"true"}});let O;return O="esriJSON"===ee.T[W]?this.http.get(A+"?f=json"):this.http.get(A,{params:u,responseType:"text"}),O.pipe((0,k.T)(j=>{if("esriJSON"===ee.T[W])return j;if(String(j).toLowerCase().includes("serviceexception")&&String(j).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return this.parsers[W].read(j)}),(0,_.W)(j=>{throw typeof j.error<"u"&&(j.error.caught=!0),j}))}parseWMSOptions(W,A){const u=this.findDataSourceInCapabilities(A.Capability.Layer,W.params.LAYERS);if(!u)throw{error:{message:"Layer not found"}};const O=u.DataURL?u.DataURL[0]:void 0,j=u.Abstract?u.Abstract:void 0,P=u.KeywordList?u.KeywordList:void 0;let Y=u.queryable;const w=this.getTimeFilter(u),I=w&&Object.keys(w).length>0,E=u.Style?this.getStyle(u.Style):void 0;let s=!0;u.EX_GeographicBoundingBox?u.EX_GeographicBoundingBox.forEach((de,ue)=>{ue<2&&(de>180||de<-180)&&(s=!1),ue>=2&&(de>90||de<-90)&&(s=!1)}):s=!1;const z=s?L.DI(u.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0;let Q;const ae=[H.wf.GEOJSON,H.wf.GEOJSON2,H.wf.GML3,H.wf.GML2,H.wf.JSON,H.wf.HTML];for(const de of ae)if(-1!==A.Capability.Request.GetFeatureInfo.Format.indexOf(de)){const ue=Object.keys(H.wf).find(ce=>H.wf[ce]===de);Q=H.gv[ue];break}Q||(Y=!1);const ye=F.BF.removeUndefined({_layerOptionsFromSource:{title:u.Title,maxResolution:(0,X.HB)(u.MaxScaleDenominator),minResolution:(0,X.HB)(u.MinScaleDenominator),extent:z,metadata:{url:O?O.OnlineResource:void 0,extern:!!O||void 0,abstract:j,keywordList:P},legendOptions:E},queryable:Y,queryFormat:Q,timeFilter:I?w:void 0,timeFilterable:!!I||void 0,minDate:I?w.min:void 0,maxDate:I?w.max:void 0,stepDate:I?w.step:void 0});return F.BF.mergeDeep(ye,W)}parseWMTSOptions(W,A){const g=A.Contents.Layer.find(P=>P.Identifier===W.layer),u=(0,R.t)(A,W),O=Object.assign(u,W),j=F.BF.removeUndefined({_layerOptionsFromSource:{title:g.Title}});return F.BF.mergeDeep(j,O)}parseCartoOptions(W,A){const g=[],u=A.layers[1].options.layer_definition;u.layers.forEach(j=>{g.push({type:j.type.toLowerCase(),options:j.options,legend:j.legend})});const O=F.BF.removeUndefined({config:{version:u.version,layers:g}});return F.BF.mergeDeep(O,W)}parseArcgisOptions(W,A,g){const u=A.name;let O,j;O=A.drawingInfo?.renderer?A.drawingInfo.renderer:void 0,A.drawingInfo&&(j=(new x.i).generateStyle(A,"esriMeters"===A.units?"m":"degrees"));const P=new p.A({target:A.copyrightText});let Y,w;if(A.timeInfo){const s=A.timeInfo.timeExtent;Y=s[0]+","+s[1];const z=new Date;z.setTime(s[0]);const Q=new Date;Q.setTime(s[1]),w={min:z.toUTCString(),max:Q.toUTCString(),range:!0,type:h.U.DATETIME,style:h.Z.CALENDAR}}const I=Object.assign({},{style:j,LAYERS:W.layer?"show:"+W.layer:void 0,time:Y}),E=F.BF.removeUndefined({params:I,_layerOptionsFromSource:{title:u,minResolution:(0,X.HB)(A.maxScale),maxResolution:(0,X.HB)(A.minScale),metadata:{extern:!1,abstract:A.description||g.serviceDescription}},legendInfo:O,timeFilter:w,sourceFields:A.fields,queryTitle:A.displayField});return E.attributions=P,F.BF.mergeDeep(E,W)}parseTileOrImageArcgisOptions(W,A,g,u){const O=A.name,j=g.layers?g.layers.find(s=>s.layerName===O):void 0,P=new p.A({target:A.copyrightText});let Y,w;if(A.timeInfo){const s=A.timeInfo.timeExtent;Y=s[0]+","+s[1];const z=new Date;z.setTime(s[0]);const Q=new Date;Q.setTime(s[1]),w={min:z.toUTCString(),max:Q.toUTCString(),range:!0,type:h.U.DATETIME,style:h.Z.CALENDAR}}const I=Object.assign({},{LAYERS:W.layer?"show:"+W.layer:void 0,time:Y}),E=F.BF.removeUndefined({params:I,_layerOptionsFromSource:{title:O,minResolution:(0,X.HB)(A.maxScale),maxResolution:(0,X.HB)(A.minScale),metadata:{extern:!1,abstract:A.description||u.serviceDescription}},legendInfo:j,timeFilter:w,sourceFields:A.fields,queryTitle:A.displayField});return E.attributions=P,F.BF.mergeDeep(E,W)}findDataSourceInCapabilities(W,A){if(Array.isArray(W)){let g;return W.find(u=>(g=this.findDataSourceInCapabilities(u,A),void 0!==g),this),g}return W.Layer?this.findDataSourceInCapabilities(W.Layer,A):W.Name&&W.Name===A?W:void 0}getTimeFilter(W){let A;if(W.Dimension){const g={};if(A=W.Dimension[0],A.values){const u=A.values.split("/");g.min=void 0!==u[0]?u[0]:void 0,g.max=void 0!==u[1]?u[1]:void 0,g.step=void 0!==u[2]?u[2]:void 0}return A.default&&(g.value=A.default),g}}getStyle(W){return{stylesAvailable:W.map(u=>({name:u.Name,title:u.Title})).filter((u,O,j)=>j.findIndex(P=>P.name===u.name)===O)}}static \u0275fac=function(A){return new(A||U)(Z.KVO(a.Qq),Z.KVO(G.u))};static \u0275prov=Z.jDH({token:U,factory:U.\u0275fac,providedIn:"root"})}(0,M.Cg)([(0,D.R)({maxCacheCount:20}),(0,M.Sn)("design:type",Function),(0,M.Sn)("design:paramtypes",[Object]),(0,M.Sn)("design:returntype",b.c)],U.prototype,"getArcgisOptions",null),(0,M.Cg)([(0,D.R)({maxCacheCount:20}),(0,M.Sn)("design:type",Function),(0,M.Sn)("design:paramtypes",[Object]),(0,M.Sn)("design:returntype",b.c)],U.prototype,"getImageArcgisOptions",null),(0,M.Cg)([(0,D.R)({maxCacheCount:20}),(0,M.Sn)("design:type",Function),(0,M.Sn)("design:paramtypes",[Object]),(0,M.Sn)("design:returntype",b.c)],U.prototype,"getTileArcgisOptions",null),(0,M.Cg)([(0,D.R)({maxCacheCount:20}),(0,M.Sn)("design:type",Function),(0,M.Sn)("design:paramtypes",[String,String,String]),(0,M.Sn)("design:returntype",b.c)],U.prototype,"getCapabilities",null)},96875:(De,le,r)=>{"use strict";r.d(le,{n:()=>h});var M=r(30699),a=r(21701),F=r(1455),p=r(68671),e=r(75797),c=r(43942),o=r(59452),L=r(61873),R=r(61318),v=r(70271),y=r(13483),b=r(91020),k=r(3212),_=r(68559);class D{}let h=(()=>{class X{capabilitiesService;optionsService;wfsDataSourceService;languageService;messageService;authInterceptor;datasources$=new e.t([]);constructor(x,ee,Z,G,U,N){this.capabilitiesService=x,this.optionsService=ee,this.wfsDataSourceService=Z,this.languageService=G,this.messageService=U,this.authInterceptor=N}createAsyncDataSource(x,ee){if(!x.type)throw console.error(x),new Error("Datasource needs a type");let Z;switch(x.type.toLowerCase()){case"osm":Z=this.createOSMDataSource(x);break;case"vector":Z=this.createFeatureDataSource(x);break;case"wfs":Z=this.createWFSDataSource(x);break;case"wms":const G=x;p.BF.removeDuplicateCaseInsensitive(G.params),Z=this.createWMSDataSource(G,ee);break;case"wmts":Z=this.createWMTSDataSource(x);break;case"xyz":Z=this.createXYZDataSource(x);break;case"tiledebug":Z=this.createTileDebugDataSource(x);break;case"carto":Z=this.createCartoDataSource(x);break;case"arcgisrest":Z=this.createArcGISRestDataSource(x,ee);break;case"imagearcgisrest":Z=this.createArcGISRestImageDataSource(x,ee);break;case"websocket":Z=this.createWebSocketDataSource(x);break;case"mvt":Z=this.createMVTDataSource(x);break;case"tilearcgisrest":Z=this.createTileArcGISRestDataSource(x,ee);break;case"cluster":Z=this.createClusterDataSource(x);break;default:throw console.error(x),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([Z])),Z}createOSMDataSource(x){return new c.c(ee=>ee.next(new b.nk(x)))}createFeatureDataSource(x){return new c.c(ee=>ee.next(new b._k(x)))}createWebSocketDataSource(x){return new c.c(ee=>ee.next(new b.xO(x)))}createWFSDataSource(x){return new c.c(ee=>ee.next(new b._K(x,this.wfsDataSourceService,this.authInterceptor)))}createWMSDataSource(x,ee){const Z=[];return x.optionsFromCapabilities&&window.navigator.onLine&&Z.push(this.capabilitiesService.getWMSOptions(x).pipe((0,R.W)(G=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:x.params.LAYERS}),G}))),this.optionsService&&x.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getWMSOptions(x,ee).pipe((0,R.W)(G=>(G.error.toDisplay=!0,G.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),G.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),Z.push((0,o.of)(x)),(0,L.p)(Z).pipe((0,v.T)(G=>{const U=G.reduce((N,W)=>p.BF.mergeDeep(N,W));return new b.Tg(U,this.wfsDataSourceService)}),(0,R.W)(()=>(0,o.of)(void 0)))}createWMTSDataSource(x){return x.optionsFromCapabilities&&window.navigator.onLine?this.capabilitiesService.getWMTSOptions(x).pipe((0,v.T)(ee=>ee?new b.ps(ee):void 0),(0,R.W)(()=>(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:x.layer}),(0,o.of)(void 0)))):new c.c(ee=>ee.next(new b.ps(x)))}createXYZDataSource(x){return new c.c(ee=>ee.next(new b.d_(x)))}createTileDebugDataSource(x){return new c.c(ee=>ee.next(new b.PZ(x)))}createCartoDataSource(x){return x.mapId?this.capabilitiesService.getCartoOptions(x).pipe((0,v.T)(ee=>new b.fl(ee))):new c.c(ee=>ee.next(new b.fl(x)))}createArcGISRestDataSource(x,ee){const Z=[];return window.navigator.onLine&&Z.push(this.capabilitiesService.getArcgisOptions(x).pipe((0,R.W)(G=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:x.layer}),G}))),this.optionsService&&x.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getArcgisRestOptions(x,ee).pipe((0,R.W)(G=>(G.error.toDisplay=!0,G.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),G.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),Z.push((0,o.of)(x)),(0,L.p)(Z).pipe((0,v.T)(G=>{const U=G.reduce((N,W)=>p.BF.mergeDeep(N,W));return new b.Hw(U)}),(0,R.W)(()=>(0,o.of)(void 0)))}createArcGISRestImageDataSource(x,ee){const Z=[];return window.navigator.onLine&&Z.push(this.capabilitiesService.getImageArcgisOptions(x).pipe((0,R.W)(G=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:x.params.LAYERS}),G}))),this.optionsService&&x.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getArcgisRestOptions(x,ee).pipe((0,R.W)(G=>(G.error.toDisplay=!0,G.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),G.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),Z.push((0,o.of)(x)),(0,L.p)(Z).pipe((0,v.T)(G=>{const U=G.reduce((N,W)=>p.BF.mergeDeep(N,W));return new b.e(U)}),(0,R.W)(()=>(0,o.of)(void 0)))}createTileArcGISRestDataSource(x,ee){const Z=[];return window.navigator.onLine&&Z.push(this.capabilitiesService.getImageArcgisOptions(x).pipe((0,R.W)(G=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:x.params.LAYERS}),G}))),this.optionsService&&x.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getArcgisRestOptions(x,ee).pipe((0,R.W)(G=>(G.error.toDisplay=!0,G.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),G.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,o.of)({}))))),Z.push((0,o.of)(x)),(0,L.p)(Z).pipe((0,v.T)(G=>{const U=G.reduce((N,W)=>p.BF.mergeDeep(N,W));return new b.HO(U)}),(0,R.W)(()=>(0,o.of)(void 0)))}createMVTDataSource(x){return new c.c(ee=>ee.next(new b.X_(x)))}createClusterDataSource(x){return new c.c(ee=>ee.next(new b.U7(x)))}static \u0275fac=function(ee){return new(ee||X)(_.KVO(y.w),_.KVO(D,8),_.KVO(k.E),_.KVO(a.gw),_.KVO(F.bg),_.KVO(M._L))};static \u0275prov=_.jDH({token:X,factory:X.\u0275fac,providedIn:"root"})}return X})()},12171:(De,le,r)=>{"use strict";r.d(le,{U:()=>p});var M=r(68671),a=r(75181),F=r(8115);class p extends F._{createOlSource(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=super.createOlSource(),new a.A(this.options)}generateId(){return(0,M.uR)()}onUnwatch(){}}},27802:(De,le,r)=>{"use strict";r.d(le,{q:()=>a});var M=r(19807);class a{options;dataService;id;ol;legend;constructor(p={},e){this.options=p,this.dataService=e,this.options=p,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}generateId(){return(0,M._E)(this.options)}getLegend(p,e){return this.legend?this.legend:[]}setLegend(p){return this.legend=p.url?[{url:p.url}]:p.html?[{html:p.html}]:[],this.legend}}},8115:(De,le,r)=>{"use strict";r.d(le,{_:()=>e});var M=r(66586),a=r(26035),F=r(65836),p=r(27802);class e extends p.q{createOlSource(){const o={format:this.getSourceFormatFromOptions(this.options)};return new F.A(Object.assign(o,this.options))}getSourceFormatFromOptions(o){if(o.format)return o.format;let L;const R=o.formatType;if(R){if(L=a[R],void 0===L)throw new Error("Invalid vector source format ${formatType}.")}else L=M.A;const v=o.formatOptions;let y;return y=v?new L(v):new L,y}onUnwatch(){}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}}},91020:(De,le,r)=>{"use strict";r.d(le,{Hw:()=>Z,fl:()=>x,U7:()=>E.U,_k:()=>a._,e:()=>U,X_:()=>I,nk:()=>p,HO:()=>N.H,PZ:()=>g,_K:()=>y,Tg:()=>k.T,ps:()=>h,xO:()=>u,d_:()=>c});var M=r(27802),a=r(8115),F=r(53310);class p extends M.q{createOlSource(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new F.A(this.options)}onUnwatch(){}}var e=r(23448);class c extends M.q{createOlSource(){return new e.A(this.options)}onUnwatch(){}}var o=r(56372),L=r(65836),R=r(17027),v=r(55726);class y extends M.q{options;wfsService;authInterceptor;set ogcFilters(z){this.options.ogcFilters=z}get ogcFilters(){return this.options.ogcFilters}constructor(z,Q,ae){super((0,v.vj)(z,"wfs")),this.options=z,this.wfsService=Q,this.authInterceptor=ae;const ye=this.options.ogcFilters,de=this.options.paramsWFS.fieldNameGeometry||v.n3,ue=new R.l;this.options.ogcFilters=ue.defineOgcFiltersDefaultOptions(ye,de),this.options.ogcFilters.enabled&&this.options.ogcFilters.editable&&(z.sourceFields||[]).filter(ce=>!ce.values).length>0&&this.wfsService.getSourceFieldsFromWFS(this.options),ye?.pushButtons&&(ye.pushButtons.selectorType="pushButton"),ye?.checkboxes&&(ye.checkboxes.selectorType="checkbox"),ye?.radioButtons&&(ye.radioButtons.selectorType="radioButton"),ye?.select&&(ye.select.selectorType="select"),ye?.autocomplete&&(ye.autocomplete.selectorType="autocomplete"),this.setOgcFilters(this.options.ogcFilters,!0)}createOlSource(){return new L.A({format:(0,v.uz)(this.options),strategy:o.Qk})}setOgcFilters(z,Q=!1){this.ogcFilters=z,Q&&this.ol.notify("ogcFilters",this.ogcFilters)}onUnwatch(){}}r(3212);var k=r(61134),_=r(66606),D=r(65882);class h extends M.q{constructor(z){super(z)}createOlSource(){const z=Object.assign({tileGrid:(0,D.s)(this.options.projection)},this.options);return new _.A(z)}onUnwatch(){}}var X=r(23030),H=r(84547);class x extends M.q{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:H.DG.BLANK}createOlSource(){const Q=Object.assign({crossOrigin:this.options.crossOrigin?this.options.crossOrigin:"anonymous"},this.options);return new X.A(Q)}getLegend(){const z=super.getLegend();if(z.length>0)return z;let Q="<table>";if(this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(ae=>{!0===ae.visible&&(Q+='<tr><td><p><font size="5" color="'+ae.value+'"> &#9679</font></p></td><td>'+ae.name+"</td></tr>")}),Q+="</table>",[{html:Q}];{const ae=this.options.config.layers[0].options,ye=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];for(const de of ye)if(ae.cartocss.includes(de)){const ue=ae.cartocss.split(de).pop(),ce=ue.substr(0,ue.indexOf(";"));if(ce.includes("ramp")){const re=ce.split(", (")[1].split(","),be=ce.split(", (")[2].split(",");for(let _e=0;_e<re.length;_e++)re[_e]=re[_e].replace(/("|\))/g,""),be[_e]=be[_e].replace(/("|\))/g,""),"="===be[_e].replace(/\s+/g,"")&&(be[_e]="Autres"),Q+='<tr><td><p><font size="5" color="'+re[_e]+'"> &#9679</font></p></td><td>'+be[_e]+"</td></tr>";break}Q+='<tr><td><p><font size="5" color="'+ce+'"> &#9679</font></p></td><td>'+(ae.layer_name?ae.layer_name:"")+"</td></tr>";break}return Q+="</table>",[{html:Q}]}}onUnwatch(){}}var ee=r(1706);class Z extends M.q{createOlSource(){const z=new ee.A;return new L.A({attributions:this.options.params.attributions,overlaps:!1,format:z,url:function(Q,ae,ye){const de=this.options.url+"/"+this.options.layer+"/query/",ce=["f=json",`geometry=${encodeURIComponent('{"xmin":'+Q[0]+',"ymin":'+Q[1]+',"xmax":'+Q[2]+',"ymax":'+Q[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];return this.options.params.time&&ce.push(`time=${this.options.params.time}`),this.options.params.customParams&&this.options.params.customParams.forEach(re=>{ce.push(re)}),`${de}?${ce.join("&")}`}.bind(this),strategy:o.Qk})}getLegend(){const z=this.options.legendInfo,Q=super.getLegend();if(void 0===z||Q.length>0)return Q;if(!z)return;let ye,de,ue,ae="<table>";if(z.legend)for(const ce of z.legend)ye=this.htmlImgSrc(ce.contentType,ce.imageData),de=ce.label?ce.label.replace("<Null>","Null"):"",ae+="<tr><td align='left'><img src=\""+ye+'" alt =\'\' /></td><td class="mat-typography">'+de+"</td></tr>";else if("uniqueValue"===z.type)for(const ce of z.uniqueValueInfos)de=ce.label.replace("<Null>","Null"),"esriPMS"===ce.symbol.type?(ye=this.htmlImgSrc(ce.symbol.contentType,ce.symbol.imageData),ae+="<tr><td align='left'><img src=\""+ye+'" alt =\'\' /></td><td class="mat-typography">'+de+"</td></tr>"):"esriPMS"!==ce.symbol.type&&(ue=this.createSVG(ce.symbol),ae+="<tr><td align='left'>"+ue+'</td><td class="mat-typography">'+de+"</td></tr>");else"simple"===z.type&&(de=z.label?z.label.replace("<Null>","Null"):"","esriPMS"===z.symbol.type?(ye=this.htmlImgSrc(z.symbol.contentType,z.symbol.imageData),ae+="<tr><td align='left'><img src=\""+ye+'" alt =\'\' /></td><td class="mat-typography">'+de+"</td></tr>"):"esriPMS"!==z.symbol.type&&(ue=this.createSVG(z.symbol),ae+="<tr><td align='left'>"+ue+'</td><td class="mat-typography">'+de+"</td></tr>"));return ae+="</table>",[{html:ae}]}htmlImgSrc(z,Q){return`data:${z};base64,${Q}`}createSVG(z){let Q="";const ae=z.color?z.color:[0,0,0,0];if("esriSLS"===z.type){const de="stroke:rgba("+ae[0]+","+ae[1]+","+ae[2]+","+ae[3]+")",ue="stroke-width:"+(z.width?z.width:0);"esriSLSSolid"===z.style?Q='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+de+";"+ue+'"/></svg>':"esriSLSDash"===z.style&&(Q='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+de+";"+ue+'" stroke-dasharray="5,5"/></svg>')}else if("esriSMSCircle"===z.style||"esriSFSSolid"===z.style){const ye=z.outline.color,ce="stroke:rgba("+ye[0]+","+ye[1]+","+ye[2]+","+ye[3]+")",re="stroke-width:"+z.outline.width,be="fill:rgba("+ae[0]+","+ae[1]+","+ae[2]+","+ae[3]+")";Q="esriSMSCircle"===z.style?'<svg height="30" width="30"><circle cx="15" cy="15" r="'+z.size/2+'" style="'+ce+";"+re+";"+be+'"/></svg>':'<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+ce+";"+re+";"+be+'"/></svg>'}return Q}onUnwatch(){}}var G=r(54493);class U extends M.q{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:H.DG.BLANK}createOlSource(){const z=void 0===this.options.layer?this.options.params:Object.assign({LAYERS:`show:${this.options.layer}`},this.options.params);return"object"==typeof z.renderingRule&&(z.renderingRule=JSON.stringify(z.renderingRule)),new G.A({ratio:1,params:z,url:this.options.url})}getLegend(){const z=this.options.legendInfo,Q=super.getLegend();if(void 0===z||void 0===this.options.layer||Q.length>0)return Q;if(!z)return;let ae="<table>";for(const ye of z.legend)ae+=`<tr><td align='left'><img src="${this.options.url}/${z.layerId}/images/${ye.url}" alt ='' /></td><td class="mat-typography">`+ye.label.replace("<Null>","Null")+"</td></tr>";return ae+="</table>",[{html:ae}]}onUnwatch(){}}var N=r(69824),W=r(4456),A=r(54232);class g extends M.q{createOlSource(){const z=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete z.tileGrid,z.tileGrid=new A.A(this.options.tileGrid)),new W.A(z)}onUnwatch(){}}class u extends a._{ws;createOlSource(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),super.createOlSource()}createWebSocket(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}onMessage(z){const Q=this.options.format.readFeature(z.data);switch(this.options.onmessage){case"update":const ae=this.ol.getFeatureById(Q.getId());ae&&this.ol.removeFeature(ae),this.ol.addFeature(Q);break;case"delete":this.ol.clear(!0),this.ol.addFeature(Q);break;default:this.ol.addFeature(Q)}}onClose(z){}onError(z){}onOpen(z){}onUnwatch(){this.ws.close()}}var O=r(68671),j=r(94691),P=r(20540),Y=r(82749),w=r(31191);class I extends M.q{createOlSource(){let z;return z="feature"===this.options.featureClass?new P.A({featureClass:j.A}):new P.A,this.options.format=z,new Y.A(this.options)}generateId(){return this.options.url?w.VV.hashStr("mvt"+this.options.url):(0,O.uR)()}onUnwatch(){}}var E=r(12171)},69824:(De,le,r)=>{"use strict";r.d(le,{H:()=>p});var M=r(32696),a=r(84547),F=r(27802);class p extends F.q{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:a.DG.BLANK}createOlSource(){return new M.A(this.options)}getLegend(){const c=this.options.legendInfo,o=super.getLegend();if(void 0===c||void 0===this.options.layer||o.length>0)return o;if(!c)return;let L="<table>";for(const R of c.legend)L+=`<tr><td align='left'><img src="${this.options.url}/${c.layerId}/images/${R.url}" alt ='' /></td><td class="mat-typography">`+R.label.replace("<Null>","Null")+"</td></tr>";return L+="</table>",[{html:L}]}onUnwatch(){}}},3212:(De,le,r)=>{"use strict";r.d(le,{E:()=>R});var M=r(43942),a=r(59452),F=r(19999),p=r(51903);class e{}var c=r(55726),o=r(68559),L=r(46443);let R=(()=>{class v extends e{http;constructor(b){super(),this.http=b}getData(){return console.log("This is defining a data service."),"This is defining a data service."}getSourceFieldsFromWFS(b){b.sourceFields&&0!==b.sourceFields.length?this.defineFieldAndValuefromWFS(b).subscribe(k=>{b.sourceFields.forEach(_=>{void 0===_.alias&&(_.alias=_.name),(void 0===_.values||0===_.values.length)&&(_.values=k.find(D=>D.name===_.name).values)})}):(b.sourceFields=[],this.defineFieldAndValuefromWFS(b).subscribe(k=>{b.sourceFields=k}))}wfsGetFeature(b,k=c.X2,_=c.Xv,D,h=0,X=!1){const x=(0,c.FK)(b,k,_,D,h,X).find(Z=>"getfeature"===Z.name).value,ee=b.paramsWFS.outputFormat;return X||c.si.test(ee)||!ee?this.http.get(x,{responseType:"text"}):this.http.get(x)}defineFieldAndValuefromWFS(b){return new M.c(k=>{const _=[];let D,h,X,H,x;H=(0,c.uz)(b);const ee=JSON.parse(JSON.stringify(b));delete ee.paramsWFS.outputFormat,delete ee.formatOptions,x=(0,c.uz)(ee);let Z=b.sourceFields?.filter(G=>!G.values).map(G=>G.name);this.wfsGetFeature(b,1,void 0,void 0,0,!0).pipe((0,p.H)(G=>String(G).toLowerCase().includes("exception")?(0,a.of)(!1):(0,a.of)(!0)),(0,p.H)(G=>this.wfsGetFeature(b,1).pipe((0,p.H)(U=>{const N=H.readFeatures(U);D=N[0].getKeys(),(b.sourceFields||0===b.sourceFields.length)&&(Z=D),h=D.filter(g=>Z.includes(g)&&g!==N[0].getGeometryName()&&!g.match(/boundedby/gi)),X=h.join(",");const W=[];let A=0;if(!G&&"2.0.0"===b.paramsWFS.version&&b.paramsWFS.maxFeatures>c.X2){for(;A<b.paramsWFS.maxFeatures;)W.push(this.wfsGetFeature(b,1e3,b.paramsWFS.srsName,X,A)),A+=1e3;x=H}else W.push(this.wfsGetFeature(b,b.paramsWFS.maxFeatures||c.X2,b.paramsWFS.srsName,X,0,!0));return(0,F.z)(W)})))).subscribe(G=>{let U=[];G.map(N=>{const W=x.readFeatures(N);U=U.concat(W)}),this.built_properties_value(U).forEach(N=>{_.push(N)}),k.next(_),k.complete()})})}built_properties_value(b){if(0===b.length)return[];const k=Object.assign({},b[0].getProperties());delete k[b[0].getGeometryName()],delete k.boundedBy;const _=[];for(const D in k)if(k.hasOwnProperty(D)){const h="object"==typeof b[0].get(D)?void 0:typeof b[0].get(D);_.push({name:D,alias:D,type:h,values:[k[D]]})}return b.every(D=>{const h=D.getProperties();for(const X in h)h.hasOwnProperty(X)&&X in k&&_.filter(H=>H.name===X).forEach(H=>{-1===H.values.indexOf(h[X])&&H.values.push(h[X])});return!0}),_}static \u0275fac=function(k){return new(k||v)(o.KVO(L.Qq))};static \u0275prov=o.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},61134:(De,le,r)=>{"use strict";r.d(le,{T:()=>L});var M=r(68671),a=r(66200),F=r(75797),p=r(17027),e=r(84547),c=r(27802),o=r(55726);class L extends c.q{options;wfsService;get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:e.DG.BLANK}set ogcFilters(v){this.options.ogcFilters=v}get ogcFilters(){return this.options.ogcFilters}set timeFilter(v){this.options.timeFilter=v}get timeFilter(){return this.options.timeFilter}timeFilter$=new F.t(void 0);constructor(v,y){super(v),this.options=v,this.wfsService=y;const b=v.params,k=b.DPI||96;b.DPI=k,b.MAP_RESOLUTION=k,b.FORMAT_OPTIONS="dpi:"+k,v.refreshIntervalSec&&v.refreshIntervalSec>0&&setInterval(()=>{this.refresh()},1e3*v.refreshIntervalSec);let _=o.n3;if(v.paramsWFS){const x=(0,o.vj)(v,"wms");M.BF.mergeDeep(v.paramsWFS,x.paramsWFS),_=v.paramsWFS.fieldNameGeometry||_,v.download=Object.assign({},v.download,{dynamicUrl:this.buildDynamicDownloadUrlFromParamsWFS(v)})}v.sourceFields&&0!==v.sourceFields.length?v.sourceFields.forEach(x=>{x.alias=x.alias?x.alias:x.name}):v.sourceFields=[];const D=v.ogcFilters,h=new p.l;D?(D.advancedOgcFilters=!(D.pushButtons||D.checkboxes||D.radioButtons||D.select||D.autocomplete),D.advancedOgcFilters&&D.filters&&D.filters.calendarModeYear&&(D.advancedOgcFilters=!1),D.pushButtons&&(D.pushButtons.selectorType="pushButton"),D.checkboxes&&(D.checkboxes.selectorType="checkbox"),D.radioButtons&&(D.radioButtons.selectorType="radioButton"),D.select&&(D.select.selectorType="select"),D.autocomplete&&(D.autocomplete.selectorType="autocomplete")):v.ogcFilters=h.defineOgcFiltersDefaultOptions(D,_,"wms"),b.LAYERS.split(",").length>1&&D&&D.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+b.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),v.paramsWFS&&D&&D.enabled&&D.editable&&(v.sourceFields||[]).filter(x=>!x.values).length>0&&this.wfsService.getSourceFieldsFromWFS(v);const X=h.handleOgcFiltersAppliedValue(v,_);b.FILTER=X,this.ol.updateParams({FILTER:b.FILTER}),this.setOgcFilters(D,!0);const H=v;H?.timeFilterable&&H?.timeFilter&&this.setTimeFilter(H.timeFilter,!0)}refresh(){this.ol.updateParams({igoRefresh:Math.random()})}buildDynamicDownloadUrlFromParamsWFS(v){return(0,o.FK)(v).find(k=>"getfeature"===k.name).value}createOlSource(){return new a.A(Object.assign({ratio:1},this.options))}setOgcFilters(v,y=!1){this.ogcFilters=v,y&&this.ol.notify("ogcFilters",this.ogcFilters)}setTimeFilter(v,y=!1){this.timeFilter=v,y&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}getLegend(v,y){let b=super.getLegend();if(b.length>0&&void 0===v&&!y?.scale)return b;let _,k=!1;y?.size&&y?.extent&&y?.projection&&this.options.contentDependentLegend&&(_="1.3.0"===this.params.VERSION||void 0===this.params.VERSION?"CRS":"SRS",k=!0);const D=this.params;let h=[];void 0!==D.LAYERS&&(h=D.LAYERS.split(","));const X=this.options.url.replace(/\?$/,""),H=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0",`VERSION=${D.VERSION||"1.3.0"}`];return void 0!==v&&H.push(`STYLE=${v}`),void 0!==y?.scale&&H.push(`SCALE=${y.scale}`),k&&(H.push(`WIDTH=${y.size[0]}`),H.push(`HEIGHT=${y.size[1]}`),H.push(`BBOX=${y.extent.join(",")}`),H.push(`${_}=${y.projection}`)),b=h.map(x=>{const ee=X.match(/\?/)?"&":"?";return{url:`${X}${ee}${H.join("&")}&LAYER=${x}`,title:h.length>1?x:void 0,currentStyle:void 0===v?void 0:v}}),b}onUnwatch(){}}},55726:(De,le,r)=>{"use strict";r.d(le,{FK:()=>Z,X2:()=>D,Xv:()=>_,c$:()=>ee,n3:()=>X,si:()=>H,uz:()=>U,vj:()=>G});var M=r(5247),a=r(26035),F=r(30399),p=r(66586),e=r(1706),c=r(15852),o=r(34927),L=r(34997),R=r(37923),v=r(16636),y=r(97036),b=r(10615),k=r(17027);const _="EPSG:3857",D=5e3,h="2.0.0",X="geometry",H=new RegExp(/(.*)?gml(.*)?/gi);function ee(N,W,A,g,u){const O=N.paramsWFS,j=Z(N,void 0,N.paramsWFS.srsName);let P;g?.enabled&&(P=g?.filters);const Y=new k.l,w=Y.buildFilter(P,W,A,g?.geometryName,N);let I=Y.handleOgcFiltersAppliedValue(N,g?.geometryName,W,A),E="filter";I||(E="bbox",I=W.join(",")+","+A.getCode()),O.xmlFilter=g?.advancedOgcFilters?w:`${E}=${I}`;let s=j.find(Q=>"getfeature"===Q.name).value;return s=/(filter|bbox)=.*/gi.test(O.xmlFilter)?`${s}&${O.xmlFilter}`:s,N.download=Object.assign({},N.download,{dynamicUrl:s}),u&&(s+=`$&_t${(new Date).getTime()}`),s.replace(/&&/g,"&")}function Z(N,W,A,g,u=0,O=!1){const j="2.0.0",P=N.urlWfs,Y=N.paramsWFS,w=W||D,I=Y.version===j?`startIndex=${u}`:"",E=A||_;let s=Y.outputFormat?`outputFormat=${Y.outputFormat}`:"",z=Y.version?`version=${Y.version}`:`version=${h}`;const ae=`${Y.version===j?"typenames":"typename"}=${Y.featureTypes}`,ye=Y.version===j?"count":"maxFeatures";let de=W?`${ye}=${w}`:Y.maxFeatures?`${ye}=${Y.maxFeatures}`:`${ye}=${w}`;O&&(s="",z="version=1.1.0",de=de.replace("count","maxFeatures"));const ue=A?`srsname=${E}`:Y.srsName?"srsname="+Y.srsName:`srsname=${E}`;let ce="",re="";g&&(ce=`propertyName=${g}`,re=`valueReference=${g}`);const be=N.sourceFields;if(!ce&&be&&be.length>0){const Be=[];N.sourceFields.forEach(rt=>{Be.push(rt.name)}),ce=`propertyName=${Be.join(",")},${Y.fieldNameGeometry}`}const _e=-1===P.indexOf("?")?"?":"&";let We=`${P}${_e}service=WFS&request=GetFeature&${z}&${ae}&`;We+=`${s}&${ue}&${de}&${ce}&${I}`;let Xe=`${P}?service=WFS&request=GetPropertyValue&version=${j}&${ae}&`;return Xe+=`&${de}&${re}`,[{name:"outputformat",value:s},{name:"version",value:z},{name:"typename",value:ae},{name:"count",value:de},{name:"srsname",value:ue},{name:"propertyname",value:ce},{name:"valuereference",value:re},{name:"getcapabilities",value:`${P}${_e}service=WFS&request=GetCapabilities&${z}`.replace(/&&/g,"&")},{name:"getfeature",value:We.replace(/&&/g,"&")},{name:"getpropertyvalue",value:Xe.replace(/&&/g,"&")}]}function G(N,W){W&&"wfs"===W&&(N.paramsWFS=N.params);const A=N.paramsWFS;let g;return N.urlWfs=N.urlWfs||N.url,A.version=A.version||h,A.fieldNameGeometry=A.fieldNameGeometry||X,A.maxFeatures=A.maxFeatures||D,A.outputFormat&&(g=A.outputFormat),(H.test(g)||!g)&&(A.version="1.1.0"),Object.assign({},N)}function U(N){const W=N;let A;const g=W.paramsWFS.outputFormat?W.paramsWFS.outputFormat:void 0;return g?a[g]?(A=a[g],new A(W.formatOptions)):g.toLowerCase().match("gml2")?(A=M.A,new A({...W.formatOptions,gmlFormat:R.A})):g.toLowerCase().match("gml32")?(A=M.A,new A({...W.formatOptions,gmlFormat:y.A})):g.toLowerCase().match("gml3")?(A=M.A,new A({...W.formatOptions,gmlFormat:v.A})):g.toLowerCase().match("topojson")?(A=F.A,new A(W.formatOptions)):g.toLowerCase().match("geojson")?(A=p.A,new A(W.formatOptions)):g.toLowerCase().match("esrijson")?(A=e.A,new A(W.formatOptions)):g.toLowerCase().match("json")?(A=p.A,new A(W.formatOptions)):g.toLowerCase().match("gpx")?(A=c.A,new A(W.formatOptions)):g.toLowerCase().match("WKT")?(A=o.A,new A(W.formatOptions)):g.toLowerCase().match("osmxml")?(A=b.A,new A(W.formatOptions)):g.toLowerCase().match("kml")?(A=L.Ay,new A(W.formatOptions)):new A:(A=M.A,new A(W.formatOptions))}},65882:(De,le,r)=>{"use strict";r.d(le,{s:()=>p});var M=r(84505),a=r(63886),F=r(81293);function p(e){const o=a.Jt(e||"EPSG:3857").getExtent(),L=(0,M.RG)(o)/256,R=new Array(20),v=new Array(20);for(let y=0;y<20;++y)R[y]=L/Math.pow(2,y),v[y]=y;return new F.A({origin:(0,M.Py)(o),resolutions:R,matrixIds:v})}},68077:(De,le,r)=>{"use strict";r.d(le,{f:()=>G});var M=r(60316),a=r(84175),F=r(93840),p=r(80640),e=r(21701),c=r(1455),o=r(71424),L=r(68671),R=r(84205),v=r(75797),y=r(64004),b=r(85447),k=r(4514),D=(r(1666),r(68559)),h=r(90852);function X(U,N){if(1&U){const W=D.RV6();D.j41(0,"button",5),D.nI1(1,"translate"),D.bIt("click",function(){D.eBV(W);const g=D.XpG();return D.Njj(g.resetStops())}),D.j41(2,"mat-icon"),D.EFF(3,"restore_page"),D.k0s()()}2&U&&D.Y8G("matTooltip",D.bMT(1,1,"igo.geo.directionsForm.resetDirectionsBtn"))}function H(U,N){if(1&U){const W=D.RV6();D.j41(0,"button",1),D.nI1(1,"translate"),D.bIt("click",function(){D.eBV(W);const g=D.XpG();return D.Njj(g.zoomRoute())}),D.j41(2,"mat-icon"),D.EFF(3,"zoom_in"),D.k0s()()}2&U&&D.Y8G("matTooltip",D.bMT(1,1,"igo.geo.directionsForm.zoomRoute"))}function x(U,N){if(1&U){const W=D.RV6();D.j41(0,"button",1),D.nI1(1,"translate"),D.bIt("click",function(){D.eBV(W);const g=D.XpG();return D.Njj(g.copyDirectionsToClipboard())}),D.j41(2,"mat-icon"),D.EFF(3,"content_copy"),D.k0s()()}2&U&&D.Y8G("matTooltip",D.bMT(1,1,"igo.geo.directionsForm.copy"))}function ee(U,N){if(1&U){const W=D.RV6();D.j41(0,"button",1),D.nI1(1,"translate"),D.bIt("click",function(){D.eBV(W);const g=D.XpG();return D.Njj(g.copyLinkToClipboard())}),D.j41(2,"mat-icon"),D.EFF(3,"link"),D.k0s()()}2&U&&D.Y8G("matTooltip",D.bMT(1,1,"igo.geo.directionsForm.link"))}function Z(U,N){if(1&U){const W=D.RV6();D.j41(0,"button",6),D.nI1(1,"async"),D.nI1(2,"translate"),D.bIt("click",function(){D.eBV(W);const g=D.XpG();return D.Njj(g.printDirections())}),D.j41(3,"mat-icon"),D.EFF(4,"print"),D.k0s()()}if(2&U){const W=D.XpG();D.Y8G("disabled",D.bMT(1,2,W.disabled$))("matTooltip",D.bMT(2,4,"igo.geo.directionsForm.print"))}}let G=(()=>{class U{languageService;messageService;route;directionsService;get activeRoute(){return this.routesFeatureStore.all().find(W=>W.properties.active)}contextUri;zoomToActiveRoute$=new R.B;stopsStore;routesFeatureStore;stepFeatureStore;disabled$=new v.t(!1);constructor(W,A,g,u){this.languageService=W,this.messageService=A,this.route=g,this.directionsService=u}resetStops(){this.stopsStore.clearStops()}addStop(){(0,k.QG)(this.stopsStore)}copyLinkToClipboard(){L.B0.copy(this.getUrl())&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsgLink","igo.geo.directionsForm.dialog.copyTitle")}zoomRoute(){this.zoomToActiveRoute$.next()}copyDirectionsToClipboard(){const W=this.directionsToText();L.B0.copy(W)&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsg","igo.geo.directionsForm.dialog.copyTitle")}directionsToText(){const W="\t";let A=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",g="";const u=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n"+W+this.activeRoute.properties.direction.title+"\n"+W+(0,k.BO)(this.activeRoute.properties.direction.distance)+"\n"+W+(0,k.a3)(this.activeRoute.properties.direction.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",O=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n"+W+this.getUrl();let j=1;this.stopsStore.view.all().forEach(w=>{let I="",E="";w.text!==(0,y.ho)(w.coordinates).join(",")?(E=w.text,I=` ( ${(0,y.ho)(w.coordinates).join(",")} )`):E=(0,y.ho)(w.coordinates).join(","),g=g+W+j.toLocaleString()+". "+E+I+"\n",j++});let P=0;return this.activeRoute.properties.direction.steps.forEach(w=>{const I=this.formatStep(w,P).instruction,E=void 0===(0,k.BO)(w.distance)?"":" ("+(0,k.BO)(w.distance)+")";A=A+W+(P+1).toLocaleString()+". "+I+E+"\n",P++}),u+g+"\n"+O+"\n\n"+A}formatStep(W,A){return(0,k.EI)(W.maneuver.type,W.maneuver.modifier,W.name,W.maneuver.bearing_after,A,W.maneuver.exit,this.languageService,A===this.activeRoute.properties.direction.steps.length-1)}getUrl(){if(!this.route)return;let W="";this.contextUri&&(W=`context=${this.contextUri}&`);const A=this.routesFeatureStore.all().map(P=>P.properties.id).indexOf(this.activeRoute.properties.id);let g="";0!==A&&(g=`&${this.route.options.directionsOptionsKey}=result:${A}`);const u=this.route.options.directionsCoordKey,O=this.stopsStore.view.all().map(P=>(0,y.ho)(P.coordinates,6));let j="";return O.length>=2?(j=`${u}=${O.join(";")}`,`${location.origin}${location.pathname}?${W}tool=directions&sidenav=1&${j}${g}`):void 0}printDirections(){this.stepFeatureStore.clear(),this.disabled$.next(!0),this.directionsService.downloadDirection(this.routesFeatureStore.map,this.activeRoute.properties.direction).subscribe(()=>{this.disabled$.next(!1)})}static \u0275fac=function(A){return new(A||U)(D.rXU(e.gw),D.rXU(c.bg),D.rXU(o.v$,8),D.rXU(b.YK))};static \u0275cmp=D.VBU({type:U,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomToActiveRoute$:"zoomToActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[D.aNF],decls:16,vars:20,consts:[[1,"igo-form-button-group"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"click","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"click","disabled","matTooltip"]],template:function(A,g){1&A&&(D.j41(0,"div",0)(1,"button",1),D.nI1(2,"translate"),D.bIt("click",function(){return g.addStop()}),D.j41(3,"mat-icon"),D.EFF(4,"add_location_alt"),D.k0s()(),D.DNE(5,X,4,3,"button",2),D.nI1(6,"async"),D.nI1(7,"async"),D.DNE(8,H,4,3,"button",3),D.nI1(9,"async"),D.DNE(10,x,4,3,"button",3),D.nI1(11,"async"),D.DNE(12,ee,4,3,"button",3),D.nI1(13,"async"),D.DNE(14,Z,5,6,"button",4),D.nI1(15,"async"),D.k0s()),2&A&&(D.R7$(),D.Y8G("matTooltip",D.bMT(2,6,"igo.geo.directionsForm.addStop")),D.R7$(4),D.Y8G("ngIf",D.bMT(6,8,g.routesFeatureStore.count$)>=1||D.bMT(7,10,g.stopsStore.count$)>=1),D.R7$(3),D.Y8G("ngIf",D.bMT(9,12,g.routesFeatureStore.count$)>=1),D.R7$(2),D.Y8G("ngIf",D.bMT(11,14,g.routesFeatureStore.count$)>=1),D.R7$(2),D.Y8G("ngIf",D.bMT(13,16,g.routesFeatureStore.count$)>=1),D.R7$(2),D.Y8G("ngIf",D.bMT(15,18,g.routesFeatureStore.count$)>=1))},dependencies:[a.Hl,a.iY,p.uc,p.oV,F.m_,F.An,M.bT,M.Jj,e.Ck,h.D9]})}return U})()},24335:(De,le,r)=>{"use strict";r.d(le,{f:()=>g});var M=r(50854),a=r(60316),F=r(68559),p=r(34456),e=r(79771),c=r(84175),o=r(85060),L=r(15944),R=r(93840),v=r(87984),y=r(80640),b=r(21701),k=r(12912),_=r(63886),D=r(23984),h=r(64004),X=r(82182),H=r(4514),ee=(r(1666),r(90852));function Z(u,O){if(1&u){const j=F.RV6();F.j41(0,"button",11),F.nI1(1,"translate"),F.bIt("click",function(){F.eBV(j);const Y=F.XpG().$implicit,w=F.XpG();return F.Njj(w.clearStop(Y))}),F.j41(2,"mat-icon"),F.EFF(3,"close"),F.k0s()()}2&u&&F.Y8G("matTooltip",F.bMT(1,1,"igo.geo.directionsForm.clearStop"))}function G(u,O){if(1&u&&(F.j41(0,"mat-option",14),F.EFF(1),F.k0s()),2&u){const j=O.$implicit;F.Y8G("value",j)("matTooltip",j.meta?j.meta.title:""),F.R7$(),F.SpI(" ",j.meta?j.meta.title:""," ")}}function U(u,O){if(1&u&&(F.j41(0,"mat-optgroup",12),F.DNE(1,G,2,3,"mat-option",13),F.k0s()),2&u){const j=O.$implicit;F.Y8G("label",j.source.title)("disabled",!1===j.source.enabled),F.R7$(),F.Y8G("ngForOf",j.results)}}function N(u,O){if(1&u){const j=F.RV6();F.j41(0,"button",18),F.nI1(1,"translate"),F.bIt("click",function(){F.eBV(j);const Y=F.XpG(2).$implicit,w=F.XpG();return F.Njj(w.removeStop(Y))}),F.j41(2,"mat-icon"),F.EFF(3,"delete"),F.k0s()()}2&u&&F.Y8G("matTooltip",F.bMT(1,1,"igo.geo.directionsForm.removeStop"))}function W(u,O){if(1&u&&(F.j41(0,"div",15)(1,"button",16),F.nI1(2,"translate"),F.j41(3,"mat-icon"),F.EFF(4,"drag_indicator"),F.k0s()(),F.DNE(5,N,4,3,"button",17),F.nI1(6,"async"),F.k0s()),2&u){const j=F.XpG(2);F.R7$(),F.Y8G("matTooltip",F.bMT(2,2,"igo.geo.directionsForm.moveStop")),F.R7$(4),F.Y8G("ngIf",F.bMT(6,4,j.stopsStore.count$)>2)}}function A(u,O){if(1&u){const j=F.RV6();F.j41(0,"div",3),F.bIt("touchenter",function(){const Y=F.eBV(j).$implicit,w=F.XpG();return F.Njj(w.onStopEnter(Y))})("touchleave",function(){F.eBV(j);const Y=F.XpG();return F.Njj(Y.onStopLeave())})("mouseover",function(){const Y=F.eBV(j).$implicit,w=F.XpG();return F.Njj(w.onStopEnter(Y))})("mouseleave",function(){F.eBV(j);const Y=F.XpG();return F.Njj(Y.onStopLeave())})("cdkDragStarted",function(){F.eBV(j);const Y=F.XpG();return F.Njj(Y.stopIsDragged=!0)})("cdkDragEnded",function(){F.eBV(j);const Y=F.XpG();return F.Njj(Y.stopIsDragged=!1)}),F.j41(1,"div",4)(2,"mat-form-field",5)(3,"mat-label"),F.EFF(4),F.k0s(),F.j41(5,"input",6),F.bIt("focus",function(){const Y=F.eBV(j).$implicit,w=F.XpG();return F.Njj(w.onInputFocus(Y))}),F.mxI("ngModelChange",function(Y){const w=F.eBV(j).$implicit;return F.DH7(w.text,Y)||(w.text=Y),F.Njj(Y)}),F.bIt("keyup",function(Y){const w=F.eBV(j).$implicit,I=F.XpG();return F.Njj(I.setStopText(Y,w))})("keydown.enter",function(Y){return F.eBV(j),F.Njj(Y.preventDefault())}),F.k0s(),F.DNE(6,Z,4,3,"button",7),F.j41(7,"mat-autocomplete",8,0),F.bIt("optionSelected",function(Y){const w=F.eBV(j).$implicit,I=F.XpG();return F.Njj(I.chooseProposal(Y,w))}),F.DNE(9,U,2,3,"mat-optgroup",9),F.k0s()()(),F.DNE(10,W,7,6,"div",10),F.k0s()}if(2&u){const j=O.$implicit,P=F.sdS(8),Y=F.XpG();F.R7$(),F.Y8G("ngClass",Y.getNgClass(j)),F.R7$(3),F.JRh(Y.getPlaceholder(j)),F.R7$(),F.FS9("id",j.id),F.Y8G("placeholder",Y.getPlaceholder(j))("matTooltip",j.text),F.R50("ngModel",j.text),F.Y8G("matAutocomplete",P),F.R7$(),F.Y8G("ngIf",(j.text||j.coordinates)&&Y.stopWithHover&&j.id===Y.stopWithHover.id),F.R7$(),F.Y8G("displayWith",Y.getOptionText),F.R7$(2),F.Y8G("ngForOf",j.searchProposals),F.R7$(),F.Y8G("ngIf",!Y.stopIsDragged&&Y.stopWithHover&&j.id===Y.stopWithHover.id)}}let g=(()=>{class u{languageService;invalidKeys=["Control","Shift","Alt"];onMapClickEventKeys=[];stopWithHover;stopIsDragged=!1;stopsStore;stopsFeatureStore;projection;coordRoundedDecimals=6;debounce=200;length=2;stopInputHasFocus=new F.bkB(!1);constructor(j){this.languageService=j}ngOnDestroy(){this.unlistenMapSingleClick()}onStopEnter(j){this.stopWithHover=j}onStopLeave(){this.stopWithHover=void 0}getOptionText(j){return j instanceof Object?j?.meta?j.meta.title:"":j}chooseProposal(j,P){const Y=j.option.value;if(Y){let w;const I=Y.geometry;if("Point"===I.type)w=I.coordinates;else{const E=(0,D.A)(Y.geometry);w=[E.geometry.coordinates[0],E.geometry.coordinates[1]]}w&&(P.coordinates=w,P.text=Y.meta.title,this.stopsStore.update(P))}}setStopText(j,P){this.unlistenMapSingleClick();const Y=j.target.value;0===Y.length?this.clearStop(P):this.validateTerm(Y)&&(P.text=Y,this.stopsStore.update(P))}validateTerm(j){return!(!this.keyIsValid(j)||!(j.length>=this.length||0===j.length))}keyIsValid(j){return void 0===this.invalidKeys.find(P=>P===j)}getNgClass(j){return this.stopWithHover&&j.id===this.stopWithHover.id?"igo-input-container reduce":"igo-input-container"}getPlaceholder(j){let P="";return j.relativePosition?(j.relativePosition===X.XX.Intermediate&&(P=" #"+j.position),this.languageService.translate.instant("igo.geo.directionsForm."+j.relativePosition)+P):""}removeStop(j){(0,H.gk)(this.stopsStore,j)}clearStop(j){this.stopsStore.update({id:j.id,relativePosition:j.relativePosition,position:j.position})}drop(j){this.moveStops(j.previousIndex,j.currentIndex)}moveStops(j,P){if(j!==P){const Y=[...this.stopsStore.view.all()];(0,M.HD)(Y,j,P),Y.map((w,I)=>{w.relativePosition=(0,H.jb)(I,Y.length),w.position=I}),this.stopsStore.updateMany(Y),(0,H.N5)(this.stopsStore)}}onInputFocus(j){(!j.text||0===j.text?.length)&&(this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(j))}listenMapSingleClick(j){const P=this.stopsFeatureStore.layer.map.ol.once("singleclick",Y=>{const w=_.pd(Y.coordinate,this.stopsFeatureStore.layer.map.projection,this.projection),I=(0,h.ho)(w,this.coordRoundedDecimals);j.text=I.join(","),j.coordinates=I,this.stopsStore.update(j),setTimeout(()=>{this.stopInputHasFocus.emit(!1)},500)});this.onMapClickEventKeys.push(P)}unlistenMapSingleClick(){this.onMapClickEventKeys.map(j=>{k.e(j)}),this.onMapClickEventKeys=[]}static \u0275fac=function(P){return new(P||u)(F.rXU(b.gw))};static \u0275cmp=F.VBU({type:u,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},standalone:!0,features:[F.aNF],decls:3,vars:3,consts:[["auto","matAutocomplete"],["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["touchleave","","cdkDragLockAxis","y","class","stop-box","cdkDrag","",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded",4,"ngFor","ngForOf"],["touchleave","","cdkDragLockAxis","y","cdkDrag","",1,"stop-box",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],[3,"ngClass"],["subscriptSizing","dynamic"],["type","text","matTooltipShowDelay","500","aria-label","Number","matInput","",3,"focus","ngModelChange","keyup","keydown.enter","id","placeholder","matTooltip","ngModel","matAutocomplete"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","igo-form-button-group",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"click","matTooltip"],[3,"label","disabled"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"igo-form-button-group"],["cdkDragHandle","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"swipe-vertical",3,"matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip"]],template:function(P,Y){1&P&&(F.j41(0,"div",1),F.bIt("cdkDropListDropped",function(I){return Y.drop(I)}),F.DNE(1,A,11,11,"div",2),F.nI1(2,"async"),F.k0s()),2&P&&(F.R7$(),F.Y8G("ngForOf",F.bMT(2,1,Y.stopsStore.view.all$())))},dependencies:[M.O7,a.pM,M.T1,a.YU,L.RG,L.rl,L.nJ,L.yw,v.fS,v.fg,p.YN,p.me,p.BC,p.vS,e.jL,e.$3,o.wT,o.D7,e.pN,y.uc,y.oV,a.bT,c.Hl,c.iY,R.m_,R.An,o.Sy,M.Fb,a.Jj,b.Ck,ee.D9],styles:["[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{display:flex;align-items:center;padding-left:12px}[_nghost-%COMP%]   .stops-list[_ngcontent-%COMP%]{max-width:100%;min-height:60px;display:block;background:#fff;border-radius:4px;overflow:hidden;padding:20px 10px}[_nghost-%COMP%]   .swipe-vertical[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]{color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:#fff}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}[_nghost-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}[_nghost-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]   .stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return u})()},94663:(De,le,r)=>{"use strict";r.d(le,{g:()=>A});var M=r(60316),a=r(34456),F=r(85060),p=r(14102),e=r(15944),c=r(93840),o=r(20943),L=r(25175),R=r(21701),v=r(94691),y=r(66586),b=r(76983),k=r(49964),_=r(52575),D=r(3439),h=r(82182),X=r(4514),x=(r(1666),r(68559)),ee=r(90852);function Z(g,u){if(1&g&&(x.j41(0,"mat-option",9),x.EFF(1),x.k0s()),2&g){const O=u.$implicit,j=u.index,P=x.XpG(3);x.Y8G("value",O),x.R7$(),x.E5c(" Option ",j+1," : ",P.formatDistance(O.distance)," (",P.formatDuration(O.duration),") ")}}function G(g,u){if(1&g){const O=x.RV6();x.j41(0,"mat-form-field")(1,"mat-label"),x.EFF(2),x.nI1(3,"translate"),x.k0s(),x.j41(4,"mat-select",7),x.nI1(5,"translate"),x.bIt("selectionChange",function(){x.eBV(O);const P=x.XpG(2);return x.Njj(P.changeRoute())}),x.mxI("ngModelChange",function(P){x.eBV(O);const Y=x.XpG(2);return x.DH7(Y.activeDirection,P)||(Y.activeDirection=P),x.Njj(P)}),x.DNE(6,Z,2,4,"mat-option",8),x.k0s()()}if(2&g){const O=x.XpG(2);x.R7$(2),x.JRh(x.bMT(3,4,"igo.geo.directionsForm.drivingOptions")),x.R7$(2),x.FS9("placeholder",x.bMT(5,6,"igo.geo.directionsForm.drivingOptions")),x.R50("ngModel",O.activeDirection),x.R7$(2),x.Y8G("ngForOf",O.directions)}}function U(g,u){1&g&&x.nrm(0,"mat-divider")}function N(g,u){if(1&g){const O=x.RV6();x.j41(0,"mat-list-item",10),x.bIt("mouseenter",function(){const P=x.eBV(O).$implicit,Y=x.XpG(2);return x.Njj(Y.showSegment(P))})("click",function(){const P=x.eBV(O).$implicit,Y=x.XpG(2);return x.Njj(Y.showSegment(P,!0))}),x.j41(1,"mat-icon",11),x.EFF(2),x.k0s(),x.j41(3,"span",12),x.EFF(4),x.k0s(),x.j41(5,"span",13),x.EFF(6),x.k0s()()}if(2&g){const O=u.$implicit,j=u.index,P=x.XpG(2);x.R7$(),x.Y8G("ngClass",P.formatStep(O,j).cssClass),x.R7$(),x.SpI("",P.formatStep(O,j).image," "),x.R7$(2),x.Lme(" ",j+1,". ",P.formatStep(O,j).instruction," "),x.R7$(2),x.SpI(" ",P.formatDistance(O.distance)," ")}}function W(g,u){if(1&g){const O=x.RV6();x.j41(0,"div",1),x.DNE(1,G,7,8,"mat-form-field",2)(2,U,1,0,"mat-divider",2),x.j41(3,"mat-list",3),x.bIt("mouseleave",function(){x.eBV(O);const P=x.XpG();return x.Njj(P.onStepsListBlur())}),x.j41(4,"h2",4),x.EFF(5),x.k0s(),x.j41(6,"span",5),x.EFF(7),x.k0s(),x.DNE(8,N,7,5,"mat-list-item",6),x.nrm(9,"mat-divider"),x.k0s()()}if(2&g){const O=x.XpG();x.R7$(),x.Y8G("ngIf",O.directions&&O.directions.length>1),x.R7$(),x.Y8G("ngIf",O.directions&&0===O.directions.length),x.R7$(3),x.JRh(O.activeDirection.title),x.R7$(2),x.Lme(" ",O.formatDistance(O.activeDirection.distance),", ",O.formatDuration(O.activeDirection.duration)," "),x.R7$(),x.Y8G("ngForOf",O.activeDirection.steps)}}let A=(()=>{class g{languageService;cdRef;activeDirection;directions;entities$$;routesFeatureStore;stepFeatureStore;constructor(O,j){this.languageService=O,this.cdRef=j}ngOnInit(){this.entities$$=this.routesFeatureStore.entities$.pipe((0,_.B)(200)).subscribe(O=>{const j=O.find(P=>P.properties.active);this.directions=O.map(P=>P.properties.direction),this.activeDirection=j?j.properties.direction:void 0,this.cdRef.detectChanges()})}ngOnDestroy(){this.entities$$.unsubscribe()}changeRoute(){this.routesFeatureStore.entities$.value.map(O=>O.properties.active=!O.properties.active),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(O=>O.set("active",!O.get("active")))}formatDistance(O){return(0,X.BO)(O)}formatDuration(O){return(0,X.a3)(O)}formatStep(O,j){return(0,X.EI)(O.maneuver.type,O.maneuver.modifier,O.name,O.maneuver.bearing_after,j,O.maneuver.exit,this.languageService,j===this.activeDirection.steps.length-1)}onStepsListBlur(){this.stepFeatureStore.clear()}showSegment(O,j=!1){this.showRouteSegmentGeometry(O,j)}showRouteSegmentGeometry(O,j=!1){const Y="vertex",s=new b.A(O.geometry.coordinates).transform("EPSG:4326",this.stepFeatureStore.layer.map.projection).getCoordinates()[0],z=new k.A(s),Q=new v.A({geometry:z}),ae=(new y.A).writeGeometryObject(z,{featureProjection:this.stepFeatureStore.layer.map.projection,dataProjection:this.stepFeatureStore.layer.map.projection}),ye=this.stepFeatureStore.get(Y);this.stepFeatureStore.update({type:D.R,geometry:ae,projection:this.stepFeatureStore.layer.map.projection,properties:{id:Y,step:O,type:h.wu.Vertex},meta:{id:Y,revision:(ye?ye.meta.revision:0)+1},ol:Q}),j&&this.stepFeatureStore.layer.map.viewController.zoomToExtent(Q.getGeometry().getExtent())}static \u0275fac=function(j){return new(j||g)(x.rXU(R.gw),x.rXU(x.gRc))};static \u0275cmp=x.VBU({type:g,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[x.aNF],decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[4,"ngIf"],[3,"mouseleave"],["mat-header","",1,"igo-route-title"],[1,"mat-caption"],["class","igo-steps","igoListItem","",3,"mouseenter","click",4,"ngFor","ngForOf"],[3,"selectionChange","ngModelChange","placeholder","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["igoListItem","",1,"igo-steps",3,"mouseenter","click"],["matListItemIcon","",3,"ngClass"],[1,"igo-step-text"],["matListItemMeta",""]],template:function(j,P){1&j&&x.DNE(0,W,10,6,"div",0),2&j&&x.Y8G("ngIf",P.directions&&P.activeDirection)},dependencies:[M.bT,e.RG,e.rl,e.nJ,L.Ve,L.VO,F.wT,a.YN,a.BC,a.vS,M.pM,F.Sy,p.w,p.q,o.Fg,o.jt,o.YE,o.ZV,o.BJ,c.m_,c.An,M.YU,R.Ck,ee.D9],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px;box-sizing:border-box}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:70%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700}.igo-steps[_ngcontent-%COMP%]{cursor:pointer;padding:35px 0}.igo-steps[_ngcontent-%COMP%]   .igo-step-text[_ngcontent-%COMP%]{overflow-wrap:break-word;word-wrap:break-word;white-space:pre-wrap}.mat-mdc-list-item[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:pre-wrap!important}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg)}.rotate-45[_ngcontent-%COMP%]{transform:rotate(45deg)}.rotate-270[_ngcontent-%COMP%]{transform:rotate(270deg)}.rotate-250[_ngcontent-%COMP%]{transform:rotate(250deg)}.rotate-290[_ngcontent-%COMP%]{transform:rotate(290deg)}.icon-flipped[_ngcontent-%COMP%]{transform:scaleY(-1)}"]})}return g})()},2639:(De,le,r)=>{"use strict";r.d(le,{o:()=>M});class M{}},49130:(De,le,r)=>{"use strict";r.d(le,{c:()=>P});var M=r(60316),a=r(8827),F=r(75300),p=r(21701),e=r(1455),c=r(68671),o=r(68710),L=r(60052),R=r(84740),v=r(63886),y=r(84205),b=r(91817),k=r(52575),_=r(70271),D=r(9355),h=r(78421),X=r(74458),H=r(35876),x=r(68077),ee=r(24335),Z=r(94663),G=r(82182),U=r(4316),N=r(4514),A=(r(1666),r(68559)),g=r(46443),u=r(27146),O=r(90852);function j(Y,w){if(1&Y){const I=A.RV6();A.j41(0,"mat-slide-toggle",1),A.bIt("change",function(s){A.eBV(I);const z=A.XpG();return A.Njj(z.onTogglePrivateModeControl(s.checked))}),A.EFF(1),A.nI1(2,"translate"),A.k0s()}if(2&Y){const I=A.XpG();A.Y8G("checked",I.enabledProfileHasAuthorization)("labelPosition","before"),A.R7$(),A.SpI(" ",A.bMT(2,3,"igo.geo.directionsForm.toggleType")," ")}}let P=(()=>{class Y{cdRef;http;languageService;directionsService;directionsSourceService;searchService;queryService;messageService;watcher;projection="EPSG:4326";hasOsrmPrivateAccess=!1;twoSourcesAvailable=!1;zoomRoute$$;storeEmpty$$;storeChange$$;routesQueries$$=[];selectStopInteraction;translateStop;selectedRoute;focusOnStop=!1;isTranslating=!1;previousStops=[];searchs$$=[];authenticated$$;contextUri;stopsStore;stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounce=200;length=2;coordRoundedDecimals=6;zoomToActiveRoute$=new y.B;authenticated$;get directionControlIsActive(){return!this.queryService.queryEnabled}get interactions(){return[this.selectStopInteraction,this.translateStop,this.selectedRoute]}get enabledProfileHasAuthorization(){return this.directionsSourceService.sources[0].getEnabledProfile().authorization}constructor(I,E,s,z,Q,ae,ye,de){this.cdRef=I,this.http=E,this.languageService=s,this.directionsService=z,this.directionsSourceService=Q,this.searchService=ae,this.queryService=ye,this.messageService=de}ngOnInit(){this.authenticated$$=this.authenticated$.subscribe(I=>{if(I){const E=this.directionsSourceService.sources[0].getProfileWithAuthorization();E&&this.http.get(E.authorization.url).subscribe(s=>{this.hasOsrmPrivateAccess=s[E.authorization.property]})}}),this.twoSourcesAvailable=2===this.directionsSourceService.sources[0].profiles.length,this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(()=>{(0,N.V5)(this.stopsFeatureStore,this.languageService),(0,N.ep)(this.routesFeatureStore,this.languageService),(0,N.i1)(this.stepFeatureStore),this.initOlInteraction()},1)}ngOnDestroy(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(I=>I.unsubscribe()),this.zoomRoute$$.unsubscribe(),this.authenticated$$.unsubscribe(),this.freezeStores()}freezeStores(){this.interactions.map(I=>this.routesFeatureStore.layer.map.ol.removeInteraction(I)),this.stopsFeatureStore.deactivateStrategyOfType(D.n),this.routesFeatureStore.deactivateStrategyOfType(D.n),this.stepFeatureStore.deactivateStrategyOfType(D.n)}initEntityStores(){this.watcher=new F.bz(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}monitorActiveRouteZoom(){this.zoomRoute$$=this.zoomToActiveRoute$.subscribe(()=>{if(this.routesFeatureStore.count>=1){const I=this.routesFeatureStore.all().find(E=>E.properties.active);if(I){I.ol.getGeometry();const E=I.ol.getGeometry().getExtent();this.routesFeatureStore.layer.map.viewController.zoomToExtent(E)}}})}initOlInteraction(){this.selectStopInteraction=new L.A({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:I=>"pointermove"===I.type&&!I.dragging}),this.translateStop=new R.A({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",I=>{this.isTranslating=!0,this.executeStopTranslation(I.features)}),this.translateStop.on("translateend",I=>{this.isTranslating=!1,this.executeStopTranslation(I.features)}),this.selectedRoute=new L.A({layers:[this.routesFeatureStore.layer.ol],condition:o.jM,hitTolerance:7,filter:I=>I.get("type")===G.wu.Route&&I.get("active")&&!this.isTranslating}),this.selectedRoute.on("select",I=>{if(!1===this.focusOnStop){const E=(0,h.ho)(v.pd(I.mapBrowserEvent.coordinate,this.routesFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals),s=(0,N.QG)(this.stopsStore);s.text=E.join(","),s.coordinates=[E[0],E[1]]}}),this.interactions.map(I=>this.routesFeatureStore.layer.map.ol.addInteraction(I))}onStopInputHasFocusChange(I){I?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}executeStopTranslation(I){if(0===I.getLength())return;const E=I.getArray()[0],s=E.getId(),z=v.pd(E.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),Q=this.stopsStore.get(s),ae=(0,h.ho)(z,this.coordRoundedDecimals);Q.coordinates=ae,Q.text=ae.join(","),this.stopsStore.update(Q)}monitorEmptyEntityStore(){this.storeEmpty$$=this.stopsStore.count$.pipe((0,b.F)()).subscribe(I=>{if(I<2){if((0,N.QG)(this.stopsStore),2===this.stopsStore.count)return void this.stopsStore.storeInitialized$.next(!0);this.stopsStore.storeInitialized$.next(!1)}this.routesQueries$$.map(E=>E.unsubscribe())})}monitorEntityStoreChange(){this.storeChange$$=this.stopsStore.entities$.pipe((0,k.B)(this.debounce)).subscribe(I=>{this.handleStopDiff(I),(0,N.N5)(this.stopsStore),this.handleStopsFeature(),this.getRoutes(this.isTranslating)})}cancelSearch(){this.searchs$$.map(I=>I.unsubscribe())}handleStopDiff(I){const E=I.map(Q=>c.BF.removeUndefined({id:Q.id,text:Q.text,coordinates:Q.coordinates})),s=c.og.findChanges(this.previousStops,E,["coordinates"]),z=s.added.concat(s.modified);z&&z.map(Q=>{const ae=Q.newValue;if(ae){const ye=this.stopsStore.get(ae.id),de=ye.text;if(!de||0===de.length)return;const ue=(0,h.vm)(de,this.stopsFeatureStore.layer.map.projection);let ce,re=!1;ue.lonLat&&(re=!0),ce=this.searchService.search(de,{searchType:"Feature"}),this.cancelSearch();const be=ce.map(_e=>_e.request.pipe((0,_.T)(Le=>Le.filter(We=>re?"Point"===We.data.geometry.type&&We.data.geometry:We.data.geometry))));this.searchs$$=be.map(_e=>_e.pipe((0,_.T)(Le=>Le.filter(We=>re?"Point"===We.data.geometry.type&&We.data.geometry:We.data.geometry))).subscribe(Le=>{if(Le.length>0){const We=Le[0].source,Xe=Le[0].meta,Be=Le.map(Ie=>Ie.data);ye.searchProposals||(ye.searchProposals=[]),ye.searchProposals=ye.searchProposals.filter(Ie=>Ie.type===(re?G.FX.Coord:G.FX.Text));let rt=ye.searchProposals.find(Ie=>Ie.source===We);rt?rt.results=Be:ye.searchProposals.push({type:re?G.FX.Coord:G.FX.Text,source:We,meta:Xe,results:Be})}this.cdRef.detectChanges()}))}}),this.previousStops=E}handleStopsFeature(){const I=this.stopsStore.all();I.filter(z=>z.coordinates).map(z=>this.addStopOverlay(z)),this.stopsFeatureStore.all().map(z=>{this.stopsStore.get(z.properties.id)||this.stopsFeatureStore.delete(z)}),I.filter(z=>!z.coordinates).map(z=>{const Q=this.stopsFeatureStore.get(z.id);Q&&this.stopsFeatureStore.delete(Q)})}getRoutes(I=!1){const E=this.stopsStore.view.all().filter(ae=>ae.coordinates);if(E.length<2)return void this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());const s=E.map(ae=>(0,h.ho)(ae.coordinates,this.coordRoundedDecimals));this.routesQueries$$.map(ae=>ae.unsubscribe());const Q=this.directionsService.route(s,I?{overview:!0,steps:!1,alternatives:!1,continue_straight:!1}:void 0);Q&&this.routesQueries$$.push(Q.subscribe(ae=>{this.routesFeatureStore.deleteMany(this.routesFeatureStore.all()),ae.map(ye=>(0,N.JG)(this.routesFeatureStore,ye,this.projection,ye===ae[0]))}))}addStopOverlay(I){(0,N.LN)(I,this.stopsStore,this.stopsFeatureStore,this.projection,this.languageService)}onToggleDirectionsControl(I){this.queryService.queryEnabled=!I;const E=this.routesFeatureStore.layer.map.ol;this.interactions.map(s=>I?E.addInteraction(s):E.removeInteraction(s))}onTogglePrivateModeControl(I){this.directionsSourceService.sources[0].profiles.forEach(E=>E.enabled=!1),I?(this.directionsSourceService.sources[0].profiles.find(E=>E.authorization).enabled=!0,this.messageService.alert(this.languageService.translate.instant("igo.geo.directionsForm.forestRoadsWarning.text"),this.languageService.translate.instant("igo.geo.directionsForm.forestRoadsWarning.title"))):this.directionsSourceService.sources[0].profiles.find(E=>!E.authorization).enabled=!0,this.getRoutes()}static \u0275fac=function(E){return new(E||Y)(A.rXU(A.gRc),A.rXU(g.Qq),A.rXU(p.gw),A.rXU(U.Y),A.rXU(u.xC),A.rXU(H.S),A.rXU(X.c),A.rXU(e.bg))};static \u0275cmp=A.VBU({type:Y,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomToActiveRoute$:"zoomToActiveRoute$",authenticated$:"authenticated$"},standalone:!0,features:[A.aNF],decls:8,vars:19,consts:[[1,"directions-options"],[3,"change","checked","labelPosition"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"stepFeatureStore","contextUri","zoomToActiveRoute$","routesFeatureStore","stopsStore"],[3,"stopInputHasFocus","coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length"],[3,"stepFeatureStore","routesFeatureStore"]],template:function(E,s){1&E&&(A.j41(0,"div",0)(1,"mat-slide-toggle",1),A.bIt("change",function(Q){return s.onToggleDirectionsControl(Q.checked)}),A.EFF(2),A.nI1(3,"translate"),A.k0s(),A.DNE(4,j,3,5,"mat-slide-toggle",2),A.k0s(),A.nrm(5,"igo-directions-buttons",3),A.j41(6,"igo-directions-inputs",4),A.bIt("stopInputHasFocus",function(Q){return s.onStopInputHasFocusChange(Q)}),A.k0s(),A.nrm(7,"igo-directions-results",5)),2&E&&(A.R7$(),A.Y8G("checked",s.directionControlIsActive)("labelPosition","before"),A.R7$(),A.SpI(" ",A.bMT(3,17,"igo.geo.directionsForm.toggleActive")," "),A.R7$(2),A.Y8G("ngIf",s.hasOsrmPrivateAccess&&s.twoSourcesAvailable),A.R7$(),A.Y8G("stepFeatureStore",s.stepFeatureStore)("contextUri",s.contextUri)("zoomToActiveRoute$",s.zoomToActiveRoute$)("routesFeatureStore",s.routesFeatureStore)("stopsStore",s.stopsStore),A.R7$(),A.Y8G("coordRoundedDecimals",s.coordRoundedDecimals)("projection",s.projection)("stopsFeatureStore",s.stopsFeatureStore)("stopsStore",s.stopsStore)("debounce",s.debounce)("length",s.length),A.R7$(),A.Y8G("stepFeatureStore",s.stepFeatureStore)("routesFeatureStore",s.routesFeatureStore))},dependencies:[M.MD,M.bT,a.mV,a.sG,x.f,ee.f,Z.g,p.Ck,O.D9],styles:[".directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}"]})}return Y})()},27146:(De,le,r)=>{"use strict";r.d(le,{I7:()=>p,xC:()=>a});var M=r(2639);class a{sources;constructor(c){this.sources=c}}function F(e){return new a(e)}function p(){return{provide:a,useFactory:F,deps:[M.o]}}},82182:(De,le,r)=>{"use strict";r.d(le,{FX:()=>F,GN:()=>a,XX:()=>e,ee:()=>M,wu:()=>p});var M=function(c){return c[c.GeoJSON=0]="GeoJSON",c[c.JSON=1]="JSON",c}(M||{}),a=function(c){return c.Route="route",c.Trip="trip",c}(a||{}),F=function(c){return c.Coord="coord",c.Text="text",c}(F||{}),p=function(c){return c.Stop="stop",c.Route="route",c.Vertex="vertex",c}(p||{}),e=function(c){return c.Start="start",c.Intermediate="intermediate",c.End="end",c}(e||{})},4316:(De,le,r)=>{"use strict";r.d(le,{Y:()=>ee});var M=r(89204),a=r(60316),F=r(67778),p=r(67143),e=r(21701),c=r(68671),o=r(60822),L=r.n(o),R=r(38158),b=(r(6530),r(39545)),k=r.n(b),_=r(84205),D=r(3674),h=r(9799),X=r(4514),H=r(68559),x=r(27146);let ee=(()=>{class Z{directionsSourceService;configService;languageService;printService;document;activityService;constructor(U,N,W,A,g,u){this.directionsSourceService=U,this.configService=N,this.languageService=W,this.printService=A,this.document=g,this.activityService=u}route(U,N={}){if(0!==U.length)return this.routeSource(this.directionsSourceService.sources[0],U,N)}routeSource(U,N,W={}){return U.route(N,W)}downloadDirection(U,N){var W=this;const A=this.activityService.register(),g=new _.B,u=new R.default({orientation:"p",format:"Letter",unit:"mm"}),{width:O,height:j}=u.internal.pageSize,P=[20,10,20,10];this.addAttribution(U,u,P);const I=[O-P[3]-P[1],j-P[0]-P[2]],E=`${N.title} (${(0,X.BO)(N.distance)}, ${(0,X.a3)(N.duration)})`;return u.text(E,u.internal.pageSize.width/2,25,{align:"center"}),this.printService.addMap(u,U,96,I,P,h.go.none).subscribe(function(){var Q=(0,M.A)(function*(ae){ae===c.Bi.Done&&(yield W.addInstructions(u,N,E),W.setPageHeaderFooter(u),yield u.save(`${E}.pdf`,{returnPromise:!0})),W.activityService.unregister(A),g.next(ae)});return function(ae){return Q.apply(this,arguments)}}()),g}addAttribution(U,N,W){const g=this.printService.getAttributionText(U);if(g){W[2]+=5;const u=W[3],j=N.internal.pageSize.height-W[2]+5;N.setFontSize(10),N.text(g,u,j)}}setHTMLTableContent(U){var N=this;return(0,M.A)(function*(){const W=yield N.directionsInstruction(U),A=document.createElement("table"),g=document.createElement("tbody");for(let P=0;P<W.length;P++){const Y=W[P];var u=document.createElement("tr"),O=document.createElement("td"),j=document.createElement("td");const w=document.createElement("img");w.src=Y.icon;const I=document.createElement("span");if(I.innerHTML=Y.instruction,O.appendChild(w),j.appendChild(I),Y.distance){const E=document.createElement("span");E.style.verticalAlign="middle",E.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+Y.distance,j.appendChild(E)}u.append(O),u.append(j),g.appendChild(u)}return A.appendChild(g),A})()}directionsInstruction(U){var N=this;return(0,M.A)(function*(){const A=N.document.getElementsByTagName("igo-directions-results")[0].getElementsByTagName("mat-list")[0].getElementsByTagName("mat-list-item");let g=[];for(let O=0;O<A.length;O++){const P=A[O].getElementsByTagName("mat-icon")[0],Y=P.innerText;if(!g.some(I=>I.name===Y)){const I=yield L()(P,{scale:3});g.push({name:Y,icon:I.toDataURL()})}}let u=[];for(let O=0;O<U.steps.length;O++){const j=U.steps[O],P=(0,X.EI)(j.maneuver.type,j.maneuver.modifier,j.name,j.maneuver.bearing_after,O,j.maneuver.exit,N.languageService,O===U.steps.length-1),Y=(0,X.BO)(j.distance);u.push({instruction:O+1+". "+P.instruction,icon:g.find(w=>w.name===P.image).icon,distance:Y?"("+Y+")":void 0})}return u})()}addInstructions(U,N,W){var A=this;return(0,M.A)(function*(){U.addPage(),U.text(W,U.internal.pageSize.width/2,25,{align:"center"});const u=yield A.setHTMLTableContent(N);U.autoTable({html:u,startY:30,margin:{top:20,bottom:20},columnStyles:{0:{cellWidth:10}},theme:"plain",styles:{fontSize:12},didDrawCell:function(j){if(0===j.column.index&&"body"===j.cell.section){j.row.height=10;const Y=j.cell.raw.getElementsByTagName("img")[0];U.addImage(Y.src,j.cell.x,j.cell.y,8,8)}}})})()}setPageHeaderFooter(U){const N=U.getNumberOfPages(),W=k()(Date.now()).format("DD/MM/YYYY hh:mm").toString(),g=this.configService.getConfig("directionsSources.logo")||"assets/logo.png";for(let u=0;u<N;u++){U.setPage(u),U.setFontSize(8);const O=U.internal.pageSize,j=O.height?O.height:O.getHeight(),P=O.width?O.width:O.getWidth();U.text(W,10,10,{baseline:"top"}),U.addImage(g,"PNG",P-20,5,10,10),U.text(W,10,j-10),U.text("Page "+U.getCurrentPageInfo().pageNumber+" / "+N,P-20,j-10)}}static \u0275fac=function(N){return new(N||Z)(H.KVO(x.xC),H.KVO(p.we),H.KVO(e.gw),H.KVO(D.B),H.KVO(a.qQ),H.KVO(F.Ti))};static \u0275prov=H.jDH({token:Z,factory:Z.\u0275fac})}return Z})()},4514:(De,le,r)=>{"use strict";r.d(le,{BO:()=>O,EI:()=>P,JG:()=>u,LN:()=>g,N5:()=>H,QG:()=>Z,V5:()=>N,a3:()=>j,ep:()=>W,gk:()=>G,i1:()=>A,jb:()=>x});var M=r(68671),a=r(94691),F=r(66586),p=r(49964),e=r(76983),c=r(63886),o=r(29814),L=r(61099),R=r(1963),v=r(8115),y=r(84540),b=r(3439),k=r(35235),_=r(9355),D=r(91640),h=r(42525),X=r(82182);function H(I,E="asc",s="position"){I.view.sort({direction:E,valueAccessor:z=>z[s]})}function x(I,E){let s=X.XX.Intermediate;return 0===I?s=X.XX.Start:I===E-1&&(s=X.XX.End),s}function Z(I){const E=(0,M.uR)(),s=I.all();let z;z=0===I.count?[0]:s.map(ue=>ue.position);const Q=Math.max(...z),ae=Q,ye=Q+1,de=I.all().find(ue=>ue.position===Q);return de&&(de.position=ye,de.relativePosition=x(ye,I.count+1)),I.insert({id:E,position:ae,relativePosition:x(ae,I.count+1)}),H(I),I.get(E)}function G(I,E){I.delete(E),function ee(I){const E=[...I.all()];E.sort((s,z)=>s.position-z.position),E.map((s,z)=>{s.position=z,s.relativePosition=x(s.position,E.length)}),E&&I.updateMany(E)}(I)}function U(I,E){const s=[new o.Ay({geometry:I.getGeometry(),image:new L.A({radius:7,stroke:new R.A({color:"#FF0000",width:3})})})],z=(0,h.O)({text:I.get("stopText"),opacity:I.get("stopOpacity"),markerColor:I.get("stopColor"),markerOutlineColor:[255,255,255]}),Q=[new o.Ay({stroke:new R.A({color:`rgba(106, 121, 130, ${I.get("active")?.75:0})`,width:10})}),new o.Ay({stroke:new R.A({color:`rgba(79, 169, 221, ${I.get("active")?.75:0})`,width:6})})];return I.get("type")===X.wu.Stop?z:"vertex"===I.get("type")?s:I.get("type")===X.wu.Route?Q:void 0}function N(I,E){const s=new _.n({motion:b.B.None}),z=new D.v({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:E.translate.instant("igo.geo.directionsForm.stopLayer"),zIndex:911,source:new v._,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:U});(0,y.d)(I,z),I.layer.visible=!0,(0,k.c)(I,s)}function W(I,E){const s=new _.n({motion:b.B.None}),z=new D.v({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:E.translate.instant("igo.geo.directionsForm.routeLayer"),zIndex:910,source:new v._,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:U});(0,y.d)(I,z),I.layer.visible=!0,(0,k.c)(I,s)}function A(I){const E=new _.n({motion:b.B.None}),s=new D.v({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new v._,showInLayerList:!1,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:U});(0,y.d)(I,s),I.layer.visible=!0,(0,k.c)(I,E)}function g(I,E,s,z,Q){let ae,ye;switch(I.relativePosition){case X.XX.Start:ae="#008000",ye=Q.translate.instant("igo.geo.directionsForm.start");break;case X.XX.End:ae="#f64139",ye=Q.translate.instant("igo.geo.directionsForm.end");break;default:ae="#ffd700",ye=Q.translate.instant("igo.geo.directionsForm.intermediate")+" #"+I.position}const de=new p.A(c.pd(I.coordinates,z,s.map.projection)),ue=(new F.A).writeGeometryObject(de,{featureProjection:s.map.projection,dataProjection:s.map.projection}),ce=s.get(I.id),be={type:b.R,geometry:ue,projection:s.map.projection,properties:{id:I.id,type:X.wu.Stop,stopText:ye,stopColor:ae,stopOpacity:1,stop:I},meta:{id:I.id,revision:(ce?ce.meta.revision:0)+1},ol:new a.A({geometry:de})};s.update(be)}function u(I,E,s,z=!1,Q=!1){const de=new e.A(E.geometry.coordinates).transform(s,I.map.projection),ue=(new F.A).writeGeometryObject(de,{featureProjection:I.map.projection,dataProjection:I.map.projection}),ce=I.get(E.id),be={type:b.R,geometry:ue,projection:I.map.projection,properties:{id:E.id,type:X.wu.Route,active:z,direction:E},meta:{id:E.id,revision:(ce?ce.meta.revision:0)+1},ol:new a.A({geometry:de})};I.update(be)}function O(I){if(0!==I)return I>=1e5?M.ZM.roundToNDecimal(Math.round(I)/1e3,1)+" km":I>=1e4||I>=1e3?M.ZM.roundToNDecimal(Math.round(I)/100/10,1)+" km":M.ZM.roundToNDecimal(I,0)+" m"}function j(I){if(I>=3600){const E=Math.floor(I/3600),s=Math.round(60*(I/3600-E));return 60===s?E+1+" h":E+" h "+s+" min"}return I>=60?Math.round(I/60)+" min":I+" s"}function P(I,E,s="Voie",z,Q,ae,ye,de=!1){const ue=ye.translate;let ce,re="arrow_forward",be="rotate-270";const _e=function w(I,E){const s=E.translate;return I>=337||I<23?s.instant("igo.geo.cardinalPoints.n"):I<67?s.instant("igo.geo.cardinalPoints.ne"):I<113?s.instant("igo.geo.cardinalPoints.e"):I<157?s.instant("igo.geo.cardinalPoints.se"):I<203?s.instant("igo.geo.cardinalPoints.s"):I<247?s.instant("igo.geo.cardinalPoints.sw"):I<293?s.instant("igo.geo.cardinalPoints.w"):I<337?s.instant("igo.geo.cardinalPoints.nw"):void 0}(z,ye),Le=function Y(I,E){const s=E.translate;return"uturn"===I?s.instant("igo.geo.directions.uturn"):"sharp right"===I?s.instant("igo.geo.directions.sharp right"):"right"===I?s.instant("igo.geo.directions.right"):"slight right"===I?s.instant("igo.geo.directions.slight right"):"sharp left"===I?E.translate.instant("igo.geo.directions.sharp left"):"left"===I?E.translate.instant("igo.geo.directions.left"):"slight left"===I?E.translate.instant("igo.geo.directions.slight left"):"straight"===I?E.translate.instant("igo.geo.directions.straight"):I}(E,ye);let Xe=("straight"===E?"":ue.instant("igo.geo.directions.modifier.prefix"))+Le;if(E?.search("slight")>=0&&(Xe=Le),"uturn"===E?(re="arrow_forward",be="rotate-90"):"sharp right"===E||"right"===E?(re="subdirectory_arrow_right",be="icon-flipped"):"slight right"===E?(re="arrow_forward",be="rotate-290"):"straight"===E?re="arrow_forward":"slight left"===E?(re="arrow_forward",be="rotate-250"):("left"===E||"sharp left"===E)&&(re="subdirectory_arrow_left",be="icon-flipped"),"turn"===I)ce="straight"===E?ue.instant("igo.geo.directions.turn.straight",{route:s}):"uturn"===E?ue.instant("igo.geo.directions.turn.uturn",{route:s}):ue.instant("igo.geo.directions.turn.else",{route:s,aggregatedDirection:Xe,translatedModifier:Le});else if("new name"===I)ce=ue.instant("igo.geo.directions.new name",{route:s,translatedDirection:_e}),re="explore",be="";else if("depart"===I)ce=ue.instant("igo.geo.directions.depart",{route:s,translatedDirection:_e}),re="explore",be="";else if("arrive"===I)de?(Xe=Le?Xe:"",ce=ue.instant("igo.geo.directions.arrive.lastStep",{coma:Le?", ":"",aggregatedDirection:Xe})):(ce=ue.instant("igo.geo.directions.arrive.intermediate",{route:s}),re="location_on",be="");else if("merge"===I)ce=ue.instant("igo.geo.directions.merge",{route:s}),re="arrow_forward",be="rotate-270";else if("on ramp"===I)ce=ue.instant("igo.geo.directions.on ramp",{aggregatedDirection:Xe});else if("off ramp"===I)ce=ue.instant("igo.geo.directions.off ramp",{aggregatedDirection:Xe});else if("fork"===I)ce=E.search("left")>=0?ue.instant("igo.geo.directions.fork.left",{route:s}):E.search("right")>=0?ue.instant("igo.geo.directions.fork.right",{route:s}):ue.instant("igo.geo.directions.fork.else",{route:s});else if("end of road"===I)ce=ue.instant("igo.geo.directions.end of road",{translatedModifier:Le,route:s});else if("use lane"===I)ce=ue.instant("igo.geo.directions.use lane");else if("continue"===I&&"uturn"!==E)ce=ue.instant("igo.geo.directions.continue.notUturn",{route:s}),re="arrow_forward",be="rotate-270";else if("roundabout"===I){const Be=ue.instant(1===ae?"igo.geo.directions.cntSuffix.first":"igo.geo.directions.cntSuffix.secondAndMore");ce=ue.instant("igo.geo.directions.roundabout",{exit:ae,cntSuffix:Be,route:s}),re="donut_large",be=""}else"rotary"===I?(ce=ue.instant("igo.geo.directions.rotary"),re="donut_large",be=""):"roundabout turn"===I?(ce=ue.instant("igo.geo.directions.roundabout turn"),re="donut_large",be=""):"exit roundabout"===I?(ce=ue.instant("igo.geo.directions.exit roundabout",{route:s}),re="arrow_forward",be="rotate-270"):ce="notification"===I?ue.instant("igo.geo.directions.notification"):"uturn"===E?ue.instant("igo.geo.directions.uturnText",{translatedDirection:_e,route:s}):ue.instant("igo.geo.directions.unknown");return re=de?"flag":re,be=de?"":be,re=0===Q?"explore":re,be=0===Q?"":be,{instruction:ce,image:re,cssClass:be}}},85447:(De,le,r)=>{"use strict";r.d(le,{$h:()=>p.$h,Er:()=>p.Er,UL:()=>p.UL,YK:()=>M.Y,Zr:()=>p.Zr});var M=r(4316),p=(r(82182),r(4514),r(1666))},1666:(De,le,r)=>{"use strict";r.d(le,{$h:()=>e,Er:()=>o,UL:()=>c,Zr:()=>p});var M=r(75300),a=r(75797),F=r(67852);class p extends M.D_{storeInitialized$=new a.t(!1);clearStops(){this.storeInitialized$.next(!1),this.clear()}}class e extends F.o{}class c extends F.o{}class o extends F.o{}},63721:(De,le,r)=>{"use strict";r.d(le,{_:()=>j});var M=r(60316),a=r(68559),F=r(93840),p=r(75300),e=r(59912),c=r(67143),o=r(21701),L=r(1455),R=r(69576),v=r(68671),y=r(84205),b=r(33900),D=(r(53792),r(24891),r(46443)),h=r(80436),X=r(90852);const H=()=>({cursor:"pointer",color:"blue"});function x(P,Y){if(1&P&&(a.j41(0,"td")(1,"mat-icon",7),a.EFF(2),a.k0s()()),2&P){const w=a.XpG(3);a.R7$(2),a.JRh(w.icon)}}function ee(P,Y){if(1&P){const w=a.RV6();a.j41(0,"td")(1,"a",8),a.EFF(2),a.nI1(3,"translate"),a.k0s(),a.j41(4,"button",9),a.bIt("click",function(){a.eBV(w);const E=a.XpG().$implicit,s=a.XpG(2);return a.Njj(s.copyTextToClipboard(E.value))}),a.j41(5,"mat-icon"),a.EFF(6,"content_copy"),a.k0s()()()}if(2&P){const w=a.XpG().$implicit,I=a.XpG(2);a.R7$(),a.FS9("href",w.value,a.B4B),a.R7$(),a.Lme(" ",a.bMT(3,3,"igo.geo.targetHtmlUrl")," ",I.title,"")}}function Z(P,Y){if(1&P&&(a.j41(0,"td",10),a.EFF(1),a.k0s()),2&P){const w=a.XpG().$implicit;a.R7$(),a.SpI(" ",w.key," ")}}function G(P,Y){if(1&P&&a.nrm(0,"td",11),2&P){const w=a.XpG().$implicit;a.Y8G("innerHTML",w.value,a.npT)}}function U(P,Y){if(1&P){const w=a.RV6();a.j41(0,"td")(1,"u",12),a.bIt("click",function(){a.eBV(w);const E=a.XpG().$implicit,s=a.XpG(2);return a.Njj(s.openSecureUrl(E.value))}),a.EFF(2),a.k0s()()}if(2&P){const w=a.XpG().$implicit,I=a.XpG(2);a.R7$(),a.Y8G("ngStyle",a.lJ4(2,H)),a.R7$(),a.JRh(I.getEmbeddedLinkText(w.value))}}function N(P,Y){if(1&P){const w=a.RV6();a.j41(0,"td")(1,"u",12),a.bIt("click",function(){a.eBV(w);const E=a.XpG().$implicit,s=a.XpG(2);return a.Njj(s.openSecureUrl(E.value))}),a.EFF(2),a.nI1(3,"translate"),a.k0s(),a.j41(4,"button",9),a.bIt("click",function(){a.eBV(w);const E=a.XpG().$implicit,s=a.XpG(2);return a.Njj(s.copyTextToClipboard(E.value))}),a.j41(5,"mat-icon"),a.EFF(6,"content_copy"),a.k0s()()()}2&P&&(a.R7$(),a.Y8G("ngStyle",a.lJ4(4,H)),a.R7$(),a.JRh(a.bMT(3,2,"igo.geo.targetHtmlUrl")))}function W(P,Y){if(1&P){const w=a.RV6();a.j41(0,"td")(1,"a",13),a.bIt("click",function(){a.eBV(w);const E=a.XpG().$implicit,s=a.XpG(2);return a.Njj(s.openSecureUrl(E.value))}),a.nrm(2,"img",14),a.nI1(3,"secureImage"),a.nI1(4,"async"),a.k0s()()}if(2&P){const w=a.XpG().$implicit;a.R7$(),a.FS9("href",w.value,a.B4B),a.R7$(),a.FS9("src",a.bMT(4,4,a.bMT(3,2,w.value)),a.B4B)}}function A(P,Y){if(1&P&&(a.nrm(0,"td",11),a.nI1(1,"json")),2&P){const w=a.XpG().$implicit;a.Y8G("innerHTML",a.bMT(1,1,w.value),a.npT)}}function g(P,Y){if(1&P&&(a.j41(0,"tr"),a.DNE(1,x,3,1,"td",4)(2,ee,7,5,"td",4)(3,Z,2,1,"td",5)(4,G,1,1,"td",6)(5,U,3,3,"td",4)(6,N,7,5,"td",4)(7,W,5,6,"td",4)(8,A,2,3,"td",6),a.k0s()),2&P){const w=Y.$implicit,I=a.XpG(2);a.R7$(),a.Y8G("ngIf","_blank"===I.feature.properties.target&&"url"===w.key),a.R7$(),a.Y8G("ngIf","_blank"===I.feature.properties.target&&"url"===w.key),a.R7$(),a.Y8G("ngIf",void 0===I.feature.properties.target),a.R7$(),a.Y8G("ngIf",void 0===I.feature.properties.target&&!I.isObject(w.value)&&!I.isUrl(w.value)&&!I.isEmbeddedLink(w.value)),a.R7$(),a.Y8G("ngIf",void 0===I.feature.properties.target&&I.isEmbeddedLink(w.value)),a.R7$(),a.Y8G("ngIf",void 0===I.feature.properties.target&&!I.isObject(w.value)&&(I.isDoc(w.value)||I.isUrl(w.value))&&!I.isImg(w.value)),a.R7$(),a.Y8G("ngIf",void 0===I.feature.properties.target&&!I.isObject(w.value)&&I.isUrl(w.value)&&I.isImg(w.value)),a.R7$(),a.Y8G("ngIf",void 0===I.feature.properties.target&&I.isObject(w.value))}}function u(P,Y){if(1&P&&(a.j41(0,"table",2)(1,"tbody"),a.DNE(2,g,9,8,"tr",3),a.nI1(3,"keyvalue"),a.k0s()()),2&P){const w=a.XpG();a.R7$(2),a.Y8G("ngForOf",a.bMT(3,1,w.filterFeatureProperties(w.feature)))}}function O(P,Y){if(1&P&&a.nrm(0,"iframe",15),2&P){const w=a.XpG();a.Y8G("srcdoc",w.htmlSanitizer(w.feature.properties),a.npT)("src",w.urlSanitizer(w.feature.properties.url),a.f$h)}}let j=(()=>{class P{http;cdRef;sanitizer;networkService;messageService;configService;state;unsubscribe$=new y.B;ready=!1;get source(){return this._source}set source(w){this._source=w,this.cdRef.detectChanges()}map;toolbox;get feature(){return this._feature}set feature(w){this._feature=w,this.cdRef.detectChanges(),this.selectFeature.emit()}_feature;_source;routeEvent=new a.bkB;selectFeature=new a.bkB;htmlDisplayEvent=new a.bkB;get title(){return(0,p.k0)(this.feature)}get icon(){return(0,p.Zq)(this.feature)||"link"}constructor(w,I,E,s,z,Q){this.http=w,this.cdRef=I,this.sanitizer=E,this.networkService=s,this.messageService=z,this.configService=Q,this.networkService.currentState().pipe((0,b.Q)(this.unsubscribe$)).subscribe(ae=>{this.state=ae})}ngOnInit(){this.ready=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}urlSanitizer(w){return this.sanitizer.bypassSecurityTrustResourceUrl(w)}isHtmlDisplay(){return this.feature&&this.isObject(this.feature.properties)&&"iframe"===this.feature.properties.target?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}htmlSanitizer(w){if(w.body){if(!/<base href="[\w:\/\.]+">/.test(w.body)){const E=new URL(w.url,window.location.origin);w.body=w.body.replace("<head>",`<head><base href="${E.origin}">`)}return this.sanitizer.bypassSecurityTrustHtml(w.body)}}isObject(w){return"object"==typeof w}openSecureUrl(w){let I;const E=new RegExp(this.configService?.getConfig("depot.url")+".*?(?=\\s|$)");if(E.test(w))I=w.match(E)[0],this.http.get(I,{responseType:"blob"}).subscribe(z=>{const Q=URL.createObjectURL(z);window.open(Q,"_blank"),this.cdRef.detectChanges()},z=>{this.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{let z=w;if(this.isEmbeddedLink(w)){var s=document.createElement("div");s.innerHTML=w,z=s.children[0].getAttribute("href")}window.open(z,"_blank")}}isUrl(w){if("string"==typeof w)return/^https?:\/\//.test(w)}isDoc(w){if("string"==typeof w)return!!this.isUrl(w)&&/(pdf|docx?|xlsx?)$/.test(w.toLowerCase())}isImg(w){if("string"==typeof w)return!!this.isUrl(w)&&/(jpe?g|png|gif)$/.test(w.toLowerCase())}isEmbeddedLink(w){return"string"==typeof w&&1===(w.match(/<a/g)||[]).length}getEmbeddedLinkText(w){let E=w.match(/(?:>).*?(?=<|$)/)[0];return E=E.replace(/>/g,""),E}filterFeatureProperties(w){const I=w.meta?w.meta.alias:void 0,E={};let s;return this.map&&this.map.forcedOffline$.pipe((0,b.Q)(this.unsubscribe$)).subscribe(z=>{s=z}),w.properties&&w.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete w.properties.Route,I?(Object.keys(I).forEach(z=>{E[I[z]]=w.properties[z]}),E):(void 0!==s&&s?w.meta&&w.meta.excludeAttributeOffline&&w.meta.excludeAttributeOffline.forEach(Q=>{delete w.properties[Q]}):this.state.connection&&w.meta&&w.meta.excludeAttribute?w.meta.excludeAttribute.forEach(Q=>{delete w.properties[Q]}):!this.state.connection&&w.meta&&w.meta.excludeAttributeOffline&&w.meta.excludeAttributeOffline.forEach(Q=>{delete w.properties[Q]}),w.properties)}copyTextToClipboard(w){v.B0.copy(w)&&this.messageService.success("igo.geo.query.link.message")}static \u0275fac=function(I){return new(I||P)(a.rXU(D.Qq),a.rXU(a.gRc),a.rXU(h.up),a.rXU(R.A),a.rXU(L.bg),a.rXU(c.we))};static \u0275cmp=a.VBU({type:P,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},standalone:!0,features:[a.aNF],decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["matListItemIcon",""],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["id","keyValue"],[3,"innerHTML"],[3,"click","ngStyle"],["target","_blank","rel","noopener noreferrer",3,"click","href"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(I,E){1&I&&a.DNE(0,u,4,3,"table",0)(1,O,1,2,"iframe",1),2&I&&(a.Y8G("ngIf",E.ready&&E.feature&&E.isObject(E.feature.properties)&&"iframe"!==E.feature.properties.target),a.R7$(),a.Y8G("ngIf",E.isHtmlDisplay()))},dependencies:[M.bT,M.pM,F.m_,F.An,M.B3,e.Ju,M.Jj,M.TG,M.lG,o.Ck,X.D9,e.V2],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}"],changeDetection:0})}return P})()},90315:(De,le,r)=>{"use strict";r.d(le,{A:()=>p});var M=r(68559),a=r(75797),F=r(63721);let p=(()=>{class e{el;component;get feature(){return this.component.feature}feature$=new a.t(void 0);routingEvent=new M.bkB;setFeature(){this.feature$.next(this.feature)}constructor(o,L){this.el=L,this.component=o}ngOnInit(){this.feature$.subscribe(()=>{this.feature.geometry&&this.bindClicking()})}bindClicking(){setTimeout(()=>{const o=this.el.nativeElement.querySelector("span.routing");o&&o.addEventListener("click",()=>{this.routingEvent.emit()})},1)}static \u0275fac=function(L){return new(L||e)(M.rXU(F._,2),M.rXU(M.aKT))};static \u0275dir=M.FsC({type:e,selectors:[["","igoFeatureDetailsDirective",""]],hostBindings:function(L,R){1&L&&M.bIt("selectFeature",function(){return R.setFeature()})},outputs:{routingEvent:"routingEvent"},standalone:!0})}return e})()},5372:(De,le,r)=>{"use strict";r.d(le,{R:()=>F});var M=r(63721),a=r(90315);const F=[M._,a.A]},51053:(De,le,r)=>{"use strict";r.d(le,{R3:()=>M.R,_U:()=>a._});var M=r(5372),a=r(63721);r(90315)},60557:(De,le,r)=>{"use strict";r.d(le,{G:()=>y});var M=r(60316),a=r(68559),F=r(75300),p=r(36250),e=r(68671),c=r(75797),o=r(3439);const L=["igoForm"],R=["*",[["","formButtons",""]]],v=["*","[formButtons]"];let y=(()=>{class b{form;set feature(_){this.feature$.next(_)}get feature(){return this.feature$.value}feature$=new c.t(void 0);submitForm=new a.bkB;igoForm;constructor(){}onSubmit(_){const D=this.formDataToFeature(_);this.submitForm.emit(D)}getData(){return this.formDataToFeature(this.igoForm.getData())}formDataToFeature(_){const D={},h={};void 0===this.feature?h.id=(0,e.uR)():(Object.assign(D,this.feature.properties),Object.assign(h,this.feature.meta,{revision:(0,F.nd)(this.feature)+1}));Object.entries(_).forEach(x=>{const[ee,Z]=x;if(ee.startsWith("properties.")){const G=ee.substr(11);D[G]=Z}});let H=_.geometry;return void 0===H&&void 0!==this.feature&&(H=this.feature.geometry),{meta:h,type:o.R,geometry:H,projection:"EPSG:4326",properties:D}}static \u0275fac=function(D){return new(D||b)};static \u0275cmp=a.VBU({type:b,selectors:[["igo-feature-form"]],viewQuery:function(D,h){if(1&D&&a.GBs(L,7),2&D){let X;a.mGM(X=a.lsd())&&(h.igoForm=X.first)}},inputs:{form:"form",feature:"feature"},outputs:{submitForm:"submitForm"},standalone:!0,features:[a.aNF],ngContentSelectors:v,decls:5,vars:4,consts:[["igoForm",""],[3,"submitForm","form","formData"]],template:function(D,h){if(1&D){const X=a.RV6();a.NAR(R),a.j41(0,"igo-form",1,0),a.nI1(2,"async"),a.bIt("submitForm",function(x){return a.eBV(X),a.Njj(h.onSubmit(x))}),a.SdG(3),a.SdG(4,1,["formButtons",""]),a.k0s()}2&D&&a.Y8G("form",h.form)("formData",a.bMT(2,2,h.feature$))},dependencies:[p.s2,M.Jj],styles:["[_nghost-%COMP%]{display:block}igo-form[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return b})()},54239:(De,le,r)=>{"use strict";r(51053),r(60557);r(63721),r(90315)},54427:(De,le,r)=>{"use strict";r.d(le,{Bl:()=>M.Bl,M2:()=>M.M2,M8:()=>M.M8,RI:()=>M.RI,WJ:()=>M.WJ,ZA:()=>M.ZA,_O:()=>M._O,_U:()=>F._U,as:()=>M.as,c2:()=>M.c2,df:()=>M.df,n6:()=>M.n6,oE:()=>M.oE,p6:()=>M.p6,xH:()=>M.xH});var M=r(44295),F=(r(54239),r(51053));r(60557)},84540:(De,le,r)=>{"use strict";r.d(le,{d:()=>F});var M=r(91020),a=r(91640);function F(p,e){void 0===p.layer?(e=e||new a.v({source:new M._k}),p.bindLayer(e),void 0===p.layer.map&&p.map.addLayer(p.layer)):void 0===p.layer.map&&p.map.addLayer(p.layer)}},3439:(De,le,r)=>{"use strict";r.d(le,{B:()=>a,R:()=>M});const M="Feature";var a=function(F){return F[F.None=0]="None",F[F.Move=1]="Move",F[F.Zoom=2]="Zoom",F[F.Default=3]="Default",F}(a||{})},33864:(De,le,r)=>{"use strict";r.d(le,{Iy:()=>b,LN:()=>Z,M2:()=>k,M8:()=>D,WJ:()=>H,_Q:()=>ee,as:()=>X,p6:()=>x,xH:()=>y});var M=r(75300),a=r(68671),F=r(84505),p=r(66586),e=r(76983),c=r(49964),o=r(93812),L=r(63886),R=r(29814),v=r(3439);function y(G,U,N){N=N||M.t_;const A=(new p.A).readFeature(G,{dataProjection:G.projection,featureProjection:U});A.setId(N(G));const g=(0,M.k0)(G);void 0!==g&&A.set("_title",g,!0),void 0!==G.extent&&A.set("_extent",G.extent,!0),void 0!==G.projection&&A.set("_projection",G.projection,!0);const u=(0,M.jZ)(G,"meta.mapTitle");void 0!==u&&A.set("_mapTitle",u,!0),A.set("_entityRevision",(0,M.nd)(G),!0);const O=(0,M.Zq)(G);return void 0!==O&&A.set("_icon",O,!0),G.meta&&G.meta.style&&A.set("_style",G.meta.style,!0),G.sourceId&&A.set("_sourceId",G.sourceId,!0),A}function b(G,U,N,W="EPSG:4326"){let A,g,u,O;N?(g=N.get("title"),N.get("sourceOptions")&&(u=N.get("sourceOptions").excludeAttribute,O=N.get("sourceOptions").excludeAttributeOffline)):g=G.get("_title");const j=new p.A,P=G.getProperties(),Y=G.getType();if("Polygon"===Y){const z=G.getEnds();A=new o.Ay(G.getFlatCoordinates(),"XY",z)}else"Point"===Y?A=new c.A(G.getFlatCoordinates(),"XY"):"LineString"===Y&&(A=new e.A(G.getFlatCoordinates(),"XY"));const w=j.writeGeometryObject(A,{dataProjection:W,featureProjection:U}),I=G.getId()?G.getId():(0,a.uR)(),E=G.get("_mapTitle"),s=L.DI(G.getExtent(),U,W);return{type:v.R,projection:W,extent:s,meta:{id:I,title:g||E||I,mapTitle:E,excludeAttribute:u,excludeAttributeOffline:O},properties:P,geometry:w,ol:G}}function k(G,U,N,W="EPSG:4326"){let A,g,u,O;const j=new p.A,Y=G.getKeys().filter(z=>!z.startsWith("_")&&"geometry"!==z).reduce((z,Q)=>(z[Q]=G.get(Q),z),{}),w=j.writeGeometryObject(G.getGeometry(),{dataProjection:W,featureProjection:U});if(N){A=N.get("title");const z=N.get("sourceOptions");z&&(g=z.excludeAttribute,u=z.excludeAttributeOffline,O=z.idColumn||("arcgisrest"===z.type||"tilearcgisrest"===z.type?"OBJECTID":void 0))}else A=G.get("_title");const I=G.get("_mapTitle"),E=G.getId()?G.getId():G.get(O)?G.get(O):(0,a.uR)();return G.get("_newFeature"),{type:v.R,projection:W,extent:G.get("_extent"),meta:{id:E,title:A||I||E,mapTitle:I,revision:G.getRevision(),style:G.get("_style"),excludeAttribute:g,excludeAttributeOffline:u},properties:Y,geometry:w,ol:G}}function D(G,U){const N=F.S5();return G.forEach(W=>{const A=function _(G,U){let N=F.S5();const W=G.get("_extent"),A=G.get("_projection");if(void 0!==W&&void 0!==A)N=L.DI(W,A,U);else{const g=G.getGeometry();null!==g&&(N=g.getExtent())}return N}(W,U);F.X$(N,A)}),N}function h(G,U){const[N,W]=F.YC(G);return[U[3]?G[0]-N*U[3]:G[0],U[2]?G[1]-W*U[2]:G[1],U[1]?G[2]+N*U[1]:G[2],U[0]?G[3]+W*U[0]:G[3]]}function X(G,U,N=.05){const W=Array.isArray(N)?N:[N,N,N,N],g=h(G,[-1,-1,-1,-1].map((u,O)=>u*W[O]));return!F.ms(g,U)}function H(G,U,N){N=N||.004;const W=G.getExtent(),A=F.UG(W),g=F.UG(U);return!(0===g&&G.getZoom()>13)&&g/A<N}function x(G,U,N=v.B.Default,W,A){const g=G.getExtent(),O=D(U,G.getOlProjection());let j=O;void 0!==W&&(j=h(j,W)),N===v.B.Zoom?G.zoomToExtent(j):N===v.B.Move?G.moveToExtent(j):N===v.B.Default&&(X(g,O)||H(G,O,A))&&G.zoomToExtent(j)}function ee(G){G.setStyle(new R.Ay({}))}function Z(G,U){const N=new Map;U.forEach(u=>{N.set(u.getId(),u)});const W=[];G.forEach(u=>{const O=N.get(u.getId());void 0===O||O.get("_entityRevision")!==u.get("_entityRevision")?W.push(u):N.delete(O.getId())});const A=Array.from(N.keys());return{add:U.filter(u=>A.indexOf(u.getId())>=0),remove:W}}},44295:(De,le,r)=>{"use strict";r.d(le,{RI:()=>M.R,Bl:()=>M.B,oE:()=>p.o,MZ:()=>e.M,Sh:()=>L,CJ:()=>D,n6:()=>k.n,px:()=>x,ZA:()=>h.Z,AI:()=>b,M8:()=>a.M8,M2:()=>a.M2,xH:()=>a.xH,as:()=>a.as,WJ:()=>a.WJ,p6:()=>a.p6,c2:()=>ee.c,_O:()=>ee._,df:()=>F.d});var M=r(3439),a=r(33864),F=r(84540),p=r(67852),e=r(66720),c=r(75300),o=r(52575);class L extends c.Mo{options;stores$$=new Map;resolution$$=[];empty$$;constructor(G){super(G),this.options=G}bindStore(G){super.bindStore(G),!0===this.active&&this.watchStore(G),this.empty$$=G.empty$.subscribe(()=>this.updateEntitiesInResolution(G,G.layer.map.viewController.getResolution()))}unbindStore(G){super.unbindStore(G),!0===this.active&&this.unwatchStore(G)}doActivate(){this.stores.forEach(G=>this.watchStore(G))}doDeactivate(){this.unwatchAll()}watchStore(G){this.stores$$.has(G)||(this.updateEntitiesInResolution(G,G.layer.map.viewController.getResolution()),this.resolution$$.push(G.layer.map.viewController.resolution$.pipe((0,o.B)(250)).subscribe(U=>{this.updateEntitiesInResolution(G,U)})))}updateEntitiesInResolution(G,U){G.state.updateAll(U>G.layer.minResolution&&U<G.layer.maxResolution?{inMapResolution:!0}:{inMapResolution:!1})}unwatchStore(G){void 0!==this.stores$$.get(G)&&this.stores$$.delete(G)}unwatchAll(){this.stores$$.clear(),this.resolution$$.map(G=>G.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var R=r(68671),v=r(5057),y=r(19807);class b extends c.Mo{options;propertyTypeDetectorService;capabilitiesService;stores$$=new Map;states$$=[];empty$$;map;constructor(G,U,N){super(G),this.options=G,this.propertyTypeDetectorService=U,this.capabilitiesService=N,this.map=G.map}bindStore(G){super.bindStore(G),!0===this.active&&this.watchStore(G)}unbindStore(G){super.unbindStore(G),!0===this.active&&this.unwatchStore(G)}doActivate(){this.stores.forEach(G=>this.watchStore(G))}doDeactivate(){this.unwatchAll()}watchStore(G){this.stores$$.has(G)||(this.updateEntitiesPropertiesState(G),this.states$$.push(this.map.layers$.pipe((0,o.B)(250),(0,v.J)()).subscribe(([U,N])=>{let W;U&&(W=U.map(g=>g.id));const A=N.filter(g=>!W.includes(g.id));this.updateEntitiesPropertiesState(G,A)})),this.states$$.push(G.entities$.pipe((0,o.B)(250)).subscribe(U=>{this.updateEntitiesPropertiesState(G)})))}updateEntitiesPropertiesState(G,U){const N=this.map.layers.map(w=>w.id);let W=[];W=U?G.entities$.value:G.stateView.all().length?G.stateView.all().filter(I=>!I.state.geoService).map(I=>I.entity):G.entities$.value;const g=W.slice(0,W.length>=250?250:W.length);let u=[];g.map(w=>{u=u.concat(Object.keys(w.properties||{}))}),u=[...new Set(u)];const O={};u.map(w=>{O[w]=[...new Set(W.map(I=>I.properties[w]))]});const j={};Object.entries(O).forEach(w=>{const[I,E]=w,s=E.filter(z=>this.propertyTypeDetectorService.isGeoService(z));s?.length&&(j[I]=s)});const P=[];Object.entries(j).forEach(w=>{const[I,E]=w;E.map(s=>{const z=this.propertyTypeDetectorService.getGeoService(s,u);if(z){const Q=u.filter(ye=>z.propertiesForLayerName.includes(ye)),ae=Q.length?Q[0]:void 0;ae&&P.push({url:s,urlProperty:I,layerNameProperty:ae,geoService:z})}})});const Y=[];P.map(w=>{const I=w.url,E=w.geoService.type||"wms";O[w.layerNameProperty].map(s=>{let Q,z=s;["arcgisrest","imagearcgisrest","tilearcgisrest"].includes(E)&&(z=void 0,Q=s);const ae=R.BF.removeUndefined({sourceOptions:{type:E||"wms",url:I,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:z,LAYER:Q}}}),ye=(0,y._E)(ae.sourceOptions);Y.push({geoServiceAssociation:w,state:{added:void 0!==N.find(de=>de===ye),haveGeoServiceProperties:!0,type:E,url:I,layerName:s}})})}),Y.map(w=>{const I=w.geoServiceAssociation.urlProperty,E=w.geoServiceAssociation.layerNameProperty,s=w.state.url,z=w.state.layerName,Q=W.filter(ye=>ye.properties[I]===s&&ye.properties[E]===z);G.state.updateMany(Q,{geoService:w.state},!0)})}unwatchStore(G){void 0!==this.stores$$.get(G)&&this.stores$$.delete(G)}unwatchAll(){this.stores$$.clear(),this.states$$.map(G=>G.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var k=r(9355),_=r(12171);class D extends c.Mo{options;stores$$=new Map;constructor(G){super(G),this.options=G}bindStore(G){super.bindStore(G),!0===this.active&&this.watchStore(G)}unbindStore(G){super.unbindStore(G),!0===this.active&&this.unwatchStore(G)}doActivate(){this.stores.forEach(G=>this.watchStore(G))}doDeactivate(){this.unwatchAll()}watchStore(G){this.stores$$.has(G)||(this.onSourceChanges(G),G.layer.ol.getSource().on("change",N=>{this.onSourceChanges(G)}))}unwatchStore(G){void 0!==this.stores$$.get(G)&&this.stores$$.delete(G)}unwatchAll(){Array.from(this.stores$$.entries()).forEach(G=>{}),this.stores$$.clear()}onSourceChanges(G){let U=G.layer.ol.getSource().getFeatures();G.layer.dataSource instanceof _.U&&(U=U.flatMap(N=>N.get("features"))),0===U.length?G.clear():G.setStoreOlFeatures(U)}}var h=r(12393),X=r(42228),H=r(97489);class x extends c.Mo{options;stores$$=new Map;constructor(G){super(G),this.options=G}bindStore(G){super.bindStore(G),!0===this.active&&this.watchStore(G)}unbindStore(G){super.unbindStore(G),!0===this.active&&this.unwatchStore(G)}doActivate(){this.stores.forEach(G=>this.watchStore(G))}doDeactivate(){this.unwatchAll()}initStoreSearchIndex(G){G.searchDocument=new X.Document({tokenize:"full"})}watchStore(G){this.stores$$.has(G)||(this.initStoreSearchIndex(G),G.entities$.pipe((0,H.j)(U=>!U.length)).subscribe(()=>this.onEntitiesChanges(G)))}unwatchStore(G){void 0!==this.stores$$.get(G)&&(G.searchDocument=void 0,this.stores$$.delete(G))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(G=>{}),this.stores$$.clear()}onEntitiesChanges(G){const U=this.options.percentDistinctValueRatio||2,N=[];G.index.forEach((u,O)=>{const j=u.properties;j.igoSearchID=O,N.push(j)});const W=[];let A=[],g=[];if(this.options.sourceFields)A=this.options.sourceFields.filter(u=>!u.searchIndex?.enabled),g=this.options.sourceFields.filter(u=>u.searchIndex?.enabled).map(u=>Object.assign({},{field:u.name,tokenize:"full"},u.searchIndex));else if(N.length){const u=Object.keys(N[0]),O=[];A=u.map(P=>{const Y=[...new Set(N.map(w=>w[P]))];Y.length/N.length*100<=U||Y.every(w=>Number(w)===w&&w%1!=0)?A.push(P):O.push(P)}).filter(P=>P),g=O.filter(P=>"igoSearchID"!==P).map(P=>({field:P,tokenize:"full"}))}G.index.forEach((u,O)=>{const j=JSON.parse(JSON.stringify(u.properties));A.map(P=>delete j[P]),Object.keys(j).length&&W.push(j)}),0===W.length?this.initStoreSearchIndex(G):(G.searchDocument=new X.Document({document:{id:"igoSearchID",index:g}}),W.map(u=>{G.searchDocument.add(u.igoSearchID,u)}))}}var ee=r(35235)},67852:(De,le,r)=>{"use strict";r.d(le,{o:()=>e});var M=r(75300),a=r(84505),F=r(3439),p=r(33864);class e extends M.D_{layer;map;get source(){return this.layer?this.layer.dataSource:void 0}set searchDocument(o){this._searchDocument=o}get searchDocument(){return this._searchDocument}_searchDocument;constructor(o,L){super(o,L),this.map=L.map}bindLayer(o){return this.layer=o,this}setLayerFeatures(o,L=F.B.Default,R,v,y){y=y||M.t_,this.checkLayer();const b=o.map(k=>(0,p.xH)(k,this.map.projection,y));this.setLayerOlFeatures(b,L,R,v)}setStoreOlFeatures(o){this.checkLayer();const L=o.map(R=>(R.set("_featureStore",this,!0),(0,p.M2)(R,this.layer.map.projection)));this.load(L)}clearLayer(){this.checkLayer(),this.source.ol.clear()}checkLayer(){if(void 0===this.layer)throw new Error("This FeatureStore is not bound to a layer.")}setLayerOlFeatures(o,L=F.B.Default,R,v){const y=this.layer.ol.getSource(),b=(0,p.LN)(y.getFeatures(),o);b.remove.length>0&&this.removeOlFeaturesFromLayer(b.remove),b.add.length>0&&this.addOlFeaturesToLayer(b.add),b.add.length>0?(0,p.p6)(this.map.viewController,b.add,L,R,v):b.remove.length>0&&(0,p.p6)(this.map.viewController,o,L,R,v)}setLayerExtent(){let o=this.entities$.getValue(),L=a.S5(),R=[];o.forEach(y=>{R.push((0,p.xH)(y,this.map.projection))});const v=(0,p.M8)(R,this.map.viewProjection);a.X$(L,v),this.layer.setExtent(L)}addOlFeaturesToLayer(o){o.forEach(L=>{L.set("_featureStore",this,!0)}),this.source.ol.addFeatures(o)}removeOlFeaturesFromLayer(o){o.forEach(L=>{this.source.ol.removeFeature(L)})}}},35235:(De,le,r)=>{"use strict";r.d(le,{_:()=>p,c:()=>F});var M=r(9355),a=r(12393);function F(e,c){void 0===e.getStrategyOfType(M.n)?(c=c||new M.n({}),e.addStrategy(c),c.activate()):e.activateStrategyOfType(M.n)}function p(e,c){void 0===e.getStrategyOfType(a.Z)?(c=c||new a.Z({map:e.map}),e.addStrategy(c),c.activate()):e.activateStrategyOfType(a.Z)}},66720:(De,le,r)=>{"use strict";r.d(le,{M:()=>e});var M=r(75300),a=r(84505),F=r(97489),p=r(52575);class e extends M.Mo{options;stores$$=new Map;states$$=[];empty$$;constructor(o){super(o),this.options=o}bindStore(o){super.bindStore(o),!0===this.active&&this.watchStore(o),this.empty$$=o.empty$.pipe((0,F.j)(L=>!L)).subscribe(()=>this.updateEntitiesInExtent(o))}unbindStore(o){super.unbindStore(o),!0===this.active&&this.unwatchStore(o)}doActivate(){this.stores.forEach(o=>this.watchStore(o))}doDeactivate(){this.unwatchAll()}watchStore(o){this.stores$$.has(o)||(this.updateEntitiesInExtent(o),this.states$$.push(o.layer.map.viewController.state$.pipe((0,p.B)(250)).subscribe(()=>this.updateEntitiesInExtent(o))))}updateEntitiesInExtent(o){if(o?.layer?.map?.viewController){o.state.updateAll({inMapExtent:!1});const L=o.layer.map.viewController.getExtent(),v=this.getFeaturesInExtent(o.entities$.value,L);o.state.updateMany(v,{inMapExtent:!0},!1)}}getFeaturesInExtent(o,L){return o.reduce((R,v)=>{const y=v.ol?.getGeometry();if(y){const b=y.getExtent();a.HY(b,L)&&R.push(v)}else R.push(v);return R},[])}unwatchStore(o){void 0!==this.stores$$.get(o)&&this.stores$$.delete(o)}unwatchAll(){this.stores$$.clear(),this.states$$.map(o=>o.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}},9355:(De,le,r)=>{"use strict";r.d(le,{n:()=>F});var M=r(75300),a=r(3439);class F extends M.Mo{options;stores$$=new Map;motion;constructor(e){super(e),this.options=e,this.setMotion(e.motion)}bindStore(e){super.bindStore(e),!0===this.active&&this.watchStore(e)}unbindStore(e){super.unbindStore(e),!0===this.active&&this.unwatchStore(e)}setMotion(e){this.motion=e}doActivate(){this.stores.forEach(e=>this.watchStore(e))}doDeactivate(){this.unwatchAll()}watchStore(e){if(this.stores$$.has(e))return;const c=e.view.all$().subscribe(o=>this.onFeaturesChange(o,e));this.stores$$.set(e,c)}unwatchStore(e){const c=this.stores$$.get(e);void 0!==c&&(c.unsubscribe(),this.stores$$.delete(e))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(e=>{e[1].unsubscribe()}),this.stores$$.clear()}onFeaturesChange(e,c){0===e.length?c.clearLayer():c.setLayerFeatures(e,this.selectMotion(c),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}selectMotion(e){return void 0!==this.motion?this.motion:!0===e.pristine||e.count>e.view.count?a.B.Default:a.B.None}}},12393:(De,le,r)=>{"use strict";r.d(le,{Z:()=>_,k:()=>k});var M=r(75300),a=r(12912),F=r(12328),p=r(19999),e=r(70271),c=r(52575),o=r(47470),L=r(91020),R=r(91640),v=r(64004),y=r(3439),b=r(67852);class k extends F.A{constructor(h){super(h)}}class _ extends M.Mo{options;mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;stores$$;motion;get map(){return this.options.map}get overlayStore(){return this._overlayStore}_overlayStore;constructor(h){super(h),this.options=h,this.setMotion(h.motion),this._overlayStore=this.createOverlayStore()}bindStore(h){super.bindStore(h),!0===this.active&&this.activate()}unbindStore(h){super.unbindStore(h),!0===this.active&&this.activate()}setMotion(h){this.motion=h}unselectAll(){this.stores.forEach(h=>{h.state.updateAll({selected:!1})})}clear(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}deactivateSelection(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}doActivate(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()}doDeactivate(){this.deactivateSelection(),this.removeOverlayLayer()}watchAll(){this.unwatchAll();const h=this.stores.map(X=>X.stateView.manyBy$(H=>!0===H.state.selected).pipe((0,e.T)(H=>H.map(x=>x.entity))));this.stores$$=(0,p.z)(h).pipe((0,c.B)(5),(0,o.i)(1),(0,e.T)(X=>X.reduce((H,x)=>H.concat(x)))).subscribe(X=>this.onSelectFromStore(X))}unwatchAll(){void 0!==this.stores$$&&this.stores$$.unsubscribe()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",h=>{this.onMapClick(h)})}unlistenToMapClick(){(0,a.e)(this.mapClickListener)}onMapClick(h){const X=!(0,v.hH)(h),H=!X,x=h.map.getFeaturesAtPixel(h.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:ee=>void 0!==this.stores.find(G=>G.layer?.ol===ee)});this.onSelectFromMap(x,X,H)}addDragBoxInteraction(){let h;const X=this.map.ol.getInteractions().getArray();for(const H of X)if(H instanceof k){h=H;break}void 0===h&&(h=new k({condition:v.hH}),this.map.ol.addInteraction(h),this.olDragSelectInteraction=h),this.olDragSelectInteractionEndKey=h.on("boxend",H=>this.onDragBoxEnd(H))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,a.e)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}onDragBoxEnd(h){const X=!(0,v.hH)(h.mapBrowserEvent),x=h.target.getGeometry().getExtent(),ee=this.stores.reduce((Z,G)=>{const U=G.layer.ol.getSource();return Z.push(...U.getFeaturesInExtent(x)),Z},[]);this.onSelectFromMap(ee,X,!1)}onSelectFromStore(h){const X=this.motion,x=this.overlayStore.layer.ol.getSource().getFeatures().map(G=>G.getId()),ee=h.map(this.overlayStore.getKey);let Z;Z=0!==h.length&&(x.length!==ee.length||!x.every(G=>ee.indexOf(G)>=0)),this.overlayStore.setLayerFeatures(h,Z?X:y.B.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}onSelectFromMap(h,X,H){const x=this.groupFeaturesByStore(h);this.stores.forEach(ee=>{const Z=x.get(ee);void 0===Z&&!0===X?this.unselectAllFeaturesFromStore(ee):void 0===Z&&!1===X||this.selectFeaturesFromStore(ee,Z,X,H)})}selectFeaturesFromStore(h,X,H,x){!0===x?h.state.reverseMany(X,["selected"]):h.state.updateMany(X,{selected:!0},H)}unselectAllFeaturesFromStore(h){h.state.updateAll({selected:!1})}groupFeaturesByStore(h){const X=new Map;return null==h||h.forEach(H=>{const x=H.get("_featureStore");if(void 0===x)return;let ee=X.get(x);void 0===ee&&(ee=[],X.set(x,ee));const Z=x.get(H.getId());void 0!==Z&&ee.push(Z)}),X}createOverlayStore(){const h=this.options.layer?this.options.layer:this.createOverlayLayer();return new b.o([],{map:this.map}).bindLayer(h)}createOverlayLayer(){return new R.v({zIndex:300,source:new L._k,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}addOverlayLayer(){void 0===this.overlayStore.layer.map&&this.map.addLayer(this.overlayStore.layer)}removeOverlayLayer(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)}}},66400:(De,le,r)=>{"use strict";r.d(le,{E:()=>a,s:()=>M});var M=function(F){return F.BasicNumericOperator="basicnumericoperator",F.Basic="basic",F.BasicAndSpatial="basicandspatial",F.Spatial="spatial",F.All="all",F.Time="time",F}(M||{}),a=function(F){return F.BBOX="BBox",F.PropertyIsBetween="PropertyIsBetween",F.Contains="Contains",F.During="During",F.PropertyIsEqualTo="PropertyIsEqualTo",F.PropertyIsGreaterThan="PropertyIsGreaterThan",F.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",F.Intersects="Intersects",F.PropertyIsNull="PropertyIsNull",F.PropertyIsLessThan="PropertyIsLessThan",F.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",F.PropertyIsLike="PropertyIsLike",F.PropertyIsNotEqualTo="PropertyIsNotEqualTo",F.Within="Within",F.And="And",F.Or="Or",F.Not="Not",F}(a||{})},17027:(De,le,r)=>{"use strict";r.d(le,{l:()=>L});var M=r(68671),a=r(5247),F=r(34927),p=r(14202),e=r(39545),c=r.n(e),o=r(66400);class L{filterSequence=[];operators={[o.E.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsLike]:{spatial:!1,fieldRestrict:["string"]},[o.E.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[o.E.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[o.E.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[o.E.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[o.E.PropertyIsBetween]:{spatial:!1,fieldRestrict:["number"]},[o.E.During]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsNull]:{spatial:!1,fieldRestrict:[]},[o.E.Intersects]:{spatial:!0,fieldRestrict:[]},[o.E.Within]:{spatial:!0,fieldRestrict:[]},[o.E.Contains]:{spatial:!0,fieldRestrict:[]}};defineOgcFiltersDefaultOptions(v,y,b){let k=!0;return b&&"wms"===b&&(k=!1),(v=v||{}).enabled=void 0===v.enabled?k:v.enabled,v.editable=void 0===v.editable?k:v.editable,v.geometryName=y,v.advancedOgcFilters=!0,v.enabled&&(v.pushButtons||v.checkboxes||v.radioButtons||v.select||v.autocomplete)&&(v.advancedOgcFilters=!1),v}buildFilter(v,y,b,k,_){let D,h,X;if(h=!/intersects|contains|within/gi.test(JSON.stringify(v)),v&&(k=void 0!==v.geometryName?v.geometryName:k),y&&v&&(D=p.Qk(k,y,b.getCode())),!v)return"bbox="+y.join(",")+","+b.getCode();v=this.checkIgoFiltersProperties(v,k,b),X=y&&h?p.Uo(D,this.bundleFilter(v,_)):this.bundleFilter(v,_);const H={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:X,outputFormat:"",geometryName:k},x=(new a.A).writeGetFeature(H);return"filter="+(new XMLSerializer).serializeToString(x).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]}bundleFilter(v,y){if(v instanceof Array){const b=[];return v.forEach(k=>{b.push(this.bundleFilter(k,y))}),b}return v.hasOwnProperty("logical")?this.createFilter({operator:v.logical,logicalArray:this.bundleFilter(v.filters,y)},y):v.hasOwnProperty("operator")?this.createFilter(v,y):void 0}createFilter(v,y){const b=v.operator,k=v.logicalArray,_=v.propertyName,D=v.pattern,h=!v.matchCase||v.matchCase,X=v.wildCard?v.wildCard:"*",H=v.singleChar?v.singleChar:".",x=v.escapeChar?v.escapeChar:"!",ee=v.lowerBoundary,Z=v.upperBoundary,G=v.geometryName,U=v.extent,N=v.wkt_geometry,W=v.srsName?v.srsName:"EPSG:3857",A=this.parseFilterOptionDate(v.begin,y?y.minDate:void 0),g=this.parseFilterOptionDate(v.end,y?y.maxDate:void 0),u=v.expression;let O;switch(N&&(O=(new F.A).readGeometry(N,{dataProjection:W,featureProjection:W||"EPSG:3857"})),b.toLowerCase()){case o.E.BBOX.toLowerCase():return p.Qk(G,U,W);case o.E.PropertyIsBetween.toLowerCase():return p.Tq(_,ee||-1e40,Z||1e40);case o.E.Contains.toLowerCase():return p.gR(G,O,W);case o.E.During.toLowerCase():return p.iW(_,A,g);case o.E.PropertyIsEqualTo.toLowerCase():return p.iz(_,u,h);case o.E.PropertyIsGreaterThan.toLowerCase():return p.MM(_,u);case o.E.PropertyIsGreaterThanOrEqualTo.toLowerCase():return p.An(_,u);case o.E.Intersects.toLowerCase():return p.HY(G,O,W);case o.E.PropertyIsNull.toLowerCase():return p.kZ(_);case o.E.PropertyIsLessThan.toLowerCase():return p.Xe(_,u);case o.E.PropertyIsLessThanOrEqualTo.toLowerCase():return p.Bj(_,u);case o.E.PropertyIsLike.toLowerCase():return p.mj(_,D?D.replace(/[()_]/gi,H):X,X,H,x,h);case o.E.PropertyIsNotEqualTo.toLowerCase():return p.Rn(_,u,h);case o.E.Within.toLowerCase():return p.ux(G,O,W);case o.E.And.toLowerCase():return p.Uo.apply(null,k);case o.E.Or.toLowerCase():return p.or.apply(null,k);case o.E.Not.toLowerCase():return p.AU.apply(null,k);default:return}}defineInterfaceFilterSequence(v,y,b="",k=-1){return v instanceof Array?v.forEach(_=>{this.filterSequence.concat(this.defineInterfaceFilterSequence(_,y,b,k))}):v.hasOwnProperty("logical")?this.filterSequence.concat(this.defineInterfaceFilterSequence(v.filters,y,v.logical,k+=1)):v.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(v,y,k,b)),this.filterSequence}computeAllowedOperators(v,y,b){let _,D,h,k={};if(v&&y){const X=v.find(H=>H.name===y);_=X&&X.allowedOperatorsType?X.allowedOperatorsType:b}switch(v&&v.map(X=>{if(!X.allowedOperatorsType)return;const H=X.allowedOperatorsType.toLowerCase();(H===o.s.All.toLowerCase()||H===o.s.Spatial.toLowerCase()||H===o.s.BasicAndSpatial.toLowerCase())&&(D=!0,H===o.s.All.toLowerCase()&&(h=!0))}),_=_||o.s.BasicAndSpatial,_.toLowerCase()){case o.s.All:k=this.operators;break;case o.s.Spatial:k={[o.E.Intersects]:{spatial:!0,fieldRestrict:[]},[o.E.Within]:{spatial:!0,fieldRestrict:[]}};break;case o.s.BasicAndSpatial:k={[o.E.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.Intersects]:{spatial:!0,fieldRestrict:[]},[o.E.Within]:{spatial:!0,fieldRestrict:[]}};break;case o.s.Basic:k={[o.E.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]}};break;case o.s.Time:k={[o.E.During]:{spatial:!1,fieldRestrict:[]}};break;case o.s.BasicNumericOperator:k={[o.E.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[o.E.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[o.E.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[o.E.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]}};break;default:k={[o.E.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[o.E.Intersects]:{spatial:!0,fieldRestrict:[]},[o.E.Within]:{spatial:!0,fieldRestrict:[]}}}return D&&(k.Intersects={spatial:!0,fieldRestrict:[]},k.Within={spatial:!0,fieldRestrict:[]},h&&(k.Contains={spatial:!0,fieldRestrict:[]})),k}addInterfaceFilter(v,y,b=0,k="Or"){v||(v={operator:"PropertyIsEqualTo"});const _={propertyName:"",operator:"",active:"",filterid:(0,M.uR)(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(_,{parentLogical:k,level:b,geometryName:y},v)}checkIgoFiltersProperties(v,y,b,k=!1){const _=[];return v instanceof Array?(v.forEach(D=>{_.push(this.checkIgoFiltersProperties(D,y,b,k))}),_):v.hasOwnProperty("logical")?Object.assign({},{logical:v.logical,filters:this.checkIgoFiltersProperties(v.filters,y,b,k)}):v.hasOwnProperty("operator")?this.addFilterProperties(v,y,b,k):void 0}addFilterProperties(v,y,b,k=!1){const _=v.hasOwnProperty("filterid")?v.filterid:(0,M.uR)(),D=v.hasOwnProperty("active")?v.active:k,h=v.hasOwnProperty("srsName")?v.srsName:b?b.getCode():"EPSG:3857";return Object.assign({},{filterid:_,active:D,igoSpatialSelector:"fixedExtent",srsName:h},v,{geometryName:y})}rebuiltIgoOgcFilterObjectFromSequence(v){if(v instanceof Array&&v.length>=1){let b,_,y=v[0].parentLogical,k=[];return v.forEach(D=>{const h=Object.assign({},D),X=v.indexOf(D);b=X>=0&&X<v.length-1?v[X+1]:h,delete h.active,delete h.filterid,delete h.parentLogical,k.push(h),1===v.length?_=h:y!==b.parentLogical&&(1===k.length?console.log("You must set at least two operator in a logical ("+y+")"):(_=Object.assign({},{logical:y,filters:k}),k=[_],y=b.parentLogical))}),_}}computeIgoSelector(v){if(v.groups.every(b=>void 0!==b.computedSelectors))return v;let y;if(v.groups&&v.bundles){if(!v.bundles.every(b=>void 0!==b.id))throw new Error("You must set an id for each of your bundles");y=M.BF.copyDeep(v),y.groups.forEach(b=>{b.title=b.title?b.title:b.name,b.enabled=!!b.enabled&&b.enabled,b.computedSelectors=M.BF.copyDeep(y.bundles.filter(k=>b.ids.includes(k.id)))})}else!v.groups&&v.bundles?(y=M.BF.copyDeep(v),y.groups=[{title:"group1",name:"group1",computedSelectors:M.BF.copyDeep(y.bundles)}]):y={bundles:v,groups:[{title:"group1",name:"group1",computedSelectors:M.BF.copyDeep(v)}],selectorType:y.selectorType};return y.groups.find(b=>b.enabled)||(y.groups[0].enabled=!0),y}handleOgcFiltersAppliedValue(v,y,b,k){const _=v.ogcFilters;if(!_)return;const D=[];let h="",X="";if(_.enabled&&(_.pushButtons||_.checkboxes||_.radioButtons||_.select||_.autocomplete)){let x;if(_.pushButtons){x=_.pushButtons;const ee=this.formatGroupAndFilter(_,x);for(const Z of ee)D.push(Z)}if(_.checkboxes){x=_.checkboxes;const ee=this.formatGroupAndFilter(_,x);for(const Z of ee)D.push(Z)}if(_.radioButtons){x=_.radioButtons;const ee=this.verifyMultipleEnableds(x),Z=this.formatGroupAndFilter(_,ee);for(const G of Z)D.push(G)}if(_.select){x=_.select;const ee=this.verifyMultipleEnableds(x),Z=this.formatGroupAndFilter(_,ee);for(const G of Z)D.push(G)}if(_.autocomplete){x=_.autocomplete;const ee=this.formatGroupAndFilter(_,x);for(const Z of ee)D.push(Z)}_.filters&&"operator"in _.filters&&_.filters.operator.toLowerCase()===o.E.During.toLowerCase()&&_.filters.active&&_.interfaceOgcFilters?.length>0&&D.push(_.interfaceOgcFilters[0]),D.length>=1&&(h=this.buildFilter(1===D.length?D[0]:{logical:"And",filters:D},b,k,_.geometryName))}_.enabled&&_.filters&&(_.geometryName=_.geometryName||y,X=this.buildFilter(_.filters,b,k,_.geometryName,v));let H=_.advancedOgcFilters?X:h;return"wms"===v.type&&(H=this.formatProcessedOgcFilter(H,v.params.LAYERS)),"wfs"===v.type&&(H=this.formatProcessedOgcFilter(H,v.params.featureTypes)),H}verifyMultipleEnableds(v){return v.bundles.forEach(y=>{if(!y.multiple&&y.selectors){const b=y.selectors.reduce((k,_,D)=>!0===_.enabled?k.concat(D):k,[]);b.length>1&&(b.splice(0,1),b.forEach(k=>{y.selectors[k].enabled=!1}))}}),v}formatGroupAndFilter(v,y){const b=(y=this.computeIgoSelector(y)).groups.find(_=>_.enabled).computedSelectors,k=[];return b.map(_=>{const D=[],h=_.selectors;h&&(h.filter(X=>!0===X.enabled).forEach(X=>D.push(X.filters)),1===D.length?k.push(D[0]):D.length>1&&k.push({logical:_.logical,filters:D}))}),"pushButton"===y.selectorType?v.pushButtons=y:"checkbox"===y.selectorType?v.checkboxes=y:"radioButton"===y.selectorType?v.radioButtons=y:"select"===y.selectorType?v.select=y:"autocomplete"===y.selectorType&&(v.autocomplete=y),k}formatProcessedOgcFilter(v,y){if(!v)return;let b="";return 0===v.length&&-1===y.indexOf(",")?b=v:y.split(",").forEach(_=>{b=`${b}(${v.replace("filter=","")})`}),b=b.replace(/\(\)/g,""),b.length>0?b.replace("filter=",""):void 0}parseFilterOptionDate(v,y){return v?v.toLowerCase().includes("now")||v.toLowerCase().includes("today")?this.parseDateOperation(v):c()(v).isValid()?v:void 0:y}parseDateOperation(v){const y=v.toLowerCase().split(" "),b=y[0],k=["+","-"].includes(y[1])?y[1]:void 0,_=/^[0-9]*$/.test(y[2])?y[2]:void 0,D=["years","months","weeks","days","hours","seconds"].includes(y[3])?y[3]:void 0;return k&&D&&_?"+"===k?"now"===b?c()().add(parseInt(_,10),D).format():c()().endOf("day").add(parseInt(_,10),D).format():"now"===b?c()().subtract(parseInt(_,10),D).format():c()().endOf("day").subtract(parseInt(_,10),D).format():"now"===b?c()().format():c()().endOf("day").format()}}},14114:(De,le,r)=>{"use strict";r.d(le,{U:()=>M,Z:()=>a});var M=function(F){return F.DATE="date",F.TIME="time",F.DATETIME="datetime",F.YEAR="year",F}(M||{}),a=function(F){return F.CALENDAR="calendar",F.SLIDER="slider",F}(a||{})},44260:(De,le,r)=>{"use strict";r.d(le,{S:()=>b});var M=r(12912),a=r(68710),F=r(36758),p=r(77662),e=r(60052),c=r(18094),o=r(65836),L=r(84205),R=r(75797),v=r(18537),y=r(57510);class b{options;start$=new L.B;end$=new L.B;changes$=new L.B;modify$=new L.B;select$=new L.B;abort$=new L.B;freehand$=new R.t(!1);ispredefinedRadius$=new R.t(!1);predefinedRadius$=new R.t(void 0);radiusDrawEnd$=new R.t(void 0);keyDown$$;olGeometryType;olInteractionStyle;olMap;olDrawingLayer;olDrawInteraction;olSelectInteraction;olModifyInteraction;onDrawStartKey;onDrawEndKey;onDrawAbortKey;onDrawKey;radius;mousePosition;get radiusVal(){return this.predefinedRadius$.getValue()}set radiusValData(_){this.predefinedRadius$.next(_)}get active(){return void 0!==this.olMap}get olDrawingLayerSource(){return this.olDrawingLayer.getSource()}constructor(_){this.options=_,this.olDrawingLayer=_.drawingLayer?_.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType,this.olInteractionStyle=this.options.interactionStyle}setOlMap(_,D){if(!_)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),void(this.olMap=_);this.olMap=_,this.addOlInnerOverlayLayer(),this.addOlInteractions(D)}getSource(){return this.olDrawingLayerSource}setOlInteractionStyle(_){this.olInteractionStyle=_}setGeometryType(_){this.olGeometryType=_}getGeometryType(){return this.olGeometryType}createOlInnerOverlayLayer(){return new c.A({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new o.A,style:this.options.drawingLayerStyle,zIndex:500})}removeOlInnerOverlayLayer(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}addOlInnerOverlayLayer(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}clearOlInnerOverlaySource(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}addOlInteractions(_){let D;if(D=this.freehand$.getValue()?new F.Ay("Point"===this.olGeometryType?{type:"Circle",source:this.getSource(),style:"function"==typeof this.olInteractionStyle?void 0:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}:{type:this.olGeometryType,source:this.getSource(),style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):this.ispredefinedRadius$.getValue()?new F.Ay({type:"Point",source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}):new F.Ay({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}),this.olMap.addInteraction(D),this.olDrawInteraction=D,this.onDrawStartKey=D.on("drawstart",h=>this.onDrawStart(h)),this.onDrawEndKey=D.on("drawend",h=>this.onDrawEnd(h)),this.onDrawAbortKey=D.on("drawabort",h=>this.abort$.next(h.feature.getGeometry())),_){const h=new p.A({source:this.getSource()});if(this.olMap.addInteraction(h),this.olModifyInteraction=h,!this.olSelectInteraction){const X=new e.A({condition:a.qG,style:void 0});this.olMap.addInteraction(X),this.olSelectInteraction=X,this.olSelectInteraction.on("select",H=>this.onSelect(H))}}}removeOlInteractions(){this.unsubscribeKeyDown(),(0,M.e)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}onDrawStart(_){const D=_.feature.getGeometry();this.start$.next(D),this.clearOlInnerOverlaySource(),this.onDrawKey=D.on("change",h=>{this.mousePosition=(0,y.ki)(h),this.changes$.next(h.target)}),this.subscribeKeyDown()}onDrawEnd(_){"Point"===_.feature.getGeometry().getType()&&this.radiusDrawEnd$.next(this.predefinedRadius$.getValue()),this.unsubscribeKeyDown(),(0,M.e)(this.onDrawKey);const D=_.feature.getGeometry();D.on("change",()=>{this.modify$.next(D)}),this.end$.next(D)}onSelect(_){1===_.selected.length&&this.select$.next(_.selected[0])}subscribeKeyDown(){this.unsubscribeKeyDown(),this.keyDown$$=(0,v.R)(document,"keydown").subscribe(_=>{"Escape"!==_.key?("Backspace"===_.key&&this.olDrawInteraction.removeLastPoint(),"Enter"===_.key&&this.olDrawInteraction.finishDrawing()," "!==_.key||this.olMap.getView().animate({center:this.mousePosition,duration:100})):this.olDrawInteraction.abortDrawing()})}unsubscribeKeyDown(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}}},13680:(De,le,r)=>{"use strict";r.d(le,{SW:()=>M.S,YV:()=>D});var M=r(44260),a=r(94691),F=r(12912),p=r(20199),e=r(93812),c=r(12328),o=r(36758),L=r(77662),R=r(84740),v=r(18094),y=r(65836),b=r(84205),k=r(18537),_=r(57510);class D{options;start$=new b.B;end$=new b.B;changes$=new b.B;olMap;olOverlayLayer;olModifyInteraction;onModifyStartKey;onModifyEndKey;onModifyKey;olModifyInteractionIsActive=!1;olTranslateInteraction;onTranslateStartKey;onTranslateEndKey;onTranslateKey;olTranslateInteractionIsActive=!1;olDrawInteraction;onDrawStartKey;onDrawEndKey;onDrawKey;olDrawInteractionIsActive=!1;mousePosition;keyDown$$;drawKeyUp$$;drawKeyDown$$;removedOlInteractions=[];olLinearRingsLayer;olOuterGeometry;get active(){return void 0!==this.olMap}get olOverlaySource(){return this.olOverlayLayer.getSource()}get olLinearRingsSource(){return this.olLinearRingsLayer.getSource()}modify=!0;translate=!0;constructor(x){this.options=x,void 0!==x.modify&&(this.modify=x.modify),void 0!==x.translate&&(this.translate=x.translate),this.olOverlayLayer=void 0!==x.layer?x.layer:this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}setOlMap(x){if(void 0===x)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=x);this.olMap=x,this.addOlInnerOverlayLayer(),!0===this.modify&&this.addOlDrawInteraction(),!0===this.translate&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),!0===this.modify&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}getSource(){return this.olOverlaySource}setOlGeometry(x){const ee=new a.A({geometry:x});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(ee)}createOlInnerOverlayLayer(){return new v.A({source:this.options.source?this.options.source:new y.A,style:this.options.layerStyle,zIndex:500})}addOlInnerOverlayLayer(){void 0===this.options.layer&&this.olMap.addLayer(this.olOverlayLayer)}removeOlInnerOverlayLayer(){void 0===this.options.layer&&void 0!==this.olMap&&this.olMap.removeLayer(this.olOverlayLayer)}clearOlInnerOverlaySource(){void 0===this.options.layer&&void 0===this.options.source&&this.olOverlaySource.clear(!0)}createOlLinearRingsLayer(){return new v.A({source:new y.A,style:(0,_.Yx)(),zIndex:500})}addOlLinearRingsLayer(){this.olMap.addLayer(this.olLinearRingsLayer)}removeOlLinearRingsLayer(){this.olMap.removeLayer(this.olLinearRingsLayer)}clearOlLinearRingsSource(){this.olLinearRingsSource.clear(!0)}addOlModifyInteraction(){const x=new L.A({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=x}removeOlModifyInteraction(){void 0!==this.olModifyInteraction&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}activateModifyInteraction(){!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",x=>this.onModifyStart(x)),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",x=>this.onModifyEnd(x)),this.olMap.addInteraction(this.olModifyInteraction))}deactivateModifyInteraction(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,(0,F.e)([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olModifyInteraction))}onModifyStart(x){const ee=x.features.item(0).getGeometry();this.start$.next(ee),this.onModifyKey=ee.on("change",Z=>{this.mousePosition=(0,_.ki)(Z),this.changes$.next(Z.target)}),this.subscribeToKeyDown()}onModifyEnd(x){(0,F.e)(this.onModifyKey),this.end$.next(x.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}subscribeToKeyDown(){this.keyDown$$=(0,k.R)(document,"keydown").subscribe(x=>{" "!==x.key||this.olMap.getView().animate({center:this.mousePosition,duration:0})})}unsubscribeToKeyDown(){void 0!==this.keyDown$$&&this.keyDown$$.unsubscribe()}addOlTranslateInteraction(){const x=new R.A({layers:[this.olOverlayLayer]});this.olTranslateInteraction=x}removeOlTranslateInteraction(){void 0!==this.olTranslateInteraction&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}activateTranslateInteraction(){!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",x=>this.onTranslateStart(x)),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",x=>this.onTranslateEnd(x)),this.olMap.addInteraction(this.olTranslateInteraction))}deactivateTranslateInteraction(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,(0,F.e)([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olTranslateInteraction))}onTranslateStart(x){const ee=x.features.item(0).getGeometry();this.start$.next(ee),this.onTranslateKey=ee.on("change",Z=>{})}onTranslateEnd(x){(0,F.e)(this.onTranslateKey),this.end$.next(x.features.item(0).getGeometry())}addOlDrawInteraction(){const x=new o.Ay({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:(0,_.Yx)(),condition:ee=>(this.olOuterGeometry||this.getOlGeometry()).intersectsCoordinate(ee.coordinate)});this.olDrawInteraction=x,this.subscribeToDrawKeyDown()}subscribeToDrawKeyDown(){this.drawKeyDown$$=(0,k.R)(document,"keydown").subscribe(x=>{if("Control"!==x.key)return;this.unsubscribeToDrawKeyDown();const ee=this.getOlGeometry();!ee||!(ee instanceof e.Ay)||(this.subscribeToDrawKeyUp(),this.deactivateModifyInteraction(),this.deactivateTranslateInteraction(),this.activateDrawInteraction())})}subscribeToDrawKeyUp(){this.drawKeyUp$$=(0,k.R)(document,"keyup").subscribe(x=>{"Control"===x.key&&(this.unsubscribeToDrawKeyUp(),this.unsubscribeToKeyDown(),this.deactivateDrawInteraction(),this.activateModifyInteraction(),!0===this.translate&&this.activateTranslateInteraction(),this.subscribeToDrawKeyDown(),this.olOuterGeometry=void 0,this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()))})}unsubscribeToDrawKeyDown(){void 0!==this.drawKeyDown$$&&this.drawKeyDown$$.unsubscribe()}unsubscribeToDrawKeyUp(){void 0!==this.drawKeyUp$$&&this.drawKeyUp$$.unsubscribe()}removeOlDrawInteraction(){void 0!==this.olDrawInteraction&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}activateDrawInteraction(){!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(x=>{x instanceof c.A&&(this.olMap.removeInteraction(x),this.removedOlInteractions.push(x))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",x=>this.onDrawStart(x)),this.onDrawEndKey=this.olDrawInteraction.on("drawend",x=>this.onDrawEnd(x)),this.olMap.addInteraction(this.olDrawInteraction))}deactivateDrawInteraction(){!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(x=>{this.olMap.addInteraction(x)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,(0,F.e)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olDrawInteraction))}onDrawStart(x){const ee=x.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();const Z=ee.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(Z),this.start$.next(this.getOlGeometry()),this.onDrawKey=ee.on("change",G=>{this.mousePosition=(0,_.ki)(G);const N=G.target.getLinearRing(0).getCoordinates();this.updateLinearRingOfOlGeometry(N),this.changes$.next(this.getOlGeometry())}),this.subscribeToKeyDown()}onDrawEnd(x){(0,F.e)(this.onDrawKey),this.olOuterGeometry=void 0;const ee=x.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(ee),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}addLinearRingToOlGeometry(x){const ee=this.getOlGeometry(),Z=new p.A(x);(0,_.bV)(ee,Z)}updateLinearRingOfOlGeometry(x){const ee=this.getOlGeometry(),G=ee.getLinearRings().slice(0,-1).map(U=>U.getCoordinates());G.push(x),ee.setCoordinates(G)}getOlGeometry(){const x=this.olOverlaySource.getFeatures();return x.length>0?x[0].getGeometry():void 0}}r(1692)},1692:(De,le,r)=>{"use strict";Error},57510:(De,le,r)=>{"use strict";r.d(le,{Yx:()=>v,bV:()=>_,g4:()=>R,ki:()=>D});var M=r(93812),a=r(61099),F=r(1963),p=r(18194),e=r(29814);function R(h){return new a.A({stroke:new F.A({color:(h=h||[0,153,255]).concat([1]),width:2}),fill:new p.A({color:h.concat([.2])}),radius:8})}function v(){return new e.Ay({stroke:new F.A({color:[0,153,255,1],width:2})})}function _(h,X){h.appendLinearRing(X)}function D(h){const X=h.target;return X instanceof M.Ay?X.getFlatCoordinates().slice(-4,-2):X.getFlatCoordinates().slice(-2)}r(27885),r(68262),r(1692)},36741:(De,le,r)=>{"use strict";r.d(le,{SW:()=>F.SW,YV:()=>F.YV}),r(1692),r(57510);var F=r(13680)},44860:(De,le,r)=>{"use strict";r.d(le,{BY:()=>M.B,Ib:()=>a.Ib,X9:()=>a.X9,vK:()=>a.vK});var M=r(64412),a=r(24371)},81081:(De,le,r)=>{"use strict";r.d(le,{I:()=>M});const M="Layer"},64412:(De,le,r)=>{"use strict";r.d(le,{B:()=>N});var M=r(30699),a=r(1455),F=r(68671),p=r(29814),e=r(36107),c=r(43942),o=r(59452),L=r(19999),R=r(70271),v=r(61318),y=r(51903),b=r(96875),k=r(91020),_=r(8781),D=r(32780);function h(W){const A=W;return"mvt"===A.sourceOptions?.type&&(A.igoStyle?.styleByAttribute?.hoverStyle||A.igoStyle?.hoverStyle)&&(A.sourceOptions.featureClass=A.sourceOptions.featureClass||"feature"),W}var X=r(24371),H=r(68559),x=r(46443),ee=r(84205),Z=r(2435),G=r(51307);let U=(()=>{class W{ngxIndexedDBService;dbName="layerData";constructor(g){this.ngxIndexedDBService=g}update(g){const u=new ee.B;return this.ngxIndexedDBService.getByID(this.dbName,g.layerId).pipe((0,Z.$)(),(0,y.H)(O=>O?this.customUpdate(g):this.ngxIndexedDBService.add(this.dbName,g))).subscribe(O=>{u.next(O),u.complete()}),u}customUpdate(g){const u=new ee.B;return this.ngxIndexedDBService.deleteByKey(this.dbName,g.layerId).pipe((0,y.H)(j=>j?this.ngxIndexedDBService.add(this.dbName,g):(0,o.of)(void 0))).subscribe(j=>{j&&u.next(j),u.complete()}),u}getByID(g){return this.ngxIndexedDBService.getByID(this.dbName,g)}deleteByKey(g){return this.ngxIndexedDBService.deleteByKey(this.dbName,g)}getAll(){return this.ngxIndexedDBService.getAll(this.dbName)}static \u0275fac=function(u){return new(u||W)(H.KVO(G.MX))};static \u0275prov=H.jDH({token:W,factory:W.\u0275fac,providedIn:"root"})}return W})(),N=(()=>{class W{http;styleService;dataSourceService;geoNetworkService;messageService;layerDBService;authInterceptor;constructor(g,u,O,j,P,Y,w){this.http=g,this.styleService=u,this.dataSourceService=O,this.geoNetworkService=j,this.messageService=P,this.layerDBService=Y,this.authInterceptor=w}createLayer(g){if(!g.source)return;let u;switch(g.source.options&&g.source.options._layerOptionsFromSource&&(g=F.BF.mergeDeep(g.source.options._layerOptionsFromSource,g||{})),g.source.constructor){case k.nk:case k.ps:case k.d_:case k.PZ:case k.fl:case k.HO:u=this.createTileLayer(g);break;case k._k:case k._K:case k.Hw:case k.xO:case k.U7:u=this.createVectorLayer(g);break;case k.e:case k.Tg:u=this.createImageLayer(g);break;case k.X_:const O=h(g);u=this.createVectorTileLayer(O)}return u}createAsyncLayer(g,u){const O=h(g);return O.source?new c.c(j=>j.next(this.createLayer(O))):this.dataSourceService.createAsyncDataSource(O.sourceOptions,u).pipe((0,R.T)(j=>{if(void 0!==j)return this.createLayer(Object.assign(O,{source:j}))}))}createImageLayer(g){return new X.PQ(g,this.messageService,this.authInterceptor)}createTileLayer(g){return new X.eZ(g,this.messageService,this.authInterceptor)}createVectorLayer(g){let O,u=g.style;if(g.igoStyle||(g.igoStyle={}),this.handleLegacyStyles(g,["styleByAttribute","hoverStyle","mapboxStyle","clusterBaseStyle","style"]),g.igoStyle.igoStyleObject&&!g.idbInfo?.storeToIdb?u=(Y,w)=>this.styleService.createStyle(g.igoStyle.igoStyleObject,Y,w):g.igoStyle.igoStyleObject&&g.idbInfo?.storeToIdb&&(u=this.styleService.parseStyle("style",g.igoStyle.igoStyleObject)),g.source instanceof k.Hw)u=g.source.options.params.style;else if(g.igoStyle?.styleByAttribute){const Y=this.styleService;g.style=(w,I)=>Y.createStyleByAttribute(w,g.igoStyle.styleByAttribute,I),O=new X.vK(g,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}if(g.source instanceof k.U7){const Y=this.styleService,w=g.igoStyle.clusterBaseStyle;g.style=(I,E)=>Y.createClusterStyle(I,E,g.clusterParam,w),O=new X.vK(g,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}const P=Object.assign({},g,{style:u});return O||(O=new X.vK(P,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)),this.applyMapboxStyle(O,P),O}handleLegacyStyles(g,u){u.map(O=>{if(g[O]){let j=O;if("style"===O){if(g[O]instanceof p.Ay)return;if("object"!=typeof g[O])return;j="igoStyleObject"}g.igoStyle[j]=g[O],delete g[O],console.warn(`\n        The location of this style option (${O}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${O}: {...} must be transfered to igoStyle: { ${j}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `)}})}createVectorTileLayer(g){let u,O;if(g.igoStyle||(g.igoStyle={}),this.handleLegacyStyles(g,["styleByAttribute","hoverStyle","mapboxStyle","style"]),g.igoStyle.igoStyleObject&&(u=(Y,w)=>this.styleService.createStyle(g.igoStyle.igoStyleObject,Y,w)),g.igoStyle.styleByAttribute){const Y=this.styleService;g.style=(w,I)=>Y.createStyleByAttribute(w,g.igoStyle.styleByAttribute,I),O=new X.pR(g,this.messageService,this.authInterceptor)}const P=Object.assign({},g,{style:u});return O||(O=new X.pR(P,this.messageService,this.authInterceptor)),this.applyMapboxStyle(O,P),O}applyMapboxStyle(g,u){u.igoStyle?.mapboxStyle&&this.getStuff(u.igoStyle.mapboxStyle.url).subscribe(O=>{if(O.sprite){const j=this.getAbsoluteUrl(u.igoStyle.mapboxStyle.url,O.sprite);this.getStuff(j+".json").subscribe(P=>{(0,e.mt)(g.ol,O,u.igoStyle.mapboxStyle.source,void 0,P,j+".png")})}else(0,e.mt)(g.ol,O,u.igoStyle.mapboxStyle.source)})}getStuff(g){return this.http.get(g).pipe((0,R.T)(u=>u),(0,v.W)(u=>(console.log("No style was found"),(0,o.of)(u))))}getAbsoluteUrl(g,u){return new RegExp("^http|//","i").test(u)?u:"/"===g.substr(g.length-1)?g+u:g+"/"+u}createAsyncIdbLayers(g="*"){return this.layerDBService.getAll().pipe((0,y.H)(u=>{const j=("*"!==g?u.filter(P=>P.detailedContextUri===g):u).map(P=>Object.assign({},P.layerOptions,{sourceOptions:P.sourceOptions}));return(0,L.z)(j.map(P=>this.createAsyncLayer(P)))}))}static \u0275fac=function(u){return new(u||W)(H.KVO(x.Qq),H.KVO(D.J),H.KVO(b.n),H.KVO(_.x),H.KVO(a.bg),H.KVO(U),H.KVO(M._L,8))};static \u0275prov=H.jDH({token:W,factory:W.\u0275fac,providedIn:"root"})}return W})()},24371:(De,le,r)=>{"use strict";r.d(le,{PQ:()=>e,X9:()=>a.X,eZ:()=>L,Ib:()=>a.I,vK:()=>R.v,pR:()=>y});var M=r(98742),a=r(88363),F=r(6624),p=r(14970);class e extends M.W{messageService;authInterceptor;watcher;constructor(k,_,D){super(k,_,D),this.messageService=_,this.authInterceptor=D,this.watcher=new p.i(this,this.messageService),this.status$=this.watcher.status$,this.status$.subscribe(h=>{0===h&&(this.olLoadingProblem=!0)})}createOlLayer(){const k=Object.assign({},this.options,{source:this.options.source.ol}),_=new F.A(k);return this.authInterceptor&&_.getSource().setImageLoadFunction((D,h)=>{this.customLoader(D,h,this.authInterceptor,this.messageService)}),_}setMap(k){void 0===k?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(k)}customLoader(k,_,D,h){const X=new XMLHttpRequest,H=D.alterUrlWithKeyAuth(_);let x=_;if(H&&(x=H),X.open("GET",x),!D.interceptXhr(X,x))return X.abort(),void(k.getImage().src=x);X.responseType="arraybuffer",X.onload=function(){const Z=new Uint8Array(this.response);(new TextDecoder).decode(Z).includes("ServiceExceptionReport")&&h.error("igo.geo.dataSource.optionsApiUnavailable","igo.geo.dataSource.unavailableTitle");const U=new Blob([Z],{type:"image/png"}),W=window.URL.createObjectURL(U);k.getImage().src=W},X.send()}}var c=r(49020),o=r(49953);class L extends M.W{messageService;authInterceptor;watcher;constructor(k,_,D){super(k,_),this.messageService=_,this.authInterceptor=D,this.watcher=new o.Z(this),this.status$=this.watcher.status$}createOlLayer(){const k=Object.assign({},this.options,{source:this.options.source.ol}),_=new c.A(k);return _.getSource().setTileLoadFunction((h,X)=>{this.customLoader(h,X,this.authInterceptor)}),_}customLoader(k,_,D){const h=D.alterUrlWithKeyAuth(_);let X=_;h&&(X=h),k.getImage().src=X}setMap(k){void 0===k?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(k)}}var R=r(91640),v=r(61881);class y extends M.W{messageService;authInterceptor;watcher;constructor(k,_,D){super(k,_,D),this.messageService=_,this.authInterceptor=D,this.watcher=new o.Z(this),this.status$=this.watcher.status$}createOlLayer(){const k=Object.assign({},this.options,{source:this.options.source.ol}),_=new v.A(k);return _.getSource().setTileLoadFunction((h,X)=>{const H=this.customLoader(X,h.getFormat(),this.authInterceptor,h.onLoad.bind(h));H&&h.setLoader(H)}),_}customLoader(k,_,D,h,X){return(H,x,ee)=>{const Z=new XMLHttpRequest;let G=k;if("function"!=typeof k){const U=D.alterUrlWithKeyAuth(k);U&&(G=U)}else G=k(H,x,ee);Z.open("GET",G),D&&D.interceptXhr(Z,G),"arraybuffer"===_.getType()&&(Z.responseType="arraybuffer"),Z.onload=U=>{if(!Z.status||Z.status>=200&&Z.status<300){const N=_.getType();let W;"json"===N||"text"===N?W=Z.responseText:"xml"===N?(W=Z.responseXML,W||(W=(new DOMParser).parseFromString(Z.responseText,"application/xml"))):"arraybuffer"===N&&(W=Z.response),W?h.call(this,_.readFeatures(W,{extent:H,featureProjection:ee}),_.readProjection(W)):X.call(this)}else X.call(this)},Z.onerror=()=>{X.call(this)},Z.send()}}setMap(k){void 0===k?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(k)}}},88363:(De,le,r)=>{"use strict";r.d(le,{I:()=>a,X:()=>M});var M=function(F){return F.OPACITY="opacity",F.VISIBLE="visible",F.OGCFILTERS="ogcFilters",F.MINRESOLUTION="minResolution",F.MAXRESOLUTION="maxResolution",F.ZINDEX="zIndex",F.TIMEFILTER="timeFilter",F}(M||{}),a=function(F){return F.TITLE="title",F.ABSTRACT="abstract",F.CUSTOM="custom",F}(a||{})},98742:(De,le,r)=>{"use strict";r.d(le,{W:()=>e});var M=r(75797),a=r(19999),F=r(70271),p=r(64004);class e{options;messageService;authInterceptor;geoDBService;layerDBService;collapsed;dataSource;legend;legendCollapsed=!0;firstLoadComponent=!0;map;ol;olLoadingProblem=!1;status$;hasBeenVisible$=new M.t(void 0);hasBeenVisible$$;resolution$$;get isIgoInternalLayer(){return this.options.isIgoInternalLayer||!1}get id(){return this.options.id||this.dataSource.id}get alias(){return this.options.alias}get title(){return this.options.title}set title(o){this.options.title=o}get zIndex(){return this.ol.getZIndex()}set zIndex(o){this.ol.setZIndex(o)}get baseLayer(){return this.options.baseLayer}set baseLayer(o){this.options.baseLayer=o}get opacity(){return this.ol.get("opacity")}set opacity(o){this.ol.setOpacity(o)}set isInResolutionsRange(o){this.isInResolutionsRange$.next(o)}get isInResolutionsRange(){return this.isInResolutionsRange$.value}isInResolutionsRange$=new M.t(!1);set maxResolution(o){this.ol.setMaxResolution(0===o?0:o||1/0),this.updateInResolutionsRange()}get maxResolution(){return this.ol.getMaxResolution()}set minResolution(o){this.ol.setMinResolution(o||0),this.updateInResolutionsRange()}get minResolution(){return this.ol.getMinResolution()}set visible(o){this.ol.setVisible(o),this.visible$.next(o),!this.hasBeenVisible$.value&&o&&this.hasBeenVisible$.next(o),this.options?.messages&&o&&this.options?.messages.filter(L=>L.options?.showOnEachLayerVisibility).map(L=>this.showMessage(L))}get visible(){return this.visible$.value}visible$=new M.t(void 0);get displayed(){return this.visible&&this.isInResolutionsRange}displayed$=(0,a.z)([this.isInResolutionsRange$,this.visible$]).pipe((0,F.T)(o=>o[0]&&o[1]));get showInLayerList(){return!1!==this.options.showInLayerList}constructor(o,L,R,v,y){this.options=o,this.messageService=L,this.authInterceptor=R,this.geoDBService=v,this.layerDBService=y,this.dataSource=o.source,this.ol=this.createOlLayer(),void 0!==o.zIndex&&(this.zIndex=o.zIndex),o.baseLayer&&void 0===o.visible&&(o.visible=!1),this.maxResolution=o.maxResolution||(0,p.HB)(Number(o.maxScaleDenom)),this.minResolution=o.minResolution||(0,p.HB)(Number(o.minScaleDenom)),this.visible=void 0===o.visible||o.visible,this.opacity=void 0===o.opacity?1:o.opacity,o.legendOptions&&(o.legendOptions.url||o.legendOptions.html)&&(this.legend=this.dataSource.setLegend(o.legendOptions)),this.legendCollapsed=!o.legendOptions||!o.legendOptions.collapsed||o.legendOptions.collapsed,this.ol.set("_layer",this,!0)}setMap(o){this.map=o,this.unobserveResolution(),void 0!==o&&(this.observeResolution(),this.hasBeenVisible$$=this.hasBeenVisible$.subscribe(()=>{this.options.messages&&this.visible&&this.options.messages.map(L=>{this.showMessage(L)})}))}showMessage(o){this.messageService&&(o.title=o.title,o.text=o.text,this.messageService.message(o))}observeResolution(){this.resolution$$=this.map.viewController.resolution$.subscribe(()=>this.updateInResolutionsRange())}unobserveResolution(){void 0!==this.resolution$$&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}updateInResolutionsRange(){if(void 0!==this.map){const o=this.map.viewController.getResolution();this.isInResolutionsRange=o>=this.minResolution&&o<=(void 0===this.maxResolution?1/0:this.maxResolution)}else this.isInResolutionsRange=!1}}},91640:(De,le,r)=>{"use strict";r.d(le,{v:()=>W});var M=r(68671),a=r(12912),F=r(17041),p=r(75736),e=r(66586),c=r(18094),o=r(63886),L=r(41196),R=r(88841),v=r(18537),y=r(69243),b=r(59452),k=r(52575),_=r(60591),D=r(51903),h=r(2435),X=r(61318),H=r(8115),x=r(55726),ee=r(41161),Z=r(63353),U=r(79634),N=r(98742);class W extends N.W{messageService;authInterceptor;geoNetworkService;geoDBService;layerDBService;previousLoadExtent;previousLoadResolution;previousOgcFilters;xhrAccumulator=[];watcher;trackFeatureListenerId;get browsable(){return!1!==this.options.browsable}get exportable(){return!1!==this.options.exportable}constructor(g,u,O,j,P,Y){super(g,u,O,P,Y),this.messageService=u,this.authInterceptor=O,this.geoNetworkService=j,this.geoDBService=P,this.layerDBService=Y,this.watcher=new U.w(this),this.status$=this.watcher.status$}createOlLayer(){const g=this.options.opacity||1,u=!1!==this.options.visible,O=this.options.minResolution||(0,ee.HB)(Number(this.options.minScaleDenom)),j=this.options.maxResolution||(0,ee.HB)(Number(this.options.maxScaleDenom)),P=this.options.sourceOptions;this.dataSource instanceof H._&&(P?.preload?.bypassResolution||P?.preload?.bypassVisible)&&(this.options.opacity=0,P.preload.bypassResolution&&(this.options.minResolution||this.options.maxResolution)&&(this.options.minResolution=0,this.options.maxResolution=1/0),P.preload.bypassVisible&&!u&&(this.options.visible=!0));const Y=Object.assign({},this.options,{source:this.options.source.ol,sourceOptions:this.options.sourceOptions||this.options.source.options});this.options.animation&&this.dataSource.ol.on("addfeature",function(s){this.flash(s.feature)}.bind(this)),this.options.idbInfo?.storeToIdb&&this.geoDBService&&(this.options.idbInfo.firstLoad&&this.maintainFeaturesInIdb(),this.dataSource.ol.once("featuresloadend",()=>{this.dataSource.ol.on("addfeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("changefeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("clear",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("removefeature",()=>this.maintainFeaturesInIdb())})),this.dataSource instanceof H._&&(P?.preload?.bypassResolution||P?.preload?.bypassVisible)&&this.dataSource.ol.once("featuresloadend",()=>{g&&(this.opacity=g),P.preload.bypassResolution&&(this.minResolution=O,this.maxResolution=j),P.preload.bypassVisible&&(this.visible=u)}),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);const w=new c.A(Y),I=w.getSource(),E=I.getUrl();if("function"==typeof E)return w;if(E||"wfs"===Y.sourceOptions?.type){let s;const z=Y.sourceOptions;s="wfs"===z?.type&&(z.params||z.paramsWFS)?(Q,ae,ye,de,ue)=>{this.customWFSLoader(I,z,this.authInterceptor,Q,ae,ye,de,ue)}:(Q,ae,ye,de,ue)=>{this.customLoader(I,E,this.authInterceptor,Q,ae,ye,de,ue)},s&&I.setLoader(s)}else if(this.options.idbInfo?.storeToIdb&&this.geoDBService){const s=(z,Q,ae,ye,de)=>{this.customIDBLoader(I,Y.id,z,ae,ye,de)};s&&I.setLoader(s)}return this.options.idbInfo?.storeToIdb&&this.geoDBService&&w.once("sourceready",()=>{this.options.idbInfo.firstLoad&&this.maintainOptionsInIdb(),(0,v.R)(w,"change").pipe((0,k.B)(750)).subscribe(()=>this.maintainOptionsInIdb()),w.on("change:zIndex",()=>this.maintainOptionsInIdb())}),w}removeLayerFromIDB(){this.geoDBService&&this.layerDBService&&(0,y.y)(this.geoDBService.deleteByKey(this.id),this.layerDBService.deleteByKey(this.id)).subscribe()}maintainOptionsInIdb(){this.options.igoStyle.igoStyleObject=function G(A){const g=A.getStyle();return"function"==typeof g||g instanceof Array?void 0:{fill:{color:g.getFill().getColor()},stroke:{color:g.getStroke().getColor(),width:2},circle:{fill:{color:g.getImage().getFill().getColor()},stroke:{color:g.getImage().getStroke().getColor(),width:2},radius:5}}}(this.ol);const g=M.BF.removeUndefined({layerId:this.id,detailedContextUri:this.options.idbInfo.contextUri,sourceOptions:{id:this.id,type:"vector",queryable:!0},layerOptions:{workspace:this.options.workspace,zIndex:this.ol?this.zIndex:1e6,id:this.id,isIgoInternalLayer:this.isIgoInternalLayer,title:this.title,igoStyle:this.options.igoStyle,idbInfo:Object.assign({},this.options.idbInfo,{firstLoad:!1})},insertEvent:`${this.title}-${this.id}-${new Date}`});this.layerDBService.update(g)}maintainFeaturesInIdb(){const g=this.dataSource.ol.getFeatures(),u=JSON.parse((new e.A).writeFeatures(g,{dataProjection:"EPSG:4326",featureProjection:this.dataSource.ol.getProjection()||"EPSG:3857"}));this.geoDBService.update(this.id,this.id,u,Z.z.User,`${this.title}-${this.id}-${new Date}`)}flash(g){const u=(new Date).getTime(),O=this.ol.on("postrender",function j(P){const Y=(0,R.r2)(P),w=P.frameState,I=g.getGeometry().clone(),E=w.time-u,s=E/this.options.animation.duration,z=(0,p.vT)(1-s),Q=(0,F._j)(this.options.animation.color||"red");Q[3]=z;let ae=this.ol.getStyleFunction().call(this,g).find(de=>de.getImage());ae||(ae=this.ol.getStyleFunction().call(this,g)[0]);const ye=ae.clone();switch(g.getGeometry().getType()){case"Point":if(null!==ye.getImage()&&"function"==typeof ye.getImage().getRadius){const de=(0,p.vT)(s)*(3*ye.getImage().getRadius());ye.getImage().setRadius(de),ye.getImage().setOpacity(z)}break;case"LineString":ye.getImage()&&(ye.getImage().getStroke().setColor(Q),ye.getImage().getStroke().setWidth((0,p.vT)(s)*(3*ye.getImage().getStroke().getWidth()))),ye.getStroke()&&(ye.getStroke().setColor(Q),ye.getStroke().setWidth((0,p.vT)(s)*(3*ye.getStroke().getWidth())));break;case"Polygon":ye.getImage()&&ye.getImage().getFill().setColor(Q),ye.getFill()&&ye.getFill().setColor(Q)}if(ye.setText(""),Y.setStyle(ye),Y.drawGeometry(I),E>this.options.animation.duration)return(0,a.e)(O),void this.map.ol.render();this.map.ol.render()}.bind(this))}setMap(g){void 0===g?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(g)}setExtent(g){this.options.extent=g}onUnwatch(){this.dataSource.onUnwatch(),this.stopAnimation()}stopAnimation(){this.dataSource.ol.un("addfeature",function(g){this.visible&&this.flash(g.feature)}.bind(this))}enableTrackFeature(g){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,g))}centerMapOnFeature(g){const u=this.dataSource.ol.getFeatureById(g);u&&this.map.ol.getView().setCenter(u.getGeometry().getCoordinates())}trackFeature(g,u){u.feature.getId()===g&&this.visible&&this.centerMapOnFeature(g)}disableTrackFeature(g){(0,a.e)(this.trackFeatureListenerId)}customWFSLoader(g,u,O,j,P,Y,w,I,E){{const s=u.paramsWFS,z=s.srsName?new L.A({code:s.srsName}):Y,Q=o.DI(j,Y,z),ae=u.ogcFilters;if(this.previousLoadExtent&&this.previousLoadExtent!==Q||this.previousLoadResolution&&this.previousLoadResolution!==P||this.previousOgcFilters&&this.previousOgcFilters!==ae){g.removeLoadedExtent(this.previousLoadExtent);for(let ue of this.xhrAccumulator)ue.abort()}this.previousLoadExtent=Q,this.previousLoadResolution=P,this.previousOgcFilters=ae,s.srsName=s.srsName||Y.getCode();const ye=(0,x.c$)(u,Q,z,ae,E);let de=0;if("2.0.0"===s.version&&s.maxFeatures>x.X2)for(;de<s.maxFeatures;){let ce=ye.replace("count="+s.maxFeatures,"count=1000");ce=ce.replace("startIndex=0","0"),ce+="&startIndex="+de,ce.replace(/&&/g,"&"),this.getFeatures(g,O,Q,z,Y,ce,w,I),de+=1e3}else this.getFeatures(g,O,Q,z,Y,ye,w,I)}}getFeatures(g,u,O,j,P,Y,w,I){const E=new XMLHttpRequest,s=u.alterUrlWithKeyAuth(Y);let z=Y;s&&(z=s),E.open("GET",z),u&&u.interceptXhr(E,z);const Q=()=>{g.removeLoadedExtent(O),I()};E.onerror=Q,E.onload=()=>{if(200===E.status&&E.responseText.length>0){const ae=g.getFormat().readFeatures(E.responseText,{dataProjection:j,featureProjection:P});ae?(g.addFeatures(ae),w(ae)):w([])}else Q()},this.xhrAccumulator.push(E),E.send()}customLoader(g,u,O,j,P,Y,w,I){const E=new XMLHttpRequest;let s=u;if("function"!=typeof u){const z=O.alterUrlWithKeyAuth(u);z&&(s=z)}if(this.geoNetworkService&&"function"!=typeof u){let ae=g.getFormat().getType();const ye=()=>{g.removeLoadedExtent(j),I()},de={responseType:ae};this.geoNetworkService.geoDBService.get(u).pipe((0,_.c)(750)).pipe((0,D.H)(ue=>ue?(0,b.of)(ue):this.geoNetworkService.get(s,de).pipe((0,h.$)(),(0,X.W)(ce=>{throw ye(),ce})))).subscribe(ue=>{if(ue){const ce=g.getFormat(),re=ce.getType();let be;if("json"===re||"text"===re?be=ue:"xml"===re?(be=ue,be||(be=(new DOMParser).parseFromString(ue,"application/xml"))):"arraybuffer"===re&&(be=ue),be){const _e=ce.readFeatures(be,{extent:j,featureProjection:Y});g.addFeatures(_e),w(_e)}else ye()}})}else{E.open("GET",s);const z=g.getFormat();"arraybuffer"===z.getType()&&(E.responseType="arraybuffer"),O&&O.interceptXhr(E,s);const Q=()=>{g.removeLoadedExtent(j),I()};E.onerror=Q,E.onload=()=>{if(!E.status||E.status>=200&&E.status<300){const ae=z.getType();let ye;if("json"===ae||"text"===ae?ye=E.responseText:"xml"===ae?(ye=E.responseXML,ye||(ye=(new DOMParser).parseFromString(E.responseText,"application/xml"))):"arraybuffer"===ae&&(ye=E.response),ye){const de=z.readFeatures(ye,{extent:j,featureProjection:Y});g.addFeatures(de),w(de)}else Q()}else Q()},E.send()}}customIDBLoader(g,u,O,j,P,Y){if(this.geoNetworkService){const w=()=>{g.removeLoadedExtent(O),Y()};this.geoNetworkService.geoDBService.get(u).subscribe(I=>{if(I){const E=g.getFormat(),s=E.getType();let z;if("json"===s||"text"===s?z=I:"xml"===s?(z=I,z||(z=(new DOMParser).parseFromString(I,"application/xml"))):"arraybuffer"===s&&(z=I),z){const Q=E.readFeatures(z,{extent:O,featureProjection:j});g.addFeatures(Q,E.readProjection(z)),P(Q)}else w()}})}}}},14970:(De,le,r)=>{"use strict";r.d(le,{i:()=>a});var M=r(68671);class a extends M.ZV{id;loaded=0;loading=0;source;messageService;constructor(p,e){super(),this.source=p.options.source.ol,this.id=(0,M.uR)(),this.messageService=e}watch(){this.source.on("imageloadstart",p=>this.handleLoadStart(p)),this.source.on("imageloadend",p=>this.handleLoadEnd(p)),this.source.on("imageloaderror",p=>this.handleLoadEnd(p)),this.source.on("imageloaderror",p=>this.handleLoadError(p))}unwatch(){this.source.un("imageloadstart",p=>this.handleLoadStart(p)),this.source.un("imageloadend",p=>this.handleLoadEnd(p)),this.source.un("imageloaderror",p=>this.handleLoadEnd(p)),this.source.un("imageloaderror",p=>this.handleLoadError(p))}handleLoadStart(p){p.image.__watchers__||(p.image.__watchers__=[]),p.image.__watchers__.push(this.id),this.loading+=1,this.status=M.Bi.Working}handleLoadEnd(p){if(!p.image.__watchers__)return;const e=p.image.__watchers__.indexOf(this.id);if(e<0)return;p.image.__watchers__.splice(e,1),this.loaded+=1;const c=this.loading;this.loaded>=c&&c===this.loading&&(this.status=M.Bi.Done,this.loaded=this.loading=0)}handleLoadError(p){p.image.__watchers__&&(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:p.target.params_.LAYERS}),this.loaded=-1,this.loading=0,this.status=M.Bi.Error)}}},49953:(De,le,r)=>{"use strict";r.d(le,{Z:()=>a});var M=r(68671);class a extends M.ZV{id;loaded=0;loading=0;source;constructor(p){super(),this.source=p.options.source.ol,this.id=(0,M.uR)()}watch(){this.source.on("tileloadstart",p=>this.handleLoadStart(p)),this.source.on("tileloadend",p=>this.handleLoadEnd(p)),this.source.on("tileloaderror",p=>this.handleLoadEnd(p))}unwatch(){this.source.un("tileloadstart",p=>this.handleLoadStart(p)),this.source.un("tileloadend",p=>this.handleLoadEnd(p)),this.source.un("tileloaderror",p=>this.handleLoadEnd(p))}handleLoadStart(p){p.tile.__watchers__||(p.tile.__watchers__=[]),p.tile.__watchers__.push(this.id),this.loading+=1,this.status=M.Bi.Working}handleLoadEnd(p){if(!p.tile.__watchers__)return;const e=p.tile.__watchers__.indexOf(this.id);if(e<0)return;p.tile.__watchers__.splice(e,1),this.loaded+=1;const c=this.loading;this.loaded>=c&&c===this.loading&&(this.status=M.Bi.Done,this.loaded=this.loading=0)}}},79634:(De,le,r)=>{"use strict";r.d(le,{w:()=>F});var M=r(68671),a=r(12171);class F extends M.ZV{id;loaded=0;loading=0;layer;constructor(e){super(),this.layer=e,this.id=(0,M.uR)()}watch(){let e=this.layer.options.source.ol;this.layer.dataSource instanceof a.U&&(e=this.layer.options.source.options.source),e.getUrl()&&(e.on("featuresloadstart",c=>this.handleLoadStart(c)),e.on("featuresloadend",c=>this.handleLoadEnd(c)),e.on("featuresloaderror",c=>this.handleLoadEnd(c)))}unwatch(){let e=this.layer.options.source.ol;this.layer.dataSource instanceof a.U&&(e=this.layer.options.source.options.source),e.getUrl()&&(e.un("featuresloadstart",c=>this.handleLoadStart(c)),e.un("featuresloadend",c=>this.handleLoadEnd(c)),e.un("featuresloaderror",c=>this.handleLoadEnd(c)))}handleLoadStart(e){this.loading+=1,this.status=M.Bi.Working}handleLoadEnd(e){this.loaded+=1;const c=this.loading;this.loaded>=c&&c===this.loading&&(this.status=M.Bi.Done,this.loaded=this.loading=0)}}},65666:(De,le,r)=>{"use strict";r.d(le,{W:()=>H});var M=r(60316),a=r(84175),F=r(93840),p=r(80640),e=r(21701),c=r(55050),L=(r(53792),r(47172));function R(){return(0,L.hZ)("baseLayerSwitcherState",[(0,L.wk)("collapseIcon",(0,L.iF)({height:"40px",width:"40px",overflow:"hidden"})),(0,L.wk)("collapseMap",(0,L.iF)({height:"80px",overflow:"hidden"})),(0,L.wk)("expand",(0,L.iF)({overflow:"hidden"})),(0,L.kY)("collapse => expand",(0,L.i0)("200ms")),(0,L.kY)("expand => collapse",(0,L.i0)("200ms"))])}var v=r(29555),y=r(68559),b=r(90852);const k=x=>({"container-expand":x});function _(x,ee){1&x&&(y.j41(0,"div",6)(1,"button",7),y.nI1(2,"translate"),y.j41(3,"mat-icon"),y.EFF(4,"photo_library"),y.k0s()()()),2&x&&(y.R7$(),y.Y8G("matTooltip",y.bMT(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function D(x,ee){if(1&x&&(y.nrm(0,"igo-mini-basemap",8),y.nI1(1,"translate")),2&x){const Z=ee.$implicit,G=ee.index,U=y.XpG(2);y.Y8G("map",U.map)("baseLayer",Z)("title",U.baseLayers.length>2&&!U.expand?y.bMT(1,5,"igo.geo.baselayersSwitcher.title"):Z.title)("display",U.expand||0===G&&!U.useStaticIcon)("disabled",!U.expand&&U.baseLayers.length>1)}}function h(x,ee){1&x&&(y.j41(0,"div",9)(1,"mat-icon",10),y.EFF(2,"arrow_drop_down"),y.k0s()())}function X(x,ee){if(1&x){const Z=y.RV6();y.j41(0,"div",1),y.bIt("@baseLayerSwitcherState.start",function(){y.eBV(Z);const U=y.XpG();return y.Njj(U.showButton=!1)})("@baseLayerSwitcherState.done",function(){y.eBV(Z);const U=y.XpG();return y.Njj(U.showButton=!0)})("click",function(){y.eBV(Z);const U=y.XpG();return y.Njj(U.collapseOrExpand())}),y.DNE(1,_,5,3,"div",2),y.j41(2,"div",3),y.DNE(3,D,2,7,"igo-mini-basemap",4),y.k0s(),y.DNE(4,h,3,0,"div",5),y.k0s()}if(2&x){const Z=y.XpG();y.Y8G("ngClass",y.eq3(5,k,Z.expand))("@baseLayerSwitcherState",Z.expand?"expand":Z.useStaticIcon?"collapseIcon":"collapseMap"),y.R7$(),y.Y8G("ngIf",Z.useStaticIcon&&!Z.expand&&Z.showButton),y.R7$(2),y.Y8G("ngForOf",Z.baseLayers),y.R7$(),y.Y8G("ngIf",Z.hasMoreThanTwo)}}let H=(()=>{class x{mediaService;map;useStaticIcon;_baseLayers=[];expand=!1;showButton=!0;layers$$;get hasMoreThanTwo(){return this.baseLayers.length>1}constructor(Z){this.mediaService=Z,this.mediaService.media$.value===c.$U.Mobile&&void 0===this.useStaticIcon&&(this.useStaticIcon=!0)}ngAfterViewInit(){this.layers$$=this.map.layers$.subscribe(Z=>{this._baseLayers=Z.filter(G=>G.baseLayer)})}ngOnDestroy(){this.layers$$.unsubscribe()}collapseOrExpand(){this.expand=!(!this.hasMoreThanTwo&&!this.useStaticIcon||this.expand)}get baseLayers(){const Z=this.map.viewController.getResolution(),G=this.map.viewController.getZoom(),U=this._baseLayers.filter(W=>(!W.options.maxResolution||Z<=W.options.maxResolution)&&(!W.options.minResolution||Z>=W.options.minResolution)&&(!W.options.source.options.maxZoom||G<=W.options.source.options.maxZoom)&&(!W.options.source.options.minZoom||G>=W.options.source.options.minZoom)),N=U.filter(W=>!W.visible);return N.length+1===U.length?N:U}static \u0275fac=function(G){return new(G||x)(y.rXU(c.u1))};static \u0275cmp=y.VBU({type:x,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},standalone:!0,features:[y.aNF],decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"click","ngClass"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],[1,"basemap-list"],[3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],["class","more-baselayers",4,"ngIf"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],[3,"map","baseLayer","title","display","disabled"],[1,"more-baselayers"],["color","primary",1,"material-icons","mat-icon"]],template:function(G,U){1&G&&y.DNE(0,X,5,7,"div",0),2&G&&y.Y8G("ngIf",U.baseLayers.length>0)},dependencies:[M.bT,M.YU,a.Hl,a.iY,p.uc,p.oV,F.m_,F.An,M.pM,v.i,e.Ck,b.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]{display:block}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]:not(:first-child){margin-top:4px}.igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"],data:{animation:[R()]}})}return x})()},29555:(De,le,r)=>{"use strict";r.d(le,{i:()=>R});var M=r(60316),F=(r(44860),r(64412)),p=r(42449),e=r(53792),c=r(68559);function o(v,y){if(1&v&&(c.j41(0,"div",5),c.EFF(1),c.k0s()),2&v){const b=c.XpG(2);c.R7$(),c.JRh(b.title)}}function L(v,y){if(1&v){const b=c.RV6();c.j41(0,"div",2),c.bIt("click",function(){c.eBV(b);const _=c.XpG();return c.Njj(_.changeBaseLayer(_.baseLayer))}),c.nrm(1,"igo-map-browser",3),c.DNE(2,o,2,1,"div",4),c.k0s()}if(2&v){const b=c.XpG();c.R7$(),c.Y8G("map",b.basemap),c.R7$(),c.Y8G("ngIf",b.title)}}let R=(()=>{class v{layerService;appRef;map;disabled;title;get display(){return this._display}set display(b){this._display=b,this.basemap.ol.getView().changed()}_display;get baseLayer(){return this._baseLayer}set baseLayer(b){this._baseLayer=b,this.handleBaseLayerChanged(b)}_baseLayer;basemap=new e.y({controls:{},interactions:!1});constructor(b,k){this.layerService=b,this.appRef=k}ngAfterViewInit(){this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",b=>{this.handleMainMapViewChange(b.target)}),this.map.ol.on("pointerdrag",b=>{this.handleMainMapViewChange(b.target.getView())})}ngOnDestroy(){this.map.viewController.olView.un("change",b=>{this.handleMainMapViewChange(b.target)}),this.map.ol.un("pointerdrag",b=>{this.handleMainMapViewChange(b.target.getView())})}changeBaseLayer(b){this.disabled||(this.map.changeBaseLayer(b),this.appRef.tick())}handleMainMapViewChange(b){const k=b.getProperties();this.basemap.viewController.olView.setResolution(k.resolution),this.basemap.viewController.olView.setRotation(k.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}handleBaseLayerChanged(b){this.basemap.removeAllLayers();const k=Object.assign(Object.create(b.options),b.options,{visible:!0,baseLayer:!1}),_=this.layerService.createLayer(k);this.basemap.addLayer(_),this.handleLinkedBaseLayer(_)}handleLinkedBaseLayer(b){const k=b.options.linkedLayers;if(!k)return;const _=k.links;_&&_.map(h=>{h.linkedIds.map(X=>{const H=this.map.layers.find(x=>x.options.linkedLayers?.linkId===X);if(H){const x=Object.assign(Object.create(H.options),H.options,{zIndex:9e3,visible:H.options.linkedLayers?.showInMiniBaseMap??!0,baseLayer:!1});this.basemap.addLayer(this.layerService.createLayer(x))}})})}static \u0275fac=function(k){return new(k||v)(c.rXU(F.B),c.rXU(c.o8S))};static \u0275cmp=c.VBU({type:v,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",title:"title",display:"display",baseLayer:"baseLayer"},standalone:!0,features:[c.aNF],decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(k,_){1&k&&(c.j41(0,"div",0),c.DNE(1,L,3,2,"div",1),c.k0s()),2&k&&(c.R7$(),c.Y8G("ngIf",_.display))},dependencies:[M.bT,p.K],styles:[".igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"],changeDetection:0})}return v})()},97927:(De,le,r)=>{"use strict";r.d(le,{x:()=>b});var M=r(60316),a=r(84175),F=r(93840),p=r(80640),e=r(67143),c=r(21701),o=r(75797),R=(r(53792),r(68559)),v=r(90852);function y(k,_){if(1&k){const D=R.RV6();R.j41(0,"div",1)(1,"button",2),R.nI1(2,"translate"),R.nI1(3,"translate"),R.bIt("click",function(){R.eBV(D);const X=R.XpG();return R.Njj(X.onGeolocationClick())}),R.j41(4,"mat-icon"),R.EFF(5),R.nI1(6,"async"),R.k0s()()()}if(2&k){const D=R.XpG();R.R7$(),R.Y8G("matTooltip",D.map.geolocationController.tracking?R.bMT(2,3,"igo.geo.mapButtons.geolocateInactive"):R.bMT(3,5,"igo.geo.mapButtons.geolocate"))("color",D.color),R.R7$(4),R.JRh(R.bMT(6,7,D.icon$))}}let b=(()=>{class k{configService;tracking$$;icon$=new o.t("my_location");get map(){return this._map}set map(D){this._map=D}_map;get color(){return this._color}set color(D){this._color=D}_color;constructor(D){this.configService=D}ngAfterContentInit(){this.map.ol.once("rendercomplete",()=>{this.tracking$$=this.map.geolocationController.tracking$.subscribe(D=>{D||this.configService.getConfig("geolocate.basic")?this.icon$.next("my_location"):this.icon$.next("location_searching")})})}ngOnDestroy(){this.tracking$$&&this.tracking$$.unsubscribe()}onGeolocationClick(){this.map.geolocationController.tracking=!this.map.geolocationController.tracking}static \u0275fac=function(h){return new(h||k)(R.rXU(e.we))};static \u0275cmp=R.VBU({type:k,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[R.aNF],decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","color"]],template:function(h,X){1&h&&R.DNE(0,y,7,9,"div",0),2&h&&R.Y8G("ngIf",X.map.geolocationController)},dependencies:[M.bT,a.Hl,a.iY,p.uc,p.oV,F.m_,F.An,M.Jj,c.Ck,v.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return k})()},90697:(De,le,r)=>{"use strict";r.d(le,{h:()=>v});var M=r(84175),a=r(93840),F=r(80640),p=r(67143),e=r(21701),c=r(63886),L=(r(53792),r(68559)),R=r(90852);let v=(()=>{class y{configService;map;color;extentOverride;centerOverride;zoomOverride;homeExtentButtonExtent;homeExtentButtonCenter;homeExtentButtonZoom;constructor(k){this.configService=k,this.computeHomeExtent()}computeHomeExtent(){const k=this.configService.getConfig("homeExtentButton");this.homeExtentButtonExtent=this.extentOverride||k?.homeExtButtonExtent,this.homeExtentButtonCenter=this.centerOverride||k?.homeExtButtonCenter,this.homeExtentButtonZoom=this.zoomOverride||k?.homeExtButtonZoom,this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}onToggleClick(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){const k=c.Rb(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(k),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}static \u0275fac=function(_){return new(_||y)(L.rXU(p.we))};static \u0275cmp=L.VBU({type:y,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},standalone:!0,features:[L.aNF],decls:5,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","color"]],template:function(_,D){1&_&&(L.j41(0,"div",0)(1,"button",1),L.nI1(2,"translate"),L.bIt("click",function(){return D.onToggleClick()}),L.j41(3,"mat-icon"),L.EFF(4,"home"),L.k0s()()()),2&_&&(L.R7$(),L.Y8G("matTooltip",L.bMT(2,2,"igo.geo.mapButtons.home-extent"))("color",D.color))},dependencies:[M.Hl,M.iY,F.uc,F.oV,a.m_,a.An,e.Ck,R.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return y})()},78421:(De,le,r)=>{"use strict";r.d(le,{xL:()=>e.x,hU:()=>c.h,y6:()=>M.y6,Xy:()=>_.X,Kn:()=>a.K,uk:()=>M.uk,we:()=>M.we,vM:()=>M.vM,dT:()=>y.w,nH:()=>L.n,Lz:()=>F.L,A5:()=>M.A5,A1:()=>M.A1,ho:()=>M.ho,vm:()=>M.vm,Hh:()=>M.Hh,FU:()=>M.FU});var M=r(41161),a=r(42449),F=r(13361),e=(r(37685),r(97927)),c=r(90697),L=(r(48339),r(47457)),y=(r(65666),r(29555),r(72789)),_=(r(8577),r(96463),r(86635))},86635:(De,le,r)=>{"use strict";r.d(le,{X:()=>p});var M=r(60316),a=r(68559);function F(e,c){if(1&e&&(a.j41(0,"div",1)(1,"pre"),a.EFF(2),a.k0s()()),2&e){const o=a.XpG();a.R7$(2),a.JRh(o.infoContent)}}let p=(()=>{class e{infoContent="";constructor(){}static \u0275fac=function(L){return new(L||e)};static \u0275cmp=a.VBU({type:e,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},standalone:!0,features:[a.aNF],decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(L,R){1&L&&a.DNE(0,F,3,1,"div",0),2&L&&a.Y8G("ngIf",R.infoContent&&R.infoContent.length)},dependencies:[M.bT],styles:[".infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}"]})}return e})()},42449:(De,le,r)=>{"use strict";r.d(le,{K:()=>c});var M=r(67778),a=r(68671),p=(r(53792),r(68559));const e=["*"];let c=(()=>{class o{activityService;activityId;status$$;map;get view(){return this._view}set view(R){this._view=R,void 0!==this.map&&this.map.updateView(R)}_view;get controls(){return this._controls}set controls(R){this._controls=R,void 0!==this.map&&this.map.updateControls(R)}_controls;id=`igo-map-target-${(0,a.uR)()}`;constructor(R){this.activityService=R}ngOnInit(){this.status$$=this.map.status$.subscribe(R=>this.handleStatusChange(R))}ngAfterViewInit(){this.map.setTarget(this.id)}ngOnDestroy(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}handleStatusChange(R){R===a.Bi.Working&&void 0===this.activityId?this.activityId=this.activityService.register():R===a.Bi.Done&&void 0!==this.activityId&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}static \u0275fac=function(v){return new(v||o)(p.rXU(M.Ti))};static \u0275cmp=p.VBU({type:o,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},standalone:!0,features:[p.aNF],ngContentSelectors:e,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(v,y){1&v&&(p.NAR(),p.nrm(0,"div",0),p.SdG(1)),2&v&&p.Y8G("id",y.id)},styles:["[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}"]})}return o})()},96463:(De,le,r)=>{"use strict";r.d(le,{B:()=>F}),r(53792);var a=r(68559);let F=(()=>{class p{map;displayCenter$$;constructor(){}ngAfterViewInit(){this.map&&(this.displayCenter$$=this.map.mapCenter$.subscribe(c=>{document.getElementById("mapCenter").style.visibility=c?"visible":"hidden"})),this.letZoom()}ngOnDestroy(){this.displayCenter$$&&this.displayCenter$$.unsubscribe()}letZoom(){document.getElementById("mapCenter").addEventListener("wheel",c=>{c.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(o){return new(o||p)};static \u0275cmp=a.VBU({type:p,selectors:[["igo-map-center"]],inputs:{map:"map"},standalone:!0,features:[a.aNF],decls:3,vars:0,consts:[["id","mapCenter",1,"mapCenter"],[1,"vertical"],[1,"horizontal"]],template:function(o,L){1&o&&(a.j41(0,"div",0),a.nrm(1,"div",1)(2,"div",2),a.k0s())},styles:[".mapCenter[_ngcontent-%COMP%]{width:30px;height:30px;position:absolute;top:50%;left:50%;transform:translate(-15px,-15px);pointer-events:none}.mapCenter[_ngcontent-%COMP%]   .vertical[_ngcontent-%COMP%], .mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{width:4px;height:30px;position:absolute;left:13px;background-color:#000}.mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{transform:rotate(90deg)}"]})}return p})()},37685:(De,le,r)=>{"use strict";r.d(le,{V:()=>R});var M=r(60316),a=r(68559),F=r(84175),p=r(93840),e=r(80640),c=r(67143),o=r(21701),L=r(90852);let R=(()=>{class v{configService;get sidenavOpened(){return this._sidenavOpenend}set sidenavOpened(b){this._sidenavOpenend=b,this.getClassMenuButton()}_sidenavOpenend;openSidenav=new a.bkB;useThemeColor;menuButtonClass;constructor(b){this.configService=b;const k=this.configService.getConfig("menu.button.useThemeColor");this.useThemeColor=void 0!==k&&k}getClassMenuButton(){this.menuButtonClass={"menu-button-white-background":!this.useThemeColor}}onToggleSidenavClick(){this.openSidenav.emit()}static \u0275fac=function(k){return new(k||v)(a.rXU(c.we))};static \u0275cmp=a.VBU({type:v,selectors:[["igo-menu-button"]],inputs:{sidenavOpened:"sidenavOpened"},outputs:{openSidenav:"openSidenav"},standalone:!0,features:[a.aNF],decls:4,vars:4,consts:[["mat-icon-button","","id","menu-button","tooltip-position","below","matTooltipShowDelay","500",3,"click","ngClass","matTooltip"]],template:function(k,_){1&k&&(a.j41(0,"button",0),a.nI1(1,"translate"),a.bIt("click",function(){return _.onToggleSidenavClick()}),a.j41(2,"mat-icon"),a.EFF(3,"menu"),a.k0s()()),2&k&&a.Y8G("ngClass",_.menuButtonClass)("matTooltip",a.bMT(1,2,_.sidenavOpened?"menu.close":"menu.open"))},dependencies:[F.Hl,F.iY,M.YU,e.uc,e.oV,p.m_,p.An,o.Ck,L.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}"]})}return v})()},48339:(De,le,r)=>{"use strict";r.d(le,{B:()=>v});var M=r(60316),a=r(84175),F=r(93840),p=r(80640),e=r(21701),o=(r(53792),r(68559)),L=r(90852);const R=y=>[y];let v=(()=>{class y{btnStyle="onlineStyle";map;color;enabled=!1;constructor(){}ngOnInit(){this.map.forcedOffline$.next(this.enabled)}onClick(){this.enabled=!this.enabled,this.handleButtonStyle(),this.map.forcedOffline$.next(this.enabled)}handleButtonStyle(){this.btnStyle=this.enabled?"offlineStyle":"onlineStyle"}static \u0275fac=function(_){return new(_||y)};static \u0275cmp=o.VBU({type:y,selectors:[["igo-offline-button"]],inputs:{map:"map",color:"color",enabled:"enabled"},standalone:!0,features:[o.aNF],decls:6,vars:9,consts:[[1,"igo-user-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","ngClass","color"]],template:function(_,D){1&_&&(o.j41(0,"div",0)(1,"button",1),o.nI1(2,"translate"),o.nI1(3,"translate"),o.bIt("click",function(){return D.onClick()}),o.j41(4,"mat-icon"),o.EFF(5,"wifi_off"),o.k0s()()()),2&_&&(o.R7$(),o.Y8G("matTooltip",D.enabled?o.bMT(2,3,"igo.geo.mapButtons.online"):o.bMT(3,5,"igo.geo.mapButtons.offline"))("ngClass",o.eq3(7,R,D.btnStyle))("color",D.enabled?D.color:null))},dependencies:[a.Hl,a.iY,p.uc,p.oV,M.YU,F.m_,F.An,e.Ck,L.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .offlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#b9b9b9}"]})}return y})()},72789:(De,le,r)=>{"use strict";r.d(le,{w:()=>k});var M=r(60316),a=r(84175),F=r(93840),p=r(80640),e=r(21701),c=r(27885),o=r(75797),R=(r(53792),r(68559)),v=r(90852);const y=(_,D)=>({azimuth:_,rotation:D});function b(_,D){if(1&_){const h=R.RV6();R.j41(0,"div",1),R.nI1(1,"async"),R.nI1(2,"translate"),R.nI1(3,"translate"),R.j41(4,"button",2),R.nI1(5,"async"),R.bIt("click",function(){R.eBV(h);const H=R.XpG();return R.Njj(H.map.viewController.resetRotation())}),R.j41(6,"mat-icon",3),R.nI1(7,"async"),R.EFF(8,"navigation "),R.k0s()()()}if(2&_){const h=R.XpG();R.Y8G("matTooltip",R.bMT(1,4,h.rotated$)?R.i5U(2,6,"igo.geo.mapButtons.resetRotation",R.l_i(15,y,h.azimuthRounded,h.rotationRounded)):R.bMT(3,9,"igo.geo.mapButtons.tipRotation")),R.R7$(4),R.Y8G("color",h.color)("disabled",!1===R.bMT(5,11,h.rotated$)),R.R7$(2),R.Y8G("ngStyle",R.bMT(7,13,h.currentStyle$))}}let k=(()=>{class _{rotated$=new o.t(!1);azimuthRounded=0;rotationRounded=0;currentStyle$=new o.t({transform:"rotate(0rad)"});map;showIfNoRotation;color;constructor(){}ngAfterContentInit(){this.map.viewController.rotation$.subscribe(h=>{const X=h||0,H=180*X/Math.PI;this.rotationRounded=Math.round(H),this.azimuthRounded=Math.round((0,c.u8)(-1*H)),this.currentStyle$.next({transform:"rotate("+X+"rad)"}),this.rotated$.next(0!==X)})}static \u0275fac=function(X){return new(X||_)};static \u0275cmp=R.VBU({type:_,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},standalone:!0,features:[R.aNF],decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"click","color","disabled"],[3,"ngStyle"]],template:function(X,H){1&X&&(R.DNE(0,b,9,18,"div",0),R.nI1(1,"async")),2&X&&R.Y8G("ngIf",R.bMT(1,1,H.rotated$)&&!H.showIfNoRotation||H.showIfNoRotation)},dependencies:[M.bT,p.uc,p.oV,a.Hl,a.iY,F.m_,F.An,M.B3,M.Jj,e.Ck,v.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return _})()},61619:(De,le,r)=>{"use strict";r.d(le,{T:()=>a});var M=r(12912);class a{olMap;observerKeys=[];getOlMap(){return this.olMap}setOlMap(p){if(void 0!==p&&void 0!==this.getOlMap())throw new Error("This controller is already bound to a map.");if(void 0===p)return this.teardownObservers(),void(this.olMap=p);this.olMap=p}teardownObservers(){this.observerKeys.forEach(p=>(0,M.e)(p)),this.observerKeys=[]}}},56780:(De,le,r)=>{"use strict";r.d(le,{$:()=>M});var M=function(a){return a.Position="position",a.PositionDirection="positionDirection",a.Accuracy="accuracy",a.Buffer="buffer",a}(M||{})},34565:(De,le,r)=>{"use strict";r.d(le,{x:()=>G});var M=r(94691),a=r(65227),F=r(49964),p=r(29100),e=r(93812),c=r(63886),o=r(78292),L=r(29814),R=r(61099),v=r(18194),y=r(1963),b=r(2844),k=r(61938),_=r(75797),D=r(19240),h=r(36647),X=r(3439),H=r(33864),x=r(25771),ee=r(61619),Z=r(56780);class G extends ee.T{map;options;storageService;configService;arrowRotation;subscriptions$$=[];geolocationOverlay;positionFeatureStyle=new L.Ay({image:new R.A({radius:6,fill:new v.A({color:"#3399CC"}),stroke:new y.A({color:"#fff",width:2})})});accuracyFeatureStyle=new L.Ay({stroke:new y.A({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new v.A({color:"rgba(120, 120, 120, 0.4)"})});get bufferStyle(){return new L.Ay({stroke:new y.A({width:2,color:this.buffer.bufferStroke}),fill:new v.A({color:this.buffer.bufferFill}),text:new b.A({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?`${this.buffer.bufferRadius}m`:"",fill:new v.A({color:"#000"}),stroke:new y.A({color:"#fff",width:3})})})}get arrowStyle(){return new L.Ay({image:new k.A({radius:5.5,fill:new v.A({color:"rgba(0, 132, 202)"}),stroke:new y.A({color:"#fff",width:1.5}),points:3,displacement:[0,9],rotation:this.arrowRotation,rotateWithView:!0})})}geolocation;emissionIntervalSeconds$=new _.t(5);position$=new _.t(void 0);tracking$=new _.t(void 0);followPosition$=new _.t(void 0);lastPosition;set buffer(N){this._buffer=N,this.handleFeatureCreation(this.position$.value)}get buffer(){return this._buffer}_buffer;set accuracyThreshold(N){this._accuracyThreshold=N,this.handleFeatureCreation(this.position$.value)}get accuracyThreshold(){return this._accuracyThreshold}_accuracyThreshold;get olGeolocation(){return this.geolocation}get tracking(){return this.geolocation.getTracking()}set tracking(N){this.geolocation.setTracking(N||!1),this.tracking$.next(N),this.storageService&&void 0!==N&&this.storageService.set("geolocation.tracking",N),N||this.position$.next(void 0)}set followPosition(N){this._followPosition=N,this.followPosition$.next(N),!1===this.configService?.getConfig("geolocate.followPosition")&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&void 0!==N&&this.storageService.set("geolocation.followPosition",N)}get followPosition(){return this._followPosition}_followPosition;constructor(N,W,A,g){super(),this.map=N,this.options=W,this.storageService=A,this.configService=g,this.geolocationOverlay=new x.h(this.map),this._followPosition=!(!this.options||!this.options.followPosition)&&this.options.followPosition,this._buffer=this.options&&this.options.buffer?this.options.buffer:void 0,this._accuracyThreshold=this.options&&this.options.accuracyThreshold?this.options.accuracyThreshold:5e3}setOlMap(N){super.setOlMap(N),this.setupObservers()}deleteGeolocationFeatures(){this.deleteFeatureByType(Z.$.Position),this.deleteFeatureByType(Z.$.PositionDirection),this.deleteFeatureByType(Z.$.Accuracy),this.deleteFeatureByType(Z.$.Buffer)}setupObservers(){this.tracking$.subscribe(W=>{W?this.onPositionChange(!0,!0):this.deleteGeolocationFeatures()}),this.geolocation=new a.A({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});let N=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe((0,h.n)(W=>(0,D.Y)(1e3*W))).subscribe(()=>{N===this.tracking?this.onPositionChange(!0):(N=this.tracking,this.onPositionChange(!0,!0))})),this.geolocation.on("change",W=>{this.onPositionChange(!1,!1)})}updateArrowFeatureOrientation(N){const W=c.pd(N.position,N.projection,"EPSG:4326");if(!this.lastPosition)return void(this.lastPosition={coordinates:W,dateTime:new Date});const A=this.getFeatureByType(Z.$.PositionDirection),g=N?.speed>1.25&&this.distanceBetweenPoints(this.lastPosition.coordinates,W)>.003;if(N.accuracy<=this.accuracyThreshold&&g){var j=Math.atan2(W[0]-this.lastPosition.coordinates[0],W[1]-this.lastPosition.coordinates[1]);j<0&&(j=2*Math.PI+j),this.arrowRotation=j,A&&A.setStyle(this.arrowStyle),this.lastPosition={coordinates:W,dateTime:new Date}}else A&&(new Date).getTime()-this.lastPosition.dateTime.getTime()>3e3&&(0,H._Q)(A)}distanceBetweenPoints(N,W){return o.Yf(N,W)/1e3}addOnChangedListener(N){let W=()=>{N(this.geolocation)};return this.geolocation.on("change",W),W}deleteChangedListener(N){this.geolocation.un("change",N)}updateGeolocationOptions(N){if(!N)return;let W=N.geolocate,A=N.alwaysTracking;if(this.storageService){const g=this.storageService.get("geolocation.tracking");null!=g&&(W=g);const u=this.storageService.get("geolocation.followPosition");null!=u&&(A=u)}this.tracking=W,this.followPosition=A,this.buffer=N.buffer}teardownObservers(){this.subscriptions$$.length&&this.subscriptions$$.map(N=>N.unsubscribe()),super.teardownObservers()}onPositionChange(N=!1,W=!1){if(!this.tracking)return;const A=this.geolocation.getProperties();if(A.accuracy>this.accuracyThreshold)return console.warn("Poor geolocation accuracy. No position are stored/shown"),void this.position$.next(void 0);const g={position:A.position,projection:this.geolocation.getProjection().getCode(),accuracy:A.accuracy,altitude:A.altitude,altitudeAccuracy:A.altitudeAccuracy,heading:A.heading,speed:A.speed,enableHighAccuracy:!!A.trackingOptions?.enableHighAccuracy,timestamp:new Date};this.handleFeatureCreation(g),this.handleViewFromFeatures(g,W),N&&this.position$.next(g)}getFeatureByType(N){return this.geolocationOverlay.dataSource.ol.getFeatureById(N)}deleteFeatureByType(N){const W=this.geolocationOverlay?.dataSource.ol.getFeatureById(N);W&&this.geolocationOverlay.dataSource.ol.removeFeature(W)}handleFeatureCreation(N){if(!N||!N.position)return;const W=new F.A(N.position),A=(0,e.nD)(new p.A(N.position,N.accuracy||0));let g=this.getFeatureByType(Z.$.Position),u=this.getFeatureByType(Z.$.PositionDirection),O=this.getFeatureByType(Z.$.Accuracy);const j=!!g,P=!!u,Y=!!O;if(P||(u=new M.A({geometry:W}),u.setId(Z.$.PositionDirection),(0,H._Q)(u)),j||(g=new M.A({geometry:W}),g.setId(Z.$.Position),g.setStyle(this.positionFeatureStyle)),Y||(O=new M.A({geometry:A}),O.setId(Z.$.Accuracy),O.setStyle(this.accuracyFeatureStyle)),W&&(j?g.setGeometry(W):this.geolocationOverlay.addOlFeature(g,X.B.None),P?u.setGeometry(W):this.geolocationOverlay.addOlFeature(u,X.B.None),this.updateArrowFeatureOrientation(N),Y?O.setGeometry(A):this.geolocationOverlay.addOlFeature(O,X.B.None),this.buffer)){let w=this.getFeatureByType(Z.$.Buffer);const I=!!w,E=new p.A(N.position,this.buffer.bufferRadius);I||(w=new M.A(E),w.setId(Z.$.Buffer),w.setStyle(this.positionFeatureStyle)),w.setStyle(this.bufferStyle),I?w.setGeometry(E):this.geolocationOverlay.addOlFeature(w,X.B.None)}}handleViewFromFeatures(N,W=!1){const j=[this.getFeatureByType(Z.$.Position),this.getFeatureByType(Z.$.PositionDirection),this.getFeatureByType(Z.$.Accuracy),this.getFeatureByType(Z.$.Buffer)].filter(P=>P);if(j.length>0){const P=(0,H.M8)(j,this.map.viewProjection),Y=N?.speed>12.5?[.25,.25,.25,.25]:[.15,.1,.1,.1],w=(0,H.as)(this.map.getExtent(),P,Y);let I=this.followPosition&&w?X.B.Move:X.B.None;W&&(I=X.B.Zoom),I!==X.B.None&&(0,H.p6)(this.map.viewController,j,I)}}}},54370:(De,le,r)=>{"use strict";r.d(le,{c:()=>R});var M=r(75736),a=r(63886),F=r(75797),p=r(84205),e=r(52575),c=r(85091),o=r(64004),L=r(61619);class R extends L.T{options;rotation$=new F.t(0);resolution$=new F.t(void 0);state$=new F.t(void 0);padding=[0,0,0,0];maxZoomOnExtent=19;maxLayerZoomExtent;extent$=new p.B;extent$$;states=[];stateIndex=0;get stateHistory(){return!!this.options&&!0===this.options.stateHistory}get olView(){return this.olMap.getView()}constructor(y){super(),this.options=y}setPadding(y){(y.top||0===y.top)&&(this.padding[0]=y.top),(y.right||0===y.right)&&(this.padding[1]=y.right),(y.bottom||0===y.bottom)&&(this.padding[2]=y.bottom),(y.left||0===y.left)&&(this.padding[3]=y.left)}setOlMap(y){super.setOlMap(y),this.setupObservers()}setupObservers(){!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",y=>this.onMoveEnd(y))),this.extent$$=this.extent$.pipe((0,e.B)(25)).subscribe(y=>{this.setExtent(y.extent,y.action)})}monitorRotation(){this.observerKeys.push(this.olMap.getView().on("change:rotation",y=>{this.rotation$.next(y.target.getRotation())})),this.rotation$.next(this.getRotation())}teardownObservers(){super.teardownObservers(),void 0!==this.extent$$&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}getOlProjection(){return this.olView.getProjection()}getCenter(y){let b=this.olView.getCenter();return y&&b&&(b=a.pd(b,this.getOlProjection(),y)),b}getExtent(y){let b=this.olView.calculateExtent(this.olMap.getSize());return y&&b&&(b=a.DI(b,this.getOlProjection(),y)),b}getScale(y=96){return(0,o.D5)(this.getResolution(),this.getOlProjection().getUnits(),y)}getResolution(){return this.olView.getResolution()}getZoom(){return Math.round(this.olView.getZoom())}zoomIn(){this.zoomTo(this.olView.getZoom()+1)}zoomOut(){this.zoomTo(this.olView.getZoom()-1)}zoomTo(y){this.olView.cancelAnimations(),this.olView.animate({zoom:y,duration:250,easing:M.vT})}moveToExtent(y){this.extent$.next({extent:y,action:c._.Move})}zoomToExtent(y){this.extent$.next({extent:y,action:c._.Zoom})}getRotation(){return this.olView.getRotation()}resetRotation(){this.olView.animate({rotation:0})}hasPreviousState(){return this.states.length>1&&this.stateIndex>0}hasNextState(){return this.states.length>1&&this.stateIndex<this.states.length-1}previousState(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}nextState(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}clearStateHistory(){this.states=[],this.stateIndex=0}setInitialState(){this.states.length>0&&this.setStateIndex(0)}setExtent(y,b,k=!0){const _=this.olView;_.cancelAnimations();const D=k?500:0,h=_.getZoom(),X=_.getCenter(),H=[y[0]+(y[2]-y[0])/2,y[1]+(y[3]-y[1])/2],x=Math.sqrt(Math.pow(X[0]-H[0],2)+Math.pow(X[1]-H[1],2)),ee=_.calculateExtent(),Z=Math.sqrt(Math.pow(ee[2]-ee[0],2)+Math.pow(ee[3]-ee[1],2)),N=x/((Math.sqrt(Math.pow(y[2]-y[0],2)+Math.pow(y[3]-y[1],2))+Z)/2),W=b===c._.Move||h>this.maxZoomOnExtent?h:this.maxZoomOnExtent;_.fit(y,{size:this.olMap.getSize(),maxZoom:W,padding:this.padding,duration:N>4?0:D,callback:A=>{A||_.fit(y,{size:this.olMap.getSize(),maxZoom:W,padding:this.padding,duration:N>4?0:D})}})}setStateIndex(y){this.stateIndex=y,this.setState(this.states[y])}setState(y){this.olView.animate({resolution:y.resolution,center:y.center,duration:0})}onMoveEnd(y){const b=this.getResolution();this.resolution$.value!==b&&this.resolution$.next(b);const k={resolution:b,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){const _=this.stateIndex;(0,o.C0)(k,0===this.states.length?void 0:this.states[_])||(this.states=this.states.slice(0,_+1).concat([k]),this.stateIndex=this.states.length-1)}this.state$.next(k)}}},95047:(De,le,r)=>{"use strict";r.d(le,{_:()=>U});var M=r(75300),a=r(55050),F=r(68671),p=r(94691),e=r(12912),c=r(49964),o=r(93812),L=r(76983),R=r(18094),v=r(61881),y=r(81140),b=r(82749),k=r(2435),_=r(8115),D=r(84540),h=r(3439),X=r(67852),H=r(24371),x=r(42449),ee=r(56999),Z=r(32780),G=r(68559);let U=(()=>{class N{component;mediaService;styleService;store;pointerHoverFeatureStore=new M.D_([]);lastTimeoutRequest;store$$;layers$$;selectionLayer;selectionMVT={};mvtStyleOptions;pointerMoveListener;singleClickMapListener;hoverFeatureId="hoverFeatureId";igoHoverFeatureDelay=1e3;igoHoverFeatureEnabled=!1;mouseout(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(A,g,u){this.component=A,this.mediaService=g,this.styleService=u}ngOnInit(){this.map.status$.pipe((0,k.$)(A=>A===F.Bi.Done)).subscribe(()=>{this.store=new X.o([],{map:this.map}),this.initStore(),this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick()}),this.layers$$=this.map.layers$.subscribe(A=>{this.store&&!A.find(g=>"hoverFeatureId"===g.id)&&this.initStore()})}initStore(){const A=this.store,g=new H.vK({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new _._,showInLayerList:!1,exportable:!1,browsable:!1,style:ee.aK});(0,D.d)(A,g),this.selectionLayer=new v.A({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new b.A({projection:this.map.projection}),style:(u,O)=>{if(this.mvtStyleOptions&&u.getId()in this.selectionMVT)return this.createHoverStyle(u,this.mvtStyleOptions,O)}})}createHoverStyle(A,g,u){const O={...g};let j=g.label?g.label.attribute:void 0,P=!!g.label?.style;if(A.get("_isLabel")){const Y=O.data?O.data.length:0,w=[],I=[],E=[],s=[];for(let z=0;z<Y;z++)w.push(0),I.push("rgba(255, 255, 255, 0)"),E.push(0),s.push("rgba(255, 255, 255, 0)");O.radius=w,O.stroke=I,O.width=E,O.fill=s}else O.label=void 0,P=!1,j=void 0;return!P&&j&&(O.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(A,O,u)}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(A=>{this.addFeatureOverlay(A)})}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",A=>this.onMapEvent(A))}listenToMapClick(){this.singleClickMapListener=this.map.ol.on("singleclick",A=>this.onMapSingleClickEvent(A))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unlistenToMapPointerMove(){(0,e.e)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapSingleClick(){(0,e.e)(this.singleClickMapListener),this.singleClickMapListener=void 0}onMapSingleClickEvent(A){this.clearLayer()}onMapEvent(A){if(A.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen())return void this.clearLayer();typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let u,g=-1/0;const O=this.map.ol.getPixelFromCoordinate(A.coordinate);this.lastTimeoutRequest=setTimeout(()=>{if(this.map.ol.forEachFeatureAtPixel(O,(j,P)=>{if(!P)return;const Y=this.map.getLayerByOlUId(P.ol_uid);this.canProcessHover(Y)&&(Y.zIndex<=g||(g=Y.zIndex,u=P))},{hitTolerance:10,layerFilter:j=>j instanceof R.A||j instanceof v.A}),!u)return this.clearLayer(),void this.pointerHoverFeatureStore.clear();this.map.ol.forEachFeatureAtPixel(O,(j,P)=>{if(void 0===j.get("hoverSummary")&&j.getProperties()!==this.pointerHoverFeatureStore.all()[0]?.getProperties()){let Y;if(this.clearLayer(),P instanceof R.A){const w=this.map.getLayerByOlUId(P.ol_uid);if(!this.canProcessHover(w))return;let I=this.handleRenderFeature(j);this.setLayerStyleFromOptions(w,I);const E=[I];I.set("_isLabel",!1);const s=new p.A;s.setProperties(I.getProperties());const z="Point"===I.getGeometry().getType()?I.getGeometry():new c.A(A.coordinate);return s.setGeometry(z),s.setId(I.getId()),s.set("_isLabel",!0),this.setLayerStyleFromOptions(w,s),E.push(s),this.pointerHoverFeatureStore.load(E),Y=w,!0}if(P instanceof v.A){const w=this.map.getLayerByOlUId(P.ol_uid);if(!this.canProcessHover(w))return;w?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.mvtStyleOptions=w.options.igoStyle.styleByAttribute.hoverStyle:w?.options?.igoStyle?.hoverStyle&&(this.mvtStyleOptions=w.options.igoStyle.hoverStyle),this.selectionLayer.setSource(P.getSource()),P.getFeatures(A.pixel).then(I=>{if(!I.length)return this.selectionMVT={},this.selectionLayer.changed(),void this.clearLayer();const E=I[0];if(!E)return void this.clearLayer();let s=this.handleRenderFeature(E);s.set("_isLabel",!1);const z=new p.A;z.setProperties(s.getProperties());const Q="Point"===s.getGeometry().getType()?s.getGeometry():new c.A(A.coordinate);z.setGeometry(Q),z.setId(s.getId()),z.set("_isLabel",!0),this.setLayerStyleFromOptions(w,z),this.pointerHoverFeatureStore.load([z]),this.selectionMVT[E.getId()]=s,this.selectionLayer.changed()}),Y=w}}},{hitTolerance:10,layerFilter:j=>j===u})},this.igoHoverFeatureDelay)}canProcessHover(A){return!(!A||!A.visible||!A.options||!A.options.igoStyle?.styleByAttribute&&!A.options.igoStyle?.hoverStyle||A.options.igoStyle?.styleByAttribute&&!A.options.igoStyle?.styleByAttribute.hoverStyle&&!A.options.igoStyle?.hoverStyle)}handleRenderFeature(A){let g;return A instanceof y.Ay?(g=new p.A({geometry:this.getGeometry(A)}),g.setId(A.getId())):A instanceof p.A&&(g=A),g.setProperties(A.getProperties()),g}addFeatureOverlay(A){if(A.length>0){const g=A[0];this.clearLayer();const u=new p.A({geometry:g.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(g.getProperties())});this.store.setLayerOlFeatures([u],h.B.None)}}setLayerStyleFromOptions(A,g){const u=this.store.layer.map.viewController.getResolution();A?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.store.layer.ol.setStyle(this.createHoverStyle(g,A.options.igoStyle.styleByAttribute.hoverStyle,u)):A?.options?.igoStyle?.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(g,A.options.igoStyle.hoverStyle,u))}getHoverSummary(A){let g="";for(const[u,O]of Object.entries(A))!u.startsWith("_")&&"geometry"!==u&&(g+=`${u}: ${O}\n`);return g.length>=2?g.slice(0,-2):g}getGeometry(A){let g;if(A.getOrientedFlatCoordinates){const u=A.getOrientedFlatCoordinates(),O=[];switch(u.forEach((j,P)=>{P%2==0&&O.push([parseFloat(u[P]),parseFloat(u[P+1])])}),A.getType()){case"Point":g=new c.A(O);break;case"Polygon":g=new o.Ay([O]);break;case"LineString":g=new L.A([O])}}else g=A.getGeometry();return g}clearLayer(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}static \u0275fac=function(g){return new(g||N)(G.rXU(x.K,2),G.rXU(a.u1),G.rXU(Z.J))};static \u0275dir=G.FsC({type:N,selectors:[["","igoHoverFeature",""]],hostBindings:function(g,u){1&g&&G.bIt("mouseout",function(){return u.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"},standalone:!0})}return N})()},41161:(De,le,r)=>{"use strict";r.d(le,{y6:()=>M.y,uk:()=>F.u,we:()=>c.w,vM:()=>L.v,A5:()=>b.A5,A1:()=>p.A1,HB:()=>p.HB,ho:()=>p.ho,vm:()=>p.vm,Hh:()=>b.Hh,FU:()=>b.FU});var M=r(53792),F=(r(85091),r(52314)),p=r(64004),c=(r(86827),r(63724)),L=(r(95047),r(58417)),b=(r(34565),r(56780),r(54370),r(64259));r(99441)},99441:(De,le,r)=>{"use strict";r.d(le,{Bb:()=>R,Ey:()=>b,N2:()=>X,TZ:()=>H,i:()=>k,t_:()=>h});var M=r(75889),a=r(61134),F=r(17027),p=r(24371);function e(x){return x.options.linkedLayers}function c(x,ee){return x.layers.find(Z=>Z.options.linkedLayers?.linkId===ee)}function R(x,ee,Z){let G=ee,U=G,N=!0;for(;N;)G=U,U=v(x,G,Z),N=!!U;return N||function o(x,ee){let Z=!1;const G=e(x);return G?.links&&(Z=!!G.links.find(N=>N.properties.includes(ee))),Z}(G,Z)||(G=void 0),N?U:G}function v(x,ee,Z){if(ee?.options.linkedLayers?.linkId){const G=ee.options.linkedLayers.linkId;let U=x.layers.filter(N=>{const W=N.options.linkedLayers;if(W&&W.links)return W.links.find(g=>g.linkedIds.includes(G)&&g.properties.includes(Z))});return U.length>1&&console.warn(`Your layer ${ee.title||ee.id} must only have 1 parent (${U.map(N=>N.title||N.id)})\n            , The first parent (${U[0].title||U[0].id}) will be use to sync properties`),U[0]}}function y(x,ee,Z){let G=[];return ee?.options.linkedLayers?.links&&ee.options.linkedLayers.links.filter(U=>U.properties.includes(Z)).map(U=>{G=G.concat(U.linkedIds)}),G.map(U=>c(x,U))}function b(x,ee,Z,G){return y(x,ee,G).map(N=>{Z.push(N),y(x,N,G)&&b(x,N,Z,G)}),Z}function k(x,ee){let Z=ee,G=Z,U=!0;for(;U;)Z=G,G=_(x,Z),U=!!G;return U||function L(x){let ee=!1;const Z=e(x);return Z?.links&&(ee=!!Z.links.find(U=>U.syncedDelete)),ee}(Z)||(Z=void 0),U?G:Z}function _(x,ee){if(ee.options.linkedLayers?.linkId){const Z=ee.options.linkedLayers.linkId;let G=x.layers.filter(U=>{const N=U.options.linkedLayers;if(N&&N.links)return N.links.find(A=>A.linkedIds.includes(Z)&&A.syncedDelete)});return G.length>1&&console.warn(`Your layer ${ee.title||ee.id} must only have 1 parent (${G.map(U=>U.title||U.id)})\n          , The first parent (${G[0].title||G[0].id}) will be use to sync properties`),G[0]}}function D(x,ee){let Z=[];return ee?.options.linkedLayers?.links&&ee.options.linkedLayers.links.filter(G=>G.syncedDelete).map(G=>{Z=Z.concat(G.linkedIds)}),Z.map(G=>c(x,G))}function h(x,ee,Z){return D(x,ee).map(U=>{Z.push(U),D(x,U)&&h(x,U,Z)}),Z}function X(x,ee){const Z={},G=Object.keys(p.X9);G.map(U=>{Z[p.X9[U]]=[]}),ee.filter(U=>e(U)).map(U=>{G.map(N=>{const W=p.X9[N],A=R(x,U,W),u=Z[W].map(O=>O.id);A&&!u.includes(A.id)&&Z[W].push(A)})}),Object.keys(Z).map(U=>{Z[U].map(W=>W.ol.notify(U,void 0))})}function H(x,ee,Z){if(!ee)return;const G=new F.l;let U=!0,N=!0;const W=ee.key;let A;if("ogcFilters"===W?(U=!1,N=!0,A=Z.dataSource.options.ogcFilters):"timeFilter"===W?(U=!1,N=!0,A=Z.dataSource.options.timeFilter):(U=!0,N=!1,A=Z.ol.get(W)),e(Z)){let u=R(x,Z,W);u||(u=Z);const O=[u];b(x,u,O,W);let j=!1;const P=Z.options.source.options.type,Y=Z.dataSource.options;O.map(w=>{if(Z&&w&&(0,M.v6)(Z.ol)!==(0,M.v6)(w?.ol)){const I=w.options.source.options.type;if(U)w.ol.set(W,A,!0),"visible"===W&&w.visible$.next(A),("minResolution"===W||"maxResolution"===W)&&(j=!0);else if(N)if("ogcFilters"===W){if(w.dataSource.setOgcFilters(A,!1),"wfs"===I&&w.ol.getSource().refresh(),"wms"===I){let E;"wfs"===P?E=G.handleOgcFiltersAppliedValue(Y,Z.dataSource.options.fieldNameGeometry,void 0,x.viewController.getOlProjection()):"wms"===P&&(E=Z.dataSource.ol.getParams().FILTER),w.dataSource.ol.updateParams({FILTER:E})}}else if(w.dataSource instanceof a.T&&"timeFilter"===W){w.dataSource.setTimeFilter(A,!1);const E=Z.ol.getSource().getParams().TIME;w.dataSource.ol.updateParams({TIME:E})}}}),j&&x.viewController.resolution$.next(x.viewController.resolution$.value)}}},63724:(De,le,r)=>{"use strict";r.d(le,{w:()=>c});var M=r(68559),a=r(55050),F=r(12912),p=r(63886),e=r(42449);let c=(()=>{class o{component;mediaService;lastTimeoutRequest;pointerMoveListener;mapClickListener;pointerPositionDelay=1e3;pointerPositionCoord=new M.bkB;get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(R,v){this.component=R,this.mediaService=v}ngOnInit(){this.listenToMapPointerMove(),this.listenToMapClick()}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",R=>this.onPointerEvent(R,this.pointerPositionDelay))}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",R=>this.onPointerEvent(R,0))}unlistenToMapPointerMove(){(0,F.e)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapClick(){this.mapClickListener=void 0}onPointerEvent(R,v){if(R.dragging||this.mediaService.isTouchScreen())return;typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const y=(0,p.pd)(R.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(()=>{this.pointerPositionCoord.emit(y)},v)}static \u0275fac=function(v){return new(v||o)(M.rXU(e.K,2),M.rXU(a.u1))};static \u0275dir=M.FsC({type:o,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"},standalone:!0})}return o})()},85091:(De,le,r)=>{"use strict";r.d(le,{_:()=>M});var M=function(a){return a[a.Move=0]="Move",a[a.Zoom=1]="Zoom",a}(M||{})},52314:(De,le,r)=>{"use strict";r.d(le,{u:()=>a});var M=r(68559);let a=(()=>{class F{map;constructor(){}getMap(){return this.map}setMap(e){this.map=e}static \u0275fac=function(c){return new(c||F)};static \u0275prov=M.jDH({token:F,factory:F.\u0275fac,providedIn:"root"})}return F})()},53792:(De,le,r)=>{"use strict";r.d(le,{y:()=>Z});var M=r(94800),a=r(18691),F=r(54710),p=r(7055),e=r(58160),c=r(63886),o=r(4860),L=r(75889),R=r(51219),v=r(75797),y=r(5057),b=r(97489),k=r(24371),_=r(25771),D=r(68671),h=r(91817);class X extends D.ZV{propertyChange$=new v.t(void 0);loaded=0;loading=0;layers=[];subscriptions=[];constructor(){super()}watch(){}unwatch(){this.layers.forEach(U=>this.unwatchLayer(U),this)}setPropertyChange(U,N){[k.X9.TIMEFILTER,k.X9.OGCFILTERS,k.X9.VISIBLE,k.X9.OPACITY,k.X9.MINRESOLUTION,k.X9.MAXRESOLUTION].includes(U.key)&&this.propertyChange$.next({event:U,layer:N})}watchLayer(U){if(void 0===U.status$)return;U.ol.on("propertychange",W=>this.setPropertyChange(W,U)),U.dataSource.ol.on("propertychange",W=>this.setPropertyChange(W,U)),this.layers.push(U);const N=U.status$.pipe((0,h.F)()).subscribe(W=>{W===D.Bi.Error&&(this.loading=0,this.loaded=-1),W===D.Bi.Working?this.loading+=1:W===D.Bi.Done&&(this.loaded+=1),this.loaded>=this.loading?(this.loading=this.loaded=0,this.status=D.Bi.Done):this.loading>0&&(this.status=D.Bi.Working)});this.subscriptions.push(N)}unwatchLayer(U){U.ol.un("propertychange",W=>this.setPropertyChange(W,U)),U.dataSource.ol.un("propertychange",W=>this.setPropertyChange(W,U)),U.status$.next(D.Bi.Done);const N=this.layers.indexOf(U);N>=0&&(-1!==[D.Bi.Working,D.Bi.Waiting].indexOf(U.watcher.status)&&(this.loaded+=1),this.subscriptions[N].unsubscribe(),this.subscriptions.splice(N,1),this.layers.splice(N,1),U.watcher.unwatch())}}var H=r(34565),x=r(54370),ee=r(99441);class Z{storageService;configService;ol;forcedOffline$=new v.t(!1);layers$=new v.t([]);layersAddedByClick$=new v.t(void 0);status$;propertyChange$;overlay;queryResultsOverlay;searchResultsOverlay;viewController;geolocationController;swipeEnabled$=new v.t(!1);mapCenter$=new v.t(!1);selectedFeatures$=new v.t(null);bufferDataSource;layerWatcher;options;mapViewOptions;defaultOptions={controls:{attribution:!1}};get layers(){return this.layers$.value}get projection(){return this.projectionCode}get viewProjection(){return this.viewController.getOlProjection()}get projectionCode(){return this.viewProjection.getCode()}constructor(U,N,W){this.storageService=N,this.configService=W,this.options=Object.assign({},this.defaultOptions,U),this.layerWatcher=new X,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,o.kz(R.A),this.init()}init(){const U=[];this.options.controls&&(this.options.controls.attribution&&U.push(new F.A(!0===this.options.controls.attribution?{}:this.options.controls.attribution)),this.options.controls.scaleLine&&U.push(new p.A(!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine)));let N={};!1===this.options.interactions&&(N={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new M.A({interactions:e.N(N),controls:U}),this.setView(this.options.view||{}),this.viewController=new x.c({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new _.h(this),this.queryResultsOverlay=new _.h(this),this.searchResultsOverlay=new _.h(this),this.ol.once("rendercomplete",()=>{this.geolocationController=new H.x(this,{projection:this.viewController.getOlProjection()},this.storageService,this.configService),this.geolocationController.setOlMap(this.ol),this.geolocationController&&this.geolocationController.updateGeolocationOptions(this.mapViewOptions),this.layers$.pipe((0,y.J)()).subscribe(([W,A])=>{let g;W&&(g=W.map(O=>O.id));const u=A.filter(O=>!g.includes(O.id));for(const O of u)O.options.linkedLayers&&O.ol.once("postrender",()=>{(0,ee.N2)(this,u)})}),this.viewController.monitorRotation()}),this.propertyChange$.pipe((0,b.j)(W=>!W)).subscribe(W=>(0,ee.TZ)(this,W.event,W.layer))}setTarget(U){this.ol.setTarget(U),void 0!==U?this.layerWatcher.subscribe(()=>{},null):this.layerWatcher.unsubscribe()}updateView(U){const W={...this.ol.getView().getProperties(),...U};U.zoom&&null==U.resolution&&(W.resolution=void 0),this.setView(W),U.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=U.maxZoomOnExtent),this.mapViewOptions=U}setView(U){void 0!==this.viewController&&this.viewController.clearStateHistory();const N={constrainResolution:!0,...U};U.center&&(N.center=c.Rb(U.center,U.projection)),this.ol.setView(new a.Ay(N)),U.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=U.maxLayerZoomExtent)}updateControls(U){if(void 0===U)return;const N=[];U.attribution&&N.push(new F.A(!0===U.attribution?{}:U.attribution)),U.scaleLine&&N.push(new p.A(!0===U.scaleLine?{}:U.scaleLine)),Object.assign([],this.ol.getControls().getArray()).forEach(A=>{this.ol.removeControl(A)}),N.forEach(A=>{this.ol.addControl(A)})}getCenter(U){return this.viewController.getCenter(U)}getExtent(U){return this.viewController.getExtent(U)}getZoom(){return this.viewController.getZoom()}changeBaseLayer(U){if(U){for(const N of this.getBaseLayers())N.visible=!1;U.visible=!0,this.viewController.olView.setMinZoom(U.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(U.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}}getBaseLayers(){return this.layers.filter(U=>!0===U.baseLayer)}getLayerById(U){return this.layers.find(N=>N.id&&N.id===U)}getLayerByAlias(U){return this.layers.find(N=>N.alias&&N.alias===U)}getLayerByOlUId(U){return this.layers.find(N=>(0,L.v6)(N.ol)&&(0,L.v6)(N.ol)===U)}getLayerByOlLayer(U){const N=(0,L.v6)(U);return this.getLayerByOlUId(N)}addLayer(U,N=!0){this.addLayers([U])}addLayers(U,N=!0){let W=0,A=0;const g=U.map(u=>{if(!u)return;const O=u.zIndex?0:u.baseLayer?A++:W++;return this.doAddLayer(u,O)}).filter(u=>void 0!==u);this.setLayers([].concat(this.layers,g))}removeLayer(U){this.removeLayers([U])}removeLayers(U){const N=this.layers$.value.slice(0),W=[];U.forEach(A=>{A instanceof k.vK&&A.removeLayerFromIDB();const g=N.indexOf(A);g>=0&&(W.push(A),N.splice(g,1),this.handleLinkedLayersDeletion(A,W),W.map(u=>{const O=N.indexOf(u);O>=0&&N.splice(O,1)}))}),W.forEach(A=>this.doRemoveLayer(A)),this.setLayers(N)}handleLinkedLayersDeletion(U,N){let W=(0,ee.i)(this,U);W||(W=U);const A=(0,ee.t_)(this,W,[W]);for(const g of A)N.push(g)}removeAllLayers(){this.layers.forEach(U=>this.doRemoveLayer(U)),this.layers$.next([])}raiseLayer(U){const N=this.getLayerIndex(U);N>1&&this.moveLayer(U,N,N-1)}raiseLayers(U){for(const N of U)this.raiseLayer(N)}lowerLayer(U){const N=this.getLayerIndex(U);N<this.layers.length-1&&this.moveLayer(U,N,N+1)}lowerLayers(U){const N=U.reverse();for(const W of N)this.lowerLayer(W)}moveLayer(U,N,W){const A=this.layers[W],u=U.zIndex;A.baseLayer||U.baseLayer||(U.zIndex=A.zIndex,A.zIndex=u,this.layers[W]=U,this.layers[N]=A,this.layers$.next(this.layers.slice(0)))}doAddLayer(U,N){U.baseLayer&&U.visible&&this.changeBaseLayer(U);const W=this.getLayerById(U.id);if(void 0===W){if(!U.baseLayer&&U.zIndex&&(U.zIndex+=10),void 0===U.zIndex||0===U.zIndex){const A=Math.max(U.baseLayer?0:10,...this.layers.filter(g=>g.baseLayer===U.baseLayer&&g.zIndex<200).map(g=>g.zIndex));U.zIndex=A+1+N}return U.baseLayer&&U.zIndex>9&&(U.zIndex=10),U.setMap(this),this.layerWatcher.watchLayer(U),this.ol.addLayer(U.ol),U}W.visible=!0}doRemoveLayer(U){this.layerWatcher.unwatchLayer(U),this.ol.removeLayer(U.ol),U.setMap(void 0)}setLayers(U){this.layers$.next(this.sortLayersByZIndex(U).slice(0))}sortLayersByZIndex(U){return U.sort((N,W)=>W.zIndex-N.zIndex)}getLayerIndex(U){return this.layers.findIndex(N=>N===U)}}},64004:(De,le,r)=>{"use strict";r.d(le,{A1:()=>L,C0:()=>o,D5:()=>v,HB:()=>R,aQ:()=>k,hH:()=>y,ho:()=>b,vi:()=>c,vm:()=>p,xN:()=>_});var M=r(68671),a=r(65549),F=r(63886);function p(X,H,x={}){let ee,Z,G,U,N,W,A,g,u,O,j,P,Y,w,I,E,s,z,Q,de;const ue=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),ce="([-+])?([\\d]{1,3})([,.](\\d+))?",re=`${ce}[\\s,]+${ce}`,be=new RegExp(`^${re}$`,"g"),_e="([0-9]{1,2})[:|\xb0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|\u2033|\u201d]?\\s*",Le=`${_e}([N|S|E|W|O]),?\\s*${_e}([N|S|E|W|O])`,We=new RegExp(`^${Le}$`,"gi"),Xe="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Be=new RegExp(`^${Xe}`,"gi"),rt="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ie=new RegExp(`^${rt}`,"gi"),Ve="([-+])?(\\d{1,3})[,.](\\d+)",ie=`${Ve}\\s*[,]?\\s*${Ve}`,he=new RegExp(`^${ie}`,"g"),$e="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",Ae=`${$e}\\s*[,.]?\\s*${$e}`,Qe=new RegExp(`^${Ae}`,"g"),Ge="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",at=new RegExp(`^${Ge}?`,"gi"),Oe="([-+]?\\d+)[,.]?(\\d+)?",Ye=`${Oe}[\\s,]+${Oe}`,ze=new RegExp(`^${Ye}$`,"g");let et=!1;if(X=X.toLocaleUpperCase().trim(),ue.test(X)?[Z,de]=X.split(";").map(jt=>jt.trim()):Z=X,be.test(Z))[,G,z,,g,u,Q,,w]=Z.match(re),z=parseFloat((G||"")+z+"."+g),Q=parseFloat((u||"")+Q+"."+w);else if(We.test(Z))[,U,N,W,A,O,j,P,Y]=Z.match(Le),("S"===A||"N"===A)&&(U=[O,O=U][0],N=[j,j=N][0],W=[P,P=W][0],A=[Y,Y=A][0]),z=e(parseFloat(U),parseFloat(N),parseFloat(W),A),Q=e(parseFloat(O),parseFloat(j),parseFloat(P),Y);else if(Be.test(Z)){et=!0,[,,I,z,Q]=Z.match(Xe);const jt=Number(I)<10?`EPSG:3260${I}`:`EPSG:326${I}`;[z,Q]=F.pd([parseFloat(z),parseFloat(Q)],jt,"EPSG:4326")}else if(Ie.test(Z)){et=!0,[,,I,z,Q]=Z.match(rt);const jt=Number(I)<10?`EPSG:3218${I}`:`EPSG:321${80+Number(I)}`;[z,Q]=F.pd([parseFloat(z),parseFloat(Q)],jt,"EPSG:4326")}else if(Qe.test(Z))[,G,U,N,W,g,u,O,j,P,w]=Z.match(Ae),z=e(parseFloat((G||"")+U),parseFloat(N),parseFloat(W),A),Q=e(parseFloat((u||"")+O),parseFloat(j),parseFloat(P),Y);else if(he.test(Z))[,G,U,g,u,O,w]=Z.match(ie),z=e(parseFloat((G||"")+U),parseFloat(N),parseFloat(W),A),Q=e(parseFloat((u||"")+O),parseFloat(j),parseFloat(P),Y);else if(at.test(Z))[,u,O,j,P,,Y,G,U,N,W,,A,E,s]=Z.match(Ge),A||(A="W"),z=N&&N.length>2?parseFloat((G||"")+U+"."+N):e(parseFloat(U),parseFloat(N),parseFloat(W),A),Q=j&&j.length>2?parseFloat((u||"")+O+"."+j):e(parseFloat(O),parseFloat(j),parseFloat(P),Y);else{if(!ze.test(Z))return{lonLat:void 0,message:"",radius:void 0,conf:void 0};et=!0,[,z,g,Q,w]=Z.match(Ye),g&&(z=parseFloat(z+"."+g)),w&&(Q=parseFloat(Q+"."+w))}if(x.forceNA&&!et&&(z>0&&Q>0&&(z>Q?z=-z:Q=-Q),z>Q&&(z=[Q,Q=z][0])),ee=[Number(z),Number(Q)],void 0!==de&&"4326"!==de||ee[0]>180||ee[0]<-180||ee[1]>90||ee[1]<-90){const jt=de?"EPSG:"+de:H,dt="EPSG:4326";try{ee=F.pd(ee,jt,dt)}catch{return{lonLat:void 0,message:"Projection "+jt+" not supported",radius:void 0,conf:void 0}}}return Math.abs(ee[0])<=180&&Math.abs(ee[1])<=90?{lonLat:ee,message:"",radius:E?parseInt(E,10):void 0,conf:s?parseInt(s,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function e(X,H,x,ee){H=H||0,x=x||0;const Z=X<0;let G=Math.abs(X)+H/60+x/3600;return(Z||"S"===ee||"W"===ee)&&(G=-G),G}function c(X,H=3){const x=[];return X.forEach(ee=>{const Z=ee<0?Math.ceil(ee):Math.floor(ee),G=ee<0?60*(Z-ee):60*(ee-Z),U=Math.floor(G),N=(60*(G-U)).toFixed(H);x.push(`${Z}\xb0 ${U}' ${N}"`)}),x}function o(X,H){if(void 0===X||void 0===H)return!1;const x=1e-4;return X.zoom===H.zoom&&Math.trunc(X.center[0]/x)===Math.trunc(H.center[0]/x)&&Math.trunc(X.center[1]/x)===Math.trunc(H.center[1]/x)}function L(X){return(X=Math.round(X))<1e4?X+"":(X=Math.round(X/1e3))<1e3?X+"K":(X=Math.round(X/1e3))+"M"}function R(X,H=96){return X/(39.3701*H)}function v(X,H="m",x=96){return X*F.Ig[H]*39.3701*x}function y(X){const H=X.originalEvent;return!H.altKey&&(a.ew?H.metaKey:H.ctrlKey)&&!H.shiftKey}function b(X,H=3){return[M.ZM.roundToNDecimal(X[0],H),M.ZM.roundToNDecimal(X[1],H)]}function k(X,H=3){return b(X,H).map(x=>x.toString())}function _(X,H){const x=F.pd(X,"EPSG:4326","EPSG:3857"),ee=[{code:"EPSG:3857",alias:"Web Mercator",coord:x,igo2CoordFormat:`${b(x).join(", ")} ; 3857`}],Z=function D(X){return Math.ceil((X[0]+180)/6)}(X),G=Z<10?`EPSG:3260${Z}`:`EPSG:326${Z}`,U=`UTM-${Z}`,N=F.pd(X,"EPSG:4326",G);ee.push({code:G,alias:"UTM",coord:N,igo2CoordFormat:`${U} ${b(N).join(", ")}`});const W=function h(X){const H=X[0];let x;return H<-51&&H>-54&&(x=1),H<-54&&H>-57&&(x=2),H<-57&&H>-60&&(x=3),H<-60&&H>-63&&(x=4),H<-63&&H>-66&&(x=5),H<-66&&H>-69&&(x=6),H<-69&&H>-72&&(x=7),H<-72&&H>-75&&(x=8),H<-75&&H>-78&&(x=9),H<-78&&H>-81&&(x=10),x}(X);if(W){const A=W<10?`EPSG:3218${W}`:`EPSG:321${80+W}`,g=`MTM-${W}`,u=F.pd(X,"EPSG:4326",A);ee.push({code:A,alias:"MTM",coord:u,igo2CoordFormat:`${g} ${b(u).join(", ")}`})}return H.forEach(A=>{const g=F.pd(X,"EPSG:4326",A.code),u=A.code.split(":")[1];ee.push({code:A.code,alias:A.alias||A.code,coord:g,igo2CoordFormat:`${b(g).join(", ")} ; ${u}`})}),ee}},86827:(De,le,r)=>{"use strict";r.d(le,{n:()=>c});var M=r(1455),a=r(69576),F=r(19999),p=r(42449),e=r(68559);let c=(()=>{class o{networkService;messageService;component;get map(){return this.component.map}previousMessageId;constructor(R,v,y){this.networkService=v,this.messageService=y,this.component=R}ngAfterViewInit(){const R=window.navigator.onLine;this.map.forcedOffline$.subscribe(v=>{const y=window.navigator.onLine;if(!R||R!==y||v)if(this.previousMessageId&&this.messageService.remove(this.previousMessageId),!v&&y){const b=this.messageService.info("igo.geo.network.online.message","igo.geo.network.online.title");this.previousMessageId=b.toastId}else if(v){const b=this.messageService.info("igo.geo.network.offline.message","igo.geo.network.offline.title");this.previousMessageId=b.toastId}}),(0,F.z)([this.networkService.currentState(),this.map.forcedOffline$,this.map.layers$]).subscribe(v=>{this.handleLayersOnlineState(v[0].connection,v[1],v[2])})}handleNonOfflinableLayerResolution(R,v,y){!R||v?y.maxResolution=0:(R||!v)&&(y.maxResolution=y.options.maxResolution||1/0)}handleLayersOnlineState(R,v,y){y.forEach(b=>{let k;if(!b.isIgoInternalLayer){if(b.options.sourceOptions?.pathOffline&&(k=b.options.sourceOptions),!k)return void this.handleNonOfflinableLayerResolution(R,v,b);{const _=k.type;if("mvt"===_&&b.ol.getSource().refresh(),!R||v){if(["vector","cluster"].includes(_))return;b.ol.getSource().setUrl(k.pathOffline)}else if(R&&v)this.handleNonOfflinableLayerResolution(R,v,b);else{if(["vector","cluster"].includes(_))return;b.ol.getSource().setUrl(k.url)}}}})}static \u0275fac=function(v){return new(v||o)(e.rXU(p.K),e.rXU(a.A),e.rXU(M.bg))};static \u0275dir=e.FsC({type:o,selectors:[["","igoMapOffline",""]],standalone:!0})}return o})()},58417:(De,le,r)=>{"use strict";r.d(le,{v:()=>c});var M=r(67143),a=r(63886),F=r(4860),p=r(51219),e=r(68559);let c=(()=>{class o{config;constructor(R){this.config=R,(this.config.getConfig("projections")||[]).forEach(y=>{y.alias=y.alias?y.alias:y.code,this.registerProjection(y)});for(let y=1;y<61;y++)this.registerProjection({code:y<10?`EPSG:3260${y}`:`EPSG:326${y}`,def:`+proj=utm +zone=${y} +datum=WGS84 +units=m +no_defs`,extent:void 0});for(let y=1;y<11;y++){const b=y<10?`EPSG:3218${y}`:`EPSG:321${80+y}`;let k;k=Number(y)<=2?-50-3*Number(y):Number(y)>=12?-81-3*(Number(y)-12):-49.5-3*Number(y),this.registerProjection({code:b,def:`+proj=tmerc +lat_0=0 +lon_0=${k} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"`,extent:void 0})}}registerProjection(R){p.A.defs(R.code,R.def),F.kz(p.A),R.extent&&a.Jt(R.code).setExtent(R.extent)}static \u0275fac=function(v){return new(v||o)(e.KVO(M.we))};static \u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},64259:(De,le,r)=>{"use strict";r.d(le,{A5:()=>p,FU:()=>F,Hh:()=>a,Z1:()=>e});var M=r(95429);function a(c){let o=-54;if(c<-81||c>o)return 0;{let v=2;for(;Math.abs(c-o)>3;)o-=3,v++;return v}}function F(c){let o=-180,v=1;for(;Math.abs(c-o)>6;)o+=6,v++;return v}function p(c){const o=c.mtmZone,L=c.utmZone;return{projFromConfig:!1!==c.projFromConfig,nad83:!1!==c.nad83,wgs84:!1!==c.wgs84,webMercator:!1!==c.webMercator,utm:!1!==c.utm,mtm:!1!==c.mtm,utmZone:{minZone:L&&L.minZone?L.minZone:17,maxZone:L&&L.maxZone?L.maxZone:21},mtmZone:{minZone:o&&o.minZone?o.minZone:2,maxZone:o&&o.maxZone?o.maxZone:10}}}function e(c){const o=c.file,L=c.nbLines??500,R=new FileReader;return(0,M.H)(new Promise(v=>{o.name.toLowerCase().endsWith(".geojson")||o.name.toLowerCase().endsWith(".json")||o.name.toLowerCase().endsWith(".gml")?(R.onload=y=>{if(o.name.toLowerCase().endsWith(".geojson")||o.name.toLowerCase().endsWith(".json")){const b=JSON.parse(R.result);if(b.crs?.properties?.name){const k=b.crs.properties.name.match(/EPSG:{1,2}\d{0,6}/gm);return null!==k&&k.length?void v(k[0].replace(/::/g,":")):void v("epsgNotDefined")}v("epsgNotDefined")}else if(o.name.toLowerCase().endsWith(".gml")){const k=R.result.split("\n");for(let _=0;_<=L;_++){const D=k[_].match(/EPSG:\d{0,6}/gm);if(null!==D&&D.length){v(D[0]);break}v(void 0)}}else v("epsgNotDefined")},R.readAsText(o,"UTF-8")):v("epsgNotDefined")}))}},8577:(De,le,r)=>{"use strict";r.d(le,{Z:()=>p});var M=r(88841),F=(r(53792),r(68559));let p=(()=>{class e{map;layers;pos1;pos3;inDragAction=!1;swipeEnabled$$;boundPrerender=this.prerender.bind(this);constructor(){}ngAfterViewInit(){this.getListOfLayers(),this.swipeEnabled$$=this.map.swipeEnabled$.subscribe(o=>{o?this.displaySwipe():this.displaySwipeOff()}),this.letZoom()}ngOnDestroy(){this.swipeEnabled$$.unsubscribe(),this.map.swipeEnabled$.unsubscribe(),this.displaySwipeOff()}displaySwipe(){this.swipeId&&(this.swipeId.style.visibility="visible"),this.layers.map(o=>o.ol.on("prerender",this.boundPrerender)),this.layers.map(o=>o.ol.on("postrender",this.postrender)),this.map.ol.render()}displaySwipeOff(){this.swipeId&&(this.swipeId.style.visibility="hidden"),this.layers.map(o=>o.ol.un("prerender",this.boundPrerender)),this.layers.map(o=>o.ol.un("postrender",this.postrender)),this.map.ol.render(),this.layers=[]}get swipeId(){return document.getElementById("igo-layer-swipe")}getListOfLayers(){this.map.selectedFeatures$.subscribe(o=>{if(this.layers=[],null!==o)for(const L of o)this.layers.includes(L)||this.layers.push(L)})}dragDown(o){this.inDragAction=!0,o.preventDefault(),"mousedown"===o.type?(this.pos3=o.clientX,this.mouseSwipe(),document.onmouseup=this.closeDragMouseElement):"touchstart"===o.type&&(document.getElementById("arrows").style.visibility="hidden",this.pos3=o.touches[0].clientX,this.touchSwipe(),document.ontouchend=this.closeDragTouchElement)}mouseSwipe(){document.addEventListener("mousemove",o=>{this.inDragAction&&(o.preventDefault(),this.pos1=this.pos3-o.clientX,this.pos3=o.clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}touchSwipe(){document.addEventListener("touchmove",o=>{this.inDragAction&&(o.preventDefault(),document.getElementById("arrows").style.visibility="hidden",this.pos1=this.pos3-o.changedTouches[0].clientX,this.pos3=o.changedTouches[0].clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}closeDragMouseElement(){document.onmouseup=null,document.onmousemove=null,this.inDragAction=!1}closeDragTouchElement(){document.ontouchend=null,document.ontouchmove=null,document.getElementById("arrows").style.visibility="visible",this.inDragAction=!1}prerender(o){const L=o.context,R=this.map.ol.getSize(),v=this.swipeId.offsetLeft,y=(0,M.FY)(o,[v,0]),b=(0,M.FY)(o,[0,0]),k=(0,M.FY)(o,[v,R[1]]),_=(0,M.FY)(o,[0,R[1]]);L.save(),L.beginPath(),L.moveTo(y[0],y[1]),L.lineTo(k[0],k[1]),L.lineTo(_[0],_[1]),L.lineTo(b[0],b[1]),L.closePath(),L.clip()}postrender(o){o.context.restore(),o.context.save()}letZoom(){document.getElementById("igo-layer-swipe").addEventListener("wheel",o=>{o.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(L){return new(L||e)};static \u0275cmp=F.VBU({type:e,selectors:[["igo-swipe-control"]],inputs:{map:"map"},standalone:!0,features:[F.aNF],decls:5,vars:0,consts:[["id","igo-layer-swipe",1,"igo-swipe-control-container",3,"mousedown","mouseup","touchstart","touchend"],[1,"igo-swipe-control-line"],["id","arrows",1,"igo-swipe-control-arrows"],[1,"igo-arrow-left"],[1,"igo-arrow-right"]],template:function(L,R){1&L&&(F.j41(0,"div",0),F.bIt("mousedown",function(y){return R.dragDown(y)})("mouseup",function(){return R.closeDragMouseElement()})("touchstart",function(y){return R.dragDown(y)})("touchend",function(){return R.closeDragTouchElement()}),F.nrm(1,"div",1),F.j41(2,"div",2),F.nrm(3,"div",3)(4,"div",4),F.k0s()())},styles:[".igo-swipe-control-container[_ngcontent-%COMP%]{position:absolute;width:80px;height:100%;top:0%;left:50%;cursor:grab;z-index:1;transform:translate(-40px)}.igo-swipe-control-container[_ngcontent-%COMP%]:active{cursor:grabbing}.igo-swipe-control-line[_ngcontent-%COMP%]{position:absolute;width:4px;height:100%;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#5e5a5a}.igo-swipe-control-arrows[_ngcontent-%COMP%]{position:absolute;width:32px;height:32px;left:50%;top:50%;transform:translate(-50%,-50%);margin-top:-16px;padding:5px 4px;background-color:#5e5a5a;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0)}.igo-swipe-control-arrows[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-right[_ngcontent-%COMP%]{margin-left:4px;border-left:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-left[_ngcontent-%COMP%]{border-right:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]:active{display:none}"]})}return e})()},47457:(De,le,r)=>{"use strict";r.d(le,{n:()=>k});var M=r(60316),a=r(84175),F=r(93840),p=r(80640),e=r(21701),c=r(81681),o=r(68671),L=r(43471),R=r.n(L),v=r(75797),y=r(68559),b=r(90852);let k=(()=>{class _{storageService;color="primary";get enabled(){return this.storageService.get("wakeLockEnabled")}set enabled(h){this.storageService.set("wakeLockEnabled",h)}noSleep;icon$=new v.t("bedtime");visible=!1;constructor(h){this.storageService=h,this.noSleep=new(R()),o.N1.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.addEventListener("blur",()=>{this.disableWakeLock(),this.enabled=!1})),this.enabled?this.enableWakeLock():this.disableWakeLock()}enableWakeLock(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("bedtime_off")}disableWakeLock(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("bedtime")}toggleWakeLock(){this.enabled?this.disableWakeLock():this.enableWakeLock()}static \u0275fac=function(X){return new(X||_)(y.rXU(c.n$))};static \u0275cmp=y.VBU({type:_,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",enabled:"enabled"},standalone:!0,features:[y.aNF],decls:7,vars:9,consts:[[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","color","matTooltip"]],template:function(X,H){1&X&&(y.j41(0,"div",0)(1,"button",1),y.nI1(2,"translate"),y.nI1(3,"translate"),y.bIt("click",function(){return H.toggleWakeLock()}),y.j41(4,"mat-icon"),y.EFF(5),y.nI1(6,"async"),y.k0s()()()),2&X&&(y.R7$(),y.Y8G("color",H.color)("matTooltip",H.enabled?y.bMT(2,3,"igo.geo.mapButtons.preventScreenLock"):y.bMT(3,5,"igo.geo.mapButtons.letScreenLock")),y.R7$(4),y.JRh(y.bMT(6,7,H.icon$)))},dependencies:[a.Hl,a.iY,p.uc,p.oV,F.m_,F.An,M.Jj,e.Ck,b.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return _})()},13361:(De,le,r)=>{"use strict";r.d(le,{L:()=>R});var M=r(84175),a=r(93840),F=r(80640),p=r(21701),c=(r(53792),r(68559)),o=r(90852);const L=v=>({zoom:v});let R=(()=>{class v{map;color;get zoom(){return this.map.viewController.getZoom()}get minZoom(){return this.map.viewController.olView.getMinZoom()||1}get maxZoom(){return this.map.viewController.olView.getMaxZoom()}constructor(){}static \u0275fac=function(k){return new(k||v)};static \u0275cmp=c.VBU({type:v,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[c.aNF],decls:9,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","color","disabled"]],template:function(k,_){1&k&&(c.j41(0,"div",0)(1,"button",1),c.nI1(2,"translate"),c.bIt("click",function(){return _.map.viewController.zoomIn()}),c.j41(3,"mat-icon"),c.EFF(4,"add"),c.k0s()(),c.j41(5,"button",1),c.nI1(6,"translate"),c.bIt("click",function(){return _.map.viewController.zoomOut()}),c.j41(7,"mat-icon"),c.EFF(8,"remove"),c.k0s()()()),2&k&&(c.R7$(),c.Y8G("matTooltip",c.i5U(2,6,"igo.geo.mapButtons.zoomIn",c.eq3(12,L,_.zoom+1)))("color",_.color)("disabled",_.zoom>=_.maxZoom),c.R7$(4),c.Y8G("matTooltip",c.i5U(6,9,"igo.geo.mapButtons.zoomOut",c.eq3(14,L,_.zoom-1)))("color",_.color)("disabled",_.zoom<=_.minZoom))},dependencies:[M.Hl,M.iY,F.uc,F.oV,a.m_,a.An,p.Ck,o.D9],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}"]})}return v})()},25713:(De,le,r)=>{"use strict";r.d(le,{$R:()=>M.$R,w4:()=>F.w,os:()=>M.os,JM:()=>M.JM,RE:()=>M.RE,mc:()=>M.mc,Sg:()=>M.Sg});var M=r(83019),F=(r(55414),r(76173))},55414:(De,le,r)=>{"use strict";r.d(le,{o:()=>p});var M=r(28440),a=r(71480),F=r(68559);let p=(()=>{class e{transform(o,L,R=!1,v=1){let y;return Object.values(M.i2).indexOf(L)>=0?y=(0,a.dN)(o,L):Object.values(M.$R).indexOf(L)>=0&&(y=(0,a.SI)(o,L)),y&&(0,a.os)(y,{decimal:1,unit:L,unitAbbr:R,locale:"fr"})}static \u0275fac=function(L){return new(L||e)};static \u0275pipe=F.EJ8({name:"measureFormat",type:e,pure:!0,standalone:!0})}return e})()},76173:(De,le,r)=>{"use strict";r.d(le,{w:()=>rt});var M=r(60316),a=r(84175),F=r(59864),p=r(14102),e=r(93840),c=r(8827),o=r(80640),L=r(75300),R=r(21701),v=r(81681),y=r(68671),b=r(12912),k=r(66586),_=r(65836),D=r(29814),h=r(75797),X=r(47470),H=r(91020),x=r(54427),ee=r(36741),Z=r(44860),U=(r(53792),r(28440)),N=r(71480),W=r(87941),A=r(55414),g=r(68559),u=r(90852);function O(Ie,Ve){if(1&Ie&&(g.j41(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),g.EFF(4),g.nI1(5,"translate"),g.k0s()()(),g.j41(6,"tbody")(7,"tr")(8,"td"),g.EFF(9),g.nI1(10,"measureFormat"),g.k0s(),g.j41(11,"td"),g.EFF(12),g.nI1(13,"translate"),g.k0s()(),g.j41(14,"tr")(15,"td"),g.EFF(16),g.nI1(17,"measureFormat"),g.k0s(),g.j41(18,"td"),g.EFF(19),g.nI1(20,"translate"),g.k0s()(),g.j41(21,"tr")(22,"td"),g.EFF(23),g.nI1(24,"measureFormat"),g.k0s(),g.j41(25,"td"),g.EFF(26),g.nI1(27,"translate"),g.k0s()(),g.j41(28,"tr")(29,"td"),g.EFF(30),g.nI1(31,"measureFormat"),g.k0s(),g.j41(32,"td"),g.EFF(33),g.nI1(34,"translate"),g.k0s()()()()),2&Ie){const ie=g.XpG();g.R7$(4),g.SpI(" ",g.bMT(5,9,"igo.geo.measure.dialog.length.title")," "),g.R7$(5),g.JRh(g.i5U(10,11,ie.data.length,ie.measureLengthUnit.Meters)),g.R7$(3),g.JRh(g.bMT(13,14,"igo.geo.measure.dialog.lengthInMeters")),g.R7$(4),g.SpI(" ",g.i5U(17,16,ie.data.length,ie.measureLengthUnit.Kilometers)," "),g.R7$(3),g.JRh(g.bMT(20,19,"igo.geo.measure.dialog.lengthInKilometers")),g.R7$(4),g.JRh(g.i5U(24,21,ie.data.length,ie.measureLengthUnit.Miles)),g.R7$(3),g.JRh(g.bMT(27,24,"igo.geo.measure.dialog.lengthInMiles")),g.R7$(4),g.JRh(g.i5U(31,26,ie.data.length,ie.measureLengthUnit.Feet)),g.R7$(3),g.JRh(g.bMT(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function j(Ie,Ve){if(1&Ie&&(g.j41(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),g.EFF(4),g.nI1(5,"translate"),g.k0s()()(),g.j41(6,"tbody")(7,"tr")(8,"td"),g.EFF(9),g.nI1(10,"measureFormat"),g.k0s(),g.j41(11,"td"),g.EFF(12),g.nI1(13,"translate"),g.k0s()(),g.j41(14,"tr")(15,"td"),g.EFF(16),g.nI1(17,"measureFormat"),g.k0s(),g.j41(18,"td"),g.EFF(19),g.nI1(20,"translate"),g.k0s()(),g.j41(21,"tr")(22,"td"),g.EFF(23),g.nI1(24,"measureFormat"),g.k0s(),g.j41(25,"td"),g.EFF(26),g.nI1(27,"translate"),g.k0s()(),g.j41(28,"tr")(29,"td"),g.EFF(30),g.nI1(31,"measureFormat"),g.k0s(),g.j41(32,"td"),g.EFF(33),g.nI1(34,"translate"),g.k0s()(),g.j41(35,"tr")(36,"td"),g.EFF(37),g.nI1(38,"measureFormat"),g.k0s(),g.j41(39,"td"),g.EFF(40),g.nI1(41,"translate"),g.k0s()(),g.j41(42,"tr")(43,"td"),g.EFF(44),g.nI1(45,"translate"),g.k0s(),g.j41(46,"td"),g.EFF(47),g.nI1(48,"measureFormat"),g.k0s()()()()),2&Ie){const ie=g.XpG();g.R7$(4),g.SpI(" ",g.bMT(5,13,"igo.geo.measure.dialog.area.title")," "),g.R7$(5),g.JRh(g.i5U(10,15,ie.data.area,ie.measureAreaUnit.SquareMeters)),g.R7$(3),g.JRh(g.bMT(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),g.R7$(4),g.SpI(" ",g.i5U(17,20,ie.data.area,ie.measureAreaUnit.SquareKilometers)," "),g.R7$(3),g.SpI(" ",g.bMT(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")," "),g.R7$(4),g.JRh(g.i5U(24,25,ie.data.area,ie.measureAreaUnit.SquareMiles)),g.R7$(3),g.JRh(g.bMT(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),g.R7$(4),g.JRh(g.i5U(31,30,ie.data.area,ie.measureAreaUnit.Acres)),g.R7$(3),g.JRh(g.bMT(34,33,"igo.geo.measure.dialog.areaInAcres")),g.R7$(4),g.JRh(g.i5U(38,35,ie.data.area,ie.measureAreaUnit.Hectares)),g.R7$(3),g.JRh(g.bMT(41,38,"igo.geo.measure.dialog.areaInHectares")),g.R7$(4),g.JRh(g.bMT(45,40,"igo.geo.measure.dialog.perimeterInMeters")),g.R7$(3),g.JRh(g.i5U(48,42,ie.data.perimeter,ie.measureLengthUnit.Meters))}}let P=(()=>{class Ie{dialogRef;data;measureAreaUnit=U.i2;measureLengthUnit=U.$R;constructor(ie,he){this.dialogRef=ie,this.data=he}onNoClick(){this.dialogRef.close()}static \u0275fac=function(he){return new(he||Ie)(g.rXU(W.CP),g.rXU(W.Vh))};static \u0275cmp=g.VBU({type:Ie,selectors:[["igo-measurer-dialog"]],standalone:!0,features:[g.aNF],decls:6,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function(he,$e){1&he&&(g.j41(0,"h3",0),g.EFF(1),g.nI1(2,"translate"),g.k0s(),g.j41(3,"div",1),g.DNE(4,O,35,31,"table",2)(5,j,49,45,"table",2),g.k0s()),2&he&&(g.R7$(),g.JRh(g.bMT(2,3,"igo.geo.measure.dialog.title")),g.R7$(3),g.Y8G("ngIf",$e.data.length>0),g.R7$(),g.Y8G("ngIf",$e.data.area>0))},dependencies:[W.BI,W.Yi,M.bT,R.Ck,u.D9,A.o],styles:["[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}"]})}return Ie})();var Y=r(85060),w=r(15944),I=r(87984),E=r(25175);function s(Ie,Ve){if(1&Ie&&(g.j41(0,"mat-option",5),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&Ie){const ie=Ve.$implicit;g.Y8G("value",ie),g.R7$(),g.SpI(" ",g.bMT(2,2,"igo.geo.measure."+ie)," ")}}let z=(()=>{class Ie{measure$=new h.t(void 0);measure$$;measureType;measureUnit;set measure(ie){this.measure$.next(ie)}get measure(){return this.measure$.value}set auto(ie){this.toggleAutoUnit(ie)}get auto(){return this._auto}_auto=!1;placeholder;measureUnitChange=new g.bkB;get measureUnits(){return Object.values(this.measureType===U.H_.Area?U.i2:U.$R)}constructor(){}ngOnDestroy(){this.toggleAutoUnit(!1)}onMeasureUnitChange(ie){this.measureUnit=ie,this.measureUnitChange.emit(ie)}toggleAutoUnit(ie){void 0!==this.measure$$&&this.measure$$.unsubscribe(),!0===ie&&(this.measure$$=this.measure$.subscribe(he=>{this.computeBestMeasureUnit(he)})),this._auto=ie}computeBestMeasureUnit(ie){let he=this.measureUnit;this.measureType===U.H_.Area?he=(0,N.x3)(ie):this.measureType===U.H_.Length&&(he=(0,N.UO)(ie)),he!==this.measureUnit&&this.onMeasureUnitChange(he)}static \u0275fac=function(he){return new(he||Ie)};static \u0275cmp=g.VBU({type:Ie,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},standalone:!0,features:[g.aNF],decls:9,vars:12,consts:[["floatLabel","always",1,"measure-field"],["matInput","",3,"disabled","readonly","value"],[1,"unit-field"],[3,"selectionChange","value","disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(he,$e){1&he&&(g.j41(0,"mat-form-field",0)(1,"mat-label"),g.EFF(2),g.k0s(),g.nrm(3,"input",1),g.nI1(4,"async"),g.nI1(5,"measureFormat"),g.k0s(),g.j41(6,"mat-form-field",2)(7,"mat-select",3),g.bIt("selectionChange",function(Qe){return $e.onMeasureUnitChange(Qe.value)}),g.DNE(8,s,3,4,"mat-option",4),g.k0s()()),2&he&&(g.R7$(2),g.JRh($e.placeholder),g.R7$(),g.Y8G("disabled",!0)("readonly",!0)("value",g.i5U(5,9,g.bMT(4,7,$e.measure$)||0,$e.measureUnit)),g.R7$(4),g.Y8G("value",$e.measureUnit)("disabled",$e.auto),g.R7$(),g.Y8G("ngForOf",$e.measureUnits))},dependencies:[w.RG,w.rl,w.nJ,I.fS,I.fg,E.Ve,E.VO,Y.wT,M.pM,Y.Sy,M.Jj,R.Ck,u.D9,A.o],styles:["[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}[_nghost-%COMP%]   .measure-field[_ngcontent-%COMP%]{pointer-events:none;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:8px;flex:1}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}return Ie})();const Q=["table"];function ae(Ie,Ve){1&Ie&&g.nrm(0,"mat-divider")}function ye(Ie,Ve){if(1&Ie){const ie=g.RV6();g.j41(0,"mat-slide-toggle",8),g.bIt("change",function($e){g.eBV(ie);const Ae=g.XpG();return g.Njj(Ae.onToggleDisplayLines($e.checked))}),g.EFF(1),g.nI1(2,"translate"),g.k0s()}if(2&Ie){const ie=g.XpG();g.Y8G("checked",ie.displayLines)("labelPosition","before"),g.R7$(),g.SpI(" ",g.bMT(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function de(Ie,Ve){1&Ie&&g.nrm(0,"mat-divider")}function ue(Ie,Ve){if(1&Ie){const ie=g.RV6();g.j41(0,"mat-slide-toggle",8),g.bIt("change",function($e){g.eBV(ie);const Ae=g.XpG();return g.Njj(Ae.onToggleDisplayDistance($e.checked))}),g.EFF(1),g.nI1(2,"translate"),g.k0s()}if(2&Ie){const ie=g.XpG();g.Y8G("checked",ie.displayDistance)("labelPosition","before"),g.R7$(),g.SpI(" ",g.bMT(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function ce(Ie,Ve){if(1&Ie){const ie=g.RV6();g.j41(0,"mat-slide-toggle",8),g.bIt("change",function($e){g.eBV(ie);const Ae=g.XpG();return g.Njj(Ae.onToggleDisplayAreas($e.checked))}),g.EFF(1),g.nI1(2,"translate"),g.k0s()}if(2&Ie){const ie=g.XpG();g.Y8G("checked",ie.displayAreas)("labelPosition","before"),g.R7$(),g.SpI(" ",g.bMT(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function re(Ie,Ve){1&Ie&&g.nrm(0,"mat-divider")}function be(Ie,Ve){if(1&Ie){const ie=g.RV6();g.j41(0,"igo-measurer-item",14),g.nI1(1,"translate"),g.bIt("measureUnitChange",function($e){g.eBV(ie);const Ae=g.XpG(2);return g.Njj(Ae.onLengthUnitChange($e))}),g.k0s()}if(2&Ie){const ie=g.XpG().ngIf,he=g.XpG();g.Y8G("measureType",he.measureType.Length)("measureUnit",he.activeLengthUnit)("measure",ie.length)("auto",he.measureUnitsAuto)("placeholder",g.bMT(1,5,he.activeMeasureType===he.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function _e(Ie,Ve){if(1&Ie){const ie=g.RV6();g.j41(0,"igo-measurer-item",14),g.nI1(1,"translate"),g.bIt("measureUnitChange",function($e){g.eBV(ie);const Ae=g.XpG(2);return g.Njj(Ae.onAreaUnitChange($e))}),g.k0s()}if(2&Ie){const ie=g.XpG().ngIf,he=g.XpG();g.Y8G("measureType",he.measureType.Area)("measureUnit",he.activeAreaUnit)("measure",ie.area)("auto",he.measureUnitsAuto)("placeholder",g.bMT(1,5,"igo.geo.measure.area"))}}function Le(Ie,Ve){if(1&Ie&&(g.qex(0),g.DNE(1,be,2,7,"igo-measurer-item",13)(2,_e,2,7,"igo-measurer-item",13),g.bVm()),2&Ie){const ie=g.XpG();g.R7$(),g.Y8G("ngIf",ie.activeMeasureType===ie.measureType.Length||ie.activeMeasureType===ie.measureType.Area),g.R7$(),g.Y8G("ngIf",ie.activeMeasureType===ie.measureType.Area)}}function We(Ie,Ve){1&Ie&&g.nrm(0,"mat-divider")}function Xe(Ie,Ve){if(1&Ie){const ie=g.RV6();g.j41(0,"button",15),g.nI1(1,"translate"),g.nI1(2,"async"),g.bIt("click",function(){g.eBV(ie);const $e=g.XpG();return g.Njj($e.onCalculateClick())}),g.j41(3,"mat-icon"),g.EFF(4,"calculate"),g.k0s()()}if(2&Ie){const ie=g.XpG();g.Y8G("matTooltip",g.bMT(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",0===g.bMT(2,4,ie.selectedFeatures$).length)}}function Be(Ie,Ve){if(1&Ie){const ie=g.RV6();g.j41(0,"button",16),g.nI1(1,"translate"),g.nI1(2,"async"),g.bIt("click",function(){g.eBV(ie);const $e=g.XpG();return g.Njj($e.onDeleteClick())}),g.j41(3,"mat-icon"),g.EFF(4,"delete"),g.k0s()()}if(2&Ie){const ie=g.XpG();g.Y8G("matTooltip",g.bMT(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",0===g.bMT(2,4,ie.selectedFeatures$).length)}}let rt=(()=>{class Ie{languageService;dialog;storageService;document;tableTemplate;subscriptions$$=[];measureType=U.H_;measureAreaUnit=U.i2;measureLengthUnit=U.$R;measureUnitsAuto=!1;displayDistance=!0;displayLines=!0;displayAreas=!0;hasLine$=new h.t(!1);hasArea$=new h.t(!1);measure$=new h.t({});selectedFeatures$=new h.t([]);showTooltips=!0;drawControlIsDisabled=!0;drawLineControl;drawPolygonControl;modifyControl;activeOlGeometry;activeLengthUnit=U.$R.Meters;activeAreaUnit=U.i2.SquareMeters;onFeatureAddedKey;onFeatureRemovedKey;activeDrawControl;drawStart$$;drawEnd$$;drawChanges$$;modifyStart$$;modifyEnd$$;modifyChanges$$;selectedFeatures$$;olDrawSource=new _.A;map;store;set activeMeasureType(ie){this.setActiveMeasureType(ie)}get activeMeasureType(){return this._activeMeasureType}_activeMeasureType;minSegmentLength=10;table;get drawControlIsActive(){return void 0!==this.activeDrawControl}get projection(){return this.map.ol.getView().getProjection().getCode()}constructor(ie,he,$e,Ae){this.languageService=ie,this.dialog=he,this.storageService=$e,this.document=Ae,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:Qe=>{const Ge=this.activeLengthUnit,at=(0,N.SI)(Qe.properties.measure.length,Ge);return(0,N.os)(at,{decimal:1,unit:Ge,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:Qe=>{const Ge=this.activeAreaUnit,at=(0,N.dN)(Qe.properties.measure.area,Ge);return at?(0,N.os)(at,{decimal:1,unit:Ge,unitAbbr:!1,locale:"fr"}):""}}]}}ngOnInit(){this.getSavedUnits(),this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(U.H_.Length)}ngOnDestroy(){this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(ie=>ie.unsubscribe())}onMeasureTypeChange(ie){this.activeMeasureType=ie}onToggleDrawControl(ie){!0===ie?this.toggleDrawControl():this.deactivateDrawControl()}onToggleMeasureUnitsAuto(ie){this.measureUnitsAuto=ie}onToggleDisplayDistance(ie){this.displayDistance=ie,this.onDisplayDistance(),this.storageService.set("distanceToggle",!!ie,v.YM.SESSION)}onToggleDisplayLines(ie){this.displayLines=ie,this.onDisplayLines(),this.storageService.set("linesToggle",!!ie,v.YM.SESSION)}onToggleDisplayAreas(ie){this.displayAreas=ie,this.onDisplayAreas(),this.storageService.set("areasToggle",!!ie,v.YM.SESSION)}checkDistanceAreaToggle(){!1===this.storageService.get("distanceToggle")&&(this.displayDistance=!1),!1===this.storageService.get("linesToggle")&&(this.displayLines=!1),!1===this.storageService.get("areasToggle")&&(this.displayAreas=!1)}onDisplayDistance(){const ie=this.document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments");this.displayDistance?Array.from(ie).map(he=>he.classList.remove("igo-map-tooltip-hidden")):Array.from(ie).map(he=>he.classList.add("igo-map-tooltip-hidden"))}onDisplayLines(){const ie=this.document.getElementsByClassName("igo-map-tooltip-measure-line-segments");this.displayLines?Array.from(ie).map(he=>{he.classList.remove("igo-map-tooltip-hidden")}):Array.from(ie).map(he=>{he.classList.add("igo-map-tooltip-hidden")})}onDisplayAreas(){const ie=this.document.getElementsByClassName("igo-map-tooltip-measure-area");this.displayAreas?Array.from(ie).map(he=>he.classList.remove("igo-map-tooltip-hidden")):Array.from(ie).map(he=>he.classList.add("igo-map-tooltip-hidden"))}onLengthUnitChange(ie){this.activeLengthUnit=ie,this.saveCurrentUnits(),this.refreshTableAndTooltip()}onAreaUnitChange(ie){this.activeAreaUnit=ie,this.saveCurrentUnits(),this.refreshTableAndTooltip()}refreshTableAndTooltip(){this.store.stateView.clear(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onCalculateClick(){const ie=this.selectedFeatures$.value,he=ie.reduce((Qe,Ge)=>Qe+Ge.properties.measure.area||0,0),$e=ie.reduce((Qe,Ge)=>"Polygon"===Ge.geometry.type?Qe:Qe+Ge.properties.measure.length||0,0),Ae=ie.reduce((Qe,Ge)=>"LineString"===Ge.geometry.type?Qe:Qe+Ge.properties.measure.length||0,0);this.openDialog({area:he,length:$e,perimeter:Ae})}onDeleteClick(){this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(ie=>{this.olDrawSource.getFeatures().forEach(he=>{const $e=he.getGeometry();ie.properties.id===$e.ol_uid&&this.olDrawSource.removeFeature(he)})})}onModifyClick(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{const ie=this.selectedFeatures$.value[0],$e=this.store.layer.ol.getSource().getFeatures().find(Ae=>Ae.get("id")===ie.properties.id);if(void 0!==$e){this.deactivateDrawControl(),this.activateModifyControl();const Ae=$e.getGeometry();this.clearTooltipsOfOlGeometry(Ae),this.modifyControl.setOlGeometry(Ae)}}}openDialog(ie){this.dialog.open(P,{data:ie})}initStore(){const ie=this.store,he=new Z.vK({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:`igo-measures-${(0,y.uR)()}`,zIndex:200,source:new H._k,style:(0,N.t_)(),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}});(0,x.df)(ie,he),ie.layer.visible=!0,he.visible$.subscribe($e=>{const Ae=this.document.getElementsByClassName("igo-map-tooltip-measure");$e?Array.from(Ae).map(Qe=>Qe.classList.remove("igo-map-tooltip-measure-by-display")):Array.from(Ae).map(Qe=>Qe.classList.add("igo-map-tooltip-measure-by-display"))}),(0,x.c2)(ie),(0,x._O)(ie,new x.ZA({map:this.map,many:!0})),this.onFeatureAddedKey=ie.source.ol.on("addfeature",$e=>{const Ae=$e.feature,Qe=Ae.getGeometry();this.updateMeasureOfOlGeometry(Qe,Ae.get("measure")),this.onDisplayDistance(),this.onDisplayLines(),this.onDisplayAreas()}),this.onFeatureRemovedKey=ie.source.ol.on("removefeature",$e=>{const Ae=$e.feature.getGeometry();this.clearTooltipsOfOlGeometry(Ae)}),this.selectedFeatures$$=ie.stateView.manyBy$($e=>!0===$e.state.selected).pipe((0,X.i)(1)).subscribe($e=>{!0===this.modifyControl.active&&this.deactivateModifyControl(),this.selectedFeatures$.next($e.map(Ae=>Ae.entity))}),this.subscriptions$$.push(this.store.entities$.subscribe($e=>{$e.find(Ae=>"Polygon"===Ae.geometry.type)?this.hasArea$.next(!0):this.hasArea$.next(!1),$e.find(Ae=>"LineString"===Ae.geometry.type)?this.hasLine$.next(!0):this.hasLine$.next(!1)})),this.subscriptions$$.push(this.store.count$.subscribe($e=>{this.store.layer.options.showInLayerList=$e>=1}))}freezeStore(){const ie=this.store;this.selectedFeatures$$.unsubscribe(),(0,b.e)(this.onFeatureAddedKey),(0,b.e)(this.onFeatureRemovedKey),ie.deactivateStrategyOfType(x.n6),ie.deactivateStrategyOfType(x.ZA)}createDrawLineControl(){this.drawLineControl=new ee.SW({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:(0,N.iN)(),drawingLayerStyle:new D.Ay({})})}createDrawPolygonControl(){this.drawPolygonControl=new ee.SW({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:(0,N.iN)(),drawingLayerStyle:new D.Ay({})})}createModifyControl(){this.modifyControl=new ee.YV({source:this.olDrawSource,drawStyle:(0,N.iN)(),layerStyle:new D.Ay({})})}toggleDrawControl(){this.deactivateDrawControl(),this.activeMeasureType===U.H_.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===U.H_.Area&&this.activateDrawControl(this.drawPolygonControl)}activateDrawControl(ie){this.drawControlIsDisabled=!1,this.activeDrawControl=ie,this.drawStart$$=ie.start$.subscribe(he=>this.onDrawStart(he)),this.drawEnd$$=ie.end$.subscribe(he=>this.onDrawEnd(he)),this.drawChanges$$=ie.changes$.subscribe(he=>this.onDrawChanges(he)),this.drawChanges$$=ie.abort$.subscribe(he=>{this.clearTooltipsOfOlGeometry(he),this.clearMeasures()}),ie.setOlMap(this.map.ol,!1)}deactivateDrawControl(){void 0!==this.activeDrawControl&&(this.olDrawSource.clear(),void 0!==this.drawStart$$&&this.drawStart$$.unsubscribe(),void 0!==this.drawEnd$$&&this.drawEnd$$.unsubscribe(),void 0!==this.drawChanges$$&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),void 0!==this.activeOlGeometry&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}setActiveMeasureType(ie){this._activeMeasureType=ie,this.clearMeasures(),this.toggleDrawControl()}onDrawStart(ie){this.activeOlGeometry=ie}onDrawEnd(ie){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(ie),this.addFeatureToStore(ie),this.clearTooltipsOfOlGeometry(ie),this.olDrawSource.clear(!0)}onDrawChanges(ie){const he=(0,N.i2)(ie,this.projection);this.updateMeasureOfOlGeometry(ie,Object.assign({},he,{area:void 0})),this.measure$.next(he)}activateModifyControl(){const ie=this.store.getStrategyOfType(x.ZA);ie.deactivate(),ie.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(he=>this.onModifyStart(he)),this.modifyEnd$$=this.modifyControl.end$.subscribe(he=>this.onModifyEnd(he)),this.modifyChanges$$=this.modifyControl.changes$.subscribe(he=>this.onModifyChanges(he)),this.modifyControl.setOlMap(this.map.ol)}deactivateModifyControl(){void 0!==this.modifyStart$$&&this.modifyStart$$.unsubscribe(),void 0!==this.modifyEnd$$&&this.modifyEnd$$.unsubscribe(),void 0!==this.modifyChanges$$&&this.modifyChanges$$.unsubscribe(),void 0!==this.activeOlGeometry&&(1===this.selectedFeatures$.value.length&&this.addFeatureToStore(this.activeOlGeometry,this.selectedFeatures$.value[0]),this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)),this.olDrawSource.clear(),this.store.activateStrategyOfType(x.ZA),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}onModifyStart(ie){this.onDrawStart(ie)}onModifyChanges(ie){this.onDrawChanges(ie)}onModifyEnd(ie){this.finalizeMeasureOfOlGeometry(ie)}finalizeMeasureOfOlGeometry(ie){const he=(0,N.i2)(ie,this.projection);this.updateMeasureOfOlGeometry(ie,he)}updateMeasureOfOlGeometry(ie,he){ie.setProperties({_measure:he},!0),this.updateTooltipsOfOlGeometry(ie)}clearMeasures(){this.measure$.next({})}addFeatureToStore(ie,he){const $e=he?he.properties.id:ie.ol_uid,Ae=this.map.ol.getView().getProjection(),Qe=(new k.A).writeGeometryObject(ie,{featureProjection:Ae,dataProjection:Ae});this.store.update({type:x.RI,geometry:Qe,projection:Ae.getCode(),properties:{id:$e,measure:ie.get("_measure")},meta:{id:$e}})}updateTooltipsOfOlGeometry(ie){const he=ie.get("_measure"),$e=he.lengths,Ae=he.area,Qe=(0,N.jg)(ie);if($e.length===Qe.length)for(let Ge=0;Ge<Qe.length;Ge++){const at=$e[Ge];void 0!==at&&this.updateOlTooltip(Qe[Ge],(0,N.SI)(at,this.activeLengthUnit),this.activeLengthUnit,U.H_.Length)}void 0!==Ae&&this.updateOlTooltip((0,N.AS)(ie),(0,N.dN)(Ae,this.activeAreaUnit),this.activeAreaUnit,U.H_.Area)}showTooltipsOfOlGeometry(ie){(0,N.JM)(ie).forEach(he=>{this.shouldShowTooltip(he)&&this.map.ol.addOverlay(he)})}clearTooltipsOfOlGeometry(ie){(0,N.JM)(ie).forEach(he=>{void 0!==he&&void 0!==he.getMap()&&this.map.ol.removeOverlay(he)})}updateTooltipsOfOlSource(ie){ie.forEachFeature(he=>{this.updateTooltipsOfOlGeometry(he.getGeometry())})}showTooltipsOfOlSource(ie){ie.forEachFeature(he=>{this.showTooltipsOfOlGeometry(he.getGeometry())})}clearTooltipsOfOlSource(ie){ie.forEachFeature(he=>{void 0!==he.getGeometry()&&this.clearTooltipsOfOlGeometry(he.getGeometry())})}updateOlTooltip(ie,he,$e,Ae){ie.setProperties({_measure:he,_unit:$e,_type:Ae},!0),ie.getElement().innerHTML=this.computeTooltipInnerHTML(ie),this.shouldShowTooltip(ie)&&this.map.ol.addOverlay(ie)}computeTooltipInnerHTML(ie){const he=ie.getProperties();return(0,N.os)(he._measure,{decimal:1,unit:he._unit,unitAbbr:!0,locale:"fr"},this.languageService)}shouldShowTooltip(ie){if(!1===this.showTooltips)return!1;const he=ie.getProperties(),$e=he._measure;if(void 0===$e)return!1;if(he._unit===U.H_.Length){const Ae=(0,N.SI)(this.minSegmentLength,he._unit)||0;return $e>Math.max(Ae,0)}return!0}saveCurrentUnits(){this.storageService.set("distanceUnit",this.activeLengthUnit,v.YM.SESSION),this.storageService.set("areaUnit",this.activeAreaUnit,v.YM.SESSION)}getSavedUnits(){const ie=this.storageService.get("distanceUnit"),he=this.storageService.get("areaUnit");this.activeLengthUnit=ie||this.activeLengthUnit,this.activeAreaUnit=he||this.activeAreaUnit}static \u0275fac=function(he){return new(he||Ie)(g.rXU(R.gw),g.rXU(W.bZ),g.rXU(v.n$),g.rXU(M.qQ))};static \u0275cmp=g.VBU({type:Ie,selectors:[["igo-measurer"]],viewQuery:function(he,$e){if(1&he&&g.GBs(Q,7),2&he){let Ae;g.mGM(Ae=g.lsd())&&($e.table=Ae.first)}},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},standalone:!0,features:[g.aNF],decls:43,vars:60,consts:[["table",""],[1,"measure-type-toggle","mat-typography"],[3,"change","value"],[3,"value"],[1,"measure-options","mat-typography"],[3,"change","disabled","checked","labelPosition"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"change","checked","labelPosition"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureUnitChange","measureType","measureUnit","measure","auto","placeholder"],["mat-icon-button","","color","accent",3,"click","matTooltip","disabled"],["mat-icon-button","","color","warn",3,"click","matTooltip","disabled"]],template:function(he,$e){if(1&he){const Ae=g.RV6();g.j41(0,"div")(1,"div",1)(2,"mat-button-toggle-group",2),g.bIt("change",function(Ge){return g.eBV(Ae),g.Njj($e.onMeasureTypeChange(Ge.value))}),g.j41(3,"mat-button-toggle",3),g.EFF(4),g.nI1(5,"translate"),g.k0s(),g.j41(6,"mat-button-toggle",3),g.EFF(7),g.nI1(8,"translate"),g.k0s()()(),g.j41(9,"div",4)(10,"mat-slide-toggle",5),g.bIt("change",function(Ge){return g.eBV(Ae),g.Njj($e.onToggleDrawControl(Ge.checked))}),g.EFF(11),g.nI1(12,"translate"),g.k0s(),g.DNE(13,ae,1,0,"mat-divider",6),g.nI1(14,"async"),g.DNE(15,ye,3,5,"mat-slide-toggle",7),g.nI1(16,"async"),g.DNE(17,de,1,0,"mat-divider",6),g.nI1(18,"async"),g.nI1(19,"async"),g.DNE(20,ue,3,5,"mat-slide-toggle",7),g.nI1(21,"async"),g.DNE(22,ce,3,5,"mat-slide-toggle",7),g.nI1(23,"async"),g.DNE(24,re,1,0,"mat-divider",6),g.nI1(25,"async"),g.j41(26,"mat-slide-toggle",8),g.bIt("change",function(Ge){return g.eBV(Ae),g.Njj($e.onToggleMeasureUnitsAuto(Ge.checked))}),g.EFF(27),g.nI1(28,"translate"),g.k0s()(),g.DNE(29,Le,3,2,"ng-container",6),g.nI1(30,"async"),g.DNE(31,We,1,0,"mat-divider",6),g.nI1(32,"async"),g.nI1(33,"async"),g.j41(34,"div",9),g.DNE(35,Xe,5,6,"button",10),g.nI1(36,"async"),g.nI1(37,"async"),g.DNE(38,Be,5,6,"button",11),g.nI1(39,"async"),g.nI1(40,"async"),g.k0s(),g.nrm(41,"igo-entity-table",12,0),g.k0s()}2&he&&(g.R7$(2),g.Y8G("value",$e.activeMeasureType),g.R7$(),g.Y8G("value",$e.measureType.Length),g.R7$(),g.SpI(" ",g.bMT(5,24,"igo.geo.measure."+$e.measureType.Length)," "),g.R7$(2),g.Y8G("value",$e.measureType.Area),g.R7$(),g.SpI(" ",g.bMT(8,26,"igo.geo.measure."+$e.measureType.Area)," "),g.R7$(3),g.Y8G("disabled",$e.drawControlIsDisabled)("checked",$e.drawControlIsActive)("labelPosition","before"),g.R7$(),g.SpI(" ",g.bMT(12,28,"igo.geo.measure.toggleActive")," "),g.R7$(2),g.Y8G("ngIf",g.bMT(14,30,$e.hasLine$)),g.R7$(2),g.Y8G("ngIf",g.bMT(16,32,$e.hasLine$)),g.R7$(2),g.Y8G("ngIf",g.bMT(18,34,$e.hasLine$)||g.bMT(19,36,$e.hasArea$)),g.R7$(3),g.Y8G("ngIf",g.bMT(21,38,$e.hasArea$)),g.R7$(2),g.Y8G("ngIf",g.bMT(23,40,$e.hasArea$)),g.R7$(2),g.Y8G("ngIf",g.bMT(25,42,$e.hasArea$)),g.R7$(2),g.Y8G("checked",$e.measureUnitsAuto)("labelPosition","before"),g.R7$(),g.SpI(" ",g.bMT(28,44,"igo.geo.measure.toggleAutoUnits")," "),g.R7$(2),g.Y8G("ngIf",g.bMT(30,46,$e.measure$)),g.R7$(2),g.Y8G("ngIf",g.bMT(32,48,$e.hasLine$)||g.bMT(33,50,$e.hasArea$)),g.R7$(4),g.Y8G("ngIf",g.bMT(36,52,$e.hasLine$)||g.bMT(37,54,$e.hasArea$)),g.R7$(3),g.Y8G("ngIf",g.bMT(39,56,$e.hasLine$)||g.bMT(40,58,$e.hasArea$)),g.R7$(3),g.Y8G("store",$e.store)("template",$e.tableTemplate))},dependencies:[F.Vg,F.ec,F.pc,c.mV,c.sG,M.bT,p.w,p.q,z,a.Hl,a.iY,o.uc,o.oV,e.m_,e.An,L.f7,M.Jj,R.Ck,u.D9],styles:["[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   .igo-map-tooltip[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:4px 8px;white-space:nowrap}  .igo-map-tooltip-hidden, .igo-map-tooltip-measure-by-display[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}return Ie})()},83019:(De,le,r)=>{"use strict";r.d(le,{$R:()=>M.$R,JM:()=>a.JM,RE:()=>a.i2,Sg:()=>a.Sg,mc:()=>a.mc,os:()=>a.os});var M=r(28440),a=r(71480)},28440:(De,le,r)=>{"use strict";r.d(le,{$R:()=>F,H_:()=>a,M3:()=>c,i2:()=>e,tC:()=>p});var a=function(o){return o.Length="length",o.Area="area",o}(a||{}),F=function(o){return o.Meters="meters",o.Kilometers="kilometers",o.Miles="miles",o.Feet="feet",o}(F||{});const p={[F.Meters]:"m",[F.Kilometers]:"km",[F.Miles]:"mi",[F.Feet]:"ft"};var e=function(o){return o.SquareMeters="squareMeters",o.SquareKilometers="squareKilometers",o.SquareMiles="squareMiles",o.SquareFeet="squareFeet",o.Hectares="hectares",o.Acres="acres",o}(e||{});const c={[e.SquareMeters]:"m\xb2",[e.SquareKilometers]:"km\xb2",[e.SquareMiles]:"mi\xb2",[e.SquareFeet]:"ft\xb2",[e.Hectares]:"ha",[e.Acres]:"ac"}},71480:(De,le,r)=>{"use strict";r.d(le,{AS:()=>Q,JM:()=>ye,SI:()=>Z,Sg:()=>P,UO:()=>N,dN:()=>G,i2:()=>j,iN:()=>A,j5:()=>O,jg:()=>E,mc:()=>u,os:()=>U,t_:()=>g,x3:()=>W});var M=r(19061),a=r(84505),F=r(29100),p=r(76983),e=r(49964),c=r(93812),o=r(78292),L=r(29814),R=r(1963),v=r(18194),y=r(61099),b=r(28440);function k(ue){return.001*ue}function _(ue){return 3.2808*ue}function D(ue){return 621e-6*ue}function h(ue){return 1e-6*ue}function X(ue){return 3.861e-7*ue}function H(ue){return 10.764*ue}function x(ue){return 1e-4*ue}function ee(ue){return 24711e-8*ue}function Z(ue,ce){const be=new Map([[b.$R.Meters,_e=>_e],[b.$R.Kilometers,k],[b.$R.Miles,D],[b.$R.Feet,_]]).get(ce);return be?be(ue):void 0}function G(ue,ce){const be=new Map([[b.i2.SquareMeters,_e=>_e],[b.i2.SquareKilometers,h],[b.i2.SquareMiles,X],[b.i2.SquareFeet,H],[b.i2.Hectares,x],[b.i2.Acres,ee]]).get(ce);return be?be(ue):void 0}function U(ue,ce,re){let be=ce.decimal;(void 0===be||be<0)&&(be=1);const _e=[];return _e.push(void 0!==ce.locale?ue.toLocaleString(ce.locale,{minimumFractionDigits:be,maximumFractionDigits:be}):ue.toFixed(be).toString()),void 0!==ce.unit&&!0===ce.unitAbbr&&_e.push(re?re.translate.instant(b.tC[ce.unit]?"igo.geo.measure."+b.tC[ce.unit]:"igo.geo.measure."+b.M3[ce.unit]):b.tC[ce.unit]||b.M3[ce.unit]),_e.filter(Le=>void 0!==Le).join(" ")}function N(ue){let ce=b.$R.Meters,re=ue;const be=[b.$R.Kilometers];for(;re>1e3&&be.length>0;)ce=be.pop(),re=Z(ue,ce);return ce}function W(ue){let ce=b.i2.SquareMeters,re=ue;const be=[b.i2.SquareKilometers];for(;re>1e6&&be.length>0;)ce=be.pop(),re=G(ue,ce);return ce}function A(){return new L.Ay({stroke:new R.A({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new v.A({color:"rgba(255, 255, 255, 0.2)"}),image:new y.A({radius:5,stroke:new R.A({color:"#ffcc33"}),fill:new v.A({color:"rgba(255, 255, 255, 0.2)"})})})}function g(){return new L.Ay({stroke:new R.A({color:"#ffcc33",width:2}),fill:new v.A({color:"rgba(255, 255, 255, 0.2)"})})}function u(ue,ce){if(!(ue instanceof e.A)&&0!==ue.getFlatCoordinates().length)return(0,o.R3)(ue,{projection:ce})}function O(ue,ce){if(!(ue instanceof e.A||ue instanceof p.A)&&0!==ue.getFlatCoordinates().length)return(0,o.UG)(ue,{projection:ce})}function j(ue,ce){const re=u(ue,ce),be=O(ue,ce),_e=[],Le=ue.getFlatCoordinates(),We=Le.length;for(let Xe=0;Xe<=We-4;Xe+=2){const Be=new p.A([[Le[Xe],Le[Xe+1]],[Le[Xe+2],Le[Xe+3]]]);_e.push(u(Be,ce))}return{area:be,length:re,lengths:_e}}function P(ue){let ce;if(ue instanceof e.A){const re=new e.A(ue.getFlatCoordinates());ce=new Array(1),ce[0]=re}else{ce=w(ue);const re=ue.getFlatCoordinates(),be=ce.length;for(let _e=0;_e<be;_e++){const Le=2*_e,Xe=new p.A([[re[Le],re[Le+1]],[re[Le+2],re[Le+3]]]).getCoordinateAt(.5),Be=ce[_e];void 0!==Be?Be.setCoordinates(Xe):ce[_e]=new e.A(Xe)}}return ce}function w(ue){let ce;ce=ue instanceof F.A?0:Math.max(ue.getFlatCoordinates().length/2-1,0);let re=ue.get("_midpoints");if(void 0===re)return re=new Array(ue instanceof e.A?1:ce),ue.set("_midpoints",re,!0),re;if(0===ce||ce===re.length)return re;if(ce>re.length)return re.push(...new Array(ce-re.length)),re;for(let be=ce;be<re.length;be++){const _e=re[ce];void 0!==_e&&I(_e)}return re.splice(ce),re}function I(ue){const ce=ue.get("_tooltip");if(void 0!==ce){const re=ce.getMap();void 0!==re&&re.removeOverlay(ce)}}function E(ue){const ce=P(ue);let re="";return ue instanceof p.A?re="line-":ue instanceof c.Ay&&(re="polygone-"),ce.map(_e=>{let Le=_e.get("_tooltip");return void 0===Le?Le=de(_e,!1,re):Le.setPosition(_e.getFlatCoordinates()),Le})}function Q(ue){const ce=function z(ue){let ce=ue.get("_center");const re=(0,a.q1)(ue.getExtent());return void 0!==ce?ce.setCoordinates(re):(ce=new e.A(re),ue.set("_center",ce)),ce}(ue);let re=ce.get("_tooltip");return void 0===re?re=de(ce,!0):re.setPosition(ce.getFlatCoordinates()),re}function ye(ue){const ce=[].concat(function s(ue){return w(ue).map(re=>re?re.get("_tooltip"):void 0)}(ue)||[]),re=function ae(ue){const ce=ue.get("_center");return ce?ce.get("_tooltip"):void 0}(ue);return void 0!==re&&ce.push(re),ce}function de(ue,ce=!1,re=""){const be=new M.A({element:document.createElement("div"),offset:[-30,-10],className:(ce?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure",`igo-map-tooltip-measure-${re}segments`]).join(" "),stopEvent:!1});return be.setPosition(ue.getFlatCoordinates()),ue.set("_tooltip",be),be}},63353:(De,le,r)=>{"use strict";r.d(le,{z:()=>M});var M=function(a){return a.System="system",a.User="user",a}(M||{})},77320:(De,le,r)=>{"use strict";r.d(le,{d:()=>v});var M=r(68671),a=r(51307),F=r(84205),p=r(59452),e=r(2435),c=r(51903),o=r(70271),L=r(64334),R=r(68559);let v=(()=>{class y{ngxIndexedDBService;dbName="geoData";collisionsMap=new Map;_newData=0;compression=new M.Pr;constructor(k){this.ngxIndexedDBService=k}update(k,_,D,h,X){if(!D)return;let H=!1;const x=new F.B;let Z,ee=(0,p.of)(D);return D instanceof Blob&&(ee=this.compression.compressBlob(D),H=!0),ee.pipe((0,e.$)(),(0,c.H)(G=>(Z={url:k,regionID:_,object:G,compressed:H,insertSource:h,insertEvent:X},this.ngxIndexedDBService.getByID(this.dbName,k))),(0,c.H)(G=>{if(G){const U=G.regionID;if(U!==_){const N=this.collisionsMap.get(U);void 0!==N?(N.push(G.url),this.collisionsMap.set(U,N)):this.collisionsMap.set(U,[G.url])}return this.customUpdate(Z)}return this._newData++,this.ngxIndexedDBService.add(this.dbName,Z)})).subscribe(G=>{x.next(G),x.complete()}),x}customUpdate(k){const _=new F.B;return this.ngxIndexedDBService.deleteByKey(this.dbName,k.url).pipe((0,c.H)(h=>h?this.ngxIndexedDBService.add(this.dbName,k):(0,p.of)(void 0))).subscribe(h=>{h&&_.next(h),_.complete()}),_}get(k){return this.ngxIndexedDBService.getByID(this.dbName,k).pipe((0,o.T)(_=>{if(_){const D=_.object;return _.compressed?this.compression.decompressBlob(D):D}}))}getByID(k){return this.ngxIndexedDBService.getByID(this.dbName,k)}deleteByKey(k){return this.ngxIndexedDBService.deleteByKey(this.dbName,k)}getRegionCountByID(k){const _=new F.B;return this.getRegionByID(k).subscribe(h=>{_.next(h.length),_.complete()}),_}getRegionByID(k){if(!k)return;const _=IDBKeyRange.only(k);return this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",_)}deleteByRegionID(k){if(!k)return;const _=IDBKeyRange.only(k),D=this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",_);return D.subscribe(h=>{h.forEach(X=>{this.ngxIndexedDBService.deleteByKey(this.dbName,X.url)})}),D}openCursor(k=IDBKeyRange.lowerBound(0),_=a.Go.readonly){return this.ngxIndexedDBService.openCursorByIndex(this.dbName,"regionID",k,_)}resetCounters(){this.resetCollisionsMap(),this._newData=0}resetCollisionsMap(){this.collisionsMap=new Map}revertCollisions(){for(const[k,_]of this.collisionsMap)for(const D of _)this.ngxIndexedDBService.getByKey(this.dbName,D).pipe((0,L.s)(1)).subscribe(h=>{h.regionID=k,this.customUpdate(h)})}get newData(){return this._newData}static \u0275fac=function(_){return new(_||y)(R.KVO(a.MX))};static \u0275prov=R.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}return y})()},8781:(De,le,r)=>{"use strict";r.d(le,{x:()=>c});var M=r(69576),a=r(77320),F=r(68559),p=r(46443);let c=(()=>{class o{http;geoDBService;networkService;networkOnline=!0;constructor(R,v,y){this.http=R,this.geoDBService=v,this.networkService=y,this.networkService.currentState().subscribe(b=>{this.networkOnline=b.connection})}get(R,v){return window.navigator.onLine&&this.networkOnline?this.getOnline(R,v):this.getOffline(R)}getOnline(R,v){let y;switch(v.responseType){case"arraybuffer":y=this.http.get(R,{responseType:"arraybuffer",withCredentials:v.withCredentials});break;case"text":y=this.http.get(R,{responseType:"text",withCredentials:v.withCredentials});break;case"json":y=this.http.get(R,{responseType:"json",withCredentials:v.withCredentials});break;default:y=this.http.get(R,{responseType:"blob",withCredentials:v.withCredentials})}return y}getOffline(R){return this.geoDBService.get(R)}isOnline(){return this.networkOnline&&window.navigator.onLine}static \u0275fac=function(v){return new(v||o)(F.KVO(p.Qq),F.KVO(a.d),F.KVO(M.A))};static \u0275prov=F.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},25771:(De,le,r)=>{"use strict";r.d(le,{h:()=>F});var M=r(44295),a=r(1928);class F{map;layer;get dataSource(){return this.layer.dataSource}constructor(e){this.layer=(0,a.E)(),this.setMap(e)}setMap(e){void 0===e?void 0!==this.map&&this.map.ol.removeLayer(this.layer.ol):e.ol.addLayer(this.layer.ol),this.map=e}setFeatures(e,c=M.Bl.Default,o){if(o)for(const L of this.dataSource.ol.getFeatures())L.get("_sourceId")===o&&this.removeOlFeature(L);else this.clear();this.addFeatures(e,c)}addFeature(e,c=M.Bl.Default){this.addFeatures([e],c)}addFeatures(e,c=M.Bl.Default){const o=[];e.forEach(L=>{const R=(0,M.xH)(L,this.map.projection);null!==R.getGeometry()&&o.push(R)}),this.addOlFeatures(o,c)}addOlFeature(e,c=M.Bl.Default){this.addOlFeatures([e],c)}addOlFeatures(e,c=M.Bl.Default){this.dataSource.ol.addFeatures(e),(0,M.p6)(this.map.viewController,e,c)}removeFeature(e){this.removeFeatures([e])}removeFeatures(e){e.forEach(c=>{c.meta&&this.dataSource.ol.getFeatureById(c.meta.id)&&this.removeOlFeature(this.dataSource.ol.getFeatureById(c.meta.id))})}removeOlFeature(e){this.dataSource.ol.removeFeature(e)}clear(){this.dataSource.ol.clear()}}},1928:(De,le,r)=>{"use strict";r.d(le,{E:()=>p});var M=r(91020),a=r(91640),F=r(31736);function p(){const e=new M._k;return new a.v({title:"Overlay",zIndex:300,source:e,style:(0,F.Z)()})}},3674:(De,le,r)=>{"use strict";r.d(le,{B:()=>W});var M=r(89204),a=r(60316),F=r(59912),p=r(67778),e=r(67143),c=r(21701),o=r(1455),L=r(68671),R=r(85841),v=r(60822),y=r.n(v),b=r(38158),k=r(45834),_=r.n(k),D=r(84205),h=r(43942),X=r(61873),H=r(70271),ee=r(64004);function Z(A){const g=function(u,O){const j=u.join(" "),P=O[0],Y=O[2],w=O[1],I=O[3],E=[I,P,w,P,w,Y,I,Y].join(" "),s=this.internal.newAdditionalObject(),z=this.internal.newAdditionalObject(),Q=this.internal.newAdditionalObject();Q.content='<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.017453292519943295]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",0.0],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]) >>',z.content="<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS "+Q.objId+" 0 R /GPTS [ "+E+" ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>",s.content="<< /BBox [ "+j+" ] /Measure "+z.objId+" 0 R /Name (Layer) /Type /Viewport >>";const ae=this.internal.newAdditionalObject(),ye=(new Date).toLocaleDateString("en-CA");return ae.content="<< /Name IGO2 /Type /OCG /Date "+ye+" >>",s.objId};A.setGeoArea=function(u,O){this.internal.events.subscribe("putPage",function(){const j=g.call(this,u,O);this.internal.write("/VP [ "+j+" 0 R ]")})}}var G=r(9799),U=r(68559),N=r(46443);let W=(()=>{class A{http;messageService;activityService;languageService;configService;document;zipFile;nbFileToProcess;activityId;mapPrintExtent;imgSizeAdded;TEXTPDFFONT={titleFont:"times",titleFontStyle:"bold",subtitleFont:"times",subtitleFontStyle:"bold",commentFont:"times",commentFontStyle:"normal",commentFontSize:12};constructor(u,O,j,P,Y,w){this.http=u,this.messageService=O,this.activityService=j,this.languageService=P,this.configService=Y,this.document=w}print(u,O){var j=this;const P=new D.B,Y=O.paperFormat,w=+O.resolution,I=O.orientation,E=O.legendPosition;this.activityId=this.activityService.register(),Z(b.default.API);const s=new b.default({orientation:I,format:Y.toLowerCase(),unit:"mm"}),{width:z,height:Q}=s.internal.pageSize,ae=[10,10,10,10];let ye,de;(""!==O.title||""!==O.subtitle)&&(Y===G.VA.A1||Y===G.VA.A0)&&(ae[0]+=10);const ue=Math.round(2*(Q+145)*.05)/2;return void 0!==O.title&&""!==O.title&&(ye=this.getTextPdfObjectSizeAndMarg(O.title,ae,this.TEXTPDFFONT.titleFont,ue,this.TEXTPDFFONT.titleFontStyle,s),this.addTextInPdfDoc(s,O.title,this.TEXTPDFFONT.titleFont,this.TEXTPDFFONT.titleFontStyle,ye.fontSize,ye.marginLeft+ae[3],ae[0]),ae[0]=ye.height+ae[0]),void 0!==O.subtitle&&""!==O.subtitle&&(de=this.getTextPdfObjectSizeAndMarg(O.subtitle,ae,this.TEXTPDFFONT.subtitleFont,""!==O.title?.7*ye.fontSize:.7*ue,this.TEXTPDFFONT.subtitleFontStyle,s),this.addTextInPdfDoc(s,O.subtitle,this.TEXTPDFFONT.subtitleFont,this.TEXTPDFFONT.subtitleFontStyle,de.fontSize,de.marginLeft+ae[3],ae[0]),ae[0]+=5),void 0!==O.comment&&""!==O.comment&&this.addComment(s,O.comment,ae,5),this.handleFooter(u,s,O,w,5,ae),this.addMap(s,u,w,[z-ae[3]-ae[1],Q-ae[0]-ae[2]],ae,E).subscribe(function(){var Le=(0,M.A)(function*(We){if(We===L.Bi.Done){const Xe=j.imgSizeAdded[0];if(j.addGeoRef(s,u,Xe,j.imgSizeAdded[1],ae),yield j.handleMeasureLayer(s,u,ae),O.showNorthArrow){const rt=yield j.createNorthDirectionArrow(u.viewController.getRotation());yield j.addNorthArrowInDoc(s,rt,ae,E,Xe)}"none"!==O.legendPosition?["topleft","topright","bottomleft","bottomright"].indexOf(O.legendPosition)>-1?yield j.addLegendSamePage(s,u,ae,w,O.legendPosition):"newpage"===O.legendPosition&&(yield j.addLegend(s,u,ae,w)):yield j.saveDoc(s)}(We===L.Bi.Done||We===L.Bi.Error)&&(j.activityService.unregister(j.activityId),P.next(L.Bi.Done))});return function(We){return Le.apply(this,arguments)}}()),P}addGeoRef(u,O,j,P,Y){const I=u.internal.pageSize.getHeight(),E=Y[3],s=I-Y[0]-P;let z=[E,s,E+j,s+P];for(let Q=0;Q<z.length;Q++)z[Q]=this.pdf_units2points(z[Q],"mm");u.setGeoArea(z,this.mapPrintExtent)}handleMeasureLayer(u,O,j){var P=this;return(0,M.A)(function*(){if(O.layers.find(Y=>Y.visible&&Y.id.startsWith("igo-measures-"))){let Y;const w=O.ol.getOverlayContainer();yield y()(w,{scale:1,backgroundColor:null}).then(I=>{Y=I}),P.addCanvas(u,Y,j)}})()}getLayersLegendHtml(u,O,j){return new h.c(P=>{let Y="";const w=function x(A,g){const u=[];for(const O of A){const j=O.options.legendOptions;if(!1===O.visible)continue;const P=O.dataSource.getLegend(void 0,g)||[];for(const Y of P)void 0!==Y.url&&u.push({title:O.title||"",url:Y.url,display:void 0===j?.display||j.display,isInResolutionsRange:O.isInResolutionsRange})}return u}(u.layers,{resolution:u.viewController.getResolution(),extent:u.viewController.getExtent(),projection:u.viewController.getOlProjection().getCode(),size:u.ol.getSize()});if(0===w.filter(E=>!0===E.display).length)return P.next(Y),void P.complete();Y+='<style media="screen" type="text/css">',Y+=".html2canvas-container { width: "+O+"mm !important; height: 2000px !important; }",Y+="table.tableLegend {table-layout: auto;}",Y+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",Y+="</style>",Y+='<font size="3" face="Times" >',Y+='<div class="styleLegend">',Y+='<table class="tableLegend" >';const I=w.filter(E=>E.display&&!0===E.isInResolutionsRange).map(E=>this.getDataImage(E.url).pipe((0,H.T)(s=>{let z="<tr><td>"+E.title.toUpperCase()+"</td></tr>";return z+='<tr><td><img src="'+s+'"></td></tr>',z})));(0,X.p)(I).subscribe(E=>{Y=E.reduce((s,z)=>s+z,Y),Y+="</table>",Y+="</div>",P.next(Y),P.complete()})})}getDataImage(u){return new F.V2(this.http,this.configService).transform(u)}getLayersLegendImage(u,O="png",j,P){var Y=this;return(0,M.A)(function*(){const w=new D.B;let E=yield Y.getLayersLegendHtml(u,200,P).toPromise();O=O.toLowerCase(),0===E.length&&(E='<font size="12" face="Courier New" >',E+='<div align="center"><b>NO LEGEND</b></div>');const s=window.document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.zIndex="-1",window.document.body.appendChild(s),s.innerHTML=E,yield Y.timeout(1);const z=yield y()(s,{useCORS:!0}).catch(Q=>{console.log(Q)});if(Y.removeHtmlElement(s),z){let Q=L.Bi.Done;try{j?Y.generateCanvaFileToZip(z,"legendImage."+O):Y.saveCanvasImageAsFile(z,"legendImage",O)}catch{Q=L.Bi.Error}w.next(Q)}return w})()}removeHtmlElement(u){u.parentNode.removeChild(u)}getTextPdfObjectSizeAndMarg(u,O,j,P,Y,w){const s=w.internal.pageSize.getWidth()-O[1]-O[3];w.setFont(j,Y),w.setFontSize(P);let Q,z=w.getTextDimensions(u);return z.w>s?(Q=0,w.setFontSize(P*=.7),z=w.getTextDimensions(u)):Q=(s-z.w)/2,{fontSize:P,marginLeft:Q,height:z.h}}addComment(u,O,j,P){j[2]+=P,this.addTextInPdfDoc(u,O,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,j[3],u.internal.pageSize.height-j[2]+P,!0)}addTextInPdfDoc(u,O,j,P,Y,w,I,E=!1){u.setFont(j,P),u.setFontSize(Y),E&&(O=u.splitTextToSize(O,u.internal.pageSize.getWidth()-3*w)),u.text(O,w,I)}handleFooter(u,O,j,P,Y,w){var I=this;return(0,M.A)(function*(){let E="";const s=I.getAttributionText(u);s&&(E+=s+". "),(!0===j.showProjection||!0===j.showScale)&&(E+=I.getProjScale(u,j,P)),E&&(w[2]+=Y),I.addTextInPdfDoc(O,E,I.TEXTPDFFONT.commentFont,I.TEXTPDFFONT.commentFontStyle,I.TEXTPDFFONT.commentFontSize,w[3],O.internal.pageSize.height-w[2]+Y)})()}getAttributionText(u){const j=u.ol.getOverlayContainerStopEvent().getElementsByClassName("ol-attribution")[0].cloneNode(!0);return j.getElementsByTagName("button")[0].remove(),j.innerText}getProjScale(u,O,j){const P=this.languageService.translate;let Y="";if(!0===O.showProjection&&(Y+=P.instant("igo.geo.printForm.projection")+": "+u.projection),!0===O.showScale){!0===O.showProjection&&(Y+="   ");const w=P.instant("igo.geo.printForm.scale"),I=u.viewController.getScale(j);Y+=w+": ~ 1 / "+(0,ee.A1)(I)}return Y}addLegend(u,O,j,P){var Y=this;return(0,M.A)(function*(){const w=u.internal.pageSize.width,I=yield Y.getLayersLegendHtml(O,w,P).toPromise();if(""===I)return yield Y.saveDoc(u),!0;const E=window.document.createElement("div");E.style.position="absolute",E.style.top="0",E.style.zIndex="-1",window.document.body.appendChild(E),E.innerHTML=I,yield Y.timeout(1);const s=yield y()(E,{useCORS:!0}).catch(z=>{console.log(z)});if(Y.removeHtmlElement(E),s){const Q=[25.4*s.width*.85/P,25.4*s.height*.85/P];let ae;u.addPage(),ae=s.toDataURL("image/png"),u.addImage(ae,"PNG",10,10,Q[0],Q[1])}yield Y.saveDoc(u)})()}addLegendSamePage(u,O,j,P,Y){var w=this;return(0,M.A)(function*(){const I=u.internal.pageSize.width,E=yield w.getLayersLegendHtml(O,I,P).toPromise();if(""===E)return yield w.saveDoc(u),!0;const s=window.document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.zIndex="-1",window.document.body.appendChild(s),s.innerHTML=E,yield w.timeout(1);const z=yield y()(s,{useCORS:!0}).catch(ae=>{console.log(ae)});let Q;if(w.removeHtmlElement(s),z){const ye=[25.4*z.width*.85/P,25.4*z.height*.85/P];"bottomright"===Y?Q=[u.internal.pageSize.height-j[2]-ye[1],j[1],j[2],u.internal.pageSize.width-j[1]-ye[0]]:"topright"===Y?Q=[j[0],j[1],u.internal.pageSize.height-j[0]-ye[1],u.internal.pageSize.width-j[1]-ye[0]]:"bottomleft"===Y?Q=[u.internal.pageSize.height-j[2]-ye[1],u.internal.pageSize.width-j[3]-ye[0],j[2],j[3]]:"topleft"===Y&&(Q=[j[0],u.internal.pageSize.width-j[3]-ye[0],u.internal.pageSize.height-j[0]-ye[1],j[3]]),w.addCanvas(u,z,Q),yield w.saveDoc(u)}})()}defineNbFileToProcess(u){this.nbFileToProcess=u}timeout(u){return new Promise(O=>setTimeout(O,u))}addCanvas(u,O,j){let P;if(O&&(P=O.toDataURL("image/png")),void 0!==P){if(P.length<20)return void console.log("Warning: An image cannot be print in pdf file");const Y=this.getImageSizeToFitPdf(u,O,j);u.addImage(P,"PNG",j[3],j[0],Y[0],Y[1]),u.rect(j[3],j[0],Y[0],Y[1]),this.imgSizeAdded=Y}}addMap(u,O,j,P,Y,w){var I=this;const E=O.ol.getSize(),s=O.ol.getView().getResolution(),z=this.setMapResolution(O,P,j,s),Q=new D.B;let ae;return O.ol.once("rendercomplete",function(){var ye=(0,M.A)(function*(de){const ue=de.target.getViewport().getElementsByTagName("canvas"),ce=yield I.drawMap(z,ue);I.mapPrintExtent=O.viewController.getExtent("EPSG:3857"),I.resetOriginalMapSize(O,E,s),yield I.drawMapControls(O,ce,w);const re=O.status$.subscribe(be=>{if(clearTimeout(ae),be!==L.Bi.Done)return;re.unsubscribe();let _e=L.Bi.Done;try{0!==ce.width&&I.addCanvas(u,ce,Y)}catch{_e=L.Bi.Error,I.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}Q.next(_e)});ae=window.setTimeout(()=>{re.unsubscribe();let be=L.Bi.Done;try{0!==ce.width&&I.addCanvas(u,ce,Y)}catch{be=L.Bi.Error,I.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}I.resetOriginalMapSize(O,E,s),Q.next(be)},200)});return function(de){return ye.apply(this,arguments)}}()),Q}setMapResolution(u,O,j,P){const Y=u.ol.getSize(),w=Math.round(O[0]*j/25.4),I=Math.round(O[1]*j/25.4);u.ol.setSize([w,I]);const s=Math.min(w/Y[0],I/Y[1]);return u.ol.getView().setResolution(P/s),[w,I]}resetOriginalMapSize(u,O,j){u.ol.setSize(O),u.ol.getView().setResolution(j),u.ol.updateSize(),u.ol.renderSync()}drawMap(u,O){var j=this;return(0,M.A)(function*(){const P=document.createElement("canvas");P.width=u[0],P.height=u[1];for(let Y=0;Y<O.length;Y++){const w=O[Y];w.width>0&&j.handleCanvas(w,P)}return P})()}handleCanvas(u,O){const j=O.getContext("2d"),P=u.parentElement.style.opacity||u.style.opacity;j.globalAlpha=""===P?1:Number(P);const Y=u.style.transform;let w;w=Y?Y.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number):[parseFloat(u.style.width)/u.width,0,0,parseFloat(u.style.height)/u.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(j,w);const I=u.parentElement.style.backgroundColor;I&&(j.fillStyle=I,j.fillRect(0,0,u.width,u.height)),j.drawImage(u,0,0),j.globalAlpha=1,j.setTransform(1,0,0,1,0,0)}drawMapControls(u,O,j){return(0,M.A)(function*(){const P=O.getContext("2d"),Y=u.ol.getOverlayContainerStopEvent().cloneNode(!0);Y.style.width=O.width+"px",Y.style.height=O.height+"px",Y.style.zIndex="-1",document.getElementsByClassName("ol-viewport")[0].appendChild(Y);const w=yield y()(Y,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0,ignoreElements:I=>I instanceof HTMLElement&&I.className.includes("ol-attribution")});0!==w.width&&0!==w.height&&P.drawImage(w,0,0),Y.remove()})()}addNorthArrowInDoc(u,O,j,P,Y,w=0){return(0,M.A)(function*(){let I=0,E=0;u instanceof CanvasRenderingContext2D?(E=50,I="topright"===P?0:Y-E,u.drawImage(O,I,w,E,E)):(E=16,I="topright"===P?10:Y-j[1],w=j[0],u.addImage(O.toDataURL(),I,w,E,E))})()}createNorthDirectionArrow(u){var O=this;return(0,M.A)(function*(){const j=O.document.createElement("div");j.style.maxWidth="50mm",j.style.maxHeight="50mm",j.style.textAlign="center";const P=O.document.createElement("img");P.src="./assets/igo2/geo/images/north-direction.png",P.style.maxWidth="50mm",P.style.maxHeight="50mm",P.style.transform="rotate("+u+"rad)",P.style.padding="5mm",j.appendChild(P),O.document.body.appendChild(j);const Y=yield y()(j,{backgroundColor:null});if(O.removeHtmlElement(j),Y)return Y})()}downloadMapImage(u,O,j="png",P=!1,Y=!1,w="",I="",E="",s=!0,z,Q){var ae=this;const ye=new D.B;this.activityId=this.activityService.register();const de=this.languageService.translate;j=j.toLowerCase();const ue=+O,ce=u.ol.getSize(),re=u.ol.getView().getResolution();return u.ol.once("rendercomplete",function(){var be=(0,M.A)(function*(_e){const Le=u.ol.getSize(),We=_e.target.getViewport().getElementsByTagName("canvas"),Xe=yield ae.drawMap(Le,We);ae.resetOriginalMapSize(u,ce,re),yield ae.drawMapControls(u,Xe,z),"none"!==z&&(["topleft","topright","bottomleft","bottomright"].indexOf(z)>-1?yield ae.addLegendToImage(Xe,u,ue,z,j):"newpage"===z&&(yield ae.getLayersLegendImage(u,j,s,ue)));const Be=document.createElement("canvas"),rt=Be.getContext("2d");let Ie=0;const Ve=Xe.width;let ie=Xe.height;rt.font="20px Calibri";const he=rt.measureText(E).width;ie=""!==w?ie+30:ie,ie=""!==I?ie+30:ie,ie=!1!==P||!1!==Y?ie+30:ie;const $e=ie-10,Ae=Math.ceil(he/Ve);ie=""!==E?ie+30*Ae:ie;let Qe=ie-20*Ae+5;if(Be.width=Ve,Be.height=ie,["bmp","gif","jpeg","png","tiff"].indexOf(j)>-1&&("jpeg"===j||""!==w||""!==I||""!==E||!1!==P||!1!==Y)&&(rt.fillStyle="#ffffff",rt.fillRect(0,0,Ve,ie),rt.fillStyle="#000000"),""!==w&&(rt.font="26px Calibri",Ie=30,rt.textAlign="center",rt.fillText(w,Ve/2,20,.9*Ve)),""!==I&&(rt.font="26px Calibri",Ie=60,rt.textAlign="center",rt.fillText(I,Ve/2,50,.9*Ve)),rt.font="20px Calibri",!1!==P||!1!==Y){let Oe="";if(!1!==P&&(Oe=de.instant("igo.geo.printForm.projection")+": "+u.projection+"         "),!1!==Y){const Ye=de.instant("igo.geo.printForm.scale"),ze=u.viewController.getScale(ue);Oe+=Ye+": ~ 1 / "+(0,ee.A1)(ze)}rt.textAlign="center",rt.fillText(Oe,Ve/2,$e,.9*Ve)}if(""!==E)if(rt.textAlign="center",1===Ae)rt.fillText(E,Ve/2,Qe);else{const Ye=Math.floor(E.length/Ae);let jt,ze="",et=0;for(let dt=0;dt<Ae;dt++)Ae-1>dt?(ze=E.substr(et,Ye),jt=ze.lastIndexOf(" "),rt.fillText(ze.substr(0,jt),Ve/2,Qe),et+=jt,Qe+=20):rt.fillText(E.substr(et),Ve/2,Qe)}if(rt.drawImage(Xe,0,Ie),Q){const Oe=yield ae.createNorthDirectionArrow(u.viewController.getRotation());yield ae.addNorthArrowInDoc(rt,Oe,null,z,Ve,Ie)}let Ge=L.Bi.Done,at="map."+j;"tiff"===j.toLowerCase()&&(at="map"+u.projection.replace(":","_")+"."+j);try{s?(j.toLowerCase(),ae.generateCanvaFileToZip(Be,at)):ae.saveCanvasImageAsFile(Be,at,j)}catch{Ge=L.Bi.Error}if(ye.next(Ge),"tiff"===j.toLowerCase()){const Oe=at.substring(0,at.toLowerCase().indexOf(".tiff"))+".tfw",Ye=ae.getWorldFileInformation(u),ze=new Blob([Ye],{type:"text/plain;charset=utf-8"});s?ae.addFileToZip(Oe,ze):((0,R.saveAs)(ze,Oe),ae.saveFileProcessing())}});return function(_e){return be.apply(this,arguments)}}()),this.setMapImageResolution(u,ce,ue,re),ye}setMapImageResolution(u,O,j,P){const Y=j/96,w=[Math.round(O[0]*Y),Math.round(O[1]*Y)];u.ol.setSize(w);const I=Math.min(w[0]/O[0],w[1]/O[1]);u.ol.getView().setResolution(P/I),u.ol.renderSync()}addLegendToImage(u,O,j,P,Y){var w=this;return(0,M.A)(function*(){const I="map."+Y,E=u.getContext("2d"),s=yield w.getLayersLegendHtml(O,u.width,j).toPromise();if(""===s)return yield w.saveCanvasImageAsFile(u,I,Y),!0;const z=window.document.createElement("div");z.style.position="absolute",z.style.top="0",z.style.zIndex="-1",window.document.body.appendChild(z),z.innerHTML=s,yield w.timeout(1);const Q=yield y()(z,{useCORS:!0}).catch(ae=>{console.log(ae)});if(Q){const ae=u.height,ye=u.width,de=Q.height,ue=Q.width,ce=.01*ae;let re,be;return"bottomright"===P?(re=ye-ue-ce,be=ae-de-ce):"topright"===P?(re=ye-ue-ce,be=ce):"bottomleft"===P?(re=ce,be=ae-de-ce-15):"topleft"===P&&(re=ce,be=ce),E.drawImage(Q,re,be,ue,de),E.strokeRect(re,be,ue,de),w.removeHtmlElement(z),!0}})()}renderMap(u,O,j){u.ol.updateSize(),u.ol.renderSync()}saveDoc(u){return(0,M.A)(function*(){yield u.save("map_georef.pdf",{returnPromise:!0})})()}getImageSizeToFitPdf(u,O,j){const P=u.internal.pageSize.getHeight()-(j[0]+j[2]),Y=u.internal.pageSize.getWidth()-(j[1]+j[3]),w=this.pdf_units2points(O.height,"mm"),I=this.pdf_units2points(O.width,"mm"),E=w/P,s=I/Y,z=E>s?E:s;return[z>1?I/z:I,z>1?w/z:w]}getWorldFileInformation(u){const O=u.viewController.getResolution(),j=u.viewController.getExtent();return[O,0,0,-O,j[0]+O/.5,j[3]-O/.5].join("\n")}saveCanvasImageAsFile(u,O,j){const P="image/"+j,Y=this;try{u.toDataURL(),u.toBlob(w=>{(0,R.saveAs)(w,O),Y.saveFileProcessing()},P)}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}generateCanvaFileToZip(u,O){const P=this;(!this.hasOwnProperty("zipFile")||typeof this.zipFile>"u")&&(this.zipFile=new(_()));try{u.toDataURL(),navigator.msSaveBlob?this.addFileToZip(O,u.msToBlob()):u.toBlob(Y=>{P.addFileToZip(O,Y)},"image/jpeg")}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}addFileToZip(u,O){this.zipFile.file(u,O),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))}saveFileProcessing(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)}getZipFile(){const u=this;this.zipFile.generateAsync({type:"blob"}).then(O=>{(0,R.saveAs)(O,"map.zip"),delete u.zipFile})}pdf_units2points(u,O){let j=1;switch(O){case"pt":j=1;break;case"mm":j=72/25.4;break;case"cm":j=72/2.54;break;case"in":j=72;break;case"px":j=96/72;break;case"pc":case"em":j=12;break;case"ex":j=6;break;default:throw new Error("Invalid unit: "+O)}return u*j}static \u0275fac=function(O){return new(O||A)(U.KVO(N.Qq),U.KVO(o.bg),U.KVO(p.Ti),U.KVO(c.gw),U.KVO(e.we),U.KVO(a.qQ))};static \u0275prov=U.jDH({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})()},9799:(De,le,r)=>{"use strict";r.d(le,{JS:()=>c,O9:()=>a,VA:()=>F,e3:()=>e,go:()=>o,y9:()=>p});var M=r(68671);const a=(0,M.Jw)(["Pdf","Image"]),F=(0,M.Jw)(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),p=(0,M.Jw)(["landscape","portrait"]),e=["72","96","150","300"],c=(0,M.Jw)(["Bmp","Gif","Jpeg","Png","Tiff"]),o=(0,M.Jw)(["none","topright","topleft","bottomleft","bottomright","newpage"])},65988:(De,le,r)=>{"use strict";r.d(le,{E:()=>k});var M=r(68559),a=r(12912),F=r(81140),p=r(69243),e=r(59452),c=r(33864),o=r(12393),L=r(91640),R=r(42449),v=r(64004),y=r(74458),b=r(87716);let k=(()=>{class _{component;queryService;queries$$=[];mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;queryFeatures=!1;queryFeaturesHitTolerance=0;queryFeaturesCondition;waitForAllQueries=!0;query=new M.bkB;get map(){return this.component.map}constructor(h,X){this.component=h,this.queryService=X}ngAfterViewInit(){this.listenToMapClick(),this.addDragBoxInteraction()}ngOnDestroy(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",h=>this.onMapEvent(h))}unlistenToMapClick(){(0,a.e)(this.mapClickListener),this.mapClickListener=void 0}onMapEvent(h){if(this.cancelOngoingQueries(),!this.queryService.queryEnabled)return;const X=[];this.queryFeatures&&X.push(this.doQueryFeatures(h));const H=this.map.ol.getView().getResolution(),x=this.map.layers.filter(b.oG);X.push(...this.queryService.query(x,{coordinates:h.coordinate,projection:this.map.projection,resolution:H})),0!==X.length&&(this.waitForAllQueries?this.queries$$.push((0,p.y)(...X).subscribe(ee=>{const Z=[].concat(...ee);this.query.emit({features:Z,event:h})})):this.queries$$=X.map(ee=>ee.subscribe(Z=>{this.query.emit({features:Z,event:h})})))}doQueryFeatures(h){const X=[];if("singleclick"===h.type)this.map.ol.forEachFeatureAtPixel(h.pixel,(H,x)=>{const ee=this.map.getLayerById(x.values_._layer.id);if(!ee.dataSource.options.queryFormatAsWms&&H)if(H.get("features"))for(const Z of H.get("features")){const G=(0,c.M2)(Z,this.map.projection);G.meta={title:Z.values_.nom,id:x.values_._layer.id+"."+Z.id_,icon:Z.values_._icon,sourceTitle:x.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(ee)},X.push(G)}else if(H instanceof F.Ay){const Z=(0,c.Iy)(H,this.map.projection,x);Z.meta={id:x.values_._layer.id+"."+Z.meta.id,sourceTitle:x.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(ee),title:this.queryService.getQueryTitle(Z,ee)||Z.meta.title},X.push(Z)}else{const Z=(0,c.M2)(H,this.map.projection,x);Z.meta={id:x.values_._layer.id+"."+Z.meta.id,sourceTitle:x.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(ee),title:this.queryService.getQueryTitle(Z,ee)||Z.meta.title},X.push(Z)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:b.dG});else if("boxend"===h.type){const x=h.target.getGeometry().getExtent();this.map.layers.filter(b.oG).filter(ee=>ee instanceof L.v&&ee.visible).map(ee=>{ee.dataSource.ol.forEachFeatureIntersectingExtent(x,G=>{const U=(0,c.M2)(G,this.map.projection,ee.ol);U.meta={id:ee.id+"."+G.getId(),icon:G.values_._icon,sourceTitle:ee.title,alias:this.queryService.getAllowedFieldsAndAlias(ee),title:this.queryService.getQueryTitle(U,ee)||U.meta.title},X.push(U)})})}return(0,e.of)(X)}cancelOngoingQueries(){this.queries$$.forEach(h=>h.unsubscribe()),this.queries$$=[]}addDragBoxInteraction(){let h;const X=this.map.ol.getInteractions().getArray();for(const H of X)if(H instanceof o.k){h=H;break}void 0===h&&(h=new o.k({condition:v.hH}),this.map.ol.addInteraction(h),this.olDragSelectInteraction=h),this.olDragSelectInteractionEndKey=h.on("boxend",H=>this.onMapEvent(H))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,a.e)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}static \u0275fac=function(X){return new(X||_)(M.rXU(R.K,2),M.rXU(y.c))};static \u0275dir=M.FsC({type:_,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"},standalone:!0})}return _})()},84547:(De,le,r)=>{"use strict";r.d(le,{DG:()=>F,gv:()=>M,wf:()=>a});var M=function(p){return p.GML2="gml2",p.GML3="gml3",p.JSON="json",p.GEOJSON="geojson",p.GEOJSON2="geojson2",p.ESRIJSON="esrijson",p.TEXT="text",p.HTML="html",p.HTMLGML2="htmlgml2",p}(M||{}),a=function(p){return p.GML2="application/vnd.ogc.gml",p.GML3="application/vnd.ogc.gml/3.1.1",p.JSON="application/json",p.GEOJSON="application/geojson",p.GEOJSON2="geojson",p.ESRIJSON="application/json",p.TEXT="text/plain",p.HTML="text/html",p.HTMLGML2="text/html",p}(a||{}),F=function(p){return p.IFRAME="iframe",p.BLANK="_blank",p}(F||{})},74458:(De,le,r)=>{"use strict";r.d(le,{c:()=>N});var M=r(1455),a=r(68671),F=r(84505),p=r(82418),e=r(34927),c=r(1706),o=r(37923),L=r(16636),R=r(61552),v=r(38713),y=r(49964),b=r(76983),k=r(93812),_=r(59452),D=r(1365),h=r(70271),X=r(44950),H=r.n(X),x=r(91020),ee=r(3439),Z=r(84547),G=r(68559),U=r(46443);let N=(()=>{class W{http;messageService;queryEnabled=!0;defaultFeatureCount=20;featureCount=20;previousMessageIds=[];constructor(g,u){this.http=g,this.messageService=u}query(g,u){this.previousMessageIds.length&&this.previousMessageIds.forEach(P=>{this.messageService.remove(P)});const O=g.filter(P=>P.visible&&P.isInResolutionsRange).map(P=>this.queryLayer(P,u));return[].concat.apply([],O)}queryLayer(g,u){const O=this.getQueryUrl(g.dataSource,u,!1,g.map.viewController.getExtent());if(!O)return(0,_.of)([]);const j=g.map.viewController.getResolution(),P=g.map.viewController.getScale();if(g.dataSource.options.queryFormat===Z.gv.HTMLGML2){if("string"==typeof O){const I=this.getQueryUrl(g.dataSource,u,!0);return this.http.get(I,{responseType:"text"}).pipe((0,D.Z)(E=>{const s=this.mergeGML(E,O,g),z=s[0],Q=s[1];return this.http.get(O,{responseType:"text"}).pipe((0,h.T)(ae=>this.extractData(ae,g,u,O,z,Q)))}))}const Y=this.getQueryUrl(g.dataSource,u,!0);let w=[];for(let I=0;I<Y.length;I++){const E=Y[I];this.checkScaleAndResolution(j,P,E)&&w.push(this.requestDataForHTMLGML2(E.url,O[I].url,g,u))}return w}{if("string"==typeof O)return this.http.get(O,{responseType:"text"}).pipe((0,h.T)(I=>this.extractData(I,g,u,O)));let Y=[];for(let w=0;w<O.length;w++){const I=O[w];if(this.checkScaleAndResolution(j,P,I)){const E=this.http.get(I.url,{responseType:"text"});Y.push(E.pipe((0,h.T)(s=>this.extractData(s,g,u,I.url))))}}return Y}}requestDataForHTMLGML2(g,u,O,j){return this.http.get(g,{responseType:"text"}).pipe((0,D.Z)(P=>{const Y=this.mergeGML(P,u,O),w=Y[0],I=Y[1];return this.http.get(u,{responseType:"text"}).pipe((0,h.T)(E=>this.extractData(E,O,j,u,w,I)))}))}checkScaleAndResolution(g,u,O){let j,P;return!(O.minResolution||O.maxResolution||O.minScale||O.maxScale)||(O.minResolution&&O.maxResolution?g>=O.minResolution&&g<=O.maxResolution&&(P=!0):(O.minResolution&&g>=O.minResolution&&(P=!0),O.maxResolution&&g<=O.maxResolution&&(P=!0)),O.minScale&&O.maxScale?u>O.minScale&&u<O.maxScale&&(j=!0):(O.maxScale&&u<=O.maxScale&&(j=!0),O.minScale&&u>=O.minScale&&(j=!0)),!0===j&&!0===P||!0===P&&!j||!0===j&&!P)}mergeGML(g,u,O){let P=(new o.A).readFeatures(g);0===P.length&&(P=(new p.A).readFeatures(g));const Y=new R.A([]);let w;const I=[];let s,E=new v.A([]);const z=P.length,ye=this.getQueryParams(u.toLowerCase()).bbox.split(","),de=F.S5();let ce,re,be,_e;if(F.X$(de,ye),O.options?.source?.options){const We=O.options.source.options;We.queryTitle&&(re=We.queryTitle)}switch(P.map(We=>{if(re){let rt=We.getProperties()[re];rt&&(ce=ce?`${ce},${rt}`:rt)}const Xe=We.getGeometry().getCoordinates(),Be=We.getGeometry().getType();switch(!s&&(s=Be),Be){case"Point":1===z?w=new y.A(Xe,"XY"):I.push(Xe);break;case"LineString":Y.appendLineString(new b.A(Xe,"XY"));break;case"Polygon":E.appendPolygon(new k.Ay(Xe,"XY"));break;case"MultiPolygon":E=new v.A(Xe,"XY");break;default:return}}),be=0===I.length&&w?{type:w.getType(),coordinates:w.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(I)]},s){case"LineString":_e={type:Y.getType(),coordinates:Y.getCoordinates()};break;case"Point":_e=be;break;case"Polygon":case"MultiPolygon":_e={type:E.getType(),coordinates:E.getCoordinates()}}const Le={};return re&&(Le[re]=ce),[_e,Le]}cross(g,u,O){return(g[0]-O[0])*(u[1]-O[1])-(g[1]-O[1])*(u[0]-O[0])}convexHull(g){g.sort((j,P)=>j[0]===P[0]?j[1]-P[1]:j[0]-P[0]);const u=[];for(const j of g){for(;u.length>=2&&this.cross(u[u.length-2],u[u.length-1],j)<=0;)u.pop();u.push(j)}const O=[];for(let j=g.length-1;j>=0;j--){for(;O.length>=2&&this.cross(O[O.length-2],O[O.length-1],g[j])<=0;)O.pop();O.push(g[j])}return O.pop(),u.pop(),u.concat(O)}extractData(g,u,O,j,P,Y){const w=u.dataSource,I=this.getAllowedFieldsAndAlias(u);let E=[];switch(w.options.queryFormat){case Z.gv.GML3:E=this.extractGML3Data(g,u.zIndex,I);break;case Z.gv.JSON:case Z.gv.GEOJSON:case Z.gv.GEOJSON2:E=this.extractGeoJSONData(g,u.zIndex,I);break;case Z.gv.ESRIJSON:E=this.extractEsriJSONData(g,u.zIndex,I);break;case Z.gv.TEXT:E=this.extractTextData(g);break;case Z.gv.HTML:E=this.extractHtmlData(g,w.queryHtmlTarget,j);break;case Z.gv.HTMLGML2:E=this.extractHtmlData(g,w.queryHtmlTarget,j,P,Y);break;default:E=this.extractGML2Data(g,u,I)}if(E.length>0&&(null===E[0].geometry||!E[0].geometry)){const Q=this.createGeometryFromUrlClick(j);for(const ae of E)ae.geometry=Q}const s=u.dataSource;if((s.params?.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(j)&&(s.params?.FEATURE_COUNT&&this.featureCount>1&&E.length===this.featureCount||!s.params?.FEATURE_COUNT&&E.length===this.defaultFeatureCount)){const Q=this.messageService.info("igo.geo.query.featureCountMax",void 0,void 0,{value:u.title});this.previousMessageIds.push(Q.toastId)}return E.map((Q,ae)=>{const ye=Q.properties[w.mapLabel];let de;if("wms"===u.options.sourceOptions?.type){const re=u.options.sourceOptions;de=re?re.excludeAttribute:void 0}let ue=this.getQueryTitle(Q,u);!ue&&E.length>1?ue=`${u.title} (${ae+1})`:ue||(ue=u.title);const ce=Object.assign({},Q.meta||{},{id:(0,a.uR)(),title:ue,mapTitle:ye,sourceTitle:u.title,order:1e3-u.zIndex,excludeAttribute:de});return Object.assign(Q,{meta:ce,projection:"carto"===w.options.type?"EPSG:4326":O.projection})})}createGeometryFromUrlClick(g){const u=this.getQueryParams(g.toLowerCase()),O=u.bbox,j=parseInt(u.width,10),P=parseInt(u.height,10),Y=parseInt(u.i||u.x,10),w=parseInt(u.j||u.y,10),I=O.split(",");let E=.05*(Math.abs(parseFloat(I[0]))-Math.abs(parseFloat(I[2])));Math.abs(parseFloat(I[0]))<180&&(E=.045);const s=parseFloat(I[0])+Math.abs(parseFloat(I[0])-parseFloat(I[2]))*Y/j-E,z=parseFloat(I[1])+Math.abs(parseFloat(I[1])-parseFloat(I[3]))*w/P-E,Q=s+2*E,ae=z+2*E,ye="POLYGON(("+s+" "+z+", "+s+" "+ae+", "+Q+" "+ae+", "+Q+" "+z+", "+s+" "+z+"))",ce=(new e.A).readFeature(ye).getGeometry();return{type:ce.getType(),coordinates:ce.getCoordinates()}}extractGML2Data(g,u,O){let P=(new o.A).readFeatures(g);if(0===P.length){const Y=new p.A;try{P=Y.readFeatures(g)}catch{console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return P.map(Y=>this.featureToResult(Y,u,O))}extractGML3Data(g,u,O){const j=new L.A;let P=[];try{P=j.readFeatures(g)}catch{console.warn("query.service: GML3 is not well supported")}return P.map(Y=>this.featureToResult(Y,u,O))}extractGeoJSONData(g,u,O){let j=[];try{j=JSON.parse(g.replace(/(\r|\n)/g," ")).features}catch{console.warn("query.service: Unable to parse geojson","\n",g)}return j.map(P=>P.meta={id:(0,a.uR)(),order:1e3-u,alias:O}),j}extractEsriJSONData(g,u,O){if(g)try{if(JSON.parse(g).error)return[]}catch{}return(new c.A).readFeatures(g).map(Y=>this.featureToResult(Y,u,O))}extractTextData(g){return[]}extractHtmlData(g,u,O,j,P){const Y=this.getQueryParams(O.toLowerCase()),w=Y.crs||Y.srs||"EPSG:3857",I=this.createGeometryFromUrlClick(O);u!==Z.DG.BLANK&&u!==Z.DG.IFRAME&&(u=Z.DG.IFRAME);const E=g.toLowerCase().indexOf("<body>"),s=g.toLowerCase().lastIndexOf("</body>")+7;return""===H()(g.slice(E,s).replace(/(\r|\n|\s)/g,""))||""===g?[]:[{type:ee.R,projection:w,properties:Object.assign({target:u,body:g,url:O},P),geometry:j||I}]}getQueryParams(g){const u=g.split("?");if(!u[1])return;const O=u[1].split("&"),j={};return O.forEach(P=>{P=P.split("="),j[P[0]]=decodeURIComponent(P[1]||"")}),j}featureToResult(g,u,O){const j=g.getGeometry(),P=Object.assign({},g.getProperties());let Y;return delete P.geometry,delete P.GEOMETRIE,delete P.boundedBy,delete P.shape,delete P.SHAPE,delete P.SHAPE_S,delete P.SHAPE_L,delete P.SHAPE_P,delete P.the_geom,delete P.geom,delete P.geom32198,j&&(Y={type:j.getType(),coordinates:j.getCoordinates()}),{type:ee.R,projection:void 0,properties:P,geometry:Y,meta:{id:(0,a.uR)(),order:1e3-u,alias:O}}}getQueryUrl(g,u,O=!1,j){let P;if(g.options.queryUrls)return this.getCustomQueryUrl(g,u,j);switch(g.constructor){case x.Tg:const Y=g,w={INFO_FORMAT:Y.params.INFO_FORMAT||this.getMimeInfoFormat(g.options.queryFormat),QUERY_LAYERS:Y.params.LAYERS,FEATURE_COUNT:Y.params.FEATURE_COUNT||this.defaultFeatureCount};Y.params.FEATURE_COUNT&&(this.featureCount=Y.params.FEATURE_COUNT),O&&(w.INFO_FORMAT=this.getMimeInfoFormat(Z.gv.GML2)),P=Y.ol.getFeatureInfoUrl(u.coordinates,u.resolution,u.projection,w);break;case x.fl:P=`${"https://"+g.options.account+".carto.com/api/v2/sql?"}format=GeoJSON${"&q="+g.options.config.layers[0].options.sql} WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(${u.coordinates[0]+","+u.coordinates[1]+"),3857),"+(g.options.queryPrecision?g.options.queryPrecision:"1000")+"))"}`;break;case x.e:case x.HO:const de=g,ue=Math.abs(j[0]-j[2]),ce=Math.abs(j[1]-j[3]),_e=de.options.queryPrecision?de.options.queryPrecision:.005*(ue>ce?ue:ce),Le=F.r(F.Tr([u.coordinates]),_e);P=`${de.options.url+"/"+de.options.layer+"/query/"}?${["f=json",`geometry=${encodeURIComponent('{"xmin":'+Le[0]+',"ymin":'+Le[1]+',"xmax":'+Le[2]+',"ymax":'+Le[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}`}return P}getMimeInfoFormat(g){let u="application/vnd.ogc.gml";const O=Object.keys(Z.gv).find(j=>Z.gv[j]===g);return O&&(u=Z.wf[O]),u}getAllowedFieldsAndAlias(g){let u;return g.options?.source?.options?.sourceFields&&g.options.source.options.sourceFields.length>=1&&(u={},g.options.source.options.sourceFields.forEach(O=>{u[O.name]=O.alias?O.alias:O.name})),u}getQueryTitle(g,u){let O;if(u.options?.source?.options){const j=u.options.source.options;j.queryTitle&&(O=this.getLabelMatch(g,j.queryTitle))}return O}getLabelMatch(g,u){let O=u;const j=Array.from(u.matchAll(/\$\{([^\{\}]+)\}/g));return j.forEach(P=>{O=O.replace(P[0],g.properties[P[1]])}),0===j.length&&O===u&&(O=g.properties[u]||u),O}getCustomQueryUrl(g,u,O){const j=F.Bg(u.coordinates,u.resolution,0,[101,101]);return g.options.queryUrls.map(P=>{let Y={url:P.url.replace(/\{bbox\}/g,j.join(",")).replace(/\{x\}/g,u.coordinates[0].toString()).replace(/\{y\}/g,u.coordinates[1].toString()).replace(/\{resolution\}/g,u.resolution.toString()).replace(/\{srid\}/g,u.projection.replace("EPSG:",""))};return O&&Y.url.replace(/\{xmin\}/g,O[0].toString()).replace(/\{ymin\}/g,O[1].toString()).replace(/\{xmax\}/g,O[2].toString()).replace(/\{ymax\}/g,O[3].toString()),P.maxResolution&&(Y.maxResolution=P.maxResolution),P.minResolution&&(Y.minResolution=P.minResolution),P.minScale&&(Y.minScale=P.minScale),P.maxScale&&(Y.maxScale=P.maxScale),Y})}static \u0275fac=function(u){return new(u||W)(G.KVO(U.Qq),G.KVO(M.bg))};static \u0275prov=G.jDH({token:W,factory:W.\u0275fac,providedIn:"root"})}return W})()},87716:(De,le,r)=>{"use strict";function M(e){return!0===e.dataSource.options.queryable}function p(e){const c=e.get("_layer");return void 0!==c&&M(c)&&function F(e){const c=e.dataSource;return void 0===c.options.queryLayerFeatures||!0===c.options.queryLayerFeatures}(c)}r.d(le,{dG:()=>p,oG:()=>M})},11439:(De,le,r)=>{"use strict";r.d(le,{L:()=>P});var M=r(60316),a=r(68559),F=r(84175),p=r(14102),e=r(15944),c=r(93840),o=r(87984),L=r(80640),v=(r(75300),r(67143)),y=r(21701),b=r(75797),k=r(14876),_=r(9114),D=r(91817),h=r(61181),X=r(36465),H=r(30269),x=r(35876),ee=r(40386),Z=r(90852);const G=["input"],U=Y=>({empty:Y}),N=Y=>({hasSearchIcon:Y});function W(Y,w){if(1&Y&&(a.j41(0,"mat-label"),a.EFF(1),a.k0s()),2&Y){const I=a.XpG();a.R7$(),a.JRh(I.label)}}function A(Y,w){if(1&Y){const I=a.RV6();a.j41(0,"button",11),a.nI1(1,"translate"),a.bIt("click",function(){a.eBV(I);const s=a.XpG();return a.Njj(s.onClearButtonClick())}),a.j41(2,"mat-icon"),a.EFF(3,"close"),a.k0s()()}if(2&Y){const I=a.XpG();a.Y8G("color",I.color)("matTooltip",a.bMT(1,2,"igo.geo.search.clearSearch"))}}function g(Y,w){1&Y&&a.nrm(0,"mat-divider",12),2&Y&&a.Y8G("vertical",!0)}function u(Y,w){if(1&Y){const I=a.RV6();a.j41(0,"button",13),a.bIt("click",function(){a.eBV(I);const s=a.XpG();return a.Njj(s.handleSearch())}),a.j41(1,"mat-icon"),a.EFF(2,"search"),a.k0s()()}if(2&Y){const I=a.XpG();a.Y8G("color",I.color)}}function O(Y,w){if(1&Y){const I=a.RV6();a.j41(0,"igo-search-selector",14),a.nI1(1,"async"),a.bIt("searchTypeChange",function(s){a.eBV(I);const z=a.XpG();return a.Njj(z.onSearchTypeChange(s))}),a.k0s()}if(2&Y){const I=a.XpG();a.Y8G("searchTypes",I.searchTypes)("searchType",a.bMT(1,2,I.searchType$))}}function j(Y,w){if(1&Y){const I=a.RV6();a.j41(0,"igo-search-settings",15),a.bIt("pointerSummaryStatus",function(s){a.eBV(I);const z=a.XpG();return a.Njj(z.pointerSummaryStatus.emit(s))})("searchResultsGeometryStatus",function(s){a.eBV(I);const z=a.XpG();return a.Njj(z.searchResultsGeometryStatus.emit(s))})("reverseSearchCoordsFormatStatus",function(s){a.eBV(I);const z=a.XpG();return a.Njj(z.reverseSearchCoordsFormatStatus.emit(s))})("searchSourceChange",function(){a.eBV(I);const s=a.XpG();return a.Njj(s.onSearchSettingsChange())}),a.k0s()}if(2&Y){const I=a.XpG();a.Y8G("pointerSummaryEnabled",I.pointerSummaryEnabled)("searchResultsGeometryEnabled",I.searchResultsGeometryEnabled)("reverseSearchCoordsFormatEnabled",I.reverseSearchCoordsFormatEnabled)}}let P=(()=>{class Y{configService;searchService;searchSourceService;static invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"];placeholder$=new b.t("igo.geo.search.placeholder");empty$=new b.t(!0);term$$;stream$=new b.t("");stream$$;searchType$$;researches$$;showSearchButton=!1;searchTypes=H.v;withDivider;set searchType(I){this.setSearchType(I)}get searchType(){return this.searchType$.value}searchType$=new b.t(void 0);pointerSummaryStatus=new a.bkB;searchResultsGeometryStatus=new a.bkB;reverseSearchCoordsFormatStatus=new a.bkB;set term(I){this.setTerm(I)}get term(){return this.term$.value}term$=new b.t("");set disabled(I){this.disabled$.next(I)}get disabled(){return this.disabled$.value}disabled$=new b.t(!1);pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;get reverseSearchCoordsFormatEnabled(){return this._reverseSearchCoordsFormatEnabled}set reverseSearchCoordsFormatEnabled(I){this._reverseSearchCoordsFormatEnabled=I,this.setTerm(this.term,!0)}_reverseSearchCoordsFormatEnabled=!1;floatLabel="auto";appearance="fill";placeholder;label;color="primary";termSplitter="|";debounce=200;minLength=2;searchSelector=!1;searchSettings=!1;forceNA=!1;store;searchTermChange=new a.bkB;search=new a.bkB;searchTypeChange=new a.bkB;clearFeature=new a.bkB;searchSettingsChange=new a.bkB;input;get empty(){return 0===this.term.length}constructor(I,E,s){this.configService=I,this.searchService=E,this.searchSourceService=s}ngOnInit(){this.term$$=this.term$.subscribe(E=>{this.empty$.next(void 0===E||0===E.length)}),this.stream$$=this.stream$.pipe((0,_.s)(()=>(0,k.O)(this.debounce))).subscribe(E=>this.onSetTerm(E)),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe((0,D.F)()).subscribe(E=>this.onSetSearchType(E));const I=this.configService.getConfig("searchBar.showSearchButton");this.showSearchButton=void 0!==I&&I}ngOnDestroy(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}onKeyup(I){this.keyIsValid(I.key)&&this.setTerm(I.target.value)}onClearButtonClick(){this.clear(),this.clearFeature.emit()}onSearchTypeChange(I){this.setSearchType(I)}setSearchType(I){this.searchType$.next(I)}onSearchSettingsChange(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}setTerm(I,E){if(this.disabled)return;(I=I||"")!==this.term&&!E&&this.term$.next(I);const s=I.replace(/(#[^\s]*)/g,"").trim();(s.length>=this.minLength||0===s.length)&&this.stream$.next(I)}handleSearch(){this.doSearch(this.term)}clear(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}keyIsValid(I){return-1===Y.invalidKeys.indexOf(I)}onSetTerm(I){this.searchTermChange.emit(I),this.doSearch(I)}handlePlaceholder(){const I=[...new Set(this.searchSourceService.getEnabledSources().filter(s=>!["map","coordinatesreverse"].includes(s.getId())).map(s=>s.getType()))];let E="igo.geo.search.placeholder";1===I.length?E=`igo.geo.search.${I[0].toLowerCase()}.placeholder`:0===I.length&&(E="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(E)}onSetSearchType(I){if(null==I)return;this.searchTypeChange.emit(I);const E=`igo.geo.search.${I.toLowerCase()}.placeholder`;this.placeholder$.next(E),this.setTerm(this.term)}doSearch(I){let E;this.researches$$&&(this.researches$$.map(z=>z.unsubscribe()),this.researches$$=void 0),this.termSplitter&&I.match(new RegExp(this.termSplitter,"g"))?(E=I.split(this.termSplitter).filter(z=>z.length>=this.minLength),this.store&&this.store.clear()):E=[I];let s=[];E.map(z=>{""!==(z?z.replace(/(#[^\s]*)/g,"").trim():"")?s=s.concat(this.searchService.search(z,{forceNA:this.forceNA})):void 0!==this.store&&this.store.clear()}),this.researches$$=s.map(z=>z.request.subscribe(Q=>{this.onResearchCompleted(z,Q)}))}onResearchCompleted(I,E){if(this.search.emit({research:I,results:E}),void 0!==this.store){const s=this.store.all().filter(z=>z.source!==I.source).concat(E);this.store.updateMany(s)}}static \u0275fac=function(E){return new(E||Y)(a.rXU(v.we),a.rXU(x.S),a.rXU(ee.z))};static \u0275cmp=a.VBU({type:Y,selectors:[["igo-search-bar"]],viewQuery:function(E,s){if(1&E&&a.GBs(G,7),2&E){let z;a.mGM(z=a.lsd())&&(s.input=z.first)}},inputs:{searchTypes:"searchTypes",withDivider:"withDivider",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},standalone:!0,features:[a.aNF],decls:17,vars:29,consts:[["input",""],[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"keyup","ngClass","disabled","placeholder","value"],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click",4,"ngIf"],[3,"vertical",4,"ngIf"],[1,"search-bar-buttons"],["mat-icon-button","",3,"color","click",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click","color","matTooltip"],[3,"vertical"],["mat-icon-button","",3,"click","color"],[3,"searchTypeChange","searchTypes","searchType"],[3,"pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange","pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled"]],template:function(E,s){if(1&E){const z=a.RV6();a.j41(0,"div",1),a.nI1(1,"async"),a.j41(2,"mat-form-field",2),a.DNE(3,W,2,1,"mat-label",3),a.j41(4,"input",4,0),a.nI1(6,"async"),a.nI1(7,"async"),a.nI1(8,"translate"),a.nI1(9,"async"),a.bIt("keyup",function(ae){return a.eBV(z),a.Njj(s.onKeyup(ae))}),a.k0s(),a.DNE(10,A,4,4,"button",5),a.nI1(11,"async"),a.k0s(),a.DNE(12,g,1,1,"mat-divider",6),a.j41(13,"div",7),a.DNE(14,u,3,1,"button",8)(15,O,2,4,"igo-search-selector",9)(16,j,1,3,"igo-search-settings",10),a.k0s()()}2&E&&(a.Y8G("ngClass",a.eq3(25,U,a.bMT(1,13,s.empty$))),a.R7$(2),a.Y8G("floatLabel",s.floatLabel)("appearance",s.appearance),a.R7$(),a.Y8G("ngIf",s.label),a.R7$(),a.Y8G("ngClass",a.eq3(27,N,s.showSearchButton))("disabled",a.bMT(6,15,s.disabled$))("placeholder",s.placeholder?s.placeholder:a.bMT(7,17,s.placeholder$)?a.bMT(8,19,s.placeholder$.value):void 0)("value",a.bMT(9,21,s.term$)),a.R7$(6),a.Y8G("ngIf",!1===a.bMT(11,23,s.empty$)),a.R7$(2),a.Y8G("ngIf",s.withDivider),a.R7$(2),a.Y8G("ngIf",s.showSearchButton),a.R7$(),a.Y8G("ngIf",s.searchSelector),a.R7$(),a.Y8G("ngIf",s.searchSettings))},dependencies:[M.YU,e.RG,e.rl,e.nJ,e.yw,M.bT,o.fS,o.fg,F.Hl,F.iY,L.uc,L.oV,c.m_,c.An,p.w,p.q,h.B,X.V,M.Jj,y.Ck,Z.D9],styles:['[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{align-items:center;padding-right:0}[_nghost-%COMP%]     .mat-mdc-form-field-infix{align-self:center}@media (max-width: 599px){[_nghost-%COMP%]     .mat-mdc-form-field-infix{width:158px}}[_nghost-%COMP%]     mat-form-field .mdc-line-ripple{display:none}[_nghost-%COMP%]     mat-form-field input{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:flex}mat-form-field[_ngcontent-%COMP%]{flex:1}mat-divider[_ngcontent-%COMP%]{margin:8px 0}.search-bar-buttons[_ngcontent-%COMP%]{position:relative;display:inline-flex}.search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";border-right:1px solid #ddd;height:28px}igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}'],changeDetection:0})}return Y})()},52342:(De,le,r)=>{"use strict";r.d(le,{E:()=>de});var M=r(60316),a=r(16256),F=r(84175),p=r(93840),e=r(80640),c=r(16684),L=(r(75300),r(36222)),R=r(21701),v=r(55050),y=r(61099),b=r(18194),k=r(1963),_=r(29814),D=r(75797),h=r(64334),X=r(96875),H=r(54427),x=r(81081),ee=r(64412),Z=r(91640),U=(r(53792),r(25713)),N=r(34456),W=r(79771),A=r(85060),g=r(87941),u=r(15944),O=r(87984),j=r(20943),P=r(28176),Y=r(63037),w=r(70271),I=r(14907),E=r(68559),s=r(90852);function z(ue,ce){if(1&ue&&(E.j41(0,"mat-option",14)(1,"p",15),E.EFF(2),E.k0s()()),2&ue){const re=ce.$implicit;E.Y8G("value",re),E.R7$(2),E.JRh(re.title)}}let Q=(()=>{class ue{formBuilder;languageService;dialogRef;data;form;feature;layers=[];filteredLayers$;constructor(re,be,_e,Le){this.formBuilder=re,this.languageService=be,this.dialogRef=_e,this.data=Le,this.form=this.formBuilder.group({layerName:["",[N.k0.required]]})}ngOnInit(){this.feature=this.data.feature,this.layers=this.data.layers,this.filteredLayers$=this.form.controls.layerName.valueChanges.pipe((0,Y.Z)(""),(0,w.T)(re=>this.filter(re)))}filter(re){if("string"==typeof re)return this.layers.map(be=>be).filter(be=>be?.title?.toLowerCase().includes(re.toLowerCase()))}displayFn(re){return re&&re.title?re.title:""}save(){this.dialogRef.close({layer:this.form.value.layerName,feature:this.feature})}cancel(){this.dialogRef.close()}static \u0275fac=function(be){return new(be||ue)(E.rXU(N.ze),E.rXU(R.gw),E.rXU(g.CP),E.rXU(g.Vh,8))};static \u0275cmp=E.VBU({type:ue,selectors:[["igo-save-feature-dialog"]],standalone:!0,features:[E.aNF],decls:23,vars:22,consts:[["auto","matAutocomplete"],["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[3,"navigation","selection"],["igoListItem","","color","accent",3,"result","showIcons"],[1,"igo-input-container"],["type","text","matInput","","formControlName","layerName",3,"placeholder","matAutocomplete"],[3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","create-layer-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","createLayerBtnDialog","mat-raised-button","","type","button","color","primary",3,"click"],[3,"value"],["matListItemTitle",""]],template:function(be,_e){if(1&be){const Le=E.RV6();E.j41(0,"h1",1),E.EFF(1),E.nI1(2,"translate"),E.k0s(),E.j41(3,"div",2)(4,"form",3)(5,"igo-list",4),E.nrm(6,"igo-search-results-item",5),E.k0s(),E.j41(7,"div",6)(8,"mat-form-field"),E.nrm(9,"input",7),E.nI1(10,"translate"),E.j41(11,"mat-autocomplete",8,0),E.DNE(13,z,3,2,"mat-option",9),E.nI1(14,"async"),E.k0s()()()()(),E.j41(15,"div",10)(16,"div",11)(17,"button",12),E.bIt("click",function(){return E.eBV(Le),E.Njj(_e.cancel())}),E.EFF(18),E.nI1(19,"translate"),E.k0s(),E.j41(20,"button",13),E.bIt("click",function(){return E.eBV(Le),E.Njj(_e.save())}),E.EFF(21),E.nI1(22,"translate"),E.k0s()()()}if(2&be){const Le=E.sdS(12);E.R7$(),E.SpI(" ",E.bMT(2,12,"igo.geo.layer.saveFeatureInLayer"),"\n"),E.R7$(3),E.Y8G("formGroup",_e.form),E.R7$(),E.Y8G("navigation",!1)("selection",!1),E.R7$(),E.Y8G("result",_e.feature)("showIcons",!0),E.R7$(3),E.FS9("placeholder",E.bMT(10,14,"igo.geo.layer.chooseOrSet")),E.Y8G("matAutocomplete",Le),E.R7$(2),E.Y8G("displayWith",_e.displayFn),E.R7$(2),E.Y8G("ngForOf",E.bMT(14,16,_e.filteredLayers$)),E.R7$(5),E.SpI(" ",E.bMT(19,18,"igo.geo.layer.cancelBtn")," "),E.R7$(3),E.SpI(" ",E.bMT(22,20,"igo.geo.layer.saveBtn")," ")}},dependencies:[g.BI,g.Yi,N.YN,N.qT,N.me,N.BC,N.cb,N.X1,N.j4,N.JD,P.sB,I.f,P.dF,u.RG,u.rl,O.fS,O.fg,W.jL,W.$3,A.wT,W.pN,M.pM,A.Sy,j.Fg,j.yE,g.E7,F.Hl,F.$z,M.Jj,R.Ck,s.D9],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .create-layer-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   button#createLayerBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:red}"]})}return ue})();function ae(ue,ce){if(1&ue){const re=E.RV6();E.j41(0,"button",2),E.nI1(1,"translate"),E.nI1(2,"async"),E.bIt("mouseenter",function(_e){E.eBV(re);const Le=E.XpG();return E.Njj(Le.onMouseEvent(_e))})("mouseleave",function(_e){E.eBV(re);const Le=E.XpG();return E.Njj(Le.onMouseEvent(_e))})("click",function(_e){E.eBV(re);const Le=E.XpG();return E.Njj(Le.onToggleClick(_e))}),E.j41(3,"mat-icon",3),E.nI1(4,"async"),E.nI1(5,"async"),E.nI1(6,"async"),E.nI1(7,"async"),E.nI1(8,"async"),E.nI1(9,"async"),E.EFF(10),E.nI1(11,"async"),E.k0s()()}if(2&ue){const re=E.XpG();E.Y8G("matTooltip",E.bMT(1,7,re.computeTooltip()))("color",E.bMT(2,9,re.isPreview$)?"":re.added?"warn":""),E.R7$(3),E.Y8G("igoMatBadgeIcon",re.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",E.bMT(4,11,re.inRange$)&&!0===E.bMT(5,13,re.isVisible$)||E.bMT(6,15,re.inRange$)&&!re.added||E.bMT(7,17,re.inRange$)&&E.bMT(8,19,re.isPreview$))("matBadgeDisabled",!1===E.bMT(9,21,re.inRange$)),E.R7$(7),E.SpI("",E.bMT(11,23,re.isPreview$)?"add":re.added?"delete":"add"," ")}}function ye(ue,ce){if(1&ue){const re=E.RV6();E.j41(0,"button",4),E.nI1(1,"async"),E.nI1(2,"translate"),E.bIt("click",function(){E.eBV(re);const _e=E.XpG();return E.Njj(_e.addFeatureToLayer())}),E.j41(3,"mat-icon",5),E.nI1(4,"async"),E.EFF(5,"add_to_photos "),E.k0s()()}if(2&ue){const re=E.XpG();E.Y8G("id",re.isMobile?"":"hide-save-search-result-btn")("matTooltip",E.bMT(2,7,E.bMT(1,5,re.addFeatureToLayerTooltip$))),E.R7$(3),E.Y8G("igoMatBadgeInverseColor",!0)("matBadgeHidden",E.bMT(4,9,re.inRange$))("matBadgeDisabled",!0)}}let de=(()=>{class ue{layerService;dialog;dataSourceService;mediaService;tooltip$=new D.t("igo.geo.catalog.layer.addToMap");addFeatureToLayerTooltip$=new D.t("igo.geo.search.addToLayer");resolution$$;layers$$;inRange$=new D.t(!0);isVisible$=new D.t(!1);isPreview$=new D.t(!1);layersSubcriptions=[];lastTimeoutRequest;mouseInsideAdd=!1;layer;store;added;map;saveSearchResultInLayer=!1;get color(){return this._color}set color(re){this._color=re}_color="primary";stores=[];get allLayers(){return this.map.layers.filter(re=>String(re.id).includes("igo-search-layer"))}mediaService$$;isMobile=!1;constructor(re,be,_e,Le){this.layerService=re,this.dialog=be,this.dataSourceService=_e,this.mediaService=Le}ngOnInit(){this.mediaService$$=this.mediaService.media$.subscribe(re=>{re===v.$U.Mobile&&(this.isMobile=!0)}),"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(re=>re.id===this.layer.data.sourceOptions.id)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(re=>{this.isInResolutionsRange(re),this.isVisible()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.layers$$.unsubscribe(),this.mediaService$$&&this.mediaService$$.unsubscribe()}onMouseEvent(re){this.onToggleClick(re)}onToggleClick(re){typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const be=re||{};if("mouseenter"!==be.type||!this.mouseInsideAdd)switch(be.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add(be)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(be),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(re){this.added||(this.added=!0,this.addLayerToMap(re))}remove(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(re=>re.unsubscribe()),this.layersSubcriptions=[])}addLayerToMap(re){if(void 0===this.map||this.layer.meta.dataType!==x.I)return;const be=this.layer.data;void 0===be.sourceOptions.optionsFromApi&&(be.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(be).subscribe(_e=>{"click"===re.type&&this.map.layersAddedByClick$.next([_e]),this.map.addLayer(_e)}))}removeLayerFromMap(){if(void 0===this.map||this.layer.meta.dataType!==x.I)return;const re=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(re)}isInResolutionsRange(re){this.inRange$.next(re>=(this.layer.data.minResolution||0)&&re<=(this.layer.data.maxResolution||1/0))}isVisible(){if(this.layer?.data?.sourceOptions?.id){const re=this.map.getLayerById(this.layer.data.sourceOptions.id);this.isVisible$.next(!!re&&re.visible)}}getBadgeIcon(){return this.inRange$.value&&this.isVisible$.value?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}addFeatureToLayer(){"Feature"===this.layer.meta.dataType&&this.dialog.open(Q,{width:"700px",data:{feature:this.layer,layers:this.allLayers}}).afterClosed().subscribe(_e=>{if(_e)if(this.stores.length>0&&this.stores.map(Le=>(Le.state.updateAll({selected:!1}),Le?.layer&&(Le.layer.visible=!1),Le)),"string"==typeof _e.layer)this.createLayer(_e.layer,_e.feature);else{const Le=this.stores.find(We=>We.layer.id===_e.layer.id);Le.layer.visible=!0,Le.layer.opacity=1,this.addFeature(_e.feature,Le)}})}createLayer(re,be){const _e=new H.oE([],{map:this.map}),Le=[new _.Ay({image:new y.A({radius:5,stroke:new k.A({width:1,color:"rgba(143,7,7,1)"}),fill:new b.A({color:"rgba(143,7,7,1)"})})}),new _.Ay({stroke:new k.A({width:1,color:"rgba(143,7,7,1)"}),fill:new b.A({color:"rgba(0, 0, 255, 0.1)"})})];let We=0;for(const Xe of this.allLayers){let Be=Number(Xe.id.replace("igo-search-layer",""));We=Math.max(Be,We)}this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,h.s)(1)).subscribe(Xe=>{let Be=new Z.v({isIgoInternalLayer:!0,id:"igo-search-layer"+ ++We,title:re,source:Xe,igoStyle:{editable:!1,igoStyleObject:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},circle:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},radius:5}}},style:Le,showInLayerList:!0,exportable:!0,workspace:{enabled:!0}});(0,H.df)(_e,Be),(0,H.c2)(_e,new H.n6({motion:H.Bl.None})),(0,H._O)(_e,new H.ZA({map:this.map,motion:H.Bl.None,many:!0})),_e.layer.visible=!0,_e.source.ol.on("removefeature",rt=>{const Ie=rt.feature.getGeometry();this.clearLabelsOfOlGeometry(Ie)}),this.addFeature(be,_e),this.stores.push(_e)})}addFeature(re,be){const _e={type:re.data.type,geometry:{coordinates:re.data.geometry.coordinates,type:re.data.geometry.type},projection:re.data.projection,properties:re.data.properties,meta:{id:re.meta.id}};delete _e.properties.Route,be.update(_e),be.setLayerExtent(),be.layer.ol.getSource().refresh()}clearLabelsOfOlGeometry(re){(0,U.JM)(re).forEach(be=>{be&&be.getMap()&&this.map.ol.removeOverlay(be)})}static \u0275fac=function(be){return new(be||ue)(E.rXU(ee.B),E.rXU(g.bZ),E.rXU(X.n),E.rXU(v.u1))};static \u0275cmp=E.VBU({type:ue,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",store:"store",added:"added",map:"map",saveSearchResultInLayer:"saveSearchResultInLayer",color:"color",stores:"stores"},standalone:!0,features:[E.aNF],decls:2,vars:2,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"mouseenter","mouseleave","click","matTooltip","color"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","id","matTooltip"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","visibility_off","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"]],template:function(be,_e){1&be&&E.DNE(0,ae,12,25,"button",0)(1,ye,6,11,"button",1),2&be&&(E.Y8G("ngIf","Layer"===_e.layer.meta.dataType),E.R7$(),E.Y8G("ngIf","Feature"===_e.layer.meta.dataType&&_e.saveSearchResultInLayer))},dependencies:[M.bT,F.Hl,F.iY,L.WZ,e.uc,e.oV,p.m_,p.An,a.Y,a.k,c.V,M.Jj,R.Ck,s.D9],styles:["[_nghost-%COMP%]   #hide-save-search-result-btn[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   #show-save-search-result-btn[_ngcontent-%COMP%]{display:block}"],changeDetection:0})}return ue})()},14907:(De,le,r)=>{"use strict";r.d(le,{f:()=>x});var M=r(60316),a=r(68559),F=r(84175),p=r(93840),e=r(20943),c=r(80640),o=r(75300),L=r(36222),R=r(66586),v=r(54427);r(53792);const b=[[["","igoSearchItemToolbar",""]]],k=["[igoSearchItemToolbar]"];function _(ee,Z){if(1&ee&&(a.j41(0,"mat-icon",6),a.EFF(1),a.k0s()),2&ee){const G=a.XpG();a.R7$(),a.JRh(G.showIcons?G.icon:"blank")}}function D(ee,Z){if(1&ee&&a.nrm(0,"div",7),2&ee){const G=a.XpG();a.Y8G("innerHtml",G.titleHtml,a.npT)("matTooltip",G.tooltipHtml)}}function h(ee,Z){if(1&ee&&(a.j41(0,"span",9),a.EFF(1),a.k0s()),2&ee){const G=a.XpG(2);a.Y8G("matTooltip",G.title),a.R7$(),a.JRh(G.title)}}function X(ee,Z){if(1&ee&&a.DNE(0,h,2,2,"span",8),2&ee){const G=a.XpG();a.Y8G("ngIf",!G.titleHtml)}}function H(ee,Z){if(1&ee){const G=a.RV6();a.j41(0,"button",10),a.bIt("click",function(){a.eBV(G);const N=a.XpG();return a.Njj(N.onZoomHandler())}),a.j41(1,"mat-icon"),a.EFF(2,"search"),a.k0s()()}}let x=(()=>{class ee{result;map;showIcons;withZoomButton=!1;zoomEvent=new a.bkB;format=new R.A;get title(){return(0,o.k0)(this.result)}get titleHtml(){return(0,o.J1)(this.result)}get tooltipHtml(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")}get icon(){return(0,o.Zq)(this.result)}onZoomHandler(){const G=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});(0,v.p6)(this.map.viewController,[G],v.Bl.Default)}onMouseEvent(G){const U=G.target;switch(G.type){case"mouseenter":const W=U.querySelector("#hide-save-search-result-btn");W&&W.setAttribute("id","show-save-search-result-btn");break;case"mouseleave":const A=U.querySelector("#show-save-search-result-btn");A&&A.setAttribute("id","hide-save-search-result-btn")}}static \u0275fac=function(U){return new(U||ee)};static \u0275cmp=a.VBU({type:ee,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},standalone:!0,features:[a.aNF],ngContentSelectors:k,decls:8,vars:4,consts:[["normalTitle",""],[3,"mouseenter","mouseleave"],["matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf","ngIfElse"],["matListItemMeta",""],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["matListItemIcon",""],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"]],template:function(U,N){if(1&U){const W=a.RV6();a.NAR(b),a.j41(0,"mat-list-item",1),a.bIt("mouseenter",function(g){return a.eBV(W),a.Njj(N.onMouseEvent(g))})("mouseleave",function(g){return a.eBV(W),a.Njj(N.onMouseEvent(g))}),a.DNE(1,_,2,1,"mat-icon",2)(2,D,1,2,"div",3)(3,X,1,1,"ng-template",null,0,a.C5r),a.j41(5,"div",4),a.DNE(6,H,3,0,"button",5),a.SdG(7),a.k0s()()}if(2&U){const W=a.sdS(4);a.R7$(),a.Y8G("ngIf",N.icon),a.R7$(),a.Y8G("ngIf",N.titleHtml)("ngIfElse",W),a.R7$(4),a.Y8G("ngIf",N.withZoomButton)}},dependencies:[e.Fg,e.YE,e.ZV,e.yE,e.BJ,M.bT,p.m_,p.An,c.uc,c.oV,F.Hl,F.iY,L.WZ],styles:["[_nghost-%COMP%]     small{color:#8c8c8c}[_nghost-%COMP%]   div[matlistitemmeta][_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]     .search-result-tooltip{white-space:pre-line}"],changeDetection:0})}return ee})()},92142:(De,le,r)=>{"use strict";r.d(le,{M:()=>ce});var M=r(60316),a=r(68559),F=r(38223),p=r(63220),e=r(75300),c=r(28176),o=r(67143),L=r(21701),R=r(75797),v=r(59400),y=r(14876),b=r(9114),k=r(70271),D=(r(53792),r(35876)),h=r(14907),X=r(90852);const H=["igoSearchItemToolbar"],x=re=>({results:re}),ee=re=>({result:re}),Z=re=>({group:re});function G(re,be){1&re&&a.eu8(0)}function U(re,be){if(1&re){const _e=a.RV6();a.j41(0,"igo-collapsible",8),a.bIt("toggle",function(We){a.eBV(_e);const Xe=a.XpG().$implicit,Be=a.XpG(2);return a.Njj(Be.collapsed[Xe.source.title]=We)}),a.DNE(1,G,1,0,"ng-container",9),a.k0s()}if(2&re){const _e=a.XpG().$implicit,Le=a.sdS(4),We=a.XpG(2);a.HbH(_e.source.getId()),a.Y8G("title",We.computeGroupTitle(_e))("collapsed",We.collapsed[_e.source.title]),a.R7$(),a.Y8G("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.eq3(6,x,_e.results))}}function N(re,be){1&re&&a.eu8(0)}function W(re,be){if(1&re&&a.DNE(0,N,1,0,"ng-container",9),2&re){const _e=a.XpG().$implicit,Le=a.sdS(4);a.Y8G("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.eq3(2,x,_e.results))}}function A(re,be){if(1&re){const _e=a.RV6();a.j41(0,"igo-search-results-item",11),a.bIt("focus",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(4);return a.Njj(Xe.resultFocus.emit(We))})("unfocus",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(4);return a.Njj(Xe.resultUnfocus.emit(We))})("select",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(4);return a.Njj(Xe.onResultSelect(We))})("mouseenter",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(4);return a.Njj(Xe.resultFocus.emit(We))})("mouseleave",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(4);return a.Njj(Xe.resultUnfocus.emit(We))}),a.eu8(1,12),a.k0s()}if(2&re){const _e=be.$implicit,Le=a.XpG(4);a.Y8G("map",Le.map)("result",_e)("showIcons",Le.showIcons)("withZoomButton",Le.withZoomButton)("focused",Le.store.state.get(_e).focused)("selected",Le.store.state.get(_e).selected),a.R7$(),a.Y8G("ngTemplateOutlet",Le.templateSearchToolbar)("ngTemplateOutletContext",a.eq3(8,ee,_e))}}function g(re,be){if(1&re){const _e=a.RV6();a.j41(0,"span",13),a.bIt("click",function(){a.eBV(_e);const We=a.XpG(2).$implicit,Xe=a.XpG(2);return a.Njj(Xe.displayMoreResults(We))}),a.j41(1,"u"),a.EFF(2),a.nI1(3,"translate"),a.k0s()()}2&re&&(a.R7$(2),a.JRh(a.bMT(3,1,"igo.geo.search.displayMoreResults")))}function u(re,be){if(1&re&&a.DNE(0,A,2,10,"ng-template",6)(1,g,4,3,"span",10),2&re){const _e=be.results,Le=a.XpG().$implicit,We=a.XpG(2);a.Y8G("ngForOf",_e),a.R7$(),a.Y8G("ngIf",We.isMoreResults(Le))}}function O(re,be){if(1&re&&a.DNE(0,U,2,8,"igo-collapsible",7)(1,W,1,4,"ng-template",null,1,a.C5r)(3,u,2,2,"ng-template",null,2,a.C5r),2&re){const _e=a.sdS(2),Le=a.XpG(2);a.Y8G("ngIf",Le.mode===Le.searchResultMode.Grouped)("ngIfElse",_e)}}function j(re,be){if(1&re&&(a.j41(0,"igo-list",5),a.DNE(1,O,5,2,"ng-template",6,0,a.C5r),a.nI1(3,"async"),a.k0s()),2&re){const _e=a.XpG();a.Y8G("navigation",!0),a.R7$(),a.Y8G("ngForOf",a.bMT(3,2,_e.results$))}}function P(re,be){1&re&&a.eu8(0)}function Y(re,be){1&re&&a.eu8(0)}function w(re,be){if(1&re&&(a.j41(0,"mat-tab",17),a.DNE(1,Y,1,0,"ng-container",9),a.k0s()),2&re){const _e=be.$implicit;a.XpG(2);const Le=a.sdS(7),We=a.XpG();a.Y8G("label",We.computeGroupTitle(_e)),a.R7$(),a.Y8G("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.eq3(3,Z,_e))}}function I(re,be){if(1&re&&(a.j41(0,"mat-tab-group",15),a.DNE(1,w,2,5,"mat-tab",16),a.nI1(2,"async"),a.k0s()),2&re){const _e=a.XpG(2);a.R7$(),a.Y8G("ngForOf",a.bMT(2,1,_e.results$))}}function E(re,be){1&re&&a.eu8(0)}function s(re,be){if(1&re&&a.DNE(0,E,1,0,"ng-container",9),2&re){const _e=be.$implicit;a.XpG(2);const Le=a.sdS(7);a.Y8G("ngTemplateOutlet",Le)("ngTemplateOutletContext",a.eq3(2,Z,_e))}}function z(re,be){if(1&re&&(a.DNE(0,s,1,4,"ng-template",6),a.nI1(1,"async")),2&re){const _e=a.XpG(2);a.Y8G("ngForOf",a.bMT(1,1,_e.results$))}}function Q(re,be){if(1&re){const _e=a.RV6();a.j41(0,"igo-search-results-item",11),a.bIt("focus",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(3);return a.Njj(Xe.resultFocus.emit(We))})("unfocus",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(3);return a.Njj(Xe.resultUnfocus.emit(We))})("select",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(3);return a.Njj(Xe.onResultSelect(We))})("mouseenter",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(3);return a.Njj(Xe.resultFocus.emit(We))})("mouseleave",function(){const We=a.eBV(_e).$implicit,Xe=a.XpG(3);return a.Njj(Xe.resultUnfocus.emit(We))}),a.eu8(1,12),a.k0s()}if(2&re){const _e=be.$implicit,Le=a.XpG(3);a.Y8G("map",Le.map)("result",_e)("showIcons",Le.showIcons)("withZoomButton",Le.withZoomButton)("focused",Le.store.state.get(_e).focused)("selected",Le.store.state.get(_e).selected),a.R7$(),a.Y8G("ngTemplateOutlet",Le.templateSearchToolbar)("ngTemplateOutletContext",a.eq3(8,ee,_e))}}function ae(re,be){if(1&re){const _e=a.RV6();a.j41(0,"span",13),a.bIt("click",function(){a.eBV(_e);const We=a.XpG().group,Xe=a.XpG(2);return a.Njj(Xe.displayMoreResults(We))}),a.j41(1,"u"),a.EFF(2),a.nI1(3,"translate"),a.k0s()()}2&re&&(a.R7$(2),a.JRh(a.bMT(3,1,"igo.geo.search.displayMoreResults")))}function ye(re,be){if(1&re&&a.DNE(0,Q,2,10,"ng-template",6)(1,ae,4,3,"span",10),2&re){const _e=be.group,Le=a.XpG(2);a.Y8G("ngForOf",_e.results),a.R7$(),a.Y8G("ngIf",Le.isMoreResults(_e))}}function de(re,be){if(1&re&&(a.j41(0,"igo-list",5),a.DNE(1,P,1,0,"ng-container",14)(2,I,3,3,"ng-template",null,3,a.C5r)(4,z,2,3,"ng-template",null,1,a.C5r)(6,ye,2,2,"ng-template",null,2,a.C5r),a.k0s()),2&re){const _e=a.sdS(3),Le=a.sdS(5),We=a.XpG();a.Y8G("navigation",!0),a.R7$(),a.Y8G("ngIf",We.mode===We.searchResultMode.Grouped)("ngIfThen",_e)("ngIfElse",Le)}}var ue=function(re){return re.Grouped="grouped",re.Flat="flat",re}(ue||{});let ce=(()=>{class re{cdRef;searchService;configService;showResultsCount=!0;searchResultMode=ue;watcher;settingsChange$$;pageIterator=[];collapsed=[];map;store;showIcons;mode=ue.Grouped;withZoomButton=!1;tabsMode=!1;get term(){return this._term}set term(_e){this._term=_e,this.pageIterator=[]}_term;settingsChange$=new R.t(void 0);termSplitter="|";resultFocus=new a.bkB;resultUnfocus=new a.bkB;resultSelect=new a.bkB;moreResults=new a.bkB;resultMouseenter=new a.bkB;resultMouseleave=new a.bkB;templateSearchToolbar;get results$(){return void 0===this._results$&&(this._results$=this.liftResults()),this._results$}_results$;constructor(_e,Le,We){this.cdRef=_e,this.searchService=Le,this.configService=We}ngOnInit(){this.watcher=new e.bz(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(()=>{this.pageIterator=[]}),!1===this.configService.getConfig("searchSources.showResultsCount")&&(this.showResultsCount=!1)}ngOnDestroy(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}computeGroupTitle(_e){const Le=[_e.source.title],We=_e.results.length;return We>1&&this.showResultsCount&&Le.push(`(${We})`),Le.join(" ")}onResultSelect(_e){this.store.state.get(_e)&&!0===this.store.state.get(_e).selected||(this.store.state.update(_e,{focused:!0,selected:!0},!0),this.resultSelect.emit(_e))}liftResults(){return this.store.stateView.all$().pipe((0,b.s)(_e=>0===_e.length?v.w:(0,y.O)(200)),(0,k.T)(_e=>this.groupResults(_e.map(Le=>Le.entity).sort(this.sortByOrder))))}sortByOrder(_e,Le){return _e.source.displayOrder-Le.source.displayOrder}groupResults(_e){const Le=new Map;return _e.forEach(We=>{const Xe=We.source;let Be=Le.get(Xe);void 0===Be&&(Be=[],Le.set(Xe,Be)),Be.push(We)}),Array.from(Le.keys()).map(We=>(void 0===this.pageIterator[We.getId()]&&(this.pageIterator[We.getId()]=1),{source:We,results:Le.get(We)}))}isMoreResults(_e){return this.store.getStrategyOfType(e.fR)?.active?_e.results?.length%+_e.source.params.limit==0&&+_e.source.params.page<30:_e.results&&!0===_e.results[_e.results.length-1].meta.nextPage}displayMoreResults(_e){const Le={sourceId:_e.source.getId(),page:++this.pageIterator[_e.source.getId()]};let We;We=this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?this.term.split(this.termSplitter):[this.term];let Xe=[];We.map(Be=>{Xe=Xe.concat(this.searchService.search(Be,Le))}),Xe.map(Be=>{Be.request.subscribe(rt=>{const Ie=_e.results.concat(rt);rt.length||(Ie[Ie.length-1].meta.nextPage=!1),this.moreResults.emit({research:Be,results:Ie})})})}static \u0275fac=function(Le){return new(Le||re)(a.rXU(a.gRc),a.rXU(D.S),a.rXU(o.we))};static \u0275cmp=a.VBU({type:re,selectors:[["igo-search-results"]],contentQueries:function(Le,We,Xe){if(1&Le&&a.wni(Xe,H,5),2&Le){let Be;a.mGM(Be=a.lsd())&&(We.templateSearchToolbar=Be.first)}},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",tabsMode:"tabsMode",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},standalone:!0,features:[a.aNF],decls:2,vars:2,consts:[["groupTemplate",""],["flatTemplate",""],["storeItemTemplate",""],["tabsTemplate",""],[3,"navigation",4,"ngIf"],[3,"navigation"],["ngFor","",3,"ngForOf"],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],[3,"toggle","title","collapsed"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"focus","unfocus","select","mouseenter","mouseleave","map","result","showIcons","withZoomButton","focused","selected"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["dynamicHeight","",1,"custom-tabs-view"],[3,"label",4,"ngFor","ngForOf"],[3,"label"]],template:function(Le,We){1&Le&&a.DNE(0,j,4,4,"igo-list",4)(1,de,8,4,"igo-list",4),2&Le&&(a.Y8G("ngIf",!1===We.tabsMode),a.R7$(),a.Y8G("ngIf",We.tabsMode))},dependencies:[M.bT,c.sB,M.pM,p.g2,M.T3,h.f,c.dF,F.RI,F.mq,F.T8,M.Jj,L.Ck,X.D9],styles:["[_nghost-%COMP%]   .moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list{height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list .custom-tabs-view .mat-mdc-tab-header-pagination{min-width:20px}"],changeDetection:0})}return re})()},61181:(De,le,r)=>{"use strict";r.d(le,{B:()=>D});var M=r(60316),a=r(68559),F=r(84175),p=r(93840),e=r(31034),c=r(53804),o=r(80640),L=r(21701),R=r(75797),v=r(91817),y=r(30269),b=r(40386),k=r(90852);function _(h,X){if(1&h&&(a.j41(0,"mat-radio-button",6),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&h){const H=X.$implicit,x=a.XpG();a.Y8G("value",H),a.R7$(),a.SpI(" ",a.bMT(2,2,x.getSearchTypeTitle(H))," ")}}let D=(()=>{class h{searchSourceService;searchType$=new R.t(void 0);searchType$$;searchTypes=y.v;set searchType(H){this.setSearchType(H)}get searchType(){return this.searchType$.value}searchTypeChange=new a.bkB;constructor(H){this.searchSourceService=H}ngOnInit(){this.searchType$$=this.searchType$.pipe((0,v.F)()).subscribe(H=>this.onSetSearchType(H))}ngOnDestroy(){this.searchType$$.unsubscribe()}onSearchTypeChange(H){this.setSearchType(H)}getSearchTypeTitle(H){return`igo.geo.search.${H.toLowerCase()}.title`}setSearchType(H){this.searchType$.next(H)}onSetSearchType(H){null!=H&&(this.searchSourceService.enableSourcesByType(H),this.searchTypeChange.emit(H))}static \u0275fac=function(x){return new(x||h)(a.rXU(b.z))};static \u0275cmp=a.VBU({type:h,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},standalone:!0,features:[a.aNF],decls:10,vars:8,consts:[["searchSelectorMenu","matMenu"],[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"no-border-radius"],[1,"igo-search-selector-radio-group",3,"change","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(x,ee){if(1&x){const Z=a.RV6();a.j41(0,"div",1)(1,"button",2),a.nI1(2,"translate"),a.j41(3,"mat-icon"),a.EFF(4,"arrow_drop_down"),a.k0s()(),a.j41(5,"mat-menu",3,0)(7,"mat-radio-group",4),a.nI1(8,"async"),a.bIt("change",function(U){return a.eBV(Z),a.Njj(ee.onSearchTypeChange(U.value))}),a.DNE(9,_,3,4,"mat-radio-button",5),a.k0s()()()}if(2&x){const Z=a.sdS(6);a.R7$(),a.Y8G("matTooltip",a.bMT(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",Z),a.R7$(6),a.Y8G("value",a.bMT(8,6,ee.searchType$)),a.R7$(2),a.Y8G("ngForOf",ee.searchTypes)}},dependencies:[F.Hl,F.iY,o.uc,o.oV,e.Cn,e.kk,e.Cp,p.m_,p.An,c.Wk,c.VT,c._g,M.pM,M.Jj,L.Ck,k.D9],styles:["[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]{border-radius:0}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}"],changeDetection:0})}return h})()},36465:(De,le,r)=>{"use strict";r.d(le,{V:()=>u});var M=r(60316),a=r(68559),F=r(84175),p=r(97024),e=r(14102),c=r(93840),o=r(31034),L=r(53804),R=r(8827),v=r(80640),y=r(21701),b=r(55050),k=r(81681),_=r(12474),D=r(40386),h=r(90852);function X(O,j){if(1&O){const P=a.RV6();a.j41(0,"div",12)(1,"button",13),a.bIt("click",function(w){a.eBV(P);const I=a.XpG();return a.Njj(I.checkUncheckAllSources(w))}),a.EFF(2),a.nI1(3,"translate"),a.nI1(4,"translate"),a.k0s()()}if(2&O){const P=a.XpG();a.R7$(2),a.SpI(" ",P.searchSourcesAllEnabled?a.bMT(4,3,"igo.geo.search.searchSources.selectAll"):a.bMT(3,1,"igo.geo.search.searchSources.unselectAll")," ")}}function H(O,j){if(1&O&&(a.j41(0,"button",18),a.EFF(1),a.k0s()),2&O){const P=a.XpG().$implicit,Y=a.sdS(6);a.Y8G("matMenuTriggerFor",Y),a.R7$(),a.SpI(" ",P.title," ")}}function x(O,j){if(1&O&&(a.j41(0,"button",9),a.EFF(1),a.k0s()),2&O){const P=a.XpG().$implicit;a.R7$(),a.SpI(" ",P.title," ")}}function ee(O,j){if(1&O){const P=a.RV6();a.j41(0,"mat-radio-button",23),a.bIt("click",function(w){return a.eBV(P),a.Njj(w.stopPropagation())})("change",function(w){const I=a.eBV(P).$implicit,E=a.XpG(2).$implicit,s=a.XpG().$implicit,z=a.XpG();return a.Njj(z.settingsValueCheckedRadioButton(w,s,E,I))}),a.EFF(1),a.nI1(2,"translate"),a.k0s()}if(2&O){const P=j.$implicit,Y=a.XpG(4);a.Y8G("value",P)("matTooltip",Y.getAvailableHashtagsValues(P))("checked",P.enabled),a.R7$(),a.SpI(" ",a.bMT(2,4,P.title)," ")}}function Z(O,j){if(1&O&&(a.j41(0,"span")(1,"mat-radio-group",21),a.DNE(2,ee,3,6,"mat-radio-button",22),a.k0s()()),2&O){const P=a.XpG().$implicit;a.R7$(),a.Y8G("value",P),a.R7$(),a.Y8G("ngForOf",P.values)}}function G(O,j){if(1&O){const P=a.RV6();a.j41(0,"div",12)(1,"button",13),a.bIt("click",function(w){a.eBV(P);const I=a.XpG(2).$implicit,E=a.XpG().$implicit,s=a.XpG();return a.Njj(s.checkUncheckAll(w,E,I))}),a.EFF(2),a.nI1(3,"translate"),a.nI1(4,"translate"),a.k0s()()}if(2&O){const P=a.XpG(2).$implicit;a.R7$(2),a.SpI(" ",P.allEnabled||void 0===P.allEnabled?a.bMT(3,1,"igo.geo.search.searchSources.settings.unselectAll"):a.bMT(4,3,"igo.geo.search.searchSources.settings.selectAll")," ")}}function U(O,j){if(1&O){const P=a.RV6();a.j41(0,"div",25)(1,"mat-checkbox",26),a.bIt("click",function(w){return a.eBV(P),a.Njj(w.stopPropagation())})("change",function(w){const I=a.eBV(P).$implicit,E=a.XpG(2).$implicit,s=a.XpG().$implicit,z=a.XpG();return a.Njj(z.settingsValueCheckedCheckbox(w,s,E,I))}),a.EFF(2),a.nI1(3,"translate"),a.k0s()()}if(2&O){const P=j.$implicit,Y=a.XpG(2).$implicit,w=a.XpG(2);a.R7$(),a.xc7("display",w.displayBlock),a.Y8G("checked",P.enabled)("value",Y)("matTooltip",w.getAvailableHashtagsValues(P)),a.R7$(),a.SpI(" ",a.bMT(3,6,P.title)," ")}}function N(O,j){if(1&O&&(a.j41(0,"span"),a.DNE(1,G,5,5,"div",6)(2,U,4,8,"div",24),a.k0s()),2&O){const P=a.XpG().$implicit,Y=a.XpG(2);a.R7$(),a.Y8G("ngIf",P.values.length>3),a.R7$(),a.Y8G("ngForOf",Y.getAvailableValues(P))}}function W(O,j){if(1&O&&(a.qex(0),a.j41(1,"button",18),a.EFF(2),a.nI1(3,"translate"),a.k0s(),a.j41(4,"mat-menu",19,2),a.DNE(6,Z,3,2,"span",20)(7,N,3,2,"span",20),a.k0s(),a.bVm()),2&O){const P=j.$implicit,Y=a.sdS(5);a.R7$(),a.Y8G("matMenuTriggerFor",Y),a.R7$(),a.SpI(" ",a.bMT(3,5,"igo.geo.search.searchSources.settings."+P.title)," "),a.R7$(2),a.Y8G("ngSwitch",P.type),a.R7$(2),a.Y8G("ngSwitchCase","radiobutton"),a.R7$(),a.Y8G("ngSwitchCase","checkbox")}}function A(O,j){if(1&O){const P=a.RV6();a.qex(0),a.j41(1,"span",14)(2,"mat-checkbox",15),a.bIt("click",function(w){return a.eBV(P),a.Njj(w.stopPropagation())})("change",function(w){const I=a.eBV(P).$implicit,E=a.XpG();return a.Njj(E.onCheckSearchSource(w,I))}),a.k0s(),a.DNE(3,H,2,2,"button",16)(4,x,2,1,"button",17),a.k0s(),a.j41(5,"mat-menu",null,1),a.DNE(7,W,8,7,"ng-container",7),a.k0s(),a.bVm()}if(2&O){const P=j.$implicit;a.R7$(2),a.Y8G("checked",P.enabled)("value",P),a.R7$(),a.Y8G("ngIf",P.settings.length>0),a.R7$(),a.Y8G("ngIf",0===P.settings.length),a.R7$(3),a.Y8G("ngForOf",P.settings)}}function g(O,j){if(1&O){const P=a.RV6();a.j41(0,"mat-slide-toggle",11),a.nI1(1,"translate"),a.bIt("change",function(w){a.eBV(P);const I=a.XpG();return a.Njj(I.changePointerReverseSearch(w))})("click",function(w){return a.eBV(P),a.Njj(w.stopPropagation())}),a.EFF(2),a.nI1(3,"translate"),a.k0s()}if(2&O){const P=a.XpG();a.Y8G("matTooltip",a.bMT(1,3,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",P.pointerSummaryEnabled),a.R7$(2),a.SpI(" ",a.bMT(3,5,"igo.geo.search.pointerSearchSummary.title")," ")}}let u=(()=>{class O{searchSourceService;mediaService;storageService;hasPointerReverseSearchSource=!1;searchSourcesAllEnabled=!1;buffer=[];lastKeyTime=Date.now();displayBlock="block";get isTouchScreen(){return this.mediaService.isTouchScreen()}pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;reverseSearchCoordsFormatEnabled=!1;searchSourceChange=new a.bkB;pointerSummaryStatus=new a.bkB;searchResultsGeometryStatus=new a.bkB;reverseSearchCoordsFormatStatus=new a.bkB;handleKeyboardEvent(P){"F2"===P.key&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}constructor(P,Y,w){this.searchSourceService=P,this.mediaService=Y,this.storageService=w}ngOnInit(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}getSearchSources(){const P=this.searchSourceService.getSources().filter(_.cE).filter(I=>I.available&&"map"!==I.getId()&&I.showInSettings),Y=this.searchSourceService.getSources().filter(_.EF).filter(I=>I.available&&"map"!==I.getId()&&I.showInSettings),w=P.concat(Y);return this.computeSourcesCheckAllBehavior(w),w}hasReverseSearchSourcesForPointerSummary(){return!!this.searchSourceService.getEnabledSources().filter(_.yu).length}settingsValueCheckedCheckbox(P,Y,w,I){I.enabled=P.checked,Y.setParamFromSetting(w),this.searchSourceChange.emit(Y)}computeSettingCheckAllBehavior(P){P.allEnabled=void 0===P.allEnabled?!P.values.find(Y=>Y.enabled):!P.allEnabled}computeSourcesCheckAllBehavior(P){const Y=P.filter(I=>I.enabled).length,w=P.filter(I=>!I.enabled).length;this.searchSourcesAllEnabled=!(Y>=w)}checkUncheckAll(P,Y,w){P.stopPropagation(),this.computeSettingCheckAllBehavior(w),w.values.forEach(I=>{I.enabled=w.allEnabled}),Y.setParamFromSetting(w),this.searchSourceChange.emit(Y)}checkUncheckAllSources(P){P.stopPropagation(),this.getSearchSources().map(Y=>{Y.enabled=this.searchSourcesAllEnabled,this.searchSourceChange.emit(Y)})}settingsValueCheckedRadioButton(P,Y,w,I){w.values.forEach(E=>{E.enabled=E.value!==I.value?!P.source.checked:P.source.checked}),Y.setParamFromSetting(w),this.searchSourceChange.emit(Y)}onCheckSearchSource(P,Y){Y.enabled=P.checked;const w=this.storageService.get(Y.getId()+".options")||{};w.enabled=Y.enabled,this.storageService.set(Y.getId()+".options",w),this.searchSourceChange.emit(Y)}getAvailableValues(P){return P.values.filter(Y=>!1!==Y.available)}getAvailableHashtagsValues(P){if(P.hashtags)return P.hashtags.map(Y=>"#"+Y).join(", ")}stopPropagation(P){P.stopPropagation()}changePointerReverseSearch(P){this.pointerSummaryEnabled=P.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}changeSearchResultsGeometry(P){this.searchResultsGeometryEnabled=P.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}reverseSearchCoordsFormat(P){this.reverseSearchCoordsFormatEnabled=P.checked,this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled)}static \u0275fac=function(Y){return new(Y||O)(a.rXU(D.z),a.rXU(b.u1),a.rXU(k.n$))};static \u0275cmp=a.VBU({type:O,selectors:[["igo-search-settings"]],hostBindings:function(Y,w){1&Y&&a.bIt("keydown",function(E){return w.handleKeyboardEvent(E)},!1,a.EBC)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus"},standalone:!0,features:[a.aNF],decls:24,vars:23,consts:[["searchSettingsMenu","matMenu"],["sub_menu","matMenu"],["test_sub_menu","matMenu"],[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],[1,"no-border-radius"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"pointer-summary-slide-toggle-container"],["mat-menu-item",""],["class","search-option","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","change","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500",1,"search-option",3,"change","click","matTooltip","checked"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"click","change","checked","value"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["mat-menu-item","",3,"matMenuTriggerFor"],["yPosition","above",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"click","change","value","matTooltip","checked"],["class","igo-search-settings-sub-menu","mat-menu-item","",4,"ngFor","ngForOf"],["mat-menu-item","",1,"igo-search-settings-sub-menu"],[3,"click","change","checked","value","matTooltip"]],template:function(Y,w){if(1&Y){const I=a.RV6();a.j41(0,"div",3)(1,"button",4),a.nI1(2,"translate"),a.j41(3,"mat-icon"),a.EFF(4,"expand_more"),a.k0s()(),a.j41(5,"mat-menu",5,0),a.DNE(7,X,5,5,"div",6)(8,A,8,5,"ng-container",7),a.nrm(9,"mat-divider"),a.j41(10,"span",8)(11,"div",9),a.DNE(12,g,4,7,"mat-slide-toggle",10),a.k0s(),a.j41(13,"div",9)(14,"mat-slide-toggle",11),a.nI1(15,"translate"),a.bIt("change",function(s){return a.eBV(I),a.Njj(w.changeSearchResultsGeometry(s))})("click",function(s){return a.eBV(I),a.Njj(s.stopPropagation())}),a.EFF(16),a.nI1(17,"translate"),a.k0s()(),a.j41(18,"div",9)(19,"mat-slide-toggle",11),a.nI1(20,"translate"),a.nI1(21,"translate"),a.bIt("change",function(s){return a.eBV(I),a.Njj(w.reverseSearchCoordsFormat(s))})("click",function(s){return a.eBV(I),a.Njj(s.stopPropagation())}),a.EFF(22),a.nI1(23,"translate"),a.k0s()()()()()}if(2&Y){const I=a.sdS(6);a.R7$(),a.Y8G("matTooltip",a.bMT(2,11,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",I),a.R7$(6),a.Y8G("ngIf",w.getSearchSources().length>4),a.R7$(),a.Y8G("ngForOf",w.getSearchSources()),a.R7$(4),a.Y8G("ngIf",w.hasPointerReverseSearchSource&&!w.isTouchScreen),a.R7$(2),a.Y8G("matTooltip",a.bMT(15,13,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",w.searchResultsGeometryEnabled),a.R7$(2),a.SpI(" ",a.bMT(17,15,"igo.geo.search.searchResultsGeometry.title")," "),a.R7$(3),a.Y8G("matTooltip",w.reverseSearchCoordsFormatEnabled?a.bMT(20,17,"igo.geo.search.reverseCoordFormat.tooltipLatLon"):a.bMT(21,19,"igo.geo.search.reverseCoordFormat.tooltipLonLat"))("checked",w.reverseSearchCoordsFormatEnabled),a.R7$(3),a.SpI(" ",a.bMT(23,21,"igo.geo.search.reverseCoordFormat.title")," ")}},dependencies:[F.Hl,F.$z,F.iY,v.uc,v.oV,o.Cn,o.kk,o.fb,o.Cp,c.m_,c.An,M.bT,M.pM,p.g7,p.So,M.ux,M.e1,L.Wk,L.VT,L._g,e.w,e.q,R.mV,R.sG,y.Ck,h.D9],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-right:16px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.search-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px 0}.igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.igo-search-settings-sub-menu[_ngcontent-%COMP%]{min-height:34px}"],changeDetection:0})}return O})()},62739:(De,le,r)=>{"use strict";r.d(le,{d:()=>Z});var M=r(75300),a=r(55050),F=r(68671),p=r(94691),e=r(12912),c=r(66586),o=r(49964),L=r(63886),R=r(2435),v=r(8115),y=r(84540),b=r(3439),k=r(67852),_=r(91640),D=r(42449),h=r(56999),X=r(35876),H=r(12474),x=r(68559),ee=r(40386);let Z=(()=>{class G{component;searchService;searchSourceService;mediaService;store;lonLat;pointerSearchStore=new M.D_([]);lastTimeoutRequest;store$$;layers$$;reverseSearch$$=[];hasPointerReverseSearchSource=!1;pointerMoveListener;searchPointerSummaryFeatureId="searchPointerSummaryFeatureId";igoSearchPointerSummaryDelay=1e3;igoSearchPointerSummaryEnabled=!1;mouseleave(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(N,W,A,g){this.component=N,this.searchService=W,this.searchSourceService=A,this.mediaService=g}ngOnInit(){this.listenToMapPointerMove(),this.map.status$.pipe((0,R.$)(N=>N===F.Bi.Done)).subscribe(()=>{this.store=new k.o([],{map:this.map}),this.initStore(),this.subscribeToPointerStore()}),this.layers$$=this.map.layers$.subscribe(N=>{this.store&&!N.find(W=>"searchPointerSummaryId"===W.id)&&this.initStore()})}initStore(){const N=this.store,W=new _.v({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new v._,showInLayerList:!1,exportable:!1,browsable:!1,style:h.gO});(0,y.d)(N,W)}ngAfterContentChecked(){this.hasPointerReverseSearchSource=!!this.searchSourceService.getEnabledSources().filter(H.yu).length}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerSearchStore.entities$.subscribe(N=>{this.entitiesToPointerOverlay(N)})}computeSummaryClosestFeature(N){const W={};return N.map(A=>{A.data.properties.type&&A.data.properties.distance>=0&&(W.hasOwnProperty(A.data.properties.type)?A.data.properties.distance<W[A.data.properties.type].distance&&(W[A.data.properties.type]={distance:A.data.properties.distance,title:A.meta.pointerSummaryTitle||A.meta.title}):W[A.data.properties.type]={distance:A.data.properties.distance,title:A.meta.pointerSummaryTitle||A.meta.title})}),W}entitiesToPointerOverlay(N){const W=this.computeSummaryClosestFeature(N),A=Object.keys(W),g=[],u=[];N.map(O=>{const j=A.indexOf(O.data.properties.type);-1!==j?(u.push(W[O.data.properties.type].title),A.splice(j,1),g.push(O.data.properties.type)):-1===g.indexOf(O.data.properties.type)&&u.push(O.meta.pointerSummaryTitle||O.meta.title)}),u.length&&this.addPointerOverlay(u.join("\n"))}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",N=>this.onMapEvent(N))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unsubscribeReverseSearch(){this.reverseSearch$$.map(N=>N.unsubscribe()),this.reverseSearch$$=[]}unlistenToMapPointerMove(){(0,e.e)(this.pointerMoveListener),this.pointerMoveListener=void 0}onMapEvent(N){!N.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?(typeof this.lastTimeoutRequest<"u"&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=(0,L.pd)(N.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(()=>{this.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()}sortByOrder(N,W){return N.source.displayOrder-W.source.displayOrder}onSearchCoordinate(){this.pointerSearchStore.clear();const N=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0);for(const W in N)N.length>0&&this.reverseSearch$$.push(N[W].request.subscribe(A=>{this.onSearch({research:N[W],results:A})}))}onSearch(N){const W=N.results,A=this.pointerSearchStore.all().filter(g=>g.source!==N.research.source).concat(W);this.pointerSearchStore.load(A.sort(this.sortByOrder))}addPointerOverlay(N){this.clearLayer();const W=new o.A((0,L.pd)(this.lonLat,"EPSG:4326",this.mapProjection)),A=new p.A({geometry:W}),g=(new c.A).writeGeometryObject(W,{featureProjection:this.mapProjection,dataProjection:this.mapProjection});this.store.setLayerFeatures([{type:b.R,geometry:g,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:N},meta:{id:this.searchPointerSummaryFeatureId},ol:A}],b.B.None)}clearLayer(){this.store&&this.store.clearLayer()}static \u0275fac=function(W){return new(W||G)(x.rXU(D.K,2),x.rXU(X.S),x.rXU(ee.z),x.rXU(a.u1))};static \u0275dir=x.FsC({type:G,selectors:[["","igoSearchPointerSummary",""]],hostBindings:function(W,A){1&W&&x.bIt("mouseleave",function(){return A.mouseleave()})},inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"},standalone:!0})}return G})()},40386:(De,le,r)=>{"use strict";r.d(le,{z:()=>M});class M{sources;constructor(F){this.sources=F}getSources(){return this.sources}getEnabledSources(){return this.getSources().filter(F=>!0===F.enabled)}enableSourcesByType(F){this.getSources().forEach(p=>{p.enabled=p.constructor.type===F})}setParamFromSetting(F,p){F.setParamFromSetting(p)}setWorkspaces(F,p){F.setWorkspaces(p)}}},30269:(De,le,r)=>{"use strict";r.d(le,{v:()=>F});var M=r(3439),a=r(81081);const F=[M.R,a.I]},35876:(De,le,r)=>{"use strict";r.d(le,{S:()=>L});var M=r(68559),a=r(95374),F=r(81681),p=r(64004),e=r(12474),c=r(40386),o=r(52314);let L=(()=>{class R{searchSourceService;mapService;storageService;analyticsService;searchTerm=(0,M.vPA)(null);constructor(y,b,k,_,D){this.searchSourceService=y,this.mapService=b,this.storageService=k,this.analyticsService=_,D&&this.handleAnalytics()}handleAnalytics(){(0,M.QZP)(()=>{const y=this.searchTerm();null!=y&&this.analyticsService.trackSearch(y,null)})}search(y,b={}){if(!this.termIsValid(y))return[];this.searchTerm.set(y);const k=this.mapService.getMap()?.projection||"EPSG:3857",_=(0,p.vm)(y,k,{forceNA:b.forceNA});if(_.lonLat)return this.reverseSearch(_.lonLat,{distance:_.radius,conf:_.conf});let D;return _.message&&console.log(_.message),b.extent=this.mapService.getMap()?.viewController.getExtent("EPSG:4326"),D=b.getEnabledOnly||void 0===b.getEnabledOnly?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),b.sourceId?D=D.filter(h=>h.getId()===b.sourceId):b.searchType&&(D=D.filter(h=>h.getType()===b.searchType)),D=D.filter(e.cE),this.searchSources(D,y,b)}reverseSearch(y,b,k=!1){const _=k?e.yu:e.EF,D=this.searchSourceService.getEnabledSources().filter(_),h=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1;return this.reverseSearchSources(D,y,b||{},h)}searchSources(y,b,k){return y.map(_=>({request:_.search(b,k),reverse:!1,source:_}))}reverseSearchSources(y,b,k,_){return y.map(D=>({request:D.reverseSearch(b,k,_),reverse:!0,source:D}))}termIsValid(y){return"string"==typeof y&&""!==y}static \u0275fac=function(b){return new(b||R)(M.KVO(c.z),M.KVO(o.u),M.KVO(F.n$),M.KVO(a.c),M.KVO("searchAnalytics",8))};static \u0275prov=M.jDH({token:R,factory:R.\u0275fac})}return R})()},12474:(De,le,r)=>{"use strict";function a(L){return void 0!==L.search}function F(L){return void 0!==L.reverseSearch}function p(L){return void 0!==L.reverseSearch&&!0===L.showInPointerSummary}function c(L,R){let v="";return R.split("").forEach((y,b)=>{y!==L.charAt(b)&&(v+=y)}),v}function o(L,R,v=!1){if(!L||!R)return 0;const y=v?L:L.toString().toLowerCase(),b=v?R:R.toString().toLowerCase(),D=c(y,b)+c(b,y);let h=0;return D.length&&(h=D.length/y.length*100),100-Math.floor(h)}r.d(le,{EF:()=>F,H_:()=>o,cE:()=>a,yu:()=>p}),r(3439)},24891:(De,le,r)=>{"use strict";r.d(le,{C:()=>a});var M=r(68671);let a=(()=>class F{storageService;static id="";static type="";options;getId(){throw new Error('You have to implement the method "getId".')}getType(){throw new Error('You have to implement the method "getType".')}getDefaultOptions(){throw new Error('You have to implement the method "getDefaultOptions".')}get title(){return this.options.title}get available(){return!1!==this.options.available}set enabled(e){this.options.enabled=e}get enabled(){return this.available&&!1!==this.options.enabled}get showInPointerSummary(){return this.options.showInPointerSummary||!1}get showInSettings(){const e=this.options.showInSettings;return void 0===e||e}get searchUrl(){return this.options.searchUrl}get params(){return this.options.params}get settings(){return void 0===this.options.settings?[]:this.options.settings}set featureStoresWithIndex(e){this._featureStoresWithIndex=e}get featureStoresWithIndex(){return this._featureStoresWithIndex}_featureStoresWithIndex;setWorkspaces(e){this.options.available=e.filter(L=>L.entityStore.searchDocument).length>=1;const c=[];this.featureStoresWithIndex=e.filter(L=>L.entityStore.searchDocument).map(L=>(c.push({title:L.title,value:L.title,enabled:!0}),L.entityStore));const o=this.options.settings.find(L=>"datasets"===L.title);o&&(o.values=c),this.setParamFromSetting(o)}setParamFromSetting(e,c=!0){switch(e.type){case"radiobutton":e.values.forEach(L=>{L.enabled&&(this.options.params=Object.assign(this.options.params||{},{[e.name]:L.value}))});break;case"checkbox":let o="";e.values.filter(L=>!1!==L.available).forEach(L=>{L.enabled&&(o+=L.value+",")}),o=o.slice(0,-1),this.options.params=Object.assign(this.options.params||{},{[e.name]:o})}c&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}get displayOrder(){return void 0===this.options.order?99:this.options.order}constructor(e,c){if(this.storageService=c,this.options=e,this.storageService){const o=this.storageService.get(this.getId()+".options");o&&(this.options=M.BF.mergeDeep(this.options,o))}this.options=M.BF.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(o=>{this.setParamFromSetting(o,!1)})}getHashtagsValid(e,c){const o=e.match(/(#[A-Za-z\xc0-\xff-+]+)/g);if(!o)return;const L=this.getSettingsValues(c),R=[];return o.forEach(v=>{L.values.forEach(y=>{const b=v.substring(1);if("string"==typeof y.value){const k=y.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),_=k.indexOf(b.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==_&&R.push(k[_])}y.hashtags&&-1!==y.hashtags.indexOf(b.toLowerCase())&&R.push(y.value)})}),R.filter((v,y)=>R.indexOf(v)===y)}getSettingsValues(e){return this.getDefaultOptions().settings.find(c=>c.name===e)}})()},25583:(De,le,r)=>{"use strict";r.d(le,{i:()=>R});var M=r(63886),a=r(29814),F=r(2844),p=r(18194),e=r(57690),c=r(1963),o=r(61099),L=r(61938);class R{_converters;_renderers;constructor(){this._converters={},this._converters.esriPMS=R._convertEsriPMS,this._converters.esriSFS=R._convertEsriSFS,this._converters.esriSLS=R._convertEsriSLS,this._converters.esriSMS=R._convertEsriSMS,this._converters.esriTS=R._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}static _convertPointToPixel(y){return y/.75}static _transformColor(y){return[y[0],y[1],y[2],y[3]/255]}static _getResolutionForScale(y,b){const _=M.Ig[b];return parseFloat(y)/(39.3701*_*96)}static _convertEsriTS(y){const b=R._transformAngle(y.angle),k=void 0!==y.text?y.text:void 0;return new a.Ay({text:new F.A({fill:new p.A({color:R._transformColor(y.color)}),font:y.font.style+" "+y.font.weight+" "+y.font.size+" px "+y.font.family,textBaseline:y.verticalAlignment,textAlign:y.horizontalAlignment,offsetX:R._convertPointToPixel(y.xoffset),offsetY:R._convertPointToPixel(y.yoffset),rotation:b,text:k})})}static _convertEsriPMS(y){const b="data:"+y.contentType+";base64, "+y.imageData,k=R._transformAngle(y.angle);return new a.Ay({image:new e.A({src:b,rotation:k})})}static _convertEsriSFS(y){const b=new p.A({color:R._transformColor(y.color)}),k=y.outline?R._convertOutline(y.outline):void 0;return new a.Ay({fill:b,stroke:k})}static _convertOutline(y){let b;const k=R._transformColor(y.color);return"esriSLSDash"===y.style?b=[5]:"esriSLSDashDot"===y.style?b=[5,5,1,2]:"esriSLSDashDotDot"===y.style?b=[5,5,1,2,1,2]:"esriSLSDot"===y.style?b=[1,2]:"esriSLSNull"===y.style&&(k[3]=0),new c.A({color:k,lineDash:b,width:R._convertPointToPixel(y.width)})}static _convertEsriSLS(y){return new a.Ay({stroke:R._convertOutline(y)})}static _transformAngle(y){if(0===y||void 0===y)return;const k=-y*Math.PI/180+Math.PI/2;return k<0?2*Math.PI+k:k}static _convertEsriSMS(y){const b=new p.A({color:R._transformColor(y.color)}),k=y.outline?R._convertOutline(y.outline):void 0,_=R._convertPointToPixel(y.size)/2,D=R._transformAngle(y.angle);return"esriSMSCircle"===y.style?new a.Ay({image:new o.A({radius:_,fill:b,stroke:k})}):"esriSMSCross"===y.style?new a.Ay({image:new L.A({fill:b,stroke:k,points:4,radius:_,radius2:0,angle:0,rotation:D})}):"esriSMSDiamond"===y.style?new a.Ay({image:new L.A({fill:b,stroke:k,points:4,radius:_,rotation:D})}):"esriSMSSquare"===y.style?new a.Ay({image:new L.A({fill:b,stroke:k,points:4,radius:_,angle:Math.PI/4,rotation:D})}):"esriSMSX"===y.style?new a.Ay({image:new L.A({fill:b,stroke:k,points:4,radius:_,radius2:0,angle:Math.PI/4,rotation:D})}):"esriSMSTriangle"===y.style?new a.Ay({image:new L.A({fill:b,stroke:k,points:3,radius:_,angle:0,rotation:D})}):void 0}_convertLabelingInfo(y,b){const k=[];for(let _=0,D=y.length;_<D;++_){const h=y[_].labelExpression,X=h.substr(h.indexOf("[")+1,h.indexOf("]")-1),H=y[_].symbol,x=y[_].maxScale,ee=y[_].minScale;let Z=null;0!==x&&(Z=R._getResolutionForScale(x,b));let G=null;0!==ee&&(G=R._getResolutionForScale(ee,b));const U=this._converters[H.type].call(this,H);k.push(function(N,W){let A=!0;if(null!==this.minResolution&&null!==this.maxResolution?A=W<this.maxResolution&&W>=this.minResolution:null!==this.minResolution?A=W>=this.minResolution:null!==this.maxResolution&&(A=W<this.maxResolution),A){const g=N.get(this.field);return this.style.getText().setText(g),[this.style]}}.bind({minResolution:Z,maxResolution:G,field:X,style:U}))}return k}_renderSimple(y){const b=this._converters[y.symbol.type].call(this,y.symbol);return()=>[b]}_renderClassBreaks(y){const b=y.defaultSymbol,k=this._converters[b.type].call(this,b),_=y.field,D=[];for(let h=0,X=y.classBreakInfos.length;h<X;++h){const H=y.classBreakInfos[h];let x;x=null==H.classMinValue?0===h?y.minValue:y.classBreakInfos[h-1].classMaxValue:H.classMinValue;const ee=H.classMaxValue,Z=H.symbol,G=this._converters[Z.type].call(this,Z);D.push({min:x,max:ee,style:G})}return h=>{const X=h.get(_);for(let H=0,x=D.length;H<x;++H){let ee;if(ee=0===H?X>=D[H].min&&X<=D[H].max:X>D[H].min&&X<=D[H].max,ee)return[D[H].style]}return[k]}}_renderUniqueValue(y){const b=y.defaultSymbol;let k=[];b&&(k=[this._converters[b.type].call(this,b)]);const _=y.field1,D=y.uniqueValueInfos,h=this;return(()=>{const X={};for(let H=0,x=D.length;H<x;++H){const ee=D[H],Z=ee.symbol;X[ee.value]=[h._converters[Z.type].call(h,Z)]}return H=>X[H.get(_)]||k})()}generateStyle(y,b){const k=y.drawingInfo;let _=[];const D=this._renderers[k.renderer.type].call(this,k.renderer);if(void 0!==D&&_.push(D),y.labelingInfo){const h=this._convertLabelingInfo(y.labelingInfo,b);_=_.concat(h)}return 1===_.length?_[0]:(h,X)=>{let H=[];for(let x=0,ee=_.length;x<ee;++x){const Z=_[x].call(null,h,X);Z&&(H=H.concat(Z))}return H}}}},56999:(De,le,r)=>{"use strict";r.d(le,{aK:()=>y,gO:()=>b,l7:()=>v,tp:()=>R});var M=r(68671),a=r(1963),F=r(18194),p=r(29814),e=r(61099),c=r(2844),o=r(57690),L=r(32780);function R(){const k=Math.floor(255*Math.random()),_=Math.floor(255*Math.random()),D=Math.floor(255*Math.random()),h=new a.A({color:[k,_,D,1],width:2}),X=new F.A({color:[k,_,D,.4]});return(H,x)=>{const ee=H.get("_style");if(ee&&(0,M.zM)(ee)){if(ee.circle&&H.get("rad")&&H.get("longitude")&&H.get("latitude")){const U=[H.get("longitude"),H.get("latitude")],N=H.get("rad")/Math.cos(Math.PI/180*U[1])/x;ee.circle.radius=N}return(new L.J).createStyle(ee,void 0,x)}return new p.Ay({stroke:h,fill:X,image:new e.A({radius:5,stroke:h,fill:X}),text:H.get("_mapTitle")?new c.A({text:H.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new F.A({color:"#000"}),stroke:new a.A({color:"#fff",width:3}),overflow:!0}):void 0})}}function v(){const k=Math.floor(255*Math.random()),_=Math.floor(255*Math.random()),D=Math.floor(255*Math.random()),h=new a.A({color:[k,_,D,1],width:2}),X=new F.A({color:[k,_,D,.4]});return new p.Ay({stroke:h,fill:X,image:new e.A({radius:5,stroke:h,fill:X})})}function y(k,_){const h=[new p.Ay({text:new c.A({text:k.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new F.A({color:"#000"}),backgroundFill:new F.A({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new a.A({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new a.A({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];return"Point"===k.getGeometry().getType()?h.push(new p.Ay({image:new e.A({radius:10,stroke:new a.A({color:"blue",width:3})})})):(h.push(new p.Ay({stroke:new a.A({color:"white",width:5})})),h.push(new p.Ay({stroke:new a.A({color:"blue",width:3})}))),h}function b(k,_){return new p.Ay({image:new o.A({src:"./assets/igo2/geo/icons/cross_black_18px.svg"}),text:new c.A({text:k.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new F.A({color:"#000"}),backgroundFill:new F.A({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new a.A({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new a.A({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}},42525:(De,le,r)=>{"use strict";r.d(le,{O:()=>o});var M=r(17041),a=r(29814),F=r(57690),p=r(2844),e=r(18194),c=r(1963);function o({text:L,opacity:R=1,markerColor:v=[0,161,222],markerOutlineColor:y=[255,255,255]}={}){let b,k,_,D;const h=(0,M._j)(v).slice(0),X=(0,M._j)(y).slice(0);return 4===h.length&&("string"!=typeof v||/^#[0-9A-F]{8}$/i.test(v))&&(R=h[3]),k=`"rgba(${h[0]},${h[1]},${h[2]},${R})"`,b=v,_=`"rgb(${X[0]},${X[1]},${X[2]})"`,D='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+k+" stroke="+_+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>',new a.Ay({image:new F.A({src:D,opacity:R,anchor:[.5,.92]}),text:new p.A({text:L,font:"12px Calibri,sans-serif",fill:new e.A({color:"#000"}),stroke:new c.A({color:"#fff",width:3}),overflow:!0})})}},31736:(De,le,r)=>{"use strict";r.d(le,{Z:()=>R,l:()=>v});var M=r(17041),a=r(1963),F=r(18194),p=r(29814),e=r(61099),c=r(2844),o=r(32780),L=r(42525);function R(){const b=v(),k=(0,L.O)();let _;return(D,h)=>{if("bufferFeature"===D.getId())return _=function y(b=[0,161,222,1],k=2,_=[0,161,222,.15],D){const h=new a.A({width:k,color:b}),X=new F.A({color:_});return new p.Ay({stroke:h,fill:X,image:new e.A({radius:5,stroke:h,fill:X}),text:new c.A({font:"12px Calibri,sans-serif",text:D,fill:new F.A({color:"#000"}),stroke:new a.A({color:"#fff",width:3}),overflow:!0})})}(D.get("bufferStroke"),2,D.get("bufferFill"),D.get("bufferText")),_;{const X=D.get("_style");return X?(new o.J).createStyle(X,D,h):(_="Point"===D.getGeometry().getType()?k:b,_.getText().setText(D.get("_mapTitle")),_)}}}function v({text:b,strokeWidth:k=2,fillColor:_=[0,161,222,.3],strokeColor:D=[0,161,222,.9]}={}){const h=(0,M._j)(_).slice(0),X=(0,M._j)(D).slice(0),H=new a.A({width:k,color:X}),x=new F.A({color:h});return new p.Ay({stroke:H,fill:x,image:new e.A({radius:5,stroke:H,fill:x}),text:new c.A({text:b,font:"12px Calibri,sans-serif",fill:new F.A({color:"#000"}),stroke:new a.A({color:"#fff",width:3}),overflow:!0})})}},32780:(De,le,r)=>{"use strict";r.d(le,{J:()=>k});var M=r(94691),a=r(29814),F=r(18652),p=r(61938),e=r(18194),c=r(1963),o=r(2844),L=r(57690),R=r(61099),v=r(64004),y=r(42525),b=r(68559);let k=(()=>{class _{style;createStyle(h,X,H){if(!h)return(0,y.O)();if("function"==typeof h||h instanceof a.Ay)return h;const x=this.parseStyle("style",h);if(x.getText()){let ee=0,Z=1/0;if(h.text){const G=h.text?.minScaleDenom?(0,v.HB)(Number(h.text.minScaleDenom)):void 0,U=h.text?.maxScaleDenom?(0,v.HB)(Number(h.text.maxScaleDenom)):void 0;ee=G||(h.text?.minResolution?h.text.minResolution:0),Z=U||(h.text?.maxResolution?h.text.maxResolution:1/0)}(h.text?.minScaleDenom||h.text?.maxScaleDenom||h.text?.minResolution||h.text?.maxResolution)&&(X&&H>=ee&&H<=Z?X&&h.text.attribute&&x.getText().setText(this.getLabel(X,h.text.attribute)):x.setText())}return x}parseStyle(h,X){const H={},x=this.getOlCls(h);return x&&X instanceof Object?(Object.keys(X).forEach(ee=>{const Z=this.getOlKey(ee);H[Z]=this.parseStyle(ee,X[ee])}),new x(H)):X}getOlKey(h){let X;switch(h.toLowerCase()){case"circle":case"regularshape":case"icon":X="image"}return X||h}getOlCls(h){let X=F[h.charAt(0).toUpperCase()+h.slice(1)];return"regularshape"===h&&(X=p.A),"backgroundFill"===h&&(X=e.A),"backgroundStroke"===h&&(X=c.A),X}createStyleByAttribute(h,X,H){let x;const ee=X.type?X.type:this.guessTypeFeature(h),Z=X.attribute,G=X.data,U=X.stroke,N=X.width,W=X.fill,A=X.anchor,g=X.radius,u=X.icon,O=X.scale,j=G?G.length:0,P=X.label?X.label.attribute:void 0,Y=X.label?.minScaleDenom?(0,v.HB)(Number(X.label.minScaleDenom)):void 0,w=X.label?.maxScaleDenom?(0,v.HB)(Number(X.label.maxScaleDenom)):void 0,s=Y||(X.label?.minResolution?X.label.minResolution:0),z=w||(X.label?.maxResolution?X.label.maxResolution:1/0);let Q=X.label?.style?this.parseStyle("text",X.label.style):void 0;!Q&&P&&(Q=new o.A);const ae=X.baseStyle;if(Q&&Q.setText(H>=s&&H<=z?this.getLabel(h,P):""),"circle"===ee){for(let ye=0;ye<j;ye++){const de=typeof h.get(Z)<"u"&&null!==h.get(Z)?h.get(Z):"";if(de===G[ye]||de.toString().match(new RegExp(G[ye],"gmi")))return u?(x=[new a.Ay({image:new L.A({color:W?W[ye]:void 0,src:u[ye],scale:O?O[ye]:1,anchor:A?A[ye]:[.5,.5]}),text:Q instanceof o.A?Q:void 0})],x):(x=[new a.Ay({image:new R.A({radius:g?g[ye]:4,stroke:new c.A({color:U?U[ye]:"black",width:N?N[ye]:1}),fill:new e.A({color:W?W[ye]:"black"})}),text:Q instanceof o.A?Q:void 0})],x)}if(!h.getStyle())return ae?(x=this.createStyle(ae,h,H),Q&&x.setText(Q),x):(x=[new a.Ay({image:new R.A({radius:4,stroke:new c.A({color:"black"}),fill:new e.A({color:"#bbbbf2"})})})],x)}else if("regular"===ee){for(let ye=0;ye<j;ye++){const de=typeof h.get(Z)<"u"&&null!==h.get(Z)?h.get(Z):"";if(de===G[ye]||de.toString().match(new RegExp(G[ye],"gmi")))return x=[new a.Ay({stroke:new c.A({color:U?U[ye]:"black",width:N?N[ye]:1}),fill:new e.A({color:W?W[ye]:"rgba(255,255,255,0.4)"}),text:Q instanceof o.A?Q:void 0})],x}if(h instanceof M.A&&!h.getStyle())return ae?(x=this.createStyle(ae,h,H),Q&&x.setText(Q),x):(x=[new a.Ay({stroke:new c.A({color:"black"}),fill:new e.A({color:"#bbbbf2"})})],x)}}createClusterStyle(h,X,H={},x){let ee;const Z=h.get("features").length;if(1!==Z){if(H.clusterRanges)for(const G of H.clusterRanges)if((!G.minRadius||G.minRadius<=Z)&&(!G.maxRadius||G.maxRadius>=Z)){if(ee=this.createStyle(G.style),G.showRange){const U=new o.A({text:Z.toString(),fill:new e.A({color:"#fff"})});ee.setText(U)}if(G.dynamicRadius){let U;const N=ee.getRadius();U=5*Math.log(Z),U<N&&(U=N),ee.image_.setRadius(U)}break}if(!ee){let G;H.radiusCalc?G=H.radiusCalc(Z):(G=5*Math.log(Z),G<6&&(G=6)),ee=[new a.Ay({image:new R.A({radius:G,stroke:new c.A({color:"black"}),fill:new e.A({color:"rgba(24, 134, 45, 0.5)"})}),text:new o.A({text:Z.toString(),fill:new e.A({color:"#fff"})})})]}}else ee=this.createStyle(x,h,X);return ee}getLabel(h,X){let H=X;if(!H)return;const x=Array.from(X.matchAll(/\$\{([^\{\}]+)\}/g));return x.forEach(ee=>{H=H.replace(ee[0],h.get(ee[1]))}),0===x.length&&H===X&&(H=h.get(X)||X),H}guessTypeFeature(h){switch(h.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}static \u0275fac=function(X){return new(X||_)};static \u0275prov=b.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},19807:(De,le,r)=>{"use strict";r.d(le,{FN:()=>y,_E:()=>F});var M=r(68671),a=r(31191);function F(b){return({wms:p,wmts:e,xyz:c,feature:o,wfs:L,arcgisrest:R,imagearcgisrest:R,tilearcgisrest:R,osm:D=>"OSM",tiledebug:D=>"tiledebug"}[b.type]||v)(b)}function p(b){const k=b.params.LAYERS,D="wms"+y(b.url)+k;return a.VV.hashStr(D)}function e(b){const k=b.layer,D="wmts"+y(b.url)+k;return a.VV.hashStr(D)}function c(b){const _="xyz"+y(b.url);return a.VV.hashStr(_)}function o(b){if(!b.url)return v();const _="feature"+y(b.url);return a.VV.hashStr(_)}function L(b){if(!b.url||!b.params)return v();const _="wfs"+y(b.url)+b.params.featureTypes;return a.VV.hashStr(_)}function R(b){const k=b.layer,_=y(b.url);return a.VV.hashStr((b.type||"arcgis")+_+k)}function v(b){return(0,M.uR)()}function y(b){const _=("/"===b.charAt(0)?window.location.origin+b:b).split(/[?&]/);let D=_.shift();const h=_.filter(X=>0!==X.length&&"_"!==X.charAt(0));return h.length&&(D+="?"+h.join("&")),D}},19032:(De,le,r)=>{"use strict";r.d(le,{DiI:()=>Al,eTW:()=>Bl,HGc:()=>Jp,U7x:()=>ft.U7,n_V:()=>Zt.n,ciq:()=>p.c,S6C:()=>w,E6t:()=>fs,i9p:()=>ic,gIZ:()=>Wa,_Th:()=>Mr,RI9:()=>kt.RI,_kc:()=>ft._k,_UF:()=>kt._U,BlV:()=>kt.Bl,oEt:()=>kt.oE,n6d:()=>kt.n6,ZA3:()=>kt.ZA,ur0:()=>nc,xLv:()=>z.xL,viy:()=>To,hUG:()=>z.hU,qcC:()=>c,YvR:()=>Yp,y6n:()=>z.y6,Qlh:()=>Ld,izC:()=>yp,Qmf:()=>Ap,poF:()=>qa,Xy5:()=>z.Xy,N8E:()=>al,S3U:()=>Os,cBF:()=>pl,Lnt:()=>Ds,$zv:()=>tr,BY8:()=>oe.BY,KnQ:()=>z.Kn,uk7:()=>z.uk,$Rc:()=>J.$R,w4o:()=>J.w4,LU:()=>Rs,rBO:()=>Gn,sQD:()=>ee.s,kSP:()=>Rl,uMK:()=>Jo,U9N:()=>C,JeN:()=>ne,KQ4:()=>cm,wes:()=>z.we,NDo:()=>qd,vMP:()=>z.vM,gvR:()=>pn.gv,DGK:()=>pn.DG,we_:()=>z.dT,ULV:()=>_i.UL,Ecg:()=>$s.E,Mni:()=>Ls.M,zA1:()=>As.z,J_O:()=>Ba,KXJ:()=>W,_We:()=>O,R22:()=>N,Q5v:()=>Va,ErE:()=>_i.Er,$h6:()=>_i.$h,Zr3:()=>_i.Zr,bhg:()=>Ts,$AX:()=>Gp,JwY:()=>qi.J,tsz:()=>Na,i8R:()=>Tr,qEv:()=>Ya,TPU:()=>bs,Zv:()=>h.Z,UMS:()=>h.U,IbQ:()=>oe.Ib,jFp:()=>dl,vK2:()=>oe.vK,nH3:()=>z.nH,KV8:()=>Ks,kjk:()=>Lm,LzH:()=>z.Lz,M8B:()=>kt.M8,A5L:()=>z.A5,O5R:()=>ec.O,M2o:()=>kt.M2,l7K:()=>wr.l7,tpu:()=>wr.tp,xHV:()=>kt.xH,asi:()=>kt.as,WJb:()=>kt.WJ,A1A:()=>z.A1,DLO:()=>kr,a72:()=>tc,zHQ:()=>Im,mc1:()=>J.mc,p67:()=>kt.p6,Tww:()=>Fm,vQ1:()=>tm,yVI:()=>um,hou:()=>z.ho,cE5:()=>On.cE,JVX:()=>Ep,FHQ:()=>rm,FXP:()=>Cm,HhX:()=>z.Hh,FUe:()=>z.FU});var M=r(68077),a=r(24335),F=r(94663),p=r(49130),e=r(68559);let c=(()=>{class l{static forRoot(){return{ngModule:l}}static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[p.c,a.f,M.f,F.g]})}return l})();var o=r(60316),L=r(84175),R=r(93840),v=r(80640),y=r(21701),k=(r(98742),r(1455)),_=r(63886),D=r(41196),h=r(14114),X=r(69824),H=r(61134);let x=(()=>{class l{constructor(){}filterByDate(t,n){let i,d,T,B;if(Array.isArray(n)){const fe=[];n[0]&&(T=this.reformatDateTime(n[0]),fe.push(n[0])),n[1]&&(B=this.reformatDateTime(n[1]),fe.push(n[1])),2===fe.length&&T!==B&&(i=t instanceof X.H?T+","+B:T+"/"+B),T===B&&(i=T)}else n&&(d=this.reformatDateTime(n),i=d);t.ol.updateParams({TIME:i}),t instanceof H.T&&t.setTimeFilter(t.timeFilter,!0)}filterByYear(t,n){let i,d,T;if(Array.isArray(n)){const me=[];n[0]&&(d=n[0],me.push(n[0])),n[1]&&(T=n[1],me.push(n[1])),2===me.length&&d!==T&&(i=t instanceof X.H?d+","+T:d+"/"+T),d===T&&(i=d)}else i=n;t.ol.updateParams({TIME:i}),t instanceof H.T&&t.setTimeFilter(t.timeFilter,!0)}reformatDateTime(t){const n=t.getFullYear();let i=t.getMonth()+1,d=t.getUTCDate(),T=t.getUTCHours(),B=t.getUTCMinutes();return Number(i)<10&&(i="0"+i),Number(d)<10&&(d="0"+d),Number(T)<10&&(T="0"+T),Number(B)<10&&(B="0"+B),n+"-"+i+"-"+d+"T"+T+":"+B+":00Z"}static \u0275fac=function(n){return new(n||l)};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();var ee=r(66400),Z=r(17027);let G=(()=>{class l{constructor(){}filterByOgc(t,n){const i=(new Z.l).formatProcessedOgcFilter(n,t.options.params.LAYERS);t.ol.updateParams({FILTER:i})}setOgcWFSFiltersOptions(t){const n=t.options,i=new Z.l;n.ogcFilters.enabled&&n.ogcFilters.filters&&(n.ogcFilters.filters=i.checkIgoFiltersProperties(n.ogcFilters.filters,n.paramsWFS.fieldNameGeometry,new D.A({code:n.paramsWFS.srsName}),!0),n.ogcFilters.interfaceOgcFilters||(n.ogcFilters.interfaceOgcFilters=i.defineInterfaceFilterSequence(n.ogcFilters.filters,n.paramsWFS.fieldNameGeometry)))}setOgcWMSFiltersOptions(t){const n=t.options,i=new Z.l;n.ogcFilters.enabled&&n.ogcFilters.filters?(n.ogcFilters.filters=i.checkIgoFiltersProperties(n.ogcFilters.filters,n.fieldNameGeometry,void 0,!0),n.ogcFilters.interfaceOgcFilters||(n.ogcFilters.interfaceOgcFilters=i.defineInterfaceFilterSequence(n.ogcFilters.filters,n.fieldNameGeometry)),this.filterByOgc(t,i.buildFilter(n.ogcFilters.filters,void 0,void 0,void 0,t.options)),n.filtered=!0):(n.ogcFilters.filters=void 0,n.ogcFilters.interfaceOgcFilters=[],n.filtered=!1)}static \u0275fac=function(n){return new(n||l)};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();var N=function(l){return l.Predefined="Predefined",l.Polygon="Polygon",l.Point="Point",l}(N||{}),W=function(l){return l.Address="Address",l.Thematics="Thematics",l}(W||{}),A=r(67143),g=r(70271),u=r(46443);let O=(()=>{class l{http;languageService;configService;baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/";urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"};constructor(t,n,i){this.http=t,this.languageService=n,this.configService=i,this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}getKeyByValue(t,n){return Object.keys(t).find(i=>t[i]===n)}loadFilterList(t){if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe((0,g.T)(i=>i.features.map(d=>(d.meta={id:d.properties.code},d))))}loadThematicsList(){const n=[];return this.http.get(this.baseUrl+"types").pipe((0,g.T)(i=>(i.forEach(d=>{if(d.startsWith("lieux")){const T={name:void 0,source:d};let B=d.substring(6,d.length),me=B;if(B.includes(".")){const fe=B.indexOf(".");me=B.substring(fe+1,B.length),B=B.substring(0,fe)}try{T.name=this.languageService.translate.instant("igo.geo.terrapi."+me)}catch{T.name=me.substring(0,1).toUpperCase()+me.substring(1,me.length-1)}try{T.group=this.languageService.translate.instant("igo.geo.spatialFilter.group."+B)}catch{T.group=B.substring(0,1).toUpperCase()+B.substring(1,me.length-1)}n.push(T)}else if(this.getKeyByValue(this.urlFilterList,d)){const T={name:void 0,source:d},B=this.getKeyByValue(this.urlFilterList,d);try{T.name=this.languageService.translate.instant("igo.geo.terrapi."+B)}catch{T.name=B.substring(0,1).toUpperCase()+B.substring(1,B.length-1)}T.source=d,n.push(T)}}),n)))}loadFilterItem(t,n,i,d,T){if(i){const me=this.baseUrl+this.urlFilterList[i];let fe="";return n===W.Address?(fe="adresses",this.http.get(me+"/"+t.properties.code+"/"+fe,{params:{geometry:"true",icon:"true",bufferInput:T.toString(),simplified:"100"}}).pipe((0,g.T)(we=>we.features.map(Me=>(Me.meta={id:Me.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:Me.icon},Me))))):(fe=d.source,this.http.get(me+"/"+t.properties.code+"/"+fe,{params:{geometry:"true",icon:"true",bufferInput:T.toString(),simplified:"100"}}).pipe((0,g.T)(we=>we.features.map(Me=>(Me.meta={id:Me.properties.code,title:d.name,icon:Me.icon},Me)))))}{const B=this.baseUrl+"locate";return n===W.Address?this.http.post(B+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:T.toString(),simplified:"100"}).pipe((0,g.T)(fe=>fe.features.map(we=>(we.meta={id:we.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:we.icon},we)))):this.http.post(B+"?type="+d.source,{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:T.toString(),simplified:"100"}).pipe((0,g.T)(fe=>fe.features.map(we=>(we.meta={id:we.properties.code,title:d.name,icon:we.icon},we))))}}loadItemById(t,n){const i=this.urlFilterList[n],d="/"+t.properties.code;if(i&&d)return this.http.get(this.baseUrl+i+d,{params:{geometry:"true"}}).pipe((0,g.T)(T=>(T.meta={id:T.properties.code,alias:T.properties.nom,title:T.properties.nom},T)))}loadBufferGeometry(t,n,i,d){if(n!==N.Predefined)return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:i,loc:JSON.stringify(t)}).pipe((0,g.T)(T=>T));{const T=this.urlFilterList[d],B="/"+t.properties.code;if(T&&B)return this.http.get(this.baseUrl+T+B,{params:{geometry:"100",bufferOutput:i.toString()}}).pipe((0,g.T)(me=>(me.meta={id:me.properties.code,alias:me.properties.nom,title:me.properties.nom},me)))}}static \u0275fac=function(n){return new(n||l)(e.KVO(u.Qq),e.KVO(y.gw),e.KVO(A.we))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),j=(()=>{class l{messageService;constructor(t){this.messageService=t}open(t){this.messageService.success("igo.geo.download.start","igo.geo.download.title");const n=t.dataSource.options;if(Object.keys(n.download).length>0)if(n.download.dynamicUrl&&void 0===n.download.url){let i,d=new D.A({code:t.map.projection});const T=t.dataSource.options.paramsWFS;T&&Object.keys(T).length>0?(d=T.srsName?new D.A({code:T.srsName}):d,i=t.dataSource.options.paramsWFS):i=t.dataSource.options.params;const B=_.DI(t.map.viewController.getExtent(),new D.A({code:t.map.projection}),d),me=void 0===i.outputFormatDownload?void 0===i.outputFormat?"":"outputformat="+i.outputFormat:"outputformat="+i.outputFormatDownload,fe=n.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),we=t.dataSource.options.ogcFilters;let Me;Me=(new Z.l).handleOgcFiltersAppliedValue(t.dataSource.options,we.geometryName,B,d),Me=Me?"filter="+encodeURIComponent(Me):(new Z.l).buildFilter(void 0,B,d,we.geometryName),window.open(`${fe}&${Me}&${me}`,"_blank")}else n.download&&window.open(n.download.url,"_blank")}static \u0275fac=function(n){return new(n||l)(e.KVO(k.bg))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var P=r(90852);function Y(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",1),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openDownload(i.layer))}),e.j41(2,"mat-icon"),e.EFF(3,"download"),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,2,"igo.geo.download.action"))("color",t.color)}}let w=(()=>{class l{downloadService;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t){this.downloadService=t}openDownload(t){this.downloadService.open(t)}get options(){if(this.layer)return this.layer.dataSource.options}static \u0275fac=function(n){return new(n||l)(e.rXU(j))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","color"]],template:function(n,i){1&n&&e.DNE(0,Y,4,4,"button",0),2&n&&e.Y8G("ngIf",i.options&&i.options.download&&(i.options.download.dynamicUrl||i.options.download.url))},dependencies:[o.bT,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,y.Ck,P.D9],changeDetection:0})}return l})();var E=r(16256),s=r(28176),z=r(78421),Q=r(34456),ae=r(97024),ye=r(14102),de=r(20943),ue=r(63220),ce=r(75797),re=r(85060),be=r(15944),_e=r(25175),Le=r(19816),We=r(59912),Xe=r(59452),Be=r(61318),rt=r(13483);const Ie=["renderedLegend"],Ve=l=>({"with-title":l});function ie(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-list-item")(1,"mat-icon",8),e.bIt("toggle",function(i){e.eBV(t);const d=e.XpG(2).$implicit,T=e.XpG(3);return e.Njj(T.toggleLegendItem(i,d))}),e.EFF(2,"expand_less "),e.k0s(),e.j41(3,"span",9),e.EFF(4),e.nI1(5,"async"),e.k0s()()}if(2&l){e.XpG();const t=e.sdS(3),n=e.XpG().$implicit,i=e.XpG(3);e.R7$(),e.Y8G("target",t)("collapsed",n.collapsed),e.R7$(3),e.SpI("",e.bMT(5,3,i.computeItemTitle(n))," ")}}function he(l,f){if(1&l&&(e.j41(0,"mat-option",12),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.name),e.R7$(),e.JRh(t.title)}}function $e(l,f){if(1&l){const t=e.RV6();e.j41(0,"div")(1,"mat-form-field")(2,"mat-select",10),e.nI1(3,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(5);return e.DH7(d.currentStyle,i)||(d.currentStyle=i),e.Njj(i)}),e.bIt("selectionChange",function(){e.eBV(t);const i=e.XpG(5);return e.Njj(i.onChangeStyle())}),e.DNE(4,he,2,2,"mat-option",11),e.k0s()()()}if(2&l){const t=e.XpG(5);e.R7$(2),e.Y8G("matTooltip",e.bMT(3,3,"igo.geo.layer.legend.selectStyle")),e.R50("ngModel",t.currentStyle),e.R7$(2),e.Y8G("ngForOf",t.styles)}}function Ae(l,f){if(1&l){const t=e.RV6();e.j41(0,"img",15,3),e.nI1(2,"translate"),e.bIt("load",function(){e.eBV(t);const i=e.XpG(4).$implicit,d=e.XpG(3);return e.Njj(d.onLoadImage(i.title))}),e.k0s()}if(2&l){const t=e.XpG(4).$implicit;e.FS9("id",t.title),e.FS9("alt",e.bMT(2,4,"igo.geo.layer.legend.loadingLegendText")),e.Y8G("hideError",!0)("src",t.imgGraphValue,e.B4B)}}function Qe(l,f){1&l&&(e.j41(0,"small"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function Ge(l,f){if(1&l&&(e.j41(0,"div"),e.DNE(1,Ae,3,6,"img",14)(2,Qe,3,3,"small",4),e.k0s()),2&l){const t=e.XpG(3).$implicit,n=e.XpG(3);e.R7$(),e.Y8G("ngIf",t.imgGraphValue),e.R7$(),e.Y8G("ngIf",n.imagesHeight[t.title]<16)}}function at(l,f){if(1&l&&(e.nrm(0,"div",16),e.nI1(1,"sanitizeHtml")),2&l){const t=e.XpG(3).$implicit;e.Y8G("ngStyle",t.style)("innerHTML",e.bMT(1,2,t.html),e.npT)}}function Oe(l,f){if(1&l&&(e.j41(0,"div"),e.DNE(1,Ge,3,2,"div",4)(2,at,2,4,"div",13),e.k0s()),2&l){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf",t.url),e.R7$(),e.Y8G("ngIf",t.html)}}function Ye(l,f){if(1&l&&(e.j41(0,"div"),e.DNE(1,ie,6,5,"mat-list-item",4),e.j41(2,"div",7,2),e.DNE(4,$e,5,5,"div",4)(5,Oe,3,2,"div",4),e.k0s()()),2&l){const t=e.XpG().$implicit,n=e.XpG(3);e.R7$(),e.Y8G("ngIf",t.title),e.R7$(),e.Y8G("ngClass",e.eq3(4,Ve,t.title)),e.R7$(2),e.Y8G("ngIf",void 0!==n.currentStyle),e.R7$(),e.Y8G("ngIf",!t.collapsed)}}function ze(l,f){if(1&l&&(e.qex(0,null,1),e.DNE(2,Ye,6,6,"div",5),e.bVm()),2&l){e.XpG(2);const t=e.sdS(3),n=e.XpG();e.R7$(2),e.Y8G("ngIf",n.getLegend)("ngIfElse",t)}}function et(l,f){if(1&l&&(e.qex(0),e.DNE(1,ze,3,2,"ng-container",6),e.bVm()),2&l){const t=e.XpG().ngIf;e.R7$(),e.Y8G("ngForOf",t.slice().reverse())}}function jt(l,f){1&l&&(e.j41(0,"small"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.layer.legend.noLegendText")," "))}function dt(l,f){if(1&l&&(e.qex(0),e.DNE(1,et,2,1,"ng-container",5)(2,jt,3,3,"ng-template",null,0,e.C5r),e.bVm()),2&l){const t=f.ngIf,n=e.sdS(3);e.R7$(),e.Y8G("ngIf",t.length)("ngIfElse",n)}}let to=(()=>{class l{capabilitiesService;languageService;configService;http;cdRef;updateLegendOnResolutionChange=!1;legendItems$=new ce.t([]);state$$;styles;currentStyle;scale=void 0;view=void 0;renderedLegends;imagesHeight={};layer;getLegend=!0;constructor(t,n,i,d,T){this.capabilitiesService=t,this.languageService=n,this.configService=i,this.http=d,this.cdRef=T}ngOnInit(){let t=this.layer.legend;this.styles=this.listStyles();const n=this.layer.options.source.options;if(n&&n.params&&n.params.STYLES?this.currentStyle=this.styles.find(i=>i.name===n.params.STYLES).name:t?this.styles&&this.styles.length>1&&(this.currentStyle=t[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),t=typeof this.layer.options.legendOptions<"u"&&!1===this.layer.options.legendOptions.display?[]:this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||n.contentDependentLegend)this.state$$=this.layer.map.viewController.state$.subscribe(()=>this.onViewControllerStateChange());else if(t&&0!==t.length){this.legendItems$.next(t);for(const i of t)this.getLegendGraphic(i)}}ngOnDestroy(){void 0!==this.state$$&&this.state$$.unsubscribe()}getLegendGraphic(t){t.url&&new We.V2(this.http,this.configService).transform(t.url).pipe((0,Be.W)(i=>{if(i.error)return i.error.caught=!0,this.getLegend=!1,this.cdRef.detectChanges(),i})).subscribe(i=>{const d=this.legendItems$.value.findIndex(B=>B.title===t.title);this.legendItems$.value[d].imgGraphValue=i,this.cdRef.detectChanges()})}toggleLegendItem(t,n){n.collapsed=t}transfertToggleLegendItem(t){const n=t,i=this.layer.legend;for(let d=0;d<i.length;d++)n[d].collapsed=i[d].collapsed;return n}computeItemTitle(t){const n=this.layer.dataSource.options;if("wms"!==n.type)return(0,Xe.of)(t.title);const i=n.params.LAYERS.split(","),d=JSON.parse(JSON.stringify(n));return d.params.LAYERS=i.find(T=>T===t.title),this.capabilitiesService.getWMSOptions(d).pipe((0,g.T)(T=>T._layerOptionsFromSource.title))}onViewControllerStateChange(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}updateLegend(){let t=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(t=this.transfertToggleLegendItem(t)),this.layer.legend=t,0!==t.length||0!==this.legendItems$.value.length){this.legendItems$.next(t);for(const n of this.legendItems$.value)this.getLegendGraphic(n)}}listStyles(){const t=this.layer.options;if(t&&t.legendOptions){let d=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return t.legendOptions.stylesAvailable&&(d=d.concat(t.legendOptions.stylesAvailable.filter(T=>"default"!==T.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==T.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")))),d.filter(T=>!T.title).map(T=>T.title=T.name),d.map(T=>T.title=T.title.charAt(0).toUpperCase()+T.title.slice(1).replace(/_/g," ")),d}}onChangeStyle(){this.updateLegend();let t="";this.layer.dataSource instanceof H.T&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(n=>t+=this.currentStyle+","),t=t.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:t}))}onLoadImage(t){let n;n=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(i=>i.nativeElement.id===t).nativeElement,this.imagesHeight[t]=n.height}static \u0275fac=function(n){return new(n||l)(e.rXU(rt.w),e.rXU(y.gw),e.rXU(A.we),e.rXU(u.Qq),e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-layer-legend"]],viewQuery:function(n,i){if(1&n&&e.GBs(Ie,5),2&n){let d;e.mGM(d=e.lsd())&&(i.renderedLegends=d)}},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},standalone:!0,features:[e.aNF],decls:2,vars:3,consts:[["noItems",""],["renderedLegends",""],["legend",""],["renderedLegend",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[1,"igo-layer-legend",3,"ngClass"],["id","legend-toggle","matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"toggle","target","collapsed"],["matListItemTitle",""],["tooltip-position","below","matTooltipShowDelay","500",3,"ngModelChange","selectionChange","matTooltip","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load",4,"ngIf"],["igoImageError","",3,"load","hideError","id","src","alt"],[3,"ngStyle","innerHTML"]],template:function(n,i){1&n&&(e.DNE(0,dt,4,2,"ng-container",4),e.nI1(1,"async")),2&n&&e.Y8G("ngIf",e.bMT(1,1,i.legendItems$))},dependencies:[o.bT,o.pM,de.Fg,de.YE,de.ZV,de.yE,R.m_,R.An,ue.Dc,o.YU,be.RG,be.rl,_e.Ve,_e.VO,re.wT,v.uc,v.oV,Q.YN,Q.BC,Q.vS,re.Sy,We.Ju,o.B3,o.Jj,y.Ck,P.D9,Le.b8],styles:['[_nghost-%COMP%]   .igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;animation:2s linear infinite _ngcontent-%COMP%_spin}@-moz-document url-prefix(){-shadowcsshost-no-combinator img:after{margin-left:19px}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0})}return l})();var Bt=r(79771),Tt=r(87984),wo=r(34927);let Mt=(()=>{class l{constructor(){}wktToFeature(t,n,i){return(new wo.A).readFeature(t,{dataProjection:n,featureProjection:i})}extentToWkt(t,n,i){let d=_.DI(n,i,t);return d=this.roundCoordinateArray(d,t,0),{wktPoly:`POLYGON((\n      ${n[0]} ${n[1]},\n      ${n[0]} ${n[3]},\n      ${n[2]} ${n[3]},\n      ${n[2]} ${n[1]},\n      ${n[0]} ${n[1]}))`,wktLine:`LINESTRING(\n      ${n[0]} ${n[1]},\n      ${n[0]} ${n[3]},\n      ${n[2]} ${n[3]},\n      ${n[2]} ${n[1]},\n      ${n[0]} ${n[1]})`,wktMultiPoints:`MULTIPOINT(\n        ${n[0]} ${n[1]},\n        ${n[0]} ${n[3]},\n        ${n[2]} ${n[3]},\n        ${n[2]} ${n[1]})`}}roundCoordinateArray(t,n,i=0){const T=_.Jt(n).getUnits();return-1!==["ft","m","us-ft"].indexOf(T)&&(t=this.roundArray(t,i)),t}roundArray(t,n=0){let i=0;for(;i<t.length;)t[i]=t[i].toFixed(n),i++;return t}snrcToWkt(t,n){let i;t=t.toLowerCase();const d={1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}},T={1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}},B=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],me=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]];let ke=!1,Je=!1,je=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(t)?je=!0:/\d{2,3}[a-p]/gi.test(t)?Je=!0:/\d{2,3}/gi.test(t)&&(ke=!0),ke?t+="a01":Je&&(t+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(t)){const lt=t.split(/(?=[a-p])/gi),bt=lt[0],Lt=lt[1][0],po=lt[1].split(Lt)[1];let Go=1;3===bt.length&&(Go=2);const yi=bt.substring(0,Go),sc=bt.substring(Go),ac=8,Vo=4,en=2,vi=1,lc=.5,cc=.25;let zs=0,Js=0,uc=0,pc=0;B.forEach(ti=>{-1!==ti.indexOf(Lt)&&(Js=B.indexOf(ti),zs=ti.indexOf(Lt))}),me.forEach(ti=>{-1!==ti.indexOf(po)&&(pc=me.indexOf(ti),uc=ti.indexOf(po))});let Zs=0,Qs=0,qs=0,ea=0,Ur=ac,Nr=Vo;Je?(Zs=zs*en,Qs=Js*vi,qs=0,ea=0,Ur=en,Nr=vi):je&&(Zs=zs*en,Qs=Js*vi,qs=uc*lc,ea=pc*cc,Ur=lc,Nr=cc);const St={ul:[d[yi].to+Zs+qs,T[sc].to-Qs-ea]};return St.lr=[St.ul[0]+Ur,St.ul[1]-Nr],St.ur=[St.ul[0],St.ul[1]-Nr],St.ll=[St.ul[0]+Ur,St.ul[1]],St.ul=_.pd([St.ul[0],St.ul[1]],"EPSG:4326",n),St.lr=_.pd([St.lr[0],St.lr[1]],"EPSG:4326",n),St.ur=_.pd([St.ur[0],St.ur[1]],"EPSG:4326",n),St.ll=_.pd([St.ll[0],St.ll[1]],"EPSG:4326",n),St.ul=this.roundCoordinateArray(St.ul,n,0),St.lr=this.roundCoordinateArray(St.lr,n,0),St.ur=this.roundCoordinateArray(St.ur,n,0),St.ll=this.roundCoordinateArray(St.ll,n,0),i="POLYGON(("+[St.ul.join(" "),St.ur.join(" "),St.lr.join(" "),St.ll.join(" "),St.ul.join(" ")].join(",")+"))",{wktPoly:i,wktLine:"LINESTRING("+[St.ul.join(" "),St.ur.join(" "),St.lr.join(" "),St.ll.join(" "),St.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[St.ul.join(" "),St.ur.join(" "),St.lr.join(" "),St.ll.join(" ")].join(",")+")"}}}static \u0275fac=function(n){return new(n||l)};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var mo=r(56114),ut=r(61977),Ft=r(8827),Qt=r(39545),nt=r.n(Qt);let Eo=(()=>{class l{defaultStepMillisecond=6e4;constructor(){}step(t,n){return t.options.stepDate?t.options.stepDate:n.step}stepMillisecond(t,n){const i=nt().duration(this.step(t,n)).asMilliseconds();return 0===i?this.defaultStepMillisecond:i}stepIsYearDuration(t){const n=nt().duration(t);return 0!==n.years()&&0===n.months()&&0===n.weeks()&&0===n.days()&&0===n.hours()&&0===n.minutes()}stepIsMonthDuration(t){const n=nt().duration(t);return 0!==n.months()&&0===n.weeks()&&0===n.days()&&0===n.hours()&&0===n.minutes()}stepIsWeekDuration(t){const n=nt().duration(t);return 0!==n.weeks()&&7===n.days()&&0===n.hours()&&0===n.minutes()}stepIsDayDuration(t){const n=nt().duration(t);return 0!==n.days()&&0===n.hours()&&0===n.minutes()}stepIsHourDuration(t){const n=nt().duration(t);return 0!==n.hours()&&0===n.minutes()}stepIsMinuteDuration(t){return 0!==nt().duration(t).minutes()}dateToNumber(t){let n=new Date;return t&&(n=new Date(t)),n.getTime()}addStep(t,n){return nt()(t).add(n,"milliseconds").toDate()}subtractStep(t,n){return nt()(t).subtract(n,"milliseconds").toDate()}static \u0275fac=function(n){return new(n||l)};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();var qt=r(64992);let ro=(()=>{class l{ogcFilterTimeService;currentFilter;begin;max;datasource;changeProperty=new e.bkB;slider;interval;sliderValue=1;calculatedStep=0;_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderInterval=2e3;playIcon="play_circle";resetIcon="replay";get sliderInterval(){return void 0===this.currentFilter.sliderInterval?this._defaultSliderInterval:this.currentFilter.sliderInterval}get displayFormat(){return this.currentFilter.sliderOptions?.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}get beginMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.begin)}get maxMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.max)}get stepMillisecond(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}constructor(t){this.ogcFilterTimeService=t,this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}ngOnInit(){this.calculateStep(),this.handleSliderInput({value:1})}sliderDisplayWith(t){let n=new Date(this.beginMillisecond+(t-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=nt().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();n=nt()(this.beginMillisecond).add((t-1)*i,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=nt().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();n=nt()(this.beginMillisecond).add((t-1)*i,"month").toDate()}return nt()(n).format(this.displayFormat)}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(n=>{if(this.slider.step<this.calculatedStep){const d="_emitInputEvent";this.slider._increment(1),this.slider[d]()}else this.stopFilter()},this.sliderInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}resetFilter(t){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle",this.slider.step=1,this.slider._emitInputEvent()}handleSliderInput(t){if(t)if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=nt().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),i=nt()(this.beginMillisecond).add((t.value-1)*n,"year").toDate(),d=nt()(i).add(n,"year").toDate();this.changeProperty.next({value:nt()(i).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:nt()(d).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=nt().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),i=nt()(this.beginMillisecond).add((t.value-1)*n,"month").toDate(),d=nt()(i).add(n,"month").toDate();this.changeProperty.next({value:nt()(i).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:nt()(d).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=new Date(this.beginMillisecond+this.stepMillisecond*(t.value-1));this.changeProperty.next({value:n.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(n.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}calculateStep(){for(let t=1;this.maxMillisecond-(this.beginMillisecond+t*this.stepMillisecond)>=-1;t++)this.calculatedStep=t}static \u0275fac=function(n){return new(n||l)(e.rXU(Eo))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(n,i){if(1&n&&e.GBs(qt.IV,5),2&n){let d;e.mGM(d=e.lsd())&&(i.slider=d.first)}},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.Jv_([Eo]),e.aNF],decls:11,vars:7,consts:[["ngSlider",""],["ngSliderThumb","matSliderThumb"],[1,"slider-container"],["id","time-slider","thumbLabel","",3,"ngModelChange","step","min","max","ngModel","displayWith"],["matSliderThumb","",3,"input"],["mat-icon-button","","color","primary",3,"click"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"div",2)(1,"mat-slider",3,0),e.mxI("ngModelChange",function(B){return e.eBV(d),e.DH7(i.sliderValue,B)||(i.sliderValue=B),e.Njj(B)}),e.j41(3,"input",4,1),e.bIt("input",function(){e.eBV(d);const B=e.sdS(2),me=e.sdS(4);return e.Njj(i.handleSliderInput({source:me,parent:B,value:me.value}))}),e.k0s()(),e.j41(5,"button",5),e.bIt("click",function(B){return e.eBV(d),e.Njj(i.playFilter(B))}),e.j41(6,"mat-icon"),e.EFF(7),e.k0s()(),e.j41(8,"button",5),e.bIt("click",function(B){return e.eBV(d),e.Njj(i.resetFilter(B))}),e.j41(9,"mat-icon"),e.EFF(10),e.k0s()()()}2&n&&(e.R7$(),e.Y8G("step",1)("min",1)("max",i.calculatedStep),e.R50("ngModel",i.sliderValue),e.Y8G("displayWith",i.sliderDisplayWith),e.R7$(6),e.JRh(i.playIcon),e.R7$(3),e.JRh(i.resetIcon))},dependencies:[qt.Ez,qt.IV,qt.OU,Q.YN,Q.BC,Q.vS,L.Hl,L.iY,R.m_,R.An],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .datetime-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{margin-left:10px}"]})}return l})();const Uo=["endDatepickerTime"],Do=["beginDatepickerTime"],dn=["beginTime"],lo=["endTime"];function co(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-slide-toggle",10),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG();return e.DH7(d.sliderMode,i)||(d.sliderMode=i),e.Njj(i)}),e.bIt("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.modeChange(i))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&l){const t=e.XpG();e.R50("ngModel",t.sliderMode),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function mt(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",11)(1,"igo-ogc-filter-time-slider",12),e.bIt("changeProperty",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changePropertyByPass(i))}),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("begin",t.beginValue)("max",t.restrictedToStep()?t.maxDate:t.endValue)("currentFilter",t.currentFilter)("datasource",t.datasource)}}function Ro(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"input",17),e.bIt("change",function(i){e.eBV(t);const d=e.sdS(8),T=e.XpG(2);return e.Njj(T.yearOnlyInputChange(i,d,"begin"))}),e.k0s(),e.nrm(6,"mat-datepicker-toggle",18),e.j41(7,"mat-datepicker",19,0),e.bIt("yearSelected",function(i){e.eBV(t);const d=e.sdS(8),T=e.XpG(2);return e.Njj(T.yearSelected(i,d,"begin"))}),e.k0s(),e.nrm(9,"input",20,1),e.k0s(),e.j41(11,"mat-form-field",16)(12,"mat-label"),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"input",17),e.bIt("change",function(i){e.eBV(t);const d=e.sdS(18),T=e.XpG(2);return e.Njj(T.yearOnlyInputChange(i,d,"end"))}),e.k0s(),e.nrm(16,"mat-datepicker-toggle",18),e.j41(17,"mat-datepicker",19,2),e.bIt("yearSelected",function(i){e.eBV(t);const d=e.sdS(18),T=e.XpG(2);return e.Njj(T.yearSelected(i,d,"end"))}),e.k0s(),e.nrm(19,"input",20,3),e.k0s(),e.j41(21,"div",21)(22,"button",22),e.nI1(23,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.resetFilter())}),e.j41(24,"mat-icon"),e.EFF(25),e.k0s()(),e.j41(26,"mat-slide-toggle",23),e.nI1(27,"translate"),e.bIt("change",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.toggleFilterState())}),e.k0s()()()}if(2&l){const t=e.sdS(8),n=e.sdS(18),i=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,27,"igo.geo.timeFilter.startYear")),e.R7$(2),e.FS9("value",i.onlyYearBegin),e.Y8G("disabled",i.filterStateDisable),e.R7$(),e.Y8G("for",t)("disabled",i.filterStateDisable),e.R7$(),e.Y8G("startView",i.calendarView())("startAt",i.beginValue),e.R7$(2),e.Y8G("matDatepicker",t)("value",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("min",i.handleDate(i.datasource.options.minDate))("max",i.endValue&&!i.restrictedToStep()?i.endValue:i.handleDate(i.datasource.options.maxDate)),e.R7$(4),e.JRh(e.bMT(14,29,"igo.geo.timeFilter.endYear")),e.R7$(2),e.FS9("value",i.onlyYearEnd),e.Y8G("disabled",i.filterStateDisable),e.R7$(),e.Y8G("for",n)("disabled",i.filterStateDisable),e.R7$(),e.Y8G("startView",i.calendarView())("startAt",i.endValue),e.R7$(2),e.Y8G("matDatepicker",n)("value",i.endValue?i.endValue:i.handleDate(i.datasource.options.maxDate))("min",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("max",i.handleDate(i.datasource.options.maxDate)),e.R7$(3),e.Y8G("matTooltip",e.bMT(23,31,"igo.geo.filter.resetFilters"))("disabled",i.filterStateDisable),e.R7$(3),e.JRh(i.resetIcon),e.R7$(),e.Y8G("matTooltip",e.bMT(27,33,"igo.geo.filter.toggleFilterState"))("checked",!i.filterStateDisable)}}function tn(l,f){if(1&l&&(e.j41(0,"mat-option",37),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function Xo(l,f){if(1&l&&(e.j41(0,"mat-option",37),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function mn(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"mat-select",34),e.bIt("selectionChange",function(){e.eBV(t),e.XpG();const i=e.sdS(5),d=e.XpG(2);return e.Njj(d.changeTemporalProperty(i.value,1))}),e.DNE(6,tn,2,2,"mat-option",35),e.k0s()(),e.j41(7,"mat-form-field",36)(8,"mat-label"),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"mat-select",34),e.bIt("selectionChange",function(){e.eBV(t),e.XpG();const i=e.sdS(5),d=e.XpG(2);return e.Njj(d.changeTemporalProperty(i.value,1))}),e.DNE(12,Xo,2,2,"mat-option",35),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(3),e.JRh(e.bMT(4,8,"igo.geo.timeFilter.hour")),e.R7$(2),e.Y8G("formControl",t.beginHourFormControl),e.BMQ("disabled",!t.currentFilter.active),e.R7$(),e.Y8G("ngForOf",t.beginHours),e.R7$(3),e.JRh(e.bMT(10,10,"igo.geo.timeFilter.minute")),e.R7$(2),e.Y8G("formControl",t.beginMinuteFormControl),e.BMQ("disabled",!t.currentFilter.active),e.R7$(),e.Y8G("ngForOf",t.beginMinutes)}}function Po(l,f){if(1&l&&(e.j41(0,"mat-option",37),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function yo(l,f){if(1&l&&(e.j41(0,"mat-option",37),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function so(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"mat-select",34),e.bIt("selectionChange",function(){e.eBV(t),e.XpG();const i=e.sdS(4),d=e.XpG(3);return e.Njj(d.changeTemporalProperty(i.value,2))}),e.DNE(6,Po,2,2,"mat-option",35),e.k0s()(),e.j41(7,"mat-form-field",36)(8,"mat-label"),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"mat-select",34),e.bIt("selectionChange",function(){e.eBV(t),e.XpG();const i=e.sdS(4),d=e.XpG(3);return e.Njj(d.changeTemporalProperty(i.value,2))}),e.DNE(12,yo,2,2,"mat-option",35),e.k0s()()()}if(2&l){const t=e.XpG(4);e.R7$(3),e.JRh(e.bMT(4,8,"igo.geo.timeFilter.hour")),e.R7$(2),e.Y8G("formControl",t.endHourFormControl),e.BMQ("disabled",!t.currentFilter.active),e.R7$(),e.Y8G("ngForOf",t.endHours),e.R7$(3),e.JRh(e.bMT(10,10,"igo.geo.timeFilter.minute")),e.R7$(2),e.Y8G("formControl",t.endMinuteFormControl),e.BMQ("disabled",!t.currentFilter.active),e.R7$(),e.Y8G("ngForOf",t.endMinutes)}}function At(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",25)(1,"mat-form-field",26),e.nrm(2,"mat-datepicker-toggle",18),e.j41(3,"input",27,5),e.nI1(5,"translate"),e.bIt("dateChange",function(){e.eBV(t);const i=e.sdS(4),d=e.XpG(3);return e.Njj(d.changeTemporalProperty(i.value,2))}),e.k0s(),e.nrm(6,"span",28),e.j41(7,"mat-datepicker",29,2),e.bIt("yearSelected",function(i){e.eBV(t);const d=e.sdS(8),T=e.XpG(3);return e.Njj(T.yearSelected(i,d,"end"))})("monthSelected",function(i){e.eBV(t);const d=e.sdS(8),T=e.XpG(3);return e.Njj(T.monthSelected(i,d,"end"))}),e.k0s()(),e.DNE(9,so,13,12,"div",30),e.k0s()}if(2&l){const t=e.sdS(8),n=e.XpG(3);e.R7$(2),e.Y8G("for",t)("disabled",n.filterStateDisable),e.R7$(),e.Y8G("matDatepicker",t)("placeholder",e.bMT(5,13,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",n.filterEndFunction)("value",n.endValue?n.endValue:n.handleDate(n.datasource.options.maxDate))("min",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("max",n.handleDate(n.datasource.options.maxDate))("disabled",n.filterStateDisable),e.BMQ("disabled",!n.currentFilter.active),e.R7$(4),e.Y8G("startView",n.calendarView())("startAt",n.endValue),e.R7$(2),e.Y8G("ngIf","datetime"===n.calendarType())}}function $o(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",24)(1,"div",25)(2,"mat-form-field",26),e.nrm(3,"mat-datepicker-toggle",18),e.j41(4,"input",27,4),e.nI1(6,"translate"),e.bIt("dateChange",function(){e.eBV(t);const i=e.sdS(5),d=e.XpG(2);return e.Njj(d.changeTemporalProperty(i.value,1))}),e.k0s(),e.nrm(7,"span",28),e.j41(8,"mat-datepicker",29,0),e.bIt("yearSelected",function(i){e.eBV(t);const d=e.sdS(9),T=e.XpG(2);return e.Njj(T.yearSelected(i,d,"begin"))})("monthSelected",function(i){e.eBV(t);const d=e.sdS(9),T=e.XpG(2);return e.Njj(T.monthSelected(i,d,"begin"))}),e.k0s()(),e.DNE(10,mn,13,12,"div",30),e.k0s(),e.DNE(11,At,10,15,"div",31),e.j41(12,"div",21)(13,"button",22),e.nI1(14,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.resetFilter())}),e.j41(15,"mat-icon"),e.EFF(16),e.k0s()(),e.j41(17,"mat-slide-toggle",23),e.nI1(18,"translate"),e.bIt("change",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.toggleFilterState())}),e.k0s()()()}if(2&l){const t=e.sdS(9),n=e.XpG(2);e.R7$(3),e.Y8G("for",t)("disabled",n.filterStateDisable),e.R7$(),e.Y8G("matDatepicker",t)("placeholder",e.bMT(6,19,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",n.filterBeginFunction)("value",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("min",n.handleDate(n.datasource.options.minDate))("max",n.endValue&&!n.restrictedToStep()?n.endValue:n.handleDate(n.datasource.options.maxDate))("disabled",n.filterStateDisable),e.BMQ("disabled",!n.currentFilter.active),e.R7$(4),e.Y8G("startView",n.calendarView())("startAt",n.beginValue),e.R7$(2),e.Y8G("ngIf","datetime"===n.calendarType()),e.R7$(),e.Y8G("ngIf",!n.restrictedToStep()),e.R7$(2),e.Y8G("matTooltip",e.bMT(14,21,"igo.geo.filter.resetFilters"))("disabled",n.filterStateDisable),e.R7$(3),e.JRh(n.resetIcon),e.R7$(),e.Y8G("matTooltip",e.bMT(18,23,"igo.geo.filter.toggleFilterState"))("checked",!n.filterStateDisable)}}function on(l,f){if(1&l&&(e.j41(0,"div"),e.DNE(1,Ro,28,35,"div",13)(2,$o,19,25,"div",14),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.calendarTypeYear),e.R7$(),e.Y8G("ngIf","year"!==t.calendarType())}}let vo=(()=>{class l{ogcFilterTimeService;datasource;currentFilter;changeProperty=new e.bkB;beginHours;endHours;beginMinutes;endMinutes;beginHourFormControl=new Q.hs;beginMinuteFormControl=new Q.hs;endHourFormControl=new Q.hs;endMinuteFormControl=new Q.hs;_beginValue;_endValue;_defaultMin="1900-01-01";_defaultMax="2052-01-06";_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderModeEnabled=!0;ogcFilterOperator=ee.E;sliderMode=!1;defaultStepMillisecond=6e4;options;onlyYearBegin;onlyYearEnd;calendarTypeYear=!1;resetIcon="replay";filterStateDisable;endDatepickerTime;beginDatepickerTime;beginTime;endTime;filterOriginConfig;get step(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}get stepMilliseconds(){const t=nt().duration(this.step).asMilliseconds();return 0===t?this.defaultStepMillisecond:t}set beginValue(t){this._beginValue=t}get beginValue(){return this._beginValue}set endValue(t){this._endValue=t}get endValue(){return this._endValue}get sliderInterval(){return void 0===this.currentFilter.sliderInterval?2e3:this.currentFilter.sliderInterval}get maxDate(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}get displayFormat(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}filterBeginFunction;filterEndFunction;constructor(t){this.ogcFilterTimeService=t}ngOnInit(){this.filterOriginConfig=this.datasource.options.ogcFilters.filters,this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=void 0!==this.currentFilter.sliderOptions.enabled?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues(),this.dateFilter(this.filterBeginFunction,"begin"),this.dateFilter(this.filterEndFunction,"end")}parseFilter(t){if(!t)return new Date;if(isNaN(new Date(t).getTime())){if(t.search("now")>=0){const n=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const i=parseInt(t.substring(t.indexOf("+")+1,n.index),10);return nt()().add(i,n[0]).toDate()}if(t.match(/\-/)){const i=parseInt(t.substring(t.indexOf("-")+1,n.index),10);return nt()().subtract(i,n[0]).toDate()}return new Date}if(t.search("today")>=0){const n=nt()().endOf("day").toDate(),i=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const d=parseInt(t.substring(t.indexOf("+")+1,i.index),10);return nt()(n).add(d,i[0]).toDate()}if(t.match(/\-/)){const d=parseInt(t.substring(t.indexOf("-")+1,i.index),10);return nt()(n).subtract(d,i[0]).toDate()}return n}return new Date}return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):t?new Date(t):new Date}changeTemporalProperty(t,n,i=!0){"string"==typeof t&&(t=new Date(t));let d=this.getDateTime(t,n);if(this.isCalendarYearMode()){let T;return 1===n?(this.beginValue=t,this.onlyYearBegin=this.beginValue.getFullYear(),T=`${this.onlyYearBegin}-01-01`):(this.endValue=t,this.onlyYearEnd=this.endValue.getFullYear(),T=`${this.onlyYearEnd}-12-31`),void this.changeProperty.next({value:T,pos:n,refreshFilter:i})}2===n&&"date"===this.calendarType()&&!this.sliderMode&&(d=nt()(d).endOf("day").toDate()),1===n?(this.beginValue=d,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(d,this.stepMilliseconds),2,i)):this.endValue=d,this.updateHoursMinutesArray(),this.changeProperty.next({value:d.toISOString(),pos:n,refreshFilter:i})}handleDate(t){if(t&&""!==t)return"string"==typeof t&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):new Date(t)}calendarType(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}isCalendarYearMode(){return"year"===this.calendarType()}yearOnlyInputChange(t,n,i){const T=this.getDateFromStringWithoutTime(t.target.value);this.yearSelected(T,n,i)}yearSelected(t,n,i,d=!0){this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(n&&n.close(),"end"===i?t=nt()(t).endOf("year").toDate():"begin"===i&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===i?1:2,d))}monthSelected(t,n,i,d=!0){this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(n&&n.close(),"end"===i?t=nt()(t).endOf("month").toDate():"begin"===i&&this.restrictedToStep()&&this.monthSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===i?1:2,d))}calendarView(){const t=this.stepMilliseconds,n=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":t<864e5&&n<864e5?"clock":"month"}dateFilter(t,n){const i=new Date(n),d=i.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){const T=nt()(i).diff(nt()(this.handleMin()),"years",!0);if("end"===t){const B=nt()(i).add(1,"d"),me=nt()(B).diff(nt()(this.handleMin()),"years",!0);return void(this.filterEndFunction=me%nt().duration(this.step).asYears()==0)}if("begin"===t)return void(this.filterBeginFunction=T%nt().duration(this.step).asYears()==0)}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){const T=nt()(i).diff(nt()(this.handleMin()),"months",!0);if("end"===t){const B=nt()(i).add(1,"d"),me=nt()(B).diff(nt()(this.handleMin()),"months",!0);return void(this.filterEndFunction=me%nt().duration(this.step).asMonths()==0)}if("begin"===t)return void(this.filterBeginFunction=T%nt().duration(this.step).asMonths()==0)}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){const T=nt()(i).diff(nt()(this.handleMin()),"weeks",!0);if("end"===t){const B=nt()(i).add(1,"d"),me=nt()(B).diff(nt()(this.handleMin()),"weeks",!0);return void(this.filterEndFunction=me%nt().duration(this.step).asWeeks()==0)}if("begin"===t)return void(this.filterBeginFunction=T%nt().duration(this.step).asWeeks()==0)}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){const T=nt()(i).diff(nt()(this.handleMin()),"days",!0);if("end"===t){const B=nt()(i).add(1,"d"),fe=nt()(B).diff(nt()(this.handleMin()),"days",!0)%nt().duration(this.step).asDays();return void(this.filterEndFunction=fe<1e-7&&fe>-1e-7||0===fe)}if("begin"===t){const B=T%nt().duration(this.step).asDays()+1;return void(this.filterBeginFunction=B<1e-7&&B>-1e-7&&0!==B||1===B)}}else if(this.ogcFilterTimeService.stepIsHourDuration(this.step)){if("end"===t){const T=nt()(i).diff(nt()(this.handleMin()),"hours",!0);return void(this.filterEndFunction=T%nt().duration(this.step).asHours()==0)}if("begin"===t){const T=nt()(i).diff(nt()(this.handleMin()),"hours",!0);return void(this.filterBeginFunction=T%nt().duration(this.step).asHours()==0)}}else if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step)){if("end"===t)return void(this.filterEndFunction=!0);if("begin"===t)return void(this.filterBeginFunction=!0)}this.filterEndFunction=d%this.stepMilliseconds==0,this.filterBeginFunction=d%this.stepMilliseconds==0}getDateTime(t,n){const i=new Date(t);let d;if(!this.sliderMode)switch(n){case 1:if(this.currentFilter.calendarModeYear){d=i.setHours(0,0);break}d=i.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break;case 2:if(this.currentFilter.calendarModeYear){d=i.setHours(0,0);break}d=i.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value)}return new Date(d||i)}handleMinuteIncrement(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3==60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}handleHourIncrement(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}fullBeginHoursArray(t){this.beginHours=Array.from(t?{length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1}:{length:23/this.handleHourIncrement()+1},(n,i)=>0+i*this.handleHourIncrement()),this.beginHourFormControl.setValue(this.beginValue.getHours())}fullEndHoursArray(t){this.endHours=t?Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},(n,i)=>this.beginHourFormControl.value+i*this.handleHourIncrement()):Array.from({length:23/this.handleHourIncrement()+1},(n,i)=>0+i*this.handleHourIncrement()),this.endHourFormControl.setValue(this.endValue.getHours())}fullBeginMinutesArray(t){this.beginMinutes=Array.from(t?{length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1}:{length:59/this.handleMinuteIncrement()+1},(n,i)=>0+i*this.handleMinuteIncrement()),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}fullEndMinutesArray(t){this.endMinutes=t?Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},(n,i)=>this.beginMinuteFormControl.value+i*this.handleMinuteIncrement()):Array.from({length:59/this.handleMinuteIncrement()+1},(n,i)=>0+i*this.handleMinuteIncrement()),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}updateHoursMinutesArray(){const t=new Date(this.beginValue),n=new Date(this.endValue);t.setHours(0,0)===n.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}updateValues(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}restrictedToStep(){return!!this.currentFilter.restrictToStep&&this.currentFilter.restrictToStep}handleMin(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}handleMax(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}changePropertyByPass(t){this.changeProperty.next(t)}modeChange(t){t.checked||this.updateValues()}setFilterStateDisable(){this.filterStateDisable=!!this.currentFilter&&!this.currentFilter.active,"datetime"===this.calendarType()&&(!0===this.filterStateDisable?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}getDateFromStringWithoutTime(t){let n,i="01",d="01";if(10===t.length){const T=t.split("-");if(3!==T.length)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");n=T[0],i=T[1],d=T[2]}else{if(4!==t.length)return new Date(t);n=t}return new Date(`${n}-${i}-${d} 00:00:00`)}resetFilter(){let t,n,i,d;this.calendarTypeYear?(d="today"===this.filterOriginConfig.end?`${(new Date).toLocaleDateString("en-CA").substring(0,4)}-01-01`:`${this.filterOriginConfig.end.substring(0,4)}-01-01`,i=`${this.filterOriginConfig.begin.substring(0,4)}-01-01`,t=this.getDateFromStringWithoutTime(i),n=this.getDateFromStringWithoutTime(d)):(t=this.parseFilter(this.filterOriginConfig.begin),n=this.parseFilter(this.filterOriginConfig.end),i=t.toISOString(),d=n.toISOString()),(this.currentFilter.begin!==i||this.currentFilter.end!==d)&&(this.beginValue=t,this.endValue=n,this.updateValues())}toggleFilterState(){this.currentFilter.active=!0!==this.currentFilter.active,this.setFilterStateDisable(),this.updateValues()}static \u0275fac=function(n){return new(n||l)(e.rXU(Eo))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filter-time"]],viewQuery:function(n,i){if(1&n&&(e.GBs(Uo,5),e.GBs(Do,5),e.GBs(dn,5),e.GBs(lo,5)),2&n){let d;e.mGM(d=e.lsd())&&(i.endDatepickerTime=d.first),e.mGM(d=e.lsd())&&(i.beginDatepickerTime=d.first),e.mGM(d=e.lsd())&&(i.beginTime=d.first),e.mGM(d=e.lsd())&&(i.endTime=d.first)}},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.Jv_([Eo,(0,mo.Jo)()]),e.aNF],decls:4,vars:3,consts:[["beginDatepicker",""],["beginYear",""],["endDatepicker",""],["endYear",""],["begin",""],["end",""],[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModelChange","change","ngModel"],[1,"slider-container"],[3,"changeProperty","begin","max","currentFilter","datasource"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],["subscriptSizing","dynamic",1,"year-input"],["matInput","",1,"year-input-only-year",3,"change","value","disabled"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"yearSelected","startView","startAt"],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],[1,"actions-container"],["mat-icon-button","","color","primary",1,"reset-button",3,"click","matTooltip","disabled"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"change","matTooltip","checked"],[1,"datetime-input-container"],[1,"datetime-input"],["subscriptSizing","dynamic",1,"date-input"],["matInput","",3,"dateChange","matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled"],[1,"filler"],[3,"yearSelected","monthSelected","startView","startAt"],["class","time-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"time-input"],["subscriptSizing","dynamic",1,"hour-input"],[3,"selectionChange","formControl"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic",1,"minute-input"],[3,"value"]],template:function(n,i){1&n&&(e.j41(0,"div",6),e.DNE(1,co,3,4,"mat-slide-toggle",7)(2,mt,2,4,"div",8)(3,on,3,2,"div",9),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",null==i.currentFilter.sliderOptions?null:i.currentFilter.sliderOptions.enabled),e.R7$(),e.Y8G("ngIf",i.sliderMode),e.R7$(),e.Y8G("ngIf",!i.sliderMode))},dependencies:[o.bT,Ft.mV,Ft.sG,Q.YN,Q.BC,Q.vS,ro,be.RG,be.rl,be.nJ,be.yw,Tt.fS,Tt.fg,ut.X6,ut.Vh,ut.bZ,ut.bU,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,_e.Ve,_e.VO,re.wT,Q.X1,Q.l_,o.pM,re.Sy,y.Ck,P.D9],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:154px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:4px}}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:last-child){margin-right:4px}[_nghost-%COMP%]   .year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}[_nghost-%COMP%]   .year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px;text-align:left!important}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-arrow{display:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-period-button{pointer-events:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}"]})}return l})();const Ht=(l,f)=>({logical:l,logicalHidden:f}),Io=(l,f)=>({operator:l,dualInput:f}),Co=()=>["expression","pattern"],Lo=()=>["lowerBoundary","begin"],Ao=()=>["upperBoundary","end"];function ko(l,f){if(1&l&&(e.j41(0,"mat-option",26),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.alias)("id",t.name)("matTooltip",t.alias),e.R7$(),e.SpI(" ",t.alias," ")}}function zt(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.clearSelectedField())}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}if(2&l){const t=e.XpG(2);e.Y8G("disabled",!t.currentFilter.active)}}function Ko(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",21),e.bIt("mouseenter",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable="selectField")})("mouseleave",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable=void 0)}),e.j41(1,"input",22),e.nI1(2,"translate"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"translate"),e.bIt("input",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.updateFieldsList(i.target.value))}),e.k0s(),e.j41(8,"mat-autocomplete",23,0),e.bIt("optionSelected",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeField(i.option.id))}),e.DNE(10,ko,2,4,"mat-option",24),e.nI1(11,"async"),e.k0s(),e.DNE(12,zt,3,1,"button",25),e.k0s()}if(2&l){const t=e.sdS(9),n=e.XpG();e.Y8G("floatLabel",n.floatLabel),e.R7$(),e.Y8G("placeholder",e.bMT(2,8,"igo.geo.sourceFields.selectField"))("disabled",!n.currentFilter.active)("matAutocomplete",t)("value",e.bMT(3,10,n.selectedField$)?e.bMT(4,12,n.selectedField$).alias:"")("matTooltip",e.bMT(5,14,n.selectedField$)?e.bMT(6,16,n.selectedField$).alias:e.bMT(7,18,"igo.geo.sourceFields.selectField")),e.R7$(9),e.Y8G("ngForOf",e.bMT(11,20,n.filteredFields$)),e.R7$(2),e.Y8G("ngIf",n.currentFilter.propertyName&&"selectField"===n.inputClearable&&n.currentFilter.active)}}function oo(l,f){if(1&l&&(e.j41(0,"mat-option",8),e.nI1(1,"translate"),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key)("matTooltip",e.bMT(1,3,"igo.geo.operators.tooltip."+t.key)),e.R7$(2),e.SpI(" ",e.bMT(3,5,"igo.geo.operators."+t.key)," ")}}function jo(l,f){if(1&l&&(e.j41(0,"mat-option",31),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.type),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.spatialSelector."+t.type)," ")}}function Fe(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",28)(1,"mat-select",29),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeSpatialSelector(i.value))}),e.DNE(2,jo,3,4,"mat-option",30),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("disabled",!t.currentFilter.active)("value",t.currentFilter.igoSpatialSelector),e.R7$(),e.Y8G("ngForOf",t.igoSpatialSelectors)}}function tt(l,f){if(1&l&&(e.j41(0,"mat-option",34),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t)("matTooltip",t),e.R7$(),e.SpI(" ",t," ")}}function Ce(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.clearProperty())}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}if(2&l){const t=e.XpG(2);e.Y8G("disabled",!t.currentFilter.active)}}function Ee(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",32),e.bIt("mouseenter",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable="selectProperty")})("mouseleave",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable=void 0)}),e.j41(1,"input",22),e.nI1(2,"translate"),e.bIt("input",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.updateValuesList(i.target.value))}),e.k0s(),e.j41(3,"mat-autocomplete",23,1),e.bIt("optionSelected",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeProperty(i.option.value))}),e.DNE(5,tt,2,3,"mat-option",33),e.nI1(6,"async"),e.k0s(),e.DNE(7,Ce,3,1,"button",25),e.k0s()}if(2&l){const t=e.sdS(4),n=e.XpG();e.Y8G("floatLabel",n.floatLabel),e.R7$(),e.Y8G("placeholder",e.bMT(2,8,"igo.geo.filter.placeholder"))("disabled",!n.currentFilter.active)("matAutocomplete",t)("value","expression"===n.detectProperty()?n.currentFilter.expression:n.currentFilter.pattern)("matTooltip","expression"===n.detectProperty()?n.currentFilter.expression||"":n.currentFilter.pattern||""),e.R7$(4),e.Y8G("ngForOf",e.bMT(6,10,n.filteredValues$)),e.R7$(2),e.Y8G("ngIf",n.isClearable()&&"selectProperty"===n.inputClearable&&n.currentFilter.active)}}function Re(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.currentFilter.igoSNRC="")}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}if(2&l){const t=e.XpG(2);e.Y8G("disabled",!t.currentFilter.active&&"selectSNRC"===t.inputClearable&&t.currentFilter.active)}}function ct(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",35),e.bIt("mouseenter",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable="selectSNRC")})("mouseleave",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable=void 0)}),e.j41(1,"input",36),e.nI1(2,"translate"),e.bIt("input",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeSNRC(i.target.value))}),e.k0s(),e.DNE(3,Re,3,1,"button",25),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("floatLabel",t.floatLabel),e.R7$(),e.Y8G("placeholder",e.bMT(2,5,"igo.geo.filter.placeholderSnrc"))("value",t.currentFilter.igoSNRC)("matTooltip",t.currentFilter.igoSNRC?t.currentFilter.igoSNRC:""),e.R7$(2),e.Y8G("ngIf",t.currentFilter.igoSNRC)}}function no(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",38),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.changeMapExtentGeometry())}),e.j41(2,"mat-icon"),e.EFF(3,"zoom_out_map"),e.k0s()()}if(2&l){const t=e.XpG(2);e.Y8G("disabled",!t.currentFilter.active)("disabled",!t.currentFilter.active)("matTooltip",e.bMT(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function gn(l,f){if(1&l&&(e.qex(0),e.DNE(1,no,4,5,"button",37),e.bVm()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf","fixedExtent"===t.currentFilter.igoSpatialSelector)}}function go(l,f){if(1&l&&(e.j41(0,"mat-option",34),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t)("matTooltip",t),e.R7$(),e.SpI(" ",t," ")}}function oi(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.clearProperty(1))}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}if(2&l){const t=e.XpG(2);e.Y8G("disabled",!t.currentFilter.active)}}function hn(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",39),e.bIt("mouseenter",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable="selectProperty1")})("mouseleave",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable=void 0)}),e.j41(1,"input",40),e.nI1(2,"translate"),e.bIt("input",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.updateValuesList(i.target.value,1))}),e.k0s(),e.j41(3,"mat-autocomplete",23,2),e.bIt("optionSelected",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeNumericProperty(i.option.value,1))}),e.DNE(5,go,2,3,"mat-option",33),e.nI1(6,"async"),e.k0s(),e.DNE(7,oi,3,1,"button",25),e.k0s()}if(2&l){const t=e.sdS(4),n=e.XpG();e.Y8G("floatLabel",n.floatLabel),e.R7$(),e.Y8G("placeholder",e.bMT(2,7,"igo.geo.filter.placeholder"))("disabled",!n.currentFilter.active)("matAutocomplete",t)("value","lowerBoundary"===n.detectProperty(1)?n.currentFilter.lowerBoundary:n.currentFilter.begin),e.R7$(4),e.Y8G("ngForOf",e.bMT(6,9,n.filteredValues$)),e.R7$(2),e.Y8G("ngIf",n.isClearable(1)&&"selectProperty1"===n.inputClearable&&n.currentFilter.active)}}function ni(l,f){if(1&l&&(e.j41(0,"mat-option",34),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t)("matTooltip",t),e.R7$(),e.SpI(" ",t," ")}}function fn(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.clearProperty(2))}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}if(2&l){const t=e.XpG(2);e.Y8G("disabled",!t.currentFilter.active)}}function Te(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",39),e.bIt("mouseenter",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable="selectProperty2")})("mouseleave",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.inputClearable=void 0)}),e.j41(1,"input",40),e.nI1(2,"translate"),e.bIt("input",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.updateValuesList(i.target.value,2))}),e.k0s(),e.j41(3,"mat-autocomplete",23,3),e.bIt("optionSelected",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeNumericProperty(i.option.value,2))}),e.DNE(5,ni,2,3,"mat-option",33),e.nI1(6,"async"),e.k0s(),e.DNE(7,fn,3,1,"button",25),e.k0s()}if(2&l){const t=e.sdS(4),n=e.XpG();e.Y8G("floatLabel",n.floatLabel),e.R7$(),e.Y8G("placeholder",e.bMT(2,7,"igo.geo.filter.placeholder"))("disabled",!n.currentFilter.active)("matAutocomplete",t)("value","upperBoundary"===n.detectProperty(2)?n.currentFilter.upperBoundary:n.currentFilter.end),e.R7$(4),e.Y8G("ngForOf",e.bMT(6,9,n.filteredValues$)),e.R7$(2),e.Y8G("ngIf",n.isClearable(2)&&"selectProperty2"===n.inputClearable&&n.currentFilter.active)}}function pe(l,f){if(1&l){const t=e.RV6();e.j41(0,"igo-ogc-filter-time",41),e.bIt("changeProperty",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeProperty(i.value,i.pos))}),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("datasource",t.datasource)("currentFilter",t.currentFilter)}}let te=(()=>{class l{wktService;ogcFilterOperator=ee.E;filteredValues$;filteredFields$;allOgcFilterOperators;ogcFilterOperators$=new ce.t(void 0);igoSpatialSelectors;value="";inputOperator;selectedField$=new ce.t(void 0);fields$=new ce.t([]);color="primary";disabled;currentFilterIsSpatial$=new ce.t(!1);defaultStepMillisecond=6e3;inputClearable;refreshFilters;datasource;map;currentFilter;set snrc(t){(/^\d{2}$/gi.test(t)||/^\d{2}[a-p]$/gi.test(t)||/^\d{2}[a-l][0,1][0-9]$/gi.test(t))&&(this._snrc=t,this.currentFilter.igoSNRC=t)}get snrc(){return this._snrc}_snrc="";floatLabel;get activeFilters(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(t=>!0===t.active)}get allowedOperators(){return(new Z.l).computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}constructor(t){this.wktService=t,this.allOgcFilterOperators=(new Z.l).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}ngOnInit(){if(this.datasource.options.sourceFields){const t=this.datasource.options.sourceFields.filter(n=>void 0===n.excludeFromOgcFilters||!n.excludeFromOgcFilters);t.map(n=>{n.values&&n.values.sort()}),this.fields$.next(t)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(t=>t.name===this.currentFilter.propertyName)),this.updateValuesList(),this.selectedField$.subscribe(t=>{this.ogcFilterOperators$.next(this.allowedOperators),-1===Object.keys(this.allowedOperators).indexOf(this.currentFilter.operator)&&(this.currentFilter.operator=Object.keys(this.allowedOperators)[0],this.currentFilter.operator=Object.keys(this.allowedOperators)[0]),this.updateValuesList()}),this.currentFilterIsSpatial()}updateFieldsList(t){this.filteredFields$=t&&t.length>0?(0,Xe.of)(this._filterFields(t)):this.fields$,this.fields$.value.find(n=>n.name===t)&&this.changeField(t)}updateValuesList(t,n){this.filteredValues$=(0,Xe.of)(t&&t.length>0?this._filterValues(t):this.selectedField$.value?this.selectedField$.value.values:[]),t&&t.length>=1&&this.changeProperty(t,n)}_filterFields(t){const n=new RegExp(t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(i=>n.test(i.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}_filterValues(t){const n=new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value?.values?.filter(i=>i&&n.test(i.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}clearSelectedField(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}isClearable(t){const n=this.detectProperty(t);if(n)return this.currentFilter[n]}clearProperty(t){const n=this.detectProperty(t);if(n)return this.currentFilter[n]=""}toggleFilterState(t){this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid).active=t.checked,this.refreshFilters()}deleteFilter(){const t=this.datasource.options.ogcFilters;t.interfaceOgcFilters=t.interfaceOgcFilters.filter(n=>n.filterid!==this.currentFilter.filterid),this.refreshFilters()}changeLogical(t){this.currentFilter.parentLogical=t,this.refreshFilters()}changeOperator(t){this.currentFilter.operator=t,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&0===this.currentFilter.wkt_geometry.length?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}changeField(t){this.currentFilter.propertyName=t,this.selectedField$.next(this.fields$.value.find(n=>n.name===this.currentFilter.propertyName)),this.refreshFilters()}changeCaseSensitive(t){this.currentFilter.matchCase=t.checked,this.refreshFilters()}changeProperty(t,n,i=!0){const d=this.detectProperty(n);d&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(T=>T.filterid===this.currentFilter.filterid)[d]=t,i&&this.refreshFilters())}changeNumericProperty(t,n){this.changeProperty(parseFloat(t),n)}changeSpatialSelector(t){this.currentFilter.igoSpatialSelector=t,"fixedExtent"===t&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}changeSNRC(t){this.snrc=t,this.changeSNRCGeometry()}changeSNRCGeometry(){this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid)&&(this.snrc&&"snrc"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}changeMapExtentGeometry(t=!0){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid)&&("fixedExtent"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),t&&this.refreshFilters())}detectProperty(t){switch(this.currentFilter.operator){case ee.E.PropertyIsNotEqualTo:case ee.E.PropertyIsEqualTo:case ee.E.PropertyIsGreaterThan:case ee.E.PropertyIsGreaterThanOrEqualTo:case ee.E.PropertyIsLessThan:case ee.E.PropertyIsLessThanOrEqualTo:return"expression";case ee.E.PropertyIsLike:return"pattern";case ee.E.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case ee.E.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}currentFilterIsSpatial(){let t=!1;this.currentFilter&&(t=-1!==[ee.E.Contains,ee.E.Intersects,ee.E.Within].indexOf(this.currentFilter.operator)),this.currentFilterIsSpatial$.next(t)}isTemporalOperator(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}static \u0275fac=function(n){return new(n||l)(e.rXU(Mt))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},standalone:!0,features:[e.aNF],decls:44,vars:76,consts:[["autoCompleteField","matAutocomplete"],["autoCompleteValues","matAutocomplete"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[1,"ogc-filter-form-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"click","change","matTooltip","checked"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"selectionChange","disabled","value","matTooltip"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"selectionChange","matTooltip","disabled","value"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","changeProperty",4,"ngIf"],[1,"field",3,"mouseenter","mouseleave","floatLabel"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"input","placeholder","disabled","matAutocomplete","value","matTooltip"],[3,"optionSelected"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click","disabled"],[1,"spatialSelector"],[3,"selectionChange","disabled","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"mouseenter","mouseleave","floatLabel"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"mouseenter","mouseleave","floatLabel"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"input","placeholder","value","matTooltip"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","disabled","matTooltip"],[1,"dualInput",3,"mouseenter","mouseleave","floatLabel"],["matInput","","type","number",3,"input","placeholder","disabled","matAutocomplete","value"],[3,"changeProperty","datasource","currentFilter"]],template:function(n,i){1&n&&(e.j41(0,"div",4)(1,"mat-checkbox",5),e.nI1(2,"translate"),e.bIt("click",function(T){return T.stopPropagation()})("change",function(T){return i.toggleFilterState(T)}),e.k0s(),e.j41(3,"mat-form-field",6)(4,"mat-select",7),e.nI1(5,"translate"),e.bIt("selectionChange",function(T){return i.changeLogical(T.value)}),e.j41(6,"mat-option",8),e.nI1(7,"translate"),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"mat-option",8),e.nI1(11,"translate"),e.EFF(12),e.nI1(13,"translate"),e.k0s()()(),e.DNE(14,Ko,13,22,"mat-form-field",9),e.nI1(15,"async"),e.nI1(16,"async"),e.nI1(17,"async"),e.nI1(18,"async"),e.j41(19,"mat-form-field",10),e.nI1(20,"async"),e.nI1(21,"async"),e.j41(22,"mat-select",11),e.nI1(23,"translate"),e.nI1(24,"translate"),e.bIt("selectionChange",function(T){return i.changeOperator(T.value)}),e.DNE(25,oo,4,7,"mat-option",12),e.nI1(26,"async"),e.nI1(27,"keyvalue"),e.k0s()(),e.DNE(28,Fe,3,3,"mat-form-field",13),e.nI1(29,"async"),e.DNE(30,Ee,8,12,"mat-form-field",14),e.j41(31,"div",15)(32,"button",16),e.nI1(33,"translate"),e.bIt("click",function(){return i.deleteFilter()}),e.j41(34,"mat-icon"),e.EFF(35,"delete"),e.k0s()()(),e.DNE(36,ct,4,7,"mat-form-field",17),e.nI1(37,"async"),e.DNE(38,gn,2,1,"ng-container",18),e.nI1(39,"async"),e.k0s(),e.j41(40,"div",4),e.DNE(41,hn,8,11,"mat-form-field",19)(42,Te,8,11,"mat-form-field",19),e.k0s(),e.DNE(43,pe,1,2,"igo-ogc-filter-time",20)),2&n&&(e.R7$(),e.Y8G("matTooltip",e.bMT(2,27,"igo.geo.filter.toggleFilterState"))("checked",i.currentFilter.active),e.R7$(2),e.Y8G("ngClass",e.l_i(67,Ht,0!==i.activeFilters.indexOf(i.currentFilter)&&!0===i.currentFilter.active,0===i.activeFilters.indexOf(i.currentFilter)||!0!==i.currentFilter.active)),e.R7$(),e.Y8G("disabled",!i.currentFilter.active)("value",i.currentFilter.parentLogical)("matTooltip",i.currentFilter.parentLogical?e.bMT(5,29,"igo.geo.operators.tooltip."+i.currentFilter.parentLogical):""),e.R7$(2),e.Y8G("value",i.ogcFilterOperator.And)("matTooltip",e.bMT(7,31,"igo.geo.operators.tooltip.And")),e.R7$(2),e.SpI(" ",e.bMT(9,33,"igo.geo.operators.And")," "),e.R7$(2),e.Y8G("value",i.ogcFilterOperator.Or)("matTooltip",e.bMT(11,35,"igo.geo.operators.tooltip.Or")),e.R7$(2),e.SpI(" ",e.bMT(13,37,"igo.geo.operators.Or")," "),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(15,39,i.currentFilterIsSpatial$)&&e.bMT(16,41,i.fields$)&&e.bMT(17,43,i.fields$).length>0&&""!==e.bMT(18,45,i.fields$)[0].name),e.R7$(5),e.Y8G("ngClass",e.l_i(70,Io,!1===e.bMT(20,47,i.currentFilterIsSpatial$),e.bMT(21,49,i.currentFilterIsSpatial$)))("floatLabel",i.floatLabel),e.R7$(3),e.Y8G("matTooltip",i.currentFilter.operator?e.bMT(23,51,"igo.geo.operators.tooltip."+i.currentFilter.operator):e.bMT(24,53,"igo.geo.filter.selectOperator"))("disabled",!i.currentFilter.active)("value",i.currentFilter.operator),e.R7$(3),e.Y8G("ngForOf",e.bMT(27,57,e.bMT(26,55,i.ogcFilterOperators$))),e.R7$(3),e.Y8G("ngIf",e.bMT(29,59,i.currentFilterIsSpatial$)),e.R7$(2),e.Y8G("ngIf",-1!==e.lJ4(73,Co).indexOf(i.detectProperty())),e.R7$(2),e.Y8G("matTooltip",e.bMT(33,61,"igo.geo.filter.removeFilter")),e.R7$(4),e.Y8G("ngIf",e.bMT(37,63,i.currentFilterIsSpatial$)&&"snrc"===i.currentFilter.igoSpatialSelector),e.R7$(2),e.Y8G("ngIf",e.bMT(39,65,i.currentFilterIsSpatial$)&&"fixedExtent"===i.currentFilter.igoSpatialSelector),e.R7$(3),e.Y8G("ngIf",!i.isTemporalOperator()&&-1!==e.lJ4(74,Lo).indexOf(i.detectProperty(1))),e.R7$(),e.Y8G("ngIf",!i.isTemporalOperator()&&-1!==e.lJ4(75,Ao).indexOf(i.detectProperty(2))),e.R7$(),e.Y8G("ngIf",i.isTemporalOperator()))},dependencies:[ae.g7,ae.So,v.uc,v.oV,be.RG,be.rl,be.yw,o.YU,_e.Ve,_e.VO,re.wT,re.Sy,o.bT,Tt.fS,Tt.fg,Bt.jL,Bt.$3,Bt.pN,o.pM,L.Hl,L.iY,R.m_,R.An,vo,o.Jj,o.lG,y.Ck,P.D9],styles:["[_nghost-%COMP%]{width:100%;padding:5px 10px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}[_nghost-%COMP%]   .ogc-filter-form-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-select-arrow[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   .logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:100%;max-width:60px;margin-right:5px}[_nghost-%COMP%]   .logicalHidden[_ngcontent-%COMP%]{width:0px;visibility:hidden;max-width:0px}[_nghost-%COMP%]     .logical .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]     .logicalHidden .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .field[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .field .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .operator[_ngcontent-%COMP%]{width:150px;margin-right:5px;text-align:center}[_nghost-%COMP%]     .operator .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .spatialSelector[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .spatialSelector .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:27%}}[_nghost-%COMP%]   .snrc[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .singleInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .dualInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .dualInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{display:flex;padding-top:5px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var se=r(89204),ge=r(59864),xe=r(12772),He=r(53804),ot=r(77919);let Gt=(()=>{class l{http;constructor(t){this.http=t}getDomValuesFromURL(t){var n=this;return(0,se.A)(function*(){const i=t.url;let d;return yield n.http.get(i).pipe((0,g.T)(T=>(d=T,T)),(0,Be.W)(T=>(0,ot.$)(T))).toPromise(),d})()}static \u0275fac=function(n){return new(n||l)(e.KVO(u.Qq))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Rt=r(84205),Jt=r(43942),ho=r(52575);const _n=["selection"],Rn=()=>({standalone:!0});function bo(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI("",t.title," ")}}function Pn(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",14)(1,"mat-form-field")(2,"mat-select",15),e.nI1(3,"translate"),e.mxI("valueChange",function(i){e.eBV(t);const d=e.XpG(3);return e.DH7(d.currentPushButtonsGroup,i)||(d.currentPushButtonsGroup=i),e.Njj(i)}),e.DNE(4,bo,2,2,"mat-option",16),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(2),e.Y8G("matTooltip",e.bMT(3,3,"igo.geo.layer.legend.selectStyle")),e.R50("value",t.currentPushButtonsGroup),e.R7$(2),e.Y8G("ngForOf",t.getPushButtonsGroups())}}function $n(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-button-toggle",20),e.bIt("change",function(){const i=e.eBV(t).$implicit,d=e.XpG(3).$implicit,T=e.XpG();return e.Njj(T.onSelectionChange(i,d.selectorType))}),e.EFF(1),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG(4);e.Y8G("matTooltip",n.getToolTip(t))("ngStyle",n.getButtonColor(t))("checked",t.enabled)("value",t),e.R7$(),e.SpI("",t.title," ")}}function Ln(l,f){if(1&l&&(e.qex(0),e.j41(1,"h3"),e.EFF(2),e.k0s(),e.j41(3,"mat-button-toggle-group",18),e.DNE(4,$n,2,5,"mat-button-toggle",19),e.k0s(),e.bVm()),2&l){const t=f.$implicit,n=e.XpG(3);e.R7$(2),e.JRh(t.title),e.R7$(),e.FS9("vertical",n.bundleIsVertical(t)),e.R7$(),e.Y8G("ngForOf",t.selectors)}}function bi(l,f){if(1&l&&(e.j41(0,"div",12),e.nrm(1,"mat-divider"),e.DNE(2,Pn,5,5,"div",13)(3,Ln,5,3,"ng-container",5),e.k0s()),2&l){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.getPushButtonsGroups().length>1),e.R7$(),e.Y8G("ngForOf",t.currentPushButtonsGroup.computedSelectors)}}function Ci(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI("",t.title," ")}}function Si(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",14)(1,"mat-form-field")(2,"mat-select",22),e.nI1(3,"translate"),e.mxI("valueChange",function(i){e.eBV(t);const d=e.XpG(3);return e.DH7(d.currentCheckboxesGroup,i)||(d.currentCheckboxesGroup=i),e.Njj(i)}),e.DNE(4,Ci,2,2,"mat-option",16),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(2),e.Y8G("matTooltip",e.bMT(3,3,"igo.geo.layer.legend.selectStyle")),e.R50("value",t.currentCheckboxesGroup),e.R7$(2),e.Y8G("ngForOf",t.getCheckboxesGroups())}}function No(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-checkbox",25),e.bIt("change",function(){const i=e.eBV(t).$implicit,d=e.XpG(3).$implicit,T=e.XpG();return e.Njj(T.onSelectionChange(i,d.selectorType))}),e.EFF(1),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG(4);e.Y8G("matTooltip",n.getToolTip(t))("checked",t.enabled)("value",t),e.R7$(),e.SpI("",t.title," ")}}function ii(l,f){if(1&l){const t=e.RV6();e.j41(0,"u",28),e.bIt("click",function(){e.eBV(t);const i=e.XpG(5);return e.Njj(i.displayLessResults("checkbox"))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&l&&(e.R7$(),e.SpI("",e.bMT(2,1,"igo.geo.filter.displayLessResults")," "))}function An(l,f){if(1&l){const t=e.RV6();e.j41(0,"u",29),e.bIt("click",function(){e.eBV(t);const i=e.XpG(5);return e.Njj(i.displayMoreResults("checkbox"))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&l&&(e.R7$(),e.SpI("",e.bMT(2,1,"igo.geo.filter.displayMoreResults")," "))}function yn(l,f){if(1&l&&(e.j41(0,"p"),e.DNE(1,ii,3,3,"u",26)(2,An,3,3,"u",27),e.k0s()),2&l){const t=e.XpG().$implicit,n=e.XpG(3);e.R7$(),e.Y8G("ngIf",n.isLessResults(t,"checkbox")),e.R7$(),e.Y8G("ngIf",n.isMoreResults(t,"checkbox"))}}function Bo(l,f){if(1&l&&(e.qex(0),e.j41(1,"h3"),e.EFF(2),e.k0s(),e.j41(3,"div",23),e.DNE(4,No,2,4,"mat-checkbox",24),e.k0s(),e.DNE(5,yn,3,2,"p",6),e.bVm()),2&l){const t=f.$implicit,n=e.XpG(3);e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("ngForOf",t.selectors),e.R7$(),e.Y8G("ngIf",n.isLessResults(t,"checkbox")||n.isMoreResults(t,"checkbox"))}}function nr(l,f){if(1&l&&(e.j41(0,"div",21),e.nrm(1,"mat-divider"),e.DNE(2,Si,5,5,"div",13)(3,Bo,6,3,"ng-container",5),e.k0s()),2&l){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.getCheckboxesGroups().length>1),e.R7$(),e.Y8G("ngForOf",t.currentCheckboxesGroup.computedSelectors)}}function Fo(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI("",t.title," ")}}function Ti(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",14)(1,"mat-form-field")(2,"mat-select",31),e.nI1(3,"translate"),e.mxI("valueChange",function(i){e.eBV(t);const d=e.XpG(3);return e.DH7(d.currentRadioButtonsGroup,i)||(d.currentRadioButtonsGroup=i),e.Njj(i)}),e.DNE(4,Fo,2,2,"mat-option",16),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(2),e.Y8G("matTooltip",e.bMT(3,3,"igo.geo.layer.legend.selectStyle")),e.R50("value",t.currentRadioButtonsGroup),e.R7$(2),e.Y8G("ngForOf",t.getRadioButtonsGroups())}}function Ii(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-radio-button",34),e.nI1(1,"translate"),e.bIt("change",function(){e.eBV(t);const i=e.XpG(4);return e.Njj(i.emptyRadioButtons())}),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&l&&(e.Y8G("matTooltip",e.bMT(1,2,"igo.geo.filter.resetFilters")),e.R7$(2),e.SpI("",e.bMT(3,4,"igo.geo.filter.resetFilters")," "))}function Fi(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-radio-button",25),e.bIt("change",function(){const i=e.eBV(t).$implicit,d=e.XpG(3).$implicit,T=e.XpG();return e.Njj(T.onSelectionChange(i,d.selectorType))}),e.EFF(1),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG(4);e.Y8G("matTooltip",n.getToolTip(t))("checked",t.enabled)("value",t),e.R7$(),e.SpI("",t.title," ")}}function Mi(l,f){if(1&l){const t=e.RV6();e.j41(0,"u",28),e.bIt("click",function(){e.eBV(t);const i=e.XpG(5);return e.Njj(i.displayLessResults("radio"))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&l&&(e.R7$(),e.SpI("",e.bMT(2,1,"igo.geo.filter.displayLessResults")," "))}function xi(l,f){if(1&l){const t=e.RV6();e.j41(0,"u",29),e.bIt("click",function(){e.eBV(t);const i=e.XpG(5);return e.Njj(i.displayMoreResults("radio"))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&l&&(e.R7$(),e.SpI("",e.bMT(2,1,"igo.geo.filter.displayMoreResults")," "))}function vn(l,f){if(1&l&&(e.j41(0,"p"),e.DNE(1,Mi,3,3,"u",26)(2,xi,3,3,"u",27),e.k0s()),2&l){const t=e.XpG().$implicit,n=e.XpG(3);e.R7$(),e.Y8G("ngIf",n.isLessResults(t,"radio")),e.R7$(),e.Y8G("ngIf",n.isMoreResults(t,"radio"))}}function Ho(l,f){if(1&l&&(e.qex(0),e.j41(1,"h3"),e.EFF(2),e.k0s(),e.j41(3,"mat-radio-group",32),e.DNE(4,Ii,4,6,"mat-radio-button",33)(5,Fi,2,4,"mat-radio-button",24)(6,vn,3,2,"p",6),e.k0s(),e.bVm()),2&l){const t=f.$implicit,n=e.XpG(3);e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("ngIf",t.unfiltered),e.R7$(),e.Y8G("ngForOf",t.selectors),e.R7$(),e.Y8G("ngIf",n.isLessResults(t,"radio")||n.isMoreResults(t,"radio"))}}function bn(l,f){if(1&l&&(e.j41(0,"div",30),e.nrm(1,"mat-divider"),e.DNE(2,Ti,5,5,"div",13)(3,Ho,7,4,"ng-container",5),e.k0s()),2&l){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.getRadioButtonsGroups().length>1),e.R7$(),e.Y8G("ngForOf",t.currentRadioButtonsGroup.computedSelectors)}}function Mo(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI("",t.title," ")}}function nn(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",14)(1,"mat-form-field")(2,"mat-select",36),e.nI1(3,"translate"),e.mxI("valueChange",function(i){e.eBV(t);const d=e.XpG(3);return e.DH7(d.currentSelectGroup,i)||(d.currentSelectGroup=i),e.Njj(i)}),e.DNE(4,Mo,2,2,"mat-option",16),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(2),e.Y8G("matTooltip",e.bMT(3,3,"igo.geo.layer.legend.selectStyle")),e.R50("value",t.currentSelectGroup),e.R7$(2),e.Y8G("ngForOf",t.getSelectGroups())}}function Cn(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-button",39),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(4);return e.Njj(i.emptySelect())}),e.j41(2,"mat-icon"),e.EFF(3,"filter_alt_off"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.filter.resetFilters"))}function rn(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-checkbox",43),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(5);return e.DH7(d.selectAllSelected,i)||(d.selectAllSelected=i),e.Njj(i)}),e.bIt("change",function(){e.eBV(t);const i=e.XpG(5);return e.Njj(i.toggleAllSelection())}),e.EFF(1,"Tous "),e.k0s()}if(2&l){const t=e.XpG(5);e.R50("ngModel",t.selectAllSelected),e.Y8G("ngModelOptions",e.lJ4(2,Rn))}}function zo(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-option",44),e.bIt("onSelectionChange",function(i){e.eBV(t);const d=e.XpG(2).$implicit,T=e.XpG(3);return e.Njj(T.selectOptionClick(i.source.value,d,i))}),e.EFF(1),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG(5);e.Y8G("matTooltip",n.getToolTip(t))("value",t),e.R7$(),e.SpI("",t.title," ")}}function Oi(l,f){if(1&l&&(e.j41(0,"div")(1,"mat-select",40,1)(3,"div",23),e.DNE(4,rn,2,3,"mat-checkbox",41),e.k0s(),e.DNE(5,zo,2,3,"mat-option",42),e.k0s()()),2&l){const t=e.XpG().$implicit;e.R7$(),e.Y8G("multiple",t.multiple)("placeholder",t.title),e.R7$(3),e.Y8G("ngIf",t.multiple),e.R7$(),e.Y8G("ngForOf",t.selectors)}}function wi(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-option",44),e.bIt("onSelectionChange",function(i){e.eBV(t);const d=e.XpG(2).$implicit,T=e.XpG(3);return e.Njj(T.selectOptionClick(i.source.value,d))}),e.EFF(1),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG(5);e.Y8G("matTooltip",n.getToolTip(t))("value",t),e.R7$(),e.SpI("",t.title," ")}}function Ei(l,f){if(1&l&&(e.j41(0,"mat-select",45),e.DNE(1,wi,2,3,"mat-option",42),e.k0s()),2&l){const t=e.XpG().$implicit;e.Y8G("placeholder",t.title),e.R7$(),e.Y8G("ngForOf",t.selectors)}}function Di(l,f){if(1&l&&(e.qex(0),e.j41(1,"h3"),e.EFF(2),e.k0s(),e.j41(3,"div",14),e.DNE(4,Cn,4,3,"mat-button",37),e.j41(5,"mat-form-field"),e.DNE(6,Oi,6,4,"div",38)(7,Ei,2,2,"ng-template",null,0,e.C5r),e.k0s()(),e.bVm()),2&l){const t=f.$implicit,n=e.sdS(8);e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("ngIf",t.unfiltered&&!t.multiple),e.R7$(),e.xc7("width",t.width?t.width:void 0,"%"),e.R7$(),e.Y8G("ngIf",t.multiple)("ngIfElse",n)}}function Ri(l,f){if(1&l&&(e.j41(0,"div",35),e.nrm(1,"mat-divider"),e.DNE(2,nn,5,5,"div",13)(3,Di,9,6,"ng-container",5),e.k0s()),2&l){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.getSelectGroups().length>1),e.R7$(),e.Y8G("ngForOf",t.currentSelectGroup.computedSelectors)}}function Pi(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI("",t.title," ")}}function Kt(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",14)(1,"mat-form-field")(2,"mat-select",47),e.nI1(3,"translate"),e.mxI("valueChange",function(i){e.eBV(t);const d=e.XpG(3);return e.DH7(d.currentAutocompleteGroup,i)||(d.currentAutocompleteGroup=i),e.Njj(i)}),e.DNE(4,Pi,2,2,"mat-option",16),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(2),e.Y8G("matTooltip",e.bMT(3,3,"igo.geo.layer.legend.selectStyle")),e.R50("value",t.currentAutocompleteGroup),e.R7$(2),e.Y8G("ngForOf",t.getAutocompleteGroups())}}function $i(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-button",39),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(4);return e.Njj(i.emptyAutocomplete())}),e.j41(2,"mat-icon"),e.EFF(3,"filter_alt_off"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.filter.resetFilters"))}function Li(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-chip",54),e.bIt("removed",function(){const i=e.eBV(t).$implicit,d=e.XpG(6);return e.Njj(d.toggleSelection(i))}),e.EFF(1),e.j41(2,"button",55),e.nI1(3,"translate"),e.j41(4,"mat-icon"),e.EFF(5,"cancel"),e.k0s()()()}if(2&l){const t=f.$implicit;e.R7$(),e.SpI(" ",t," "),e.R7$(),e.Y8G("matTooltip",e.bMT(3,2,"igo.geo.filter.removeFilter"))}}function Ai(l,f){if(1&l&&(e.j41(0,"mat-chip-set"),e.DNE(1,Li,6,4,"mat-chip",53),e.k0s()),2&l){const t=e.XpG(5);e.R7$(),e.Y8G("ngForOf",t.autocompleteEnableds)}}function ki(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-option",56)(1,"div",57),e.bIt("click",function(i){const d=e.eBV(t).$implicit,T=e.XpG(5);return e.Njj(T.toggleAutocompleteOption(i,d.value))}),e.j41(2,"mat-checkbox",58),e.bIt("click",function(i){const d=e.eBV(t).$implicit,T=e.XpG(5);return e.Njj(T.toggleAutocompleteOption(i,d.value))}),e.k0s(),e.EFF(3),e.k0s()()}if(2&l){const t=f.$implicit,n=e.XpG(5);e.Y8G("matTooltip",n.getToolTip(t)),e.R7$(2),e.Y8G("checked",n.checkedStatus(t.value)),e.R7$(),e.SpI(" ",t.value," ")}}function kn(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",49)(1,"mat-label"),e.EFF(2),e.k0s(),e.DNE(3,Ai,2,1,"mat-chip-set",6),e.j41(4,"input",50,2),e.bIt("input",function(){e.eBV(t);const i=e.XpG(4);return e.Njj(i.onInputChange())}),e.k0s(),e.j41(6,"mat-autocomplete",51,3),e.DNE(8,ki,4,3,"mat-option",52),e.nI1(9,"async"),e.k0s()()}if(2&l){let t;const n=e.sdS(7),i=e.XpG().$implicit,d=e.XpG(3);e.xc7("width",i.width?i.width:void 0,"%"),e.R7$(2),e.JRh(i.title),e.R7$(),e.Y8G("ngIf",d.filteredOgcAutocomplete[i.id]&&(null===(t=i.showChips)||void 0===t||t)),e.R7$(),e.Y8G("matAutocomplete",n),e.R7$(2),e.Y8G("displayWith",d.displayFn),e.R7$(2),e.Y8G("ngForOf",e.bMT(9,7,d.filteredOgcAutocomplete[i.id]))}}function ri(l,f){if(1&l&&(e.qex(0),e.j41(1,"h3"),e.EFF(2),e.k0s(),e.j41(3,"div",14),e.DNE(4,$i,4,3,"mat-button",37)(5,kn,10,9,"mat-form-field",48),e.k0s(),e.bVm()),2&l){const t=f.$implicit,n=e.XpG(3);e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("ngIf",t.unfiltered),e.R7$(),e.Y8G("ngIf",n.filteredOgcAutocomplete[t.id])}}function sn(l,f){if(1&l&&(e.j41(0,"div",46),e.nrm(1,"mat-divider"),e.DNE(2,Kt,5,5,"div",13)(3,ri,6,3,"ng-container",5),e.k0s()),2&l){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.getAutocompleteGroups().length>1),e.R7$(),e.Y8G("ngForOf",t.currentAutocompleteGroup.computedSelectors)}}function ji(l,f){if(1&l&&(e.j41(0,"div"),e.DNE(1,bi,4,2,"div",7)(2,nr,4,2,"div",8)(3,bn,4,2,"div",9)(4,Ri,4,2,"div",10)(5,sn,4,2,"div",11),e.k0s()),2&l){const t=f.$implicit;e.R7$(),e.Y8G("ngIf","pushButton"===t.selectorType),e.R7$(),e.Y8G("ngIf","checkbox"===t.selectorType),e.R7$(),e.Y8G("ngIf","radioButton"===t.selectorType),e.R7$(),e.Y8G("ngIf","select"===t.selectorType),e.R7$(),e.Y8G("ngIf","autocomplete"===t.selectorType)}}function Bi(l,f){1&l&&(e.j41(0,"h3"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.filter.reportingDate")," "))}function si(l,f){if(1&l&&(e.j41(0,"h3"),e.EFF(1),e.k0s()),2&l){const t=e.XpG(2);e.R7$(),e.JRh(t.currentFilter.title)}}function ir(l,f){if(1&l){const t=e.RV6();e.j41(0,"div"),e.nrm(1,"mat-divider"),e.DNE(2,Bi,3,3,"h3",6)(3,si,2,1,"h3",6),e.j41(4,"igo-ogc-filter-time",59),e.bIt("changeProperty",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeProperty(i.value,i.pos))}),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",!t.currentFilter.title),e.R7$(),e.Y8G("ngIf",t.currentFilter.title),e.R7$(),e.Y8G("datasource",t.datasource)("currentFilter",t.currentFilter)}}let Gi=(()=>{class l{ogcFilterService;formBuilder;domService;configService;cdRef;sel;matAutocomplete;refreshFilters;datasource;map;checkboxesIndex=5;radioButtonsIndex=5;baseIndex=5;get currentFilter(){return this._currentFilter}set currentFilter(t){this._currentFilter=t,this._currentFilter?.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}_currentFilter;inputChangeAutocomplete=new Rt.B;ogcFilterOperator=ee.E;form;ogcFilterWriter;color="primary";selectAllSelected=!1;selectEnabled$=new ce.t(void 0);selectEnableds$=new ce.t([]);autocompleteEnableds$=new ce.t([]);filteredOgcAutocomplete={};applyFiltersTimeout;get ogcFiltersSelectors(){const t=[];return this.datasource?.options?.ogcFilters?.pushButtons&&t.push(this.datasource?.options?.ogcFilters?.pushButtons),this.datasource?.options?.ogcFilters?.checkboxes&&t.push(this.datasource?.options?.ogcFilters?.checkboxes),this.datasource?.options?.ogcFilters?.radioButtons&&t.push(this.datasource?.options?.ogcFilters?.radioButtons),this.datasource?.options?.ogcFilters?.select&&t.push(this.datasource?.options?.ogcFilters?.select),this.datasource?.options?.ogcFilters?.autocomplete&&t.push(this.datasource?.options?.ogcFilters?.autocomplete),t.sort((n,i)=>n.order<i.order?-1:n.order>i.order?1:0),t}get currentPushButtonsGroup(){return this.form.get("pushButtonsGroup").value}set currentPushButtonsGroup(t){this.form.patchValue({pushButtonsGroup:t})}get currentCheckboxesGroup(){return this.form.get("checkboxesGroup").value}set currentCheckboxesGroup(t){this.form.patchValue({checkboxesGroup:t})}get currentRadioButtonsGroup(){return this.form.get("radioButtonsGroup").value}set currentRadioButtonsGroup(t){this.form.patchValue({radioButtonsGroup:t})}get currentSelectGroup(){return this.form.get("selectGroup").value}set currentSelectGroup(t){this.form.patchValue({selectGroup:t}),this.cdRef.detectChanges()}get currentAutocompleteGroup(){return this.form.get("autocompleteGroup").value}set currentAutocompleteGroup(t){this.form.patchValue({autocompleteGroup:t}),this.cdRef.detectChanges()}get selectEnabled(){return this.selectEnabled$.value}set selectEnabled(t){this.selectEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(i=>{i.enabled=t===i})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get selectEnableds(){return this.selectEnableds$.value}set selectEnableds(t){this.selectEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(i=>{i.enabled=!!t.includes(i)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get autocompleteEnableds(){return this.autocompleteEnableds$.value}set autocompleteEnableds(t){this.autocompleteEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(i=>{i.enabled=!1;for(const d of t)d===i.title&&(i.enabled=!0)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}checkedStatus(t){return this.autocompleteEnableds.includes(t)}constructor(t,n,i,d,T){this.ogcFilterService=t,this.formBuilder=n,this.domService=i,this.configService=d,this.cdRef=T,this.ogcFilterWriter=new Z.l,this.buildForm()}buildForm(){this.form=this.formBuilder.group({pushButtons:[""],radioButtons:[""],pushButtonsGroup:["",[Q.k0.required]],checkboxesGroup:["",[Q.k0.required]],radioButtonsGroup:["",[Q.k0.required]],selectGroup:["",[Q.k0.required]],select:[""],selectMulti:[""],autocompleteGroup:["",[Q.k0.required]],autocomplete:[""]})}getPushButtonsGroups(){if(this.datasource?.options?.ogcFilters?.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}getCheckboxesGroups(){if(this.datasource?.options?.ogcFilters?.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}getRadioButtonsGroups(){if(this.datasource?.options?.ogcFilters?.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}getSelectGroups(){if(this.datasource?.options?.ogcFilters?.select)return this.datasource.options.ogcFilters.select.groups}getAutocompleteGroups(){if(this.datasource?.options?.ogcFilters?.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}ngOnInit(){var t=this;return(0,se.A)(function*(){t.datasource.options.ogcFilters&&(t.datasource.options.ogcFilters.pushButtons&&(t.currentPushButtonsGroup=t.datasource.options.ogcFilters.pushButtons.groups.find(n=>n.enabled)||t.datasource.options.ogcFilters.pushButtons.groups[0]),t.datasource.options.ogcFilters.checkboxes&&(t.currentCheckboxesGroup=t.datasource.options.ogcFilters.checkboxes.groups.find(n=>n.enabled)||t.datasource.options.ogcFilters.checkboxes.groups[0]),t.datasource.options.ogcFilters.radioButtons&&(t.currentRadioButtonsGroup=t.datasource.options.ogcFilters.radioButtons.groups.find(n=>n.enabled)||t.datasource.options.ogcFilters.radioButtons.groups[0]),t.datasource.options.ogcFilters.select&&(t.currentSelectGroup=t.datasource.options.ogcFilters.select.groups.find(n=>n.enabled)||t.datasource.options.ogcFilters.select.groups[0],t.initSelectEnabled(),yield t.getSelectDomValues()),t.datasource.options.ogcFilters.autocomplete&&(t.currentAutocompleteGroup=t.datasource.options.ogcFilters.autocomplete.groups.find(n=>n.enabled)||t.datasource.options.ogcFilters.autocomplete.groups[0],t.initAutocompleteEnableds(),yield t.getAutocompleteDomValues()),t.applyFilters()),t.form.get("pushButtonsGroup").valueChanges.pipe((0,ho.B)(750)).subscribe(()=>{t.onPushButtonsChangeGroup(),t.applyFilters()}),t.form.get("checkboxesGroup").valueChanges.pipe((0,ho.B)(750)).subscribe(()=>{t.onCheckboxesChangeGroup(),t.applyFilters()}),t.form.get("radioButtonsGroup").valueChanges.pipe((0,ho.B)(750)).subscribe(()=>{t.onRadioButtonsChangeGroup(),t.applyFilters()}),t.form.get("selectGroup").valueChanges.pipe((0,ho.B)(750)).subscribe(()=>{t.onSelectChangeGroup(),t.applyFilters()}),t.form.get("autocompleteGroup").valueChanges.pipe((0,ho.B)(750)).subscribe(()=>{t.onAutocompleteChangeGroup(),t.applyFilters()}),t.form.get("pushButtons").valueChanges.pipe((0,ho.B)(750)).subscribe(()=>{t.applyFilters()}),t.form.get("radioButtons").valueChanges.pipe((0,ho.B)(750)).subscribe(()=>{t.applyFilters()}),t.inputChangeAutocomplete.pipe().subscribe(()=>{t.getAutocompleteDomValues()})})()}initSelectEnabled(){const t=[];let n;this.currentSelectGroup.computedSelectors.forEach(i=>{i.multiple?(i.selectors?.forEach(d=>{d.enabled&&t.push(d)}),this.selectEnableds=t,this.form.controls.selectMulti.setValue(t)):(i.selectors?.forEach(d=>{d.enabled&&(n=d)}),this.form.controls.select.reset(n),this.selectEnabled$.subscribe(d=>{this.form.controls.select.value!==d&&this.form.controls.select.setValue(d)}),this.selectEnabled=n)})}initAutocompleteEnableds(){let t=[];this.currentAutocompleteGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(i=>{if(i.enabled){const d={id:i.filters.expression,value:i.title};t.push(i.title),this.form.controls.autocomplete.setValue(d)}}),this.autocompleteEnableds=t})}getToolTip(t){let n;return t.tooltip&&(n=Array.isArray(t.tooltip)?t.tooltip.join("\n"):t.tooltip),n||""}getSelectDomValues(){var t=this;return(0,se.A)(function*(){for(const n of t.datasource.options.ogcFilters.select.bundles)if(n.domSelectors){let i;for(const d of n.domSelectors){let T;for(const B of t.configService.getConfig("dom"))(d.id===B.id||d.name===B.name)&&(T={id:B.id,url:B.url,name:B.name,values:B.values});if(i=T.url?yield t.domService.getDomValuesFromURL(T):T.values,i){let me,B=n;B.selectors=[];for(const fe of i){if(n.multiple){let we;we=!!t.selectEnableds?.find(Me=>Me.title===fe.value),me={title:fe.value,enabled:we,filters:{operator:d.operator,propertyName:d.propertyName,expression:fe.id}}}else me={title:fe.value,enabled:t.selectEnabled?.title===fe.value,filters:{operator:d.operator,propertyName:d.propertyName,expression:fe.id}};B.selectors.push(me)}t.getSelectGroups().find(fe=>fe.ids.includes(B.id)).computedSelectors.find(fe=>fe.title===B.title).selectors=B.selectors}}t.initSelectEnabled()}})()}onInputChange(){this.inputChangeAutocomplete.next()}getAutocompleteDomValues(){var t=this;return(0,se.A)(function*(){for(const n of t.datasource.options.ogcFilters.autocomplete.bundles)if(n.domSelectors){let i;for(const d of n.domSelectors){let T;for(const B of t.configService.getConfig("dom"))(d.id===B.id||d.name===B.name)&&(T={id:B.id,url:B.url,name:B.name,values:B.values});if(i=T.url?yield t.domService.getDomValuesFromURL(T):T.values,i){let me,B=n;B.selectors=[];for(const fe of i)me={title:fe.id,enabled:!!t.autocompleteEnableds?.includes(fe.value),filters:{operator:d.operator,propertyName:d.propertyName,expression:fe.value}},B.selectors.push(me);t.getAutocompleteGroups().find(fe=>fe.ids.includes(B.id)).computedSelectors.find(fe=>fe.title===B.title).selectors=B.selectors}}t.filteredOgcAutocomplete[n.id]=new Jt.c,t.cdRef.detectChanges(),t.filteredOgcAutocomplete[n.id]=(0,Xe.of)(i)}})()}getButtonColor(t){let n;return t.color&&t.enabled&&(n={"background-color":`rgba(${t.color})`}),n}bundleIsVertical(t){return!!t.vertical&&t.vertical}onPushButtonsChangeGroup(){this.getPushButtonsGroups().map(t=>t.enabled=!1),this.getPushButtonsGroups().find(t=>t===this.currentPushButtonsGroup).enabled=!0}onCheckboxesChangeGroup(){this.getCheckboxesGroups().map(t=>t.enabled=!1),this.getCheckboxesGroups().find(t=>t===this.currentCheckboxesGroup).enabled=!0}onRadioButtonsChangeGroup(){this.getRadioButtonsGroups().map(t=>t.enabled=!1),this.getRadioButtonsGroups().find(t=>t===this.currentRadioButtonsGroup).enabled=!0}onSelectChangeGroup(){this.getSelectGroups().map(t=>t.enabled=!1),this.getSelectGroups().find(t=>t===this.currentSelectGroup).enabled=!0}onAutocompleteChangeGroup(){this.getAutocompleteGroups().map(t=>t.enabled=!1),this.getAutocompleteGroups().find(t=>t===this.currentAutocompleteGroup).enabled=!0}onSelectionChange(t,n){clearTimeout(this.applyFiltersTimeout),"radioButton"===n&&this.emptyRadioButtons(),t&&(t.enabled=!t.enabled),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}emptyRadioButtons(){this.currentRadioButtonsGroup.computedSelectors.forEach(t=>{t.selectors.map(n=>n.enabled=!1),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)})}emptySelect(){this.selectEnabled=void 0}emptyAutocomplete(){this.autocompleteEnableds=[],this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}toggleAllSelection(){if(this.selectAllSelected){const t=[];this.currentSelectGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(i=>{t.push(i)})}),this.sel.options.forEach(n=>n.select()),this.selectEnableds=t}else this.sel.options.forEach(t=>t.deselect()),this.selectEnableds=[]}selectOptionClick(t,n,i){if(n.multiple){const d=this.selectEnableds;let T=!0;if(this.sel.options.forEach(B=>{B.selected||(T=!1)}),this.selectAllSelected=T,i.isUserInput)if(d.length){for(const B of d)if(B.title===t.title){if(B.enabled&&t.enabled){d.splice(d.indexOf(B),1),this.selectEnableds=d;break}}else if(d.indexOf(B)===d.length-1){d.push(t),this.selectEnableds=d;break}}else d.push(t),this.selectEnableds=d}else this.selectEnabled=t}toggleAutocompleteOption(t,n){t.stopPropagation(),this.toggleSelection(n)}toggleSelection(t){this.autocompleteEnableds=this.autocompleteEnableds.includes(t)?this.autocompleteEnableds.filter(n=>n!==t):[...this.autocompleteEnableds,t]}displayFn(){return""}applyFilters(){let t="";const n=[],i=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];for(const d of i)d.computedSelectors&&d.computedSelectors.map(T=>{const B=[];T.selectors?.filter(me=>!0===me.enabled).forEach(me=>B.push(me.filters)),B.length>=1&&n.push(1===B.length?B[0]:{logical:T.logical,filters:B})});this.isTemporalOperator()&&this._currentFilter.active&&n.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),n.length>=1&&(t=this.ogcFilterWriter.buildFilter(1===n.length?n[0]:{logical:"And",filters:n})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}isMoreResults(t,n){let i=0;for(const T of t.selectors)i++;return i>("radio"===n?this.radioButtonsIndex:this.checkboxesIndex)}displayMoreResults(t){"radio"===t?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}isLessResults(t,n){let i=0;for(const T of t.selectors)i++;return this.baseIndex!==("radio"===n?this.radioButtonsIndex:this.checkboxesIndex)&&i>this.baseIndex}displayLessResults(t){"radio"===t?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}isTemporalOperator(){return this.currentFilter?.operator?.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}changeProperty(t,n,i=!0){const d=this.detectProperty(n);d&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(T=>T.filterid===this.currentFilter.filterid)[d]=t,i&&this.applyFilters())}detectProperty(t){switch(this.currentFilter.operator){case ee.E.PropertyIsNotEqualTo:case ee.E.PropertyIsEqualTo:case ee.E.PropertyIsGreaterThan:case ee.E.PropertyIsGreaterThanOrEqualTo:case ee.E.PropertyIsLessThan:case ee.E.PropertyIsLessThanOrEqualTo:return"expression";case ee.E.PropertyIsLike:return"pattern";case ee.E.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case ee.E.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}static \u0275fac=function(n){return new(n||l)(e.rXU(G),e.rXU(Q.ze),e.rXU(Gt),e.rXU(A.we),e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(n,i){if(1&n&&(e.GBs(_n,5),e.GBs(Bt.pN,5,Bt.pN)),2&n){let d;e.mGM(d=e.lsd())&&(i.sel=d.first),e.mGM(d=e.lsd())&&(i.matAutocomplete=d.first)}},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},standalone:!0,features:[e.Jv_([Gt]),e.aNF],decls:3,vars:3,consts:[["notMulti",""],["selection",""],["input",""],["auto","matAutocomplete"],[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"change","matTooltip","ngStyle","checked","value"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"change","matTooltip","checked","value"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"change","matTooltip"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"click","matTooltip"],["formControlName","selectMulti",3,"multiple","placeholder"],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModelChange","change","ngModel","ngModelOptions"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"onSelectionChange","matTooltip","value"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],["floatLabel","always",3,"width",4,"ngIf"],["floatLabel","always"],["matInput","","type","text","formControlName","autocomplete",3,"input","matAutocomplete"],[3,"displayWith"],["id","mat-option",3,"matTooltip",4,"ngFor","ngForOf"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove","",3,"matTooltip"],["id","mat-option",3,"matTooltip"],[3,"click"],["id","mat-checkbox","color","primary",3,"click","checked"],[3,"changeProperty","datasource","currentFilter"]],template:function(n,i){1&n&&(e.j41(0,"form",4),e.DNE(1,ji,6,5,"div",5),e.k0s(),e.DNE(2,ir,5,4,"div",6)),2&n&&(e.Y8G("formGroup",i.form),e.R7$(),e.Y8G("ngForOf",i.ogcFiltersSelectors),e.R7$(),e.Y8G("ngIf",i.isTemporalOperator()))},dependencies:[Q.YN,Q.qT,Q.me,Q.BC,Q.cb,Q.vS,Q.X1,Q.j4,Q.JD,o.pM,o.bT,ye.w,ye.q,be.RG,be.rl,be.nJ,_e.Ve,_e.VO,re.wT,v.uc,v.oV,re.Sy,ge.Vg,ge.ec,ge.pc,o.B3,ae.g7,ae.So,He.Wk,He.VT,He._g,R.m_,R.An,Tt.fS,Tt.fg,Bt.jL,Bt.$3,Bt.pN,vo,o.Jj,y.Ck,P.D9,xe.YN,xe.Jl,xe.Zv,xe.Jo],styles:["[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}[_nghost-%COMP%]   .checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}[_nghost-%COMP%]   .groupsSelector[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:unset;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]     .material-tooltip{white-space:pre-wrap}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%], [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     label, [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin:7px;text-align:left}[_nghost-%COMP%]   u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:unset}"]})}return l})();function rr(l,f){if(1&l&&e.nrm(0,"igo-ogc-filter-selection",2),2&l){const t=e.XpG();e.Y8G("refreshFilters",t.refreshFunc)("datasource",t.datasource)("map",t.map)("currentFilter",t.currentFilter)}}function sr(l,f){if(1&l&&e.nrm(0,"igo-ogc-filter-form",4),2&l){const t=f.$implicit,n=e.XpG(2);e.Y8G("currentFilter",t)("refreshFilters",n.refreshFunc)("datasource",n.datasource)("map",n.map)}}function ai(l,f){if(1&l&&e.DNE(0,sr,1,4,"ng-template",3),2&l){const t=e.XpG();e.Y8G("ngForOf",t.datasource.options.ogcFilters.interfaceOgcFilters)}}let jn=(()=>{class l{datasource;map;refreshFilters;get refreshFunc(){return this.refreshFilters}get advancedOgcFilters(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}get currentFilter(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}color="primary";constructor(){}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},standalone:!0,features:[e.Jv_([{provide:_e.JO,useValue:{overlayPanelClass:"igo-overlay-panel-width"}},{provide:Bt.PF,useValue:{overlayPanelClass:"igo-overlay-panel-width"}}]),e.aNF],decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(n,i){1&n&&e.DNE(0,rr,1,4,"igo-ogc-filter-selection",0)(1,ai,1,1,null,1),2&n&&(e.Y8G("ngIf",!i.advancedOgcFilters),e.R7$(),e.Y8G("ngIf",i.advancedOgcFilters&&i.datasource.options.ogcFilters.editable))},dependencies:[o.bT,Gi,s.dF,o.pM,te],styles:[".igo-overlay-panel-width{min-width:-moz-fit-content;min-width:fit-content}\n\n/*# sourceMappingURL=ogc-filterable-form.component.ts-angular-inline--1.css.map*/"]})}return l})();const ar=l=>({"separate-item":l}),Vi=l=>({cursor:l}),Ui=l=>({disabled:l});function lr(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-icon",11),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleFiltersCollapsed())}),e.EFF(1,"expand_less "),e.k0s()}if(2&l){const t=e.XpG(),n=e.sdS(8);e.Y8G("target",n)("collapsed",t.filtersCollapsed)}}function cr(l,f){if(1&l){const t=e.RV6();e.j41(0,"span",12),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleLegendOnClick())}),e.EFF(1),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("ngStyle",e.eq3(3,Vi,t.filtersCollapsed?"default":"pointer"))("matTooltip",t.layer.title),e.R7$(),e.SpI(" ",t.layer.title," ")}}function ur(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",13),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.addFilterToSequence())}),e.j41(2,"mat-icon"),e.EFF(3,"add"),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("disabled",t.addFilterDisabled())("matTooltip",e.bMT(1,3,"igo.geo.filter.addFilter"))("color",t.color)}}function pr(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",14),e.nI1(1,"translate"),e.nI1(2,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.layer.visible=!i.layer.visible)}),e.j41(3,"mat-icon",2),e.nI1(4,"async"),e.EFF(5),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.bMT(1,4,"igo.geo.layer.hideLayer"):e.bMT(2,6,"igo.geo.layer.showLayer")),e.R7$(3),e.Y8G("ngClass",e.eq3(10,Ui,!1===e.bMT(4,8,t.inResolutionRange$))),e.R7$(2),e.SpI("",t.layer.visible?"visibility":"visibility_off"," ")}}function Ni(l,f){if(1&l&&e.nrm(0,"igo-layer-legend",17),2&l){const t=e.XpG(2);e.Y8G("layer",t.layer)}}function li(l,f){if(1&l&&(e.j41(0,"div",15,1),e.DNE(2,Ni,1,1,"igo-layer-legend",16),e.nI1(3,"async"),e.k0s()),2&l){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",e.bMT(3,1,t.showLegend$))}}function Yi(l,f){if(1&l){const t=e.RV6();e.j41(0,"section",18),e.nrm(1,"mat-divider"),e.j41(2,"mat-checkbox",19),e.bIt("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.changeOgcFilterType(i))}),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG();return e.DH7(d.datasource.options.ogcFilters.advancedOgcFilters,i)||(d.datasource.options.ogcFilters.advancedOgcFilters=i),e.Njj(i)}),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(2),e.R50("ngModel",t.datasource.options.ogcFilters.advancedOgcFilters),e.R7$(),e.SpI(" ",e.bMT(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}let Jo=(()=>{class l{ogcFilterService;color="primary";lastRunOgcFilter;defaultLogicalParent=ee.E.And;hasActiveSpatialFilter=!1;filtersAreEditable=!0;filtersCollapsed=!0;hasSelector=!1;showLegend$=new ce.t(!1);inResolutionRange$=new ce.t(!0);resolution$$;ogcFilterWriter;layer;map;header=!0;get refreshFunc(){return this.refreshFilters.bind(this)}get datasource(){return this.layer.dataSource}constructor(t){this.ogcFilterService=t,this.ogcFilterWriter=new Z.l}ngOnInit(){this.layer.visible&&(this.filtersCollapsed=!1);const t=this.datasource.options.ogcFilters;switch((t.pushButtons&&t.pushButtons.bundles.length>0||t.checkboxes&&t.checkboxes.bundles.length>0||t.radioButtons&&t.radioButtons.bundles.length>0||t.select&&t.select.bundles.length>0||t.autocomplete&&t.autocomplete.bundles.length>0)&&(void 0===t.advancedOgcFilters&&(t.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}t&&(t.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(t.interfaceOgcFilters)),t.interfaceOgcFilters.filter(i=>i.wkt_geometry).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!t.editable&&t.editable),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}addFilterToSequence(){this.filtersCollapsed=!1;const n=this.datasource.options.ogcFilters.interfaceOgcFilters||[],i=0===n.length?0:n[n.length-1].level;let d="";const T=this.datasource.options.sourceFields.filter(Me=>!Me.excludeFromOgcFilters);let B;T.length>0&&(d=void 0===T[0].name?"":T[0].name);const me=this.datasource.options;me.fieldNameGeometry?B=me.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(B=this.datasource.options.paramsWFS.fieldNameGeometry);const fe=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,d,this.datasource.options.ogcFilters.allowedOperatorsType),we=Object.keys(fe)[0];n.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:d,operator:we,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},B,i,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=n}refreshFilters(t){!0===t&&(this.lastRunOgcFilter=void 0);const n=this.datasource.options.ogcFilters,i=n.interfaceOgcFilters?n.interfaceOgcFilters.filter(d=>!0===d.active):[];if(0===i.length&&(n.filters=void 0,n.filtered=!1),i.length>1&&(i[0].parentLogical=i[1].parentLogical),this.hasActiveSpatialFilter=0!==i.filter(d=>-1!==["Contains","Intersects","Within"].indexOf(d.operator)).length,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(i)){if("wfs"===this.layer.dataSource.options.type)this.layer.dataSource.options.ogcFilters.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(i),this.layer.dataSource.ol.refresh();else if("wms"===this.layer.dataSource.options.type&&n.enabled){let d="";if(i.length>=1){const T=this.layer.dataSource,B=T.options.ogcFilters;B.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(i),d=this.ogcFilterWriter.buildFilter(B.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,T.options)}this.ogcFilterService.filterByOgc(this.datasource,d),this.datasource.options.ogcFilters.filtered=0!==i.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(i))}this.layer.dataSource.setOgcFilters(n,!0)}setVisible(){this.layer.visible=!0}isAdvancedOgcFilters(){return this.datasource.options.ogcFilters.advancedOgcFilters}addFilterDisabled(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length}changeOgcFiltersAdvancedOgcFilters(t){this.datasource.options.ogcFilters.advancedOgcFilters=t}changeOgcFilterType(t){this.changeOgcFiltersAdvancedOgcFilters(t.checked),t.checked&&this.refreshFilters(!0)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(n){return new(n||l)(e.rXU(G))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},standalone:!0,features:[e.Jv_([G]),e.aNF],decls:12,vars:12,consts:[["ogcFilters",""],["legend",""],[3,"ngClass"],["class","igo-chevron","matListItemIcon","","igoCollapse","",3,"target","collapsed","click",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["matListItemMeta",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"click","target","collapsed"],["matListItemTitle","","matTooltipShowDelay","500",3,"click","ngStyle","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","disabled","matTooltip","color"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","color","matTooltip"],[1,"igo-layer-legend-container"],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],[3,"change","ngModelChange","ngModel"]],template:function(n,i){1&n&&(e.j41(0,"div",2)(1,"mat-list-item"),e.DNE(2,lr,2,2,"mat-icon",3)(3,cr,2,5,"span",4),e.j41(4,"div",5),e.DNE(5,ur,4,5,"button",6)(6,pr,6,12,"button",7),e.k0s()(),e.j41(7,"div",null,0),e.DNE(9,li,4,3,"div",8),e.nrm(10,"igo-ogc-filterable-form",9),e.DNE(11,Yi,5,4,"section",10),e.k0s()()),2&n&&(e.Y8G("ngClass",e.eq3(10,ar,!0===i.header)),e.R7$(2),e.Y8G("ngIf",i.header),e.R7$(),e.Y8G("ngIf",i.header),e.R7$(2),e.Y8G("ngIf",i.isAdvancedOgcFilters()&&i.filtersAreEditable),e.R7$(),e.Y8G("ngIf",i.header),e.R7$(3),e.Y8G("ngIf",i.header),e.R7$(),e.Y8G("datasource",i.datasource)("map",i.map)("refreshFilters",i.refreshFunc),e.R7$(),e.Y8G("ngIf",i.hasSelector&&i.filtersAreEditable))},dependencies:[o.YU,de.Fg,de.YE,de.ZV,ye.q,de.yE,de.BJ,o.bT,R.m_,R.An,ue.Dc,o.B3,v.uc,v.oV,L.Hl,L.iY,to,jn,ye.w,ae.g7,ae.So,Q.YN,Q.BC,Q.vS,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}[_nghost-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   .separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}[_nghost-%COMP%]     .mdc-list-item__start, [_nghost-%COMP%]     .mdc-list-item__end, [_nghost-%COMP%]     .mdc-list-item__content{pointer-events:auto}"]})}return l})();function Bn(l,f){if(1&l&&(e.j41(0,"button",3),e.nI1(1,"translate"),e.j41(2,"mat-icon",4),e.EFF(3,"filter_alt"),e.k0s()()),2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.R7$(2),e.Y8G("matBadge",t.badge)}}function Sn(l,f){if(1&l&&e.nrm(0,"igo-ogc-filterable-item",7),2&l){const t=e.XpG(2);e.Y8G("header",!1)("map",t.layer.map)("layer",t.layer)}}function ci(l,f){if(1&l&&(e.j41(0,"div",5,0),e.DNE(2,Sn,1,3,"igo-ogc-filterable-item",6),e.k0s()),2&l){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",t.ogcFilterCollapse&&t.options.ogcFilters.enabled)}}let Gn=(()=>{class l{options;get badge(){const t=this.options.ogcFilters;let n=0;if(t&&!t.advancedOgcFilters){if(t.pushButtons){const d=t.pushButtons.groups.find(B=>B.enabled);let T=0;d&&d.computedSelectors?.map(B=>T+=B.selectors?.filter(me=>me.enabled).length),n+=T}if(t.checkboxes){const d=t.checkboxes.groups.find(B=>B.enabled);let T=0;d&&d.computedSelectors?.map(B=>T+=B.selectors?.filter(me=>me.enabled).length),n+=T}if(t.radioButtons){const d=t.radioButtons.groups.find(B=>B.enabled);let T=0;d&&d.computedSelectors?.map(B=>T+=B.selectors?.filter(me=>me.enabled).length),n+=T}if(t.select){const d=t.select.groups.find(B=>B.enabled);let T=0;d&&d.computedSelectors?.map(B=>T+=B.selectors?.filter(me=>me.enabled).length),n+=T}if(t.autocomplete){const d=t.autocomplete.groups.find(B=>B.enabled);let T=0;d&&d.computedSelectors?.map(B=>T+=B.selectors?.filter(me=>me.enabled).length),n+=T}}else{if(t&&t.filters&&!t.filters.filters)return 1;if(t&&t.filters&&t.filters.filters)return t.filters.filters.length}if(t.filters&&"During"===t.filters.operator&&t.filters.active&&t.interfaceOgcFilters&&t.interfaceOgcFilters[0].active){const i=t.interfaceOgcFilters[0];t.filters.calendarModeYear?(i.begin.substring(0,4)!==this.options.minDate.substring(0,4)||i.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(n+=1):(i.begin!==this.options.minDate||i.end!==this.options.maxDate)&&(n+=1)}return n>0?n:void 0}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header;ogcFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.aNF],decls:2,vars:2,consts:[["ogcFilter",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(n,i){1&n&&e.DNE(0,Bn,4,5,"button",1)(1,ci,3,1,"div",2),2&n&&(e.Y8G("ngIf",i.header&&i.options.ogcFilters&&i.options.ogcFilters.enabled&&(i.options.ogcFilters.pushButtons||i.options.ogcFilters.checkboxes||i.options.ogcFilters.radioButtons||i.options.ogcFilters.select||i.options.ogcFilters.autocomplete||i.options.ogcFilters.editable)),e.R7$(),e.Y8G("ngIf",i.options.ogcFilters&&i.options.ogcFilters.enabled&&(i.options.ogcFilters.pushButtons||i.options.ogcFilters.checkboxes||i.options.ogcFilters.radioButtons||i.options.ogcFilters.select||i.options.ogcFilters.autocomplete||i.options.ogcFilters.editable)))},dependencies:[o.bT,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,E.Y,E.k,Jo,s.dF,y.Ck,P.D9],changeDetection:0})}return l})(),an=(()=>{class l{transform(t,n){let i;return"time"===n&&(i=t.filter(d=>{const T=d.dataSource;return this.isTimeFilterable(T)&&void 0!==T.options.timeFilter&&Object.keys(T.options.timeFilter).length})),"ogc"===n&&(i=t.filter(d=>this.isOgcFilterable(d.dataSource))),i}isTimeFilterable(t){return"wms"===t.options.type&&t.options.timeFilterable}isOgcFilterable(t){let n=!1;return t.options.ogcFilters&&t.options.ogcFilters.enabled&&t.options.ogcFilters.editable&&(n=!0),t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete)&&(n=!0),n}static \u0275fac=function(n){return new(n||l)};static \u0275pipe=e.EJ8({name:"filterableDataSource",type:l,pure:!0,standalone:!0})}return l})();function dr(l,f){1&l&&(e.j41(0,"div",3),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.filter.noFilterableLayer")," "))}function mr(l,f){if(1&l&&e.nrm(0,"igo-ogc-filterable-item",4),2&l){const t=f.$implicit;e.Y8G("header",!0)("layer",t)("map",t.map)}}let ne=(()=>{class l{layers;map;constructor(){}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},standalone:!0,features:[e.aNF],decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(n,i){1&n&&(e.j41(0,"igo-list",0),e.DNE(1,dr,3,3,"div",1),e.nI1(2,"filterableDataSource"),e.DNE(3,mr,1,3,"ng-template",2),e.nI1(4,"filterableDataSource"),e.k0s()),2&n&&(e.Y8G("navigation",!1)("selection",!1),e.R7$(),e.Y8G("ngIf",0===e.i5U(2,4,i.layers,"ogc").length),e.R7$(2),e.Y8G("ngForOf",e.i5U(4,7,i.layers,"ogc")))},dependencies:[s.sB,o.bT,o.pM,Jo,s.dF,y.Ck,P.D9,an],styles:["#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}"],changeDetection:0})}return l})();var Ke=r(52314);let C=(()=>{class l{mapService;component;layers$$;constructor(t,n){this.mapService=n,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t.filter(n=>n.showInLayerList)})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(n){return new(n||l)(e.rXU(ne,2),e.rXU(Ke.u))};static \u0275dir=e.FsC({type:l,selectors:[["","igoOgcFilterableListBinding",""]],standalone:!0})}return l})();var K=r(37989),q=r(72714),ve=r(10906),Pe=r(28379),Ne=r(75300),st=r(29814),ht=r(61099),Ze=r(1963),_t=r(18194),ft=r(91020),Zt=r(96875),Nt=r(88231),wt=function(l){return l.Point="Point",l.LineString="LineString",l.Polygon="Polygon",l.Circle="Circle",l}(wt||{}),pt=function(l){return l.Coordinates="Coordinates",l.Length="Length",l.Area="Area",l.Predefined="Predefined",l.Custom="Custom",l}(pt||{}),Zo=function(l){return l.DecimalDegree="DD",l.DegreesMinutesSeconds="DMS",l}(Zo||{});let Wi=(()=>{class l{config;icons;constructor(t){this.config=t,this.getIconsList()}getIcons(){return this.icons}getPath(){return this.config.getConfig("drawingTool.icons")||[]}getIconsList(){this.icons=this.getPath()}static \u0275fac=function(n){return new(n||l)(e.KVO(A.we))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var fo=r(64004),eo=r(71480);function Un(l,f,t,n){return new st.Ay({stroke:new Ze.A({color:f||"rgba(143,7,7,1)",width:t||1}),fill:new _t.A({color:l||"rgba(255,255,255,0.4)"}),image:new ht.A({radius:5,stroke:new Ze.A({color:f||"rgba(143,7,7,1)",width:t||1}),fill:new _t.A({color:l||"rgba(255,255,255,0.4)"})})})}function Nn(l,f){let n=new Map([[Zo.DecimalDegree,i=>{if("number"==typeof i[0])return(0,fo.aQ)(i,5);{const d=[Number(i[0]),Number(i[1])];return(0,fo.aQ)(d,5)}}],[Zo.DegreesMinutesSeconds,i=>(0,fo.vi)(i,2)]]).get(f);return n?n(l):void 0}var Vt=r(47172),Wt=r(94691),_o=r(66586),Tn=r(29100),Yn=r(49964),Wn=r(93812),ln=r(65836),Hi=r(78292),Yr=r(27092),pi=r(2435),gr=r(47470),In=r(8115),kt=r(54427),Ra=r(84540),Pa=r(44260),Xn=r(91640),Ut=(r(53792),r(28440)),Qo=function(l){return l.Arial="Arial",l.ArialBlack="Arial Black",l.Verdana="Verdana",l.Tahoma="Tahoma",l.TrebuchetMS="Trebuchet MS",l.Impact="Impact",l.TimesNewRoman="Times New Roman",l.Georgia="Georgia",l.AmericanTypewriter="American Typewriter",l.Courier="Courier",l.LucidaConsole="Lucida Console",l.BrushScriptMT="Brush Script MT",l.ComicSansMS="Comic Sans MS",l}(Qo||{}),Ct=r(87941),hr=r(8004),zi=r(63725),Ji=r(62002);function La(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",4)(1,"color-chrome",5),e.bIt("onChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.handleChange(i))}),e.k0s(),e.j41(2,"div",6)(3,"button",7),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.handleClick(i))}),e.EFF(4),e.nI1(5,"translate"),e.k0s()()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("color",t.colorPicker),e.R7$(3),e.SpI(" ",e.bMT(5,2,"igo.common.confirmDialog.applyBtn")," ")}}let Wr=(()=>{class l{isOpen=!1;set value(t){this._value=this.formatColor(t??"#000"),this.colorPicker=this._value,this.onChange(this.value),this.onTouch(this.value)}get value(){return this._value}_value;outputFormat="rgba";colorChange=new e.bkB;colorPicker;onChange=()=>{};onTouch=()=>{};writeValue(t){this.value=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}handleClick(t){t.preventDefault(),t.stopPropagation(),this.isOpen=!1,this.value=this.colorPicker}handleChange(t){this.colorPicker=this.formatColor(t.color.rgb,"rgba"),this.colorChange.emit(this.formatColor(this.colorPicker))}formatColor(t,n=this.outputFormat){switch(n){case"hex":t=(0,Ji.A)(t).toHexString();break;case"rgba":default:t=(0,Ji.A)(t).toRgbString();break;case"hsla":t=(0,Ji.A)(t).toHsvString()}return t}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-color-picker-form-field"]],inputs:{outputFormat:"outputFormat"},outputs:{colorChange:"colorChange"},standalone:!0,features:[e.Jv_([{provide:Q.kq,useExisting:(0,e.Rfq)(()=>l),multi:!0}]),e.aNF],decls:6,vars:7,consts:[["trigger","cdkOverlayOrigin"],["floatLabel","always","tooltip-position","below","matTooltipShowDelay","500","subscriptSizing","dynamic","cdkOverlayOrigin","",1,"fill-field",3,"click"],["type","text","matInput","",3,"readonly"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop"],[1,"picker"],[3,"onChange","color"],[1,"buttons"],["mat-flat-button","","color","primary",3,"click"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"mat-form-field",1,0),e.bIt("click",function(){return e.eBV(d),e.Njj(i.isOpen=!i.isOpen)}),e.j41(2,"mat-label"),e.EFF(3),e.k0s(),e.nrm(4,"input",2),e.k0s(),e.DNE(5,La,6,4,"ng-template",3),e.bIt("backdropClick",function(){return e.eBV(d),e.Njj(i.isOpen=!1)})}if(2&n){const d=e.sdS(1);e.R7$(3),e.JRh(i.colorPicker),e.R7$(),e.xc7("background",i.colorPicker),e.Y8G("readonly",!0),e.R7$(),e.Y8G("cdkConnectedOverlayOrigin",d)("cdkConnectedOverlayOpen",i.isOpen)("cdkConnectedOverlayHasBackdrop",!0)}},dependencies:[be.RG,be.rl,be.nJ,hr.$Q,Tt.fS,Tt.fg,hr.WB,zi.a3,zi.Sf,L.Hl,L.$z,y.Ck,P.D9],styles:[".picker[_ngcontent-%COMP%]{left:100%;position:absolute;top:100%;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}.picker[_ngcontent-%COMP%]     .chrome-picker{box-shadow:none}.picker[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{padding:4px 12px 8px;display:flex;justify-content:flex-end}"]})}return l})();var fr=r(2844),Aa=r(57690);let _r=(()=>{class l{fillColor="rgba(255,255,255,0.4)";strokeColor="rgba(143,7,7,1)";strokeWidth=1;labelsAreShown=!0;icon;fontSize="15";fontStyle=Qo.Arial.toString();offsetX=0;offsetY=0;constructor(){}getFillColor(){return this.fillColor}setFillColor(t){this.fillColor=t}getStrokeColor(){return this.strokeColor}setStrokeColor(t){this.strokeColor=t}getStrokeWidth(){return this.strokeWidth}getLabelsAreShown(){return this.labelsAreShown}toggleLabelsAreShown(){this.labelsAreShown=!this.labelsAreShown}setIcon(t){this.icon=t}getIcon(){return this.icon}getFontSize(){return this.fontSize}setFontSize(t){this.fontSize=t}getFontStyle(){return this.fontStyle}setFontStyle(t){this.fontStyle=t}getOffsetX(){return this.offsetX}setOffsetX(t){this.offsetX=t}getOffsetY(){return this.offsetY}setOffsetY(t){this.offsetY=t}createIndividualElementStyle(t,n,i,d,T,B,me,fe,we,Me){let ke,Je=!1;t.getGeometry()instanceof Yn.A&&(Je=!Je);const qe=i?t.get("draw"):"";t.set("_mapTitle",qe);const lt={text:qe,stroke:{color:"white",width:.75},fill:{color:"black"},font:d,overflow:!0,offsetX:me,offsetY:fe};let bt;if(t.get("rad")){const Lt=(0,_.pd)(t.getGeometry().flatCoordinates,we,"EPSG:4326"),po=t.get("rad")/Math.cos(Math.PI/180*Lt[1])/n;return bt={text:lt,circle:{radius:po,stroke:{color:B||this.strokeColor,width:this.strokeWidth},fill:{color:T}}},t.set("_style",bt),ke=new st.Ay({text:new fr.A({text:qe,stroke:new Ze.A({color:"white",width:.75}),fill:new _t.A({color:"black"}),font:d,overflow:!0,offsetX:me,offsetY:fe}),image:new ht.A({radius:po,stroke:new Ze.A({color:B||this.strokeColor,width:this.strokeWidth}),fill:new _t.A({color:T})})}),ke}return Me?(this.offsetY=-26,lt.offsetY=this.offsetY,t.set("_style",{text:lt,stroke:{color:B,width:this.strokeWidth},fill:{color:T},icon:{src:Me}}),ke=new st.Ay({text:new fr.A({text:i?t.get("draw"):"",stroke:new Ze.A({color:"white",width:.75}),fill:new _t.A({color:"black"}),font:d,overflow:!0,offsetX:me,offsetY:fe}),stroke:new Ze.A({color:B,width:this.strokeWidth}),fill:new _t.A({color:T}),image:new Aa.A({src:Me})}),ke):(this.offsetY=Je?-15:0,lt.offsetY=this.offsetY,t.set("_style",{text:lt,stroke:{color:B,width:this.strokeWidth},fill:{color:T},circle:{radius:5,stroke:{color:B,width:this.strokeWidth},fill:{color:T}}}),ke=new st.Ay({text:new fr.A({text:i?t.get("draw"):"",stroke:new Ze.A({color:"white",width:.75}),fill:new _t.A({color:"black"}),font:d,overflow:!0,offsetX:me,offsetY:fe}),stroke:new Ze.A({color:B,width:this.strokeWidth}),fill:new _t.A({color:T}),image:new ht.A({radius:5,stroke:new Ze.A({color:B,width:this.strokeWidth}),fill:new _t.A({color:T})})}),ke)}static \u0275fac=function(n){return new(n||l)};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function yr(l,f){1&l&&(e.qex(0),e.j41(1,"span")(2,"mat-icon",9),e.EFF(3,"format_color_fill"),e.k0s(),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.nrm(6,"igo-color-picker-form-field",21),e.bVm()),2&l&&(e.R7$(4),e.SpI(" ",e.bMT(5,1,"igo.geo.style.fill")," "))}function vr(l,f){if(1&l&&(e.j41(0,"mat-option",22),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}let Xr=(()=>{class l{dialogRef;formBuilder;drawStyleService;data;confirmFlag=!1;form;styleModalData;linestringOnly;constructor(t,n,i,d){this.dialogRef=t,this.formBuilder=n,this.drawStyleService=i,this.data=d}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.features)"LineString"!==t.geometry.type&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getFeatureFillColor()],stroke:[this.getFeatureStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):Qo.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}get allFontStyles(){return Object.values(Qo)}getFeatureFontSize(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}getFeatureFontStyle(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):Qo.Arial}getFeatureFillColor(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}cancelDrawing(){this.dialogRef.close()}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(n){return new(n||l)(e.rXU(Ct.CP),e.rXU(Q.ze),e.rXU(_r),e.rXU(Ct.Vh))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-style-modal-drawing"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.aNF],decls:47,vars:29,consts:[["testFontSize",""],["testFontStyle",""],["offsetXInput",""],["offsetYInput",""],["mat-dialog-title",""],["mat-dialog-content","",1,"edition-drawing",3,"hidden"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],[1,"stroke-palette-icon"],["formControlName","stroke"],[1,"igo-input-container"],["subscriptSizing","dynamic",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"input","value"],["matTextSuffix",""],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"input","value"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["formControlName","fill"],[3,"value"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"h2",4),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"div",5)(4,"form",6)(5,"div",7),e.DNE(6,yr,7,3,"ng-container",8),e.j41(7,"span")(8,"mat-icon",9),e.EFF(9,"border_color "),e.k0s(),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.nrm(12,"igo-color-picker-form-field",10),e.k0s(),e.j41(13,"div",11)(14,"mat-form-field",12)(15,"mat-label"),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"input",13,0),e.bIt("input",function(B){return e.eBV(d),e.Njj(i.styleModalData.fontSize=B.target.value)}),e.k0s(),e.j41(20,"span",14),e.EFF(21,"px"),e.k0s()(),e.j41(22,"mat-form-field",12)(23,"mat-label"),e.EFF(24),e.nI1(25,"translate"),e.k0s(),e.j41(26,"mat-select",15,1),e.bIt("selectionChange",function(B){return e.eBV(d),e.Njj(i.styleModalData.fontStyle=B.value)}),e.DNE(28,vr,2,2,"mat-option",16),e.k0s()(),e.j41(29,"mat-form-field",12)(30,"mat-label"),e.EFF(31),e.nI1(32,"translate"),e.k0s(),e.j41(33,"input",17,2),e.bIt("input",function(B){return e.eBV(d),e.Njj(i.styleModalData.offsetX=B.target.value)}),e.k0s()(),e.j41(35,"mat-form-field",12)(36,"mat-label"),e.EFF(37),e.nI1(38,"translate"),e.k0s(),e.j41(39,"input",17,3),e.bIt("input",function(B){return e.eBV(d),e.Njj(i.styleModalData.offsetY=B.target.value)}),e.k0s()()()()(),e.j41(41,"div",18)(42,"button",19),e.bIt("click",function(){return e.eBV(d),e.Njj(i.cancelDrawing())}),e.EFF(43),e.nI1(44,"translate"),e.k0s(),e.j41(45,"button",20),e.bIt("click",function(){return e.eBV(d),e.Njj(i.confirm())}),e.EFF(46,"OK"),e.k0s()()}2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,15,"igo.geo.style.styleModal"),"\n"),e.R7$(2),e.Y8G("hidden",0===i.data.features.length),e.R7$(),e.Y8G("formGroup",i.form),e.R7$(2),e.Y8G("ngIf",!0!==i.linestringOnly),e.R7$(4),e.SpI(" ",e.bMT(11,17,"igo.geo.style.stroke")," "),e.R7$(6),e.JRh(e.bMT(17,19,"igo.geo.style.fontSize")),e.R7$(2),e.Y8G("value",i.getFeatureFontSize()),e.R7$(6),e.JRh(e.bMT(25,21,"igo.geo.style.fontStyle")),e.R7$(2),e.Y8G("value",i.getFeatureFontStyle()),e.R7$(2),e.Y8G("ngForOf",i.allFontStyles),e.R7$(3),e.JRh(e.bMT(32,23,"igo.geo.style.offsetX")),e.R7$(2),e.Y8G("value",i.getFeatureOffsetX()),e.R7$(4),e.JRh(e.bMT(38,25,"igo.geo.style.offsetY")),e.R7$(2),e.Y8G("value",i.getFeatureOffsetY()),e.R7$(4),e.SpI(" ",e.bMT(44,27,"igo.geo.style.cancel")," "))},dependencies:[Ct.BI,Ct.Yi,Q.YN,Q.qT,Q.BC,Q.cb,Q.X1,Q.j4,Q.JD,o.bT,R.m_,R.An,Wr,be.RG,be.rl,be.nJ,be.yw,Tt.fS,Tt.fg,_e.Ve,_e.VO,re.wT,o.pM,re.Sy,Ct.E7,L.Hl,L.$z,y.Ck,P.D9],styles:["[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{padding-top:16px}[_nghost-%COMP%]   .fill-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .stroke-field[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{width:25px;height:25px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}[_nghost-%COMP%]   .igo-form-input-box[_ngcontent-%COMP%]{width:150px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),br=(()=>{class l{dialogRef;confirmFlag=!1;constructor(t){this.dialogRef=t}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.dialogRef.close(t)}static \u0275fac=function(n){return new(n||l)(e.rXU(Ct.CP))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.aNF],decls:14,vars:9,consts:[["input",""],["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"div",1)(1,"p",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"mat-form-field",3),e.nrm(5,"input",4,0),e.nI1(7,"translate"),e.k0s()(),e.j41(8,"div",5)(9,"button",6),e.bIt("click",function(){return e.eBV(d),e.Njj(i.cancelDrawing())}),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"button",7),e.bIt("click",function(){e.eBV(d);const B=e.sdS(6);return e.Njj(i.confirm(B.value))}),e.EFF(13," OK "),e.k0s()()}2&n&&(e.R7$(2),e.SpI(" ",e.bMT(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),e.R7$(3),e.FS9("placeholder",e.bMT(7,5,"igo.geo.draw.layer.title")),e.R7$(5),e.SpI(" ",e.bMT(11,7,"igo.geo.draw.cancel")," "))},dependencies:[Ct.Yi,be.RG,be.rl,Tt.fS,Tt.fg,Ct.E7,L.Hl,L.$z,y.Ck,P.D9],styles:["[_nghost-%COMP%]   .fields-container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var di=r(41161);function ka(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-radio-button",12),e.bIt("change",function(i){e.eBV(t);const d=e.XpG(3);return e.Njj(d.onLabelTypeChange(i.value))}),e.EFF(1),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG(3);e.Y8G("value",t.value)("disabled",n.optionAvailable(t.value))("checked",t.checked),e.R7$(),e.SpI(" ",n.getProperLengthLabel(t.value)," ")}}function Kr(l,f){if(1&l&&(e.j41(0,"mat-radio-group"),e.DNE(1,ka,2,4,"mat-radio-button",11),e.k0s()),2&l){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.arrayBuiltInType)}}function Hr(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-checkbox",14),e.bIt("change",function(i){e.eBV(t);const d=e.XpG(3);return e.Njj(d.onLabelTypeChange(i.source.value,i.checked))}),e.EFF(1),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG(3);e.Y8G("value",t.value)("disabled",n.optionAvailable(t.value))("checked",t.checked),e.R7$(),e.SpI(" ",n.getProperLengthLabel(t.value)," ")}}function zr(l,f){if(1&l&&(e.qex(0),e.DNE(1,Hr,2,4,"mat-checkbox",13),e.bVm()),2&l){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.arrayBuiltInType)}}function Jr(l,f){if(1&l&&(e.j41(0,"mat-option",6),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function Zr(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),e.EFF(3,"(Latitude, Longitude)"),e.k0s(),e.nrm(4,"input",17,0),e.k0s(),e.j41(6,"mat-form-field",18)(7,"mat-select",19),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onChangeCoordinateUnit(i.value))}),e.DNE(8,Jr,2,2,"mat-option",20),e.k0s()()()}if(2&l){const t=e.XpG(2);e.R7$(4),e.FS9("value",t.currentCoordinates),e.R7$(3),e.Y8G("value",t.coordinatesMeasureUnit),e.R7$(),e.Y8G("ngForOf",t.allCoordinatesUnits)}}function Qr(l,f){if(1&l&&(e.j41(0,"mat-option",6),e.EFF(1),e.k0s()),2&l){const t=f.$implicit,n=e.XpG(3);e.Y8G("value",t),e.R7$(),e.SpI(" ",n.getLengthUnitEnum(t)," ")}}function qr(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),e.EFF(3),e.k0s(),e.nrm(4,"input",21,0),e.k0s(),e.j41(6,"mat-form-field",18)(7,"mat-select",19),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onChangeLengthUnit(i.value))}),e.DNE(8,Qr,2,2,"mat-option",20),e.k0s()()()}if(2&l){const t=e.XpG(2);e.R7$(3),e.JRh(t.lengthLabelT),e.R7$(),e.FS9("placeholder",t.lengthLabelT),e.FS9("value",t.currentLength),e.R7$(3),e.Y8G("value",t.lengthMeasureUnit),e.R7$(),e.Y8G("ngForOf",t.allLengthUnits)}}function es(l,f){if(1&l&&(e.j41(0,"mat-option",6),e.EFF(1),e.k0s()),2&l){const t=f.$implicit,n=e.XpG(3);e.Y8G("value",t),e.R7$(),e.SpI(" ",n.getAreaUnitEnum(t)," ")}}function ts(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"input",21,0),e.nI1(7,"translate"),e.k0s(),e.j41(8,"mat-form-field",18)(9,"mat-select",19),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onChangeAreaUnit(i.value))}),e.DNE(10,es,2,2,"mat-option",20),e.k0s()()()}if(2&l){const t=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,5,"igo.geo.draw.labelType.Area")),e.R7$(2),e.FS9("placeholder",e.bMT(7,7,"igo.geo.draw.labelType.Area")),e.FS9("value",t.currentArea),e.R7$(4),e.Y8G("value",t.areaMeasureUnit),e.R7$(),e.Y8G("ngForOf",t.allAreaUnits)}}function os(l,f){if(1&l){const t=e.RV6();e.qex(0),e.j41(1,"div",3)(2,"div",4)(3,"mat-button-toggle-group",5),e.bIt("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onLabelTypeChange(i.value))}),e.j41(4,"mat-button-toggle",6),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"mat-button-toggle",6),e.EFF(8),e.nI1(9,"translate"),e.k0s()()(),e.j41(10,"div")(11,"p"),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.DNE(14,Kr,2,1,"mat-radio-group",2)(15,zr,2,1,"ng-container",2)(16,Zr,9,3,"div",7)(17,qr,9,5,"div",7)(18,ts,11,9,"div",7),e.k0s()(),e.j41(19,"div",8)(20,"button",9),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelDrawing())}),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.j41(23,"button",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.confirm())}),e.EFF(24),e.k0s()(),e.bVm()}if(2&l){const t=e.XpG();e.R7$(3),e.Y8G("value",t.customOrPredefined),e.R7$(),e.Y8G("value",t.labelType.Custom),e.R7$(),e.SpI(" ",e.bMT(6,13,"igo.geo.draw.labelType.custom")," "),e.R7$(2),e.Y8G("value",t.labelType.Predefined),e.R7$(),e.SpI(" ",e.bMT(9,15,"igo.geo.draw.labelType.predefined")," "),e.R7$(4),e.SpI(" ",e.bMT(13,17,"igo.geo.draw.builtInInstructions")," "),e.R7$(2),e.Y8G("ngIf","Polygon"!==t.olGeometryType),e.R7$(),e.Y8G("ngIf","Polygon"===t.olGeometryType),e.R7$(),e.Y8G("ngIf",t.labelFlag===t.labelType.Coordinates),e.R7$(),e.Y8G("ngIf",t.labelFlag===t.labelType.Length||2===t.polygonCheck),e.R7$(),e.Y8G("ngIf",t.labelFlag===t.labelType.Area||2===t.polygonCheck),e.R7$(3),e.SpI(" ",e.bMT(22,19,"igo.geo.draw.cancel")," "),e.R7$(3),e.SpI(" ",t.noLabelButton()," ")}}function ns(l,f){if(1&l){const t=e.RV6();e.qex(0),e.j41(1,"div",3)(2,"div",4)(3,"mat-button-toggle-group",5),e.bIt("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onLabelTypeChange(i.value))}),e.j41(4,"mat-button-toggle",6),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"mat-button-toggle",6),e.EFF(8),e.nI1(9,"translate"),e.k0s()()(),e.j41(10,"p"),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"mat-form-field",22)(14,"mat-label"),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.j41(17,"input",23,0),e.nI1(19,"translate"),e.bIt("select",function(){return e.eBV(t),e.Njj(!0)})("input",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.getLabelLength(i.target.value))}),e.k0s()()(),e.j41(20,"div",8)(21,"button",9),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelDrawing())}),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"button",10),e.bIt("click",function(){e.eBV(t);const i=e.sdS(18),d=e.XpG();return e.Njj(d.confirm(i.value))}),e.EFF(25),e.k0s()(),e.bVm()}if(2&l){const t=e.XpG();e.R7$(3),e.Y8G("value",t.customOrPredefined),e.R7$(),e.Y8G("value",t.labelType.Custom),e.R7$(),e.SpI(" ",e.bMT(6,11,"igo.geo.draw.labelType.custom")," "),e.R7$(2),e.Y8G("value",t.labelType.Predefined),e.R7$(),e.SpI(" ",e.bMT(9,13,"igo.geo.draw.labelType.predefined")," "),e.R7$(3),e.SpI(" ",e.bMT(12,15,"igo.geo.draw.dialogInstruction")," "),e.R7$(4),e.JRh(e.bMT(16,17,"igo.geo.draw.dialogTitle")),e.R7$(2),e.FS9("placeholder",e.bMT(19,19,"igo.geo.draw.dialogTitle")),e.FS9("value",t.currentLabel),e.R7$(5),e.SpI(" ",e.bMT(23,21,"igo.geo.draw.cancel")," "),e.R7$(3),e.SpI(" ",t.noLabelButton()," ")}}let is=(()=>{class l{languageService;dialogRef;data;confirmFlag=!1;labelFlag=pt.Custom;coordinatesMeasureUnit;lengthMeasureUnit;areaMeasureUnit;geometryType=wt;labelType=pt;arrayBuiltInType=[];currentLabel;currentCoordinates;currentArea;currentLength;olGeometryType=void 0;lengthInMeters;areaInMetersSquare;coordinatesInDD;currentCoordinatesUnit;longlatDD;labelLength;polygonCheck=0;constructor(t,n,i){let d;this.languageService=t,this.dialogRef=n,this.data=i,this.currentLabel=this.data.olGeometry.get("draw"),this.labelLength=this.currentLabel?this.currentLabel.length:0;const T=this.data.map.ol.getView().getProjection();if(this.data.olGeometry instanceof Wt.A)if(this.data.olGeometry.get("rad")){const B=[this.data.olGeometry.get("longitude"),this.data.olGeometry.get("latitude")];this.olGeometryType=wt.Circle,d=new Tn.A(B,this.data.olGeometry.get("rad"))}else this.olGeometryType=this.data.olGeometry.getGeometry().getType(),d=this.data.olGeometry.get("geometry");else this.olGeometryType=this.data.olGeometry.getType(),d=this.data.olGeometry;if(this.olGeometryType===wt.Point||this.olGeometryType===wt.Circle){if(this.data.olGeometry instanceof Wt.A){let B=this.data.olGeometry.get("longitude"),me=this.data.olGeometry.get("latitude");this.longlatDD=(0,di.ho)([B,me],5),this.coordinatesInDD="("+me+", "+B+")"}else{let B=(0,_.pd)(this.data.olGeometry.getFlatCoordinates(),T,"EPSG:4326");this.longlatDD=(0,di.ho)([B[0],B[1]],5),this.coordinatesInDD="("+this.longlatDD[1]+", "+this.longlatDD[0]+")"}this.currentCoordinates=this.coordinatesInDD}if(this.olGeometryType===wt.LineString)this.lengthInMeters=(0,eo.mc)(d,T.getCode()).toFixed(2),this.currentLength=this.lengthInMeters;else if(this.olGeometryType===wt.Polygon)this.lengthInMeters=(0,eo.mc)(d,T.getCode()).toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,eo.j5)(d,T.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare;else if(this.olGeometryType===wt.Circle){let B=(0,Wn.nD)(d,1e4);const me=this.getRadius(B);this.lengthInMeters=me.toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,eo.j5)(B,T.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare}i.olGeometry.get("labelType")===pt.Coordinates?(this.onLabelTypeChange(pt.Predefined),this.onLabelTypeChange(pt.Coordinates,!0),this.coordinatesMeasureUnit=i.olGeometry.get("measureUnit")):i.olGeometry.get("labelType")===pt.Length?(this.onLabelTypeChange(pt.Predefined),this.onLabelTypeChange(pt.Length,!0),this.lengthMeasureUnit=i.olGeometry.get("measureUnit")):i.olGeometry.get("labelType")===pt.Area?(this.onLabelTypeChange(pt.Predefined),this.onLabelTypeChange(pt.Area,!0),this.areaMeasureUnit=i.olGeometry.get("measureUnit")):2===i.olGeometry.get("labelType")?.length&&(this.onLabelTypeChange(pt.Predefined),this.onLabelTypeChange(pt.Length,!0),this.onLabelTypeChange(pt.Area,!0),this.lengthMeasureUnit=i.olGeometry.get("measureUnit")[0],this.areaMeasureUnit=i.olGeometry.get("measureUnit")[1]),this.buildArrayType()}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.labelFlag===pt.Predefined?this.dialogRef.close():this.labelFlag===pt.Custom?this.dialogRef.close({label:t}):this.labelFlag===pt.Coordinates?this.dialogRef.close({label:this.currentCoordinates,measureUnit:this.coordinatesMeasureUnit}):this.olGeometryType===wt.Polygon?2===this.polygonCheck?(this.labelFlag=[pt.Length,pt.Area],this.dialogRef.close({label:"P: "+this.currentLength+" "+Ut.tC[Ut.$R.Meters]+"\n"+this.languageService.translate.instant("igo.geo.draw.labelType.A")+this.currentArea+" "+Ut.M3[Ut.i2.SquareMeters],measureUnit:[this.lengthMeasureUnit,this.areaMeasureUnit]})):this.dialogRef.close(this.labelFlag===pt.Length?{label:"P: "+this.currentLength+" "+Ut.tC[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}:{label:this.currentArea+" "+Ut.M3[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit}):this.labelFlag===pt.Length?this.olGeometryType===wt.Circle?this.dialogRef.close({label:"R: "+this.currentLength+" "+Ut.tC[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.olGeometryType===wt.LineString&&this.dialogRef.close({label:this.currentLength+" "+Ut.tC[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.labelFlag===pt.Area&&this.dialogRef.close({label:this.currentArea+" "+Ut.M3[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit})}onLabelTypeChange(t,n){t!==pt.Predefined&&t!==pt.Custom&&this.olGeometryType===wt.Polygon?(this.arrayBuiltInType.find(d=>d.value===t)?this.arrayBuiltInType.find(d=>d.value===t).checked=n:this.labelFlag=void 0,this.labelFlag=n?t:this.arrayBuiltInType.find(d=>d.checked)?.value):this.labelFlag=t,t===pt.Predefined?this.olGeometryType===wt.Point?(this.labelFlag=pt.Coordinates,this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=Zo.DecimalDegree):this.olGeometryType===wt.LineString&&(this.labelFlag=pt.Length,this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=Ut.$R.Meters):t===pt.Area?(this.currentArea=this.areaInMetersSquare,this.areaMeasureUnit=Ut.i2.SquareMeters):t===pt.Length?(this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=Ut.$R.Meters):this.labelFlag===pt.Coordinates&&(this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=Zo.DecimalDegree),this.olGeometryType===wt.Polygon&&[this.labelType.Length,this.labelType.Area].includes(t)?n?this.polygonCheck+=1:this.polygonCheck-=1:this.polygonCheck=0}onChangeLengthUnit(t){this.lengthMeasureUnit=t,this.currentLength=(0,eo.SI)(Number(this.lengthInMeters),t).toFixed(2)}onChangeAreaUnit(t){this.areaMeasureUnit=t,this.currentArea=(0,eo.dN)(Number(this.areaInMetersSquare),t).toFixed(2)}onChangeCoordinateUnit(t){this.coordinatesMeasureUnit=t;let n=Nn(this.longlatDD,t);this.currentCoordinates="("+n[1]+", "+n[0]+")"}buildArrayType(){for(const t of Object.values(pt))t!==pt.Custom&&t!==pt.Predefined&&this.arrayBuiltInType.push({value:t,checked:this.selectOptions(t)||this.labelFlag===t||2===this.polygonCheck&&t!==pt.Coordinates})}noLabelButton(){return this.labelFlag===pt.Predefined||this.labelFlag===pt.Custom&&0===this.labelLength?this.languageService.translate.instant("igo.geo.draw.noLabel"):"OK"}get customOrPredefined(){return this.labelFlag===pt.Custom?pt.Custom:pt.Predefined}optionAvailable(t){switch(this.olGeometryType){case wt.Point:return t!==pt.Coordinates;case wt.LineString:return t!==pt.Length;case wt.Polygon:return t===pt.Coordinates;default:return!1}}get allLengthUnits(){return Object.values(Ut.$R)}getLengthUnitEnum(t){return Ut.tC[t]}get allAreaUnits(){return Object.values(Ut.i2)}get allCoordinatesUnits(){return Object.values(Zo)}getAreaUnitEnum(t){return Ut.M3[t]}getRadius(t){const n=(0,Hi.R3)(t);return Number(n/(2*Math.PI))}get lengthLabelT(){return this.languageService.translate.instant(this.olGeometryType===wt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===wt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length")}getLabelLength(t){this.labelLength=t.length}selectOptions(t){return this.olGeometryType===wt.Point?t===pt.Coordinates:this.olGeometryType===wt.LineString?t===pt.Length:void 0}getProperLengthLabel(t){return this.languageService.translate.instant(t===pt.Length?this.olGeometryType===wt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===wt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length":"igo.geo.draw.labelType."+t)}static \u0275fac=function(n){return new(n||l)(e.rXU(y.gw),e.rXU(Ct.CP),e.rXU(Ct.Vh))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag",labelFlag:"labelFlag",coordinatesMeasureUnit:"coordinatesMeasureUnit",lengthMeasureUnit:"lengthMeasureUnit",areaMeasureUnit:"areaMeasureUnit"},standalone:!0,features:[e.aNF],decls:5,vars:5,consts:[["input",""],["mat-dialog-title",""],[4,"ngIf"],["mat-dialog-content","",1,"geometry-type-toggle"],[1,"button-toggle-container"],[3,"change","value"],[3,"value"],["class","fields-container",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[3,"change","value","disabled","checked"],["class","mat-typography",3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"change","value","disabled","checked"],[1,"fields-container"],[1,"readOnly-Input"],["matInput","","placeholder","(Latitude, Longitude)","readonly","",3,"value"],[1,"unit-field"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"placeholder","value"],[1,"input"],["matInput","","cdkFocusInitial","",3,"select","input","placeholder","value"]],template:function(n,i){1&n&&(e.j41(0,"h2",1),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.DNE(3,os,25,21,"ng-container",2)(4,ns,26,23,"ng-container",2)),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,3,"igo.geo.draw.popupTitle"),"\n"),e.R7$(2),e.Y8G("ngIf",i.labelFlag!==i.labelType.Custom),e.R7$(),e.Y8G("ngIf",i.labelFlag===i.labelType.Custom))},dependencies:[Ct.BI,o.bT,Ct.Yi,ge.Vg,ge.ec,ge.pc,He.Wk,He.VT,He._g,o.pM,ae.g7,ae.So,be.RG,be.rl,be.nJ,Tt.fS,Tt.fg,_e.Ve,_e.VO,re.wT,re.Sy,Ct.E7,L.Hl,L.$z,y.Ck,P.D9],styles:["[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .readOnly-Input[_ngcontent-%COMP%]{width:200px!important}[_nghost-%COMP%]   .button-toggle-container[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:-moz-fit-content;width:fit-content}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-select-min-line{padding-right:24px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{position:sticky!important}[_nghost-%COMP%]   .coordinatesInputView[_ngcontent-%COMP%]{top:5em!important}[_nghost-%COMP%]   .mat-mdc-dialog-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-end}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{width:auto!important}[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"]})}return l})();var Zi=r(36991);let rs=(()=>{class l{svgIcon=Zi.cu;static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-draw-shorcuts"]],standalone:!0,features:[e.aNF],decls:27,vars:13,consts:[[1,"shortcut","mat-typography"],[1,"shortcut-icon"],[3,"icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(n,i){1&n&&(e.j41(0,"mat-dialog-content")(1,"div")(2,"span",0)(3,"mat-icon",1),e.EFF(4,"keyboard_return"),e.k0s(),e.EFF(5),e.nI1(6,"translate"),e.k0s()(),e.j41(7,"div")(8,"span",0)(9,"mat-icon",1),e.EFF(10,"keyboard_backspace"),e.k0s(),e.EFF(11),e.nI1(12,"translate"),e.k0s()(),e.j41(13,"div")(14,"span",0),e.nrm(15,"igo-icon",2),e.EFF(16),e.nI1(17,"translate"),e.k0s()(),e.j41(18,"div")(19,"span",0)(20,"mat-icon",1),e.EFF(21,"space_bar"),e.k0s(),e.EFF(22),e.nI1(23,"translate"),e.k0s()()(),e.j41(24,"mat-dialog-actions",3)(25,"button",4),e.EFF(26,"OK"),e.k0s()()),2&n&&(e.R7$(5),e.JRh(e.bMT(6,5,"igo.geo.draw.finish")),e.R7$(6),e.JRh(e.bMT(12,7,"igo.geo.draw.undo")),e.R7$(4),e.Y8G("icon",i.svgIcon),e.R7$(),e.SpI(" ",e.bMT(17,9,"igo.geo.draw.abort")," "),e.R7$(6),e.JRh(e.bMT(23,11,"igo.geo.draw.move")))},dependencies:[Ct.Yi,R.m_,R.An,Ct.E7,L.Hl,L.$z,Ct.tx,y.Ck,P.D9,Zi.cc],styles:[".shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}"]})}return l})();const ss=["selectedLayer"];function as(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-slide-toggle",7),e.bIt("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onToggleFreehandMode(i))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("checked",t.freehandMode)("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(2,3,"igo.geo.draw.freehandMode")," ")}}function ls(l,f){if(1&l&&(e.j41(0,"mat-option",4),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.measure."+t)," ")}}function cs(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",24)(1,"mat-form-field",25),e.nrm(2,"input",26),e.nI1(3,"translate"),e.k0s(),e.j41(4,"mat-form-field",27)(5,"mat-select",12),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onMeasureUnitChange(i.value))}),e.DNE(6,ls,3,4,"mat-option",13),e.k0s()()()}if(2&l){const t=e.XpG();e.R7$(2),e.FS9("placeholder",e.bMT(3,5,"igo.geo.spatialFilter.radius")),e.Y8G("formControl",t.radiusFormControl)("readonly",t.freehandMode),e.R7$(3),e.Y8G("value",t.measureUnit),e.R7$(),e.Y8G("ngForOf",t.measureUnits)}}function us(l,f){if(1&l&&(e.j41(0,"mat-option",4),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.title," ")}}function Cr(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",28),e.nI1(1,"translate"),e.nI1(2,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.activeDrawingLayer.visible=!i.activeDrawingLayer.visible)}),e.j41(3,"mat-icon"),e.EFF(4),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("color",t.activeDrawingLayer.visible?"primary":"default")("matTooltip",t.activeDrawingLayer.visible?e.bMT(1,3,"igo.geo.layer.hideLayer"):e.bMT(2,5,"igo.geo.layer.showLayer")),e.R7$(4),e.SpI(" ",t.activeDrawingLayer.visible?"visibility":"visibility_off"," ")}}function ps(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",29),e.nI1(1,"translate"),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteDrawings())}),e.j41(3,"mat-icon"),e.EFF(4,"delete"),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,2,"igo.geo.draw.delete"))("disabled",0===e.bMT(2,4,t.selectedFeatures$).length)}}function ds(l,f){if(1&l&&(e.j41(0,"div",33),e.nrm(1,"img",34),e.k0s()),2&l){const t=e.XpG(2);e.R7$(),e.FS9("src",t.icon,e.B4B)}}function ms(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-option",35),e.bIt("click",function(){const i=e.eBV(t).$implicit,d=e.XpG(2);return e.Njj(d.onIconChange(i))}),e.j41(1,"div",33),e.nrm(2,"img",34),e.k0s()()}if(2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(2),e.FS9("src",t,e.B4B)}}function gs(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field")(1,"mat-label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"mat-select")(5,"mat-select-trigger"),e.DNE(6,ds,2,1,"div",30),e.k0s(),e.j41(7,"mat-option",31),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onIconChange())}),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.DNE(10,ms,3,2,"mat-option",32),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(2),e.JRh(e.bMT(3,4,"igo.geo.draw.icon")),e.R7$(4),e.Y8G("ngIf",t.icon),e.R7$(2),e.JRh(e.bMT(9,6,"igo.geo.draw.noIcon")),e.R7$(2),e.Y8G("ngForOf",t.icons)}}function hs(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",36),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openStyleModalDialog())}),e.EFF(2),e.nI1(3,"translate"),e.j41(4,"mat-icon",37),e.EFF(5,"palette "),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,3,"igo.geo.style.styleModalTooltipSelected")),e.R7$(2),e.SpI(" ",e.bMT(3,5,"igo.geo.style.styleModal")," "),e.R7$(2),e.Y8G("matBadge",t.selectedFeatures$.value.length)}}let fs=(()=>{class l{languageService;formBuilder;drawStyleService;dialog;drawIconService;tableTemplate;geometryType=wt;map;get stores(){return this._stores}set stores(t){this._stores=t}_stores=[];get drawControls(){return this._drawControls}set drawControls(t){this._drawControls=t}_drawControls=[];get activeDrawingLayer(){return this._activeDrawingLayer}set activeDrawingLayer(t){this._activeDrawingLayer=t}_activeDrawingLayer;activeLayerChange=new e.bkB;drawControlsEvent=new e.bkB;layersIDEvent=new e.bkB;fillColor;strokeColor;strokeWidth;fontSize;fontStyle;activeStore;layerCounterID=0;draw$=new ce.t({});activeDrawingLayerSource=new ln.A;activeDrawControl;drawEnd$$;drawSelect$$;selectedFeatures$=new ce.t([]);fillForm;strokeForm;drawControlIsDisabled=!0;drawControlIsActive=!1;labelsAreShown;freehandMode=!1;subscriptions$$=[];position="bottom";form;icons;icon;radiusFormControl=new Q.hs(1e3);measureUnit=Ut.$R.Meters;radiusFormControlChange$$=new Yr.yU;predefinedRadius$=new ce.t(void 0);radiusDrawEnd$=new ce.t(void 0);get measureUnits(){return[Ut.$R.Meters,Ut.$R.Kilometers]}numberOfDrawings;isCreatingNewLayer=!1;currGeometryType=this.geometryType.Point;select;constructor(t,n,i,d,T){this.languageService=t,this.formBuilder=n,this.drawStyleService=i,this.dialog=d,this.drawIconService=T,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),valueAccessor:B=>B.properties.draw},{name:"Edition",title:"",sort:!1,valueAccessor:B=>[{editMode:!1,icon:"edit",color:"primary",click:()=>{this.editLabelDrawing(B)},style:"mat-icon-button"}],renderer:Ne.pp.ButtonGroup}]},this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}ngOnInit(){this.stores.length?(this.activeStore=this.stores.find(t=>t.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(t=>t[0]===this.activeDrawingLayer.id)[1],this.deactivateDrawControl(),this.allLayers.forEach(t=>{t.id!==this.activeDrawingLayer.id&&(t.opacity=0);let n=this.stores.find(i=>i.layer.id===t.id);this.subscriptions$$.push(n.stateView.manyBy$(i=>!0===i.state.selected).pipe((0,pi.$)()).subscribe(i=>{i.forEach(d=>{d.state.selected=!1})})),this.subscriptions$$.push(n.stateView.manyBy$(i=>!0===i.state.selected).pipe((0,gr.i)(1)).subscribe(i=>{this.selectedFeatures$.next(i.map(d=>d.entity))})),this.subscriptions$$.push(n.count$.subscribe(i=>{this.activeStore.layer.options.showInLayerList=i>=1}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new kt.oE([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer)),this.radiusFormControlChange$$=this.radiusFormControl.valueChanges.subscribe(t=>{this.activeDrawControl.ispredefinedRadius$.getValue()&&this.changeRadius(t)})}ngOnDestroy(){this.allLayers.forEach(t=>t.opacity=1),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(t=>t.unsubscribe()),this.radiusFormControlChange$$.unsubscribe()}createDrawControl(t,n,i){return new Pa.S({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new st.Ay({}),interactionStyle:Un(t,n,i)})}initStore(t,n){this.createLayer(t,n),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(i=>!0===i.state.selected).pipe((0,gr.i)(1)).subscribe(i=>{this.selectedFeatures$.next(i.map(d=>d.entity))})),this.subscriptions$$.push(this.activeStore.count$.subscribe(i=>{this.activeStore.layer.options.showInLayerList=i>=1}))}openStyleModalDialog(){setTimeout(()=>{const t=this.dialog.open(Xr,{disableClose:!1,data:{features:this.selectedFeatures$.getValue(),icons:this.icons,icon:this.icon},autoFocus:!1});t.afterClosed().subscribe(n=>{t.componentInstance.confirmFlag&&(this.onFontChange(this.labelsAreShown,n.fontSize,n.fontStyle),this.onColorChange(this.labelsAreShown,!!this.icon,n.fillColor,n.strokeColor),this.onOffsetLabelChange(this.labelsAreShown,n.offsetX,n.offsetY))})},250)}openDrawDialog(t,n){setTimeout(()=>{const i=this.dialog.open(is,{disableClose:!1,data:{olGeometry:t,map:this.map}});i.afterClosed().subscribe(d=>{i.componentInstance.confirmFlag?(this.updateLabelOfOlGeometry(t,d.label),this.updateLabelType(t,i.componentInstance.labelFlag),this.updateMeasureUnit(t,d.measureUnit),t instanceof Wt.A||(this.updateFontSizeAndStyle(t,"15",Qo.Arial),this.updateFillAndStrokeColor(t,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),this.updateOffset(t,0,t instanceof Yn.A?-15:0)),n?this.onDrawEnd(t):this.onSelectDraw(t,d.label,[i.componentInstance.labelFlag,d.measureUnit]),this.updateHeightTable()):this.activeDrawingLayerSource.getFeatures().forEach(T=>{const B=T.getGeometry();t===B&&this.activeDrawingLayerSource.removeFeature(T)})})},250)}onDrawEnd(t,n){this.addFeatureToStore(t,n),this.clearLabelsOfOlGeometry(t),this.activeStore.layer.ol.getSource().refresh()}onModifyDraw(t){this.activeStore.all().forEach(i=>{if(i.properties.id===t.ol_uid){if(i.properties.labelType===pt.Coordinates){let B=Nn([i.properties.longitude,i.properties.latitude],i.properties.measureUnit);this.updateLabelOfOlGeometry(t,"("+B[1]+", "+B[0]+")")}else if(i.properties.labelType===pt.Length)if(t instanceof Tn.A){let B=(0,Wn.nD)(t,1e4);const me=(0,eo.SI)(this.getRadius(B),i.properties.measureUnit),fe=Ut.tC[i.properties.measureUnit],we="R: "+me.toFixed(2).toString()+" "+fe;this.updateLabelOfOlGeometry(t,we)}else{let me,B=(0,eo.mc)(t,this.map.ol.getView().getProjection().getCode());me=Ut.tC[i.properties.measureUnit],B=(0,eo.SI)(B,i.properties.measureUnit);let we=t instanceof Wn.Ay?"P: "+B.toFixed(2).toString()+" "+me:B.toFixed(2).toString()+" "+me;this.updateLabelOfOlGeometry(t,we)}else if(i.properties.labelType===pt.Area)if(t instanceof Tn.A){let B=(0,Wn.nD)(t,1e4),me=(0,eo.j5)(B,this.map.ol.getView().getProjection().getCode());const fe=Ut.M3[i.properties.measureUnit];me=(0,eo.dN)(me,i.properties.measureUnit);const Me=me.toFixed(2).toString()+" "+fe;this.updateLabelOfOlGeometry(t,Me)}else{let me,B=(0,eo.j5)(t,this.map.ol.getView().getProjection().getCode());me=Ut.M3[i.properties.measureUnit],B=(0,eo.dN)(B,i.properties.measureUnit);const we=B.toFixed(2).toString()+" "+me;this.updateLabelOfOlGeometry(t,we)}else this.updateLabelOfOlGeometry(t,i.properties.draw);this.updateLabelType(t,i.properties.labelType),this.updateMeasureUnit(t,i.properties.measureUnit),this.updateFontSizeAndStyle(t,i.properties.fontStyle.split(" ")[0].replace("px",""),i.properties.fontStyle.substring(i.properties.fontStyle.indexOf(" ")+1)),this.updateFillAndStrokeColor(t,i.properties.drawingStyle.fill,i.properties.drawingStyle.stroke),this.updateOffset(t,i.properties.offsetX,i.properties.offsetY),this.replaceFeatureInStore(i,t)}})}onSelectDraw(t,n,i){const d=this.activeStore.all(),T=t.getGeometry();T.ol_uid=t.get("id");const B=JSON.stringify(T.getCoordinates()[0]);d.forEach(me=>{const fe=JSON.stringify(me.geometry.coordinates[0]);if(B===fe){const we=t.get("fontStyle").split(" ")[0].replace("px",""),Me=t.get("fontStyle").substring(t.get("fontStyle").indexOf(" ")+1),ke=t.get("drawingStyle").fill,Je=t.get("drawingStyle").stroke,je=t.get("offsetX"),qe=t.get("offsetY"),lt=me.properties.rad?me.properties.rad:void 0;this.updateLabelOfOlGeometry(T,n),this.updateFontSizeAndStyle(T,we,Me),this.updateFillAndStrokeColor(T,ke,Je),this.updateOffset(T,je,qe),this.updateLabelType(T,i[0]),this.updateMeasureUnit(T,i[1]),this.replaceFeatureInStore(me,T,lt)}})}addFeatureToStore(t,n,i){let d,T,B,me,fe;const we=i?i.properties.id:t.ol_uid,Me=this.map.ol.getView().getProjection(),ke=(new _o.A).writeGeometryObject(t,{featureProjection:Me,dataProjection:Me});if(t instanceof Tn.A||n)if(n)d=n;else{ke.type="Point",ke.coordinates=t.getCenter();const Je=(0,_.pd)([t.getFlatCoordinates()[2],t.getFlatCoordinates()[3]],Me,"EPSG:4326");T=(0,_.pd)([t.getFlatCoordinates()[0],t.getFlatCoordinates()[1]],Me,"EPSG:4326"),me=T[0],fe=T[1],d=(0,Hi.Yf)(T,Je),this.radiusFormControl.setValue(Math.round(d))}this.activeDrawControl.radiusDrawEnd$.getValue()&&(d=this.activeDrawControl.radiusDrawEnd$.getValue()),t instanceof Yn.A&&(B=(0,_.pd)(t.getFlatCoordinates(),Me,"EPSG:4326"),me=B[0],fe=B[1]),this.activeStore.update({type:kt.RI,geometry:ke,projection:Me.getCode(),properties:{id:we,draw:t.get("_label"),longitude:me||null,latitude:fe||null,rad:d||null,fontStyle:t.get("fontStyle_"),drawingStyle:{fill:t.get("fillColor_"),stroke:t.get("strokeColor_")},offsetX:t.get("offsetX_"),offsetY:t.get("offsetY_"),labelType:t.get("labelType_"),measureUnit:t.get("measureUnit_")},meta:{id:we}}),this.activeStore.setLayerExtent(),this.activeDrawControl.predefinedRadius$.next(void 0),this.activeDrawControl.radiusDrawEnd$.next(void 0)}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}setupLayer(t){setTimeout(()=>{const n=this.dialog.open(br,{disableClose:!1});n.afterClosed().subscribe(i=>{n.componentInstance.confirmFlag?(this.activeStore.state.updateAll({selected:!1}),this.activeStore=new kt.oE([],{map:this.map}),this.activeDrawingLayerSource=new ln.A,this.activeDrawingLayer.opacity=0,this.deactivateDrawControl(),this.initStore(i,t),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.isCreatingNewLayer=!1,this.labelsAreShown||this.onToggleLabels(),this.activeLayerChange.emit(this.activeDrawingLayer)):(this.select.value=this.activeDrawingLayer,this.select.selectionChange.emit(this.activeDrawingLayer))})},250)}editLabelDrawing(t){const n=(0,kt.xH)(t,this.map.ol.getView().getProjection().getCode());this.openDrawDialog(n,!1)}openShorcutsDialog(){this.dialog.open(rs)}deleteDrawings(){this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.activeDrawingLayerSource.getFeatures().forEach(n=>{const i=n.getGeometry();t.properties.id===i.ol_uid&&this.activeDrawingLayerSource.removeFeature(n)})}),this.updateHeightTable(),this.activeStore.setLayerExtent()}onToggleLabels(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.elementStyle(this.labelsAreShown,!!this.icon),this.createDrawControl()}onToggleDrawControl(t){t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleFreehandMode(t){this.isCircle()&&!t.checked?(this.activeDrawControl.ispredefinedRadius$.next(!0),this.changeRadius(this.radiusFormControl.value)):(this.activeDrawControl.setOlInteractionStyle(Un(this.fillColor,this.strokeColor,this.strokeWidth)),this.activeDrawControl.ispredefinedRadius$.next(!1)),this.freehandMode=t.checked,this.activeDrawControl.freehand$.next(t.checked),this.toggleDrawControl()}onLayerChange(t){t?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=t,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(n=>n.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(n=>n[0]===this.activeDrawingLayer.id)[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}createLayer(t,n){for(const i of this.allLayers){let d=Number(i.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(d,this.layerCounterID)}this.activeDrawingLayer=new Xn.v({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:n?t:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new In._,style:(i,d)=>this.drawStyleService.createIndividualElementStyle(i,d,this.labelsAreShown,i.get("fontStyle"),i.get("drawingStyle").fill,i.get("drawingStyle").stroke,i.get("offsetX"),i.get("offsetY"),this.map.projection,this.icon),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),(0,Ra.d)(this.activeStore,this.activeDrawingLayer),(0,kt.c2)(this.activeStore,new kt.n6({motion:kt.Bl.None})),(0,kt._O)(this.activeStore,new kt.ZA({map:this.map,motion:kt.Bl.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",i=>{const d=i.feature.getGeometry();this.clearLabelsOfOlGeometry(d)})}onColorChange(t,n,i,d){this.selectedFeatures$.value.length>0&&!n&&this.selectedFeatures$.value.forEach(T=>{let B=(0,kt.xH)(T,this.map.ol.getView().getProjection().getCode());this.updateFillAndStrokeColor(B,i,d);const me=this.activeStore.all().find(fe=>fe.meta.id===B.getId());me.properties.drawingStyle.fill=B.get("fillColor_"),me.properties.drawingStyle.stroke=B.get("strokeColor_"),this.activeStore.update(me)}),this.elementStyle(t,n),this.createDrawControl()}onFontChange(t,n,i){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(d=>{let T=(0,kt.xH)(d,this.map.ol.getView().getProjection().getCode());this.updateFontSizeAndStyle(T,n,i);const B=this.activeStore.all().find(me=>me.meta.id===T.getId());B.properties.fontStyle=T.get("fontStyle_"),this.activeStore.update(B),T=this.activeStore.layer.ol.getSource().getFeatures().find(me=>me.getId()===B.meta.id),T.setProperties({fontStyle:B.properties.fontStyle}),T.changed()}),this.fontSize=n,this.fontStyle=i,this.drawStyleService.setFontSize(n),this.drawStyleService.setFontStyle(i),this.elementStyle(t))}onOffsetLabelChange(t,n,i){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(d=>{let T=(0,kt.xH)(d,this.map.ol.getView().getProjection().getCode());this.updateOffset(T,n,i);const B=this.activeStore.all().find(me=>me.meta.id===T.getId());B.properties.offsetX=T.get("offsetX_"),B.properties.offsetY=T.get("offsetY_"),this.activeStore.update(B),T=this.activeStore.layer.ol.getSource().getFeatures().find(me=>me.getId()===B.meta.id),T.setProperties({offsetX:B.properties.offsetX,offsetY:B.properties.offsetY}),T.changed()}),this.elementStyle(t))}onIconChange(t){this.icon=t,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}onGeometryTypeChange(t){this.currGeometryType=t,this.activeDrawControl.setGeometryType(t),this.onToggleFreehandMode(this.freehandMode?{checked:!0}:{checked:!1}),this.toggleDrawControl()}updateLabelOfOlGeometry(t,n){t.setProperties({_label:n},!0)}updateFontSizeAndStyle(t,n,i){t.setProperties({fontStyle_:`${n}px ${i}`},!0)}updateFillAndStrokeColor(t,n,i){t.setProperties({fillColor_:n,strokeColor_:i},!0)}updateOffset(t,n,i){t.setProperties({offsetX_:n,offsetY_:i},!0)}updateLabelType(t,n){t.setProperties({labelType_:n},!0)}updateMeasureUnit(t,n){t.setProperties({measureUnit_:n},!0)}getFeatureFontSize(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"15"}getFeatureFontStyle(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):Qo.Arial}getFeatureFillColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}get allFontStyles(){return Object.values(Qo)}get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-draw-layer"))}updateHeightTable(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.tableTemplate.tableHeight=this.numberOfDrawings>10?"35vh":"auto"}updateActiveLayer(){return this.allLayers.find(n=>n.title===this.activeDrawingLayer.title)||this.allLayers[0]}toggleDrawControl(){this.deactivateDrawControl(),this.activateDrawControl()}clearLabelsOfOlGeometry(t){(0,eo.JM)(t).forEach(n=>{n&&n.getMap()&&this.map.ol.removeOverlay(n)})}replaceFeatureInStore(t,n,i){this.activeStore.delete(t),this.onDrawEnd(n,i)}deactivateDrawControl(){this.activeDrawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}activateDrawControl(){this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(t=>{this.openDrawDialog(t,!0)}),this.activeDrawControl.modify$.subscribe(t=>{this.onModifyDraw(t)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(t=>{this.openDrawDialog(t,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}isPoint(){return this.activeDrawControl.getGeometryType()===this.geometryType.Point}isLineString(){return this.activeDrawControl.getGeometryType()===this.geometryType.LineString}isPolygon(){return this.activeDrawControl.getGeometryType()===this.geometryType.Polygon}isCircle(){return this.activeDrawControl.getGeometryType()===this.geometryType.Circle}changeRadius(t){let n;n=t?this.measureUnit===Ut.$R.Meters?t:1e3*t:void 0,this.activeDrawControl.setOlInteractionStyle((d,T)=>{const B=d.getGeometry(),me=_.pd(B.getCoordinates(),this.map.projection,"EPSG:4326"),fe=n/Math.cos(Math.PI/180*me[1])/T;return this.activeDrawControl.predefinedRadius$.next(n),new st.Ay({image:new ht.A({radius:fe,stroke:new Ze.A({width:1,color:"rgba(143,7,7,1)"}),fill:new _t.A({color:"rgba(255,255,255,0.4)"})})})}),this.toggleDrawControl()}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.radiusFormControl.setValue(this.measureUnit===Ut.$R.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}elementStyle(t,n){this.activeStore.layer.ol.setStyle(n?(i,d)=>this.drawStyleService.createIndividualElementStyle(i,d,t,i.get("fontStyle"),i.get("drawingStyle").fill,i.get("drawingStyle").stroke,i.get("offsetX"),i.get("offsetY"),this.map.projection,this.icon):(i,d)=>this.drawStyleService.createIndividualElementStyle(i,d,t,i.get("fontStyle"),i.get("drawingStyle").fill,i.get("drawingStyle").stroke,i.get("offsetX"),i.get("offsetY"),this.map.projection))}getRadius(t){const n=(0,Hi.R3)(t);return Number(n/(2*Math.PI))}static \u0275fac=function(n){return new(n||l)(e.rXU(y.gw),e.rXU(Q.ze),e.rXU(_r),e.rXU(Ct.bZ),e.rXU(Wi))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-draw"]],viewQuery:function(n,i){if(1&n&&e.GBs(ss,5),2&n){let d;e.mGM(d=e.lsd())&&(i.select=d.first)}},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},standalone:!0,features:[e.Jv_([{provide:ge.YH,useValue:{hideSingleSelectionIndicator:!0}}]),e.aNF],decls:51,vars:47,consts:[["selectedLayer",""],["table",""],[1,"geometry-type-toggle","mat-typography"],[3,"change","value"],[3,"value"],[1,"draw-options","mat-typography"],[3,"change","disabled","checked","labelPosition"],[3,"change","checked","labelPosition"],[3,"checked","labelPosition","change",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"layer-select-container"],["subscriptSizing","dynamic",1,"layer-select"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],[1,"icon-options"],[4,"ngIf"],[1,"actions-container"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"radius-unit"],[1,"radius"],["matInput","","type","number","min","0",3,"placeholder","formControl","readonly"],[1,"unit-field"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","color","matTooltip"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"click","matTooltip","disabled"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"click","value"],["mat-raised-button","","color","primary",3,"click","matTooltip"],["aria-hidden","false","iconPositionEnd","","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"div")(1,"div",2)(2,"mat-button-toggle-group",3),e.bIt("change",function(B){return e.eBV(d),e.Njj(i.onGeometryTypeChange(B.value))}),e.j41(3,"mat-button-toggle",4),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"mat-button-toggle",4),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"mat-button-toggle",4),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"mat-button-toggle",4),e.EFF(13),e.nI1(14,"translate"),e.k0s()()(),e.j41(15,"div",5)(16,"mat-slide-toggle",6),e.bIt("change",function(B){return e.eBV(d),e.Njj(i.onToggleDrawControl(B.checked))}),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"mat-slide-toggle",7),e.bIt("change",function(){return e.eBV(d),e.Njj(i.onToggleLabels())}),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.DNE(22,as,3,5,"mat-slide-toggle",8)(23,cs,7,7,"div",9),e.k0s(),e.nrm(24,"mat-divider"),e.j41(25,"div",10)(26,"mat-form-field",11)(27,"mat-label"),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"mat-select",12,0),e.bIt("selectionChange",function(){e.eBV(d);const B=e.sdS(31);return e.Njj(i.onLayerChange(B.value))}),e.DNE(32,us,2,2,"mat-option",13),e.j41(33,"mat-option",14),e.EFF(34),e.nI1(35,"translate"),e.k0s()()(),e.DNE(36,Cr,5,7,"button",15),e.k0s(),e.nrm(37,"mat-divider"),e.j41(38,"div"),e.DNE(39,ps,5,6,"button",16),e.j41(40,"div"),e.nrm(41,"igo-entity-table",17,1),e.k0s()(),e.j41(43,"div",18),e.DNE(44,gs,11,8,"mat-form-field",19),e.k0s(),e.j41(45,"div",20)(46,"button",21),e.bIt("click",function(){return e.eBV(d),e.Njj(i.openShorcutsDialog())}),e.j41(47,"mat-icon",22),e.nI1(48,"translate"),e.EFF(49,"keyboard "),e.k0s()(),e.DNE(50,hs,6,7,"button",23),e.k0s()()}2&n&&(e.R7$(2),e.Y8G("value",i.geometryType.Point),e.R7$(),e.Y8G("value",i.geometryType.Point),e.R7$(),e.SpI(" ",e.bMT(5,29,"igo.geo.draw."+i.geometryType.Point)," "),e.R7$(2),e.Y8G("value",i.geometryType.LineString),e.R7$(),e.SpI(" ",e.bMT(8,31,"igo.geo.draw."+i.geometryType.LineString)," "),e.R7$(2),e.Y8G("value",i.geometryType.Polygon),e.R7$(),e.SpI(" ",e.bMT(11,33,"igo.geo.draw."+i.geometryType.Polygon)," "),e.R7$(2),e.Y8G("value",i.geometryType.Circle),e.R7$(),e.SpI(" ",e.bMT(14,35,"igo.geo.draw."+i.geometryType.Circle)," "),e.R7$(3),e.Y8G("disabled",i.drawControlIsDisabled)("checked",i.drawControlIsActive)("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(18,37,"igo.geo.draw.drawControl")," "),e.R7$(2),e.Y8G("checked",i.labelsAreShown)("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(21,39,"igo.geo.draw.toggleMapTooltips")," "),e.R7$(2),e.Y8G("ngIf",!i.isPoint()),e.R7$(),e.Y8G("ngIf",i.isCircle()),e.R7$(5),e.JRh(e.bMT(29,41,"igo.geo.draw.layer.title")),e.R7$(2),e.Y8G("value",i.updateActiveLayer()),e.R7$(2),e.Y8G("ngForOf",i.allLayers),e.R7$(2),e.SpI(" ",e.bMT(35,43,"igo.geo.draw.layer.createNewLayer")," "),e.R7$(2),e.Y8G("ngIf",i.activeDrawingLayer),e.R7$(3),e.Y8G("ngIf",i.activeStore.count$.getValue()>0),e.R7$(2),e.Y8G("store",i.activeStore)("template",i.tableTemplate),e.R7$(3),e.Y8G("ngIf",i.icons.length>=1),e.R7$(3),e.Y8G("matTooltip",e.bMT(48,45,"igo.geo.draw.shortcuts")),e.R7$(3),e.Y8G("ngIf",i.selectedFeatures$.value.length))},dependencies:[ge.Vg,ge.ec,ge.pc,Ft.mV,Ft.sG,o.bT,be.RG,be.rl,be.nJ,Tt.fS,Tt.fg,Q.YN,Q.me,Q.Q0,Q.BC,Q.VZ,Q.X1,Q.l_,_e.Ve,_e.VO,_e.$2,re.wT,o.pM,re.Sy,ye.w,ye.q,L.Hl,L.$z,L.iY,v.uc,v.oV,R.m_,R.An,Ne.f7,E.Y,E.k,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:16px}[_nghost-%COMP%]   .edition-drawing[_ngcontent-%COMP%]{padding:10px 0}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .storeTable[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   .layer-select[_ngcontent-%COMP%]{flex:1;margin-right:8px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:4px 8px}[_nghost-%COMP%]     igo-entity-table td:last-child{text-align:right!important}[_nghost-%COMP%]     igo-entity-table td:last-child button{margin:0%!important}[_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{margin:16px 8px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{display:flex;align-items:center}"],data:{animation:[(0,Vt.hZ)("openClose",[(0,Vt.wk)("open",(0,Vt.iF)({opacity:1})),(0,Vt.wk)("closed",(0,Vt.iF)({opacity:0})),(0,Vt.kY)("open => closed",[(0,Vt.i0)("600ms ease")]),(0,Vt.kY)("closed => open",[(0,Vt.i0)("800ms ease")])])]},changeDetection:0})}return l})();var ja=r(19061),_s=r(18094),J=r(25713),V=r(13680),m=r(57510);function S(l,f){}let $=(()=>{class l{cdRef;ngControl;olOverlayLayer;olGeoJSON=new _o.A;ready=!1;drawControl;modifyControl;defaultDrawStyleRadius;olGeometryEnds$$;olGeometryChanges$$;olTooltip=this.createMeasureTooltip();activeControl;map;set geometryType(t){this._geometryType=t,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get geometryType(){return this._geometryType}_geometryType;drawGuide=null;measure=!1;get drawControlIsActive(){return this._drawControlIsActive}set drawControlIsActive(t){if(this._drawControlIsActive=t,!1!==this.ready){if(this.deactivateControl(),!this._drawControlIsActive)return;this.toggleControl()}}_drawControlIsActive=!0;get freehandDrawIsActive(){return this._freehandDrawIsActive}set freehandDrawIsActive(t){this._freehandDrawIsActive=t,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&this.drawControlIsActive&&this.toggleControl()}_freehandDrawIsActive;get predefinedRadius(){return this._predefinedRadius}set predefinedRadius(t){this._predefinedRadius=t,this.drawControl.ispredefinedRadius$.next(t)}_predefinedRadius;controlOptions={};set drawStyle(t){void 0===t&&(t=(0,m.g4)()),this._drawStyle=t;const n=this.getGuideStyleFromDrawStyle(t);this.defaultDrawStyleRadius=void 0!==n?n.getRadius():null,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get drawStyle(){return this._drawStyle}_drawStyle;set overlayStyle(t){this._overlayStyle=t}get overlayStyle(){return this._overlayStyle}_overlayStyle;set value(t){this._value=t,!1!==this.ready&&(t?this.addGeoJSONToOverlay(t):this.olOverlaySource.clear(!0),this.onChange(t),this.toggleControl(),this.cdRef.detectChanges())}get value(){return this._value}_value;get olOverlaySource(){return this.olOverlayLayer.getSource()}set radius(t){if(!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)){let n;setTimeout(()=>{n=this.modifyControl.olModifyInteraction,n&&n.features_&&(n.features_.clear(),this.addGeoJSONToOverlay(this.value))},0)}}constructor(t,n){this.cdRef=t,this.ngControl=n,void 0!==this.ngControl&&(this.ngControl.valueAccessor=this)}ngOnInit(){void 0===this.drawStyle&&(this.drawStyle=(0,m.g4)()),void 0===this.overlayStyle&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}ngOnDestroy(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}registerOnChange(t){this.onChange=t}onChange=()=>{};registerOnTouched(t){this.onTouched=t}onTouched=()=>{};writeValue(t){this.value=t}addOlOverlayLayer(){this.olOverlayLayer=new _s.A({source:new ln.A,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}createDrawControl(){const t=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:"function"==typeof this.drawStyle?this.drawStyle:(n,i)=>{const d=this.drawStyle;return this.updateDrawStyleWithDrawGuide(d,i),d}});this.drawControl=new V.SW(t)}createModifyControl(){const t=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:(n,i)=>{const d=this.drawStyle;return this.updateDrawStyleWithDrawGuide(d,i),d}});this.modifyControl=new V.YV(t)}toggleControl(){let t;t=!this.value&&this.geometryType?this.drawControl:this.modifyControl,t!==this.activeControl&&(this.deactivateControl(),this.activateControl(t))}activateControl(t){this.activeControl=t,this.olGeometryEnds$$=t.end$.subscribe(n=>this.onOlGeometryEnds(n)),!0===this.measure&&t===this.drawControl&&(this.olGeometryChanges$$=t.changes$.subscribe(n=>this.onOlGeometryChanges(n))),t.setOlMap(this.map.ol,!1)}deactivateControl(){this.removeMeasureTooltip(),void 0!==this.activeControl&&this.activeControl.setOlMap(void 0),void 0!==this.olGeometryEnds$$&&this.olGeometryEnds$$.unsubscribe(),void 0!==this.olGeometryChanges$$&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}onOlGeometryEnds(t){this.removeMeasureTooltip(),this.setOlGeometry(t)}onOlGeometryChanges(t){"Point"!==t.getType()&&this.updateMeasureTooltip(t)}setOlGeometry(t){let n;void 0!==t&&("Circle"===t.getType()&&(t=this.circleToPoint(t)),n=this.olGeoJSON.writeGeometryObject(t,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),t.get("radius")&&(n.radius=t.get("radius"),t.set("radius",n.radius)),this.writeValue(n))}circleToPoint(t){const n=t.getCenter(),i=_.pd(n,this.map.projection,"EPSG:4326"),d=Math.round(t.getRadius()*Math.cos(Math.PI/180*i[1]));return(t=new Yn.A(n)).set("radius",d,!0),t}addGeoJSONToOverlay(t){const n=this.olGeoJSON.readGeometry(t,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),i=new Wt.A({geometry:n});i.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(i)}createMeasureTooltip(){return new ja.A({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}updateMeasureTooltip(t){const i=(0,J.RE)(t,this.map.projection).lengths,d="Polygon"===t.getType()?i.length-2:i.length-1,T=i[d],B=(0,J.Sg)(t),me=B[d];if(0===B.length||void 0===me)return void this.removeMeasureTooltip();this.olTooltip.setPosition(me.getFlatCoordinates());const fe=(0,J.os)(T,{decimal:1,unit:J.$R.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=fe,void 0===this.olTooltip.getMap()&&this.map.ol.addOverlay(this.olTooltip)}removeMeasureTooltip(){this.olTooltip.getMap&&void 0!==this.olTooltip.getMap()&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}updateDrawStyleWithDrawGuide(t,n){const i=this.getGuideStyleFromDrawStyle(t);if(void 0===i)return;const d=this.drawGuide;let T;T=!d||d<0?this.defaultDrawStyleRadius:d>0?d/n:d,i.setRadius(T)}getGuideStyleFromDrawStyle(t){let n,i;return n=Array.isArray(t)?t[0]:t,"function"==typeof n.getImage&&(n=n.getImage()),"function"==typeof n.setRadius&&(i=n),i}static \u0275fac=function(n){return new(n||l)(e.rXU(e.gRc),e.rXU(Q.vO,10))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",predefinedRadius:"predefinedRadius",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},standalone:!0,features:[e.aNF],decls:1,vars:0,template:function(n,i){1&n&&e.DNE(0,S,0,0,"ng-template")},encapsulation:2,changeDetection:0})}return l})();var oe=r(44860);function Se(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-slide-toggle",17),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onDrawControlChange())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("checked",t.drawControlIsActive)("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function Ue(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-slide-toggle",17),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onfreehandControlChange())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("checked",t.freehandDrawIsActive)("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function it(l,f){if(1&l&&(e.j41(0,"mat-option",6),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.measure."+t)," ")}}function gt(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",18)(1,"mat-form-field",19),e.nrm(2,"input",20),e.nI1(3,"translate"),e.k0s(),e.j41(4,"mat-form-field",21)(5,"mat-select",22),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onMeasureUnitChange(i.value))}),e.DNE(6,it,3,4,"mat-option",23),e.k0s()()()}if(2&l){const t=e.XpG();e.R7$(2),e.FS9("placeholder",e.bMT(3,6,"igo.geo.spatialFilter.buffer")),e.Y8G("formControl",t.bufferFormControl)("value",0)("readonly",null===t.formControl.value),e.R7$(3),e.Y8G("value",t.measureUnit),e.R7$(),e.Y8G("ngForOf",t.measureUnits)}}function yt(l,f){if(1&l&&(e.j41(0,"mat-option",6),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.measure."+t)," ")}}function Pt(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",24)(1,"mat-form-field",25)(2,"input",26),e.nI1(3,"translate"),e.bIt("input",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.getRadius())}),e.k0s()(),e.j41(4,"mat-form-field",21)(5,"mat-select",22),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onMeasureUnitChange(i.value))}),e.DNE(6,yt,3,4,"mat-option",23),e.k0s()()()}if(2&l){const t=e.XpG();e.R7$(2),e.FS9("placeholder",e.bMT(3,6,"igo.geo.spatialFilter.radius")),e.Y8G("formControl",t.radiusFormControl)("value",1e3)("readonly",t.freehandDrawIsActive&&null===t.formControl.value),e.R7$(3),e.Y8G("value",t.measureUnit),e.R7$(),e.Y8G("ngForOf",t.measureUnits)}}function It(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-radio-button",27),e.bIt("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onItemTypeChange(i))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.spatialFilter."+t)," ")}}function xt(l,f){1&l&&(e.j41(0,"mat-header-cell",38),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.JRh(e.bMT(2,1,"igo.geo.spatialFilter.Thematics")))}function uo(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-header-cell",39)(1,"mat-checkbox",40),e.bIt("change",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(i?d.masterToggle():null)}),e.k0s()()}if(2&l){const t=e.XpG(2);e.R7$(),e.Y8G("checked",t.isAllSelected())("indeterminate",t.selectedThematics.hasValue()&&!t.isAllSelected())}}function Oo(l,f){1&l&&e.nrm(0,"mat-header-row")}function cn(l,f){1&l&&e.nrm(0,"mat-row")}function Yo(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-tree-node",41)(1,"li",42),e.nrm(2,"button",43),e.EFF(3),e.j41(4,"mat-checkbox",44),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())})("change",function(i){const d=e.eBV(t).$implicit,T=e.XpG(2);return e.Njj(i?T.onToggleChange(d):null)}),e.k0s()()()}if(2&l){const t=f.$implicit,n=e.XpG(2);e.R7$(3),e.SpI(" ",t.name," "),e.R7$(),e.Y8G("checked",n.selectedThematics.isSelected(t))}}function Fn(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-nested-tree-node")(1,"div",42)(2,"button",45),e.bIt("click",function(){const i=e.eBV(t).$implicit,d=e.XpG(2);return e.Njj(d.onToggleClick(i))}),e.j41(3,"mat-icon"),e.EFF(4),e.k0s()(),e.EFF(5),e.j41(6,"mat-checkbox",46),e.bIt("change",function(i){const d=e.eBV(t).$implicit,T=e.XpG(2);return e.Njj(i?T.childrensToggle(d):null)}),e.k0s()(),e.j41(7,"ul",47),e.eu8(8,48),e.k0s()()}if(2&l){const t=f.$implicit,n=e.XpG(2);e.R7$(4),e.JRh(n.treeControl.isExpanded(t)?"expand_more":"chevron_right"),e.R7$(),e.SpI(" ",t.name," "),e.R7$(),e.Y8G("checked",n.isAllSelected(t))("indeterminate",n.hasChildrenSelected(t)&&!n.isAllSelected(t)),e.R7$(),e.AVh("example-tree-invisible",!n.treeControl.isExpanded(t))}}function mi(l,f){if(1&l&&(e.j41(0,"div",28)(1,"mat-table"),e.qex(2,29),e.DNE(3,xt,3,3,"mat-header-cell",30),e.bVm(),e.qex(4,31),e.DNE(5,uo,2,2,"mat-header-cell",32),e.bVm(),e.DNE(6,Oo,1,0,"mat-header-row",33)(7,cn,1,0,"mat-row",34),e.k0s(),e.j41(8,"mat-tree",35),e.DNE(9,Yo,5,2,"mat-tree-node",36)(10,Fn,9,6,"mat-nested-tree-node",37),e.k0s()()),2&l){const t=e.XpG();e.R7$(6),e.Y8G("matHeaderRowDef",t.displayedColumns),e.R7$(),e.Y8G("matRowDefColumns",t.displayedColumns),e.R7$(),e.Y8G("dataSource",t.dataSource)("treeControl",t.treeControl),e.R7$(2),e.Y8G("matTreeNodeDefWhen",t.hasChild)}}function Qi(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",49),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.clearSearch())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("disabled",t.disabledClearSearch()),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function ys(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",50),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.clearDrawZone())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("disabled",null===t.formControl.value),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function mc(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",51),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleVisibleList())}),e.j41(2,"mat-icon"),e.EFF(3,"expand_more"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.spatialFilter.showSearchResults"))}function gc(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",55),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.toggleVisibleList())}),e.j41(2,"mat-icon"),e.EFF(3,"expand_less"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function hc(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",52),e.DNE(1,gc,4,3,"button",53),e.j41(2,"igo-entity-table",54),e.bIt("entitySelectChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.entityChange.emit(i))}),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.listIsVisible),e.R7$(),e.Y8G("template",t.tableTemplate)("store",t.store)}}let Ba=(()=>{class l{cdRef;spatialFilterService;messageService;languageService;map;get type(){return this._type}set type(t){this._type=t;const n=this.geometryTypes.findIndex(i=>i===this.type);if(this.geometryType=this.geometryTypes[n],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===N.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===N.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=(i,d)=>{const T=i.getGeometry(),B=_.pd(T.getCoordinates(),this.map.projection,"EPSG:4326");return new st.Ay({image:new ht.A({radius:this.radius/Math.cos(Math.PI/180*B[1])/d,stroke:new Ze.A({width:2,color:"rgba(0, 153, 255)"}),fill:new _t.A({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=()=>new st.Ay({stroke:new Ze.A({width:2,color:"rgba(0, 153, 255)"}),fill:new _t.A({color:"rgba(0, 153, 255, 0.2)"})});const i=[0,153,255],d=()=>new st.Ay({image:new ht.A({radius:8,stroke:new Ze.A({width:2,color:"rgba(0, 153, 255)"}),fill:new _t.A({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new Ze.A({color:i.concat([1]),width:2}),fill:new _t.A({color:i.concat([.2])})});this.overlayStyle=this.PolyStyle,this.drawStyle$.next(d)}this.overlayStyle$.next(this.overlayStyle)}_type;queryType;zone;loading;get store(){return this._store}set store(t){this._store=t,this._store.entities$.subscribe(()=>{this.cdRef.detectChanges()})}_store;get measureUnits(){return[J.$R.Meters,J.$R.Kilometers]}layers=[];allLayers=[];get thematicLength(){return this._thematicLength}set thematicLength(t){this._thematicLength=t}_thematicLength;toggleSearch=new e.bkB;itemTypeChange=new e.bkB;thematicChange=new e.bkB;drawZoneEvent=new e.bkB;bufferEvent=new e.bkB;zoneWithBufferChange=new e.bkB;measureUnitChange=new e.bkB;radiusEvent=new e.bkB;freehandControl=new e.bkB;predefinedRadius=new e.bkB;clearButtonEvent=new e.bkB;clearSearchEvent=new e.bkB;export=new e.bkB;openWorkspace=new e.bkB;entityChange=new e.bkB;itemType=[W.Address,W.Thematics];selectedItemType=W.Address;selectedSourceAddress;treeControl=new q.XO(t=>t.children);displayedColumns=["name","select"];childrens=[];groups=[];thematics=[];dataSource=new Pe.Zh;selectedThematics=new K.CB(!0,[]);value$=new ce.t(void 0);drawGuide$=new ce.t(null);overlayStyle$=new ce.t(void 0);drawStyle$=new ce.t(void 0);value$$;radiusChanges$$;bufferChanges$$;formControl=new Q.hs;geometryType;geometryTypeField=!1;geometryTypes=[wt.Point,wt.Polygon];drawGuideField=!1;drawGuide=null;drawGuidePlaceholder="";measure=!1;drawControlIsActive=!0;freehandDrawIsActive=!1;drawStyle;drawZone;overlayStyle;PointStyle;PolyStyle;radius;buffer=0;radiusFormControl=new Q.hs;bufferFormControl=new Q.hs;measureUnit=J.$R.Meters;zoneWithBuffer;listIsVisible=!0;tableTemplate;constructor(t,n,i,d){this.cdRef=t,this.spatialFilterService=n,this.messageService=i,this.languageService=d}ngOnInit(){this.spatialFilterService.loadThematicsList().subscribe(i=>{for(const T of i)this.childrens.push(T),this.childrens.sort((B,me)=>B.name.localeCompare(me.name));this.groups.push(this.languageService.translate.instant("igo.geo.terrapi.limites"));const d={name:this.groups[0],children:[]};this.thematics.push(d),this.childrens.forEach(T=>{T.group&&-1===this.groups.indexOf(T.group)&&(this.groups.push(T.group),this.thematics.push({name:T.group,children:[]})),T.group||(T.name===this.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||T.name===this.languageService.translate.instant("igo.geo.terrapi.Mun")||T.name===this.languageService.translate.instant("igo.geo.terrapi.Arrond")||T.name===this.languageService.translate.instant("igo.geo.terrapi.CircFed")||T.name===this.languageService.translate.instant("igo.geo.terrapi.CircProv")||T.name===this.languageService.translate.instant("igo.geo.terrapi.DirReg")||T.name===this.languageService.translate.instant("igo.geo.terrapi.MRC")||T.name===this.languageService.translate.instant("igo.geo.terrapi.RegTour")?T.group=d.name:T.name===this.languageService.translate.instant("igo.geo.terrapi.routes")?T.group=this.languageService.translate.instant("igo.geo.spatialFilter.group.transport"):this.thematics.push({name:T.name,children:[],source:T.source})),this.thematics.sort((B,me)=>B.name.localeCompare(me.name))}),this.thematics.forEach(T=>{for(const B of this.childrens)B.group===T.name&&T.children.push(B)})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(i=>{i?(this.value$.next(i),this.drawZone=this.formControl.value,0!==this.buffer&&(this.drawZoneEvent.emit(this.drawZone),this.bufferFormControl.setValue(this.buffer))):(this.value$.next(void 0),this.drawZone=void 0)}),this.value$.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe((0,ho.B)(500)).subscribe(i=>{this.measureUnit===J.$R.Meters&&i>0&&i<=1e5?(this.buffer=i,this.bufferEvent.emit(i),this.spatialFilterService.loadBufferGeometry(this.drawZone,N.Polygon,i).subscribe(d=>{this.zoneWithBuffer=d,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===J.$R.Kilometers&&i>0&&i<=100?(this.buffer=i,this.bufferEvent.emit(i),this.spatialFilterService.loadBufferGeometry(this.drawZone,N.Polygon,1e3*i).subscribe(d=>{this.zoneWithBuffer=d,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===i?(this.buffer=i,this.bufferEvent.emit(i),this.drawZoneEvent.emit(this.drawZone)):(i<0||this.measureUnit===J.$R.Meters&&i>1e5||this.measureUnit===J.$R.Kilometers&&i>100)&&(this.bufferFormControl.setValue(0),this.buffer=0,this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))});const t=new Ne.qA({}),n=new kt.ZA({layer:new oe.vK({zIndex:300,source:new ft._k,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:kt.Bl.Default,many:!0,dragBox:!0});this.store.addStrategy(n,!0),this.store.addStrategy(t,!1)}ngOnDestroy(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}onItemTypeChange(t){this.selectedItemType=t.value,this.itemTypeChange.emit(this.selectedItemType)}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.bufferFormControl.setValue(this.measureUnit===J.$R.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3):this.isPoint()&&this.radiusFormControl.setValue(this.measureUnit===J.$R.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}isPredefined(){return this.type===N.Predefined}isPolygon(){return this.type===N.Polygon}isPoint(){return this.type===N.Point}hasChild(t,n){return!!n.children&&n.children.length}onToggleClick(t){this.treeControl.isExpanded(t)?this.treeControl.collapse(t):this.treeControl.expand(t)}isAllSelected(t){let n,i=0;return t?(n=t.children.length,t.children.forEach(d=>{this.selectedThematics.selected.find(T=>T===d)&&i++})):(n=this.selectedThematics.selected.length,this.thematics.forEach(d=>{-1===this.groups.indexOf(d.name)&&i++}),this.childrens.forEach(d=>{this.thematics.find(T=>T.source===d.source)||i++})),i>=1&&n===i}hasChildrenSelected(t){let n=!1;return t.children.forEach(i=>{this.selectedThematics.selected.find(d=>d.source===i.source)&&(n=!0)}),n}masterToggle(){this.isAllSelected()?this.selectedThematics.clear():this.selectAll();const t=[];for(const n of this.selectedThematics.selected)t.push(n);this.isAllSelected()?this.thematics.forEach(n=>{this.hasChild(0,n)&&this.treeControl.expand(n)}):this.thematics.forEach(n=>{this.hasChild(0,n)&&this.treeControl.collapse(n)}),this.thematicChange.emit(t)}selectAll(t){t?this.hasChild(0,t)&&t.children.forEach(n=>this.selectedThematics.select(n)):(this.thematics.forEach(n=>{-1===this.groups.indexOf(n.name)&&this.selectedThematics.select(n)}),this.childrens.forEach(n=>{this.selectedThematics.selected.find(i=>i.source===n.source)||this.selectedThematics.select(n)}))}childrensToggle(t){this.isAllSelected(t)?t.children.forEach(i=>this.selectedThematics.deselect(i)):this.selectAll(t);const n=[];for(const i of this.selectedThematics.selected)n.push(i);this.treeControl.expand(t),this.thematicChange.emit(n)}onToggleChange(t){let n=!1;void 0!==this.selectedThematics.selected.find(d=>d.source===t.source)&&(n=!0),this.childrens.forEach(d=>{d===t&&!1===n&&this.selectedThematics.select(d),d===t&&!0===n&&this.selectedThematics.deselect(d)}),this.thematics.forEach(d=>{d===t&&!1===n&&this.selectedThematics.select(d),d===t&&!0===n&&this.selectedThematics.deselect(d)});const i=[];for(const d of this.selectedThematics.selected)i.push(d);this.thematicChange.emit(i)}onDrawControlChange(){this.drawControlIsActive=!this.drawControlIsActive}onfreehandControlChange(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive),this.isPoint()?(this.predefinedRadius.emit(!this.freehandDrawIsActive),this.freehandDrawIsActive&&(this.overlayStyle$.next(void 0),this.drawStyle$.next(void 0))):this.predefinedRadius.emit(!1)}toggleSearchButton(){this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe((0,ho.B)(500)).subscribe(t=>{t.length&&this.layers.length===this.thematicLength+1&&(this.openWorkspace.emit(),this.createTableTemplate())})}clearButton(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}clearDrawZone(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}clearSearch(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}disableSearchButton(){if(this.type===N.Predefined){if(this.selectedItemType===W.Address&&void 0!==this.queryType&&void 0!==this.zone)return this.loading;if(this.selectedItemType===W.Thematics&&void 0!==this.queryType&&void 0!==this.zone&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===N.Polygon||this.type===N.Point){if(this.selectedItemType===W.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===W.Thematics&&this.selectedThematics.selected.length>0&&null!==this.formControl.value)return this.loading}return!0}disabledClearSearch(){let t=!0;return t=this.selectedItemType===W.Address?void 0===this.queryType:void 0===this.queryType&&0===this.selectedThematics.selected.length,t}getRadius(){let t;if(t=null!==this.formControl.value?this.measureUnit===J.$R.Meters?this.formControl.value.radius:this.formControl.value.radius/1e3:void 0,this.type===N.Point){if(this.freehandDrawIsActive){if(t){if(t>=1e5)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),void this.formControl.reset();if(t!==this.radiusFormControl.value)return void this.radiusFormControl.setValue(t)}}else if(this.radiusFormControl.value<0||this.measureUnit===J.$R.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===J.$R.Kilometers&&this.radiusFormControl.value>=100)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.radius=1e3,this.radiusFormControl.setValue(this.measureUnit===J.$R.Meters?this.radius:this.radius/1e3),void this.drawGuide$.next(this.radius);this.measureUnit===J.$R.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=1e3*this.radiusFormControl.value,this.drawGuide$.next(1e3*this.radius)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}toggleVisibleList(){this.listIsVisible=!this.listIsVisible}createTableTemplate(){const t={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:Ne.pp.UnsanitizedHTML},n={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:Ne.pp.UnsanitizedHTML};this.tableTemplate={selection:!0,sort:!0,columns:[t,n]}}static \u0275fac=function(n){return new(n||l)(e.rXU(e.gRc),e.rXU(O),e.rXU(k.bg),e.rXU(y.gw))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",predefinedRadius:"predefinedRadius",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},standalone:!0,features:[e.aNF],decls:29,vars:43,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius","predefinedRadius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"click","disabled"],["mat-raised-button","",1,"remove-button",3,"click","disabled"],["mat-raised-button","",1,"export-button",3,"click","disabled"],["class","expand-more","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"change","checked","labelPosition"],[1,"buffer-unit"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius"],["type","number","matInput","",3,"input","placeholder","formControl","value","readonly"],[3,"change","value"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"change","checked","indeterminate"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"click","change","checked"],["mat-icon-button","",3,"click"],[1,"tree-check-2",3,"change","checked","indeterminate"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"click","disabled"],["mat-raised-button","",1,"clear-form-button",3,"click","disabled"],["mat-icon-button","","matTooltipShowDelay","500",1,"expand-more",3,"click","matTooltip"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"entitySelectChange","template","store"],["mat-icon-button","","matTooltipShowDelay","500",3,"click","matTooltip"]],template:function(n,i){1&n&&(e.nrm(0,"igo-geometry-form-field-input",0),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.j41(4,"div",1),e.DNE(5,Se,3,5,"mat-slide-toggle",2)(6,Ue,3,5,"mat-slide-toggle",2),e.k0s(),e.DNE(7,gt,7,8,"div",3)(8,Pt,7,8,"div",4),e.j41(9,"mat-label",5),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"mat-radio-group",6),e.DNE(13,It,3,4,"mat-radio-button",7),e.k0s(),e.DNE(14,mi,11,5,"div",8),e.j41(15,"div",9),e.DNE(16,Qi,3,4,"button",10)(17,ys,3,4,"button",11),e.j41(18,"button",12),e.bIt("click",function(){return i.toggleSearchButton()}),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"button",13),e.bIt("click",function(){return i.clearButton()}),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"button",14),e.bIt("click",function(){return i.export.emit()}),e.EFF(25),e.nI1(26,"translate"),e.k0s()(),e.DNE(27,mc,4,3,"button",15)(28,hc,3,3,"div",16)),2&n&&(e.Y8G("formControl",i.formControl)("map",i.map)("geometryType",i.geometryType)("drawGuide",e.bMT(1,29,i.drawGuide$))("measure",i.measure)("drawControlIsActive",i.drawControlIsActive)("freehandDrawIsActive",i.freehandDrawIsActive)("drawStyle",e.bMT(2,31,i.drawStyle$))("overlayStyle",e.bMT(3,33,i.overlayStyle$))("radius",i.radius)("predefinedRadius",i.predefinedRadius),e.R7$(5),e.Y8G("ngIf",!i.isPredefined()),e.R7$(),e.Y8G("ngIf",!i.isPredefined()),e.R7$(),e.Y8G("ngIf",i.isPolygon()),e.R7$(),e.Y8G("ngIf",i.isPoint()),e.R7$(2),e.SpI("",e.bMT(11,35,"igo.geo.spatialFilter.search")," :\n"),e.R7$(2),e.Y8G("value",i.selectedItemType),e.R7$(),e.Y8G("ngForOf",i.itemType),e.R7$(),e.Y8G("ngIf","Thematics"===i.selectedItemType&&!i.tableTemplate||"Thematics"===i.selectedItemType&&i.tableTemplate&&!i.listIsVisible),e.R7$(2),e.Y8G("ngIf",i.isPredefined()),e.R7$(),e.Y8G("ngIf",i.isPolygon()||i.isPoint()),e.R7$(),e.Y8G("disabled",i.disableSearchButton()),e.R7$(),e.SpI(" ",e.bMT(20,37,"igo.geo.spatialFilter.goSearch")," "),e.R7$(2),e.Y8G("disabled",0===i.allLayers.length),e.R7$(),e.SpI(" ",e.bMT(23,39,"igo.geo.spatialFilter.removeLayer")," "),e.R7$(2),e.Y8G("disabled",!i.store.entities$.getValue().length),e.R7$(),e.SpI(" ",e.bMT(26,41,"igo.geo.spatialFilter.exportLayer")," "),e.R7$(2),e.Y8G("ngIf",i.store.all().length&&i.tableTemplate&&!i.listIsVisible),e.R7$(),e.Y8G("ngIf",i.store.all().length&&i.tableTemplate&&i.listIsVisible))},dependencies:[$,Q.YN,Q.me,Q.Q0,Q.BC,Q.X1,Q.l_,o.bT,Ft.mV,Ft.sG,be.RG,be.rl,be.nJ,Tt.fS,Tt.fg,_e.Ve,_e.VO,re.wT,o.pM,re.Sy,He.Wk,He.VT,He._g,ve.tP,ve.Zl,ve.tL,ve.ji,ve.cC,ve.iL,ve.KS,ve.YZ,ve.NB,ae.g7,ae.So,Pe.jH,Pe.q1,Pe.yI,Pe.pO,Pe.lQ,Pe.d6,Pe.wx,L.Hl,L.$z,L.iY,R.m_,R.An,v.uc,v.oV,Ne.f7,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{margin-top:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-top:5px}[_nghost-%COMP%]   .mat-column-select[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin:16px 0}[_nghost-%COMP%]   .thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}[_nghost-%COMP%]   .mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}[_nghost-%COMP%]   .buffer-unit[_ngcontent-%COMP%], [_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:5px;box-sizing:border-box}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%], [_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex-flow:column nowrap;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .example-tree-invisible[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}[_nghost-%COMP%]   .tree-check[_ngcontent-%COMP%], [_nghost-%COMP%]   .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}[_nghost-%COMP%]   .thematics-header[_ngcontent-%COMP%]{max-width:250px}[_nghost-%COMP%]   .checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}[_nghost-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{padding:5px}[_nghost-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}[_nghost-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{height:56px}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{max-height:45%;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:unset}"],changeDetection:0})}return l})();var fc=r(91817),Mn=r(83019);function _c(l,f){if(1&l&&(e.j41(0,"mat-option",12),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.properties.nom," ")}}function yc(l,f){if(1&l&&(e.j41(0,"mat-option",12),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.measure."+t)," ")}}let Ga=(()=>{class l{spatialFilterService;messageService;get store(){return this._store}set store(t){this._store=t}_store;get queryType(){return this._queryType}set queryType(t){this.formControl.setValue(""),this._queryType=t}_queryType;get zone(){return this._zone}set zone(t){this._zone=t,t||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}_zone;layers=[];zoneWithBuffer;selectedZone;measureUnit=Mn.$R.Meters;formControl=new Q.hs;bufferFormControl=new Q.hs;get measureUnits(){return[Mn.$R.Meters,Mn.$R.Kilometers]}zoneChange=new e.bkB;zoneWithBufferChange=new e.bkB;bufferChange=new e.bkB;measureUnitChange=new e.bkB;formValueChanges$$;bufferValueChanges$$;constructor(t,n){this.spatialFilterService=t,this.messageService=n}ngOnInit(){this.formValueChanges$$=this.formControl.valueChanges.subscribe(t=>{t.length&&this.store.view.filter(n=>{const i=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return n.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe((0,ho.B)(500),(0,fc.F)()).subscribe(t=>{this.measureUnit===Mn.$R.Meters&&t>0&&t<=1e5?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,N.Predefined,t,this.queryType).subscribe(n=>{this.zoneWithBuffer=n,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===Mn.$R.Kilometers&&t>0&&t<=100?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,N.Predefined,1e3*t,this.queryType).subscribe(n=>{this.zoneWithBuffer=n,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===t&&this.layers.length>0?(this.bufferChange.emit(t),this.zoneWithBufferChange.emit(this.selectedZone)):(t<0||this.measureUnit===Mn.$R.Meters&&t>1e5||this.measureUnit===Mn.$R.Kilometers&&t>100)&&(this.bufferFormControl.setValue(0),this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))})}ngOnDestroy(){this.formValueChanges$$.unsubscribe()}displayFn(t){return t?t.properties.nom:void 0}onZoneChange(t){t&&this.queryType&&this.spatialFilterService.loadItemById(t,this.queryType).subscribe(n=>{this.selectedZone=n,this.zoneChange.emit(n)})}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.bufferFormControl.setValue(this.measureUnit===Mn.$R.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3))}static \u0275fac=function(n){return new(n||l)(e.rXU(O),e.rXU(k.bg))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.aNF],decls:23,vars:23,consts:[["input",""],["auto","matAutocomplete"],[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"selectionChange","value"],[3,"value"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"div",2)(1,"mat-form-field",3)(2,"mat-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.nrm(5,"input",4,0),e.nI1(7,"translate"),e.j41(8,"mat-autocomplete",5,1),e.bIt("optionSelected",function(B){return e.eBV(d),e.Njj(i.onZoneChange(B.option.value))}),e.DNE(10,_c,2,2,"mat-option",6),e.nI1(11,"async"),e.k0s()(),e.j41(12,"div")(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.nrm(18,"input",9),e.nI1(19,"translate"),e.k0s(),e.j41(20,"mat-form-field",10)(21,"mat-select",11),e.bIt("selectionChange",function(B){return e.eBV(d),e.Njj(i.onMeasureUnitChange(B.value))}),e.DNE(22,yc,3,4,"mat-option",6),e.k0s()()()()()}if(2&n){const d=e.sdS(9);e.R7$(3),e.JRh(e.bMT(4,13,"igo.geo.spatialFilter.listLabel")),e.R7$(2),e.FS9("placeholder",e.bMT(7,15,"igo.geo.spatialFilter.listLabel")),e.Y8G("formControl",i.formControl)("matAutocomplete",d),e.R7$(3),e.Y8G("displayWith",i.displayFn),e.R7$(2),e.Y8G("ngForOf",e.bMT(11,17,i.store.view.all$())),e.R7$(6),e.JRh(e.bMT(17,19,"igo.geo.spatialFilter.buffer")),e.R7$(2),e.FS9("placeholder",e.bMT(19,21,"igo.geo.spatialFilter.buffer")),e.Y8G("formControl",i.bufferFormControl)("value",0)("readonly",!i.zone),e.R7$(3),e.Y8G("value",i.measureUnit),e.R7$(),e.Y8G("ngForOf",i.measureUnits)}},dependencies:[be.RG,be.rl,be.nJ,Tt.fS,Tt.fg,Q.YN,Q.me,Q.Q0,Q.BC,Bt.jL,Bt.$3,re.wT,Bt.pN,Q.X1,Q.l_,o.pM,re.Sy,_e.Ve,_e.VO,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .buffer-div[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .zone-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}"],changeDetection:0})}return l})();var vs=r(38223);function vc(l,f){if(1&l&&(e.j41(0,"mat-option",8),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.terrapi."+t)," ")}}let Va=(()=>{class l{get store(){return this._store}set store(t){this._store=t}_store;queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"];selectedTypeIndex=new Q.hs(0);spatialType=N;activeDrawType=this.spatialType.Polygon;selectedQueryType;zone;layers=[];type;eventType=new e.bkB;eventQueryType=new e.bkB;zoneChange=new e.bkB;zoneWithBufferChange=new e.bkB;bufferChange=new e.bkB;measureUnitChange=new e.bkB;constructor(){}ngOnInit(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onTypeChange(t){0===this.selectedTypeIndex.value&&(this.type=N.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onDrawTypeChange(t){this.activeDrawType=t,this.eventType.emit(this.activeDrawType)}onSelectionChange(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.aNF],decls:22,vars:25,consts:[[3,"selectedIndexChange","selectedTabChange","selectedIndex"],[3,"label"],[3,"selectionChange","valueChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange","store","queryType","zone","layers"],[1,"spatial-type-toggle"],[3,"change","value"],[3,"value","matTooltip"],[3,"value"]],template:function(n,i){1&n&&(e.j41(0,"mat-tab-group",0),e.bIt("selectedIndexChange",function(T){return i.selectedTypeIndex.setValue(T)})("selectedTabChange",function(T){return i.onTypeChange(T)}),e.j41(1,"mat-tab",1),e.nI1(2,"translate"),e.j41(3,"mat-form-field")(4,"mat-label"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"mat-select",2),e.bIt("selectionChange",function(){return i.onSelectionChange()}),e.mxI("valueChange",function(T){return e.DH7(i.selectedQueryType,T)||(i.selectedQueryType=T),T}),e.DNE(8,vc,3,4,"mat-option",3),e.k0s()(),e.j41(9,"igo-spatial-filter-list",4),e.bIt("zoneChange",function(T){return i.zoneChange.emit(T)})("zoneWithBufferChange",function(T){return i.zoneWithBufferChange.emit(T)})("bufferChange",function(T){return i.bufferChange.emit(T)})("measureUnitChange",function(T){return i.measureUnitChange.emit(T)}),e.k0s()(),e.j41(10,"mat-tab",1),e.nI1(11,"translate"),e.j41(12,"div",5)(13,"mat-button-toggle-group",6),e.bIt("change",function(T){return i.onDrawTypeChange(T.value)}),e.j41(14,"mat-button-toggle",7),e.nI1(15,"translate"),e.j41(16,"mat-icon"),e.EFF(17,"pentagon"),e.k0s()(),e.j41(18,"mat-button-toggle",7),e.nI1(19,"translate"),e.j41(20,"mat-icon"),e.EFF(21,"circle"),e.k0s()()()()()()),2&n&&(e.Y8G("selectedIndex",i.selectedTypeIndex.value),e.R7$(),e.Y8G("label",e.bMT(2,15,"igo.geo.spatialFilter.predefined")),e.R7$(4),e.JRh(e.bMT(6,17,"igo.geo.spatialFilter.searchLabel")),e.R7$(2),e.R50("value",i.selectedQueryType),e.R7$(),e.Y8G("ngForOf",i.queryType),e.R7$(),e.Y8G("store",i.store)("queryType",i.selectedQueryType)("zone",i.zone)("layers",i.layers),e.R7$(),e.Y8G("label",e.bMT(11,19,"igo.geo.spatialFilter.draw")),e.R7$(3),e.Y8G("value",i.activeDrawType),e.R7$(),e.Y8G("value",i.spatialType.Polygon)("matTooltip",e.bMT(15,21,"igo.geo.spatialFilter.drawPolygon")),e.R7$(4),e.Y8G("value",i.spatialType.Point)("matTooltip",e.bMT(19,23,"igo.geo.spatialFilter.drawCircle")))},dependencies:[vs.RI,vs.mq,vs.T8,be.RG,be.rl,be.nJ,_e.Ve,_e.VO,re.wT,o.pM,re.Sy,Ga,ge.Vg,ge.ec,ge.pc,v.uc,v.oV,R.m_,R.An,y.Ck,P.D9],styles:["[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-label{padding:10px}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:5px}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return l})();var Sr=r(54149);function bc(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",9)(1,"mat-form-field"),e.nrm(2,"mat-datetimepicker-toggle",10)(3,"mat-datetimepicker",11,0),e.j41(5,"input",12),e.nI1(6,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(2);return e.DH7(d.date,i)||(d.date=i),e.Njj(i)}),e.bIt("dateChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.handleDateChange(i))}),e.k0s()()()}if(2&l){const t=e.sdS(4),n=e.XpG(2);e.R7$(2),e.Y8G("for",t),e.R7$(),e.Y8G("type",n.type)("openOnFocus",!0)("timeInterval",5),e.R7$(2),e.FS9("placeholder",e.bMT(6,9,"igo.geo.timeFilter.date")),e.Y8G("matDatetimepicker",t),e.R50("ngModel",n.date),e.Y8G("min",n.min)("max",n.max)}}function Cc(l,f){if(1&l){const t=e.RV6();e.j41(0,"div")(1,"div",13)(2,"mat-form-field"),e.nrm(3,"mat-datetimepicker-toggle",10)(4,"mat-datetimepicker",11,1),e.j41(6,"input",14),e.nI1(7,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(2);return e.DH7(d.startDate,i)||(d.startDate=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.startDate)})("dateChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.handleDateChange(i))}),e.k0s()()(),e.j41(8,"div",13)(9,"mat-form-field"),e.nrm(10,"mat-datetimepicker-toggle",10)(11,"mat-datetimepicker",11,2),e.j41(13,"input",12),e.nI1(14,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(2);return e.DH7(d.endDate,i)||(d.endDate=i),e.Njj(i)}),e.bIt("dateChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.handleDateChange(i))}),e.k0s()()()()}if(2&l){const t=e.sdS(5),n=e.sdS(12),i=e.XpG(2);e.R7$(3),e.Y8G("for",t),e.R7$(),e.Y8G("type",i.type)("openOnFocus",!0)("timeInterval",5),e.R7$(2),e.FS9("placeholder",e.bMT(7,18,"igo.geo.timeFilter.startDate")),e.Y8G("matDatetimepicker",t),e.R50("ngModel",i.startDate),e.Y8G("min",i.min)("max",i.getRangeMaxDate()),e.R7$(4),e.Y8G("for",n),e.R7$(),e.Y8G("type",i.type)("openOnFocus",!0)("timeInterval",5),e.R7$(2),e.FS9("placeholder",e.bMT(14,20,"igo.geo.timeFilter.endDate")),e.Y8G("matDatetimepicker",n),e.R50("ngModel",i.endDate),e.Y8G("min",i.getRangeMinDate())("max",i.max)}}function Sc(l,f){if(1&l&&(e.j41(0,"div"),e.DNE(1,bc,7,11,"div",8)(2,Cc,15,22,"div",6),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf",!t.isRange),e.R7$(),e.Y8G("ngIf",t.isRange)}}function Tc(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function Ic(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",9)(1,"mat-form-field")(2,"mat-select",15),e.nI1(3,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(2);return e.DH7(d.year,i)||(d.year=i),e.Njj(i)}),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.handleYearChange(i))}),e.DNE(4,Tc,2,2,"mat-option",16),e.k0s()()()}if(2&l){const t=e.XpG(2);e.R7$(2),e.FS9("placeholder",e.bMT(3,3,"igo.geo.timeFilter.date")),e.R50("ngModel",t.year),e.R7$(2),e.Y8G("ngForOf",t.listYears)}}function Fc(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function Mc(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function xc(l,f){if(1&l){const t=e.RV6();e.j41(0,"div")(1,"div",13)(2,"mat-form-field")(3,"mat-select",15),e.nI1(4,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(2);return e.DH7(d.startYear,i)||(d.startYear=i),e.Njj(i)}),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.handleYearChange(i))}),e.DNE(5,Fc,2,2,"mat-option",16),e.k0s()()(),e.j41(6,"div",13)(7,"mat-form-field")(8,"mat-select",15),e.nI1(9,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(2);return e.DH7(d.endYear,i)||(d.endYear=i),e.Njj(i)}),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.handleYearChange(i))}),e.DNE(10,Mc,2,2,"mat-option",16),e.k0s()()()()}if(2&l){const t=e.XpG(2);e.R7$(3),e.FS9("placeholder",e.bMT(4,6,"igo.geo.timeFilter.startDate")),e.R50("ngModel",t.startYear),e.R7$(2),e.Y8G("ngForOf",t.startListYears),e.R7$(3),e.FS9("placeholder",e.bMT(9,8,"igo.geo.timeFilter.endDate")),e.R50("ngModel",t.endYear),e.R7$(2),e.Y8G("ngForOf",t.endListYears)}}function Oc(l,f){if(1&l&&(e.j41(0,"div"),e.DNE(1,Ic,5,5,"div",8)(2,xc,11,10,"div",6),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf",!t.isRange),e.R7$(),e.Y8G("ngIf",t.isRange)}}function wc(l,f){if(1&l&&(e.j41(0,"p",25),e.EFF(1),e.k0s()),2&l){const t=e.XpG(2);e.R7$(),e.JRh(t.year)}}function Ec(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",18)(1,"span"),e.EFF(2),e.k0s(),e.j41(3,"mat-slider",19,3)(5,"input",20,4),e.bIt("input",function(){e.eBV(t);const i=e.sdS(4),d=e.sdS(6),T=e.XpG();return e.Njj(T.handleSliderYearChange({source:d,parent:i,value:d.value}))})("change",function(){e.eBV(t);const i=e.sdS(4),d=e.sdS(6),T=e.XpG();return e.Njj(T.handleSliderYearChange({source:d,parent:i,value:d.value}))}),e.k0s()(),e.j41(7,"span"),e.EFF(8),e.k0s(),e.DNE(9,wc,2,1,"p",21),e.j41(10,"div",22,5)(12,"mat-slide-toggle",23),e.nI1(13,"translate"),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleFilterState())}),e.k0s(),e.j41(14,"button",24),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.playYear(i))}),e.j41(15,"mat-icon"),e.EFF(16),e.k0s()(),e.j41(17,"button",24),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.resetFilter(i))}),e.j41(18,"mat-icon"),e.EFF(19),e.k0s()()()()}if(2&l){const t=e.XpG();e.R7$(2),e.JRh(t.startYear),e.R7$(),e.FS9("step",t.step),e.Y8G("min",t.startYear)("max",t.endYear)("color",t.color)("disabled",!t.options.enabled||!t.layer.visible),e.R7$(2),e.Y8G("value",t.handleSliderValue()),e.R7$(3),e.JRh(t.endYear),e.R7$(),e.Y8G("ngIf",t.options.enabled),e.R7$(3),e.Y8G("matTooltip",e.bMT(13,17,"igo.geo.filter.toggleFilterState"))("color",t.color)("checked",t.options.enabled)("disabled",!t.layer.visible),e.R7$(2),e.Y8G("disabled",!t.options.enabled||!t.layer.visible),e.R7$(2),e.JRh(t.playIcon),e.R7$(),e.Y8G("disabled",!t.options.enabled||!t.layer.visible),e.R7$(2),e.JRh(t.resetIcon)}}function Dc(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",9)(1,"mat-slider",26,3),e.bIt("selectionChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.handleSliderDateChange(i))}),e.j41(3,"input",27,4),e.bIt("input",function(){e.eBV(t);const i=e.sdS(2),d=e.sdS(4),T=e.XpG();return e.Njj(T.handleSliderDateChange({source:d,parent:i,value:d.value}))}),e.k0s()(),e.j41(5,"p",25),e.EFF(6),e.k0s(),e.j41(7,"button",28),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.playFilter(i))}),e.j41(8,"mat-icon"),e.EFF(9),e.k0s()()()}if(2&l){const t=e.XpG();e.R7$(),e.FS9("step",t.step),e.Y8G("min",t.dateToNumber(t.min))("max",t.dateToNumber(t.max)),e.R7$(2),e.Y8G("value",t.handleSliderValue()),e.R7$(3),e.JRh(t.handleSliderTooltip()),e.R7$(3),e.JRh(t.playIcon)}}let Ua=(()=>{class l{dateAdapter;layer;options;color="primary";date;startDate;endDate;year;startYear;endYear;initStartYear;initEndYear;listYears=[];startListYears=[];endListYears=[];set currentValue(t){if(t&&this.type!==h.U.YEAR){const n=t.split("/");if(n.length>0){const i=new Date(n[0]),d=new Date(n[1]);isNaN(i.valueOf())||(this.startDate=i),isNaN(d.valueOf())||(this.endDate=d)}}}interval;playIcon="play_circle";resetIcon="replay";change=new e.bkB;yearChange=new e.bkB;mySlider;get type(){return void 0===this.options.type?h.U.DATE:this.options.type}get isRange(){return void 0!==this.options.range&&this.options.style!==h.Z.SLIDER&&this.options.range}get style(){return void 0===this.options.style?h.Z.SLIDER:this.options.style}get step(){let t=108e5;if(void 0===this.options.step)switch(this.type){case h.U.DATE:case h.U.DATETIME:t=108e5;break;case h.U.TIME:t=36e5;break;case h.U.YEAR:t=31536e6;break;default:t=108e5}else t=this.getStepDefinition(this.options.step);return t}get timeInterval(){return void 0===this.options.timeInterval?2e3:this.options.timeInterval}get min(){if(this.options.min){const t=new Date(this.options.min);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get max(){if(this.options.max){const t=new Date(this.options.max);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get is(){return void 0!==this.options.range&&this.options.range}constructor(t){this.dateAdapter=t,this.dateAdapter.setLocale("fr")}ngOnInit(){if(void 0===this.startDate&&(this.startDate=new Date(this.min)),void 0===this.endDate&&(this.endDate=new Date(this.max)),void 0===this.startYear&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),void 0===this.endYear&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(let t=this.startYear;t<this.endYear;t++)this.startListYears.push(t);for(let t=this.startYear+1;t<=this.endYear;t++)this.endListYears.push(t)}else for(let t=this.startYear;t<=this.endYear+1;t++)this.listYears.push(t);this.options.enabled=void 0===this.options.enabled||this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&"slider"===this.style&&"year"===this.type&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}storeCurrentFilterValue(){!this.isRange&&this.style===h.Z.SLIDER&&this.type===h.U.YEAR&&(this.options.value=this.year.toString())}checkFilterValue(){const n=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==h.Z.SLIDER||this.type!==h.U.YEAR){if(this.isRange&&this.style===h.Z.CALENDAR&&this.type===h.U.YEAR&&n){this.startYear=parseInt(n.substr(0,4),10),this.endYear=parseInt(n.substr(5,4),10);const i=[],d=[];for(let T=this.initStartYear;T<this.endYear;T++)i.push(T);for(let T=this.startYear+1;T<=this.initEndYear;T++)d.push(T);this.startListYears=i,this.endListYears=d}}else this.year=n?new Date(n.toString()).getFullYear()+1:this.options.value?new Date(this.options.value.toString()).getFullYear()+1:new Date(this.min).getFullYear()+1}handleDateChange(t){this.setupDateOutput(),this.applyTypeChange(),this.change.emit(this.isRange?[this.startDate,this.endDate]:this.startDate)}handleYearChange(t){if(this.isRange){this.endListYears=[];for(let n=this.startYear+1;n<=this.initEndYear;n++)this.endListYears.push(n);this.startListYears=[];for(let n=this.initStartYear+1;n<this.endYear;n++)this.startListYears.push(n);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}handleListYearChange(t){this.handleYearChange([this.startYear,this.endYear])}handleListYearStartChange(t){this.change.emit([this.startDate,this.endDate])}dateToNumber(t){let n;return n=t?new Date(t):new Date(this.min),n.getTime()}setSliderThumbLabel(t){const n=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);n&&(n.textContent=t)}findThumbLabel(t){let n;return t.forEach(i=>{"mat-slider-thumb-label-text"===i.className&&(n=i),i.children.length>0&&!n&&(n=this.findThumbLabel(i.childNodes))},this),n}toggleFilterState(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&h.Z.SLIDER&&this.type===h.U.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}resetFilter(t){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&h.Z.SLIDER&&this.type===h.U.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(n=>{let i;const d=new Date(n.max);i=void 0===n.date?n.min.getTime():n.date.getTime(),i+=n.mySlider.step,n.date=new Date(i),i>d.getTime()&&n.stopFilter(),n.handleDateChange({value:n.date,date:n.date})},this.timeInterval,this))}playYear(t){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(t)),this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(()=>{this.year+this.mySlider.step>this.max.getFullYear()?this.stopFilter():this.year=this.year+this.mySlider.step,this.yearChange.emit(this.year)},this.timeInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}handleSliderDateChange(t){this.date=new Date(t.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(t)}handleSliderYearChange(t){this.year=t.value,this.yearChange.emit(this.year)}handleSliderValue(){return!0!==this.options.current&&this.min||(this.date=this.getRoundedDate(new Date)),this.type===h.U.YEAR?this.year:void 0===this.date?this.min.getTime():this.date.getTime()}handleSliderTooltip(){let t;switch(this.type){case h.U.DATE:t=void 0===this.date?this.min.toDateString():this.date.toDateString();break;case h.U.TIME:t=void 0===this.date?this.min.toTimeString():this.date.toTimeString();break;default:t=void 0===this.date?this.min.toUTCString():this.date.toUTCString()}return t}setupDateOutput(){this.style===h.Z.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=void 0===this.startDate?new Date(this.min):this.startDate,this.endDate=void 0===this.endDate?new Date(this.max):this.endDate)}applyTypeChange(){switch(this.type){case h.U.DATE:(void 0!==this.startDate||void 0!==this.endDate)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case h.U.TIME:if(this.style===h.Z.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){const t=this.startDate.getHours(),n=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(t),this.startDate.setMinutes(n)}if(this.endDate.getDay()!==this.min.getDay()){const t=this.endDate.getHours(),n=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(t),this.endDate.setMinutes(n)}}!this.isRange&&this.step>36e5&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}}getRangeMinDate(){return void 0===this.startDate?this.min:this.startDate}getRangeMaxDate(){return void 0===this.endDate?this.max:this.endDate}getRoundedDate(t,n=10){const i=6e4*n;return new Date(Math.round(t.getTime()/i)*i)}getStepDefinition(t){return nt().duration(t).asMilliseconds()}static \u0275fac=function(n){return new(n||l)(e.rXU(re.MJ))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-time-filter-form"]],viewQuery:function(n,i){if(1&n&&e.GBs(qt.IV,5),2&n){let d;e.mGM(d=e.lsd())&&(i.mySlider=d.first)}},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},standalone:!0,features:[e.aNF],decls:5,vars:4,consts:[["datetimePicker",""],["minDatetimePicker",""],["maxDatetimePicker",""],["ngSlider",""],["ngSliderThumb","matSliderThumb"],["actions",""],[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],[3,"type","openOnFocus","timeInterval"],["matInput","","autocomplete","false","readonly","readonly",3,"ngModelChange","dateChange","placeholder","matDatetimepicker","ngModel","min","max"],[1,"igo-col","igo-col-100"],["matInput","","autocomplete","false","readonly","readonly",3,"ngModelChange","input","dateChange","placeholder","matDatetimepicker","ngModel","min","max"],[3,"ngModelChange","selectionChange","placeholder","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","thumbLabel","",3,"step","min","max","color","disabled"],["matSliderThumb","",3,"input","change","value"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"change","matTooltip","color","checked","disabled"],["mat-icon-button","","color","primary",3,"click","disabled"],[1,"date-below"],["id","time-slider","thumbLabel","",3,"selectionChange","step","min","max"],["matSliderThumb","",3,"input","value"],["mat-icon-button","","color","primary",3,"click"]],template:function(n,i){1&n&&(e.DNE(0,Sc,3,2,"div",6)(1,Oc,3,2,"div",6),e.nrm(2,"br"),e.DNE(3,Ec,20,19,"div",7)(4,Dc,10,6,"div",8)),2&n&&(e.Y8G("ngIf","calendar"===i.style&&"year"!==i.type),e.R7$(),e.Y8G("ngIf","calendar"===i.style&&"year"===i.type),e.R7$(2),e.Y8G("ngIf",!i.isRange&&"slider"===i.style&&"year"===i.type),e.R7$(),e.Y8G("ngIf","slider"===i.style&&"year"!==i.type))},dependencies:[o.bT,be.RG,be.rl,be.yw,Sr.AC,Sr.NM,Sr.NI,Sr.Xm,re.WX,Tt.fS,Tt.fg,Q.YN,Q.me,Q.BC,Q.vS,_e.Ve,_e.VO,re.wT,o.pM,re.Sy,qt.Ez,qt.IV,qt.OU,Ft.mV,Ft.sG,v.uc,v.oV,L.Hl,L.iY,R.m_,R.An,y.Ck,P.D9],styles:["[_nghost-%COMP%]   .igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:70%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .date-below[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]})}return l})();const Rc=l=>({cursor:l}),Pc=l=>({disabled:l});function $c(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",10),e.nI1(1,"translate"),e.nI1(2,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.layer.visible=!i.layer.visible)}),e.j41(3,"mat-icon",11),e.nI1(4,"async"),e.EFF(5),e.k0s()()}if(2&l){const t=e.XpG(2);e.Y8G("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.bMT(1,4,"igo.geo.layer.hideLayer"):e.bMT(2,6,"igo.geo.layer.showLayer")),e.R7$(3),e.Y8G("ngClass",e.eq3(10,Pc,!1===e.bMT(4,8,t.inResolutionRange$))),e.R7$(2),e.SpI("",t.layer.visible?"visibility":"visibility_off"," ")}}function Lc(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-list-item")(1,"mat-icon",7),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleFiltersCollapsed())}),e.EFF(2," expand_less "),e.k0s(),e.j41(3,"span",8),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleLegendOnClick())}),e.EFF(4),e.k0s(),e.DNE(5,$c,6,12,"button",9),e.k0s()}if(2&l){const t=e.XpG(),n=e.sdS(2);e.R7$(),e.Y8G("target",n)("collapsed",t.filtersCollapsed),e.R7$(2),e.Y8G("ngStyle",e.eq3(5,Rc,t.filtersCollapsed?"default":"pointer")),e.R7$(),e.JRh(t.layer.title),e.R7$(),e.Y8G("ngIf",t.header)}}function Ac(l,f){if(1&l&&e.nrm(0,"igo-layer-legend",12),2&l){const t=e.XpG();e.Y8G("layer",t.layer)}}let Tr=(()=>{class l{timeFilterService;color="primary";showLegend$=new ce.t(!1);inResolutionRange$=new ce.t(!0);resolution$$;filtersCollapsed=!1;header=!0;layer;get datasource(){return this.layer.dataSource}constructor(t){this.timeFilterService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}handleYearChange(t){this.timeFilterService.filterByYear(this.datasource,t)}handleDateChange(t){this.timeFilterService.filterByDate(this.datasource,t)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}setVisible(){this.layer.visible=!0}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(n){return new(n||l)(e.rXU(x))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},standalone:!0,features:[e.Jv_([x]),e.aNF],decls:8,vars:7,consts:[["filters",""],["legend",""],[4,"ngIf"],[1,"igo-datasource-filters-container"],[1,"igo-layer-legend-container"],[3,"layer",4,"ngIf"],[3,"change","yearChange","layer","options","currentValue"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"click","target","collapsed"],["matListItemTitle","",3,"click","ngStyle"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","color","matTooltip"],[3,"ngClass"],[3,"layer"]],template:function(n,i){if(1&n){const d=e.RV6();e.DNE(0,Lc,6,7,"mat-list-item",2),e.j41(1,"div",3,0)(3,"div",4,1),e.DNE(5,Ac,1,1,"igo-layer-legend",5),e.nI1(6,"async"),e.k0s(),e.j41(7,"igo-time-filter-form",6),e.bIt("change",function(B){return e.eBV(d),e.Njj(i.handleDateChange(B))})("yearChange",function(B){return e.eBV(d),e.Njj(i.handleYearChange(B))}),e.k0s()()}2&n&&(e.Y8G("ngIf",i.header),e.R7$(5),e.Y8G("ngIf",e.bMT(6,5,i.showLegend$)),e.R7$(2),e.Y8G("layer",i.layer)("options",i.datasource.options.timeFilter)("currentValue",i.datasource.options.params.TIME))},dependencies:[o.bT,de.Fg,de.YE,de.ZV,de.yE,de.BJ,R.m_,R.An,ue.Dc,o.B3,L.Hl,L.iY,v.uc,v.oV,o.YU,to,Ua,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}"]})}return l})();function kc(l,f){if(1&l&&(e.j41(0,"button",3),e.nI1(1,"translate"),e.j41(2,"mat-icon",4),e.EFF(3,"history"),e.k0s()()),2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.R7$(2),e.Y8G("matBadge",t.badge)}}function jc(l,f){if(1&l&&e.nrm(0,"igo-time-filter-item",7),2&l){const t=e.XpG(2);e.Y8G("header",!1)("layer",t.layer)}}function Bc(l,f){if(1&l&&(e.j41(0,"div",5,0),e.DNE(2,jc,1,2,"igo-time-filter-item",6),e.k0s()),2&l){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",t.timeFilterCollapse&&t.options.timeFilter)}}let Na=(()=>{class l{options;get badge(){const t=this.options.timeFilter;if(t&&t.enabled)return 1}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header=!0;timeFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.aNF],decls:2,vars:2,consts:[["ogcFilter",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(n,i){1&n&&e.DNE(0,kc,4,5,"button",1)(1,Bc,3,1,"div",2),2&n&&(e.Y8G("ngIf",i.header&&i.options.timeFilterable&&i.options.timeFilter),e.R7$(),e.Y8G("ngIf",i.header&&i.options.timeFilterable&&i.options.timeFilter))},dependencies:[o.bT,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,E.Y,E.k,Tr,s.dF,y.Ck,P.D9],changeDetection:0})}return l})();function Gc(l,f){if(1&l&&e.nrm(0,"igo-time-filter-item",2),2&l){const t=f.$implicit;e.Y8G("header",!0)("layer",t)}}let bs=(()=>{class l{cdRef;get layers(){return this._layers}set layers(t){this._layers=t,this.cdRef.detectChanges()}_layers=[];constructor(t){this.cdRef=t}static \u0275fac=function(n){return new(n||l)(e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},standalone:!0,features:[e.aNF],decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(n,i){1&n&&(e.j41(0,"igo-list",0),e.DNE(1,Gc,1,2,"ng-template",1),e.nI1(2,"filterableDataSource"),e.k0s()),2&n&&(e.Y8G("navigation",!1)("selection",!1),e.R7$(),e.Y8G("ngForOf",e.i5U(2,3,i.layers,"time")))},dependencies:[s.sB,o.pM,Tr,s.dF,an],encapsulation:2,changeDetection:0})}return l})(),Ya=(()=>{class l{mapService;component;layers$$;constructor(t,n){this.mapService=n,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(n){return new(n||l)(e.rXU(bs,2),e.rXU(Ke.u))};static \u0275dir=e.FsC({type:l,selectors:[["","igoTimeFilterListBinding",""]],standalone:!0})}return l})();function Vc(l,f){if(1&l&&(e.j41(0,"button",1),e.nI1(1,"translate"),e.j41(2,"mat-icon"),e.EFF(3,"file_save"),e.k0s()()),2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,2,"igo.geo.download.action"))("color",t.color)}}let Wa=(()=>{class l{get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(){}get options(){if(this.layer)return this.layer.dataSource.options}layerIsExportable(){return!!(this.layer instanceof oe.vK&&!0===this.layer.exportable||this.layer.dataSource.options.download&&this.layer.dataSource.options.download.url||this.layer.options.workspace?.enabled&&this.layer.options.workspace?.workspaceId!==this.layer.id)}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-export-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"]],template:function(n,i){1&n&&e.DNE(0,Vc,4,4,"button",0),2&n&&e.Y8G("ngIf",i.layerIsExportable())},dependencies:[o.bT,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,y.Ck,P.D9],changeDetection:0})}return l})();var Cs=r(28793),Uc=r(73314),ao=r(81681),Et=r(68671),Kn=r(97489),Ss=r(12171),Ir=r(64412);let Ts=(()=>{class l{styleList={};httpClient;constructor(t){this.httpClient=new u.Qq(t)}getStyleList(t){return Et.BF.resolve(this.styleList,t)}load(t){const n=t.default||{};return t.path?new Promise((i,d)=>{this.httpClient.get(t.path).pipe((0,Be.W)(T=>(console.log(`StyleList file ${t.path} could not be read`),i(!0),(0,ot.$)(T.error||"Server error")))).subscribe(T=>{this.styleList=Et.BF.mergeDeep(n,T),i(!0)})}):(this.styleList=n,!0)}static \u0275fac=function(n){return new(n||l)(e.KVO(u.JV))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var qi=r(32780),Nc=r(26035),Yc=r(26847);class Xa extends Error{}class Is extends Xa{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Is.prototype)}}class Fr extends Xa{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,Fr.prototype)}}const vt=(0,Et.Jw)(["URL","GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon"]),Wo=(0,Et.Jw)(["UTF8","LATIN1"]);let Mr=(()=>{class l{config;static ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"};static noOgreFallbacks=["GML","GPX","KML"];ogreUrl;aggregateInComment=!0;constructor(t){this.config=t,this.ogreUrl=this.config.getConfig("importExport.url");const n=this.config.getConfig("importExport.gpxAggregateInComment");void 0!==n&&(this.aggregateInComment=n)}export(t,n,i,d,T="EPSG:4326",B="EPSG:4326"){const me=this.generateFeature(t,n,"_featureStore");return this.exportAsync(me,n,i,d,T,B)}generateFeature(t,n,i="_"){return n===vt.GPX&&this.aggregateInComment?this.generateAggregatedFeature(t):t.map(d=>{let T=d.getKeys().filter(me=>!me.startsWith(i));n===vt.Shapefile&&d.get("_style")&&JSON.stringify(d.get("_style")).length>255&&(T=T.filter(fe=>"_style"!==fe));const B=T.reduce((me,fe)=>(me[fe]=d.get(fe),me),{geometry:d.getGeometry()});return new Wt.A(B)})}generateAggregatedFeature(t){return t.map(n=>{const i=n.getKeys().filter(me=>!me.startsWith("_"));let d="";const T=i.reduce((me,fe)=>(fe&&"geometry"!==fe&&("id"===fe&&n.get("draw")?d+=fe+":"+n.get("draw")+"   \r\n":d+=fe+":"+n.get(fe)+"   \r\n"),me[fe]=n.get(fe),me),{geometry:n.getGeometry()}),B=new Wt.A(T);return B.set("name",n.getId()),B.set("cmt",d),B})}exportAsync(t,n,i,d,T,B){return new Jt.c(fe=>{if(this.nothingToExport(t,n))fe.error(new Fr);else if(Object.keys(l.ogreFormats).indexOf(n)>=0){if(!this.ogreUrl)return void(l.noOgreFallbacks.indexOf(n)>=0?this.exportToFile(t,fe,n,i,T,B):fe.error(new Is));this.exportWithOgre(t,fe,n,i,d,T,B)}else this.exportToFile(t,fe,n,i,T,B)})}exportToFile(t,n,i,d,T,B){const fe=(new Nc[i]).writeFeatures(t,{dataProjection:B,featureProjection:T,featureType:"feature",featureNS:"http://example.com/feature"}),we=`${d}.${i.toLowerCase()}`;(0,Et.e5)(fe,"attachment/plain;charset=utf-8",we),n.complete()}exportWithOgre(t,n,i,d,T,B,me){let fe=(new _o.A).writeFeatures(t,{dataProjection:me,featureProjection:B});const we=`${this.ogreUrl}/convertJson`,Me=document.createElement("form");if(Me.style.display="none",document.body.appendChild(Me),Me.setAttribute("method","post"),Me.setAttribute("target","_blank"),Me.setAttribute("action",we),T===Wo.UTF8)Me.acceptCharset="UTF-8",Me.enctype="application/x-www-form-urlencoded; charset=utf-8;";else if(T===Wo.LATIN1){const bt="ISO-8859-1",Lt=JSON.parse(fe);Lt.features.map(Go=>{const yi=String.fromCharCode.apply(null,(0,Yc.lF)(JSON.stringify(Go.properties),{mode:"replacement"}));Go.properties=JSON.parse(yi)}),fe=JSON.stringify(Lt);const po=document.createElement("input");po.setAttribute("type","hidden"),po.setAttribute("name","encoding"),po.setAttribute("value",bt),Me.appendChild(po)}if("CSVsemicolon"===i){const bt=document.createElement("input");bt.setAttribute("type","hidden"),bt.setAttribute("name","lco"),bt.setAttribute("value","SEPARATOR=SEMICOLON"),Me.appendChild(bt)}const ke=document.createElement("input");ke.setAttribute("type","hidden"),ke.setAttribute("name","json"),ke.setAttribute("value",fe),Me.appendChild(ke);const Je=document.createElement("input");let je="Shapefile"===i?`${d}.zip`:`${d}.${i.toLowerCase()}`;("CSVcomma"===i||"CSVsemicolon"===i)&&(je=`${d}.csv`),je=je.replace(" ","_"),je=je.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\u2019/g,"'"),Je.setAttribute("type","hidden"),Je.setAttribute("name","outputName"),Je.setAttribute("value",je),Me.appendChild(Je);let qe=l.ogreFormats[i];("CSVcomma"===i||"CSVsemicolon"===i)&&(qe="CSV");const lt=document.createElement("input");lt.setAttribute("type","hidden"),lt.setAttribute("name","format"),lt.setAttribute("value",qe),Me.appendChild(lt),Me.submit(),document.body.removeChild(Me),n.complete()}nothingToExport(t,n){return 0===t.length||"GPX"===n&&void 0===t.find(d=>["Point","LineString","MultiLineString"].indexOf(d.getGeometry().getType())>=0)}static \u0275fac=function(n){return new(n||l)(e.KVO(A.we))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Ka=r(34997),Ha=r(21625),za=r(15852);class gi extends Error{}class xr extends gi{constructor(){super("Invalid file"),Object.setPrototypeOf(this,xr.prototype)}}class Hn extends gi{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,Hn.prototype)}}class Or extends gi{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Or.prototype)}}class zc extends gi{constructor(){super("File is too large"),Object.setPrototypeOf(this,Or.prototype)}}class Jc extends gi{constructor(){super("Invalid SRS definition"),Object.setPrototypeOf(this,Or.prototype)}}class Fs extends gi{constructor(){super("Error 500 with OGRE"),Object.setPrototypeOf(this,Fs.prototype)}}var er=r(33864),wr=r(56999);function Er(l){return l.toString().padStart(2,"0")}function Dr(l,f,t,n,i,d,T,B,me){if(0===f.length)return void function ou(l,f){f.error("igo.geo.dropGeoFile.empty.text","igo.geo.dropGeoFile.empty.title",void 0,{value:l.name,mimeType:l.type})}(l,i);let fe=Ms(l);(T?T.open("igo.geo.import.promptStoreToIdb"):(0,Xe.of)(!1)).pipe((0,pi.$)()).subscribe(Me=>{const ke=new Date,Je=[ke.getFullYear(),Er(ke.getMonth()+1),Er(ke.getDate())].join("/")+" "+[Er(ke.getHours()),Er(ke.getMinutes())].join(":");fe=Me?`${fe} (${Je})`:fe,B?function Qc(l,f,t,n,i,d,T,B,me=!0){const fe=l.map(je=>(0,er.xH)(je,f.projection));let we,Me,ke;if(n.getStyleList(t.toString()+".styleByAttribute")){const je=n.getStyleList(t.toString()+".styleByAttribute");we=(qe,lt)=>i.createStyleByAttribute(qe,je,lt)}else if(n.getStyleList(t.toString()+".clusterStyle")){const je=n.getStyleList(t.toString()+".clusterParam");Me=n.getStyleList(t.toString()+".distance"),we=(qe,lt)=>{const bt=i.createStyle(n.getStyleList(t.toString()+".clusterStyle"),qe,lt);return i.createClusterStyle(qe,lt,je,bt)}}else if(n.getStyleList(t.toString()+".style"))we=(je,qe)=>i.createStyle(n.getStyleList(t.toString()+".style"),je,qe);else if(n.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type){const je=n.getStyleList("default.clusterParam");Me=n.getStyleList("default.distance"),we=(qe,lt)=>{const bt=i.createStyle(n.getStyleList("default.clusterStyle"),qe,lt);return i.createClusterStyle(qe,lt,je,bt)}}else we=(je,qe)=>i.createStyle(n.getStyleList("default.style"),je,qe);n.getStyleList(t.toString()+".clusterStyle")?(ke=new Ss.U(Object.assign({distance:Me,type:"cluster",queryable:!0},T)),ke.ol.source.addFeatures(fe)):n.getStyleList(t.toString())?(ke=new In._(Object.assign({type:"vector",queryable:!0},T)),ke.ol.addFeatures(fe)):n.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type?(ke=new Ss.U(Object.assign({distance:Me,type:"cluster",queryable:!0},T)),ke.ol.source.addFeatures(fe)):(ke=new In._(Object.assign({type:"vector",queryable:!0},T)),ke.ol.addFeatures(fe));const Je=new Xn.v(Object.assign({title:t,id:d||(0,Et.uR)(),isIgoInternalLayer:!0,source:ke,style:we},B));f.addLayer(Je),me&&(0,er.p6)(f.viewController,fe)}(f,t,fe,B,me):function Zc(l,f,t,n,i,d=!1){const T=l.map(Je=>(0,er.xH)(Je,f.projection)),B=(0,Et.uR)(),fe=new In._({id:B,type:"vector",queryable:!0});fe.ol.addFeatures(T);let we,Me=!1;T[0].getKeys().includes("_style")||T[0].getKeys().includes("_mapTitle")?we=(0,wr.tp)():(we=(0,wr.l7)(),Me=!0);const ke=i.createLayer({id:B,title:n,workspace:{enabled:!0,searchIndexEnabled:!0},isIgoInternalLayer:!0,source:fe,igoStyle:{editable:Me},idbInfo:{firstLoad:!0,storeToIdb:d,contextUri:t||"*"},style:we});ke.setExtent((0,er.M8)(T,f.viewProjection)),f.addLayer(ke),(0,er.p6)(f.viewController,T)}(f,t,n,fe,d,Me),i.success("igo.geo.dropGeoFile.success.text","igo.geo.dropGeoFile.success.title",void 0,{value:fe})})}function qc(l,f,t){t.error("igo.geo.dropGeoFile.invalid.text","igo.geo.dropGeoFile.invalid.title",void 0,{value:l.name,mimeType:l.type})}function eu(l,f,t){t.error("igo.geo.dropGeoFile.unreadable.text","igo.geo.dropGeoFile.unreadable.title",void 0,{value:l.name})}function tu(l,f,t,n){t.error("igo.geo.dropGeoFile.tooLarge.text","igo.geo.dropGeoFile.tooLarge.title",void 0,{value:l.name,size:n})}function nu(l,f){f.error("igo.geo.dropGeoFile.invalidSRS.text","igo.geo.dropGeoFile.invalidSRS.title",void 0,{value:l.name,mimeType:l.type})}function iu(l,f,t){t.error("igo.geo.dropGeoFile.ogreServer.text","igo.geo.dropGeoFile.ogreServer.title")}function Za(l){return l.name.split(".").pop().toLowerCase()}function Ms(l){return l.name.substr(0,l.name.lastIndexOf("."))}let Qa=(()=>{class l{http;config;static formatExtensionAssociation={GeoJSON:"geojson",GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"zip"};static allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"];static allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"];static allowedExtensions=["geojson","kml","gpx","json","gml","zip"];ogreUrl;clientSideFileSizeMax;constructor(t,n){this.http=t,this.config=n;const i=this.config.getConfig("importExport");this.ogreUrl=i.url,this.clientSideFileSizeMax=(i.clientSideFileSizeMaxMb||30)*Math.pow(1024,2),i.formats&&(l.allowedExtensions=i.formats.map(T=>l.formatExtensionAssociation[T]).filter(T=>T),l.allowedExtensions.includes("geojson")&&l.allowedExtensions.push("json"))}import(t,n="EPSG:4326",i="EPSG:4326"){return this.importAsync(t,n,i)}getFileImporter(t){const n=Za(t),i=l.allowedExtensions;let d=[];i.includes("zip")&&(d=l.allowedZipMimeTypes);const T=t.type;if(!([...l.allowedMimeTypes,...d].indexOf(T)<0&&i.indexOf(n)<0)){if("application/json"===T||["json","geojson","kml","gpx"].indexOf(n)>=0)return this.importFile;if(void 0!==this.ogreUrl)return this.importFileWithOgre}}importAsync(t,n,i){return new Jt.c(T=>{if(t.size>=this.clientSideFileSizeMax)return void T.error(new zc);const B=this.getFileImporter(t);void 0!==B?B.call(this,t,T,n,i):T.error(new xr)})}importFile(t,n,i,d){const T=new FileReader;T.onload=B=>{try{const me=this.parseFeaturesFromFile(t,B.target.result,i,d);n.next(me)}catch{n.error(new Hn)}n.complete()},T.onerror=B=>{n.error(new Hn)},T.readAsText(t,"UTF-8")}importFileWithOgre(t,n,i,d){const T=`${this.ogreUrl}/convert`,B=new FormData;B.append("upload",t),B.append("sourceSrs",i),B.append("targetSrs",d),B.append("formatOutput","GEOJSON"),B.append("skipFailures",""),this.http.post(T,B,{headers:new u.Lr}).subscribe(me=>{if(null!==me)if((me.errors||[]).length>0)n.error(new Hn);else{const we=this.parseFeaturesFromGeoJSON(t,me,d);n.next(we),n.complete()}else n.error(new Hn)},me=>{me.error.caught=!0;const fe=me.error.msg||"";"No valid files found"===fe?n.error(new xr):fe&&fe.startWith("ERROR 1: Failed to process SRS definition")?n.error(new Jc):n.error(500===me.status?new Fs:new Hn)})}parseFeaturesFromFile(t,n,i,d){const T=Za(t),B=t.type,me=new _o.A;let fe;if("application/vnd.google-earth.kml+xml"===B)fe=new Ka.Ay;else if("application/gml+xml"===B)fe=new Ha.A;else if("application/gpx+xml"===B)fe=new za.A;else switch(T){case"kml":fe=new Ka.Ay;break;case"gpx":fe=new za.A;break;case"gml":fe=new Ha.A;break;default:fe=me}return fe.readFeatures(n,{dataProjection:i,featureProjection:d}).map(ke=>Object.assign(me.writeFeatureObject(ke),{projection:d,meta:{id:(0,Et.uR)(),title:Ms(t)}}))}parseFeaturesFromGeoJSON(t,n,i){const d=new _o.A;return d.readFeatures(n).map(me=>Object.assign(d.writeFeatureObject(me),{projection:i,meta:{id:(0,Et.uR)(),title:Ms(t)}}))}static \u0275fac=function(n){return new(n||l)(e.KVO(u.Qq),e.KVO(A.we))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();const ru=l=>({size:l}),su=l=>({"igo-export-layer-mat-option":l});function au(l,f){if(1&l&&(e.j41(0,"p",16),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",e.i5U(2,1,"igo.geo.importExportForm.projections."+t.translateKey,t)," ")}}function lu(l,f){if(1&l&&(e.j41(0,"p",16),e.EFF(1),e.k0s()),2&l){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.alias," ")}}function cu(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-option",14),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.DNE(1,au,3,4,"p",15)(2,lu,2,1,"p",15),e.k0s()}if(2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.Y8G("ngIf",t.translateKey),e.R7$(),e.Y8G("ngIf",!t.translateKey)}}function uu(l,f){if(1&l){const t=e.RV6();e.j41(0,"form",6)(1,"div",7)(2,"mat-form-field")(3,"mat-label"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"mat-select",8),e.mxI("valueChange",function(i){e.eBV(t);const d=e.XpG();return e.DH7(d.inputProj,i)||(d.inputProj=i),e.Njj(i)}),e.DNE(7,cu,3,3,"mat-option",9),e.nI1(8,"async"),e.k0s()()(),e.j41(9,"div",10),e.nI1(10,"translate"),e.nI1(11,"translate"),e.j41(12,"button",11),e.nI1(13,"async"),e.bIt("click",function(){e.eBV(t);const i=e.sdS(19);return e.Njj(i.click())}),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.nrm(16,"igo-spinner",12),e.nI1(17,"async"),e.j41(18,"input",13,0),e.bIt("click",function(){e.eBV(t);const i=e.sdS(19);return e.Njj(i.value=null)})("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.importFiles(i.target.files))}),e.k0s()()()}if(2&l){const t=e.XpG();e.Y8G("formGroup",t.importForm),e.R7$(4),e.JRh(e.bMT(5,10,"igo.geo.importExportForm.importProjPlaceholder")),e.R7$(2),e.R50("value",t.inputProj),e.R7$(),e.Y8G("ngForOf",e.bMT(8,12,t.projections$)),e.R7$(2),e.Y8G("matTooltip",t.importForm.invalid?e.bMT(10,14,"igo.geo.importExportForm.projections.choose"):e.bMT(11,16,"igo.geo.importExportForm.importButton")),e.R7$(3),e.Y8G("disabled",t.importForm.invalid||e.bMT(13,18,t.loading$)),e.R7$(2),e.SpI(" ",e.bMT(15,20,"igo.geo.importExportForm.importButton")," "),e.R7$(2),e.Y8G("shown",e.bMT(17,22,t.loading$)),e.R7$(2),e.xc7("display","none")}}function pu(l,f){if(1&l&&(e.j41(0,"div")(1,"h4"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"ul")(5,"li"),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"li"),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"li"),e.EFF(12),e.nI1(13,"translate"),e.k0s()()()),2&l){const t=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,4,"igo.geo.importExportForm.importClarifications")),e.R7$(4),e.SpI(" ",e.i5U(7,6,"igo.geo.importExportForm.importSizeMax",e.eq3(13,ru,t.fileSizeMb))," "),e.R7$(3),e.SpI(" ",e.bMT(10,9,"igo.geo.importExportForm.importFormatAuthorized")," "),e.R7$(3),e.JRh(e.bMT(13,11,"igo.geo.importExportForm.importShpZip"))}}function du(l,f){if(1&l&&e.nrm(0,"igo-custom-html",20),2&l){const t=e.XpG(2);e.Y8G("html",t.importHtmlClarifications)}}function mu(l,f){if(1&l&&(e.j41(0,"section",17),e.DNE(1,pu,14,15,"div",18)(2,du,1,1,"igo-custom-html",19),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf",""===t.importHtmlClarifications),e.R7$(),e.Y8G("ngIf",""!==t.importHtmlClarifications)}}function gu(l,f){1&l&&(e.j41(0,"section",17)(1,"h4"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function hu(l,f){if(1&l&&(e.j41(0,"span",31),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=e.XpG(2);e.R7$(),e.Lme(" (+",t.layers.length-1," ",e.bMT(2,2,2===(null==t.layers?null:t.layers.length)?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function fu(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-slide-toggle",34),e.bIt("click",function(i){e.eBV(t);const d=e.XpG().$implicit,T=e.XpG(2);return e.Njj(T.onlySelectedClick(i,d.id))})("checked",function(){e.eBV(t);const i=e.XpG().$implicit,d=e.XpG(2);return e.Njj(d.inLayersIdToExportSelectionOnly(i))})("change",function(i){e.eBV(t);const d=e.XpG().$implicit,T=e.XpG(2);return e.Njj(T.onlySelected(i,d.id))}),e.j41(1,"small"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()}2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"igo.geo.importExportForm.exportSelectedFeature")))}function _u(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-option",32),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.j41(1,"p",16),e.EFF(2),e.k0s(),e.j41(3,"p",16),e.DNE(4,fu,4,3,"mat-slide-toggle",33),e.k0s()()}if(2&l){const t=f.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(4,su,n.layerHasSelectedFeatures(t)))("value",t.id),e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("ngIf",n.layerHasSelectedFeatures(t))}}function yu(l,f){if(1&l&&(e.j41(0,"mat-option",3),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.export.format."+t.value)," ")}}function vu(l,f){if(1&l&&(e.qex(0),e.DNE(1,yu,3,4,"mat-option",35),e.nI1(2,"async"),e.nI1(3,"keyvalue"),e.bVm()),2&l){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",e.bMT(3,3,e.bMT(2,1,t.formats$)))}}function bu(l,f){1&l&&(e.j41(0,"mat-option",36),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.export.noFormat.title")," "))}function Cu(l,f){1&l&&(e.j41(0,"div",7)(1,"mat-form-field"),e.nrm(2,"input",37),e.nI1(3,"translate"),e.k0s()()),2&l&&(e.R7$(2),e.FS9("placeholder",e.bMT(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function Su(l,f){if(1&l&&(e.j41(0,"mat-option",3),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.export.encoding."+t.value)," ")}}function Tu(l,f){if(1&l&&(e.qex(0),e.DNE(1,Su,3,4,"mat-option",35),e.nI1(2,"async"),e.nI1(3,"keyvalue"),e.bVm()),2&l){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",e.bMT(3,3,e.bMT(2,1,t.encodings$)))}}function Iu(l,f){if(1&l&&(e.j41(0,"div",7)(1,"mat-form-field")(2,"mat-label"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"mat-select",38),e.DNE(6,Tu,4,5,"ng-container",18),e.nI1(7,"async"),e.k0s()()()),2&l){const t=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,2,"igo.geo.importExportForm.encodingPlaceholder")),e.R7$(3),e.Y8G("ngIf",0!==e.bMT(7,4,t.encodings$).length)}}function Fu(l,f){1&l&&(e.j41(0,"div",39)(1,"mat-slide-toggle",40),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&l&&(e.R7$(),e.Y8G("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function Mu(l,f){1&l&&(e.j41(0,"div",41)(1,"mat-slide-toggle",42),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&l&&(e.R7$(),e.Y8G("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function xu(l,f){1&l&&(e.j41(0,"div",43)(1,"mat-slide-toggle",44),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&l&&(e.R7$(),e.Y8G("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function Ou(l,f){if(1&l&&e.nrm(0,"igo-custom-html",20),2&l){const t=e.XpG(2);e.Y8G("html",t.exportHtmlClarifications)}}function wu(l,f){if(1&l){const t=e.RV6();e.j41(0,"form",6)(1,"div",7)(2,"mat-form-field")(3,"mat-label"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"mat-select",21),e.mxI("valueChange",function(i){e.eBV(t);const d=e.XpG();return e.DH7(d.layers,i)||(d.layers=i),e.Njj(i)}),e.j41(7,"mat-select-trigger"),e.EFF(8),e.DNE(9,hu,3,4,"span",22),e.k0s(),e.DNE(10,_u,5,6,"mat-option",23),e.nI1(11,"async"),e.k0s()()(),e.j41(12,"div",7)(13,"mat-form-field")(14,"mat-label"),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.j41(17,"mat-select",24),e.DNE(18,vu,4,5,"ng-container",18),e.nI1(19,"async"),e.DNE(20,bu,3,3,"mat-option",25),e.nI1(21,"async"),e.k0s()()(),e.DNE(22,Cu,4,3,"div",26)(23,Iu,8,6,"div",26)(24,Fu,4,4,"div",27)(25,Mu,4,4,"div",28)(26,xu,4,4,"div",29),e.j41(27,"div",30)(28,"button",11),e.nI1(29,"async"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.handleExportFormSubmit(i.form.value))}),e.EFF(30),e.nI1(31,"translate"),e.nI1(32,"translate"),e.nI1(33,"translate"),e.k0s(),e.nrm(34,"igo-spinner",12),e.nI1(35,"async"),e.k0s(),e.DNE(36,Ou,1,1,"igo-custom-html",19),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("formGroup",t.form),e.R7$(4),e.JRh(e.bMT(5,18,"igo.geo.importExportForm.exportLayerPlaceholder")),e.R7$(2),e.R50("value",t.layers),e.R7$(2),e.SpI(" ",t.layers.length?t.getLayerTitleById(t.layers[0]):""," "),e.R7$(),e.Y8G("ngIf",t.layers.length>1),e.R7$(),e.Y8G("ngForOf",e.bMT(11,20,t.exportableLayers$)),e.R7$(5),e.JRh(e.bMT(16,22,"igo.geo.importExportForm.exportFormatPlaceholder")),e.R7$(3),e.Y8G("ngIf",0!==e.bMT(19,24,t.formats$).length),e.R7$(2),e.Y8G("ngIf",0===e.bMT(21,26,t.formats$).length),e.R7$(2),e.Y8G("ngIf",t.forceNaming&&"URL"!==t.form.value.format),e.R7$(),e.Y8G("ngIf","CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format),e.R7$(),e.Y8G("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)),e.R7$(),e.Y8G("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)&&t.form.value.combineLayers),e.R7$(),e.Y8G("ngIf","URL"!==t.form.value.format),e.R7$(2),e.Y8G("disabled",!t.form.valid||e.bMT(29,28,t.loading$)),e.R7$(2),e.SpI(" ","URL"!==t.form.value.format?e.bMT(31,30,"igo.geo.importExportForm.exportButton"):t.form.value.layers.length>1?e.bMT(32,32,"igo.geo.importExportForm.exportButtonLinks"):e.bMT(33,34,"igo.geo.importExportForm.exportButtonLink")," "),e.R7$(4),e.Y8G("shown",e.bMT(35,36,t.loading$)),e.R7$(2),e.Y8G("ngIf",""!==t.exportHtmlClarifications)}}let qa=(()=>{class l{importService;exportService;languageService;messageService;styleListService;styleService;formBuilder;config;cdRef;storageService;downloadService;layerService;confirmDialogService;form;importForm;formats$=new ce.t(void 0);encodings$=new ce.t(void 0);exportableLayers$=new ce.t([]);loading$=new ce.t(!1);forceNaming=!1;controlFormat="format";layers$$;exportableLayers$$;formats$$;encodings$$;formLayer$$;exportOptions$$;importHtmlClarifications;exportHtmlClarifications;espgCodeRegex=new RegExp("^\\d{4,6}");clientSideFileSizeMax;fileSizeMb;projections$=new ce.t([]);projectionsConstraints;popupChecked=!1;previousLayerSpecs$=new ce.t(void 0);selectFirstProj=!1;map;contextUri;_projectionsLimitations={};set projectionsLimitations(t){this._projectionsLimitations=t,this.computeProjections()}get projectionsLimitations(){return this._projectionsLimitations||{}}store;selectedMode="import";selectMode=new e.bkB;exportOptions$=new ce.t(void 0);exportOptionsChange=new e.bkB;get layers(){return this.form.get("layers").value}set layers(t){this.form.patchValue({layers:t})}get inputProj(){return this.importForm.get("inputProj").value}set inputProj(t){this.importForm.patchValue({inputProj:t})}get popupAllowed(){return this.storageService.get("importExportPopupAllowed")||!1}set popupAllowed(t){this.storageService.set("importExportPopupAllowed",t)}constructor(t,n,i,d,T,B,me,fe,we,Me,ke,Je,je){this.importService=t,this.exportService=n,this.languageService=i,this.messageService=d,this.styleListService=T,this.styleService=B,this.formBuilder=me,this.config=fe,this.cdRef=we,this.storageService=Me,this.downloadService=ke,this.layerService=Je,this.confirmDialogService=je,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}ngOnInit(){this.layers$$=this.map.layers$.subscribe(n=>{this.exportableLayers$.next(n.filter(i=>i instanceof Xn.v&&!0===i.exportable||i.dataSource.options.download&&i.dataSource.options.download.url))});const t=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(t||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe((0,Kn.j)(n=>!n)).subscribe(n=>{this.form.patchValue(n,{emitEvent:!0}),n.layers&&this.computeFormats(n.layers.map(i=>this.map.getLayerById(i)))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(n=>{const i=Object.keys(Mr.ogreFormats);!this.popupChecked&&this.form.get("layers").value?.length>1&&(i.indexOf(n)>=0||n===vt.URL)&&(this.handlePopup(!0)||this.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(n=>{this.handlePreviousLayerSpecs();const i=n instanceof Array?n:[n];this.form.patchValue({layers:i},{emitEvent:!1});const d=i.map(B=>this.map.getLayerById(B));this.computeFormats(d),-1===Object.keys(this.formats$.value).indexOf(this.form.value.format)&&this.form.patchValue({format:void 0}),this.loading$.next(!0);const T=[];d.forEach(B=>{B instanceof Xn.v&&0===B.dataSource.ol.getFeatures().length&&(T.push({id:B.id,visible:B.visible,opacity:B.opacity,queryable:B.queryable}),B.opacity=0,B.visible=!0)}),this.previousLayerSpecs$.next(T),setTimeout(()=>{this.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe((0,Kn.j)(n=>!n)).subscribe(n=>{1===Object.keys(n).length&&this.form.patchValue({format:n[Object.keys(n)[0]]})}),this.encodings$$=this.encodings$.pipe((0,Kn.j)(n=>!n)).subscribe(n=>{1===Object.keys(n).length&&this.form.patchValue({encoding:n[Object.keys(n)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe((0,Kn.j)(n=>!n)).subscribe(n=>{1===n.length&&this.form.patchValue({layers:n[0].id})}),this.form.controls[this.controlFormat].valueChanges.subscribe(n=>{this.form.patchValue(n===vt.CSVcomma||n===vt.CSVsemicolon?{encoding:Wo.LATIN1}:{encoding:Wo.UTF8}),this.cdRef.detectChanges()}),this.importForm.patchValue(this.selectFirstProj?0===this.projections$.value.length?{inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}:{inputProj:this.projections$.value[0]}:{inputProj:void 0})}computeProjections(){this.projectionsConstraints=(0,di.A5)(this.projectionsLimitations);const t=[];if(this.projectionsConstraints.nad83&&t.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.wgs84&&t.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.webMercator&&t.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.mtm){const d=this.projectionsConstraints.mtmZone.maxZone;for(let T=this.projectionsConstraints.mtmZone.minZone;T<=d;T++)t.push({translateKey:"mtm",alias:`MTM ${T}`,code:T<10?`EPSG:3218${T}`:`EPSG:321${80+T}`,zone:`${T}`,extent:void 0,def:void 0})}if(this.projectionsConstraints.utm){const d=this.projectionsConstraints.utmZone.maxZone;for(let T=this.projectionsConstraints.utmZone.minZone;T<=d;T++)t.push({translateKey:"utm",alias:`UTM ${T}`,code:T<10?`EPSG:3260${T}`:`EPSG:326${T}`,zone:`${T}`,extent:void 0,def:void 0})}let n=[];this.projectionsConstraints.projFromConfig&&(n=this.config.getConfig("projections")||[]),this.projections$.next(n.concat(t))}getWorkspaceByLayerId(t){const n=this.store.all().find(i=>i.layer.id===t);if(n)return n}getLayerTitleById(t){return this.map.getLayerById(t)?.title}layerHasSelectedFeatures(t){const n=this.getWorkspaceByLayerId(t.id);if(n)return!!n.entityStore.stateView.firstBy(d=>!0===d.state.selected)}onlySelected(t,n){let i=this.form.value.layersWithSelection;t.checked?i.push(n):i=i.filter(d=>d!==n),this.form.patchValue({layersWithSelection:i})}onlySelectedClick(t,n){this.form.value.layers.find(i=>i===n)&&t.stopPropagation()}inLayersIdToExportSelectionOnly(t){return!!this.form.value.layersWithSelection.find(n=>n===t.id)}ngOnDestroy(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.encodings$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}handlePreviousLayerSpecs(){const t=this.previousLayerSpecs$.value;t&&t.length&&t.forEach(n=>{const i=this.map.getLayerById(n.id);i.visible=n.visible,i.opacity=n.opacity,i.queryable=n.queryable}),this.previousLayerSpecs$.next(void 0)}importFiles(t){let n=this.inputProj.code;this.espgCodeRegex.test(n)&&(n=`EPSG:${n}`),this.loading$.next(!0);for(const i of t)this.importService.import(i,n).subscribe(d=>this.onFileImportSuccess(i,d),d=>this.onFileImportError(i,d),()=>{this.loading$.next(!1)})}handlePopup(t=!0){window.open("","popup","width=1, height=1").close();const i=window.open("","popup","width=1, height=1");return!i||i.closed||typeof i.closed>"u"||null===i?(this.onPopupBlockedError(t),this.popupAllowed=!1):(i.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}handleExportFormSubmit(t){this.loading$.next(!0);const n=Object.keys(Mr.ogreFormats);!this.popupChecked&&t.layers.length>1&&(n.indexOf(t.format)>=0||t.format===vt.URL)&&!this.popupAllowed&&this.handlePopup();let i=[],d=[],T="";for(const[B,me]of t.layers.entries()){const fe=this.map.getLayerById(me);t.format!==vt.CSVsemicolon&&t.format!==vt.CSVcomma||!t.combineLayers||1===t.layers.length?(T=fe.title,t.name&&(T=t.name)):T=this.languageService.translate.instant("igo.geo.export.combinedLayers");const we=fe.dataSource.options;if(t.format===vt.URL&&we.download&&(we.download.url||we.download.dynamicUrl))return void setTimeout(()=>{const je=we.download.url||we.download.dynamicUrl;je.match(/service=wfs/gi)?this.downloadService.open(fe):window.open(je,"_blank"),this.loading$.next(!1)},500);const Me=this.getWorkspaceByLayerId(me);let ke;if(Me&&Me.entityStore&&Me.entityStore.stateView.all().length)ke=-1!==t.layersWithSelection.indexOf(me)&&t.featureInMapExtent?Me.entityStore.stateView.all().filter(je=>je.state.inMapExtent&&je.state.selected).map(je=>je.entity.ol):-1===t.layersWithSelection.indexOf(me)||t.featureInMapExtent?t.featureInMapExtent?Me.entityStore.stateView.all().filter(je=>je.state.inMapExtent).map(je=>je.entity.ol):Me.entityStore.stateView.all().map(je=>je.entity.ol):Me.entityStore.stateView.all().filter(je=>je.state.selected).map(je=>je.entity.ol);else{const je=fe.dataSource.ol;ke=t.featureInMapExtent?je.getFeaturesInExtent(fe.map.viewController.getExtent()):je.getFeatures(),fe.dataSource instanceof Ss.U&&(ke=ke.flatMap(qe=>qe.get("features")))}let Je=[];if(t.format===vt.Shapefile||t.format===vt.GPX?ke.forEach(je=>{const qe=je.getGeometry().getType(),lt=Je.find(bt=>bt.geometryType===qe);lt?lt.features.push(je):Je.push({geometryType:qe,features:[je]})}):Je=[{geometryType:"",features:ke}],Je.forEach(je=>{je.features.forEach(qe=>{const lt=qe.get("rad");if(lt){const bt=[qe.get("longitude"),qe.get("latitude")],Lt=(0,Wn.kj)(bt,lt,500);Lt.transform("EPSG:4326",qe.get("_projection")),qe.setGeometry(Lt)}})}),t.format===vt.GPX){const je=Je.length;Je=Je.filter(lt=>["LineString","Point"].includes(lt.geometryType)),je>Je.length&&this.messageService.error("igo.geo.export.gpx.error.poly.text","igo.geo.export.gpx.error.poly.title",{timeOut:2e4})}else if((t.format===vt.CSVsemicolon||t.format===vt.CSVcomma)&&t.combineLayers){if(Je.forEach(je=>i.push(je)),B!==t.layers.length-1)continue;{let je;i.forEach(qe=>{qe.features.forEach(lt=>{if(t.separator)if(je){if(lt.get("_featureStore").layer.options.title!==je.get("_featureStore").layer.options.title){const bt=this.createTitleEmptyRows(je,lt);d.push(bt[2]),d.push(bt[0]),d.push(bt[1])}}else{const bt=this.createTitleEmptyRows(lt,lt);d.push(bt[0])}d.push(lt),je=lt})})}}0===Je.length?(this.loading$.next(!1),this.messageService.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title",{timeOut:2e4})):(t.format!==vt.CSVsemicolon&&t.format!==vt.CSVcomma||!t.combineLayers)&&Je.map(je=>this.exportService.export(je.features,t.format,T+je.geometryType,t.encoding,this.map.projection).subscribe(()=>{},qe=>this.onFileExportError(qe),()=>{this.onFileExportSuccess(),je.features.forEach(qe=>{this.circleToPoint(qe)}),this.loading$.next(!1)}))}(t.format===vt.CSVsemicolon||t.format===vt.CSVcomma)&&t.combineLayers&&this.exportService.export(d,t.format,T,t.encoding,this.map.projection).subscribe(()=>{},B=>this.onFileExportError(B),()=>{this.onFileExportSuccess(),d.forEach(B=>{this.circleToPoint(B)}),this.loading$.next(!1)})}createTitleEmptyRows(t,n){const i=n.clone(),d=n.clone(),T=n.clone(),B=t.getKeys();let me="";for(const je in B)if("geometry"!==B[je]){me=B[je];break}const fe=n.getKeys();let we="";for(const je in fe)if("geometry"!==fe[je]){we=fe[je];break}const Me=n.getKeys();B.forEach(je=>{Me.includes(je)&&je!==me&&Me.push(je)}),Me.unshift(me);let ke="";for(const je in Me)if("geometry"!==Me[je]){ke=Me[je];break}return Me.forEach(je=>{const qe=B.length===fe.length&&B.every((lt,bt)=>lt===fe[bt]);je!==ke||qe?je===ke&&qe||je===we?(i.set(je,n.get("_featureStore").layer.options.title,!0),d.set(je,je,!0),T.unset(je,!0)):"geometry"!==je?(i.unset(je,!0),d.set(je,je,!0),T.unset(je,!0)):(i.unset(je,!0),T.unset(je,!0)):(i.set(je,n.get("_featureStore").layer.options.title+" ===============>",!0),d.set(je,je,!0),T.unset(je,!0)),fe.includes(je)||d.unset(je,!0)}),[i,d,T]}circleToPoint(t){if(t.get("rad")){const i=new Yn.A([t.get("longitude"),t.get("latitude")]);i.transform("EPSG:4326",t.get("_projection")),t.setGeometry(i)}}buildForm(){this.importForm=this.formBuilder.group({inputProj:["",[Q.k0.required]]}),this.form=this.formBuilder.group(this.forceNaming?{format:["",[Q.k0.required]],layers:[[],[Q.k0.required]],layersWithSelection:[[]],encoding:[Wo.UTF8,[Q.k0.required]],combineLayers:[!0,[Q.k0.required]],separator:[!1,[Q.k0.required]],featureInMapExtent:[!1,[Q.k0.required]],name:["",[Q.k0.required]]}:{format:["",[Q.k0.required]],layers:[[],[Q.k0.required]],layersWithSelection:[[]],encoding:[Wo.UTF8,[Q.k0.required]],combineLayers:[!0,[Q.k0.required]],separator:[!1,[Q.k0.required]],featureInMapExtent:[!1,[Q.k0.required]]})}onFileImportSuccess(t,n){const i=this.config.getConfig("importExport"),d=i?.allowToStoreLayer?this.confirmDialogService:void 0;i?.importWithStyle?Dr(t,n,this.map,this.contextUri,this.messageService,this.layerService,d,this.styleListService,this.styleService):Dr(t,n,this.map,this.contextUri,this.messageService,this.layerService,d)}onFileImportError(t,n){this.loading$.next(!1),function Ja(l,f,t,n){({"Invalid file":qc,"File is too large":tu,"Failed to read file":eu,"Invalid SRS definition":nu,"Error 500 with OGRE":iu})[f.message](l,f,t,n=n||30)}(t,n,this.messageService,this.fileSizeMb)}onPopupBlockedError(t=!0){this.loading$.next(!1),this.messageService.error("igo.geo.export.popupBlocked.text","igo.geo.export.popupBlocked.title",{timeOut:2e4},{extraMessage:t?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry"})}onFileExportError(t){this.loading$.next(!1),function Xc(l,f){l instanceof Fr?function Hc(l){l.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title")}(f):f.error("igo.geo.export.failed.text","igo.geo.export.failed.title")}(t,this.messageService)}loadConfig(){const t=this.config.getConfig("importExport.forceNaming");this.forceNaming=void 0!==t&&t,this.computeFormats(),this.loadEncodings()}encodingDefaultValue(t){return t===vt.CSVcomma||t===vt.CSVsemicolon?(this.form.patchValue({encoding:Wo.LATIN1}),Wo.LATIN1):(this.form.patchValue({encoding:Wo.UTF8}),Wo.UTF8)}loadEncodings(){this.encodings$.next(Wo)}computeFormats(t){let n=Object.keys(vt);const i={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},d=[];if(t&&t.length)if(t.forEach(B=>{B&&(B.dataSource.options.download?.allowedFormats?(i.customList=!0,d.push({layer:B.title,formats:this.validateListFormat(B.dataSource.options.download.allowedFormats)})):B instanceof Xn.v||!B.dataSource.options.download||!B.dataSource.options.download.url?B.dataSource.options.download&&(B.dataSource.options.download.url||B.dataSource.options.download.dynamicUrl)?i.vectorAndUrl=!0:B instanceof Xn.v&&(i.onlyVector=!0):i.onlyUrl=!0)}),!0===i.onlyUrl&&!1===i.onlyVector)n=["URL"];else if(!0===i.onlyVector&&!1===i.onlyUrl)this.computeFormats(),vt.URL in this.formats$.value&&(n=Object.keys(this.formats$.value).filter(me=>"URL"!==me));else if(!0===i.vectorAndUrl&&!1===i.onlyUrl&&!1===i.onlyVector&&(this.computeFormats(),!(vt.URL in this.formats$.value))){const B=Object.keys(this.formats$.value);B.push("URL"),n=B}const T=this.config.getConfig("importExport.formats");if(T){const B=this.validateListFormat(T);n=n.filter(me=>B.includes(me))}if(i.customList){let B;const me=[];let fe=d[0].formats;d.map(Me=>{me.push(Me.layer),B=Me.formats.filter(ke=>fe.includes(ke)),fe=Me.formats});const we=B.filter(Me=>n.includes(Me));we.length>0?(this.formats$.next((0,Et.Jw)(we)),t&&t.length&&t.length>1&&this.messageService.alert("igo.geo.export.customList.text","igo.geo.export.customList.title",void 0,{value:me.join()})):(this.formats$.next([]),this.messageService.alert("igo.geo.export.noFormat.text","igo.geo.export.noFormat.title"))}else this.formats$.next((0,Et.Jw)(n))}validateListFormat(t){return t.filter(n=>{if(n.toUpperCase()===vt.CSVcomma.toUpperCase()||n.toUpperCase()===vt.CSVsemicolon.toUpperCase()||n.toUpperCase()===vt.GML.toUpperCase()||n.toUpperCase()===vt.GPX.toUpperCase()||n.toUpperCase()===vt.GeoJSON.toUpperCase()||n.toUpperCase()===vt.KML.toUpperCase()||n.toUpperCase()===vt.Shapefile.toUpperCase()||n.toUpperCase()===vt.URL.toUpperCase())return n}).map(n=>n.toUpperCase()===vt.CSVcomma.toUpperCase()?n=vt.CSVcomma:n.toUpperCase()===vt.CSVsemicolon.toUpperCase()?n=vt.CSVsemicolon:n.toUpperCase()===vt.GML.toUpperCase()?n=vt.GML:n.toUpperCase()===vt.GPX.toUpperCase()?n=vt.GPX:n.toUpperCase()===vt.GeoJSON.toUpperCase()?n=vt.GeoJSON:n.toUpperCase()===vt.KML.toUpperCase()?n=vt.KML:n.toUpperCase()===vt.Shapefile.toUpperCase()?n=vt.Shapefile:n.toUpperCase()===vt.URL.toUpperCase()?n=vt.URL:void 0)}modeChanged(t){this.selectMode.emit(t)}onFileExportSuccess(){!function Kc(l){l.success("igo.geo.export.success.text","igo.geo.export.success.title")}(this.messageService)}onImportExportChange(t){this.selectedMode=t.value}static \u0275fac=function(n){return new(n||l)(e.rXU(Qa),e.rXU(Mr),e.rXU(y.gw),e.rXU(k.bg),e.rXU(Ts),e.rXU(qi.J),e.rXU(Q.ze),e.rXU(A.we),e.rXU(e.gRc),e.rXU(ao.n$),e.rXU(j),e.rXU(Ir.B),e.rXU(Cs.gw))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",contextUri:"contextUri",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},standalone:!0,features:[e.Jv_([Cs.gw]),e.aNF],decls:14,vars:17,consts:[["fileInput",""],[1,"import-export-toggle","mat-typography"],[3,"change","value"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],["class","mat-typography",4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"valueChange","value"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"click","disabled"],[3,"shown"],["hidden","","type","file",3,"click","change"],[3,"click","value"],["matListItemTitle","",4,"ngIf"],["matListItemTitle",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["multiple","",3,"valueChange","value"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-combine-layers mat-typography",4,"ngIf"],["class","export-separator mat-typography",4,"ngIf"],["class","export-options mat-typography",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"click","ngClass","value"],[3,"click","checked","change",4,"ngIf"],[3,"click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","encoding"],[1,"export-combine-layers","mat-typography"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator","mat-typography"],["formControlName","separator",3,"labelPosition"],[1,"export-options","mat-typography"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(n,i){1&n&&(e.j41(0,"div",1)(1,"mat-button-toggle-group",2),e.bIt("change",function(T){return i.onImportExportChange(T)}),e.j41(2,"mat-button-toggle",3),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"mat-button-toggle",3),e.EFF(6),e.nI1(7,"translate"),e.k0s()()(),e.DNE(8,uu,20,24,"form",4)(9,mu,3,2,"section",5)(10,gu,4,3,"section",5),e.nI1(11,"async"),e.DNE(12,wu,37,38,"form",4),e.nI1(13,"async")),2&n&&(e.R7$(),e.Y8G("value",i.selectedMode),e.R7$(),e.Y8G("value","import"),e.R7$(),e.SpI(" ",e.bMT(4,9,"igo.geo.importExportForm.importTabTitle")," "),e.R7$(2),e.Y8G("value","export"),e.R7$(),e.SpI(" ",e.bMT(7,11,"igo.geo.importExportForm.exportTabTitle")," "),e.R7$(2),e.Y8G("ngIf","import"===i.selectedMode),e.R7$(),e.Y8G("ngIf","import"===i.selectedMode),e.R7$(),e.Y8G("ngIf",0===e.bMT(11,13,i.exportableLayers$).length&&"export"===i.selectedMode),e.R7$(2),e.Y8G("ngIf",e.bMT(13,15,i.exportableLayers$).length>0&&"export"===i.selectedMode))},dependencies:[ge.Vg,ge.ec,ge.pc,o.bT,Q.YN,Q.qT,Q.me,Q.BC,Q.cb,Q.X1,Q.j4,Q.JD,be.RG,be.rl,be.nJ,_e.Ve,_e.VO,_e.$2,re.wT,o.pM,re.Sy,v.uc,v.oV,L.Hl,L.$z,Uc.tI,Le.gE,o.YU,Ft.mV,Ft.sG,Tt.fS,Tt.fg,o.Jj,o.lG,y.Ck,P.D9],styles:["[_nghost-%COMP%]   mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:15px 5px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}[_nghost-%COMP%]   igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}"]})}return l})();r(51903);var xs=r(42449);r(64259);var el=r(69576),Pu=r(87716),un=r(88363);const tl=l=>({disabled:l});function $u(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-checkbox",10),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.check())}),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("checked",t.layerCheck)}}function Lu(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",11),e.nI1(1,"translate"),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.toggleVisibility(i))}),e.j41(2,"mat-icon",12),e.nI1(3,"async"),e.nI1(4,"async"),e.EFF(5),e.nI1(6,"async"),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("color",t.layer.visible?"primary":"default")("matTooltip",e.bMT(1,5,t.eyeTooltip)),e.R7$(2),e.Y8G("matBadgeHidden",e.bMT(3,7,t.queryBadgeHidden$))("ngClass",e.eq3(13,tl,!1===e.bMT(4,9,t.inResolutionRange$))),e.R7$(3),e.SpI("",e.bMT(6,11,t.layer.visible$)?"visibility":"visibility_off"," ")}}function Au(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",13),e.nI1(1,"translate"),e.nI1(2,"translate"),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.toggleVisibility(i))}),e.j41(3,"mat-icon",12),e.nI1(4,"async"),e.nI1(5,"async"),e.EFF(6),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.bMT(1,5,"igo.geo.layer.hideLayer"):e.bMT(2,7,"igo.geo.layer.showLayer")),e.R7$(3),e.Y8G("matBadgeHidden",e.bMT(4,9,t.queryBadgeHidden$))("ngClass",e.eq3(13,tl,!1===e.bMT(5,11,t.inResolutionRange$))),e.R7$(3),e.SpI("",t.layer.visible?"visibility":"visibility_off"," ")}}function ku(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",14),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleLayerTool())}),e.j41(2,"mat-icon"),e.EFF(3,"more_horiz"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.layer.moreOptions"))}function ju(l,f){if(1&l&&e.nrm(0,"igo-layer-legend",15),2&l){const t=e.XpG();e.Y8G("layer",t.layer)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}let ol=(()=>{class l{networkService;renderer;elRef;cdRef;focusedCls="igo-layer-item-focused";get activeLayer(){return this._activeLayer}set activeLayer(t){t&&this.layer&&t.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)}_activeLayer;layerTool$=new ce.t(!1);showLegend$=new ce.t(!0);inResolutionRange$=new ce.t(!0);queryBadgeHidden$=new ce.t(!0);tooltipText;state;get selectAll(){return this._selectAll}set selectAll(t){this._selectAll=t,!0===t&&(this.layerCheck=!0)}_selectAll=!1;layerCheck;resolution$$;network$$;layers$$;layers$=new ce.t(void 0);get layer(){return this._layer}set layer(t){this._layer=t,this.layers$.next(t)}_layer;toggleLegendOnVisibilityChange=!1;expandLegendIfVisible=!1;updateLegendOnResolutionChange=!1;orderable=!0;lowerDisabled=!1;raiseDisabled=!1;queryBadge=!1;selectionMode;changeDetection;get opacity(){return 100*this.layer.opacity}set opacity(t){this.layer.opacity=t/100}get eyeTooltip(){return!1===this.inResolutionRange$.getValue()?"igo.geo.layer.notInResolution":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}action=new e.bkB(void 0);checkbox=new e.bkB;constructor(t,n,i,d){this.networkService=t,this.renderer=n,this.elRef=i,this.cdRef=d}ngOnInit(){this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge(),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(n=>{this.state=n,this.onResolutionChange()}),this.layers$$=this.layers$.subscribe(()=>{this.layer&&this.layer.options.active&&(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls))}),this.changeDetection&&this.changeDetection.subscribe(()=>this.cdRef.detectChanges())}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe(),this.layers$$.unsubscribe()}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.toggleLegend(this.showLegend$.value)}toggleVisibility(t){t.stopPropagation(),this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const n=t.tooltip,i=t.metadata;switch(t.tooltip.type){case un.I.TITLE:return this.layer.title;case un.I.ABSTRACT:return i&&i.abstract?i.abstract:this.layer.title;case un.I.CUSTOM:return n&&n.text?n.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){const t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)}updateQueryBadge(){const t=!1===this.queryBadge||!1===this.layer.visible||!(0,Pu.oG)(this.layer);this.queryBadgeHidden$.next(t)}toggleLayerTool(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)}check(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})}static \u0275fac=function(n){return new(n||l)(e.rXU(el.A),e.rXU(e.sFG),e.rXU(e.aKT),e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-layer-item"]],inputs:{activeLayer:"activeLayer",selectAll:"selectAll",layerCheck:"layerCheck",layer:"layer",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendIfVisible:"expandLegendIfVisible",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",orderable:"orderable",lowerDisabled:"lowerDisabled",raiseDisabled:"raiseDisabled",queryBadge:"queryBadge",selectionMode:"selectionMode",changeDetection:"changeDetection"},outputs:{action:"action",checkbox:"checkbox"},standalone:!0,features:[e.aNF],decls:12,vars:9,consts:[["legend",""],[1,"igo-layer-list-item"],["class","layerCheck","matListItemIcon","",3,"checked","change",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"click","matTooltip"],["matListItemMeta",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","selection-eye","mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"igo-layer-legend-container"],[3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["matListItemIcon","",1,"layerCheck",3,"change","checked"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","color","matTooltip"],["aria-hidden","false","matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","ngClass"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",1,"selection-eye",3,"click","color","matTooltip"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"click","matTooltip"],[3,"layer","updateLegendOnResolutionChange"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"mat-list-item",1),e.DNE(1,$u,1,1,"mat-checkbox",2),e.j41(2,"span",3),e.bIt("click",function(){return e.eBV(d),e.Njj(i.toggleLegendOnClick())}),e.EFF(3),e.k0s(),e.j41(4,"div",4),e.DNE(5,Lu,7,15,"button",5)(6,Au,7,15,"button",6)(7,ku,4,3,"button",7),e.k0s()(),e.j41(8,"div",8,0),e.DNE(10,ju,1,2,"igo-layer-legend",9),e.nI1(11,"async"),e.k0s()}2&n&&(e.R7$(),e.Y8G("ngIf",i.selectionMode),e.R7$(),e.Y8G("matTooltip",i.tooltipText),e.R7$(),e.SpI(" ",i.layer.title," "),e.R7$(2),e.Y8G("ngIf",!i.selectionMode),e.R7$(),e.Y8G("ngIf",i.selectionMode),e.R7$(),e.Y8G("ngIf",!i.selectionMode),e.R7$(3),e.Y8G("ngIf",e.bMT(11,7,i.showLegend$)))},dependencies:[de.Fg,de.YE,de.ZV,de.yE,de.BJ,o.bT,ae.g7,ae.So,v.uc,v.oV,L.Hl,L.iY,R.m_,R.An,E.Y,E.k,o.YU,to,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .igo-layer-title{display:block;width:100%;cursor:pointer}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}[_nghost-%COMP%]   .layerCheck[_ngcontent-%COMP%]{align-self:baseline;width:16px;padding-right:0}"],changeDetection:0})}return l})(),nl=(()=>{class l{networkService;inResolutionRange$=new ce.t(!0);tooltipText;state;resolution$$;network$$;layer;updateLegendOnResolutionChange=!1;constructor(t){this.networkService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(n=>{this.state=n,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const n=t.tooltip,i=t.metadata;switch(t.tooltip.type){case un.I.TITLE:return this.layer.title;case un.I.ABSTRACT:return i&&i.abstract?i.abstract:this.layer.title;case un.I.CUSTOM:return n&&n.text?n.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){this.inResolutionRange$.next(this.layer.isInResolutionsRange)}static \u0275fac=function(n){return new(n||l)(e.rXU(el.A))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},standalone:!0,features:[e.aNF],decls:6,vars:4,consts:[["legend",""],[1,"igo-layer-list-item"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],[3,"layer","updateLegendOnResolutionChange"]],template:function(n,i){1&n&&(e.j41(0,"mat-list-item",1)(1,"span",2),e.EFF(2),e.k0s()(),e.j41(3,"div",3,0),e.nrm(5,"igo-layer-legend",4),e.k0s()),2&n&&(e.R7$(),e.Y8G("matTooltip",i.tooltipText),e.R7$(),e.JRh(i.layer.title),e.R7$(3),e.Y8G("layer",i.layer)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange))},dependencies:[de.Fg,de.YE,de.yE,v.uc,v.oV,to],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-layer-list-item[_ngcontent-%COMP%]{height:48px;clear:both}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}"],changeDetection:0})}return l})();var Rr=r(19999),il=r(56042),Pr=r(59400),rl=r(14876),sl=r(9114);function Bu(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-slide-toggle",6),e.nI1(1,"translate"),e.bIt("change",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.toggleShowAllLegends(i.checked))}),e.EFF(2),e.nI1(3,"translate"),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,4,"igo.geo.layer.legend.showAll"))("checked",t.showAllLegendsValue)("labelPosition","before"),e.R7$(2),e.SpI(" ",e.bMT(3,6,"igo.geo.layer.legend.showAll")," ")}}function Gu(l,f){1&l&&e.nrm(0,"mat-divider")}function Vu(l,f){if(1&l&&e.nrm(0,"igo-layer-legend-item",8),2&l){const t=e.XpG().$implicit,n=e.XpG();e.Y8G("layer",t)("updateLegendOnResolutionChange",n.updateLegendOnResolutionChange)}}function Uu(l,f){if(1&l&&e.DNE(0,Vu,1,2,"igo-layer-legend-item",7),2&l){const t=f.$implicit,n=e.XpG();e.Y8G("ngIf",!(n.excludeBaseLayers&&t.baseLayer))}}function Nu(l,f){1&l&&(e.j41(0,"p",9),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Yu(l,f){1&l&&(e.j41(0,"p",9),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function Wu(l,f){1&l&&(e.j41(0,"p",9),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function Xu(l,f){1&l&&(e.j41(0,"p",9),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}let Os=(()=>{class l{orderable=!0;hasVisibleOrInRangeLayers$=new ce.t(!0);hasVisibleAndNotInRangeLayers$=new ce.t(!0);layersInUi$=new ce.t([]);layers$=new ce.t([]);showAllLegend=!1;change$=new il.m(1);change$$;set layers(t){this._layers=t,this.next()}get layers(){return this._layers}_layers;excludeBaseLayers=!1;updateLegendOnResolutionChange=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;allLegendsShown=new e.bkB(!1);constructor(){}ngOnInit(){this.change$$=this.change$.pipe((0,sl.s)(()=>0===this.layers.length?Pr.w:(0,rl.O)(50))).subscribe(()=>{const t=this.computeShownLayers(this.layers.slice(0));this.layers$.next(t),this.hasVisibleOrInRangeLayers$.next(this.layers.slice(0).filter(n=>!0!==n.baseLayer).filter(n=>n.visible$.value&&n.isInResolutionsRange$.value).length>0),this.hasVisibleAndNotInRangeLayers$.next(this.layers.slice(0).filter(n=>!0!==n.baseLayer).filter(n=>n.visible$.value&&!n.isInResolutionsRange$.value).length>0),this.layersInUi$.next(this.layers.slice(0).filter(n=>!(!1===n.showInLayerList||this.excludeBaseLayers&&n.baseLayer)))})}ngOnDestroy(){this.change$$.unsubscribe()}next(){this.change$.next()}computeShownLayers(t){let n=t.filter(i=>i.visible&&i.isInResolutionsRange);return this.showAllLegendsValue&&(n=t),this.sortLayersByZindex(n)}sortLayersByZindex(t){return t.sort((n,i)=>i.zIndex-n.zIndex)}toggleShowAllLegends(t){this.showAllLegendsValue=t,this.next(),this.allLegendsShown.emit(t)}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},standalone:!0,features:[e.aNF],decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"change","matTooltip","checked","labelPosition"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(n,i){1&n&&(e.j41(0,"div",0),e.DNE(1,Bu,4,8,"mat-slide-toggle",1),e.nI1(2,"async"),e.DNE(3,Gu,1,0,"mat-divider",2),e.nI1(4,"async"),e.j41(5,"igo-list",3),e.DNE(6,Uu,1,1,"ng-template",4),e.nI1(7,"async"),e.k0s(),e.DNE(8,Nu,3,3,"p",5),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.DNE(12,Yu,3,3,"p",5),e.nI1(13,"async"),e.nI1(14,"async"),e.nI1(15,"async"),e.DNE(16,Wu,3,3,"p",5),e.nI1(17,"async"),e.nI1(18,"async"),e.nI1(19,"async"),e.DNE(20,Xu,3,3,"p",5),e.nI1(21,"async"),e.nI1(22,"async"),e.nI1(23,"async"),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",e.bMT(2,9,i.layersInUi$).length&&i.allowShowAllLegends),e.R7$(2),e.Y8G("ngIf",e.bMT(4,11,i.layersInUi$).length&&i.allowShowAllLegends),e.R7$(2),e.Y8G("navigation",!1)("selection",!1),e.R7$(),e.Y8G("ngForOf",e.bMT(7,13,i.layers$)),e.R7$(2),e.Y8G("ngIf",!i.showAllLegendsValue&&e.bMT(9,15,i.layersInUi$).length&&!1===e.bMT(10,17,i.hasVisibleOrInRangeLayers$)&&!1===e.bMT(11,19,i.hasVisibleAndNotInRangeLayers$)&&i.allowShowAllLegends),e.R7$(4),e.Y8G("ngIf",!i.showAllLegendsValue&&e.bMT(13,21,i.layersInUi$).length&&!1===e.bMT(14,23,i.hasVisibleOrInRangeLayers$)&&e.bMT(15,25,i.hasVisibleAndNotInRangeLayers$)&&i.allowShowAllLegends),e.R7$(4),e.Y8G("ngIf",e.bMT(17,27,i.layersInUi$).length&&!1===e.bMT(18,29,i.hasVisibleOrInRangeLayers$)&&!1===e.bMT(19,31,i.hasVisibleAndNotInRangeLayers$)&&!i.allowShowAllLegends),e.R7$(4),e.Y8G("ngIf",e.bMT(21,33,i.layersInUi$).length&&!1===e.bMT(22,35,i.hasVisibleOrInRangeLayers$)&&e.bMT(23,37,i.hasVisibleAndNotInRangeLayers$)&&!i.allowShowAllLegends))},dependencies:[o.bT,Ft.mV,Ft.sG,v.uc,v.oV,ye.w,ye.q,s.sB,o.pM,nl,s.dF,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{display:contents}[_nghost-%COMP%]   .layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}[_nghost-%COMP%]   .layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"],changeDetection:0})}return l})(),al=(()=>{class l{mapService;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,n){this.mapService=n,this.component=t}ngOnInit(){this.component.layers=[],this.layersOrResolutionChange$$=(0,Rr.z)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,ho.B)(10)).subscribe(t=>{const n=t[0].filter(i=>!0===i.showInLayerList);this.component.layers=n,this.layersVisibility$$=(0,Rr.z)(n.map(i=>i.visible$)).subscribe(i=>{this.component.change$.next()})})}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(n){return new(n||l)(e.rXU(Os,2),e.rXU(Ke.u))};static \u0275dir=e.FsC({type:l,selectors:[["","igoLayerLegendListBinding",""]],standalone:!0})}return l})();var ll=r(16684);function Ku(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.clearTerm())}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}}let cl=(()=>{class l{onlyVisible$=new ce.t(!1);sortAlpha$=new ce.t(!1);term$=new ce.t(void 0);onlyVisible$$;sortAlpha$$;term$$;layersAreAllVisible=!0;floatLabel="auto";set onlyVisible(t){this.onlyVisible$.next(t)}get onlyVisible(){return this.onlyVisible$.value}set sortAlpha(t){this.sortAlpha$.next(t)}get sortAlpha(){return this.sortAlpha$.value}set term(t){this.term$.next(t)}get term(){return this.term$.value}selectionMode=!1;appliedFilterAndSort=new e.bkB;selection=new e.bkB;ngOnInit(){this.term$$=this.term$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:t,onlyVisible:this.onlyVisible,sortAlpha:this.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:t,sortAlpha:this.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:this.onlyVisible,sortAlpha:t})})}ngOnDestroy(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()}clearTerm(){this.term=void 0}toggleSortAlpha(){this.sortAlpha=!this.sortAlpha}toggleOnlyVisible(){this.onlyVisible=!this.onlyVisible}toggleSelectionMode(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-layer-list-tool"]],inputs:{layersAreAllVisible:"layersAreAllVisible",floatLabel:"floatLabel",onlyVisible:"onlyVisible",sortAlpha:"sortAlpha",term:"term"},outputs:{appliedFilterAndSort:"appliedFilterAndSort",selection:"selection"},standalone:!0,features:[e.aNF],decls:21,vars:33,consts:[[1,"inputFilter",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"ngModelChange","placeholder","matTooltip","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"click","color","matTooltip"],["mat-icon-button","","matTooltipShowDelay","500",1,"only-visible",3,"click","disabled","color","matTooltip"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","visibility",3,"igoMatBadgeInverseColor","igoMatBadgeInheritColor"],["mat-icon-button","","color","primary","matTooltipShowDelay","500",1,"selection-mode",3,"click","matTooltip"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"]],template:function(n,i){1&n&&(e.j41(0,"mat-form-field",0)(1,"input",1),e.nI1(2,"translate"),e.nI1(3,"translate"),e.mxI("ngModelChange",function(T){return e.DH7(i.term,T)||(i.term=T),T}),e.k0s(),e.DNE(4,Ku,3,0,"button",2),e.k0s(),e.j41(5,"div",3)(6,"button",4),e.nI1(7,"translate"),e.nI1(8,"translate"),e.bIt("click",function(){return i.toggleSortAlpha()}),e.j41(9,"mat-icon"),e.EFF(10,"sort_by_alpha"),e.k0s()(),e.j41(11,"button",5),e.nI1(12,"translate"),e.nI1(13,"translate"),e.bIt("click",function(){return i.toggleOnlyVisible()}),e.j41(14,"mat-icon",6),e.EFF(15),e.k0s()(),e.j41(16,"button",7),e.nI1(17,"translate"),e.nI1(18,"translate"),e.bIt("click",function(){return i.toggleSelectionMode()}),e.j41(19,"mat-icon"),e.EFF(20),e.k0s()()()),2&n&&(e.Y8G("floatLabel",i.floatLabel),e.R7$(),e.Y8G("placeholder",e.bMT(2,17,"igo.geo.layer.filterPlaceholder"))("matTooltip",e.bMT(3,19,"igo.geo.layer.subsetLayersListKeyword")),e.R50("ngModel",i.term),e.R7$(3),e.Y8G("ngIf",i.term),e.R7$(2),e.AVh("--active",i.sortAlpha),e.Y8G("color",i.sortAlpha?"warn":"primary")("matTooltip",i.sortAlpha?e.bMT(7,21,"igo.geo.layer.sortMapOrder"):e.bMT(8,23,"igo.geo.layer.sortAlphabetically")),e.R7$(5),e.Y8G("disabled",i.layersAreAllVisible&&!i.onlyVisible)("color",i.onlyVisible?"warn":"primary")("matTooltip",i.onlyVisible?e.bMT(12,25,"igo.geo.layer.resetLayersList"):e.bMT(13,27,"igo.geo.layer.subsetLayersListOnlyVisible")),e.R7$(3),e.Y8G("igoMatBadgeInverseColor",!0)("igoMatBadgeInheritColor",!0),e.R7$(),e.SpI(" ",i.onlyVisible?"filter_alt_off":"filter_alt"," "),e.R7$(),e.Y8G("matTooltip",i.selectionMode?e.bMT(17,29,"igo.geo.layer.deactivateSelectionMode"):e.bMT(18,31,"igo.geo.layer.activateSelectionMode")),e.R7$(4),e.JRh(i.selectionMode?"library_add_check":"filter_none"))},dependencies:[be.RG,be.rl,be.yw,Tt.fS,Tt.fg,Q.YN,Q.me,Q.BC,Q.vS,v.uc,v.oV,o.bT,L.Hl,L.iY,R.m_,R.An,E.Y,E.k,ll.V,y.Ck,P.D9],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:50%}}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.sort-alpha.--active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:red}"],changeDetection:0})}return l})();var Hu=r(71424),ws=r(31034),zu=r(62152),zn=r(84505),ul=r(7177),Es=r(99441),tr=function(l){return l.always="always",l.never="never",l.default="default",l}(tr||{}),hi=function(l){return l.ALL_VISIBLE="ALL_VISIBLE",l.ALL_HIDDEN="ALL_HIDDEN",l.MIXED="MIXED",l.NULL="NULL",l}(hi||{}),$r=function(l){return l.Raise="raise",l.Lower="lower",l}($r||{});const Ju=["igoLayerItemToolbar"],Zu=[[["","igoLayerItemToolbar",""]]],Qu=["[igoLayerItemToolbar]"],qu=l=>({layer:l});function ep(l,f){if(1&l){const t=e.RV6();e.j41(0,"igo-layer-list-tool",9),e.bIt("appliedFilterAndSort",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onAppliedFilterAndSortChange(i))})("selection",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.toggleSelectionMode(i))}),e.k0s()}if(2&l){const t=e.XpG();e.Y8G("layersAreAllVisible",t.layersAreAllVisible)("term",t.layerFilterAndSortOptions.keyword)("onlyVisible",t.layerFilterAndSortOptions.onlyVisible)("sortAlpha",t.layerFilterAndSortOptions.sortAlpha)}}function tp(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",10)(1,"mat-checkbox",11),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.selectAll())}),e.EFF(2),e.nI1(3,"translate"),e.nI1(4,"translate"),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("color",!t.selectAllCheck&&t.layersChecked.length>0?"accent":"primary")("checked",t.selectAllCheck)("indeterminate",!t.selectAllCheck&&t.layersChecked.length>0),e.R7$(),e.SpI(" ",t.selectAllCheck?e.bMT(3,4,"igo.geo.layer.deselectAll"):e.bMT(4,6,"igo.geo.layer.selectAll")," ")}}function op(l,f){if(1&l){const t=e.RV6();e.j41(0,"igo-layer-item",13),e.bIt("action",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.toggleLayerTool(i))})("checkbox",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.layersCheck(i))}),e.k0s()}if(2&l){const t=e.XpG().$implicit,n=e.XpG();e.Y8G("layer",t)("activeLayer",n.activeLayer)("orderable",n.orderable&&!t.baseLayer)("lowerDisabled",n.getLowerLayer().id===t.id)("raiseDisabled",n.getUpperLayer().id===t.id)("queryBadge",n.queryBadge)("expandLegendIfVisible",n.expandLegendOfVisibleLayers)("updateLegendOnResolutionChange",n.updateLegendOnResolutionChange)("toggleLegendOnVisibilityChange",n.toggleLegendOnVisibilityChange)("selectionMode",n.selection)("selectAll",n.selectAllCheck)("layerCheck",t.options.check)("changeDetection",n.layerItemChangeDetection$)}}function np(l,f){if(1&l&&e.DNE(0,op,1,13,"igo-layer-item",12),2&l){const t=f.$implicit,n=e.XpG();e.Y8G("ngIf",!(n.excludeBaseLayers&&t.baseLayer))}}function ip(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",27),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.removeLayers())}),e.j41(2,"mat-icon"),e.EFF(3,"delete"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.layer.removeLayer"))}function rp(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",28),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.zoomLayerExtents(i.activeLayer))}),e.j41(2,"mat-icon",29),e.EFF(3,"frame_inspect"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.layer.zoomLayer"))}function sp(l,f){if(1&l){const t=e.RV6();e.j41(0,"igo-panel",14)(1,"div",15),e.DNE(2,ip,4,3,"button",16),e.j41(3,"button",17),e.nI1(4,"translate"),e.nI1(5,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.moveActiveLayer(i.activeLayer,i.layerListDisplacement.Lower,!0))}),e.j41(6,"mat-icon",18),e.EFF(7,"arrow_downward"),e.k0s()(),e.j41(8,"button",19),e.nI1(9,"translate"),e.nI1(10,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.moveActiveLayer(i.activeLayer,i.layerListDisplacement.Raise,!0))}),e.j41(11,"mat-icon",18),e.EFF(12,"arrow_upward"),e.k0s()(),e.j41(13,"button",20),e.nI1(14,"translate"),e.j41(15,"mat-icon",21),e.EFF(16,"opacity"),e.k0s()(),e.j41(17,"mat-menu",22,1)(19,"mat-slider",23,2),e.nI1(21,"translate"),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.j41(22,"input",24,3),e.bIt("input",function(){e.eBV(t);const i=e.sdS(20),d=e.sdS(23),T=e.XpG();return e.Njj(T.changeOpacity({source:d,parent:i,value:d.value}))}),e.k0s()()(),e.DNE(24,rp,4,3,"button",25),e.eu8(25,26),e.SdG(26),e.k0s()()}if(2&l){const t=e.sdS(18),n=e.XpG();e.Y8G("title",n.activeLayer.title),e.R7$(2),e.Y8G("ngIf",n.isLayerRemovable(n.activeLayer)),e.R7$(),e.Y8G("matTooltip",n.sortAlpha||n.onlyVisible||n.keyword?e.bMT(4,20,"igo.geo.layer.filterLowerLayer"):e.bMT(5,22,"igo.geo.layer.lowerLayer"))("disabled",n.lowerDisabled),e.R7$(3),e.Y8G("matBadge",n.sortAlpha||n.onlyVisible||n.keyword?"!":"")("matBadgeHidden",n.lowerDisabled),e.R7$(2),e.Y8G("matTooltip",n.sortAlpha||n.onlyVisible||n.keyword?e.bMT(9,24,"igo.geo.layer.filterRaiseLayer"):e.bMT(10,26,"igo.geo.layer.raiseLayer"))("disabled",n.raiseDisabled),e.R7$(3),e.Y8G("matBadge",n.sortAlpha||n.onlyVisible||n.keyword?"!":"")("matBadgeHidden",n.raiseDisabled),e.R7$(2),e.Y8G("matMenuTriggerFor",t)("matTooltip",e.bMT(14,28,"igo.geo.layer.opacity")),e.R7$(2),e.Y8G("matBadge",n.badgeOpacity),e.R7$(4),e.Y8G("min",0)("max",100)("matTooltip",e.bMT(21,30,"igo.geo.layer.opacity")),e.R7$(3),e.Y8G("value",n.opacity),e.R7$(2),e.Y8G("ngIf",n.activeLayerExtentIsValid(n.activeLayer)),e.R7$(),e.Y8G("ngTemplateOutlet",n.templateLayerToolbar)("ngTemplateOutletContext",e.eq3(32,qu,n.activeLayer))}}function ap(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-slider",37),e.nI1(1,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG(2);return e.DH7(d.checkOpacity,i)||(d.checkOpacity=i),e.Njj(i)}),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.nrm(2,"input",38),e.k0s()}if(2&l){const t=e.XpG(2);e.Y8G("min",0)("max",100),e.R50("ngModel",t.checkOpacity),e.Y8G("matTooltip",e.bMT(1,4,"igo.geo.layer.opacity"))}}function lp(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",28),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.zoomLayersExtents(i.layersChecked))}),e.j41(2,"mat-icon"),e.EFF(3,"frame_inspect"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.layer.zoomLayers"))}function cp(l,f){if(1&l){const t=e.RV6();e.j41(0,"igo-panel",14),e.nI1(1,"translate"),e.j41(2,"div",30)(3,"button",31),e.nI1(4,"translate"),e.nI1(5,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.removeLayers(i.layersChecked))}),e.j41(6,"mat-icon",18),e.EFF(7,"delete"),e.k0s()(),e.j41(8,"button",32),e.nI1(9,"translate"),e.nI1(10,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleVisibility(i.layersChecked))}),e.j41(11,"mat-icon"),e.EFF(12),e.k0s()(),e.j41(13,"button",17),e.nI1(14,"translate"),e.nI1(15,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.lowerLayers(i.layersChecked))}),e.j41(16,"mat-icon",18),e.EFF(17,"arrow_downward"),e.k0s()(),e.j41(18,"button",19),e.nI1(19,"translate"),e.nI1(20,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.raiseLayers(i.layersChecked))}),e.j41(21,"mat-icon",18),e.EFF(22,"arrow_upward"),e.k0s()(),e.j41(23,"button",33),e.nI1(24,"translate"),e.j41(25,"mat-icon"),e.EFF(26,"opacity"),e.k0s()(),e.j41(27,"mat-menu",34,1)(29,"div",35),e.DNE(30,ap,3,6,"mat-slider",36),e.k0s()(),e.DNE(31,lp,4,3,"button",25),e.k0s()()}if(2&l){const t=e.sdS(28),n=e.XpG();e.Y8G("title",e.bMT(1,21,"igo.geo.layer.tools")),e.R7$(3),e.Y8G("disabled",0===n.layersChecked.length)("matTooltip",n.isAllLayersRemovable(n.layersChecked)?e.bMT(4,23,"igo.geo.layer.removeSelectedLayers"):e.bMT(5,25,"igo.geo.layer.removeSelectedLayersRestriction")),e.R7$(3),e.Y8G("matBadge","!")("matBadgeHidden",n.isAllLayersRemovable(n.layersChecked)),e.R7$(2),e.Y8G("disabled",0===n.layersChecked.length)("matTooltip","ALL_HIDDEN"===n.statusSelectedLayersCheck?e.bMT(9,27,"igo.geo.layer.showSelectedLayers"):e.bMT(10,29,"igo.geo.layer.hideSelectedLayers")),e.R7$(4),e.JRh("ALL_HIDDEN"===n.statusSelectedLayersCheck?"visibility_off":"visibility"),e.R7$(),e.Y8G("matTooltip",n.sortAlpha||n.onlyVisible||n.keyword?e.bMT(14,31,"igo.geo.layer.filterLowerLayer"):e.bMT(15,33,"igo.geo.layer.lowerLayer"))("disabled",n.lowerDisabledSelection),e.R7$(3),e.Y8G("matBadge",n.sortAlpha||n.onlyVisible||n.keyword?"!":"")("matBadgeHidden",n.lowerDisabledSelection),e.R7$(2),e.Y8G("matTooltip",n.sortAlpha||n.onlyVisible||n.keyword?e.bMT(19,35,"igo.geo.layer.filterRaiseLayer"):e.bMT(20,37,"igo.geo.layer.raiseLayer"))("disabled",n.raiseDisabledSelection),e.R7$(3),e.Y8G("matBadge",n.sortAlpha||n.onlyVisible||n.keyword?"!":"")("matBadgeHidden",n.raiseDisabledSelection),e.R7$(2),e.Y8G("disabled",0===n.layersChecked.length)("matMenuTriggerFor",t)("matTooltip",e.bMT(24,39,"igo.geo.layer.opacity")),e.R7$(7),e.Y8G("ngIf",n.layersChecked.length),e.R7$(),e.Y8G("ngIf",0!==n.layersChecked.length&&n.activeLayersExtentAreValid(n.layersChecked))}}let Ds=(()=>{class l{elRef;orderable=!0;thresholdToFilterAndSort=5;layers$=new ce.t([]);change$=new il.m(1);showToolbar$=new ce.t(!1);layerTool;hideSelectedLayers=!0;activeLayer$=new ce.t(void 0);layersChecked=[];selection;change$$;layers$$;layerItemChangeDetection$=new ce.t(void 0);templateLayerToolbar;layersAreAllVisible=!0;ogcButton=!0;timeButton=!0;get map(){return this._map}set map(t){this._map=t}_map;set layers(t){this._layers=this.removeProblemLayerInList(t),this.next()}get layers(){return this._layers}_layers;set activeLayer(t){this._activeLayer=t,this.activeLayer$.next(t)}get activeLayer(){return this._activeLayer}_activeLayer;floatLabel="auto";layerFilterAndSortOptions={};excludeBaseLayers=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;queryBadge=!1;appliedFilterAndSort=new e.bkB;get keyword(){return this._keyword}set keyword(t){this._keyword=t,this.next()}_keyword=void 0;get onlyVisible(){return this._onlyVisible}set onlyVisible(t){this._onlyVisible=t,this.next()}_onlyVisible=!1;get sortAlpha(){return this._sortedAlpha}set sortAlpha(t){this._sortedAlpha=t,this.next()}_sortedAlpha=!1;get opacity(){return Math.round(100*this.activeLayer$.getValue().opacity)}set opacity(t){this.activeLayer$.getValue().opacity=t/100}get badgeOpacity(){if(100!==this.opacity)return this.opacity}get raiseDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))}get lowerDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))}get raiseDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck}get lowerDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck}get checkOpacity(){return 100*this.layersCheckedOpacity()}set checkOpacity(t){for(const n of this.layersChecked)n.opacity=t/100}get layerListDisplacement(){return $r}toggleOpacity=!1;selectAllCheck;selectAllCheck$=new ce.t(void 0);selectAllCheck$$;constructor(t){this.elRef=t}ngOnInit(){this.change$$=this.change$.pipe((0,sl.s)(()=>0===this.layers.length?Pr.w:(0,rl.O)(50))).subscribe(()=>{this.showToolbar$.next(this.computeShowToolbar()),this.layers$.next(this.computeLayers(this.layers.slice(0))),this.appliedFilterAndSort.emit({keyword:this.keyword,sortAlpha:this.sortAlpha,onlyVisible:this.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(t=>{this.selectAllCheck=t}),this.layers$$=this.layers$.subscribe(()=>{if(this.layers){let t=0;for(const n of this.layers)n.status$.subscribe(i=>{0===i&&this.map.removeLayer(n)}),n.options.active&&(this.activeLayer=n,this.layerTool=!0),n.options.check&&(t+=1);this.selectAllCheck=this.excludeBaseLayers?t===this.layers.filter(n=>!0!==n.baseLayer&&n.showInLayerList).length:t===this.layers.filter(n=>n.showInLayerList).length}})}ngOnDestroy(){this.change$$.unsubscribe(),this.selectAllCheck$$.unsubscribe(),this.layers$$.unsubscribe()}activeLayerExtentIsValid(t){let n=!1;if(!1===t.options.showButtonZoomToExtent)return!1;const i=t.options.extent,d=this.map.viewController.maxLayerZoomExtent;return i&&(n=!d||zn.ms(d,i)),n}activeLayersExtentAreValid(t){let n=!1;const i=zn.S5(),d=this.map.viewController.maxLayerZoomExtent;for(const T of t){const B=T.options.extent;B&&!B.includes(1/0)&&zn.X$(i,B)}return zn.Im(i)||(n=!d||zn.ms(d,i)),n}zoomLayerExtents(t){this.map.viewController.zoomToExtent(t.options.extent)}zoomLayersExtents(t){const n=zn.S5();for(const i of t){const d=i.options.extent;d&&zn.X$(n,d)}this.map.viewController.zoomToExtent(n)}changeOpacity(t){this.opacity=t.value}clearKeyword(){this.keyword=void 0}getLowerLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,n)=>t.zIndex<n.zIndex?t:n,{zIndex:void 0,id:void 0})}isLowerBaselayer(t){const n=this.layers.findIndex(i=>t.id===i.id);return!(!this.layers||!this.layers[n+1]||!0!==this.layers[n+1].baseLayer)}getUpperLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,n)=>t.zIndex>n.zIndex?t:n,{zIndex:void 0,id:void 0})}isUpperBaselayer(t){const n=this.layers.findIndex(i=>t.id===i.id);return!(!this.layers||!this.layers[n-1]||!0!==this.layers[n-1].baseLayer)}moveActiveLayer(t,n,i=!1){const d=[];(0,Es.Bb)(this.map,t,un.X.ZINDEX);let T=(0,Es.Bb)(this.map,t,un.X.ZINDEX);T||(T=t);const B=[T];(0,Es.Ey)(this.map,T,B,un.X.ZINDEX),this.layers.map(me=>{-1!==B.indexOf(me)&&d.push(me)}),n===$r.Raise?this.raiseLayers(d,i):n===$r.Lower&&this.lowerLayers(d,i)}raisableLayers(t){let n=!1,i=0;for(const d of t){const T=this.layers.findIndex(fe=>d.id===fe.id),B=this.layers[T];B.baseLayer&&(i+=1);const me=this.layers[T-1];me&&!0!==me.baseLayer&&!t.find(fe=>me.id===fe.id)&&!0!==B.baseLayer&&(n=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||i===this.layersChecked.length)&&(n=!1),n}raisableLayer(t){return!(t<1)&&(!this.layers[t-1].options.check||this.raisableLayer(t-1))}raiseLayers(t,n=!0){const i=[];for(const d of t){const T=this.layers.findIndex(B=>B.id===d.id);this.raisableLayer(T)&&i.push(d)}this.map.raiseLayers(i),n&&setTimeout(()=>{const d=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),T=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let B;d.length&&(B=d[0]),T.length&&(B=T[0]),B&&(0,ul.A)(B,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}lowerableLayers(t){let n=!1,i=0;for(const d of t){const T=this.layers.findIndex(fe=>d.id===fe.id);this.layers[T].baseLayer&&(i+=1);const me=this.layers[T+1];me&&!0!==me.baseLayer&&!t.find(fe=>me.id===fe.id)&&(n=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||i===this.layersChecked.length)&&(n=!1),n}lowerableLayer(t){return!(t>this.layers.filter(n=>!0!==n.baseLayer).length-2)&&(!this.layers[t+1].options.check||this.lowerableLayer(t+1))}lowerLayers(t,n=!0){const i=[];for(const d of t){const T=this.layers.findIndex(B=>B.id===d.id);this.lowerableLayer(T)&&i.push(d)}this.map.lowerLayers(i),n&&setTimeout(()=>{const d=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),T=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let B;d.length&&(B=d[d.length-1]),T.length&&(B=T[0]),B&&(0,ul.A)(B,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}next(){this.change$.next()}computeLayers(t){let n=this.filterLayers(t);return n=this.sortAlpha?this.sortLayersByTitle(n):this.sortLayersByZindex(n),n}onKeywordChange(t){this.keyword=t}onAppliedFilterAndSortChange(t){this.keyword=t.keyword,this.onlyVisible=t.onlyVisible,this.sortAlpha=t.sortAlpha}filterLayers(t){if(this.layerFilterAndSortOptions.showToolbar===tr.never||!this.keyword&&!this.onlyVisible)return t;const n=t.map(i=>i.id);return t.forEach(i=>{const T=i.dataSource.options||{},fe=(((i.options||{}).metadata||{}).keywordList||[]).map(we=>we.normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(this.keyword&&i.title){const we=this.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),Me=i.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),ke=T.type||"",Je=new RegExp(we,"gi"),je=void 0!==fe.find(qe=>Je.test(qe));if(!Je.test(Me)&&this.keyword.toLowerCase()!==ke.toLowerCase()&&!je){const qe=n.indexOf(i.id);qe>-1&&n.splice(qe,1)}}if(this.onlyVisible&&!1===i.visible){const we=n.indexOf(i.id);we>-1&&n.splice(we,1)}}),t.filter(i=>-1!==n.indexOf(i.id))}sortLayersByZindex(t){return t.sort((n,i)=>i.zIndex-n.zIndex)}sortLayersByTitle(t){return t.sort((n,i)=>this.normalize(n.title)<this.normalize(i.title)?-1:this.normalize(n.title)>this.normalize(i.title)?1:0)}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}computeShowToolbar(){switch(this.layerFilterAndSortOptions.showToolbar){case tr.always:return!0;case tr.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}}toggleLayerTool(t){this.toggleOpacity=!1,this.layerTool=!this.layerTool||t!==this.activeLayer;for(const n of this.layers)n.options.active=!1;t.options.active=!0,this.activeLayer=t}removeLayers(t){if(t&&t.length>0){this.layersChecked=[];for(const n of t)!1!==n.options.removable?n.map.removeLayer(n):this.layersChecked.push(n)}else!t&&!1!==this.activeLayer.options.removable&&(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)}toggleVisibility(t){if(t&&t.length>0)for(const n of t)n.visible=this.hideSelectedLayers;this.layerItemChangeDetection$.next(!0)}isLayerRemovable(t){return!1!==t.options.removable}isAllLayersRemovable(t){return t.every(n=>this.isLayerRemovable(n))}get statusSelectedLayersCheck(){let t=hi.NULL,n=!1,i=!1;if(0===this.layersChecked.length)t=hi.NULL;else{t=hi.MIXED,this.hideSelectedLayers=!1;for(const d of this.layersChecked)!0===d.visible&&(n=!0),!1===d.visible&&(i=!0);!0===n&&!1===i&&(t=hi.ALL_VISIBLE),!1===n&&!0===i&&(t=hi.ALL_HIDDEN,this.hideSelectedLayers=!0)}return t}layersCheck(t){if(t.layer.options.check=t.check,!0===t.check){const n=this.layers.findIndex(i=>t.layer.id===i.id);for(const i of this.layersChecked)if(n<this.layers.findIndex(T=>i.id===T.id))return this.layersChecked.splice(this.layersChecked.findIndex(T=>i.id===T.id),0,t.layer),void(this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(T=>!0!==T.baseLayer&&T.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(T=>T.showInLayerList).length));this.layersChecked.push(t.layer)}else{const n=this.layersChecked.findIndex(i=>t.layer.id===i.id);this.layersChecked.splice(n,1)}this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(n=>!0!==n.baseLayer&&n.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(n=>n.showInLayerList).length)}toggleSelectionMode(t){if(this.selection=t,this.activeLayer=void 0,!0===t){this.layerTool=!1;for(const n of this.layers)n.options.check&&this.layersChecked.push(n)}}layersCheckedOpacity(){if(this.layersChecked.length>1)return 1;{const t=[];for(const n of this.layersChecked)t.push(n.opacity);return t}}selectAll(){if(this.selectAllCheck){for(const t of this.layers)t.options.check=!1;this.layersChecked=[],this.selectAllCheck$.next(!1)}else{for(const t of this.layers)(this.excludeBaseLayers&&!0!==t.baseLayer&&t.showInLayerList||!this.excludeBaseLayers&&t.showInLayerList)&&(t.options.check=!0,this.layersChecked.push(t));this.selectAllCheck$.next(!0)}}isScrolledIntoView(t,n){const i=t.scrollTop,T=n.offsetTop;return T+n.clientHeight<=i+t.clientHeight&&T>=i}removeProblemLayerInList(t){for(const n of t)!0===n.olLoadingProblem&&this.map.removeLayer(n);return t}static \u0275fac=function(n){return new(n||l)(e.rXU(e.aKT))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-layer-list"]],contentQueries:function(n,i,d){if(1&n&&e.wni(d,Ju,5),2&n){let T;e.mGM(T=e.lsd())&&(i.templateLayerToolbar=T.first)}},inputs:{layersAreAllVisible:"layersAreAllVisible",ogcButton:"ogcButton",timeButton:"timeButton",map:"map",layers:"layers",floatLabel:"floatLabel",layerFilterAndSortOptions:"layerFilterAndSortOptions",excludeBaseLayers:"excludeBaseLayers",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",queryBadge:"queryBadge"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},standalone:!0,features:[e.aNF],ngContentSelectors:Qu,decls:10,vars:11,consts:[["igoList",""],["opacityMenu","matMenu"],["ngSlider",""],["ngSliderThumb","matSliderThumb"],["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection",4,"ngIf"],["class","select-all",4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","igo-layer-actions-container",3,"title",4,"ngIf"],["floatLabel","auto",3,"appliedFilterAndSort","selection","layersAreAllVisible","term","onlyVisible","sortAlpha"],[1,"select-all"],[1,"select-all-checkbox",3,"change","color","checked","indeterminate"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox",4,"ngIf"],["igoListItem","",3,"action","checkbox","layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"click","matTooltip","disabled"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"click","matTooltip","disabled"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["aria-hidden","false","matBadgeColor","primary","matBadgeSize","medium",3,"matBadge"],[1,"panel-opacity-menu"],["id","opacity-slider","color","primary","discrete","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"click","min","max","matTooltip"],["matSliderThumb","",3,"input","value"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoLayerItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"click","matTooltip"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"click","matTooltip"],["matBadgeColor","primary","matBadgeSize","medium"],[1,"actions-buttons-multi"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"click","disabled","matTooltip"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"click","disabled","matTooltip"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"disabled","matMenuTriggerFor","matTooltip"],[1,"mat-menu-opacity-slider"],["id","opacity-menu"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click",4,"ngIf"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"ngModelChange","click","min","max","ngModel","matTooltip"],["matSliderThumb",""]],template:function(n,i){1&n&&(e.NAR(Zu),e.DNE(0,ep,1,4,"igo-layer-list-tool",4),e.nI1(1,"async"),e.DNE(2,tp,5,8,"div",5),e.nrm(3,"mat-divider"),e.j41(4,"igo-list",6,0),e.DNE(6,np,1,1,"ng-template",7),e.nI1(7,"async"),e.k0s(),e.DNE(8,sp,27,34,"igo-panel",8)(9,cp,32,41,"igo-panel",8)),2&n&&(e.Y8G("ngIf",e.bMT(1,7,i.showToolbar$)),e.R7$(2),e.Y8G("ngIf",i.selection),e.R7$(2),e.Y8G("navigation",!1)("selection",!1),e.R7$(2),e.Y8G("ngForOf",e.bMT(7,9,i.layers$)),e.R7$(2),e.Y8G("ngIf",!i.selection&&i.layerTool&&i.activeLayer),e.R7$(),e.Y8G("ngIf",i.selection&&i.layers.length>0))},dependencies:[o.bT,cl,ae.g7,ae.So,ye.w,ye.q,s.sB,o.pM,ol,s.dF,zu.g,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,E.Y,E.k,ws.Cn,ws.kk,ws.Cp,qt.Ez,qt.IV,qt.OU,o.T3,Q.YN,Q.BC,Q.vS,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{flex:1;padding-top:8px}[_nghost-%COMP%]   mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{padding:0 6px 0 4px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__content{margin-bottom:10px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{padding-top:5px}[_nghost-%COMP%]   igo-panel[_ngcontent-%COMP%]{height:unset}[_nghost-%COMP%]   .select-all[_ngcontent-%COMP%]{display:flex;align-items:center;height:48px;padding:0 16px}  .panel-opacity-menu{overflow:visible!important}  .panel-opacity-menu #opacity-slider{margin:0 16px}"],changeDetection:0})}return l})(),pl=(()=>{class l{mapService;route;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,n,i){this.mapService=n,this.route=i,this.component=t}ngOnInit(){this.layersOrResolutionChange$$=(0,Rr.z)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,ho.B)(10)).subscribe(t=>{const n=t[0].filter(i=>!0===i.showInLayerList);this.component.layers=n,this.setLayersVisibilityStatus(n,this.component.excludeBaseLayers)})}setLayersVisibilityStatus(t,n){void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0),this.layersVisibility$$=(0,Rr.z)(t.filter(i=>i.baseLayer!==n).map(i=>i.visible$)).pipe((0,g.T)(i=>i.every(Boolean))).subscribe(i=>this.component.layersAreAllVisible=i)}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(n){return new(n||l)(e.rXU(Ds,2),e.rXU(Ke.u),e.rXU(Hu.v$,8))};static \u0275dir=e.FsC({type:l,selectors:[["","igoLayerListBinding",""]],standalone:!0})}return l})();function up(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",1),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleTrackFeature())}),e.j41(2,"mat-icon"),e.EFF(3,"my_location"),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,2,"igo.geo.layer.trackFeature"))("color",t.color)}}let dl=(()=>{class l{layer;trackFeature=!1;get options(){if(this.layer)return this.layer.options}color="primary";constructor(){}ngOnInit(){this.color=this.trackFeature?"primary":"basic"}toggleTrackFeature(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","color"]],template:function(n,i){1&n&&e.DNE(0,up,4,4,"button",0),2&n&&e.Y8G("ngIf",i.options.trackFeature)},dependencies:[o.bT,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,y.Ck,P.D9],changeDetection:0})}return l})(),pp=(()=>{class l{constructor(){}open(t){t.extern&&window.open(t.url,"_blank")}static \u0275fac=function(n){return new(n||l)};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function dp(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",1),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openMetadata(i.options.metadata))}),e.j41(2,"mat-icon"),e.EFF(3,"info"),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,2,"igo.geo.metadata.show"))("color",t.color)}}function mp(l,f){if(1&l&&(e.j41(0,"mat-dialog-content",3)(1,"h3"),e.EFF(2),e.k0s()()),2&l){const t=e.XpG();e.R7$(2),e.JRh(t.data.abstract)}}function gp(l,f){if(1&l&&(e.j41(0,"mat-dialog-content",3),e.nrm(1,"h3",4),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("innerHTML",t.data.abstract,e.npT)}}let Rs=(()=>{class l{metadataService;dialog;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t,n){this.metadataService=t,this.dialog=n}openMetadata(t){t.extern?!t.url&&t.abstract?this.dialog.open(Ps,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}}):t.url&&this.metadataService.open(t):!t.extern&&t.abstract&&this.dialog.open(Ps,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}})}get options(){if(this.layer)return this.layer.options}static \u0275fac=function(n){return new(n||l)(e.rXU(pp),e.rXU(Ct.bZ))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","color"]],template:function(n,i){1&n&&e.DNE(0,dp,4,4,"button",0),2&n&&e.Y8G("ngIf",i.options&&i.options.metadata&&i.options.metadata.url||i.options&&i.options.metadata&&i.options.metadata.abstract)},dependencies:[o.bT,L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,y.Ck,P.D9,Ct.hM],changeDetection:0})}return l})(),Ps=(()=>{class l{data;constructor(t){this.data=t}static \u0275fac=function(n){return new(n||l)(e.rXU(Ct.Vh))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-metadata-abstract"]],standalone:!0,features:[e.aNF],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(n,i){1&n&&(e.j41(0,"h2",0),e.EFF(1),e.k0s(),e.j41(2,"button",1),e.EFF(3,"X"),e.k0s(),e.DNE(4,mp,3,1,"mat-dialog-content",2)(5,gp,2,1,"mat-dialog-content",2)),2&n&&(e.R7$(),e.JRh(i.data.layerTitle),e.R7$(3),e.Y8G("ngIf","arcgisrest"!==i.data.type),e.R7$(),e.Y8G("ngIf","arcgisrest"===i.data.type))},dependencies:[Ct.BI,L.Hl,L.$z,Ct.tx,o.bT,Ct.Yi],styles:[":host{position:relative;display:block}:host .close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}\n"],encapsulation:2})}return l})();var So=r(24891),Xt=r(3439);let ml=(()=>{class l extends So.C{static id="map";static type=Xt.R;constructor(t){super(t)}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"Carte"}}static \u0275fac=function(n){return new(n||l)(e.KVO("options"))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();function hp(l){return new ml(l.getConfig(`searchSources.${ml.id}`)||{})}var _p=r(74458);let yp=(()=>{class l{static forRoot(){return{ngModule:l,providers:[{provide:So.C,useFactory:hp,multi:!0,deps:[A.we]}]}}static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({providers:[_p.c],imports:[o.MD,k.tG]})}return l})();var gl=r(11439);let hl=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[gl.L]})}return l})();var $s=r(52342),Ls=r(92142);let fl=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[Ls.M,$s.E]})}return l})();var _l=r(61181);let yl=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[_l.B]})}return l})();var vl=r(36465);let bl=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[vl.V]})}return l})();r(62739);var As=r(40386);function Cp(l){return new As.z(l)}function Cl(){return{provide:As.z,useFactory:Cp,deps:[So.C]}}var ks=r(35876),Ot=(r(58417),r(24398)),xn=r(9530);class To{static getGoogleMapsCoordLink(f,t){return`https://www.google.com/maps/search/?api=1&query=${t}%2C${f}`}static getGoogleStreetViewLink(f,t){return`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${t}%2C${f}`}static getGoogleMapsNameLink(f){return`https://www.google.com/maps/search/?api=1&query=${encodeURI(f)}`}}class Sp{static getOpenStreetMapLink(f,t,n=17){return`https://www.openstreetmap.org/?mlat=${t}&mlon=${f}#map=${n}/${t}/${f}`}static getOpenStreetCamLink(f,t,n=17){return`https://openstreetcam.org/map/@${t},${f},${n}z`}}let Sl=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(n){return new(n||l)(e.KVO(y.gw))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();class Jn extends So.C{languageService;static id="coordinatesreverse";static type=Xt.R;projections;title$=new ce.t("");get title(){return this.title$.getValue()}constructor(f,t,n,i){super(f,n),this.languageService=t,this.projections=i,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return Jn.id}getType(){return Jn.type}getDefaultOptions(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}reverseSearch(f,t,n){return(0,Xe.of)([this.dataToResult(f,t,n)])}dataToResult(f,t,n){const i=(0,fo.vi)(f),T=(0,fo.xN)(f,this.projections).reduce((je,qe)=>(je[qe.alias]=qe.igo2CoordFormat,je),{}),B=n?(0,fo.ho)(f,6).reverse().join(", "):(0,fo.ho)(f,6).join(", "),me=n?i.reverse().join(", "):i.join(", ");let fe={type:"Point",coordinates:[f[0],f[1]]};const we={};let Me="";if(t.distance){we[this.languageService.translate.instant("igo.geo.search.coordinates.radius")]=t.distance,Me="<br><small>Rayon: "+t.distance+" m</small>";const qe=_.pd([f[0],f[1]],"EPSG:4326","EPSG:3857"),lt=new Tn.A(qe,t.distance),bt=(0,Wn.nD)(lt),Lt=new _o.A;fe=JSON.parse(Lt.writeGeometry(bt.transform("EPSG:3857","EPSG:4326")))}return t.conf&&(we[this.languageService.translate.instant("igo.geo.search.coordinates.conf")]=t.conf,Me+=""===Me?"<br>":"<small> - </small>",Me+="<small>Confiance: "+t.conf+"%</small>"),we[this.languageService.translate.instant(n?"igo.geo.search.coordinates.reversedCoord":"igo.geo.search.coordinates.coord")]=B,we[this.languageService.translate.instant(n?"igo.geo.search.coordinates.reversedCoordDMS":"igo.geo.search.coordinates.coordDMS")]=me,{source:this,data:{type:Xt.R,projection:"EPSG:4326",geometry:fe,extent:void 0,properties:Object.assign(we,T,{GoogleMaps:To.getGoogleMapsCoordLink(f[0],f[1]),GoogleStreetView:To.getGoogleStreetViewLink(f[0],f[1]),OpenStreetMap:Sp.getOpenStreetMapLink(f[0],f[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:f[0].toString()+","+f[1].toString(),title:B}},meta:{dataType:Xt.R,id:f[0].toString()+","+f[1].toString(),title:B,titleHtml:B+Me,icon:"location_on",score:100}}}static \u0275fac=function(t){return new(t||Jn)(e.KVO("options"),e.KVO(y.gw),e.KVO(ao.n$),e.KVO("projections"))};static \u0275prov=e.jDH({token:Jn,factory:Jn.\u0275fac})}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[Array,Object,Boolean]),(0,Ot.Sn)("design:returntype",Jt.c)],Jn.prototype,"reverseSearch",null);var js=function(l){return l[l.ICherche=0]="ICherche",l[l.IChercheReverse=1]="IChercheReverse",l[l.Cadastre=2]="Cadastre",l[l.CoordinatesReverse=3]="CoordinatesReverse",l[l.ILayer=4]="ILayer",l[l.Nominatim=5]="Nominatim",l[l.StoredQueries=6]="StoredQueries",l[l.StoredQueriesReverse=7]="StoredQueriesReverse",l[l.Workspace=8]="Workspace",l}(js||{});function Tp(l){return new Sl(l)}var Bs=r(30699),Il=r(23984),On=r(12474);const Fl={"map-marker":"location_on",city:"location_city","flag-triangle":"flag","map-marker-alert":"fmd_bad","map-marker-radius":"pin_drop","map-marker-multiple":"local_post_office","map-legend":"map",bank:"account_balance","map-search":"search_insights","book-open-variant":"menu_book","office-building":"apartment","table-picnic":"table_restaurant",flash:"flash_on",engine:Zi.fB,"road-variant":"add_road","baby-face-outline":"child_care","home-account":"location_home",hospital:"local_hospital",pharmacy:"local_pharmacy","police-badge-outline":"local_police",parking:"local_parking",tree:"nature","home-city":"home_work",terrain:"landscape","panorama-horizontal":"panorama_horizontal"};let Lr=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(n){return new(n||l)(e.KVO(y.gw))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();class Mp{encodeKey(f){return encodeURIComponent(f)}encodeValue(f){return encodeURIComponent(f)}decodeKey(f){return decodeURIComponent(f)}decodeValue(f){return decodeURIComponent(f)}}class qo extends So.C{http;languageService;formatter;static id="icherche";static type=Xt.R;static propertiesBlacklist=[];title$=new ce.t("");hashtagsLieuxToKeep=[];get title(){return this.title$.getValue()}constructor(f,t,n,i,d,T){super(i,n),this.http=f,this.languageService=t,this.formatter=d;const B=T.get(Bs.uR);this.settings.length&&(B?B.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes()),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return qo.id}getType(){return qo.type}getDefaultOptions(){const f=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,n=this.options.params?.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"],i=this.options.showAdvancedSettings;return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==n.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==n.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==n.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:-1!==n.indexOf("bornes-cn"),hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==n.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:-1!==n.indexOf("cadastre"),hashtags:["cadastre"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==n.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==n.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.cycleStop",value:"haltes_cyclables",enabled:-1!==n.indexOf("haltes_cyclables"),hashtags:["haltevelo","haltes_cyclables"]},{title:"igo.geo.search.icherche.type.restArea",value:"haltes_routieres",enabled:-1!==n.indexOf("haltes_routieres"),hashtags:["halteroute","haltes_routieres"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:-1!==n.indexOf("hq"),hashtags:["hq"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:-1!==n.indexOf("intersections"),hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==n.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==n.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==n.indexOf("municipalites"),hashtags:["municipalit\xe9","mun"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==n.indexOf("regadmin"),hashtags:["r\xe9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:-1!==n.indexOf("bornes-gcc"),hashtags:["borne","bornes","rep\xe8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:-1!==n.indexOf("bornes-km"),hashtags:["borne","bornes","rep\xe8re","km"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==n.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:-1!==n.indexOf("sorties-autoroute"),hashtags:["sortie","sorties","exit"]},{title:"igo.geo.search.icherche.type.cultpatri",value:"culture",enabled:-1!==n.indexOf("culture"),hashtags:["grille","culture"]},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==n.indexOf("unites"),hashtags:["unites","adresse"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===f},{title:"5",value:5,enabled:5===f||!f},{title:"10",value:10,enabled:10===f},{title:"25",value:25,enabled:25===f},{title:"50",value:50,enabled:50===f}]},i&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t||!t},{title:"50 %",value:50,enabled:50===t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}].filter(Boolean)}}search(f,t){const n=this.computeRequestParams(f,t||{});return n.get("type").length?(this.options.params.page=n.get("page")||"1",this.getSearch(f,n)):(0,Xe.of)([])}getSearch(f,t){return this.http.get(`${this.searchUrl}/geocode`,{params:t}).pipe((0,g.T)(n=>this.extractResults(n,f)),(0,Be.W)(n=>{throw n.error.toDisplay=!0,n.error.title=this.languageService.translate.instant(this.getDefaultOptions().title),n}))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(f=>{const t=this.settings.find(n=>"type"===n.name);t.values.forEach(n=>{const i=new RegExp(`^${n.value}(\\.|$)`),d=f.filter(T=>i.test(T));n.available=d.length>0,"lieux"===n.value&&(this.hashtagsLieuxToKeep=[...new Set(d.map(T=>T.split(".")).reduce((T,B)=>T.concat(B)).filter(T=>"lieux"!==T))])}),this.setParamFromSetting(t,!1)})}computeRequestParams(f,t){const n=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(f,t||{}).params,{q:this.computeTerm(f),page:t.page});if("true"===n.loc){const[i,d,T,B]=t.extent;n.loc=`${i},${d};${T},${d};${T},${B};${i},${B};${i},${d}`}else"false"===n.loc&&delete n.loc;return/#[A-Za-z]+/.test(n.q)&&(n.type="lieux"),new u.Nl({fromObject:Et.BF.removeUndefined(n),encoder:new Mp})}extractResults(f,t){return f.features.map(n=>this.formatter.formatResult(this.dataToResult(n,t,f)))}dataToResult(f,t,n){const i=this.computeProperties(f),d=[this.getId(),i.type,i.code].join("."),T=f.highlight.title||f.properties.nom,B=f.highlight.title2?" <small> "+f.highlight.title2+"</small>":"",me=f.highlight.title3?"<br><small> "+f.highlight.title3+"</small>":"";let fe=f.icon;return"string"==typeof fe&&Object.keys(Fl).includes(fe)&&(fe=Fl[fe]),{source:this,data:{type:Xt.R,projection:"EPSG:4326",geometry:f.geometry,extent:f.bbox,properties:i,meta:{id:d,title:f.properties.nom}},meta:{dataType:Xt.R,id:d,title:f.properties.nom,titleHtml:T+B+me,icon:fe||"location_on",score:f.score||(0,On.H_)(t.trim(),f.properties.nom),nextPage:n.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}}computeProperties(f){const t=Et.BF.removeKeys(f.properties,qo.propertiesBlacklist);if(!f.geometry)return Object.assign({type:f.index},t);const n={GoogleMaps:""};let i,d;if("Point"===f.geometry.type)i=To.getGoogleMapsCoordLink(f.geometry.coordinates[0],f.geometry.coordinates[1]);else{const B=(0,Il.A)(f.geometry);i=To.getGoogleMapsCoordLink(B.geometry.coordinates[0],B.geometry.coordinates[1])}d=To.getGoogleMapsNameLink("routes"===f.index?f.properties.nom+", "+f.properties.municipalite:"municipalites"===f.index?f.properties.nom+", ville":"mrc"===f.index?"mrc+"+f.properties.nom:"regadmin"===f.index?f.properties.nom+",+QC":f.properties.nom||f.highlight.title),n.GoogleMaps="<a href="+i+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+d+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===f.geometry.type&&(n.GoogleStreetView=To.getGoogleStreetViewLink(f.geometry.coordinates[0],f.geometry.coordinates[1]));const T={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:f.index},t,n,T)}computeTerm(f){let n=!1;return n=(f.match(/(#[A-Za-z]+)/g)||[]).some(i=>{const d=String(i).substring(1);return this.hashtagsLieuxToKeep.some(T=>T.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),n||(f=f.replace(/(#[A-Za-z]+)/g,"")),f.replace(/[^\w\xc0-\xff !\-\+\(\)\.\/\xbd\xbc\xbe,'#]+/g,"")}computeOptionsParam(f,t){const n=super.getHashtagsValid(f,"type");return n&&(t.params=Object.assign(t.params||{},{type:n.join(",")})),t}static \u0275fac=function(t){return new(t||qo)(e.KVO(u.Qq),e.KVO(y.gw),e.KVO(ao.n$),e.KVO("options"),e.KVO(Lr),e.KVO(e.zZn))};static \u0275prov=e.jDH({token:qo,factory:qo.\u0275fac})}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20,cacheHasher:Et.lj}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[String,u.Nl]),(0,Ot.Sn)("design:returntype",Jt.c)],qo.prototype,"getSearch",null);class wn extends So.C{http;languageService;static id="icherchereverse";static type=Xt.R;static propertiesBlacklist=[];title$=new ce.t("");get title(){return this.title$.getValue()}constructor(f,t,n,i,d){super(i,n),this.http=f,this.languageService=t,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))});const T=d.get(Bs.uR);this.settings.length&&(T?T.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes())}getId(){return wn.id}getType(){return wn.type}getDefaultOptions(){const f=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==f.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==f.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==f.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==f.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==f.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==f.indexOf("regadmin")},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==f.indexOf("unites")}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}}reverseSearch(f,t){const n=this.computeRequestParams(f,t||{});return n.get("type").length?this.getReverseSearch(n):(0,Xe.of)([])}getReverseSearch(f){return this.http.get(`${this.searchUrl}/locate`,{params:f}).pipe((0,g.T)(t=>this.extractResults(t)))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(f=>{const t=this.settings.find(n=>"type"===n.name);t.values.forEach(n=>{n.available=f.indexOf(n.value)>-1}),this.setParamFromSetting(t,!1)})}computeRequestParams(f,t){return(t.distance||this.options.distance)&&(t.params=Object.assign(t.params||{},{bufferInput:t.distance||this.options.distance})),new u.Nl({fromObject:Object.assign({loc:f.join(","),sort:"distance",geometry:!0,icon:!0},t.params||{},this.params)})}extractResults(f){return f.features.map(t=>this.dataToResult(t))}getSubtitle(f){if(!this.settings.length)return"";let t="";if("arrondissements"===f.properties.type)t=f.properties.municipalite+" (Arrondissement)";else{const i=this.settings.find(d=>"type"===d.name).values.find(d=>d.value===f.properties.type);i&&(t=this.languageService.translate.instant(i.title))}return t}dataToResult(f){const t=this.computeProperties(f),n=this.computeExtent(f),i=[this.getId(),t.type,t.code].join("."),d=f.properties.nom,T=" <small> "+this.getSubtitle(f)+"</small>";return{source:this,data:{type:Xt.R,projection:"EPSG:4326",geometry:f.geometry,extent:n,properties:t,meta:{id:i,title:f.properties.nom}},meta:{dataType:Xt.R,id:i,title:f.properties.nom,titleHtml:d+T,icon:f.icon||"location_on",pointerSummaryTitle:this.getSubtitle(f)+": "+f.properties.nom}}}computeProperties(f){const t=Et.BF.removeKeys(f.properties,wn.propertiesBlacklist),n={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,n)}computeExtent(f){return f.bbox?[f.bbox[0],f.bbox[2],f.bbox[1],f.bbox[3]]:void 0}static \u0275fac=function(t){return new(t||wn)(e.KVO(u.Qq),e.KVO(y.gw),e.KVO(ao.n$),e.KVO("options"),e.KVO(e.zZn))};static \u0275prov=e.jDH({token:wn,factory:wn.\u0275fac})}function xp(l){return new Lr(l)}function Gs(){return{provide:Lr,useFactory:xp,deps:[y.gw]}}function Op(l,f,t,n,i,d){return new qo(l,f,t,n.getConfig(`searchSources.${qo.id}`),i,d)}function Ep(){return{kind:js.ICherche,providers:[{provide:So.C,useFactory:Op,multi:!0,deps:[u.Qq,y.gw,ao.n$,A.we,Lr,e.zZn]},Gs()]}}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20,cacheHasher:Et.lj}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[u.Nl]),(0,Ot.Sn)("design:returntype",Jt.c)],wn.prototype,"getReverseSearch",null);var Ml=r(81081),pn=r(84547);let Vs=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){const n=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],i=Object.entries(t.properties).filter(([T])=>-1!==n.indexOf(T)).reduce((T,B)=>{const[me,fe]=B;let we;try{we=this.languageService.translate.instant("igo.geo.search.ilayer.properties."+me)}catch{we=me}return T[we]=fe||"",T},{}),d=Object.assign({},t);return d.properties=i,d}static \u0275fac=function(n){return new(n||l)(e.KVO(y.gw))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();class Zn extends So.C{http;languageService;formatter;static id="ilayer";static type=Ml.I;title$=new ce.t("");get title(){return this.title$.getValue()}constructor(f,t,n,i,d){super(i,n),this.http=f,this.languageService=t,this.formatter=d,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return Zn.id}getType(){return Zn.type}getDefaultOptions(){const f=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===f},{title:"5",value:5,enabled:5===f||!f},{title:"10",value:10,enabled:10===f},{title:"25",value:25,enabled:25===f},{title:"50",value:50,enabled:50===f}]},this.options.showAdvancedSettings&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t},{title:"50 %",value:50,enabled:50===t||!t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]}].filter(Boolean)}}search(f,t){const n=this.computeSearchRequestParams(f,t||{});return n.get("q")&&n.get("type")?(this.options.params.page=n.get("page")||"1",this.getSearch(f,n)):(0,Xe.of)([])}getSearch(f,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,g.T)(n=>this.extractResults(n,f)))}computeSearchRequestParams(f,t){return new u.Nl({fromObject:Et.BF.removeUndefined(Object.assign({q:this.computeTerm(f)},this.params,this.computeOptionsParam(f,t||{}).params,{page:t.page}))})}computeTerm(f){return f.replace(/(#[^\s]*)/g,"").replace(/[^\w\xc0-\xff !\-\(\),'#]+/g,"")}computeOptionsParam(f,t){const n=super.getHashtagsValid(f,"type");return n&&(t.params=Object.assign(t.params||{},{type:n.join(",")})),t}extractResults(f,t){return f.items.map(n=>this.dataToResult(n,t,f))}dataToResult(f,t,n){const i=this.computeLayerOptions(f),d=f.highlight.title||f.properties.title,T=f.highlight.groupTitle||f.properties.groupTitle,B=T?' <small style="color: #6f6969"> '+T+"</small>":"";return{source:this,meta:{dataType:Ml.I,id:[this.getId(),f.properties.id].join("."),title:f.properties.title,titleHtml:d+B,icon:"Layer"===f.properties.type?"layers":"map",score:f.score||(0,On.H_)(t.trim(),f.properties.name),nextPage:n.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:i}}computeLayerOptions(f){const t=f.properties.url,n=this.extractQueryParamsFromSourceUrl(t);return Et.BF.removeUndefined({sourceOptions:{id:f.properties.id,type:f.properties.format,url:t,queryFormat:n.queryFormat,queryHtmlTarget:n.queryHtmlTarget,params:"wms"===f.properties.format?{LAYERS:f.properties.name}:void 0,layer:"wms"===f.properties.format?void 0:f.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:f.properties.title,maxResolution:(0,fo.HB)(Number(f.properties.maxScaleDenom)),minResolution:(0,fo.HB)(Number(f.properties.minScaleDenom)),metadata:{url:f.properties.metadataUrl,extern:!!f.properties.metadataUrl||void 0,abstract:f.properties.abstract||void 0},properties:this.formatter.formatResult(f).properties})}extractQueryParamsFromSourceUrl(f){let t,n;const i=this.options.queryFormat;if(i){for(const d of Object.keys(i)){const T=i[d];if("*"===T){t=pn.gv[d.toUpperCase()];break}const B=T.urls;if(Array.isArray(B)){B.forEach(me=>{-1!==f.indexOf(me)&&(t=pn.gv[d.toUpperCase()])});break}}(t===pn.gv.HTML||t===pn.gv.HTMLGML2)&&(n="iframe")}return{queryFormat:t,queryHtmlTarget:n}}static \u0275fac=function(t){return new(t||Zn)(e.KVO(u.Qq),e.KVO(y.gw),e.KVO(ao.n$),e.KVO("options"),e.KVO(Vs))};static \u0275prov=e.jDH({token:Zn,factory:Zn.\u0275fac})}function Pp(l){return new Vs(l)}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20,cacheHasher:Et.lj}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[String,u.Nl]),(0,Ot.Sn)("design:returntype",Jt.c)],Zn.prototype,"getSearch",null);let Ap=(()=>{class l{static forRoot(){return{ngModule:l,providers:[ks.S,Cl(),Gs(),{provide:Sl,useFactory:Tp,deps:[y.gw]},{provide:Vs,useFactory:Pp,deps:[y.gw]}]}}static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[hl,yl,fl,bl,hl,yl,fl,bl]})}return l})();new e.nKC("styleListOptions");var or=r(17041);function jp(l,f){if(1&l){const t=e.RV6();e.qex(0),e.j41(1,"span")(2,"mat-icon",6),e.EFF(3,"format_color_fill"),e.k0s(),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"igo-color-picker-form-field",11),e.bIt("colorChange",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.setLayerFillColor(i))}),e.k0s(),e.bVm()}2&l&&(e.R7$(4),e.SpI(" ",e.bMT(5,1,"igo.geo.style.fill")," "))}let Bp=(()=>{class l{dialogRef;formBuilder;data;confirmFlag=!1;form;styleModalData;linestringOnly;initialValues;defaultValues={fillColor:"rgba(255,255,255,0.4)",strokeColor:"rgba(143,7,7,1)"};get layerOlStyle(){const t=this.data.layer.ol.getStyle();return t instanceof Function?void 0:t.clone()}constructor(t,n,i){this.dialogRef=t,this.formBuilder=n,this.data=i}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.layer.ol.getSource().getFeatures())"LineString"!==t.getGeometry()?.getType()&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getLayerFillColor()],stroke:[this.getLayerStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()},this.initialValues={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()}}getLayerFillColor(){let t=this.defaultValues.fillColor;const n=this.layerOlStyle;if(n?.getFill()?.getColor()){const i=n.getFill().getColor();t=`rgba(${i[0]},${i[1]},${i[2]},${i[3]||.4})`}return t}getLayerStrokeColor(){let t=this.defaultValues.strokeColor;const n=this.layerOlStyle;if(n?.getStroke()?.getColor()){const i=n.getStroke().getColor();t=`rgba(${i[0]},${i[1]},${i[2]},${i[3]||1})`}return t}setLayerFillColor(t){const n=(0,or._j)(t),i=this.layerOlStyle.clone();i.getImage().getFill().setColor(n),i.getFill().setColor(n),this.data.layer.ol.setStyle(i),this.styleModalData.fillColor=t}setLayerStrokeColor(t){const n=(0,or._j)(t),i=this.layerOlStyle.clone();i.getImage().getStroke().setColor(n),i.getStroke().setColor(n),this.data.layer.ol.setStyle(i),this.styleModalData.strokeColor=t}cancel(){this.dialogRef.close(),this.setLayerFillColor(this.initialValues.fillColor),this.setLayerStrokeColor(this.initialValues.strokeColor)}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(n){return new(n||l)(e.rXU(Ct.CP),e.rXU(Q.ze),e.rXU(Ct.Vh))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-style-modal-layer"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.aNF],decls:20,vars:11,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"edit-colorpicker"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],[1,"stroke-palette-icon"],["formControlName","stroke",3,"colorChange"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["formControlName","fill",3,"colorChange"]],template:function(n,i){1&n&&(e.j41(0,"h2",0),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"div",1)(4,"div",2)(5,"form",3)(6,"div",4),e.DNE(7,jp,7,3,"ng-container",5),e.j41(8,"span")(9,"mat-icon",6),e.EFF(10,"border_color"),e.k0s(),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"igo-color-picker-form-field",7),e.bIt("colorChange",function(T){return i.setLayerStrokeColor(T)}),e.k0s()()()()(),e.j41(14,"div",8)(15,"button",9),e.bIt("click",function(){return i.cancel()}),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"button",10),e.bIt("click",function(){return i.confirm()}),e.EFF(19,"OK"),e.k0s()()),2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,5,"igo.geo.style.styleModal"),"\n"),e.R7$(4),e.Y8G("formGroup",i.form),e.R7$(2),e.Y8G("ngIf",!0!==i.linestringOnly),e.R7$(4),e.SpI(" ",e.bMT(12,7,"igo.geo.style.stroke")," "),e.R7$(5),e.SpI(" ",e.bMT(17,9,"igo.geo.style.cancel")," "))},dependencies:[Ct.BI,Ct.Yi,Q.YN,Q.qT,Q.BC,Q.cb,Q.X1,Q.j4,Q.JD,o.bT,R.m_,R.An,Wr,Ct.E7,L.Hl,L.$z,y.Ck,P.D9],styles:["h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}.color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}.color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.edit-colorpicker[_ngcontent-%COMP%]{padding:10px 0}button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),Gp=(()=>{class l{dialog;layer;constructor(t){this.dialog=t}openStyleModalDialog(){setTimeout(()=>{this.dialog.open(Bp,{disableClose:!1,data:{layer:this.layer},autoFocus:!1})},250)}static \u0275fac=function(n){return new(n||l)(e.rXU(Ct.bZ))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-style-modal-layer-button"]],inputs:{layer:"layer"},standalone:!0,features:[e.aNF],decls:4,vars:3,consts:[["mat-icon-button","","color","primary",3,"click","matTooltip"],[1,"style-icon"]],template:function(n,i){1&n&&(e.j41(0,"button",0),e.nI1(1,"translate"),e.bIt("click",function(){return i.openStyleModalDialog()}),e.j41(2,"mat-icon",1),e.EFF(3,"palette "),e.k0s()()),2&n&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.style.styleModalTooltipLayer"))},dependencies:[L.Hl,L.iY,v.uc,v.oV,R.m_,R.An,y.Ck,P.D9],changeDetection:0})}return l})();r(84133),r(63721);var wl=r(84374);let El=(()=>{class l{cdRef;layer;map;complete=new e.bkB;cancel=new e.bkB;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}onClose(){this.cancel.emit()}static \u0275fac=function(n){return new(n||l)(e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[e.aNF],decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(n,i){1&n&&e.nrm(0,"igo-ogc-filterable-item",0),2&n&&e.Y8G("layer",i.layer)("header",!1)("map",i.map)},dependencies:[Jo],changeDetection:0})}return l})(),Dl=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[El]})}return l})();const Rl=new e.nKC("OgcFilterWidget");function Vp(l){return l.create(El)}function Up(){return{provide:Rl,useFactory:Vp,deps:[wl.Cq]}}let Np=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({})}return l})(),Yp=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({providers:[Up()],imports:[wl.sQ,Dl,Np,Ct.hM,Dl]})}return l})();var Us=r(69243),Qn=r(19807),io=function(l){return l.Layer="layer",l.Group="group",l}(io||{}),$t=function(l){return l[l.wms=0]="wms",l[l.wmts=1]="wmts",l[l.baselayers=2]="baselayers",l[l.arcgisrest=3]="arcgisrest",l[l.tilearcgisrest=4]="tilearcgisrest",l[l.imagearcgisrest=5]="imagearcgisrest",l[l.composite=6]="composite",l}($t||{});class fi{id;title;url;removable;externalProvider;abstract;forcedProperties;items;type;version;matrixSet;requestEncoding;regFilters;groupImpose;groupSeparator;timeFilter;queryFormat;queryHtmlTarget;queryParams;sourceOptions;count;tooltipType;sortDirection;setCrossOriginAnonymous;showLegend;profils;constructor(f){Object.assign(this,f)}}class Wp extends fi{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=$t[$t[$t.wms]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Xp extends fi{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=$t[$t[$t.wmts]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Kp extends fi{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=$t[$t[$t.baselayers]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Hp extends fi{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=$t[$t[$t.arcgisrest]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Pl extends fi{_collectCatlogItems;constructor(f,t,n){super(f),this._collectCatlogItems=t,this.type=$t[$t[n]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class zp extends fi{_collectCatlogItems;constructor(f,t){super(f),this._collectCatlogItems=t,this.type=$t[$t[$t.composite]],this.url=null}collectCatalogItems(){return this._collectCatlogItems(this)}}let Jp=(()=>{class l{http;config;languageService;messageService;capabilitiesService;constructor(t,n,i,d,T){this.http=t,this.config=n,this.languageService=i,this.messageService=d,this.capabilitiesService=T}loadCatalogs(){const t=this.config.getConfig("context")||{},n=this.config.getConfig("catalog")||{},i=n.url||t.url,d=n.sources||[],T=[];if(i){if(n.baselayers){const we=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:`${i}/baselayers`,type:"baselayers"}];T.push((0,Xe.of)(we))}const B=this.http.get(`${i}/catalogs`).pipe((0,g.T)(me=>me.map(fe=>Object.assign(fe,fe.options))),(0,Be.W)(me=>Pr.w));T.push(B)}return d.length>0&&T.push((0,Xe.of)(d).pipe((0,g.T)(B=>B.map(me=>(me.id||(me.id=(0,Et.uR)()),me))))),(0,Us.y)(...T).pipe((0,g.T)(B=>[].concat.apply([],B)))}loadCatalogItems(t){let n;return n=$l.createInstanceCatalog(t,this),n.collectCatalogItems()}loadCatalogBaseLayerItems(t){return this.getCatalogBaseLayersOptions(t).pipe((0,g.T)(n=>{const i=n.map(d=>({id:(0,Qn._E)(d.sourceOptions),title:d.title,type:io.Layer,externalProvider:t.externalProvider,options:d}));return[{id:"catalog.group.baselayers",type:io.Group,externalProvider:t.externalProvider,title:t.title,items:i}]}))}getCatalogBaseLayersOptions(t){return this.http.get(t.url)}loadCatalogWMSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,g.T)(n=>{const i=[];if(!n)return i;n.Service&&n.Service.Abstract&&n.Service.Abstract.length&&(t.abstract=n.Service.Abstract);const d=[];this.flattenWmsCapabilities(n.Capability.Layer,0,d,t.groupSeparator);const T=Object.assign({},n.Capability.Layer);return T.Layer=d.filter(B=>0!==B.Layer.length),this.includeRecursiveItems(t,T,i),i}),(0,Be.W)(()=>(this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.title}),Pr.w)))}flattenWmsCapabilities(t,n=0,i,d=" / "){if(!i.includes(t.Title)){const T=Object.assign({},t);T.Layer=[],i.push(T)}for(const T of t.Layer){const B=Object.assign({},T);n>0&&(B.Title=t.Title+d+T.Title),T.Layer?this.flattenWmsCapabilities(B,n+1,i,d):i.find(me=>me.Title===t.Title).Layer.push(T)}}loadCatalogWMTSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,g.T)(n=>this.getWMTSItems(t,n)))}loadCatalogArcGISRestItems(t){return this.getCatalogCapabilities(t).pipe((0,g.T)(n=>this.getArcGISRESTItems(t,n)))}loadCatalogCompositeLayerItems(t){const n=t.composite,i=[];n.map(ke=>{ke.sortDirection=t.sortDirection,i.push($l.createInstanceCatalog(ke,this))});const d=[];i.map(ke=>d.push(ke.collectCatalogItems()));let T=[];function B(ke){return ke.reduce((Je,je)=>Je.concat(je.type===io.Group?B(je.items):je),[])}if(Object.keys(n).find(ke=>n[ke].groupImpose)){const ke=(Je,je)=>{const qe=i[je],lt=Object.assign({},qe.groupImpose);lt.address=qe.id,lt.type=io.Group,lt.externalProvider=qe.externalProvider,void 0===lt.sortDirection&&(lt.sortDirection=qe.sortDirection),lt.items=[];const bt=B(Je);return bt.map(Lt=>Lt.address=`${lt.address}.${lt.id}`),lt.items=bt,lt};T=d.map((Je,je)=>Je.pipe((0,g.T)(qe=>n[je].groupImpose?ke(qe,je):qe)))}else T=d;const me=(0,Us.y)(...T).pipe((0,g.T)(ke=>[].concat(...ke))),we=(ke,Je)=>ke.reduce((je,qe,lt,bt)=>{const Lt=Je(qe),po=Object.assign({},qe);if(qe.type===io.Layer){const Go=[],yi=[];if(bt.filter((Vo,en)=>{let vi=!1;return Vo.title===Lt&&Vo.type===io.Layer&&(en!==lt&&Vo.address!==qe.address&&(vi=!0),Go.push(en)),vi}).length>0){let Vo=Go.findIndex(en=>en===lt)+1;po.title=`${qe.title} (${Vo})`,Vo=yi.findIndex(en=>en===lt)+1,po.newMetadataUrl=`${qe.newMetadataUrl} (${Vo})`}je.find(Vo=>Vo.title===po.title&&Vo.type===io.Layer)||(je[je.length]=po)}else qe.type===io.Group&&(po.items=we(qe.items,Go=>Go.title),je[je.length]=po);return je},[]);return me.pipe((0,g.T)(ke=>((ke,Je)=>ke.reduce((je,qe)=>{const lt=(Je=>Je.id)(qe),bt=je.find(Lt=>Lt.id===lt);if(bt){const Lt=je.indexOf(bt);-1===je[Lt].address.split("|").indexOf(qe.address)&&(je[Lt].address=`${je[Lt].address}|${qe.address}`),je[Lt].items.push(...qe.items)}else je[je.length]=qe;return je},[]))(ke)),(0,g.T)(ke=>[].concat(...ke)),(0,g.T)(ke=>we(ke,Je=>Je.title)))}getCatalogCapabilities(t){return this.capabilitiesService.getCapabilities($t[t.type],t.url,t.version).pipe((0,Be.W)(i=>(this.messageService.error(t.title?"igo.geo.catalog.unavailable":"igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle",void 0,t.title?{value:t.title}:void 0),console.error(i),(0,Xe.of)(void 0))))}computeForcedProperties(t,n){if(!n||0===n.length)return;const i={layerName:t,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},d=n.find(T=>"*"===T.layerName);return d&&(d.metadataAbstractAll&&(i.metadataAbstractAll=d.metadataAbstractAll),d.metadataUrlAll&&(i.metadataUrlAll=d.metadataUrlAll)),n.map(T=>{t===T.layerName&&(T.title&&(i.title=T.title),T.metadataUrl&&(i.metadataUrl=T.metadataUrl),T.metadataAbstract&&(i.metadataAbstract=T.metadataAbstract))}),i}prepareCatalogItemLayer(t,n,i,d){const T=this.retrieveLayerInfoFormat(t.Name,i),B=d.showLegend&&t.Style?this.capabilitiesService.getStyle(t.Style):void 0,me=Object.assign({},d.queryParams,{LAYERS:t.Name,VERSION:d.version}),fe={type:"wms",url:d.url,crossOrigin:d.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:T,queryHtmlTarget:T===pn.gv.HTML||T===pn.gv.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},we=Object.assign({},fe,d.sourceOptions,{params:me}),Me=this.computeForcedProperties(t.Name,d.forcedProperties);let ke,Je=!0;t.Abstract?ke=t.Abstract:!t.Abstract&&d.abstract&&(ke=d.abstract);const je=t?.DataURL&&t?.DataURL.length>0?t?.DataURL[0].OnlineResource:void 0;let qe=Me?.metadataUrl||Me?.metadataUrlAll||je,lt=Me?.metadataAbstract||Me?.metadataAbstractAll||ke;!Me?.metadataUrl&&!Me?.metadataUrlAll&&(Me?.metadataAbstract||Me?.metadataAbstractAll)&&(Je=!1),Me?.metadataAbstract&&Me?.metadataUrlAll&&(Je=!1);const bt={id:(0,Qn._E)(we),type:io.Layer,title:Me?.title?Me.title:t.Title,address:n,externalProvider:d.externalProvider||!1,options:{maxResolution:(0,fo.HB)(t.MaxScaleDenominator),minResolution:(0,fo.HB)(t.MinScaleDenominator),metadata:{url:qe,extern:Je,abstract:lt,type:fe.type},legendOptions:B,tooltip:{type:d.tooltipType},sourceOptions:we}};return Et.BF.removeUndefined(bt)}prepareCatalogItemGroup(t,n,i,d,T){return{id:i,type:io.Group,title:t.Title,address:T.id,externalProvider:T.externalProvider||!1,sortDirection:T.sortDirection,items:t.Layer.reduce((me,fe)=>{if(void 0!==fe.Layer){const Me=this.prepareCatalogItemGroup(fe,n,i+`.group.${fe.Name||fe.Layer[0].Name}`,d,T);me.push(Me)}else{if(!1===this.testLayerRegexes(fe.Name,n))return me;const we=this.prepareCatalogItemLayer(fe,i,d,T);me.push(we)}return me},[])}}includeRecursiveItems(t,n,i,d=0){const T=(t.regFilters||[]).map(B=>new RegExp(B));if(n.Layer)for(const B of n.Layer){if(void 0!==B.Layer){this.includeRecursiveItems(t,B,i,d+1);continue}const me=this.findCatalogInfoFormat(t);if(0!==d){const we=this.prepareCatalogItemGroup(n,T,`catalog.group.${n.Name||B.Name}`,me,t);0!==we.items.length&&i.push(we);break}if(!1!==this.testLayerRegexes(B.Name,T)){const fe=this.prepareCatalogItemLayer(B,t.id,me,t);i.push(fe)}}}getWMTSItems(t,n){if(!n)return[];const i=n.Contents.Layer,d=(t.regFilters||[]).map(T=>new RegExp(T));return n.ServiceIdentification&&n.ServiceIdentification.Abstract&&n.ServiceIdentification.Abstract.length&&(t.abstract=n.ServiceIdentification.Abstract),i.map(T=>{const B=this.computeForcedProperties(T.Title,t.forcedProperties);let me=!0,fe=B?.metadataUrl||B?.metadataUrlAll,we=B?.metadataAbstract||B?.metadataAbstractAll||t.abstract;if(!B?.metadataUrl&&!B?.metadataUrlAll&&(B?.metadataAbstract||B?.metadataAbstractAll)&&(me=!1),B?.metadataAbstract&&B?.metadataUrlAll&&(me=!1),!1===this.testLayerRegexes(T.Identifier,d))return;const Me=Object.assign({},t.queryParams,{version:"1.0.0"}),ke={type:"wmts",url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:T.Identifier,matrixSet:t.matrixSet,optionsFromCapabilities:!0,requestEncoding:t.requestEncoding||"KVP",style:"default"},Je=Object.assign({},ke,t.sourceOptions,{params:Me});return Et.BF.removeUndefined({id:(0,Qn._E)(Je),type:io.Layer,title:B?.title?B.title:T.Title,address:t.id,externalProvider:t.externalProvider,options:{sourceOptions:Je,metadata:{url:fe,extern:me,abstract:we,type:ke.type}}})}).filter(T=>void 0!==T)}getArcGISRESTItems(t,n){if(!n||!n.layers)return this.messageService.error("igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle"),[];const i=n.layers?n.layers.filter(Me=>Me.subLayerIds):[],d=n.layers?n.layers.filter(Me=>!Me.type||Me.type===Nt.K.FeatureLayer||Me.type===Nt.K.RasterLayer):[],T=(t.regFilters||[]).map(Me=>new RegExp(Me));let B;n.serviceDescription&&n.serviceDescription.length&&(B=n.serviceDescription.replace(/(<([^>]+)>)/gi,""));const me=d.map(Me=>{const ke=this.computeForcedProperties(Me.name,t.forcedProperties);let Je=t.abstract,je=!0,qe=ke?.metadataUrl||ke?.metadataUrlAll,lt=ke?.metadataAbstract||ke?.metadataAbstractAll||Je;if(!ke?.metadataUrl&&!ke?.metadataUrlAll&&(ke?.metadataAbstract||ke?.metadataAbstractAll)&&(je=!1),ke?.metadataAbstract&&ke?.metadataUrlAll&&(je=!1),!1===this.testLayerRegexes(Me.id.toString(),T))return;const bt={type:$t[t.type],url:t.url,layer:Me.id.toString(),queryable:!0,queryFormat:pn.gv.ESRIJSON,optionsFromCapabilities:!0},Lt=Object.assign({},bt,t.sourceOptions);return Et.BF.removeUndefined({id:(0,Qn._E)(Lt),type:io.Layer,title:ke?.title?ke.title:Me.name,externalProvider:t.externalProvider,options:{sourceOptions:Lt,minResolution:(0,fo.HB)(Me.maxScale),maxResolution:(0,fo.HB)(Me.minScale),metadata:{url:qe,extern:je,abstract:lt,type:t.type}}})}).filter(Me=>void 0!==Me),fe=[],we=i.map(Me=>({options:void 0,address:`catalog.group.${Me.name}`,id:`catalog.group.${Me.name}`,type:io.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:Me.name,items:me.filter(ke=>Me.subLayerIds.map(je=>je.toString()).includes(ke.options.sourceOptions.layer)).map(ke=>(fe.push(ke.id),Object.assign({},ke,{address:`catalog.group.${Me.name}`})))})).filter(Me=>Me.items.length);if(i){const Me=t.title||t.id,ke=me.filter(Je=>!fe.includes(Je.id)).map(Je=>Object.assign({},Je,{address:`catalog.group.${Me}`}));ke.length&&we.push({options:void 0,address:`catalog.group.${Me}`,id:`catalog.group.${Me}`,type:io.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:Me,items:ke})}return i?we:me}testLayerRegexes(t,n){return 0===n.length||void 0!==n.find(i=>i.test(t))}retrieveLayerInfoFormat(t,n){const i=n.find(B=>B.layer===t),d=n.find(B=>"*"===B.layer);let T;return i?T=i.queryFormat:d&&(T=d.queryFormat),T}findCatalogInfoFormat(t){const n=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(i=>{t.queryFormat[i]instanceof Array?t.queryFormat[i].forEach(d=>{n.find(T=>T.layer===d)||n.push({layer:d,queryFormat:i})}):n.find(d=>d.layer===t.queryFormat[i])||n.push({layer:t.queryFormat[i],queryFormat:i})}),n}static \u0275fac=function(n){return new(n||l)(e.KVO(u.Qq),e.KVO(A.we),e.KVO(y.gw),e.KVO(k.bg),e.KVO(rt.w))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class $l{static createInstanceCatalog(f,t){let n;return n=f.hasOwnProperty("composite")?new zp(f,i=>t.loadCatalogCompositeLayerItems(i)):f.type===$t[$t.baselayers]?new Kp(f,i=>t.loadCatalogBaseLayerItems(i)):f.type===$t[$t.arcgisrest]?new Hp(f,i=>t.loadCatalogArcGISRestItems(i)):f.type===$t[$t.tilearcgisrest]?new Pl(f,i=>t.loadCatalogArcGISRestItems(i),$t.tilearcgisrest):f.type===$t[$t.imagearcgisrest]?new Pl(f,i=>t.loadCatalogArcGISRestItems(i),$t.imagearcgisrest):f.type===$t[$t.wmts]?new Xp(f,i=>t.loadCatalogWMTSLayerItems(i)):new Wp(f,i=>t.loadCatalogWMSLayerItems(i)),n}}var Ns=r(24371);function Zp(l,f){1&l&&e.nrm(0,"mat-icon",10)}function Qp(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",11)(1,"mat-icon",12),e.nI1(2,"translate"),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.EFF(3," public "),e.k0s()()}2&l&&(e.R7$(),e.Y8G("matTooltip",e.bMT(2,1,"igo.geo.catalog.externalProvider.layer")))}function qp(l,f){if(1&l&&(e.nrm(0,"igo-layer-legend",5),e.nI1(1,"async")),2&l){const t=e.XpG();e.Y8G("layer",e.bMT(1,1,t.igoLayer$))}}let Ll=(()=>{class l{layerService;inRange$=new ce.t(!0);isPreview$=new ce.t(!1);isVisible$=new ce.t(!1);isPreview$$;resolution$$;layers$$;lastTimeoutRequest;layerLegendShown$=new ce.t(!1);igoLayer$=new ce.t(void 0);mouseInsideAdd=!1;resolution;catalogAllowLegend=!1;layer;map;added=!1;addedChange=new e.bkB;addedLayerIsPreview=new e.bkB;get title(){return(0,Ne.k0)(this.layer)}get icon(){return(0,Ne.Zq)(this.layer)||"layers"}constructor(t){this.layerService=t}ngOnInit(){this.isPreview$$=this.isPreview$.subscribe(t=>this.addedLayerIsPreview.emit(t)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.isPreview$$.unsubscribe(),this.resolution$$.unsubscribe(),this.layers$$.unsubscribe()}computeTitleTooltip(){const t=this.layer.options;if(!t.tooltip)return(0,Ne.k0)(this.layer);const n=t.tooltip,i=t.metadata;switch(t.tooltip.type){case Ns.Ib.TITLE:return this.layer.title;case Ns.Ib.ABSTRACT:return i&&i.abstract?i.abstract:this.layer.title;case Ns.Ib.CUSTOM:return n&&n.text?n.text:this.layer.title;default:return this.layer.title}}onMouseEvent(t){this.onToggleClick(t)}askForLegend(t){this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe((0,pi.$)()).subscribe(n=>this.igoLayer$.next(n))}onToggleClick(t){if(typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove(t):this.add(t)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(t),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(t),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer,event:t}))}remove(t){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer,event:t}))}haveGroup(){return!(!this.layer.address||1===this.layer.address.split(".").length)}isInResolutionsRange(t){const n=!this.layer.options.minResolution||Number.isNaN(this.layer.options.minResolution)?0:this.layer.options.minResolution,i=!this.layer.options.maxResolution||Number.isNaN(this.layer.options.maxResolution)?1/0:this.layer.options.maxResolution;this.inRange$.next(t>=n&&t<=i)}isVisible(){if(this.layer?.id){const t=this.map.getLayerById(this.layer?.id);this.isVisible$.next(!!t&&t.visible)}}getBadgeIcon(){return this.inRange$.getValue()&&this.isVisible$.getValue()?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}static \u0275fac=function(n){return new(n||l)(e.rXU(Ir.B))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",map:"map",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},standalone:!0,features:[e.aNF],decls:24,vars:36,consts:[["legend",""],["class","catalog-browser-layer-carret","matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"click","ngClass","matTooltip"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"mouseenter","mouseleave","click","matTooltip","color"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],[1,"igo-cataloglayer-legend-container"],[3,"layer",4,"ngIf"],["matListItemIcon","",1,"catalog-browser-layer-carret"],["disabled","true","mat-icon-button",""],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloglayer-external-icon",3,"click","matTooltip"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"mat-list-item"),e.DNE(1,Zp,1,0,"mat-icon",1),e.j41(2,"span",2),e.bIt("click",function(B){return e.eBV(d),e.Njj(i.askForLegend(B))}),e.EFF(3),e.k0s(),e.j41(4,"div",3),e.DNE(5,Qp,4,3,"button",4),e.nrm(6,"igo-metadata-button",5),e.j41(7,"button",6),e.nI1(8,"translate"),e.nI1(9,"async"),e.bIt("mouseenter",function(B){return e.eBV(d),e.Njj(i.onMouseEvent(B))})("mouseleave",function(B){return e.eBV(d),e.Njj(i.onMouseEvent(B))})("click",function(B){return e.eBV(d),e.Njj(i.onToggleClick(B))}),e.j41(10,"mat-icon",7),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"async"),e.nI1(14,"async"),e.nI1(15,"async"),e.nI1(16,"async"),e.EFF(17),e.nI1(18,"async"),e.k0s()()()(),e.j41(19,"div",8,0),e.DNE(21,qp,2,3,"igo-layer-legend",9),e.nI1(22,"async"),e.nI1(23,"async"),e.k0s()}2&n&&(e.R7$(),e.Y8G("ngIf",i.haveGroup()),e.R7$(),e.Y8G("ngClass",i.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",i.computeTitleTooltip()),e.R7$(),e.SpI(" ",i.title," "),e.R7$(2),e.Y8G("ngIf",i.layer.externalProvider),e.R7$(),e.Y8G("layer",i.layer),e.R7$(),e.Y8G("matTooltip",e.bMT(8,14,i.computeTooltip()))("color",e.bMT(9,16,i.isPreview$)?"":i.added?"warn":""),e.R7$(3),e.Y8G("igoMatBadgeIcon",i.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",e.bMT(11,18,i.inRange$)&&!0===e.bMT(12,20,i.isVisible$)||e.bMT(13,22,i.inRange$)&&!i.added||e.bMT(14,24,i.inRange$)&&e.bMT(15,26,i.isPreview$))("matBadgeDisabled",!1===e.bMT(16,28,i.inRange$)),e.R7$(7),e.SpI(" ",e.bMT(18,30,i.isPreview$)?"plus":i.added?"delete":"add"," "),e.R7$(4),e.Y8G("ngIf",e.bMT(22,32,i.layerLegendShown$)&&e.bMT(23,34,i.igoLayer$)&&i.catalogAllowLegend))},dependencies:[de.Fg,de.YE,de.ZV,de.yE,de.BJ,o.bT,R.m_,R.An,o.YU,v.uc,v.oV,L.Hl,L.iY,Rs,E.Y,E.k,ll.V,to,o.Jj,y.Ck,P.D9],styles:[".igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.catalog-browser-layer-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function ed(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-icon",10),e.nI1(1,"translate"),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.EFF(2," public "),e.k0s()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.catalog.externalProvider.group"))}function td(l,f){if(1&l&&(e.j41(0,"button",8),e.DNE(1,ed,3,3,"mat-icon",9),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.group.externalProvider)}}function od(l,f){if(1&l){const t=e.RV6();e.qex(0),e.j41(1,"button",11),e.nI1(2,"translate"),e.nI1(3,"async"),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onToggleClick(i))}),e.j41(4,"mat-icon"),e.EFF(5,"delete"),e.k0s()(),e.bVm()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("matTooltip",e.bMT(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",e.bMT(3,4,t.disabled$))}}function nd(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",12),e.nI1(1,"translate"),e.nI1(2,"async"),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onToggleClick(i))}),e.j41(3,"mat-icon"),e.EFF(4,"add"),e.k0s()()}if(2&l){const t=e.XpG();e.Y8G("matTooltip",e.bMT(1,2,"igo.geo.catalog.group.addToMap"))("disabled",e.bMT(2,4,t.disabled$))}}function id(l,f){1&l&&e.eu8(0)}function rd(l,f){if(1&l){const t=e.RV6();e.qex(0),e.j41(1,"igo-catalog-browser-layer",14),e.bIt("addedLayerIsPreview",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onLayerPreview(i))})("addedChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onLayerAddedChange(i))}),e.k0s(),e.bVm()}if(2&l){const t=e.XpG().$implicit,n=e.XpG();e.R7$(),e.Y8G("layer",t)("resolution",n.resolution)("map",n.map)("catalogAllowLegend",n.catalogAllowLegend)("added",n.state.get(t).added)}}function sd(l,f){if(1&l&&e.DNE(0,id,1,0,"ng-container",13)(1,rd,2,5,"ng-container",13),2&l){const t=f.$implicit,n=e.XpG();e.Y8G("ngIf",n.isGroup(t)),e.R7$(),e.Y8G("ngIf",n.isLayer(t))}}let ad=(()=>{class l{store=new Ne.D_([]);added$=new ce.t(!1);preview$=new ce.t(!1);disabled$=new ce.t(!1);catalog;group;map;collapsed=!0;resolution;catalogAllowLegend=!1;toggleCollapsed=!0;state;addedChange=new e.bkB;layerAddedChange=new e.bkB;get title(){return this.group.title}ngOnInit(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),void 0!==this.group.sortDirection&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:t=>t.title})}ngOnDestroy(){this.store.destroy()}isGroup(t){return t.type===io.Group}isLayer(t){return t.type===io.Layer}onToggleClick(t){this.added$.value?this.remove(t):this.add(t)}onToggleCollapsed(t){this.evaluateDisabled(t)}onLayerAddedChange(t){this.layerAddedChange.emit(t),this.tryToggleGroup(t)}add(t){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group,event:t})}remove(t){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group,event:t})}onLayerPreview(t){this.preview$.next(t)}tryToggleGroup(t){const n=t.added,i=t.layer;this.store.view.all().filter(T=>T.id!==i.id).map(T=>this.state.get(T).added||!1).every(T=>T===n)?n?this.add(t.event):this.remove(t.event):!0===this.added$.value&&this.added$.next(!1)}evaluateAdded(){const t=this.store.all().every(n=>!0===(this.state.get(n).added||!1));this.added$.next(t)}evaluateDisabled(t){let n=!1;!1===this.toggleCollapsed&&(n=t),this.disabled$.next(n)}onTitleClick(){this.collapsed=!this.collapsed}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",map:"map",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},standalone:!0,features:[e.aNF],decls:16,vars:14,consts:[["notadded",""],["items",""],["matListItemIcon","","igoCollapse","",1,"igo-chevron","catalog-browser-group-carret",3,"toggle","target","collapsed"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"click","matTooltip"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloggroup-external-icon",3,"click","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip","disabled"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","disabled"],[4,"ngIf"],["igoListItem","",3,"addedLayerIsPreview","addedChange","layer","resolution","map","catalogAllowLegend","added"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"mat-list-item")(1,"mat-icon",2),e.bIt("toggle",function(B){return e.eBV(d),e.Njj(i.onToggleCollapsed(B))}),e.EFF(2," expand_less "),e.k0s(),e.j41(3,"span",3),e.bIt("click",function(){return e.eBV(d),e.Njj(i.onTitleClick())}),e.EFF(4),e.k0s(),e.j41(5,"div",4),e.DNE(6,td,2,1,"button",5)(7,od,6,6,"ng-container",6),e.nI1(8,"async"),e.nI1(9,"async"),e.DNE(10,nd,5,6,"ng-template",null,0,e.C5r),e.k0s()(),e.j41(12,"div",null,1),e.DNE(14,sd,2,2,"ng-template",7),e.nI1(15,"async"),e.k0s()}if(2&n){const d=e.sdS(11),T=e.sdS(13);e.R7$(),e.Y8G("target",T)("collapsed",i.collapsed),e.R7$(2),e.Y8G("matTooltip",i.title),e.R7$(),e.JRh(i.title),e.R7$(2),e.Y8G("ngIf",i.group.externalProvider),e.R7$(),e.Y8G("ngIf",e.bMT(8,8,i.added$)&&!1===e.bMT(9,10,i.preview$))("ngIfElse",d),e.R7$(7),e.Y8G("ngForOf",e.bMT(15,12,i.store.view.all$()))}},dependencies:[de.Fg,de.YE,de.ZV,de.yE,de.BJ,R.m_,R.An,ue.Dc,v.uc,v.oV,o.bT,L.Hl,L.iY,o.pM,Ll,s.dF,o.Jj,y.Ck,P.D9],styles:[".igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}.catalog-browser-group-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-catalog-group-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function ld(l,f){if(1&l){const t=e.RV6();e.qex(0),e.j41(1,"igo-catalog-browser-group",3),e.nI1(2,"async"),e.bIt("addedChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onGroupAddedChange(i))})("layerAddedChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onLayerAddedChange(i))}),e.k0s(),e.bVm()}if(2&l){const t=e.XpG().$implicit,n=e.XpG();e.R7$(),e.Y8G("catalog",n.catalog)("group",t)("map",n.map)("state",n.store.state)("resolution",e.bMT(2,8,n.resolution$))("catalogAllowLegend",n.catalogAllowLegend)("collapsed",1!==n.store.count)("toggleCollapsed",n.toggleCollapsedGroup)}}function cd(l,f){if(1&l){const t=e.RV6();e.qex(0),e.j41(1,"igo-catalog-browser-layer",4),e.nI1(2,"async"),e.bIt("addedChange",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.onLayerAddedChange(i))}),e.k0s(),e.bVm()}if(2&l){const t=e.XpG().$implicit,n=e.XpG();e.R7$(),e.Y8G("layer",t)("map",n.map)("resolution",e.bMT(2,5,n.resolution$))("catalogAllowLegend",n.catalogAllowLegend)("added",n.store.state.get(t).added)}}function ud(l,f){if(1&l&&e.DNE(0,ld,3,10,"ng-container",2)(1,cd,3,7,"ng-container",2),2&l){const t=f.$implicit,n=e.XpG();e.Y8G("ngIf",n.isGroup(t)),e.R7$(),e.Y8G("ngIf",n.isLayer(t))}}let Al=(()=>{class l{layerService;cdRef;watcher;get resolution$(){return this.map.viewController.resolution$}catalogAllowLegend=!1;catalog;store;map;toggleCollapsedGroup=!0;constructor(t,n){this.layerService=t,this.cdRef=n}ngOnInit(){const t=this.map.layers.map(i=>({id:i.options.source.id,title:i.title,type:io.Layer}));this.store.state.updateMany(t,{added:!0},!0),this.catalog&&void 0!==this.catalog.sortDirection&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:i=>i.title}),this.catalogAllowLegend=!!this.catalog&&this.catalog.showLegend||this.catalogAllowLegend,this.watcher=new Ne.bz(this.store,this.cdRef)}ngOnDestroy(){this.watcher.destroy()}isGroup(t){return t.type===io.Group}isLayer(t){return t.type===io.Layer}onLayerAddedChange(t){const n=t.layer;this.store.state.update(n,{added:t.added},!1),t.added?this.addLayerToMap(n,t):this.removeLayerFromMap(n)}onGroupAddedChange(t){const n=t.group;this.store.state.update(n,{added:t.added},!1),t.added?this.addGroupToMap(n,t):this.removeGroupFromMap(n)}addLayerToMap(t,n){this.addLayersToMap([t],n)}removeLayerFromMap(t){this.removeLayersFromMap([t])}addLayersToMap(t,n){const i=t.map(d=>(d.options.sourceOptions.optionsFromApi||(d.options.sourceOptions.optionsFromApi=!0),this.catalog.profils?.length&&(d.options.security={profils:this.catalog.profils}),this.layerService.createAsyncLayer(d.options)));(0,Us.y)(...i).subscribe(d=>{"click"===n.event.type&&n.added&&this.map.layersAddedByClick$.next(d),this.store.state.updateMany(d,{added:!0}),this.map.addLayers(d)})}removeLayersFromMap(t){t.forEach(n=>{if(this.store.state.update(n,{added:!1}),!0===n.options.baseLayer){const i=this.map.getLayerById(n.options.id);void 0!==i&&this.map.removeLayer(i)}else{const i=this.map.getLayerById(n.id);void 0!==i&&this.map.removeLayer(i)}})}sortCatalogItemsByTitle(t,n){const i=t.sort((d,T)=>{const B=d.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),me=T.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return B<me?-1:B>me?1:0});switch(n){case"asc":return i;case"desc":return i.reverse();default:return t}}addGroupToMap(t,n){let i=t.items.filter(d=>{const T=this.store.state.get(d).added||!1;return this.isLayer(d)&&!1===T});void 0!==t.sortDirection&&(i=this.sortCatalogItemsByTitle(i,t.sortDirection)),this.addLayersToMap(i.reverse(),n)}removeGroupFromMap(t){const n=t.items.filter(i=>{const d=this.store.state.get(i).added||!1;return this.isLayer(i)&&!0===d});this.removeLayersFromMap(n)}static \u0275fac=function(n){return new(n||l)(e.rXU(Ir.B),e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[e.aNF],decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"addedChange","layerAddedChange","catalog","group","map","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed"],["igoListItem","",3,"addedChange","layer","map","resolution","catalogAllowLegend","added"]],template:function(n,i){1&n&&(e.j41(0,"igo-list",0),e.DNE(1,ud,2,2,"ng-template",1),e.nI1(2,"async"),e.k0s()),2&n&&(e.Y8G("navigation",!1)("selection",!1),e.R7$(),e.Y8G("ngForOf",e.bMT(2,3,i.store.view.all$())))},dependencies:[s.sB,o.pM,o.bT,ad,Ll,s.dF,o.Jj],encapsulation:2,changeDetection:0})}return l})();const pd=(l,f)=>({value:l,email:f}),dd=l=>({value:l});function md(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("matTooltip",t.title)("value",t),e.R7$(),e.SpI(" ",t.title," ")}}function gd(l,f){if(1&l&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("matTooltip",t.url)("value",t),e.R7$(),e.SpI(" ",t.url," ")}}function hd(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-option",18),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.j41(1,"p",19),e.EFF(2),e.k0s()()}if(2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(2),e.JRh(t)}}function fd(l,f){if(1&l&&(e.j41(0,"span")(1,"p",20),e.EFF(2),e.k0s()()),2&l){const t=e.XpG();e.R7$(2),e.SpI(" ",t.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",e.l_i(1,pd,t.addedCatalog.url,t.emailAddress))," ")}}function _d(l,f){if(1&l&&(e.j41(0,"span")(1,"p",20),e.EFF(2),e.k0s()()),2&l){const t=e.XpG();e.R7$(2),e.SpI(" ",t.languageService.translate.instant("igo.geo.catalog.unavailable",e.eq3(1,dd,t.addedCatalog.url))," ")}}let kl=(()=>{class l{formBuilder;languageService;configService;dialogRef;data;form;defaultAddedCatalogType="wms";addedCatalogType$$;predefinedCatalogsList$=new ce.t([]);typeCapabilities;predefinedCatalogs=[];store;error=!1;addedCatalog;emailAddress;storeViewAll$$;constructor(t,n,i,d,T){this.formBuilder=t,this.languageService=n,this.configService=i,this.dialogRef=d,this.data=T,this.store=T.store,this.predefinedCatalogs=T.predefinedCatalogs,this.error=T.error,this.addedCatalog=T.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[Q.k0.required]],type:[this.defaultAddedCatalogType,[Q.k0.required]]})}ngOnInit(){this.store.state.clear(),this.typeCapabilities=Object.keys(Nt.T),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(t=>{"wmts"===t?this.form.get("title").setValidators(Q.k0.required):this.form.get("title").setValidators([]),this.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(()=>this.computePredefinedCatalogList()),this.emailAddress=this.configService.getConfig("emailAddress")}ngOnDestroy(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}changeUrlOrTitle(t){this.form.patchValue(t),this.error=!1,this.computePredefinedCatalogList()}computePredefinedCatalogList(){this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(t=>!this.store.get(t.id)))}addCatalog(t){this.error=!1,this.dialogRef.close(t)}cancel(){this.error=!1,this.dialogRef.close()}static \u0275fac=function(n){return new(n||l)(e.rXU(Q.ze),e.rXU(y.gw),e.rXU(A.we),e.rXU(Ct.CP),e.rXU(Ct.Vh,8))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-add-catalog-dialog"]],standalone:!0,features:[e.aNF],decls:34,vars:25,consts:[["auto2","matAutocomplete"],["auto","matAutocomplete"],["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"click","disabled"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"click","value"],["matListItemTitle",""],[1,"error"]],template:function(n,i){if(1&n){const d=e.RV6();e.j41(0,"h1",2),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"div",3)(4,"form",4)(5,"div",5)(6,"mat-form-field"),e.nrm(7,"input",6),e.nI1(8,"translate"),e.j41(9,"mat-autocomplete",7,0),e.bIt("optionSelected",function(B){return e.eBV(d),e.Njj(i.changeUrlOrTitle(B.option.value))}),e.DNE(11,md,2,3,"mat-option",8),e.nI1(12,"async"),e.k0s()()(),e.j41(13,"div",5)(14,"mat-form-field"),e.nrm(15,"input",9),e.j41(16,"mat-autocomplete",7,1),e.bIt("optionSelected",function(B){return e.eBV(d),e.Njj(i.changeUrlOrTitle(B.option.value))}),e.DNE(18,gd,2,3,"mat-option",8),e.nI1(19,"async"),e.k0s()()(),e.j41(20,"div",5)(21,"mat-form-field")(22,"mat-select",10),e.DNE(23,hd,3,2,"mat-option",11),e.k0s()()()(),e.DNE(24,fd,3,4,"span",12)(25,_d,3,3,"span",12),e.k0s(),e.j41(26,"div",13)(27,"div",14)(28,"button",15),e.bIt("click",function(){return e.eBV(d),e.Njj(i.cancel())}),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"button",16),e.bIt("click",function(){return e.eBV(d),e.Njj(i.addCatalog(i.form.value))}),e.EFF(32),e.nI1(33,"translate"),e.k0s()()()}if(2&n){const d=e.sdS(10),T=e.sdS(17);e.R7$(),e.SpI(" ",e.bMT(2,13,"igo.geo.catalog.library.addTitle"),"\n"),e.R7$(3),e.Y8G("formGroup",i.form),e.R7$(3),e.FS9("placeholder",e.bMT(8,15,"igo.geo.printForm.title")),e.Y8G("matAutocomplete",d),e.R7$(4),e.Y8G("ngForOf",e.bMT(12,17,i.predefinedCatalogsList$)),e.R7$(4),e.Y8G("matAutocomplete",T),e.R7$(3),e.Y8G("ngForOf",e.bMT(19,19,i.predefinedCatalogsList$)),e.R7$(5),e.Y8G("ngForOf",i.typeCapabilities),e.R7$(),e.Y8G("ngIf",i.error&&i.addedCatalog&&i.emailAddress),e.R7$(),e.Y8G("ngIf",i.error&&i.addedCatalog&&!i.emailAddress),e.R7$(4),e.SpI(" ",e.bMT(30,21,"igo.geo.catalog.library.cancel")," "),e.R7$(2),e.Y8G("disabled",!i.form.valid),e.R7$(),e.SpI(" ",e.bMT(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[Ct.BI,Ct.Yi,Q.YN,Q.qT,Q.me,Q.BC,Q.cb,Q.X1,Q.j4,Q.JD,be.RG,be.rl,Tt.fS,Tt.fg,Bt.jL,Bt.$3,re.wT,Bt.pN,o.pM,re.Sy,v.uc,v.oV,_e.Ve,_e.VO,de.Fg,de.yE,o.bT,Ct.E7,L.Hl,L.$z,o.Jj,y.Ck,P.D9],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]})}return l})();var jl=r(31191);function yd(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-icon",5),e.nI1(1,"translate"),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.stopPropagation())}),e.EFF(2," public "),e.k0s()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.catalog.externalProvider.catalog"))}function vd(l,f){if(1&l){const t=e.RV6();e.j41(0,"button",6),e.nI1(1,"translate"),e.bIt("click",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.removeCatalogFromLibrary(i))}),e.j41(2,"mat-icon"),e.EFF(3,"delete"),e.k0s()()}2&l&&e.Y8G("matTooltip",e.bMT(1,1,"igo.geo.catalog.library.remove"))}function bd(l,f){1&l&&(e.j41(0,"button",7),e.nrm(1,"mat-icon"),e.k0s())}let Cd=(()=>{class l{catalog;map;catalogRemove=new e.bkB;get title(){return(0,Ne.k0)(this.catalog)}removeCatalogFromLibrary(t){t.stopPropagation(),this.catalogRemove.emit()}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=e.VBU({type:l,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},standalone:!0,features:[e.aNF],decls:7,vars:4,consts:[["matListItemTitle",""],["matListItemMeta",""],["matListItemIcon","","class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["matListItemIcon","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-external-provider",3,"click","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip"],["disabled","true","mat-icon-button","",1,"igo-blank"]],template:function(n,i){1&n&&(e.j41(0,"mat-list-item")(1,"span",0),e.EFF(2),e.k0s(),e.j41(3,"div",1),e.DNE(4,yd,3,3,"mat-icon",2)(5,vd,4,3,"button",3)(6,bd,2,0,"button",4),e.k0s()()),2&n&&(e.R7$(2),e.SpI(" ",i.title," "),e.R7$(2),e.Y8G("ngIf",i.catalog.externalProvider),e.R7$(),e.Y8G("ngIf",i.catalog.removable),e.R7$(),e.Y8G("ngIf",!i.catalog.removable))},dependencies:[de.Fg,de.YE,de.ZV,de.yE,de.BJ,o.bT,R.m_,R.An,v.uc,v.oV,L.Hl,L.iY,y.Ck,P.D9],styles:[".igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0})}return l})();function Sd(l,f){if(1&l){const t=e.RV6();e.j41(0,"igo-catalog-library-item",3),e.bIt("catalogRemove",function(){const i=e.eBV(t).$implicit,d=e.XpG();return e.Njj(d.onCatalogRemove(i))})("select",function(){const i=e.eBV(t).$implicit,d=e.XpG();return e.Njj(d.onCatalogSelect(i))}),e.k0s()}if(2&l){const t=f.$implicit,n=e.XpG();e.Y8G("map",n.map)("catalog",t)}}function Td(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",4)(1,"button",5),e.nI1(2,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.addCatalogDialog())}),e.EFF(3),e.nI1(4,"translate"),e.j41(5,"mat-icon"),e.EFF(6,"library_add"),e.k0s()()()}2&l&&(e.R7$(),e.Y8G("matTooltip",e.bMT(2,2,"igo.geo.catalog.library.addBtn")),e.R7$(2),e.SpI(" ",e.bMT(4,4,"igo.geo.catalog.library.addBtn")," "))}let Bl=(()=>{class l{capabilitiesService;messageService;storageService;dialog;store;map;addCatalogAllowed=!1;predefinedCatalogs=[];catalogSelectChange=new e.bkB;submitDisabled=!0;addingCatalog$$;get addedCatalogs(){return this.storageService.get("addedCatalogs")||[]}set addedCatalogs(t){this.storageService.set("addedCatalogs",t)}get selectedCatalogId(){return this.storageService.get("selectedCatalogId",ao.YM.SESSION)}set selectedCatalogId(t){this.storageService.set("selectedCatalogId",t,ao.YM.SESSION)}constructor(t,n,i,d){this.capabilitiesService=t,this.messageService=n,this.storageService=i,this.dialog=d}ngOnInit(){if(this.store.state.clear(),this.selectedCatalogId){const t=this.store.all().find(n=>n.id===this.selectedCatalogId);t&&this.onCatalogSelect(t)}this.predefinedCatalogs=this.predefinedCatalogs.map(t=>(t.id=jl.VV.hashStr((t.type||"wms")+(0,Qn.FN)(t.url)),t.title=""!==t.title&&t.title?t.title:t.url,t))}getCatalogs(){return this.store.view.all$()}onCatalogSelect(t){this.store.state.update(t,{selected:!0,focused:!0},!0),this.selectedCatalogId=t.id,this.catalogSelectChange.emit({selected:!0,catalog:t})}unsubscribeAddingCatalog(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}addCatalog(t){if(!t)return;let n=jl.VV.hashStr(t.type+(0,Qn.FN)(t.url));const i=this.predefinedCatalogs.find(d=>d.id===t.id);i&&(t.version=i.version,t.externalProvider=i.externalProvider,n=i.id),this.store.get(n)?this.messageService.alert("igo.geo.catalog.library.inlist.message","igo.geo.catalog.library.inlist.title"):(this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(t.type,t.url,t.version).pipe((0,Be.W)(d=>{if(d.error)return this.addCatalogDialog(!0,t),d.error.caught=!0,d;throw this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.url}),d})).subscribe(d=>{let T,B;switch(t.type){case"wms":T=t.title||d.Service.Title,B=t.version||d.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":T=t.title||d.mapName;break;case"wmts":T=t.title||d.ServiceIdentification.ServiceType;break;default:T=t.title}const me=Et.BF.removeUndefined(Object.assign({},i,Et.BF.removeUndefined({id:n,title:T,url:t.url,type:t.type||"wms",externalProvider:t.externalProvider||!1,removable:!0,version:B})));this.store.insert(me);const fe=this.addedCatalogs.slice(0);fe.push(me),this.addedCatalogs=fe,this.unsubscribeAddingCatalog()}))}ngOnDestroy(){this.unsubscribeAddingCatalog()}onCatalogRemove(t){this.store.delete(t),this.addedCatalogs=this.addedCatalogs.slice(0).filter(n=>n.id!==t.id)}addCatalogDialog(t,n){this.dialog.open(kl,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:t,addedCatalog:n}}).afterClosed().subscribe(d=>{this.addCatalog(d)})}static \u0275fac=function(n){return new(n||l)(e.rXU(rt.w),e.rXU(k.bg),e.rXU(ao.n$),e.rXU(Ct.bZ))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},standalone:!0,features:[e.aNF],decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"catalogRemove","select","map","catalog"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"click","matTooltip"]],template:function(n,i){1&n&&(e.j41(0,"igo-list",0),e.DNE(1,Sd,1,2,"ng-template",1),e.nI1(2,"async"),e.k0s(),e.DNE(3,Td,7,6,"div",2)),2&n&&(e.Y8G("navigation",!1),e.R7$(),e.Y8G("ngForOf",e.bMT(2,3,i.getCatalogs())),e.R7$(2),e.Y8G("ngIf",i.addCatalogAllowed))},dependencies:[s.sB,o.pM,Cd,s.dF,o.bT,L.Hl,L.$z,v.uc,v.oV,R.m_,R.An,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}"],changeDetection:0})}return l})();r(90315),r(5372),r(60557),r(54239);var Fd=r(36250);function Md(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",3)(1,"mat-button-toggle-group",4),e.nI1(2,"async"),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG();return e.DH7(d.geometryType,i)||(d.geometryType=i),e.Njj(i)}),e.j41(3,"mat-button-toggle",5),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"mat-button-toggle",6),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"mat-button-toggle",7),e.EFF(10),e.nI1(11,"translate"),e.k0s()()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("disabled",void 0!==e.bMT(2,8,t.value$)),e.R50("ngModel",t.geometryType),e.R7$(2),e.Y8G("disabled",t.geometryTypes.indexOf("Point")<0),e.R7$(),e.SpI(" ",e.bMT(5,10,"igo.geo.geometry.point")," "),e.R7$(2),e.Y8G("disabled",t.geometryTypes.indexOf("LineString")<0),e.R7$(),e.SpI(" ",e.bMT(8,12,"igo.geo.geometry.line")," "),e.R7$(2),e.Y8G("disabled",t.geometryTypes.indexOf("Polygon")<0),e.R7$(),e.SpI(" ",e.bMT(11,14,"igo.geo.geometry.polygon")," ")}}function xd(l,f){if(1&l){const t=e.RV6();e.j41(0,"mat-form-field",8)(1,"input",9),e.mxI("ngModelChange",function(i){e.eBV(t);const d=e.XpG();return e.DH7(d.drawGuide,i)||(d.drawGuide=i),e.Njj(i)}),e.k0s(),e.j41(2,"mat-icon",10),e.EFF(3,"adjust "),e.k0s(),e.j41(4,"span",11),e.EFF(5),e.nI1(6,"translate"),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("placeholder",t.drawGuidePlaceholder),e.R50("ngModel",t.drawGuide),e.R7$(),e.Y8G("color","primary"),e.R7$(3),e.JRh(e.bMT(6,4,"igo.geo.measure.meters"))}}let Ys=class ia{cdRef;value$=new ce.t(void 0);value$$;set drawControlIsActive(f){this._drawControlIsActive=f,this.cdRef.detectChanges()}get drawControlIsActive(){return this._drawControlIsActive}_drawControlIsActive=!0;set freehandDrawIsActive(f){this._freehandDrawIsActive=f,this.cdRef.detectChanges()}get freehandDrawIsActive(){return this._freehandDrawIsActive}_freehandDrawIsActive=!1;formControl;map;set geometryType(f){this.geometryType$.next(f)}get geometryType(){return this.geometryType$.value}geometryType$=new ce.t(void 0);geometryTypeField=!1;geometryTypes=["Point","LineString","Polygon"];drawGuideField=!1;set drawGuide(f){this.drawGuide$.next(f)}get drawGuide(){return this.drawGuide$.value}drawGuide$=new ce.t(0);drawGuidePlaceholder="";measure=!1;controlOptions={};drawStyle;overlayStyle;constructor(f){this.cdRef=f}ngOnInit(){this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(f=>{this.value$.next(f||void 0)})}ngOnDestroy(){this.value$$.unsubscribe()}static \u0275fac=function(t){return new(t||ia)(e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:ia,selectors:[["igo-geometry-form-field"]],inputs:{formControl:"formControl",map:"map",geometryType:"geometryType",geometryTypeField:"geometryTypeField",geometryTypes:"geometryTypes",drawGuideField:"drawGuideField",drawGuide:"drawGuide",drawGuidePlaceholder:"drawGuidePlaceholder",measure:"measure",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle"},standalone:!0,features:[e.aNF],decls:5,vars:16,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","controlOptions","drawStyle","overlayStyle"],["class","geometry-type-toggle",4,"ngIf"],["class","draw-guide-field",4,"ngIf"],[1,"geometry-type-toggle"],[3,"ngModelChange","disabled","ngModel"],["value","Point",3,"disabled"],["value","LineString",3,"disabled"],["value","Polygon",3,"disabled"],[1,"draw-guide-field"],["matInput","","type","number",3,"ngModelChange","placeholder","ngModel"],["matPrefix","",3,"color"],["matSuffix","",1,"draw-guide-units"]],template:function(t,n){1&t&&(e.nrm(0,"igo-geometry-form-field-input",0),e.nI1(1,"async"),e.nI1(2,"async"),e.DNE(3,Md,12,16,"div",1)(4,xd,7,6,"mat-form-field",2)),2&t&&(e.Y8G("formControl",n.formControl)("map",n.map)("geometryType",e.bMT(1,12,n.geometryType$))("drawGuide",e.bMT(2,14,n.drawGuide$))("measure",n.measure)("drawControlIsActive",n.drawControlIsActive)("freehandDrawIsActive",n.freehandDrawIsActive)("controlOptions",n.controlOptions)("drawStyle",n.drawStyle)("overlayStyle",n.overlayStyle),e.R7$(3),e.Y8G("ngIf",n.geometryTypeField),e.R7$(),e.Y8G("ngIf",n.drawGuideField))},dependencies:[$,Q.YN,Q.me,Q.Q0,Q.BC,Q.vS,Q.X1,Q.l_,o.bT,ge.Vg,ge.ec,ge.pc,be.RG,be.rl,be.JW,be.yw,Tt.fS,Tt.fg,R.m_,R.An,o.Jj,y.Ck,P.D9],styles:["[_nghost-%COMP%]{display:block;width:100%}.geometry-type-toggle[_ngcontent-%COMP%], .draw-guide-field[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.draw-guide-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0 10px}.draw-guide-units[_ngcontent-%COMP%]{padding:10px}"],changeDetection:0})};Ys=(0,Ot.Cg)([(0,Fd.lx)("geometry"),(0,Ot.Sn)("design:paramtypes",[e.gRc])],Ys);var Gl=r(65666),Vl=(r(29555),r(97927)),Ul=r(90697),Nl=(r(86635),r(96463),r(37685)),Yl=r(48339),Wl=r(72789),Xl=(r(95047),r(63724),r(86827),r(8577),r(47457)),Kl=r(13361);let Ld=(()=>{class l{static \u0275fac=function(n){return new(n||l)};static \u0275mod=e.$C({type:l});static \u0275inj=e.G2t({imports:[Gl.W,Vl.x,Ul.h,Nl.V,Yl.B,Wl.w,Xl.n,Kl.L]})}return l})();r(76173);var Ad=r(55050),Yt=r(9799);const kd=l=>({column:l,value:130}),jd=l=>({column:l,value:120}),Bd=(l,f)=>({column:l,value:f}),Hl=()=>["newpage","newimage"];function Gd(l,f){1&l&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"translate"),e.nI1(3,"translate"),e.k0s()),2&l&&(e.R7$(),e.JRh(e.i5U(3,3,"igo.geo.formValidation.maxLength",e.eq3(6,kd,e.bMT(2,1,"igo.geo.printForm.title")))))}function Vd(l,f){1&l&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"translate"),e.nI1(3,"translate"),e.k0s()),2&l&&(e.R7$(),e.JRh(e.i5U(3,3,"igo.geo.formValidation.maxLength",e.eq3(6,jd,e.bMT(2,1,"igo.geo.printForm.subtitle")))))}function Ud(l,f){if(1&l&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"translate"),e.nI1(3,"translate"),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.JRh(e.i5U(3,3,"igo.geo.formValidation.maxLength",e.l_i(6,Bd,e.bMT(2,1,"igo.geo.printForm.comment"),t.maxLength)))}}function Nd(l,f){if(1&l&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&l){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",e.bMT(2,1,"igo.geo.printForm.legendPositions."+t.value)," ")}}function Yd(l,f){if(1&l&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&l){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,1,"Pdf"===t.outputFormat?"igo.geo.printForm.legendPositions.newpage":"igo.geo.printForm.legendPositions.newimage")," ")}}function Wd(l,f){if(1&l&&(e.j41(0,"mat-option",21),e.DNE(1,Nd,3,3,"ng-container",3)(2,Yd,3,3,"ng-container",3),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key),e.R7$(),e.Y8G("ngIf",!e.lJ4(3,Hl).includes(t.value)),e.R7$(),e.Y8G("ngIf",e.lJ4(4,Hl).includes(t.value))}}function Xd(l,f){if(1&l&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key),e.R7$(),e.SpI(" ",t.value," ")}}function Kd(l,f){if(1&l&&(e.j41(0,"mat-option",21),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.printForm.paperFormats."+t.value)," ")}}function Hd(l,f){if(1&l&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key),e.R7$(),e.SpI(" ",t.value," ")}}function zd(l,f){if(1&l&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function Jd(l,f){if(1&l&&(e.j41(0,"mat-option",21),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&l){const t=f.$implicit;e.Y8G("value",t.key),e.R7$(),e.SpI(" ",e.bMT(2,2,"igo.geo.printForm."+t.value)," ")}}let Zd=(()=>{class l{formBuilder;mediaService;form;outputFormats=Yt.O9;paperFormats=Yt.VA;orientations=Yt.y9;resolutions=[...Yt.e3];imageFormats=Yt.JS;legendPositions=Yt.go;isPrintService=!0;disabled$;get imageFormat(){return this.imageFormatField.value}set imageFormat(t){this.imageFormatField.setValue(t||Yt.JS.Jpeg,{onlySelf:!0})}get outputFormat(){return this.outputFormatField.value}set outputFormat(t){this.outputFormatField.setValue(t||Yt.O9.Pdf,{onlySelf:!0})}get paperFormat(){return this.paperFormatField.value}set paperFormat(t){this.paperFormatField.setValue(t||Yt.VA.Letter,{onlySelf:!0})}get orientation(){return this.orientationField.value}set orientation(t){this.orientationField.setValue(t||Yt.y9.landscape,{onlySelf:!0})}get resolution(){return this.resolutionField.value}set resolution(t){this.resolutionField.setValue(t||"96",{onlySelf:!0})}get legendPosition(){return this.legendPositionField.value}set legendPosition(t){this.legendPositionField.setValue(t||Yt.go.none,{onlySelf:!0})}get title(){return this.titleField.value}set title(t){this.titleField.setValue(t,{onlySelf:!0})}get subtitle(){return this.subtitleField.value}set subtitle(t){this.subtitleField.setValue(t,{onlySelf:!0})}get comment(){return this.commentField.value}set comment(t){this.commentField.setValue(t,{onlySelf:!0})}get showProjection(){return this.showProjectionField.value}set showProjection(t){this.showProjectionField.setValue(t,{onlySelf:!0})}get showScale(){return this.showScaleField.value}set showScale(t){this.showScaleField.setValue(t,{onlySelf:!0})}get showLegend(){return this.showLegendField.value}set showLegend(t){this.showLegendField.setValue(t,{onlySelf:!0})}get doZipFile(){return this.doZipFileField.value}set doZipFile(t){this.doZipFileField.setValue(t,{onlySelf:!0})}get showNorth(){return this.showNorthArrowField.value}set showNorth(t){this.showNorthArrowField.setValue(t,{onlySelf:!0})}get outputFormatField(){return this.form.controls.outputFormat}get paperFormatField(){return this.form.controls.paperFormat}get imageFormatField(){return this.form.controls.imageFormat}get orientationField(){return this.form.controls.orientation}get resolutionField(){return this.form.controls.resolution}get commentField(){return this.form.controls.comment}get showProjectionField(){return this.form.controls.showProjection}get showScaleField(){return this.form.controls.showScale}get showLegendField(){return this.form.controls.showLegend}get doZipFileField(){return this.form.controls.doZipFile}get showNorthArrowField(){return this.form.controls.showNorth}get titleField(){return this.form.controls.title}get subtitleField(){return this.form.controls.subtitle}get legendPositionField(){return this.form.controls.legendPosition}submit=new e.bkB;maxLength=180;constructor(t,n){this.formBuilder=t,this.mediaService=n,this.form=this.formBuilder.group({title:["",[Q.k0.minLength(0),Q.k0.maxLength(130)]],subtitle:["",[Q.k0.minLength(0),Q.k0.maxLength(120)]],comment:["",[Q.k0.minLength(0),Q.k0.maxLength(this.maxLength)]],outputFormat:["",[Q.k0.required]],paperFormat:["",[Q.k0.required]],imageFormat:["",[Q.k0.required]],resolution:["",[Q.k0.required]],orientation:["",[Q.k0.required]],legendPosition:["",[Q.k0.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}],showNorthArrow:!1})}ngOnInit(){this.doZipFileField.setValue(!1),this.mediaService.isMobile()&&(this.resolutions=this.resolutions.filter(t=>"300"!==t))}handleFormSubmit(t,n){t.isPrintService=this.isPrintService,n&&this.submit.emit(t)}toggleImageSaveProp(){"Image"===this.outputFormatField.value?(this.isPrintService=!1,this.commentField.clearValidators(),this.commentField.updateValueAndValidity()):this.isPrintService=!0}changeCommentLength(){switch(this.paperFormat){case Yt.VA.A0:this.maxLength=this.orientation===Yt.y9.landscape?900:600;break;case Yt.VA.A1:this.maxLength=this.orientation===Yt.y9.landscape?600:400;break;case Yt.VA.A2:this.maxLength=this.orientation===Yt.y9.landscape?400:300;break;case Yt.VA.A3:this.maxLength=this.orientation===Yt.y9.landscape?300:200;break;case Yt.VA.A4:this.maxLength=this.orientation===Yt.y9.landscape?200:100;break;case Yt.VA.A5:this.maxLength=this.orientation===Yt.y9.landscape?120:80;break;case Yt.VA.Letter:this.maxLength=this.orientation===Yt.y9.landscape?180:140;break;default:this.maxLength=this.orientation===Yt.y9.landscape?200:140}this.commentField.setValidators([Q.k0.maxLength(this.maxLength)]),this.commentField.updateValueAndValidity()}static \u0275fac=function(n){return new(n||l)(e.rXU(Q.ze),e.rXU(Ad.u1))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile",showNorth:"showNorth"},outputs:{submit:"submit"},standalone:!0,features:[e.aNF],decls:98,vars:107,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"igo-input-container","slide-toggle-container"],[1,"print-slide-toggle-container"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","showNorthArrow",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"selectionChange","placeholder"],["formControlName","paperFormat",3,"selectionChange","placeholder"],["formControlName","imageFormat",3,"placeholder"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"selectionChange","placeholder"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"click","disabled"],[3,"value"]],template:function(n,i){1&n&&(e.j41(0,"form",0)(1,"div",1)(2,"mat-form-field")(3,"mat-label"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.nrm(6,"input",2),e.nI1(7,"translate"),e.DNE(8,Gd,4,8,"mat-error",3),e.k0s()(),e.j41(9,"div",1)(10,"mat-form-field")(11,"mat-label"),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.nrm(14,"input",4),e.nI1(15,"translate"),e.DNE(16,Vd,4,8,"mat-error",3),e.k0s()(),e.j41(17,"div",1)(18,"mat-form-field")(19,"mat-label"),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.nrm(22,"input",5),e.nI1(23,"translate"),e.DNE(24,Ud,4,9,"mat-error",3),e.k0s()(),e.j41(25,"div",6)(26,"div",7)(27,"mat-slide-toggle",8),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"mat-slide-toggle",9),e.EFF(31),e.nI1(32,"translate"),e.k0s(),e.j41(33,"mat-slide-toggle",10),e.EFF(34),e.nI1(35,"translate"),e.k0s(),e.j41(36,"mat-slide-toggle",11),e.EFF(37),e.nI1(38,"translate"),e.k0s()()(),e.j41(39,"div",1)(40,"mat-form-field")(41,"mat-label"),e.EFF(42),e.nI1(43,"translate"),e.k0s(),e.j41(44,"mat-select",12),e.nI1(45,"translate"),e.DNE(46,Wd,3,5,"mat-option",13),e.nI1(47,"keyvalue"),e.k0s()()(),e.j41(48,"div",1)(49,"mat-form-field")(50,"mat-label"),e.EFF(51),e.nI1(52,"translate"),e.k0s(),e.j41(53,"mat-select",14),e.nI1(54,"translate"),e.bIt("selectionChange",function(){return i.toggleImageSaveProp()}),e.DNE(55,Xd,2,2,"mat-option",13),e.nI1(56,"keyvalue"),e.k0s()()(),e.j41(57,"div",1)(58,"mat-form-field")(59,"mat-label"),e.EFF(60),e.nI1(61,"translate"),e.k0s(),e.j41(62,"mat-select",15),e.nI1(63,"translate"),e.bIt("selectionChange",function(){return i.changeCommentLength()}),e.DNE(64,Kd,3,4,"mat-option",13),e.nI1(65,"keyvalue"),e.k0s()()(),e.j41(66,"div",1)(67,"mat-form-field")(68,"mat-label"),e.EFF(69),e.nI1(70,"translate"),e.k0s(),e.j41(71,"mat-select",16),e.nI1(72,"translate"),e.DNE(73,Hd,2,2,"mat-option",13),e.nI1(74,"keyvalue"),e.k0s()()(),e.j41(75,"div",1)(76,"mat-form-field")(77,"mat-label"),e.EFF(78),e.nI1(79,"translate"),e.nI1(80,"translate"),e.k0s(),e.j41(81,"mat-select",17),e.nI1(82,"translate"),e.DNE(83,zd,2,2,"mat-option",13),e.k0s()()(),e.j41(84,"div",1)(85,"mat-form-field")(86,"mat-label"),e.EFF(87),e.nI1(88,"translate"),e.k0s(),e.j41(89,"mat-select",18),e.nI1(90,"translate"),e.bIt("selectionChange",function(){return i.changeCommentLength()}),e.DNE(91,Jd,3,4,"mat-option",13),e.nI1(92,"keyvalue"),e.k0s()()(),e.j41(93,"div",19)(94,"button",20),e.nI1(95,"async"),e.bIt("click",function(){return i.handleFormSubmit(i.form.value,i.form.valid)}),e.EFF(96),e.nI1(97,"translate"),e.k0s()()()),2&n&&(e.Y8G("formGroup",i.form),e.R7$(4),e.JRh(e.bMT(5,47,"igo.geo.printForm.title")),e.R7$(2),e.FS9("placeholder",e.bMT(7,49,"igo.geo.printForm.title")),e.R7$(2),e.Y8G("ngIf",null==i.titleField.errors?null:i.titleField.errors.maxlength),e.R7$(4),e.JRh(e.bMT(13,51,"igo.geo.printForm.subtitle")),e.R7$(2),e.FS9("placeholder",e.bMT(15,53,"igo.geo.printForm.subtitle")),e.R7$(2),e.Y8G("ngIf",null==i.subtitleField.errors?null:i.subtitleField.errors.maxlength),e.R7$(4),e.JRh(e.bMT(21,55,"igo.geo.printForm.comment")),e.R7$(2),e.FS9("placeholder",e.bMT(23,57,"igo.geo.printForm.comment")),e.R7$(2),e.Y8G("ngIf",null==i.commentField.errors?null:i.commentField.errors.maxlength),e.R7$(3),e.Y8G("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(29,59,"igo.geo.printForm.showProjection")," "),e.R7$(2),e.Y8G("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(32,61,"igo.geo.printForm.showScale")," "),e.R7$(2),e.xc7("display",i.isPrintService?"none":""),e.Y8G("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(35,63,"igo.geo.printForm.doZipFile")," "),e.R7$(2),e.Y8G("labelPosition","before"),e.R7$(),e.SpI(" ",e.bMT(38,65,"igo.geo.printForm.showNorthArrow")," "),e.R7$(5),e.JRh(e.bMT(43,67,"igo.geo.printForm.legendPosition")),e.R7$(2),e.FS9("placeholder",e.bMT(45,69,"igo.geo.printForm.legendPosition")),e.R7$(2),e.Y8G("ngForOf",e.bMT(47,71,i.legendPositions)),e.R7$(5),e.JRh(e.bMT(52,73,"igo.geo.printForm.outputFormat")),e.R7$(2),e.FS9("placeholder",e.bMT(54,75,"igo.geo.printForm.outputFormat")),e.R7$(2),e.Y8G("ngForOf",e.bMT(56,77,i.outputFormats)),e.R7$(2),e.xc7("display",i.isPrintService?"block":"none"),e.R7$(3),e.JRh(e.bMT(61,79,"igo.geo.printForm.paperFormat")),e.R7$(2),e.FS9("placeholder",e.bMT(63,81,"igo.geo.printForm.paperFormat")),e.R7$(2),e.Y8G("ngForOf",e.bMT(65,83,i.paperFormats)),e.R7$(2),e.xc7("display",i.isPrintService?"none":"block"),e.R7$(3),e.JRh(e.bMT(70,85,"igo.geo.printForm.imageFormat")),e.R7$(2),e.FS9("placeholder",e.bMT(72,87,"igo.geo.printForm.imageFormat")),e.R7$(2),e.Y8G("ngForOf",e.bMT(74,89,i.imageFormats)),e.R7$(5),e.Lme("",e.bMT(79,91,"igo.geo.printForm.resolution")," (",e.bMT(80,93,"igo.geo.printForm.resolutionUnit"),")"),e.R7$(3),e.FS9("placeholder",e.bMT(82,95,"igo.geo.printForm.resolution")),e.R7$(2),e.Y8G("ngForOf",i.resolutions),e.R7$(),e.xc7("display",i.isPrintService?"block":"none"),e.R7$(3),e.JRh(e.bMT(88,97,"igo.geo.printForm.orientation")),e.R7$(2),e.FS9("placeholder",e.bMT(90,99,"igo.geo.printForm.orientation")),e.R7$(2),e.Y8G("ngForOf",e.bMT(92,101,i.orientations)),e.R7$(3),e.Y8G("disabled",!i.form.valid||e.bMT(95,103,i.disabled$)),e.R7$(2),e.SpI(" ",e.bMT(97,105,"igo.geo.printForm.saveBtn")," "))},dependencies:[Q.YN,Q.qT,Q.me,Q.BC,Q.cb,Q.X1,Q.j4,Q.JD,be.RG,be.rl,be.nJ,be.TL,Tt.fS,Tt.fg,o.bT,Ft.mV,Ft.sG,_e.Ve,_e.VO,re.wT,o.pM,re.Sy,L.Hl,L.$z,o.Jj,o.lG,y.Ck,P.D9],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .slide-toggle-container[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .print-option[_ngcontent-%COMP%]{display:block;margin-bottom:12px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}"]})}return l})();var Ar=r(64334),Qd=r(3674);let qd=(()=>{class l{printService;disabled$=new ce.t(!1);get map(){return this._map}set map(t){this._map=t}_map;get outputFormat(){return this._outputFormat}set outputFormat(t){this._outputFormat=t}_outputFormat;get paperFormat(){return this._paperFormat}set paperFormat(t){this._paperFormat=t}_paperFormat;get orientation(){return this._orientation}set orientation(t){this._orientation=t}_orientation;get imageFormat(){return this._imageFormat}set imageFormat(t){this._imageFormat=t}_imageFormat;get legendPosition(){return this._legendPosition}set legendPosition(t){this._legendPosition=t}_legendPosition;get resolution(){return this._resolution}set resolution(t){this._resolution=t}_resolution;constructor(t){this.printService=t}handleFormSubmit(t){if(this.disabled$.next(!0),!0===t.isPrintService)this.printService.print(this.map,t).pipe((0,Ar.s)(1)).subscribe(()=>{this.disabled$.next(!1)});else{let n=1;t.showLegend&&n++,"tiff"===t.imageFormat.toLowerCase()&&n++,"newpage"===t.legendPosition&&n++,this.printService.defineNbFileToProcess(n),this.printService.downloadMapImage(this.map,t.resolution,t.imageFormat,t.showProjection,t.showScale,t.title,t.subtitle,t.comment,t.doZipFile,t.legendPosition,t.showNorthArrow).pipe((0,Ar.s)(1)).subscribe(()=>{this.disabled$.next(!1)})}}static \u0275fac=function(n){return new(n||l)(e.rXU(Qd.B))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},standalone:!0,features:[e.aNF],decls:1,vars:7,consts:[[3,"submit","outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$"]],template:function(n,i){1&n&&(e.j41(0,"igo-print-form",0),e.bIt("submit",function(T){return i.handleFormSubmit(T)}),e.k0s()),2&n&&e.Y8G("outputFormat",i.outputFormat)("paperFormat",i.paperFormat)("orientation",i.orientation)("imageFormat",i.imageFormat)("resolution",i.resolution)("legendPosition",i.legendPosition)("disabled$",i.disabled$)},dependencies:[Zd],encapsulation:2})}return l})();r(65882);var _i=r(85447),em=r(27146);function tm(...l){const f=[{provide:_i.YK,useClass:_i.YK},(0,em.I7)()];for(const t of l)f.push(...t.providers);return f}var zl=function(l){return l[l.OSRM=0]="OSRM",l}(zl||{}),Jl=r(82182),Zl=r(2639);let om=(()=>{class l extends Zl.o{_http;_config;get options(){return this._options}set options(t){this._options=t}get sourceName(){return this._options.name}set sourceName(t){this._options.name=t}get baseUrl(){return this._options.baseUrl}set baseUrl(t){this._options.baseUrl=t}get url(){return`${this.baseUrl}${this.getEnabledProfile().name}/`}get profiles(){return this._options.profiles}set profiles(t){this._options.profiles=t}_options;constructor(t,n){super(),this._http=t,this._config=n,this._options=this._config.getConfig("directionsSources.osrm"),this.baseUrl||(this.baseUrl="/apis/itineraire/route/v1/"),this.sourceName||(this.sourceName="OSRM Qu\xe9bec"),this.profiles?this.profiles.find(i=>i.enabled)||(this.profiles[0].enabled=!0):this.profiles=[{enabled:!0,name:"driving"}]}getSourceName(){return this.sourceName}getEnabledProfile(){return this.profiles.find(t=>t.enabled)}getProfileWithAuthorization(){return this.profiles.find(t=>t.authorization)}route(t,n={}){const i=this.getRouteParams(n);return this.getRoute(t,i)}getRoute(t,n){return this._http.get(this.url+t.join(";"),{params:n}).pipe((0,g.T)(d=>this.extractRoutesData(d)))}extractRoutesData(t){const n=[];return t.routes.forEach(i=>{n.push(this.formatRoute(i,t.waypoints))}),n}getRouteParams(t={}){return t.alternatives=void 0===t.alternatives||t.alternatives,t.steps=void 0===t.steps||t.steps,t.geometries=void 0!==t.geometries?t.geometries:"geojson",t.overview=void 0!==t.overview&&t.overview,t.continue_straight=void 0!==t.continue_straight&&t.continue_straight,new u.Nl({fromObject:{alternatives:t.alternatives?"true":"false",overview:t.overview?"simplified":"full",steps:t.steps?"true":"false",geometries:t.geometries?t.geometries:"geojson",continue_straight:t.continue_straight?"true":"false"}})}formatRoute(t,n){const i=[];return t.legs.forEach(d=>{d.steps.forEach(T=>{i.push(T)})}),{id:(0,Et.uR)(),title:t.legs[0].summary,source:this.url,sourceType:Jl.GN.Route,order:1,format:Jl.ee.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:n,distance:t.distance,duration:t.duration,geometry:t.geometry,legs:t.legs,steps:i,weight:t.weight,weight_name:t.weight_name}}static \u0275fac=function(n){return new(n||l)(e.KVO(u.Qq),e.KVO(A.we))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();function nm(l,f){return new om(l,f)}function rm(){return{kind:zl.OSRM,providers:[{provide:Zl.o,useFactory:nm,multi:!0,deps:[u.Qq,A.we]}]}}var sm=r(36741);r(14970),r(49953),r(79634),r(63353),r(77320),r(45834),r(8781),r(25771);var Ws=function(l){return l[l.None=0]="None",l[l.Move=1]="Move",l[l.Zoom=2]="Zoom",l[l.ZoomIfOutMapExtent=3]="ZoomIfOutMapExtent",l}(Ws||{});let lm=(()=>{class l{features$=new ce.t([[],void 0]);constructor(){}setFeatures(t,n=Ws.None){this.features$.next([t,n])}clear(){this.features$.next([[],Ws.None])}static \u0275fac=function(n){return new(n||l)};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),cm=(()=>{class l{component;overlayService;features$$;format=new _o.A;get map(){return this.component.map}constructor(t,n){this.component=t,this.overlayService=n}ngOnInit(){this.features$$=this.overlayService.features$.subscribe(t=>this.handleFeatures(t[0],t[1]))}ngOnDestroy(){this.features$$.unsubscribe()}handleFeatures(t,n){}static \u0275fac=function(n){return new(n||l)(e.rXU(xs.K,2),e.rXU(lm))};static \u0275dir=e.FsC({type:l,selectors:[["","igoOverlay",""]],standalone:!0})}return l})();function um(l,f){const t=[f?.analytics&&{provide:"searchAnalytics",useValue:f.analytics},{provide:ks.S,useClass:ks.S},Cl()].filter(Boolean);for(const n of l)t.push(...n.providers);return t}r(1928),r(65988),r(30269);class qn extends So.C{http;languageService;static id="cadastre";static type=Xt.R;constructor(f,t,n,i){super(i,n),this.http=f,this.languageService=t}getId(){return qn.id}getType(){return qn.type}getDefaultOptions(){return{title:"Cadastre (Qu\xe9bec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}}search(f,t){f=(f=(f=(f=f.replace(/ /g,"")).replace(/,+/g,",")).endsWith(",")?f.slice(0,-1):f).startsWith(",")?f.substr(1):f;const n=this.computeSearchRequestParams(f,t||{});return n.get("numero")&&n.get("numero").match(/^[0-9,]+$/g)?this.getCadastre(f,n):(0,Xe.of)([])}getCadastre(f,t){return this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,g.T)(n=>this.extractResults(n,f)))}computeSearchRequestParams(f,t){return new u.Nl({fromObject:Object.assign({numero:f,epsg:"4326"},this.params,t.params||{})})}extractResults(f,t){return f.split("<br />").filter(n=>n.length>0).map(n=>this.dataToResult(n,t))}dataToResult(f,t){const n=f.split(";"),i=n[0],T=this.computeGeometry(n[7]),B={NoLot:i,Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"},me=[this.getId(),"cadastre",i].join(".");return{source:this,meta:{dataType:Xt.R,id:me,title:i,score:(0,On.H_)(t.trim(),i),icon:"location_on"},data:{type:Xt.R,projection:"EPSG:4326",geometry:T,properties:B,meta:{id:me,title:i}}}}computeGeometry(f){const t=(new wo.A).readFeature(f,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:t.getGeometry().getType(),coordinates:t.getGeometry().getCoordinates()}}static \u0275fac=function(t){return new(t||qn)(e.KVO(u.Qq),e.KVO(y.gw),e.KVO(ao.n$),e.KVO("options"))};static \u0275prov=e.jDH({token:qn,factory:qn.\u0275fac})}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20,cacheHasher:Et.lj}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[String,u.Nl]),(0,Ot.Sn)("design:returntype",Jt.c)],qn.prototype,"getCadastre",null);class ei extends So.C{http;static id="nominatim";static type=Xt.R;constructor(f,t,n){super(t,n),this.http=f}getId(){return ei.id}getType(){return ei.type}getDefaultOptions(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}search(f,t){const n=this.computeSearchRequestParams(f,t||{});return n.get("q")?this.getSearch(f,n):(0,Xe.of)([])}getSearch(f,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,g.T)(n=>this.extractResults(n,f)))}computeSearchRequestParams(f,t){return new u.Nl({fromObject:Object.assign({q:this.computeTerm(f),format:"json"},this.params,t.params||{})})}extractResults(f,t){return f.map(n=>this.dataToResult(n,t))}dataToResult(f,t){const n=this.computeProperties(f),i=this.computeGeometry(f),d=this.computeExtent(f),T=[this.getId(),"place",f.place_id].join(".");return{source:this,meta:{dataType:Xt.R,id:T,title:f.display_name,icon:"location_on",score:(0,On.H_)(t.trim(),f.display_name)},data:{type:Xt.R,projection:"EPSG:4326",geometry:i,extent:d,properties:n,meta:{id:T,title:f.display_name}}}}computeProperties(f){return{display_name:f.display_name,place_id:f.place_id,osm_type:f.osm_type,class:f.class,type:f.type}}computeGeometry(f){return{type:"Point",coordinates:[parseFloat(f.lon),parseFloat(f.lat)]}}computeExtent(f){return[parseFloat(f.boundingbox[2]),parseFloat(f.boundingbox[0]),parseFloat(f.boundingbox[3]),parseFloat(f.boundingbox[1])]}computeTerm(f){return this.computeTermTags(f)}computeTermTags(f){const t=super.getHashtagsValid(f,"amenity");return t?t.length?(f=f.replace(/(#[^\s]*)/g,""),t.forEach(n=>{f+="+["+n+"]"}),f):null:this.computeTermSettings(f)}computeTermSettings(f){return this.options.settings.forEach(t=>{"amenity"===t.name&&t.values.forEach(n=>{n.enabled&&"string"==typeof n.value&&n.value.split(",").forEach(d=>{f+="+["+d+"]"})})}),f}static \u0275fac=function(t){return new(t||ei)(e.KVO(u.Qq),e.KVO("options"),e.KVO(ao.n$))};static \u0275prov=e.jDH({token:ei,factory:ei.\u0275fac})}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20,cacheHasher:Et.lj}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[String,u.Nl]),(0,Ot.Sn)("design:returntype",Jt.c)],ei.prototype,"getSearch",null);var Ql=r(5247);class En extends So.C{http;languageService;static id="storedqueries";static type=Xt.R;static propertiesBlacklist=["boundedBy","id","coord_x","coord_y"];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(f,t,n,i){if(super(i,n),this.http=f,this.languageService=t,this.storedQueriesOptions=i,!this.storedQueriesOptions||this.storedQueriesOptions.available){if(this.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),this.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:"title"},this.resultTitle="title",console.log("Default values",this.storedQueriesOptions)),!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&this.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){let Me="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw Me+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(Me)}this.storedQueriesOptions.fields instanceof Array||(this.storedQueriesOptions.fields=[this.storedQueriesOptions.fields]),this.multipleFieldsQuery=this.storedQueriesOptions.fields.length>1,this.storedQueriesOptions.fields.forEach((Me,ke)=>{if(this.multipleFieldsQuery&&!Me.splitPrefix&&0!==ke)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!Me.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return En.id}getType(){return En.type}getDefaultOptions(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}search(f,t){const n=this.termSplitter(f,this.storedQueriesOptions.fields),i=this.computeRequestParams(t||{},n);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=t.page?String(t.page):"1",this.getSearch(f,i)}getSearch(f,t){return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,g.T)(n=>{let i=this.extractResults(this.extractWFSData(n),f);if(i.sort((d,T)=>d.meta.score>T.meta.score||d.meta.score===T.meta.score&&d.meta.titleHtml<T.meta.titleHtml?1:-1),i.reverse(),i.length>Number(this.options.params.limit)){const d=Number(this.options.params.limit)*Number(this.options.params.page),T=i.length;i=i.slice(0,d),i[i.length-1].meta.nextPage=d<T}return i})):this.http.get(this.searchUrl,{params:t}).pipe((0,g.T)(n=>this.extractResults(this.extractWFSData(n),f)))}getFormatFromOptions(){let f;const t=this.storedQueriesOptions.outputformat,n=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(f=_o.A),n.test(t)&&(f=Ql.A),new f}extractWFSData(f){const t=this.getFormatFromOptions(),n=_o.A,i=t.readFeatures(f);return JSON.parse((new n).writeFeatures(i))}termSplitter(f,t){const n={};let i=f,d=0;return t.forEach(B=>{n[B.name]=B.defaultValue;const me=new RegExp(B.splitPrefix+"(.+)","i");me.test(i)&&(d=B.splitPrefix?d+=1:d,i=i.split(me)[1])}),0===d?(n[t[0].name]=f,n):(i=f,[...t].reverse().forEach(B=>{const me=new RegExp(B.splitPrefix||"(.+)","i");if(i||""!==i){const fe=i.split(me);i=fe[0],fe[1]&&(n[B.name]=fe[1].trim())}}),n)}computeRequestParams(f,t){const n=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new u.Nl({fromObject:Object.assign({service:"wfs",version:n,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,f.params||{})})}extractResults(f,t){return f.features.map(n=>this.dataToResult(n,t))}dataToResult(f,t){const n=this.computeProperties(f),i=[this.getId(),n.type,f.id].join("."),d=f.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:Xt.R,projection:"EPSG:4326",geometry:f.geometry,properties:n,meta:{id:i,title:f.properties[d]}},meta:{dataType:Xt.R,id:i,title:f.properties.title,titleHtml:f.properties[d],icon:"location_on",score:(0,On.H_)(t.trim(),f.properties.title?f.properties.title:f.properties[d])}}}computeProperties(f){return Object.assign({},Et.BF.removeKeys(f.properties,En.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}static \u0275fac=function(t){return new(t||En)(e.KVO(u.Qq),e.KVO(y.gw),e.KVO(ao.n$),e.KVO("options"))};static \u0275prov=e.jDH({token:En,factory:En.\u0275fac})}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20,cacheHasher:Et.lj}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[String,u.Nl]),(0,Ot.Sn)("design:returntype",Jt.c)],En.prototype,"getSearch",null);class Dn extends So.C{http;languageService;static id="storedqueriesreverse";static type=Xt.R;static propertiesBlacklist=[];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(f,t,n,i){if(super(i,n),this.http=f,this.languageService=t,this.storedQueriesOptions=i,this.storedQueriesOptions&&(!this.storedQueriesOptions||this.storedQueriesOptions.available)){if(!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!this.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return Dn.id}getType(){return Dn.type}getDefaultOptions(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}reverseSearch(f,t){const n=this.computeRequestParams(f,t||{});return this.getReverseSearch(n)}getReverseSearch(f){return(new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:f,responseType:"text"}):this.http.get(this.searchUrl,{params:f})).pipe((0,g.T)(i=>this.extractResults(this.extractWFSData(i))))}getFormatFromOptions(){let f;const t=this.storedQueriesOptions.outputformat,n=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(f=_o.A),n.test(t)&&(f=Ql.A),new f}extractWFSData(f){const t=this.getFormatFromOptions(),n=_o.A,i=t.readFeatures(f);return JSON.parse((new n).writeFeatures(i))}computeRequestParams(f,t){const n={};return n[this.storedQueriesOptions.longField]=f[0],n[this.storedQueriesOptions.latField]=f[1],new u.Nl({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},n,this.params,t.params||{})})}extractResults(f){return f.features.map(t=>this.dataToResult(t))}dataToResult(f){const t=this.computeProperties(f),n=[this.getId(),t.type,f.id].join("."),i=f.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:Xt.R,projection:"EPSG:4326",geometry:f.geometry,properties:t,meta:{id:n,title:f.properties[i]}},meta:{dataType:Xt.R,id:n,title:f.properties[i],icon:"location_on"}}}computeProperties(f){const t=Et.BF.removeKeys(f.properties,Dn.propertiesBlacklist),n={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,{type:f.properties.doc_type},n)}static \u0275fac=function(t){return new(t||Dn)(e.KVO(u.Qq),e.KVO(y.gw),e.KVO(ao.n$),e.KVO("options"))};static \u0275prov=e.jDH({token:Dn,factory:Dn.\u0275fac})}(0,Ot.Cg)([(0,xn.R)({maxCacheCount:20,cacheHasher:Et.lj}),(0,Ot.Sn)("design:type",Function),(0,Ot.Sn)("design:paramtypes",[u.Nl]),(0,Ot.Sn)("design:returntype",Jt.c)],Dn.prototype,"getReverseSearch",null);let ql=(()=>{class l extends So.C{languageService;static id="workspace";static type=Xt.R;title$=new ce.t("");get title(){return this.title$.getValue()}constructor(t,n,i){super(i,n),this.languageService=t,this.languageService.translate.get(this.options.title).subscribe(d=>this.title$.next(d))}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"igo.geo.search.workspace.name",searchUrl:void 0,settings:[{type:"checkbox",title:"datasets",name:"datasets",values:[]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]}]}}search(t,n){const d=this.settings.find(Me=>"limit"===Me.name).values.find(Me=>Me.enabled).value||5;this.options.params.limit=d.toLocaleString();const T=[];this.options.params.page=(n.page||1).toLocaleString();const B=n.page||1,me=this.options.params.datasets.split(",");this.featureStoresWithIndex.filter(Me=>Me.searchDocument&&me.includes(Me.layer.title)).map(Me=>{const ke=t;Me.searchDocument.search(ke,{limit:B*d}).map(Je=>{const je=Je.field;Je.result.map(qe=>{const lt=Me.index.get(qe),bt=(0,On.H_)(ke.trim(),lt.properties[je]);T.push({index:qe,feature:lt,layer:Me.layer,field:je,score:bt})})})}),T.sort((Me,ke)=>Me.score>ke.score?-1:1);const fe=[],we=[];return T.map(Me=>{fe.includes(Me.index)||(fe.push(Me.index),we.push(Me))}),(0,Xe.of)(this.extractResults(we.sort((Me,ke)=>Me.score>ke.score?-1:1).slice(0,B*d)))}extractResults(t){return t.map(n=>this.dataToResult(n,t.length))}dataToResult(t,n){const i=this.computeProperties(t),d=[this.getId(),i.type,t.index].join("."),T=t.feature.properties[t.field],B="<br><small> "+t.layer.title+"</small>";return{source:this,data:{type:Xt.R,projection:"EPSG:4326",geometry:t.feature.geometry,extent:t.feature.extent,properties:i,meta:{id:d,title:t.feature.properties[t.field],alias:this.getAllowedFieldsAndAlias(t.layer)}},meta:{dataType:Xt.R,id:d,title:t.feature.meta.title,titleHtml:T+B,icon:"location_on",score:t.score,nextPage:n%+this.options.params.limit==0&&+this.options.params.page<10}}}getAllowedFieldsAndAlias(t){let n;return t.options?.source?.options?.sourceFields&&t.options.source.options.sourceFields.length>=1&&(n={},t.options.source.options.sourceFields.forEach(i=>{n[i.name]=i.alias?i.alias:i.name})),n}computeProperties(t){if(!t.feature.geometry)return Object.assign({type:t.layer.title+"."+t.field},t.feature.properties);const n={GoogleMaps:""};let i;if("Point"===t.feature.geometry.type)i=To.getGoogleMapsCoordLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]);else{const T=(0,Il.A)(t.feature.geometry);i=To.getGoogleMapsCoordLink(T.geometry.coordinates[0],T.geometry.coordinates[1])}n.GoogleMaps="<a href="+i+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a>","Point"===t.feature.geometry.type&&(n.GoogleStreetView=To.getGoogleStreetViewLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]));const d={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:t.feature.sourceId},t.feature.properties,n,d)}static \u0275fac=function(n){return new(n||l)(e.KVO(y.gw),e.KVO(ao.n$),e.KVO("options"))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac})}return l})();function vm(l,f,t){return new ql(l,f,t.getConfig(`searchSources.${ql.id}`))}function Cm(){return{kind:js.Workspace,providers:[{provide:So.C,useFactory:vm,multi:!0,deps:[y.gw,ao.n$,A.we]}]}}r(25583);var ec=r(42525),Sm=r(31736);function kr({feature:l,markerColor:f=[0,161,222],markerOpacity:t=1,markerOutlineColor:n=[0,255,255],fillColor:i,fillOpacity:d=.15,strokeColor:T=[0,255,255],strokeOpacity:B=.5,strokeWidth:me=4}){return tc({feature:l,markerColor:f,markerOpacity:t,markerOutlineColor:n,fillColor:i,fillOpacity:d,strokeColor:T,strokeOpacity:B,strokeWidth:me})}function tc({feature:l,markerColor:f=[0,161,222],markerOpacity:t=.5,markerOutlineColor:n,fillColor:i=[0,161,222],fillOpacity:d=.15,strokeColor:T=[0,161,222],strokeOpacity:B=.5,strokeWidth:me=2}){const fe=l instanceof Wt.A;let we,Me;fe?we=l.getGeometry():(we=l.geometry,Me=l.meta.mapTitle);const ke=fe?we.getType():we.type;if(we&&"Point"!==ke){const Je=(0,or._j)(i).slice(0),je=(0,or._j)(T).slice(0);return 4===Je.length&&("string"!=typeof i||/^#[0-9A-F]{8}$/i.test(i))||(Je[3]=d),4===je.length&&("string"!=typeof T||/^#[0-9A-F]{8}$/i.test(T))||(je[3]=B),(0,Sm.l)({text:Me,strokeWidth:me,strokeColor:je,fillColor:Je})}{const Je=(0,or._j)(f).slice(0),je=Je.slice(0,3);return 4===Je.length&&("string"!=typeof f||/^#[0-9A-F]{8}$/i.test(f))&&(t=Je[3]),(0,ec.O)({text:Me,opacity:t,markerOutlineColor:n,markerColor:je})}}let Tm=(()=>{class l{config;options;constructor(t){this.config=t,this.options=this.config.getConfig("regex")}getAll(){return this.options}get(t){if(this.options)return this.options[t]}static \u0275fac=function(n){return new(n||l)(e.KVO(A.we))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),Xs=(()=>{class l{regexService;geoServiceRegexes=[];constructor(t){this.regexService=t,this.geoServiceRegexes=this.getGeoServiceRegexes()}getPropertyType(t){return typeof t}isUrl(t){return/^https?:\/\//.test(t.toString())}isGeoService(t){let n=!1;if(this.isUrl){for(const i of this.geoServiceRegexes)if(new RegExp(i.url).test(t)){n=!0;break}return n}}getGeoService(t,n){if(!this.isGeoService(t))return;let i;for(const d of this.geoServiceRegexes)if(new RegExp(d.url).test(t)&&(i=n.filter(me=>d.propertiesForLayerName.includes(me))?d:void 0,i))break;return i}getGeoServiceRegexes(){return this.regexService.get("geoservice")||[]}static \u0275fac=function(n){return new(n||l)(e.KVO(Tm))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var jr=r(53994);class Ks extends jr.aR{options;inResolutionRange$=new ce.t(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(f){super(f),this.options=f,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}var Br=r(44038),Dt=r(44295);function Im(l){return l.entityStore.getStrategyOfType(Ne.fR).active$.pipe((0,g.T)(f=>f?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"))}function Fm(l){return l.entityStore.stateView.manyBy$(f=>!0===f.state.selected).pipe((0,g.T)(f=>f.length>=1))}function oc(l,f,t,n,i,d){const T=Et.BF.removeUndefined({sourceOptions:{type:n,url:t,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:"wms"===n?i:void 0,LAYER:"wms"===n?void 0:i}}});if("add"===l)d.createAsyncLayer(T).subscribe(B=>{f.layersAddedByClick$.next([B]),f.addLayer(B)});else if("remove"===l){const B=(0,Qn._E)(T.sourceOptions);f.removeLayer(f.layers.find(me=>me.id===B))}}function Hs(l,f,t,n){const i=function Mm(l,f){return[{name:"geoServiceAction",title:void 0,tooltip:"",renderer:Ne.pp.ButtonGroup,valueAccessor:(n,i)=>{let d=i.state.geoService;return d&&d.haveGeoServiceProperties&&d.url&&d.layerName?d.added?[{icon:"delete",color:"warn",click:(T,B)=>{oc("remove",l.map,B.state.geoService.url,B.state.geoService.type,B.state.geoService.layerName,f),d.added=!1}}]:[{icon:"add",color:"primary",click:(T,B)=>{oc("add",l.map,B.state.geoService.url,B.state.geoService.type,B.state.geoService.layerName,f),d.added=!0}}]:[]}}]}(l,t),d=f.dataSource.options.sourceFields||[],T=f.dataSource.options.relations||[];if(0===d.length)return void l.entityStore.entities$.pipe((0,Kn.j)(fe=>0===fe.length),(0,Ar.s)(1)).subscribe(fe=>{const we=fe[0].ol,Me=we.getKeys().filter(ke=>!ke.startsWith("_")&&"geometry"!==ke&&ke!==we.getGeometryName()&&!ke.match(/boundedby/gi)).map(ke=>({name:`properties.${ke}`,title:ke,renderer:Ne.pp.UnsanitizedHTML}));Me.unshift(...i),l.meta.tableTemplate={selection:!0,sort:!0,columns:Me,tableHeight:"100%"}});const B=d.map(fe=>({name:`properties.${fe.name}`,title:fe.alias?fe.alias:fe.name,renderer:Ne.pp.UnsanitizedHTML,tooltip:fe.tooltip,cellClassFunc:()=>{const we={};if(fe.type)return we[`class_${fe.type}`]=!0,we}})),me=T.map(fe=>({name:`properties.${fe.name}`,title:fe.alias?fe.alias:fe.name,renderer:Ne.pp.Icon,icon:fe.icon,parent:fe.parent,type:"relation",tooltip:fe.tooltip,onClick:()=>{n.next(fe.title)},cellClassFunc:()=>({class_icon:!0})}));B.push(...me),B.unshift(...i),l.meta.tableTemplate={selection:!0,sort:!0,columns:B,tableHeight:"100%"}}function Gr(){return new Ne.fR({filterClauseFunc:f=>!0===f.state.inMapExtent&&!0===f.state.inMapResolution})}let xm=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ce.t(void 0);constructor(t,n,i,d,T){this.storageService=t,this.configService=n,this.layerService=i,this.propertyTypeDetectorService=d,this.capabilitiesService=T}createWorkspace(t,n){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const i=new Ks({id:t.id,title:t.title,layer:t,map:n,entityStore:this.createFeatureStore(t,n),actionStore:new Br.uw([]),meta:{tableTemplate:void 0}});return Hs(i,t,this.layerService,this.ws$),i}createFeatureStore(t,n){const i=new Dt.oE([],{map:n});i.bindLayer(t);const d=new Dt.CJ({}),T=new Dt.MZ({}),B=new Dt.AI({map:n},this.propertyTypeDetectorService,this.capabilitiesService),me=new Dt.Sh({}),fe=new Ne.qA({}),we=this.configService.getConfig("queryOverlayStyle"),Me=new Dt.ZA({layer:new oe.vK({zIndex:300,source:new ft._k,style:ke=>kr(Object.assign({},{feature:ke},we?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Dt.Bl.Default:Dt.Bl.None,many:!0,dragBox:!0});return i.addStrategy(d,!0),i.addStrategy(T,!0),i.addStrategy(B,!0),i.addStrategy(me,!0),i.addStrategy(Me,!0),i.addStrategy(fe,!1),i.addStrategy(Gr(),!0),i}static \u0275fac=function(n){return new(n||l)(e.KVO(ao.n$),e.KVO(A.we),e.KVO(oe.BY),e.KVO(Xs),e.KVO(rt.w))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class nc extends jr.aR{options;inResolutionRange$=new ce.t(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(f){super(f),this.options=f,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}let Om=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ce.t(void 0);constructor(t,n,i,d,T){this.storageService=t,this.configService=n,this.layerService=i,this.propertyTypeDetectorService=d,this.capabilitiesService=T}createWorkspace(t,n){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const i=new nc({id:t.id,title:t.title,layer:t,map:n,entityStore:this.createFeatureStore(t,n),actionStore:new Br.uw([]),meta:{tableTemplate:void 0}});return Hs(i,t,this.layerService,this.ws$),i}createFeatureStore(t,n){const i=new Dt.oE([],{map:n});i.bindLayer(t);const d=new Dt.CJ({}),T=new Dt.px({percentDistinctValueRatio:2,sourceFields:t.dataSource.options.sourceFields}),B=new Dt.MZ({}),me=new Dt.AI({map:n},this.propertyTypeDetectorService,this.capabilitiesService),fe=new Dt.Sh({}),we=new Ne.qA({}),Me=this.configService.getConfig("queryOverlayStyle"),ke=new Dt.ZA({layer:new oe.vK({zIndex:300,source:new ft._k,style:Je=>kr(Object.assign({},{feature:Je},Me?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Dt.Bl.Default:Dt.Bl.None,many:!0,dragBox:!0});return t.options.workspace?.searchIndexEnabled&&i.addStrategy(T,!0),i.addStrategy(d,!0),i.addStrategy(B,!0),i.addStrategy(me,!0),i.addStrategy(fe,!0),i.addStrategy(ke,!0),i.addStrategy(we,!1),i.addStrategy(Gr(),!0),i}static \u0275fac=function(n){return new(n||l)(e.KVO(ao.n$),e.KVO(A.we),e.KVO(oe.BY),e.KVO(Xs),e.KVO(rt.w))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var wm=r(16613),Em=r(77662);let Dm=(()=>{class l{dialogRef;languageService;data;constructor(t,n,i){this.dialogRef=t,this.languageService=n,this.data=i}cancelAction(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}confirmedAction(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}static \u0275fac=function(n){return new(n||l)(e.rXU(Ct.CP),e.rXU(y.gw),e.rXU(Ct.Vh))};static \u0275cmp=e.VBU({type:l,selectors:[["igo-confirmation-popup-component"]],standalone:!0,features:[e.aNF],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"p",1),e.EFF(2),e.k0s()(),e.j41(3,"div",2)(4,"button",3),e.bIt("click",function(){return i.confirmedAction()}),e.EFF(5," Ok "),e.k0s(),e.j41(6,"button",4),e.bIt("click",function(){return i.cancelAction()}),e.EFF(7),e.k0s()()),2&n&&(e.R7$(2),e.SpI(" ",i.languageService.translate.instant("add"===i.data.type?"igo.geo.workspace.addConfirmation":"igo.geo.workspace.deleteConfirmation")," "),e.R7$(5),e.SpI(" ",i.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[Ct.Yi,Ct.E7,L.Hl,L.$z],styles:["div.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:center}"]})}return l})();class ic extends jr.aR{dialog;configService;adding$;getDomainValues;options;inResolutionRange$=new ce.t(!0);get layer(){return this.options.layer}get map(){return this.options.map}drawControl;drawEnd$$;olDrawingLayerSource=new ln.A;olDrawingLayer;geometryType=wt;modify;modifyStyle=new st.Ay({stroke:new Ze.A({color:"rgba(255,255,255,1)",width:1}),fill:new _t.A({color:"rgba(0,161,222,1)"}),image:new ht.A({radius:7,stroke:new Ze.A({color:"rgba(255,255,255,1)",width:1}),fill:new _t.A({color:"rgba(0,161,222,1)"})})});newFeaturefilterClauseFunc=f=>!0===f.state.newFeature;editFeaturefilterClauseFunc=f=>!0===f.state.edit;fillColor;strokeColor;strokeWidth;constructor(f,t,n,i,d){super(d),this.dialog=f,this.configService=t,this.adding$=n,this.getDomainValues=i,this.options=d,this.map.viewController.resolution$.subscribe(T=>{this.inResolutionRange$.next(T>this.layer.minResolution&&T<this.layer.maxResolution)}),this.drawControl=this.createDrawControl(),this.drawControl.setGeometryType(this.geometryType.Point),this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayer=new oe.vK({id:"igo-draw-layer",title:"edition",zIndex:300,source:new ft._k,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}})}deleteFeature(f,t){setTimeout(()=>{this.dialog.open(Dm,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(i=>{if(!1===i){let d,T;const B=t.layer.dataSource.options.edition.baseUrl,me=t.layer.dataSource.options.edition.deleteUrl;T=B.length?this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+B+"?"+me:B+"?"+me:this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+me:me;for(const fe of t.meta.tableTemplate.columns)for(const we in f.properties){let Me=fe.name;Me.includes("properties.")&&(Me=Me.split(".")[1]),Me===we&&!0===fe.primary&&(d=f.properties[we])}T&&(T+=d,this.deleteFeature(t,T))}})},250)}editFeature(f,t){f.edition=!0;let n,i=!1;const d=t.layer.dataSource.options.edition;for(const T of t.meta.tableTemplate.columns)if(("list"===T.type||"autocomplete"===T.type)&&this.getDomainValues(T.relation).subscribe(B=>{T.domainValues=B}),!1===i)for(const B in f.properties){let me=T.name;if(me.includes("properties.")&&(me=me.split(".")[1]),me===B&&!0===T.primary){n=f.properties[B],i=!0;break}}n?(f.original_properties=JSON.parse(JSON.stringify(f.properties)),f.original_geometry=f.geometry,f.idkey=n,t.entityStore.state.updateAll({edit:!1}),t.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(f,t)):!f.newFeature&&d.geomType&&(f.newFeature=!0,this.adding$.next(!0),t.entityStore.state.updateAll({newFeature:!1}),t.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),d.addWithDraw?this.onGeometryTypeChange(d.geomType,f,t):(t.entityStore.insert(f),t.entityStore.state.update(f,{newFeature:!0},!0)))}createDrawControl(f,t,n){return new sm.SW({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new st.Ay({}),interactionStyle:Un(f,t,n)})}onGeometryTypeChange(f,t,n){this.drawControl.setGeometryType(f),this.toggleDrawControl(t,n)}toggleDrawControl(f,t){this.deactivateDrawControl(),this.activateDrawControl(f,t)}deactivateDrawControl(){this.drawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}activateDrawControl(f,t){this.drawEnd$$=this.drawControl.end$.subscribe(n=>{this.addFeatureToStore(f,t,n)}),this.drawControl.setOlMap(this.map.ol,!0)}addFeatureToStore(f,t,n){const i=this.map.ol.getView().getProjection();let d=f.geometry;n?(t.entityStore.insert(f),t.entityStore.state.update(f,{newFeature:!0},!0),d=(new _o.A).writeGeometryObject(n,{featureProjection:i,dataProjection:"EPSG:4326"}),f.geometry=d):t.entityStore.state.update(f,{edit:!0},!0),f.projection="EPSG:4326";const T=(0,Dt.xH)(f,i.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(T),this.map.addLayer(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(T,f,t)}deleteDrawings(){this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}createModifyInteraction(f,t,n){this.map.ol.removeInteraction(this.modify);const i=new wm.A([f],{unique:!0});this.modify=new Em.A({features:i}),this.map.ol.addInteraction(this.modify),i.forEach(d=>{d.setStyle(this.modifyStyle)}),this.modify.on("modifyend",d=>{const T=d.features.getArray()[0]?.getGeometry();T&&this.addFeatureToStore(t,n,T)})}}let Rm=(()=>{class l{layerService;storageService;configService;messageService;http;dialog;styleService;authInterceptor;ws$=new ce.t(void 0);adding$=new ce.t(!1);relationLayers$=new ce.t(void 0);rowsInMapExtentCheckCondition$=new ce.t(!0);loading=!1;wktFormat=new wo.A;geoJsonFormat=new _o.A;get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,n,i,d,T,B,me,fe){this.layerService=t,this.storageService=n,this.configService=i,this.messageService=d,this.http=T,this.dialog=B,this.styleService=me,this.authInterceptor=fe}createWorkspace(t,n){if(!0!==t.options.workspace?.enabled||!0!==t.dataSource.options.edition.enabled)return;let i;i=t.options.workspace?t.options.workspace:{},i.srcId=t.id,i.workspaceId=t.id,i.enabled=!0,i.pageSize=t.options.workspace?.pageSize,i.pageSizeOptions=t.options.workspace?.pageSizeOptions;const d=t.dataSource,T=t.id+".WmsWorkspaceTableSrc",B=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:T,links:[]});const me={syncedDelete:!0,linkedIds:[B],properties:[oe.X9.ZINDEX,oe.X9.VISIBLE]};t.options.workspace?.minResolution||me.properties.push(oe.X9.MINRESOLUTION);let fe=!1;d.options.ogcFilters?.enabled&&(me.properties.push(oe.X9.OGCFILTERS),fe=!0),t.options.workspace?.maxResolution||me.properties.push(oe.X9.MAXRESOLUTION);let Me,we=[];return t.options.linkedLayers.links&&(we=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),we.push(me),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:T,t.options.linkedLayers.links=we,this.layerService.createAsyncLayer({id:B,linkedLayers:{linkId:B},workspace:{srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:!1},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:d.options.download,type:"wfs",url:d.options.urlWfs||d.options.url,queryable:!0,relations:d.options.relations,queryTitle:d.options.queryTitle,params:d.options.paramsWFS,ogcFilters:Object.assign({},d.ogcFilters,{enabled:fe}),sourceFields:d.options.sourceFields||void 0,edition:d.options.edition}}).subscribe(ke=>(n.addLayer(ke),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:we}},!1),ke.dataSource.ol.refresh(),Me=new ic(this.dialog,this.configService,this.adding$,Je=>this.getDomainValues(Je),{id:t.id,title:t.title,layer:ke,map:n,entityStore:this.createFeatureStore(ke,n),actionStore:new Br.uw([]),meta:{tableTemplate:void 0}}),this.createTableTemplate(Me,ke),ke.options.workspace.workspaceId=ke.id,t.options.workspace=Object.assign({},t.options.workspace,{wksConfig:i}),delete d.options.download,Me)),Me}createFeatureStore(t,n){const i=new Dt.oE([],{map:n});i.bindLayer(t);const d=new Dt.CJ({}),T=new Dt.MZ({}),B=new Dt.Sh({}),me=new Ne.qA({}),fe=new Dt.ZA({layer:new oe.vK({zIndex:300,source:new In._,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Dt.Bl.Default:Dt.Bl.None,many:!0,dragBox:!0});return i.addStrategy(d,!0),i.addStrategy(T,!0),i.addStrategy(B,!0),i.addStrategy(fe,!0),i.addStrategy(me,!1),i.addStrategy(Gr(),!0),i}createTableTemplate(t,n){const i=n.dataSource.options.sourceFields||[],d=n.dataSource.options.relations||[];let T=Ne.pp.UnsanitizedHTML,B=[],me=[],fe=[];B=[{name:"edition",title:void 0,renderer:Ne.pp.ButtonGroup,primary:!1,valueAccessor:()=>[{editMode:!1,icon:"edit",color:"primary",disabled:!1===n.dataSource.options.edition.modifyButton,click:we=>{t.editFeature(we,t)}},{editMode:!1,icon:"delete",color:"warn",disabled:!1===n.dataSource.options.edition.deleteButton,click:we=>{t.deleteFeature(we,t)}},{editMode:!0,icon:"check",color:"primary",disabled:this.loading,click:we=>{this.saveFeature(we,t)}},{editMode:!0,icon:"close",color:"primary",disabled:this.loading,click:we=>{this.cancelEdit(t,we)}}]}],0!==i.length?(me=i.map(we=>{let Me={name:`properties.${we.name}`,title:we.alias?we.alias:we.name,renderer:T,valueAccessor:void 0,cellClassFunc:()=>{const ke={};if(we.type)return ke[`class_${we.type}`]=!0,ke},primary:!0===we.primary,visible:we.visible,validation:we.validation,linkColumnForce:we.linkColumnForce,type:we.type,domainValues:void 0,relation:void 0,multiple:we.multiple,step:we.step,tooltip:we.tooltip};return("list"===we.type||"autocomplete"===we.type)&&this.getDomainValues(we.relation).subscribe(ke=>{Me.domainValues=ke,Me.relation=we.relation}),Me}),fe=d.map(we=>({name:`properties.${we.name}`,title:we.alias?we.alias:we.name,renderer:Ne.pp.Icon,icon:we.icon,parent:we.parent,type:"relation",tooltip:we.tooltip,onClick:()=>{!1===this.adding$.getValue()&&this.ws$.next(we.title)},cellClassFunc:()=>({class_icon:!0})})),me.push(...fe),me.push(...B),t.meta.tableTemplate={selection:!1,sort:!0,columns:me}):t.entityStore.entities$.pipe((0,Kn.j)(we=>0===we.length),(0,Ar.s)(1)).subscribe(we=>{const Me=we[0].ol,ke=Me.getKeys().filter(Je=>!Je.startsWith("_")&&"geometry"!==Je&&Je!==Me.getGeometryName()&&!Je.match(/boundedby/gi)).map(Je=>({name:`properties.${Je}`,title:Je,renderer:T}));t.meta.tableTemplate={selection:!1,sort:!0,columns:ke}})}saveFeature(t,n){if(!this.validateFeature(t,n))return!1;this.sanitizeParameter(t,n);const i=n.layer.dataSource.options.edition.baseUrl;let d=this.configService.getConfig("edition.url");if(d?d+=i||"":d=i,t.newFeature){d+=n.layer.dataSource.options.edition.addUrl;const B=new u.Lr(n.layer.dataSource.options.edition.addHeaders);this.addFeature(t,n,d,B)}else{d+="post"!==n.layer.dataSource.options.edition.modifyProtocol?"?"+n.layer.dataSource.options.edition.modifyUrl+t.idkey:n.layer.dataSource.options.edition.modifyUrl;const T=n.layer.dataSource.options.edition.modifyProtocol,me=new u.Lr(n.layer.dataSource.options.edition.modifyHeaders);this.modifyFeature(t,n,d,me,T)}}addFeature(t,n,i,d){if(n.layer.dataSource.options.edition.hasGeometry){const T=n.layer.options.sourceOptions.edition.geomDatabaseProj;t.properties[n.layer.dataSource.options.params.fieldNameGeometry]="SRID="+T.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",T),{dataProjection:T})}for(const T in t.properties)for(const B of n.layer.dataSource.options.sourceFields)(B.name===T&&B.validation?.readonly||B.name===T&&!1===B.validation?.send)&&delete t.properties[T];this.loading=!0,this.http.post(`${i}`,t.properties,{headers:d}).subscribe(()=>{this.loading=!1,n.entityStore.stateView.clear(),n.deleteDrawings(),n.entityStore.delete(t),this.messageService.success("igo.geo.workspace.addSuccess"),this.refreshMap(n.layer,n.layer.map),this.adding$.next(!1),this.rowsInMapExtentCheckCondition$.next(!0)},T=>{this.loading=!1,T.error.caught=!0;const B=n.layer.dataSource.options.edition.messages;if(B){let me;B.forEach(fe=>{const we=Object.keys(fe)[0];T.error.message.includes(we)&&(me=fe[we],this.messageService.error(me))}),me||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}deleteFeature(t,n){this.loading=!0,this.http.delete(`${n}`,{}).subscribe(()=>{this.loading=!1,this.messageService.success("igo.geo.workspace.deleteSuccess"),this.refreshMap(t.layer,t.layer.map);for(const i of t.layer.options.sourceOptions.relations)t.map.layers.forEach(d=>{d.title===i.title&&d.dataSource.ol.refresh()})},i=>{this.loading=!1,i.error.caught=!0;const d=t.layer.dataSource.options.edition.messages;if(d){let T;d.forEach(B=>{const me=Object.keys(B)[0];i.error.message.includes(me)&&(T=B[me],this.messageService.error(T))}),T||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}modifyFeature(t,n,i,d,T="patch"){if(n.layer.dataSource.options.edition.hasGeometry){const B=n.layer.options.sourceOptions.edition.geomDatabaseProj;t.geometry.coordinates=rc(t.geometry.coordinates),t.properties[n.layer.dataSource.options.params.fieldNameGeometry]="SRID="+B.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",B),{dataProjection:B})}for(const B in t.properties)for(const me of n.layer.dataSource.options.sourceFields)(me.name===B&&me.validation?.readonly||me.name===B&&!1===me.validation?.send||"boundedBy"===B)&&delete t.properties[B];this.loading=!0,this.http[T](`${i}`,t.properties,{headers:d}).subscribe(()=>{this.loading=!1,this.cancelEdit(n,t,!0),this.messageService.success("igo.geo.workspace.modifySuccess"),this.refreshMap(n.layer,n.layer.map);let B=[];for(const me of n.layer.options.sourceOptions.relations)n.map.layers.forEach(fe=>{fe.title===me.title&&(B.push(fe),fe.dataSource.ol.refresh())});this.relationLayers$.next(B)},B=>{this.loading=!1,B.error.caught=!0;const me=n.layer.dataSource.options.edition.messages;if(me){let fe;me.forEach(we=>{const Me=Object.keys(we)[0];B.error.message.includes(Me)&&(fe=we[Me],this.messageService.error(fe))}),fe||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}cancelEdit(t,n,i=!1){n.edition=!1,this.adding$.next(!1),t.deleteDrawings(),t.entityStore.stateView.clear(),n.newFeature?(t.entityStore.delete(n),t.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(i||(n.properties=n.original_properties,n.geometry=n.original_geometry),delete n.original_properties,delete n.original_geometry)}getDomainValues(t){let n=t.url;return n||(n=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+t.table:t.table),this.http.get(n).pipe((0,g.T)(i=>i),(0,Be.W)(i=>(i.error.caught=!0,(0,ot.$)(i))))}refreshMap(t,n){const i=t.dataSource.ol;i.setLoader((T,B,me,fe,we)=>{t.customWFSLoader(t.ol.getSource(),t.options.sourceOptions,this.authInterceptor,T,B,me,fe,we,!0)}),i.refresh();for(const T of n.layers)if(T.id!==t.id&&T.options.linkedLayers?.linkId.includes(t.id.substr(0,t.id.indexOf(".")-1))&&T.options.linkedLayers?.linkId.includes("WmsWorkspaceTableSrc")){const B=T.dataSource.ol;let me=B.getParams();me._t=(new Date).getTime(),B.updateParams(me)}}validateFeature(t,n){let d,T=!0;return n.meta.tableTemplate.columns.forEach(B=>{B.hasOwnProperty("validation")&&B.validation&&(d=Vr(B.name),Object.keys(B.validation).forEach(me=>{switch(me){case"mandatory":B.validation[me]&&(!t.properties.hasOwnProperty(d)||!t.properties[d])&&(T=!1,this.messageService.error("igo.geo.formValidation.mandatory",void 0,void 0,{column:B.title}));break;case"minValue":t.properties.hasOwnProperty(d)&&t.properties[d]&&t.properties[d]<B.validation[me]&&(T=!1,this.messageService.error("igo.geo.formValidation.minValue",void 0,void 0,{column:B.title,value:B.validation[me]}));break;case"maxValue":t.properties.hasOwnProperty(d)&&t.properties[d]&&t.properties[d]>B.validation[me]&&(T=!1,this.messageService.error("igo.geo.formValidation.maxValue",void 0,void 0,{column:B.title,value:B.validation[me]}));break;case"minLength":t.properties.hasOwnProperty(d)&&t.properties[d]&&t.properties[d].length<B.validation[me]&&(T=!1,this.messageService.error("igo.geo.formValidation.minLength",void 0,void 0,{column:B.title,value:B.validation[me]}));break;case"maxLength":t.properties.hasOwnProperty(d)&&t.properties[d]&&t.properties[d].length>B.validation[me]&&(T=!1,this.messageService.error("igo.geo.formValidation.maxLength",void 0,void 0,{column:B.title,value:B.validation[me]}))}}))}),T}sanitizeParameter(t,n){n.meta.tableTemplate.columns.forEach(i=>{"list"===i.type&&t.properties[Vr(i.name)]&&(t.properties[Vr(i.name)]=t.properties[Vr(i.name)].toString())})}static \u0275fac=function(n){return new(n||l)(e.KVO(oe.BY),e.KVO(ao.n$),e.KVO(A.we),e.KVO(k.bg),e.KVO(u.Qq),e.KVO(Ct.bZ),e.KVO(qi.J),e.KVO(Bs._L))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function Vr(l){return l.includes("properties.")?l.split(".")[1]:l}function rc(l){return 0===l.length?l:"number"==typeof l[0]?l.slice(0,2):l.map(rc)}var Pm=r(66720);let $m=(()=>{class l{layerService;storageService;capabilitiesService;styleService;configService;propertyTypeDetectorService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ce.t(void 0);constructor(t,n,i,d,T,B){this.layerService=t,this.storageService=n,this.capabilitiesService=i,this.styleService=d,this.configService=T,this.propertyTypeDetectorService=B}createWorkspace(t,n){if(!t.options.workspace||n.layers.find(ke=>ke.id===t.id+".WfsWorkspaceTableDest")||t.dataSource.options.edition)return;const i=t.dataSource,d=t.id+".WmsWorkspaceTableSrc",T=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:d,links:[]});const B={syncedDelete:!0,linkedIds:[T],properties:[oe.X9.ZINDEX,oe.X9.VISIBLE]};t.options.workspace?.minResolution||B.properties.push(oe.X9.MINRESOLUTION);let me=!1;i.options.ogcFilters?.enabled&&(B.properties.push(oe.X9.OGCFILTERS),me=!0),t.options.workspace?.maxResolution||B.properties.push(oe.X9.MAXRESOLUTION);let we,fe=[];return t.options.linkedLayers.links&&(fe=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),fe.push(B),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:d,t.options.linkedLayers.links=fe,this.layerService.createAsyncLayer({isIgoInternalLayer:!0,id:T,linkedLayers:{linkId:T},workspace:{printable:t.options.workspace?.printable,srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:i.options.download,type:"wfs",url:i.options.urlWfs||i.options.url,queryable:!0,relations:i.options.relations,queryTitle:i.options.queryTitle,queryFormatAsWms:!t.options.workspace?.enabled||i.options.queryFormatAsWms,params:i.options.paramsWFS,ogcFilters:Object.assign({},i.ogcFilters,{enabled:me}),sourceFields:i.options.sourceFields||void 0}}).subscribe(ke=>{if(n.addLayer(ke),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:fe}},!1),ke.dataSource.ol.refresh(),t.options.workspace?.enabled)return we=new Ks({id:t.id,title:t.title,layer:ke,map:n,entityStore:this.createFeatureStore(ke,n),actionStore:new Br.uw([]),meta:{tableTemplate:void 0}}),Hs(we,ke,this.layerService,this.ws$),ke.options.workspace.workspaceId=ke.id,t.options.workspace=Object.assign({},t.options.workspace,{enabled:!0,srcId:t.id,workspaceId:ke.id,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions}),delete i.options.download,we}),we}createFeatureStore(t,n){const i=new Dt.oE([],{map:n});i.bindLayer(t);const d=new Dt.CJ({}),T=new Dt.MZ({}),B=new Dt.AI({map:n},this.propertyTypeDetectorService,this.capabilitiesService),me=new Dt.Sh({}),fe=new Ne.qA({}),we=this.configService.getConfig("queryOverlayStyle"),Me=new Dt.ZA({layer:new oe.vK({zIndex:300,source:new In._,style:ke=>kr(Object.assign({},{feature:ke},we?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Dt.Bl.Default:Dt.Bl.None,many:!0,dragBox:!0});return i.addStrategy(d,!0),i.addStrategy(T,!0),i.addStrategy(B,!0),i.addStrategy(me,!0),i.addStrategy(Me,!0),i.addStrategy(fe,!1),i.addStrategy(Gr(),!0),i}static \u0275fac=function(n){return new(n||l)(e.KVO(oe.BY),e.KVO(ao.n$),e.KVO(rt.w),e.KVO(qi.J),e.KVO(A.we),e.KVO(Xs))};static \u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),Lm=(()=>{class l{component;wfsWorkspaceService;wmsWorkspaceService;editionWorkspaceService;featureWorkspaceService;layers$$;entities$$=[];map;changeWorkspace=new e.bkB;disableSwitch=new e.bkB;relationLayers=new e.bkB;rowsInMapExtentCheckCondition=new e.bkB;get workspaceStore(){return this.component.store}constructor(t,n,i,d,T){this.component=t,this.wfsWorkspaceService=n,this.wmsWorkspaceService=i,this.editionWorkspaceService=d,this.featureWorkspaceService=T}ngOnInit(){this.layers$$=this.map.layers$.pipe((0,ho.B)(50)).subscribe(t=>this.onLayersChange(t)),this.featureWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wmsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wfsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.adding$.subscribe(t=>{this.disableSwitch.emit(t)}),this.editionWorkspaceService.relationLayers$.subscribe(t=>{this.relationLayers.emit(t)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(t=>{this.rowsInMapExtentCheckCondition.emit(t)})}ngOnDestroy(){this.layers$$.unsubscribe(),this.entities$$.map(t=>t.unsubscribe())}onLayersChange(t){const n=t.filter(B=>this.layerIsEditable(B)),i=n.map(B=>B.id),d=n.map(B=>this.getOrCreateWorkspace(B)).filter(B=>void 0!==B),T=this.workspaceStore.all().filter(B=>i.indexOf(B.id)<0);T.length>0&&(T.forEach(B=>{B.entityStore.deactivateStrategyOfType(Pm.M),B.deactivate()}),this.workspaceStore.state.updateMany(T,{active:!1,selected:!1}),this.workspaceStore.deleteMany(T)),d.length>0&&this.workspaceStore.insertMany(d)}getOrCreateWorkspace(t){if(void 0===this.workspaceStore.get(t.id)){if(t.dataSource instanceof ft._K&&!0!==t.dataSource.options.edition?.enabled)return this.wfsWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof ft.Tg&&!0!==t.dataSource.options.edition?.enabled){if(!t.dataSource.options.paramsWFS)return;const i=this.wmsWorkspaceService.createWorkspace(t,this.map);return i?.inResolutionRange$.subscribe(d=>{t.dataSource.options.queryable=!d,i.layer.dataSource.options.queryable=d}),i}if(t.dataSource instanceof ft._k&&!0===t.exportable&&!0!==t.dataSource.options.edition?.enabled)return this.featureWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof ft.Tg&&!0===t.dataSource.options.edition?.enabled)return this.editionWorkspaceService.createWorkspace(t,this.map)}}layerIsEditable(t){const n=t.dataSource;return n instanceof ft._K||n instanceof ft._k||n instanceof ft.Tg&&((n.options||{}).ogcFilters?.enabled||void 0!==n.options.paramsWFS?.featureTypes)}static \u0275fac=function(n){return new(n||l)(e.rXU(jr.go),e.rXU(xm),e.rXU($m),e.rXU(Rm),e.rXU(Om))};static \u0275dir=e.FsC({type:l,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"},standalone:!0})}return l})()},68671:(De,le,r)=>{"use strict";r.d(le,{o4:()=>a,og:()=>_,B0:()=>L,Pr:()=>y,ED:()=>D,ZM:()=>ee,BF:()=>x,$x:()=>k,Bi:()=>j,ZV:()=>P,lj:()=>p,e5:()=>h,zM:()=>H,EQ:()=>N,Jw:()=>Z,N1:()=>o,uR:()=>g});let a=(()=>class Y{static PADCHAR="=";static ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static getByte(I,E){return I.charCodeAt(E)}static getByte64(I,E){return this.ALPHA.indexOf(I.charAt(E))}static decode(I){let s,z,E=0,Q=I.length,ae=[];if(I=String(I),0===Q)return I;for(I.charAt(Q-1)===this.PADCHAR&&(E=1,I.charAt(Q-2)===this.PADCHAR&&(E=2),Q-=4),s=0;s<Q;s+=4)z=this.getByte64(I,s)<<18|this.getByte64(I,s+1)<<12|this.getByte64(I,s+2)<<6|this.getByte64(I,s+3),ae.push(String.fromCharCode(z>>16,z>>8&255,255&z));switch(E){case 1:z=this.getByte64(I,s)<<18|this.getByte64(I,s+1)<<12|this.getByte64(I,s+2)<<6,ae.push(String.fromCharCode(z>>16,z>>8&255));break;case 2:z=this.getByte64(I,s)<<18|this.getByte64(I,s+1)<<12,ae.push(String.fromCharCode(z>>16))}return ae.join("")}static encode(I){let E,s,z=[],Q=(I=String(I)).length-I.length%3;if(0===I.length)return I;for(E=0;E<Q;E+=3)s=this.getByte(I,E)<<16|this.getByte(I,E+1)<<8|this.getByte(I,E+2),z.push(this.ALPHA.charAt(s>>18)),z.push(this.ALPHA.charAt(s>>12&63)),z.push(this.ALPHA.charAt(s>>6&63)),z.push(this.ALPHA.charAt(63&s));switch(I.length-Q){case 1:s=this.getByte(I,E)<<16,z.push(this.ALPHA.charAt(s>>18)+this.ALPHA.charAt(s>>12&63)+this.PADCHAR+this.PADCHAR);break;case 2:s=this.getByte(I,E)<<16|this.getByte(I,E+1)<<8,z.push(this.ALPHA.charAt(s>>18)+this.ALPHA.charAt(s>>12&63)+this.ALPHA.charAt(s>>6&63)+this.PADCHAR)}return z.join("")}})();var F=r(46443);function p(Y){return Y.map(w=>w instanceof F.Nl?w.toString():void 0!==w?JSON.parse(JSON.stringify(w)):w)}var e=r(49220);const o=r.n(e)().getParser(window.navigator.userAgent);class L{static copy(w){let I=!1;if("string"==typeof w){const E=L.createTextArea(w);L.selectText(E),I=L.copyTextToClipboard(),L.destroyTextArea(E)}else L.selectText(w),I=L.copyTextToClipboard();return I}static createTextArea(w){const I=document.createElement("textArea");return I.value=w,document.body.appendChild(I),I}static destroyTextArea(w){document.body.removeChild(w)}static selectText(w){if("iOS"===o.getOSName()){const I=w.contentEditable,E=w.readOnly,s=document.createRange(),z=window.getSelection();w.contenteditable=!0,w.readonly=!1,s.selectNodeContents(w),z.removeAllRanges(),z.addRange(s),w.setSelectionRange(0,999999),w.contentEditable=I,w.readOnly=E}else w.select()}static copyTextToClipboard(){return("iOS"!==o.getOSName()||!o.compareVersion("<10"))&&document.execCommand("copy")}}var R=r(43942);function v(Y,w,I){return Y>>w&(1<<I)-1}class y{base64Index=new Map;indexBase64=new Map;constructor(){this.generateBase64Index()}generateBase64Index(){for(let w=0;w<26;w++)this.base64Index.set(String.fromCharCode(65+w),w),this.indexBase64.set(w,String.fromCharCode(65+w));for(let w=0;w<26;w++)this.base64Index.set(String.fromCharCode(97+w),w+26),this.indexBase64.set(w+26,String.fromCharCode(97+w));for(let w=0;w<10;w++)this.base64Index.set(String.fromCharCode(48+w),w+52),this.indexBase64.set(w+52,String.fromCharCode(48+w));this.base64Index.set("+",62),this.base64Index.set("/",63),this.indexBase64.set(62,"+"),this.indexBase64.set(63,"/")}compressBlob(w){return w?new R.c(E=>{const s=new FileReader;s.readAsDataURL(w),s.onload=()=>{const z=s.result.valueOf(),Q=z.substr(z.indexOf(",")+1),ae=this.compressStringBase64(Q);E.next({length:Q.length,type:w.type,object:ae})}}):void 0}decompressBlob(w){const s=this.decompressStringBase64(w.object,w.length),z=atob(s),Q=new Array(z.length);for(let de=0;de<z.length;de++)Q[de]=z.charCodeAt(de);const ae=new Uint8Array(Q);return new Blob([ae],{type:w.type})}compressStringBase64(w){let I="",E=16,s=0,z=0;for(const Q of w){const ae=this.base64Index.get(Q);E>6?(E-=6,s+=ae<<E):(z=6-E,s+=ae>>z,I+=String.fromCharCode(s),s=ae<<16-z,E=16-z)}return w.length%8!=0&&(I+=String.fromCharCode(s)),"\u2603"+I}decompressStringBase64(w,I){if(!w)return;if(9731!==w.charCodeAt(0))return w;let E=0,s=0,z=16,Q="",ae=1,ye=w.charCodeAt(ae);for(let de=0;de<I;de++)z>6?(z-=6,E=v(ye,z,6),Q+=this.indexBase64.get(E)):(s=6-z,E=v(ye,0,z)<<s,ye=w.charCodeAt(++ae),E+=v(ye,16-s,s),Q+=this.indexBase64.get(E),z=16-s);return Q}}var b=function(Y){return Y.ADDED="added",Y.DELETED="deleted",Y.MODIFIED="modified",Y}(b||{});class k{static diff(w,I,E=4){if(!w&&!I)return"";if(!w)return'<span class="inserted">'+I+"</span>";if(!I)return'<span class="deleted">'+w+"</span>";w=w.toString(),I=I.toString();const s=k.getChanges(w,I,"",E),z=I.slice(s.mtc.length+s.ins.length+s.sbs.length),Q=w.slice(s.mtc.length+s.del.length+s.sbs.length);let ae="";return s.del.length>0&&(s.del='<span class="deleted">'+s.del+"</span>"),s.ins.length>0&&(s.ins='<span class="inserted">'+s.ins+"</span>"),ae=s.mtc+s.del+s.ins+s.sbs,ae+=""!==Q||""!==z?k.diff(Q,z,E):"",ae}static getMatchingSubstring(w,I,E){let s=0,z=!1;const Q=w.length,ae={fis:Q,mtc:E,sbs:""};for(;s<Q;)I[s]===w[s]?z?ae.sbs+=w[s]:(z=!0,ae.fis=s,ae.sbs=w[s]):z&&(s=Q),++s;return ae}static getChanges(w,I,E,s){const z=w.length>=w.length;let[Q,ae]=z?[w,I]:[I,w],ye=0;for(;ae[ye]===Q[ye]&&ye<ae.length;)++ye;Q=Q.split("").slice(ye),ae=ae.slice(ye);const de=Q.length;let ue={fis:ae.length,fil:de,sbs:"",mtc:E+I.slice(0,ye)},ce={sbs:""};if(""!==ae)for(let re=0;re<de&&ce.sbs.length<s;re++)ce=k.getMatchingSubstring(ae,k.rotateArray(Q,re),ue.mtc),ce.fil=re<de-ce.fis?ce.fis+re:ce.fis-de+re,ce.sbs.length>ue.sbs.length&&(ue=ce);return[ue.del,ue.ins]=z?[Q.slice(0,ue.fil).join(""),ae.slice(0,ue.fis)]:[ae.slice(0,ue.fis),Q.slice(0,ue.fil).join("")],-1===ue.del.indexOf(" ")||-1===ue.ins.indexOf(" ")||""===ue.del||""===ue.ins||""===ue.sbs?ue:k.getChanges(ue.del,ue.ins,ue.mtc,s)}static rotateArray(w,I){const E=w.length,s=new Array(w.length);if(I%E==0)return w.slice();for(let z=0;z<E;z++)s[z]=w[(z+(E+I%E))%E];return s}static isValidNumber(w){return!isNaN(Number(w))}static isOctalNumber(w){return k.isValidNumber(w)&&w.startsWith("0")&&w.length>1}}class _{static findChanges(w,I,E=[]){const s={added:[],deleted:[],modified:[]};if(!w||!I)return s;const z=[...w],Q=[...I];for(const ae of z){const ye=Q.findIndex(be=>be.id===ae.id);if(-1===ye){s.deleted.push({change:{type:b.DELETED},value:ae});continue}const de=Q.splice(ye,1)[0],ue=JSON.parse(JSON.stringify(ae)),ce=JSON.parse(JSON.stringify(de)),re=_.compareObject(ue,ce,void 0,E);re.length&&s.modified.push({change:{type:b.MODIFIED,keysChanged:re},value:ue,oldValue:ae,newValue:de})}return s.added=Q.map(ae=>({change:{type:b.ADDED},value:ae})),s}static compareObject(w,I,E,s=[]){const z=JSON.parse(JSON.stringify(w)),Q=JSON.parse(JSON.stringify(I)),ae=new Set([...Object.keys(w),...Object.keys(I)]);let ye=[];return ae.forEach(de=>{const ue=E?`${E}.${de}`:de;-1===s.indexOf(ue)&&(Array.isArray(w[de])&&(w[de]=w[de].join(",<br>")),Array.isArray(I[de])&&(I[de]=I[de].join(",<br>")),"object"==typeof w[de]&&"object"==typeof I[de]&&null!==w[de]&&null!==I[de]?ye=ye.concat(this.compareObject(w[de],I[de],ue)):w[de]!==I[de]&&(ye.push({key:ue,oldValue:z[de],newValue:Q[de]}),w[de]=k.diff(w[de],I[de])))}),ye}}class D{static create(w,I,E){const s=w.createElement(I);for(const z in E)s[z]=E[z];return s}static remove(w){w.parentNode&&w.parentNode.removeChild(w)}}function h(Y,w,I){!function X(Y,w){const I=document.createElement("a");I.setAttribute("href",Y),I.setAttribute("download",w),I.style.display="none",document.body.appendChild(I),I.click(),document.body.removeChild(I)}(`data:${w},${encodeURIComponent(Y)}`,I)}function H(Y){try{return JSON.parse(Y)&&!!Y}catch{return!1}}class x{static resolve(w,I){const E=I.replace(/\[/g,".").replace(/\]/g,"").split(".");let s=w;for(;E.length;){if("object"!=typeof s)return;s=s[E.shift()]}return s}static isObject(w){return w&&"object"==typeof w&&!Array.isArray(w)&&null!==w&&!(w instanceof Date)}static mergeDeep(w,I,E=!1){const s=Object.assign({},w);return x.isObject(w)&&x.isObject(I)&&Object.keys(I).filter(z=>!E||void 0!==I[z]).forEach(z=>{x.isObject(I[z])?z in w?s[z]=x.mergeDeep(w[z],I[z],E):Object.assign(s,{[z]:I[z]}):Object.assign(s,{[z]:I[z]})}),s}static copyDeep(w){const I=Array.isArray(w)?[]:{};for(const E in w)if(w.hasOwnProperty(E)){const s=w[E];I[E]=s&&"object"==typeof s?this.copyDeep(s):s}return I}static removeDuplicateCaseInsensitive(w){const I={},E={},s=[];for(const z in w)if(w.hasOwnProperty(z)){const Q=z.toUpperCase();I.hasOwnProperty(Q)?I[Q].push({[z]:w[z]}):I[Q]=[{[z]:w[z]}],s.push({key:z,count:z.replace(/[^A-Z]/g,"").length})}for(const z in I)if(I.hasOwnProperty(z)&&I.hasOwnProperty(z)){const Q=I[z];if(1===Q.length){const ae=Q[0];E[z]=ae[Object.keys(ae)[0]]}else if(Q.length>1){const ae=s.filter(ye=>ye.key.toLowerCase()===z.toLowerCase()).reduce((ye,de)=>ye.y<de.y?ye:de);E[ae.key.toUpperCase()]=w[ae.key]}}for(const z in w)w.hasOwnProperty(z)&&delete w[z];for(const z in E)E.hasOwnProperty(z)&&(w[z]=E[z])}static removeUndefined(w){const I={};return x.isObject(w)?(Object.keys(w).filter(E=>void 0!==w[E]).forEach(E=>{I[E]=x.isObject(w[E])||Array.isArray(w[E])?x.removeUndefined(w[E]):w[E]}),I):Array.isArray(w)?w.map(E=>x.removeUndefined(E)):w}static removeNull(w){const I={};return x.isObject(w)?(Object.keys(w).filter(E=>null!==w[E]).forEach(E=>{I[E]=x.isObject(w[E])||Array.isArray(w[E])?x.removeNull(w[E]):w[E]}),I):Array.isArray(w)?w.map(E=>x.removeNull(E)):w}static naturalCompare(w,I,E="asc",s){if("desc"===E&&(I=[w,w=I][0]),null===w||""===w||void 0===w||null===I||""===I||void 0===I){const ae=w===I?0:void 0===w?3:void 0===I?-3:null===w?2:null===I?-2:""===w?1:-1;return"desc"===E?!1!==s?ae:-1*ae:!0===s?-1*ae:ae}const z=[],Q=[];for(I=""+I,(w=""+w).replace(/(\d+)|(\D+)/g,(ae,ye,de)=>{z.push([ye||1/0,de||""])}),I.replace(/(\d+)|(\D+)/g,(ae,ye,de)=>{Q.push([ye||1/0,de||""])});z.length&&Q.length;){const ae=z.shift(),ye=Q.shift(),de=ae[0]-ye[0]||ae[1].localeCompare(ye[1]);if(de)return de}return z.length-Q.length}static objectsAreEquivalent(w,I){if(w===I)return!0;const E=Object.getOwnPropertyNames(w),s=Object.getOwnPropertyNames(I);if(E.length!==s.length)return!1;for(const z of E)if(w[z]!==I[z])return!1;return!0}static removeKeys(w,I){return Object.keys(w).filter(s=>I.indexOf(s)<0).reduce((s,z)=>(s[z]=w[z],s),{})}static isEmpty(w){return 0===Object.keys(w).length}}class ee{static roundToNDecimal(w,I=3){const E=Math.pow(10,I);return Math.round(w*E)/E}}function Z(Y){return Y.reduce((w,I)=>(w[I]=I,w),Object.create(null))}const G="assets/igo2/core/theming/prebuilt-themes",U="theme-styles";function N(Y,w,I=G){const E=`${I}/${w}.css`,s=Y.getElementsByTagName("head")[0];let z=Y.getElementById(U);z?z.href=E:function W(Y,w,I){const E=D.create(Y,"link",{id:U,rel:"stylesheet",href:w});I.appendChild(E)}(Y,E,s)}function A(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function g(){return`${A()}${A()}-${A()}-${A()}-${A()}-${A()}${A()}${A()}`.toLowerCase()}var u=r(84205),O=r(91817),j=function(Y){return Y[Y.Error=0]="Error",Y[Y.Done=1]="Done",Y[Y.Working=2]="Working",Y[Y.Waiting=3]="Waiting",Y}(j||{});class P{status$=new u.B;status$$;get status(){return this._status}set status(w){this._status=w,this.status$.next(w)}_status;subscribe(w,I){this.watch(),this.status$$=this.status$.pipe((0,O.F)()).subscribe(E=>{this.handleStatusChange(E),w.call(I,this)})}unsubscribe(){this.unwatch(),void 0!==this.status$$&&(this.status$$.unsubscribe(),this.status$$=void 0),this.status=j.Waiting}handleStatusChange(w){}}},33008:(De,le,r)=>{"use strict";r.r(le),r.d(le,{routes:()=>Qe});var M=r(84175),a=r(30699),F=r(60316),p=r(68559),e=r(34456),c=r(15944),o=r(87984),L=r(41134),R=r(21701),v=r(90852);function y(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"button",8),p.bIt("click",function(){p.eBV(Oe);const ze=p.XpG();return p.Njj(ze.loginAnonymous())}),p.EFF(1),p.nI1(2,"translate"),p.k0s()}2&Ge&&(p.R7$(),p.SpI(" ",p.bMT(2,1,"igo.auth.accessAnonymous")," "))}function b(Ge,at){if(1&Ge&&(p.j41(0,"div"),p.nrm(1,"br"),p.j41(2,"font",9),p.EFF(3),p.k0s()()),2&Ge){const Oe=p.XpG();p.R7$(3),p.JRh(Oe.error)}}function k(Ge,at){1&Ge&&(p.j41(0,"div",10),p.nrm(1,"mat-spinner",11),p.k0s()),2&Ge&&(p.R7$(),p.Y8G("diameter",40))}let _=(()=>{class Ge{auth;languageService;get allowAnonymous(){return this._allowAnonymous}set allowAnonymous(Oe){this._allowAnonymous=Oe}_allowAnonymous=!0;error="";form;loading=!1;login=new p.bkB;constructor(Oe,Ye,ze){this.auth=Oe,this.languageService=Ye,this.form=ze.group({username:["",e.k0.required],password:["",e.k0.required]})}loginUser(Oe){return this.loading=!0,this.auth.login(Oe.username,Oe.password).subscribe(()=>{this.login.emit(!0),this.loading=!1},Ye=>{try{this.languageService.translate.get("igo.auth.error."+Ye.error.message).subscribe(ze=>this.error=ze)}catch{this.error=Ye.error.message}this.loading=!1}),!1}loginAnonymous(){this.auth.loginAnonymous().subscribe(()=>{this.login.emit(!0)})}static \u0275fac=function(Ye){return new(Ye||Ge)(p.rXU(a.uR),p.rXU(R.gw),p.rXU(e.ze))};static \u0275cmp=p.VBU({type:Ge,selectors:[["igo-auth-intern"]],inputs:{allowAnonymous:"allowAnonymous"},outputs:{login:"login"},standalone:!0,features:[p.aNF],decls:21,vars:19,consts:[["role","form",3,"ngSubmit","formGroup"],[1,"full-width"],["matInput","","required","","formControlName","username",3,"placeholder"],["matInput","","required","","type","password","formControlName","password",3,"placeholder"],["mat-raised-button","","type","submit"],["mat-raised-button","","class","anonymous","type","button",3,"click",4,"ngIf"],[4,"ngIf"],["class","loading-container",4,"ngIf"],["mat-raised-button","","type","button",1,"anonymous",3,"click"],["size","3","color","red"],[1,"loading-container"],[3,"diameter"]],template:function(Ye,ze){1&Ye&&(p.j41(0,"form",0),p.bIt("ngSubmit",function(){return ze.loginUser(ze.form.value)}),p.j41(1,"div")(2,"mat-form-field",1)(3,"mat-label"),p.EFF(4),p.nI1(5,"translate"),p.k0s(),p.nrm(6,"input",2),p.nI1(7,"translate"),p.k0s()(),p.j41(8,"div")(9,"mat-form-field",1)(10,"mat-label"),p.EFF(11),p.nI1(12,"translate"),p.k0s(),p.nrm(13,"input",3),p.nI1(14,"translate"),p.k0s()(),p.j41(15,"button",4),p.EFF(16),p.nI1(17,"translate"),p.k0s(),p.DNE(18,y,3,3,"button",5)(19,b,4,1,"div",6),p.k0s(),p.DNE(20,k,2,1,"div",7)),2&Ye&&(p.Y8G("formGroup",ze.form),p.R7$(4),p.JRh(p.bMT(5,9,"igo.auth.user")),p.R7$(2),p.FS9("placeholder",p.bMT(7,11,"igo.auth.user")),p.R7$(5),p.JRh(p.bMT(12,13,"igo.auth.password")),p.R7$(2),p.FS9("placeholder",p.bMT(14,15,"igo.auth.password")),p.R7$(3),p.SpI(" ",p.bMT(17,17,"igo.auth.login")," "),p.R7$(2),p.Y8G("ngIf",ze.allowAnonymous),p.R7$(),p.Y8G("ngIf",ze.error),p.R7$(),p.Y8G("ngIf",ze.loading))},dependencies:[e.YN,e.qT,e.me,e.BC,e.cb,e.YS,e.X1,e.j4,e.JD,c.RG,c.rl,c.nJ,o.fS,o.fg,M.Hl,M.$z,L.LG,F.bT,R.Ck,v.D9],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.anonymous[_ngcontent-%COMP%]{margin-left:10px}.loading-container[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:1000;top:0;left:0;padding:24px;box-sizing:border-box}"]})}return Ge})();var D=r(67143),h=r(89204),X=r(36991),H=r(8653),x=r(53985),ee=r(37395),Z=r(46385),G=r(84205),U=r(51567),N=r(33900);let W=(()=>{class Ge{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new G.B;login=new p.bkB;broadcastService;svgIcon=X.bV;constructor(Oe,Ye,ze,et,jt){this.authService=Oe,this.config=Ye,this.appRef=ze,this.msalService=et,this.msalGuardConfig=jt,this.options=this.config.getConfig("auth.microsoft"),this.msalService.instance=new x.v({auth:this.options,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new H.qb(this.msalService.instance,this.msalService),this.options?.clientId?this.broadcastService.inProgress$.pipe((0,U.p)(dt=>dt===ee.T$.None),(0,N.Q)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoft(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(Oe=>{this.msalService.instance.setActiveAccount(Oe.account),this.checkAccount()})}checkAccount(){var Oe=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(Ye=>{this.authService.loginWithToken(Ye.accessToken,"microsoft",{tokenId:Ye.idToken}).subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var Ye=(0,h.A)(function*(ze){if(ze instanceof Z.CB)return Oe.msalService.acquireTokenPopup(Oe.getConf().authRequest);console.log(ze)});return function(ze){return Ye.apply(this,arguments)}}()).catch(Ye=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(Oe=>"add"===Oe.type)[0]}static \u0275fac=function(Ye){return new(Ye||Ge)(p.rXU(a.uR),p.rXU(D.we),p.rXU(p.o8S),p.rXU(H.dl),p.rXU(H.LR))};static \u0275cmp=p.VBU({type:Ge,selectors:[["igo-auth-microsoft"]],outputs:{login:"login"},standalone:!0,features:[p.aNF],decls:4,vars:4,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],[3,"icon"]],template:function(Ye,ze){1&Ye&&(p.j41(0,"button",0),p.bIt("click",function(){return ze.loginMicrosoft()}),p.nrm(1,"igo-icon",1),p.EFF(2),p.nI1(3,"translate"),p.k0s()),2&Ye&&(p.R7$(),p.Y8G("icon",ze.svgIcon),p.R7$(),p.SpI(" ",p.bMT(3,2,"igo.auth.microsoft.login"),"\n"))},dependencies:[M.Hl,M.$z,R.Ck,v.D9,X.cc],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Ge})();var A=r(63328),g=r(75797),u=r(95429);let O=(()=>{class Ge{instance;location;redirectHash;logger;name="@azure/msal-angular";version="2.0.0-beta.2";constructor(Oe,Ye){this.instance=Oe,this.location=Ye;const ze=this.location.path(!0).split("#").pop();ze&&(this.redirectHash=`#${ze}`),this.instance.initializeWrapperLibrary(ee.f7.Angular,this.version)}initialize(){return(0,u.H)(this.instance.initialize())}acquireTokenPopup(Oe){return(0,u.H)(this.instance.acquireTokenPopup(Oe))}acquireTokenRedirect(Oe){return(0,u.H)(this.instance.acquireTokenRedirect(Oe))}acquireTokenSilent(Oe){return(0,u.H)(this.instance.acquireTokenSilent(Oe))}handleRedirectObservable(Oe){return(0,u.H)(this.instance.handleRedirectPromise(Oe||this.redirectHash))}loginPopup(Oe){return(0,u.H)(this.instance.loginPopup(Oe))}loginRedirect(Oe){return(0,u.H)(this.instance.loginRedirect(Oe))}logout(Oe){return(0,u.H)(this.instance.logout(Oe))}logoutRedirect(Oe){return(0,u.H)(this.instance.logoutRedirect(Oe))}logoutPopup(Oe){return(0,u.H)(this.instance.logoutPopup(Oe))}ssoSilent(Oe){return(0,u.H)(this.instance.ssoSilent(Oe))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(this.name,this.version)),this.logger}setLogger(Oe){this.logger=Oe.clone(this.name,this.version),this.instance.setLogger(Oe)}static \u0275fac=function(Ye){return new(Ye||Ge)(p.KVO(H.Cn),p.KVO(F.aZ))};static \u0275prov=p.jDH({token:Ge,factory:Ge.\u0275fac})}return Ge})(),j=(()=>{class Ge{msalInstance;authService;_msalSubject;msalSubject$;_inProgress;inProgress$;constructor(Oe,Ye){this.msalInstance=Oe,this.authService=Ye,this._msalSubject=new G.B,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new g.t(ee.T$.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(ze=>{this._msalSubject.next(ze);const et=A.D.getInteractionStatusFromEvent(ze);null!==et&&(this.authService.getLogger().verbose(`BroadcastService - ${ze.eventType} results in setting inProgress to ${et}`),this._inProgress.next(et))})}static \u0275fac=function(Ye){return new(Ye||Ge)(p.KVO(H.Cn),p.KVO(O))};static \u0275prov=p.jDH({token:Ge,factory:Ge.\u0275fac})}return Ge})(),P=(()=>{class Ge{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new G.B;login=new p.bkB;broadcastService;svgIcon=X.bV;constructor(Oe,Ye,ze,et,jt){this.authService=Oe,this.config=Ye,this.appRef=ze,this.msalService=et,this.msalGuardConfig=jt,this.options=this.config.getConfig("auth.microsoftb2c")||{},this.msalService.instance=new x.v({auth:this.options.browserAuthOptions,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new j(this.msalService.instance,this.msalService),this.options.browserAuthOptions.clientId?this.broadcastService.inProgress$.pipe((0,U.p)(dt=>dt===ee.T$.None),(0,N.Q)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoftb2c(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(Oe=>{this.msalService.instance.setActiveAccount(Oe.account),this.checkAccount()})}checkAccount(){var Oe=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(Ye=>{this.authService.loginWithToken(Ye.idToken,"microsoftb2c").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var Ye=(0,h.A)(function*(ze){if(ze instanceof Z.CB)return Oe.msalService.acquireTokenPopup(Oe.getConf().authRequest)});return function(ze){return Ye.apply(this,arguments)}}()).catch(Ye=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(Oe=>"b2c"===Oe.type)[0]}static \u0275fac=function(Ye){return new(Ye||Ge)(p.rXU(a.uR),p.rXU(D.we),p.rXU(p.o8S),p.rXU(O),p.rXU(H.LR))};static \u0275cmp=p.VBU({type:Ge,selectors:[["igo-auth-microsoftb2c"]],outputs:{login:"login"},standalone:!0,features:[p.Jv_([O]),p.aNF],decls:4,vars:4,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],[3,"icon"]],template:function(Ye,ze){1&Ye&&(p.j41(0,"button",0),p.bIt("click",function(){return ze.loginMicrosoftb2c()}),p.nrm(1,"igo-icon",1),p.EFF(2),p.nI1(3,"translate"),p.k0s()),2&Ye&&(p.R7$(),p.Y8G("icon",ze.svgIcon),p.R7$(),p.SpI(" ",p.bMT(3,2,"igo.auth.microsoftb2c.login"),"\n"))},dependencies:[M.Hl,M.$z,R.Ck,v.D9,X.cc],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Ge})();var Q=r(58610);let ae=(()=>{class Ge{authService;config;appRef;options;login=new p.bkB;constructor(Oe,Ye,ze){this.authService=Oe,this.config=Ye,this.appRef=ze,this.options=this.config.getConfig("auth.facebook"),this.options?.appId?this.loadSDKFacebook():console.warn('Facebook authentification needs "appId" option')}subscribeEvents(){window.FB.Event.subscribe("auth.statusChange",Oe=>{this.statusChangeCallback(Oe)})}statusChangeCallback(Oe){"connected"===Oe.status&&this.loginFacebook(Oe.authResponse.accessToken)}loginFacebook(Oe){this.authService.loginWithToken(Oe,"facebook").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKFacebook(){if(document.getElementById("facebook-jssdk"))return;const Ye=document.getElementsByTagName("script")[0],ze=document.createElement("script");ze.id="facebook-jssdk",ze.src=`https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9&appId=${this.options?.appId}`,ze.onload=()=>{this.subscribeEvents()},Ye.parentNode.insertBefore(ze,Ye)}static \u0275fac=function(Ye){return new(Ye||Ge)(p.rXU(a.uR),p.rXU(D.we),p.rXU(p.o8S))};static \u0275cmp=p.VBU({type:Ge,selectors:[["igo-auth-facebook"]],outputs:{login:"login"},standalone:!0,features:[p.aNF],decls:1,vars:0,consts:[["scope","public_profile,email","data-max-rows","1","data-size","large","data-button-type","login_with","data-show-faces","false","data-auto-logout-link","false","data-use-continue-as","false",1,"fb-login-button"]],template:function(Ye,ze){1&Ye&&p.nrm(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-3px}"],changeDetection:0})}return Ge})(),ye=(()=>{class Ge{authService;config;languageService;appRef;options;login=new p.bkB;constructor(Oe,Ye,ze,et){this.authService=Oe,this.config=Ye,this.languageService=ze,this.appRef=et,this.options=this.config.getConfig("auth.google"),this.options?.apiKey&&this.options?.clientId?(this.loadSDKGoogle(),this.loadPlatform()):console.warn('Google authentification needs "apiKey" and "clientId" options')}handleSignInClick(){window.gapi.auth2.getAuthInstance().signIn()}handleSignOutClick(){window.gapi.auth2.getAuthInstance().signOut()}handleClientLoad(){window.gapi.load("client:auth2",()=>this.initClient())}initClient(){window.gapi.client.init({apiKey:this.options?.apiKey,clientId:this.options?.clientId,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(()=>{this.handleSignOutClick(),this.updateTextButton(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(Oe=>{this.updateSigninStatus(Oe)})})}updateSigninStatus(Oe){this.updateTextButton(),Oe&&this.loginGoogle(window.gapi.client.getToken().access_token)}updateTextButton(){const Oe=document.querySelector('span[id^="not_signed_"]');Oe&&"en"!==this.languageService.getLanguage()&&("Sign in with Google"===Oe.innerHTML?Oe.innerHTML=this.languageService.translate.instant("igo.auth.google.login"):"Signed in with Google"===Oe.innerHTML&&(Oe.innerHTML=this.languageService.translate.instant("igo.auth.google.logged")))}loginGoogle(Oe){this.authService.loginWithToken(Oe,"google").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKGoogle(){const Oe=document.getElementsByTagName("script")[0],Ye=document.createElement("script");Ye.id="google-jssdk",Ye.src="https://apis.google.com/js/api.js",Ye.onload=()=>{this.handleClientLoad()},Oe.parentNode.insertBefore(Ye,Oe)}loadPlatform(){const Oe=document.getElementsByTagName("script")[0],Ye=document.createElement("script");Ye.id="google-platform",Ye.src="https://apis.google.com/js/platform.js",Oe.parentNode.insertBefore(Ye,Oe)}static \u0275fac=function(Ye){return new(Ye||Ge)(p.rXU(a.uR),p.rXU(D.we),p.rXU(R.gw),p.rXU(p.o8S))};static \u0275cmp=p.VBU({type:Ge,selectors:[["igo-auth-google"]],outputs:{login:"login"},standalone:!0,features:[p.aNF],decls:1,vars:0,consts:[["data-height","40","data-width","265","data-longtitle","true",1,"g-signin2","google-login-button"]],template:function(Ye,ze){1&Ye&&p.nrm(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block}.google-login-button[_ngcontent-%COMP%]     .abcRioButton{color:#000000de}"],changeDetection:0})}return Ge})();function de(Ge,at){1&Ge&&p.nrm(0,"div",3)}function ue(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"igo-auth-google",7),p.bIt("login",function(){p.eBV(Oe);const ze=p.XpG(3);return p.Njj(ze.onLogin())}),p.k0s()}}function ce(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"igo-auth-microsoft",7),p.bIt("login",function(){p.eBV(Oe);const ze=p.XpG(3);return p.Njj(ze.onLogin())}),p.k0s()}}function re(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"igo-auth-microsoftb2c",7),p.bIt("login",function(){p.eBV(Oe);const ze=p.XpG(3);return p.Njj(ze.onLogin())}),p.k0s()}}function be(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"igo-auth-facebook",7),p.bIt("login",function(){p.eBV(Oe);const ze=p.XpG(3);return p.Njj(ze.onLogin())}),p.k0s()}}function _e(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"igo-auth-intern",8),p.bIt("login",function(){p.eBV(Oe);const ze=p.XpG(3);return p.Njj(ze.onLogin())}),p.k0s()}if(2&Ge){const Oe=p.XpG(3);p.Y8G("allowAnonymous",Oe.options.allowAnonymous)}}function Le(Ge,at){if(1&Ge&&(p.j41(0,"div",4)(1,"h1"),p.EFF(2),p.nI1(3,"translate"),p.k0s(),p.DNE(4,ue,1,0,"igo-auth-google",5)(5,ce,1,0,"igo-auth-microsoft",5)(6,re,1,0,"igo-auth-microsoftb2c",5)(7,be,1,0,"igo-auth-facebook",5)(8,_e,1,1,"igo-auth-intern",6),p.k0s()),2&Ge){const Oe=p.XpG(2);p.R7$(2),p.JRh(p.bMT(3,6,"igo.auth.connection")),p.R7$(2),p.Y8G("ngIf",Oe.options.google&&!1!==Oe.options.google.enabled),p.R7$(),p.Y8G("ngIf",Oe.options.microsoft&&!1!==Oe.options.microsoft.enabled),p.R7$(),p.Y8G("ngIf",Oe.options.microsoftb2c&&!1!==Oe.options.microsoftb2c.enabled),p.R7$(),p.Y8G("ngIf",Oe.options.facebook&&!1!==Oe.options.facebook.enabled),p.R7$(),p.Y8G("ngIf",!Oe.options.intern||!1!==Oe.options.intern.enabled)}}function We(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"div",4)(1,"p"),p.EFF(2),p.nI1(3,"translate"),p.k0s(),p.j41(4,"button",9),p.bIt("click",function(){p.eBV(Oe);const ze=p.XpG(2);return p.Njj(ze.logout())}),p.EFF(5),p.nI1(6,"translate"),p.k0s()()}if(2&Ge){const Oe=p.XpG(2);p.R7$(2),p.JRh(p.i5U(3,2,"igo.auth.welcome",Oe.user)),p.R7$(3),p.SpI(" ",p.bMT(6,5,"igo.auth.signOut")," ")}}function Xe(Ge,at){if(1&Ge){const Oe=p.RV6();p.j41(0,"button",9),p.bIt("click",function(){p.eBV(Oe);const ze=p.XpG(3);return p.Njj(ze.home())}),p.EFF(1),p.nI1(2,"translate"),p.k0s()}2&Ge&&(p.R7$(),p.SpI(" ",p.bMT(2,1,"igo.auth.home")," "))}function Be(Ge,at){if(1&Ge&&(p.j41(0,"div",4)(1,"p"),p.EFF(2),p.nI1(3,"translate"),p.k0s(),p.DNE(4,Xe,3,3,"button",10),p.k0s()),2&Ge){const Oe=p.XpG(2);p.R7$(2),p.JRh(p.bMT(3,2,"igo.auth.deconnection")),p.R7$(2),p.Y8G("ngIf",Oe.options.homeRoute)}}function rt(Ge,at){if(1&Ge&&(p.j41(0,"div"),p.DNE(1,de,1,0,"div",1)(2,Le,9,8,"div",2)(3,We,7,7,"div",2)(4,Be,5,4,"div",2),p.k0s()),2&Ge){const Oe=p.XpG();p.R7$(),p.Y8G("ngIf",!Oe.auth.logged&&Oe.backgroundDisable),p.R7$(),p.Y8G("ngIf",!Oe.auth.logged&&Oe.showLoginDiv),p.R7$(),p.Y8G("ngIf",Oe.auth.logged&&Oe.showAlreadyConnectedDiv),p.R7$(),p.Y8G("ngIf",Oe.showLogoutDiv)}}let Ie=(()=>{class Ge{auth;config;router;get backgroundDisable(){return!this.isLogoutRoute&&!this.isLogoutRoute&&this._backgroundDisable}set backgroundDisable(Oe){this._backgroundDisable="true"===Oe.toString()}_backgroundDisable=!0;get hasAlreadyConnectedDiv(){return this._hasAlreadyConnectedDiv}set hasAlreadyConnectedDiv(Oe){this._hasAlreadyConnectedDiv="true"===Oe.toString()}_hasAlreadyConnectedDiv=!0;get hasLogoutDiv(){return this._hasLogoutDiv}set hasLogoutDiv(Oe){this._hasLogoutDiv="true"===Oe.toString()}_hasLogoutDiv=!0;get showAlreadyConnectedDiv(){return this.isLogoutRoute?this.hasAlreadyConnectedDiv:this._showAlreadyConnectedDiv}set showAlreadyConnectedDiv(Oe){this._showAlreadyConnectedDiv="true"===Oe.toString()}_showAlreadyConnectedDiv=!1;get showLogoutDiv(){return this.isLogoutRoute?this.hasLogoutDiv:this._showLogoutDiv}set showLogoutDiv(Oe){this._showLogoutDiv="true"===Oe.toString()}_showLogoutDiv=!1;get showLoginDiv(){if(!this.isLogoutRoute)return!0}login=new p.bkB;options;user;visible=!0;isLogoutRoute;constructor(Oe,Ye,ze){this.auth=Oe,this.config=Ye,this.router=ze,this.options=this.config.getConfig("auth"),this.visible=0!==Object.getOwnPropertyNames(this.options).length}ngOnInit(){this.analyzeRoute(),this.getName()}onLogin(){this.auth.goToRedirectUrl(),this.getName(),this.login.emit(!0)}logout(){this.auth.logout().subscribe(()=>{this.user=void 0,this.router&&(this.options?.logoutRoute?this.router.navigate([this.options?.logoutRoute]):this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute]))})}home(){this.router&&this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute])}getName(){const Oe=this.auth.decodeToken();Oe&&(this.user={name:Oe.user.firstName||Oe.user.sourceId})}analyzeRoute(){this.router&&this.router.events.pipe((0,U.p)(Oe=>Oe instanceof Q.Z)).subscribe(Oe=>{if(Oe.url){const Ye=Oe.url,ze=this.options?.logoutRoute;this.isLogoutRoute=Ye===ze,this.isLogoutRoute&&this.auth.logout()}})}static \u0275fac=function(Ye){return new(Ye||Ge)(p.rXU(a.uR),p.rXU(D.we),p.rXU(Q.Ix,8))};static \u0275cmp=p.VBU({type:Ge,selectors:[["igo-auth-form"]],inputs:{backgroundDisable:"backgroundDisable",hasAlreadyConnectedDiv:"hasAlreadyConnectedDiv",hasLogoutDiv:"hasLogoutDiv",showAlreadyConnectedDiv:"showAlreadyConnectedDiv",showLogoutDiv:"showLogoutDiv"},outputs:{login:"login"},standalone:!0,features:[p.aNF],decls:1,vars:1,consts:[[4,"ngIf"],["class","backgroundDisable",4,"ngIf"],["class","login center-block",4,"ngIf"],[1,"backgroundDisable"],[1,"login","center-block"],[3,"login",4,"ngIf"],[3,"allowAnonymous","login",4,"ngIf"],[3,"login"],[3,"login","allowAnonymous"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button",3,"click",4,"ngIf"]],template:function(Ye,ze){1&Ye&&p.DNE(0,rt,5,4,"div",0),2&Ye&&p.Y8G("ngIf",ze.visible)},dependencies:[F.bT,ye,W,P,ae,_,M.Hl,M.$z,R.Ck,v.D9],styles:["[_nghost-%COMP%]{z-index:999}div.login[_ngcontent-%COMP%]{z-index:200;width:90%;min-width:360px;max-width:600px;padding:25px 50px;border:1px solid;background-color:#fff;border-color:#888}.center-block[_ngcontent-%COMP%]{position:fixed;top:20%;left:50%;transform:translate(-50%)}.backgroundDisable[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background:#000;opacity:.8;z-index:100;height:100%;width:100%}"]})}return Ge})();var ie=r(49156),he=r(99621);const $e=()=>["ConfigService","LanguageService"],Qe=[{path:"",redirectTo:"form",pathMatch:"full"},{title:"Authentification",path:"form",component:(()=>{class Ge{_authService;logged=!1;logged$$;constructor(Oe){this._authService=Oe}ngOnInit(){this.logged$$=this._authService.logged$.subscribe(Oe=>{this.logged=Oe})}logout(){this._authService.logout()}ngOnDestroy(){this.logged$$.unsubscribe()}static \u0275fac=function(Ye){return new(Ye||Ge)(p.rXU(a.uR))};static \u0275cmp=p.VBU({type:Ge,selectors:[["app-auth-form"]],standalone:!0,features:[p.aNF],decls:7,vars:3,consts:[["title","Authentification","subtitle","Auth",3,"dependencies"],["codeFolder","auth/auth-form","configFolder","environments"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(Ye,ze){1&Ye&&(p.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1),p.EFF(2," The dialog opens automatically if you are not logged in "),p.nrm(3,"br"),p.j41(4,"button",2),p.bIt("click",function(){return ze.logout()}),p.EFF(5," Log out "),p.k0s()()(),p.nrm(6,"igo-auth-form")),2&Ye&&(p.Y8G("dependencies",p.lJ4(2,$e)),p.R7$(4),p.Y8G("disabled",!ze.logged))},dependencies:[ie.g,he.s,Ie,M.Hl,M.$z],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Ge})()}]},20293:(De,le,r)=>{"use strict";r.r(le),r.d(le,{routes:()=>jo});var M=r(44038),a=r(55050),F=r(75797),p=r(49156),e=r(99621),c=r(68559),o=r(8004);let L=(()=>{class Fe{overlay;mediaService;store=new M.uw([]);added$=new F.t(!1);get actionbarMode(){return this.mediaService.media$.value===a.$U.Desktop&&this.mediaService.orientation$.value===a.rU.Landscape?M.rS.Dock:M.rS.Overlay}constructor(Ce,Ee){this.overlay=Ce,this.mediaService=Ee}ngOnInit(){this.store.load([{id:"add",title:"Add",icon:"add",tooltip:"Add Tooltip",handler:()=>{alert("Add!"),this.added$.next(!0)}},{id:"edit",title:"Edit",icon:"edit",tooltip:"Edit Tooltip",args:["1"],handler:Ce=>{alert(`Edit item ${Ce}!`)},availability:()=>this.added$},{id:"delete",title:"Delete",tooltip:"Delete Tooltip",icon:"delete",handler:()=>{alert("Delete!"),this.added$.next(!1)},availability:()=>this.added$}])}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(o.hJ),c.rXU(a.u1))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-action"]],standalone:!0,features:[c.aNF],decls:3,vars:5,consts:[["title","Action","subtitle","Common"],["title","Action Bar","codeFolder","common/action"],[3,"store","withIcon","withTitle","horizontal","mode"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1),c.nrm(2,"igo-actionbar",2),c.k0s()()),2&Ee&&(c.R7$(2),c.Y8G("store",Re.store)("withIcon",!0)("withTitle","overlay"===Re.actionbarMode)("horizontal",!0)("mode",Re.actionbarMode))},dependencies:[p.g,e.s,M.Vn],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Fe})();var R=r(34456),v=r(84175),y=r(14102),b=r(28793),k=r(36250),_=r(60316),D=r(87941);const h=Fe=>({obj:Fe}),X=(Fe,tt)=>({obj:Fe,baseKey:tt});function H(Fe,tt){1&Fe&&c.eu8(0)}function x(Fe,tt){1&Fe&&c.eu8(0)}function ee(Fe,tt){if(1&Fe&&(c.qex(0),c.DNE(1,x,1,0,"ng-container",4),c.bVm()),2&Fe){const Ce=c.XpG(2).$implicit,Ee=c.XpG().baseKey,Re=c.XpG(),ct=c.sdS(5);c.R7$(),c.Y8G("ngTemplateOutlet",ct)("ngTemplateOutletContext",c.l_i(2,X,Ce.value,Re.getKey(Ee,Ce.key)))}}function Z(Fe,tt){if(1&Fe&&(c.j41(0,"p")(1,"span")(2,"b"),c.EFF(3),c.k0s(),c.EFF(4," : "),c.k0s(),c.nrm(5,"span",10),c.k0s()),2&Fe){const Ce=c.XpG(2).$implicit,Ee=c.XpG().baseKey,Re=c.XpG();c.R7$(3),c.JRh(Re.getKey(Ee,Ce.key)),c.R7$(2),c.Y8G("innerHtml",Ce.value,c.npT)}}function G(Fe,tt){if(1&Fe&&(c.qex(0),c.DNE(1,ee,2,5,"ng-container",9)(2,Z,6,2,"ng-template",null,1,c.C5r),c.bVm()),2&Fe){const Ce=c.sdS(3),Ee=c.XpG().$implicit,Re=c.XpG(2);c.R7$(),c.Y8G("ngIf",Re.isObject(Ee.value))("ngIfElse",Ce)}}function U(Fe,tt){if(1&Fe&&(c.qex(0),c.DNE(1,G,4,2,"ng-container",8),c.bVm()),2&Fe){const Ce=tt.$implicit,Ee=c.XpG().baseKey,Re=c.XpG();c.R7$(),c.Y8G("ngIf",-1===Re.ignoreKeys.indexOf(Re.getKey(Ee,Ce.key)))}}function N(Fe,tt){1&Fe&&(c.DNE(0,U,2,1,"ng-container",7),c.nI1(1,"keyvalue")),2&Fe&&c.Y8G("ngForOf",c.bMT(1,1,tt.obj))}let W=(()=>{class Fe{dialogRef;title;data;ignoreKeys;constructor(Ce){this.dialogRef=Ce}isObject(Ce){return"object"==typeof Ce&&!Array.isArray(Ce)}getKey(Ce,Ee){return(Ce?Ce+".":"")+Ee}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(D.CP))};static \u0275cmp=c.VBU({type:Fe,selectors:[["igo-json-dialog"]],standalone:!0,features:[c.aNF],decls:9,vars:5,consts:[["loopObject",""],["notObject",""],["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"propertyValue",3,"innerHtml"]],template:function(Ee,Re){if(1&Ee){const ct=c.RV6();c.j41(0,"h1",2),c.EFF(1),c.k0s(),c.j41(2,"div",3),c.DNE(3,H,1,0,"ng-container",4)(4,N,2,3,"ng-template",null,0,c.C5r),c.k0s(),c.j41(6,"div",5)(7,"button",6),c.bIt("click",function(){return c.eBV(ct),c.Njj(Re.dialogRef.close(!1))}),c.EFF(8," OK "),c.k0s()()}if(2&Ee){const ct=c.sdS(5);c.R7$(),c.JRh(Re.title),c.R7$(2),c.Y8G("ngTemplateOutlet",ct)("ngTemplateOutletContext",c.eq3(3,h,Re.data))}},dependencies:[D.BI,D.Yi,_.T3,_.pM,_.bT,D.E7,v.Hl,v.$z,_.lG],encapsulation:2})}return Fe})(),A=(()=>{class Fe{dialog;constructor(Ce){this.dialog=Ce}open(Ce,Ee,Re){const ct=this.dialog.open(W,{disableClose:!1});return ct.componentInstance.data=Ee,ct.componentInstance.title=Ce,ct.componentInstance.ignoreKeys=Re??[],ct.afterClosed()}static \u0275fac=function(Ee){return new(Ee||Fe)(c.KVO(D.bZ))};static \u0275prov=c.jDH({token:Fe,factory:Fe.\u0275fac})}return Fe})(),g=(()=>{class Fe{static forRoot(){return{ngModule:Fe}}static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275mod=c.$C({type:Fe});static \u0275inj=c.G2t({providers:[A],imports:[W]})}return Fe})();var u=r(97024),O=r(53804),j=r(21701),P=function(Fe){return Fe.Radio="radio",Fe.Checkbox="checkbox",Fe}(P||{}),Y=r(90852);function w(Fe,tt){if(1&Fe&&(c.j41(0,"mat-checkbox",10),c.EFF(1),c.k0s()),2&Fe){const Ce=tt.$implicit;c.FS9("formControlName",Ce.value),c.R7$(),c.JRh(Ce.title||Ce.value)}}function I(Fe,tt){if(1&Fe&&c.DNE(0,w,2,2,"ng-template",9),2&Fe){const Ce=c.XpG();c.Y8G("ngForOf",Ce.data.choices)}}function E(Fe,tt){if(1&Fe&&(c.j41(0,"mat-radio-button",13),c.EFF(1),c.k0s()),2&Fe){const Ce=tt.$implicit;c.Y8G("value",Ce.value),c.R7$(),c.SpI(" ",Ce.title||Ce.value," ")}}function s(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"mat-radio-group",11),c.bIt("change",function(Re){c.eBV(Ce);const ct=c.XpG();return c.Njj(ct.onChange(Re))}),c.DNE(1,E,2,2,"mat-radio-button",12),c.k0s()}if(2&Fe){const Ce=c.XpG();c.R7$(),c.Y8G("ngForOf",Ce.data.choices)}}let z=(()=>{class Fe{formBuilder;languageService;dialogRef;data;formGroup;isDisabled$=new F.t(!0);constructor(Ce,Ee,Re,ct){this.formBuilder=Ce,this.languageService=Ee,this.dialogRef=Re,this.data=ct,this.formGroup=this.formBuilder.group(this.getFg()),this.data.selectFieldText=this.data.selectFieldText??"igo.common.selectValueDialog.selectFieldText",this.data.processButtonText=this.data.processButtonText??"igo.common.selectValueDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.selectValueDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.selectValueDialog.multipleTitle",this.data.type===P.Radio&&(this.data.title="igo.common.selectValueDialog.title")}ngOnInit(){this.formGroup.valueChanges.subscribe(()=>this.canProcess())}getFg(){const Ce={};return this.data.choices.map(Ee=>Ce[Ee.value]=!1),Ce}canProcess(){const Ce=this.data.choices.map(Re=>Re.value),Ee=[];Ce.map(Re=>this.formGroup.value[Re]?Ee.push(Re):void 0),this.isDisabled$.next(!Ee.length)}save(){const Ce=this.data.choices.map(Re=>Re.value),Ee=[];Ce.map(Re=>this.formGroup.value[Re]?Ee.push(Re):void 0),this.dialogRef.close({choices:Ee})}cancel(){this.dialogRef.close()}onChange(Ce){const Ee={};this.data.choices.map(Re=>Ee[Re.value]=!1),Ee[Ce.value]=!0,this.formGroup.setValue(Ee)}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(R.ze),c.rXU(j.gw),c.rXU(D.CP),c.rXU(D.Vh,8))};static \u0275cmp=c.VBU({type:Fe,selectors:[["igo-select-value-check-radio-dialog"]],standalone:!0,features:[c.aNF],decls:16,vars:15,consts:[["mat-dialog-title",""],[1,"igo-form",3,"formGroup"],[1,"choices-section"],[4,"ngIf"],[3,"change",4,"ngIf"],["mat-dialog-actions",""],[1,"button-group"],["mat-raised-button","","type","button",3,"click"],["id","processBtnDialog","mat-raised-button","","type","button","color","primary",3,"click","disabled"],["ngFor","",3,"ngForOf"],[3,"formControlName"],[3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"h1",0),c.EFF(1),c.nI1(2,"translate"),c.k0s(),c.j41(3,"form",1)(4,"section",2),c.DNE(5,I,1,1,null,3)(6,s,2,1,"mat-radio-group",4),c.k0s(),c.j41(7,"div",5)(8,"div",6)(9,"button",7),c.bIt("click",function(){return Re.cancel()}),c.EFF(10),c.nI1(11,"translate"),c.k0s(),c.j41(12,"button",8),c.nI1(13,"async"),c.bIt("click",function(){return Re.save()}),c.EFF(14),c.nI1(15,"translate"),c.k0s()()()()),2&Ee&&(c.R7$(),c.JRh(c.bMT(2,7,Re.data.title)),c.R7$(2),c.Y8G("formGroup",Re.formGroup),c.R7$(2),c.Y8G("ngIf","checkbox"===Re.data.type),c.R7$(),c.Y8G("ngIf","radio"===Re.data.type),c.R7$(4),c.SpI(" ",c.bMT(11,9,Re.data.cancelButtonText)," "),c.R7$(2),c.Y8G("disabled",c.bMT(13,11,Re.isDisabled$)),c.R7$(2),c.SpI(" ",c.bMT(15,13,Re.data.processButtonText)," "))},dependencies:[D.BI,R.YN,R.qT,R.BC,R.cb,R.X1,R.j4,R.JD,_.bT,_.pM,u.g7,u.So,O.Wk,O.VT,O._g,D.E7,v.Hl,v.$z,_.Jj,j.Ck,Y.D9],styles:["[_nghost-%COMP%]  div[mat-dialog-actions]{margin:10px 0 0}[_nghost-%COMP%]  section.choices-section{max-width:auto;display:grid;grid-template-columns:auto auto;grid-gap:0px;padding:5px}"]})}return Fe})(),Q=(()=>{class Fe{dialog;constructor(Ce){this.dialog=Ce}open(Ce,Ee){const Re={choices:Ce,...Ee};return this.dialog.open(z,{disableClose:!1,data:Re,...Ee}).afterClosed()}static \u0275fac=function(Ee){return new(Ee||Fe)(c.KVO(D.bZ))};static \u0275prov=c.jDH({token:Fe,factory:Fe.\u0275fac})}return Fe})(),ae=(()=>{class Fe{static forRoot(){return{ngModule:Fe,providers:[]}}static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275mod=c.$C({type:Fe});static \u0275inj=c.G2t({providers:[Q],imports:[z]})}return Fe})(),ye=(()=>{class Fe{confirmDialogService;selectValueDialogService;jsonDialogService;formDialogService;constructor(Ce,Ee,Re,ct){this.confirmDialogService=Ce,this.selectValueDialogService=Ee,this.jsonDialogService=Re,this.formDialogService=ct}confirm(){this.confirmDialogService.open("Do you want to continue?").subscribe(Ce=>{alert(`Your choice is: ${Ce}`)})}yesno(){this.confirmDialogService.open("Is the sky blue today? ",{modeYesNo:!0}).subscribe(Ce=>{alert(`Your choice is: ${Ce}`)})}select(Ce){this.selectValueDialogService.open([{value:"1",title:"Chocolate"},{value:"2",title:"Candy"},{value:3,title:"Cake"}],{type:Ce}).subscribe(Re=>{Re?.choices&&(Re.choices.length>1?alert(`Your choice(s) are: ${Re.choices}`):alert(`Your choice is: ${Re.choices}`))})}check(){this.select(P.Checkbox)}radio(){this.select(P.Radio)}json(){this.jsonDialogService.open("A JSON viewer",{isbn:"123-456-222",author:{lastname:"Doe",firstname:"Jane"},editor:{lastname:"Smith",firstname:"Jane"},title:"The Ultimate Database Study Guide",category:["Non-Fiction","Technology"]},["category"])}form(){this.formDialogService.open({formFieldConfigs:[{name:"country",title:"Country",options:{cols:1}}],formGroupsConfigs:[{name:"country",formFieldConfigs:[{name:"city",title:"City",options:{cols:1}}]},{name:"city",formFieldConfigs:[{name:"id",title:"ID",options:{cols:1,validator:R.k0.required}},{name:"name",title:"Name",options:{cols:1,validator:R.k0.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}]}]},{minWidth:"50vh"}).subscribe(no=>{no&&alert(JSON.stringify(no))})}email(){const Ce=[{name:"email",title:"Email",options:{cols:2,validator:R.k0.compose([R.k0.required,R.k0.email])}},{name:"password",title:"Password",options:{cols:2,validator:R.k0.required},inputs:{isPassword:!0}}];this.formDialogService.open({formFieldConfigs:Ce}).subscribe(Ee=>{Ee&&(Ee.password="\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0",alert(JSON.stringify(Ee)))})}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(b.gw),c.rXU(Q),c.rXU(A),c.rXU(k.Eg))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-dialog"]],standalone:!0,features:[c.aNF],decls:35,vars:0,consts:[["title","Various dialogs","subtitle","Common"],["codeFolder","common/dialog"],[1,"example-label"],[1,"example-button-row"],["mat-flat-button","","type","button","color","primary",3,"click"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"section")(3,"div",2),c.EFF(4,"Confirmation"),c.k0s(),c.j41(5,"div",3)(6,"button",4),c.bIt("click",function(){return Re.confirm()}),c.EFF(7," Base dialog "),c.k0s(),c.j41(8,"button",4),c.bIt("click",function(){return Re.yesno()}),c.EFF(9," Yes/no confirm dialog "),c.k0s()()(),c.nrm(10,"mat-divider"),c.j41(11,"section")(12,"div",2),c.EFF(13,"Custom selectors"),c.k0s(),c.j41(14,"div",3)(15,"button",4),c.bIt("click",function(){return Re.check()}),c.EFF(16," Open a dialog to select values by checkboxes "),c.k0s(),c.j41(17,"button",4),c.bIt("click",function(){return Re.radio()}),c.EFF(18," Open a dialog to select values by radio buttons "),c.k0s()()(),c.nrm(19,"mat-divider"),c.j41(20,"section")(21,"div",2),c.EFF(22,"Form based"),c.k0s(),c.j41(23,"div",3)(24,"button",4),c.bIt("click",function(){return Re.form()}),c.EFF(25," Basic form "),c.k0s(),c.j41(26,"button",4),c.bIt("click",function(){return Re.email()}),c.EFF(27," Email "),c.k0s()()(),c.nrm(28,"mat-divider"),c.j41(29,"section")(30,"div",2),c.EFF(31,"Renderer"),c.k0s(),c.j41(32,"div",3)(33,"button",4),c.bIt("click",function(){return Re.json()}),c.EFF(34," Open a dialog to open a json "),c.k0s()()()()())},dependencies:[p.g,e.s,b.KD,ae,k.SS,g,v.Hl,v.$z,y.w,y.q],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}.example-label[_ngcontent-%COMP%]{display:table-cell;font-size:14px;margin-left:8px;min-width:120px}.example-button-row[_ngcontent-%COMP%]{display:table-cell;max-width:600px}.example-button-row[_ngcontent-%COMP%]   .mat-mdc-button-base[_ngcontent-%COMP%]{margin:8px 8px 8px 0}"]})}return Fe})();var de=r(74104);let ue=(()=>{class Fe{cdRef;name;constructor(Ce){this.cdRef=Ce}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(c.gRc))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-salutation-component"]],inputs:{name:"name"},standalone:!0,features:[c.aNF],decls:2,vars:1,template:function(Ee,Re){1&Ee&&(c.j41(0,"p"),c.EFF(1),c.k0s()),2&Ee&&(c.R7$(),c.SpI("Hello, my name is ",Re.name,"."))},encapsulation:2,changeDetection:0})}return Fe})(),ce=(()=>{class Fe{cdRef;constructor(Ce){this.cdRef=Ce}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(c.gRc))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-explanation-component"]],standalone:!0,features:[c.aNF],decls:2,vars:0,template:function(Ee,Re){1&Ee&&(c.j41(0,"p"),c.EFF(1,"I am a dynamic component, rendered into an IgoDynamicOutlet."),c.k0s())},encapsulation:2,changeDetection:0})}return Fe})(),re=(()=>{class Fe{component=ue;inputs={name:"Bob"};toggleComponent(){this.component=this.component===ue?ce:ue}static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-dynamic-component"]],standalone:!0,features:[c.aNF],decls:5,vars:2,consts:[["title","Dynamic Component","subtitle","Common"],["codeFolder","common/dynamic-component"],[3,"component","inputs"],["mat-flat-button","","color","primary",3,"click"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1),c.nrm(2,"igo-dynamic-outlet",2),c.j41(3,"button",3),c.bIt("click",function(){return Re.toggleComponent()}),c.EFF(4," Toggle Component "),c.k0s()()()),2&Ee&&(c.R7$(2),c.Y8G("component",Re.component)("inputs",Re.inputs))},dependencies:[p.g,e.s,de.Yq,v.Hl,v.$z],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Fe})();var be=r(75300);function _e(Fe,tt){if(1&Fe&&(c.j41(0,"div")(1,"p"),c.EFF(2),c.nI1(3,"async"),c.k0s(),c.j41(4,"p"),c.EFF(5),c.nI1(6,"async"),c.k0s(),c.j41(7,"p"),c.EFF(8,"Description: "),c.nrm(9,"span",4),c.nI1(10,"async"),c.k0s()()),2&Fe){const Ce=c.XpG();c.R7$(2),c.SpI("ID: ",c.bMT(3,3,Ce.selectedEntity$).id,""),c.R7$(3),c.SpI("Name: ",c.bMT(6,5,Ce.selectedEntity$).name,""),c.R7$(4),c.Y8G("innerHtml",c.bMT(10,7,Ce.selectedEntity$).description,c.npT)}}let Le=(()=>{class Fe{store=new be.D_([]);selectedEntity$=new F.t(void 0);entityIsSelected;constructor(){}ngOnInit(){this.store.load([{id:"2",name:"Name 2",description:"<b>Description 2</b>"},{id:"1",name:"Name 1",description:"<b>Description 1</b>"},{id:"3",name:"Name 3",description:"<b>Description 3</b>"}])}ngOnDestroy(){this.store.destroy()}getTitle(Ce){return Ce.name}onSelectedChange(Ce){this.entityIsSelected=!!Ce.value.id,this.selectedEntity$.next(Ce.value)}static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-entity-selector"]],standalone:!0,features:[c.aNF],decls:4,vars:5,consts:[["title","Entity Selector","subtitle","Common"],["codeFolder","common/entity-selector"],[3,"selectedChange","store","titleAccessor","emptyText","placeholder"],[4,"ngIf"],[3,"innerHtml"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-selector",2),c.bIt("selectedChange",function(no){return Re.onSelectedChange(no)}),c.k0s(),c.DNE(3,_e,11,9,"div",3),c.k0s()()),2&Ee&&(c.R7$(2),c.Y8G("store",Re.store)("titleAccessor",Re.getTitle)("emptyText","")("placeholder","Select an entity"),c.R7$(),c.Y8G("ngIf",Re.entityIsSelected))},dependencies:[p.g,e.s,be.iX,_.bT,_.Jj],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Fe})(),We=(()=>{class Fe{store=new be.D_([]);paginator;entitySortChange$=new F.t(!1);paginatorOptions={pageSize:10};template={selection:!0,selectionCheckbox:!0,selectMany:!0,sort:!0,valueAccessor:(Ce,Ee)=>(0,be.jZ)(Ce,Ee),columns:[{name:"selected",title:"Selected",valueAccessor:Ce=>this.store.state.get(Ce).selected?"radio_button_checked":"radio_button_unchecked",renderer:be.pp.Icon},{name:"id",title:"ID"},{name:"name",title:"Name"},{name:"description",title:"Description",renderer:be.pp.HTML},{name:"date",title:"Date",type:"date"},{name:"url",title:"Hyperlink"},{name:"image",title:"Image"},{name:"action",title:"",valueAccessor:()=>[{icon:"home",color:"warn",click:Ce=>{console.log(Ce)}}],renderer:be.pp.ButtonGroup}]};constructor(){}ngOnInit(){const Ee=[2,1,3,4,5,6,7,8,9,10,11,12,13].map(Re=>3===Re?{id:Re,name:`Name ${Re}`,description:`<b>Description ${Re}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png"}:{id:Re,name:`Name ${Re}`,description:`<b>Description ${Re}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/Igo_logoavec.png"});this.store.load(Ee)}entitySortChange(){this.entitySortChange$.next(!0)}paginatorChange(Ce){this.paginator=Ce}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-entity-table"]],standalone:!0,features:[c.aNF],decls:3,vars:4,consts:[["title","Entity Table","subtitle","Common"],["codeFolder","common/entity-table"],[3,"entitySortChange","store","withPaginator","paginatorOptions","template"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-table",2),c.bIt("entitySortChange",function(){return Re.entitySortChange()}),c.k0s()()()),2&Ee&&(c.R7$(2),c.Y8G("store",Re.store)("withPaginator",!0)("paginatorOptions",Re.paginatorOptions)("template",Re.template))},dependencies:[p.g,e.s,be.f7],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Fe})();function Xe(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"igo-form",3),c.nI1(1,"async"),c.bIt("submitForm",function(Re){c.eBV(Ce);const ct=c.XpG();return c.Njj(ct.onSubmit(Re))}),c.nrm(2,"igo-form-group",4),c.j41(3,"div",5)(4,"button",6),c.bIt("click",function(){c.eBV(Ce);const Re=c.XpG();return c.Njj(Re.fillForm())}),c.EFF(5," Fill Form "),c.k0s(),c.j41(6,"button",6),c.bIt("click",function(){c.eBV(Ce);const Re=c.XpG();return c.Njj(Re.clearForm())}),c.EFF(7," Clear Form "),c.k0s(),c.j41(8,"button",7),c.EFF(9," Submit "),c.k0s()()()}if(2&Fe){const Ce=tt.ngIf,Ee=c.XpG();c.Y8G("form",Ce)("formData",c.bMT(1,4,Ee.data$)),c.R7$(2),c.Y8G("group",Ce.groups[0]),c.R7$(6),c.Y8G("disabled",Ee.submitDisabled)}}let Be=(()=>{class Fe{formService;form$=new F.t(void 0);data$=new F.t(void 0);submitDisabled=!0;valueChanges$$;constructor(Ce){this.formService=Ce}ngOnInit(){const Ee=[{name:"id",title:"ID",options:{cols:1,validator:R.k0.required}},{name:"name",title:"Name",options:{cols:1,validator:R.k0.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}].map(ct=>this.formService.field(ct)),Re=this.formService.form([],[this.formService.group({name:"info"},Ee)]);this.valueChanges$$=Re.control.valueChanges.subscribe(()=>{this.submitDisabled=!Re.control.valid}),this.form$.next(Re)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({id:1,name:"Bob",status:2})}clearForm(){this.form$.value.control.reset()}onSubmit(Ce){alert(JSON.stringify(Ce))}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(k.ux))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-form"]],standalone:!0,features:[c.aNF],decls:4,vars:3,consts:[["title","Form","subtitle","Common"],["codeFolder","common/form"],[3,"form","formData","submitForm",4,"ngIf"],[3,"submitForm","form","formData"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1),c.DNE(2,Xe,10,6,"igo-form",2),c.nI1(3,"async"),c.k0s()()),2&Ee&&(c.R7$(2),c.Y8G("ngIf",c.bMT(3,1,Re.form$)))},dependencies:[p.g,e.s,_.bT,k.s2,k.h4,v.Hl,v.$z,_.Jj],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{max-width:500px}"]})}return Fe})();var rt=r(15944),Ie=r(87984),Ve=r(36991);let ie=(()=>{class Fe{exampleIndexHtml=$e;exampleIndexStaticHtml=he;exampleStyleVariable=Ae;exampleProvider=Qe;nameControl=new R.MJ("shopping_cart_checkout");static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-icon"]],standalone:!0,features:[c.aNF],decls:60,vars:6,consts:[["title","Icon","subtitle","Common"],["href","https://fonts.google.com/icons","target","_blank"],["title","Icon","codeFolder","common/icon"],[1,"field-container"],["subscriptSizing","dynamic"],["matInput","","type","text",3,"formControl"],["icon","equal",1,"m-h-12"],[3,"icon"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"section")(2,"p"),c.EFF(3," The "),c.j41(4,"code"),c.EFF(5,"icon"),c.k0s(),c.EFF(6," is a core concept for many packages of the IGO2 library. The icon system is base on "),c.j41(7,"a",1),c.EFF(8,"Google Font - Material Symbol"),c.k0s(),c.EFF(9," who use font ligature to configure the icon "),c.k0s()(),c.j41(10,"section")(11,"h3"),c.EFF(12,"Getting started"),c.k0s(),c.j41(13,"h2"),c.EFF(14,"Static icon font (Most light in term of data)"),c.k0s(),c.EFF(15," In your "),c.j41(16,"code"),c.EFF(17,"index.html"),c.k0s(),c.EFF(18," file, add the variable font stylesheet request to your head tag and "),c.j41(19,"pre")(20,"code"),c.EFF(21),c.k0s()(),c.j41(22,"h2"),c.EFF(23,"Variable icon font (Alternative)"),c.k0s(),c.j41(24,"ol")(25,"li"),c.EFF(26," In your "),c.j41(27,"code"),c.EFF(28,"index.html"),c.k0s(),c.EFF(29," file, add the variable font stylesheet request to your head tag and "),c.j41(30,"pre")(31,"code"),c.EFF(32),c.k0s()()(),c.j41(33,"li"),c.EFF(34," Then add the current class with variable axes configuration to icons in your "),c.j41(35,"code"),c.EFF(36,"style.scss"),c.k0s(),c.EFF(37," file. "),c.j41(38,"pre")(39,"code"),c.EFF(40),c.k0s()()(),c.j41(41,"li"),c.EFF(42," Finally, add the icon provider configuration in your main file "),c.j41(43,"code"),c.EFF(44,"main.ts"),c.k0s(),c.j41(45,"pre")(46,"code"),c.EFF(47),c.k0s()()()()(),c.j41(48,"app-example-viewer",2)(49,"p"),c.EFF(50," Enter a name from the "),c.j41(51,"a",1),c.EFF(52,"Google Font - Material Symbol"),c.k0s()(),c.j41(53,"div",3)(54,"mat-form-field",4)(55,"mat-label"),c.EFF(56,"Icon Name"),c.k0s(),c.nrm(57,"input",5),c.k0s(),c.nrm(58,"igo-icon",6)(59,"igo-icon",7),c.k0s()()()),2&Ee&&(c.R7$(21),c.JRh(Re.exampleIndexStaticHtml),c.R7$(11),c.JRh(Re.exampleIndexHtml),c.R7$(8),c.JRh(Re.exampleStyleVariable),c.R7$(7),c.JRh(Re.exampleProvider),c.R7$(10),c.Y8G("formControl",Re.nameControl),c.R7$(2),c.Y8G("icon",Re.nameControl.value))},dependencies:[p.g,e.s,Ve.cc,rt.RG,rt.rl,rt.nJ,R.X1,R.me,R.BC,R.l_,Ie.fS,Ie.fg],styles:[".field-container[_ngcontent-%COMP%]{display:flex;align-items:center}"]})}return Fe})();const he='<link rel="stylesheet" href=""https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"" />',$e='<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />',Ae=".material-symbols-outlined {\n  font-variation-settings:\n  'FILL' 0,\n  'wght' 400,\n  'GRAD' 0,\n  'opsz' 24\n}",Qe="import { provideIcon } from '@igo2/common/icon';\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    provideIcon(),\n  ]\n})\n";var Ge=r(37989),at=r(93840),Oe=r(22047),Ye=r(10906),ze=r(68671),et=r(18537),jt=r(52575),dt=r(91817),to=function(Fe){return Fe[Fe.primary=0]="primary",Fe[Fe.accent=1]="accent",Fe[Fe.warn=2]="warn",Fe}(to||{}),Bt=r(63617),Tt=r(70271);class wo extends Ge.qS{_database;_model;_sort;get filter(){return this._filterChange.value}set filter(tt){this._filterChange.next(tt)}_filterChange=new F.t("");constructor(tt,Ce,Ee){super(),this._database=tt,this._model=Ce,this._sort=Ee}connect(){return this._database?(0,Bt.h)(this._database.dataChange,this._filterChange,this._sort.sortChange).pipe((0,Tt.T)(()=>this.getFilteredData(this._database.data)),(0,Tt.T)(Ce=>this.getSortedData(Ce))):(0,Bt.h)([])}disconnect(){}getFilteredData(tt){return this.filter?tt.slice().filter(Ce=>-1!==this._model.columns.filter(Re=>Re.filterable).map(Re=>ze.BF.resolve(Ce,Re.name)).join(" ").toLowerCase().indexOf(this.filter.toLowerCase())):tt}getSortedData(tt){return this._sort.active&&""!==this._sort.direction?tt.sort((Ce,Ee)=>{const Re=ze.BF.resolve(Ce,this._sort.active),ct=ze.BF.resolve(Ee,this._sort.active);return ze.BF.naturalCompare(ct,Re,this._sort.direction)}):tt}}const Mt=["filter"],mo=()=>({});function ut(Fe,tt){1&Fe&&(c.j41(0,"div",14)(1,"mat-form-field",15),c.nrm(2,"input",16,1),c.nI1(4,"translate"),c.k0s()()),2&Fe&&(c.R7$(2),c.Y8G("placeholder",c.bMT(4,1,"igo.common.table.filter")))}function Ft(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"th",17)(1,"mat-checkbox",18),c.bIt("change",function(Re){c.eBV(Ce);const ct=c.XpG();return c.Njj(Re?ct.masterToggle():null)}),c.k0s()()}if(2&Fe){const Ce=c.XpG();c.R7$(),c.Y8G("checked",Ce.selection.hasValue()&&Ce.isAllSelected())("indeterminate",Ce.selection.hasValue()&&!Ce.isAllSelected())}}function Qt(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"td",19)(1,"mat-checkbox",20),c.bIt("click",function(Re){return c.eBV(Ce),c.Njj(Re.stopPropagation())})("change",function(Re){const ct=c.eBV(Ce).$implicit,no=c.XpG();return c.Njj(Re?no.selection.toggle(ct):null)}),c.k0s()()}if(2&Fe){const Ce=tt.$implicit,Ee=c.XpG();c.R7$(),c.Y8G("checked",Ee.selection.isSelected(Ce))}}function nt(Fe,tt){if(1&Fe&&(c.j41(0,"th",25),c.EFF(1),c.k0s()),2&Fe){const Ce=c.XpG(2).$implicit;c.R7$(),c.SpI(" ",Ce.title," ")}}function Eo(Fe,tt){1&Fe&&(c.qex(0),c.DNE(1,nt,2,1,"th",24),c.bVm())}function qt(Fe,tt){if(1&Fe&&(c.j41(0,"th",17),c.EFF(1),c.k0s()),2&Fe){const Ce=c.XpG(2).$implicit;c.R7$(),c.JRh(Ce.title)}}function ro(Fe,tt){1&Fe&&(c.qex(0),c.DNE(1,qt,2,1,"th",8),c.bVm())}function Uo(Fe,tt){if(1&Fe&&(c.j41(0,"td",27),c.EFF(1),c.k0s()),2&Fe){const Ce=tt.$implicit,Ee=c.XpG(2).$implicit,Re=c.XpG();c.Y8G("ngClass",Re.model.cellClassFunc?Re.model.cellClassFunc(Ce,Ee):c.lJ4(2,mo)),c.R7$(),c.SpI(" ",Re.getValue(Ce,Ee.name)," ")}}function Do(Fe,tt){1&Fe&&(c.qex(0),c.DNE(1,Uo,2,3,"td",26),c.bVm())}function dn(Fe,tt){if(1&Fe&&c.nrm(0,"td",29),2&Fe){const Ce=tt.$implicit,Ee=c.XpG(2).$implicit,Re=c.XpG();c.Y8G("ngClass",Re.model.cellClassFunc?Re.model.cellClassFunc(Ce,Ee):c.lJ4(2,mo))("innerHTML",Re.getValue(Ce,Ee.name),c.npT)}}function lo(Fe,tt){1&Fe&&c.DNE(0,dn,1,3,"td",28)}function co(Fe,tt){if(1&Fe&&(c.qex(0,21),c.DNE(1,Eo,2,0,"ng-container",22)(2,ro,2,0,"ng-container",22)(3,Do,2,0,"ng-container",23)(4,lo,1,0,"ng-template",null,2,c.C5r),c.bVm()),2&Fe){const Ce=tt.$implicit,Ee=c.sdS(5);c.Y8G("matColumnDef",Ce.name),c.R7$(),c.Y8G("ngIf",Ce.sortable),c.R7$(),c.Y8G("ngIf",!Ce.sortable),c.R7$(),c.Y8G("ngIf",!Ce.html)("ngIfElse",Ee)}}function mt(Fe,tt){1&Fe&&c.nrm(0,"th",17)}function Ro(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"button",31),c.bIt("click",function(Re){const ct=c.eBV(Ce).$implicit,no=c.XpG().$implicit,gn=c.XpG();return c.Njj(gn.handleClickAction(Re,ct,no))}),c.j41(1,"mat-icon"),c.EFF(2),c.k0s()()}if(2&Fe){const Ce=tt.$implicit,Ee=c.XpG(2);c.Y8G("color",Ee.getActionColor(Ce.color)),c.R7$(2),c.JRh(Ce.icon)}}function tn(Fe,tt){if(1&Fe&&(c.j41(0,"td",19),c.DNE(1,Ro,3,2,"button",30),c.k0s()),2&Fe){const Ce=c.XpG();c.R7$(),c.Y8G("ngForOf",Ce.model.actions)}}function Xo(Fe,tt){1&Fe&&c.nrm(0,"tr",32)}function mn(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"tr",33),c.bIt("click",function(){const Re=c.eBV(Ce).$implicit,ct=c.XpG();return c.Njj(ct.selection.toggle(Re))}),c.k0s()}if(2&Fe){const Ce=tt.$implicit,Ee=c.XpG();c.Y8G("ngClass",Ee.model.rowClassFunc?Ee.model.rowClassFunc(Ce):c.lJ4(1,mo))}}let Po=(()=>{class Fe{get database(){return this._database}set database(Ce){this._database=Ce}_database;get model(){return this._model}set model(Ce){this._model=Ce}_model;get hasFilterInput(){return this._hasFIlterInput}set hasFilterInput(Ce){this._hasFIlterInput=Ce}_hasFIlterInput=!0;displayedColumns;dataSource;selection=new Ge.CB(!0,[]);select=new c.bkB;filter;sort;ngOnInit(){this.dataSource=new wo(this.database,this.model,this.sort),this.model&&(this.displayedColumns=this.model.columns.filter(Ce=>!1!==Ce.displayed).map(Ce=>Ce.name),this.model.selectionCheckbox&&this.displayedColumns.unshift("selectionCheckbox"),this.model.actions&&this.model.actions.length&&this.displayedColumns.push("action")),this.selection.changed.subscribe(Ce=>this.select.emit(Ce))}ngAfterViewInit(){this.filter&&(0,et.R)(this.filter.nativeElement,"keyup").pipe((0,jt.B)(150),(0,dt.F)()).subscribe(()=>{this.dataSource&&(this.dataSource.filter=this.filter.nativeElement.value)})}ngOnChanges(Ce){Ce.database&&(this.dataSource=new wo(this.database,this.model,this.sort),this.selection.clear())}getActionColor(Ce){return to[Ce]}getValue(Ce,Ee){return ze.BF.resolve(Ce,Ee)}isAllSelected(){return this.selection.selected.length===this.database.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.database.data.forEach(Ce=>this.selection.select(Ce))}handleClickAction(Ce,Ee,Re){Ce.stopPropagation(),Ee.click(Re)}static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275cmp=c.VBU({type:Fe,selectors:[["igo-table"]],viewQuery:function(Ee,Re){if(1&Ee&&(c.GBs(Mt,5),c.GBs(Oe.B4,7)),2&Ee){let ct;c.mGM(ct=c.lsd())&&(Re.filter=ct.first),c.mGM(ct=c.lsd())&&(Re.sort=ct.first)}},inputs:{database:"database",model:"model",hasFilterInput:"hasFilterInput"},outputs:{select:"select"},standalone:!0,features:[c.OA$,c.aNF],decls:14,vars:5,consts:[["table",""],["filter",""],["cellHTML",""],[1,"table-box"],["class","table-header",4,"ngIf"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","selectionCheckbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[1,"table-header"],["floatPlaceholder","never"],["matInput","",3,"placeholder"],["mat-header-cell",""],[3,"change","checked","indeterminate"],["mat-cell",""],[3,"click","change","checked"],[3,"matColumnDef"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-mini-fab","",3,"color","click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"click","color"],["mat-header-row",""],["mat-row","",3,"click","ngClass"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"div",3),c.DNE(1,ut,5,3,"div",4),c.j41(2,"div",5)(3,"table",6,0),c.qex(5,7),c.DNE(6,Ft,2,2,"th",8)(7,Qt,2,1,"td",9),c.bVm(),c.DNE(8,co,6,5,"ng-container",10),c.qex(9,11),c.DNE(10,mt,1,0,"th",8)(11,tn,2,1,"td",9),c.bVm(),c.DNE(12,Xo,1,0,"tr",12)(13,mn,1,2,"tr",13),c.k0s()()()),2&Ee&&(c.R7$(),c.Y8G("ngIf",Re.hasFilterInput),c.R7$(2),c.Y8G("dataSource",Re.dataSource),c.R7$(5),c.Y8G("ngForOf",Re.model.columns),c.R7$(4),c.Y8G("matHeaderRowDef",Re.displayedColumns),c.R7$(),c.Y8G("matRowDefColumns",Re.displayedColumns))},dependencies:[_.bT,rt.RG,rt.rl,Ie.fS,Ie.fg,Ye.tP,Ye.Zl,Ye.tL,Ye.ji,Ye.cC,Ye.YV,Ye.iL,Ye.KS,Ye.$R,Ye.YZ,Ye.NB,Oe.NQ,Oe.B4,Oe.aE,u.g7,u.So,_.pM,_.YU,v.Hl,v.$0,at.m_,at.An,j.Ck,Y.D9],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.table-box[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.table-header[_ngcontent-%COMP%]{min-height:64px;max-width:500px;display:flex;flex:0 1 auto;align-items:baseline;padding:8px 24px 0;font-size:20px;justify-content:space-between}tr[mat-header-row][_ngcontent-%COMP%], tr[mat-row][_ngcontent-%COMP%]{height:60px}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}td[mat-cell][_ngcontent-%COMP%]{padding-right:15px}th.mat-mdc-header-cell[_ngcontent-%COMP%]{padding-right:5px}button[_ngcontent-%COMP%]{margin-right:10px}"]})}return Fe})();class so{dataChange=new F.t([]);get data(){return this.dataChange.value}constructor(tt){tt&&this.dataChange.next(tt)}set(tt){this.dataChange.next(tt)}add(tt){const Ce=this.data.slice();Ce.push(tt),this.set(Ce)}remove(tt){const Ce=this.data.slice(),Ee=Ce.indexOf(tt);Ce.splice(Ee,1),this.set(Ce)}}let At=(()=>{class Fe{database;model={columns:[{name:"id",title:"ID",sortable:!1,filterable:!0},{name:"name",title:"Name",sortable:!0,filterable:!0},{name:"description",title:"Description",sortable:!0,filterable:!0}],actions:[{icon:"description",color:to.primary,click:Ce=>this.showName(Ce.name)}],selectionCheckbox:!0};constructor(){}ngOnInit(){this.database=new so([{id:"2",name:"Name 2",description:"Hello 2"},{id:"1",name:"Name 1",description:"Bonjour 1"},{id:"3",name:"Name 3",description:"Hola 3"}])}showName(Ce){alert(Ce)}handleSelect(Ce){console.log(Ce)}static \u0275fac=function(Ee){return new(Ee||Fe)};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-table"]],standalone:!0,features:[c.aNF],decls:3,vars:3,consts:[["title","Table","subtitle","Common"],["codeFolder","common/table"],[3,"select","database","model","hasFilterInput"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-table",2),c.bIt("select",function(no){return Re.handleSelect(no)}),c.k0s()()()),2&Ee&&(c.R7$(2),c.Y8G("database",Re.database)("model",Re.model)("hasFilterInput",!0))},dependencies:[p.g,e.s,Po],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Fe})();var $o=r(24398),on=r(62152),vo=r(12545);function Ht(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"button",7),c.bIt("click",function(){c.eBV(Ce);const Re=c.XpG();return c.Njj(Re.toolbox.activatePreviousTool())}),c.j41(1,"mat-icon"),c.EFF(2,"arrow_back"),c.k0s()()}}function Io(Fe,tt){if(1&Fe){const Ce=c.RV6();c.j41(0,"button",8),c.bIt("click",function(){c.eBV(Ce);const Re=c.XpG();return c.Njj(Re.toolbox.deactivateTool())}),c.j41(1,"mat-icon"),c.EFF(2,"menu"),c.k0s()()}}let Co=class ra{cdRef;name;constructor(tt){this.cdRef=tt}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(Ce){return new(Ce||ra)(c.rXU(c.gRc))};static \u0275cmp=c.VBU({type:ra,selectors:[["app-salutation-tool"]],inputs:{name:"name"},standalone:!0,features:[c.aNF],decls:2,vars:1,template:function(Ce,Ee){1&Ce&&(c.j41(0,"p"),c.EFF(1),c.k0s()),2&Ce&&(c.R7$(),c.SpI("Hello, my name is ",Ee.name,"."))},encapsulation:2,changeDetection:0})};Co=(0,$o.Cg)([(0,vo.S$)({name:"demo-salutation",title:"Salutation",icon:"person",options:{name:"Jack"}}),(0,$o.Sn)("design:paramtypes",[c.gRc])],Co);let Lo=class sa{static \u0275fac=function(Ce){return new(Ce||sa)};static \u0275cmp=c.VBU({type:sa,selectors:[["app-about-tool"]],standalone:!0,features:[c.aNF],decls:2,vars:0,template:function(Ce,Ee){1&Ce&&(c.j41(0,"p"),c.EFF(1,"I'm a tool inside a toolbox."),c.k0s())},encapsulation:2,changeDetection:0})};Lo=(0,$o.Cg)([(0,vo.S$)({name:"demo-about",title:"About",icon:"information"})],Lo);let Ao=(()=>{class Fe{toolService;toolbox=new vo.OO;get activeTool$(){return this.toolbox.activeTool$}get panelTitle(){return this.activeTool$.value?this.activeTool$.value.title:"Toolbox"}constructor(Ce){this.toolService=Ce}ngOnInit(){this.toolbox.setToolbar(["demo-salutation","demo-about"]),this.toolbox.setTools(this.toolService.getTools())}ngOnDestroy(){this.toolbox.destroy()}activateSalutationTool(){this.toolbox.activateTool("demo-salutation",{name:"Bob"})}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(vo.mJ))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-tool"]],standalone:!0,features:[c.aNF],decls:10,vars:9,consts:[["title","Tool","subtitle","Common"],["codeFolder","common/tool"],[3,"title"],["mat-icon-button","","panelLeftButton","",3,"click",4,"ngIf"],["mat-icon-button","","panelRightButton","",3,"click",4,"ngIf"],["color","primary",3,"toolbox","animate"],["mat-flat-button","","type","button","color","primary",3,"click"],["mat-icon-button","","panelLeftButton","",3,"click"],["mat-icon-button","","panelRightButton","",3,"click"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-panel",2),c.DNE(3,Ht,3,0,"button",3),c.nI1(4,"async"),c.DNE(5,Io,3,0,"button",4),c.nI1(6,"async"),c.nrm(7,"igo-toolbox",5),c.k0s(),c.j41(8,"button",6),c.bIt("click",function(){return Re.activateSalutationTool()}),c.EFF(9," Activate Salutation Tool "),c.k0s()()()),2&Ee&&(c.R7$(2),c.Y8G("title",Re.panelTitle),c.R7$(),c.Y8G("ngIf",c.bMT(4,5,Re.activeTool$)),c.R7$(2),c.Y8G("ngIf",c.bMT(6,7,Re.activeTool$)),c.R7$(2),c.Y8G("toolbox",Re.toolbox)("animate",!0))},dependencies:[p.g,e.s,on.g,_.bT,v.Hl,v.$z,v.iY,at.m_,at.An,vo.PY,_.Jj],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Fe})();var ko=r(84374),zt=r(49827);let Ko=(()=>{class Fe{cdRef;name;complete=new c.bkB;cancel=new c.bkB;constructor(Ce){this.cdRef=Ce}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(c.gRc))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-salutation-widget"]],inputs:{name:"name"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[c.aNF],decls:6,vars:1,consts:[["mat-flat-button","",3,"click"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"p"),c.EFF(1),c.k0s(),c.j41(2,"button",0),c.bIt("click",function(){return Re.complete.emit(Re.name)}),c.EFF(3," Nice to meet you "),c.k0s(),c.j41(4,"button",0),c.bIt("click",function(){return Re.cancel.emit(Re.name)}),c.EFF(5,"Dismiss"),c.k0s()),2&Ee&&(c.R7$(),c.SpI("Hello, my name is ",Re.name,"."))},dependencies:[v.Hl,v.$z],encapsulation:2,changeDetection:0})}return Fe})();const jo=[{path:"",redirectTo:"action",pathMatch:"full"},{title:"Action",path:"action",component:L},{title:"Dialogs",path:"dialog",component:ye},{title:"Dynamic Component",path:"dynamic-component",component:re},{title:"Entity Table",path:"entity-table",component:We},{title:"Entity Selector",path:"entity-selector",component:Le},{title:"Form",path:"form",component:Be},{title:"Icon",path:"icon",component:ie},{title:"Table",path:"table",component:At},{title:"Tool",path:"tool",component:Ao},{title:"Widget",path:"widget",component:(()=>{class Fe{widgetService;widget;inputs={name:"Bob"};constructor(Ce){this.widgetService=Ce,this.widget=this.widgetService.create(Ko)}onWidgetComplete(Ce){alert(`${Ce} emitted event 'complete' then got automatically destroyed.`)}onWidgetCancel(){alert("Widget emitted event 'cancel' then got automatically destroyed.")}static \u0275fac=function(Ee){return new(Ee||Fe)(c.rXU(ko.Cq))};static \u0275cmp=c.VBU({type:Fe,selectors:[["app-widget"]],standalone:!0,features:[c.aNF],decls:3,vars:2,consts:[["title","Widget","subtitle","Common"],["codeFolder","common/widget"],[3,"complete","cancel","widget","inputs"]],template:function(Ee,Re){1&Ee&&(c.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-widget-outlet",2),c.bIt("complete",function(no){return Re.onWidgetComplete(no)})("cancel",function(){return Re.onWidgetCancel()}),c.k0s()()()),2&Ee&&(c.R7$(2),c.Y8G("widget",Re.widget)("inputs",Re.inputs))},dependencies:[p.g,e.s,ko.bM,zt.b],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Fe})()}]},49156:(De,le,r)=>{"use strict";r.d(le,{g:()=>c});var M=r(60316),a=r(68559);const F=["*"];function p(o,L){if(1&o&&(a.j41(0,"li"),a.EFF(1),a.k0s()),2&o){const R=L.$implicit;a.R7$(),a.JRh(R)}}function e(o,L){if(1&o&&(a.qex(0),a.j41(1,"label",3),a.EFF(2,"Dependencies:"),a.k0s(),a.j41(3,"ul"),a.DNE(4,p,2,1,"li",4),a.k0s(),a.bVm()),2&o){const R=a.XpG();a.R7$(4),a.Y8G("ngForOf",R.dependencies)}}let c=(()=>{class o{title;subtitle;dependencies;static \u0275fac=function(v){return new(v||o)};static \u0275cmp=a.VBU({type:o,selectors:[["app-doc-viewer"]],inputs:{title:"title",subtitle:"subtitle",dependencies:"dependencies"},standalone:!0,features:[a.aNF],ngContentSelectors:F,decls:7,vars:3,consts:[[1,"mat-subtitle-2","m-b-0"],[1,"mat-body-1"],[4,"ngIf"],["for",""],[4,"ngFor","ngForOf"]],template:function(v,y){1&v&&(a.NAR(),a.j41(0,"h6",0),a.EFF(1),a.k0s(),a.j41(2,"h2"),a.EFF(3),a.k0s(),a.j41(4,"div",1),a.DNE(5,e,5,1,"ng-container",2),a.SdG(6),a.k0s()),2&v&&(a.R7$(),a.JRh(y.subtitle),a.R7$(2),a.JRh(y.title),a.R7$(2),a.Y8G("ngIf",null==y.dependencies?null:y.dependencies.length))},dependencies:[M.bT,M.pM],styles:["[_nghost-%COMP%]{display:block;padding:16px 48px}@media (max-width: 599px){[_nghost-%COMP%]{padding:16px}}[_nghost-%COMP%]     pre{background:#00000003;border:.5px solid rgba(0,0,0,.2);border-radius:5px;display:block;margin:16px auto;overflow-x:auto;padding:20px;white-space:pre-wrap}[_nghost-%COMP%]     pre code{background:transparent}[_nghost-%COMP%]     code{background:#00000008;padding:3px;font-size:90%}[_nghost-%COMP%]     section{margin-bottom:42px}"]})}return o})()},99621:(De,le,r)=>{"use strict";r.d(le,{s:()=>b});var M=r(60316),a=r(84175),F=r(53777),p=r(14102),e=r(93840),c=r(80640),o=r(68559);const L=["*"];function R(k,_){if(1&k&&(o.j41(0,"a",6)(1,"mat-icon"),o.EFF(2,"code-tags"),o.k0s()()),2&k){const D=o.XpG();o.Y8G("href",D.codeUrl,o.B4B)}}function v(k,_){if(1&k&&(o.j41(0,"a",7)(1,"mat-icon"),o.EFF(2,"settings"),o.k0s()()),2&k){const D=o.XpG();o.Y8G("href",D.configUrl,o.B4B)}}const y="https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src";let b=(()=>{class k{title;codeFolder;configFolder;get codeUrl(){return`${y}/app/${this.codeFolder}`}get configUrl(){return`${y}/${this.configFolder}`}static \u0275fac=function(h){return new(h||k)};static \u0275cmp=o.VBU({type:k,selectors:[["app-example-viewer"]],inputs:{title:"title",codeFolder:"codeFolder",configFolder:"configFolder"},standalone:!0,features:[o.aNF],ngContentSelectors:L,decls:10,vars:3,consts:[["appearance","outlined"],[1,"actions"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href",4,"ngIf"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href",4,"ngIf"],[1,"m-b-16"],[1,"mat-body-1"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href"]],template:function(h,X){1&h&&(o.NAR(),o.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-subtitle"),o.EFF(3),o.k0s(),o.j41(4,"div",1),o.DNE(5,R,3,1,"a",2)(6,v,3,1,"a",3),o.k0s()(),o.nrm(7,"mat-divider",4),o.j41(8,"mat-card-content",5),o.SdG(9),o.k0s()()),2&h&&(o.R7$(3),o.SpI(" ",X.title," "),o.R7$(2),o.Y8G("ngIf",X.codeFolder),o.R7$(),o.Y8G("ngIf",X.configFolder))},dependencies:[F.Hu,F.RN,F.m2,F.MM,F.Lc,M.bT,a.Hl,a.pQ,c.uc,c.oV,e.m_,e.An,p.w,p.q],styles:["[_nghost-%COMP%]{display:block;margin-top:24px}[_nghost-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 8px 0 16px;margin-bottom:0}[_nghost-%COMP%]     .mat-mdc-card-header-text{display:flex;align-items:center}[_nghost-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:16px}"]})}return k})()},64654:(De,le,r)=>{"use strict";r.r(le),r.d(le,{routes:()=>y});var M=r(16488),a=r(62152),F=r(57132),p=r(19032),e=r(49156),c=r(99621),o=r(68559);const L=()=>["HttpClientModule"];function R(b,k){1&b&&o.nrm(0,"igo-metadata-button",18),2&b&&o.Y8G("layer",k.layer)}const y=[{path:"",redirectTo:"context",pathMatch:"full"},{title:"Context",path:"context",component:(()=>{class b{mapService;contextService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(_,D){this.mapService=_,this.contextService=D,this.mapService.setMap(this.map),this.contextService.loadDefaultContext(),this.contextService.loadContexts()}static \u0275fac=function(D){return new(D||b)(o.rXU(p.uk7),o.rXU(F.VT))};static \u0275cmp=o.VBU({type:b,selectors:[["app-context"]],standalone:!0,features:[o.aNF],decls:22,vars:12,consts:[["igoLayerItemToolbar",""],["title","Context","subtitle","Context",3,"dependencies"],["codeFolder","context/context","configFolder","contexts"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoMapContext","","igoLayerContext","",3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100"],["title","Contexts list",1,"h-100","w-100"],["igoContextListBinding","",3,"map"],["title","Layers",1,"h-100","w-100"],["igoLayerListBinding","",3,"map"],["title","Import/Export context","codeFolder","context/context","configFolder","contexts"],[3,"map"],[3,"layer"]],template:function(D,h){1&D&&(o.j41(0,"app-doc-viewer",1)(1,"app-example-viewer",2)(2,"mat-grid-list",3)(3,"mat-grid-tile")(4,"igo-map-browser",4)(5,"div",5),o.nrm(6,"div",6)(7,"igo-rotation-button",7),o.k0s(),o.j41(8,"div",8),o.nrm(9,"igo-home-extent-button",9)(10,"igo-geolocate-button",9)(11,"igo-zoom-button",10),o.k0s()()(),o.j41(12,"mat-grid-tile")(13,"div",11)(14,"igo-panel",12),o.nrm(15,"igo-context-list",13),o.k0s(),o.j41(16,"igo-panel",14)(17,"igo-layer-list",15),o.DNE(18,R,1,1,"ng-template",null,0,o.C5r),o.k0s()()()()()(),o.j41(20,"app-example-viewer",16),o.nrm(21,"igo-context-import-export",17),o.k0s()()),2&D&&(o.Y8G("dependencies",o.lJ4(11,L)),o.R7$(4),o.Y8G("map",h.map)("view",h.view),o.R7$(3),o.Y8G("showIfNoRotation",!0)("map",h.map),o.R7$(2),o.Y8G("map",h.map),o.R7$(),o.Y8G("map",h.map),o.R7$(),o.Y8G("map",h.map),o.R7$(4),o.Y8G("map",h.map),o.R7$(2),o.Y8G("map",h.map),o.R7$(4),o.Y8G("map",h.map))},dependencies:[e.g,c.s,M.Fe,M.B_,M.NS,p.xLv,p.hUG,p.KnQ,p.we_,p.LzH,F.RT,F.kc,F.V,F.QC,a.g,p.Lnt,p.cBF,p.LU,F.g4]})}return b})()}]},48723:(De,le,r)=>{"use strict";r.r(le),r.d(le,{routes:()=>Xe});var M=r(84175),a=r(73314),F=r(67778),p=r(49156),e=r(99621),c=r(68559);let o=(()=>{class Be{activityService;idsActivity=[];constructor(Ie){this.activityService=Ie}register(){this.idsActivity.push(this.activityService.register())}unregister(){this.activityService.unregister(this.idsActivity.pop())}get counter(){return this.activityService.counter$.value}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(F.Ti))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-activity"]],standalone:!0,features:[c.aNF],decls:23,vars:1,consts:[["title","Activity","subtitle","Core"],["codeFolder","core/activity"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"mat-body-1","sub-content"],["igoSpinnerActivity",""]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"p"),c.EFF(2,"Register activities in service. Use to display a loading icon"),c.k0s(),c.j41(3,"li"),c.EFF(4," Import "),c.j41(5,"code"),c.EFF(6,"IgoActivityModule"),c.k0s(),c.EFF(7," only if you want register HTTP calls "),c.k0s(),c.j41(8,"li"),c.EFF(9,"Import "),c.j41(10,"code"),c.EFF(11,"IgoActivityModule"),c.k0s(),c.EFF(12," only once"),c.k0s(),c.j41(13,"app-example-viewer",1)(14,"div",2)(15,"button",3),c.bIt("click",function(){return ie.register()}),c.EFF(16,"Register"),c.k0s(),c.j41(17,"button",3),c.bIt("click",function(){return ie.unregister()}),c.EFF(18,"Unregister"),c.k0s()(),c.j41(19,"div",4)(20,"p"),c.EFF(21),c.k0s(),c.nrm(22,"igo-spinner",5),c.k0s()()()),2&Ve&&(c.R7$(21),c.SpI("Counter: ",ie.counter,""))},dependencies:[p.g,e.s,a.tI,M.Hl,M.$z],styles:["[_nghost-%COMP%]   .sub-content[_ngcontent-%COMP%]{margin-top:12px}"]})}return Be})();var L=r(60316),R=r(67143);let v=(()=>{class Be{configService;configLanguage;constructor(Ie){this.configService=Ie,this.configLanguage=this.configService.getConfig("language")}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(R.we))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-config"]],standalone:!0,features:[c.aNF],decls:12,vars:3,consts:[["title","Config","subtitle","Core"],["title","Simple config","codeFolder","core/config","configFolder","environments"],[1,"mat-body-1"]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"p"),c.EFF(2,"Load config in your angular application"),c.k0s(),c.j41(3,"li"),c.EFF(4,"Import "),c.j41(5,"code"),c.EFF(6,"IgoConfigModule"),c.k0s(),c.EFF(7," only once"),c.k0s(),c.j41(8,"app-example-viewer",1)(9,"p",2),c.EFF(10),c.nI1(11,"json"),c.k0s()()()),2&Ve&&(c.R7$(10),c.SpI("Config language: ",c.bMT(11,1,ie.configLanguage),""))},dependencies:[p.g,e.s,L.TG]})}return Be})();var y=r(21701),b=r(90852);let k=(()=>{class Be{languageService;app={title:"IGO"};constructor(Ie){this.languageService=Ie}changeLanguage(Ie){this.languageService.setLanguage(Ie),console.log(this.languageService)}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(y.gw))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-language"]],standalone:!0,features:[c.aNF],decls:21,vars:4,consts:[["title","Language","subtitle","Core"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src/locale"],["codeFolder","core/language"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"m-t-12"]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"p"),c.EFF(2,"Translate your angular application"),c.k0s(),c.j41(3,"li"),c.EFF(4,"Import "),c.j41(5,"code"),c.EFF(6,"IgoLanguageModule"),c.k0s(),c.EFF(7," only once"),c.k0s(),c.j41(8,"li"),c.EFF(9," Configure the "),c.j41(10,"a",1),c.EFF(11,"locale files"),c.k0s()(),c.j41(12,"app-example-viewer",2)(13,"div",3)(14,"button",4),c.bIt("click",function(){return ie.changeLanguage("en")}),c.EFF(15,"English"),c.k0s(),c.j41(16,"button",4),c.bIt("click",function(){return ie.changeLanguage("fr")}),c.EFF(17,"Fran\xe7ais"),c.k0s()(),c.j41(18,"div",5),c.EFF(19),c.nI1(20,"translate"),c.k0s()()()),2&Ve&&(c.R7$(19),c.SpI(" ",c.i5U(20,1,"welcome",ie.app)," "))},dependencies:[p.g,e.s,M.Hl,M.$z,y.Ck,b.D9]})}return Be})();var _=r(55050);let D=(()=>{class Be{mediaService;constructor(Ie){this.mediaService=Ie}get media(){return this.mediaService.getMedia()}get orientation(){return this.mediaService.getOrientation()}get isTouchScreen(){return this.mediaService.isTouchScreen()}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(_.u1))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-media"]],standalone:!0,features:[c.aNF],decls:10,vars:3,consts:[["title","Media","subtitle","Core"],["codeFolder","core/media"]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"p"),c.EFF(2,"Detect type of media (mobile, tablet, desktop)"),c.k0s(),c.j41(3,"app-example-viewer",1)(4,"p"),c.EFF(5),c.k0s(),c.j41(6,"p"),c.EFF(7),c.k0s(),c.j41(8,"p"),c.EFF(9),c.k0s()()()),2&Ve&&(c.R7$(5),c.SpI("Current media: ",ie.media,""),c.R7$(2),c.SpI("Current orientation: ",ie.orientation,""),c.R7$(2),c.SpI(" Device mode: ",ie.isTouchScreen?"Touch device":"Not a touch device "," "))},dependencies:[p.g,e.s]})}return Be})();var h=r(1455);let X=(()=>{class Be{messageService;constructor(Ie){this.messageService=Ie}success(){this.messageService.success("Congratulations","Success")}info(){this.messageService.info("Welcome to IGO","Info")}alert(){this.messageService.alert("Warning","Alert")}error(){this.messageService.error("There is a bug","Error")}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(h.bg))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-message"]],standalone:!0,features:[c.aNF],decls:20,vars:0,consts:[["title","Message","subtitle","Core"],["codeFolder","core/message"],[1,"d-flex","m-t-16","actions-container"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"p"),c.EFF(2,"Show message to user."),c.k0s(),c.j41(3,"li"),c.EFF(4,"Import "),c.j41(5,"code"),c.EFF(6,"IgoMessageModule"),c.k0s(),c.EFF(7," only once"),c.k0s(),c.j41(8,"li"),c.EFF(9,"Dependencies: BrowserAnimationsModule"),c.k0s(),c.j41(10,"app-example-viewer",1)(11,"div",2)(12,"button",3),c.bIt("click",function(){return ie.success()}),c.EFF(13,"Success message"),c.k0s(),c.j41(14,"button",4),c.bIt("click",function(){return ie.info()}),c.EFF(15," Info message "),c.k0s(),c.j41(16,"button",5),c.bIt("click",function(){return ie.alert()}),c.EFF(17," Alert message "),c.k0s(),c.j41(18,"button",6),c.bIt("click",function(){return ie.error()}),c.EFF(19," Error message "),c.k0s()()()())},dependencies:[p.g,e.s,M.Hl,M.$z]})}return Be})();var H=r(22359);const x=Be=>!!Be.tracesSampleRate||!!Be.tracesSampler,ee=Be=>!!Be.replaysSessionSampleRate||!!Be.replaysOnErrorSampleRate;var G=r(58610),U=r(12189),N=r(76484),W=r(31793);const O=new c.nKC("monitoring.options");function j(Be){if(!Be)return[];const rt=[{provide:O,useValue:Be}];return"sentry"===Be.provider&&rt.push(...(Be=>{if(void 0!==Be.enabled&&!Be.enabled)return[];((Be,rt)=>{if((0,N.KU)())return;const Ve={...Be,integrations:[x(Be)&&(0,U.dp)(),ee(Be)&&(0,W.w)()].filter(Boolean)};(0,U.Ts)(Ve)})(Be);const Ie=x(Be);return[{provide:c.zcH,useFactory:()=>(Be=>(0,U.JF)({logErrors:Be.logErrors,...Be.errorHandlerOptions??{}}))(Be)},Ie&&{provide:U.jP,deps:[G.Ix]},Ie&&{provide:c.hnV,useFactory:()=>()=>{},deps:[U.jP],multi:!0}].filter(Boolean)})(Be)),rt}var w=r(30699),I=r(2435),E=r(36647);let s=(()=>{class Be{configService;monitoringOptions;injector;authService;constructor(Ie,Ve,ie){this.configService=Ie,this.monitoringOptions=Ve,this.injector=ie,this.monitoringOptions?.identifyUser&&this.configService.isLoaded$.pipe((0,I.$)(he=>he),(0,E.n)(()=>(this.authService=this.injector.get(w.uR),this.authService?.authenticate$))).subscribe(he=>{this._identifyUser(he?this.authService.user:null)})}_identifyUser(Ie){"sentry"===this.monitoringOptions.provider&&(Be=>{(0,H.gV)(Be?{id:Be.id,username:`${Be.firstName} ${Be.lastName}`,email:Be.email}:null)})(Ie)}static \u0275fac=function(Ve){return new(Ve||Be)(c.KVO(R.we),c.KVO(O,8),c.KVO(c.zZn))};static \u0275prov=c.jDH({token:Be,factory:Be.\u0275fac,providedIn:"root"})}return Be})();function z(Be){return Be?[{provide:s,useClass:s,deps:[R.we,O,c.zZn]},{provide:c.hnV,useFactory:()=>()=>{},deps:[s],multi:!0}]:[]}var Q=r(92913);let ae=(()=>{class Be{options;json;exampleProviderCode=ye;constructor(Ie,Ve){this.options=Ie,this.json=Ve}throwTestError(){throw new Error("Sentry Test Error")}getBasicConfigExample(){const Ie=`{"igo": {"monitoring": ${JSON.stringify(this.options,null,2)}}}`;return this.json.transform(JSON.parse(Ie))}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(O),c.rXU(L.TG))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-monitoring"]],standalone:!0,features:[c.Jv_([L.TG,...j(Q.c.igo.monitoring),...z(Q.c.igo.monitoring)]),c.aNF],decls:58,vars:2,consts:[["title","Monitoring","subtitle","Core"],["href","https://docs.sentry.io/platforms/javascript/configuration/options","target","_blank"],["href","https://docs.sentry.io/platforms/javascript/guides/angular/sourcemaps/","target","_blank"],[3,"innerHTML"],["title","Sentry","codeFolder","core/monitoring","configFolder","environments"],[1,"mat-body-1"],["mat-raised-button","","color","warn",3,"click"]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"section")(2,"p"),c.EFF(3," The "),c.j41(4,"code"),c.EFF(5,"monitoring"),c.k0s(),c.EFF(6," package provides a set of configuration for managing application monitoring "),c.k0s(),c.j41(7,"ul")(8,"li"),c.EFF(9,"Error montioring, report application exception"),c.k0s(),c.j41(10,"li"),c.EFF(11,"Custom event reporting, like tracking use of code deprecation"),c.k0s()()(),c.j41(12,"section")(13,"h3"),c.EFF(14,"Getting started"),c.k0s(),c.j41(15,"p"),c.EFF(16," Start by configure the monitoring options in your "),c.j41(17,"code"),c.EFF(18,"environnment.ts"),c.k0s(),c.EFF(19," file. You can complement this configuration with your provider options. To get the basic options, for Sentry consult the "),c.j41(20,"a",1),c.EFF(21,"documentation"),c.k0s()(),c.j41(22,"pre")(23,"code"),c.EFF(24),c.k0s()()(),c.j41(25,"section")(26,"h3"),c.EFF(27,"Identify user information with the event"),c.k0s(),c.j41(28,"p"),c.EFF(29," If you yant to identify the user with the monitoring event, you need to configure "),c.j41(30,"code"),c.EFF(31,"identifyUser"),c.k0s(),c.EFF(32," to true in the monitoring options. Then import the "),c.j41(33,"code"),c.EFF(34,"provideAuthUserMonitoring"),c.k0s(),c.EFF(35," to your main file. "),c.k0s()(),c.j41(36,"section")(37,"h3"),c.EFF(38,"Add Readable Stack Traces to Errors for your application"),c.k0s(),c.j41(39,"p"),c.EFF(40," Follow the instruction "),c.j41(41,"a",2),c.EFF(42,"Sentry - Source Maps"),c.k0s()()(),c.j41(43,"section")(44,"h3"),c.EFF(45,"Initialize monitoring"),c.k0s(),c.j41(46,"p"),c.EFF(47," Then import the "),c.j41(48,"code"),c.EFF(49,"provideMonitoring"),c.k0s(),c.EFF(50," providers into your main file "),c.k0s(),c.j41(51,"pre"),c.nrm(52,"code",3),c.k0s()(),c.j41(53,"app-example-viewer",4)(54,"p",5),c.EFF(55," Trigger a test error somewhere in your Angular app, for example in your main app component. Once triggered, an error event should be sent on your Sentry application "),c.k0s(),c.j41(56,"button",6),c.bIt("click",function(){return ie.throwTestError()}),c.EFF(57," Throw Test Error "),c.k0s()()()),2&Ve&&(c.R7$(24),c.JRh(ie.getBasicConfigExample()),c.R7$(28),c.Y8G("innerHTML",ie.exampleProviderCode,c.npT))},dependencies:[p.g,e.s,M.Hl,M.$z]})}return Be})();const ye="bootstrapApplication(AppComponent, {\n  providers: [\n    ...provideMonitoring(environment.igo.monitoring),\n\n    // Provide the authentication user monitoring if you want to identify your user (id, fullname, email) in the error logging \n    ...provideAuthUserMonitoring(environment.igo.monitoring)\n  ]\n})\n";var de=r(46443);let ue=(()=>{class Be{http;languageService;constructor(Ie,Ve){this.http=Ie,this.languageService=Ve}callHttp(){this.http.get("https://geoegl.msp.gouv.qc.ca/apis/icherche/info").subscribe(Ve=>{console.log(Ve)})}callHttpError(){this.http.get("404").subscribe(Ve=>{console.log(Ve)})}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(de.Qq),c.rXU(y.gw))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-request"]],standalone:!0,features:[c.aNF],decls:21,vars:0,consts:[["title","Request","subtitle","Core"],["codeFolder","core/core"],[1,"actions-container"],["mat-raised-button","",3,"click"]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"p"),c.EFF(2,"Register http calls in console"),c.k0s(),c.j41(3,"li"),c.EFF(4," Import "),c.j41(5,"code"),c.EFF(6,"IgoLoggingModule"),c.k0s(),c.EFF(7," only if you want register HTTP calls in console "),c.k0s(),c.j41(8,"li"),c.EFF(9," Import "),c.j41(10,"code"),c.EFF(11,"IgoErrorModule"),c.k0s(),c.EFF(12," only if you want register errors from HTTP calls in console "),c.k0s(),c.j41(13,"li"),c.EFF(14,"Import modules only once"),c.k0s(),c.j41(15,"app-example-viewer",1)(16,"div",2)(17,"button",3),c.bIt("click",function(){return ie.callHttp()}),c.EFF(18,"Log"),c.k0s(),c.j41(19,"button",3),c.bIt("click",function(){return ie.callHttpError()}),c.EFF(20,"Error"),c.k0s()()()())},dependencies:[p.g,e.s,M.Hl,M.$z]})}return Be})();var ce=r(85060),re=r(15944),be=r(25175),_e=r(68671);function Le(Be,rt){if(1&Be&&(c.j41(0,"mat-option",6),c.EFF(1),c.k0s()),2&Be){const Ie=rt.$implicit;c.Y8G("value",Ie.value),c.R7$(),c.SpI(" ",Ie.title," ")}}const Xe=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Activity",path:"activity",component:o},{title:"Config",path:"config",component:v},{title:"Language",path:"language",component:k},{title:"Media",path:"media",component:D},{title:"Message",path:"message",component:X},{title:"Monitoring",path:"monitoring",component:ae},{title:"Request",path:"request",component:ue},{title:"Themes",path:"theme",component:(()=>{class Be{languageService;renderer;isDark;themes=[{value:"blue",title:"Blue"},{value:"bluedark",title:"Blue-dark"},{value:"bluedq",title:"Donn\xe9es Qu\xe9bec"},{value:"bluegrey",title:"Blue grey"},{value:"dark",title:"Dark"},{value:"deeppurple",title:"Purple"},{value:"indigo",title:"Indigo"},{value:"orange",title:"Orange"},{value:"teal",title:"Teal"}];constructor(Ie,Ve){this.languageService=Ie,this.renderer=Ve}loadTheme(Ie){if("dark-demo-test"===Ie.value)return this.isDark=!0,void this.renderer.addClass(document.body,"dark-theme");this.isDark&&this.renderer.removeClass(document.body,"dark-theme"),(0,_e.EQ)(window.document,Ie.value+"-theme")}static \u0275fac=function(Ve){return new(Ve||Be)(c.rXU(y.gw),c.rXU(c.sFG))};static \u0275cmp=c.VBU({type:Be,selectors:[["app-theme"]],standalone:!0,features:[c.aNF],decls:10,vars:1,consts:[["title","Theme","subtitle","Core"],["codeFolder","core/theme"],[1,"actions-container"],["placeholder","Select a theme",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["value","dark-demo-test"],[3,"value"]],template:function(Ve,ie){1&Ve&&(c.j41(0,"app-doc-viewer",0)(1,"p"),c.EFF(2,"Change the app theme"),c.k0s(),c.j41(3,"app-example-viewer",1)(4,"div",2)(5,"mat-form-field")(6,"mat-select",3),c.bIt("selectionChange",function($e){return ie.loadTheme($e)}),c.DNE(7,Le,2,2,"mat-option",4),c.j41(8,"mat-option",5),c.EFF(9," Dark theme "),c.k0s()()()()()()),2&Ve&&(c.R7$(7),c.Y8G("ngForOf",ie.themes))},dependencies:[p.g,e.s,re.RG,re.rl,be.Ve,be.VO,ce.wT,L.pM,ce.Sy]})}return Be})()}]},87674:(De,le,r)=>{"use strict";r.r(le),r.d(le,{routes:()=>_s});var M=r(75300),a=r(62152),F=r(81681),p=r(19032),e=r(49156),c=r(99621),o=r(68559);const L=()=>["ConfigService","LanguageService"];let R=(()=>{class J{layerService;catalogService;storageService;mapService;catalog;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};catalogStore=new M.D_([]);catalogItemStore=new M.D_([]);constructor(m,S,$,oe){this.layerService=m,this.catalogService=S,this.storageService=$,this.mapService=oe}ngOnInit(){this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(m=>this.map.addLayer(m)),this.loadCatalogs(),this.mapService.setMap(this.map),this.catalogStore.stateView.firstBy$(m=>!0===m.state.selected).subscribe(m=>{m&&m.entity&&(this.catalog=m.entity)})}onCatalogSelectChange(m){this.loadCatalogItems(m.catalog)}loadCatalogs(){this.catalogService.loadCatalogs().subscribe(m=>{this.catalogStore.clear(),this.catalogStore.load(m.concat(this.storageService.get("addedCatalogs")||[]))})}loadCatalogItems(m){this.catalogService.loadCatalogItems(m).subscribe(S=>{this.catalogItemStore.clear(),this.catalogItemStore.load(S)})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.BY8),o.rXU(p.HGc),o.rXU(F.n$),o.rXU(p.uk7))};static \u0275cmp=o.VBU({type:J,selectors:[["app-catalog"]],standalone:!0,features:[o.aNF],decls:9,vars:9,consts:[["title","Catalog","subtitle","Geo",3,"dependencies"],["codeFolder","geo/catalog"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Catalog Library"],[3,"catalogSelectChange","store"],["title","Catalog Browser"],[3,"catalog","store","map"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()(),o.j41(5,"igo-panel",5)(6,"igo-catalog-library",6),o.bIt("catalogSelectChange",function(Se){return $.onCatalogSelectChange(Se)}),o.k0s()(),o.j41(7,"igo-panel",7),o.nrm(8,"igo-catalog-browser",8),o.k0s()()()),2&S&&(o.Y8G("dependencies",o.lJ4(8,L)),o.R7$(2),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(2),o.Y8G("store",$.catalogStore),o.R7$(2),o.Y8G("catalog",$.catalog)("store",$.catalogItemStore)("map",$.map))},dependencies:[e.g,c.s,p.KnQ,p.LzH,a.g,p.eTW,p.DiI],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})();var v=r(16488),y=r(30699),b=r(84205);const k=()=>["LanguageService"];let _=(()=>{class J{layerService;mapService;authService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9,geolocate:!1};stopsStore=new p.Zr3([]);stopsFeatureStore=new p.$h6([],{map:this.map});stepFeatureStore=new p.ErE([],{map:this.map});routesFeatureStore=new p.ULV([],{map:this.map});zoomToActiveRoute$=new b.B;authenticated$;constructor(m,S,$){this.layerService=m,this.mapService=S,this.authService=$,this.authenticated$=this.authService.authenticate$,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png",crossOrigin:"anonymous"}}).subscribe(oe=>this.map.addLayer(oe))}static \u0275fac=function(S){return new(S||J)(o.rXU(p.BY8),o.rXU(p.uk7),o.rXU(y.uR))};static \u0275cmp=o.VBU({type:J,selectors:[["app-directions"]],standalone:!0,features:[o.Jv_([(0,p.vQ1)((0,p.FHQ)()),(0,p.yVI)([(0,p.JVX)()])]),o.aNF],decls:15,vars:15,consts:[["title","Directions","subtitle","Geo",3,"dependencies"],["codeFolder","geo/directions"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100",3,"stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$","authenticated$"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.nrm(6,"div",5)(7,"igo-rotation-button",6),o.k0s(),o.j41(8,"div",7),o.nrm(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.k0s()()(),o.j41(12,"mat-grid-tile")(13,"div",10),o.nrm(14,"igo-directions",11),o.k0s()()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(14,k)),o.R7$(4),o.Y8G("map",$.map)("view",$.view),o.R7$(3),o.Y8G("showIfNoRotation",!0)("map",$.map),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("map",$.map),o.R7$(),o.Y8G("map",$.map),o.R7$(3),o.Y8G("stopsStore",$.stopsStore)("stopsFeatureStore",$.stopsFeatureStore)("stepFeatureStore",$.stepFeatureStore)("routesFeatureStore",$.routesFeatureStore)("zoomToActiveRoute$",$.zoomToActiveRoute$)("authenticated$",$.authenticated$))},dependencies:[e.g,c.s,v.Fe,v.B_,v.NS,p.xLv,p.hUG,p.KnQ,p.we_,p.LzH,p.ciq]})}return J})();const D=()=>["LanguageService"];let h=(()=>{class J{dataSourceService;layerService;mapService;map=new p.y6n({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};stores=[];constructor(m,S,$){this.dataSourceService=m,this.layerService=S,this.mapService=$,this.mapService.setMap(this.map),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(oe=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:oe,baseLayer:!0,visible:!0}))})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8),o.rXU(p.uk7))};static \u0275cmp=o.VBU({type:J,selectors:[["app-draw"]],standalone:!0,features:[o.aNF],decls:6,vars:7,consts:[["title","Draw","subtitle","Geo",3,"dependencies"],["codeFolder","geo/draw"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"stores","map"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()(),o.nrm(5,"igo-draw",5),o.k0s()()),2&S&&(o.Y8G("dependencies",o.lJ4(6,D)),o.R7$(2),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("stores",$.stores)("map",$.map))},dependencies:[p.KnQ,p.LzH,p.E6t,e.g,c.s],styles:["[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})(),X=(()=>{class J{dataSourceService;layerService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};tableTemplate={selection:!0,selectMany:!0,sort:!0,columns:[{name:"properties.id",title:"ID"},{name:"properties.name",title:"Name"},{name:"properties.description",title:"Description"}]};store=new p.oEt([],{map:this.map});constructor(m,S){this.dataSourceService=m,this.layerService=S}ngOnInit(){const m=new p.n6d({});this.store.addStrategy(m);const S=new p.ZA3({map:this.map,motion:p.BlV.Default});this.store.addStrategy(S),this.store.load([{meta:{id:1},type:"Feature",geometry:{type:"Point",coordinates:[-72,47.8]},projection:"EPSG:4326",properties:{id:1,name:"Name 1",description:"Description 1"}},{meta:{id:4},type:"Feature",geometry:{type:"Point",coordinates:[-71,46.8]},projection:"EPSG:4326",properties:{id:4,name:"Name 4",description:"Description 4"}},{meta:{id:5},type:"Feature",geometry:{type:"Point",coordinates:[-73,45.8]},projection:"EPSG:4326",properties:{id:5,name:"Name 5",description:"Description 5"}},{meta:{id:2},type:"Feature",geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]},projection:"EPSG:4326",properties:{id:2,name:"Name 2",description:"Description 2"}},{meta:{id:3},type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]},projection:"EPSG:4326",properties:{id:3,name:"Name 3",description:"Description 3"}}]),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:$}))}),this.dataSourceService.createAsyncDataSource({type:"vector"}).subscribe($=>{const oe=this.layerService.createLayer({title:"Vector Layer",source:$,animation:{duration:2e3},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-feature.json",source:"source_nameX"}}});this.map.addLayer(oe),this.store.bindLayer(oe),m.activate(),S.activate()})}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-feature"]],standalone:!0,features:[o.aNF],decls:6,vars:5,consts:[["title","Feature","subtitle","Geo"],["codeFolder","geo/feature"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","template"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()(),o.nrm(5,"igo-entity-table",5),o.k0s()()),2&S&&(o.R7$(2),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("store",$.store)("template",$.tableTemplate))},dependencies:[e.g,c.s,p.KnQ,p.LzH,M.f7],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();var H=r(60316),x=r(34456),ee=r(84175),Z=r(36250),G=r(29814),U=r(1963),N=r(18194),W=r(61099),A=r(75797);function g(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-form",7),o.nI1(1,"async"),o.bIt("submitForm",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onSubmit($))}),o.nrm(2,"igo-form-group",8),o.j41(3,"div",9)(4,"button",10),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.fillForm())}),o.EFF(5," Fill Form "),o.k0s(),o.j41(6,"button",10),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.clearForm())}),o.EFF(7," Clear Form "),o.k0s(),o.j41(8,"button",11),o.EFF(9," Submit "),o.k0s()()()}if(2&J){const m=V.ngIf,S=o.XpG();o.Y8G("form",m)("formData",o.bMT(1,4,S.data$)),o.R7$(2),o.Y8G("group",m.groups[0]),o.R7$(6),o.Y8G("disabled",S.submitDisabled)}}let u=(()=>{class J{formService;dataSourceService;layerService;map=new p.y6n({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:15};form$=new A.t(void 0);data$=new A.t(void 0);submitDisabled=!0;valueChanges$$;constructor(m,S,$){this.formService=m,this.dataSourceService=S,this.layerService=$}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(oe=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:oe,baseLayer:!0,visible:!0}))});const S=[{name:"geometry",title:"Geometry",options:{validator:x.k0.required},type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!0,drawGuide:50,drawGuidePlaceholder:"Draw Guide",drawStyle:new G.Ay({stroke:new U.A({color:[255,0,0,1],width:2}),fill:new N.A({color:[255,0,0,.2]}),image:new W.A({radius:8,stroke:new U.A({color:[255,0,0,1]}),fill:new N.A({color:[255,0,0,.2]})})})}},{name:"name",title:"Name",options:{validator:x.k0.required}}].map(oe=>this.formService.field(oe)),$=this.formService.form([],[this.formService.group({name:"info"},S)]);this.valueChanges$$=$.control.valueChanges.subscribe(()=>{this.submitDisabled=!$.control.valid}),this.form$.next($)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({name:"Place",geometry:JSON.stringify({type:"Polygon",coordinates:[[[-106,42],[-107,31],[-81,32],[-82,42],[-106,42]]]})})}clearForm(){this.form$.value.control.reset()}onSubmit(m){alert(JSON.stringify(m))}static \u0275fac=function(S){return new(S||J)(o.rXU(Z.ux),o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-geometry"]],standalone:!0,features:[o.aNF],decls:8,vars:6,consts:[["title","Geometry Form","subtitle","Geo"],["codeFolder","geo/geometry"],[1,"container"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"form","formData","submitForm",4,"ngIf"],[3,"submitForm","form","formData"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"div",2)(3,"igo-map-browser",3)(4,"div",4),o.nrm(5,"igo-zoom-button",5),o.k0s()(),o.DNE(6,g,10,6,"igo-form",6),o.nI1(7,"async"),o.k0s()()()),2&S&&(o.R7$(3),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("ngIf",o.bMT(7,4,$.form$)))},dependencies:[e.g,c.s,p.KnQ,p.LzH,H.bT,Z.s2,Z.h4,ee.Hl,ee.$z,H.Jj],styles:["[_nghost-%COMP%]   pre[_ngcontent-%COMP%], [_nghost-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace,monospace}[_nghost-%COMP%]   pre[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{flex:1;height:500px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;gap:16px}"]})}return J})();var O=r(55050),j=r(97927),P=r(90697),Y=r(95047),w=r(42449),I=r(72789),E=r(13361);const s=()=>["LanguageService"];let z=(()=>{class J{dataSourceService;layerService;mediaService;pointerCoordDelay=0;pointerHoverFeatureDelay=0;map=new p.y6n({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:8,projection:"EPSG:3857"};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(m,S,$){this.dataSourceService=m,this.layerService=S,this.mediaService=$,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png"}}).subscribe(Se=>this.map.addLayer(Se)),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{featureTypes:"MSP_CASERNE_PUBLIC",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"Casernes",visible:!0,source:Se,igoStyle:{styleByAttribute:{attribute:"en_caserne",data:["true","false"],stroke:["red","blue"],fill:["#ffffff","#ffffff"],radius:[7,7],width:[2,2]},hoverStyle:{label:{attribute:"Caserne: ${no_caserne}\xa0\nMun: ${nom_ssi}",style:{textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:20,offsetY:10,padding:[2.5,2.5,2.5,2.5]}},baseStyle:{circle:{stroke:{color:"orange",width:5},radius:15}}}}}))})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8),o.rXU(O.u1))};static \u0275cmp=o.VBU({type:J,selectors:[["app-hover"]],standalone:!0,features:[o.aNF],decls:10,vars:11,consts:[["title","Hover","subtitle","Geo",3,"dependencies"],["codeFolder","geo/hover"],["igoHoverFeature","",3,"map","view","igoHoverFeatureDelay","igoHoverFeatureEnabled"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"div",4)(5,"igo-rotation-button",5),o.k0s(),o.j41(6,"div",6),o.nrm(7,"igo-home-extent-button",7)(8,"igo-geolocate-button",7)(9,"igo-zoom-button",8),o.k0s()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(10,s)),o.R7$(2),o.Y8G("map",$.map)("view",$.view)("igoHoverFeatureDelay",$.pointerHoverFeatureDelay)("igoHoverFeatureEnabled",!0),o.R7$(3),o.Y8G("showIfNoRotation",!0)("map",$.map),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("map",$.map),o.R7$(),o.Y8G("map",$.map))},dependencies:[e.g,c.s,p.Qlh,j.x,P.h,Y._,w.K,I.w,E.L],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:500px}"]})}return J})();var Q=r(53994);const ae=()=>["LanguageService"];let ye=(()=>{class J{layerService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9};store=new Q.Du([]);constructor(m){this.layerService=m,this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(S=>this.map.addLayer(S))}static \u0275fac=function(S){return new(S||J)(o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-import-export"]],standalone:!0,features:[o.aNF],decls:10,vars:7,consts:[["title","Import / Export","subtitle","Geo",3,"dependencies"],["codeFolder","geo/import-export"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],[1,"w-100",3,"store","map"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.nrm(6,"igo-zoom-button",5),o.k0s()()(),o.j41(7,"mat-grid-tile")(8,"div",6),o.nrm(9,"igo-import-export",7),o.k0s()()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(6,ae)),o.R7$(4),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(3),o.Y8G("store",$.store)("map",$.map))},dependencies:[e.g,c.s,v.Fe,v.B_,v.NS,p.KnQ,p.LzH,p.poF]})}return J})();const de=()=>["LanguageService"];function ue(J,V){if(1&J&&o.nrm(0,"igo-metadata-button",10)(1,"igo-download-button",10)(2,"igo-ogc-filter-button",11)(3,"igo-time-filter-button",11)(4,"igo-track-feature-button",12),2&J){const m=V.layer;o.Y8G("layer",m),o.R7$(),o.Y8G("layer",m),o.R7$(),o.Y8G("header",!0)("layer",m),o.R7$(),o.Y8G("header",!0)("layer",m),o.R7$(),o.Y8G("layer",m)("trackFeature",!0)}}let ce=(()=>{class J{dataSourceService;layerService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],maxLayerZoomExtent:[-11e6,45e5,-45e5,1e7],zoom:7};constructor(m,S){this.dataSourceService=m,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:Se}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson",srsName:"EPSG:32198",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!1,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"12072"}},formatOptions:{dataProjection:"EPSG:32198"}}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (Custom EPSG)",visible:!0,source:Se,removable:!1}))}),this.layerService.createAsyncLayer({title:"Parcs routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"parc_routier",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"Direction du vent",visible:!1,legendOptions:{stylesAvailable:[{name:"WDIR6-LINEAR",title:"WDIR6-LINEAR"},{name:"WDIR6",title:"WDIR6"},{name:"WDIR3-LINEAR",title:"WDIR3-LINEAR"},{name:"WDIR3",title:"WDIR3"}]},sourceOptions:{type:"wms",url:"https://geo.weather.gc.ca/geomet?lang=fr",params:{LAYERS:"HRDPS.CONTINENTAL_WD",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"District \xe9cologique",visible:!1,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.layerService.createAsyncLayer({title:"Avertissements routiers",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(Se=>this.map.addLayer(Se)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(Se=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:Se,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-layer"]],standalone:!0,features:[o.aNF],decls:13,vars:10,consts:[["igoLayerItemToolbar",""],["title","Layer","subtitle","Geo",3,"dependencies"],["codeFolder","geo/layer"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"map","layers","expandLegendOfVisibleLayers","queryBadge","excludeBaseLayers"],[3,"layer"],[3,"header","layer"],[3,"layer","trackFeature"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",1)(1,"app-example-viewer",2)(2,"mat-grid-list",3)(3,"mat-grid-tile")(4,"igo-map-browser",4)(5,"div",5),o.nrm(6,"igo-zoom-button",6),o.k0s()()(),o.j41(7,"mat-grid-tile")(8,"div",7)(9,"igo-panel",8)(10,"igo-layer-list",9),o.DNE(11,ue,5,8,"ng-template",null,0,o.C5r),o.k0s()()()()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(9,de)),o.R7$(4),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(4),o.Y8G("map",$.map)("layers",$.map.layers)("expandLegendOfVisibleLayers",!1)("queryBadge",!0)("excludeBaseLayers",!0))},dependencies:[e.g,c.s,v.Fe,v.B_,v.NS,p.KnQ,p.LzH,a.g,p.Lnt,p.jFp,p.LU,p.S6C,p.tsz,p.rBO]})}return J})();const re=()=>["LanguageService"];let be=(()=>{class J{dataSourceService;layerService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(m,S){this.dataSourceService=m,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(oe=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:oe}))}),this.layerService.createAsyncLayer({title:"Legend with display: false",legendOptions:{display:!1},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(oe=>this.map.addLayer(oe)),this.layerService.createAsyncLayer({title:"Legend with html param",legendOptions:{html:'<h2 style="background-color: blue;">HTML legend</h2>'},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_sreg_eco",VERSION:"1.3.0"}}}).subscribe(oe=>this.map.addLayer(oe)),this.layerService.createAsyncLayer({title:"Legend with url param",legendOptions:{url:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEhUQEBISFRUVFRAQFRUQFRUVFRAPFRUWFhUVFRUYHSggGBolGxUVITEiJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGy0dHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAACAQMEBQYAB//EADwQAAIBAwEGAwYFAgUEAwAAAAECAAMEESEFEjFBUWETInEGFDKBkaFCscHR8FJyFSNTYoIzQ5LxFqLh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJREBAQACAgEFAAEFAAAAAAAAAAECERIhAwQTMUFRYRQiI3Gh/9oADAMBAAIRAxEAPwB0QhAEMTFQhCEEQhACEIQRFEYEIQgiEIAU6IIsAWLEnQAp0KmBqSdFBY+g5D1OBGD4nxYBHQafQzLPzTDLVbYeHLObh2LARwwyD+4PQiFNJZZuMrLLqlnRJ0ZFiTp0A6KEOM4OITuF8q4L8ydVp9sc2+0atrlw/hVGLBw2MnO66gsMdBpjHeYZeoxmXGOjH0+Vx5UsSLEm7ndEM6IYAhgmEYJgCGCYRgmIBMEwjAJgAmAYRgkwAGjTxxjGniBipGo5UjcAthCEAGEIwMQhAEIGAHFEERcxgYiiBmEDADzFgAxcwA50HMXMANh5H/tA+rrJhXy8JDXJDAcSpx6jB/SE18u6uuhGnqeU4vPP8m7+PR9N34tT9V20FZD4ifMcmHSSra5V1DKdD9Qeh7yLd1d4HAOJm7W9q27NlWKE55cOozzleLLTPz4b7bPM7MrbXbC1AFRQGb4d84OemP17Rk7YYsUREJUn8XxhfjI7gzp5xyXGrjMj3l5uYVfjYeX/AGrzb15D5mRau0N0Bt3e3uAVhoO56ympms1Z6lTtgaaDHAdgBiZZ+Tc1G3i8fe60FsN0AZ1iLUzXpDTRifqpHGVh2ioGMP8AIQtm3G9WUdmbX+04nNw3Y7+Wsb/peRJ0Qz0HkOMQzokQcTBM4xCYBxgGKTBJgCEwTFJgEwBCYBMUmCTABaMvHGMacxGZeNw3jUCWwMIGNAwgYwdBhAxoGEDAHAYQMbBigwBzMIGNAwgYA4DFzGwYWYwPMXMbzCBgD1PjxxylRUuEpv4J0PDXPx9BLNDrI17bMtd2PmVgrNngHwNdZzeeTqur02dm4RquAWK4A111yOxme2tXZicaAcuZGf3/ADl7UrFtRwA68x69jM/eVGffZcBkyxA0bdAGZHjna/Jl0pKdJmuFUN8A3ufyA+UGz3jVABIOWBOez5z05fWSrxs0qV2g1DbrY/pJAx35H6yMoxWDjhq2Ou8Dp/5GdDmBYsy7yF87rnGpx/NZfWd4yrg65JGeJHM6SjpjcthUK+apUI7glifyMnUKhV9zPH4vpjT7yMpteF0tL6qwAK6j0zr6x72YY1HLlQNwNnHMnQfrIyVAujHThx0lt7MhQKqjj5W/46iRjO42zyvG6XGYhMSJmdLjdmITOJgkwBSYJMQmITAOJgkziYJMA4mATOJgEwDiYBM4mATAOYxpzCJjTGIG3MbzFcwMwCzBhAxpQekPdPSPVLcOAwgYzgxd6GjPAwsxkNFDQB7MUNGhnpDCGPVLcOAxQY3unpFzA9nQYoMaBhAxBO2bS3qijvk+g1kXbFVqlY0qWAB56jHn0EnbPfw1ZzngeExu3L2qRu0iVNVtWGclQPyyZz+T+7LTfx9Y7XdfaNvRQh2ydFAXBJY6AADhrjjMlW2jRSqCyVFLb2vlO8uobKjQj9oT2lMUmpHILbp8TGSHU6b2OIzIVwtVt1moFmUEK9IhlI7a9esMJB5Ll9L1dnqLUCk29TJJ05KSfuAT9BK/w/PpodBwGdOGny9NInsrfstSpQq+UMDuqdd0jj+hkg4Fbf5Zzj7Qm5bKq9yWHLq1QUEeqd1UffAxx5LpzPDSU9G/pl2dKTnd0YlgCfly4R72huHqV6dKjhgi4wdBvEfY6SOthUGfFZKYbG8KZLVHA5Y5SsZNdoz3vpate0agXdyuQG3X4gH85P8AZ2p4dfdfmCgP+08P0lNcW3jDK090IMIc6jHAd47sWuxanv8AEFR8wZOuul7beoMEiBmFVyTnrGjmdHbmKTBJiZnYgCExCYpWAYg4mAWiEwC0AItAJiFoBaAKTAJiFoJMA5jGnMJjG2gDTmDmKwMHBhomsFsI4trLJLaP07aepxjjtqmNn2jbWA6TRi1gNbCK4Y0TLJnvch0hrZdpc+COkcShJ4YnyyVVOzjwtO0tVoiOCkJWoXalNnANl2l74U4UIaxPtRe59oq2faXvgTnTAJ0+gkZSKm2M9pK2F8NSQeOnT9pQJbFqbVq9ZRpujGm4O2ect/amoynLZ3dfh00PUzMW9AK2uMH4S3mHbAPOeLbvderJrUO+IHXcRqjqOBekx9QGUg4+RjKW1VGyhK9cAjP/ABM0lihGFqPT64Ua/wD1kza9gXVGViMHOFpv59eBMmZ96O4xjaNBxVNTdw7ndXPEA8TIj3JBPE68wdZtKeyvGTB31ZSSrqGTB5EZOT85namyqu97rk+Lx8TAx4e98Weu7p1zNMcti46VtrSZnFRR5hkH04D6ayStlU1YAknJydSPU/WaB9jigoCbxYnLMys28Txzidsy2KKcsxzyKFQO2WzFzK4M8XXIR9/e0KsWA83TdXQQrOo6VlBXy7+8OfHiJZ7QsS2rboA1UhRnI4a6SHswO9dd4g6jkVOnYiPG7icpp6LTtwVB7RDajpBt78DRvvH/AH1ZvPPYxvilR/dlne7iSPGUwHdYf1U/C9j+TDWwgGzzHGrATkuR1mmPqML8xN8GU+Ki1LDtGv8ADzLujWUyQKAM6Zhhe3PblOmaNlBNjNT7oOkZqW4j9vEuVZr3CC1oJoDbxipZw4Q+VULUBGzb9polsIZsBF7cHJmPdD0ie5zTe4RPcu0qeKJudaJbacaMaW9ne9TH3m3tnRTMUWxMKjWllQIMfvUe3FctnFNsZdLTE40BF7lPhFL7tE92ls9CR3oGL3aOEREoR8W8NaZEdEPdo4REa2kPaFLdQky33pA2yM0mHaTl5bqqmE2yF8ErJgg4xxI4ntnjMc9N0yppgINTUYjyjkWc8PQYlvR2luVGSrndUgZ6k8FH3k7aNrTqqoqaLxWmuSSepxr+vpPPn8uxmLFwrb9Niyg6u5O4D0A+Jzrw9Jq7C/p1BuFjjucHeHHOD3GnLnrpMnteg4ICEBVyCyjSmnMKvXlnnnAwDqxb3wUhcYxhDg5wF1K/fB6lm7StS9lu/bf+5Mo8gU548vrxMpG2NW8fxd8cMbpXQjP1kKx2zcAZVsjjg8DrJr+0tXnTXPDOsXU+D+Vi1uxH+YFUDnnOR+kp9pbVpou4nDUZ46+n8/SQ7zaNWpjeY45gcBKa+vV1GBk/U6/nz/8AcJjunbqHql+w1NUlTwHEHtrofQiFb3qrh38nJQOHqU5fKV1FN3LvjH9J4N0P84QqVJqzg/g7jgOhmmmdu2pvr1t1cZ1Gc/hP04SGu2WQ7rR2nWVk3AVwowN7OCZn9s13yKemBqMYixm+itaVdtA8DJ9ttANznm4uWXnLSy2lgZzDLx/gmbZ3lbTIMrqN6d7GZWU9rqeJkb3vLgrFMP1VybaxdidJorJmHGUGwwzAEiX7XAAwY/H5ssPhOfjmS0R1Mbq0hK1nIGQY5bXe8NTOvH1Eyc98OkoUYnu8RLgR9amZtM2dxAtvOahJIEBjK5xPFEqUwJBeprJt3UAEzdzdeY6zPLzaOePbcps9e0L/AA4dJW09o1BxWSKe1+oM5OUdXE89liAodYX+KrOF6hj5wcTyXhHGODaYkZipgG3Uw5jinC/U84a3APOVhsl6wDa9GMXKjiuBVWGMGUPgVOTSXRFQcY5kNLTwRIm0LfyH0MEXbDiI1dbSBUiPotMNtawR8OOKZO7nAL/zny5a6jF3l/cU3L587ZHDRKY00HLJ4dh3mr2lvhjVpkFMtvr1A79ZE8ajcDBAD8xzHQZ+k5rdNpNswdsOiDxBlm1HLGuhx24/MSDUuVxvU9NBkdcgZ/naX+1dj7zDGCNEHYAfw/OUd7sKoDoDz4fQSsbiLMg0L9eRZTofLwJ5nEsVvSQMEHn007zPvs6qOXI4wOcdt7e4A3TqOGvDMu4xPKrK8r1GGE0zrK0lE1Ygtr9ZEqUq+8QoYZ5dPST9mbHz56p0HIx6khbtqRs62asByAz5Tkj+cZZ3VZKaGjTxvt9usgXF+f8Ap0RjGBnkO8C2UJlmbLccnv0zJ190966iws3VFwQGxqe31lZcMu8TjGekds7nVmYZz5cc4l5bEciM8MjEufKag3FvkZWQDvLLClX3TumSXtlaVtOlNTZidJodhW53gWjFCgqydZVSGzIzvS8Me29s75KaY5yBd7Wzw+0qQ5PGMuxBnJa6pjFqu1anDlJFLaeBrKRq2kAVsysUZRa0/aDdfBOk0uydso/AzynajkHIh7P2g9MhgSJ1Y7nbmuq9sN0McZWXe1FHEiZq22m1ZNG+kS22O1U5ZjD3h7azvdrKRoZlbi5JYnM1dD2YTmWPzjh2BRGm4PpJ7vdPUnw0NGgx+IYhtbCW7UpFqWy88iGhtULa68ZKS1XtHfcFJyHM6tZNyePUG3NZ9DGXsao+FozVsq/4XEVLW6/1F+kWv4Dmo3A6GMV2uRwUH5yZv3K8d0wm2qy/HSPy1ho0K2vao+ND8pY09rrzBHqIFLbFBtOB7x2rbpUGVIilB9b6mw4iQ7w02U4xwMYr7PbGglXWsXXJ1Eq5CRQ1qLGk3hnO4xGP9szW6lQgklH+IngSM66GW3+IFC6qMgtu4P4uWgme2xc+bygZGpI7Hh9dJGrs9xOb3mm3HfGOXEAc+8JNsgndIKnkCMcOEpBt5kwTjQa4568B9oR21Tc+dRoQo7aZOvpF7d+4rnPqr1LpSQB3PXGRgfpGGZs4ABGn01IP86SppIh1QkajTPLOknWTMjEE59f6c4+uknjpUy2kJqx0Hy5aZlZtO6GoB04a8AeklOzZYKJQ3jK2jNjtLwxRlkb97J8qDA4EnnOe4Pwrr8v3nF6IGCfl1hU95x/lKFX+o8Zqz2KgAmrnXiB0mh9/NWhlk0XTMzFeg40G8x68pK2O1Viafhs2RoADmFn2UokUE4IkqpSKiC9AqcEFSDqDxEnOuV1itVIrLepvHEuLeljUyBQoYOZNNWZZ1rhE4NOqtI9N51SpMuDbloDVI2z44Rlt5jhQT/aM/lJFLZF2w0oVPmMfnNJGWWSDdJvSFd6LiXjez17/AKLfMr+8hXexrofFRf5YP5TWVjew+z+0igmq2f7UAYXHGU+xvZhviqndHTnLC62Va6qr+YDkRmZZZY29LmOWu24ttpBlGCIFVWJ4mZT2c2dVQ5Z/T0mqLGLnvo+Om4DwWAPKMLCDTfbLTmtUPLEaOzRyJj2/6wg8Ogrq+yHPwuZCqbGuR8NQ/OX+8YYc9fyhqBl22Rd/6sae0vV/Eh9QZqKtZxwUn+3EHxcjJRvprFYcrJVEqf8AdoBu6a/Yxmnof8moyH+ipn9ZsPBzqAV9RKu+2dVbiiOv0Mjirki2ntCVIS4XHLe5H5y2uHpumQRqJm721qoMeE7pzUgkj+085SJfvRPlLGm3JshkPTBi3Z8nqX4RtpWtKmlR6jYPiNu4x5RMlV2Z4qnwgxUebI54zgA8M/vNPV2OtxVFWuc0qYyFzoWJzrJVrWp1AapA8FDu00XgzD8Rx3hy0VxYil7NVCm8FJAIAAGdSAePPlIdXZaqPMCOJJweWh/Oenrf1ar+HTUIAN9ieRI8oA689eEZuEWoDSuAjZ47vlA7b2fN8oTy/o4fjzZaCqcjTHCPVr8annqPUHj+8l7Z2HUouSgLodQVGcfIcJR1mA0PPryM11Kjek6zqkNkNnXnKe8phqrdznEstnWdWq2KSlsfTHrNLsj2URH8W4IJ4hAeJ7mFymI1az+yNg75B0A5F8y7q0UoEK64HBWOCra6AGLta7u97IUIg0AQ4wO3IwrfaAqLuVNQ2hBBAJ7f0kdpF3e1TU6NeDSqkKh3W6/hbtkcD2jaq1u281XXBwFVgQegbGD9Yxf7JqU8VKJ38fhPxYGvz/PSS6hS5okjRlBOD8SkcQecc/4VDWvKdUZyS3VskyOwPIymt3K1N09cazTWNMtooLHoNZVx0UyRKNJzyku12RVqHyAn0ms2T7Lu2GqkAdBrNTQtqNEYAGn84CRdLlrIbO9i3YDxHx2XUy+tfY61p6shc/7tf/yWr7RxooP/AIn8sSK+0UY+YVVPZTg/XSLo7s74NOmMU6aL6LGffQ3lzg+kYN1RByXYf8WB9eOPtHqN5bVPxjPDJGDJCsudpVkbcYadeokG6vqg83FTx04TV07ZOJdHXln9JL8OnjAVT2wBCSj4YY12chcZzoMSds72NtUqeNVyznXU6D5cJqVorn/poMcMYMSuBzXP7R446K3Y1taOBhRpwkKvbrn4BCNUE+Rs9uYjqk8xH0O04Oen3hmQaVxHQ8pKauOs7HeRd4wlJ6wCSSP/AFBL9MxsRcmAPo/Uzt8dzGgIYWMONbtAas3yhPpIdZzHsaSTV7/eMXNJXGHVWHRgD+cbWqOAEcCdY52FTfbCouhRVZAcE+G3T1z9pSXexqlNadOnh0Vt473kxrkZHMCbMiRquDpJuMPahegtOmFGMsxZyPxdsyjvL2lTfKrvMRrnXHp0mpvLEOMA4lDtL2WqMd5GGnUcfpMbhdtJlNKOl7TVN4gBR2lXdWdC8rA1PIx0O7oGMXbOzqlFt90I5EjUGVlglZ6quadUIuSCqnX7TTDH7ic7GztLBLVXRMKgAJJ1Zmmd2rdMy75JGuF5GOUPfXfd3SygkgucEjlkTrzYl61QOyAqOQPOTwvLsTKadTu2NMipwA4HnGNneEy7yjUHjnOnTEtP/itzVQhmCZ+ZxFs/YitSXcVxgnU45RzHorlNoV9cimA3MlcfvHqQtCQ7O9NyDnChlIP9XD85p7T2ctwAKi75HNjmHfez1vU0A3ca+XT6yuPSeW2HX2cUtvU7iiykg+clGHyOn3m02PbW9BQDUTqSGBLH5cpW3fskRqnm7DQ/aV52Qy6MHHqTC205I2F17UUlG7SBbvwEz9z7Q12/Hx5KMYjVts4D8DH6mFb7IqbxCocciREfR+32rWHmZyf1k239oXPHQyPU2DXOuAOgzGDs9wQCsCae020rDDYj1SiG1plfRgCJkLi2qLjcU9TLjZVZ9CYocy0sjQdf+zSz/tHGLb+Lzor8s/vJi3MJLnJ0jvRy7O0Cw/CAPU/vHDUx3iUzn4sQXccBHpBqqik7w0PUfr1jxRzqpGO/WNEQPFxwMVitomHzHkqHrEnQkI5TrmOi4nTpRDW5jouDOnRmIV2jq3ESdFQJ68YJJnToASkLqZFr7S1wonTobBErMRrG3M6dEAKxkynV0nTowi3Qpt8QBi0FpcAonToEbr2VPO9gQhTUjAnTpROWniGyTp0ZK+uwBgb/AEE6dIqofpEwy4X4hn1nToqccbxQMhRH7a7zyAnToYlXVq0ZVA3ETp0mnB1LVcaxilQXOAIk6HxSSjSAEra+8moiTppZuJnRy3vAeJklWXOQZ06R8KO+IesBlnTo7Q//2Q=="},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_reg_eco",VERSION:"1.3.0"}}}).subscribe(oe=>this.map.addLayer(oe)),this.layerService.createAsyncLayer({title:"Commissions scolaires anglophones",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{LAYERS:"WMS_MEQ_CS_ANGLO",VERSION:"1.3.0"}}}).subscribe(oe=>this.map.addLayer(oe)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(oe=>this.map.addLayer(oe)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(oe=>this.map.addLayer(oe)),this.layerService.createAsyncLayer({title:"Avertissements routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(oe=>this.map.addLayer(oe)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(oe=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:oe,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-legend"]],standalone:!0,features:[o.aNF],decls:7,vars:10,consts:[["title","Simple Map with a legend list","subtitle","Geo",3,"dependencies"],["codeFolder","geo/legend"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Legends"],[3,"layers","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()(),o.j41(5,"igo-panel",5),o.nrm(6,"igo-layer-legend-list",6),o.k0s()()()),2&S&&(o.Y8G("dependencies",o.lJ4(9,re)),o.R7$(2),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(2),o.Y8G("layers",$.map.layers)("excludeBaseLayers",!0)("allowShowAllLegends",!0)("updateLegendOnResolutionChange",!1)("showAllLegendsValue",!1))},dependencies:[e.g,c.s,p.KnQ,p.LzH,a.g,p.S3U],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();const _e=()=>["LanguageService"];let Le=(()=>{class J{dataSourceService;layerService;map=new p.y6n({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};store=new p.oEt([],{map:this.map});constructor(m,S){this.dataSourceService=m,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-measure"]],standalone:!0,features:[o.aNF],decls:6,vars:7,consts:[["title","Measure","subtitle","Geo",3,"dependencies"],["codeFolder","geo/measure"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","map"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()(),o.nrm(5,"igo-measurer",5),o.k0s()()),2&S&&(o.Y8G("dependencies",o.lJ4(6,_e)),o.R7$(2),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("store",$.store)("map",$.map))},dependencies:[e.g,c.s,p.KnQ,p.LzH,p.w4o],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-measurer[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]})}return J})();const We=()=>["LanguageService"];let Xe=(()=>{class J{dataSourceService;layerService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(m,S){this.dataSourceService=m,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:xt,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"code_municipalite",alias:"# de la municipalit\xe9e"},{name:"date_observation",excludeFromOgcFilters:!0},{name:"urgence",values:["imm\xe9diate","inconnue"]}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.sQD.All,filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"},{operator:"Intersects",geometryName:"the_geom",wkt_geometry:"MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))"}]}}}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (PropertyIsEqualTo OR Intersects polygon)",source:xt,style:new G.Ay({image:new W.A({radius:5,fill:new N.A({color:"white"}),stroke:new U.A({color:"orange",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.sQD.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-21T00:00:00-05:00",end:"2016-01-26T00:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-10T00:00:00-05:00",stepDate:"P2D"}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P2D)",id:"1",source:xt,style:new G.Ay({image:new W.A({radius:5,fill:new N.A({color:"white"}),stroke:new U.A({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.sQD.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.sQD.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T04:00:00-05:00",end:"2016-01-12T16:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-14T20:00:00-05:00",stepDate:"PT4H"}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: PT4H)",id:"2",source:xt,style:new G.Ay({image:new W.A({radius:5,fill:new N.A({color:"white"}),stroke:new U.A({color:"blue",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.sQD.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.sQD.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T00:00:00-05:00",end:"2016-03-31T00:00:00-05:00",displayFormat:"MMMM"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2018-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1M)",id:"3",source:xt,style:new G.Ay({image:new W.A({radius:5,fill:new N.A({color:"white"}),stroke:new U.A({color:"yellow",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.sQD.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.sQD.All,filters:{operator:"During",propertyName:"date_observation",begin:"2014-01-01T00:00:00-05:00",end:"2019-12-31T00:00:00-05:00",displayFormat:"YYYY"}},minDate:"2014-01-01T00:00:00-05:00",maxDate:"2019-12-31T00:00:00-05:00",stepDate:"P1Y"}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1Y)",id:"4",source:xt,style:new G.Ay({image:new W.A({radius:5,fill:new N.A({color:"white"}),stroke:new U.A({color:"green",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.sQD.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.sQD.All,filters:{operator:"During",propertyName:"date_observation",begin:"today - 2 days",end:"today"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1D"}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Interval from Now, Step: P1D)",id:"5",source:xt,style:new G.Ay({image:new W.A({radius:5,fill:new N.A({color:"white"}),stroke:new U.A({color:"black",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.sQD.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:p.sQD.All,filters:{operator:"During",propertyName:"date_observation",begin:"2019-01-01 00:00:00",restrictToStep:!0}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, RestrictToStep, Step: P1M)",id:"6",source:xt,style:new G.Ay({image:new W.A({radius:5,fill:new N.A({color:"black"}),stroke:new U.A({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",optionsFromCapabilities:!1,params:{LAYERS:"vg_observation_v_autre_wmst",VERSION:"1.3.0"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:p.sQD.Time}],ogcFilters:{enabled:!0,editable:!0,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01 00:00:00",end:"2020-01-01 00:00:00"},allowedOperatorsType:p.sQD.Time}}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Inondations (During)",source:xt}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",urlWfs:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"radars_photos",VERSION:"1.3.0"},ogcFilters:{enabled:!0,editable:!0,pushButtons:{selectorType:"pushButton",order:2,groups:[{title:"Nom du group1 - push",name:"1 - push",ids:["id1"]}],bundles:[{id:"id1",title:"R\xe9gions",logical:"Or",vertical:!0,selectors:[{title:"Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Laval"}]}},{title:"Outside Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"And",filters:[{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Laval"}]}}]}]},checkboxes:{selectorType:"checkbox",order:1,groups:[{title:"Nom du group1 - checkbox",name:"1 - checkbox",ids:["id1"]}],bundles:[{id:"id1",title:"Type de radar photo",logical:"Or",selectors:[{title:"Radar photo fixe",enabled:!0,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe"}},{title:"Radar photo mobile",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo mobile"}},{title:"Radar photo fixe + feu rouge",enabled:!1,color:"0,200,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe et surveillance au feu rouge"}},{title:"Radar feu rouge",enabled:!1,color:"255,0,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Appareil de surveillance au feu rouge"}}]}]},allowedOperatorsType:p.sQD.Basic},paramsWFS:{featureTypes:"radars_photos",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"1.1.0",outputFormat:"geojson",outputFormatDownload:"shp"}}).subscribe(xt=>{this.map.addLayer(this.layerService.createLayer({title:"Filterable WMS layers with predefined filters (push buttons)",source:xt}))})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-ogc-filter"]],standalone:!0,features:[o.aNF],decls:11,vars:7,consts:[["title","Ogc filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/ogc-filter"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],["title","Layers"],[3,"map","layers"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.nrm(6,"igo-zoom-button",5),o.k0s()()(),o.j41(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.nrm(10,"igo-ogc-filterable-list",8),o.k0s()()()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(6,We)),o.R7$(4),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(4),o.Y8G("map",$.map)("layers",$.map.layers))},dependencies:[e.g,c.s,v.Fe,v.B_,v.NS,p.KnQ,p.LzH,a.g,p.JeN]})}return J})(),Be=(()=>{class J{dataSourceService;layerService;map=new p.y6n({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(m,S){this.dataSourceService=m,this.layerService=S}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:m,baseLayer:!0,visible:!0}))})}ngAfterViewInit(){this.map.overlay.setFeatures([{type:p.RI9,projection:"EPSG:4326",meta:{id:1},properties:{},geometry:{type:"Point",coordinates:[-73,46.6]}},{type:p.RI9,projection:"EPSG:4326",meta:{id:2},properties:{},geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]}},{type:p.RI9,projection:"EPSG:4326",meta:{id:3},properties:{},geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]}}],p.BlV.None)}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-overlay"]],standalone:!0,features:[o.aNF],decls:5,vars:3,consts:[["title","Overlay","subtitle","Geo"],["codeFolder","geo/overlay"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()()()()),2&S&&(o.R7$(2),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map))},dependencies:[e.g,c.s,p.KnQ,p.LzH],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})();const rt=()=>["LanguageService"];let Ie=(()=>{class J{layerService;map=new p.y6n({controls:{attribution:{collapsed:!1}}});view={center:[-73,47.2],zoom:9};constructor(m){this.layerService=m,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png",crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S)),this.layerService.createAsyncLayer({title:"Emb\xe2cles",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S)),this.layerService.createAsyncLayer({title:"Radar m\xe9t\xe9o",sourceOptions:{type:"wms",url:"https://geo.meteo.gc.ca/geomet?lang=fr",params:{LAYERS:"RADAR_1KM_RRAI",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S)),this.layerService.createAsyncLayer({title:"A\xe9roports",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq?",params:{layers:"aeroport",version:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S))}static \u0275fac=function(S){return new(S||J)(o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-print"]],standalone:!0,features:[o.aNF],decls:14,vars:10,consts:[["title","Print","subtitle","Geo",3,"dependencies"],["codeFolder","geo/print"],["cols","2","rowHeight","800px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[3,"map"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.nrm(6,"div",5)(7,"igo-rotation-button",6),o.k0s(),o.j41(8,"div",7),o.nrm(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.k0s()()(),o.j41(12,"mat-grid-tile"),o.nrm(13,"igo-print",10),o.k0s()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(9,rt)),o.R7$(4),o.Y8G("map",$.map)("view",$.view),o.R7$(3),o.Y8G("showIfNoRotation",!0)("map",$.map),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("map",$.map),o.R7$(),o.Y8G("map",$.map),o.R7$(2),o.Y8G("map",$.map))},dependencies:[e.g,c.s,v.Fe,v.B_,v.NS,p.xLv,p.hUG,p.KnQ,p.we_,p.LzH,p.NDo],styles:["[_nghost-%COMP%]   igo-print[_ngcontent-%COMP%]{overflow-y:auto;width:100%;height:100%}"]})}return J})();var Ve=r(94691),ie=r(76983),he=r(49964),$e=r(93812),Ae=r(63886),Qe=r(65988);const Ge=()=>[];function at(J,V){if(1&J&&(o.j41(0,"div")(1,"h1"),o.EFF(2," Query Title : "),o.j41(3,"span",8),o.EFF(4),o.k0s()(),o.nrm(5,"igo-feature-details",9),o.k0s()),2&J){const m=V.$implicit,S=o.XpG(2);o.R7$(4),o.JRh(S.getTitle(m)),o.R7$(),o.Y8G("feature",m)}}function Oe(J,V){if(1&J&&(o.qex(0),o.DNE(1,at,6,2,"div",7),o.bVm()),2&J){const m=V.ngIf;o.R7$(),o.Y8G("ngForOf",m)}}let Ye=(()=>{class J{dataSourceService;layerService;features$=new A.t([]);map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(m,S){this.dataSourceService=m,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS",source:$}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryFormat:p.gvR.HTMLGML2,queryHtmlTarget:p.DGK.IFRAME,params:{layers:"aeroport",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS html with a pre call in GML",source:$}))}),this.layerService.createAsyncLayer({title:"WMS with different query url",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",queryable:!0,queryFormat:p.gvR.HTMLGML2,queryHtmlTarget:p.DGK.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1,params:{layers:"SDA_MUNIC_S_20K",version:"1.3.0"}}}).subscribe($=>this.map.addLayer($)),this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0,sourceFields:[{name:"name",alias:"Alias name"},{name:"description",alias:"Alias description"}]}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"Vector layer",source:$})),this.addFeatures($)}),this.layerService.createAsyncLayer({title:"Vector tile with different query url",sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0,queryFormat:p.gvR.HTMLGML2,queryHtmlTarget:p.DGK.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe($=>this.map.addLayer($))}addFeatures(m){const S=new Ve.A({name:"feature1",geometry:new ie.A([Ae.pd([-72,47.8],"EPSG:4326","EPSG:3857"),Ae.pd([-73.5,47.4],"EPSG:4326","EPSG:3857"),Ae.pd([-72.4,48.6],"EPSG:4326","EPSG:3857")])}),$=new Ve.A({name:"feature2",geometry:new he.A(Ae.pd([-73,46.6],"EPSG:4326","EPSG:3857"))}),oe=new Ve.A({name:"feature3",geometry:new $e.Ay([[Ae.pd([-71,46.8],"EPSG:4326","EPSG:3857"),Ae.pd([-73,47],"EPSG:4326","EPSG:3857"),Ae.pd([-71.2,46.6],"EPSG:4326","EPSG:3857")]])});m.ol.addFeatures([S,$,oe])}handleQueryResults(m){const S=m.features;S.length&&S[0]&&(this.features$.next(S),this.map.queryResultsOverlay.setFeatures(S,p.BlV.None))}getTitle(m){return(0,M.k0)(m)}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-query"]],standalone:!0,features:[o.aNF],decls:8,vars:9,consts:[["title","Query","subtitle","Geo",3,"dependencies"],["codeFolder","geo/query"],["igoOverlay","","igoQuery","",3,"query","map","view","queryFeatures"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Details"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"background-color","#e0e0e0"],[3,"feature"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.bIt("query",function(Se){return $.handleQueryResults(Se)}),o.j41(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()(),o.j41(5,"igo-panel",5),o.DNE(6,Oe,2,1,"ng-container",6),o.nI1(7,"async"),o.k0s()()()),2&S&&(o.Y8G("dependencies",o.lJ4(8,Ge)),o.R7$(2),o.Y8G("map",$.map)("view",$.view)("queryFeatures",!0),o.R7$(2),o.Y8G("map",$.map),o.R7$(2),o.Y8G("ngIf",o.bMT(7,6,$.features$)))},dependencies:[e.g,c.s,p.KnQ,p.LzH,p.KQ4,p.izC,Qe.E,a.g,H.bT,H.pM,p._UF,H.Jj],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();var ze=r(44038),et=r(24398),jt=r(46443),dt=r(93840),to=r(31034),Bt=r(80640),Tt=r(19816),wo=r(417),Mt=r(12545),mo=r(67143),ut=r(21701),Ft=r(59452),Qt=r(90852);const nt=J=>({version:J});function Eo(J,V){if(1&J){const m=o.RV6();o.j41(0,"button",7),o.nI1(1,"translate"),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.openGuide())}),o.j41(2,"span"),o.EFF(3),o.nI1(4,"translate"),o.k0s(),o.j41(5,"mat-icon"),o.EFF(6,"description"),o.k0s()()}if(2&J){const m=o.XpG();o.Y8G("disabled",m.loading)("matTooltip",o.bMT(1,3,"igo.integration.aboutTool.trainingGuideTooltip")),o.R7$(3),o.JRh(o.bMT(4,5,"igo.integration.aboutTool.trainingGuide"))}}function qt(J,V){if(1&J&&(o.j41(0,"button",8),o.nI1(1,"translate"),o.j41(2,"span"),o.EFF(3),o.nI1(4,"translate"),o.k0s(),o.j41(5,"mat-icon"),o.EFF(6,"description"),o.k0s()()),2&J){const m=o.XpG(),S=o.sdS(5);o.Y8G("disabled",m.loading)("matTooltip",o.bMT(1,4,"igo.integration.aboutTool.trainingGuideTooltip"))("matMenuTriggerFor",S),o.R7$(3),o.JRh(o.bMT(4,6,"igo.integration.aboutTool.trainingGuide"))}}function ro(J,V){if(1&J){const m=o.RV6();o.j41(0,"button",9),o.bIt("click",function(){const $=o.eBV(m).$implicit,oe=o.XpG();return o.Njj(oe.openGuide($))}),o.EFF(1),o.k0s()}if(2&J){const m=V.$implicit,S=o.XpG();o.R7$(),o.SpI(" ",S.formatFileName(m)," ")}}function Uo(J,V){if(1&J&&(o.nrm(0,"igo-custom-html",6),o.nI1(1,"translate")),2&J){const m=o.XpG();o.Y8G("html",o.bMT(1,1,m.headerHtml))}}let Do=class aa{configService;auth;http;cdRef;languageService;configOptions;get headerHtml(){return this._headerHtml}set headerHtml(V){this._headerHtml=Array.isArray(V)?V.join("\n"):V}get html(){return this._html}set html(V){this._html=Array.isArray(V)?V.join("\n"):V}_discoverTitleInLocale="IGO";discoverTitleInLocale$=(0,Ft.of)(this._discoverTitleInLocale);get discoverTitleInLocale(){return this._discoverTitleInLocale}set discoverTitleInLocale(V){this._discoverTitleInLocale=V,this.discoverTitleInLocale$=(0,Ft.of)(V)}trainingGuideURLs;effectiveVersion;_html="igo.integration.aboutTool.html";_headerHtml;baseUrlProfil;baseUrlGuide;loading=!1;constructor(V,m,S,$,oe){this.configService=V,this.auth=m,this.http=S,this.cdRef=$,this.languageService=oe,this.headerHtml=this.languageService.translate.instant("igo.integration.aboutTool.headerHtml"),this.configOptions=this.configService.getConfigs();const Se=this.configOptions.version;this.effectiveVersion=Se?.app||Se?.lib||mo.rE.lib,this.baseUrlProfil=this.configOptions.storage?.url,this.baseUrlGuide=this.configOptions.depot?.url+this.configOptions.depot?.guideUrl}ngOnInit(){this.auth.authenticated&&this.configOptions.context?.url?this.http.get(this.baseUrlProfil).subscribe(V=>{this.trainingGuideURLs=V.guides,this.cdRef.detectChanges()}):this.auth.authenticated&&!this.configOptions.context?.url&&this.configOptions.depot?.trainingGuides&&(this.trainingGuideURLs=this.configOptions.depot?.trainingGuides)}openGuide(V){this.loading=!0;const m=V?this.baseUrlGuide+V+"?":this.baseUrlGuide+this.trainingGuideURLs[0]+"?";this.http.get(m,{responseType:"blob"}).subscribe(()=>{this.loading=!1,window.open(m,"_blank"),this.cdRef.detectChanges()})}formatFileName(V){const m=(V=V.split("_").join(" ")).indexOf(".");return V.slice(0,m)}static \u0275fac=function(m){return new(m||aa)(o.rXU(mo.we),o.rXU(y.uR),o.rXU(jt.Qq),o.rXU(o.gRc),o.rXU(ut.gw))};static \u0275cmp=o.VBU({type:aa,selectors:[["igo-about-tool"]],inputs:{headerHtml:"headerHtml",html:"html",discoverTitleInLocale:"discoverTitleInLocale",trainingGuideURLs:"trainingGuideURLs"},standalone:!0,features:[o.aNF],decls:10,vars:11,consts:[["menu","matMenu"],["mat-raised-button","","tourToStart","global","menuIsOpen","true","styleButton","raised",3,"discoverTitleInLocale$"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"click","disabled","matTooltip"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","matMenuTriggerFor"],["mat-menu-item","",3,"click"]],template:function(m,S){1&m&&(o.nrm(0,"p")(1,"igo-interactive-tour",1),o.DNE(2,Eo,7,7,"button",2)(3,qt,7,8,"button",3),o.j41(4,"mat-menu",null,0),o.DNE(6,ro,2,1,"button",4),o.k0s(),o.DNE(7,Uo,2,3,"igo-custom-html",5),o.nrm(8,"igo-custom-html",6),o.nI1(9,"translate")),2&m&&(o.R7$(),o.Y8G("discoverTitleInLocale$",S.discoverTitleInLocale$),o.R7$(),o.Y8G("ngIf",S.auth.authenticated&&S.trainingGuideURLs&&1===S.trainingGuideURLs.length),o.R7$(),o.Y8G("ngIf",S.auth.authenticated&&S.trainingGuideURLs&&S.trainingGuideURLs.length>1),o.R7$(3),o.Y8G("ngForOf",S.trainingGuideURLs),o.R7$(),o.Y8G("ngIf",""!==S.headerHtml),o.R7$(),o.Y8G("html",o.i5U(9,6,S.html,o.eq3(9,nt,S.effectiveVersion))))},dependencies:[wo.IJ,H.bT,ee.Hl,ee.$z,Bt.uc,Bt.oV,dt.m_,dt.An,to.Cn,to.kk,to.fb,to.Cp,H.pM,Tt.gE,ut.Ck,Qt.D9],styles:["igo-interactive-tour[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:20px}.training-guide-button[_ngcontent-%COMP%]{margin-left:5px;background-color:#1976d2;color:#fff;padding:0 12px}"]})};Do=(0,et.Cg)([(0,Mt.S$)({name:"about",title:"igo.integration.tools.about",icon:"help"}),(0,et.Sn)("design:paramtypes",[mo.we,y.uR,jt.Qq,o.gRc,ut.gw])],Do);var lo=r(19999),co=r(64334);let mt=(()=>{class J{mapService;projectionService;storageService;configService;get showAllLegendsValue(){return this._legendToolShowAll}set showAllLegendsValue(m){this._legendToolShowAll=m}_legendToolShowAll;get map(){return this._map}_map;constructor(m,S,$,oe){this.mapService=m,this.projectionService=S,this.storageService=$,this.configService=oe,this._map=new p.y6n({controls:{scaleLine:!0,attribution:{collapsed:!0}}},this.storageService,this.configService),this.mapService.setMap(this.map)}static \u0275fac=function(S){return new(S||J)(o.KVO(p.uk7),o.KVO(p.vMP),o.KVO(F.n$),o.KVO(mo.we))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Ro=(()=>{class J{get catalogStore(){return this._catalogStore}_catalogStore;catalogItemsStores=new Map;constructor(m){this._catalogStore=new M.D_([]),m.authenticate$.subscribe(()=>{this.clearCatalogItemsStores()})}getCatalogItemsStore(m){return this.catalogItemsStores.get(m.id)}setCatalogItemsStore(m,S){this.catalogItemsStores.set(m.id,S)}clearCatalogItemsStores(){this.catalogItemsStores.clear()}static \u0275fac=function(S){return new(S||J)(o.KVO(y.uR))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function tn(J,V){if(1&J&&o.nrm(0,"igo-catalog-browser",1),2&J){const m=V.ngIf,S=o.XpG();o.Y8G("catalog",S.catalog)("store",m)("map",S.map)("toggleCollapsedGroup",S.toggleCollapsedGroup)}}let Xo=class la{catalogService;catalogState;mapState;authService;catalog;store$=new A.t(void 0);catalog$$;toggleCollapsedGroup=!0;get map(){return this.mapState.map}constructor(V,m,S,$){this.catalogService=V,this.catalogState=m,this.mapState=S,this.authService=$}ngOnInit(){const m=this.catalogState.catalogStore.stateView.firstBy$($=>!0===$.state.selected);this.catalog$$=(0,lo.z)([m,this.authService.authenticate$]).subscribe(([$,oe])=>{this.catalog=$.entity,this.loadCatalogItems(this.catalog)})}ngOnDestroy(){this.catalog$$.unsubscribe()}loadCatalogItems(V){let m=this.catalogState.getCatalogItemsStore(V);void 0===m?(m=new M.D_([]),this.catalogState.setCatalogItemsStore(V,m),this.catalogService.loadCatalogItems(V).pipe((0,co.s)(1)).subscribe(S=>{m.load(S),this.store$.next(m)})):this.store$.next(m)}static \u0275fac=function(m){return new(m||la)(o.rXU(p.HGc),o.rXU(Ro),o.rXU(mt),o.rXU(y.uR))};static \u0275cmp=o.VBU({type:la,selectors:[["igo-catalog-browser-tool"]],inputs:{toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[o.aNF],decls:2,vars:3,consts:[[3,"catalog","store","map","toggleCollapsedGroup",4,"ngIf"],[3,"catalog","store","map","toggleCollapsedGroup"]],template:function(m,S){1&m&&(o.DNE(0,tn,1,4,"igo-catalog-browser",0),o.nI1(1,"async")),2&m&&o.Y8G("ngIf",o.bMT(1,1,S.store$))},dependencies:[H.bT,p.DiI,H.Jj],encapsulation:2,changeDetection:0})};Xo=(0,et.Cg)([(0,Mt.S$)({name:"catalogBrowser",title:"igo.integration.tools.catalog",parent:"catalog"}),(0,et.Sn)("design:paramtypes",[p.HGc,Ro,mt,y.uR])],Xo);var Po=function(J){return J.layer="layer",J.context="context",J}(Po||{}),yo=function(J){return J.import="import",J.export="export",J}(yo||{});let so=(()=>{class J{importExportType$=new A.t(Po.layer);selectedMode$=new A.t(yo.import);exportOptions$=new A.t(void 0);setImportExportType(m){this.importExportType$.next(m)}setMode(m){this.selectedMode$.next(m)}setsExportOptions(m){this.exportOptions$.next(m)}static \u0275fac=function(S){return new(S||J)};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),At=(()=>{class J{toolService;importExportState;get toolbox(){return this.toolService.toolbox}openSidenav$=new A.t(void 0);constructor(m,S){this.toolService=m,this.importExportState=S}toolToActivateFromOptions(m){if(m){if("importExport"===m.tool){let S=this.importExportState.exportOptions$.value;S?(S.layers=m.options.layers,S.featureInMapExtent=m.options.featureInMapExtent):S={layers:m.options.layers,featureInMapExtent:m.options.featureInMapExtent},this.importExportState.setsExportOptions(S),this.importExportState.setMode(yo.export)}this.toolbox.getTool(m.tool)&&(this.toolbox.activateTool(m.tool),this.openSidenav$.next(!0))}}static \u0275fac=function(S){return new(S||J)(o.KVO(Mt.mJ),o.KVO(so))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),$o=class ca{catalogService;catalogState;toolState;storageService;get store(){return this.catalogState.catalogStore}addCatalogAllowed=!1;predefinedCatalogs=[];set selectedCatalogId(V){this.storageService.set("selectedCatalogId",V,F.YM.SESSION)}get currentTool(){return this.toolState.toolbox.getCurrentPreviousToolName()[1]}get lastTool(){return this.toolState.toolbox.getCurrentPreviousToolName()[0]}constructor(V,m,S,$){this.catalogService=V,this.catalogState=m,this.toolState=S,this.storageService=$}ngOnInit(){"catalogBrowser"===this.lastTool&&"catalog"===this.currentTool&&(this.selectedCatalogId=null),0===this.store.count&&this.loadCatalogs()}onCatalogSelectChange(V){!1!==V.selected&&this.toolState.toolbox.activateTool("catalogBrowser")}loadCatalogs(){this.catalogService.loadCatalogs().pipe((0,co.s)(1)).subscribe(V=>{this.store.clear(),this.store.load(V.concat(this.storageService.get("addedCatalogs")||[]))})}static \u0275fac=function(m){return new(m||ca)(o.rXU(p.HGc),o.rXU(Ro),o.rXU(At),o.rXU(F.n$))};static \u0275cmp=o.VBU({type:ca,selectors:[["igo-catalog-library-tool"]],inputs:{addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},standalone:!0,features:[o.aNF],decls:1,vars:3,consts:[[3,"catalogSelectChange","predefinedCatalogs","addCatalogAllowed","store"]],template:function(m,S){1&m&&(o.j41(0,"igo-catalog-library",0),o.bIt("catalogSelectChange",function(oe){return S.onCatalogSelectChange(oe)}),o.k0s()),2&m&&o.Y8G("predefinedCatalogs",S.predefinedCatalogs)("addCatalogAllowed",S.addCatalogAllowed)("store",S.store)},dependencies:[p.eTW],encapsulation:2,changeDetection:0})};$o=(0,et.Cg)([(0,Mt.S$)({name:"catalog",title:"igo.integration.tools.catalog",icon:"library_add"}),(0,et.Sn)("design:paramtypes",[p.HGc,Ro,At,F.n$])],$o);var Ht=r(57132);let Io=class ua{toolState;constructor(V){this.toolState=V}submitSuccessed(){this.toolState.toolbox.activatePreviousTool()}static \u0275fac=function(m){return new(m||ua)(o.rXU(At))};static \u0275cmp=o.VBU({type:ua,selectors:[["igo-context-editor-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:0,consts:[["igoContextEditBinding","",3,"submitSuccessed"]],template:function(m,S){1&m&&(o.j41(0,"igo-context-edit",0),o.bIt("submitSuccessed",function(){return S.submitSuccessed()}),o.k0s())},dependencies:[Ht.vi,Ht.MM],encapsulation:2})};Io=(0,et.Cg)([(0,Mt.S$)({name:"contextEditor",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"}),(0,et.Sn)("design:paramtypes",[At])],Io);let Co=class pa{toolState;mapState;toolToOpenOnContextChange="mapTools";get map(){return this.mapState.map}constructor(V,m){this.toolState=V,this.mapState=m}editContext(){this.toolState.toolbox.activateTool("contextEditor")}managePermissions(){this.toolState.toolbox.activateTool("contextPermissionManager")}static \u0275fac=function(m){return new(m||pa)(o.rXU(At),o.rXU(mt))};static \u0275cmp=o.VBU({type:pa,selectors:[["igo-context-manager-tool"]],inputs:{toolToOpenOnContextChange:"toolToOpenOnContextChange"},standalone:!0,features:[o.aNF],decls:1,vars:1,consts:[["igoContextListBinding","",3,"edit","managePermissions","map"]],template:function(m,S){1&m&&(o.j41(0,"igo-context-list",0),o.bIt("edit",function(){return S.editContext()})("managePermissions",function(){return S.managePermissions()}),o.k0s()),2&m&&o.Y8G("map",S.map)},dependencies:[Ht.RT,Ht.kc],encapsulation:2})};Co=(0,et.Cg)([(0,Mt.S$)({name:"contextManager",title:"igo.integration.tools.contexts",icon:"star"}),(0,et.Sn)("design:paramtypes",[At,mt])],Co);let Lo=class da{static \u0275fac=function(m){return new(m||da)};static \u0275cmp=o.VBU({type:da,selectors:[["igo-context-permission-manager-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:0,consts:[["igoContextPermissionsBinding",""]],template:function(m,S){1&m&&o.nrm(0,"igo-context-permissions",0)},dependencies:[Ht.BJ,Ht.yV],encapsulation:2})};Lo=(0,et.Cg)([(0,Mt.S$)({name:"contextPermissionManager",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"})],Lo);let Ao=(()=>{class J{keyword$=new A.t("");sortAlpha$=new A.t(void 0);onlyVisible$=new A.t(void 0);selectedTab$=new A.t(void 0);setKeyword(m){this.keyword$.next(m)}setSortAlpha(m){this.sortAlpha$.next(m)}setOnlyVisible(m){this.onlyVisible$.next(m)}setSelectedTab(m){this.selectedTab$.next(m)}getLayerListControls(){return{keyword:this.keyword$.value,onlyVisible:this.onlyVisible$.value,sortAlpha:this.sortAlpha$.value}}static \u0275fac=function(S){return new(S||J)};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),ko=class ma{mapState;layerListToolState;get map(){return this.mapState.map}get layerListControls(){return this.layerListToolState.getLayerListControls()}constructor(V,m){this.mapState=V,this.layerListToolState=m}static \u0275fac=function(m){return new(m||ma)(o.rXU(mt),o.rXU(Ao))};static \u0275cmp=o.VBU({type:ma,selectors:[["igo-context-share-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:1,consts:[[3,"map"]],template:function(m,S){1&m&&o.nrm(0,"igo-share-map",0),2&m&&o.Y8G("map",S.map)},dependencies:[Ht.T$],encapsulation:2})};ko=(0,et.Cg)([(0,Mt.S$)({name:"shareMap",title:"igo.integration.tools.shareMap",icon:"share"}),(0,et.Sn)("design:paramtypes",[mt,Ao])],ko);var oo=r(1455);let jo=(()=>{class J{contextService;toolService;toolState;languageService;context$=new A.t(void 0);constructor(m,S,$,oe){this.contextService=m,this.toolService=S,this.toolState=$,this.languageService=oe,this.contextService.context$.subscribe(Se=>{this.onContextChange(Se)}),this.contextService.toolsChanged$.subscribe(Se=>{this.updateTools(Se)})}setContext(m){this.updateTools(m),this.context$.next(m)}updateTools(m){const S=this.toolState.toolbox,$=[];(m.tools||[]).forEach(Se=>{const Ue=this.toolService.getTool(Se.name);if(void 0===Ue)return;const it=Object.assign({},Ue.options||{},Se.options||{}),gt=Object.assign({},Ue,Se,{options:it});$.push(gt)}),$.forEach(Se=>{if(Se.parent){const Ue=$.findIndex(it=>it.name===Se.parent);-1!==Ue&&($[Ue].children=[],$[Ue].children.push(Se.name))}}),S.setTools($),S.setToolbar(m.toolbar||[]),this.contextService.setTools([].concat($)),this.contextService.setToolbar(m.toolbar||[])}onContextChange(m){void 0!==m&&this.setContext(m)}static \u0275fac=function(S){return new(S||J)(o.KVO(Ht.VT),o.KVO(Mt.mJ),o.KVO(At),o.KVO(ut.gw))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Fe=(()=>{class J{mapState;zoomToActiveRoute$=new b.B;stopsStore=new p.Zr3([]);stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounceTime=200;constructor(m){this.mapState=m,this.stopsFeatureStore=new p.$h6([],{map:this.mapState.map}),this.routesFeatureStore=new p.ULV([],{map:this.mapState.map}),this.stepFeatureStore=new p.ErE([],{map:this.mapState.map}),this.mapState.map.ol.once("rendercomplete",()=>{this.stopsFeatureStore.empty$.subscribe(S=>{this.stopsFeatureStore.layer?.options&&(this.stopsFeatureStore.layer.options.showInLayerList=!S)}),this.routesFeatureStore.empty$.subscribe(S=>{this.routesFeatureStore.layer?.options&&(this.routesFeatureStore.layer.options.showInLayerList=!S)})}),this.mapState.map.layers$.subscribe(()=>{this.mapState.map.getLayerById("igo-direction-stops-layer")||(this.stopsStore.deleteMany(this.stopsStore.all()),this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all())),this.mapState.map.getLayerById("igo-direction-route-layer")||this.routesFeatureStore.deleteMany(this.routesFeatureStore.all())})}static \u0275fac=function(S){return new(S||J)(o.KVO(mt))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();var tt=r(49130);let Ce=class ga{directionState;mapState;languageService;messageService;storageService;contextState;authService;currentContextUri;get stopsStore(){return this.directionState.stopsStore}get debounceTime(){return this.directionState.debounceTime}get stopsFeatureStore(){return this.directionState.stopsFeatureStore}get routesFeatureStore(){return this.directionState.routesFeatureStore}get stepFeatureStore(){return this.directionState.stepFeatureStore}get zoomToActiveRoute$(){return this.directionState.zoomToActiveRoute$}get authenticated$(){return this.authService.authenticate$}get map(){return this.mapState.map}constructor(V,m,S,$,oe,Se,Ue){this.directionState=V,this.mapState=m,this.languageService=S,this.messageService=$,this.storageService=oe,this.contextState=Se,this.authService=Ue}ngOnInit(){this.storageService.get("direction.warning.shown")||(this.messageService.info("igo.integration.directions.warning.message","igo.integration.directions.warning.title",{timeOut:2e4}),this.storageService.set("direction.warning.shown",!0,F.YM.SESSION)),this.contextState.context$.subscribe(m=>{this.authService.authenticated||(this.currentContextUri=m.uri)})}static \u0275fac=function(m){return new(m||ga)(o.rXU(Fe),o.rXU(mt),o.rXU(ut.gw),o.rXU(oo.bg),o.rXU(F.n$),o.rXU(jo),o.rXU(y.uR))};static \u0275cmp=o.VBU({type:ga,selectors:[["igo-directions-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:8,consts:[[3,"contextUri","debounce","stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$","authenticated$"]],template:function(m,S){1&m&&o.nrm(0,"igo-directions",0),2&m&&o.Y8G("contextUri",S.currentContextUri)("debounce",S.debounceTime)("stopsStore",S.stopsStore)("stopsFeatureStore",S.stopsFeatureStore)("stepFeatureStore",S.stepFeatureStore)("routesFeatureStore",S.routesFeatureStore)("zoomToActiveRoute$",S.zoomToActiveRoute$)("authenticated$",S.authenticated$)},dependencies:[p.qcC,tt.c],encapsulation:2})};Ce=(0,et.Cg)([(0,Mt.S$)({name:"directions",title:"igo.integration.tools.directions",icon:"directions"}),(0,et.Sn)("design:paramtypes",[Fe,mt,ut.gw,oo.bg,F.n$,jo,y.uR])],Ce);let Re=(()=>{class J{mapState;stores=[];layersID=[];drawControls=[];activeDrawingLayer;constructor(m){this.mapState=m,this.mapState.map.layers$.subscribe(()=>{this.layersID.forEach(S=>{if(!this.mapState.map.getLayerById(S)){let $=this.stores.find(Se=>Se.layer.id===S);$.deleteMany($.all()),this.stores.splice(this.stores.indexOf($,0),1),this.layersID.splice(this.layersID.indexOf(S,0),1);let oe=this.drawControls.findIndex(Se=>Se[0]===S);this.drawControls.splice(oe,1)}})});for(let S of this.stores)S=new p.oEt([],{map:this.mapState.map})}static \u0275fac=function(S){return new(S||J)(o.KVO(mt))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),ct=class ha{drawState;mapState;get stores(){return this.drawState.stores}get map(){return this.mapState.map}get layersID(){return this.drawState.layersID}get drawControls(){return this.drawState.drawControls}set drawControls(V){this.drawState.drawControls=V}get activeDrawingLayer(){return this.drawState.activeDrawingLayer}set activeDrawingLayer(V){this.drawState.activeDrawingLayer=V}addLayersID(V){this.layersID.push(V)}addDrawControls(V){this.drawControls=V}constructor(V,m){this.drawState=V,this.mapState=m}static \u0275fac=function(m){return new(m||ha)(o.rXU(Re),o.rXU(mt))};static \u0275cmp=o.VBU({type:ha,selectors:[["igo-drawing-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:4,consts:[[3,"layersIDEvent","drawControlsEvent","activeLayerChange","stores","map","activeDrawingLayer","drawControls"]],template:function(m,S){1&m&&(o.j41(0,"igo-draw",0),o.bIt("layersIDEvent",function(oe){return S.addLayersID(oe)})("drawControlsEvent",function(oe){return S.addDrawControls(oe)})("activeLayerChange",function(oe){return S.activeDrawingLayer=oe}),o.k0s()),2&m&&o.Y8G("stores",S.stores)("map",S.map)("activeDrawingLayer",S.activeDrawingLayer)("drawControls",S.drawControls)},dependencies:[p.E6t],encapsulation:2,changeDetection:0})};ct=(0,et.Cg)([(0,Mt.S$)({name:"draw",title:"igo.integration.tools.draw",icon:"stylus_note"}),(0,et.Sn)("design:paramtypes",[Re,mt])],ct);var go=r(47172);function oi(J="300ms",V="ease-in-out"){return(0,go.hZ)("toolSlideInOut",[(0,go.wk)("enter",(0,go.iF)({transform:"translateX(100%)"})),(0,go.kY)("void => enter",(0,go.i0)(J+" "+V))])}let hn=class fa{mapState;get map(){return this.mapState.map}get layer(){for(const V of this.map.layers)if(!0===V.options.active)return V}animate="enter";constructor(V){this.mapState=V}static \u0275fac=function(m){return new(m||fa)(o.rXU(mt))};static \u0275cmp=o.VBU({type:fa,selectors:[["igo-active-ogc-filter-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:4,consts:[[3,"map","layer","header"]],template:function(m,S){1&m&&o.nrm(0,"igo-ogc-filterable-item",0),2&m&&o.Y8G("map",S.map)("layer",S.layer)("header",!1)("@toolSlideInOut",S.animate)},dependencies:[p.uMK],encapsulation:2,data:{animation:[oi()]}})};function ni(J="300ms",V="ease-in-out"){return(0,go.hZ)("toolSlideInOut",[(0,go.wk)("enter",(0,go.iF)({transform:"translateX(100%)"})),(0,go.kY)("void => enter",(0,go.i0)(J+" "+V))])}hn=(0,et.Cg)([(0,Mt.S$)({name:"activeOgcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter",parent:"mapTools"}),(0,et.Sn)("design:paramtypes",[mt])],hn);let fn=class _a{mapState;get map(){return this.mapState.map}get layer(){for(const V of this.map.layers)if(!0===V.options.active)return V}animate="enter";constructor(V){this.mapState=V}static \u0275fac=function(m){return new(m||_a)(o.rXU(mt))};static \u0275cmp=o.VBU({type:_a,selectors:[["igo-active-time-filter-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:3,consts:[[3,"layer","header"]],template:function(m,S){1&m&&o.nrm(0,"igo-time-filter-item",0),2&m&&o.Y8G("layer",S.layer)("header",!1)("@toolSlideInOut",S.animate)},dependencies:[p.i8R],encapsulation:2,data:{animation:[ni()]}})};fn=(0,et.Cg)([(0,Mt.S$)({name:"activeTimeFilter",title:"igo.integration.tools.timeFilter",icon:"history",parent:"mapTools"}),(0,et.Sn)("design:paramtypes",[mt])],fn);let Te=class ya{constructor(){}static \u0275fac=function(m){return new(m||ya)};static \u0275cmp=o.VBU({type:ya,selectors:[["igo-ogc-filter-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:0,consts:[["igoOgcFilterableListBinding",""]],template:function(m,S){1&m&&o.nrm(0,"igo-ogc-filterable-list",0)},dependencies:[p.JeN,p.U9N],encapsulation:2})};Te=(0,et.Cg)([(0,Mt.S$)({name:"ogcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter"}),(0,et.Sn)("design:paramtypes",[])],Te);var pe=r(36991),te=r(66586),se=r(57690),ge=r(61873),xe=r(33900),He=r(98764),Gt=(r(84374),r(97489));let Rt=(()=>{class J{igoStorageService;get storageService(){return this.igoStorageService}constructor(m){this.igoStorageService=m}static \u0275fac=function(S){return new(S||J)(o.KVO(F.n$))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();var Jt=r(38158),_n=(r(6530),r(39545)),Rn=r.n(_n),bo=r(70271);function Pn(J,V){J.entityStore.getStrategyOfType(p.ZA3).setMotion(V.get("zoomAuto")?p.BlV.Default:p.BlV.None)}function $n(J,V,m,S,$,oe,Se,Ue,it,gt){const yt=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:$,handler:()=>{Pn(J,Se),Se.set("zoomAuto",!Se.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:(0,p.zHQ)(J),checkCondition:V,handler:()=>V.next(!V.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.tooltip",checkCondition:m,handler:()=>m.next(!m.value)},{id:"clearselection",icon:"deselect",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:It=>{It.entityStore.state.updateMany(It.entityStore.view.all(),{selected:!1})},args:[J],availability:It=>(0,p.Tww)(It)},{id:"featureDownload",icon:"file_save",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:It=>{const xt=It.entityStore.getStrategyOfType(M.fR),Oo=It.entityStore.getStrategyOfType(M.qA).active?[It.layer.id]:[];gt.toolToActivateFromOptions({tool:"importExport",options:{layers:[It.layer.id],featureInMapExtent:xt.active,layersWithSelection:Oo}})},args:[J]},{id:"ogcFilter",icon:"filter_alt",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:(It,xt)=>{xt.activateWidget(It,{map:xt.map,layer:xt.layer})},args:[S,J]},{id:"maximize",title:Ue.translate.instant("igo.integration.workspace.maximize"),tooltip:Ue.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>oe.pipe((0,bo.T)(It=>!It&&!it.isMobile())),handler:()=>{it.isMobile()||oe.next(!0)}},{id:"standardExtent",title:Ue.translate.instant("igo.integration.workspace.standardExtent"),tooltip:Ue.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>oe.pipe((0,bo.T)(It=>It&&!it.isMobile())),handler:()=>{oe.next(!1)}},{id:"print",icon:"print",title:"igo.integration.workspace.print.title",tooltip:"igo.integration.workspace.print.tooltip",handler:It=>{const xt=`${It.layer.title} (${function Ln(J,V){return Rn()(J).format(V)}(new Date,"YYYY-MM-DD-HH_mm")})`,uo=new Jt.default("landscape"),Oo="{total_pages_count_string}";uo.text(xt,14,20),uo.autoTable({startY:25,tableWidth:"wrap",html:"#currentWorkspaceTable",horizontalPageBreak:!0,styles:{cellPadding:.5,minCellWidth:20,fontSize:6},didDrawPage:cn=>{let Yo="Page "+uo.internal.getNumberOfPages();"function"==typeof uo.putTotalPages&&(Yo=Yo+" / "+Oo),uo.setFontSize(6);const Fn=uo.internal.pageSize,mi=Fn.height?Fn.height:Fn.getHeight();uo.text(Yo,cn.settings.margin.left,mi-10)}}),"function"==typeof uo.putTotalPages&&uo.putTotalPages(Oo),uo.save(`${xt}.pdf`)},args:[J]}];let Pt=J.layer.dataSource.options.ogcFilters?.enabled?yt:yt.filter(It=>"ogcFilter"!==It.id);return Pt=!1!==J.layer.options.workspace.printable?yt:yt.filter(It=>"print"!==It.id),Pt}let bi=(()=>{class J{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;zoomAuto$=new A.t(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(m,S,$,oe,Se){this.ogcFilterWidget=m,this.storageState=S,this.languageService=$,this.mediaService=oe,this.toolState=Se,this.maximize$=new A.t(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(m,S,$){const oe=this.buildActions(m,S,$);m.actionStore.load(oe)}buildActions(m,S,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Gt.j)(oe=>"zoomAuto"!==oe?.key||oe?.event===F.yl.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),Pn(m,this.storageService)}),$n(m,S,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(S){return new(S||J)(o.KVO(p.kSP,8),o.KVO(Rt),o.KVO(ut.gw),o.KVO(O.u1),o.KVO(At))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Ci=(()=>{class J{storageState;languageService;toolState;mediaService;maximize$;zoomAuto$=new A.t(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(m,S,$,oe){this.storageState=m,this.languageService=S,this.toolState=$,this.mediaService=oe,this.maximize$=new A.t(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(m,S,$){const oe=this.buildActions(m,S,$);m.actionStore.load(oe)}buildActions(m,S,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Gt.j)(oe=>"zoomAuto"!==oe?.key||oe?.event===F.yl.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),Pn(m,this.storageService)}),$n(m,S,$,void 0,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(S){return new(S||J)(o.KVO(Rt),o.KVO(ut.gw),o.KVO(At),o.KVO(O.u1))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Si=(()=>{class J{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;selectOnlyCheckCondition$=new A.t(!1);zoomAuto$=new A.t(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(m,S,$,oe,Se){this.ogcFilterWidget=m,this.storageState=S,this.languageService=$,this.mediaService=oe,this.toolState=Se,this.maximize$=new A.t(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(m,S,$){const oe=this.buildActions(m,S,$);m.actionStore.load(oe)}buildActions(m,S,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Gt.j)(oe=>"zoomAuto"!==oe?.key||oe?.event===F.yl.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),Pn(m,this.storageService)}),$n(m,S,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(S){return new(S||J)(o.KVO(p.kSP,8),o.KVO(Rt),o.KVO(ut.gw),o.KVO(O.u1),o.KVO(At))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),No=(()=>{class J{featureActionsService;wfsActionsService;editionActionsService;storageService;workspacePanelExpanded=!1;workspaceEnabled$=new A.t(!1);rowsInMapExtentCheckCondition$=new A.t(!0);selectOnlyCheckCondition$=new A.t(!1);workspaceMaximize$;actionMaximize$$=[];rowsInMapExtentCheckCondition$$;selectOnlyCheckCondition$$;activeWorkspace$$;activeWorkspaceWidget$$;activeWorkspaceWidget$=new A.t(void 0);workspace$=new A.t(void 0);get store(){return this._store}_store;get workspaceSelection(){return this.workspace$.value?this.workspace$.value?.entityStore.stateView.manyBy(m=>!0===m.state.selected):[]}get workspaceSelection$(){return this.workspace$.value?this.workspace$.value?.entityStore?.stateView.manyBy$(m=>!0===m.state.selected):(0,Ft.of)([])}constructor(m,S,$,oe){this.featureActionsService=m,this.wfsActionsService=S,this.editionActionsService=$,this.storageService=oe,this.workspaceMaximize$=new A.t(this.storageService.get("workspaceMaximize")),this.initWorkspaces()}initWorkspaces(){this._store=new Q.Du([]),this._store.stateView.firstBy$(m=>!0===m.state.active).subscribe(m=>{this.workspace$.next(m?m.entity:void 0)}),this._store.stateView.all$().subscribe(m=>{m.map(S=>{S.entity.actionStore.empty&&(S.entity instanceof p.KV8?this.wfsActionsService.loadActions(S.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):S.entity instanceof p.ur0?this.featureActionsService.loadActions(S.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):S.entity instanceof p.i9p&&this.editionActionsService.loadActions(S.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$))})}),this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(m=>{this.setWorkspaceIsMaximized(m)})),this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(m=>{this.setWorkspaceIsMaximized(m)})),this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(m=>{this.setWorkspaceIsMaximized(m)})),this.activeWorkspace$$=this.workspace$.subscribe(m=>{void 0!==this.activeWorkspaceWidget$$&&(this.activeWorkspaceWidget$$.unsubscribe(),this.activeWorkspaceWidget$$=void 0),void 0!==m&&(this.activeWorkspaceWidget$$=m.widget$.subscribe(S=>this.activeWorkspaceWidget$.next(S)))}),this.rowsInMapExtentCheckCondition$$=this.rowsInMapExtentCheckCondition$.subscribe(m=>{this._store.stateView.all().map(S=>{if(!S.entity.actionStore.empty){const $=S.entity.entityStore.getStrategyOfType(M.fR);$&&(m?$.activate():$.deactivate())}})}),this.selectOnlyCheckCondition$$=this.selectOnlyCheckCondition$.subscribe(m=>{this._store.stateView.all().map(S=>{if(!S.entity.actionStore.empty){const $=S.entity.entityStore.getStrategyOfType(M.qA);$&&(m?$.activate():$.deactivate())}})})}setWorkspaceIsMaximized(m){this.storageService.set("workspaceMaximize",m),this.workspaceMaximize$.next(m)}setActiveWorkspaceById(m){const S=this.store.all().find($=>$.id===m);S&&this.store.activateWorkspace(S)}setActiveWorkspaceByTitle(m){const S=this.store.all().find($=>$.title===m);S&&this.store.activateWorkspace(S)}ngOnDestroy(){this.teardownWorkspaces(),this.actionMaximize$$.map(m=>m.unsubscribe()),this.rowsInMapExtentCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe(),this.selectOnlyCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe()}teardownWorkspaces(){this.store.clear(),void 0!==this.activeWorkspaceWidget$$&&this.activeWorkspaceWidget$$.unsubscribe(),void 0!==this.activeWorkspace$$&&this.activeWorkspace$$.unsubscribe()}static \u0275fac=function(S){return new(S||J)(o.KVO(Ci),o.KVO(Si),o.KVO(bi),o.KVO(F.n$))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function ii(J,V){if(1&J&&(o.qex(0),o.nrm(1,"igo-feature-details",3),o.bVm()),2&J){const m=V.ngIf;o.R7$(),o.Y8G("feature",m)}}let An=class va{matIconRegistry;spatialFilterService;dataSourceService;layerService;mapState;messageService;languageService;importExportState;toolState;workspaceState;cdRef;get map(){return this.mapState.map}type;itemType=p.KXJ.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new A.t(void 0);format=new te.A;store=new M.D_([]);spatialListStore=new M.D_([]);loading=!1;thematicLength=0;measureUnit=p.$Rc.Meters;unsubscribe$=new b.B;moveendKey;defaultStyle;constructor(V,m,S,$,oe,Se,Ue,it,gt,yt,Pt){this.matIconRegistry=V,this.spatialFilterService=m,this.dataSourceService=S,this.layerService=$,this.mapState=oe,this.messageService=Se,this.languageService=Ue,this.importExportState=it,this.toolState=gt,this.workspaceState=yt,this.cdRef=Pt}ngOnInit(){for(const V of this.map.layers)V.title&&V.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(V)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(V){this.type=V,this.queryType=void 0}getOutputQueryType(V){this.queryType=V,this.queryType&&this.loadFilterList()}activateExportTool(){const V=[],m=new RegExp("^Zone \\d+");for(const S of this.layers)S.title.match(m)||V.push(S.id);this.importExportState.setMode(yo.export),this.importExportState.setsExportOptions({layers:V}),this.toolState.toolbox.activateTool("importExport")}activateWorkspace(V){let m;this.workspaceState.store.entities$.pipe((0,xe.Q)(this.unsubscribe$)).subscribe(()=>{if(!V&&this.activeLayers.length&&this.workspaceState.store.all().length>1){if(this.itemType===p.KXJ.Thematics){for(const S of this.thematics)if(!S.zeroResults){m=this.activeLayers.find($=>$.title.includes(S.name+" "+this.iterator.toString()));break}}else{const S="Adresses "+this.iterator.toString();this.activeLayers.forEach($=>{$.title.includes(S)&&(m=$)})}m&&(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(m.id))}else V&&this.activeLayers.length&&this.workspaceState.store.all().length>1&&(this.selectWorkspaceEntity(V),this.moveendKey=this.map.ol.on("moveend",()=>{this.selectWorkspaceEntity(V)}))})}selectWorkspaceEntity(V){this.workspaceState.store.all().forEach(m=>{m.entityStore.state.updateAll({selected:!1}),m.title.includes(V.added[0].meta.title)&&(this.workspaceState.setActiveWorkspaceById(m.id),m.entityStore.state.updateMany(V.added,{selected:!0}))})}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,xe.Q)(this.unsubscribe$)).subscribe(V=>{V.sort((m,S)=>m.properties.nom<S.properties.nom?-1:m.properties.nom>S.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(V)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===p.R22.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let m,V=!0;(0===this.buffer||this.type===p.R22.Point)&&this.tryAddFeaturesToMap([this.zone]),m=this.itemType!==p.KXJ.Thematics?[{name:""}]:this.thematics,this.measureUnit===p.$Rc.Kilometers&&this.type!==p.R22.Point&&(this.buffer=1e3*this.buffer),this.type===p.R22.Polygon&&(this.buffer=0);const S=[];m.forEach($=>{S.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,$,this.buffer).pipe((0,He.M)(oe=>{this.store.insertMany(oe);const Se=[],Ue=[];let it,gt;oe.forEach(yt=>{"Point"===yt.geometry.type?(yt.properties.longitude=yt.geometry.coordinates[0],yt.properties.latitude=yt.geometry.coordinates[1],Se.push(yt),it=yt.meta.id):(Ue.push(yt),gt=yt.meta.id)}),this.tryAddPointToMap(Se,it),this.tryAddLayerToMap(Ue,gt),oe.length?(V=!1,this.thematicLength+=1,$.zeroResults=!1,this.cdRef.detectChanges()):$.zeroResults=!0,oe.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,ge.p)(S).pipe((0,xe.Q)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,V&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(V,m){this.zone=V,V&&(m?this.tryAddFeaturesToMap([V],!0):this.tryAddFeaturesToMap([V]),this.zoomToFeatureExtent(V))}tryAddFeaturesToMap(V,m){let S=1;for(const $ of V){if(this.type===p.R22.Predefined)for(const oe of this.layers){if(oe.options._internal&&oe.options._internal.code===$.properties.code&&!m){if(!oe.title?.startsWith("Zone")){const Se=this.layers.indexOf(oe);this.layers.splice(Se,1)}return}if(oe.title?.startsWith("Zone")){this.activeLayers=[];const Se=this.layers.indexOf(oe);this.layers.splice(Se,1),this.map.removeLayer(oe)}}else{if(m)for(const oe of this.activeLayers)if(1===this.activeLayers.length&&oe.title?.startsWith("Zone")){const Se=this.layers.indexOf(oe);this.layers.splice(Se,1),this.map.removeLayer(oe)}this.activeLayers=[]}for(const oe of this.layers)oe.title?.startsWith("Zone")&&S++;this.defaultStyle=(oe,Se)=>{const Ue=V[0].coordinates;return new G.Ay({image:new W.A({radius:Ue?this.buffer/Math.cos(Math.PI/180*Ue[1])/Se:void 0,fill:new N.A({color:"rgba(200, 200, 20, 0.2)"}),stroke:new U.A({width:1,color:"orange"})}),stroke:new U.A({width:1,color:"orange"}),fill:new N.A({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,co.s)(1)).subscribe(oe=>{const Se=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===p.R22.Predefined?$.properties.code:void 0},source:oe,visible:!0}),Ue=V.map(gt=>(0,p.xHV)(gt,this.map.projection));if(this.type!==p.R22.Predefined){const gt=this.type===p.R22.Point?"Cercle":"Polygone";Ue[0].set("nom","Zone",!0),Ue[0].set("type",gt,!0)}oe.ol.addFeatures(Ue),Se.ol.setStyle(this.defaultStyle),this.map.addLayer(Se),this.layers.push(Se),this.activeLayers.push(Se),this.cdRef.detectChanges()})}}tryAddPointToMap(V,m){let S=1;if(V.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(V[0].meta.title)&&S++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:m,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,co.s)(1)).subscribe($=>{const oe=V[0].meta.icon;let Se;Se=oe&&this.createSvgIcon(oe)||(0,p.O5R)();const Ue=this.layerService.createLayer({isIgoInternalLayer:!0,title:V[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0,style:Se}),it=V.map(yt=>(0,p.xHV)(yt,this.map.projection));$.ol.getSource().addFeatures(it),this.layers.find(yt=>yt.id===Ue.id)&&(this.map.removeLayer(this.layers.find(yt=>yt.id===Ue.id)),S-=1,Ue.title=V[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),Ue.options.title=Ue.title),this.iterator=S,this.map.addLayer(Ue),this.layers.push(Ue),this.pushLayer(Ue),this.cdRef.detectChanges()})}}createSvgIcon(V){let m;return this.matIconRegistry.getNamedSvgIcon(V).subscribe(S=>{const $=new XMLSerializer;S.setAttribute("width","30"),S.setAttribute("height","30"),S.setAttribute("fill","rgba(0, 128, 255)"),S.setAttribute("stroke","white");const oe=$.serializeToString(S);m=new G.Ay({image:new se.A({src:"data:image/svg+xml;utf8,"+oe})})}),m}tryAddLayerToMap(V,m){let S=1;if(V.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(V[0].meta.title)&&S++;this.dataSourceService.createAsyncDataSource({type:"vector",id:m,queryable:!0}).pipe((0,co.s)(1)).subscribe($=>{const oe=this.layerService.createLayer({isIgoInternalLayer:!0,title:V[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0}),Se=V.map(it=>(0,p.xHV)(it,this.map.projection));$.ol.addFeatures(Se),this.layers.find(it=>it.id===oe.id)&&(this.map.removeLayer(this.layers.find(it=>it.id===oe.id)),S-=1,oe.title=V[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),oe.options.title=oe.title),this.map.addLayer(oe),this.layers.push(oe),this.pushLayer(oe),this.cdRef.detectChanges()})}}zoomToFeatureExtent(V){if(V){const m=this.format.readFeature(V,{dataProjection:V.projection,featureProjection:this.map.projection});(0,p.p67)(this.map.viewController,[m],p.BlV.Zoom)}}pushLayer(V){for(const m of this.activeLayers)if(m.id===V.id)return;this.activeLayers.push(V)}static \u0275fac=function(m){return new(m||va)(o.rXU(dt.tp),o.rXU(p._We),o.rXU(p.n_V),o.rXU(p.BY8),o.rXU(mt),o.rXU(oo.bg),o.rXU(ut.gw),o.rXU(so),o.rXU(At),o.rXU(No),o.rXU(o.gRc))};static \u0275cmp=o.VBU({type:va,selectors:[["igo-spatial-filter-tool"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.aNF],decls:4,vars:16,consts:[[3,"eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange","store","selectedQueryType","zone","layers"],[3,"radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent","export","openWorkspace","entityChange","type","queryType","map","zone","loading","store","layers","allLayers","thematicLength"],[4,"ngIf"],[3,"feature"]],template:function(m,S){1&m&&(o.j41(0,"igo-spatial-filter-type",0),o.bIt("eventType",function(oe){return S.getOutputType(oe)})("eventQueryType",function(oe){return S.getOutputQueryType(oe)})("zoneChange",function(oe){return S.onZoneChange(oe)})("zoneWithBufferChange",function(oe){return S.onZoneChange(oe,!0)})("bufferChange",function(oe){return S.buffer=oe})("measureUnitChange",function(oe){return S.measureUnit=oe}),o.k0s(),o.j41(1,"igo-spatial-filter-item",1),o.bIt("radiusEvent",function(oe){return S.buffer=oe})("bufferEvent",function(oe){return S.buffer=oe})("measureUnitChange",function(oe){return S.measureUnit=oe})("freehandControl",function(oe){return S.freehandDrawIsActive=oe})("drawZoneEvent",function(oe){return S.zone=oe})("zoneWithBufferChange",function(oe){return S.onZoneChange(oe,!0)})("itemTypeChange",function(oe){return S.itemType=oe})("thematicChange",function(oe){return S.thematics=oe})("toggleSearch",function(){return S.getOutputToggleSearch()})("clearButtonEvent",function(){return S.clearMap()})("clearSearchEvent",function(){return S.getOutputClearSearch()})("export",function(){return S.activateExportTool()})("openWorkspace",function(){return S.activateWorkspace()})("entityChange",function(oe){return S.activateWorkspace(oe)}),o.k0s(),o.DNE(2,ii,2,1,"ng-container",2),o.nI1(3,"async")),2&m&&(o.Y8G("store",S.spatialListStore)("selectedQueryType",S.queryType)("zone",S.zone)("layers",S.activeLayers),o.R7$(),o.Y8G("type",S.type)("queryType",S.queryType)("map",S.map)("zone",S.zone)("loading",S.loading)("store",S.store)("layers",S.activeLayers)("allLayers",S.layers)("thematicLength",S.thematicLength),o.R7$(),o.Y8G("ngIf",o.bMT(3,14,S.selectedFeature$)))},dependencies:[p.Q5v,p.J_O,p._UF,H.bT,H.Jj],styles:["[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]{display:block;padding:0 12px}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:12px;padding:0 12px}"],changeDetection:0})};An=(0,et.Cg)([(0,Mt.S$)({name:"spatialFilter",title:"igo.integration.tools.spatialFilter",icon:pe._}),(0,et.Sn)("design:paramtypes",[dt.tp,p._We,p.n_V,p.BY8,mt,oo.bg,ut.gw,so,At,No,o.gRc])],An);let yn=class ba{constructor(){}static \u0275fac=function(m){return new(m||ba)};static \u0275cmp=o.VBU({type:ba,selectors:[["igo-time-filter-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:0,consts:[["igoTimeFilterListBinding",""]],template:function(m,S){1&m&&o.nrm(0,"igo-time-filter-list",0)},dependencies:[p.TPU,p.qEv],encapsulation:2})};yn=(0,et.Cg)([(0,Mt.S$)({name:"timeFilter",title:"igo.integration.tools.timeFilter",icon:"history"}),(0,et.Sn)("design:paramtypes",[])],yn);var Fo=r(38223);function Ti(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-tab-group")(1,"mat-tab",3),o.nI1(2,"translate"),o.j41(3,"igo-import-export",4),o.nI1(4,"async"),o.nI1(5,"async"),o.bIt("selectMode",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.modeChanged($))})("exportOptionsChange",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.exportOptionsChange($))}),o.k0s()(),o.j41(6,"mat-tab",3),o.nI1(7,"translate"),o.nrm(8,"igo-context-import-export",5),o.k0s()()}if(2&J){const m=o.XpG();o.R7$(),o.Y8G("label",o.bMT(2,10,"igo.integration.importExportTool.importExportData")),o.R7$(2),o.Y8G("contextUri",o.bMT(4,12,m.contextState.context$).uri)("map",m.map)("selectFirstProj",m.selectFirstProj)("projectionsLimitations",m.projectionsLimitations)("store",m.workspaceStore)("selectedMode",o.bMT(5,14,m.importExportState.selectedMode$))("exportOptions$",m.importExportState.exportOptions$),o.R7$(3),o.Y8G("label",o.bMT(7,16,"igo.integration.importExportTool.importExportContext")),o.R7$(2),o.Y8G("map",m.map)}}function Ii(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-import-export",6),o.nI1(1,"async"),o.nI1(2,"async"),o.bIt("selectMode",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.modeChanged($))})("exportOptionsChange",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.exportOptionsChange($))}),o.k0s()}if(2&J){const m=o.XpG();o.Y8G("contextUri",o.bMT(1,5,m.contextState.context$).uri)("map",m.map)("store",m.workspaceStore)("selectedMode",o.bMT(2,7,m.importExportState.selectedMode$))("exportOptions$",m.importExportState.exportOptions$)}}function Fi(J,V){if(1&J&&o.nrm(0,"igo-context-import-export",5),2&J){const m=o.XpG();o.Y8G("map",m.map)}}let Mi=class Ca{mapState;importExportState;workspaceState;contextState;projectionsLimitations;selectFirstProj=!1;get map(){return this.mapState.map}get workspaceStore(){return this.workspaceState.store}importExportType=Po.layer;importExportShowBothType=!0;constructor(V,m,S,$){this.mapState=V,this.importExportState=m,this.workspaceState=S,this.contextState=$}ngOnInit(){this.selectType(),this.selectMode()}selectType(){this.importExportType&&this.importExportState.importExportType$.next(this.importExportType);const V=this.importExportState.importExportType$.value;this.importExportState.setImportExportType(void 0!==V?V:Po.layer)}selectMode(){const V=this.importExportState.selectedMode$.value;this.importExportState.setMode(void 0!==V?V:yo.import)}modeChanged(V){this.importExportState.setMode(V)}exportOptionsChange(V){this.importExportState.setsExportOptions(V)}importExportTypeChange(V){this.importExportType=V.value}static \u0275fac=function(m){return new(m||Ca)(o.rXU(mt),o.rXU(so),o.rXU(No),o.rXU(jo))};static \u0275cmp=o.VBU({type:Ca,selectors:[["igo-import-export-tool"]],inputs:{projectionsLimitations:"projectionsLimitations",selectFirstProj:"selectFirstProj",importExportType:"importExportType",importExportShowBothType:"importExportShowBothType"},standalone:!0,features:[o.aNF],decls:3,vars:3,consts:[[4,"ngIf"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange",4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"selectMode","exportOptionsChange","contextUri","map","selectFirstProj","projectionsLimitations","store","selectedMode","exportOptions$"],[3,"map"],[3,"selectMode","exportOptionsChange","contextUri","map","store","selectedMode","exportOptions$"]],template:function(m,S){1&m&&o.DNE(0,Ti,9,18,"mat-tab-group",0)(1,Ii,3,9,"igo-import-export",1)(2,Fi,1,1,"igo-context-import-export",2),2&m&&(o.Y8G("ngIf",S.importExportShowBothType),o.R7$(),o.Y8G("ngIf",!S.importExportShowBothType&&"layer"===S.importExportType),o.R7$(),o.Y8G("ngIf",!S.importExportShowBothType&&"context"===S.importExportType))},dependencies:[H.bT,Fo.RI,Fo.mq,Fo.T8,p.poF,Ht.g4,H.Jj,ut.Ck,Qt.D9],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})};Mi=(0,et.Cg)([(0,Mt.S$)({name:"importExport",title:"igo.integration.tools.importExport",icon:"file_save"}),(0,et.Sn)("design:paramtypes",[mt,so,No,jo])],Mi);var vn=r(14102),Ho=r(8827),bn=r(85060),Mo=r(15944),nn=r(87984),Cn=r(25175),rn=r(68671),zo=r(52575);function Oi(J,V){if(1&J&&(o.j41(0,"mat-form-field",13)(1,"mat-label"),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.nrm(4,"textarea",14,2),o.nI1(6,"translate"),o.k0s()),2&J){const m=o.XpG();o.R7$(2),o.JRh(o.bMT(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lon")),o.R7$(2),o.Y8G("placeholder",o.bMT(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lon"))("value",m.coordinates[0])}}function wi(J,V){if(1&J&&(o.j41(0,"mat-form-field",13),o.nrm(1,"textarea",14,2),o.nI1(3,"translate"),o.k0s()),2&J){const m=o.XpG();o.R7$(),o.Y8G("placeholder",o.bMT(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.est"))("value",m.coordinates[0])}}function Ei(J,V){if(1&J&&(o.j41(0,"mat-form-field",13)(1,"mat-label"),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.nrm(4,"textarea",14,2),o.nI1(6,"translate"),o.k0s()),2&J){const m=o.XpG();o.R7$(2),o.JRh(o.bMT(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lat")),o.R7$(2),o.Y8G("placeholder",o.bMT(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lat"))("value",m.coordinates[1])}}function Di(J,V){if(1&J&&(o.j41(0,"mat-form-field",13),o.nrm(1,"textarea",14,2),o.nI1(3,"translate"),o.k0s()),2&J){const m=o.XpG();o.R7$(),o.Y8G("placeholder",o.bMT(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.nord"))("value",m.coordinates[1])}}function Ri(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-option",15),o.bIt("click",function($){return o.eBV(m),o.Njj($.stopPropagation())}),o.EFF(1),o.k0s()}if(2&J){const m=V.$implicit;o.Y8G("value",m),o.R7$(),o.SpI(" ",m.translatedValue||m.alias," ")}}let Pi=(()=>{class J{mapState;languageService;messageService;cdRef;storageService;config;formBuilder;formattedScale$=new A.t("");projections$=new A.t([]);form;coordinates;currentCenterDefaultProj;center;inMtmZone=!0;inLambert2={32198:!0,3798:!0};mapState$$;formStatus$$;_projectionsLimitations={};projectionsConstraints;defaultProj;currentZones={utm:void 0,mtm:void 0};units=!0;get map(){return this.mapState.map}get inputProj(){return this.form.get("inputProj").value}set inputProj(m){this.form.patchValue({inputProj:m})}get projectionsLimitations(){return this._projectionsLimitations||{}}set projectionsLimitations(m){this._projectionsLimitations=m}constructor(m,S,$,oe,Se,Ue,it){this.mapState=m,this.languageService=S,this.messageService=$,this.cdRef=oe,this.storageService=Se,this.config=Ue,this.formBuilder=it,this.defaultProj={translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0},this.center=this.storageService.get("centerToggle"),this.computeProjections(),this.buildForm()}ngOnInit(){this.mapState$$=this.map.viewController.state$.pipe((0,zo.B)(50)).subscribe(()=>{this.setScaleValue(this.map),this.updateCoordinates()}),this.formStatus$$=this.form.valueChanges.subscribe(()=>{this.updateCoordinates()});const m=this.storageService.get("currentProjection");if(this.inputProj=this.projections$.value.find(S=>S.code===this.defaultProj.code)??this.projections$.value[0],null!==m){const S=this.positionInList(m);this.inputProj=this.projections$.value[S],this.updateZoneMtmUtm()}this.map.mapCenter$.next(this.center),this.coordinates=this.getCoordinates(),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code)}ngOnDestroy(){this.map.mapCenter$.next(!1),this.mapState$$.unsubscribe(),this.formStatus$$.unsubscribe()}setScaleValue(m){this.formattedScale$.next(": ~ 1 / "+(0,p.A1A)(m.viewController.getScale()))}getCoordinates(){let m;this.currentZones.mtm=(0,p.HhX)(this.currentCenterDefaultProj[0]),this.currentZones.utm=(0,p.FUe)(this.currentCenterDefaultProj[0]);const S=this.inputProj.code;let $=2;return(S.includes("EPSG:4326")||S.includes("EPSG:4269"))&&($=5),this.units="EPSG:4326"===S||"EPSG:4269"===S,m=this.map.viewController.getCenter(S).map(oe=>oe.toFixed($)),m}updateCoordinates(){this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code);const m=(0,p.HhX)(this.currentCenterDefaultProj[0]),S=(0,p.FUe)(this.currentCenterDefaultProj[0]);!this.inMtmZone&&m!==this.currentZones.mtm&&this.back2quebec();let $=!1;m!==this.currentZones.mtm&&(this.currentZones.mtm=m,$=!0),S!==this.currentZones.utm&&(this.currentZones.utm=S,$=!0),$&&this.updateProjectionsZoneChange(),this.checkLambert(this.currentCenterDefaultProj),this.coordinates=this.getCoordinates(),this.storageService.set("currentProjection",this.inputProj,F.YM.SESSION)}copyTextToClipboard(){rn.B0.copy(this.coordinates.toString())&&this.messageService.success("igo.integration.advanced-map-tool.advanced-coordinates.copyMsg","igo.integration.advanced-map-tool.advanced-coordinates.copyTitle")}displayCenter(m){this.center=m,this.map.mapCenter$.next(m),this.storageService.set("centerToggle",m,F.YM.SESSION)}buildForm(){this.form=this.formBuilder.group({inputProj:["",[x.k0.required]]})}updateProjectionsZoneChange(){let m=this.projections$.value;const S=this.languageService.translate;m.map($=>{if("mtm"===$.translateKey){const oe=(0,p.HhX)(this.currentCenterDefaultProj[0]);if(oe){const Se=oe<10?`EPSG:3218${oe}`:`EPSG:321${80+oe}`;$.alias=`MTM ${oe}`,$.code=Se,$.zone=`${oe}`,$.translatedValue=S.instant("igo.geo.importExportForm.projections.mtm",$)}else $.alias="",this.inMtmZone=!1,"mtm"===this.inputProj.translateKey&&(this.inputProj=this.projections$.value[0])}if("utm"===$.translateKey){const oe=(0,p.FUe)(this.currentCenterDefaultProj[0]),Se=`EPSG:326${oe}`;$.alias=`UTM ${oe}`,$.code=Se,$.zone=`${oe}`,$.translatedValue=S.instant("igo.geo.importExportForm.projections.utm",$)}}),m=m.filter($=>""!==$.alias),this.projections$.next(m)}computeProjections(){this.projectionsConstraints=(0,p.A5L)(this.projectionsLimitations);const m=[];this.currentCenterDefaultProj||(this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code));const S=this.languageService.translate;if(this.projectionsConstraints.wgs84&&m.push({translatedValue:S.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.nad83&&m.push({translatedValue:S.instant("igo.geo.importExportForm.projections.nad83",{code:"EPSG:4269"}),translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.webMercator&&m.push({translatedValue:S.instant("igo.geo.importExportForm.projections.webMercator",{code:"EPSG:3857"}),translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.mtm){const oe=(0,p.HhX)(this.currentCenterDefaultProj[0]);if(oe){this.inMtmZone=!0;const Se=oe<10?`EPSG:3218${oe}`:`EPSG:321${80+oe}`;m.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:Se,zone:oe}),translateKey:"mtm",alias:`MTM ${oe}`,code:Se,zone:`${oe}`,def:void 0,extent:void 0})}else this.inMtmZone=!1}if(this.projectionsConstraints.utm){const oe=this.inMtmZone?4:3,Se=(0,p.FUe)(this.currentCenterDefaultProj[0]),Ue=Se<10?`EPSG:3260${Se}`:`EPSG:326${Se}`;m.splice(oe,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:Ue,zone:Se}),translateKey:"utm",alias:`UTM ${Se}`,code:Ue,zone:`${Se}`,def:void 0,extent:void 0})}let $=[];this.projectionsConstraints.projFromConfig&&($=this.config.getConfig("projections")||[]),this.projections$.next($.concat(m))}pushMtm(m){if(this.projectionsConstraints.mtm){const S=(0,p.HhX)(this.currentCenterDefaultProj[0]),$=S<10?`EPSG:3218${S}`:`EPSG:321${80+S}`;m.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:$,zone:S}),translateKey:"mtm",alias:`MTM ${S}`,code:$,zone:`${S}`,def:void 0,extent:void 0})}}back2quebec(){this.pushMtm(this.projections$.value),this.inMtmZone=!0}updateZoneMtmUtm(){if("mtm"===this.inputProj.translateKey){const m=(0,p.HhX)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`MTM ${m}`;const S=m<10?`EPSG:3218${m}`:`EPSG:321${80+m}`;this.inputProj.code=S,this.inputProj.zone=`${m}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:S,zone:m})}if("utm"===this.inputProj.translateKey){const m=(0,p.FUe)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`UTM ${m}`;const S=m<10?`EPSG:3260${m}`:`EPSG:326${m}`;this.inputProj.code=S,this.inputProj.zone=`${m}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:S,zone:m})}}positionInList(m){const S=m.translateKey,$=m.alias;let oe,Se=0;return this.projections$.value.map(Ue=>{S?S===Ue.translateKey&&(oe=Se):$===Ue.alias&&(oe=Se),Se++}),oe=oe||0,oe}checkLambert(m){(this.config.getConfig("projections")||[]).forEach($=>{let oe=this.projections$.value;const Se=$.extent,Ue=$.code.match(/\d+/),it=Ae.DI(Se,$.code,this.defaultProj.code);m[0]<it[0]||m[0]>it[2]||m[1]<it[1]||m[1]>it[3]?(this.inLambert2[Ue]=!1,this.inputProj.alias===$.alias&&(this.inputProj=this.projections$.value[0]),oe=oe.filter(gt=>gt.alias!==$.alias),this.projections$.next(oe)):this.inLambert2[Ue]||(this.projections$.next(oe.concat($)),this.inLambert2[Ue]=!0)})}static \u0275fac=function(S){return new(S||J)(o.rXU(mt),o.rXU(ut.gw),o.rXU(oo.bg),o.rXU(o.gRc),o.rXU(F.n$),o.rXU(mo.we),o.rXU(x.ze))};static \u0275cmp=o.VBU({type:J,selectors:[["igo-advanced-coordinates"]],inputs:{projectionsLimitations:"projectionsLimitations"},standalone:!0,features:[o.aNF],decls:36,vars:37,consts:[["elseBlock",""],["elseBlock2",""],["textArea",""],[1,"advanced-coordinates__coordinates-container"],[1,"advanced-coordinates__coordinates-container__inner"],["subscriptSizing","dynamic",4,"ngIf","ngIfElse"],["mat-icon-button","",1,"igo-form-button-group","advanced-coordinates__copy-coordinates",3,"click"],[1,"igo-form","advanced-coordinates__form",3,"formGroup"],["subscriptSizing","dynamic",1,"igo-input-container"],[3,"valueChange","value"],["matTooltipShowDelay","500",3,"value","click",4,"ngFor","ngForOf"],[1,"center-toggle","mat-typography",3,"change","checked","labelPosition"],[1,"igo-zoom","mat-typography"],["subscriptSizing","dynamic"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["matTooltipShowDelay","500",3,"click","value"]],template:function(S,$){if(1&S){const oe=o.RV6();o.j41(0,"div",3)(1,"div",4),o.DNE(2,Oi,7,7,"mat-form-field",5)(3,wi,4,4,"ng-template",null,0,o.C5r)(5,Ei,7,7,"mat-form-field",5)(6,Di,4,4,"ng-template",null,1,o.C5r),o.j41(8,"button",6),o.nI1(9,"translate"),o.bIt("click",function(){return o.eBV(oe),o.Njj($.copyTextToClipboard())}),o.j41(10,"mat-icon"),o.EFF(11,"content_copy"),o.k0s()()(),o.j41(12,"form",7)(13,"div",4)(14,"mat-form-field",8)(15,"mat-label"),o.EFF(16),o.nI1(17,"translate"),o.k0s(),o.j41(18,"mat-select",9),o.mxI("valueChange",function(Ue){return o.eBV(oe),o.DH7($.inputProj,Ue)||($.inputProj=Ue),o.Njj(Ue)}),o.DNE(19,Ri,2,2,"mat-option",10),o.nI1(20,"async"),o.k0s()()(),o.j41(21,"div",4)(22,"mat-slide-toggle",11),o.bIt("change",function(Ue){return o.eBV(oe),o.Njj($.displayCenter(Ue.checked))}),o.EFF(23),o.nI1(24,"translate"),o.k0s()()(),o.j41(25,"p",12),o.EFF(26),o.nI1(27,"translate"),o.k0s(),o.j41(28,"p",12),o.EFF(29),o.nI1(30,"translate"),o.nI1(31,"async"),o.k0s(),o.j41(32,"p",12),o.EFF(33),o.nI1(34,"translate"),o.nI1(35,"number"),o.k0s()()}if(2&S){const oe=o.sdS(4),Se=o.sdS(7);o.R7$(2),o.Y8G("ngIf",$.units)("ngIfElse",oe),o.R7$(3),o.Y8G("ngIf",$.units)("ngIfElse",Se),o.R7$(3),o.BMQ("aria-label",o.bMT(9,18,"igo.integration.advanced-map-tool.advanced-coordinates.copy")),o.R7$(4),o.Y8G("formGroup",$.form),o.R7$(4),o.JRh(o.bMT(17,20,"igo.integration.advanced-map-tool.advanced-coordinates.coordSystem")),o.R7$(2),o.R50("value",$.inputProj),o.R7$(),o.Y8G("ngForOf",o.bMT(20,22,$.projections$)),o.R7$(3),o.Y8G("checked",$.center)("labelPosition","before"),o.R7$(),o.SpI(" ",o.bMT(24,24,"igo.integration.advanced-map-tool.advanced-coordinates.center")," "),o.R7$(3),o.Lme(" ",o.bMT(27,26,"igo.integration.advanced-map-tool.advanced-coordinates.zoom")," ",$.map.viewController.getZoom()," "),o.R7$(3),o.Lme(" ",o.bMT(30,28,"igo.integration.advanced-map-tool.advanced-coordinates.scale")," ",o.bMT(31,30,$.formattedScale$)," "),o.R7$(4),o.Lme(" ",o.bMT(34,32,"igo.integration.advanced-map-tool.advanced-coordinates.resolution")," ",o.i5U(35,34,$.map.viewController.getResolution(),"1.0-0")," ")}},dependencies:[H.bT,Mo.RG,Mo.rl,Mo.nJ,nn.fS,nn.fg,ee.Hl,ee.iY,dt.m_,dt.An,x.YN,x.qT,x.cb,x.X1,x.j4,Cn.Ve,Cn.VO,bn.wT,H.pM,bn.Sy,Ho.mV,Ho.sG,H.Jj,H.QX,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]{padding:12px 0}textarea[_ngcontent-%COMP%]{resize:none}.advanced-coordinates__coordinates-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;padding:12px 0}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:first-child), .advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:first-child){margin-left:8px}.advanced-coordinates__form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}"]})}return J})();var Kt=r(20943);function $i(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-option",6),o.bIt("click",function(){o.eBV(m),o.XpG();const $=o.sdS(8),oe=o.XpG();return o.Njj(oe.applyNewLayers($))}),o.EFF(1),o.k0s()}if(2&J){const m=V.$implicit;o.Y8G("value",m),o.R7$(),o.JRh(m.title)}}function Li(J,V){if(1&J){const m=o.RV6();o.j41(0,"div",3)(1,"form",4)(2,"mat-form-field")(3,"mat-label"),o.EFF(4),o.nI1(5,"translate"),o.k0s(),o.j41(6,"mat-select",5)(7,"mat-option",6,1),o.bIt("click",function(){o.eBV(m);const $=o.sdS(8),oe=o.XpG();return o.Njj(oe.selectAll($))}),o.EFF(9),o.nI1(10,"translate"),o.k0s(),o.nrm(11,"mat-divider"),o.DNE(12,$i,2,2,"mat-option",7),o.k0s()(),o.j41(13,"mat-slide-toggle",8),o.bIt("change",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.startSwipe($.checked))}),o.EFF(14),o.nI1(15,"translate"),o.k0s()()()}if(2&J){const m=o.XpG();o.R7$(),o.Y8G("formGroup",m.form),o.R7$(3),o.JRh(o.bMT(5,8,"igo.integration.advanced-map-tool.advanced-swipe.swipe-select")),o.R7$(3),o.Y8G("value",1),o.R7$(2),o.SpI(" ",o.bMT(10,10,"igo.integration.advanced-map-tool.advanced-swipe.selectAll")," "),o.R7$(3),o.Y8G("ngForOf",m.userControlledLayerList),o.R7$(),o.Y8G("checked",m.swipe)("labelPosition","before"),o.R7$(),o.SpI(" ",o.bMT(15,12,"igo.integration.advanced-map-tool.advanced-swipe.swipe")," ")}}function Ai(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list")(1,"p",9),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.j41(4,"p",9),o.EFF(5),o.nI1(6,"translate"),o.k0s(),o.j41(7,"mat-list-item")(8,"mat-icon",10),o.EFF(9,"search"),o.k0s(),o.j41(10,"span",11),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.searchEmit())}),o.EFF(11),o.nI1(12,"translate"),o.k0s()(),o.j41(13,"mat-list-item")(14,"mat-icon",10),o.EFF(15,"library_add"),o.k0s(),o.j41(16,"span",12),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.catalogEmit())}),o.EFF(17),o.nI1(18,"translate"),o.k0s()(),o.j41(19,"mat-list-item")(20,"mat-icon",10),o.EFF(21,"star"),o.k0s(),o.j41(22,"span",13),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.contextEmit())}),o.EFF(23),o.nI1(24,"translate"),o.k0s()()()}2&J&&(o.R7$(2),o.SpI(" ",o.bMT(3,5,"igo.integration.advanced-map-tool.advanced-swipe.empty")," "),o.R7$(3),o.SpI(" ",o.bMT(6,7,"igo.integration.advanced-map-tool.advanced-swipe.customize")," "),o.R7$(6),o.SpI(" ",o.bMT(12,9,"igo.integration.advanced-map-tool.advanced-swipe.search-tool")," "),o.R7$(6),o.SpI(" ",o.bMT(18,11,"igo.integration.advanced-map-tool.advanced-swipe.catalog-tool")," "),o.R7$(6),o.SpI(" ",o.bMT(24,13,"igo.integration.advanced-map-tool.advanced-swipe.context-tool")," "))}let ki=(()=>{class J{mapState;contextService;formBuilder;toolState;swipe=!1;layerList;userControlledLayerList;form;layers;res;listForSwipe;get map(){return this.mapState.map}constructor(m,S,$,oe){this.mapState=m,this.contextService=S,this.formBuilder=$,this.toolState=oe,this.buildForm()}ngOnInit(){this.map.layers$.subscribe(m=>this.userControlledLayerList=m.filter(S=>!S.baseLayer&&S.showInLayerList&&S.displayed))}ngOnDestroy(){this.swipe=!1,this.map.swipeEnabled$.next(this.swipe)}buildForm(){this.form=this.formBuilder.group({layers:["",[x.k0.required]]})}startSwipe(m){this.swipe=m,this.map.swipeEnabled$.next(m),this.listForSwipe=[];for(const S of this.form.value.layers)this.listForSwipe.push(S);this.map.selectedFeatures$.next(this.listForSwipe)}applyNewLayers(m){this.startSwipe(!1),this.startSwipe(!0),m._selected&&(m._selected=!1),this.form.controls.layers.value.length===this.userControlledLayerList.length&&(m._selected=!0)}selectAll(m){m._selected?(this.form.controls.layers.setValue(this.userControlledLayerList),m._selected=!0):this.form.controls.layers.setValue([]),this.startSwipe(!1),this.startSwipe(!0)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(S){return new(S||J)(o.rXU(mt),o.rXU(Ht.VT),o.rXU(x.ze),o.rXU(At))};static \u0275cmp=o.VBU({type:J,selectors:[["igo-advanced-swipe"]],standalone:!0,features:[o.aNF],decls:3,vars:2,consts:[["noLayersBlock",""],["e",""],["class","igo-swipe-select-container",4,"ngIf","ngIfElse"],[1,"igo-swipe-select-container"],[1,"igo-form",3,"formGroup"],["formControlName","layers","multiple",""],[3,"click","value"],[3,"value","click",4,"ngFor","ngForOf"],[1,"swipe-toggle","mat-typography",3,"change","checked","labelPosition"],[1,"map-empty","mat-typography"],["matListItemIcon",""],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(S,$){if(1&S&&o.DNE(0,Li,16,14,"div",2)(1,Ai,25,15,"ng-template",null,0,o.C5r),2&S){const oe=o.sdS(2);o.Y8G("ngIf",$.userControlledLayerList.length)("ngIfElse",oe)}},dependencies:[H.bT,x.YN,x.qT,x.BC,x.cb,x.X1,x.j4,x.JD,Mo.RG,Mo.rl,Mo.nJ,Cn.Ve,Cn.VO,bn.wT,bn.Sy,vn.w,vn.q,H.pM,Ho.mV,Ho.sG,Kt.Fg,Kt.jt,Kt.YE,Kt.ZV,Kt.yE,dt.m_,dt.An,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:4px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{padding:12px 0;text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   .advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}"]})}return J})(),kn=class Sa{mapState;get tracking$(){return this.mapState.map.geolocationController.tracking$}get followPosition$(){return this.mapState.map.geolocationController.followPosition$}constructor(V){this.mapState=V}toggleTracking(V){this.mapState.map.geolocationController.tracking=V}toggleFollow(V){this.mapState.map.geolocationController.followPosition=V}static \u0275fac=function(m){return new(m||Sa)(o.rXU(mt))};static \u0275cmp=o.VBU({type:Sa,selectors:[["igo-advanced-map-tool"]],standalone:!0,features:[o.aNF],decls:24,vars:26,consts:[[1,"nameOfTool"],[1,"advanced-tool-line"],[1,"igo-input-container"],[1,"geolocation-slide-toggle-container"],[1,"geolocation-option",3,"change","checked","labelPosition"],[1,"geolocation-option",3,"change","disabled","labelPosition","checked"]],template:function(m,S){1&m&&(o.j41(0,"h4",0),o.EFF(1),o.nI1(2,"translate"),o.k0s(),o.nrm(3,"igo-advanced-swipe")(4,"mat-divider",1),o.j41(5,"h4",0),o.EFF(6),o.nI1(7,"translate"),o.k0s(),o.nrm(8,"igo-advanced-coordinates")(9,"mat-divider",1),o.j41(10,"h4",0),o.EFF(11),o.nI1(12,"translate"),o.k0s(),o.j41(13,"div",2)(14,"div",3)(15,"mat-slide-toggle",4),o.nI1(16,"async"),o.bIt("change",function(oe){return S.toggleTracking(oe.checked)}),o.EFF(17),o.nI1(18,"translate"),o.k0s(),o.j41(19,"mat-slide-toggle",5),o.nI1(20,"async"),o.nI1(21,"async"),o.bIt("change",function(oe){return S.toggleFollow(oe.checked)}),o.EFF(22),o.nI1(23,"translate"),o.k0s()()()),2&m&&(o.R7$(),o.SpI(" ",o.bMT(2,10,"igo.integration.advanced-map-tool.advanced-swipe.swipe-tool"),"\n"),o.R7$(5),o.SpI(" ",o.bMT(7,12,"igo.integration.advanced-map-tool.advanced-coordinates.coordinates"),"\n"),o.R7$(5),o.SpI(" ",o.bMT(12,14,"igo.integration.advanced-map-tool.geolocation.title"),"\n"),o.R7$(4),o.Y8G("checked",o.bMT(16,16,S.tracking$))("labelPosition","before"),o.R7$(2),o.SpI(" ",o.bMT(18,18,"igo.integration.advanced-map-tool.geolocation.tracking")," "),o.R7$(2),o.Y8G("disabled",!0!==o.bMT(20,20,S.tracking$))("labelPosition","before")("checked",o.bMT(21,22,S.followPosition$)),o.R7$(3),o.SpI(" ",o.bMT(23,24,"igo.integration.advanced-map-tool.geolocation.follow")," "))},dependencies:[ki,vn.w,vn.q,Pi,Ho.mV,Ho.sG,H.Jj,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]{display:block;padding:0 16px 12px}.nameOfTool[_ngcontent-%COMP%]{text-align:center;font-weight:700;font-size:small;margin:12px 0 8px}.advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}.geolocation-slide-toggle-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px 0}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}mat-divider[_ngcontent-%COMP%]{margin:0 -16px}"]})};function ri(J,V){if(1&J){const m=o.RV6();o.j41(0,"button",1),o.nI1(1,"translate"),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.activateWorkspace())}),o.j41(2,"mat-icon"),o.EFF(3,"table"),o.k0s()()}if(2&J){const m=o.XpG();o.Y8G("matTooltip",o.bMT(1,2,"igo.integration.workspace.toggleWorkspace"))("color",m.color)}}kn=(0,et.Cg)([(0,Mt.S$)({name:"advancedMap",title:"igo.integration.tools.advancedMap",icon:"home_repair_service"}),(0,et.Sn)("design:paramtypes",[mt])],kn);let sn=(()=>{class J{workspaceState;hasWorkspace$=new A.t(!1);hasWorkspace$$;_layer;layer$=new A.t(void 0);set layer(m){this._layer=m,this.layer$.next(this._layer)}get layer(){return this._layer}color="primary";constructor(m){this.workspaceState=m}ngOnInit(){this.hasWorkspace$$=(0,lo.z)([this.workspaceState.workspaceEnabled$,this.layer$]).subscribe(m=>this.hasWorkspace$.next(m[0]&&m[1]?.options.workspace?.enabled))}ngOnDestroy(){this.hasWorkspace$$.unsubscribe()}activateWorkspace(){this.workspaceState.workspace$.value&&this.workspaceState.workspace$.value.layer.id===this.layer.id&&this.workspaceState.workspacePanelExpanded?this.workspaceState.workspacePanelExpanded=!1:(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(this.layer.id))}static \u0275fac=function(S){return new(S||J)(o.rXU(No))};static \u0275cmp=o.VBU({type:J,selectors:[["igo-workspace-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[o.aNF],decls:2,vars:3,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","color"]],template:function(S,$){1&S&&(o.DNE(0,ri,4,4,"button",0),o.nI1(1,"async")),2&S&&o.Y8G("ngIf",o.bMT(1,1,$.hasWorkspace$))},dependencies:[H.bT,ee.Hl,ee.iY,Bt.uc,Bt.oV,dt.m_,dt.An,H.Jj,ut.Ck,Qt.D9],changeDetection:0})}return J})();function ji(J,V){if(1&J){const m=o.RV6();o.nrm(0,"igo-workspace-button",4),o.j41(1,"igo-export-button",5),o.bIt("click",function(){const $=o.eBV(m).layer,oe=o.XpG(2);return o.Njj(oe.activateExport($))}),o.k0s(),o.nrm(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&J){const m=V.layer,S=o.XpG(2);o.Y8G("layer",m),o.R7$(),o.Y8G("layer",m),o.R7$(),o.Y8G("header",S.ogcButton)("layer",m),o.R7$(),o.Y8G("header",S.timeButton)("layer",m),o.R7$(),o.Y8G("trackFeature",!0)("layer",m),o.R7$(),o.Y8G("layer",m)}}function Bi(J,V){if(1&J&&(o.j41(0,"igo-layer-list",3),o.DNE(1,ji,6,9,"ng-template",null,1,o.C5r),o.k0s()),2&J){const m=o.XpG();o.Y8G("map",m.map)("excludeBaseLayers",m.excludeBaseLayers)("layerFilterAndSortOptions",m.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",m.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",m.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)("queryBadge",m.queryBadge)}}function si(J,V){1&J&&(o.j41(0,"p",9),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&J&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"igo.integration.mapTool.customize")," "))}function ir(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",11),o.EFF(2,"search"),o.k0s(),o.j41(3,"span",12),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.searchEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.search-tool")," "))}function Gi(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",11),o.EFF(2,"library_add"),o.k0s(),o.j41(3,"span",13),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.catalogEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.catalog-tool")," "))}function rr(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",11),o.EFF(2,"star"),o.k0s(),o.j41(3,"span",14),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.contextEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.context-tool")," "))}function sr(J,V){if(1&J&&(o.j41(0,"mat-list")(1,"p",9),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.DNE(4,si,3,3,"p",10)(5,ir,6,3,"mat-list-item",8)(6,Gi,6,3,"mat-list-item",8)(7,rr,6,3,"mat-list-item",8),o.k0s()),2&J){const m=o.XpG(2);o.R7$(2),o.SpI(" ",o.bMT(3,5,"igo.integration.mapTool.empty")," "),o.R7$(2),o.Y8G("ngIf",m.layerAdditionAllowed&&(m.searchToolInToolbar||m.catalogToolInToolbar||m.contextToolInToolbar)),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.searchToolInToolbar),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.catalogToolInToolbar),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.contextToolInToolbar)}}function ai(J,V){if(1&J&&o.DNE(0,sr,8,7,"mat-list",8),2&J){const m=o.XpG();o.Y8G("ngIf",m.delayedShowEmptyMapContent)}}let jn=class Ta{mapState;toolState;searchSourceService;cdRef;importExportState;delayedShowEmptyMapContent=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;layerAdditionAllowed=!0;get map(){return this.mapState.map}get layers$(){return this.map.layers$.pipe((0,bo.T)(V=>V.filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer))))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const V=Object.assign({showToolbar:p.$zv.default},this.layerListControls);switch(this.layerListControls.showToolbar){case p.$zv.always:V.showToolbar=p.$zv.always;break;case p.$zv.never:V.showToolbar=p.$zv.never}return V}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(p.cE5).filter(V=>V.available&&"Layer"===V.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(V,m,S,$,oe){this.mapState=V,this.toolState=m,this.searchSourceService=S,this.cdRef=$,this.importExportState=oe}ngOnInit(){setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}activateExport(V){let m=V.id;V.options.workspace?.workspaceId&&(m=V.options.workspace.workspaceId!==V.id?V.options.workspace.workspaceId:V.id),this.importExportState.setsExportOptions({layers:[m]}),this.importExportState.setMode(yo.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(m){return new(m||Ta)(o.rXU(mt),o.rXU(At),o.rXU(p.zA1),o.rXU(o.gRc),o.rXU(so))};static \u0275cmp=o.VBU({type:Ta,selectors:[["igo-map-details-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge",layerAdditionAllowed:"layerAdditionAllowed"},standalone:!0,features:[o.aNF],decls:4,vars:4,consts:[["empty",""],["igoLayerItemToolbar",""],["class","mapDetailsList","igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge",4,"ngIf","ngIfElse"],["igoLayerListBinding","",1,"mapDetailsList",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],[3,"layer"],[3,"click","layer"],[3,"header","layer"],[3,"trackFeature","layer"],[4,"ngIf"],[1,"map-empty","mat-typography"],["class","map-empty mat-typography",4,"ngIf"],["matListItemIcon",""],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(m,S){if(1&m&&(o.DNE(0,Bi,3,7,"igo-layer-list",2),o.nI1(1,"async"),o.DNE(2,ai,1,1,"ng-template",null,0,o.C5r)),2&m){const $=o.sdS(3);o.Y8G("ngIf",o.bMT(1,2,S.layers$).length)("ngIfElse",$)}},dependencies:[H.bT,p.Lnt,p.cBF,sn,p.gIZ,p.rBO,p.tsz,p.jFp,p.LU,Kt.Fg,Kt.jt,Kt.YE,Kt.ZV,Kt.yE,dt.m_,dt.An,H.Jj,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}[_nghost-%COMP%]   .mapDetailsList[_ngcontent-%COMP%]{overflow:hidden}"]})};jn=(0,et.Cg)([(0,Mt.S$)({name:"mapDetails",title:"igo.integration.tools.map",icon:"map"}),(0,et.Sn)("design:paramtypes",[mt,At,p.zA1,o.gRc,so])],jn);var ar=r(56042);function Vi(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-layer-legend-list",4),o.nI1(1,"async"),o.bIt("allLegendsShown",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onShowAllLegends($))}),o.k0s()}if(2&J){const m=o.XpG();o.Y8G("excludeBaseLayers",m.excludeBaseLayers)("allowShowAllLegends",m.allowShowAllLegends)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)("showAllLegendsValue",o.bMT(1,4,m.showAllLegendsValue$))}}function Ui(J,V){}function lr(J,V){1&J&&o.DNE(0,Ui,0,0,"ng-template")}function cr(J,V){if(1&J&&(o.j41(0,"p",5),o.EFF(1),o.nI1(2,"async"),o.nI1(3,"translate"),o.nI1(4,"translate"),o.k0s()),2&J){const m=o.XpG();o.R7$(),o.SpI(" ",o.bMT(2,1,m.visibleLayers$).length?o.bMT(3,3,"igo.integration.mapTool.noLayersInRange"):o.bMT(4,5,"igo.integration.mapTool.noLayersVisible"),"\n")}}function ur(J,V){1&J&&(o.j41(0,"p",5),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&J&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"igo.integration.mapTool.customize")," "))}function pr(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",7),o.EFF(2,"search"),o.k0s(),o.j41(3,"span",8),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.searchEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.search-tool")," "))}function Ni(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",7),o.EFF(2,"library_add"),o.k0s(),o.j41(3,"span",9),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.catalogEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.catalog-tool")," "))}function li(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",7),o.EFF(2,"star"),o.k0s(),o.j41(3,"span",10),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.contextEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.context-tool")," "))}function Yi(J,V){if(1&J&&(o.j41(0,"mat-list")(1,"p",5),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.DNE(4,ur,3,3,"p",3)(5,pr,6,3,"mat-list-item",6)(6,Ni,6,3,"mat-list-item",6)(7,li,6,3,"mat-list-item",6),o.k0s()),2&J){const m=o.XpG(2);o.R7$(2),o.SpI(" ",o.bMT(3,5,"igo.integration.mapTool.empty")," "),o.R7$(2),o.Y8G("ngIf",m.layerAdditionAllowed&&(m.searchToolInToolbar||m.catalogToolInToolbar||m.contextToolInToolbar)),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.searchToolInToolbar),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.catalogToolInToolbar),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.contextToolInToolbar)}}function Jo(J,V){if(1&J&&o.DNE(0,Yi,8,7,"mat-list",6),2&J){const m=o.XpG();o.Y8G("ngIf",m.delayedShowEmptyMapContent)}}let Bn=class Ia{mapState;toolState;searchSourceService;cdRef;delayedShowEmptyMapContent=!1;layers$=new A.t([]);showAllLegendsValue$=new A.t(!1);change$=new ar.m(1);resolution$$;visibleOrInRangeLayers$$;updateLegendOnResolutionChange=!1;layerAdditionAllowed=!0;allowShowAllLegends=!1;showAllLegendsValue=!1;layerListControls={};get map(){return this.mapState.map}get visibleOrInRangeLayers$(){return this.layers$.pipe((0,bo.T)(V=>V.filter(m=>m.visible$.value&&m.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,bo.T)(V=>V.filter(m=>m.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(p.cE5).filter(V=>V.available&&"Layer"===V.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(V,m,S,$){this.mapState=V,this.toolState=m,this.searchSourceService=S,this.cdRef=$}ngOnInit(){this.resolution$$=(0,lo.z)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,zo.B)(10)).subscribe(V=>{this.layers$.next(V[0].filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}onShowAllLegends(V){this.mapState.showAllLegendsValue=V,this.showAllLegendsValue$.next(V)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let V;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(m=>{V=0!==m.length}),!1===V)return!1}return!0}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(m){return new(m||Ia)(o.rXU(mt),o.rXU(At),o.rXU(p.zA1),o.rXU(o.gRc))};static \u0275cmp=o.VBU({type:Ia,selectors:[["igo-map-legend-tool"]],inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layerAdditionAllowed:"layerAdditionAllowed",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",layerListControls:"layerListControls"},standalone:!0,features:[o.aNF],decls:8,vars:10,consts:[["emptyLayers",""],["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["igoLayerLegendListBinding","",3,"allLegendsShown","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(m,S){if(1&m&&(o.DNE(0,Vi,2,6,"igo-layer-legend-list",1)(1,lr,1,0,null,2),o.nI1(2,"async"),o.DNE(3,cr,5,7,"p",3),o.nI1(4,"async"),o.nI1(5,"async"),o.DNE(6,Jo,1,1,"ng-template",null,0,o.C5r)),2&m){const $=o.sdS(7);o.Y8G("ngIf",S.showAllLegend()),o.R7$(),o.Y8G("ngIf",0!==o.bMT(2,4,S.layers$).length)("ngIfElse",$),o.R7$(2),o.Y8G("ngIf",!S.allowShowAllLegends&&0!==o.bMT(4,6,S.layers$).length&&0===o.bMT(5,8,S.visibleOrInRangeLayers$).length)}},dependencies:[H.bT,p.S3U,p.N8E,Kt.Fg,Kt.jt,Kt.YE,Kt.ZV,Kt.yE,dt.m_,dt.An,H.Jj,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"]})};Bn=(0,et.Cg)([(0,Mt.S$)({name:"mapLegend",title:"igo.integration.tools.legend",icon:"format_list_bulleted"}),(0,et.Sn)("design:paramtypes",[mt,At,p.zA1,o.gRc])],Bn);var Sn=r(53804),ci=r(18094),Gn=r(19240);let an=(()=>{class J{mapState;storageService;defaultProximityRadiusValue=30;enabled$=new A.t(!1);proximityRadiusValue$;proximitylocationType$=new A.t("geolocation");proximityFeatureStore;subs$$=[];currentPositionCoordinate$=new A.t(void 0);get map(){return this.mapState.map}constructor(m,S){this.mapState=m,this.storageService=S,this.proximityFeatureStore=new p.oEt([],{map:this.mapState.map}),this.proximityRadiusValue$=new A.t(this.storageService.get("mapProximityRadius")||this.defaultProximityRadiusValue),this.mapState.map.ol.once("rendercomplete",()=>{this.subscribeProximityMonitor()})}subscribeProximityMonitor(){this.subs$$.push((0,lo.z)([this.enabled$,this.proximitylocationType$,this.proximityRadiusValue$,(0,Gn.Y)(5e3),this.map.geolocationController.position$]).pipe((0,zo.B)(750)).subscribe(m=>{this.proximityFeatureStore.clear();const S=m[0],$=this.map.layers,oe=this.map.geolocationController.position$.value,Se=m[1],Ue=m[2];if(this.storageService.set("mapProximityRadius",Ue||this.defaultProximityRadiusValue),!S)return;let it;if("geolocation"===Se){if(!oe||!oe.position)return;it=Ae.pd(oe.position,oe.projection,this.map.projection),this.map.mapCenter$.next(!1)}else it=this.map.viewController.getCenter(),this.map.mapCenter$.next(!0);const gt=Ae.pd(it,this.map.projection,"EPSG:4269"),yt=(0,p.hou)(gt,6);this.currentPositionCoordinate$.next(yt),$.filter(It=>It.ol instanceof ci.A&&It.dataSource.options.queryable&&It.visible&&It.isInResolutionsRange).map(It=>{const xt=It.ol.getSource(),uo=xt.getFeaturesAtCoordinate(it);if(uo&&uo.length)uo.map(Oo=>{const cn=(0,p.M2o)(Oo,this.map.projection);let Yo=this.getQueryTitle(cn,It);this.addFeatureToStore(It,it,cn,Yo,0)});else{const Oo=xt.getClosestFeatureToCoordinate(it);if(Oo){const cn=Oo.getGeometry(),Yo=(0,p.M2o)(Oo,this.map.projection),Fn=cn.getClosestPoint(it),mi=new ie.A([it,Fn]),Qi=(0,p.mc1)(mi,"EPSG:3857");if(Qi<=Ue){let ys=this.getQueryTitle(Yo,It);this.addFeatureToStore(It,it,Yo,ys,Qi)}}}})}))}addFeatureToStore(m,S,$,oe,Se){const Ue=(0,rn.uR)(),it=this.map.ol.getView().getProjection(),gt=$.ol.getGeometry(),yt=(new te.A).writeGeometryObject(gt,{featureProjection:it,dataProjection:it});this.proximityFeatureStore.update({type:p.RI9,geometry:yt,projection:it.getCode(),properties:{...$.properties,id:Ue,element:oe,distance:Se,coordFromCalculatedDistance:S,layerSrcId:m.id,layerSrcTitle:m.title},meta:{id:Ue}})}getQueryTitle(m,S){let $;if(S.options?.source?.options){const oe=S.options.source.options;oe.queryTitle&&($=this.getLabelMatch(m,oe.queryTitle))}return $}getLabelMatch(m,S){let $=S;const oe=Array.from(S.matchAll(/\$\{([^\{\}]+)\}/g));return oe.forEach(Se=>{$=$.replace(Se[0],m.properties[Se[1]])}),0===oe.length&&$===S&&($=m.properties[S]||S),$}static \u0275fac=function(S){return new(S||J)(o.KVO(mt),o.KVO(F.n$))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();const dr=["table"];function mr(J,V){if(1&J&&(o.j41(0,"mat-form-field",15),o.nrm(1,"textarea",16,1),o.nI1(3,"translate"),o.k0s()),2&J){const m=V.ngIf;o.R7$(),o.Y8G("placeholder",o.bMT(3,2,"igo.integration.map-proximity-tool.lon"))("value",m[0])}}function ne(J,V){if(1&J&&(o.j41(0,"mat-form-field",17),o.nrm(1,"textarea",16,1),o.nI1(3,"translate"),o.k0s()),2&J){const m=V.ngIf;o.R7$(),o.Y8G("placeholder",o.bMT(3,2,"igo.integration.map-proximity-tool.lat"))("value",m[1])}}function Ke(J,V){if(1&J){const m=o.RV6();o.j41(0,"button",18),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.copyTextToClipboard())}),o.j41(1,"mat-icon"),o.EFF(2,"content_copy"),o.k0s()()}}let C=class Fa{mapState;mapProximityState;languageService;messageService;subs$$=[];table;get maxDistance(){return this.mapProximityState.proximityRadiusValue$.value}set maxDistance(V){this.mapProximityState.proximityRadiusValue$.next(V)}get map(){return this.mapState.map}userDefinedMapCenter;userDefinedFollowPosition;tableTemplate;constructor(V,m,S,$){this.mapState=V,this.mapProximityState=m,this.languageService=S,this.messageService=$,this.tableTemplate={selection:!0,selectMany:!1,selectionCheckbox:!1,sort:!0,columns:[{name:"element",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.feature"),valueAccessor:oe=>oe.properties.element},{name:"distance",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.distance"),valueAccessor:oe=>`${rn.ZM.roundToNDecimal(oe.properties.distance,1)}m`}]}}ngOnInit(){this.mapProximityState.enabled$.next(!0),this.userDefinedFollowPosition=!0===this.map.geolocationController.followPosition,this.userDefinedMapCenter=!0===this.map.mapCenter$.value,this.subs$$.push(this.mapProximityState.proximitylocationType$.subscribe(V=>{this.map.mapCenter$.next("geolocation"!==V),this.map.geolocationController.followPosition="geolocation"===V}))}ngOnDestroy(){this.mapProximityState.enabled$.next(!1),this.map.mapCenter$.next(this.userDefinedMapCenter),this.subs$$.map(V=>V.unsubscribe()),this.map.geolocationController.followPosition=this.userDefinedFollowPosition}onLocationTypeChange(V){this.mapProximityState.proximitylocationType$.next(V.value)}copyTextToClipboard(){rn.B0.copy(this.mapProximityState.currentPositionCoordinate$?.value.toString())&&this.messageService.success("igo.integration.map-proximity-tool.copyMsg","igo.integration.map-proximity-tool.copyTitle")}static \u0275fac=function(m){return new(m||Fa)(o.rXU(mt),o.rXU(an),o.rXU(ut.gw),o.rXU(oo.bg))};static \u0275cmp=o.VBU({type:Fa,selectors:[["igo-map-proximity-tool"]],viewQuery:function(m,S){if(1&m&&o.GBs(dr,7),2&m){let $;o.mGM($=o.lsd())&&(S.table=$.first)}},standalone:!0,features:[o.aNF],decls:31,vars:35,consts:[["table",""],["textArea",""],[1,"table-compact",3,"store","template"],["class","coordinates",4,"ngIf"],["class","coordinates2",4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"title-container"],[1,"title","mat-typography"],[1,"igo-input-container","mat-typography"],[3,"change"],["value","geolocation",3,"checked"],["value","mapCenter",3,"checked"],[1,"radius-unit"],["floatLabel","always",1,"radius-field"],["type","number","pattern","[0-9]*","matInput","",3,"ngModelChange","ngModel","placeholder"],[1,"coordinates"],["matInput","","readonly","","rows","1",3,"placeholder","value"],[1,"coordinates2"],["mat-icon-button","",3,"click"]],template:function(m,S){if(1&m){const $=o.RV6();o.nrm(0,"igo-entity-table",2,0)(2,"br"),o.DNE(3,mr,4,4,"mat-form-field",3),o.nI1(4,"async"),o.DNE(5,ne,4,4,"mat-form-field",4),o.nI1(6,"async"),o.DNE(7,Ke,3,0,"button",5),o.nI1(8,"async"),o.nI1(9,"async"),o.j41(10,"div",6)(11,"mat-label",7),o.EFF(12),o.nI1(13,"translate"),o.k0s()(),o.j41(14,"div",8)(15,"mat-radio-group",9),o.bIt("change",function(Se){return o.eBV($),o.Njj(S.onLocationTypeChange(Se))}),o.j41(16,"mat-radio-button",10),o.nI1(17,"async"),o.EFF(18),o.nI1(19,"translate"),o.k0s(),o.j41(20,"mat-radio-button",11),o.nI1(21,"async"),o.EFF(22),o.nI1(23,"translate"),o.k0s()()(),o.j41(24,"div",12)(25,"mat-form-field",13)(26,"mat-label"),o.EFF(27),o.nI1(28,"translate"),o.k0s(),o.j41(29,"input",14),o.nI1(30,"translate"),o.mxI("ngModelChange",function(Se){return o.eBV($),o.DH7(S.maxDistance,Se)||(S.maxDistance=Se),o.Njj(Se)}),o.k0s()()()}2&m&&(o.Y8G("store",S.mapProximityState.proximityFeatureStore)("template",S.tableTemplate),o.R7$(3),o.Y8G("ngIf",o.bMT(4,13,S.mapProximityState.currentPositionCoordinate$)),o.R7$(2),o.Y8G("ngIf",o.bMT(6,15,S.mapProximityState.currentPositionCoordinate$)),o.R7$(2),o.Y8G("ngIf",o.bMT(8,17,S.mapProximityState.currentPositionCoordinate$)&&o.bMT(9,19,S.mapProximityState.currentPositionCoordinate$).length),o.R7$(5),o.JRh(o.bMT(13,21,"igo.integration.map-proximity-tool.method")),o.R7$(4),o.Y8G("checked","geolocation"===o.bMT(17,23,S.mapProximityState.proximitylocationType$)),o.R7$(2),o.JRh(o.bMT(19,25,"igo.integration.map-proximity-tool.geolocation")),o.R7$(2),o.Y8G("checked","mapCenter"===o.bMT(21,27,S.mapProximityState.proximitylocationType$)),o.R7$(2),o.JRh(o.bMT(23,29,"igo.integration.map-proximity-tool.mapCenter")),o.R7$(5),o.JRh(o.bMT(28,31,"igo.integration.map-proximity-tool.radiusM")),o.R7$(2),o.FS9("placeholder",o.bMT(30,33,"igo.integration.map-proximity-tool.radiusM")),o.R50("ngModel",S.maxDistance))},dependencies:[M.f7,H.bT,Mo.RG,Mo.rl,Mo.nJ,nn.fS,nn.fg,ee.Hl,ee.iY,dt.m_,dt.An,Sn.Wk,Sn.VT,Sn._g,x.YN,x.me,x.Q0,x.BC,x.R_,x.vS,H.Jj,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none}[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{padding:10px 15px}[_nghost-%COMP%]   mat-form-field.coordinates[_ngcontent-%COMP%]{width:110px}[_nghost-%COMP%]   mat-form-field.coordinates2[_ngcontent-%COMP%]{width:100px;padding:0 10px 0 3px}[_nghost-%COMP%]   mat-form-field.igo-input-container[_ngcontent-%COMP%]{width:60%;padding:0 15px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:90%;margin-left:2px;padding:5px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]   mat-form-field.radius-field[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:100%}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}"]})};function K(J,V){if(1&J){const m=o.RV6();o.nrm(0,"igo-workspace-button",4),o.j41(1,"igo-export-button",5),o.bIt("click",function(){const $=o.eBV(m).layer,oe=o.XpG();return o.Njj(oe.activateExport($))}),o.k0s(),o.nrm(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&J){const m=V.layer,S=o.XpG();o.Y8G("layer",m),o.R7$(),o.Y8G("layer",m),o.R7$(),o.Y8G("header",S.ogcButton)("layer",m),o.R7$(),o.Y8G("header",S.timeButton)("layer",m),o.R7$(),o.Y8G("trackFeature",!0)("layer",m),o.R7$(),o.Y8G("layer",m)}}C=(0,et.Cg)([(0,Mt.S$)({name:"map-proximity",title:"igo.integration.tools.closestFeature",icon:"radar"}),(0,et.Sn)("design:paramtypes",[mt,an,ut.gw,oo.bg])],C);let q=class Ma{mapState;toolState;importExportState;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;get map(){return this.mapState.map}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const V=Object.assign({showToolbar:p.$zv.default},this.layerListControls);switch(this.layerListControls.showToolbar){case p.$zv.always:V.showToolbar=p.$zv.always;break;case p.$zv.never:V.showToolbar=p.$zv.never}return V}constructor(V,m,S){this.mapState=V,this.toolState=m,this.importExportState=S}activateExport(V){let m=V.id;V.options.workspace?.workspaceId&&(m=V.options.workspace.workspaceId!==V.id?V.options.workspace.workspaceId:V.id),this.importExportState.setsExportOptions({layers:[m]}),this.importExportState.setMode(yo.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(m){return new(m||Ma)(o.rXU(mt),o.rXU(At),o.rXU(so))};static \u0275cmp=o.VBU({type:Ma,selectors:[["igo-map-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.aNF],decls:9,vars:13,consts:[["igoLayerItemToolbar",""],[3,"label"],["igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoContextListBinding",""],[3,"layer"],[3,"click","layer"],[3,"header","layer"],[3,"trackFeature","layer"]],template:function(m,S){1&m&&(o.j41(0,"mat-tab-group")(1,"mat-tab",1),o.nI1(2,"translate"),o.j41(3,"igo-layer-list",2),o.DNE(4,K,6,9,"ng-template",null,0,o.C5r),o.k0s()(),o.j41(6,"mat-tab",1),o.nI1(7,"translate"),o.nrm(8,"igo-context-list",3),o.k0s()()),2&m&&(o.R7$(),o.Y8G("label",o.bMT(2,9,"igo.integration.tools.map")),o.R7$(2),o.Y8G("map",S.map)("excludeBaseLayers",S.excludeBaseLayers)("layerFilterAndSortOptions",S.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",S.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",S.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",S.updateLegendOnResolutionChange)("queryBadge",S.queryBadge),o.R7$(3),o.Y8G("label",o.bMT(7,11,"igo.integration.tools.contexts")))},dependencies:[Fo.RI,Fo.mq,Fo.T8,p.Lnt,p.cBF,sn,p.gIZ,p.rBO,p.tsz,p.jFp,p.LU,Ht.RT,Ht.kc,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}"],changeDetection:0})};q=(0,et.Cg)([(0,Mt.S$)({name:"map",title:"igo.integration.tools.map",icon:"map"}),(0,et.Sn)("design:paramtypes",[mt,At,so])],q);const ve=["tabGroup"];function Pe(J,V){if(1&J&&o.nrm(0,"igo-style-modal-layer-button",11),2&J){const m=o.XpG().layer;o.Y8G("layer",m)}}function Ne(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-time-filter-button",15),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.activateTimeFilter())}),o.k0s()}if(2&J){const m=o.XpG().layer,S=o.XpG(2);o.Y8G("header",S.timeButton)("layer",m)}}function st(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-ogc-filter-button",15),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.activateOgcFilter())}),o.k0s()}if(2&J){const m=o.XpG().layer,S=o.XpG(2);o.Y8G("header",S.ogcButton)("layer",m)}}function ht(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-export-button",16),o.bIt("click",function(){o.eBV(m);const $=o.XpG().layer,oe=o.XpG(2);return o.Njj(oe.activateExport($))}),o.k0s()}if(2&J){const m=o.XpG().layer;o.Y8G("layer",m)}}function Ze(J,V){if(1&J&&(o.DNE(0,Pe,1,1,"igo-style-modal-layer-button",10),o.nrm(1,"igo-metadata-button",11)(2,"igo-track-feature-button",12),o.DNE(3,Ne,1,2,"igo-time-filter-button",13)(4,st,1,2,"igo-ogc-filter-button",13)(5,ht,1,1,"igo-export-button",14),o.nrm(6,"igo-workspace-button",11)),2&J){const m=V.layer,S=o.XpG(2);o.Y8G("ngIf",S.isStyleEditButton(m)),o.R7$(),o.Y8G("layer",m),o.R7$(),o.Y8G("trackFeature",!0)("layer",m),o.R7$(),o.Y8G("ngIf",S.isTimeFilterButton(m)),o.R7$(),o.Y8G("ngIf",S.isOGCFilterButton(m)),o.R7$(),o.Y8G("ngIf",S.isExportButton(m)),o.R7$(),o.Y8G("layer",m)}}function _t(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-layer-list",9),o.bIt("appliedFilterAndSort",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onLayerListChange($))}),o.DNE(1,Ze,7,8,"ng-template",null,2,o.C5r),o.k0s()}if(2&J){const m=o.XpG();o.Y8G("excludeBaseLayers",m.excludeBaseLayers)("layerFilterAndSortOptions",m.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",m.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",m.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)("queryBadge",m.queryBadge)("map",m.map)}}function ft(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-layer-legend-list",17),o.nI1(1,"async"),o.bIt("allLegendsShown",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onShowAllLegends($))}),o.k0s()}if(2&J){const m=o.XpG();o.Y8G("allowShowAllLegends",m.allowShowAllLegends)("showAllLegendsValue",o.bMT(1,4,m.showAllLegendsValue$))("excludeBaseLayers",m.excludeBaseLayers)("updateLegendOnResolutionChange",m.updateLegendOnResolutionChange)}}function Zt(J,V){}function Nt(J,V){1&J&&o.DNE(0,Zt,0,0,"ng-template")}function xo(J,V){if(1&J&&(o.j41(0,"p",18),o.EFF(1),o.nI1(2,"async"),o.nI1(3,"translate"),o.nI1(4,"translate"),o.k0s()),2&J){const m=o.XpG();o.R7$(),o.SpI(" ",o.bMT(2,1,m.visibleLayers$).length?o.bMT(3,3,"igo.integration.mapTool.noLayersInRange"):o.bMT(4,5,"igo.integration.mapTool.noLayersVisible")," ")}}function Vn(J,V){1&J&&(o.j41(0,"p",18),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&J&&(o.R7$(),o.SpI(" ",o.bMT(2,1,"igo.integration.mapTool.customize")," "))}function wt(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",20),o.EFF(2,"search"),o.k0s(),o.j41(3,"span",21),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.searchEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.search-tool")," "))}function pt(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",20),o.EFF(2,"library_add"),o.k0s(),o.j41(3,"span",22),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.catalogEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.catalog-tool")," "))}function Zo(J,V){if(1&J){const m=o.RV6();o.j41(0,"mat-list-item")(1,"mat-icon",20),o.EFF(2,"star"),o.k0s(),o.j41(3,"span",23),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.contextEmit())}),o.EFF(4),o.nI1(5,"translate"),o.k0s()()}2&J&&(o.R7$(4),o.SpI(" ",o.bMT(5,1,"igo.integration.mapTool.context-tool")," "))}function Wi(J,V){if(1&J&&(o.j41(0,"mat-list")(1,"p",18),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.DNE(4,Vn,3,3,"p",8)(5,wt,6,3,"mat-list-item",19)(6,pt,6,3,"mat-list-item",19)(7,Zo,6,3,"mat-list-item",19),o.k0s()),2&J){const m=o.XpG(2);o.R7$(2),o.SpI(" ",o.bMT(3,5,"igo.integration.mapTool.empty")," "),o.R7$(2),o.Y8G("ngIf",m.layerAdditionAllowed&&(m.searchToolInToolbar||m.catalogToolInToolbar||m.contextToolInToolbar)),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.searchToolInToolbar),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.catalogToolInToolbar),o.R7$(),o.Y8G("ngIf",m.layerAdditionAllowed&&m.contextToolInToolbar)}}function fo(J,V){if(1&J&&o.DNE(0,Wi,8,7,"mat-list",19),2&J){const m=o.XpG();o.Y8G("ngIf",m.delayedShowEmptyMapContent)}}let eo=class xa{layerListToolState;toolState;mapState;searchSourceService;importExportState;layers$=new A.t([]);showAllLegendsValue$=new A.t(!1);resolution$$;visibleOrInRangeLayers$$;delayedShowEmptyMapContent=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;selectedTabAtOpening;ogcButton=!0;timeButton=!0;layerAdditionAllowed=!0;get layerListControls(){return this._layerListControls}set layerListControls(V){const m=this.layerListToolState.getLayerListControls(),S=m.keyword,$=m.onlyVisible,oe=m.sortAlpha;V.keyword=""!==S?S:V.keyword,V.onlyVisible=void 0!==$?$:V.onlyVisible,V.sortAlpha=void 0!==oe?oe:V.sortAlpha,V.onlyVisible=void 0!==V.onlyVisible&&V.onlyVisible,V.sortAlpha=void 0!==V.sortAlpha&&V.sortAlpha,this._layerListControls=V}_layerListControls={};get map(){return this.mapState.map}queryBadge=!1;get visibleOrInRangeLayers$(){return this.layers$.pipe((0,bo.T)(V=>V.filter(m=>m.visible$.value&&m.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,bo.T)(V=>V.filter(m=>m.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const V=Object.assign({showToolbar:p.$zv.default},this.layerListControls);switch(this.layerListControls.showToolbar){case p.$zv.always:V.showToolbar=p.$zv.always;break;case p.$zv.never:V.showToolbar=p.$zv.never}return V}tabGroup;get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(p.cE5).filter(V=>V.available&&"Layer"===V.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(V,m,S,$,oe){this.layerListToolState=V,this.toolState=m,this.mapState=S,this.searchSourceService=$,this.importExportState=oe}ngOnInit(){this.selectedTab(),this.resolution$$=(0,lo.z)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,zo.B)(10)).subscribe(V=>{this.layers$.next(V[0].filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>this.delayedShowEmptyMapContent=!0,250)}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}onShowAllLegends(V){this.mapState.showAllLegendsValue=V,this.showAllLegendsValue$.next(V)}selectedTab(){const V=this.layerListToolState.selectedTab$.value;this.layerListToolState.setSelectedTab(void 0!==V?V:"legend"===this.selectedTabAtOpening?1:0)}tabChanged(V){this.layerListToolState.setSelectedTab(V.index),this.layers$.next(this.map.layers.filter(m=>!(!1===m.showInLayerList||this.excludeBaseLayers&&m.baseLayer)))}onLayerListChange(V){this.layerListToolState.setKeyword(V.keyword),this.layerListToolState.setSortAlpha(V.sortAlpha),this.layerListToolState.setOnlyVisible(V.onlyVisible)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let V;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(m=>{V=0!==m.length}),!1===V)return!1}return!0}activateExport(V){let m=V.id;V.options.workspace?.workspaceId&&(m=V.options.workspace.workspaceId!==V.id?V.options.workspace.workspaceId:V.id),this.importExportState.setsExportOptions({layers:[m]}),this.importExportState.setMode(yo.export),this.toolState.toolbox.activateTool("importExport")}activateTimeFilter(){this.toolState.toolbox.activateTool("activeTimeFilter")}activateOgcFilter(){this.toolState.toolbox.activateTool("activeOgcFilter")}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}isTimeFilterButton(V){const m=V.dataSource.options;return this.timeButton&&m.timeFilterable&&m.timeFilter}isOGCFilterButton(V){const m=V.dataSource.options;return this.ogcButton&&m.ogcFilters&&m.ogcFilters.enabled&&(m.ogcFilters.pushButtons||m.ogcFilters.checkboxes||m.ogcFilters.radioButtons||m.ogcFilters.select||m.ogcFilters.autocomplete||m.ogcFilters.editable)}isExportButton(V){return!!(V instanceof p.vK2&&!0===V.exportable||V.dataSource.options.download&&V.dataSource.options.download.url||V.options.workspace?.enabled&&V.options.workspace?.workspaceId!==V.id)}isStyleEditButton(V){return!!(V instanceof p.vK2&&V.options?.igoStyle?.editable)}static \u0275fac=function(m){return new(m||xa)(o.rXU(Ao),o.rXU(At),o.rXU(mt),o.rXU(p.zA1),o.rXU(so))};static \u0275cmp=o.VBU({type:xa,selectors:[["igo-map-tools"]],viewQuery:function(m,S){if(1&m&&o.GBs(ve,7),2&m){let $;o.mGM($=o.lsd())&&(S.tabGroup=$.first)}},inputs:{allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",selectedTabAtOpening:"selectedTabAtOpening",ogcButton:"ogcButton",timeButton:"timeButton",layerAdditionAllowed:"layerAdditionAllowed",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.aNF],decls:17,vars:23,consts:[["tabGroup",""],["emptyLayers",""],["igoLayerItemToolbar",""],[3,"selectedTabChange","selectedIndex"],[3,"label"],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map","appliedFilterAndSort",4,"ngIf","ngIfElse"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["igoLayerListBinding","",3,"appliedFilterAndSort","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map"],[3,"layer",4,"ngIf"],[3,"layer"],[3,"trackFeature","layer"],[3,"header","layer","click",4,"ngIf"],[3,"layer","click",4,"ngIf"],[3,"click","header","layer"],[3,"click","layer"],["igoLayerLegendListBinding","",3,"allLegendsShown","allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(m,S){if(1&m){const $=o.RV6();o.j41(0,"mat-tab-group",3,0),o.nI1(2,"async"),o.bIt("selectedTabChange",function(Se){return o.eBV($),o.Njj(S.tabChanged(Se))}),o.j41(3,"mat-tab",4),o.nI1(4,"translate"),o.DNE(5,_t,3,7,"igo-layer-list",5),o.nI1(6,"async"),o.k0s(),o.j41(7,"mat-tab",4),o.nI1(8,"translate"),o.DNE(9,ft,2,6,"igo-layer-legend-list",6)(10,Nt,1,0,null,7),o.nI1(11,"async"),o.DNE(12,xo,5,7,"p",8),o.nI1(13,"async"),o.nI1(14,"async"),o.k0s(),o.DNE(15,fo,1,1,"ng-template",null,1,o.C5r),o.k0s()}if(2&m){const $=o.sdS(16);o.Y8G("selectedIndex",o.bMT(2,9,S.layerListToolState.selectedTab$)),o.R7$(3),o.Y8G("label",o.bMT(4,11,"igo.integration.tools.layers")),o.R7$(2),o.Y8G("ngIf",0!==o.bMT(6,13,S.layers$).length)("ngIfElse",$),o.R7$(2),o.Y8G("label",o.bMT(8,15,"igo.integration.tools.legend")),o.R7$(2),o.Y8G("ngIf",S.showAllLegend()),o.R7$(),o.Y8G("ngIf",0!==o.bMT(11,17,S.layers$).length)("ngIfElse",$),o.R7$(2),o.Y8G("ngIf",!S.allowShowAllLegends&&0!==o.bMT(13,19,S.layers$).length&&0===o.bMT(14,21,S.visibleOrInRangeLayers$).length)}},dependencies:[Fo.RI,Fo.mq,Fo.T8,H.bT,p.Lnt,p.cBF,p.$AX,p.LU,p.jFp,p.tsz,p.rBO,p.gIZ,sn,p.S3U,p.N8E,Kt.Fg,Kt.jt,Kt.YE,Kt.ZV,Kt.yE,dt.m_,dt.An,H.Jj,ut.Ck,Qt.D9],styles:["[_nghost-%COMP%]   mat-tab-group[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{flex:1}[_nghost-%COMP%]     .mat-tab-body{margin-top:8px}[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"],changeDetection:0})};eo=(0,et.Cg)([(0,Mt.S$)({name:"mapTools",title:"igo.integration.tools.map",icon:"map"}),(0,et.Sn)("design:paramtypes",[Ao,At,mt,p.zA1,so])],eo);let Xi=(()=>{class J{mapState;store;constructor(m){this.mapState=m,this.store=new p.oEt([],{map:this.mapState.map}),this.mapState.map.layers$.subscribe(S=>{0===S.filter($=>$.id?.startsWith("igo-measures-")).length&&(this.store.deleteMany(this.store.all()),this.mapState.map.ol.getOverlays().getArray().filter($=>$.options.className.includes("igo-map-tooltip")).map($=>this.mapState.map.ol.removeOverlay($)))})}static \u0275fac=function(S){return new(S||J)(o.KVO(mt))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Ki=class Oa{measureState;mapState;get store(){return this.measureState.store}get map(){return this.mapState.map}constructor(V,m){this.measureState=V,this.mapState=m}static \u0275fac=function(m){return new(m||Oa)(o.rXU(Xi),o.rXU(mt))};static \u0275cmp=o.VBU({type:Oa,selectors:[["igo-measurer-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:2,consts:[[3,"store","map"]],template:function(m,S){1&m&&o.nrm(0,"igo-measurer",0),2&m&&o.Y8G("store",S.store)("map",S.map)},dependencies:[p.w4o],encapsulation:2,changeDetection:0})};Ki=(0,et.Cg)([(0,Mt.S$)({name:"measurer",title:"igo.integration.tools.measurer",icon:"square_foot"}),(0,et.Sn)("design:paramtypes",[Xi,mt])],Ki);let Vt=class wa{mapState;get map(){return this.mapState.map}constructor(V){this.mapState=V}static \u0275fac=function(m){return new(m||wa)(o.rXU(mt))};static \u0275cmp=o.VBU({type:wa,selectors:[["igo-print-tool"]],standalone:!0,features:[o.aNF],decls:1,vars:1,consts:[[3,"map"]],template:function(m,S){1&m&&o.nrm(0,"igo-print",0),2&m&&o.Y8G("map",S.map)},dependencies:[p.NDo],encapsulation:2})};Vt=(0,et.Cg)([(0,Mt.S$)({name:"print",title:"igo.integration.tools.print",icon:"print"}),(0,et.Sn)("design:paramtypes",[mt])],Vt);var _o=r(16256),Tn=r(84133),Yn=r(23984);let ln=(()=>{class J{searchSourceService;storageService;workspaceState;configService;mapState;searchLayerStores=[];searchOverlayStyle={};searchOverlayStyleSelection={};searchOverlayStyleFocus={};focusedOrResolution$$;selectedOrResolution$$;featureMotion={selected:p.BlV.Default,focus:p.BlV.None};searchTermSplitter$=new A.t("|");searchTerm$=new A.t(void 0);searchType$=new A.t(void 0);searchDisabled$=new A.t(!1);searchResultsGeometryEnabled$=new A.t(!1);searchSettingsChange$=new A.t(void 0);selectedResult$=new A.t(void 0);store=new M.D_([]);get searchTypes(){return this.searchSourceService.getEnabledSources().map(m=>m.constructor.type)}constructor(m,S,$,oe,Se){this.searchSourceService=m,this.storageService=S,this.workspaceState=$,this.configService=oe,this.mapState=Se;const Ue=this.configService.getConfig("searchOverlayStyle");Ue&&(this.searchOverlayStyle=Ue.base,this.searchOverlayStyleSelection=Ue.selection,this.searchOverlayStyleFocus=Ue.focus);const it=this.storageService.get("searchResultsGeometryEnabled");it&&this.searchResultsGeometryEnabled$.next(it),this.store.addStrategy(this.createCustomFilterTermStrategy(),!1);const gt=this.searchSourceService.getSources().find(yt=>"workspace"===yt.getId());gt&&this.workspaceState.store.entities$.subscribe(yt=>{const Pt=yt.filter(It=>It instanceof p.ur0&&It.layer.options.workspace.searchIndexEnabled);this.searchSourceService.setWorkspaces(gt,Pt)}),this.monitorLayerDeletion()}monitorLayerDeletion(){this.mapState.map.layers$.subscribe(m=>{this.searchLayerStores.forEach(S=>{if(!m.find(oe=>oe.id===S.layer.id)){const oe=this.searchLayerStores.indexOf(S);this.searchLayerStores.splice(oe,1)}})})}createCustomFilterTermStrategy(){return new M.fR({filterClauseFunc:S=>100===S.entity.meta.score})}activateCustomFilterTermStrategy(){const m=this.store.getStrategyOfType(M.fR);void 0!==m&&m.activate()}deactivateCustomFilterTermStrategy(){const m=this.store.getStrategyOfType(M.fR);void 0!==m&&m.deactivate()}enableSearch(){this.searchDisabled$.next(!1)}disableSearch(){this.searchDisabled$.next(!0)}setSearchTerm(m){this.searchTerm$.next(m)}setSearchType(m){this.searchSourceService.enableSourcesByType(m),this.searchType$.next(m)}setSearchSettingsChange(){this.searchSettingsChange$.next(!0)}setSelectedResult(m){this.selectedResult$.next(m)}setSearchResultsGeometryStatus(m){this.storageService.set("searchResultsGeometryEnabled",m),this.searchResultsGeometryEnabled$.next(m)}static \u0275fac=function(S){return new(S||J)(o.KVO(p.zA1),o.KVO(F.n$),o.KVO(No),o.KVO(mo.we),o.KVO(mt))};static \u0275prov=o.jDH({token:J,factory:J.\u0275fac})}return J})();function Hi(J,V){1&J&&(o.j41(0,"div",4)(1,"section",5)(2,"h4")(3,"strong"),o.EFF(4),o.nI1(5,"translate"),o.k0s()(),o.j41(6,"p")(7,"strong"),o.EFF(8),o.nI1(9,"translate"),o.k0s()(),o.nrm(10,"div",6),o.nI1(11,"translate"),o.nI1(12,"sanitizeHtml"),o.k0s()()),2&J&&(o.R7$(4),o.JRh(o.bMT(5,3,"igo.integration.searchResultsTool.noResults")),o.R7$(4),o.JRh(o.bMT(9,5,"igo.integration.searchResultsTool.doSearch")),o.R7$(2),o.Y8G("innerHTML",o.bMT(12,9,o.bMT(11,7,"igo.integration.searchResultsTool.examples")),o.npT))}function Yr(J,V){if(1&J&&o.nrm(0,"igo-search-add-button",12),2&J){const m=V.result,S=o.XpG(2);o.Y8G("map",S.map)("store",S.store)("stores",S.stores)("layer",m)("saveSearchResultInLayer",S.saveSearchResultInLayer)}}function pi(J,V){if(1&J){const m=o.RV6();o.j41(0,"button",17),o.nI1(1,"async"),o.nI1(2,"translate"),o.bIt("click",function(){o.eBV(m);const $=o.XpG(3);return o.Njj($.zoomToFeatureExtent())}),o.j41(3,"mat-icon",18),o.nI1(4,"async"),o.nI1(5,"async"),o.EFF(6,"zoom_in"),o.k0s()()}if(2&J){const m=o.XpG(3);o.Y8G("matTooltip",o.bMT(2,5,o.bMT(1,3,m.isSelectedResultOutOfView$)?"igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView":"igo.integration.searchResultsTool.zoomOnFeatureTooltip")),o.R7$(3),o.Y8G("matBadge",o.bMT(4,7,m.isSelectedResultOutOfView$)?"!":"")("matBadgeHidden",!1===o.bMT(5,9,m.isSelectedResultOutOfView$))}}function gr(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-panel",13),o.bIt("click",function($){o.eBV(m);const oe=o.XpG(2);return o.Njj(oe.toggleTopPanel($))}),o.j41(1,"button",14),o.bIt("click",function(){o.eBV(m);const $=o.XpG(2);return o.Njj($.toggleTopPanel())}),o.j41(2,"mat-icon"),o.EFF(3),o.nI1(4,"async"),o.k0s()(),o.DNE(5,pi,7,11,"button",15),o.j41(6,"igo-feature-details",16),o.nI1(7,"async"),o.bIt("routingEvent",function(){o.eBV(m);const $=o.XpG(2);return o.Njj($.getRoute())}),o.k0s()()}if(2&J){const m=o.XpG(2);o.Y8G("title",m.featureTitle)("cursorPointer",!0),o.R7$(3),o.JRh("collapsed"===o.bMT(4,7,m.topPanelState$)?"arrow_upward":"arrow_downward"),o.R7$(2),o.Y8G("ngIf",m.feature.geometry),o.R7$(),o.Y8G("feature",o.bMT(7,9,m.feature$))("map",m.map)("toolbox",m.toolState.toolbox)}}function In(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-flexible",7,0),o.nI1(2,"async"),o.j41(3,"div",8)(4,"igo-search-results",9),o.bIt("resultFocus",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onResultFocus($))})("resultSelect",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onResultSelect($))})("resultUnfocus",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onResultUnfocus($))})("resultMouseenter",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onResultFocus($))})("resultMouseleave",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onResultUnfocus($))})("moreResults",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onSearch($))}),o.DNE(5,Yr,1,5,"ng-template",null,1,o.C5r),o.k0s()(),o.j41(7,"div",10),o.DNE(8,gr,8,11,"igo-panel",11),o.nI1(9,"async"),o.k0s()()}if(2&J){const m=o.XpG();o.Y8G("state",o.bMT(2,8,m.feature$)?m.topPanelState:"initial"),o.R7$(4),o.Y8G("store",m.store)("showIcons",m.showIcons)("term",m.term)("termSplitter",m.termSplitter)("settingsChange$",m.settingsChange$)("map",m.map),o.R7$(4),o.Y8G("ngIf",o.bMT(9,10,m.feature$))}}let kt=class Ea{mapState;searchState;elRef;toolState;directionState;showIcons=!0;topPanelStateDefault="expanded";hasFeatureEmphasisOnSelection=!1;saveSearchResultInLayer=!1;showResultsGeometries$$;getRoute$$;shownResultsGeometries=[];shownResultsEmphasisGeometries=[];focusedResult$=new A.t(void 0);isSelectedResultOutOfView$=new A.t(!1);isSelectedResultOutOfView$$;abstractFocusedResult;abstractSelectedResult;debouncedEmpty$=new A.t(!0);debouncedEmpty$$;get store(){return this.searchState.store}get map(){return this.mapState.map}get featureTitle(){return this.feature?(0,M.k0)(this.feature):void 0}get feature$(){return this.store.stateView.firstBy$(V=>V.state.focused).pipe((0,bo.T)(V=>this.feature=V?V.entity.data:void 0))}feature;term="";searchTerm$$;settingsChange$=new A.t(void 0);topPanelState$=new A.t("initial");topPanelState$$;set topPanelState(V){this.topPanelState$.next(V)}get topPanelState(){return this.topPanelState$.value}get termSplitter(){return this.searchState.searchTermSplitter$.value}format=new te.A;get stores(){return this.searchState.searchLayerStores}constructor(V,m,S,$,oe,Se){this.mapState=V,this.searchState=m,this.elRef=S,this.toolState=$,this.directionState=oe,this.hasFeatureEmphasisOnSelection=Se.getConfig("hasFeatureEmphasisOnSelection"),this.saveSearchResultInLayer=Se.getConfig("saveSearchResultInLayer")}ngOnInit(){this.searchTerm$$=this.searchState.searchTerm$.subscribe(V=>{null!=V&&""!==V?(this.term=V,this.debouncedEmpty$.next(!1)):""===V&&this.debouncedEmpty$.next(!0)});for(const V of this.store.stateView.all$().value)!0===this.store.state.get(V.entity).selected&&(this.topPanelState="expanded");this.searchState.searchSettingsChange$.subscribe(()=>{this.settingsChange$.next(!0)}),this.topPanelState$$=this.topPanelState$.subscribe(()=>{const V=this.computeElementRef()[0],m=this.computeElementRef()[1];m&&setTimeout(()=>{this.isScrolledIntoView(V,m)||this.adjustTopPanel(V,m)},Tn.D.transitionTime+50)}),this.hasFeatureEmphasisOnSelection&&(this.searchState.focusedOrResolution$$||(this.searchState.focusedOrResolution$$=(0,lo.z)([this.focusedResult$,this.map.viewController.resolution$]).subscribe(V=>this.buildResultEmphasis(V[0],"focused"))),this.searchState.selectedOrResolution$$||(this.searchState.selectedOrResolution$$=(0,lo.z)([this.searchState.selectedResult$,this.map.viewController.resolution$]).subscribe(V=>this.buildResultEmphasis(V[0],"selected")))),this.monitorResultOutOfView(),this.showResultsGeometries$$=(0,lo.z)([this.searchState.searchResultsGeometryEnabled$,this.store.stateView.all$(),this.focusedResult$,this.searchState.selectedResult$,this.searchState.searchTerm$,this.map.viewController.resolution$]).subscribe(V=>{const m=V[0],S=V[1];this.hasFeatureEmphasisOnSelection&&this.clearFeatureEmphasis("shown"),this.shownResultsGeometries.map(oe=>this.map.queryResultsOverlay.removeFeature(oe)),S.filter(oe=>oe.entity.meta.dataType===p.RI9&&oe.entity.data.geometry&&!oe.state.selected&&!oe.state.focused).map(oe=>{m&&(oe.entity.data.meta.style=(0,p.a72)(Object.assign({},{feature:oe.entity.data},this.searchState.searchOverlayStyle,oe.entity.style?.base?oe.entity.style.base:{})),this.shownResultsGeometries.push(oe.entity.data),this.map.queryResultsOverlay.addFeature(oe.entity.data,p.BlV.None),this.hasFeatureEmphasisOnSelection&&this.buildResultEmphasis(oe.entity,"shown"))})}),this.debouncedEmpty$$=this.store.stateView.empty$.pipe((0,zo.B)(1500)).subscribe(V=>this.debouncedEmpty$.next(V))}monitorResultOutOfView(){this.isSelectedResultOutOfView$$=(0,lo.z)([this.map.viewController.state$,this.searchState.selectedResult$]).pipe((0,zo.B)(100)).subscribe(V=>{const m=V[1];if(m){if(m.data.geometry){const S=(0,p.xHV)(m.data,this.map.projection),$=(0,p.M8B)([S],this.map.viewController.getOlProjection());this.isSelectedResultOutOfView$.next((0,p.asi)(this.map.getExtent(),$))}}else this.isSelectedResultOutOfView$.next(!1)})}buildResultEmphasis(V,m){if("shown"!==m&&this.clearFeatureEmphasis(m),!V||!V.data.geometry)return;const $=(0,p.xHV)(V.data,this.map.projection).getGeometry();if((0,p.WJb)(this.map.viewController,$.getExtent(),.0025)){const oe=$.getExtent(),it=new Ve.A({name:`${m}AbstractResult'`,geometry:new he.A([oe[0]+(oe[2]-oe[0])/2,oe[1]+(oe[3]-oe[1])/2])}),gt=(0,p.M2o)(it,this.map.projection);let yt,Pt=0;switch(m){case"focused":yt=(0,p.DLO)(Object.assign({},{feature:gt},this.searchState.searchOverlayStyleFocus,V.style?.focus?V.style.focus:{})),Pt=2;break;case"shown":yt=(0,p.a72)(Object.assign({},{feature:gt},this.searchState.searchOverlayStyle,V.style?.base?V.style.base:{}));break;case"selected":yt=(0,p.DLO)(Object.assign({},{feature:gt},this.searchState.searchOverlayStyleSelection,V.style?.selection?V.style.selection:{})),Pt=1}gt.meta.style=yt,gt.meta.style.setZIndex(2e3+Pt),this.map.searchResultsOverlay.addFeature(gt,this.searchState.featureMotion.focus),"focused"===m&&(this.abstractFocusedResult=gt),"selected"===m&&(this.abstractSelectedResult=gt),"shown"===m&&this.shownResultsEmphasisGeometries.push(gt)}else this.clearFeatureEmphasis(m)}clearFeatureEmphasis(V){"focused"===V&&this.abstractFocusedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult),this.abstractFocusedResult=void 0),"selected"===V&&this.abstractSelectedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult),this.abstractSelectedResult=void 0),"shown"===V&&(this.shownResultsEmphasisGeometries.map(m=>this.map.searchResultsOverlay.removeFeature(m)),this.shownResultsEmphasisGeometries=[])}ngOnDestroy(){this.topPanelState$$.unsubscribe(),this.searchTerm$$.unsubscribe(),this.isSelectedResultOutOfView$$&&this.isSelectedResultOutOfView$$.unsubscribe(),this.showResultsGeometries$$&&this.showResultsGeometries$$.unsubscribe(),this.getRoute$$&&this.getRoute$$.unsubscribe(),this.debouncedEmpty$$&&this.debouncedEmpty$$.unsubscribe()}onResultFocus(V){if(this.focusedResult$.next(V),V.meta.dataType===p.RI9&&V.data.geometry){V.data.meta.style=(0,p.DLO)(Object.assign({},{feature:V.data},this.searchState.searchOverlayStyleFocus,V.style?.focus?V.style.focus:{}));const m=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(V.meta.id);if(m)return void m.setStyle(V.data.meta.style);this.map.searchResultsOverlay.addFeature(V.data,this.searchState.featureMotion.focus)}}onResultUnfocus(V){if(this.focusedResult$.next(void 0),V.meta.dataType===p.RI9){if(!0===this.store.state.get(V).selected){const m=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(V.meta.id);if(m){const S=(0,p.DLO)(Object.assign({},{feature:V.data},this.searchState.searchOverlayStyleFocus,V.style?.focus?V.style.focus:{}));m.setStyle(S)}return}this.map.searchResultsOverlay.removeFeature(V.data)}}onResultSelect(V){if(this.map.searchResultsOverlay.dataSource.ol.clear(),this.tryAddFeatureToMap(V,this.searchState.featureMotion.selected),this.searchState.setSelectedResult(V),"initial"===this.topPanelState&&(this.topPanelState="collapsed"!==this.topPanelStateDefault?"expanded":"collapsed"),"expanded"===this.topPanelState){const m=this.computeElementRef()[0],S=this.computeElementRef()[1];this.isScrolledIntoView(m,S)||this.adjustTopPanel(m,S)}}onSearch(V){const m=V.results,S=this.store.entities$.value.filter($=>$.source!==V.research.source).concat(m);this.store.load(S);for(const $ of this.store.all())!0===this.store.state.get($).focused&&!0!==this.store.state.get($).selected&&this.store.state.update($,{focused:!1},!0);setTimeout(()=>{const $=this.elRef.nativeElement.querySelector("igo-list");let oe;V.research.request.subscribe(Se=>{oe=Se[0]&&Se[0].source?"icherche"===Se[0].source.getId()?$.querySelector(".icherche .moreResults"):"ilayer"===Se[0].source.getId()?$.querySelector(".ilayer .moreResults"):"nominatim"===Se[0].source.getId()?$.querySelector(".nominatim .moreResults"):$.querySelector("."+Se[0].source.getId()+" .moreResults"):null,null!==oe&&!this.isScrolledIntoView($,oe)&&($.scrollTop=oe.offsetTop+oe.offsetHeight-$.clientHeight)})},250)}computeElementRef(){const V=document.getElementsByTagName("igo-search-results-item"),m=this.elRef.nativeElement.getElementsByTagName("igo-list")[0];let S;for(let $=0;$<V.length;$++)V[$].className.includes("igo-list-item-selected")&&(S=V[$]);return[m,S]}adjustTopPanel(V,m){this.isScrolledIntoView(V,m)||(V.scrollTop=m.offsetTop+m.children[0].offsetHeight-V.clientHeight)}toggleTopPanel(V){V&&"igo-panel-title"!==V.target?.className||(this.topPanelState="expanded"===this.topPanelState?"collapsed":"expanded")}zoomToFeatureExtent(){if(this.feature.geometry){const V=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projectionCode});(0,p.p67)(this.map.viewController,[V],p.BlV.Zoom)}}tryAddFeatureToMap(V,m=p.BlV.Default){if(V.meta.dataType!==p.RI9)return;const S=V.data;S.geometry&&(S.meta.style=(0,p.DLO)(Object.assign({},{feature:S},this.searchState.searchOverlayStyleSelection,V.style?.selection?V.style.selection:{})),this.map.searchResultsOverlay.addFeature(S,m))}isScrolledIntoView(V,m){const $=V.scrollTop,Se=m.offsetTop;return Se+m.clientHeight+6<=$+V.clientHeight&&Se>=$}getRoute(){this.toolState.toolbox.activateTool("directions"),this.directionState.stopsStore.clearStops(),setTimeout(()=>{let V=!1;this.getRoute$$&&this.getRoute$$.unsubscribe(),this.getRoute$$=this.directionState.stopsStore.storeInitialized$.subscribe(m=>{if(this.directionState.stopsStore.storeInitialized$.value&&!V){V=!0;const S=this.directionState.stopsStore.all().find(oe=>1===oe.position);let $;if(this.feature.geometry)if("Point"===this.feature.geometry.type)$=[this.feature.geometry.coordinates[0],this.feature.geometry.coordinates[1]];else{const oe=(0,Yn.A)(this.feature.geometry);$=[oe.geometry.coordinates[0],oe.geometry.coordinates[1]]}if(S.text=this.featureTitle,S.coordinates=$,this.directionState.stopsStore.update(S),this.map.geolocationController.position$.value){const oe=this.map.geolocationController.position$.value,Se=this.directionState.stopsStore.all().find(gt=>0===gt.position),Ue=Ae.pd(oe.position,oe.projection,"EPSG:4326"),it=(0,p.hou)([Ue[0],Ue[1]],6);Se.text=it.join(","),Se.coordinates=it,this.directionState.stopsStore.update(Se)}}})},250)}static \u0275fac=function(m){return new(m||Ea)(o.rXU(mt),o.rXU(ln),o.rXU(o.aKT),o.rXU(At),o.rXU(Fe),o.rXU(mo.we))};static \u0275cmp=o.VBU({type:Ea,selectors:[["igo-search-results-tool"]],inputs:{showIcons:"showIcons",topPanelStateDefault:"topPanelStateDefault",topPanelState:"topPanelState"},standalone:!0,features:[o.aNF],decls:4,vars:6,consts:[["topPanel",""],["igoSearchItemToolbar",""],["style","margin: 10px",4,"ngIf"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state",4,"ngIf"],[2,"margin","10px"],[1,"mat-typography"],[3,"innerHTML"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state"],[1,"igo-content"],["placeholder","false",3,"resultFocus","resultSelect","resultUnfocus","resultMouseenter","resultMouseleave","moreResults","store","showIcons","term","termSplitter","settingsChange$","map"],["igoFlexibleFill","",1,"igo-content"],[3,"title","cursorPointer","click",4,"ngIf"],[3,"map","store","stores","layer","saveSearchResultInLayer"],[3,"click","title","cursorPointer"],["mat-icon-button","","panelLeftButton","",1,"igo-icon-button",3,"click"],["mat-icon-button","","panelRightButton","","class","igo-icon-button","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoFeatureDetailsDirective","",3,"routingEvent","feature","map","toolbox"],["mat-icon-button","","panelRightButton","","matTooltipShowDelay","500",1,"igo-icon-button",3,"click","matTooltip"],["aria-hidden","false","matBadgeColor","accent","matBadgeSize","small",3,"matBadge","matBadgeHidden"]],template:function(m,S){1&m&&(o.DNE(0,Hi,13,11,"div",2),o.nI1(1,"async"),o.DNE(2,In,10,12,"igo-flexible",3),o.nI1(3,"async")),2&m&&(o.Y8G("ngIf",(!S.store||S.store.stateView.empty)&&o.bMT(1,2,S.debouncedEmpty$)),o.R7$(2),o.Y8G("ngIf",!1===o.bMT(3,4,S.debouncedEmpty$)))},dependencies:[H.bT,Tn.D,p.Mni,p.Ecg,a.g,ee.Hl,ee.iY,dt.m_,dt.An,Bt.uc,Bt.oV,_o.Y,_o.k,p._UF,H.Jj,ut.Ck,Qt.D9,Tt.b8],encapsulation:2,changeDetection:0})};kt=(0,et.Cg)([(0,Mt.S$)({name:"searchResults",title:"igo.integration.tools.searchResults",icon:"search"}),(0,et.Sn)("design:paramtypes",[mt,ln,o.aKT,At,Fe,mo.we])],kt);var $a=r(1181),Ut=r(92055);function Qo(J,V){1&J&&o.nrm(0,"igo-form-field",8),2&J&&o.Y8G("field",V.$implicit)}function Ct(J,V){if(1&J&&(o.j41(0,"div",6),o.DNE(1,Qo,1,1,"igo-form-field",7),o.k0s()),2&J){const m=o.XpG().ngIf;o.R7$(),o.Y8G("ngForOf",m.fields)}}function hr(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-form",1),o.nI1(1,"async"),o.bIt("submitForm",function($){o.eBV(m);const oe=o.XpG();return o.Njj(oe.onSubmit($))}),o.DNE(2,Ct,2,1,"div",2),o.j41(3,"div",3)(4,"button",4),o.bIt("click",function(){o.eBV(m);const $=o.XpG();return o.Njj($.clearForm())}),o.EFF(5),o.nI1(6,"translate"),o.k0s(),o.j41(7,"button",5),o.EFF(8),o.nI1(9,"translate"),o.k0s()()()}if(2&J){const m=V.ngIf,S=o.XpG();o.Y8G("form",m)("formData",o.bMT(1,6,S.data$)),o.R7$(2),o.Y8G("ngIf",m.fields.length),o.R7$(3),o.SpI(" ",o.bMT(6,8,"igo.integration.dataIssueReporterTool.reset.button")," "),o.R7$(2),o.Y8G("disabled",S.submitDisabled),o.R7$(),o.SpI(" ",o.bMT(9,10,"igo.integration.dataIssueReporterTool.submit.button")," ")}}let zi=class Da{mapState;formService;languageService;messageService;httpClient;url;get map(){return this.mapState.map}form$=new A.t(void 0);data$=new A.t(void 0);submitDisabled=!0;valueChanges$$;constructor(V,m,S,$,oe){this.mapState=V,this.formService=m,this.languageService=S,this.messageService=$,this.httpClient=oe}ngOnInit(){(0,lo.z)([this.languageService.language$,this.map.layers$]).subscribe(([V,m])=>{const S=m.filter(Ue=>Ue.baseLayer||Ue.showInLayerList).map(Ue=>({value:`${Ue.title}-${Ue.id}`,title:Ue.title})),oe=[{name:"geometry",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.geometry"),type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!1,drawGuide:0,drawGuidePlaceholder:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.drawGuidePlaceholder"),drawStyle:new G.Ay({stroke:new U.A({color:[255,0,0,1],width:2}),fill:new N.A({color:[255,0,0,.2]}),image:new W.A({radius:8,stroke:new U.A({color:[255,0,0,1]}),fill:new N.A({color:[255,0,0,.2]})})}),overlayStyle:new G.Ay({stroke:new U.A({color:[0,255,0,1],width:2}),fill:new N.A({color:[0,255,0,.2]}),image:new W.A({radius:8,stroke:new U.A({color:[0,255,0,1]}),fill:new N.A({color:[0,255,0,.2]})})})}},{name:"layer",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.layer"),type:"select",options:{cols:2},inputs:{choices:S}},{name:"desc",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.description"),type:"textarea",options:{validator:x.k0.required}},{name:"email",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.email"),options:{validator:x.k0.email}}].map(Ue=>this.formService.field(Ue)),Se=this.formService.form(oe,[]);this.valueChanges$$=Se.control.valueChanges.subscribe(()=>{this.submitDisabled=!Se.control.valid}),this.form$.next(Se)})}ngOnDestroy(){this.valueChanges$$.unsubscribe()}clearForm(){this.form$.value.control.reset()}onSubmit(V){const m="igo.integration.dataIssueReporterTool.submit.title";this.url?(this.httpClient.post(this.url,V).subscribe(()=>{this.messageService.success("igo.integration.dataIssueReporterTool.submit.message",m)}),this.clearForm()):(this.messageService.alert("igo.integration.dataIssueReporterTool.submit.setupMessage",m),alert(JSON.stringify(V)))}static \u0275fac=function(m){return new(m||Da)(o.rXU(mt),o.rXU(Z.ux),o.rXU(ut.gw),o.rXU(oo.bg),o.rXU(jt.Qq))};static \u0275cmp=o.VBU({type:Da,selectors:[["igo-issue-reporter-tool"]],inputs:{url:"url"},decls:2,vars:3,consts:[[3,"form","formData","submitForm",4,"ngIf"],[3,"submitForm","form","formData"],["class","form-container",4,"ngIf"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"],[1,"form-container"],[3,"field",4,"ngFor","ngForOf"],[3,"field"]],template:function(m,S){1&m&&(o.DNE(0,hr,10,12,"igo-form",0),o.nI1(1,"async")),2&m&&o.Y8G("ngIf",o.bMT(1,1,S.form$))},dependencies:[H.Sq,H.bT,ee.$z,$a.K,Ut.s,H.Jj,Qt.D9],styles:["[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%]{display:block;height:auto}"]})};zi=(0,et.Cg)([(0,Mt.S$)({name:"dataIssueReporter",title:"igo.integration.tools.dataIssueReporter",icon:"feedback"}),(0,et.Sn)("design:paramtypes",[mt,Z.ux,ut.gw,oo.bg,jt.Qq])],zi),r(95374);var _r=r(9168),yr=r(18537),vr=r(51567),Xr=r(8004);let br=(()=>{class J{overlay;viewContainerRef;elementRef;overlayRef;sub;menuContext;menuPosition=new o.bkB;constructor(m,S,$){this.overlay=m,this.viewContainerRef=S,this.elementRef=$}onContextMenu(m){let S,$;if(m instanceof MouseEvent?(S=m.x,$=m.y):m instanceof TouchEvent&&(S=m.touches[0].pageX,$=m.touches[0].pageY),!S||!$)return;this.close(),m.preventDefault(),this.menuPosition.emit({x:S,y:$}),this.overlayRef=null;const oe=this.overlay.position().flexibleConnectedTo({x:S,y:$}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}]);this.overlayRef=this.overlay.create({positionStrategy:oe,scrollStrategy:this.overlay.scrollStrategies.close()}),this.overlayRef.attach(new _r.VA(this.menuContext,this.viewContainerRef,{$implicit:void 0})),this.sub=(0,yr.R)(document,"click").pipe((0,vr.p)(Se=>{const Ue=Se.target;return this.close(),!!this.overlayRef&&!this.overlayRef.overlayElement.contains(Ue)}),(0,co.s)(1)).subscribe(()=>this.close()),this.sub=(0,yr.R)(document,"contextmenu").pipe((0,vr.p)(Se=>{const Ue=Se.target;if(Ue&&!this.elementRef.nativeElement.contains(Ue)&&!this.overlayRef.overlayElement.contains(Ue))return!0;Se.preventDefault()}),(0,co.s)(1)).subscribe(()=>this.close())}close(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null),this.sub&&this.sub.unsubscribe()}static \u0275fac=function(S){return new(S||J)(o.rXU(Xr.hJ),o.rXU(o.c1b),o.rXU(o.aKT))};static \u0275dir=o.FsC({type:J,selectors:[["","igoContextMenu",""]],hostBindings:function(S,$){1&S&&o.bIt("longpress",function(Se){return $.onContextMenu(Se)})("contextmenu",function(Se){return $.onContextMenu(Se)})},inputs:{menuContext:[o.Mj6.None,"igoContextMenu","menuContext"]},outputs:{menuPosition:"menuPosition"},standalone:!0})}return J})(),di=(()=>{class J{touchTimeout;touchDuration=400;onlyIOS=!0;longpress=new o.bkB;constructor(){}touchstart(m){m.touches.length>1?this.touchEnd():this.touchTimeout=setTimeout(()=>{this.onlyIOS?"iOS"===rn.N1.getOSName()&&this.longpress.emit(m):this.longpress.emit(m)},this.touchDuration)}touchend(){this.touchEnd()}touchEnd(){clearTimeout(this.touchTimeout)}static \u0275fac=function(S){return new(S||J)};static \u0275dir=o.FsC({type:J,selectors:[["","igoLongPress",""]],hostBindings:function(S,$){1&S&&o.bIt("touchstart",function(Se){return $.touchstart(Se)})("touchmove",function(){return $.touchend()})("touchcancel",function(){return $.touchend()})("touchend",function(){return $.touchend()})},inputs:{touchDuration:"touchDuration",onlyIOS:"onlyIOS"},outputs:{longpress:"longpress"},standalone:!0})}return J})();var Kr=r(11439),Hr=r(92142),zr=r(52342),Jr=r(62739);const Zr=["mapBrowser"],Qr=()=>["ConfigService","LanguageService"];function qr(J,V){if(1&J&&(o.j41(0,"span",12),o.EFF(1),o.k0s()),2&J){const m=o.XpG();o.R7$(),o.SpI(" Pointer activated: ",m.igoSearchPointerSummaryEnabled," (F2 activate/deactivate the pointer location). ")}}function es(J,V){if(1&J&&o.nrm(0,"igo-search-add-button",13),2&J){const m=V.result,S=o.XpG();o.Y8G("map",S.map)("layer",m)}}function ts(J,V){if(1&J&&(o.j41(0,"igo-panel",12),o.nrm(1,"igo-feature-details",14),o.k0s()),2&J){const m=o.XpG();o.R7$(),o.Y8G("feature",m.selectedFeature)}}function os(J,V){if(1&J&&o.nrm(0,"igo-actionbar",15),2&J){const m=o.XpG();o.Y8G("store",m.store)("withIcon",!1)("horizontal",!0)("mode",m.actionBarMode)}}let ns=(()=>{class J{mapService;layerService;searchState;mediaService;storageService;store=new ze.uw([]);actionBarMode=ze.rS.Context;igoSearchPointerSummaryEnabled=!1;termSplitter="|";map=new p.y6n({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};mapBrowser;lonlat;mapProjection;term;settingsChange$=new A.t(void 0);get searchStore(){return this.searchState.store}get isTouchScreen(){return this.mediaService.isTouchScreen()}selectedFeature;igoReverseSearchCoordsFormatEnabled;constructor(m,S,$,oe,Se){this.mapService=m,this.layerService=S,this.searchState=$,this.mediaService=oe,this.storageService=Se,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(Ue=>this.map.addLayer(Ue)),this.igoReverseSearchCoordsFormatEnabled=!!this.storageService.get("reverseSearchCoordsFormatEnabled")||!1}onPointerSummaryStatusChange(m){this.igoSearchPointerSummaryEnabled=m}onSearchTermChange(m){this.term=m,this.searchState.setSearchTerm(m),m.replace(/(#[^\s]*)/g,"").trim().length<2&&(this.searchStore.clear(),this.selectedFeature=void 0)}onSearch(m){const S=m.results;this.searchStore.state.updateAll({focused:!1,selected:!1});const $=this.searchStore.entities$.value.filter(oe=>oe.source!==m.research.source).concat(S);this.searchStore.updateMany($)}onReverseCoordsFormatStatusChange(m){this.storageService.set("reverseSearchCoordsFormatEnabled",m),this.igoReverseSearchCoordsFormatEnabled=m}onSearchSettingsChange(){this.settingsChange$.next(!0)}onResultFocus(m){this.tryAddFeatureToMap(m,this.searchState.featureMotion.focus),this.selectedFeature=m.data}onResultSelect(m){this.tryAddFeatureToMap(m,this.searchState.featureMotion.selected),this.selectedFeature=m.data}tryAddFeatureToMap(m,S=p.BlV.Default){m.meta.dataType===p.RI9&&void 0!==m.data.geometry&&this.map.searchResultsOverlay.setFeatures([m.data],S)}ngOnInit(){this.store.load([{id:"coordinates",title:"coordinates",handler:()=>this.searchCoordinate(this.lonlat)},{id:"googleMaps",title:"googleMap",handler:()=>this.openGoogleMaps(this.lonlat)},{id:"googleStreetView",title:"googleStreetView",handler:()=>this.openGoogleStreetView(this.lonlat)}])}ngOnDestroy(){this.store.destroy()}removeFeatureFromMap(){this.map.searchResultsOverlay.clear()}onContextMenuOpen(m){const S=this.mapPosition(m),$=this.mapService.getMap().ol.getCoordinateFromPixel(S);this.mapProjection=this.mapService.getMap().projectionCode,this.lonlat=Ae.pd($,this.mapProjection,"EPSG:4326")}mapPosition(m){const S=m;return S.y=S.y-this.mapBrowser.nativeElement.getBoundingClientRect().top+window.scrollY,S.x=S.x-this.mapBrowser.nativeElement.getBoundingClientRect().left+window.scrollX,[S.x,S.y]}searchCoordinate(m){this.searchStore.clear(),this.term=this.igoReverseSearchCoordsFormatEnabled?m.reverse().map(S=>S.toFixed(6)).join(", "):m.map(S=>S.toFixed(6)).join(", ")}openGoogleMaps(m){window.open(p.viy.getGoogleMapsCoordLink(m[0],m[1]))}openGoogleStreetView(m){window.open(p.viy.getGoogleStreetViewLink(m[0],m[1]))}static \u0275fac=function(S){return new(S||J)(o.rXU(p.uk7),o.rXU(p.BY8),o.rXU(ln),o.rXU(O.u1),o.rXU(F.n$))};static \u0275cmp=o.VBU({type:J,selectors:[["app-search"]],viewQuery:function(S,$){if(1&S&&o.GBs(Zr,7,o.aKT),2&S){let oe;o.mGM(oe=o.lsd())&&($.mapBrowser=oe.first)}},standalone:!0,features:[o.Jv_([(0,p.yVI)([(0,p.JVX)(),(0,p.FXP)()],{analytics:!0}),ln]),o.aNF],decls:15,vars:19,consts:[["mapBrowser",""],["igoSearchItemToolbar",""],["actionbarMenu",""],["title","Search","subtitle","Geo",3,"dependencies"],["codeFolder","geo/search","configFolder","environments"],["title","Details",4,"ngIf"],["igoOverlay","","igoLongPress","","igoSearchPointerSummary","",3,"menuPosition","map","view","igoContextMenu","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Search"],[3,"pointerSummaryStatus","searchTermChange","search","clearFeature","searchSettingsChange","reverseSearchCoordsFormatStatus","term","searchSettings","store","termSplitter","reverseSearchCoordsFormatEnabled"],["placeholder","false",3,"resultFocus","resultSelect","moreResults","store","term","termSplitter","settingsChange$"],["title","Details"],[3,"map","layer"],[3,"feature"],[3,"store","withIcon","horizontal","mode"]],template:function(S,$){if(1&S){const oe=o.RV6();o.j41(0,"app-doc-viewer",3)(1,"app-example-viewer",4),o.DNE(2,qr,2,1,"span",5),o.j41(3,"igo-map-browser",6,0),o.bIt("menuPosition",function(Ue){return o.eBV(oe),o.Njj($.onContextMenuOpen(Ue))}),o.j41(5,"div",7),o.nrm(6,"igo-zoom-button",8),o.k0s()(),o.j41(7,"igo-panel",9)(8,"igo-search-bar",10),o.bIt("pointerSummaryStatus",function(Ue){return o.eBV(oe),o.Njj($.onPointerSummaryStatusChange(Ue))})("searchTermChange",function(Ue){return o.eBV(oe),o.Njj($.onSearchTermChange(Ue))})("search",function(Ue){return o.eBV(oe),o.Njj($.onSearch(Ue))})("clearFeature",function(){return o.eBV(oe),o.Njj($.removeFeatureFromMap())})("searchSettingsChange",function(){return o.eBV(oe),o.Njj($.onSearchSettingsChange())})("reverseSearchCoordsFormatStatus",function(Ue){return o.eBV(oe),o.Njj($.onReverseCoordsFormatStatusChange(Ue))}),o.k0s(),o.j41(9,"igo-search-results",11),o.bIt("resultFocus",function(Ue){return o.eBV(oe),o.Njj($.onResultFocus(Ue))})("resultSelect",function(Ue){return o.eBV(oe),o.Njj($.onResultSelect(Ue))})("moreResults",function(Ue){return o.eBV(oe),o.Njj($.onSearch(Ue))}),o.DNE(10,es,1,2,"ng-template",null,1,o.C5r),o.k0s()(),o.DNE(12,ts,2,1,"igo-panel",5)(13,os,1,4,"ng-template",null,2,o.C5r),o.k0s()()}if(2&S){const oe=o.sdS(14);o.Y8G("dependencies",o.lJ4(18,Qr)),o.R7$(2),o.Y8G("ngIf",!$.isTouchScreen),o.R7$(),o.Y8G("map",$.map)("view",$.view)("igoContextMenu",oe)("igoSearchPointerSummaryDelay",500)("igoSearchPointerSummaryEnabled",$.igoSearchPointerSummaryEnabled),o.R7$(3),o.Y8G("map",$.map),o.R7$(2),o.Y8G("term",$.term)("searchSettings",!0)("store",$.searchStore)("termSplitter",$.termSplitter)("reverseSearchCoordsFormatEnabled",$.igoReverseSearchCoordsFormatEnabled),o.R7$(),o.Y8G("store",$.searchStore)("term",$.term)("termSplitter",$.termSplitter)("settingsChange$",$.settingsChange$),o.R7$(3),o.Y8G("ngIf",$.selectedFeature)}},dependencies:[e.g,c.s,H.bT,p.KnQ,p.LzH,br,di,p.Qmf,Kr.L,Hr.M,zr.E,Jr.d,a.g,ze.Vn,p._UF],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{height:100%;width:100%;padding-top:10px}"]})}return J})();const is=()=>["LanguageService"];function Zi(J,V){if(1&J&&(o.j41(0,"p"),o.EFF(1),o.k0s()),2&J){const m=o.XpG();o.R7$(),o.JRh(m.pointerCoord)}}let rs=(()=>{class J{dataSourceService;layerService;mediaService;pointerCoord;pointerCoordDelay=0;map=new p.y6n({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,rotation:.75};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(m,S,$){this.dataSourceService=m,this.layerService=S,this.mediaService=$,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(oe=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:oe,visible:!0,baseLayer:!0}))})}onPointerMove(m){this.pointerCoord=m}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8),o.rXU(O.u1))};static \u0275cmp=o.VBU({type:J,selectors:[["app-simple-map"]],standalone:!0,features:[o.aNF],decls:13,vars:12,consts:[["title","Simple Map","subtitle","Geo",3,"dependencies"],["codeFolder","geo/simple-map"],["igoPointerPosition","",3,"pointerPositionCoord","map","view","pointerPositionDelay"],[3,"infoContent"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[4,"ngIf"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.bIt("pointerPositionCoord",function(Se){return $.onPointerMove(Se)}),o.nrm(3,"igo-info-section",3),o.j41(4,"div",4),o.nrm(5,"div",5)(6,"igo-rotation-button",6),o.k0s(),o.j41(7,"div",7),o.nrm(8,"igo-home-extent-button",8)(9,"igo-wake-lock-button")(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.k0s()(),o.DNE(12,Zi,2,1,"p",10),o.k0s()()),2&S&&(o.Y8G("dependencies",o.lJ4(11,is)),o.R7$(2),o.Y8G("map",$.map)("view",$.view)("pointerPositionDelay",$.pointerCoordDelay),o.R7$(),o.Y8G("infoContent",null==$.pointerCoord?null:$.pointerCoord.toString()),o.R7$(3),o.Y8G("showIfNoRotation",!0)("map",$.map),o.R7$(2),o.Y8G("map",$.map),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("map",$.map),o.R7$(),o.Y8G("ngIf",!$.isTouchScreen))},dependencies:[e.g,c.s,p.xLv,p.hUG,p.Xy5,p.KnQ,p.wes,p.we_,p.nH3,p.LzH,H.bT],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:350px}"]})}return J})();const ss=()=>["LanguageService"];function as(J,V){if(1&J&&(o.qex(0),o.nrm(1,"igo-feature-details",11),o.bVm()),2&J){const m=V.ngIf;o.R7$(),o.Y8G("feature",m)}}let ls=(()=>{class J{matIconRegistry;spatialFilterService;dataSourceService;layerService;messageService;languageService;cdRef;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};type;itemType=p.KXJ.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new A.t(void 0);format=new te.A;store=new M.D_([]);spatialListStore=new M.D_([]);loading=!1;thematicLength=0;measureUnit=p.$Rc.Meters;unsubscribe$=new b.B;defaultStyle;constructor(m,S,$,oe,Se,Ue,it){this.matIconRegistry=m,this.spatialFilterService=S,this.dataSourceService=$,this.layerService=oe,this.messageService=Se,this.languageService=Ue,this.cdRef=it,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(gt=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:gt,baseLayer:!0,visible:!0}))})}ngOnInit(){for(const m of this.map.layers)m.title&&m.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(m)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(m){this.type=m,this.queryType=void 0}getOutputQueryType(m){this.queryType=m,this.queryType&&this.loadFilterList()}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,xe.Q)(this.unsubscribe$)).subscribe(m=>{m.sort((S,$)=>S.properties.nom<$.properties.nom?-1:S.properties.nom>$.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(m)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===p.R22.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let S,m=!0;(0===this.buffer||this.type===p.R22.Point)&&this.tryAddFeaturesToMap([this.zone]),S=this.itemType!==p.KXJ.Thematics?[{name:""}]:this.thematics,this.measureUnit===p.$Rc.Kilometers&&this.type!==p.R22.Point&&(this.buffer=1e3*this.buffer),this.type===p.R22.Polygon&&(this.buffer=0);const $=[];S.forEach(oe=>{$.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,oe,this.buffer).pipe((0,He.M)(Se=>{this.store.insertMany(Se);const Ue=[],it=[];let gt,yt;Se.forEach(Pt=>{Pt.geometry.type===p.R22.Point?(Pt.properties.longitude=Pt.geometry.coordinates[0],Pt.properties.latitude=Pt.geometry.coordinates[1],Ue.push(Pt),gt=Pt.meta.id):(it.push(Pt),yt=Pt.meta.id)}),this.tryAddPointToMap(Ue,gt),this.tryAddLayerToMap(it,yt),Se.length?(m=!1,this.thematicLength+=1,oe.zeroResults=!1,this.cdRef.detectChanges()):oe.zeroResults=!0,Se.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,ge.p)($).pipe((0,xe.Q)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,m&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(m,S){this.zone=m,m&&(S?this.tryAddFeaturesToMap([m],!0):this.tryAddFeaturesToMap([m]),this.zoomToFeatureExtent(m))}tryAddFeaturesToMap(m,S){let $=1;for(const oe of m){if(this.type===p.R22.Predefined)for(const Se of this.layers){if(Se.options._internal&&Se.options._internal.code===oe.properties.code&&!S){if(!Se.title?.startsWith("Zone")){const Ue=this.layers.indexOf(Se);this.layers.splice(Ue,1)}return}if(Se.title?.startsWith("Zone")){this.activeLayers=[];const Ue=this.layers.indexOf(Se);this.layers.splice(Ue,1),this.map.removeLayer(Se)}}else{if(S)for(const Se of this.activeLayers)if(1===this.activeLayers.length&&Se.title?.startsWith("Zone")){const Ue=this.layers.indexOf(Se);this.layers.splice(Ue,1),this.map.removeLayer(Se)}this.activeLayers=[]}for(const Se of this.layers)Se.title?.startsWith("Zone")&&$++;this.defaultStyle=(Se,Ue)=>{const it=m[0].geometry.coordinates;return new G.Ay({image:new W.A({radius:it?this.buffer/Math.cos(Math.PI/180*it[1])/Ue:void 0,fill:new N.A({color:"rgba(200, 200, 20, 0.2)"}),stroke:new U.A({width:1,color:"orange"})}),stroke:new U.A({width:1,color:"orange"}),fill:new N.A({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,co.s)(1)).subscribe(Se=>{const Ue=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===p.R22.Predefined?oe.properties.code:void 0},source:Se,visible:!0}),it=m.map(yt=>(0,p.xHV)(yt,this.map.projectionCode));if(this.type!==p.R22.Predefined){const yt=this.type===p.R22.Point?"Cercle":"Polygone";it[0].set("nom","Zone",!0),it[0].set("type",yt,!0)}Se.ol.addFeatures(it),Ue.ol.setStyle(this.defaultStyle),this.map.addLayer(Ue),this.layers.push(Ue),this.activeLayers.push(Ue),this.cdRef.detectChanges()})}}tryAddPointToMap(m,S){let $=1;if(m.length){if(void 0===this.map)return;for(const oe of this.layers)oe.title?.startsWith(m[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:S,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,co.s)(1)).subscribe(oe=>{const Se=m[0].meta.icon;let Ue;Ue=Se&&this.createSvgIcon(Se)||(0,p.O5R)();const it=this.layerService.createLayer({isIgoInternalLayer:!0,title:m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:oe,visible:!0,style:Ue}),gt=m.map(Pt=>(0,p.xHV)(Pt,this.map.projectionCode));oe.ol.getSource().addFeatures(gt),this.layers.find(Pt=>Pt.id===it.id)&&(this.map.removeLayer(this.layers.find(Pt=>Pt.id===it.id)),$-=1,it.title=m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),it.options.title=it.title),this.iterator=$,this.map.addLayer(it),this.layers.push(it),this.pushLayer(it),this.cdRef.detectChanges()})}}createSvgIcon(m){let S;return this.matIconRegistry.getNamedSvgIcon(m).subscribe($=>{const oe=new XMLSerializer;$.setAttribute("width","30"),$.setAttribute("height","30"),$.setAttribute("fill","rgba(0, 128, 255)"),$.setAttribute("stroke","white");const Se=oe.serializeToString($);S=new G.Ay({image:new se.A({src:"data:image/svg+xml;utf8,"+Se})})}),S}tryAddLayerToMap(m,S){let $=1;if(m.length){if(void 0===this.map)return;for(const oe of this.layers)oe.title?.startsWith(m[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"vector",id:S,queryable:!0}).pipe((0,co.s)(1)).subscribe(oe=>{const Se=this.layerService.createLayer({isIgoInternalLayer:!0,title:m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:oe,visible:!0}),Ue=m.map(gt=>(0,p.xHV)(gt,this.map.projectionCode));oe.ol.addFeatures(Ue),this.layers.find(gt=>gt.id===Se.id)&&(this.map.removeLayer(this.layers.find(gt=>gt.id===Se.id)),$-=1,Se.title=m[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),Se.options.title=Se.title),this.map.addLayer(Se),this.layers.push(Se),this.pushLayer(Se),this.cdRef.detectChanges()})}}zoomToFeatureExtent(m){if(m){const S=this.format.readFeature(m,{dataProjection:m.projection,featureProjection:this.map.projectionCode});(0,p.p67)(this.map.viewController,[S],p.BlV.Zoom)}}pushLayer(m){for(const S of this.activeLayers)if(S.id===m.id)return;this.activeLayers.push(m)}static \u0275fac=function(S){return new(S||J)(o.rXU(dt.tp),o.rXU(p._We),o.rXU(p.n_V),o.rXU(p.BY8),o.rXU(oo.bg),o.rXU(ut.gw),o.rXU(o.gRc))};static \u0275cmp=o.VBU({type:J,selectors:[["app-spatial-filter"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.aNF],decls:15,vars:22,consts:[["title","Spatial Filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/spatial-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100"],[3,"eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange","store","selectedQueryType","zone","layers"],[3,"radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent","type","queryType","map","zone","loading","store","layers","allLayers","thematicLength"],[4,"ngIf"],[3,"feature"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.nrm(6,"igo-zoom-button",5),o.k0s()()(),o.j41(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7)(10,"igo-spatial-filter-type",8),o.bIt("eventType",function(Se){return $.getOutputType(Se)})("eventQueryType",function(Se){return $.getOutputQueryType(Se)})("zoneChange",function(Se){return $.onZoneChange(Se)})("zoneWithBufferChange",function(Se){return $.onZoneChange(Se,!0)})("bufferChange",function(Se){return $.buffer=Se})("measureUnitChange",function(Se){return $.measureUnit=Se}),o.k0s(),o.j41(11,"igo-spatial-filter-item",9),o.bIt("radiusEvent",function(Se){return $.buffer=Se})("bufferEvent",function(Se){return $.buffer=Se})("measureUnitChange",function(Se){return $.measureUnit=Se})("freehandControl",function(Se){return $.freehandDrawIsActive=Se})("drawZoneEvent",function(Se){return $.zone=Se})("zoneWithBufferChange",function(Se){return $.onZoneChange(Se,!0)})("itemTypeChange",function(Se){return $.itemType=Se})("thematicChange",function(Se){return $.thematics=Se})("toggleSearch",function(){return $.getOutputToggleSearch()})("clearButtonEvent",function(){return $.clearMap()})("clearSearchEvent",function(){return $.getOutputClearSearch()}),o.k0s()(),o.j41(12,"igo-panel",7),o.DNE(13,as,2,1,"ng-container",10),o.nI1(14,"async"),o.k0s()()()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(21,ss)),o.R7$(4),o.Y8G("map",$.map)("view",$.view)("queryFeatures",!0),o.R7$(2),o.Y8G("map",$.map),o.R7$(4),o.Y8G("store",$.spatialListStore)("selectedQueryType",$.queryType)("zone",$.zone)("layers",$.activeLayers),o.R7$(),o.Y8G("type",$.type)("queryType",$.queryType)("map",$.map)("zone",$.zone)("loading",$.loading)("store",$.store)("layers",$.activeLayers)("allLayers",$.layers)("thematicLength",$.thematicLength),o.R7$(2),o.Y8G("ngIf",o.bMT(14,19,$.selectedFeature$)))},dependencies:[e.g,c.s,v.Fe,v.B_,v.NS,p.KnQ,p.LzH,p.izC,Qe.E,a.g,p.Q5v,p.J_O,H.bT,p._UF,H.Jj],styles:["[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]     .thematics-header{max-width:225px}"],changeDetection:0})}return J})();const cs=()=>["LanguageService"];let us=(()=>{class J{dataSourceService;layerService;map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(m,S){this.dataSourceService=m,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(oe=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:oe}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},timeFilterable:!0,timeFilter:{min:"2013",max:"2019",range:!1,type:p.UMS.YEAR,style:p.Zv.SLIDER,step:1}}).subscribe(oe=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:oe}))})}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8))};static \u0275cmp=o.VBU({type:J,selectors:[["app-time-filter"]],standalone:!0,features:[o.aNF],decls:11,vars:6,consts:[["title","Time filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/time-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"layers"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.nrm(6,"igo-zoom-button",5),o.k0s()()(),o.j41(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.nrm(10,"igo-time-filter-list",8),o.k0s()()()()()()),2&S&&(o.Y8G("dependencies",o.lJ4(5,cs)),o.R7$(4),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(4),o.Y8G("layers",$.map.layers))},dependencies:[e.g,c.s,v.Fe,v.B_,v.NS,p.KnQ,p.LzH,a.g,p.TPU]})}return J})();var Cr=r(53777);function ps(J,V){if(1&J){const m=o.RV6();o.j41(0,"igo-entity-table-paginator",8),o.bIt("paginatorChange",function($){o.eBV(m);const oe=o.XpG(2);return o.Njj(oe.paginatorChange($))}),o.k0s()}if(2&J){const m=o.XpG().ngIf,S=o.XpG();o.Y8G("store",m.entityStore)("paginatorOptions",S.paginatorOptions)("entitySortChange$",S.entitySortChange$)}}function ds(J,V){if(1&J&&(o.qex(0),o.DNE(1,ps,1,3,"igo-entity-table-paginator",7),o.nI1(2,"async"),o.bVm()),2&J){const m=V.ngIf;o.R7$(),o.Y8G("ngIf",o.bMT(2,1,m.inResolutionRange$))}}function ms(J,V){if(1&J&&o.nrm(0,"igo-actionbar",12),2&J){const m=o.XpG().ngIf,S=o.XpG();o.Y8G("store",m.actionStore)("horizontal",!0)("withToggleButton",!0)("withTitle",!0)("mode",S.actionbarMode)}}function gs(J,V){if(1&J&&o.nrm(0,"igo-entity-table",13),2&J){const m=o.XpG().ngIf,S=o.XpG();o.Y8G("paginator",S.workspacePaginator)("scrollBehavior",S.scrollBehavior)("store",m.entityStore)("template",m.meta.tableTemplate)}}function hs(J,V){1&J&&(o.j41(0,"mat-card-content"),o.EFF(1," No data available at this scale. Please zoom in. "),o.k0s())}function fs(J,V){if(1&J&&(o.qex(0),o.DNE(1,ms,1,5,"igo-actionbar",9)(2,gs,1,4,"igo-entity-table",10),o.nI1(3,"async"),o.DNE(4,hs,2,0,"mat-card-content",6),o.nI1(5,"async"),o.nrm(6,"igo-workspace-widget-outlet",11),o.bVm()),2&J){const m=V.ngIf;o.R7$(),o.Y8G("ngIf",m.actionStore),o.R7$(),o.Y8G("ngIf",m.entityStore&&m.meta&&m.meta.tableTemplate&&o.bMT(3,4,m.inResolutionRange$)),o.R7$(2),o.Y8G("ngIf",!1===o.bMT(5,6,m.inResolutionRange$)),o.R7$(2),o.Y8G("workspace",m)}}const _s=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Simple map",path:"simple-map",component:rs},{title:"Layer",path:"layer",component:ce},{title:"Legend",path:"legend",component:be},{title:"Overlay",path:"overlay",component:Be},{title:"Geometry",path:"geometry",component:u},{title:"Feature",path:"feature",component:X},{title:"Hover",path:"hover",component:z},{title:"Measure",path:"measure",component:Le},{title:"Draw",path:"draw",component:h},{title:"Query",path:"query",component:Ye},{title:"Catalog",path:"catalog",component:R},{title:"Search",path:"search",component:ns},{title:"Print",path:"print",component:Ie},{title:"Import/Export",path:"import-export",component:ye},{title:"Directions",path:"directions",component:_},{title:"Time Filter",path:"time-filter",component:us},{title:"OGC Filter",path:"ogc-filter",component:Xe},{title:"Spatial Filter",path:"spatial-filter",component:ls},{title:"Workspace",path:"workspace",component:(()=>{class J{dataSourceService;layerService;workspaceState;workspacePaginator;entitySortChange$=new A.t(!1);paginatorOptions={pageSize:5,pageSizeOptions:[1,5,10,15,30,50,100],showFirstLastButtons:!0};map=new p.y6n({controls:{attribution:{collapsed:!0}}});view={center:[-72,47.2],zoom:5};get workspaceStore(){return this.workspaceState.store}selectedWorkspace$;actionbarMode=ze.rS.Overlay;scrollBehavior=M.Tf.Instant;constructor(m,S,$){this.dataSourceService=m,this.layerService=S,this.workspaceState=$}ngOnInit(){this.selectedWorkspace$=this.workspaceStore.stateView.firstBy$(S=>!0===S.state.selected).pipe((0,bo.T)(S=>{const $=void 0===S?void 0:S.entity;return $&&$.actionStore.view.filter(oe=>"wfsDownload"!==oe.id),$})),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(S=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:S,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{featureTypes:"etablissement_mtq",fieldNameGeometry:"geometry",version:"2.0.0",outputFormat:"geojson"},sourceFields:[{name:"idetablis",alias:"ID"},{name:"nometablis",alias:"Name"},{name:"typetablis",alias:"Type"}]}).subscribe(S=>{this.map.addLayer(this.layerService.createLayer({title:"Simple WFS ",maxResolution:3e3,visible:!0,source:S}))})}paginatorChange(m){this.workspacePaginator=m}static \u0275fac=function(S){return new(S||J)(o.rXU(p.n_V),o.rXU(p.BY8),o.rXU(No))};static \u0275cmp=o.VBU({type:J,selectors:[["app-workspace"]],standalone:!0,features:[o.aNF],decls:10,vars:11,consts:[["title","Workspace","subtitle","Geo"],["codeFolder","geo/workspace"],[1,"m-b-16",3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["igoWorkspaceSelector","",3,"store","map"],[4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],[3,"paginatorChange","store","paginatorOptions","entitySortChange$"],[3,"store","horizontal","withToggleButton","withTitle","mode",4,"ngIf"],["class","table-compact table-centered",3,"paginator","scrollBehavior","store","template",4,"ngIf"],[3,"workspace"],[3,"store","horizontal","withToggleButton","withTitle","mode"],[1,"table-compact","table-centered",3,"paginator","scrollBehavior","store","template"]],template:function(S,$){1&S&&(o.j41(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.nrm(4,"igo-zoom-button",4),o.k0s()(),o.nrm(5,"igo-workspace-selector",5),o.DNE(6,ds,3,3,"ng-container",6),o.nI1(7,"async"),o.DNE(8,fs,7,8,"ng-container",6),o.nI1(9,"async"),o.k0s()()),2&S&&(o.R7$(2),o.Y8G("map",$.map)("view",$.view),o.R7$(2),o.Y8G("map",$.map),o.R7$(),o.Y8G("store",$.workspaceStore)("map",$.map),o.R7$(),o.Y8G("ngIf",o.bMT(7,7,$.selectedWorkspace$)),o.R7$(2),o.Y8G("ngIf",o.bMT(9,9,$.selectedWorkspace$)))},dependencies:[H.Jj,e.g,c.s,M.f7,ze.Vn,M.CA,p.YvR,p.KnQ,p.LzH,Q.go,p.kjk,Q.qP,Cr.Hu,Cr.m2,H.bT],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-entity-table[_ngcontent-%COMP%]{height:400px}igo-actionbar[_ngcontent-%COMP%]{height:48px}"]})}return J})()}]},92913:(De,le,r)=>{"use strict";r.d(le,{c:()=>a});const a={production:!0,igo:{directionsSources:{osrm:{name:"OSRM Qu\xe9bec",baseUrl:"/apis/itineraire/route/v1/",profiles:[{name:"driving"},{name:"forestier",authorization:{url:"/apis/igo2/user/igo",property:"hasOsrmPrivateAccess"}}]}},projections:[{code:"EPSG:32198",alias:"Quebec Lambert",def:"+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",extent:[-886251.0296,180252.9126,897177.3418,2106143.8139]}],auth:{tokenKey:"testIgo2Lib",intern:{enabled:!0},allowAnonymous:!0},interactiveTour:{tourInMobile:!0,activateInteractiveTour:!0},importExport:{url:"https://geoegl.msp.gouv.qc.ca/apis/ogre"},language:{prefix:"./locale/"},catalog:{sources:[{id:"Gououvert",title:"Gouvouvert",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi"},{id:"DefiningInfoFormat",title:"Defining info_format",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryFormat:{html:"*",json:["stations_meteoroutieres","histo_stations_meteoroutieres"]},queryHtmlTarget:"iframe",count:30},{id:"catalogwithregex",title:"Filtered catalog by regex",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",regFilters:["zpegt"]},{id:"catalogwithtooltipcontrol",title:"Controling tooltip format",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",tooltipType:r(19032).IbQ.ABSTRACT}]},monitoring:{provider:"sentry",dsn:"https://examplePublicKey@o0.ingest.sentry.io/0",identifyUser:!0},searchSources:{storedqueriesreverse:{enabled:!1},nominatim:{enabled:!1},icherche:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",order:2,enabled:!0,params:{limit:"8"},showAdvancedSettings:!0},coordinatesreverse:{showInPointerSummary:!0},icherchereverse:{showInPointerSummary:!0,searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",order:3,enabled:!0},ilayer:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",order:4,enabled:!0,params:{limit:"5"}}}}}},55711:(De,le,r)=>{"use strict";var M=r(46443),a=r(68559),F=r(84175),p=r(15944),e=r(93840),c=r(20943),o=r(17049),L=r(39552),R=r(80640),v=r(80436),y=r(32552),b=r(58610),k=r(30699),_=r(36991),D=r(60316),h=r(67778),X=r(67143),H=r(21701),x=r(1455),ee=r(77919),Z=r(61318),G=r(89475);let U=(()=>{class he{messageService;constructor(Ae){this.messageService=Ae}intercept(Ae,Qe){const Ge=Ae.headers.get("interceptError"),at=Ae.clone({headers:Ae.headers.delete("interceptError")});if("false"===Ge)return Qe.handle(at);const Oe={httpError:void 0};return Qe.handle(at).pipe((0,Z.W)(Ye=>this.handleError(Ye,Oe)),(0,G.j)(()=>{const Ye=Oe.httpError;Ye&&(Ye.error.toDisplay?this.handleCaughtError(Ye):Ye.error.caught||this.handleUncaughtError(Ye))}))}handleError(Ae,Qe){if(Ae instanceof M.yz){const Ge="object"===Ae.error?Ae.error:{};Ge.message=Ae.error?.message||Ae.statusText,Ge.caught=!1,Ae=new M.yz({error:Ge,headers:Ae.headers,status:Ae.status,statusText:Ae.statusText,url:Ae.url})}return Qe.httpError=Ae,(0,ee.$)(Ae)}handleCaughtError(Ae){Ae.error.caught=!0,this.messageService.error(Ae.error.message,Ae.error.title,{progressBar:!1})}handleUncaughtError(Ae){Ae.error.caught=!0,this.messageService.error("igo.core.errors.uncaught.message","igo.core.errors.uncaught.title",{progressBar:!1})}static \u0275fac=function(Qe){return new(Qe||he)(a.KVO(x.bg))};static \u0275prov=a.jDH({token:he,factory:he.\u0275fac,providedIn:"root"})}return he})(),N=(()=>{class he{static forRoot(){return{ngModule:he,providers:[{provide:M.a7,useClass:U,multi:!0}]}}constructor(Ae){if(Ae)throw new Error("IgoErrorModule is already loaded. Import it in the AppModule only")}static \u0275fac=function(Qe){return new(Qe||he)(a.KVO(he,12))};static \u0275mod=a.$C({type:he});static \u0275inj=a.G2t({})}return he})();var W=r(51307);r(20279);const g={name:"igo2DB",version:2,objectStoresMeta:[{store:"geoData",storeConfig:{keyPath:"url",autoIncrement:!1},storeSchema:[{name:"regionID",keypath:"regionID",options:{unique:!1}}]},{store:"layerData",storeConfig:{keyPath:"layerId",autoIncrement:!1},storeSchema:[{name:"layerOptions",keypath:"layerOptions",options:{unique:!1}},{name:"sourceOptions",keypath:"sourceOptions",options:{unique:!1}}]}]};let u=(()=>{class he{static forRoot(Ae={}){return{ngModule:he,providers:[(0,X.ec)(Ae),(0,H.X$)()]}}constructor(){}static \u0275fac=function(Qe){return new(Qe||he)};static \u0275mod=a.$C({type:he});static \u0275inj=a.G2t({providers:[(0,x.Fi)()],imports:[D.MD,M.q1,h.Vl.forRoot(),N.forRoot(),W.L7.forRoot(g),h.Vl,N,H.Ck]})}return he})();var O=r(90353),j=r(68671),P=r(2435),Y=r(60591),w=r(33008),I=r(20293),E=r(64654),s=r(48723),z=r(87674),Q=r(417),ae=r(49156),ye=r(84398);const ue=[{title:"Home",path:"home",component:(()=>{class he{interactiveTourService;constructor(Ae){this.interactiveTourService=Ae}startTour(){this.interactiveTourService.startTour("global")}static \u0275fac=function(Qe){return new(Qe||he)(a.rXU(Q.Gq))};static \u0275cmp=a.VBU({type:he,selectors:[["app-home"]],standalone:!0,features:[a.aNF],decls:58,vars:0,consts:[[2,"text-align","center"],["id","igo-title"],["width","180","src","assets/igo2/core/logo.png",1,"igo-logo"],["tourToStart","global","menuIsOpen","true","styleButton","raised"],[1,"mat-body-1"],["target","_blank","rel","noopener","href","https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation"],["target","_blank","rel","noopener","href","https://angular.io/docs"]],template:function(Qe,Ge){1&Qe&&(a.j41(0,"app-doc-viewer")(1,"div",0)(2,"h1",1),a.EFF(3,"Welcome to IGO"),a.k0s(),a.nrm(4,"img",2),a.k0s(),a.j41(5,"p"),a.nrm(6,"igo-interactive-tour",3),a.k0s(),a.j41(7,"p",4),a.EFF(8," IGO2 library contains many components and services that may benefit any web application. "),a.nrm(9,"br"),a.EFF(10," IGO2 library is open source project using Angular, Angular Material and OpenLayers. "),a.k0s(),a.j41(11,"h3"),a.EFF(12,"IGO2 library is divided into several elements:"),a.k0s(),a.j41(13,"ul",4)(14,"li")(15,"b"),a.EFF(16,"@igo2/utils"),a.k0s(),a.EFF(17," : Basic utilies without dependency (ex: base64, clipboard, uuid) "),a.k0s(),a.j41(18,"li")(19,"b"),a.EFF(20,"@igo2/core"),a.k0s(),a.EFF(21," : Element affecting the core of the application (ex: config, language, message, media, request) "),a.k0s(),a.j41(22,"li")(23,"b"),a.EFF(24,"@igo2/common"),a.k0s(),a.EFF(25," : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table) "),a.k0s(),a.j41(26,"li")(27,"b"),a.EFF(28,"@igo2/auth"),a.k0s(),a.EFF(29," : Library grouping the authentication and security module "),a.k0s(),a.j41(30,"li")(31,"b"),a.EFF(32,"@igo2/geo"),a.k0s(),a.EFF(33," : Library containing the geomatic components. Depends on Openlayers. "),a.k0s(),a.j41(34,"li")(35,"b"),a.EFF(36,"@igo2/context"),a.k0s(),a.EFF(37," : Library of components uniting @igo2/geo and @igo2/auth "),a.k0s(),a.j41(38,"li")(39,"b"),a.EFF(40,"@igo2/integration"),a.k0s(),a.EFF(41," : Library integrate basic components"),a.k0s()(),a.j41(42,"h2"),a.EFF(43,"Here are some links to help you start:"),a.k0s(),a.j41(44,"ul")(45,"li")(46,"h2")(47,"a",5),a.EFF(48,"Installation"),a.k0s()()(),a.j41(49,"li")(50,"h2")(51,"a",6),a.EFF(52,"Angular Documentation"),a.k0s()()()(),a.j41(53,"span",4),a.EFF(54,"*** Modules in "),a.j41(55,"code"),a.EFF(56,"@igo2/core"),a.k0s(),a.EFF(57," must be imported only once"),a.k0s()())},dependencies:[ae.g,Q.io,ye.I]})}return he})()},{title:"Auth",path:"auth",loadChildren:()=>Promise.resolve().then(r.bind(r,33008)).then(he=>he.routes)},{title:"Common",path:"common",loadChildren:()=>Promise.resolve().then(r.bind(r,20293)).then(he=>he.routes)},{title:"Context",path:"context",loadChildren:()=>Promise.resolve().then(r.bind(r,64654)).then(he=>he.routes)},{title:"Core",path:"core",loadChildren:()=>Promise.resolve().then(r.bind(r,48723)).then(he=>he.routes)},{title:"Geo",path:"geo",loadChildren:()=>Promise.resolve().then(r.bind(r,87674)).then(he=>he.routes)},{path:"**",redirectTo:"/home"}],ce=[{title:"Home",path:"home",redirectTo:"/home",pathMatch:"full"},{title:"Core",path:"core",children:re(s.routes)},{title:"Auth",path:"auth",children:re(w.routes)},{title:"Common",path:"common",children:re(I.routes)},{title:"Geo",path:"geo",children:re(z.routes)},{title:"Context",path:"context",children:re(E.routes)}];function re(he){return he.filter($e=>$e.title).sort(($e,Ae)=>$e.title.localeCompare(Ae.title))}var be=r(87912),_e=r(14102);const Le=()=>({exact:!0});function We(he,$e){if(1&he&&(a.qex(0),a.j41(1,"mat-nav-list")(2,"a",11),a.EFF(3),a.k0s()(),a.nrm(4,"mat-divider"),a.bVm()),2&he){const Ae=a.XpG().$implicit;a.R7$(2),a.Y8G("routerLink",Ae.path)("routerLinkActiveOptions",a.lJ4(3,Le)),a.R7$(),a.JRh(Ae.title)}}function Xe(he,$e){if(1&he&&(a.j41(0,"a",14),a.EFF(1),a.k0s()),2&he){const Ae=$e.$implicit,Qe=a.XpG(2).$implicit;a.Y8G("routerLink",Qe.path+"/"+Ae.path),a.R7$(),a.JRh(Ae.title)}}function Be(he,$e){if(1&he&&(a.j41(0,"mat-expansion-panel",12)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),a.EFF(3),a.k0s()(),a.j41(4,"mat-nav-list"),a.DNE(5,Xe,2,2,"a",13),a.k0s()(),a.nrm(6,"mat-divider")),2&he){const Ae=a.XpG().$implicit;a.R7$(3),a.SpI(" ",Ae.title," "),a.R7$(2),a.Y8G("ngForOf",Ae.children)}}function rt(he,$e){if(1&he&&(a.qex(0),a.DNE(1,We,5,4,"ng-container",10)(2,Be,7,2,"ng-template",null,1,a.C5r),a.bVm()),2&he){const Ae=$e.$implicit,Qe=a.sdS(3);a.R7$(),a.Y8G("ngIf",!Ae.children)("ngIfElse",Qe)}}let Ie=(()=>{class he{document;changeDetectorRef;media;router;mobileQuery;routesConfig=ce;title="IGO";version=X.rE;_mobileQueryListener;constructor(Ae,Qe,Ge,at){this.document=Ae,this.changeDetectorRef=Qe,this.media=Ge,this.router=at,this.mobileQuery=this.media.matchMedia("(max-width: 600px)"),this._mobileQueryListener=()=>this.changeDetectorRef.detectChanges(),this.mobileQuery.addEventListener("change",this._mobileQueryListener),this.detectOldBrowser()}ngOnInit(){this.handleSplashScreen()}handleSplashScreen(){this.router.events.pipe((0,P.$)(Ae=>Ae instanceof b.wF),(0,Y.c)(300)).subscribe(()=>{this._removeSplashScreen()})}_removeSplashScreen(){const Ae=this.document.getElementById("splash-screen");if(!Ae)return;Ae.classList.add("is-destroying");const Ge=this.document.getElementById("splash-screen-stylesheet");setTimeout(()=>{j.ED.remove(Ae),j.ED.remove(Ge)},300)}ngOnDestroy(){this.mobileQuery.removeEventListener("change",this._mobileQueryListener)}detectOldBrowser(){j.N1.satisfies({ie:"<=11",chrome:"<64",firefox:"<60"})&&console.log("Very old browser ! ",j.N1.getBrowser())}static \u0275fac=function(Qe){return new(Qe||he)(a.rXU(D.qQ),a.rXU(a.gRc),a.rXU(be.DY),a.rXU(b.Ix))};static \u0275cmp=a.VBU({type:he,selectors:[["app-root"]],standalone:!0,features:[a.aNF],decls:16,vars:9,consts:[["snav",""],["routeWithChildren",""],[1,"example-container"],["color","primary",1,"example-toolbar","mat-elevation-z6"],["mat-icon-button","",3,"click"],[1,"mat-subtitle-1","m-b-0"],[1,"example-sidenav-container"],["opened","true","fixedTopGap","48",3,"mode","fixedInViewport"],["displayMode","flat","multi",""],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["mat-list-item","","routerLinkActive","active-link",1,"p-h-24","m-t-8",3,"routerLink","routerLinkActiveOptions"],["expanded",""],["mat-list-item","","routerLinkActive","active-link",3,"routerLink",4,"ngFor","ngForOf"],["mat-list-item","","routerLinkActive","active-link",3,"routerLink"]],template:function(Qe,Ge){if(1&Qe){const at=a.RV6();a.j41(0,"div",2)(1,"mat-toolbar",3)(2,"button",4),a.bIt("click",function(){a.eBV(at);const Ye=a.sdS(11);return a.Njj(Ye.toggle())}),a.j41(3,"mat-icon"),a.EFF(4,"menu"),a.k0s()(),a.j41(5,"h1"),a.EFF(6),a.k0s(),a.j41(7,"h5",5),a.EFF(8),a.k0s()(),a.j41(9,"mat-sidenav-container",6)(10,"mat-sidenav",7,0)(12,"mat-accordion",8),a.DNE(13,rt,4,2,"ng-container",9),a.k0s()(),a.j41(14,"mat-sidenav-content"),a.nrm(15,"router-outlet"),a.k0s()()()}2&Qe&&(a.AVh("example-is-mobile",Ge.mobileQuery.matches),a.R7$(6),a.JRh(Ge.title),a.R7$(2),a.JRh(Ge.version.lib),a.R7$(),a.xc7("margin-top",Ge.mobileQuery.matches?48:0,"px"),a.R7$(),a.Y8G("mode",Ge.mobileQuery.matches?"over":"side")("fixedInViewport",Ge.mobileQuery.matches),a.R7$(3),a.Y8G("ngForOf",Ge.routesConfig))},dependencies:[D.pM,D.bT,O.MY,O.BS,O.GK,O.Z2,O.WN,L.s5,L.KQ,F.Hl,F.iY,e.m_,e.An,o.vg,o.LG,o.US,o.El,c.Fg,c._L,c.YE,_e.q,b.Wk,b.wQ,b.n3],styles:[".example-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;inset:0}.example-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;z-index:2}.example-toolbar[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}mat-panel-title[_ngcontent-%COMP%]{font-size:14px}mat-nav-list[_ngcontent-%COMP%]{padding:0}mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:unset!important}mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0 8px 16px}.active-link[_ngcontent-%COMP%]     span{font-weight:700}.example-is-mobile[_ngcontent-%COMP%]   .example-toolbar[_ngcontent-%COMP%]{position:fixed;z-index:2}.example-sidenav-container[_ngcontent-%COMP%]{flex:1}.example-is-mobile[_ngcontent-%COMP%]   .example-sidenav-container[_ngcontent-%COMP%]{flex:1 0 auto}.example-is-mobile[_ngcontent-%COMP%]   mat-sidenav[_ngcontent-%COMP%]{background-color:#fff}mat-sidenav-content[_ngcontent-%COMP%]{box-sizing:border-box}"]})}return he})();var Ve=r(92913);Ve.c.production&&(0,a.SmG)(),(0,v.B8)(Ie,{providers:[(0,a.oKB)(u,v.Bb,v.fM,F.Hl,e.m_,c.Fg,o.vg,L.s5),(0,M.$R)((0,M.YH)()),(0,b.lh)(ue,(0,b.Sn)(b.Kp)),(0,y.vF)(),(0,X.ec)({default:Ve.c.igo}),(0,H.X$)(),(0,k.rY)(),(0,_.BD)(),{provide:p.U$,useValue:{appearance:"outline"}},{provide:R.sM,useValue:{showDelay:500,hideDelay:0,touchendHideDelay:0,disableTooltipInteractivity:!0}}]}).catch(he=>console.log(he))},35358:(De,le,r)=>{var M={"./af":85637,"./af.js":85637,"./ar":6777,"./ar-dz":74508,"./ar-dz.js":74508,"./ar-kw":67504,"./ar-kw.js":67504,"./ar-ly":95373,"./ar-ly.js":95373,"./ar-ma":92412,"./ar-ma.js":92412,"./ar-ps":78823,"./ar-ps.js":78823,"./ar-sa":36670,"./ar-sa.js":36670,"./ar-tn":36448,"./ar-tn.js":36448,"./ar.js":6777,"./az":23009,"./az.js":23009,"./be":28299,"./be.js":28299,"./bg":4685,"./bg.js":4685,"./bm":11171,"./bm.js":11171,"./bn":23590,"./bn-bd":5841,"./bn-bd.js":5841,"./bn.js":23590,"./bo":54309,"./bo.js":54309,"./br":54130,"./br.js":54130,"./bs":8033,"./bs.js":8033,"./ca":55294,"./ca.js":55294,"./cs":53028,"./cs.js":53028,"./cv":5807,"./cv.js":5807,"./cy":70342,"./cy.js":70342,"./da":38269,"./da.js":38269,"./de":11489,"./de-at":42123,"./de-at.js":42123,"./de-ch":17757,"./de-ch.js":17757,"./de.js":11489,"./dv":28152,"./dv.js":28152,"./el":7687,"./el.js":7687,"./en-au":46668,"./en-au.js":46668,"./en-ca":76798,"./en-ca.js":76798,"./en-gb":53615,"./en-gb.js":53615,"./en-ie":91364,"./en-ie.js":91364,"./en-il":79907,"./en-il.js":79907,"./en-in":70533,"./en-in.js":70533,"./en-nz":33190,"./en-nz.js":33190,"./en-sg":51096,"./en-sg.js":51096,"./eo":3962,"./eo.js":3962,"./es":37726,"./es-do":65010,"./es-do.js":65010,"./es-mx":63654,"./es-mx.js":63654,"./es-us":59043,"./es-us.js":59043,"./es.js":37726,"./et":25343,"./et.js":25343,"./eu":90728,"./eu.js":90728,"./fa":60787,"./fa.js":60787,"./fi":71771,"./fi.js":71771,"./fil":45335,"./fil.js":45335,"./fo":69761,"./fo.js":69761,"./fr":1670,"./fr-ca":28991,"./fr-ca.js":28991,"./fr-ch":97280,"./fr-ch.js":97280,"./fr.js":1670,"./fy":24203,"./fy.js":24203,"./ga":69858,"./ga.js":69858,"./gd":38605,"./gd.js":38605,"./gl":27365,"./gl.js":27365,"./gom-deva":33896,"./gom-deva.js":33896,"./gom-latn":95587,"./gom-latn.js":95587,"./gu":97950,"./gu.js":97950,"./he":92029,"./he.js":92029,"./hi":51897,"./hi.js":51897,"./hr":29816,"./hr.js":29816,"./hu":22253,"./hu.js":22253,"./hy-am":28196,"./hy-am.js":28196,"./id":73688,"./id.js":73688,"./is":95474,"./is.js":95474,"./it":23099,"./it-ch":45807,"./it-ch.js":45807,"./it.js":23099,"./ja":19127,"./ja.js":19127,"./jv":30182,"./jv.js":30182,"./ka":10758,"./ka.js":10758,"./kk":93444,"./kk.js":93444,"./km":72034,"./km.js":72034,"./kn":46223,"./kn.js":46223,"./ko":83064,"./ko.js":83064,"./ku":8714,"./ku-kmr":10961,"./ku-kmr.js":10961,"./ku.js":8714,"./ky":12062,"./ky.js":12062,"./lb":84796,"./lb.js":84796,"./lo":19279,"./lo.js":19279,"./lt":106,"./lt.js":106,"./lv":11840,"./lv.js":11840,"./me":42240,"./me.js":42240,"./mi":13588,"./mi.js":13588,"./mk":15518,"./mk.js":15518,"./ml":37823,"./ml.js":37823,"./mn":98657,"./mn.js":98657,"./mr":61285,"./mr.js":61285,"./ms":43014,"./ms-my":86253,"./ms-my.js":86253,"./ms.js":43014,"./mt":20167,"./mt.js":20167,"./my":47940,"./my.js":47940,"./nb":50014,"./nb.js":50014,"./ne":49023,"./ne.js":49023,"./nl":34208,"./nl-be":71412,"./nl-be.js":71412,"./nl.js":34208,"./nn":81354,"./nn.js":81354,"./oc-lnc":40870,"./oc-lnc.js":40870,"./pa-in":80389,"./pa-in.js":80389,"./pl":7342,"./pl.js":7342,"./pt":34774,"./pt-br":73003,"./pt-br.js":73003,"./pt.js":34774,"./ro":85333,"./ro.js":85333,"./ru":73451,"./ru.js":73451,"./sd":43921,"./sd.js":43921,"./se":59682,"./se.js":59682,"./si":80582,"./si.js":80582,"./sk":4348,"./sk.js":4348,"./sl":95337,"./sl.js":95337,"./sq":39358,"./sq.js":39358,"./sr":50683,"./sr-cyrl":69382,"./sr-cyrl.js":69382,"./sr.js":50683,"./ss":51156,"./ss.js":51156,"./sv":29855,"./sv.js":29855,"./sw":18536,"./sw.js":18536,"./ta":15373,"./ta.js":15373,"./te":37809,"./te.js":37809,"./tet":61297,"./tet.js":61297,"./tg":92527,"./tg.js":92527,"./th":85862,"./th.js":85862,"./tk":79331,"./tk.js":79331,"./tl-ph":44387,"./tl-ph.js":44387,"./tlh":3592,"./tlh.js":3592,"./tr":79732,"./tr.js":79732,"./tzl":99570,"./tzl.js":99570,"./tzm":83553,"./tzm-latn":7699,"./tzm-latn.js":7699,"./tzm.js":83553,"./ug-cn":25674,"./ug-cn.js":25674,"./uk":69974,"./uk.js":69974,"./ur":45773,"./ur.js":45773,"./uz":357,"./uz-latn":77135,"./uz-latn.js":77135,"./uz.js":357,"./vi":20043,"./vi.js":20043,"./x-pseudo":40767,"./x-pseudo.js":40767,"./yo":80150,"./yo.js":80150,"./zh-cn":21828,"./zh-cn.js":21828,"./zh-hk":86644,"./zh-hk.js":86644,"./zh-mo":79305,"./zh-mo.js":79305,"./zh-tw":31860,"./zh-tw.js":31860};function a(p){var e=F(p);return r(e)}function F(p){if(!r.o(M,p)){var e=new Error("Cannot find module '"+p+"'");throw e.code="MODULE_NOT_FOUND",e}return M[p]}a.keys=function(){return Object.keys(M)},a.resolve=F,De.exports=a,a.id=35358}},De=>{De.O(0,[502],()=>De(De.s=55711)),De.O()}]);
//# sourceMappingURL=main.7f88e0b4cdfd4a62.js.map